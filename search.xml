<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[tmux + vim的复制配置]]></title>
    <url>%2F2019%2F02%2F22%2Ftmux_%2B_vim%E7%9A%84%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[&#x505A;&#x5D4C;&#x5165;&#x5F0F;&#x7684;&#x540C;&#x5B66;&#xFF0C;&#x5927;&#x591A;&#x5728;Linux&#x73AF;&#x5883;&#x4E0B;&#x5F00;&#x53D1;&#x3002;&#x73B0;&#x5728;&#x4E5F;&#x6709;&#x5F88;&#x591A;&#x540C;&#x5B66;&#x7528;OSX&#x5F00;&#x53D1;&#x3002;&#x5176;&#x5B9E;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;&#x7C7B;Linux&#x7CFB;&#x7EDF;&#x3002;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x6548;&#x7387;&#x5F88;&#x91CD;&#x8981;&#x3002;&#x6709;&#x5F88;&#x591A;&#x91CD;&#x590D;&#x7410;&#x788E;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x63D0;&#x9AD8;&#x4E00;&#x70B9;&#x6548;&#x7387;&#xFF0C;&#x591A;&#x6B21;&#x7D2F;&#x79EF;&#x8D77;&#x6765;&#xFF0C;&#x8282;&#x7701;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x7CBE;&#x529B;&#x4E5F;&#x662F;&#x53EF;&#x89C2;&#x7684;&#x3002;&#x5728;&#x63D0;&#x5347;&#x6548;&#x7387;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x505A;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x6548;&#x7387;&#xFF0C;&#x800C;&#x907F;&#x514D;&#x7410;&#x788E;&#x91CD;&#x590D;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;&#x4E5F;&#x5F88;&#x6709;&#x52A9;&#x4E8E;&#x5FC3;&#x60C5;&#x7684;&#x6109;&#x60A6;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x4F46;&#x51E1;&#x6709;&#x673A;&#x4F1A;&#xFF0C;&#x6211;&#x90FD;&#x4F1A;&#x7ED9;&#x522B;&#x4EBA;&#x5B89;&#x5229;&#x4E00;&#x4E9B;&#x597D;&#x7528;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x4F8B;&#x5982;tmux&#xFF0C;vim&#xFF0C;fish&#x554A;&#xFF0C;&#x7B49;&#x7B49;&#x3002; &#x6709;&#x4EBA;&#x79F0;tmux, zsh, vim&#x662F;&#x6587;&#x672C;&#x5904;&#x7406;&#x7684;&#x4E09;&#x5251;&#x5BA2;&#x3002;&#x8FD9;&#x4E09;&#x4E2A;&#x5DE5;&#x5177;&#x7528;&#x597D;&#x4E86;&#x786E;&#x5B9E;&#x597D;&#x7528;&#x3002;&#x6211;&#x76EE;&#x524D;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4F7F;&#x7528;&#x7684;&#x662F;fish + tmux + vim&#x3002;fish&#x7684;&#x4F5C;&#x7528;&#x548C;zsh&#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x672C;&#x6587;&#x60F3;&#x7740;&#x91CD;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x56F0;&#x6270;&#x6211;&#x5F88;&#x591A;&#x5E74;&#x7684;tmux + vim&#x7684;&#x526A;&#x8D34;&#x677F;&#x95EE;&#x9898;&#x3002; tmux&#x4E0B;&#x7684;&#x590D;&#x5236; &#x5728;&#x6BD5;&#x4E1A;&#x540E;&#x7684;&#x82E5;&#x5E72;&#x5E74;&#x5185;&#xFF0C;&#x6211;&#x4E00;&#x76F4;&#x5728;Windows&#x4E0B;&#xFF0C;&#x4F7F;&#x7528;putty + ssh +tmux&#x8FDE;&#x63A5;&#x8FDC;&#x7AEF;&#x7684;Linux&#x670D;&#x52A1;&#x5668;&#x505A;&#x5F00;&#x53D1;&#x3002;&#x597D;&#x5904;&#x662F;&#xFF0C;tmux&#x53EF;&#x4EE5;&#x505A;session&#x7BA1;&#x7406;&#xFF0C;&#x5373;&#x4FBF;putty ssh&#x5173;&#x95ED;&#xFF0C;&#x4EFB;&#x52A1;&#x4E0D;&#x4F1A;&#x4E2D;&#x65AD;&#x3002;&#x53EA;&#x8981;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x5173;&#x95ED;&#xFF0C;&#x4E0B;&#x6B21;&#x6253;&#x5F00;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x6062;&#x590D;&#x5DE5;&#x4F5C;&#x73B0;&#x573A;&#x3002; tmux&#x5206;&#x5C4F;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x6587;&#x672C;&#x9009;&#x4E2D; tmux&#x4E2D;&#x7684;panel&#x5728;&#x591A;&#x4EFB;&#x52A1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x975E;&#x5E38;&#x597D;&#x7528;&#x3002;&#x4F46;&#x5E26;&#x6765;&#x7684;&#x95EE;&#x9898;&#x662F;&#xFF0C;&#x5F53;tmux&#x6709;&#x6A2A;&#x5411;&#x5206;&#x5C4F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x590D;&#x5236;&#x597D;&#x56F0;&#x96BE;&#xFF08;&#x56FE;&#x622A;&#x4E0D;&#x51FA;&#x6765;&#xFF0C;&#x76F8;&#x4FE1;&#x4F7F;&#x7528;tmux&#x7684;&#x65B0;&#x624B;&#x540C;&#x5B66;&#xFF0C;&#x5E94;&#x8BE5;&#x90FD;&#x9047;&#x5230;&#x8FC7;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF09;&#x3002;&#x89E3;&#x51B3;&#x7684;&#x529E;&#x6CD5;&#x662F;&#xFF0C;&#x6253;&#x5F00;tmux&#x7684;&#x9F20;&#x6807;&#x6A21;&#x5F0F;&#xFF1A; set-option -g mouse on &#x6B64;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;&#x9F20;&#x6807;&#x9009;&#x4E2D;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x8DE8;&#x8D8A;&#x5206;&#x5C4F;&#x8FB9;&#x754C;&#x3002;&#x600E;&#x4E48;&#x590D;&#x5236;&#xFF0C;&#x5BF9;&#x4E8E;&#x65B0;&#x624B;&#x6765;&#x8BF4;&#xFF0C;&#x53C8;&#x662F;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002; tmux&#x590D;&#x5236;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x590D;&#x5236; tmux&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x901A;&#x8FC7;bind-key&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x672C;&#x8EAB;&#x6709;&#x4E00;&#x5957;&#x9ED8;&#x8BA4;&#x7684;bind-key table&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;tmux&#x63D2;&#x4EF6;&#x4E5F;&#x53EF;&#x4EE5;&#x5E2E;&#x4F60;&#x5B9A;&#x4E49;&#x3002;&#x6240;&#x4EE5;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x6E05;&#x695A;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x81EA;&#x884C;&#x67E5;bind-key table&#x3002;&#x65B9;&#x6CD5;&#x662F;&#xFF1A; &#x901A;&#x8FC7;ctrl + :&#x8FDB;&#x5165;tmux&#x547D;&#x4EE4;&#x6A21;&#x5F0F; &#x6267;&#x884C;list-keys&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x4E86; &#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x8F83;&#x65B0;&#x7684;tmux &#xFF0C;&#x4F8B;&#x5982;&#x7B14;&#x8005;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x6700;&#x65B0;release&#x7248;tmux2.8&#xFF0C;&#x4E2D;&#x7684;bind-key table&#x8F83;&#x8001;&#x677F;&#x7684;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x3002;&#x636E;&#x8BF4;tmux&#x4E2D;&#x95F4;&#x8FDB;&#x884C;&#x8FC7;&#x91CD;&#x6784;&#xFF0C;&#x5BFC;&#x81F4;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x5176;&#x5B9E;&#x5E76;&#x4E0D;&#x517C;&#x5BB9;&#x8001;&#x7248;&#x672C;&#x3002;&#x6240;&#x4EE5;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x65B0;&#x7248;&#x672C;&#x3002; Ubuntu 16.04 LTS&#x7248;&#x672C;&#x7684;&#x6E90;&#x4E2D;&#x81EA;&#x5E26;&#x7684;tmux&#x662F;2.1&#x7684;&#x3002;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x6CA1;&#x6CD5;&#x4F7F;&#x7528; # tmux 2.8 list-keys bind-key -T copy-mode C-Space send-keys -X begin-selection bind-key -T copy-mode C-a send-keys -X start-of-line bind-key -T copy-mode C-b send-keys -X cursor-left bind-key -T copy-mode C-c send-keys -X cancel bind-key -T copy-mode C-e send-keys -X end-of-line bind-key -T copy-mode C-f send-keys -X cursor-right bind-key -T copy-mode C-g send-keys -X clear-selection bind-key -T copy-mode C-k send-keys -X copy-end-of-line bind-key -T copy-mode C-n send-keys -X cursor-down bind-key -T copy-mode C-p send-keys -X cursor-up # tmux 2.1 list-keys bind-key C-b send-prefix bind-key C-o rotate-window bind-key C-z suspend-client bind-key Space next-layout bind-key ! break-pane bind-key &quot; split-window bind-key # list-buffers bind-key $ command-prompt -I #S &quot;rename-session &apos;%%&apos;&quot; bind-key % split-window -h bind-key &amp; confirm-before -p &quot;kill-window #W? (y/n)&quot; kill-window &#x662F;&#x4E0D;&#x662F;&#x5F88;&#x4E0D;&#x4E00;&#x6837;&#xFF1F; &#x8BF7;&#x81EA;&#x884C;&#x5FFD;&#x7565;2.1&#x7248;&#x672C;&#x3002; 2.8&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x5176;&#x5B9E;&#x8FD0;&#x884C;&#x7684;&#x662F;&#x4E00;&#x4E2A;bind-key&#x547D;&#x4EE4;&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x53C2;&#x8003;tmux man page -T: &#x6307;&#x5B9A;&#x8868;&#x683C; -r: &#x6307;&#x5B9A;&#x8BE5;&#x6309;&#x952E;&#x53EF;&#x4EE5;repeat&#x3002;&#x4F8B;&#x5982;&#x8C03;&#x6574;panel&#x5927;&#x5C0F;&#xFF0C;&#x4F60;&#x4E0D;&#x60F3;&#x6BCF;&#x653E;&#x5927;&#x7F29;&#x5C0F;&#x4E00;&#x6B21;&#x90FD;&#x8981;&#x6309;prefix&#x5427;&#xFF0C;&#x90A3;&#x4F1A;&#x6293;&#x72C2;&#x7684;&#x3002; copy-mode&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5177;&#x4F53;table&#xFF0C;&#x5728;&#x4F60;&#x6309;&#x4E0B;ctrl + [&#x8FDB;&#x5165;&#x590D;&#x5236;&#x6A21;&#x5F0F;&#x65F6;&#x751F;&#x6548;&#x3002;&#x540C;&#x7406;&#x8FD8;&#x6709;&#x4E2A;&#x53EB;prefix&#x7684;table&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x666E;&#x901A;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x6309;&#x952E;&#x8868;&#x3002; &#x8BDD;&#x8BF4;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x5230;&#x5E95;&#x600E;&#x4E48;&#x590D;&#x5236;&#xFF1F;&#x641C;&#x7D22;&#x8FD9;&#x4E2A;&#x8868;&#x683C;&#x7684;&#x662F;&#x5426;&#x6709;copy-selection&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x901A;&#x5E38;Enter&#x4F1A;&#x88AB;&#x6620;&#x5C04;&#x6210;send-keys -X copy-selection-and-cancel&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x6309;&#x4E0B;Enter&#xFF0C;&#x9009;&#x4E2D;&#x7684;&#x6587;&#x5B57;&#x4F1A;&#x88AB;&#x590D;&#x5236;&#x5230;tmux&#x526A;&#x8D34;&#x677F;&#x3002; tmux&#x4E0B;&#x590D;&#x5236;&#x5230;Windows&#x526A;&#x8D34;&#x677F; &#x8FD9;&#x4E2A;&#x624D;&#x662F;&#x672C;&#x7BC7;&#x60F3;&#x8BF4;&#x7684;&#x8BDD;&#x9898;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x82B1;&#x4E86;&#x597D;&#x4E9B;&#x5E74;&#x624D;&#x627E;&#x5230;&#x7B54;&#x6848;&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x89C1;&#x7ECF;&#x9A8C;&#x7684;&#x4F20;&#x627F;&#x662F;&#x591A;&#x4E48;&#x91CD;&#x8981;&#x3002;&#x4E0B;&#x9762;&#x5148;&#x8BF4;&#x600E;&#x4E48;&#x505A;&#xFF0C;&#x518D;&#x8BF4;&#x4E3A;&#x4EC0;&#x4E48;&#x3002; &#x5982;&#x4F55;&#x505A;&#xFF1F; &#x9996;&#x5148;&#x5355;&#x7EAF;&#x9760;putty&#x662F;&#x6CA1;&#x529E;&#x6CD5;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;putty&#x53EA;&#x662F;&#x5355;&#x7EAF;&#x7684;terminal emulator&#x3002;&#x800C;Linux&#x7684;&#x526A;&#x8D34;&#x677F;&#x7BA1;&#x7406;&#x662F;&#x9700;&#x8981;X-Window&#x652F;&#x6301;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x4F60;&#x9700;&#x8981;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;X11 forwarding&#x7684;&#x73AF;&#x5883;&#x3002;X11 forwarding&#x6709;&#x5F88;&#x591A;&#x9014;&#x5F84;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x884C;google&#xFF0C;&#x7B14;&#x8005;&#x9009;&#x62E9;&#x7684;&#x662F;&#x4E00;&#x4E2A;turn key solution&#xFF0C;&#x5C31;&#x662F;&#x5B89;&#x88C5;MobaXTerm&#x3002;&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x5C31;&#x5DF2;&#x7ECF;&#x662F;&#x80FD;X11 server&#x548C;X11 forwarding&#x4E86;&#x3002; &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#xFF1A; &#x786E;&#x5B9A;&#x4F60;&#x7684;Linux&#x7CFB;&#x7EDF;&#x91CC;&#x6709;X11&#x754C;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BF7;&#x81EA;&#x884C;google&#x5B89;&#x88C5; &#x786E;&#x5B9A;&#x4F60;&#x7684;Linux&#x7CFB;&#x7EDF;&#x91CC;&#x6709;xclip, xsel&#x6216;xclipboard&#x4E09;&#x8005;&#x4E4B;&#x4E00; &#x5982;&#x679C;&#x4F60;&#x7684;DISPLAY&#x53D8;&#x91CF;&#x5728;tmux&#x4E0B;&#x4E0D;&#x6B63;&#x5E38;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;.tmux.conf&#x4E0B;&#x6DFB;&#x52A0; set -g update-environment &quot;\ DISPLAY \ &quot; bind-key: bind-key -T copy-mode y send-keys -X copy-pipe-and-cancel &quot;xsel -i --clipboard&quot; &#x6700;&#x540E;&#x4E00;&#x6B65;&#x66F4;&#x4F18;&#x96C5;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x662F;&#x5B89;&#x88C5;tmux-yank&#x63D2;&#x4EF6;&#x3002; &#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF1F; Linux&#x7684;&#x684C;&#x9762;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x4E86;&#x4E00;&#x4E2A;&#x526A;&#x8D34;&#x677F;&#xFF0C;&#x8FD9;&#x4E2A;&#x526A;&#x8D34;&#x677F;&#x4F9D;&#x8D56;&#x4E8E;X Window&#x7CFB;&#x7EDF;&#xFF0C;&#x7531;&#x524D;&#x8FF0;&#x7684;&#x51E0;&#x79CD;app&#x7BA1;&#x7406;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Windows&#x4E0B;&#x7684;clip.exe&#x3002;&#x5F53;&#x5728;Windows&#x4E0B;&#x7528;ssh&#x8FDE;&#x63A5;Linux&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;X11 forwarding&#xFF0C;&#x5219;&#x5728;Windows&#x4E0B;&#x662F;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x5230;xsel&#xFF0C;xclip&#x6216;&#x8005;xclipboard&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;Linux&#x7684;&#x526A;&#x8D34;&#x677F;&#x5185;&#x5BB9;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x597D;&#x4E86;X11 forwarding&#xFF0C;&#x5219;&#x5728;Windows&#x4E0B;&#x5C31;&#x80FD;&#x8BBF;&#x95EE;Linux&#x526A;&#x8D34;&#x677F;&#x3002; tmux&#x672C;&#x8EAB;&#x4E5F;&#x7BA1;&#x7406;&#x4E86;&#x4E00;&#x4E2A;&#x526A;&#x8D34;&#x677F;&#xFF0C;&#x79F0;&#x4E3A;buffer&#x3002;tmux&#x7684;&#x547D;&#x4EE4;copy-selection, paste-buffer, list-buffers&#x5C31;&#x662F;&#x9488;&#x5BF9;tmux&#x81EA;&#x8EAB;&#x7684;&#x526A;&#x8D34;&#x677F;&#x7684;&#x64CD;&#x4F5C;&#x3002;tmux&#x539F;&#x751F;&#x652F;&#x6301;&#xFF0C;&#x901A;&#x8FC7;&#x7A7A;&#x683C;&#x9009;&#x4E2D;&#xFF0C;Enter&#x590D;&#x5236;&#xFF0C;ctrl + ] &#x7C98;&#x8D34;&#x3002; &#x5982;&#x679C;&#x60F3;tmux&#x4E0B;&#x5C06;&#x7EC8;&#x7AEF;&#x663E;&#x793A;&#x5185;&#x5BB9;&#x590D;&#x5236;&#x5230;Windows&#x526A;&#x8D34;&#x677F;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x628A;tmux&#x526A;&#x8D34;&#x677F;&#x53D1;&#x9001;&#x5230;X11&#x7684;&#x526A;&#x8D34;&#x677F;&#x4E2D;&#x3002;tmux-yank&#x63D2;&#x4EF6;&#x505A;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4EF6;&#x4E8B;&#x3002;&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728;copy-mode-vi&#x8868;&#x683C;&#x91CC;&#x7ED1;&#x5B9A;&#x4EFB;&#x4F55;&#x6309;&#x952E;&#x6765;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#x60C5;&#x3002; vim&#x590D;&#x5236;&#x5230;Windows&#x526A;&#x8D34;&#x677F; &#x6CA1;&#x6709;&#x8FD0;&#x884C;&#x5728;tmux&#x4E0B;&#x7684;vim&#x6216;&#x662F;gvim&#x8981;&#x590D;&#x5236;&#x5230;Windows&#x526A;&#x8D34;&#x677F;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x662F;&#x7CFB;&#x7EDF;&#x526A;&#x8D34;&#x677F;&#xFF0C;&#x4F9D;&#x8D56;&#x7684;&#x662F;vim&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x64CD;&#x4F5C;&#x3002;&#x53EF;&#x4EE5;&#x81EA;&#x884C;google&#x3002;&#x7CFB;&#x7EDF;&#x526A;&#x8D34;&#x677F;&#x5BF9;&#x5E94;&#x7684;vim&#x5BC4;&#x5B58;&#x5668;&#x662F;: &quot;+&#x3002;&#x6240;&#x4EE5;&#x5728;vim&#x4E0B;&#x5982;&#x679C;&#x60F3;&#x590D;&#x5236;&#x5230;&#x7CFB;&#x7EDF;&#x526A;&#x8D34;&#x677F;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&quot;+y&#x6765;&#x53D6;&#x4EE3;&#x5E73;&#x65F6;&#x5E38;&#x7528;&#x7684;y&#x3002;&#x4F8B;&#x5982;&#xFF1A; &quot;+yy&#xFF1A;&#x590D;&#x5236;&#x5F53;&#x524D;&#x884C;&#x5230;&#x7CFB;&#x7EDF;&#x526A;&#x8D34;&#x677F; &quot;+yw&#xFF1A;&#x590D;&#x5236;&#x5F53;&#x524D;&#x7684;&#x5355;&#x8BCD;&#x5230;&#x7CFB;&#x7EDF;&#x526A;&#x8D34;&#x677F; &#x5982;&#x679C;vim&#x8FD0;&#x884C;&#x5728;tmux&#x4E0B;&#xFF0C;&#x56E0;&#x4E3A;tmux&#x81EA;&#x5E26;&#x7684;&#x526A;&#x8D34;&#x677F;&#x5C31;&#x6709;&#x70B9;&#x9EBB;&#x70E6;&#x4E86;&#x3002;&#x8FD9;&#x65F6;&#x5019;&#x6709;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#x5C31;&#x6BD4;&#x8F83;&#x6709;&#x7528;&#x4E86;&#x2014;&#x2014;vim-tmux-clipboard&#x3002;&#x4ED6;&#x4F9D;&#x8D56;&#x4E8E;&#x53E6;&#x4E00;&#x4E2A;vim&#x63D2;&#x4EF6;vim-tmux-focus-events&#x3002;&#x88C5;&#x597D;&#x8FD9;&#x4E24;&#x4E2A;&#x63D2;&#x4EF6;&#xFF0C;&#x5728;.tmux.conf&#x4E2D;&#x6DFB;&#x52A0; set -g focus-events on &#x5927;&#x529F;&#x544A;&#x6210;&#x3002;&#x73B0;&#x5728;&#x5728;vim&#x4E0B;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;yank&#x5FEB;&#x6377;&#x952E;&#xFF0C;&#x4E0D;&#x7528;&#x6307;&#x5B9A;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x590D;&#x5236;&#x5185;&#x5BB9;&#x5230;tmux&#x526A;&#x8D34;&#x677F;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x590D;&#x5236;&#x5230;&#x7CFB;&#x7EDF;&#x526A;&#x8D34;&#x677F;&#x3002; %E5%81%9A%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%9A%84%E5%90%8C%E5%AD%A6%EF%BC%8C%E5%A4%A7%E5%A4%9A%E5%9C%A8Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%80%E5%8F%91%E3%80%82%E7%8E%B0%E5%9C%A8%E4%B9%9F%E6%9C%89%E5%BE%88%E5%A4%9A%E5%90%8C%E5%AD%A6%E7%94%A8OSX%E5%BC%80%E5%8F%91%E3%80%82%E5%85%B6%E5%AE%9E%E4%BB%96%E4%BB%AC%E9%83%BD%E6%98%AF%E7%B1%BBLinux%E7%B3%BB%E7%BB%9F%E3%80%82%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%BC%80%E5%8F%91%E8%80%85%EF%BC%8C%E6%95%88%E7%8E%87%E5%BE%88%E9%87%8D%E8%A6%81%E3%80%82%E6%9C%89%E5%BE%88%E5%A4%9A%E9%87%8D%E5%A4%8D%E7%90%90%E7%A2%8E%E7%9A%84%E5%8A%A8%E4%BD%9C%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%83%BD%E6%8F%90%E9%AB%98%E4%B8%80%E7%82%B9%E6%95%88%E7%8E%87%EF%BC%8C%E5%A4%9A%E6%AC%A1%E7%B4%AF%E7%A7%AF%E8%B5%B7%E6%9D%A5%EF%BC%8C%E8%8A%82%E7%9C%81%E7%9A%84%E6%97%B6%E9%97%B4%E5%92%8C%E7%B2%BE%E5%8A%9B%E4%B9%9F%E6%98%AF%E5%8F%AF%E8%A7%82%E7%9A%84%E3%80%82%E5%9C%A8%E6%8F%90%E5%8D%87%E6%95%88%E7%8E%87%E7%9A%84%E5%90%8C%E6%97%B6%EF%BC%8C%E5%81%9A%E4%B8%80%E4%B8%AA%E5%BE%88%E6%9C%89%E6%95%88%E7%8E%87%EF%BC%8C%E8%80%8C%E9%81%BF%E5%85%8D%E7%90%90%E7%A2%8E%E9%87%8D%E5%A4%8D%E7%9A%84%E5%8A%A8%E4%BD%9C%EF%BC%8C%E4%B9%9F%E5%BE%88%E6%9C%89%E5%8A%A9%E4%BA%8E%E5%BF%83%E6%83%85%E7%9A%84%E6%84%89%E6%82%A6%E3%80%82%E6%89%80%E4%BB%A5%EF%BC%8C%E4%BD%86%E5%87%A1%E6%9C%89%E6%9C%BA%E4%BC%9A%EF%BC%8C%E6%88%91%E9%83%BD%E4%BC%9A%E7%BB%99%E5%88%AB%E4%BA%BA%E5%AE%89%E5%88%A9%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%EF%BC%8C%E4%BE%8B%E5%A6%82tmux%EF%BC%8Cvim%EF%BC%8Cfish%E5%95%8A%EF%BC%8C%E7%AD%89%E7%AD%89%E3%80%82%0A%0A%E6%9C%89%E4%BA%BA%E7%A7%B0tmux%2C%20zsh%2C%20vim%E6%98%AF%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E7%9A%84%E4%B8%89%E5%89%91%E5%AE%A2%E3%80%82%E8%BF%99%E4%B8%89%E4%B8%AA%E5%B7%A5%E5%85%B7%E7%94%A8%E5%A5%BD%E4%BA%86%E7%A1%AE%E5%AE%9E%E5%A5%BD%E7%94%A8%E3%80%82%E6%88%91%E7%9B%AE%E5%89%8D%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AFfish%20%2B%20tmux%20%2B%20vim%E3%80%82fish%E7%9A%84%E4%BD%9C%E7%94%A8%E5%92%8Czsh%E5%B7%AE%E4%B8%8D%E5%A4%9A%E3%80%82%E6%9C%AC%E6%96%87%E6%83%B3%E7%9D%80%E9%87%8D%E4%BB%8B%E7%BB%8D%E7%9A%84%E6%98%AF%E5%9B%B0%E6%89%B0%E6%88%91%E5%BE%88%E5%A4%9A%E5%B9%B4%E7%9A%84tmux%20%2B%20vim%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E9%97%AE%E9%A2%98%E3%80%82%0A%0A%23%23%20tmux%E4%B8%8B%E7%9A%84%E5%A4%8D%E5%88%B6%0A%0A%E5%9C%A8%E6%AF%95%E4%B8%9A%E5%90%8E%E7%9A%84%E8%8B%A5%E5%B9%B2%E5%B9%B4%E5%86%85%EF%BC%8C%E6%88%91%E4%B8%80%E7%9B%B4%E5%9C%A8Windows%E4%B8%8B%EF%BC%8C%E4%BD%BF%E7%94%A8putty%20%2B%20ssh%20%2Btmux%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%AB%AF%E7%9A%84Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9A%E5%BC%80%E5%8F%91%E3%80%82%E5%A5%BD%E5%A4%84%E6%98%AF%EF%BC%8Ctmux%E5%8F%AF%E4%BB%A5%E5%81%9Asession%E7%AE%A1%E7%90%86%EF%BC%8C%E5%8D%B3%E4%BE%BFputty%20ssh%E5%85%B3%E9%97%AD%EF%BC%8C%E4%BB%BB%E5%8A%A1%E4%B8%8D%E4%BC%9A%E4%B8%AD%E6%96%AD%E3%80%82%E5%8F%AA%E8%A6%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8D%E5%85%B3%E9%97%AD%EF%BC%8C%E4%B8%8B%E6%AC%A1%E6%89%93%E5%BC%80%E4%BB%8D%E7%84%B6%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D%E5%B7%A5%E4%BD%9C%E7%8E%B0%E5%9C%BA%E3%80%82%0A%0A%23%23%23%20tmux%E5%88%86%E5%B1%8F%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%96%87%E6%9C%AC%E9%80%89%E4%B8%AD%0A%0Atmux%E4%B8%AD%E7%9A%84panel%E5%9C%A8%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E9%9D%9E%E5%B8%B8%E5%A5%BD%E7%94%A8%E3%80%82%E4%BD%86%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98%E6%98%AF%EF%BC%8C%E5%BD%93tmux%E6%9C%89%E6%A8%AA%E5%90%91%E5%88%86%E5%B1%8F%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%A4%8D%E5%88%B6%E5%A5%BD%E5%9B%B0%E9%9A%BE%EF%BC%88%E5%9B%BE%E6%88%AA%E4%B8%8D%E5%87%BA%E6%9D%A5%EF%BC%8C%E7%9B%B8%E4%BF%A1%E4%BD%BF%E7%94%A8tmux%E7%9A%84%E6%96%B0%E6%89%8B%E5%90%8C%E5%AD%A6%EF%BC%8C%E5%BA%94%E8%AF%A5%E9%83%BD%E9%81%87%E5%88%B0%E8%BF%87%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%89%E3%80%82%E8%A7%A3%E5%86%B3%E7%9A%84%E5%8A%9E%E6%B3%95%E6%98%AF%EF%BC%8C%E6%89%93%E5%BC%80tmux%E7%9A%84%E9%BC%A0%E6%A0%87%E6%A8%A1%E5%BC%8F%EF%BC%9A%0A%0A%60%60%60tmux%0Aset-option%20-g%20mouse%20on%0A%60%60%60%0A%0A%E6%AD%A4%E6%97%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%80%9A%E8%BF%87%E9%BC%A0%E6%A0%87%E9%80%89%E4%B8%AD%EF%BC%8C%E5%B0%B1%E4%B8%8D%E4%BC%9A%E8%B7%A8%E8%B6%8A%E5%88%86%E5%B1%8F%E8%BE%B9%E7%95%8C%E3%80%82%E6%80%8E%E4%B9%88%E5%A4%8D%E5%88%B6%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%96%B0%E6%89%8B%E6%9D%A5%E8%AF%B4%EF%BC%8C%E5%8F%88%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E3%80%82%0A%0A%23%23%23%20tmux%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E5%A4%8D%E5%88%B6%0A%0Atmux%E7%9A%84%E6%89%80%E6%9C%89%E6%93%8D%E4%BD%9C%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87bind-key%E5%AE%9E%E7%8E%B0%E7%9A%84%E3%80%82%E6%9C%AC%E8%BA%AB%E6%9C%89%E4%B8%80%E5%A5%97%E9%BB%98%E8%AE%A4%E7%9A%84bind-key%20table%EF%BC%8C%E5%BD%93%E7%84%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89%EF%BC%8Ctmux%E6%8F%92%E4%BB%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%B8%AE%E4%BD%A0%E5%AE%9A%E4%B9%89%E3%80%82%E6%89%80%E4%BB%A5%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E6%B8%85%E6%A5%9A%E7%9A%84%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%87%AA%E8%A1%8C%E6%9F%A5bind-key%20table%E3%80%82%E6%96%B9%E6%B3%95%E6%98%AF%EF%BC%9A%0A%0A-%20%E9%80%9A%E8%BF%87%60ctrl%20%2B%20%3A%60%E8%BF%9B%E5%85%A5tmux%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%0A-%20%E6%89%A7%E8%A1%8C%60list-keys%60%E5%91%BD%E4%BB%A4%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%0A%0A%E8%BF%99%E9%87%8C%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%E8%BE%83%E6%96%B0%E7%9A%84tmux%20%EF%BC%8C%E4%BE%8B%E5%A6%82%E7%AC%94%E8%80%85%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%80%E6%96%B0release%E7%89%88tmux2.8%EF%BC%8C%E4%B8%AD%E7%9A%84bind-key%20table%E8%BE%83%E8%80%81%E6%9D%BF%E7%9A%84%E5%AE%8C%E5%85%A8%E4%B8%8D%E5%90%8C%E3%80%82%E6%8D%AE%E8%AF%B4tmux%E4%B8%AD%E9%97%B4%E8%BF%9B%E8%A1%8C%E8%BF%87%E9%87%8D%E6%9E%84%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%BE%88%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%85%B6%E5%AE%9E%E5%B9%B6%E4%B8%8D%E5%85%BC%E5%AE%B9%E8%80%81%E7%89%88%E6%9C%AC%E3%80%82%E6%89%80%E4%BB%A5%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%96%B0%E7%89%88%E6%9C%AC%E3%80%82%0A%0A%3E%20Ubuntu%2016.04%20LTS%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E4%B8%AD%E8%87%AA%E5%B8%A6%E7%9A%84tmux%E6%98%AF2.1%E7%9A%84%E3%80%82%E8%BF%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E5%BE%88%E5%A4%9A%E5%8A%9F%E8%83%BD%E6%B2%A1%E6%B3%95%E4%BD%BF%E7%94%A8%0A%3E%0A%3E%20%60%60%60tmux%0A%3E%20%23%20tmux%202.8%20list-keys%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-Space%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20begin-selection%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20start-of-line%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-left%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-c%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cancel%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20end-of-line%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-f%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-right%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-g%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20clear-selection%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-k%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20copy-end-of-line%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-n%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-down%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-p%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-up%0A%3E%20%0A%3E%20%23%20tmux%202.1%20list-keys%0A%3E%20bind-key%20%20%20%20%20%20%20%20C-b%20send-prefix%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%3E%20bind-key%20%20%20%20%20%20%20%20C-o%20rotate-window%0A%3E%20bind-key%20%20%20%20%20%20%20%20C-z%20suspend-client%0A%3E%20bind-key%20%20%20%20%20%20Space%20next-layout%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20!%20break-pane%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%22%20split-window%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%23%20list-buffers%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%24%20command-prompt%20-I%20%23S%20%22rename-session%20&apos;%25%25&apos;%22%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%25%20split-window%20-h%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%26%20confirm-before%20-p%20%22kill-window%20%23W%3F%20(y%2Fn)%22%20kill-window%0A%3E%20%60%60%60%0A%3E%0A%3E%20%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%9F%0A%3E%0A%3E%20%E8%AF%B7%E8%87%AA%E8%A1%8C%E5%BF%BD%E7%95%A52.1%E7%89%88%E6%9C%AC%E3%80%82%0A%3E%0A%3E%202.8%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%80%E8%A1%8C%E5%85%B6%E5%AE%9E%E8%BF%90%E8%A1%8C%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AAbind-key%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%85%B7%E4%BD%93%E5%8F%82%E6%95%B0%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%5Btmux%20man%20page%5D(http%3A%2F%2Fman.openbsd.org%2FOpenBSD-current%2Fman1%2Ftmux.1)%0A%3E%0A%3E%20-%20-T%3A%20%E6%8C%87%E5%AE%9A%E8%A1%A8%E6%A0%BC%0A%3E%20-%20-r%3A%20%E6%8C%87%E5%AE%9A%E8%AF%A5%E6%8C%89%E9%94%AE%E5%8F%AF%E4%BB%A5repeat%E3%80%82%E4%BE%8B%E5%A6%82%E8%B0%83%E6%95%B4panel%E5%A4%A7%E5%B0%8F%EF%BC%8C%E4%BD%A0%E4%B8%8D%E6%83%B3%E6%AF%8F%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F%E4%B8%80%E6%AC%A1%E9%83%BD%E8%A6%81%E6%8C%89prefix%E5%90%A7%EF%BC%8C%E9%82%A3%E4%BC%9A%E6%8A%93%E7%8B%82%E7%9A%84%E3%80%82%0A%3E%0A%3E%20copy-mode%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E5%85%B7%E4%BD%93table%EF%BC%8C%E5%9C%A8%E4%BD%A0%E6%8C%89%E4%B8%8B%60ctrl%20%2B%20%5B%60%E8%BF%9B%E5%85%A5%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E6%97%B6%E7%94%9F%E6%95%88%E3%80%82%E5%90%8C%E7%90%86%E8%BF%98%E6%9C%89%E4%B8%AA%E5%8F%ABprefix%E7%9A%84table%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%99%AE%E9%80%9A%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%8C%89%E9%94%AE%E8%A1%A8%E3%80%82%0A%0A%E8%AF%9D%E8%AF%B4%E8%BF%99%E4%B9%88%E5%A4%9A%EF%BC%8C%E5%88%B0%E5%BA%95%E6%80%8E%E4%B9%88%E5%A4%8D%E5%88%B6%EF%BC%9F%E6%90%9C%E7%B4%A2%E8%BF%99%E4%B8%AA%E8%A1%A8%E6%A0%BC%E7%9A%84%E6%98%AF%E5%90%A6%E6%9C%89%60copy-selection%60%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%E3%80%82%E6%89%80%E4%BB%A5%E9%80%9A%E5%B8%B8%60Enter%60%E4%BC%9A%E8%A2%AB%E6%98%A0%E5%B0%84%E6%88%90%60send-keys%20-X%20copy-selection-and-cancel%60%E3%80%82%E4%B9%9F%E5%B0%B1%E6%98%AF**%E6%8C%89%E4%B8%8BEnter%EF%BC%8C%E9%80%89%E4%B8%AD%E7%9A%84%E6%96%87%E5%AD%97%E4%BC%9A%E8%A2%AB%E5%A4%8D%E5%88%B6%E5%88%B0tmux%E5%89%AA%E8%B4%B4%E6%9D%BF**%E3%80%82%0A%0A%23%23%20tmux%E4%B8%8B%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%0A%0A%E8%BF%99%E4%B8%AA%E6%89%8D%E6%98%AF%E6%9C%AC%E7%AF%87%E6%83%B3%E8%AF%B4%E7%9A%84%E8%AF%9D%E9%A2%98%E3%80%82%E5%9B%A0%E4%B8%BA%E6%88%91%E8%8A%B1%E4%BA%86%E5%A5%BD%E4%BA%9B%E5%B9%B4%E6%89%8D%E6%89%BE%E5%88%B0%E7%AD%94%E6%A1%88%E3%80%82%E6%89%80%E4%BB%A5%E5%8F%AF%E8%A7%81%E7%BB%8F%E9%AA%8C%E7%9A%84%E4%BC%A0%E6%89%BF%E6%98%AF%E5%A4%9A%E4%B9%88%E9%87%8D%E8%A6%81%E3%80%82%E4%B8%8B%E9%9D%A2%E5%85%88%E8%AF%B4%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%8C%E5%86%8D%E8%AF%B4%E4%B8%BA%E4%BB%80%E4%B9%88%E3%80%82%0A%0A%23%23%23%20%E5%A6%82%E4%BD%95%E5%81%9A%EF%BC%9F%0A%0A%E9%A6%96%E5%85%88%E5%8D%95%E7%BA%AF%E9%9D%A0putty%E6%98%AF%E6%B2%A1%E5%8A%9E%E6%B3%95%E7%9A%84%EF%BC%8C%E5%9B%A0%E4%B8%BAputty%E5%8F%AA%E6%98%AF%E5%8D%95%E7%BA%AF%E7%9A%84terminal%20emulator%E3%80%82%E8%80%8CLinux%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E7%AE%A1%E7%90%86%E6%98%AF%E9%9C%80%E8%A6%81X-Window%E6%94%AF%E6%8C%81%E7%9A%84%E3%80%82%E6%89%80%E4%BB%A5%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84X11%20forwarding%E7%9A%84%E7%8E%AF%E5%A2%83%E3%80%82X11%20forwarding%E6%9C%89%E5%BE%88%E5%A4%9A%E9%80%94%E5%BE%84%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%88%B0%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8Cgoogle%EF%BC%8C%E7%AC%94%E8%80%85%E9%80%89%E6%8B%A9%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AAturn%20key%20solution%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%AE%89%E8%A3%85%5BMobaXTerm%5D(https%3A%2F%2Fmobaxterm.mobatek.net%2F)%E3%80%82%E9%BB%98%E8%AE%A4%E7%9A%84%E9%85%8D%E7%BD%AE%E5%B0%B1%E5%B7%B2%E7%BB%8F%E6%98%AF%E8%83%BDX11%20server%E5%92%8CX11%20forwarding%E4%BA%86%E3%80%82%0A%0A%E6%8E%A5%E4%B8%8B%E6%9D%A5%EF%BC%8C%E8%A6%81%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%EF%BC%9A%0A%0A-%20%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84Linux%E7%B3%BB%E7%BB%9F%E9%87%8C%E6%9C%89X11%E7%95%8C%E9%9D%A2%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E8%AF%B7%E8%87%AA%E8%A1%8Cgoogle%E5%AE%89%E8%A3%85%0A-%20%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84Linux%E7%B3%BB%E7%BB%9F%E9%87%8C%E6%9C%89xclip%2C%20xsel%E6%88%96xclipboard%E4%B8%89%E8%80%85%E4%B9%8B%E4%B8%80%0A-%20%E5%A6%82%E6%9E%9C%E4%BD%A0%E7%9A%84DISPLAY%E5%8F%98%E9%87%8F%E5%9C%A8tmux%E4%B8%8B%E4%B8%8D%E6%AD%A3%E5%B8%B8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8.tmux.conf%E4%B8%8B%E6%B7%BB%E5%8A%A0%0A%0A%60%60%60tmux%0Aset%20-g%20update-environment%20%22%5C%0A%20%20%20%20DISPLAY%20%5C%0A%20%20%20%20%22%0A%60%60%60%0A%0A-%20bind-key%3A%20bind-key%20-T%20copy-mode%20y%20send-keys%20-X%20copy-pipe-and-cancel%20%22xsel%20-i%20--clipboard%22%0A%0A%E6%9C%80%E5%90%8E%E4%B8%80%E6%AD%A5%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%98%AF%E5%AE%89%E8%A3%85%5Btmux-yank%5D(https%3A%2F%2Fgithub.com%2Ftmux-plugins%2Ftmux-yank)%E6%8F%92%E4%BB%B6%E3%80%82%0A%0A%23%23%23%20%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%99%E4%B9%88%E5%81%9A%EF%BC%9F%0A%0ALinux%E7%9A%84%E6%A1%8C%E9%9D%A2%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%BA%86%E4%B8%80%E4%B8%AA%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%89%AA%E8%B4%B4%E6%9D%BF%E4%BE%9D%E8%B5%96%E4%BA%8EX%20Window%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%B1%E5%89%8D%E8%BF%B0%E7%9A%84%E5%87%A0%E7%A7%8Dapp%E7%AE%A1%E7%90%86%EF%BC%8C%E7%B1%BB%E4%BC%BC%E4%BA%8EWindows%E4%B8%8B%E7%9A%84clip.exe%E3%80%82%E5%BD%93%E5%9C%A8Windows%E4%B8%8B%E7%94%A8ssh%E8%BF%9E%E6%8E%A5Linux%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%AA%E8%AE%BE%E7%BD%AEX11%20forwarding%EF%BC%8C%E5%88%99%E5%9C%A8Windows%E4%B8%8B%E6%98%AF%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E5%88%B0xsel%EF%BC%8Cxclip%E6%88%96%E8%80%85xclipboard%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AELinux%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%86%85%E5%AE%B9%E3%80%82%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E5%A5%BD%E4%BA%86X11%20forwarding%EF%BC%8C%E5%88%99%E5%9C%A8Windows%E4%B8%8B%E5%B0%B1%E8%83%BD%E8%AE%BF%E9%97%AELinux%E5%89%AA%E8%B4%B4%E6%9D%BF%E3%80%82%0A%0Atmux%E6%9C%AC%E8%BA%AB%E4%B9%9F%E7%AE%A1%E7%90%86%E4%BA%86%E4%B8%80%E4%B8%AA%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E7%A7%B0%E4%B8%BAbuffer%E3%80%82tmux%E7%9A%84%E5%91%BD%E4%BB%A4copy-selection%2C%20paste-buffer%2C%20list-buffers%E5%B0%B1%E6%98%AF%E9%92%88%E5%AF%B9tmux%E8%87%AA%E8%BA%AB%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82tmux%E5%8E%9F%E7%94%9F%E6%94%AF%E6%8C%81%EF%BC%8C%E9%80%9A%E8%BF%87%E7%A9%BA%E6%A0%BC%E9%80%89%E4%B8%AD%EF%BC%8CEnter%E5%A4%8D%E5%88%B6%EF%BC%8Cctrl%20%2B%20%5D%20%E7%B2%98%E8%B4%B4%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%83%B3tmux%E4%B8%8B%E5%B0%86%E7%BB%88%E7%AB%AF%E6%98%BE%E7%A4%BA%E5%86%85%E5%AE%B9%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%E8%A6%81%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E6%8A%8Atmux%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%8F%91%E9%80%81%E5%88%B0X11%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E4%B8%AD%E3%80%82tmux-yank%E6%8F%92%E4%BB%B6%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E8%BF%99%E4%BB%B6%E4%BA%8B%E3%80%82%E5%BD%93%E7%84%B6%E4%BD%A0%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%9C%A8copy-mode-vi%E8%A1%A8%E6%A0%BC%E9%87%8C%E7%BB%91%E5%AE%9A%E4%BB%BB%E4%BD%95%E6%8C%89%E9%94%AE%E6%9D%A5%E5%81%9A%E8%BF%99%E4%BB%B6%E4%BA%8B%E6%83%85%E3%80%82%0A%0A%23%23%20vim%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%0A%0A%E6%B2%A1%E6%9C%89%E8%BF%90%E8%A1%8C%E5%9C%A8tmux%E4%B8%8B%E7%9A%84vim%E6%88%96%E6%98%AFgvim%E8%A6%81%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E6%88%96%E8%80%85%E8%AF%B4%E6%98%AF%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E4%BE%9D%E8%B5%96%E7%9A%84%E6%98%AFvim%E7%9A%84%E5%AF%84%E5%AD%98%E5%99%A8%E6%93%8D%E4%BD%9C%E3%80%82%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8Cgoogle%E3%80%82%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%AF%B9%E5%BA%94%E7%9A%84vim%E5%AF%84%E5%AD%98%E5%99%A8%E6%98%AF%3A%20%22%2B%E3%80%82%E6%89%80%E4%BB%A5%E5%9C%A8vim%E4%B8%8B%E5%A6%82%E6%9E%9C%E6%83%B3%E5%A4%8D%E5%88%B6%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E4%BD%A0%E5%8F%AF%E4%BB%A5%E7%94%A8%22%2By%E6%9D%A5%E5%8F%96%E4%BB%A3%E5%B9%B3%E6%97%B6%E5%B8%B8%E7%94%A8%E7%9A%84y%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%9A%0A%0A-%20%22%2Byy%EF%BC%9A%E5%A4%8D%E5%88%B6%E5%BD%93%E5%89%8D%E8%A1%8C%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%0A-%20%22%2Byw%EF%BC%9A%E5%A4%8D%E5%88%B6%E5%BD%93%E5%89%8D%E7%9A%84%E5%8D%95%E8%AF%8D%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%0A%0A%E5%A6%82%E6%9E%9Cvim%E8%BF%90%E8%A1%8C%E5%9C%A8tmux%E4%B8%8B%EF%BC%8C%E5%9B%A0%E4%B8%BAtmux%E8%87%AA%E5%B8%A6%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%B0%B1%E6%9C%89%E7%82%B9%E9%BA%BB%E7%83%A6%E4%BA%86%E3%80%82%E8%BF%99%E6%97%B6%E5%80%99%E6%9C%89%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6%E5%B0%B1%E6%AF%94%E8%BE%83%E6%9C%89%E7%94%A8%E4%BA%86%E2%80%94%E2%80%94%5Bvim-tmux-clipboard%5D(https%3A%2F%2Fgithub.com%2Froxma%2Fvim-tmux-clipboard)%E3%80%82%E4%BB%96%E4%BE%9D%E8%B5%96%E4%BA%8E%E5%8F%A6%E4%B8%80%E4%B8%AAvim%E6%8F%92%E4%BB%B6%5Bvim-tmux-focus-events%5D(https%3A%2F%2Fgithub.com%2Ftmux-plugins%2Fvim-tmux-focus-events)%E3%80%82%E8%A3%85%E5%A5%BD%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%8F%92%E4%BB%B6%EF%BC%8C%E5%9C%A8.tmux.conf%E4%B8%AD%E6%B7%BB%E5%8A%A0%0A%0A%60%60%60tmux%0Aset%20-g%20focus-events%20on%0A%60%60%60%0A%0A%E5%A4%A7%E5%8A%9F%E5%91%8A%E6%88%90%E3%80%82%E7%8E%B0%E5%9C%A8%E5%9C%A8vim%E4%B8%8B%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8yank%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%8C%E4%B8%8D%E7%94%A8%E6%8C%87%E5%AE%9A%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E5%86%85%E5%AE%B9%E5%88%B0tmux%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E4%BC%9A%E5%A4%8D%E5%88%B6%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%E3%80%82%0A%0A%0A%0A]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>vim</tag>
        <tag>tmux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Resource_Access_Protocol - PIP, PCP, SRP]]></title>
    <url>%2F2019%2F02%2F04%2FResource_Access_Protocol_-_PIP%2C_PCP%2C_SRP%2F</url>
    <content type="text"><![CDATA[&#x5E38;&#x89C1;&#x7684;protocol&#x6709;Non Preemption Protocol (NPP)&#xFF0C;Highest Locker&#x2019;s Priority Protocol (HLP)&#xFF0C;Priority Inheritance Protocol (PIP&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;)&#xFF0C;Priority Ceiling Protocol (PCP&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x5929;&#x82B1;&#x677F;)&#xFF0C;Stack-based Resource Policy (SRP)&#x3002;&#x540E;3&#x8005;&#x5E94;&#x7528;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x4E14;&#x4ED6;&#x4EEC;&#x5448;&#x73B0;&#x9012;&#x8FDB;&#x5173;&#x7CFB;&#xFF0C;PCP&#x662F;PIP&#x7684;&#x6539;&#x8FDB;&#xFF0C;SRP&#x662F;PCP&#x7684;&#x6539;&#x8FDB;&#x3002;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x9488;&#x5BF9;PIP&#xFF0C;PCP&#x548C;SRP&#x3002; &#x95EE;&#x9898; Unbounded Priority Inversion &#x7B80;&#x5355;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x53CD;&#x8F6C;&#x3002; &#x5F15;&#x5165;&#x4EFB;&#x52A1;&#x62A2;&#x5360;&#x540E;&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x53CD;&#x8F6C;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x53EF;&#x9884;&#x6D4B;&#x7684;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x3002;&#x8FD9;&#x79F0;&#x4E3A;Unbounded Priority Inversion&#x3002; Dead lock &#x5F53;&#x6709;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x8981;&#x8BF7;&#x6C42;&#x591A;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x6B7B;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x3002; Transitive blocking &#x963B;&#x585E;&#x7684;&#x4F20;&#x9012;&#xFF0C;&#x770B;&#x4E0B;&#x56FE; &#x5F53;&#x6709;&#x5D4C;&#x5957;&#x4E34;&#x754C;&#x533A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x963B;&#x585E;&#x4F20;&#x9012;&#x3002;J1&#x200B;&#x88AB;J2&#x200B;&#x963B;&#x585E;&#x56E0;&#x4E3A;S2&#xFF0C;J2&#x200B;&#x88AB;J3&#x200B;&#x963B;&#x585E;&#x56E0;&#x4E3A;S1&#xFF0C;&#x5BFC;&#x81F4;J1&#x5FC5;&#x987B;&#x7B49;&#x5F85;J3&#x200B;&#x91CA;&#x653E;S1&#xFF0C;&#x7136;&#x540E;J2&#x200B;&#x91CA;&#x653E;S2&#x4E4B;&#x540E;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x987A;&#x5229;&#x83B7;&#x5F97;S2&#x8FDB;&#x5165;&#x4E34;&#x754C;&#x533A;&#x3002; Schedulability PIP &#x5B9A;&#x4E49; direct blocking&#xFF1A;&#x666E;&#x901A;&#x7684;&#x8D44;&#x6E90;&#x7ADE;&#x4E89;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x7533;&#x8BF7;&#x7684;&#x8D44;&#x6E90;&#x88AB;&#x53E6;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x9501;&#x4F4F;&#x65F6;&#xFF0C;&#x5373;&#x662F;direct blocking&#x3002; push-through blocking: &#x56E0;&#x4E3A;priority inversion&#x5BFC;&#x81F4;&#x7684;&#x963B;&#x585E;&#x3002; &#x7B97;&#x6CD5; A gets semaphore S B with higher priority tries to lock S, and blocked by S B transfers its priority to A (so A is resumed and run with B&#x2019;s priority) A finishes its critical section and back to original priority before it enters the critical section &#x4F18;&#x70B9; &#x56E0;&#x4E3A;&#x5F53;&#x524D;&#x5360;&#x4F4F;&#x8D44;&#x6E90;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x59CB;&#x7EC8;&#x4EE5;&#x6700;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x4E2D;&#x7B49;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x4E0D;&#x53EF;&#x80FD;&#x62A2;&#x5360;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#xFF0C;&#x6240;&#x4EE5;&#x89E3;&#x51B3;&#x4E86;Unbounded Priority Inversion&#x3002; &#x7F3A;&#x70B9; PIP&#x5E76;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;&#x6B7B;&#x9501;&#x95EE;&#x9898;&#x3002; PIP&#x4E5F;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;&#x963B;&#x585E;&#x4F20;&#x9012;&#x7684;&#x95EE;&#x9898;&#x3002; PIP&#x8FD8;&#x6709;&#x4E0D;&#x591F;&#x5B8C;&#x5584;&#x7684;&#x5730;&#x65B9;&#x662F;&#x5728;&#x5904;&#x7406;&#x591A;&#x6B21;&#x8D44;&#x6E90;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x4F1A;&#x53EF;&#x80FD;&#x51FA;&#x73B0;chained blocking&#xFF0C;&#x5BFC;&#x81F4;&#x8FC7;&#x591A;&#x7684;context switch&#x3002;&#x5982;&#x4E0B;&#x7684;Task1&#x3002; PCP PCP&#x7B97;&#x6CD5;&#x53EA;&#x80FD;&#x9002;&#x7528;&#x4E8E;binary semaphore&#x573A;&#x666F;&#x3002; &#x5B9A;&#x4E49; &#x4E00;&#x4E2A;semaphore&#x7684;ceiling&#x662F;&#x6240;&#x6709;&#x53EF;&#x80FD;lock&#x5B83;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x6700;&#x9AD8;&#x4F18;&#x5148;&#x7EA7; &#x67D0;&#x4E00;&#x65F6;&#x523B;&#xFF0C;&#x9488;&#x5BF9;&#x67D0;&#x4E00;&#x4EFB;&#x52A1;J&#x7684;ceiling&#x662F;&#xFF0C;&#x9664;J&#x4EE5;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5DF2;lock&#x7684;semaphore&#x7684;ceiling&#x6700;&#x5927;&#x503C; ceiling blocking: &#x56E0;&#x4E3A;&#x4F18;&#x5148;&#x7EA7;&#x4E0D;&#x5927;&#x4E8E;&#x7CFB;&#x7EDF;&#x4F18;&#x5148;&#x7EA7;&#x5929;&#x82B1;&#x677F;&#x5BFC;&#x81F4;&#x7684;&#x963B;&#x585E; S&#x2217;: &#x5BFC;&#x81F4;ceiling blocking&#x7684;&#x4FE1;&#x53F7;&#x91CF; &#x3C0;(J): &#x4EFB;&#x52A1;J&#x7684;&#x4F18;&#x5148;&#x7EA7; C(S): &#x4FE1;&#x53F7;&#x91CF;S&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x5929;&#x82B1;&#x677F; &#x3C0;(J): &#x7CFB;&#x7EDF;&#x9488;&#x5BF9;J&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x5929;&#x82B1;&#x677F; S&#x2217;: &#x7CFB;&#x7EDF;&#x9488;&#x5BF9;J&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x5929;&#x82B1;&#x677F; &#x7B97;&#x6CD5; &#x5F53;&#x67D0;&#x4E00;&#x4EFB;&#x52A1;J&#x9700;&#x8981;lock&#x4E00;&#x4E2A;semaphore&#x65F6; &#x82E5;&#x8BE5;&#x8D44;&#x6E90;&#x5DF2;&#x88AB;J&#x2032; lock &#x3C0;(J)&#x2264;&#x3C0;(J&#x2032;)&#xFF0C;&#x5219;J&#x88AB;block &#x3C0;(J)&gt;&#x3C0;(J&#x2032;)&#xFF0C;&#x5219;J&#x2032;&#x83B7;&#x5F97;J&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x76F4;&#x5230;J&#x2032;&#x91CA;&#x653E;&#x8BE5;&#x8D44;&#x6E90; &#x82E5;&#x8BE5;&#x8D44;&#x6E90;free &#x3C0;(J)&#x2264;&#x3C0;(J)&#xFF0C;&#x5219;J&#x88AB;S&#x2217;&#x963B;&#x585E;&#xFF0C;&#x56E0;&#x4E3A;&#x3C0;(J)&#x2264;C(S&#x2217;)&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F; &#x3C0;(J)&gt;&#x3C0;(J)&#xFF0C;&#x5219;J&#x53EF;&#x4EE5;&#x9501;&#x4F4F;&#x8BE5;&#x8D44;&#x6E90; &#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x4E0D;&#x6D89;&#x53CA;&#x7533;&#x8BF7;&#x8D44;&#x6E90;&#xFF0C;&#x5219;&#x5B83;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x62A2;&#x5360;(preempt)&#x5176;&#x4ED6;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#x3002; &#x4F18;&#x70B9; &#x56E0;&#x4E3A;PCP&#x5305;&#x542B;PIP&#xFF0C;&#x6240;&#x4EE5;PCP&#x5305;&#x542B;PIP&#x6240;&#x6709;&#x7684;&#x4F18;&#x70B9; PCP&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x6B7B;&#x9501;&#x95EE;&#x9898;&#x3002; &#x8BC1;&#x660E; &#x518D;&#x770B;&#x8FD9;&#x5F20;&#x56FE; &#x6B64;&#x65F6;&#x6709;&#xFF1A; C(S1)=H,C(S2)=H &#x5F53;Task1&#x8BD5;&#x56FE;&#x6267;&#x884C;P(S1)&#x65F6;&#xFF0C;&#x3C0;(Task1)=C(S2)=H&#xFF0C;&#x663E;&#x7136;&#x3C0;(Task1)&#x2264;&#x3C0;(Task1)&#xFF0C;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;S1&#xFF0C;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x4F1A;&#x6709;&#x540E;&#x6765;&#x7684;P(S2)&#x4E86;&#x3002; &#x5F53;Task2&#x8BD5;&#x56FE;&#x6267;&#x884C;P(S2)&#x65F6;&#xFF0C;&#x3C0;(Task2)=0&#xFF0C;&#x56E0;&#x4E3A;&#x9664;&#x4E86;Task2&#xFF0C;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x8D44;&#x6E90;&#x88AB;&#x9501;&#x4F4F;&#x3002;&#x6240;&#x4EE5;Task2&#x53EF;&#x4EE5;&#x987A;&#x5229;&#x83B7;&#x5F97;&#x8D44;&#x6E90;S1&#x3002; &#x7EFC;&#x4E0A;&#xFF0C;&#x6B7B;&#x9501;&#x4E0D;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x3002; &#x6CA1;&#x6709;&#x963B;&#x585E;&#x4F20;&#x9012;&#x3002; &#x8BC1;&#x660E; &#x5047;&#x8BBE;J3&#x200B;&#x963B;&#x585E;J2&#x200B;, J2&#x200B;&#x963B;&#x585E;J1&#x200B; t3&#x200B;&#x65F6;&#xFF0C;C(S1&#x200B;)&#x2265;&#x3C0;(J2&#x200B;)&#x22C2;C(S1&#x200B;)&#x2265;&#x3C0;(J3&#x200B;)&#xFF0C;J2&#x200B; lock&#x6210;&#x529F;&#xFF0C;&#x8BF4;&#x660E;&#x3C0;(J2&#x200B;)&gt;C(S1&#x200B;)&#xFF0C;&#x77DB;&#x76FE;&#x3002;&#x6B63;&#x786E;&#x7684;&#x56FE;&#x5982;&#x4E0B;&#xFF1A; &#x6210;&#x529F;&#x907F;&#x514D;transitive blocking&#x3002; &#x88AB;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#x963B;&#x585E;(priority inversion)&#x53EA;&#x4F1A;&#x53D1;&#x751F;&#x4E00;&#x6B21; &#x8BC1;&#x660E; &#x5047;&#x8BBE;&#x6709;&#x3C0;(J1&#x200B;)&gt;&#x3C0;(J2&#x200B;) &#x5982;&#x679C;J1&#x200B;&#x88AB;J2&#x200B;&#x963B;&#x585E;&#x4E24;&#x6B21;&#xFF0C;&#x5206;&#x522B;&#x5728;J1&#x200B;&#x7533;&#x8BF7;&#x8D44;&#x6E90;A,B&#x65F6;&#xFF0C;&#x5219;&#x6709; &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0D;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;A&#x88AB;&#x91CA;&#x653E;&#x65F6;(V(A))&#xFF0C;&#x56E0;&#x4E3A;J1&#x200B;&#x662F;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#xFF0C;A&#x4E00;&#x65E6;&#x91CA;&#x653E;&#xFF0C;J1&#x200B;&#x5219;&#x4F1A;&#x7ACB;&#x5373;&#x5F97;&#x5230;&#x8FD0;&#x884C; &#x5982;&#x679C;J1&#x200B;&#x88AB;&#x4E0D;&#x540C;&#x7684;&#x4EFB;&#x52A1;J2&#x200B;,J3&#x200B;&#x963B;&#x585E; J1&#x200B;&#x5BF9;A&#xFF0C;B&#x6709;&#x8BC9;&#x6C42;&#xFF0C;&#x8BF4;&#x660E;&#x3C0;(J1&#x200B;)&#x2264;C(A)&#x22C2;&#x3C0;(J1&#x200B;)&#x2264;C(B) J2&#x200B;&#x80FD;&#x5F97;&#x5230;&#x8FD0;&#x884C;&#xFF0C;&#x8BF4;&#x660E;&#x3C0;(J2&#x200B;)&gt;C(A) &#x7EFC;&#x4E0A;&#xFF0C;&#x4E24;&#x8005;&#x77DB;&#x76FE;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;T&#x5BF9;A&#x6709;&#x8BC9;&#x6C42;&#xFF0C;&#x5219;J2&#x200B;&#x5728;&#x7533;&#x8BF7;A&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x88AB;&#x963B;&#x585E;(ceiling blocking)&#xFF0C;&#x56E0;&#x4E3A;&#x3C0;(J2&#x200B;)&#x2265;C(A)&#x2265;&#x3C0;(T)&gt;&#x3C0;(T2&#x200B;)&#xFF0C;&#x5373;&#x3C0;(T2&#x200B;)&lt;C(A) &#x7F3A;&#x70B9; PCP&#x5728;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x7684;&#x5F88;&#x597D;&#x4E86;&#xFF0C;&#x7F3A;&#x70B9;&#x662F;&#xFF1A; &#x53EA;&#x652F;&#x6301;binary semaphore&#x3002;&#x7F3A;&#x5C11;&#x5BF9;&#x591A;&#x8D44;&#x6E90;&#x4FE1;&#x53F7;&#x91CF;&#x7684;&#x652F;&#x6301;&#x3002; &#x5BF9;&#x52A8;&#x6001;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#xFF0C;&#x8981;&#x5B9E;&#x65F6;&#x8C03;&#x6574;&#x7CFB;&#x7EDF;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;priority ceiling&#x3002; &#x867D;&#x7136;context switch&#x5DF2;&#x7ECF;&#x53EB;PIP&#x8F83;&#x4E3A;&#x51CF;&#x5C11;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x6709;&#x63D0;&#x5347;&#x7A7A;&#x95F4; SRP SRP&#x7684;&#x4EA7;&#x751F;&#x53EF;&#x4EE5;&#x514B;&#x670D;&#x8FD9;&#x4E9B;PCP&#x7684;&#x7F3A;&#x70B9;&#x3002; &#x4E4B;&#x6240;&#x4EE5;&#x53EB;stack based&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x8BDE;&#x751F;&#x548C;&#x5D4C;&#x5165;&#x5F0F;&#x9886;&#x57DF;&#x7684;stack sharing[1]&#x6709;&#x5173;&#x3002; stack sharing&#x7528;&#x4E8E;&#x8282;&#x7701;&#x5185;&#x5B58;&#x3002;&#x5982;&#x679C;&#x5DE6;&#x8FB9;&#x6BCF;&#x4E2A;&#x6808;&#x7A7A;&#x95F4;&#x4E3A;10K&#xFF0C;&#x5219;&#x603B;&#x5171;&#x9700;&#x8981;30K&#x3002;&#x5728;&#x6808;&#x7A7A;&#x95F4;&#x4E0D;&#x662F;&#x5F88;&#x7D27;&#x5F20;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x91C7;&#x7528;stack sharing&#x540E;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x603B;&#x5171;10K&#x7684;&#x6808;&#x7A7A;&#x95F4; stack sharing&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#xFF0C;&#x5C31;&#x662F;&#x4EFB;&#x52A1;&#x53EA;&#x80FD;&#x5728;&#x6808;&#x9876;&#x7684;&#x65F6;&#x5019;&#x624D;&#x80FD;&#x5F97;&#x5230;&#x8FD0;&#x884C;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x88AB;&#x53E6;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x62A2;&#x5360;&#x540E;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x88AB;&#x62A2;&#x5360;&#x7684;&#x4EFB;&#x52A1;&#x8981;&#x7B49;&#x5230;&#x62A2;&#x5360;&#x8005;&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x624D;&#x6709;&#x673A;&#x4F1A;&#x8FD0;&#x884C;&#x3002; &#x5F53;&#x91C7;&#x7528;stack sharing&#x4E4B;&#x540E;&#xFF0C;stack&#x4E5F;&#x5C31;&#x53D8;&#x6210;&#x4E86;&#x4E00;&#x79CD;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x3002; &#x867D;&#x7136;SRP&#x662F;&#x56E0;&#x4E3A;stack sharing&#x800C;&#x4EA7;&#x751F;&#xFF0C;&#x4F46;&#x5373;&#x4FBF;&#x5728;&#x4E0D;&#x662F;stack sharing&#x7684;&#x573A;&#x5408;&#xFF0C;&#x4E5F;&#x6709;&#x5F88;&#x597D;&#x7684;&#x6027;&#x80FD;&#x3002; &#x5B9A;&#x4E49; priority&#xFF1A;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x52A8;&#x6001;&#x8C03;&#x6574;&#xFF0C;&#x4F8B;&#x5982;&#x5728;&#x4E00;&#x4E9B;&#x52A8;&#x6001;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x4E2D;&#xFF0C;&#x4F8B;&#x5982;EDF preemption level&#xFF1A;&#x76F8;&#x5BF9;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;preemption level&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x65B9;&#x4FBF;&#x5728;&#x52A8;&#x6001;&#x4F18;&#x5148;&#x7EA7;&#x7B97;&#x6CD5;&#x4E2D;&#xFF0C;&#x9884;&#x6D4B;&#x8D44;&#x6E90;&#x7ADE;&#x4E89;&#x3002;&#x901A;&#x5E38;&#x53D6;&#x4EFB;&#x52A1;&#x7684;&#x521D;&#x59CB;&#x4F18;&#x5148;&#x7EA7;&#x3002; &#x63A8;&#x5BFC;preemption level&#x7684;&#x5145;&#x5206;&#x6761;&#x4EF6; p(J)&#x2264;p(J&#x2032;)&#x22C3;Arrival(J)&#x2264;Arrival(J&#x2032;)&#x22C3;&#x3C0;(J)&lt;&#x3C0;(J&#x2032;) &#x7B80;&#x5355;&#x8BF4;&#x5C31;&#x662F;&#x5982;&#x679C;J&#x665A;&#x5230;&#x65E9;&#x7ED3;&#x675F;&#xFF0C;&#x5219;J&#x7684;preemption level&#x8F83;&#x5927;&#x3002; ceiling&#xFF1A;SRP&#x7684;ceiling&#x5B9A;&#x4E49;&#x4E0E;PCP&#x4E0D;&#x4E00;&#x6837;&#x3002; &#x2308;R&#x2309;&#x3BD;R&#x200B;&#x200B;=max({0}&#x22C3;{&#x3C0;(J)&#x2223;&#x3BD;R&#x200B;&lt;&#x3BC;R&#x200B;(J)}) &#x5176;&#x4E2D;&#xFF1A; &#x3BC;R&#x200B;: maximum number of units of R that job J may need to hold at any one time. &#x3BD;R&#x200B;: the number of units of R that are currently available current ceiling: &#x3C0;=max{&#x2308;Ri&#x200B;&#x2309;&#x3BD;R&#x200B;&#x200B;&#x2223;i=1,&#x2026;,m} &#x7B97;&#x6CD5; &#x56E0;&#x4E3A;preemption level&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;ceiling&#x7684;&#x8BA1;&#x7B97;&#x4E5F;&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x9884;&#x5148;&#x8BA1;&#x7B97;&#x5E76;&#x5199;&#x5165;&#x4E00;&#x5F20;&#x8868;&#x683C;&#x3002; &#x5F15;&#x7528;&#x539F;&#x8BBA;&#x6587;[2]&#x4E2D;&#x7684;&#x4F8B;&#x5B50; &#x5047;&#x5982;J1&#x200B;, J2&#x200B;, J3&#x200B;&#x5728;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x7533;&#x8BF7;&#x8D44;&#x6E90;&#x5982;&#x4E0B;&#xFF1A; &#x76F4;&#x89C2;&#x4E00;&#x70B9;&#x7684;&#x8D44;&#x6E90;&#x7533;&#x8BF7;&#x56FE;&#xFF1A; &#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x51FA;&#x2308;R&#x2309;&#x3BD;R&#x200B;&#x200B;&#x8868;&#x683C;&#x5982;&#x4E0B;&#xFF1A; &#x4EE5;&#x2308;R2&#x200B;&#x2309;0&#x200B;&#x4E3A;&#x4F8B;&#xFF1A; &#x3BD;R&#x200B;=0 &#x2308;R2&#x200B;&#x2309;0&#x200B;=max({0}&#x22C3;{&#x3C0;(J)&#x2223;0&lt;&#x3BC;R&#x200B;(J)}) &#x82E5;&#x3C0;(Ii&#x200B;)=p(Ji&#x200B;)=i , &#x5219;&#x6EE1;&#x8DB3;&#x4E0A;&#x5F0F;&#x7684;&#x6700;&#x5927;&#x7684;&#x3C0;(J)=2&#xFF0C;&#x5982;&#x8868;&#x6240;&#x793A;&#x3002; &#x5F53;&#x4EFB;&#x52A1;J ready&#x65F6;&#xFF0C;&#x8BA1;&#x7B97;&#x6B64;&#x65F6;&#x7684;preemption level&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#xFF1A;&#x3C0;(J)&gt;&#x3C0;&#xFF0C;&#x4E0D;&#x6EE1;&#x8DB3;&#x5219;&#x963B;&#x585E;&#x3002; &#x4F18;&#x70B9; No job can be blocked after it starts. &#x6CA1;&#x6709;block&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;context switch&#x3002;context switch&#x53EA;&#x4F1A;&#x53D1;&#x751F;&#x5728;start execution&#x548C;preemption&#x3002; There can be n o transitive blocking or deadlock. If the oldest highest-priority job is blocked, it will become unblocked no later than the first instant that the currently executing job is not holding any non-preemptable resources &#x53C2;&#x8003;&#x6587;&#x732E; [1] Bhuvan Middha, Matthew Simpson and Rajeev Barua, &quot;MTSS: Multi Task Stack Sharing for Embedded Systems &quot;, Department of Electrical &amp; Computer Engineering University of Maryland College Park [2] T.P. Baker, &quot;A Stack-Based Resource Allocation Policy for Realtime Processes &quot;, In Proceedings of the Real-Time Systems Symposium, pages 191&#x2013;200, 1990 [3] Lui Sha; Ragunathan Rajkumar &amp; John P. Lehoczky (September 1990). &quot;Priority Inheritance Protocols: An Approach to Real-Time Synchronization&quot;. IEEE Transactions on Computers. %E5%B8%B8%E8%A7%81%E7%9A%84protocol%E6%9C%89Non%20Preemption%20Protocol%20(NPP)%EF%BC%8CHighest%20Locker%E2%80%99s%20Priority%20Protocol%20%20(HLP)%EF%BC%8CPriority%20Inheritance%20Protocol%20(PIP%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF)%EF%BC%8CPriority%20Ceiling%20Protocol%20(PCP%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF)%EF%BC%8CStack-based%20Resource%20Policy%20(SRP)%E3%80%82%E5%90%8E3%E8%80%85%E5%BA%94%E7%94%A8%E6%AF%94%E8%BE%83%E5%A4%9A%EF%BC%8C%E4%B8%94%E4%BB%96%E4%BB%AC%E5%91%88%E7%8E%B0%E9%80%92%E8%BF%9B%E5%85%B3%E7%B3%BB%EF%BC%8CPCP%E6%98%AFPIP%E7%9A%84%E6%94%B9%E8%BF%9B%EF%BC%8CSRP%E6%98%AFPCP%E7%9A%84%E6%94%B9%E8%BF%9B%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E9%92%88%E5%AF%B9PIP%EF%BC%8CPCP%E5%92%8CSRP%E3%80%82%0A%0A%23%23%20%E9%97%AE%E9%A2%98%0A%0A%23%23%23%20Unbounded%20Priority%20Inversion%0A%0A%E7%AE%80%E5%8D%95%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E3%80%82%0A%0A!%5B5649cf806ca1f3713eedd57cb7e5d9fa.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5851)%0A%0A%0A%E5%BC%95%E5%85%A5%E4%BB%BB%E5%8A%A1%E6%8A%A2%E5%8D%A0%E5%90%8E%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E4%BC%9A%E5%AF%BC%E8%87%B4%E4%B8%8D%E5%8F%AF%E9%A2%84%E6%B5%8B%E7%9A%84%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4%E3%80%82%E8%BF%99%E7%A7%B0%E4%B8%BAUnbounded%20Priority%20Inversion%E3%80%82%0A%0A!%5B8df099f053cbeaee4881a9d6ffc8963f.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5852)%0A%0A%0A%0A%0A%23%23%23%20Dead%20lock%0A%0A!%5B3bfb6dd811b3c01343eae69264f5637f.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5853)%0A%0A%0A%E5%BD%93%E6%9C%89%E5%A4%9A%E4%B8%AA%E4%BB%BB%E5%8A%A1%E8%A6%81%E8%AF%B7%E6%B1%82%E5%A4%9A%E4%B8%AA%E8%B5%84%E6%BA%90%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%88%99%E5%BE%88%E6%9C%89%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E6%AD%BB%E9%94%81%E7%9A%84%E6%83%85%E5%86%B5%E3%80%82%0A%0A%23%23%23%20Transitive%20blocking%0A%0A%E9%98%BB%E5%A1%9E%E7%9A%84%E4%BC%A0%E9%80%92%EF%BC%8C%E7%9C%8B%E4%B8%8B%E5%9B%BE%0A%0A!%5B2513fdc689793678a116c5627fd2391b.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5854)%0A%0A%0A%E5%BD%93%E6%9C%89%E5%B5%8C%E5%A5%97%E4%B8%B4%E7%95%8C%E5%8C%BA%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%B0%B1%E5%BE%88%E5%AE%B9%E6%98%93%E4%BA%A7%E7%94%9F%E9%98%BB%E5%A1%9E%E4%BC%A0%E9%80%92%E3%80%82%24J_1%24%E8%A2%AB%24J_2%24%E9%98%BB%E5%A1%9E%E5%9B%A0%E4%B8%BAS2%EF%BC%8C%24J_2%24%E8%A2%AB%24J_3%24%E9%98%BB%E5%A1%9E%E5%9B%A0%E4%B8%BAS1%EF%BC%8C%E5%AF%BC%E8%87%B4%24J1%24%E5%BF%85%E9%A1%BB%E7%AD%89%E5%BE%85%24J_3%24%E9%87%8A%E6%94%BES1%EF%BC%8C%E7%84%B6%E5%90%8E%24J_2%24%E9%87%8A%E6%94%BES2%E4%B9%8B%E5%90%8E%EF%BC%8C%E6%89%8D%E5%8F%AF%E4%BB%A5%E9%A1%BA%E5%88%A9%E8%8E%B7%E5%BE%97S2%E8%BF%9B%E5%85%A5%E4%B8%B4%E7%95%8C%E5%8C%BA%E3%80%82%0A%0A%23%23%23%20Schedulability%0A%0A%0A%0A%23%23%20PIP%0A%0A%23%23%23%20%E5%AE%9A%E4%B9%89%0A%0A-%20direct%20blocking%EF%BC%9A%E6%99%AE%E9%80%9A%E7%9A%84%E8%B5%84%E6%BA%90%E7%AB%9E%E4%BA%89%E3%80%82%E5%BD%93%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E7%94%B3%E8%AF%B7%E7%9A%84%E8%B5%84%E6%BA%90%E8%A2%AB%E5%8F%A6%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E9%94%81%E4%BD%8F%E6%97%B6%EF%BC%8C%E5%8D%B3%E6%98%AFdirect%20blocking%E3%80%82%0A-%20push-through%20blocking%3A%20%E5%9B%A0%E4%B8%BApriority%20inversion%E5%AF%BC%E8%87%B4%E7%9A%84%E9%98%BB%E5%A1%9E%E3%80%82%0A%0A%23%23%23%20%E7%AE%97%E6%B3%95%0A%0A-%20A%20gets%20semaphore%20S%0A-%20B%20with%20higher%20priority%20tries%20to%20lock%20S%2C%20and%20blocked%20by%20S%0A-%20B%20transfers%20its%20priority%20to%20A%20(so%20A%20is%20resumed%20and%20run%20with%20B%E2%80%99s%20priority)%20%0A-%20A%20finishes%20its%20critical%20section%20and%20back%20to%20original%20priority%20before%20it%20enters%20the%20critical%20section%0A%0A%23%23%23%20%E4%BC%98%E7%82%B9%0A%0A%E5%9B%A0%E4%B8%BA%E5%BD%93%E5%89%8D%E5%8D%A0%E4%BD%8F%E8%B5%84%E6%BA%90%E7%9A%84%E4%BB%BB%E5%8A%A1%EF%BC%8C%E5%A7%8B%E7%BB%88%E4%BB%A5%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E5%9C%A8%E8%BF%90%E8%A1%8C%EF%BC%8C%E4%B8%AD%E7%AD%89%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%B0%B1%E4%B8%8D%E5%8F%AF%E8%83%BD%E6%8A%A2%E5%8D%A0%E4%BD%8E%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%EF%BC%8C%E6%89%80%E4%BB%A5%E8%A7%A3%E5%86%B3%E4%BA%86Unbounded%20Priority%20Inversion%E3%80%82%0A%0A%23%23%23%20%E7%BC%BA%E7%82%B9%0A%0A-%20PIP%E5%B9%B6%E4%B8%8D%E8%83%BD%E8%A7%A3%E5%86%B3%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E3%80%82%0A-%20PIP%E4%B9%9F%E4%B8%8D%E8%83%BD%E8%A7%A3%E5%86%B3%E9%98%BB%E5%A1%9E%E4%BC%A0%E9%80%92%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82%0A-%20PIP%E8%BF%98%E6%9C%89%E4%B8%8D%E5%A4%9F%E5%AE%8C%E5%96%84%E7%9A%84%E5%9C%B0%E6%96%B9%E6%98%AF%E5%9C%A8%E5%A4%84%E7%90%86%E5%A4%9A%E6%AC%A1%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E6%97%B6%EF%BC%8C%E4%BB%8D%E7%84%B6%E4%BC%9A%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0chained%20blocking%EF%BC%8C%E5%AF%BC%E8%87%B4%E8%BF%87%E5%A4%9A%E7%9A%84context%20switch%E3%80%82%E5%A6%82%E4%B8%8B%E7%9A%84Task1%E3%80%82%0A%20%20!%5Bb2be2df4d66a9c75b11aee7f22a3121c.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5855)%0A%20%20%0A%0A%23%23%20PCP%0A%0APCP%E7%AE%97%E6%B3%95%E5%8F%AA%E8%83%BD%E9%80%82%E7%94%A8%E4%BA%8Ebinary%20semaphore%E5%9C%BA%E6%99%AF%E3%80%82%0A%0A%23%23%23%20%E5%AE%9A%E4%B9%89%0A%0A-%20%E4%B8%80%E4%B8%AAsemaphore%E7%9A%84ceiling%E6%98%AF%E6%89%80%E6%9C%89**%E5%8F%AF%E8%83%BD**lock%E5%AE%83%E7%9A%84%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%0A-%20%E6%9F%90%E4%B8%80%E6%97%B6%E5%88%BB%EF%BC%8C%E9%92%88%E5%AF%B9%E6%9F%90%E4%B8%80%E4%BB%BB%E5%8A%A1%24J%24%E7%9A%84ceiling%E6%98%AF%EF%BC%8C%E9%99%A4%24J%24%E4%BB%A5%E5%A4%96%E7%9A%84%E5%85%B6%E4%BB%96%E7%BA%BF%E7%A8%8B%E5%B7%B2lock%E7%9A%84semaphore%E7%9A%84ceiling%E6%9C%80%E5%A4%A7%E5%80%BC%0A-%20ceiling%20blocking%3A%20%E5%9B%A0%E4%B8%BA%E4%BC%98%E5%85%88%E7%BA%A7%E4%B8%8D%E5%A4%A7%E4%BA%8E%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF%E5%AF%BC%E8%87%B4%E7%9A%84%E9%98%BB%E5%A1%9E%0A-%20%24S%5E*%24%3A%20%E5%AF%BC%E8%87%B4ceiling%20blocking%E7%9A%84%E4%BF%A1%E5%8F%B7%E9%87%8F%0A-%20%24%5Cpi(J)%24%3A%20%E4%BB%BB%E5%8A%A1%24J%24%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%0A-%20%24C(S)%24%3A%20%E4%BF%A1%E5%8F%B7%E9%87%8F%24S%24%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF%0A-%20%24%5Coverline%7B%5Cpi%7D(J)%24%3A%20%E7%B3%BB%E7%BB%9F%E9%92%88%E5%AF%B9%24J%24%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF%0A-%20%24S%5E*%24%3A%20%E7%B3%BB%E7%BB%9F%E9%92%88%E5%AF%B9%24J%24%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF%0A%0A%23%23%23%20%E7%AE%97%E6%B3%95%0A%0A-%20%E5%BD%93%E6%9F%90%E4%B8%80%E4%BB%BB%E5%8A%A1%24J%24%E9%9C%80%E8%A6%81lock%E4%B8%80%E4%B8%AAsemaphore%E6%97%B6%0A%20%20-%20%E8%8B%A5%E8%AF%A5%E8%B5%84%E6%BA%90%E5%B7%B2%E8%A2%AB%24J&apos;%24%20lock%0A%20%20%20%20-%20%24%5Cpi(J)%20%5Cle%20%5Cpi(J&apos;)%24%EF%BC%8C%E5%88%99%24J%24%E8%A2%ABblock%0A%20%20%20%20-%20%24%5Cpi(J)%20%5Cgt%20%5Cpi(J&apos;)%24%EF%BC%8C%E5%88%99%24J&apos;%24%E8%8E%B7%E5%BE%97%24J%24%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E7%9B%B4%E5%88%B0%24J&apos;%24%E9%87%8A%E6%94%BE%E8%AF%A5%E8%B5%84%E6%BA%90%0A%20%20-%20%E8%8B%A5%E8%AF%A5%E8%B5%84%E6%BA%90free%0A%20%20%20%20-%20%24%5Cpi(J)%20%5Cle%20%5Coverline%7B%5Cpi%7D(J)%24%EF%BC%8C%E5%88%99%24J%24%E8%A2%AB%24S%5E*%24%E9%98%BB%E5%A1%9E%EF%BC%8C%E5%9B%A0%E4%B8%BA%24%5Cpi(J)%20%5Cle%20C(S%5E*)%24%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%8D%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%0A%20%20%20%20-%20%24%5Cpi(J)%20%5Cgt%20%5Coverline%7B%5Cpi%7D(J)%24%EF%BC%8C%E5%88%99%24J%24%E5%8F%AF%E4%BB%A5%E9%94%81%E4%BD%8F%E8%AF%A5%E8%B5%84%E6%BA%90%0A-%20%E5%A6%82%E6%9E%9C%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E4%B8%8D%E6%B6%89%E5%8F%8A%E7%94%B3%E8%AF%B7%E8%B5%84%E6%BA%90%EF%BC%8C%E5%88%99%E5%AE%83%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E6%8A%A2%E5%8D%A0(preempt)%E5%85%B6%E4%BB%96%E4%BD%8E%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E3%80%82%0A%0A%23%23%23%20%E4%BC%98%E7%82%B9%0A%0A1.%20%E5%9B%A0%E4%B8%BAPCP%E5%8C%85%E5%90%ABPIP%EF%BC%8C%E6%89%80%E4%BB%A5PCP%E5%8C%85%E5%90%ABPIP%E6%89%80%E6%9C%89%E7%9A%84%E4%BC%98%E7%82%B9%0A2.%20PCP%E5%8F%AF%E4%BB%A5%E8%A7%A3%E5%86%B3%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E3%80%82%0A%0A%3E%20**%E8%AF%81%E6%98%8E**%0A%3E%0A%3E%20%E5%86%8D%E7%9C%8B%E8%BF%99%E5%BC%A0%E5%9B%BE%0A%3E%0A%3E%20!%5B3bfb6dd811b3c01343eae69264f5637f.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5853)%0A%3E%0A%3E%20%E6%AD%A4%E6%97%B6%E6%9C%89%EF%BC%9A%0A%3E%0A%3E%20%24%24C(S1)%20%3D%20H%2C%20C(S2)%20%3D%20H%24%24%0A%3E%0A%3E%20%E5%BD%93Task1%E8%AF%95%E5%9B%BE%E6%89%A7%E8%A1%8CP(S1)%E6%97%B6%EF%BC%8C%24%5Coverline%7B%5Cpi%7D(Task1)%20%3D%20C(S2)%20%3D%20H%24%EF%BC%8C%E6%98%BE%E7%84%B6%24%5Cpi(Task1)%20%5Cle%20%5Coverline%7B%5Cpi%7D(Task1)%24%EF%BC%8C%E4%B8%8D%E8%83%BD%E8%8E%B7%E5%8F%96S1%EF%BC%8C%E8%A2%AB%E9%98%BB%E5%A1%9E%EF%BC%8C%E4%B9%9F%E5%B0%B1%E4%B8%8D%E4%BC%9A%E6%9C%89%E5%90%8E%E6%9D%A5%E7%9A%84P(S2)%E4%BA%86%E3%80%82%0A%3E%0A%3E%20%E5%BD%93Task2%E8%AF%95%E5%9B%BE%E6%89%A7%E8%A1%8CP(S2)%E6%97%B6%EF%BC%8C%24%5Coverline%7B%5Cpi%7D(Task2)%20%3D0%24%EF%BC%8C%E5%9B%A0%E4%B8%BA%E9%99%A4%E4%BA%86Task2%EF%BC%8C%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E7%9A%84%E8%B5%84%E6%BA%90%E8%A2%AB%E9%94%81%E4%BD%8F%E3%80%82%E6%89%80%E4%BB%A5Task2%E5%8F%AF%E4%BB%A5%E9%A1%BA%E5%88%A9%E8%8E%B7%E5%BE%97%E8%B5%84%E6%BA%90S1%E3%80%82%0A%3E%0A%3E%20%E7%BB%BC%E4%B8%8A%EF%BC%8C%E6%AD%BB%E9%94%81%E4%B8%8D%E5%8F%AF%E8%83%BD%E5%8F%91%E7%94%9F%E3%80%82%0A%0A3.%20%E6%B2%A1%E6%9C%89%E9%98%BB%E5%A1%9E%E4%BC%A0%E9%80%92%E3%80%82%0A%0A%3E%20**%E8%AF%81%E6%98%8E**%0A%3E%0A%3E%20%E5%81%87%E8%AE%BE%24J_3%24%E9%98%BB%E5%A1%9E%24J_2%24%2C%20%24J_2%24%E9%98%BB%E5%A1%9E%24J_1%24%0A%3E%0A%3E%20!%5B2513fdc689793678a116c5627fd2391b.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5854)%0A%3E%0A%3E%20%24t_3%24%E6%97%B6%EF%BC%8C%24C(S_1)%20%5Cge%20%5Cpi(J_2)%20%5Cbigcap%20C(S_1)%20%5Cge%20%5Cpi(J_3)%24%EF%BC%8C%24J_2%24%20lock%E6%88%90%E5%8A%9F%EF%BC%8C%E8%AF%B4%E6%98%8E%24%5Cpi(J_2)%20%5Cgt%20C(S_1)%24%EF%BC%8C%E7%9F%9B%E7%9B%BE%E3%80%82%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%9B%BE%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%3E%0A%3E%20!%5B905612682c4d116a70d76d0852ea863b.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5857)%0A%3E%0A%3E%20%E6%88%90%E5%8A%9F%E9%81%BF%E5%85%8Dtransitive%20blocking%E3%80%82%0A%0A4.%20%E8%A2%AB%E4%BD%8E%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E9%98%BB%E5%A1%9E(priority%20inversion)%E5%8F%AA%E4%BC%9A%E5%8F%91%E7%94%9F%E4%B8%80%E6%AC%A1%0A%0A%3E%20**%E8%AF%81%E6%98%8E**%0A%3E%0A%3E%20%E5%81%87%E8%AE%BE%E6%9C%89%24%5Cpi(J_1)%20%3E%20%5Cpi(J_2)%24%0A%3E%0A%3E%20-%20%E5%A6%82%E6%9E%9C%24J_1%24%E8%A2%AB%24J_2%24%E9%98%BB%E5%A1%9E%E4%B8%A4%E6%AC%A1%EF%BC%8C%E5%88%86%E5%88%AB%E5%9C%A8%24J_1%24%E7%94%B3%E8%AF%B7%E8%B5%84%E6%BA%90%24A%2C%20B%24%E6%97%B6%EF%BC%8C%E5%88%99%E6%9C%89%0A%3E%0A%3E%20!%5B499d02f4b995e801df99538302d05d02.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5856)%0A%3E%0A%3E%20%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E4%B8%8D%E5%8F%AF%E8%83%BD%E5%8F%91%E7%94%9F%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%BD%93A%E8%A2%AB%E9%87%8A%E6%94%BE%E6%97%B6(V(A))%EF%BC%8C%E5%9B%A0%E4%B8%BA%24J_1%24%E6%98%AF%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%EF%BC%8CA%E4%B8%80%E6%97%A6%E9%87%8A%E6%94%BE%EF%BC%8C%24J_1%24%E5%88%99%E4%BC%9A%E7%AB%8B%E5%8D%B3%E5%BE%97%E5%88%B0%E8%BF%90%E8%A1%8C%0A%3E%0A%3E%20-%20%E5%A6%82%E6%9E%9C%24J_1%24%E8%A2%AB%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BB%BB%E5%8A%A1%24J_2%24%2C%24J_3%24%E9%98%BB%E5%A1%9E%0A%3E%0A%3E%20!%5B719fb123a87fd610c3fd5e86c4d5a5e1.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5858)%0A%3E%0A%3E%20-%20%24J_1%24%E5%AF%B9A%EF%BC%8CB%E6%9C%89%E8%AF%89%E6%B1%82%EF%BC%8C%E8%AF%B4%E6%98%8E%24%5Cpi(J_1)%20%5Cle%20C(A)%20%5Cbigcap%20%5Cpi(J_1)%20%5Cle%20C(B)%24%0A%3E%20-%20%24J_2%24%E8%83%BD%E5%BE%97%E5%88%B0%E8%BF%90%E8%A1%8C%EF%BC%8C%E8%AF%B4%E6%98%8E%24%5Cpi(J_2)%20%5Cgt%20C(A)%24%0A%3E%20-%20%E7%BB%BC%E4%B8%8A%EF%BC%8C%E4%B8%A4%E8%80%85%E7%9F%9B%E7%9B%BE%EF%BC%8C%E6%89%80%E4%BB%A5%E5%A6%82%E6%9E%9CT%E5%AF%B9A%E6%9C%89%E8%AF%89%E6%B1%82%EF%BC%8C%E5%88%99%24J_2%24%E5%9C%A8%E7%94%B3%E8%AF%B7A%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E8%A2%AB%E9%98%BB%E5%A1%9E(ceiling%20blocking)%EF%BC%8C%E5%9B%A0%E4%B8%BA%24%5Coverline%7B%5Cpi%7D(J_2)%20%5Cge%20C(A)%20%5Cge%20%5Cpi(T)%20%5Cgt%20%5Cpi(T_2)%24%EF%BC%8C%E5%8D%B3%24%5Cpi(T_2)%20%5Clt%20C(A)%24%0A%0A%23%23%23%20%E7%BC%BA%E7%82%B9%0A%0APCP%E5%9C%A8%E7%BB%9D%E5%A4%A7%E5%A4%9A%E6%95%B0%E6%83%85%E5%86%B5%E4%B8%8B%E9%83%BD%E5%8F%AF%E4%BB%A5%E8%BF%90%E8%A1%8C%E7%9A%84%E5%BE%88%E5%A5%BD%E4%BA%86%EF%BC%8C%E7%BC%BA%E7%82%B9%E6%98%AF%EF%BC%9A%0A%0A1.%20%E5%8F%AA%E6%94%AF%E6%8C%81binary%20semaphore%E3%80%82%E7%BC%BA%E5%B0%91%E5%AF%B9%E5%A4%9A%E8%B5%84%E6%BA%90%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E6%94%AF%E6%8C%81%E3%80%82%0A2.%20%E5%AF%B9%E5%8A%A8%E6%80%81%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E4%BA%8E%E5%A4%8D%E6%9D%82%EF%BC%8C%E8%A6%81%E5%AE%9E%E6%97%B6%E8%B0%83%E6%95%B4%E7%B3%BB%E7%BB%9F%E9%92%88%E5%AF%B9%E6%AF%8F%E4%B8%AA%E4%BB%BB%E5%8A%A1%E7%9A%84priority%20ceiling%E3%80%82%0A3.%20%E8%99%BD%E7%84%B6context%20switch%E5%B7%B2%E7%BB%8F%E5%8F%ABPIP%E8%BE%83%E4%B8%BA%E5%87%8F%E5%B0%91%EF%BC%8C%E4%BD%86%E4%BB%8D%E7%84%B6%E6%9C%89%E6%8F%90%E5%8D%87%E7%A9%BA%E9%97%B4%0A%0A%23%23%20SRP%0A%0ASRP%E7%9A%84%E4%BA%A7%E7%94%9F%E5%8F%AF%E4%BB%A5%E5%85%8B%E6%9C%8D%E8%BF%99%E4%BA%9BPCP%E7%9A%84%E7%BC%BA%E7%82%B9%E3%80%82%0A%0A%3E%20%E4%B9%8B%E6%89%80%E4%BB%A5%E5%8F%ABstack%20based%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%AE%83%E7%9A%84%E8%AF%9E%E7%94%9F%E5%92%8C%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%A2%86%E5%9F%9F%E7%9A%84stack%20sharing%5B1%5D%E6%9C%89%E5%85%B3%E3%80%82%0A%3E%0A%3E%20!%5B6635599516cf187e0c50d27771a3b326.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5859)%0A%3E%0A%3E%20stack%20sharing%E7%94%A8%E4%BA%8E%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E3%80%82%E5%A6%82%E6%9E%9C%E5%B7%A6%E8%BE%B9%E6%AF%8F%E4%B8%AA%E6%A0%88%E7%A9%BA%E9%97%B4%E4%B8%BA10K%EF%BC%8C%E5%88%99%E6%80%BB%E5%85%B1%E9%9C%80%E8%A6%8130K%E3%80%82%E5%9C%A8%E6%A0%88%E7%A9%BA%E9%97%B4%E4%B8%8D%E6%98%AF%E5%BE%88%E7%B4%A7%E5%BC%A0%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%87%87%E7%94%A8stack%20sharing%E5%90%8E%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E6%80%BB%E5%85%B110K%E7%9A%84%E6%A0%88%E7%A9%BA%E9%97%B4%0A%3E%0A%3E%20stack%20sharing%E6%9C%89%E4%B8%80%E4%B8%AA%E7%89%B9%E6%80%A7%EF%BC%8C%E5%B0%B1%E6%98%AF%E4%BB%BB%E5%8A%A1%E5%8F%AA%E8%83%BD%E5%9C%A8%E6%A0%88%E9%A1%B6%E7%9A%84%E6%97%B6%E5%80%99%E6%89%8D%E8%83%BD%E5%BE%97%E5%88%B0%E8%BF%90%E8%A1%8C%E3%80%82%E5%BD%93%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E8%A2%AB%E5%8F%A6%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E6%8A%A2%E5%8D%A0%E5%90%8E%EF%BC%8C%E6%84%8F%E5%91%B3%E7%9D%80%E8%A2%AB%E6%8A%A2%E5%8D%A0%E7%9A%84%E4%BB%BB%E5%8A%A1%E8%A6%81%E7%AD%89%E5%88%B0%E6%8A%A2%E5%8D%A0%E8%80%85%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9D%9F%E6%89%8D%E6%9C%89%E6%9C%BA%E4%BC%9A%E8%BF%90%E8%A1%8C%E3%80%82%0A%3E%0A%3E%20%E5%BD%93%E9%87%87%E7%94%A8stack%20sharing%E4%B9%8B%E5%90%8E%EF%BC%8Cstack%E4%B9%9F%E5%B0%B1%E5%8F%98%E6%88%90%E4%BA%86%E4%B8%80%E7%A7%8D%E5%85%B1%E4%BA%AB%E8%B5%84%E6%BA%90%E3%80%82%0A%0A%E8%99%BD%E7%84%B6SRP%E6%98%AF%E5%9B%A0%E4%B8%BAstack%20sharing%E8%80%8C%E4%BA%A7%E7%94%9F%EF%BC%8C%E4%BD%86%E5%8D%B3%E4%BE%BF%E5%9C%A8%E4%B8%8D%E6%98%AFstack%20sharing%E7%9A%84%E5%9C%BA%E5%90%88%EF%BC%8C%E4%B9%9F%E6%9C%89%E5%BE%88%E5%A5%BD%E7%9A%84%E6%80%A7%E8%83%BD%E3%80%82%0A%0A%23%23%23%20%E5%AE%9A%E4%B9%89%0A%0A-%20priority%EF%BC%9A%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%EF%BC%8C%E4%BE%8B%E5%A6%82%E5%9C%A8%E4%B8%80%E4%BA%9B%E5%8A%A8%E6%80%81%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E4%B8%AD%EF%BC%8C%E4%BE%8B%E5%A6%82EDF%0A-%20preemption%20level%EF%BC%9A%E7%9B%B8%E5%AF%B9%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8Cpreemption%20level%E6%98%AF%E9%9D%99%E6%80%81%E7%9A%84%EF%BC%8C%E6%96%B9%E4%BE%BF%E5%9C%A8%E5%8A%A8%E6%80%81%E4%BC%98%E5%85%88%E7%BA%A7%E7%AE%97%E6%B3%95%E4%B8%AD%EF%BC%8C%E9%A2%84%E6%B5%8B%E8%B5%84%E6%BA%90%E7%AB%9E%E4%BA%89%E3%80%82%E9%80%9A%E5%B8%B8%E5%8F%96%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%88%9D%E5%A7%8B%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%0A%0A%3E%20%E6%8E%A8%E5%AF%BCpreemption%20level%E7%9A%84%E5%85%85%E5%88%86%E6%9D%A1%E4%BB%B6%0A%3E%0A%3E%20%24%24p(J)%20%5Cle%20p(J&apos;)%20%5Cbigcup%20Arrival(J)%20%5Cle%20Arrival(J&apos;)%20%5Cbigcup%20%5Cpi(J)%20%5Clt%20%5Cpi(J&apos;)%24%24%0A%3E%0A%3E%20%E7%AE%80%E5%8D%95%E8%AF%B4%E5%B0%B1%E6%98%AF%E5%A6%82%E6%9E%9C%24J%24%E6%99%9A%E5%88%B0%E6%97%A9%E7%BB%93%E6%9D%9F%EF%BC%8C%E5%88%99%24J%24%E7%9A%84preemption%20level%E8%BE%83%E5%A4%A7%E3%80%82%0A%0A-%20ceiling%EF%BC%9ASRP%E7%9A%84ceiling%E5%AE%9A%E4%B9%89%E4%B8%8EPCP%E4%B8%8D%E4%B8%80%E6%A0%B7%E3%80%82%0A%0A%3E%20%24%24%5Clceil%20R%20%5Crceil%20_%7B%5Cnu_R%7D%20%3D%20max(%5C%7B0%5C%7D%20%5Cbigcup%20%5C%7B%5Cpi(J)%20%5Cmid%20%5Cnu_R%20%5Clt%20%5Cmu_R(J)%5C%7D%20)%24%24%0A%3E%0A%3E%20%E5%85%B6%E4%B8%AD%EF%BC%9A%0A%3E%0A%3E%20-%20%24%5Cmu_R%24%3A%20maximum%20number%20of%20units%20of%20R%20that%20job%20%24J%24%20may%20need%20to%20hold%20at%20any%20one%20time.%20%20%0A%3E%20-%20%24%5Cnu_R%24%3A%20the%20number%20of%20units%20of%20R%20that%20are%20currently%20available%20%20%0A%0A-%20current%20ceiling%3A%20%24%5Coverline%20%5Cpi%20%3D%20max%5C%7B%20%5Clceil%20R_i%20%5Crceil%20_%7B%5Cnu_R%7D%20%5Cmid%20i%20%3D1%2C%20%5Cdots%2C%20m%5C%7D%24%0A%0A%23%23%23%20%E7%AE%97%E6%B3%95%0A%0A%E5%9B%A0%E4%B8%BApreemption%20level%E6%98%AF%E9%9D%99%E6%80%81%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E5%AF%B9ceiling%E7%9A%84%E8%AE%A1%E7%AE%97%E4%B9%9F%E6%98%AF%E9%9D%99%E6%80%81%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E9%A2%84%E5%85%88%E8%AE%A1%E7%AE%97%E5%B9%B6%E5%86%99%E5%85%A5%E4%B8%80%E5%BC%A0%E8%A1%A8%E6%A0%BC%E3%80%82%0A%0A%3E%20%E5%BC%95%E7%94%A8%E5%8E%9F%E8%AE%BA%E6%96%87%5B2%5D%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90%0A%3E%0A%3E%20%E5%81%87%E5%A6%82%24J_1%24%2C%20%24J_2%24%2C%20%24J_3%24%E5%9C%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%B8%AD%E7%94%B3%E8%AF%B7%E8%B5%84%E6%BA%90%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%3E%0A%3E%20!%5Bcb4dcb668edd5aa63274fdc3e43d866b.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5860)%0A%3E%0A%3E%20%E7%9B%B4%E8%A7%82%E4%B8%80%E7%82%B9%E7%9A%84%E8%B5%84%E6%BA%90%E7%94%B3%E8%AF%B7%E5%9B%BE%EF%BC%9A%0A%3E%0A%3E%20!%5Bbdf4e3f81cf26a5446b44c5bd8f879b6.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5861)%0A%3E%0A%3E%20%E5%8F%AF%E4%BB%A5%E8%AE%A1%E7%AE%97%E5%87%BA%24%5Clceil%20R%20%5Crceil_%7B%5Cnu_R%7D%24%E8%A1%A8%E6%A0%BC%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%3E%0A%3E%20!%5B544e35157b7538159438725e5ec1e4ec.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5862)%0A%3E%0A%3E%20%E4%BB%A5%24%5Clceil%20R_2%20%5Crceil%20_0%24%E4%B8%BA%E4%BE%8B%EF%BC%9A%0A%3E%0A%3E%20-%20%24%5Cnu_R%20%3D%200%24%0A%3E%20-%20%24%5Clceil%20R_2%20%5Crceil%20_0%20%3D%20max(%5C%7B0%5C%7D%20%5Cbigcup%20%5C%7B%5Cpi(J)%20%5Cmid%200%20%5Clt%20%5Cmu_R(J)%5C%7D%20)%24%0A%3E%20-%20%E8%8B%A5%24%5Cpi(I_i)%20%3D%20p(J_i)%20%3D%20i%24%20%2C%20%E5%88%99%E6%BB%A1%E8%B6%B3%E4%B8%8A%E5%BC%8F%E7%9A%84%E6%9C%80%E5%A4%A7%E7%9A%84%24%5Cpi(J)%20%3D%202%24%EF%BC%8C%E5%A6%82%E8%A1%A8%E6%89%80%E7%A4%BA%E3%80%82%0A%0A-%20%E5%BD%93%E4%BB%BB%E5%8A%A1%24J%24%20ready%E6%97%B6%EF%BC%8C%E8%AE%A1%E7%AE%97%E6%AD%A4%E6%97%B6%E7%9A%84preemption%20level%E6%98%AF%E5%90%A6%E6%BB%A1%E8%B6%B3%EF%BC%9A%24%5Cpi(J)%20%5Cgt%20%5Coverline%20%5Cpi%24%EF%BC%8C%E4%B8%8D%E6%BB%A1%E8%B6%B3%E5%88%99%E9%98%BB%E5%A1%9E%E3%80%82%0A%0A%23%23%23%20%E4%BC%98%E7%82%B9%0A%0A1.%20No%20job%20can%20be%20blocked%20after%20it%20starts.%20%E6%B2%A1%E6%9C%89block%EF%BC%8C%E6%89%80%E4%BB%A5%E6%B2%A1%E6%9C%89%E9%A2%9D%E5%A4%96%E7%9A%84context%20switch%E3%80%82context%20switch%E5%8F%AA%E4%BC%9A%E5%8F%91%E7%94%9F%E5%9C%A8start%20execution%E5%92%8Cpreemption%E3%80%82%0A2.%20There%20can%20be%20n%20o%20transitive%20blocking%20or%20deadlock.%0A3.%20If%20the%20oldest%20highest-priority%20job%20is%20blocked%2C%20it%20will%20become%20unblocked%20no%20later%20than%20the%20first%20instant%20that%20the%20currently%20executing%20job%20is%20not%20holding%20any%20non-preemptable%20resources%20%0A%0A%23%23%20%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%0A%0A%5B1%5D%20Bhuvan%20Middha%2C%20Matthew%20Simpson%20and%20Rajeev%20Barua%2C%20%22MTSS%3A%20Multi%20Task%20Stack%20Sharing%20for%20Embedded%20Systems%20%22%2C%20Department%20of%20Electrical%20%26%20Computer%20Engineering%20University%20of%20Maryland%20College%20Park%0A%0A%5B2%5D%20T.P.%20Baker%2C%20%22A%20Stack-Based%20Resource%20Allocation%20Policy%20for%20Realtime%20Processes%20%22%2C%20In%20Proceedings%20of%20the%20Real-Time%20Systems%20Symposium%2C%20pages%20191%E2%80%93200%2C%201990%20%0A%0A%5B3%5D%20Lui%20Sha%3B%20Ragunathan%20Rajkumar%20%26%20John%20P.%20Lehoczky%20(September%201990).%20%22Priority%20Inheritance%20Protocols%3A%20An%20Approach%20to%20Real-Time%20Synchronization%22.%20IEEE%20Transactions%20on%20Computers.%0A%0A%0A%0A%0A%0A%0A%0A]]></content>
      <tags>
        <tag>schedule algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PIP在Linux+glibc中的实现]]></title>
    <url>%2F2019%2F02%2F03%2FPIP%E5%9C%A8Linux%2Bglibc%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[&#x4F18;&#x5148;&#x7EA7;&#x53CD;&#x8F6C; &#x4F18;&#x5148;&#x7EA7;&#x53CD;&#x8F6C;&#x6307;&#x4E00;&#x4E2A;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#x56E0;&#x4E3A;&#x8D44;&#x6E90;&#x88AB;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#x5360;&#x7528;&#xFF0C;&#x800C;&#x4E0D;&#x5F97;&#x4E0D;&#x7B49;&#x5F85;&#x3002;&#x8FD9;&#x4E2A;&#x903B;&#x8F91;&#x672C;&#x8EAB;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x3002;&#x4F18;&#x5148;&#x7EA7;&#x53CD;&#x8F6C;&#x5E26;&#x6765;&#x6700;&#x76F4;&#x63A5;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x53EF;&#x80FD;&#x56E0;&#x4E3A;&#x8FD9;&#x6B21;&#x963B;&#x585E;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#x963B;&#x585E;&#x65F6;&#x5EF6;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x3002; Task 9&#x4F18;&#x5148;&#x7EA7;&#x8F83;&#x4F4E;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x5176;&#x4ED6;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x4EFB;&#x52A1;&#x62A2;&#x5360;&#x8FD0;&#x884C;&#xFF0C;&#x5BFC;&#x81F4;&#x5BF9;&#x8D44;&#x6E90;S&#x7684;&#x9501;&#x65E0;&#x6CD5;&#x91CA;&#x653E;&#xFF0C;&#x800C;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x4EFB;&#x52A1;&#x56E0;&#x4E3A;&#x8981;&#x6301;&#x6709;&#x8BE5;&#x9501;&#xFF0C;&#x4E0D;&#x5F97;&#x4E0D;&#x7B49;&#x5F85;&#x3002; &#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F; Priority Inheritance Protocol&#x7FFB;&#x8BD1;&#x4E3A;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#xFF0C;&#x7B80;&#x79F0;PIP&#x3002;&#x8FD9;&#x662F;&#x89E3;&#x51B3;&#x4E0A;&#x8FF0;Unbounded inversion&#x6700;&#x76F4;&#x63A5;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x5360;&#x6709;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x6574;&#x5230;&#x5728;&#x7B49;&#x5F85;&#x7684;&#x4EFB;&#x52A1;&#x7684;&#x6700;&#x9AD8;&#x503C;&#x3002;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x662F;&#x8D2A;&#x5A6A;&#x7684;&#xFF0C;&#x5C40;&#x90E8;&#x6700;&#x4F18;&#xFF0C;&#x4F46;&#x4E0D;&#x662F;&#x6574;&#x4F53;&#x6700;&#x4F18;&#x89E3;&#xFF0C;&#x5728;&#x6B64;&#x4E4B;&#x4E0A;&#x53C8;&#x6709;PCP(&#x4F18;&#x5148;&#x7EA7;&#x5929;&#x82B1;&#x677F;)&#x548C;SRP(&#x57FA;&#x4E8E;&#x6808;&#x7684;&#x8D44;&#x6E90;&#x7B56;&#x7565;)&#x3002;&#x672C;&#x6587;&#x4E0D;&#x505A;&#x8BA8;&#x8BBA;&#x3002;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x4ECE;&#x6E90;&#x7801;&#x7684;&#x89D2;&#x5EA6;&#xFF0C;&#x9610;&#x8FF0;PIP&#x5728;Linux&#x548C;glibc&#x4E2D;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002; Overview Linux&#x4E0B;&#x7684;PIP&#x5B9E;&#x73B0;&#x5206;&#x6210;&#x4EE5;&#x4E0A;3&#x4E2A;&#x90E8;&#x5206;&#xFF1A; glibc&#x4E2D;&#x7684;pthread_mutex_lock&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;FUTEX_LOCK_PI&#x5B9E;&#x73B0;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x6574; Linux&#x7684;futex&#x90E8;&#x5206;&#x63D0;&#x4F9B;FUTEX_LOCK_PI&#x7684;&#x5B9E;&#x73B0; &#x6700;&#x7EC8;&#x7684;&#x9501;&#x673A;&#x5236;&#x901A;&#x8FC7;rt_mutex&#x6765;&#x5B9E;&#x73B0; pthread_mutex Types pthread mutex&#x662F;POSIX pthread&#x5E93;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x79CD;&#x9501;&#x673A;&#x5236;&#xFF0C;&#x4E0E;&#x4FE1;&#x53F7;&#x91CF;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x9501;&#x53EA;&#x6709;&#x4E24;&#x79CD;&#x72B6;&#x6001;&#xFF1A;locked&#x6216;unlocked&#x3002;&#x4E0E;binary semaphore&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;mutex&#x53EA;&#x80FD;&#x88AB;lock&#x7684;&#x7EBF;&#x7A0B;unlock&#xFF0C;&#x5373;&#x53EA;&#x80FD;&#x88AB;mutex owner unlock&#x3002; &#x76EE;&#x524D;POSIX&#x6807;&#x51C6;(1003.1-2008)&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;4&#x79CD;&#x7C7B;&#x578B;&#x7684;mutex: PTHREAD_MUTEX_NORMAL PTHREAD_MUTEX_ERRORCHECK PTHREAD_MUTEX_RECURSIVE PTHREAD_MUTEX_DEFAULT &#x8FD9;4&#x79CD;mutex&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5982;&#x4E0B; attempting to relock this mutex without first unlockingAttempting to unlock a mutex locked by a different threadNORMALdeadlockundefinedERRORCHECKreturn error -EDEADLOCKreturn errorRECURSIVEsucceed in lockingreturn errorDEFAULTundefinedundefined glibc&#x5BF9;&#x4E0A;&#x8FF0;4&#x79CD;&#x7C7B;&#x578B;&#x7684;mutex&#x8FDB;&#x884C;&#x4E86;&#x6269;&#x5C55;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A; case PTHREAD_MUTEX_PI_RECURSIVE_NP: case PTHREAD_MUTEX_PI_ERRORCHECK_NP: case PTHREAD_MUTEX_PI_NORMAL_NP: case PTHREAD_MUTEX_PI_ADAPTIVE_NP: case PTHREAD_MUTEX_PI_ROBUST_RECURSIVE_NP: case PTHREAD_MUTEX_PI_ROBUST_ERRORCHECK_NP: case PTHREAD_MUTEX_PI_ROBUST_NORMAL_NP: case PTHREAD_MUTEX_PI_ROBUST_ADAPTIVE_NP: &#x4E3B;&#x8981;&#x591A;&#x4E86;&#x8FD9;3&#x79CD;&#x5C5E;&#x6027;&#xFF1A; ADAPTIVE&#xFF1A;&#x5728;SMP&#x67B6;&#x6784;&#x4E0B;&#xFF0C;&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x8FDB;&#x5165;wait&#xFF0C;&#x800C;&#x662F;&#x5148;&#x8C03;&#x7528;spinlock&#x7B49;&#x5F85;&#x4E00;&#x5C0F;&#x6BB5;&#x65F6;&#x95F4;&#x3002;musl&#x91CC;&#x9ED8;&#x8BA4;&#x90FD;&#x91C7;&#x7528;&#x4E86;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0; PI&#xFF1A;&#x5305;&#x542B;&#x8BE5;&#x5C5E;&#x6027;&#x7684;mutex&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;(Priority Inheritance, PI) ROBUST&#xFF1A;&#x82E5;&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#x65F6;&#x672A;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5219;&#x4EE5;&#x540E;&#x5BF9;&#x8BE5;&#x9501;&#x64CD;&#x4F5C;&#x90FD;&#x4F1A;&#x8FD4;&#x56DE;-EOWNERDEAD&#xFF0C;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#x7684;&#x662F;PTHREAD_MUTEX_STALLED(&#x8FD9;&#x662F;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;)&#xFF0C;&#x5BF9;&#x8BE5;&#x5F02;&#x5E38;&#x9501;&#x7684;&#x64CD;&#x4F5C;&#x4F1A;&#x51FA;&#x73B0;undefined&#x884C;&#x4E3A;&#x3002; &#x518D;&#x4E0E;&#x539F;&#x5148;&#x7684;4&#x79CD;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x6392;&#x5217;&#x7EC4;&#x5408;&#x3002; &quot;_NP&quot; suffix Note: the _NP suffix indicates a non-portable extension to the POSIX specification. In fact the latest specification, 1003.1-2008 [2], includes most of the Linux additions so you can leave the _NP ending off. I have chosen not to because some older versions of the header files only have the _NP variants. &#x6839;&#x636E;&#x6700;&#x65B0;&#x7684;POSIX&#x6807;&#x51C6;1003.1-2008&#xFF0C;&#x8FD9;&#x4E9B;&#x6269;&#x5C55;&#x5E76;&#x6CA1;&#x6709;&#x52A0;&#x5165;&#x3002; &#x672C;&#x6587;&#x53EA;&#x5173;&#x6CE8;MUTEX_PI&#x5B9E;&#x73B0;&#x3002; PTHREAD_MUTEX_PI pthread_mutex_lock &#x91CD;&#x8981;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A; typedef union { struct __pthread_mutex_s __data; char __size[__SIZEOF_PTHREAD_MUTEX_T]; long int __align; } pthread_mutex_t; struct __pthread_mutex_s { int __lock __LOCK_ALIGNMENT; unsigned int __count; int __owner; ... } &#x5982;&#x679C;&#x4E0D;&#x8003;&#x8651;ROBUST&#x60C5;&#x51B5;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x4E00;&#x6B21;&#x9488;&#x5BF9;&#x5B9E;&#x73B0;&#x4E86;PI&#x5C5E;&#x6027;&#x7684;pthread_mutex_lock&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A; atomic_compare_and_exchange_val_acq &#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;&#x5148;&#x6BD4;&#x8F83;&#x518D;&#x8D4B;&#x503C;&#xFF0C;&#x4F2A;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A; int compare_and_swap(int* reg, int oldval, int newval) { ATOMIC(); int old_reg_val = *reg; if (old_reg_val == oldval) *reg = newval; END_ATOMIC(); return old_reg_val; } &#x9488;&#x5BF9;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#xFF1A; oldval == 0: &#x8868;&#x793A;mutex-&gt;__data.__lock == 0&#xFF0C;&#x5373;&#x8BE5;lock&#x65E0;owner&#xFF0C;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x3002; oldval != 0: &#x8868;&#x793A;&#x8BE5;mutex&#x88AB;lock&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x8FDB;&#x5165;kernel&#x6765;&#x5904;&#x7406;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x3002; pthread_mutex_lock&#x7684;&#x903B;&#x8F91;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x5224;&#x65AD;&#x9501;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;&#x9501;&#x4F4F;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x9501;&#x4F4F;&#x5C31;&#x66F4;&#x65B0;owner&#xFF0C;&#x4EE5;&#x53CA;user&#x8BA1;&#x6570;&#x3002;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x88AB;&#x9501;&#x4F4F;&#xFF0C;&#x5219;&#x9677;&#x5165;&#x5185;&#x6838;&#x8C03;&#x7528;FUTEX_LOCK_PI&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5B8C;&#x6210;&#x4E0A;&#x9501;&#x7684;&#x64CD;&#x4F5C;&#x3002; pthread_mutex_unlock &#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528;futex_unlock_pi SYSCALL&#x6765;&#x5B8C;&#x6210;&#x5DE5;&#x4F5C;&#xFF1A; /* Unlock the mutex using a CAS unless there are futex waiters or our &#x203A; TID is not the value of __lock anymore, in which case we let the &#x203A; kernel take care of the situation. Use release MO in the CAS to &#x203A; synchronize with acquire MO in lock acquisitions. */ int l = atomic_load_relaxed (&amp;mutex-&gt;__data.__lock); do &#x203A; { &#x203A; if (((l &amp; FUTEX_WAITERS) != 0) &#x203A; || (l != THREAD_GETMEM (THREAD_SELF, tid))) &#x203A; { &#x203A; INTERNAL_SYSCALL_DECL (__err); &#x203A; INTERNAL_SYSCALL (futex, __err, 2, &amp;mutex-&gt;__data.__lock, &#x203A; &#x203A; &#x203A; &#x203A; __lll_private_flag (FUTEX_UNLOCK_PI, private)); &#x203A; break; &#x203A; } &#x203A; } while (!atomic_compare_exchange_weak_release (&amp;mutex-&gt;__data.__lock, &#x203A; &#x203A; &#x203A; &#x203A; &#x203A; &#x203A; &amp;l, 0)); futex futex&#x662F;&#x4E00;&#x79CD;&#x5185;&#x6838;&#x7684;&#x7B49;&#x5F85;&#x673A;&#x5236;&#xFF0C;&#x7B49;&#x5F85;&#x67D0;&#x4E2A;&#x7528;&#x6237;&#x6001;&#x6570;&#x636E;&#x88AB;&#x8BBE;&#x7F6E;&#x6210;&#x67D0;&#x4E2A;&#x503C;&#x3002;&#x9488;&#x5BF9;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#x7684;futex&#x7565;&#x6709;&#x4E0D;&#x540C;&#x3002;&#x5B83;&#x4E0D;&#x518D;&#x7B49;&#x5F85;&#x7528;&#x6237;&#x4F20;&#x5165;&#x7684;&#x5730;&#x5740;&#x4E0A;&#x7684;&#x503C;&#xFF0C;&#x800C;&#x662F;&#x57FA;&#x4E8E;&#x5185;&#x6838;rt_mutex&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7B49;&#x5F85;&#xFF0C;&#x4E0A;&#x9501;&#x548C;&#x89E3;&#x9501;&#x7684;&#x529F;&#x80FD;&#x3002;&#x770B;&#x4E0B;&#x9762;glibc&#x548C;Linux&#x7684;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;&#xFF1A; // glibc: pthread_mutex_lock.c int e = INTERNAL_SYSCALL (futex, __err, 4, &amp;mutex-&gt;__data.__lock, &#x203A; &#x203A; __lll_private_flag (FUTEX_LOCK_PI, &#x203A; &#x203A; &#x203A; &#x203A; &#x203A; private), 1, 0); // Linux: futex.c long do_futex(u32 __user *uaddr, int op, u32 val, ktime_t *timeout, &#x203A; &#x203A; u32 __user *uaddr2, u32 val2, u32 val3) { ... case FUTEX_LOCK_PI: &#x203A; return futex_lock_pi(uaddr, flags, NULL, 1); ... } &#x53EF;&#x89C1;&#xFF1A; uaddr = &amp;mutex-&gt;__data.__lock flags = __lll_private_flag (FUTEX_LOCK_PI, private) val = 1, timeout = NULL &#x5173;&#x4E8E;lock/unlock&#x7684;&#x53D9;&#x8FF0;&#x4F1A;&#x7B80;&#x5316;&#x6389;time&#x76F8;&#x5173;&#x90E8;&#x5206;&#xFF0C;&#x4EE5;&#x53CA;PI&#x65E0;&#x5173;&#x7684;ROBUST&#x7B49;&#x7279;&#x6027;&#x3002; &#x91CD;&#x8981;&#x6570;&#x636E;&#x7ED3;&#x6784; /* * Hash buckets are shared by all the futex_keys that hash to the same * location. Each key may have multiple futex_q structures, one for each task * waiting on a futex. */ struct futex_hash_bucket { &#x203A; atomic_t waiters; &#x203A; spinlock_t lock; &#x203A; struct plist_head chain; } ____cacheline_aligned_in_smp; /** * struct futex_q - The hashed futex queue entry, one per waiting task * @list:&#x203A; &#x203A; priority-sorted list of tasks waiting on this futex * @task:&#x203A; &#x203A; the task waiting on the futex * @lock_ptr:&#x203A; &#x203A; the hash bucket lock * @key:&#x203A; &#x203A; the key the futex is hashed on * @pi_state:&#x203A; &#x203A; optional priority inheritance state * @rt_waiter:&#x203A; &#x203A; rt_waiter storage for use with requeue_pi * @requeue_pi_key:&#x203A;the requeue_pi target futex key * @bitset:&#x203A;&#x203A; bitset for the optional bitmasked wakeup * * We use this hashed waitqueue, instead of a normal wait_queue_entry_t, so * we can wake only the relevant ones (hashed queues may be shared). * * A futex_q has a woken state, just like tasks have TASK_RUNNING. * It is considered woken when plist_node_empty(&amp;q-&gt;list) || q-&gt;lock_ptr == 0. * The order of wakeup is always to make the first condition true, then * the second. * * PI futexes are typically woken before they are removed from the hash list via * the rt_mutex code. See unqueue_me_pi(). */ struct futex_q { &#x203A; struct plist_node list; &#x203A; struct task_struct *task; &#x203A; spinlock_t *lock_ptr; &#x203A; union futex_key key; &#x203A; struct futex_pi_state *pi_state; &#x203A; struct rt_mutex_waiter *rt_waiter; &#x203A; union futex_key *requeue_pi_key; &#x203A; u32 bitset; } __randomize_layout; /* * Priority Inheritance state: */ struct futex_pi_state { &#x203A; /* &#x203A; * list of &apos;owned&apos; pi_state instances - these have to be &#x203A; * cleaned up in do_exit() if the task exits prematurely: &#x203A; */ &#x203A; struct list_head list; &#x203A; /* &#x203A; * The PI object: &#x203A; */ &#x203A; struct rt_mutex pi_mutex; &#x203A; struct task_struct *owner; &#x203A; atomic_t refcount; &#x203A; union futex_key key; } __randomize_layout; futex_hash_bucket&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x6001;&#x7684;uaddr&#x3002;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x6001;&#x4F20;&#x5165;&#x7684;uaddr&#x5730;&#x5740;&#xFF0C;&#x6765;&#x83B7;&#x5F97;&#x5BF9;&#x5E94;&#x7684;futex&#x7ED3;&#x6784;&#x4F53;&#x3002;&#x7528;hash&#x7684;&#x539F;&#x56E0;&#x662F;&#x4F20;&#x5165;&#x7684;&#x662F;uaddr&#x5730;&#x5740;&#x503C;&#xFF0C;&#x6570;&#x5B57;&#x5F88;&#x5927;&#xFF0C;&#x5206;&#x5E03;&#x5F88;&#x6563;&#xFF0C;&#x6240;&#x4EE5;&#x7528;hash&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x7D22;&#x5F15;&#x3002; futex_q&#x662F;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#xFF0C;&#x5BF9;&#x5E94;&#x4E86;&#x4E00;&#x4E2A;futex&#x7684;waiter&#x7EBF;&#x7A0B;&#x3002;&#x5B83;&#x901A;&#x5E38;&#x88AB;&#x7528;&#x6765;&#x4F20;&#x9012;&#x5404;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002; pi_state&#x662F;task_struct&#x5185;&#x90E8;&#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x5728;futex_lock_pi&#x8C03;&#x7528;refill_pi_state_cache&#x91CC;&#x9762;&#x505A;&#x5206;&#x914D;&#x3002; static int refill_pi_state_cache(void) { ... pi_state = kzalloc(sizeof(*pi_state), GFP_KERNEL); current-&gt;pi_state_cache = pi_state; ... } futex_lock_pi &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x903B;&#x8F91;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x76F4;&#x7EBF;&#x7684;&#xFF0C;&#x540C;&#x5927;&#x591A;&#x6570;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x4E00;&#x6837;&#xFF0C;&#x5148;&#x5C1D;&#x8BD5;&#x539F;&#x5B50;&#x9501;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x884C;&#xFF0C;&#x5219;&#x8C03;&#x7528;rt_mutex&#x7684;&#x5B9E;&#x73B0;&#x6765;&#x5904;&#x7406;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#x7684;&#x673A;&#x5236;&#x3002;&#x4EE5;&#x4E0B;&#x6361;&#x53D6;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x51FD;&#x6570;&#x505A;&#x9610;&#x8FF0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x53C2;&#x8003;&#x6587;&#x732E;[3], [4]&#x4E2D;&#x7684;&#x63CF;&#x8FF0;&#x3002; queue_lock, queue_unlock &#x5BF9;hash_bucket&#x8FDB;&#x884C;&#x9501;&#x64CD;&#x4F5C;&#x3002;&#x4ED6;&#x4EEC;&#x64CD;&#x4F5C;&#x7684;&#x662F;hash_bucket&#x4E0B;&#x7684;lock&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x662F;futex_q&#x4E0B;&#x7684;lock_ptr&#x3002;&#x8FD9;&#x91CC;&#x9501;&#x7684;&#x51FA;&#x73B0;&#x6BD4;&#x8F83;&#x6DF7;&#x4E71;&#xFF0C;&#x6709;&#x65F6;&#x8C03;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6709;&#x65F6;&#x76F4;&#x63A5;&#x5BF9;lock&#x6307;&#x9488;&#x64CD;&#x4F5C;&#x3002;&#x9700;&#x8981;&#x5C0F;&#x5FC3;&#x3002; __queue_me, unqueue_me &#x8FD9;&#x91CC;&#x5C06;&#x7533;&#x8BF7;futex&#x7684;&#x7EBF;&#x7A0B;&#x5728;hash_bucket&#x7684;chain&#x4E0A;&#x505A;&#x6DFB;&#x52A0;&#x6216;&#x79FB;&#x9664;&#x64CD;&#x4F5C;&#x3002;&#x8FD8;&#x4F1A;&#x6D89;&#x53CA;&#x9501;&#x7684;&#x64CD;&#x4F5C;&#x3002; &#x4EE5;&#x4E0A;4&#x4E2A;&#x51FD;&#x6570;&#x66F4;&#x591A;&#x7684;&#x4E0E;futex&#x7684;&#x5B9E;&#x73B0;&#x76F8;&#x5173;&#xFF0C;&#x4E0E;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#x5E76;&#x65E0;&#x5173;&#x7CFB;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7565;&#x8FC7;&#x3002; futex_lock_pi_atomic &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x505A;&#x7684;&#x5C31;&#x662F;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x6765;&#x8BF7;&#x6C42;&#x9501;&#xFF0C; &#x5982;&#x679C;futex&#x6CA1;&#x6709;waiter&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x83B7;&#x5F97;&#x9501;&#x5E76;&#x8FD4;&#x56DE;1&#xFF0C;&#x8868;&#x793A;&#x6210;&#x529F;&#x83B7;&#x5F97;&#x9501; &#x5982;&#x679C;&#x6709;waiter&#xFF0C;&#x5C31;&#x8FD4;&#x56DE;0&#xFF0C;&#x8868;&#x793A;ready to wait &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x4F1A;&#x505A;&#x4E00;&#x4E9B;&#x4E0E;PI&#x76F8;&#x5173;&#x7684;&#x5904;&#x7406;&#xFF1A; &#x6709;waiter&#x7684;&#x60C5;&#x51B5;&#xFF1A; &#x8C03;&#x7528;attach_to_pi_state&#x6765;&#x83B7;&#x5F97;&#x8BE5;top_waiter&#x7684;pi_state &#x6CA1;&#x6709;waiter&#x7684;&#x60C5;&#x51B5; &#x8C03;&#x7528;attach_to_pi_owner&#x6765;&#x53D6;&#x7528;&#x672C;&#x7EBF;&#x7A0B;&#x91CC;&#x5206;&#x914D;&#x7684;pi_state&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x5E76;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x3002;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x88AB;queue&#x5230;hash_bucket&#x7684;&#x961F;&#x5217;&#x4E2D;&#x3002; rt_mutex&#x63A5;&#x53E3; futex_lock_pi&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x5982;&#x4E0B;&#x8FD9;&#x4E9B;rt_mutex&#x63A5;&#x53E3;&#xFF1A; rt_mutex_init_waiter&#xFF1A;&#x521D;&#x59CB;&#x5316;waiter&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5176;&#x5B9E;&#x4E3A;&#x4E00;&#x4E2A;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x4E2A;waiter&#x5BF9;&#x5E94;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x53CD;&#x6620;&#x7EBF;&#x7A0B;&#x5728;&#x67D0;&#x4E2A;&#x9501;&#x4E0A;&#x7684;&#x7B49;&#x5F85;&#x5173;&#x7CFB;&#x3002; __rt_mutex_start_proxy_lock&#xFF1A;&#x8FD9;&#x4E2A;&#x662F;PI&#x7684;&#x6838;&#x5FC3;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x6765;&#x5BF9;&#x5404;waiters&#x6570;&#x636E;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x4EE5;&#x53CA;&#x904D;&#x5386;lock&#x94FE;&#x6765;&#x68C0;&#x67E5;&#x6B7B;&#x9501;&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E0E;&#x4E4B;&#x524D;&#x7684;&#x539F;&#x5B50;&#x68C0;&#x67E5;&#x7C7B;&#x4F3C;&#xFF0C;&#x5982;&#x679C;&#x8FD4;&#x56DE;1&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x83B7;&#x5F97;&#x9501;&#xFF0C;&#x5982;&#x679C;&#x8FD4;&#x56DE;0&#xFF0C;&#x5219;ready to wait&#x3002; rt_mutex_wait_proxy_lock&#xFF1A;&#x901A;&#x8FC7;__rt_mutex_start_proxy_lock&#x5904;&#x7406;&#x4E4B;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x83B7;&#x5F97;&#x9501;&#xFF0C;&#x90A3;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x7B49;&#x5F85;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5C06;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x4E3A;TASK_INTERRUPTIBLE&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x5F00;&#x59CB;&#x7B49;&#x5F85;&#x3002;&#x8FD9;&#x5176;&#x95F4;&#x4F1A;&#x5904;&#x7406;&#x57FA;&#x4E8E;&#x65F6;&#x95F4;&#x7684;&#x7B49;&#x5F85;&#xFF0C;&#x4E14;&#x4F1A;&#x89E6;&#x53D1;&#x8C03;&#x5EA6;&#x3002; rt_mutex_cleanup_proxy_lock&#xFF1A;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x963B;&#x585E;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x83B7;&#x5F97;&#x9501;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x8D85;&#x65F6;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x51FA;&#x9519;&#xFF0C;&#x603B;&#x4E4B;&#x8981;&#x5C06;&#x672C;&#x7EBF;&#x7A0B;&#x4ECE;waiters&#x4E2D;&#x79FB;&#x9664;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5C31;&#x662F;&#x8D77;&#x8FD9;&#x4E2A;&#x4F5C;&#x7528;&#x3002; fixup_owner &#x4ECE;&#x6CE8;&#x91CA;&#x4E0A;&#x770B;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x5904;&#x7406;lock steal&#x3002;&#x800C;lock steal&#x4F3C;&#x4E4E;&#x591A;&#x53D1;&#x751F;&#x5728;futex requeue&#x64CD;&#x4F5C;&#x4E0A;&#xFF0C;&#x76EE;&#x524D;&#x5C1A;&#x672A;&#x4ED4;&#x7EC6;&#x7814;&#x7A76;&#x3002; futex_unlock_pi futex_unlock_pi&#x91CA;&#x653E;futex&#x4EE5;&#x53CA;&#x66F4;&#x65B0;&#x76F8;&#x5E94;&#x7684;pi_state&#x548C;rt_mutex&#x7684;owner&#x5B57;&#x6BB5;&#x3002;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x5C42;&#x6B21;&#x6BD4;&#x8F83;&#x6DF1;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;&#x6BCF;&#x4E00;&#x5C42;&#x505A;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x7684;&#x66F4;&#x65B0;&#x5DE5;&#x4F5C;&#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5230;__rt_mutex_futex_unlock&#x6765;&#x91CD;&#x65B0;&#x8C03;&#x6574;&#x672C;&#x7EBF;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5E76;&#x5C06;top waiter&#x653E;&#x5230;wake queue&#x4E0A;&#x3002;&#x5728;rt_mutex_postunlock&#x8C03;&#x7528;&#x7684;rt_mutex_postunlock&#x5C06;&#x65B0;&#x7EBF;&#x7A0B;&#x5524;&#x9192;&#x3002; &#x5982;&#x679C;&#x6CA1;&#x6709;waiter&#xFF0C;&#x5219;&#x4F7F;&#x7528;cmpxchg_futex_value_locked&#x6765;&#x5C06;&#x7528;&#x6237;&#x6001;&#x5730;&#x5740;uaddr&#x4E0A;&#x7684;&#x503C;&#x8BBE;&#x4E3A;0&#x3002;&#x56E0;&#x4E3A;&#x9501;&#x6CA1;&#x6709;waiter&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4F18;&#x5148;&#x7EA7;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x6062;&#x590D;&#x4E86;&#xFF0C;&#x6216;&#x8005;&#x5DF2;&#x7ECF;&#x6062;&#x590D;&#x8FC7;&#x4E86;&#x3002; &#x5982;&#x679C;&#x6709;waiter&#xFF0C;&#x5C31;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#x6765;&#x5207;&#x6362;lock owner&#xFF0C;&#x5E76;&#x6062;&#x590D;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002; wake_futex_pi &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x505A;&#x4E86;&#x4E0B;&#x9762;&#x51E0;&#x4EF6;&#x4E8B;&#xFF1A; &#x7528;cmpxchg_futex_value_locked&#x5C06;&#x7528;&#x6237;&#x6001;&#x4F20;&#x5165;&#x7684;uaddr&#x5904;&#x7684;&#x6570;&#x503C;&#x66F4;&#x65B0;&#x4E3A;&#x65B0;&#x7684;rt_mutex_next_owner() | FUTEX_WAITERS list_del_init(&amp;pi_state-&gt;list)&#xFF1A;&#x5C06;list&#x4ECE;&#x539F;&#x5148;&#x7684;&#x8868;&#x4E0A;&#x5220;&#x9664;&#xFF0C;&#x5E76;&#x91CD;&#x65B0;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x51C6;&#x5907;&#x79FB;&#x5230;&#x5176;&#x4ED6;&#x7684;&#x8868;&#x4E0A;&#x3002; list_add(&amp;pi_state-&gt;list, &amp;new_owner-&gt;pi_state_list) pi_state-&gt;owner = new_owner __rt_mutex_futex_unlock rt_mutex_postunlock mark_wakeup_next_waiter &#x6CE8;&#x610F;&#xFF1A;&#x6B64;&#x65F6;pi_state-&gt;owner&#x5DF2;&#x7ECF;&#x8BBE;&#x7F6E;&#x8FC7;&#x4E86;&#xFF0C;&#x4F46;&#x662F;pi_state-&gt;pi_mutex-&gt;owner&#x8FD8;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E0B;&#x9762;&#x51E0;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A; rt_mutex_dequeue_pi(current, waiter); rt_mutex_adjust_prio(current):&#x5728;&#x8FD9;&#x91CC;&#x8C03;&#x6574;&#x4E86;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5B8C;&#x6210;&#x4E86;&#x6574;&#x4E2A;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#x534F;&#x8BAE;&#x3002; wake_q_add(wake_q, waiter-&gt;task) put_pi_state &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x66F4;&#x591A;&#x7684;&#x662F;&#x6E05;&#x7406;&#x5DE5;&#x4F5C;: &#x8C03;&#x7528;&#x4E86;rt_mutex_proxy_unlock&#x6765;&#x91CA;&#x653E;pi_state-&gt;pi_mutex. &#x91CA;&#x653E;&#x4E86;current-&gt;pi_state_cache&#x7A7A;&#x95F4; cmpxchg_futex_value_locked&#x539F;&#x5B50;&#x64CD;&#x4F5C; static int cmpxchg_futex_value_locked(u32 *uval, u32 __user *uaddr, &#x203A; &#x203A; &#x203A; &#x203A; u32 oldval, u32 newval) { ATOMIC(); int val = *uaddr; if (val == oldval) { *uaddr = newval; } *uval = val; END_ATOMIC(); return 0; } &#x5176;&#x4E2D;ATOMIC&#x64CD;&#x4F5C;&#x901A;&#x8FC7;page_disable()&#x548C;preempt_disable()&#x4FDD;&#x8BC1;&#x3002; __rt_mutex_start_proxy_lock &#x4ECE;&#x4E0A;&#x9762;futex_lock_pi&#x7528;&#x5230;&#x7684;rt_mutex&#x63A5;&#x53E3;&#x4ECB;&#x7ECD;&#x4E2D;&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F;&#x6574;&#x4E2A;PI&#x5904;&#x7406;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x53C8;&#x4E3B;&#x8981;&#x8C03;&#x7528;task_blocks_on_rt_mutex&#x6765;&#x5904;&#x7406;PI&#x3002; rt_mutex_adjust_prio(owner) &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5C31;&#x662F;&#x8C03;&#x6574;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#x7684;&#x3002;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF1A; if (task_has_pi_waiters(p)) &#x203A; pi_task = task_top_pi_waiter(p)-&gt;task; rt_mutex_setprio(p, pi_task); &#x628A;owner&#x7EBF;&#x7A0B;&#x8BBE;&#x7F6E;&#x4E3A;owner&#x7EBF;&#x7A0B;&#x6240;&#x6709;waiter(&#x53EF;&#x80FD;&#x6765;&#x81EA;&#x591A;&#x4E2A;&#x9501;)&#x7684;&#x6700;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x3002; rt_mutex_adjust_prio_chain &#x4E3A;&#x4EC0;&#x4E48;&#x6709;&#x8FD9;&#x4E2A;&#x94FE;&#x5F0F;&#x8C03;&#x6574;&#xFF1F; &#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x5F20;&#x8868;&#x683C;&#xFF1A; &#x6BCF;&#x4E2A;rt_mutex&#x6709;&#x5F20;waiters&#x8868;&#x683C;&#xFF0C;&#x8868;&#x793A;&#x6240;&#x6709;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B; &#x6BCF;&#x4E2A;task&#x4E5F;&#x6709;&#x5F20;&#x8868;&#x683C;&#xFF0C;&#x8868;&#x683C;&#x91CC;&#x7684;&#x6BCF;&#x4E00;&#x9879;&#x5BF9;&#x5E94;owner&#x7EBF;&#x7A0B;&#x5360;&#x6709;&#x7684;&#x9501;&#xFF0C;&#x6BCF;&#x4E00;&#x9879;&#x662F;&#x4E00;&#x4E2A;rt_mutex_waiter&#xFF0C;&#x8868;&#x793A;&#x7533;&#x8BF7;&#x8BE5;&#x9501;&#x7684;&#x6700;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;waiter &#x5047;&#x8BBE;Task1&#x5C31;&#x662F;owner&#xFF0C;Task0&#x5BF9;Lock0&#x7684;&#x7533;&#x8BF7;&#x5BFC;&#x81F4;Task1&#x63D0;&#x5347;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5982;&#x679C;Task1&#x540C;&#x65F6;&#x88AB;Task2&#x6301;&#x6709;&#x7684;&#x67D0;&#x4E2A;&#x9501;&#x963B;&#x585E;&#xFF0C;&#x5219;Task1&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;Task2 pi_waiters&#x5217;&#x8868;&#x6539;&#x53D8;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;Task2&#x4F18;&#x5148;&#x7EA7;&#x6539;&#x53D8;&#x3002;&#x4F9D;&#x6B64;&#x7C7B;&#x63A8;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x79CD;&#x94FE;&#x5F0F;&#x53CD;&#x5E94;&#x3002; &#x94FE;&#x5904;&#x7406;&#x6D41;&#x7A0B; &#x6574;&#x4E2A;chain&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x5927;&#x81F4;&#x5982;&#x4E0B;&#xFF1A; &#x5982;&#x679C;Task0&#x662F;Lock0&#x7684;top waiter&#xFF0C;&#x5219;&#x6FC0;&#x53D1;&#x8BE5;&#x94FE;&#x5F0F;&#x8C03;&#x6574;&#x3002; &#x56E0;&#x4E3A;Task0&#x6210;&#x4E3A;Lock0&#x7684;topwaiter&#xFF0C;&#x5219;Task1&#x7684;pi_waiters&#x9700;&#x8981;&#x8C03;&#x6574;&#xFF0C;&#x5219;Task1&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8C03;&#x6574;&#x3002;&#x9000;&#x51FA;&#x53EF;&#x80FD;&#xFF1A; &#x8D77;&#x70B9;&#x9501;&#x91CA;&#x653E;&#x4E86; &#x94FE;&#x7684;&#x5F53;&#x524D;&#x73AF;&#x8282;&#x88AB;&#x66F4;&#x6539;( next_lock &#x2260;waiter-&gt;lock) Task1&#x6CA1;&#x6709;&#x5360;&#x9501; &#x5982;&#x679C;Task1&#x4E5F;wait&#x5728;&#x67D0;&#x4E2A;lock&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x8BE5;lock&#x7684;waiters&#x9700;&#x8981;&#x8C03;&#x6574;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x82E5;&#x5E72;&#x79CD;&#x9000;&#x51FA;&#x53EF;&#x80FD;&#x3002; Task1&#x6CA1;&#x6709;&#x88AB;block Task1 pi_waiters&#x4E2D;&#x6709;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#x4E8E;Task0&#x7684;waiter&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;lock0&#x7684;top_waiter&#x4E0D;&#x662F;Task1&#x7684;top pi_waiter&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x7EE7;&#x627F;&#x4E0D;&#x9700;&#x8981;&#x7EE7;&#x7EED;&#x4F20;&#x9012; &#x5982;&#x679C;Task1&#x5728;&#x7533;&#x8BF7;Lock1 &#x7684;&#x65F6;&#x5019;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF08;&#x8FD9;&#x4E2A;&#x8BB0;&#x5F55;&#x5728;waiter-&gt;prio&#x91CC;&#xFF09;&#x4E0E;&#x5F53;&#x524D;&#x8C03;&#x6574;&#x540E;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x76F8;&#x7B49;&#xFF0C;&#x5219;&#x540E;&#x7EED;&#x6CA1;&#x5FC5;&#x8981;&#x5728;&#x7EE7;&#x7EED;&#x8C03;&#x6574;&#x4F18;&#x5148;&#x7EA7; &#x68C0;&#x6D4B;&#x5230;DEADLOCK &#x56DE;&#x5230;1&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;&#x76F4;&#x5230;&#x9000;&#x51FA;&#x94FE;&#x5F0F;&#x5904;&#x7406; &#x6B7B;&#x9501; &#x6709;3&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x51FD;&#x6570;&#x4F1A;&#x8FD4;&#x56DE;&#x6B7B;&#x9501; &#x94FE;&#x4E0A;&#x8D85;&#x8FC7;1024&#x4E2A;&#x9501;&#x8282;&#x70B9; &#x94FE;&#x4E0A;&#x4EFB;&#x610F;Task&#x8282;&#x70B9;&#x7533;&#x8BF7;&#x7B2C;&#x4E00;&#x4E2A;&#x9501;&#x8282;&#x70B9;&#xFF0C;&#x5373;Lock0 &#x94FE;&#x4E0A;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x9501;owner&#x662F;&#x7B2C;&#x4E00;&#x4E2A;Task&#x8282;&#x70B9;&#xFF0C;&#x5373;Task0 &#x53C2;&#x8003;&#x6587;&#x732E; [1] [Mutex mutandis: understanding mutex types and attributes]. (http://2net.co.uk/tutorial/mutex_mutandis) [2] POSIX Revision of IEEE Std 1003.1-2008 [3] Source code analysis of pthread_mutex_lock [4] linux pi_futex&#x6D45;&#x6790; [5] Linux 4.20-rc3 source code [6] glibc 2.28 source code %23%23%20%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%0A%0A%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E6%8C%87%E4%B8%80%E4%B8%AA%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E5%9B%A0%E4%B8%BA%E8%B5%84%E6%BA%90%E8%A2%AB%E4%BD%8E%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E5%8D%A0%E7%94%A8%EF%BC%8C%E8%80%8C%E4%B8%8D%E5%BE%97%E4%B8%8D%E7%AD%89%E5%BE%85%E3%80%82%E8%BF%99%E4%B8%AA%E9%80%BB%E8%BE%91%E6%9C%AC%E8%BA%AB%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E3%80%82%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E5%B8%A6%E6%9D%A5%E6%9C%80%E7%9B%B4%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98%E5%B0%B1%E6%98%AF%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%AF%E8%83%BD%E5%9B%A0%E4%B8%BA%E8%BF%99%E6%AC%A1%E9%98%BB%E5%A1%9E%EF%BC%8C%E8%80%8C%E6%97%A0%E6%B3%95%E7%A1%AE%E5%AE%9A%E9%98%BB%E5%A1%9E%E6%97%B6%E5%BB%B6%E3%80%82%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82%0A!%5B8df099f053cbeaee4881a9d6ffc8963f.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5789)%0A%0ATask%209%E4%BC%98%E5%85%88%E7%BA%A7%E8%BE%83%E4%BD%8E%EF%BC%8C%E6%89%80%E4%BB%A5%E5%BE%88%E5%AE%B9%E6%98%93%E8%A2%AB%E5%85%B6%E4%BB%96%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%8A%A2%E5%8D%A0%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%AF%B9%E8%B5%84%E6%BA%90S%E7%9A%84%E9%94%81%E6%97%A0%E6%B3%95%E9%87%8A%E6%94%BE%EF%BC%8C%E8%80%8C%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%9B%A0%E4%B8%BA%E8%A6%81%E6%8C%81%E6%9C%89%E8%AF%A5%E9%94%81%EF%BC%8C%E4%B8%8D%E5%BE%97%E4%B8%8D%E7%AD%89%E5%BE%85%E3%80%82%0A%0A%23%23%20%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%0A%0APriority%20Inheritance%20Protocol%E7%BF%BB%E8%AF%91%E4%B8%BA%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%EF%BC%8C%E7%AE%80%E7%A7%B0PIP%E3%80%82%E8%BF%99%E6%98%AF%E8%A7%A3%E5%86%B3%E4%B8%8A%E8%BF%B0Unbounded%20inversion%E6%9C%80%E7%9B%B4%E6%8E%A5%E7%9A%84%E5%8A%9E%E6%B3%95%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%B0%86%E5%8D%A0%E6%9C%89%E9%94%81%E7%9A%84%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E6%95%B4%E5%88%B0%E5%9C%A8%E7%AD%89%E5%BE%85%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%9C%80%E9%AB%98%E5%80%BC%E3%80%82%E8%BF%99%E4%B8%AA%E7%AE%97%E6%B3%95%E6%98%AF%E8%B4%AA%E5%A9%AA%E7%9A%84%EF%BC%8C%E5%B1%80%E9%83%A8%E6%9C%80%E4%BC%98%EF%BC%8C%E4%BD%86%E4%B8%8D%E6%98%AF%E6%95%B4%E4%BD%93%E6%9C%80%E4%BC%98%E8%A7%A3%EF%BC%8C%E5%9C%A8%E6%AD%A4%E4%B9%8B%E4%B8%8A%E5%8F%88%E6%9C%89PCP(%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF)%E5%92%8CSRP(%E5%9F%BA%E4%BA%8E%E6%A0%88%E7%9A%84%E8%B5%84%E6%BA%90%E7%AD%96%E7%95%A5)%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%8D%E5%81%9A%E8%AE%A8%E8%AE%BA%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E4%BB%8E%E6%BA%90%E7%A0%81%E7%9A%84%E8%A7%92%E5%BA%A6%EF%BC%8C%E9%98%90%E8%BF%B0PIP%E5%9C%A8Linux%E5%92%8Cglibc%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%23%23%20Overview%0A!%5Bb16f478e9d2cf9485b4b8bba9e81e3b0.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5790)%0A%0ALinux%E4%B8%8B%E7%9A%84PIP%E5%AE%9E%E7%8E%B0%E5%88%86%E6%88%90%E4%BB%A5%E4%B8%8A3%E4%B8%AA%E9%83%A8%E5%88%86%EF%BC%9A%0A%0A-%20glibc%E4%B8%AD%E7%9A%84pthread_mutex_lock%E6%8F%90%E4%BE%9B%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3%EF%BC%8C%E9%80%9A%E8%BF%87FUTEX_LOCK_PI%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E6%95%B4%0A-%20Linux%E7%9A%84futex%E9%83%A8%E5%88%86%E6%8F%90%E4%BE%9BFUTEX_LOCK_PI%E7%9A%84%E5%AE%9E%E7%8E%B0%0A-%20%E6%9C%80%E7%BB%88%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6%E9%80%9A%E8%BF%87rt_mutex%E6%9D%A5%E5%AE%9E%E7%8E%B0%0A%0A%23%23%20pthread_mutex%0A%0A%23%23%23%20Types%0A%0Apthread%20mutex%E6%98%AFPOSIX%20pthread%E5%BA%93%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E4%B8%80%E7%A7%8D%E9%94%81%E6%9C%BA%E5%88%B6%EF%BC%8C%E4%B8%8E%E4%BF%A1%E5%8F%B7%E9%87%8F%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%94%81%E5%8F%AA%E6%9C%89%E4%B8%A4%E7%A7%8D%E7%8A%B6%E6%80%81%EF%BC%9Alocked%E6%88%96unlocked%E3%80%82%E4%B8%8Ebinary%20semaphore%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%8Cmutex%E5%8F%AA%E8%83%BD%E8%A2%ABlock%E7%9A%84%E7%BA%BF%E7%A8%8Bunlock%EF%BC%8C%E5%8D%B3%E5%8F%AA%E8%83%BD%E8%A2%ABmutex%20owner%20unlock%E3%80%82%0A%0A%E7%9B%AE%E5%89%8D%5BPOSIX%E6%A0%87%E5%87%86(1003.1-2008)%5D(http%3A%2F%2Fpubs.opengroup.org%2Fonlinepubs%2F9699919799%2Ffunctions%2Fcontents.html)%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BA%864%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84mutex%3A%0A%0A-%20PTHREAD_MUTEX_NORMAL%0A-%20PTHREAD_MUTEX_ERRORCHECK%0A-%20PTHREAD_MUTEX_RECURSIVE%0A-%20PTHREAD_MUTEX_DEFAULT%0A%0A%E8%BF%994%E7%A7%8Dmutex%E4%B8%8D%E5%90%8C%E4%B9%8B%E5%A4%84%E5%A6%82%E4%B8%8B%0A%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%20attempting%20to%20relock%20this%20mutex%20without%20first%20unlocking%20%7C%20Attempting%20to%20unlock%20a%20mutex%20locked%20by%20a%20different%20thread%20%7C%0A%7C%20----------%20%7C%20-------------------------------------------------------%20%7C%20---------------------------------------------------------%20%7C%0A%7C%20NORMAL%20%20%20%20%20%7C%20deadlock%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20ERRORCHECK%20%7C%20return%20error%20-EDEADLOCK%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20return%20error%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20RECURSIVE%20%20%7C%20succeed%20in%20locking%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20return%20error%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20DEFAULT%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%0Aglibc%E5%AF%B9%E4%B8%8A%E8%BF%B04%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84mutex%E8%BF%9B%E8%A1%8C%E4%BA%86%E6%89%A9%E5%B1%95%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9A%0A%0A%60%60%60c%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_RECURSIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ERRORCHECK_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_NORMAL_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ADAPTIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_RECURSIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_ERRORCHECK_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_NORMAL_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_ADAPTIVE_NP%3A%0A%60%60%60%0A%0A%E4%B8%BB%E8%A6%81%E5%A4%9A%E4%BA%86%E8%BF%993%E7%A7%8D%E5%B1%9E%E6%80%A7%EF%BC%9A%0A%0A-%20ADAPTIVE%EF%BC%9A%E5%9C%A8SMP%E6%9E%B6%E6%9E%84%E4%B8%8B%EF%BC%8C%E5%B9%B6%E4%B8%8D%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5wait%EF%BC%8C%E8%80%8C%E6%98%AF%E5%85%88%E8%B0%83%E7%94%A8spinlock%E7%AD%89%E5%BE%85%E4%B8%80%E5%B0%8F%E6%AE%B5%E6%97%B6%E9%97%B4%E3%80%82musl%E9%87%8C%E9%BB%98%E8%AE%A4%E9%83%BD%E9%87%87%E7%94%A8%E4%BA%86%E8%BF%99%E7%A7%8D%E5%AE%9E%E7%8E%B0%0A%0A-%20PI%EF%BC%9A%E5%8C%85%E5%90%AB%E8%AF%A5%E5%B1%9E%E6%80%A7%E7%9A%84mutex%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BA%86%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF(Priority%20Inheritance%2C%20PI)%0A%0A-%20ROBUST%EF%BC%9A%E8%8B%A5%E7%BA%BF%E7%A8%8B%E9%80%80%E5%87%BA%E6%97%B6%E6%9C%AA%E9%87%8A%E6%94%BE%E9%94%81%EF%BC%8C%E5%88%99%E4%BB%A5%E5%90%8E%E5%AF%B9%E8%AF%A5%E9%94%81%E6%93%8D%E4%BD%9C%E9%83%BD%E4%BC%9A%E8%BF%94%E5%9B%9E-EOWNERDEAD%EF%BC%8C%E4%B8%8E%E4%B9%8B%E5%AF%B9%E5%BA%94%E7%9A%84%E6%98%AFPTHREAD_MUTEX_STALLED(%E8%BF%99%E6%98%AF%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE)%EF%BC%8C%E5%AF%B9%E8%AF%A5%E5%BC%82%E5%B8%B8%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BC%9A%E5%87%BA%E7%8E%B0undefined%E8%A1%8C%E4%B8%BA%E3%80%82%0A%0A%E5%86%8D%E4%B8%8E%E5%8E%9F%E5%85%88%E7%9A%844%E7%A7%8D%E5%B1%9E%E6%80%A7%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E3%80%82%0A%0A%3E%20**%22_NP%22%20suffix**%0A%3E%0A%3E%20Note%3A%20the%20_NP%20suffix%20indicates%20a%20non-portable%20extension%20to%20the%20POSIX%20specification.%20In%20fact%20the%20latest%20specification%2C%201003.1-2008%20%5B%5B2%5C%5D%5D(http%3A%2F%2F2net.co.uk%2Ftutorial%2Fmutex_mutandis%23ref_2)%2C%20includes%20most%20of%20the%20Linux%20additions%20so%20you%20can%20leave%20the%20_NP%20ending%20off.%20I%20have%20chosen%20not%20to%20because%20some%20older%20versions%20of%20the%20header%20files%20only%20have%20the%20_NP%20variants.%0A%3E%0A%3E%20%E6%A0%B9%E6%8D%AE%E6%9C%80%E6%96%B0%E7%9A%84POSIX%E6%A0%87%E5%87%861003.1-2008%EF%BC%8C%E8%BF%99%E4%BA%9B%E6%89%A9%E5%B1%95%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%8A%A0%E5%85%A5%E3%80%82%0A%0A%E6%9C%AC%E6%96%87%E5%8F%AA%E5%85%B3%E6%B3%A8MUTEX_PI%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%23%23%23%20PTHREAD_MUTEX_PI%0A%0A%23%23%23%23%20pthread_mutex_lock%0A%0A%E9%87%8D%E8%A6%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A%60%60%60C%0Atypedef%20union%0A%7B%0A%20%20struct%20__pthread_mutex_s%20__data%3B%0A%20%20char%20__size%5B__SIZEOF_PTHREAD_MUTEX_T%5D%3B%0A%20%20long%20int%20__align%3B%0A%7D%20pthread_mutex_t%3B%0Astruct%20__pthread_mutex_s%0A%7B%0A%20%20int%20__lock%20__LOCK_ALIGNMENT%3B%0A%20%20unsigned%20int%20__count%3B%0A%20%20int%20__owner%3B%0A%20%20...%0A%7D%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%80%83%E8%99%91ROBUST%E6%83%85%E5%86%B5%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%8C%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E5%AE%9E%E7%8E%B0%E4%BA%86PI%E5%B1%9E%E6%80%A7%E7%9A%84pthread_mutex_lock%E6%93%8D%E4%BD%9C%E5%A6%82%E4%B8%8B%EF%BC%9A%0A!%5B36c67b688ae44843223a576d9cc0be30.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5791)%0A%0A%0A%3E%20**atomic_compare_and_exchange_val_acq**%0A%3E%0A%3E%20%E8%BF%99%E6%98%AF%E4%B8%80%E7%A7%8D%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%85%88%E6%AF%94%E8%BE%83%E5%86%8D%E8%B5%8B%E5%80%BC%EF%BC%8C%E4%BC%AA%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%3E%0A%3E%20%60%60%60C%0A%3E%20int%20compare_and_swap(int*%20reg%2C%20int%20oldval%2C%20int%20newval)%0A%3E%20%7B%0A%3E%20%20%20%20%20ATOMIC()%3B%0A%3E%20%20%20%20%20int%20old_reg_val%20%3D%20*reg%3B%0A%3E%20%20%20%20%20if%20(old_reg_val%20%3D%3D%20oldval)%0A%3E%20%20%20%20%20%20%20*reg%20%3D%20newval%3B%0A%3E%20%20%20%20%20END_ATOMIC()%3B%0A%3E%20%20%20%20%20return%20old_reg_val%3B%0A%3E%20%7D%0A%3E%20%60%60%60%0A%3E%0A%3E%20%E9%92%88%E5%AF%B9%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E6%83%85%E5%86%B5%EF%BC%9A%0A%3E%0A%3E%20-%20%60oldval%20%3D%3D%200%60%3A%20%E8%A1%A8%E7%A4%BA%60mutex-%3E__data.__lock%20%3D%3D%200%60%EF%BC%8C%E5%8D%B3%E8%AF%A5lock%E6%97%A0owner%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%BE%97%E3%80%82%0A%3E%20-%20%60oldval%20!%3D%200%60%3A%20%E8%A1%A8%E7%A4%BA%E8%AF%A5mutex%E8%A2%ABlock%E4%BA%86%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%BF%9B%E5%85%A5kernel%E6%9D%A5%E5%A4%84%E7%90%86%E9%94%81%E7%9A%84%E6%83%85%E5%86%B5%E3%80%82%0A%0Apthread_mutex_lock%E7%9A%84%E9%80%BB%E8%BE%91%E6%AF%94%E8%BE%83%E7%AE%80%E5%8D%95%EF%BC%8C%E5%B0%B1%E6%98%AF%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%88%A4%E6%96%AD%E9%94%81%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E8%A2%AB%E9%94%81%E4%BD%8F%E3%80%82%E5%A6%82%E6%9E%9C%E6%B2%A1%E9%94%81%E4%BD%8F%E5%B0%B1%E6%9B%B4%E6%96%B0owner%EF%BC%8C%E4%BB%A5%E5%8F%8Auser%E8%AE%A1%E6%95%B0%E3%80%82%E5%A6%82%E6%9E%9C%E5%B7%B2%E7%BB%8F%E8%A2%AB%E9%94%81%E4%BD%8F%EF%BC%8C%E5%88%99%E9%99%B7%E5%85%A5%E5%86%85%E6%A0%B8%E8%B0%83%E7%94%A8FUTEX_LOCK_PI%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AE%8C%E6%88%90%E4%B8%8A%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82%0A%0A%23%23%23%23%20pthread_mutex_unlock%0A%0A%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%E5%9F%BA%E6%9C%AC%E4%B8%8A%E5%B0%B1%E6%98%AF%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8futex_unlock_pi%20SYSCALL%E6%9D%A5%E5%AE%8C%E6%88%90%E5%B7%A5%E4%BD%9C%EF%BC%9A%0A%0A%60%60%60c%0A%20%20%20%20%20%20%2F*%20Unlock%20the%20mutex%20using%20a%20CAS%20unless%20there%20are%20futex%20waiters%20or%20our%0A%E2%80%BA%20%20%20%20TID%20is%20not%20the%20value%20of%20__lock%20anymore%2C%20in%20which%20case%20we%20let%20the%0A%E2%80%BA%20%20%20%20kernel%20take%20care%20of%20the%20situation.%20%20Use%20release%20MO%20in%20the%20CAS%20to%0A%E2%80%BA%20%20%20%20synchronize%20with%20acquire%20MO%20in%20lock%20acquisitions.%20%20*%2F%0A%20%20%20%20%20%20int%20l%20%3D%20atomic_load_relaxed%20(%26mutex-%3E__data.__lock)%3B%0A%20%20%20%20%20%20do%0A%E2%80%BA%20%20%20%7B%0A%E2%80%BA%20%20%20%20%20if%20(((l%20%26%20FUTEX_WAITERS)%20!%3D%200)%0A%E2%80%BA%20%20%20%20%20%20%20%20%20%7C%7C%20(l%20!%3D%20THREAD_GETMEM%20(THREAD_SELF%2C%20tid)))%0A%E2%80%BA%20%20%20%20%20%20%20%7B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20INTERNAL_SYSCALL_DECL%20(__err)%3B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20INTERNAL_SYSCALL%20(futex%2C%20__err%2C%202%2C%20%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20__lll_private_flag%20(FUTEX_UNLOCK_PI%2C%20private))%3B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20break%3B%0A%E2%80%BA%20%20%20%20%20%20%20%7D%0A%E2%80%BA%20%20%20%7D%0A%20%20%20%20%20%20while%20(!atomic_compare_exchange_weak_release%20(%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%26l%2C%200))%3B%0A%60%60%60%0A%0A%0A%0A%23%23%20futex%0A%0Afutex%E6%98%AF%E4%B8%80%E7%A7%8D%E5%86%85%E6%A0%B8%E7%9A%84%E7%AD%89%E5%BE%85%E6%9C%BA%E5%88%B6%EF%BC%8C%E7%AD%89%E5%BE%85%E6%9F%90%E4%B8%AA%E7%94%A8%E6%88%B7%E6%80%81%E6%95%B0%E6%8D%AE%E8%A2%AB%E8%AE%BE%E7%BD%AE%E6%88%90%E6%9F%90%E4%B8%AA%E5%80%BC%E3%80%82%E9%92%88%E5%AF%B9%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84futex%E7%95%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E3%80%82%E5%AE%83%E4%B8%8D%E5%86%8D%E7%AD%89%E5%BE%85%E7%94%A8%E6%88%B7%E4%BC%A0%E5%85%A5%E7%9A%84%E5%9C%B0%E5%9D%80%E4%B8%8A%E7%9A%84%E5%80%BC%EF%BC%8C%E8%80%8C%E6%98%AF%E5%9F%BA%E4%BA%8E%E5%86%85%E6%A0%B8rt_mutex%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E7%AD%89%E5%BE%85%EF%BC%8C%E4%B8%8A%E9%94%81%E5%92%8C%E8%A7%A3%E9%94%81%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%E7%9C%8B%E4%B8%8B%E9%9D%A2glibc%E5%92%8CLinux%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%AF%B9%E6%8E%A5%EF%BC%9A%0A%0A%60%60%60c%0A%2F%2F%20glibc%3A%20pthread_mutex_lock.c%0Aint%20e%20%3D%20INTERNAL_SYSCALL%20(futex%2C%20__err%2C%204%2C%20%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%20%20__lll_private_flag%20(FUTEX_LOCK_PI%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20private)%2C%201%2C%200)%3B%0A%0A%2F%2F%20Linux%3A%20futex.c%0Along%20do_futex(u32%20__user%20*uaddr%2C%20int%20op%2C%20u32%20val%2C%20ktime_t%20*timeout%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20u32%20__user%20*uaddr2%2C%20u32%20val2%2C%20u32%20val3)%0A%7B%0A...%0A%09case%20FUTEX_LOCK_PI%3A%0A%E2%80%BA%20%20%20%09return%20futex_lock_pi(uaddr%2C%20flags%2C%20NULL%2C%201)%3B%20%20%20%20%0A...%20%0A%7D%0A%60%60%60%0A%0A%E5%8F%AF%E8%A7%81%EF%BC%9A%0A%0A-%20%60uaddr%20%3D%20%26mutex-%3E__data.__lock%60%0A-%20%60flags%20%3D%20__lll_private_flag%20(FUTEX_LOCK_PI%2C%20private)%60%0A-%20%60val%20%3D%201%2C%20timeout%20%3D%20NULL%60%0A%0A%3E%20%E5%85%B3%E4%BA%8Elock%2Funlock%E7%9A%84%E5%8F%99%E8%BF%B0%E4%BC%9A%E7%AE%80%E5%8C%96%E6%8E%89time%E7%9B%B8%E5%85%B3%E9%83%A8%E5%88%86%EF%BC%8C%E4%BB%A5%E5%8F%8API%E6%97%A0%E5%85%B3%E7%9A%84ROBUST%E7%AD%89%E7%89%B9%E6%80%A7%E3%80%82%0A%0A%23%23%23%20%E9%87%8D%E8%A6%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%0A%0A%60%60%60c%0A%2F*%0A%20*%20Hash%20buckets%20are%20shared%20by%20all%20the%20futex_keys%20that%20hash%20to%20the%20same%0A%20*%20location.%20%20Each%20key%20may%20have%20multiple%20futex_q%20structures%2C%20one%20for%20each%20task%0A%20*%20waiting%20on%20a%20futex.%0A%20*%2F%0Astruct%20futex_hash_bucket%20%7B%0A%E2%80%BA%20%20%20atomic_t%20waiters%3B%0A%E2%80%BA%20%20%20spinlock_t%20lock%3B%0A%E2%80%BA%20%20%20struct%20plist_head%20chain%3B%0A%7D%20____cacheline_aligned_in_smp%3B%0A%0A%2F**%0A%20*%20struct%20futex_q%20-%20The%20hashed%20futex%20queue%20entry%2C%20one%20per%20waiting%20task%0A%20*%20%40list%3A%E2%80%BA%20%20%E2%80%BA%20%20%20priority-sorted%20list%20of%20tasks%20waiting%20on%20this%20futex%0A%20*%20%40task%3A%E2%80%BA%20%20%E2%80%BA%20%20%20the%20task%20waiting%20on%20the%20futex%0A%20*%20%40lock_ptr%3A%E2%80%BA%20%20%E2%80%BA%20%20%20the%20hash%20bucket%20lock%0A%20*%20%40key%3A%E2%80%BA%20%20%20%E2%80%BA%20%20%20the%20key%20the%20futex%20is%20hashed%20on%0A%20*%20%40pi_state%3A%E2%80%BA%20%20%E2%80%BA%20%20%20optional%20priority%20inheritance%20state%0A%20*%20%40rt_waiter%3A%E2%80%BA%20%E2%80%BA%20%20%20rt_waiter%20storage%20for%20use%20with%20requeue_pi%0A%20*%20%40requeue_pi_key%3A%E2%80%BAthe%20requeue_pi%20target%20futex%20key%0A%20*%20%40bitset%3A%E2%80%BA%E2%80%BA%20%20%20bitset%20for%20the%20optional%20bitmasked%20wakeup%0A%20*%0A%20*%20We%20use%20this%20hashed%20waitqueue%2C%20instead%20of%20a%20normal%20wait_queue_entry_t%2C%20so%0A%20*%20we%20can%20wake%20only%20the%20relevant%20ones%20(hashed%20queues%20may%20be%20shared).%0A%20*%0A%20*%20A%20futex_q%20has%20a%20woken%20state%2C%20just%20like%20tasks%20have%20TASK_RUNNING.%0A%20*%20It%20is%20considered%20woken%20when%20plist_node_empty(%26q-%3Elist)%20%7C%7C%20q-%3Elock_ptr%20%3D%3D%200.%0A%20*%20The%20order%20of%20wakeup%20is%20always%20to%20make%20the%20first%20condition%20true%2C%20then%0A%20*%20the%20second.%0A%20*%0A%20*%20PI%20futexes%20are%20typically%20woken%20before%20they%20are%20removed%20from%20the%20hash%20list%20via%0A%20*%20the%20rt_mutex%20code.%20See%20unqueue_me_pi().%0A%20*%2F%0Astruct%20futex_q%20%7B%0A%E2%80%BA%20%20%20struct%20plist_node%20list%3B%0A%0A%E2%80%BA%20%20%20struct%20task_struct%20*task%3B%0A%E2%80%BA%20%20%20spinlock_t%20*lock_ptr%3B%0A%E2%80%BA%20%20%20union%20futex_key%20key%3B%0A%E2%80%BA%20%20%20struct%20futex_pi_state%20*pi_state%3B%0A%E2%80%BA%20%20%20struct%20rt_mutex_waiter%20*rt_waiter%3B%0A%E2%80%BA%20%20%20union%20futex_key%20*requeue_pi_key%3B%0A%E2%80%BA%20%20%20u32%20bitset%3B%0A%7D%20__randomize_layout%3B%0A%0A%2F*%0A%20*%20Priority%20Inheritance%20state%3A%0A%20*%2F%0Astruct%20futex_pi_state%20%7B%0A%E2%80%BA%20%20%20%2F*%0A%E2%80%BA%20%20%20%20*%20list%20of%20&apos;owned&apos;%20pi_state%20instances%20-%20these%20have%20to%20be%0A%E2%80%BA%20%20%20%20*%20cleaned%20up%20in%20do_exit()%20if%20the%20task%20exits%20prematurely%3A%0A%E2%80%BA%20%20%20%20*%2F%0A%E2%80%BA%20%20%20struct%20list_head%20list%3B%0A%0A%E2%80%BA%20%20%20%2F*%0A%E2%80%BA%20%20%20%20*%20The%20PI%20object%3A%0A%E2%80%BA%20%20%20%20*%2F%0A%E2%80%BA%20%20%20struct%20rt_mutex%20pi_mutex%3B%0A%0A%E2%80%BA%20%20%20struct%20task_struct%20*owner%3B%0A%E2%80%BA%20%20%20atomic_t%20refcount%3B%0A%0A%E2%80%BA%20%20%20union%20futex_key%20key%3B%0A%7D%20__randomize_layout%3B%0A%60%60%60%0A%0A%60futex_hash_bucket%60%E5%AF%B9%E5%BA%94%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E6%80%81%E7%9A%84%60uaddr%60%E3%80%82%E9%80%9A%E8%BF%87%E7%94%A8%E6%88%B7%E6%80%81%E4%BC%A0%E5%85%A5%E7%9A%84uaddr%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%9D%A5%E8%8E%B7%E5%BE%97%E5%AF%B9%E5%BA%94%E7%9A%84futex%E7%BB%93%E6%9E%84%E4%BD%93%E3%80%82%E7%94%A8hash%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%98%AF%E4%BC%A0%E5%85%A5%E7%9A%84%E6%98%AFuaddr%E5%9C%B0%E5%9D%80%E5%80%BC%EF%BC%8C%E6%95%B0%E5%AD%97%E5%BE%88%E5%A4%A7%EF%BC%8C%E5%88%86%E5%B8%83%E5%BE%88%E6%95%A3%EF%BC%8C%E6%89%80%E4%BB%A5%E7%94%A8hash%E5%8F%AF%E4%BB%A5%E6%9C%89%E6%95%88%E7%B4%A2%E5%BC%95%E3%80%82%0A%0A%60futex_q%20%60%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F%EF%BC%8C%E5%AF%B9%E5%BA%94%E4%BA%86%E4%B8%80%E4%B8%AAfutex%E7%9A%84waiter%E7%BA%BF%E7%A8%8B%E3%80%82%E5%AE%83%E9%80%9A%E5%B8%B8%E8%A2%AB%E7%94%A8%E6%9D%A5%E4%BC%A0%E9%80%92%E5%90%84%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%82%0A%0A%60pi_state%60%E6%98%AF%60task_struct%60%E5%86%85%E9%83%A8%E7%9A%84%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%EF%BC%8C%E5%9C%A8%60futex_lock_pi%60%E8%B0%83%E7%94%A8%60refill_pi_state_cache%60%E9%87%8C%E9%9D%A2%E5%81%9A%E5%88%86%E9%85%8D%E3%80%82%0A%0A%0A%60%60%60c%0Astatic%20int%20refill_pi_state_cache(void)%0A%7B%0A...%0A%09pi_state%20%3D%20kzalloc(sizeof(*pi_state)%2C%20GFP_KERNEL)%3B%0A%20%20%20%20current-%3Epi_state_cache%20%3D%20pi_state%3B%0A...%0A%7D%0A%60%60%60%0A%23%23%23%20futex_lock_pi%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E7%9A%84%E9%80%BB%E8%BE%91%E8%BF%98%E6%98%AF%E6%AF%94%E8%BE%83%E7%9B%B4%E7%BA%BF%E7%9A%84%EF%BC%8C%E5%90%8C%E5%A4%A7%E5%A4%9A%E6%95%B0%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%85%88%E5%B0%9D%E8%AF%95%E5%8E%9F%E5%AD%90%E9%94%81%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%A1%8C%EF%BC%8C%E5%88%99%E8%B0%83%E7%94%A8rt_mutex%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%9D%A5%E5%A4%84%E7%90%86%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E6%9C%BA%E5%88%B6%E3%80%82%E4%BB%A5%E4%B8%8B%E6%8D%A1%E5%8F%96%E6%AF%94%E8%BE%83%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%BD%E6%95%B0%E5%81%9A%E9%98%90%E8%BF%B0%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%5C%5B3%5D%2C%20%5C%5B4%5D%E4%B8%AD%E7%9A%84%E6%8F%8F%E8%BF%B0%E3%80%82%0A%0A%23%23%23%23%20queue_lock%2C%20queue_unlock%0A%0A%E5%AF%B9hash_bucket%E8%BF%9B%E8%A1%8C%E9%94%81%E6%93%8D%E4%BD%9C%E3%80%82%E4%BB%96%E4%BB%AC%E6%93%8D%E4%BD%9C%E7%9A%84%E6%98%AF%60hash_bucket%60%E4%B8%8B%E7%9A%84%60lock%60%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E6%98%AF%60futex_q%60%E4%B8%8B%E7%9A%84%60lock_ptr%60%E3%80%82%E8%BF%99%E9%87%8C%E9%94%81%E7%9A%84%E5%87%BA%E7%8E%B0%E6%AF%94%E8%BE%83%E6%B7%B7%E4%B9%B1%EF%BC%8C%E6%9C%89%E6%97%B6%E8%B0%83%E7%94%A8%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%87%BD%E6%95%B0%EF%BC%8C%E6%9C%89%E6%97%B6%E7%9B%B4%E6%8E%A5%E5%AF%B9lock%E6%8C%87%E9%92%88%E6%93%8D%E4%BD%9C%E3%80%82%E9%9C%80%E8%A6%81%E5%B0%8F%E5%BF%83%E3%80%82%0A%0A%23%23%23%23%20__queue_me%2C%20unqueue_me%0A%0A%E8%BF%99%E9%87%8C%E5%B0%86%E7%94%B3%E8%AF%B7futex%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%9C%A8hash_bucket%E7%9A%84chain%E4%B8%8A%E5%81%9A%E6%B7%BB%E5%8A%A0%E6%88%96%E7%A7%BB%E9%99%A4%E6%93%8D%E4%BD%9C%E3%80%82%E8%BF%98%E4%BC%9A%E6%B6%89%E5%8F%8A%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82%0A%0A%E4%BB%A5%E4%B8%8A4%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9B%B4%E5%A4%9A%E7%9A%84%E4%B8%8Efutex%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9B%B8%E5%85%B3%EF%BC%8C%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E5%B9%B6%E6%97%A0%E5%85%B3%E7%B3%BB%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E7%95%A5%E8%BF%87%E3%80%82%0A%0A%23%23%23%23%20futex_lock_pi_atomic%0A!%5B8f64be7a14c9e36fb86aff8b54e61062.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5792)%0A%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E6%9D%A5%E8%AF%B7%E6%B1%82%E9%94%81%EF%BC%8C%0A%0A-%20%E5%A6%82%E6%9E%9Cfutex%E6%B2%A1%E6%9C%89waiter%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E8%8E%B7%E5%BE%97%E9%94%81%E5%B9%B6%E8%BF%94%E5%9B%9E1%EF%BC%8C%E8%A1%A8%E7%A4%BA%E6%88%90%E5%8A%9F%E8%8E%B7%E5%BE%97%E9%94%81%0A-%20%E5%A6%82%E6%9E%9C%E6%9C%89waiter%EF%BC%8C%E5%B0%B1%E8%BF%94%E5%9B%9E0%EF%BC%8C%E8%A1%A8%E7%A4%BAready%20to%20wait%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%E4%BC%9A%E5%81%9A%E4%B8%80%E4%BA%9B%E4%B8%8EPI%E7%9B%B8%E5%85%B3%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%9A%0A%0A-%20%E6%9C%89waiter%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9A%0A%20%20-%20%E8%B0%83%E7%94%A8attach_to_pi_state%E6%9D%A5%E8%8E%B7%E5%BE%97%E8%AF%A5top_waiter%E7%9A%84pi_state%0A-%20%E6%B2%A1%E6%9C%89waiter%E7%9A%84%E6%83%85%E5%86%B5%0A%20%20-%20%E8%B0%83%E7%94%A8attach_to_pi_owner%E6%9D%A5%E5%8F%96%E7%94%A8%E6%9C%AC%E7%BA%BF%E7%A8%8B%E9%87%8C%E5%88%86%E9%85%8D%E7%9A%84pi_state%E7%BB%93%E6%9E%84%E4%BD%93%EF%BC%8C%E5%B9%B6%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E3%80%82%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E8%A2%ABqueue%E5%88%B0hash_bucket%E7%9A%84%E9%98%9F%E5%88%97%E4%B8%AD%E3%80%82%0A%0A%23%23%23%23%20rt_mutex%E6%8E%A5%E5%8F%A3%0A%0Afutex_lock_pi%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%88%B0%E5%A6%82%E4%B8%8B%E8%BF%99%E4%BA%9Brt_mutex%E6%8E%A5%E5%8F%A3%EF%BC%9A%0A%0A-%20rt_mutex_init_waiter%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96waiter%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E5%85%B6%E5%AE%9E%E4%B8%BA%E4%B8%80%E4%B8%AA%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E8%8A%82%E7%82%B9%E3%80%82%E8%BF%99%E4%B8%AAwaiter%E5%AF%B9%E5%BA%94%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%EF%BC%8C%E5%B9%B6%E5%8F%8D%E6%98%A0%E7%BA%BF%E7%A8%8B%E5%9C%A8%E6%9F%90%E4%B8%AA%E9%94%81%E4%B8%8A%E7%9A%84%E7%AD%89%E5%BE%85%E5%85%B3%E7%B3%BB%E3%80%82%0A-%20__rt_mutex_start_proxy_lock%EF%BC%9A%E8%BF%99%E4%B8%AA%E6%98%AFPI%E7%9A%84%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%AF%B9%E5%90%84waiters%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%BB%A5%E5%8F%8A%E9%81%8D%E5%8E%86lock%E9%93%BE%E6%9D%A5%E6%A3%80%E6%9F%A5%E6%AD%BB%E9%94%81%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%8E%E4%B9%8B%E5%89%8D%E7%9A%84%E5%8E%9F%E5%AD%90%E6%A3%80%E6%9F%A5%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%94%E5%9B%9E1%E8%A1%A8%E7%A4%BA%E5%B7%B2%E7%BB%8F%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%94%E5%9B%9E0%EF%BC%8C%E5%88%99ready%20to%20wait%E3%80%82%0A-%20rt_mutex_wait_proxy_lock%EF%BC%9A%E9%80%9A%E8%BF%87__rt_mutex_start_proxy_lock%E5%A4%84%E7%90%86%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%98%E6%B2%A1%E6%9C%89%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E9%82%A3%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BC%80%E5%A7%8B%E7%AD%89%E5%BE%85%E4%BA%86%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%86%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E4%B8%BATASK_INTERRUPTIBLE%E7%8A%B6%E6%80%81%EF%BC%8C%E5%B9%B6%E5%BC%80%E5%A7%8B%E7%AD%89%E5%BE%85%E3%80%82%E8%BF%99%E5%85%B6%E9%97%B4%E4%BC%9A%E5%A4%84%E7%90%86%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E7%AD%89%E5%BE%85%EF%BC%8C%E4%B8%94%E4%BC%9A%E8%A7%A6%E5%8F%91%E8%B0%83%E5%BA%A6%E3%80%82%0A-%20rt_mutex_cleanup_proxy_lock%EF%BC%9A%E7%8E%B0%E5%9C%A8%E5%B7%B2%E7%BB%8F%E9%98%BB%E5%A1%9E%E7%BB%93%E6%9D%9F%E4%BA%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%98%E6%B2%A1%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E8%A6%81%E4%B9%88%E6%98%AF%E8%B6%85%E6%97%B6%EF%BC%8C%E8%A6%81%E4%B9%88%E6%98%AF%E5%87%BA%E9%94%99%EF%BC%8C%E6%80%BB%E4%B9%8B%E8%A6%81%E5%B0%86%E6%9C%AC%E7%BA%BF%E7%A8%8B%E4%BB%8Ewaiters%E4%B8%AD%E7%A7%BB%E9%99%A4%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%B1%E6%98%AF%E8%B5%B7%E8%BF%99%E4%B8%AA%E4%BD%9C%E7%94%A8%E3%80%82%0A%0A%23%23%23%23%20fixup_owner%0A%0A%E4%BB%8E%E6%B3%A8%E9%87%8A%E4%B8%8A%E7%9C%8B%EF%BC%8C%E6%98%AF%E4%B8%BA%E4%BA%86%E5%A4%84%E7%90%86lock%20steal%E3%80%82%E8%80%8Clock%20steal%E4%BC%BC%E4%B9%8E%E5%A4%9A%E5%8F%91%E7%94%9F%E5%9C%A8futex%20requeue%E6%93%8D%E4%BD%9C%E4%B8%8A%EF%BC%8C%E7%9B%AE%E5%89%8D%E5%B0%9A%E6%9C%AA%E4%BB%94%E7%BB%86%E7%A0%94%E7%A9%B6%E3%80%82%0A%0A%23%23%23%20futex_unlock_pi%0A%0Afutex_unlock_pi%E9%87%8A%E6%94%BEfutex%E4%BB%A5%E5%8F%8A%E6%9B%B4%E6%96%B0%E7%9B%B8%E5%BA%94%E7%9A%84pi_state%E5%92%8Crt_mutex%E7%9A%84owner%E5%AD%97%E6%AE%B5%E3%80%82%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%B1%82%E6%AC%A1%E6%AF%94%E8%BE%83%E6%B7%B1%EF%BC%8C%E5%9F%BA%E6%9C%AC%E4%B8%8A%E9%83%BD%E6%98%AF%E6%AF%8F%E4%B8%80%E5%B1%82%E5%81%9A%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%9B%B4%E6%96%B0%E5%B7%A5%E4%BD%9C%EF%BC%8C%E6%9C%80%E7%BB%88%E8%B0%83%E7%94%A8%E5%88%B0__rt_mutex_futex_unlock%E6%9D%A5%E9%87%8D%E6%96%B0%E8%B0%83%E6%95%B4%E6%9C%AC%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%B9%B6%E5%B0%86top%20waiter%E6%94%BE%E5%88%B0wake%20queue%E4%B8%8A%E3%80%82%E5%9C%A8rt_mutex_postunlock%E8%B0%83%E7%94%A8%E7%9A%84rt_mutex_postunlock%E5%B0%86%E6%96%B0%E7%BA%BF%E7%A8%8B%E5%94%A4%E9%86%92%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89waiter%EF%BC%8C%E5%88%99%E4%BD%BF%E7%94%A8%60cmpxchg_futex_value_locked%60%E6%9D%A5%E5%B0%86%E7%94%A8%E6%88%B7%E6%80%81%E5%9C%B0%E5%9D%80uaddr%E4%B8%8A%E7%9A%84%E5%80%BC%E8%AE%BE%E4%B8%BA0%E3%80%82%E5%9B%A0%E4%B8%BA%E9%94%81%E6%B2%A1%E6%9C%89waiter%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BC%98%E5%85%88%E7%BA%A7%E4%B9%9F%E4%B8%8D%E9%9C%80%E8%A6%81%E6%81%A2%E5%A4%8D%E4%BA%86%EF%BC%8C%E6%88%96%E8%80%85%E5%B7%B2%E7%BB%8F%E6%81%A2%E5%A4%8D%E8%BF%87%E4%BA%86%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%9C%89waiter%EF%BC%8C%E5%B0%B1%E4%BD%BF%E7%94%A8%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9D%A5%E5%88%87%E6%8D%A2lock%20owner%EF%BC%8C%E5%B9%B6%E6%81%A2%E5%A4%8D%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%0A%0A%23%23%23%23%20wake_futex_pi%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%81%9A%E4%BA%86%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%BB%B6%E4%BA%8B%EF%BC%9A%0A%0A1.%20%E7%94%A8cmpxchg_futex_value_locked%E5%B0%86%E7%94%A8%E6%88%B7%E6%80%81%E4%BC%A0%E5%85%A5%E7%9A%84uaddr%E5%A4%84%E7%9A%84%E6%95%B0%E5%80%BC%E6%9B%B4%E6%96%B0%E4%B8%BA%E6%96%B0%E7%9A%84%60rt_mutex_next_owner()%20%7C%20FUTEX_WAITERS%60%0A2.%20%60list_del_init(%26pi_state-%3Elist)%60%EF%BC%9A%E5%B0%86list%E4%BB%8E%E5%8E%9F%E5%85%88%E7%9A%84%E8%A1%A8%E4%B8%8A%E5%88%A0%E9%99%A4%EF%BC%8C%E5%B9%B6%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8C%E5%87%86%E5%A4%87%E7%A7%BB%E5%88%B0%E5%85%B6%E4%BB%96%E7%9A%84%E8%A1%A8%E4%B8%8A%E3%80%82%0A3.%20%60list_add(%26pi_state-%3Elist%2C%20%26new_owner-%3Epi_state_list)%60%0A4.%20%60pi_state-%3Eowner%20%3D%20new_owner%60%0A5.%20%60__rt_mutex_futex_unlock%60%0A6.%20%60rt_mutex_postunlock%60%0A%0A%23%23%23%23%20mark_wakeup_next_waiter%0A%0A%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%AD%A4%E6%97%B6pi_state-%3Eowner%E5%B7%B2%E7%BB%8F%E8%AE%BE%E7%BD%AE%E8%BF%87%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AFpi_state-%3Epi_mutex-%3Eowner%E8%BF%98%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AE%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%BB%E8%A6%81%E5%81%9A%E4%BA%86%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%BB%B6%E4%BA%8B%E6%83%85%EF%BC%9A%0A%0A1.%20%60rt_mutex_dequeue_pi(current%2C%20waiter)%3B%60%0A2.%20%60rt_mutex_adjust_prio(current)%60%3A%E5%9C%A8%E8%BF%99%E9%87%8C%E8%B0%83%E6%95%B4%E4%BA%86%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%AE%8C%E6%88%90%E4%BA%86%E6%95%B4%E4%B8%AA%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E5%8D%8F%E8%AE%AE%E3%80%82%0A3.%20%60wake_q_add(wake_q%2C%20waiter-%3Etask)%60%0A%0A%23%23%23%23%20put_pi_state%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%98%AF%E6%B8%85%E7%90%86%E5%B7%A5%E4%BD%9C%3A%0A%0A1.%20%E8%B0%83%E7%94%A8%E4%BA%86%60rt_mutex_proxy_unlock%60%E6%9D%A5%E9%87%8A%E6%94%BEpi_state-%3Epi_mutex.%0A2.%20%E9%87%8A%E6%94%BE%E4%BA%86current-%3Epi_state_cache%E7%A9%BA%E9%97%B4%0A%0A%3E**cmpxchg_futex_value_locked%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C**%0A%3E%0A%3E%60%60%60c%0A%3Estatic%20int%20cmpxchg_futex_value_locked(u32%20*uval%2C%20u32%20__user%20*uaddr%2C%0A%3E%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%20%20u32%20oldval%2C%20u32%20newval)%0A%3E%7B%0A%3EATOMIC()%3B%0A%3Eint%20val%20%3D%20*uaddr%3B%0A%3Eif%20(val%20%3D%3D%20oldval)%20%7B%0A%3E*uaddr%20%3D%20newval%3B%0A%3E%7D%0A%3E*uval%20%3D%20val%3B%0A%3EEND_ATOMIC()%3B%0A%3Ereturn%200%3B%0A%3E%7D%0A%3E%0A%3E%E5%85%B6%E4%B8%ADATOMIC%E6%93%8D%E4%BD%9C%E9%80%9A%E8%BF%87page_disable()%E5%92%8Cpreempt_disable()%E4%BF%9D%E8%AF%81%E3%80%82%0A%3E%60%60%60%0A%0A%23%23%20__rt_mutex_start_proxy_lock%0A%0A%E4%BB%8E%E4%B8%8A%E9%9D%A2futex_lock_pi%E7%94%A8%E5%88%B0%E7%9A%84rt_mutex%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D%E4%B8%AD%E5%8F%AF%E7%9F%A5%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%98%AF%E6%95%B4%E4%B8%AAPI%E5%A4%84%E7%90%86%E7%9A%84%E6%A0%B8%E5%BF%83%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%88%E4%B8%BB%E8%A6%81%E8%B0%83%E7%94%A8task_blocks_on_rt_mutex%E6%9D%A5%E5%A4%84%E7%90%86PI%E3%80%82%0A%0A!%5B692787b6adf4be8b04b3aa57c3612c37.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5793)%0A%0A%0A%23%23%23%23%20rt_mutex_adjust_prio(owner)%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%B1%E6%98%AF%E8%B0%83%E6%95%B4%E9%98%BB%E5%A1%9E%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E3%80%82%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E4%B9%9F%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%9A%0A%0A%60%60%60c%0Aif%20(task_has_pi_waiters(p))%0A%E2%80%BA%20%20%20pi_task%20%3D%20task_top_pi_waiter(p)-%3Etask%3B%0A%0Art_mutex_setprio(p%2C%20pi_task)%3B%0A%60%60%60%0A%0A%E6%8A%8Aowner%E7%BA%BF%E7%A8%8B%E8%AE%BE%E7%BD%AE%E4%B8%BAowner%E7%BA%BF%E7%A8%8B%E6%89%80%E6%9C%89waiter(%E5%8F%AF%E8%83%BD%E6%9D%A5%E8%87%AA%E5%A4%9A%E4%B8%AA%E9%94%81)%E7%9A%84%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%0A%0A%23%23%23%23%20rt_mutex_adjust_prio_chain%0A%0A%23%23%23%23%23%20%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E8%BF%99%E4%B8%AA%E9%93%BE%E5%BC%8F%E8%B0%83%E6%95%B4%EF%BC%9F%0A!%5Bc4badef8862a4db7fb98b88635d31ecb.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5794)%0A%0A%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%A4%E5%BC%A0%E8%A1%A8%E6%A0%BC%EF%BC%9A%0A%0A-%20%E6%AF%8F%E4%B8%AArt_mutex%E6%9C%89%E5%BC%A0waiters%E8%A1%A8%E6%A0%BC%EF%BC%8C%E8%A1%A8%E7%A4%BA%E6%89%80%E6%9C%89%E7%AD%89%E5%BE%85%E7%9A%84%E7%BA%BF%E7%A8%8B%0A%0A-%20%E6%AF%8F%E4%B8%AAtask%E4%B9%9F%E6%9C%89%E5%BC%A0%E8%A1%A8%E6%A0%BC%EF%BC%8C%E8%A1%A8%E6%A0%BC%E9%87%8C%E7%9A%84%E6%AF%8F%E4%B8%80%E9%A1%B9%E5%AF%B9%E5%BA%94owner%E7%BA%BF%E7%A8%8B%E5%8D%A0%E6%9C%89%E7%9A%84%E9%94%81%EF%BC%8C%E6%AF%8F%E4%B8%80%E9%A1%B9%E6%98%AF%E4%B8%80%E4%B8%AArt_mutex_waiter%EF%BC%8C%E8%A1%A8%E7%A4%BA%E7%94%B3%E8%AF%B7%E8%AF%A5%E9%94%81%E7%9A%84%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7waiter%0A%0A%E5%81%87%E8%AE%BETask1%E5%B0%B1%E6%98%AFowner%EF%BC%8CTask0%E5%AF%B9Lock0%E7%9A%84%E7%94%B3%E8%AF%B7%E5%AF%BC%E8%87%B4Task1%E6%8F%90%E5%8D%87%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%A6%82%E6%9E%9CTask1%E5%90%8C%E6%97%B6%E8%A2%ABTask2%E6%8C%81%E6%9C%89%E7%9A%84%E6%9F%90%E4%B8%AA%E9%94%81%E9%98%BB%E5%A1%9E%EF%BC%8C%E5%88%99Task1%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E6%94%B9%E5%8F%98%EF%BC%8C%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4Task2%20pi_waiters%E5%88%97%E8%A1%A8%E6%94%B9%E5%8F%98%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4Task2%E4%BC%98%E5%85%88%E7%BA%A7%E6%94%B9%E5%8F%98%E3%80%82%E4%BE%9D%E6%AD%A4%E7%B1%BB%E6%8E%A8%EF%BC%8C%E5%B0%B1%E4%BC%9A%E5%AF%BC%E8%87%B4%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%BF%99%E7%A7%8D%E9%93%BE%E5%BC%8F%E5%8F%8D%E5%BA%94%E3%80%82%0A%0A%0A%0A%23%23%23%23%23%20%E9%93%BE%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%0A%E6%95%B4%E4%B8%AAchain%E7%9A%84%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%A4%A7%E8%87%B4%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A1.%20%E5%A6%82%E6%9E%9CTask0%E6%98%AFLock0%E7%9A%84top%20waiter%EF%BC%8C%E5%88%99%E6%BF%80%E5%8F%91%E8%AF%A5%E9%93%BE%E5%BC%8F%E8%B0%83%E6%95%B4%E3%80%82%0A2.%20%E5%9B%A0%E4%B8%BATask0%E6%88%90%E4%B8%BALock0%E7%9A%84topwaiter%EF%BC%8C%E5%88%99Task1%E7%9A%84pi_waiters%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%EF%BC%8C%E5%88%99Task1%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%E3%80%82%E9%80%80%E5%87%BA%E5%8F%AF%E8%83%BD%EF%BC%9A%0A%20%20%20%20-%20%E8%B5%B7%E7%82%B9%E9%94%81%E9%87%8A%E6%94%BE%E4%BA%86%0A%0A%20%20%20%20-%20%E9%93%BE%E7%9A%84%E5%BD%93%E5%89%8D%E7%8E%AF%E8%8A%82%E8%A2%AB%E6%9B%B4%E6%94%B9(%20next_lock%20%E2%89%A0waiter-%3Elock)%0A%0A%20%20%20%20-%20Task1%E6%B2%A1%E6%9C%89%E5%8D%A0%E9%94%81%0A3.%20%E5%A6%82%E6%9E%9CTask1%E4%B9%9Fwait%E5%9C%A8%E6%9F%90%E4%B8%AAlock%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%88%99%E8%AF%A5lock%E7%9A%84waiters%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%EF%BC%8C%E8%BF%99%E9%87%8C%E6%9C%89%E8%8B%A5%E5%B9%B2%E7%A7%8D%E9%80%80%E5%87%BA%E5%8F%AF%E8%83%BD%E3%80%82%0A%0A%20%20-%20Task1%E6%B2%A1%E6%9C%89%E8%A2%ABblock%0A%20%20-%20Task1%20pi_waiters%E4%B8%AD%E6%9C%89%E4%BC%98%E5%85%88%E7%BA%A7%E9%AB%98%E4%BA%8ETask0%E7%9A%84waiter%EF%BC%8C%E6%8D%A2%E5%8F%A5%E8%AF%9D%E8%AF%B4%EF%BC%8Clock0%E7%9A%84top_waiter%E4%B8%8D%E6%98%AFTask1%E7%9A%84top%20pi_waiter%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E4%B8%8D%E9%9C%80%E8%A6%81%E7%BB%A7%E7%BB%AD%E4%BC%A0%E9%80%92%20%0A%20%20-%20%E5%A6%82%E6%9E%9CTask1%E5%9C%A8%E7%94%B3%E8%AF%B7Lock1%20%E7%9A%84%E6%97%B6%E5%80%99%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88%E8%BF%99%E4%B8%AA%E8%AE%B0%E5%BD%95%E5%9C%A8waiter-%3Eprio%E9%87%8C%EF%BC%89%E4%B8%8E%E5%BD%93%E5%89%8D%E8%B0%83%E6%95%B4%E5%90%8E%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E7%9B%B8%E7%AD%89%EF%BC%8C%E5%88%99%E5%90%8E%E7%BB%AD%E6%B2%A1%E5%BF%85%E8%A6%81%E5%9C%A8%E7%BB%A7%E7%BB%AD%E8%B0%83%E6%95%B4%E4%BC%98%E5%85%88%E7%BA%A7%0A%20%20-%20%E6%A3%80%E6%B5%8B%E5%88%B0DEADLOCK%0A4.%20%E5%9B%9E%E5%88%B01%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%EF%BC%8C%E7%9B%B4%E5%88%B0%E9%80%80%E5%87%BA%E9%93%BE%E5%BC%8F%E5%A4%84%E7%90%86%0A%0A%23%23%23%23%23%20%E6%AD%BB%E9%94%81%0A%0A%E6%9C%893%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%8C%E5%87%BD%E6%95%B0%E4%BC%9A%E8%BF%94%E5%9B%9E%E6%AD%BB%E9%94%81%0A%0A-%20%E9%93%BE%E4%B8%8A%E8%B6%85%E8%BF%871024%E4%B8%AA%E9%94%81%E8%8A%82%E7%82%B9%0A-%20%E9%93%BE%E4%B8%8A%E4%BB%BB%E6%84%8FTask%E8%8A%82%E7%82%B9%E7%94%B3%E8%AF%B7%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%94%81%E8%8A%82%E7%82%B9%EF%BC%8C%E5%8D%B3Lock0%0A-%20%E9%93%BE%E4%B8%8A%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E9%94%81owner%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AATask%E8%8A%82%E7%82%B9%EF%BC%8C%E5%8D%B3Task0%0A%0A%0A%23%23%20%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%0A%0A%5C%5B1%5D%20%5BMutex%20mutandis%3A%20understanding%20mutex%20types%20and%20attributes%5D.%20(http%3A%2F%2F2net.co.uk%2Ftutorial%2Fmutex_mutandis)%0A%0A%5C%5B2%5D%20%5BPOSIX%20Revision%20of%20IEEE%20Std%201003.1-2008%5D(http%3A%2F%2Fpubs.opengroup.org%2Fonlinepubs%2F9699919799%2Ffunctions%2Fcontents.html)%0A%0A%5C%5B3%5D%20%5BSource%20code%20analysis%20of%20pthread_mutex_lock%5D(https%3A%2F%2Fzihan.me%2F2018%2F08%2F15%2Fsource-code-analysis-pthread-mutex-lock%2F)%0A%0A%5C%5B4%5D%20%5Blinux%20pi_futex%E6%B5%85%E6%9E%90%5D(https%3A%2F%2Fyq.aliyun.com%2Farticles%2F6044)%0A%0A%5C%5B5%5D%20Linux%204.20-rc3%20source%20code%0A%0A%5C%5B6%5D%20glibc%202.28%20source%20code%0A]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>schedule algorithm</tag>
        <tag>glibc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[如何规划职业的未来]]></title>
    <url>%2F2018%2F11%2F18%2F%E5%A6%82%E4%BD%95%E8%A7%84%E5%88%92%E8%81%8C%E4%B8%9A%E7%9A%84%E6%9C%AA%E6%9D%A5%2F</url>
    <content type="text"><![CDATA[&#x4E0D;&#x7BA1;&#x662F;&#x521A;&#x6BD5;&#x4E1A;&#x7684;&#x83DC;&#x9E1F;&#xFF0C;&#x8FD8;&#x662F;&#x50CF;&#x6211;&#x8FD9;&#x6837;&#x5DE5;&#x4F5C;&#x4E86;&#x5FEB;10&#x5E74;&#x7684;&#x8001;&#x6CB9;&#x6761;&#xFF0C;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x804C;&#x573A;&#x4EBA;&#xFF0C;&#x5185;&#x5FC3;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x7EC8;&#x6781;&#x62F7;&#x95EE;: &#x6211;&#x5230;&#x5E95;&#x8981;&#x6210;&#x4E3A;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x4EBA;&#xFF1F;&#x8BF4;&#x4E13;&#x4E1A;&#x4E00;&#x70B9;&#x5C31;&#x662F;&#x804C;&#x4E1A;&#x751F;&#x6DAF;&#x7684;&#x89C4;&#x5212;&#x3002; &#x8FD9;&#x4E24;&#x5929;&#x8FD8;&#x770B;&#x5230;&#x962E;&#x4E00;&#x5CF0;&#x535A;&#x5BA2;&#x4E0A;&#x7684;&#x63A8;&#x9001;&#xFF0C;&#x5173;&#x4E8E;&#x4E54;&#x5E03;&#x65AF;&#x7684;&#x70ED;&#x60C5;&#x5047;&#x8BF4;&#xFF0C;&#x4EE5;&#x53CA;&#x4ED6;&#x7684;&#x53CD;&#x8C03;&#x300A;&#x4F18;&#x79C0;&#x5230;&#x65E0;&#x6CD5;&#x5FFD;&#x7565;&#x300B;&#xFF08;&#x300A;So Good They Can&apos;t Ignore You&#x300B;&#xFF09;&#x3002;&#x4E0B;&#x9762;&#x5927;&#x6BB5;&#x5F15;&#x7528;&#x535A;&#x6587;&#x4E2D;,&#x5173;&#x4E8E;&#x4E24;&#x4E2A;&#x8BBA;&#x70B9;&#x7684;&#x9610;&#x8FF0;&#x3002; 2005&#x5E74;&#xFF0C;&#x65AF;&#x5766;&#x798F;&#x5927;&#x5B66;&#x9080;&#x8BF7;&#x4E54;&#x5E03;&#x65AF;&#x5728;&#x6BD5;&#x4E1A;&#x5178;&#x793C;&#x6F14;&#x8BB2;&#x3002;&#x8FD9;&#x4E2A;&#x6F14;&#x8BB2;&#x540E;&#x6765;&#x6210;&#x4E3A;&#x7ECF;&#x5178;&#xFF0C;&#x300A;&#x4E54;&#x5E03;&#x65AF;&#x4F20;&#x300B;&#x8BF4;&quot;&#x6216;&#x8BB8;&#x6709;&#x4E9B;&#x6F14;&#x8BB2;&#x5BF9;&#x540E;&#x4E16;&#x5F71;&#x54CD;&#x66F4;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x627E;&#x4E0D;&#x5230;&#xFF08;&#x6BD4;&#x8FD9;&#x7BC7;&#xFF09;&#x66F4;&#x597D;&#x7684;&#x6F14;&#x8BB2;&#x3002;&quot; &#x6F14;&#x8BB2;&#x4E2D;&#xFF0C;&#x4E54;&#x5E03;&#x65AF;&#x8BF4;&#x4E86;&#x4E00;&#x6BB5;&#x6709;&#x540D;&#x7684;&#x8BDD;&#x3002; &quot;&#x4F60;&#x4EEC;&#x7684;&#x65F6;&#x95F4;&#x6709;&#x9650;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x628A;&#x5B83;&#x6D6A;&#x8D39;&#x5728;&#x8FC7;&#x5176;&#x4ED6;&#x4EBA;&#x7684;&#x751F;&#x6D3B;&#x3002;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x4F60;&#x8981;&#x6709;&#x52C7;&#x6C14;&#x8DDF;&#x968F;&#x4F60;&#x7684;&#x5185;&#x5FC3;&#x548C;&#x76F4;&#x89C9;&#x3002;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#xFF0C;&#x5B83;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4F60;&#x771F;&#x6B63;&#x60F3;&#x8981;&#x6210;&#x4E3A;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#x3002;&#x5176;&#x4ED6;&#x6240;&#x6709;&#x4E8B;&#x60C5;&#x90FD;&#x662F;&#x6B21;&#x8981;&#x7684;&#x3002;&quot; &#x8FD9;&#x6BB5;&#x8BDD;&#x540E;&#x6765;&#x88AB;&#x79F0;&#x4E3A;&quot;&#x70ED;&#x60C5;&#x5047;&#x8BBE;&quot;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x5F15;&#x7528;&#x5B83;&#x9F13;&#x52B1;&#x5E74;&#x8F7B;&#x4EBA;&#xFF1A;&#x5BFB;&#x627E;&#x804C;&#x4E1A;&#x65B9;&#x5411;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8981;&#x8DDF;&#x968F;&#x5185;&#x5FC3;&#x7684;&#x70ED;&#x60C5;&#xFF08;passion&#xFF09;&#xFF0C;&#x53BB;&#x505A;&#x90A3;&#x4E9B;&#x4F60;&#x6709;&#x5F3A;&#x70C8;&#x610F;&#x613F;&#x4ECE;&#x4E8B;&#x7684;&#x5DE5;&#x4F5C;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x7F8E;&#x56FD;&#x6700;&#x8FD1;&#x51FA;&#x7248;&#x4E86;&#x4E00;&#x672C;&#x65B0;&#x4E66;&#x300A;&#x4F18;&#x79C0;&#x5230;&#x65E0;&#x6CD5;&#x5FFD;&#x7565;&#x300B;&#xFF08;&#x300A;So Good They Can&apos;t Ignore You&#x300B;&#xFF09;&#xFF0C;&#x58F0;&#x79F0;&#x4E54;&#x5E03;&#x65AF;&#x7684;&#x8FD9;&#x4E2A;&#x5EFA;&#x8BAE;&#x662F;&#x5B8C;&#x5168;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x8BEF;&#x5BFC;&#x5E74;&#x8F7B;&#x4EBA;&#x3002;&#x522B;&#x7684;&#x4E0D;&#x8BF4;&#xFF0C;&#x4E54;&#x5E03;&#x65AF;&#x672C;&#x4EBA;&#x4E5F;&#x4E0D;&#x9075;&#x5B88;&quot;&#x70ED;&#x60C5;&#x5047;&#x8BBE;&quot;&#x3002;&#x5E74;&#x8F7B;&#x65F6;&#xFF0C;&#x4ED6;&#x5BF9;&#x7985;&#x5B97;&#x601D;&#x60F3;&#x6700;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x53BB;&#x5370;&#x5EA6;&#x5B66;&#x4E60;&#x4F5B;&#x6559;&#x3002;&#x5982;&#x679C;&#x4ED6;&#x771F;&#x7684;&#x8FFD;&#x968F;&#x81EA;&#x5DF1;&#x7684;&#x5185;&#x5FC3;&#xFF0C;&#x4ED6;&#x5C31;&#x5E94;&#x8BE5;&#x53BB;&#x5F53;&#x4E00;&#x4E2A;&#x7985;&#x5B97;&#x8001;&#x5E08;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8DD1;&#x56DE;&#x7F8E;&#x56FD;&#x521B;&#x529E;&#x82F9;&#x679C;&#x516C;&#x53F8;&#x3002; &#x8FD9;&#x672C;&#x4E66;&#x8BA4;&#x4E3A;&#xFF0C;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x539F;&#x56E0;&#x5BFC;&#x81F4;&quot;&#x70ED;&#x60C5;&#x5047;&#x8BBE;&quot;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x5EFA;&#x8BAE;&#x3002; &#x7B2C;&#x4E00;&#xFF0C;&#x70ED;&#x60C5;&#x771F;&#x7684;&#x5F88;&#x7F55;&#x89C1;&#x3002;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x90FD;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x6CA1;&#x5174;&#x8DA3;&#xFF0C;&#x800C;&#x662F;&#x5BF9;&#x67D0;&#x79CD;&#x7231;&#x597D;&#xFF08;&#x6BD4;&#x5982;&#x6253;&#x7403;&#x3001;&#x9493;&#x9C7C;&#xFF09;&#x6709;&#x5174;&#x8DA3;&#x3002;&#x5982;&#x679C;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x90FD;&#x627E;&#x4E0D;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x804C;&#x4E1A;&#x70ED;&#x60C5;&#xFF0C;&#x4F60;&#x600E;&#x4E48;&#x80FD;&#x53EB;&#x4ED6;&#x4EEC;&#x53BB;&#x8FFD;&#x968F;&#x70ED;&#x60C5;&#x5462;&#xFF1F; &#x7B2C;&#x4E8C;&#xFF0C;&#x70ED;&#x60C5;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x6765;&#x5EFA;&#x7ACB;&#x3002;&#x8BB8;&#x591A;&#x4EBA;&#x521A;&#x5F00;&#x59CB;&#x5DE5;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;&#x804C;&#x4E1A;&#x5E76;&#x6CA1;&#x6709;&#x5174;&#x8DA3;&#xFF0C;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x79EF;&#x7D2F;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x7ECF;&#x9A8C;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x80FD;&#x591F;&#x638C;&#x63A7;&#x7684;&#x4E1C;&#x897F;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x8FD9;&#x624D;&#x6162;&#x6162;&#x5F00;&#x59CB;&#x70ED;&#x7231;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x627E;&#x5DE5;&#x4F5C;&#x9636;&#x6BB5;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x6839;&#x672C;&#x4E0D;&#x4F1A;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x4E2A;&#x804C;&#x4E1A;&#x5C31;&#x662F;&#x4F60;&#x7684;&#x70ED;&#x60C5;&#x6240;&#x5728;&#x3002; &#x7B2C;&#x4E09;&#xFF0C;&#x8FC7;&#x5EA6;&#x5F3A;&#x8C03;&#x70ED;&#x60C5;&#xFF0C;&#x5BB9;&#x6613;&#x5BF9;&#x73B0;&#x72B6;&#x4EA7;&#x751F;&#x4E0D;&#x6EE1;&#x3002;2010&#x5E74;&#x7684;&#x4E00;&#x9879;&#x8C03;&#x67E5;&#x53D1;&#x73B0;&#xFF0C;&#x53EA;&#x6709;45&#xFF05;&#x7684;&#x7F8E;&#x56FD;&#x4EBA;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x6EE1;&#x610F;&#x3002;&#x7531;&#x4E8E;&#x5F88;&#x591A;&#x4EBA;&#x76F8;&#x4FE1;&#xFF0C;&#x65E0;&#x6CD5;&#x4EA7;&#x751F;&#x70ED;&#x60C5;&#x7684;&#x5DE5;&#x4F5C;&#x4E0D;&#x662F;&#x597D;&#x5DE5;&#x4F5C;&#xFF0C;&#x5BFC;&#x81F4;&#x5BF9;&#x804C;&#x4E1A;&#x751F;&#x6DAF;&#x62B1;&#x6709;&#x4E0D;&#x5207;&#x5B9E;&#x9645;&#x7684;&#x671F;&#x671B;&#xFF0C;&#x5BF9;&#x73B0;&#x6709;&#x7684;&#x5DE5;&#x4F5C;&#x4E0D;&#x6EE1;&#x610F;&#xFF0C;&#x4E0D;&#x65AD;&#x8DF3;&#x69FD;&#x3002; &#x8FD9;&#x672C;&#x4E66;&#x63D0;&#x51FA;&#xFF0C;&#x70ED;&#x60C5;&#x4E0D;&#x662F;&#x51ED;&#x7A7A;&#x4EA7;&#x751F;&#x7684;&#xFF0C;&#x5B83;&#x8DDF;&#x81EA;&#x4E3B;&#x6743;&#x6709;&#x5173;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5728;&#x67D0;&#x4E2A;&#x804C;&#x4F4D;&#x4E0A;&#x7684;&#x81EA;&#x4E3B;&#x6743;&#x8D8A;&#x5927;&#xFF0C;&#x80FD;&#x591F;&#x638C;&#x63A7;&#x7684;&#x4E1C;&#x897F;&#x8D8A;&#x591A;&#xFF0C;&#x5C31;&#x8D8A;&#x5BB9;&#x6613;&#x5BF9;&#x5F53;&#x524D;&#x7684;&#x804C;&#x4E1A;&#x4EA7;&#x751F;&#x70ED;&#x60C5;&#x3002;&#x4E0E;&#x5176;&#x5F3A;&#x8C03;&#x8DDF;&#x968F;&#x5185;&#x5FC3;&#x7684;&#x70ED;&#x60C5;&#xFF0C;&#x4E0D;&#x5982;&#x5F3A;&#x8C03;&#x5982;&#x4F55;&#x5728;&#x67D0;&#x79CD;&#x804C;&#x4E1A;&#x91CC;&#x9762;&#x83B7;&#x5F97;&#x81EA;&#x4E3B;&#x6743;&#x3002;&#x4F60;&#x5FC5;&#x987B;&#x4F7F;&#x81EA;&#x5DF1;&#x53D8;&#x5F97;&#x4F18;&#x79C0;&#xFF0C;&#x8BA9;&#x522B;&#x4EBA;&#x65E0;&#x6CD5;&#x5FFD;&#x89C6;&#x4F60;&#xFF0C;&#x540C;&#x610F;&#x8BA9;&#x4F60;&#x638C;&#x63A7;&#x66F4;&#x591A;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x4E66;&#x540D;&#x7684;&#x542B;&#x4E49;&#x3002; &#x5728;&#x8FD9;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x542C;&#x8FC7;&#x3001;&#x770B;&#x8FC7;&#x6216;&#x8BFB;&#x8FC7;&#x4E54;&#x5E03;&#x65AF;&#x7684;&#x6F14;&#x8BB2;&#x4EE5;&#x53CA;&#x300A;&#x4E54;&#x5E03;&#x65AF;&#x4F20;&#x300B;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x7BC7;&#x535A;&#x6587;&#x548C;&#x60F3;&#x5199;&#x7684;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x6211;&#x7279;&#x610F;&#x53BB;&#x8BFB;&#x4E86;&#x4E54;&#x5E03;&#x65AF;&#x7684;&#x6F14;&#x8BB2;&#x7A3F;&#x3002;&#x5173;&#x4E8E;&#x4E54;&#x5E03;&#x65AF;&#x7684;&#x89C2;&#x70B9;&#xFF0C;&#x6211;&#x4E0D;&#x80FD;&#x540C;&#x610F;&#x66F4;&#x591A;&#x3002;&#x4E00;&#x4E2A;&#x4EBA;&#x60F3;&#x8981;&#x5728;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x4E0A;&#x6210;&#x529F;&#xFF0C;&#x9760;&#x7684;&#x4E0D;&#x5E94;&#x5F53;&#x662F;&#x5916;&#x90E8;&#x7684;&#x6761;&#x6761;&#x6846;&#x6846;&#xFF0C;&#x6216;&#x8005;&#x662F;&#x5404;&#x5F0F;&#x5404;&#x6837;&#xFF0C;&#x5F62;&#x5F62;&#x8272;&#x8272;&#x7684;&#x6BD2;&#x9E21;&#x6C64;&#x3002;&#x6240;&#x6709;&#x7684;&#x52A8;&#x529B;&#xFF0C;&#x5E94;&#x8BE5;&#x6765;&#x81EA;&#x4E8E;&#x4F60;&#x7684;&#x5185;&#x5FC3;&#x3002;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#x672C;&#x8EAB;&#x63D0;&#x4F9B;&#x7ED9;&#x4F60;&#x7684;&#x5FEB;&#x4E50;&#xFF0C;&#x624D;&#x80FD;&#x6FC0;&#x52B1;&#x4F60;&#x6301;&#x7EED;&#x7684;&#x575A;&#x6301;&#x4E0B;&#x53BB;&#xFF0C;&#x6301;&#x7EED;&#x5730;&#x53BB;&#x4ED8;&#x51FA;&#x3002;&#x56E0;&#x4E3A;&#x4ED6;&#x6301;&#x7EED;&#x7684;&#x7528;&#x5FEB;&#x4E50;&#x6765;&#x56DE;&#x9988;&#xFF0C;&#x4F60;&#x624D;&#x4E0D;&#x4F1A;&#x8BA1;&#x8F83;&#x4ED8;&#x51FA;&#x7684;&#x591A;&#x5BE1;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x56DE;&#x62A5;&#x624D;&#x4F1A;&#x4E30;&#x539A;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x4ED8;&#x51FA;&#x7684;&#x591A;&#x3002;&#x800C;&#x5916;&#x90E8;&#x7684;&#x4E00;&#x5207;&#x56E0;&#x7D20;&#xFF0C;&#x6216;&#x662F;&#x6FC0;&#x52B1;&#xFF0C;&#x6216;&#x662F;&#x523A;&#x6FC0;&#x90FD;&#x662F;&#x4E0D;&#x7A33;&#x5B9A;&#x7684;&#xFF0C;&#x90FD;&#x662F;&#x6613;&#x53D8;&#x7684;&#x3002;&#x4ECA;&#x5929;&#x6D41;&#x884C;&#x8FD9;&#x4E2A;&#xFF0C;&#x660E;&#x5929;&#x6D41;&#x884C;&#x90A3;&#x4E2A;;&#x66FE;&#x7ECF;&#x4E92;&#x8054;&#x7F51;&#x706B;&#xFF0C;&#x73B0;&#x5728;AI&#x706B;;&#x4ECA;&#x5929;&#x542C;&#x8981;&#x4FDD;&#x6301;&#x70ED;&#x60C5;&#x8981;&#x594B;&#x6597;&#xFF0C;&#x5FC3;&#x91CC;&#x50CF;&#x6253;&#x4E86;&#x9E21;&#x8840;&#xFF0C;&#x4E0D;&#x7834;&#x697C;&#x5170;&#x6B7B;&#x4E0D;&#x8FD8;&#xFF0C;&#x660E;&#x5929;&#x542C;&#x4E2A;&#x4E8E;&#x4E39;&#x7684;&#x9EC4;&#x8001;&#x4E4B;&#x5B66;&#xFF0C;&#x53C8;&#x8981;&#x53CD;&#x601D;&#xFF0C;&#x6211;&#x8FD9;&#x4E48;&#x62FC;&#x662F;&#x4E3A;&#x4E86;&#x8C01;&#xFF0C;&#x4EBA;&#x751F;&#x800C;&#x4E0D;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x5FEB;&#x4E50;&#x5417;&#xFF0C;&#x8FD8;&#x662F;&#x5C81;&#x6708;&#x9759;&#x597D;&#x5427;&#x3002;&#x95EE;&#x95EE;&#x81EA;&#x5DF1;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x7ECF;&#x5E38;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x5FC3;&#x7406;&#x6CE2;&#x52A8;&#xFF1F;&#x5982;&#x679C;&#x8BD5;&#x60F3;&#xFF0C;&#x4F60;&#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x53BB;&#x8FFD;&#x968F;&#xFF0C;&#x90A3;&#x662F;&#x4E0D;&#x662F;&#x4E8B;&#x4E8B;&#x90FD;&#x662F;&#x6D45;&#x5C1D;&#x8F84;&#x6B62;&#x5462;? &#x5176;&#x5B9E;&#x4E16;&#x4E8B;&#x4E5F;&#x5E76;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x590D;&#x6742;&#x3002;&#x4EBA;&#xFF0C;&#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x52A8;&#x7269;&#xFF0C;&#x603B;&#x4F1A;&#x53BB;&#x8FFD;&#x9010;&#x8BA9;&#x4F60;&#x5F97;&#x5230;&#x5FEB;&#x611F;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5403;&#xFF0C;&#x6709;&#x591A;&#x5C11;&#x4EBA;&#x53D1;&#x8A93;&#x8981;&#x51CF;&#x80A5;&#xFF0C;&#x4F46;&#x8F6C;&#x8138;&#x5C31;&#x5FCD;&#x4E0D;&#x4F4F;&#xFF0C;&#x56E0;&#x4E3A;&#x7F8E;&#x98DF;&#x5728;&#x4F60;&#x7684;&#x6F5C;&#x610F;&#x8BC6;&#x91CC;&#x4EE3;&#x8868;&#x4E86;&#x7F8E;&#x597D;&#x3002;&#x4F8B;&#x5982;&#x592B;&#x59BB;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x66FE;&#x7ECF;&#x5982;&#x80F6;&#x4F3C;&#x6F06;&#xFF0C;&#x73B0;&#x5728;&#x5374;&#x623F;&#x4E8B;&#x51B7;&#x6DE1;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x4EEC;&#x66FE;&#x7ECF;&#x52AA;&#x529B;&#x5730;&#x53BB;&#x8425;&#x9020;&#x7F8E;&#x597D;&#xFF0C;&#x540E;&#x6765;&#x5E73;&#x6DE1;&#x4E4B;&#x540E;&#xFF0C;&#x4E00;&#x5B9A;&#x662F;&#x6709;&#x4E86;&#x6CA1;&#x90A3;&#x4E48;&#x7F8E;&#x5999;&#x7684;&#x4E00;&#x6B21;&#x6216;&#x51E0;&#x6B21;&#xFF0C;&#x592B;&#x59BB;&#x4E4B;&#x4E8B;&#x5728;&#x6F5C;&#x610F;&#x8BC6;&#x5DF2;&#x7ECF;&#x4E0D;&#x4EE3;&#x8868;&#x5FEB;&#x4E50;&#x3002;&#x518D;&#x4E3E;&#x4E00;&#x4E2A;&#x4E0D;&#x6070;&#x5F53;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x4E00;&#x4E2A;&#x763E;&#x541B;&#x5B50;&#x4ED6;&#x4E0D;&#x77E5;&#x9053;&#x6BD2;&#x54C1;&#x7684;&#x5371;&#x5BB3;&#x5417;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x6709;&#x4EBA;&#x628A;&#x81EA;&#x5DF1;&#x5F80;&#x4E07;&#x52AB;&#x4E0D;&#x590D;&#x7684;&#x6DF1;&#x6E0A;&#x63A8;&#xFF1F;&#x56E0;&#x4E3A;&#x90A3;&#x662F;&#x6765;&#x81EA;&#x5FC3;&#x5E95;&#x7684;&#x5BF9;&#x90A3;&#x4EFD;&#x5FEB;&#x611F;&#x7684;&#x8FFD;&#x6C42;&#x3002; &#x6240;&#x4EE5;&#x5185;&#x5FC3;&#x7684;&#x70ED;&#x60C5;&#xFF0C;&#x6216;&#x8005;&#x6109;&#x60A6;&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x624D;&#x662F;&#x7A33;&#x5B9A;&#x7684;&#x52A8;&#x529B;&#x4E4B;&#x6E90;&#x3002;&#x4E0A;&#x5347;&#x5230;&#x54F2;&#x5B66;&#x7684;&#x89D2;&#x5EA6;, &#x4E0D;&#x662F;&#x8BF4;&#x5185;&#x56E0;&#x624D;&#x6C38;&#x8FDC;&#x662F;&#x4E3B;&#x5BFC;&#x56E0;&#x7D20;&#x5417;&#xFF1F;&#x6211;&#x4EEC;&#x867D;&#x7136;&#x6CA1;&#x6CD5;&#x50CF;&#x763E;&#x541B;&#x5B50;&#x90A3;&#x6837;&#x6B47;&#x65AF;&#x5E95;&#x91CC;&#x5730;&#x8FFD;&#x6C42;&#x6211;&#x4EEC;&#x7684;&#x68A6;&#x60F3;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x81F3;&#x5C11;&#x53EF;&#x4EE5;&#x6709;&#x610F;&#x8BC6;&#x5730;&#x5BFB;&#x627E;&#x90A3;&#x4EFD;&#x539F;&#x59CB;&#x800C;&#x7B80;&#x5355;&#x7684;&#x5FEB;&#x4E50;&#x3002; &#x518D;&#x8BF4;&#x4E3A;&#x4EC0;&#x4E48;&#x4E54;&#x5E03;&#x65AF;&#x6CA1;&#x53BB;&#x505A;&#x7985;&#x5B97;&#x8001;&#x5E08;&#x3002;&#x56E0;&#x4E3A;&#x4E16;&#x4E8B;&#x90FD;&#x662F;&#x52A8;&#x6001;&#x7684;&#x3002;&#x4F60;&#x53EF;&#x80FD;&#x67D0;&#x65F6;&#x67D0;&#x523B;&#x5BF9;&#x67D0;&#x4E00;&#x4EF6;&#x4E8B;&#x7269;&#x7279;&#x522B;&#x75F4;&#x8FF7;&#xFF0C;&#x4F46;&#x968F;&#x7740;&#x4F60;&#x7684;&#x6210;&#x957F;&#x4E0E;&#x8BA4;&#x8BC6;&#x7684;&#x6DF1;&#x523B;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x5E76;&#x4E0D;&#x80FD;&#x53D1;&#x73B0;&#x5B83;&#x80FD;&#x6301;&#x7EED;&#x5730;&#x7ED9;&#x4F60;&#x5FEB;&#x4E50;&#x3002;&#x66F4;&#x591A;&#x7684;&#x53EA;&#x662F;&#x4E00;&#x65F6;&#x7684;&#x523A;&#x6FC0;&#x3002;&#x8FD9;&#x91CC;&#x6240;&#x8C13;&#x7684;&#x7231;&#x597D;&#xFF0C;&#x5E94;&#x5F53;&#x662F;&#x80FD;&#x4E00;&#x76F4;&#x5438;&#x5F15;&#x4F60;&#x8D70;&#x51FA;&#x5FC3;&#x7406;&#x8212;&#x9002;&#x533A;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x770B;&#x7535;&#x5F71;&#xFF0C;&#x4E0A;&#x7F51;&#x8FD9;&#x79CD;&#x5C31;&#x4E0D;&#x80FD;&#x7B97;&#x662F;&#x7231;&#x597D;&#x4E86;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5F88;&#x591A;&#x4EBA;&#x559C;&#x6B22;&#x6253;&#x7403;&#xFF0C;&#x9493;&#x9C7C;&#xFF0C;&#x5374;&#x4E0D;&#x80FD;&#x5C06;&#x5B83;&#x4EEC;&#x53D8;&#x4E3A;&#x804C;&#x4E1A;&#x7684;&#x539F;&#x56E0;&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5E26;&#x6765;&#x7684;&#x5FEB;&#x4E50;&#x66F4;&#x591A;&#x7684;&#x662F;&#x611F;&#x5B98;&#x4E0A;&#x7684;&#x523A;&#x6FC0;&#xFF0C;&#x6216;&#x662F;&#x5FC3;&#x91CC;&#x653E;&#x677E;&#x5E26;&#x6765;&#x7684;&#x8F7B;&#x677E;&#x8212;&#x9002;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x4E0D;&#x8DB3;&#x4EE5;&#x8BA9;&#x4F60;&#x8FC8;&#x51FA;&#x5FC3;&#x7406;&#x8212;&#x9002;&#x533A;&#x3002;&#x4F60;&#x559C;&#x6B22;&#x6253;&#x7BEE;&#x7403;&#xFF0C;&#x90A3;&#x4F60;&#x80FD;&#x505A;&#x5230;&#x6BCF;&#x5929;&#x7EC3;1000&#x6B21;&#x6295;&#x7BEE;&#x5417;&#xFF1F;&#x6211;&#x60F3;&#x4F60;&#x505A;&#x4E0D;&#x5230;&#xFF0C;&#x4F60;&#x903C;&#x81EA;&#x5DF1;&#x505A;&#x4E00;&#x6B21;&#x4E5F;&#x4E0D;&#x4F1A;&#x5FEB;&#x4E50;&#xFF0C;&#x4F46;&#x79D1;&#x6BD4;&#x5C31;&#x80FD;&#x505A;&#x5230;&#xFF0C;&#x800C;&#x4E14;&#x5341;&#x51E0;&#x5E74;&#x5982;&#x4E00;&#x65E5;&#xFF0C;&#x4E50;&#x6B64;&#x4E0D;&#x75B2;&#x3002;&#x4F60;&#x89C9;&#x5F97;&#x662F;&#x6709;&#x4EC0;&#x4E48;&#x5728;&#x6FC0;&#x52B1;&#x4ED6;&#x5417;&#xFF1F;&#x5BF9;&#x7BEE;&#x7403;&#x7684;&#x70ED;&#x7231;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x90A3;&#x4EFD;&#x6700;&#x539F;&#x59CB;&#x7684;&#x5FEB;&#x4E50;&#x3002;&#x522B;&#x8BF4;&#x7BEE;&#x7403;&#xFF0C;&#x9493;&#x9C7C;&#x4E0D;&#x80FD;&#x505A;&#x804C;&#x4E1A;&#xFF0C;&#x5927;&#x628A;&#x4EBA;&#x4EE5;&#x6B64;&#x4E3A;&#x751F;&#x3002;&#x4E54;&#x5E03;&#x65AF;&#x5728;&#x5370;&#x5EA6;&#x5B66;&#x4E60;&#x671F;&#x95F4;&#xFF0C;&#x53EF;&#x80FD;&#x4E5F;&#x8BA4;&#x6E05;&#x4E86;&#x81EA;&#x5DF1;&#xFF0C;&#x4ED6;&#x5E76;&#x4E0D;&#x90A3;&#x4E48;&#x70ED;&#x7231;&#x7985;&#x5B97;&#x3002; &#x7136;&#x540E;,&#x6211;&#x8BA4;&#x4E3A;&#x8FD9;&#x672C;&#x300A;&#x4F18;&#x79C0;&#x5230;&#x65E0;&#x6CD5;&#x5FFD;&#x7565;&#x300B;&#x5C31;&#x662F;&#x4E00;&#x7897;&#x6EE1;&#x6EE1;&#x7684;&#x6BD2;&#x9E21;&#x6C64;&#x3002;&#x70ED;&#x60C5;&#x786E;&#x5B9E;&#x5F88;&#x7F55;&#x89C1;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5404;&#x884C;&#x5404;&#x4E1A;&#x771F;&#x6B63;&#x4F18;&#x79C0;&#x7684;&#x4EBA;&#x90FD;&#x53EA;&#x662F;&#x51E4;&#x6BDB;&#x9CDE;&#x89D2;&#x3002;&#x4F46;&#x8FD9;&#x5E76;&#x4E0D;&#x4EE3;&#x8868;&#x6211;&#x4EEC;&#x4E0D;&#x5FC5;&#x8FFD;&#x9010;&#x4F18;&#x79C0;&#x3002;&#x5C24;&#x5176;&#x5728;&#x4E2D;&#x56FD;&#x7684;&#x6559;&#x80B2;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x8FD9;&#x70B9;&#x5C24;&#x5176;&#x91CD;&#x8981;&#x3002;&#x56E0;&#x4E3A;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#xFF0C;&#x90FD;&#x6D3B;&#x5728;&#x522B;&#x4EBA;&#x7684;&#x773C;&#x4E2D;&#x3002;&#x6240;&#x6709;&#x7684;&#x51B3;&#x5B9A;&#x90FD;&#x662F;&#x628A;&#x6211;&#x4EEC;&#x5851;&#x9020;&#x6210;&#x7236;&#x6BCD;&#x60F3;&#x8BA9;&#x6211;&#x4EEC;&#x6210;&#x4E3A;&#x7684;&#x4EBA;&#x3002;&#x505A;&#x7684;&#x4E00;&#x5207;&#x52AA;&#x529B;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x6210;&#x4E3A;&#x8001;&#x5E08;&#x773C;&#x4E2D;&#x7684;&#x597D;&#x5B66;&#x751F;&#x3002;&#x4ECE;&#x6765;&#x90FD;&#x6CA1;&#x6709;&#x4EBA;&#x771F;&#x7684;&#x5728;&#x4E4E;&#x6211;&#x4EEC;&#x559C;&#x6B22;&#x4EC0;&#x4E48;&#xFF0C;&#x64C5;&#x957F;&#x4EC0;&#x4E48;&#x3002;&#x4E0D;&#x8981;&#x544A;&#x8BC9;&#x6211;&#x4EC0;&#x4E48;&#x5E72;&#x4E00;&#x884C;&#x7231;&#x4E00;&#x884C;&#x3002;&#x7231;&#x4E0D;&#x662F;&#x4E0D;&#x8BA8;&#x538C;&#x3002;&#x8BF4;&#x4E0D;&#x8BA8;&#x538C;&#x7684;&#xFF0C;&#x591A;&#x534A;&#x662F;&#x4E0D;&#x7231;&#x3002;&#x7231;&#x662F;&#x9700;&#x8981;&#x4F60;&#x80FD;&#x611F;&#x53D7;&#x5230;&#x90A3;&#x4E00;&#x4EFD;&#x5FEB;&#x4E50;&#xFF0C;&#x80FD;&#x4E0D;&#x65AD;&#x6FC0;&#x53D1;&#x81EA;&#x5DF1;&#x53BB;&#x7A81;&#x7834;&#x81EA;&#x5DF1;&#x7684;&#x3002;&#x5982;&#x679C;&#x4F60;&#x53EA;&#x662F;&#x56E0;&#x4E3A;&#x4E0D;&#x8BA8;&#x538C;&#xFF0C;&#x800C;&#x52AA;&#x529B;&#x538B;&#x5236;&#x81EA;&#x5DF1;&#x7684;&#x70ED;&#x60C5;&#xFF0C;&#x8FD9;&#x59A8;&#x788D;&#x4E86;&#x4F60;&#x7684;&#x5FEB;&#x4E50;&#xFF0C;&#x4E5F;&#x963B;&#x6321;&#x4E86;&#x4F60;&#x6210;&#x4E3A;&#x66F4;&#x4F18;&#x79C0;&#x7684;&#x4EBA;&#x3002; &#x70ED;&#x60C5;&#x7684;&#x5EFA;&#x7ACB;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x3002;&#x4F46;&#x6211;&#x8BA4;&#x4E3A;&#x5E76;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x638C;&#x63A7;&#x7684;&#x4E1C;&#x897F;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x624D;&#x5BFC;&#x81F4;&#x70ED;&#x60C5;&#x3002;&#x800C;&#x662F;&#x5728;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x5386;&#x7EC3;&#x4E2D;&#xFF0C;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#xFF0C;&#x63A2;&#x7D22;&#x81EA;&#x5DF1;&#xFF0C;&#x5230;&#x5E95;&#x559C;&#x6B22;&#x4EC0;&#x5E76;&#x4E14;&#x64C5;&#x957F;&#x4EC0;&#x4E48;&#xFF0C;&#x5E76;&#x6700;&#x7EC8;&#x4EE5;&#x6B64;&#x4F5C;&#x4E3A;&#x957F;&#x671F;&#x7684;&#x804C;&#x4E1A;&#x76EE;&#x6807;&#x3002;&#x521A;&#x6BD5;&#x4E1A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#x7ECF;&#x5386;&#xFF0C;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#x9760;&#x60F3;&#x8C61;&#x3002;&#x4F46;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#x53EA;&#x6709;&#x7ECF;&#x5386;&#x4E86;&#x624D;&#x80FD;&#x7ED9;&#x51FA;&#x6070;&#x5F53;&#x7684;&#x8BC4;&#x65AD;&#x3002;&#x6240;&#x4EE5;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x4EE5;&#x6211;&#x89C9;&#x5F97;&#x6211;&#x559C;&#x6B22;&#x4EC0;&#x4E48;&#xFF0C;&#x6216;&#x8005;&#x6211;&#x4E0D;&#x8BA8;&#x538C;&#x4EC0;&#x4E48;&#x6765;&#x4F5C;&#x8BC4;&#x5224;&#x70ED;&#x60C5;&#x7684;&#x6807;&#x51C6;&#x3002;&#x9009;&#x62E9;&#x4E00;&#x9879;&#x4E8B;&#x60C5;&#xFF0C;&#x5C31;&#x8981;&#x5168;&#x8EAB;&#x6027;&#x7684;&#x6295;&#x5165;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x5728;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E0D;&#x65AD;&#x7684;&#x4E86;&#x89E3;&#x81EA;&#x5DF1;&#x3002;&#x5426;&#x5219;&#x4EFB;&#x4F55;&#x4E8B;&#x60C5;&#x90FD;&#x6D45;&#x5C1D;&#x8F84;&#x6B62;&#xFF0C;&#x4E5F;&#x5E76;&#x4E0D;&#x4F1A;&#x5BF9;&#x8BA4;&#x77E5;&#x81EA;&#x5DF1;&#x5E26;&#x6765;&#x66F4;&#x5927;&#x7684;&#x5E2E;&#x52A9;&#xFF0C;&#x76F8;&#x53CD;&#x5374;&#x6D6A;&#x8D39;&#x4E86;&#x5B9D;&#x8D35;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x6211;&#x8BA4;&#x4E3A;&#x6BCF;&#x4E00;&#x6B21;&#x5C1D;&#x8BD5;&#x7684;&#x65F6;&#x95F4;&#x81F3;&#x5C11;&#x4EE5;&#x5E74;&#x4E3A;&#x5355;&#x4F4D;&#x3002;&#x901A;&#x5E38;&#x4E00;&#x4E2A;&#x672C;&#x79D1;&#x751F;22&#x5C81;&#x6BD5;&#x4E1A;&#xFF0C;&#x5230;30&#x5C81;&#x6709;8&#x5E74;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x7855;&#x58EB;&#x751F;&#x6709;5&#xFF5E;6&#x5E74;&#x3002;&#x6293;&#x4F4F;&#x8FD9;&#x51E0;&#x5E74;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x540E;&#x9762;&#x518D;&#x60F3;&#x5C1D;&#x8BD5;&#xFF0C;&#x4F60;&#x7684;&#x673A;&#x4F1A;&#x6210;&#x672C;&#x4F1A;&#x66F4;&#x9AD8;&#x3002;&#x5F53;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x786E;&#x5B9E;&#x7F3A;&#x4E4F;&#x70ED;&#x60C5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x8981;&#x5C3D;&#x5FEB;&#x7684;&#x6293;&#x4F4F;&#x5C1D;&#x8BD5;&#x65B0;&#x65B9;&#x5411;&#x7684;&#x673A;&#x4F1A;&#x3002;&#x8FD9;&#x4E5F;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x5C24;&#x5176;&#x5BF9;&#x4E2D;&#x56FD;&#x6559;&#x80B2;&#x51FA;&#x6765;&#x7684;&#x5B69;&#x5B50;&#x3002;&#x8BB0;&#x4F4F;&#x73B0;&#x5728;&#x4F60;&#x8981;&#x4E3A;&#x4F60;&#x81EA;&#x5DF1;&#x7684;&#x804C;&#x4E1A;&#x751F;&#x6DAF;&#x8D1F;&#x8D23;&#xFF0C;&#x6CA1;&#x6709;&#x4EBA;&#x518D;&#x5E2E;&#x4F60;&#x505A;&#x51B3;&#x5B9A;&#xFF0C;&#x5206;&#x62C5;&#x8D23;&#x4EFB;&#x3002;&#x4F60;&#x8981;&#x5BF9;&#x4F60;&#x81EA;&#x5DF1;&#x8D1F;&#x8D23;&#x3002;&#x56DE;&#x60F3;&#x81EA;&#x5DF1;&#x5F53;&#x521D;&#x521A;&#x6BD5;&#x4E1A;&#x65F6;&#xFF0C;&#x5F88;&#x591A;&#x540C;&#x5B66;&#x90FD;&#x505A;&#x6280;&#x672F;&#xFF0C;&#x73B0;&#x5728;&#x770B;&#x770B;&#xFF0C;&#x6709;&#x505A;&#x6295;&#x8D44;&#x7684;&#xFF0C;&#x505A;&#x4EA7;&#x54C1;&#x7ECF;&#x7406;&#x7684;&#xFF0C;&#x505A;&#x8001;&#x5E08;&#x7684;&#x2026;&#x521A;&#x6BD5;&#x4E1A;&#x7684;&#x65F6;&#x5019;&#x5165;&#x5BF9;&#x884C;&#xFF0C;&#x786E;&#x5B9E;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x4F46;&#x6211;&#x8BA4;&#x4E3A;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#x4F60;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;&#x63A2;&#x7D22;&#xFF0C;&#x5BF9;&#x81EA;&#x5DF1;&#x8BA4;&#x8BC6;&#x7684;&#x63D0;&#x9AD8;&#xFF0C;&#x624D;&#x80FD;&#x771F;&#x6B63;&#x7684;&#x5E2E;&#x52A9;&#x4F60;&#x5728;&#x672A;&#x6765;30&#x591A;&#x5E74;&#x7684;&#x804C;&#x4E1A;&#x751F;&#x6DAF;&#x4E2D;&#x66F4;&#x597D;&#x7684;&#x8FFD;&#x6C42;&#x81EA;&#x5DF1;&#x7684;&#x70ED;&#x60C5;&#xFF0C;&#x505A;&#x81EA;&#x5DF1;&#x559C;&#x6B22;&#x505A;&#x7684;&#x4E8B;&#xFF0C;&#x4ECE;&#x800C;&#x628A;&#x81EA;&#x5DF1;&#x53D8;&#x4E3A;&#x66F4;&#x4F18;&#x79C0;&#x7684;&#x4EBA;&#x3002; &#x6240;&#x8C13;&#x4EBA;&#x751F;&#x4E0D;&#x5982;&#x610F;&#x8005;&#xFF0C;&#x5341;&#x4E4B;&#x516B;&#x4E5D;&#x3002;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x7528;&#x8FD9;&#x53E5;&#x8BDD;&#x6765;&#x6BD4;&#x55BB;&#x4EBA;&#x751F;&#x7684;&#x8270;&#x8F9B;&#x3002;&#x5176;&#x5B9E;&#xFF0C;&#x8FD9;&#x4F55;&#x5C1D;&#x4E0D;&#x662F;&#x6B63;&#x597D;&#x8BF4;&#x660E;&#x7740;&#x804C;&#x573A;&#x7684;&#x73B0;&#x72B6;&#x5462;&#xFF1F;&#x6709;&#x591A;&#x5C11;&#x4EBA;&#x771F;&#x6B63;&#x7231;&#x7740;&#x4F60;&#x73B0;&#x5728;&#x7684;&#x5DE5;&#x4F5C;&#x5462;&#xFF1F;&#x8FD9;&#x4E0D;&#x6B63;&#x8BF4;&#x660E;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x4F18;&#x79C0;&#x7684;&#x4EBA;&#x8FD9;&#x4E48;&#x7A00;&#x5C11;&#x7684;&#x7F18;&#x6545;&#x5417;&#xFF1F;&#x4F18;&#x79C0;&#x7684;&#x4EBA;&#x548C;&#x6210;&#x529F;&#x7684;&#x4E8B;&#x4E1A;&#x4ECE;&#x6765;&#x90FD;&#x662F;&#x76F8;&#x8F85;&#x76F8;&#x6210;&#xFF0C;&#x4E92;&#x76F8;&#x6210;&#x5C31;&#x7684;&#x3002;&#x6240;&#x8C13;&#x5929;&#x751F;&#x6211;&#x6750;&#x5FC5;&#x6709;&#x7528;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x4E00;&#x53E5;&#x6577;&#x884D;&#x7684;&#x5B89;&#x6170;&#x7684;&#x8BDD;&#x3002;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x771F;&#x6B63;&#x70ED;&#x7231;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x53EA;&#x662F;&#x4F60;&#x6CA1;&#x6709;&#x8BA4;&#x8BC6;&#x5230;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x6295;&#x5165;&#x53BB;&#x5BFB;&#x627E;&#x3002;&#x6709;&#x7684;&#x4EBA;&#x8FD0;&#x6C14;&#x597D;&#xFF0C;&#x6B63;&#x597D;&#x4ECE;&#x4E8B;&#x4E86;&#x81EA;&#x5DF1;&#x6709;&#x70ED;&#x60C5;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6240;&#x4EE5;&#x6210;&#x529F;&#x4E86;&#xFF1B;&#x6709;&#x7684;&#x4EBA;&#x8BA4;&#x8BC6;&#x5230;&#x70ED;&#x60C5;&#x5047;&#x8BBE;&#xFF0C;&#x5E76;&#x7528;&#x5FC3;&#x53BB;&#x5BFB;&#x627E;&#xFF0C;&#x4F46;&#x662F;&#x603B;&#x662F;&#x7F18;&#x60AD;&#x4E00;&#x9762;&#xFF0C;&#x4F46;&#x4ED6;&#x4EEC;&#x8FD8;&#x5728;&#x8DEF;&#x4E0A;&#xFF1B;&#x4F46;&#x5927;&#x591A;&#x6570;&#x4EBA;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x610F;&#x8BC6;&#x5230;&#x70ED;&#x60C5;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x4ED6;&#x4EEC;&#x6D51;&#x6D51;&#x5669;&#x5669;&#x5F97;&#x8FC7;&#x4E14;&#x8FC7;&#xFF0C;&#x62B1;&#x6028;&#x81EA;&#x5DF1;&#x7684;&#x6BCF;&#x4E00;&#x5929;&#xFF0C;&#x5374;&#x4E0D;&#x53BB;&#x5BFB;&#x627E;&#xFF0C;&#x6216;&#x8005;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x5BFB;&#x627E;&#x3002;&#x6211;&#x7406;&#x89E3;&#x6700;&#x540E;&#x4E00;&#x79CD;&#x4EBA;&#x7684;&#x60F3;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x4E16;&#x4E8B;&#x7E41;&#x6742;&#xFF0C;&#x9700;&#x8981;&#x4F60;&#x6709;&#x4E00;&#x53CC;&#x6167;&#x773C;&#x548C;&#x4E00;&#x9897;&#x5584;&#x4E8E;&#x601D;&#x8003;&#x7684;&#x5FC3;&#x3002;&#x8FD9;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x5929;&#x5206;&#x554A;&#xFF0C;&#x548C;&#x80FD;&#x591F;&#x6212;&#x8E81;&#x6212;&#x8E81;&#x7684;&#x52AA;&#x529B;&#x4E00;&#x6837;&#xFF0C;&#x4ED6;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x5929;&#x5206;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x53EF;&#x9047;&#x800C;&#x4E0D;&#x53EF;&#x6C42;&#x7684;&#x3002;&#x4F46;&#x5982;&#x679C;&#x6211;&#x5199;&#x8FD9;&#x4E9B;&#x80FD;&#x591F;&#x6FC0;&#x8D77;&#x4F60;&#x5185;&#x5FC3;&#x54EA;&#x6015;&#x4E00;&#x4E1D;&#x4E1D;&#x7684;&#x6CE2;&#x6F9C;&#xFF0C;&#x5374;&#x4E5F;&#x771F;&#x662F;&#x65E0;&#x91CF;&#x529F;&#x5FB7;&#x4E00;&#x4EF6;&#x3002;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x4F60;&#x5F00;&#x59CB;&#x601D;&#x8003;&#xFF0C;&#x4E0A;&#x8DEF;&#xFF0C;&#x4F60;&#x5C31;&#x80FD;&#x5F15;&#x9886;&#x4F60;&#x8D70;&#x5411;&#x5BFB;&#x627E;&#x70ED;&#x60C5;&#xFF0C;&#x6210;&#x4E3A;&#x4F18;&#x79C0;&#x7684;&#x4EBA;&#x7684;&#x8DEF;&#x3002;&#x54EA;&#x6015;&#x662F;&#x7B2C;&#x4E8C;&#x79CD;&#x4EBA;&#xFF0C;&#x603B;&#x597D;&#x8FC7;&#x6D51;&#x6D51;&#x5669;&#x5669;&#x8FC7;&#x5B8C;&#x8FD9;30&#x591A;&#x5E74;&#x3002; &#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x53EA;&#x662F;&#x4ECE;&#x6211;&#x81EA;&#x5DF1;&#x7684;&#x89D2;&#x5EA6;&#x548C;&#x7ECF;&#x5386;&#x6765;&#x9644;&#x548C;&#x4E54;&#x5E03;&#x65AF;&#x7684;&#x70ED;&#x60C5;&#x5047;&#x8BF4;&#x3002;&#x505A;&#x81EA;&#x5DF1;&#x201C;&#x559C;&#x6B22;&#x201D;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x771F;&#x7684;&#x771F;&#x7684;&#x5F88;&#x91CD;&#x8981;&#x3002;&#x4F46;&#x524D;&#x63D0;&#x662F;&#x4F60;&#x8981;&#x80FD;&#x7406;&#x89E3;&#x201C;&#x559C;&#x6B22;&#x201D;&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x60F3;&#x60F3;&#x4F60;&#x8FFD;&#x6C42;&#x8FC7;&#x7684;&#x5973;&#x5B69;&#x513F;&#x5427;&#xFF0C;&#x6211;&#x89C9;&#x5F97;&#x8FD9;&#x6837;&#x7684;&#x611F;&#x89C9;&#x6CA1;&#x4EC0;&#x4E48;&#x4E24;&#x6837;&#x3002; %E4%B8%8D%E7%AE%A1%E6%98%AF%E5%88%9A%E6%AF%95%E4%B8%9A%E7%9A%84%E8%8F%9C%E9%B8%9F%EF%BC%8C%E8%BF%98%E6%98%AF%E5%83%8F%E6%88%91%E8%BF%99%E6%A0%B7%E5%B7%A5%E4%BD%9C%E4%BA%86%E5%BF%AB10%E5%B9%B4%E7%9A%84%E8%80%81%E6%B2%B9%E6%9D%A1%EF%BC%8C%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%81%8C%E5%9C%BA%E4%BA%BA%EF%BC%8C%E5%86%85%E5%BF%83%E9%83%BD%E4%BC%9A%E6%9C%89%E4%B8%80%E4%B8%AA%E7%BB%88%E6%9E%81%E6%8B%B7%E9%97%AE%3A%20%E6%88%91%E5%88%B0%E5%BA%95%E8%A6%81%E6%88%90%E4%B8%BA%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E4%BA%BA%EF%BC%9F%E8%AF%B4%E4%B8%93%E4%B8%9A%E4%B8%80%E7%82%B9%E5%B0%B1%E6%98%AF%E8%81%8C%E4%B8%9A%E7%94%9F%E6%B6%AF%E7%9A%84%E8%A7%84%E5%88%92%E3%80%82%0A%E8%BF%99%E4%B8%A4%E5%A4%A9%E8%BF%98%E7%9C%8B%E5%88%B0%E9%98%AE%E4%B8%80%E5%B3%B0%E5%8D%9A%E5%AE%A2%E4%B8%8A%E7%9A%84%E6%8E%A8%E9%80%81%EF%BC%8C%E5%85%B3%E4%BA%8E%E4%B9%94%E5%B8%83%E6%96%AF%E7%9A%84%E7%83%AD%E6%83%85%E5%81%87%E8%AF%B4%EF%BC%8C%E4%BB%A5%E5%8F%8A%E4%BB%96%E7%9A%84%E5%8F%8D%E8%B0%83%E3%80%8A%E4%BC%98%E7%A7%80%E5%88%B0%E6%97%A0%E6%B3%95%E5%BF%BD%E7%95%A5%E3%80%8B%EF%BC%88%E3%80%8ASo%20Good%20They%20Can&apos;t%20Ignore%20You%E3%80%8B%EF%BC%89%E3%80%82%E4%B8%8B%E9%9D%A2%E5%A4%A7%E6%AE%B5%E5%BC%95%E7%94%A8%E5%8D%9A%E6%96%87%E4%B8%AD%2C%E5%85%B3%E4%BA%8E%E4%B8%A4%E4%B8%AA%E8%AE%BA%E7%82%B9%E7%9A%84%E9%98%90%E8%BF%B0%E3%80%82%0A%0A%3E2005%E5%B9%B4%EF%BC%8C%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%A4%A7%E5%AD%A6%E9%82%80%E8%AF%B7%E4%B9%94%E5%B8%83%E6%96%AF%E5%9C%A8%E6%AF%95%E4%B8%9A%E5%85%B8%E7%A4%BC%E6%BC%94%E8%AE%B2%E3%80%82%E8%BF%99%E4%B8%AA%E6%BC%94%E8%AE%B2%E5%90%8E%E6%9D%A5%E6%88%90%E4%B8%BA%E7%BB%8F%E5%85%B8%EF%BC%8C%E3%80%8A%E4%B9%94%E5%B8%83%E6%96%AF%E4%BC%A0%E3%80%8B%E8%AF%B4%22%E6%88%96%E8%AE%B8%E6%9C%89%E4%BA%9B%E6%BC%94%E8%AE%B2%E5%AF%B9%E5%90%8E%E4%B8%96%E5%BD%B1%E5%93%8D%E6%9B%B4%E5%A4%A7%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BD%A0%E6%89%BE%E4%B8%8D%E5%88%B0%EF%BC%88%E6%AF%94%E8%BF%99%E7%AF%87%EF%BC%89%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%BC%94%E8%AE%B2%E3%80%82%22%0A%3E%0A%3E%E6%BC%94%E8%AE%B2%E4%B8%AD%EF%BC%8C%E4%B9%94%E5%B8%83%E6%96%AF%E8%AF%B4%E4%BA%86%E4%B8%80%E6%AE%B5%E6%9C%89%E5%90%8D%E7%9A%84%E8%AF%9D%E3%80%82%0A%3E%0A%3E%22%E4%BD%A0%E4%BB%AC%E7%9A%84%E6%97%B6%E9%97%B4%E6%9C%89%E9%99%90%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%8D%E8%A6%81%E6%8A%8A%E5%AE%83%E6%B5%AA%E8%B4%B9%E5%9C%A8%E8%BF%87%E5%85%B6%E4%BB%96%E4%BA%BA%E7%9A%84%E7%94%9F%E6%B4%BB%E3%80%82%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E6%98%AF%EF%BC%8C%E4%BD%A0%E8%A6%81%E6%9C%89%E5%8B%87%E6%B0%94%E8%B7%9F%E9%9A%8F%E4%BD%A0%E7%9A%84%E5%86%85%E5%BF%83%E5%92%8C%E7%9B%B4%E8%A7%89%E3%80%82%E6%9F%90%E7%A7%8D%E7%A8%8B%E5%BA%A6%E4%B8%8A%EF%BC%8C%E5%AE%83%E4%BB%AC%E5%B7%B2%E7%BB%8F%E7%9F%A5%E9%81%93%E4%BD%A0%E7%9C%9F%E6%AD%A3%E6%83%B3%E8%A6%81%E6%88%90%E4%B8%BA%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90%E3%80%82%E5%85%B6%E4%BB%96%E6%89%80%E6%9C%89%E4%BA%8B%E6%83%85%E9%83%BD%E6%98%AF%E6%AC%A1%E8%A6%81%E7%9A%84%E3%80%82%22%0A%3E%0A%3E%E8%BF%99%E6%AE%B5%E8%AF%9D%E5%90%8E%E6%9D%A5%E8%A2%AB%E7%A7%B0%E4%B8%BA%22%E7%83%AD%E6%83%85%E5%81%87%E8%AE%BE%22%EF%BC%8C%E5%BE%88%E5%A4%9A%E4%BA%BA%E9%83%BD%E5%BC%95%E7%94%A8%E5%AE%83%E9%BC%93%E5%8A%B1%E5%B9%B4%E8%BD%BB%E4%BA%BA%EF%BC%9A%E5%AF%BB%E6%89%BE%E8%81%8C%E4%B8%9A%E6%96%B9%E5%90%91%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%A6%81%E8%B7%9F%E9%9A%8F%E5%86%85%E5%BF%83%E7%9A%84%E7%83%AD%E6%83%85%EF%BC%88passion%EF%BC%89%EF%BC%8C%E5%8E%BB%E5%81%9A%E9%82%A3%E4%BA%9B%E4%BD%A0%E6%9C%89%E5%BC%BA%E7%83%88%E6%84%8F%E6%84%BF%E4%BB%8E%E4%BA%8B%E7%9A%84%E5%B7%A5%E4%BD%9C%E3%80%82%0A%E4%BD%86%E6%98%AF%EF%BC%8C%E7%BE%8E%E5%9B%BD%E6%9C%80%E8%BF%91%E5%87%BA%E7%89%88%E4%BA%86%E4%B8%80%E6%9C%AC%E6%96%B0%E4%B9%A6%E3%80%8A%E4%BC%98%E7%A7%80%E5%88%B0%E6%97%A0%E6%B3%95%E5%BF%BD%E7%95%A5%E3%80%8B%EF%BC%88%E3%80%8ASo%20Good%20They%20Can&apos;t%20Ignore%20You%E3%80%8B%EF%BC%89%EF%BC%8C%E5%A3%B0%E7%A7%B0%E4%B9%94%E5%B8%83%E6%96%AF%E7%9A%84%E8%BF%99%E4%B8%AA%E5%BB%BA%E8%AE%AE%E6%98%AF%E5%AE%8C%E5%85%A8%E9%94%99%E8%AF%AF%E7%9A%84%EF%BC%8C%E8%AF%AF%E5%AF%BC%E5%B9%B4%E8%BD%BB%E4%BA%BA%E3%80%82%E5%88%AB%E7%9A%84%E4%B8%8D%E8%AF%B4%EF%BC%8C%E4%B9%94%E5%B8%83%E6%96%AF%E6%9C%AC%E4%BA%BA%E4%B9%9F%E4%B8%8D%E9%81%B5%E5%AE%88%22%E7%83%AD%E6%83%85%E5%81%87%E8%AE%BE%22%E3%80%82%E5%B9%B4%E8%BD%BB%E6%97%B6%EF%BC%8C%E4%BB%96%E5%AF%B9%E7%A6%85%E5%AE%97%E6%80%9D%E6%83%B3%E6%9C%80%E6%84%9F%E5%85%B4%E8%B6%A3%EF%BC%8C%E5%8E%BB%E5%8D%B0%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%BD%9B%E6%95%99%E3%80%82%E5%A6%82%E6%9E%9C%E4%BB%96%E7%9C%9F%E7%9A%84%E8%BF%BD%E9%9A%8F%E8%87%AA%E5%B7%B1%E7%9A%84%E5%86%85%E5%BF%83%EF%BC%8C%E4%BB%96%E5%B0%B1%E5%BA%94%E8%AF%A5%E5%8E%BB%E5%BD%93%E4%B8%80%E4%B8%AA%E7%A6%85%E5%AE%97%E8%80%81%E5%B8%88%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E8%B7%91%E5%9B%9E%E7%BE%8E%E5%9B%BD%E5%88%9B%E5%8A%9E%E8%8B%B9%E6%9E%9C%E5%85%AC%E5%8F%B8%E3%80%82%0A%3E%0A%3E%E8%BF%99%E6%9C%AC%E4%B9%A6%E8%AE%A4%E4%B8%BA%EF%BC%8C%E4%BB%A5%E4%B8%8B%E5%87%A0%E4%B8%AA%E5%8E%9F%E5%9B%A0%E5%AF%BC%E8%87%B4%22%E7%83%AD%E6%83%85%E5%81%87%E8%AE%BE%22%E4%B8%8D%E6%98%AF%E4%B8%80%E4%B8%AA%E5%A5%BD%E7%9A%84%E5%BB%BA%E8%AE%AE%E3%80%82%0A%3E%0A%3E%E7%AC%AC%E4%B8%80%EF%BC%8C%E7%83%AD%E6%83%85%E7%9C%9F%E7%9A%84%E5%BE%88%E7%BD%95%E8%A7%81%E3%80%82%E5%A4%A7%E9%83%A8%E5%88%86%E4%BA%BA%E9%83%BD%E5%AF%B9%E8%87%AA%E5%B7%B1%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B2%A1%E5%85%B4%E8%B6%A3%EF%BC%8C%E8%80%8C%E6%98%AF%E5%AF%B9%E6%9F%90%E7%A7%8D%E7%88%B1%E5%A5%BD%EF%BC%88%E6%AF%94%E5%A6%82%E6%89%93%E7%90%83%E3%80%81%E9%92%93%E9%B1%BC%EF%BC%89%E6%9C%89%E5%85%B4%E8%B6%A3%E3%80%82%E5%A6%82%E6%9E%9C%E5%A4%A7%E9%83%A8%E5%88%86%E4%BA%BA%E9%83%BD%E6%89%BE%E4%B8%8D%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E8%81%8C%E4%B8%9A%E7%83%AD%E6%83%85%EF%BC%8C%E4%BD%A0%E6%80%8E%E4%B9%88%E8%83%BD%E5%8F%AB%E4%BB%96%E4%BB%AC%E5%8E%BB%E8%BF%BD%E9%9A%8F%E7%83%AD%E6%83%85%E5%91%A2%EF%BC%9F%0A%3E%0A%3E%E7%AC%AC%E4%BA%8C%EF%BC%8C%E7%83%AD%E6%83%85%E9%9C%80%E8%A6%81%E6%97%B6%E9%97%B4%E6%9D%A5%E5%BB%BA%E7%AB%8B%E3%80%82%E8%AE%B8%E5%A4%9A%E4%BA%BA%E5%88%9A%E5%BC%80%E5%A7%8B%E5%B7%A5%E4%BD%9C%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%AF%B9%E8%87%AA%E5%B7%B1%E7%9A%84%E8%81%8C%E4%B8%9A%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%85%B4%E8%B6%A3%EF%BC%8C%E9%9A%8F%E7%9D%80%E6%97%B6%E9%97%B4%E7%A7%AF%E7%B4%AF%EF%BC%8C%E4%BB%96%E4%BB%AC%E7%9A%84%E7%BB%8F%E9%AA%8C%E8%B6%8A%E6%9D%A5%E8%B6%8A%E5%A4%9A%EF%BC%8C%E8%83%BD%E5%A4%9F%E6%8E%8C%E6%8E%A7%E7%9A%84%E4%B8%9C%E8%A5%BF%E8%B6%8A%E6%9D%A5%E8%B6%8A%E5%A4%9A%EF%BC%8C%E8%BF%99%E6%89%8D%E6%85%A2%E6%85%A2%E5%BC%80%E5%A7%8B%E7%83%AD%E7%88%B1%E8%87%AA%E5%B7%B1%E7%9A%84%E5%B7%A5%E4%BD%9C%E3%80%82%E6%89%BE%E5%B7%A5%E4%BD%9C%E9%98%B6%E6%AE%B5%EF%BC%8C%E4%BD%A0%E5%8F%AF%E8%83%BD%E6%A0%B9%E6%9C%AC%E4%B8%8D%E4%BC%9A%E6%84%8F%E8%AF%86%E5%88%B0%E8%BF%99%E4%B8%AA%E8%81%8C%E4%B8%9A%E5%B0%B1%E6%98%AF%E4%BD%A0%E7%9A%84%E7%83%AD%E6%83%85%E6%89%80%E5%9C%A8%E3%80%82%0A%3E%0A%3E%E7%AC%AC%E4%B8%89%EF%BC%8C%E8%BF%87%E5%BA%A6%E5%BC%BA%E8%B0%83%E7%83%AD%E6%83%85%EF%BC%8C%E5%AE%B9%E6%98%93%E5%AF%B9%E7%8E%B0%E7%8A%B6%E4%BA%A7%E7%94%9F%E4%B8%8D%E6%BB%A1%E3%80%822010%E5%B9%B4%E7%9A%84%E4%B8%80%E9%A1%B9%E8%B0%83%E6%9F%A5%E5%8F%91%E7%8E%B0%EF%BC%8C%E5%8F%AA%E6%9C%8945%EF%BC%85%E7%9A%84%E7%BE%8E%E5%9B%BD%E4%BA%BA%E5%AF%B9%E8%87%AA%E5%B7%B1%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%BB%A1%E6%84%8F%E3%80%82%E7%94%B1%E4%BA%8E%E5%BE%88%E5%A4%9A%E4%BA%BA%E7%9B%B8%E4%BF%A1%EF%BC%8C%E6%97%A0%E6%B3%95%E4%BA%A7%E7%94%9F%E7%83%AD%E6%83%85%E7%9A%84%E5%B7%A5%E4%BD%9C%E4%B8%8D%E6%98%AF%E5%A5%BD%E5%B7%A5%E4%BD%9C%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%AF%B9%E8%81%8C%E4%B8%9A%E7%94%9F%E6%B6%AF%E6%8A%B1%E6%9C%89%E4%B8%8D%E5%88%87%E5%AE%9E%E9%99%85%E7%9A%84%E6%9C%9F%E6%9C%9B%EF%BC%8C%E5%AF%B9%E7%8E%B0%E6%9C%89%E7%9A%84%E5%B7%A5%E4%BD%9C%E4%B8%8D%E6%BB%A1%E6%84%8F%EF%BC%8C%E4%B8%8D%E6%96%AD%E8%B7%B3%E6%A7%BD%E3%80%82%0A%3E%0A%3E%E8%BF%99%E6%9C%AC%E4%B9%A6%E6%8F%90%E5%87%BA%EF%BC%8C%E7%83%AD%E6%83%85%E4%B8%8D%E6%98%AF%E5%87%AD%E7%A9%BA%E4%BA%A7%E7%94%9F%E7%9A%84%EF%BC%8C%E5%AE%83%E8%B7%9F%E8%87%AA%E4%B8%BB%E6%9D%83%E6%9C%89%E5%85%B3%E3%80%82%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%9C%A8%E6%9F%90%E4%B8%AA%E8%81%8C%E4%BD%8D%E4%B8%8A%E7%9A%84%E8%87%AA%E4%B8%BB%E6%9D%83%E8%B6%8A%E5%A4%A7%EF%BC%8C%E8%83%BD%E5%A4%9F%E6%8E%8C%E6%8E%A7%E7%9A%84%E4%B8%9C%E8%A5%BF%E8%B6%8A%E5%A4%9A%EF%BC%8C%E5%B0%B1%E8%B6%8A%E5%AE%B9%E6%98%93%E5%AF%B9%E5%BD%93%E5%89%8D%E7%9A%84%E8%81%8C%E4%B8%9A%E4%BA%A7%E7%94%9F%E7%83%AD%E6%83%85%E3%80%82%E4%B8%8E%E5%85%B6%E5%BC%BA%E8%B0%83%E8%B7%9F%E9%9A%8F%E5%86%85%E5%BF%83%E7%9A%84%E7%83%AD%E6%83%85%EF%BC%8C%E4%B8%8D%E5%A6%82%E5%BC%BA%E8%B0%83%E5%A6%82%E4%BD%95%E5%9C%A8%E6%9F%90%E7%A7%8D%E8%81%8C%E4%B8%9A%E9%87%8C%E9%9D%A2%E8%8E%B7%E5%BE%97%E8%87%AA%E4%B8%BB%E6%9D%83%E3%80%82%E4%BD%A0%E5%BF%85%E9%A1%BB%E4%BD%BF%E8%87%AA%E5%B7%B1%E5%8F%98%E5%BE%97%E4%BC%98%E7%A7%80%EF%BC%8C%E8%AE%A9%E5%88%AB%E4%BA%BA%E6%97%A0%E6%B3%95%E5%BF%BD%E8%A7%86%E4%BD%A0%EF%BC%8C%E5%90%8C%E6%84%8F%E8%AE%A9%E4%BD%A0%E6%8E%8C%E6%8E%A7%E6%9B%B4%E5%A4%9A%E7%9A%84%E8%B5%84%E6%BA%90%EF%BC%8C%E8%BF%99%E5%B0%B1%E6%98%AF%E4%B9%A6%E5%90%8D%E7%9A%84%E5%90%AB%E4%B9%89%E3%80%82%0A%0A%E5%9C%A8%E8%BF%99%E4%B9%8B%E5%89%8D%EF%BC%8C%E6%88%91%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%90%AC%E8%BF%87%E3%80%81%E7%9C%8B%E8%BF%87%E6%88%96%E8%AF%BB%E8%BF%87%E4%B9%94%E5%B8%83%E6%96%AF%E7%9A%84%E6%BC%94%E8%AE%B2%E4%BB%A5%E5%8F%8A%E3%80%8A%E4%B9%94%E5%B8%83%E6%96%AF%E4%BC%A0%E3%80%8B%E3%80%82%E5%9B%A0%E4%B8%BA%E8%BF%99%E7%AF%87%E5%8D%9A%E6%96%87%E5%92%8C%E6%83%B3%E5%86%99%E7%9A%84%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%EF%BC%8C%E6%88%91%E7%89%B9%E6%84%8F%E5%8E%BB%E8%AF%BB%E4%BA%86%E4%B9%94%E5%B8%83%E6%96%AF%E7%9A%84%E6%BC%94%E8%AE%B2%E7%A8%BF%E3%80%82%E5%85%B3%E4%BA%8E%E4%B9%94%E5%B8%83%E6%96%AF%E7%9A%84%E8%A7%82%E7%82%B9%EF%BC%8C%E6%88%91%E4%B8%8D%E8%83%BD%E5%90%8C%E6%84%8F%E6%9B%B4%E5%A4%9A%E3%80%82%E4%B8%80%E4%B8%AA%E4%BA%BA%E6%83%B3%E8%A6%81%E5%9C%A8%E4%B8%80%E4%BB%B6%E4%BA%8B%E6%83%85%E4%B8%8A%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9D%A0%E7%9A%84%E4%B8%8D%E5%BA%94%E5%BD%93%E6%98%AF%E5%A4%96%E9%83%A8%E7%9A%84%E6%9D%A1%E6%9D%A1%E6%A1%86%E6%A1%86%EF%BC%8C%E6%88%96%E8%80%85%E6%98%AF%E5%90%84%E5%BC%8F%E5%90%84%E6%A0%B7%EF%BC%8C%E5%BD%A2%E5%BD%A2%E8%89%B2%E8%89%B2%E7%9A%84%E6%AF%92%E9%B8%A1%E6%B1%A4%E3%80%82%E6%89%80%E6%9C%89%E7%9A%84%E5%8A%A8%E5%8A%9B%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%9D%A5%E8%87%AA%E4%BA%8E%E4%BD%A0%E7%9A%84%E5%86%85%E5%BF%83%E3%80%82%E5%81%9A%E8%BF%99%E4%BB%B6%E4%BA%8B%E6%9C%AC%E8%BA%AB%E6%8F%90%E4%BE%9B%E7%BB%99%E4%BD%A0%E7%9A%84%E5%BF%AB%E4%B9%90%EF%BC%8C%E6%89%8D%E8%83%BD%E6%BF%80%E5%8A%B1%E4%BD%A0%E6%8C%81%E7%BB%AD%E7%9A%84%E5%9D%9A%E6%8C%81%E4%B8%8B%E5%8E%BB%EF%BC%8C%E6%8C%81%E7%BB%AD%E5%9C%B0%E5%8E%BB%E4%BB%98%E5%87%BA%E3%80%82%E5%9B%A0%E4%B8%BA%E4%BB%96%E6%8C%81%E7%BB%AD%E7%9A%84%E7%94%A8%E5%BF%AB%E4%B9%90%E6%9D%A5%E5%9B%9E%E9%A6%88%EF%BC%8C%E4%BD%A0%E6%89%8D%E4%B8%8D%E4%BC%9A%E8%AE%A1%E8%BE%83%E4%BB%98%E5%87%BA%E7%9A%84%E5%A4%9A%E5%AF%A1%E3%80%82%E8%BF%99%E6%A0%B7%E7%9A%84%E5%9B%9E%E6%8A%A5%E6%89%8D%E4%BC%9A%E4%B8%B0%E5%8E%9A%EF%BC%8C%E5%9B%A0%E4%B8%BA%E4%BD%A0%E4%BB%98%E5%87%BA%E7%9A%84%E5%A4%9A%E3%80%82%E8%80%8C%E5%A4%96%E9%83%A8%E7%9A%84%E4%B8%80%E5%88%87%E5%9B%A0%E7%B4%A0%EF%BC%8C%E6%88%96%E6%98%AF%E6%BF%80%E5%8A%B1%EF%BC%8C%E6%88%96%E6%98%AF%E5%88%BA%E6%BF%80%E9%83%BD%E6%98%AF%E4%B8%8D%E7%A8%B3%E5%AE%9A%E7%9A%84%EF%BC%8C%E9%83%BD%E6%98%AF%E6%98%93%E5%8F%98%E7%9A%84%E3%80%82%E4%BB%8A%E5%A4%A9%E6%B5%81%E8%A1%8C%E8%BF%99%E4%B8%AA%EF%BC%8C%E6%98%8E%E5%A4%A9%E6%B5%81%E8%A1%8C%E9%82%A3%E4%B8%AA%3B%E6%9B%BE%E7%BB%8F%E4%BA%92%E8%81%94%E7%BD%91%E7%81%AB%EF%BC%8C%E7%8E%B0%E5%9C%A8AI%E7%81%AB%3B%E4%BB%8A%E5%A4%A9%E5%90%AC%E8%A6%81%E4%BF%9D%E6%8C%81%E7%83%AD%E6%83%85%E8%A6%81%E5%A5%8B%E6%96%97%EF%BC%8C%E5%BF%83%E9%87%8C%E5%83%8F%E6%89%93%E4%BA%86%E9%B8%A1%E8%A1%80%EF%BC%8C%E4%B8%8D%E7%A0%B4%E6%A5%BC%E5%85%B0%E6%AD%BB%E4%B8%8D%E8%BF%98%EF%BC%8C%E6%98%8E%E5%A4%A9%E5%90%AC%E4%B8%AA%E4%BA%8E%E4%B8%B9%E7%9A%84%E9%BB%84%E8%80%81%E4%B9%8B%E5%AD%A6%EF%BC%8C%E5%8F%88%E8%A6%81%E5%8F%8D%E6%80%9D%EF%BC%8C%E6%88%91%E8%BF%99%E4%B9%88%E6%8B%BC%E6%98%AF%E4%B8%BA%E4%BA%86%E8%B0%81%EF%BC%8C%E4%BA%BA%E7%94%9F%E8%80%8C%E4%B8%8D%E5%B0%B1%E6%98%AF%E4%B8%BA%E4%BA%86%E5%BF%AB%E4%B9%90%E5%90%97%EF%BC%8C%E8%BF%98%E6%98%AF%E5%B2%81%E6%9C%88%E9%9D%99%E5%A5%BD%E5%90%A7%E3%80%82%E9%97%AE%E9%97%AE%E8%87%AA%E5%B7%B1%EF%BC%8C%E6%98%AF%E4%B8%8D%E6%98%AF%E7%BB%8F%E5%B8%B8%E6%9C%89%E8%BF%99%E6%A0%B7%E7%9A%84%E5%BF%83%E7%90%86%E6%B3%A2%E5%8A%A8%EF%BC%9F%E5%A6%82%E6%9E%9C%E8%AF%95%E6%83%B3%EF%BC%8C%E4%BD%A0%E6%AF%8F%E4%B8%80%E4%B8%AA%E9%83%BD%E5%8E%BB%E8%BF%BD%E9%9A%8F%EF%BC%8C%E9%82%A3%E6%98%AF%E4%B8%8D%E6%98%AF%E4%BA%8B%E4%BA%8B%E9%83%BD%E6%98%AF%E6%B5%85%E5%B0%9D%E8%BE%84%E6%AD%A2%E5%91%A2%3F%0A%E5%85%B6%E5%AE%9E%E4%B8%96%E4%BA%8B%E4%B9%9F%E5%B9%B6%E6%B2%A1%E6%9C%89%E9%82%A3%E4%B9%88%E5%A4%8D%E6%9D%82%E3%80%82%E4%BA%BA%EF%BC%8C%E4%BD%9C%E4%B8%BA%E4%B8%80%E7%A7%8D%E5%8A%A8%E7%89%A9%EF%BC%8C%E6%80%BB%E4%BC%9A%E5%8E%BB%E8%BF%BD%E9%80%90%E8%AE%A9%E4%BD%A0%E5%BE%97%E5%88%B0%E5%BF%AB%E6%84%9F%E7%9A%84%E4%BA%8B%E6%83%85%E3%80%82%E6%AF%94%E5%A6%82%EF%BC%8C%E5%90%83%EF%BC%8C%E6%9C%89%E5%A4%9A%E5%B0%91%E4%BA%BA%E5%8F%91%E8%AA%93%E8%A6%81%E5%87%8F%E8%82%A5%EF%BC%8C%E4%BD%86%E8%BD%AC%E8%84%B8%E5%B0%B1%E5%BF%8D%E4%B8%8D%E4%BD%8F%EF%BC%8C%E5%9B%A0%E4%B8%BA%E7%BE%8E%E9%A3%9F%E5%9C%A8%E4%BD%A0%E7%9A%84%E6%BD%9C%E6%84%8F%E8%AF%86%E9%87%8C%E4%BB%A3%E8%A1%A8%E4%BA%86%E7%BE%8E%E5%A5%BD%E3%80%82%E4%BE%8B%E5%A6%82%E5%A4%AB%E5%A6%BB%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9B%BE%E7%BB%8F%E5%A6%82%E8%83%B6%E4%BC%BC%E6%BC%86%EF%BC%8C%E7%8E%B0%E5%9C%A8%E5%8D%B4%E6%88%BF%E4%BA%8B%E5%86%B7%E6%B7%A1%EF%BC%8C%E5%9B%A0%E4%B8%BA%E4%BD%A0%E4%BB%AC%E6%9B%BE%E7%BB%8F%E5%8A%AA%E5%8A%9B%E5%9C%B0%E5%8E%BB%E8%90%A5%E9%80%A0%E7%BE%8E%E5%A5%BD%EF%BC%8C%E5%90%8E%E6%9D%A5%E5%B9%B3%E6%B7%A1%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%B8%80%E5%AE%9A%E6%98%AF%E6%9C%89%E4%BA%86%E6%B2%A1%E9%82%A3%E4%B9%88%E7%BE%8E%E5%A6%99%E7%9A%84%E4%B8%80%E6%AC%A1%E6%88%96%E5%87%A0%E6%AC%A1%EF%BC%8C%E5%A4%AB%E5%A6%BB%E4%B9%8B%E4%BA%8B%E5%9C%A8%E6%BD%9C%E6%84%8F%E8%AF%86%E5%B7%B2%E7%BB%8F%E4%B8%8D%E4%BB%A3%E8%A1%A8%E5%BF%AB%E4%B9%90%E3%80%82%E5%86%8D%E4%B8%BE%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%81%B0%E5%BD%93%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%8C%E4%B8%80%E4%B8%AA%E7%98%BE%E5%90%9B%E5%AD%90%E4%BB%96%E4%B8%8D%E7%9F%A5%E9%81%93%E6%AF%92%E5%93%81%E7%9A%84%E5%8D%B1%E5%AE%B3%E5%90%97%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E6%9C%89%E4%BA%BA%E6%8A%8A%E8%87%AA%E5%B7%B1%E5%BE%80%E4%B8%87%E5%8A%AB%E4%B8%8D%E5%A4%8D%E7%9A%84%E6%B7%B1%E6%B8%8A%E6%8E%A8%EF%BC%9F%E5%9B%A0%E4%B8%BA%E9%82%A3%E6%98%AF%E6%9D%A5%E8%87%AA%E5%BF%83%E5%BA%95%E7%9A%84%E5%AF%B9%E9%82%A3%E4%BB%BD%E5%BF%AB%E6%84%9F%E7%9A%84%E8%BF%BD%E6%B1%82%E3%80%82%0A%E6%89%80%E4%BB%A5%E5%86%85%E5%BF%83%E7%9A%84%E7%83%AD%E6%83%85%EF%BC%8C%E6%88%96%E8%80%85%E6%84%89%E6%82%A6%E7%9A%84%E6%84%9F%E8%A7%89%EF%BC%8C%E6%89%8D%E6%98%AF%E7%A8%B3%E5%AE%9A%E7%9A%84%E5%8A%A8%E5%8A%9B%E4%B9%8B%E6%BA%90%E3%80%82%E4%B8%8A%E5%8D%87%E5%88%B0%E5%93%B2%E5%AD%A6%E7%9A%84%E8%A7%92%E5%BA%A6%2C%20%E4%B8%8D%E6%98%AF%E8%AF%B4%E5%86%85%E5%9B%A0%E6%89%8D%E6%B0%B8%E8%BF%9C%E6%98%AF%E4%B8%BB%E5%AF%BC%E5%9B%A0%E7%B4%A0%E5%90%97%EF%BC%9F%E6%88%91%E4%BB%AC%E8%99%BD%E7%84%B6%E6%B2%A1%E6%B3%95%E5%83%8F%E7%98%BE%E5%90%9B%E5%AD%90%E9%82%A3%E6%A0%B7%E6%AD%87%E6%96%AF%E5%BA%95%E9%87%8C%E5%9C%B0%E8%BF%BD%E6%B1%82%E6%88%91%E4%BB%AC%E7%9A%84%E6%A2%A6%E6%83%B3%EF%BC%8C%E4%BD%86%E6%88%91%E4%BB%AC%E8%87%B3%E5%B0%91%E5%8F%AF%E4%BB%A5%E6%9C%89%E6%84%8F%E8%AF%86%E5%9C%B0%E5%AF%BB%E6%89%BE%E9%82%A3%E4%BB%BD%E5%8E%9F%E5%A7%8B%E8%80%8C%E7%AE%80%E5%8D%95%E7%9A%84%E5%BF%AB%E4%B9%90%E3%80%82%0A%E5%86%8D%E8%AF%B4%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B9%94%E5%B8%83%E6%96%AF%E6%B2%A1%E5%8E%BB%E5%81%9A%E7%A6%85%E5%AE%97%E8%80%81%E5%B8%88%E3%80%82%E5%9B%A0%E4%B8%BA%E4%B8%96%E4%BA%8B%E9%83%BD%E6%98%AF%E5%8A%A8%E6%80%81%E7%9A%84%E3%80%82%E4%BD%A0%E5%8F%AF%E8%83%BD%E6%9F%90%E6%97%B6%E6%9F%90%E5%88%BB%E5%AF%B9%E6%9F%90%E4%B8%80%E4%BB%B6%E4%BA%8B%E7%89%A9%E7%89%B9%E5%88%AB%E7%97%B4%E8%BF%B7%EF%BC%8C%E4%BD%86%E9%9A%8F%E7%9D%80%E4%BD%A0%E7%9A%84%E6%88%90%E9%95%BF%E4%B8%8E%E8%AE%A4%E8%AF%86%E7%9A%84%E6%B7%B1%E5%88%BB%EF%BC%8C%E4%BD%A0%E5%8F%AF%E8%83%BD%E5%B9%B6%E4%B8%8D%E8%83%BD%E5%8F%91%E7%8E%B0%E5%AE%83%E8%83%BD%E6%8C%81%E7%BB%AD%E5%9C%B0%E7%BB%99%E4%BD%A0%E5%BF%AB%E4%B9%90%E3%80%82%E6%9B%B4%E5%A4%9A%E7%9A%84%E5%8F%AA%E6%98%AF%E4%B8%80%E6%97%B6%E7%9A%84%E5%88%BA%E6%BF%80%E3%80%82%E8%BF%99%E9%87%8C%E6%89%80%E8%B0%93%E7%9A%84%E7%88%B1%E5%A5%BD%EF%BC%8C%E5%BA%94%E5%BD%93%E6%98%AF%E8%83%BD%E4%B8%80%E7%9B%B4%E5%90%B8%E5%BC%95%E4%BD%A0%E8%B5%B0%E5%87%BA%E5%BF%83%E7%90%86%E8%88%92%E9%80%82%E5%8C%BA%E7%9A%84%E4%B8%9C%E8%A5%BF%E3%80%82%E6%89%80%E4%BB%A5%EF%BC%8C%E7%9C%8B%E7%94%B5%E5%BD%B1%EF%BC%8C%E4%B8%8A%E7%BD%91%E8%BF%99%E7%A7%8D%E5%B0%B1%E4%B8%8D%E8%83%BD%E7%AE%97%E6%98%AF%E7%88%B1%E5%A5%BD%E4%BA%86%E3%80%82%E8%BF%99%E4%B9%9F%E6%98%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BE%88%E5%A4%9A%E4%BA%BA%E5%96%9C%E6%AC%A2%E6%89%93%E7%90%83%EF%BC%8C%E9%92%93%E9%B1%BC%EF%BC%8C%E5%8D%B4%E4%B8%8D%E8%83%BD%E5%B0%86%E5%AE%83%E4%BB%AC%E5%8F%98%E4%B8%BA%E8%81%8C%E4%B8%9A%E7%9A%84%E5%8E%9F%E5%9B%A0%E3%80%82%E5%9B%A0%E4%B8%BA%E5%AE%83%E4%BB%AC%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%BF%AB%E4%B9%90%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%98%AF%E6%84%9F%E5%AE%98%E4%B8%8A%E7%9A%84%E5%88%BA%E6%BF%80%EF%BC%8C%E6%88%96%E6%98%AF%E5%BF%83%E9%87%8C%E6%94%BE%E6%9D%BE%E5%B8%A6%E6%9D%A5%E7%9A%84%E8%BD%BB%E6%9D%BE%E8%88%92%E9%80%82%EF%BC%8C%E4%BD%86%E5%AE%83%E4%BB%AC%E4%B8%8D%E8%B6%B3%E4%BB%A5%E8%AE%A9%E4%BD%A0%E8%BF%88%E5%87%BA%E5%BF%83%E7%90%86%E8%88%92%E9%80%82%E5%8C%BA%E3%80%82%E4%BD%A0%E5%96%9C%E6%AC%A2%E6%89%93%E7%AF%AE%E7%90%83%EF%BC%8C%E9%82%A3%E4%BD%A0%E8%83%BD%E5%81%9A%E5%88%B0%E6%AF%8F%E5%A4%A9%E7%BB%831000%E6%AC%A1%E6%8A%95%E7%AF%AE%E5%90%97%EF%BC%9F%E6%88%91%E6%83%B3%E4%BD%A0%E5%81%9A%E4%B8%8D%E5%88%B0%EF%BC%8C%E4%BD%A0%E9%80%BC%E8%87%AA%E5%B7%B1%E5%81%9A%E4%B8%80%E6%AC%A1%E4%B9%9F%E4%B8%8D%E4%BC%9A%E5%BF%AB%E4%B9%90%EF%BC%8C%E4%BD%86%E7%A7%91%E6%AF%94%E5%B0%B1%E8%83%BD%E5%81%9A%E5%88%B0%EF%BC%8C%E8%80%8C%E4%B8%94%E5%8D%81%E5%87%A0%E5%B9%B4%E5%A6%82%E4%B8%80%E6%97%A5%EF%BC%8C%E4%B9%90%E6%AD%A4%E4%B8%8D%E7%96%B2%E3%80%82%E4%BD%A0%E8%A7%89%E5%BE%97%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E5%9C%A8%E6%BF%80%E5%8A%B1%E4%BB%96%E5%90%97%EF%BC%9F%E5%AF%B9%E7%AF%AE%E7%90%83%E7%9A%84%E7%83%AD%E7%88%B1%EF%BC%8C%E8%BF%99%E5%B0%B1%E6%98%AF%E9%82%A3%E4%BB%BD%E6%9C%80%E5%8E%9F%E5%A7%8B%E7%9A%84%E5%BF%AB%E4%B9%90%E3%80%82%E5%88%AB%E8%AF%B4%E7%AF%AE%E7%90%83%EF%BC%8C%E9%92%93%E9%B1%BC%E4%B8%8D%E8%83%BD%E5%81%9A%E8%81%8C%E4%B8%9A%EF%BC%8C%E5%A4%A7%E6%8A%8A%E4%BA%BA%E4%BB%A5%E6%AD%A4%E4%B8%BA%E7%94%9F%E3%80%82%E4%B9%94%E5%B8%83%E6%96%AF%E5%9C%A8%E5%8D%B0%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%9C%9F%E9%97%B4%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%B9%9F%E8%AE%A4%E6%B8%85%E4%BA%86%E8%87%AA%E5%B7%B1%EF%BC%8C%E4%BB%96%E5%B9%B6%E4%B8%8D%E9%82%A3%E4%B9%88%E7%83%AD%E7%88%B1%E7%A6%85%E5%AE%97%E3%80%82%0A%E7%84%B6%E5%90%8E%2C%E6%88%91%E8%AE%A4%E4%B8%BA%E8%BF%99%E6%9C%AC%E3%80%8A%E4%BC%98%E7%A7%80%E5%88%B0%E6%97%A0%E6%B3%95%E5%BF%BD%E7%95%A5%E3%80%8B%E5%B0%B1%E6%98%AF%E4%B8%80%E7%A2%97%E6%BB%A1%E6%BB%A1%E7%9A%84%E6%AF%92%E9%B8%A1%E6%B1%A4%E3%80%82%E7%83%AD%E6%83%85%E7%A1%AE%E5%AE%9E%E5%BE%88%E7%BD%95%E8%A7%81%EF%BC%8C%E8%BF%99%E4%B9%9F%E6%98%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%84%E8%A1%8C%E5%90%84%E4%B8%9A%E7%9C%9F%E6%AD%A3%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%E9%83%BD%E5%8F%AA%E6%98%AF%E5%87%A4%E6%AF%9B%E9%B3%9E%E8%A7%92%E3%80%82%E4%BD%86%E8%BF%99%E5%B9%B6%E4%B8%8D%E4%BB%A3%E8%A1%A8%E6%88%91%E4%BB%AC%E4%B8%8D%E5%BF%85%E8%BF%BD%E9%80%90%E4%BC%98%E7%A7%80%E3%80%82%E5%B0%A4%E5%85%B6%E5%9C%A8%E4%B8%AD%E5%9B%BD%E7%9A%84%E6%95%99%E8%82%B2%E7%8E%AF%E5%A2%83%E4%B8%8B%EF%BC%8C%E8%BF%99%E7%82%B9%E5%B0%A4%E5%85%B6%E9%87%8D%E8%A6%81%E3%80%82%E5%9B%A0%E4%B8%BA%E4%BB%8E%E5%B0%8F%E5%88%B0%E5%A4%A7%EF%BC%8C%E9%83%BD%E6%B4%BB%E5%9C%A8%E5%88%AB%E4%BA%BA%E7%9A%84%E7%9C%BC%E4%B8%AD%E3%80%82%E6%89%80%E6%9C%89%E7%9A%84%E5%86%B3%E5%AE%9A%E9%83%BD%E6%98%AF%E6%8A%8A%E6%88%91%E4%BB%AC%E5%A1%91%E9%80%A0%E6%88%90%E7%88%B6%E6%AF%8D%E6%83%B3%E8%AE%A9%E6%88%91%E4%BB%AC%E6%88%90%E4%B8%BA%E7%9A%84%E4%BA%BA%E3%80%82%E5%81%9A%E7%9A%84%E4%B8%80%E5%88%87%E5%8A%AA%E5%8A%9B%E9%83%BD%E6%98%AF%E4%B8%BA%E4%BA%86%E6%88%90%E4%B8%BA%E8%80%81%E5%B8%88%E7%9C%BC%E4%B8%AD%E7%9A%84%E5%A5%BD%E5%AD%A6%E7%94%9F%E3%80%82%E4%BB%8E%E6%9D%A5%E9%83%BD%E6%B2%A1%E6%9C%89%E4%BA%BA%E7%9C%9F%E7%9A%84%E5%9C%A8%E4%B9%8E%E6%88%91%E4%BB%AC%E5%96%9C%E6%AC%A2%E4%BB%80%E4%B9%88%EF%BC%8C%E6%93%85%E9%95%BF%E4%BB%80%E4%B9%88%E3%80%82%E4%B8%8D%E8%A6%81%E5%91%8A%E8%AF%89%E6%88%91%E4%BB%80%E4%B9%88%E5%B9%B2%E4%B8%80%E8%A1%8C%E7%88%B1%E4%B8%80%E8%A1%8C%E3%80%82%E7%88%B1%E4%B8%8D%E6%98%AF%E4%B8%8D%E8%AE%A8%E5%8E%8C%E3%80%82%E8%AF%B4%E4%B8%8D%E8%AE%A8%E5%8E%8C%E7%9A%84%EF%BC%8C%E5%A4%9A%E5%8D%8A%E6%98%AF%E4%B8%8D%E7%88%B1%E3%80%82%E7%88%B1%E6%98%AF%E9%9C%80%E8%A6%81%E4%BD%A0%E8%83%BD%E6%84%9F%E5%8F%97%E5%88%B0%E9%82%A3%E4%B8%80%E4%BB%BD%E5%BF%AB%E4%B9%90%EF%BC%8C%E8%83%BD%E4%B8%8D%E6%96%AD%E6%BF%80%E5%8F%91%E8%87%AA%E5%B7%B1%E5%8E%BB%E7%AA%81%E7%A0%B4%E8%87%AA%E5%B7%B1%E7%9A%84%E3%80%82%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%8F%AA%E6%98%AF%E5%9B%A0%E4%B8%BA%E4%B8%8D%E8%AE%A8%E5%8E%8C%EF%BC%8C%E8%80%8C%E5%8A%AA%E5%8A%9B%E5%8E%8B%E5%88%B6%E8%87%AA%E5%B7%B1%E7%9A%84%E7%83%AD%E6%83%85%EF%BC%8C%E8%BF%99%E5%A6%A8%E7%A2%8D%E4%BA%86%E4%BD%A0%E7%9A%84%E5%BF%AB%E4%B9%90%EF%BC%8C%E4%B9%9F%E9%98%BB%E6%8C%A1%E4%BA%86%E4%BD%A0%E6%88%90%E4%B8%BA%E6%9B%B4%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%E3%80%82%0A%E7%83%AD%E6%83%85%E7%9A%84%E5%BB%BA%E7%AB%8B%E7%A1%AE%E5%AE%9E%E9%9C%80%E8%A6%81%E6%97%B6%E9%97%B4%E3%80%82%E4%BD%86%E6%88%91%E8%AE%A4%E4%B8%BA%E5%B9%B6%E4%B8%8D%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%8E%8C%E6%8E%A7%E7%9A%84%E4%B8%9C%E8%A5%BF%E8%B6%8A%E6%9D%A5%E8%B6%8A%E5%A4%9A%E6%89%8D%E5%AF%BC%E8%87%B4%E7%83%AD%E6%83%85%E3%80%82%E8%80%8C%E6%98%AF%E5%9C%A8%E8%B6%8A%E6%9D%A5%E8%B6%8A%E5%A4%9A%E7%9A%84%E5%8E%86%E7%BB%83%E4%B8%AD%EF%BC%8C%E5%8F%91%E7%8E%B0%E8%87%AA%E5%B7%B1%EF%BC%8C%E6%8E%A2%E7%B4%A2%E8%87%AA%E5%B7%B1%EF%BC%8C%E5%88%B0%E5%BA%95%E5%96%9C%E6%AC%A2%E4%BB%80%E5%B9%B6%E4%B8%94%E6%93%85%E9%95%BF%E4%BB%80%E4%B9%88%EF%BC%8C%E5%B9%B6%E6%9C%80%E7%BB%88%E4%BB%A5%E6%AD%A4%E4%BD%9C%E4%B8%BA%E9%95%BF%E6%9C%9F%E7%9A%84%E8%81%8C%E4%B8%9A%E7%9B%AE%E6%A0%87%E3%80%82%E5%88%9A%E6%AF%95%E4%B8%9A%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%88%91%E4%BB%AC%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%E7%BB%8F%E5%8E%86%EF%BC%8C%E5%BE%88%E5%A4%9A%E4%BA%8B%E6%83%85%E9%9D%A0%E6%83%B3%E8%B1%A1%E3%80%82%E4%BD%86%E5%BE%88%E5%A4%9A%E4%BA%8B%E6%83%85%E5%8F%AA%E6%9C%89%E7%BB%8F%E5%8E%86%E4%BA%86%E6%89%8D%E8%83%BD%E7%BB%99%E5%87%BA%E6%81%B0%E5%BD%93%E7%9A%84%E8%AF%84%E6%96%AD%E3%80%82%E6%89%80%E4%BB%A5%E5%8D%83%E4%B8%87%E4%B8%8D%E8%A6%81%E4%BB%A5%E6%88%91%E8%A7%89%E5%BE%97%E6%88%91%E5%96%9C%E6%AC%A2%E4%BB%80%E4%B9%88%EF%BC%8C%E6%88%96%E8%80%85%E6%88%91%E4%B8%8D%E8%AE%A8%E5%8E%8C%E4%BB%80%E4%B9%88%E6%9D%A5%E4%BD%9C%E8%AF%84%E5%88%A4%E7%83%AD%E6%83%85%E7%9A%84%E6%A0%87%E5%87%86%E3%80%82%E9%80%89%E6%8B%A9%E4%B8%80%E9%A1%B9%E4%BA%8B%E6%83%85%EF%BC%8C%E5%B0%B1%E8%A6%81%E5%85%A8%E8%BA%AB%E6%80%A7%E7%9A%84%E6%8A%95%E5%85%A5%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%89%8D%E8%83%BD%E5%9C%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E4%B8%8D%E6%96%AD%E7%9A%84%E4%BA%86%E8%A7%A3%E8%87%AA%E5%B7%B1%E3%80%82%E5%90%A6%E5%88%99%E4%BB%BB%E4%BD%95%E4%BA%8B%E6%83%85%E9%83%BD%E6%B5%85%E5%B0%9D%E8%BE%84%E6%AD%A2%EF%BC%8C%E4%B9%9F%E5%B9%B6%E4%B8%8D%E4%BC%9A%E5%AF%B9%E8%AE%A4%E7%9F%A5%E8%87%AA%E5%B7%B1%E5%B8%A6%E6%9D%A5%E6%9B%B4%E5%A4%A7%E7%9A%84%E5%B8%AE%E5%8A%A9%EF%BC%8C%E7%9B%B8%E5%8F%8D%E5%8D%B4%E6%B5%AA%E8%B4%B9%E4%BA%86%E5%AE%9D%E8%B4%B5%E7%9A%84%E6%97%B6%E9%97%B4%E3%80%82%E6%88%91%E8%AE%A4%E4%B8%BA%E6%AF%8F%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95%E7%9A%84%E6%97%B6%E9%97%B4%E8%87%B3%E5%B0%91%E4%BB%A5%E5%B9%B4%E4%B8%BA%E5%8D%95%E4%BD%8D%E3%80%82%E9%80%9A%E5%B8%B8%E4%B8%80%E4%B8%AA%E6%9C%AC%E7%A7%91%E7%94%9F22%E5%B2%81%E6%AF%95%E4%B8%9A%EF%BC%8C%E5%88%B030%E5%B2%81%E6%9C%898%E5%B9%B4%E7%9A%84%E6%97%B6%E9%97%B4%EF%BC%8C%E7%A1%95%E5%A3%AB%E7%94%9F%E6%9C%895%EF%BD%9E6%E5%B9%B4%E3%80%82%E6%8A%93%E4%BD%8F%E8%BF%99%E5%87%A0%E5%B9%B4%E7%9A%84%E6%97%B6%E9%97%B4%EF%BC%8C%E5%90%8E%E9%9D%A2%E5%86%8D%E6%83%B3%E5%B0%9D%E8%AF%95%EF%BC%8C%E4%BD%A0%E7%9A%84%E6%9C%BA%E4%BC%9A%E6%88%90%E6%9C%AC%E4%BC%9A%E6%9B%B4%E9%AB%98%E3%80%82%E5%BD%93%E5%8F%91%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%A1%AE%E5%AE%9E%E7%BC%BA%E4%B9%8F%E7%83%AD%E6%83%85%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%B9%9F%E8%A6%81%E5%B0%BD%E5%BF%AB%E7%9A%84%E6%8A%93%E4%BD%8F%E5%B0%9D%E8%AF%95%E6%96%B0%E6%96%B9%E5%90%91%E7%9A%84%E6%9C%BA%E4%BC%9A%E3%80%82%E8%BF%99%E4%B9%9F%E5%BE%88%E9%87%8D%E8%A6%81%EF%BC%8C%E5%B0%A4%E5%85%B6%E5%AF%B9%E4%B8%AD%E5%9B%BD%E6%95%99%E8%82%B2%E5%87%BA%E6%9D%A5%E7%9A%84%E5%AD%A9%E5%AD%90%E3%80%82%E8%AE%B0%E4%BD%8F%E7%8E%B0%E5%9C%A8%E4%BD%A0%E8%A6%81%E4%B8%BA%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E8%81%8C%E4%B8%9A%E7%94%9F%E6%B6%AF%E8%B4%9F%E8%B4%A3%EF%BC%8C%E6%B2%A1%E6%9C%89%E4%BA%BA%E5%86%8D%E5%B8%AE%E4%BD%A0%E5%81%9A%E5%86%B3%E5%AE%9A%EF%BC%8C%E5%88%86%E6%8B%85%E8%B4%A3%E4%BB%BB%E3%80%82%E4%BD%A0%E8%A6%81%E5%AF%B9%E4%BD%A0%E8%87%AA%E5%B7%B1%E8%B4%9F%E8%B4%A3%E3%80%82%E5%9B%9E%E6%83%B3%E8%87%AA%E5%B7%B1%E5%BD%93%E5%88%9D%E5%88%9A%E6%AF%95%E4%B8%9A%E6%97%B6%EF%BC%8C%E5%BE%88%E5%A4%9A%E5%90%8C%E5%AD%A6%E9%83%BD%E5%81%9A%E6%8A%80%E6%9C%AF%EF%BC%8C%E7%8E%B0%E5%9C%A8%E7%9C%8B%E7%9C%8B%EF%BC%8C%E6%9C%89%E5%81%9A%E6%8A%95%E8%B5%84%E7%9A%84%EF%BC%8C%E5%81%9A%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86%E7%9A%84%EF%BC%8C%E5%81%9A%E8%80%81%E5%B8%88%E7%9A%84%E2%80%A6%E5%88%9A%E6%AF%95%E4%B8%9A%E7%9A%84%E6%97%B6%E5%80%99%E5%85%A5%E5%AF%B9%E8%A1%8C%EF%BC%8C%E7%A1%AE%E5%AE%9E%E5%BE%88%E9%87%8D%E8%A6%81%EF%BC%8C%E4%BD%86%E6%88%91%E8%AE%A4%E4%B8%BA%E6%9B%B4%E9%87%8D%E8%A6%81%E7%9A%84%E6%98%AF%E4%BD%A0%E5%AF%B9%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8E%A2%E7%B4%A2%EF%BC%8C%E5%AF%B9%E8%87%AA%E5%B7%B1%E8%AE%A4%E8%AF%86%E7%9A%84%E6%8F%90%E9%AB%98%EF%BC%8C%E6%89%8D%E8%83%BD%E7%9C%9F%E6%AD%A3%E7%9A%84%E5%B8%AE%E5%8A%A9%E4%BD%A0%E5%9C%A8%E6%9C%AA%E6%9D%A530%E5%A4%9A%E5%B9%B4%E7%9A%84%E8%81%8C%E4%B8%9A%E7%94%9F%E6%B6%AF%E4%B8%AD%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%BF%BD%E6%B1%82%E8%87%AA%E5%B7%B1%E7%9A%84%E7%83%AD%E6%83%85%EF%BC%8C%E5%81%9A%E8%87%AA%E5%B7%B1%E5%96%9C%E6%AC%A2%E5%81%9A%E7%9A%84%E4%BA%8B%EF%BC%8C%E4%BB%8E%E8%80%8C%E6%8A%8A%E8%87%AA%E5%B7%B1%E5%8F%98%E4%B8%BA%E6%9B%B4%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%E3%80%82%0A%E6%89%80%E8%B0%93%E4%BA%BA%E7%94%9F%E4%B8%8D%E5%A6%82%E6%84%8F%E8%80%85%EF%BC%8C%E5%8D%81%E4%B9%8B%E5%85%AB%E4%B9%9D%E3%80%82%E9%80%9A%E5%B8%B8%E6%88%91%E4%BB%AC%E7%94%A8%E8%BF%99%E5%8F%A5%E8%AF%9D%E6%9D%A5%E6%AF%94%E5%96%BB%E4%BA%BA%E7%94%9F%E7%9A%84%E8%89%B0%E8%BE%9B%E3%80%82%E5%85%B6%E5%AE%9E%EF%BC%8C%E8%BF%99%E4%BD%95%E5%B0%9D%E4%B8%8D%E6%98%AF%E6%AD%A3%E5%A5%BD%E8%AF%B4%E6%98%8E%E7%9D%80%E8%81%8C%E5%9C%BA%E7%9A%84%E7%8E%B0%E7%8A%B6%E5%91%A2%EF%BC%9F%E6%9C%89%E5%A4%9A%E5%B0%91%E4%BA%BA%E7%9C%9F%E6%AD%A3%E7%88%B1%E7%9D%80%E4%BD%A0%E7%8E%B0%E5%9C%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%91%A2%EF%BC%9F%E8%BF%99%E4%B8%8D%E6%AD%A3%E8%AF%B4%E6%98%8E%E4%BA%86%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%E8%BF%99%E4%B9%88%E7%A8%80%E5%B0%91%E7%9A%84%E7%BC%98%E6%95%85%E5%90%97%EF%BC%9F%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%E5%92%8C%E6%88%90%E5%8A%9F%E7%9A%84%E4%BA%8B%E4%B8%9A%E4%BB%8E%E6%9D%A5%E9%83%BD%E6%98%AF%E7%9B%B8%E8%BE%85%E7%9B%B8%E6%88%90%EF%BC%8C%E4%BA%92%E7%9B%B8%E6%88%90%E5%B0%B1%E7%9A%84%E3%80%82%E6%89%80%E8%B0%93%E5%A4%A9%E7%94%9F%E6%88%91%E6%9D%90%E5%BF%85%E6%9C%89%E7%94%A8%E3%80%82%E8%BF%99%E4%B8%8D%E6%98%AF%E4%B8%80%E5%8F%A5%E6%95%B7%E8%A1%8D%E7%9A%84%E5%AE%89%E6%85%B0%E7%9A%84%E8%AF%9D%E3%80%82%E6%AF%8F%E4%B8%AA%E4%BA%BA%E9%83%BD%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9C%9F%E6%AD%A3%E7%83%AD%E7%88%B1%E7%9A%84%E4%BA%8B%E6%83%85%EF%BC%8C%E5%8F%AA%E6%98%AF%E4%BD%A0%E6%B2%A1%E6%9C%89%E8%AE%A4%E8%AF%86%E5%88%B0%EF%BC%8C%E4%B9%9F%E6%B2%A1%E6%9C%89%E6%8A%95%E5%85%A5%E5%8E%BB%E5%AF%BB%E6%89%BE%E3%80%82%E6%9C%89%E7%9A%84%E4%BA%BA%E8%BF%90%E6%B0%94%E5%A5%BD%EF%BC%8C%E6%AD%A3%E5%A5%BD%E4%BB%8E%E4%BA%8B%E4%BA%86%E8%87%AA%E5%B7%B1%E6%9C%89%E7%83%AD%E6%83%85%E7%9A%84%E4%BA%8B%E6%83%85%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%90%E5%8A%9F%E4%BA%86%EF%BC%9B%E6%9C%89%E7%9A%84%E4%BA%BA%E8%AE%A4%E8%AF%86%E5%88%B0%E7%83%AD%E6%83%85%E5%81%87%E8%AE%BE%EF%BC%8C%E5%B9%B6%E7%94%A8%E5%BF%83%E5%8E%BB%E5%AF%BB%E6%89%BE%EF%BC%8C%E4%BD%86%E6%98%AF%E6%80%BB%E6%98%AF%E7%BC%98%E6%82%AD%E4%B8%80%E9%9D%A2%EF%BC%8C%E4%BD%86%E4%BB%96%E4%BB%AC%E8%BF%98%E5%9C%A8%E8%B7%AF%E4%B8%8A%EF%BC%9B%E4%BD%86%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BA%BA%EF%BC%8C%E5%B9%B6%E6%B2%A1%E6%9C%89%E6%84%8F%E8%AF%86%E5%88%B0%E7%83%AD%E6%83%85%E7%9A%84%E5%AD%98%E5%9C%A8%EF%BC%8C%E4%BB%96%E4%BB%AC%E6%B5%91%E6%B5%91%E5%99%A9%E5%99%A9%E5%BE%97%E8%BF%87%E4%B8%94%E8%BF%87%EF%BC%8C%E6%8A%B1%E6%80%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E6%AF%8F%E4%B8%80%E5%A4%A9%EF%BC%8C%E5%8D%B4%E4%B8%8D%E5%8E%BB%E5%AF%BB%E6%89%BE%EF%BC%8C%E6%88%96%E8%80%85%E4%B8%8D%E7%9F%A5%E9%81%93%E5%A6%82%E4%BD%95%E5%AF%BB%E6%89%BE%E3%80%82%E6%88%91%E7%90%86%E8%A7%A3%E6%9C%80%E5%90%8E%E4%B8%80%E7%A7%8D%E4%BA%BA%E7%9A%84%E6%83%B3%E6%B3%95%EF%BC%8C%E5%9B%A0%E4%B8%BA%E4%B8%96%E4%BA%8B%E7%B9%81%E6%9D%82%EF%BC%8C%E9%9C%80%E8%A6%81%E4%BD%A0%E6%9C%89%E4%B8%80%E5%8F%8C%E6%85%A7%E7%9C%BC%E5%92%8C%E4%B8%80%E9%A2%97%E5%96%84%E4%BA%8E%E6%80%9D%E8%80%83%E7%9A%84%E5%BF%83%E3%80%82%E8%BF%99%E5%85%B6%E5%AE%9E%E4%B9%9F%E6%98%AF%E4%B8%80%E7%A7%8D%E5%A4%A9%E5%88%86%E5%95%8A%EF%BC%8C%E5%92%8C%E8%83%BD%E5%A4%9F%E6%88%92%E8%BA%81%E6%88%92%E8%BA%81%E7%9A%84%E5%8A%AA%E5%8A%9B%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BB%96%E4%B9%9F%E6%98%AF%E4%B8%80%E7%A7%8D%E5%A4%A9%E5%88%86%EF%BC%8C%E5%8F%AF%E8%83%BD%E6%98%AF%E5%8F%AF%E9%81%87%E8%80%8C%E4%B8%8D%E5%8F%AF%E6%B1%82%E7%9A%84%E3%80%82%E4%BD%86%E5%A6%82%E6%9E%9C%E6%88%91%E5%86%99%E8%BF%99%E4%BA%9B%E8%83%BD%E5%A4%9F%E6%BF%80%E8%B5%B7%E4%BD%A0%E5%86%85%E5%BF%83%E5%93%AA%E6%80%95%E4%B8%80%E4%B8%9D%E4%B8%9D%E7%9A%84%E6%B3%A2%E6%BE%9C%EF%BC%8C%E5%8D%B4%E4%B9%9F%E7%9C%9F%E6%98%AF%E6%97%A0%E9%87%8F%E5%8A%9F%E5%BE%B7%E4%B8%80%E4%BB%B6%E3%80%82%E5%9B%A0%E4%B8%BA%E4%B8%80%E6%97%A6%E4%BD%A0%E5%BC%80%E5%A7%8B%E6%80%9D%E8%80%83%EF%BC%8C%E4%B8%8A%E8%B7%AF%EF%BC%8C%E4%BD%A0%E5%B0%B1%E8%83%BD%E5%BC%95%E9%A2%86%E4%BD%A0%E8%B5%B0%E5%90%91%E5%AF%BB%E6%89%BE%E7%83%AD%E6%83%85%EF%BC%8C%E6%88%90%E4%B8%BA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%E7%9A%84%E8%B7%AF%E3%80%82%E5%93%AA%E6%80%95%E6%98%AF%E7%AC%AC%E4%BA%8C%E7%A7%8D%E4%BA%BA%EF%BC%8C%E6%80%BB%E5%A5%BD%E8%BF%87%E6%B5%91%E6%B5%91%E5%99%A9%E5%99%A9%E8%BF%87%E5%AE%8C%E8%BF%9930%E5%A4%9A%E5%B9%B4%E3%80%82%0A%E8%AF%B4%E4%BA%86%E8%BF%99%E4%B9%88%E5%A4%9A%EF%BC%8C%E5%8F%AA%E6%98%AF%E4%BB%8E%E6%88%91%E8%87%AA%E5%B7%B1%E7%9A%84%E8%A7%92%E5%BA%A6%E5%92%8C%E7%BB%8F%E5%8E%86%E6%9D%A5%E9%99%84%E5%92%8C%E4%B9%94%E5%B8%83%E6%96%AF%E7%9A%84%E7%83%AD%E6%83%85%E5%81%87%E8%AF%B4%E3%80%82%E5%81%9A%E8%87%AA%E5%B7%B1%E2%80%9C%E5%96%9C%E6%AC%A2%E2%80%9D%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85%E7%9C%9F%E7%9A%84%E7%9C%9F%E7%9A%84%E5%BE%88%E9%87%8D%E8%A6%81%E3%80%82%E4%BD%86%E5%89%8D%E6%8F%90%E6%98%AF%E4%BD%A0%E8%A6%81%E8%83%BD%E7%90%86%E8%A7%A3%E2%80%9C%E5%96%9C%E6%AC%A2%E2%80%9D%E6%98%AF%E4%BB%80%E4%B9%88%E3%80%82%E6%83%B3%E6%83%B3%E4%BD%A0%E8%BF%BD%E6%B1%82%E8%BF%87%E7%9A%84%E5%A5%B3%E5%AD%A9%E5%84%BF%E5%90%A7%EF%BC%8C%E6%88%91%E8%A7%89%E5%BE%97%E8%BF%99%E6%A0%B7%E7%9A%84%E6%84%9F%E8%A7%89%E6%B2%A1%E4%BB%80%E4%B9%88%E4%B8%A4%E6%A0%B7%E3%80%82%0A]]></content>
  </entry>
  <entry>
    <title><![CDATA[如何做到不被年轻人取代]]></title>
    <url>%2F2018%2F11%2F17%2F%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E4%B8%8D%E8%A2%AB%E5%B9%B4%E8%BD%BB%E4%BA%BA%E5%8F%96%E4%BB%A3%2F</url>
    <content type="text"><![CDATA[&#x8FD9;&#x662F;&#x6211;&#x6700;&#x60F3;&#x5199;&#x7684;&#x4E00;&#x4E2A;&#x8BDD;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x89C9;&#x5F97;&#x8FD9;&#x4E5F;&#x662F;&#x6700;&#x591A;&#x4EBA;&#x5728;&#x601D;&#x8003;&#x7B54;&#x6848;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x50CF;&#x6211;&#x8FD9;&#x6837;&#x9762;&#x4E34;35&#x5C81;&#x5371;&#x673A;&#x7684;&#x4EBA;&#x3002;&#x81EA;&#x5DF1;&#x601D;&#x8003;&#x4E86;&#x5F88;&#x591A;&#xFF0C;&#x4E5F;&#x542C;&#x5230;&#x522B;&#x4EBA;&#x7684;&#x7ECF;&#x9A8C;&#x4E4B;&#x8C08;&#xFF0C;&#x5728;&#x5404;&#x79CD;&#x9762;&#x8BD5;&#x53D7;&#x632B;&#x65F6;&#xFF0C;&#x4E5F;&#x53CD;&#x601D;&#x5F88;&#x591A;&#x6B21;&#x3002;&#x5176;&#x4E2D;&#x6709;&#x4E9B;&#x8BB8;&#x5FC3;&#x5F97;&#xFF0C;&#x4E0D;&#x8BBA;&#x5BF9;&#x9519;&#xFF0C;&#x4E0E;&#x541B;&#x5206;&#x4EAB;&#x3002; &#x5047;&#x5982;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x5929;&#xFF0C;&#x4F60;&#x5728;&#x4E00;&#x4E2A;&#x516C;&#x53F8;&#x5DE5;&#x4F5C;&#x4E86;&#x5F88;&#x591A;&#x5E74;(&#x56E0;&#x4E3A;&#x672C;&#x4EBA;&#x7ECF;&#x5386;&#x6709;&#x9650;&#xFF0C;&#x5C31;&#x8FD8;&#x4EE5;&#x6211;&#x6700;&#x719F;&#x6089;&#x7684;&#x79D1;&#x6280;&#x516C;&#x53F8;&#x4E3A;&#x4F8B;)&#xFF0C;&#x6765;&#x4E86;&#x4E00;&#x4E2A;&#x521A;&#x5DE5;&#x4F5C;2,3&#x5E74;&#x7684;&#x5C0F;&#x4F19;&#x5B50;&#x3002;&#x4F60;&#x4FE9;&#x90FD;&#x662F;&#x7A0B;&#x5E8F;&#x5458;&#xFF0C;&#x4F60;&#x89C9;&#x5F97;&#x81EA;&#x5DF1;&#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x52A3;&#x52BF;&#x5728;&#x54EA;&#x513F;&#x5462;&#xFF1F; &#x52A3;&#x52BF;,&#x6211;&#x4EEC;&#x597D;&#x50CF;&#x80FD;&#x8BF4;&#x4E00;&#x5927;&#x5806;: &#x7CBE;&#x529B;&#x4E0D;&#x884C;&#x4E86;&#xFF0C;&#x8981;&#x517C;&#x987E;&#x5BB6;&#x5EAD;&#xFF0C;&#x8A00;&#x4E0B;&#x4E4B;&#x610F;&#xFF0C;&#x4E0D;&#x5229;&#x4E8E;&#x52A0;&#x73ED; &#x6280;&#x672F;&#x843D;&#x4F0D;&#x4E86;&#xFF0C;&#x4E0D;&#x80FD;&#x63A5;&#x53D7;&#x65B0;&#x4E8B;&#x7269; &#x6F5C;&#x529B;&#x4E0D;&#x8DB3;&#xFF0C;&#x8A00;&#x4E0B;&#x4E4B;&#x610F;&#xFF0C;&#x4E0D;&#x518D;&#x613F;&#x610F;&#x5B66;&#x4E60;&#x6765;&#x63D0;&#x5347;&#x81EA;&#x5DF1;&#x3002; &#x4F18;&#x52BF;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x53EA;&#x6709;&#x4E00;&#x6761;&#xFF0C;&#x7ECF;&#x9A8C;&#x3002; &#x6240;&#x8C13;&#x77E5;&#x5DF1;&#x77E5;&#x5F7C;&#xFF0C;&#x767E;&#x6218;&#x4E0D;&#x6B86;&#x3002;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x53D1;&#x6325;&#x81EA;&#x5DF1;&#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x5F25;&#x8865;&#x81EA;&#x5DF1;&#x7684;&#x52A3;&#x52BF;&#xFF0C;&#x624D;&#x80FD;&#x6253;&#x8D62;&#x8FD9;&#x573A;&#x804C;&#x573A;&#x4E4B;&#x6218;&#x3002; &#x7ECF;&#x9A8C;&#x5230;&#x5E95;&#x91CD;&#x8981;&#x5417;&#xFF1F;&#x5728;&#x5982;&#x4ECA;&#x6280;&#x672F;&#x53D8;&#x9769;&#x5982;&#x6B64;&#x5FEB;&#x7684;&#x4ECA;&#x5929;&#xFF0C;&#x6211;&#x4EEC;&#x638C;&#x63E1;&#x7684;&#x90A3;&#x4E9B;&#x8001;&#x6389;&#x7259;&#x7684;&#x6280;&#x672F;&#x771F;&#x7684;&#x91CD;&#x8981;&#x5417;?Of course&#xFF0C;&#x5F53;&#x7136;&#x3002;&#x4E00;&#x4E2A;&#x9AD8;&#x6548;&#x7A0B;&#x5E8F;&#x5458;&#x7684;&#x6548;&#x7387;&#x53EF;&#x4EE5;&#x662F;&#x666E;&#x901A;&#x7A0B;&#x5E8F;&#x5458;&#x7684;10&#x500D;&#xFF0C;&#x751A;&#x81F3;100&#x500D;&#x3002;&#x4F60;&#x5728;&#x6210;&#x957F;&#x8DEF;&#x4E0A;&#x8E0F;&#x8FC7;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5751;&#xFF0C;&#x90FD;&#x5E2E;&#x52A9;&#x4F60;&#x79BB;&#x9AD8;&#x6548;&#x7A0B;&#x5E8F;&#x5458;&#x66F4;&#x8FD1;&#x4E00;&#x6B65;&#x3002;&#x4ED6;&#x5373;&#x4FBF;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E9B;&#x7ECF;&#x9A8C;&#x4E86;(2~3&#x5E74;)&#xFF0C;&#x4F46;&#x4ED6;&#x8E29;&#x8FC7;&#x7684;&#x6280;&#x672F;&#x4E0A;&#x7684;&#x5751;&#x4E00;&#x5B9A;&#x6CA1;&#x4F60;&#x591A;&#xFF0C;&#x4F60;&#x4E00;&#x5B9A;&#x66F4;&#x63A5;&#x8FD1;&#x8F6F;&#x4EF6;&#x7F16;&#x7A0B;&#x7684;&#x672C;&#x8D28;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x672C;&#x884C;&#x4E1A;&#x7684;&#x79EF;&#x7D2F;&#x4E5F;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x3002;&#x7F16;&#x7A0B;&#x8FD9;&#x4E00;&#x6280;&#x80FD;&#xFF0C;&#x8DE8;&#x884C;&#x4E1A;&#x662F;&#x6709;&#x6548;&#x7684;&#xFF0C;&#x4F46;&#x9886;&#x57DF;&#x77E5;&#x8BC6;&#x4E0D;&#x884C;&#x3002;&#x505A;&#x4E92;&#x8054;&#x7F51;&#x5927;&#x6570;&#x636E;&#x7684;&#xFF0C;&#x4E00;&#x5B9A;&#x6CA1;&#x6709;&#x8E29;&#x8FC7;&#x9020;&#x6C7D;&#x8F66;&#x7684;&#x5751;&#x3002;&#x800C;&#x9886;&#x57DF;&#x77E5;&#x8BC6;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x5927;&#x91CF;&#x7684;&#x9879;&#x76EE;&#x7ECF;&#x9A8C;&#x548C;&#x65F6;&#x95F4;&#x6765;&#x6C89;&#x6DC0;&#x3002; &#x62E5;&#x6709;&#x7ECF;&#x9A8C;&#x5C31;&#x80FD;&#x8D62;&#x4E86;&#x5417;&#xFF1F;&#x7B54;&#x6848;&#x5F53;&#x7136;&#x662F;&#x9519;&#x9519;&#x9519;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x5148;&#x8F88;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#xFF0C;&#x4E0D;&#x80FD;&#x8EBA;&#x5728;&#x5386;&#x53F2;&#x7684;&#x529F;&#x52B3;&#x7C3F;&#x4E0A;&#x3002;&#x7ECF;&#x9A8C;&#x53EA;&#x80FD;&#x4EE3;&#x8868;&#x4F60;&#x5F53;&#x524D;&#x7684;&#x72B6;&#x6001;&#x3002;&#x4ECE;&#x516C;&#x53F8;&#x7684;&#x89D2;&#x5EA6;&#x770B;&#xFF0C;&#x4F60;&#x7684;&#x7ECF;&#x9A8C;&#x591A;&#x4E00;&#x4E9B;&#xFF0C;&#x4EE3;&#x8868;&#x4F60;&#x5F53;&#x524D;&#x7684;&#x80FD;&#x529B;&#x6BD4;&#x90A3;&#x4F4D;&#x5C0F;&#x9C9C;&#x8089;&#x5F3A;&#x4E00;&#x4E9B;&#x3002;&#x53EA;&#x80FD;&#x8BF4;&#x660E;&#x4F60;&#x7684;&#x8D77;&#x8DD1;&#x7EBF;&#x6BD4;&#x522B;&#x4EBA;&#x9760;&#x524D;&#x4E00;&#x4E9B;&#x3002;&#x8FD9;&#x4E9B;&#x7ECF;&#x9A8C;&#xFF0C;&#x8FD9;&#x4F4D;&#x5C0F;&#x9C9C;&#x8089;&#x540C;&#x5B66;&#x53EA;&#x8981;&#x52E4;&#x594B;&#x52AA;&#x529B;&#xFF0C;&#x52A0;&#x4E0A;&#x8D44;&#x8D28;&#x5C1A;&#x53EF;&#xFF0C;&#x8FFD;&#x56DE;&#x6765;&#x5206;&#x5206;&#x949F;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x6253;&#x4E2A;&#x4E0D;&#x6070;&#x5F53;&#x7684;&#x6BD4;&#x65B9;&#xFF0C;&#x4F60;&#x8DDF;&#x535A;&#x5C14;&#x7279;&#x6BD4;&#x8D5B;&#x8DD1;&#xFF0C;&#x4F60;&#x8D77;&#x8DD1;&#x7EBF;&#x63D0;&#x524D;&#x4E2A;10&#x7C73;&#xFF0C;&#x6709;&#x6BDB;&#x7528;&#x3002; &#x5982;&#x679C;&#x4E0D;&#x60F3;&#x88AB;&#x5E74;&#x8F7B;&#x4EBA;&#x8D85;&#x8D8A;&#xFF0C;&#x4F60;&#x5FC5;&#x9700;&#x62E5;&#x6709;&#x53EA;&#x4F9D;&#x9760;&#x539F;&#x59CB;&#x79EF;&#x7D2F;&#x65E0;&#x6CD5;&#x5F97;&#x5230;&#x7684;&#x54C1;&#x8D28;&#x3002;&#x597D;&#x6BD4;&#x53E4;&#x4EE3;&#x7684;&#x6218;&#x4E89;&#x3002;&#x5175;&#x529B;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x56E0;&#x7D20;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x9760;&#x4EBA;&#x591A;&#x5C31;&#x80FD;&#x8D62;&#x3002;&#x5F81;&#x5175;&#x53EA;&#x8981;&#x541B;&#x4E3B;&#x80AF;&#x51FA;&#x94B1;&#xFF0C;&#x6A2A;&#x5F81;&#x66B4;&#x655B;&#xFF0C;&#x6293;&#x58EE;&#x4E01;&#xFF0C;&#x4EBA;&#x603B;&#x662F;&#x80FD;&#x51D1;&#x51FA;&#x6765;&#x7684;&#x3002;&#x4F46;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6218;&#x4E89;&#x8FD8;&#x662F;&#x4EF0;&#x4ED7;&#x4F18;&#x79C0;&#x7684;&#x6307;&#x6325;&#x5B98;&#x548C;&#x6770;&#x51FA;&#x7684;&#x519B;&#x4E8B;&#x5BB6;&#x3002;&#x541B;&#x4E0D;&#x89C1;&#x5386;&#x53F2;&#x4E0A;&#x591A;&#x5C11;&#x4EE5;&#x5C11;&#x80DC;&#x591A;&#xFF0C;&#x4EE5;&#x5F31;&#x80DC;&#x5F3A;&#x7684;&#x6218;&#x4F8B;&#x3002;&#x6B63;&#x6240;&#x8C13;&#x5343;&#x519B;&#x6613;&#x5F97;&#xFF0C;&#x4E00;&#x5C06;&#x96BE;&#x6C42;&#x3002;&#x5DE5;&#x4F5C;&#x4EA6;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x7ECF;&#x9A8C;&#x7684;&#x79EF;&#x7D2F;&#xFF0C;&#x4F9D;&#x9760;&#x65F6;&#x95F4;&#x7684;&#x6C89;&#x6DC0;&#xFF0C;&#x7CBE;&#x529B;&#x7684;&#x4ED8;&#x51FA;&#x603B;&#x53EF;&#x4EE5;&#x505A;&#x5F97;&#x5230;&#x7684;&#x3002;&#x4F46;&#x4F55;&#x4E3A;&#x5C06;&#x624D;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x4EC0;&#x4E48;&#x624D;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x6838;&#x5FC3;&#x7ADE;&#x4E89;&#x529B;&#xFF1F;&#x4EC0;&#x4E48;&#x624D;&#x80FD;&#x7B51;&#x6210;&#x56F4;&#x62A4;&#x804C;&#x573A;&#x7684;&#x6DF1;&#x6C9F;&#x5927;&#x58D1;&#xFF1F;&#x6211;&#x603B;&#x7ED3;&#x5982;&#x4E0B;: &#x9996;&#x8981;&#x7684;&#x662F;&#x4E09;&#x89C2;&#xFF0C;&#x4E16;&#x754C;&#x89C2;,&#x4EBA;&#x751F;&#x89C2;&#xFF0C;&#x4EF7;&#x503C;&#x89C2; &#x826F;&#x597D;&#x7684;&#x81EA;&#x7701;&#x4E0E;&#x81EA;&#x63A7;&#x80FD;&#x529B;&#xFF0C;&#x826F;&#x597D;&#x7684;&#x751F;&#x6D3B;&#x4E60;&#x60EF; &#x80FD;&#x5BA2;&#x89C2;&#x7406;&#x667A;&#x5730;&#x5BF9;&#x5F85;&#x4EBA;&#x4E0E;&#x4E8B;&#x7269;&#xFF0C;&#x51E1;&#x4E8B;&#x4FDD;&#x6301;&#x6B63;&#x5411;&#x601D;&#x7EF4; &#x4E0E;&#x4EBA;&#x6C9F;&#x901A;&#x7684;&#x80FD;&#x529B; &#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7231;&#x597D;&#xFF0C;&#x6709;&#x5BF9;&#x6587;&#x5B66;&#x6216;&#x827A;&#x672F;&#x7684;&#x9274;&#x8D4F;&#x80FD;&#x529B; &#x7ECF;&#x9A8C;&#x662F;&#x6280;&#x672F;&#x5C42;&#x9762;&#x7684;&#xFF0C;&#x662F;&#x5175;&#x529B;&#xFF0C;&#x662F;&#x4F60;&#x7684;&#x7B79;&#x7801;&#x3002;&#x5982;&#x4F55;&#x6301;&#x7EED;&#x5730;&#x63D0;&#x5347;&#x81EA;&#x5DF1;&#xFF0C;&#x5982;&#x4F55;&#x8FD0;&#x7528;&#x597D;&#x4F60;&#x7684;&#x7B79;&#x7801;&#x6765;&#x6784;&#x5EFA;&#x51FA;&#x8272;&#x7684;&#x56E2;&#x961F;&#x653B;&#x57CE;&#x62D4;&#x5BE8;&#x3002;&#x8FD9;&#x4E9B;&#x4ECE;&#x957F;&#x8FDC;&#x770B;&#xFF0C;&#x6211;&#x8BA4;&#x4E3A;&#x6BD4;&#x6280;&#x672F;&#x672C;&#x8EAB;&#xFF0C;&#x6216;&#x7ECF;&#x9A8C;&#x672C;&#x8EAB;&#x66F4;&#x91CD;&#x8981;&#x3002;&#x6BD5;&#x7ADF;&#x6280;&#x672F;(&#x7ECF;&#x9A8C;)&#x662F;&#x6B7B;&#x7684;&#xFF0C;&#x5B83;&#x4E0D;&#x80FD;&#x5E2E;&#x4F60;&#x5B8C;&#x6210;&#x9879;&#x76EE;&#xFF0C;&#x505A;&#x51FA;&#x4EA7;&#x54C1;&#x3002;&#x4EBA;&#x624D;&#x662F;&#x6D3B;&#x7684;&#xFF0C;&#x600E;&#x4E48;&#x63D0;&#x5347;&#x81EA;&#x5DF1;&#xFF0C;&#x6574;&#x5408;&#x8D44;&#x6E90;&#xFF0C;&#x624D;&#x80FD;&#x5E2E;&#x4F60;&#x505A;&#x51FA;&#x597D;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x597D;&#x7684;&#x4EA7;&#x54C1;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x4E9B;&#x8F6F;&#x6280;&#x80FD;&#x624D;&#x662F;&#x771F;&#x6B63;&#x7684;&#x6838;&#x5FC3;&#x7ADE;&#x4E89;&#x529B;&#x5E94;&#x3002;&#x800C;&#x4E14;&#x6240;&#x6709;&#x7684;&#x8FD9;&#x4E9B;&#x8F6F;&#x6280;&#x80FD;&#x90FD;&#x4E0D;&#x662F;&#x9760;&#x4E00;&#x5929;&#x4E24;&#x5929;&#xFF0C;&#x751A;&#x81F3;&#x4E00;&#x5E74;&#x4E24;&#x5E74;&#x7684;&#x901F;&#x6210;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x7684;&#x3002;&#x4ED6;&#x9700;&#x8981;&#x601D;&#x8003;&#x3001;&#x603B;&#x7ED3;&#x3001;&#x987F;&#x609F;&#xFF0C;&#x6709;&#x610F;&#x8BC6;&#x5730;&#x8BAD;&#x7EC3;&#x81EA;&#x5DF1;&#x3002; &#x4E16;&#x754C;&#x89C2;&#xFF0C;&#x4EBA;&#x751F;&#x89C2;&#xFF0C;&#x4EF7;&#x503C;&#x89C2; &#x6240;&#x8C13;&#x4E09;&#x89C2;&#x4E0D;&#x6B63;&#xFF0C;&#x4F55;&#x4EE5;&#x6B63;&#x5929;&#x4E0B;&#x3002;&#x6211;&#x7406;&#x89E3;&#x7684;&#x4E09;&#x89C2;: &#x4E16;&#x754C;&#x89C2;:&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x793E;&#x4F1A;&#x5730;&#x4F4D;&#x4E0D;&#x540C;, &#x8BA4;&#x77E5;&#x4E0D;&#x540C;&#xFF0C;&#x89C2;&#x5BDF;&#x95EE;&#x9898;&#x7684;&#x89D2;&#x5EA6;&#x4E5F;&#x4E0D;&#x540C;&#xFF0C;&#x9020;&#x6210;&#x7684;&#x89C2;&#x5FF5;&#x6216;&#x89C2;&#x70B9;&#x7684;&#x5DEE;&#x522B;&#x3002;&#x4F8B;&#x5982;:&#x4F60;&#x603B;&#x80FD;&#x770B;&#x5230;&#x4E00;&#x4EF6;&#x4E8B;&#x7684;&#x597D;&#x5904;&#x548C;&#x574F;&#x5904;&#x5417;?&#x4F60;&#x603B;&#x80FD;&#x7406;&#x89E3;&#x4E00;&#x4EF6;&#x4E8B;&#x9664;&#x4E86;&#x597D;&#x548C;&#x574F;&#xFF0C;&#x5B83;&#x5176;&#x5B9E;&#x603B;&#x662F;&#x5904;&#x4E8E;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x7684;&#x4E2D;&#x95F4;&#x6001;&#x5417;&#xFF1F;&#x4EBA;&#x8BF4;&#x4F17;&#x751F;&#x5E73;&#x7B49;&#xFF0C;&#x4F60;&#x771F;&#x7684;&#x80FD;&#x505A;&#x5230;&#x5417;&#xFF1F; &#x4EBA;&#x751F;&#x89C2;: &#x4EBA;&#x6D3B;&#x4E00;&#x4E16;&#xFF0C;&#x5230;&#x5E95;&#x4EC0;&#x4E48;&#x624D;&#x662F;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x751F;&#x6D3B;&#x3002;&#x4F60;&#x8F9B;&#x82E6;&#x5DE5;&#x4F5C;&#x5230;&#x5E95;&#x662F;&#x4E3A;&#x4E86;&#x8C01;&#xFF1F;&#x662F;&#x94B1;&#x91CD;&#x8981;&#xFF0C;&#x662F;&#x5FEB;&#x4E50;&#x91CD;&#x8981;&#xFF0C;&#x662F;&#x5BB6;&#x5EAD;&#x91CD;&#x8981;&#xFF0C;&#x8FD8;&#x662F;&#x6210;&#x5C31;&#x611F;&#x91CD;&#x8981;?&#x76F4;&#x51FB;&#x5185;&#x5FC3;&#x5417;?&#x60F3;&#x6E05;&#x695A;&#x4E86;&#x5417;? &#x4EF7;&#x503C;&#x89C2;: &#x4EC0;&#x4E48;&#x662F;&#x5BF9;&#x4F60;&#x6709;&#x4EF7;&#x503C;&#x7684;&#xFF1F;&#x94B1;&#x5417;?&#x672A;&#x6765;&#x7684;&#x53D1;&#x5C55;&#xFF1F;&#x8001;&#x677F;&#x5B89;&#x6392;&#x4F60;&#x505A;&#x4E00;&#x4EF6;&#x7410;&#x788E;&#x7684;&#x4E8B;&#xFF0C;&#x4F60;&#x80FD;&#x770B;&#x5230;&#x5BF9;&#x4F60;&#x6709;&#x4EF7;&#x503C;&#x7684;&#x90E8;&#x5206;&#x5417;? &#x62E5;&#x6709;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x4E09;&#x89C2;&#xFF0C;&#x624D;&#x80FD;&#x66F4;&#x5BB9;&#x6613;&#x6446;&#x6B63;&#x81EA;&#x5DF1;&#x7684;&#x5FC3;&#x6001;&#xFF0C;&#x660E;&#x786E;&#x81EA;&#x5DF1;&#x524D;&#x8FDB;&#x7684;&#x65B9;&#x5411;&#xFF0C;&#x7406;&#x6027;&#x800C;&#x5E73;&#x548C;&#x5730;&#x5BF9;&#x5F85;&#x8EAB;&#x8FB9;&#x7684;&#x4EBA;&#x548C;&#x4E8B;&#xFF0C;&#x79EF;&#x6781;&#x6B63;&#x5411;&#x5730;&#x53BB;&#x751F;&#x6D3B;&#x3002; &#x4E09;&#x89C2;&#x7684;&#x5F62;&#x6210;&#x6709;&#x8BF8;&#x591A;&#x56E0;&#x7D20;--&#x539F;&#x751F;&#x5BB6;&#x5EAD;&#xFF0C;&#x6559;&#x80B2;&#xFF0C;&#x9605;&#x5386;&#x7B49;&#x7B49;&#x3002;&#x4E00;&#x4E2A;&#x4EBA;&#x7684;&#x4E09;&#x89C2;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x4E0D;&#x65AD;&#x53D8;&#x5316;&#x7740;&#x3002;&#x4F60;&#x8BFB;&#x8FC7;&#x7684;&#x6BCF;&#x4E00;&#x672C;&#x4E66;,&#x6BCF;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x90FD;&#x5728;&#x65E0;&#x5F62;&#x4E4B;&#x4E2D;&#x5F71;&#x54CD;&#x7740;&#x4F60;&#x3002;&#x4F46;&#x5185;&#x56E0;&#x603B;&#x662F;&#x4E3B;&#x5BFC;&#x56E0;&#x7D20;&#xFF0C;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x6210;&#x5E74;&#x4EBA;&#xFF0C;&#x522B;&#x4EBA;&#x5DF2;&#x7ECF;&#x5F88;&#x96BE;&#x6559;&#x4F1A;&#x4F60;&#x4EC0;&#x4E48;&#x3002;&#x81EA;&#x5DF1;&#x591A;&#x601D;&#x8003;&#xFF0C;&#x591A;&#x6C42;&#x8BC1;&#xFF0C;&#x624D;&#x4F1A;&#x6210;&#x957F;&#x3002; &#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7231;&#x597D;&#xFF0C;&#x6709;&#x5BF9;&#x6587;&#x5B66;&#x6216;&#x827A;&#x672F;&#x7684;&#x9274;&#x8D4F;&#x80FD;&#x529B; &#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7231;&#x597D;&#x662F;&#x4E00;&#x4EF6;&#x5F88;&#x597D;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x4E16;&#x754C;&#x672C;&#x6765;&#x5C31;&#x662F;&#x590D;&#x6742;&#x7684;&#x3002;&#x4ED6;&#x4E0D;&#x662F;&#x53EA;&#x7531;&#x4E00;&#x5806;&#x903B;&#x8F91;&#x4E0E;&#x6570;&#x636E;&#x642D;&#x5EFA;&#x8D77;&#x6765;&#x7684;&#xFF0C;&#x90A3;&#x662F;&#x6E38;&#x620F;&#xFF0C;&#x662F;&#x865A;&#x62DF;&#x4E16;&#x754C;&#x3002;&#x73B0;&#x5B9E;&#x4E16;&#x754C;&#x8981;&#x590D;&#x6742;&#x5F97;&#x591A;&#x3002;&#x5728;&#x7F16;&#x7A0B;&#x4E4B;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x7231;&#x597D;&#xFF0C;&#x4F8B;&#x5982;&#x827A;&#x672F;&#xFF0C;&#x6444;&#x5F71;&#xFF0C;&#x97F3;&#x4E50;&#x821E;&#x8E48;&#xFF0C;&#x4EA6;&#x6216;&#x662F;&#x82B1;&#x9E1F;&#x866B;&#x9C7C;&#xFF0C;&#x4F53;&#x80B2;&#x8FD0;&#x52A8;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x4F60;&#x4ECE;&#x4E0D;&#x540C;&#x7EF4;&#x5EA6;&#x53BB;&#x7406;&#x89E3;&#x4E16;&#x754C;&#xFF0C;&#x53BB;&#x8BA4;&#x8BC6;&#x4F60;&#x81EA;&#x5DF1;&#x3002;&#x4ECE;&#x800C;&#x5E2E;&#x52A9;&#x4F60;&#x6811;&#x7ACB;&#x6216;&#x4FEE;&#x6B63;&#x4F60;&#x7684;&#x4E09;&#x89C2;&#x3002;&#x4EBA;&#x4EEC;&#x5E38;&#x8BF4;&#x7684;&#x9676;&#x51B6;&#x60C5;&#x64CD;&#xFF0C;&#x5927;&#x62B5;&#x5982;&#x6B64;&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x505A;&#x4F60;&#x7231;&#x505A;&#x7684;&#x4E8B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8EAB;&#x5FC3;&#x5FC5;&#x662F;&#x6109;&#x60A6;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x66F4;&#x597D;&#x5730;&#x5728;&#x5DE5;&#x4F5C;&#x4E4B;&#x4F59;&#x653E;&#x677E;&#x81EA;&#x5DF1;&#xFF0C;&#x91CA;&#x653E;&#x538B;&#x529B;&#xFF0C;&#x518D;&#x5DE5;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x66F4;&#x7406;&#x667A;&#xFF0C;&#x66F4;&#x4E13;&#x6CE8;&#x3002;&#x6548;&#x7387;&#x81EA;&#x7136;&#x5C31;&#x9AD8;&#x4E86;&#x3002;&#x8BB0;&#x5F97;&#x4E0A;&#x5B66;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8001;&#x5E08;&#x7ECF;&#x5E38;&#x63D0;&#x8D77;&#x8FD9;&#x6837;&#x4E00;&#x79CD;&#x4EBA;&#xFF0C;&#x6574;&#x5929;&#x5728;&#x73A9;&#xFF0C;&#x8003;&#x8BD5;&#x603B;&#x80FD;&#x540D;&#x5217;&#x524D;&#x8305;&#x3002;&#x73B0;&#x5728;&#x60F3;&#x6765;&#x8FD9;&#x4E9B;&#x4EBA;&#x9664;&#x4E86;&#x667A;&#x5546;&#x9AD8;&#xFF0C;&#x7231;&#x597D;&#x548C;&#x5DE5;&#x4F5C;&#x7684;&#x5173;&#x7CFB;&#x4E00;&#x5B9A;&#x4E5F;&#x5904;&#x7406;&#x5F97;&#x5F88;&#x597D;&#x3002; &#x81EA;&#x7701;&#x4E0E;&#x81EA;&#x63A7;&#x80FD;&#x529B; &#x8FD9;&#x4E2A;&#x8BF4;&#x8D77;&#x6765;&#x5BB9;&#x6613;&#xFF0C;&#x505A;&#x8D77;&#x6765;&#x771F;&#x7684;&#x5F88;&#x96BE;&#x3002;&#x9700;&#x8981;&#x5927;&#x5BB6;&#x7528;&#x5FC3;&#x53BB;&#x4F53;&#x4F1A;&#x3002;&#x4F55;&#x4E3A;&#x81EA;&#x7701;?&#x5B54;&#x5B50;&#x66F0;&#xFF0C;&#x543E;&#x65E5;&#x4E09;&#x7701;&#x543E;&#x8EAB;&#x3002;&#x534E;&#x4E3A;&#x7684;&#x6838;&#x5FC3;&#x4EF7;&#x503C;&#x89C2;&#x6709;&#xFF0C;&#x575A;&#x6301;&#x81EA;&#x6211;&#x6279;&#x5224;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x81EA;&#x7701;&#x3002;&#x5F53;&#x53D1;&#x751F;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x4EBA;&#x4EEC;&#x4F1A;&#x672C;&#x80FD;&#x5730;&#x8BA4;&#x4E3A;&#x90FD;&#x662F;&#x522B;&#x4EBA;&#x7684;&#x8D23;&#x4EFB;&#x3002;&#x56E0;&#x4E3A;&#x4F60;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;&#x4E86;&#x89E3;&#x4E00;&#x5B9A;&#x80DC;&#x8FC7;&#x5BF9;&#x522B;&#x4EBA;&#x7684;&#x4E86;&#x89E3;&#x3002;&#x56E0;&#x4E3A;&#x4E0D;&#x4E86;&#x89E3;&#x800C;&#x6000;&#x7591;&#xFF0C;&#x8FDB;&#x800C;&#x6709;&#x610F;&#x65E0;&#x610F;&#x7684;&#x7529;&#x9505;&#x3002;&#x5728;&#x7529;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5373;&#x4FBF;&#x5728;&#x7529;&#x4E4B;&#x540E;,&#x80FD;&#x4E0D;&#x80FD;&#x5373;&#x65F6;&#x5730;&#x8BA4;&#x8BC6;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x95EE;&#x9898;&#xFF1F;&#x6B64;&#x4E3A;&#x81EA;&#x7701;&#x3002; &#x81EA;&#x63A7;&#x662F;&#x4F60;&#x80FD;&#x5BF9;&#x6297;&#x4F60;&#x7684;&#x6B32;&#x671B;&#x5417;&#xFF1F;&#x5F53;&#x4F60;&#x5728;&#x505A;&#x8543;&#x8304;&#x949F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x80FD;&#x514B;&#x5236;&#x81EA;&#x5DF1;&#x4E0D;&#x73A9;&#x624B;&#x673A;&#x5417;&#xFF1F;&#x5728;&#x7F16;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x80FD;&#x63A7;&#x5236;&#x81EA;&#x5DF1;&#x603B;&#x662F;&#x60F3;&#x628A;&#x4EE3;&#x7801;&#x8BBE;&#x8BA1;&#x5F97;&#x5927;&#x800C;&#x5168;&#x7684;&#x6B32;&#x671B;&#x5417;?&#x4F60;&#x80FD;&#x65E0;&#x8BBA;&#x51AC;&#x590F;&#x6BCF;&#x5929;6&#x70B9;&#x8D77;&#x5E8A;10&#x70B9;&#x7761;&#x89C9;&#xFF0C;&#x4E00;&#x5468;&#x8FD0;&#x52A8;3&#x6B21;&#x5417;&#xFF1F;&#x751F;&#x6D3B;&#x4E2D;&#x7684;&#x6B32;&#x671B;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#xFF0C;&#x7528;&#x5F53;&#x4E0B;&#x6D41;&#x884C;&#x7684;&#x8BDD;&#x8BF4;&#xFF0C;&#x4F60;&#x80FD;&#x4FDD;&#x6301;&#x521D;&#x5FC3;&#x5417;? &#x826F;&#x597D;&#x7684;&#x751F;&#x6D3B;&#x4E60;&#x60EF;&#x4F9D;&#x8D56;&#x4E8E;&#x826F;&#x597D;&#x7684;&#x81EA;&#x63A7;&#x529B;&#x3002;&#x8FD9;&#x91CC;&#x5355;&#x72EC;&#x5730;&#x63D0;&#x51FA;&#xFF0C;&#x56E0;&#x4E3A;&#x5065;&#x5EB7;&#x5BF9;&#x6211;&#x4EEC;&#x592A;&#x91CD;&#x8981;&#x4E86;&#x3002;&#x534E;&#x4E3A;&#x6709;&#x53E5;&#x8BDD;&#xFF0C;&#x5DE5;&#x4F5C;&#x662F;&#x573A;&#x9A6C;&#x62C9;&#x677E;&#xFF0C;&#x4E0D;&#x662F;100&#x7C73;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x65F6;&#x523B;&#x51B2;&#x523A;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x6700;&#x540E;&#x7684;&#x80DC;&#x5229;&#x3002;&#x5DE5;&#x4F5C;&#x4E22;&#x4E86;&#x8FD8;&#x80FD;&#x627E;&#x56DE;&#x6765;&#xFF0C;&#x5065;&#x5EB7;&#x3001;&#x5BB6;&#x5EAD;&#x3001;&#x611F;&#x60C5;&#x4E1F;&#x4E86;&#x5C31;&#x518D;&#x4E5F;&#x6CA1;&#x6709;&#x4E86;&#x3002;&#x6700;&#x540E;&#x5957;&#x7528;&#x90ED;&#x5FB7;&#x7EB2;&#x4E00;&#x53E5;&#x8BDD;: &#x4EC0;&#x4E48;&#x662F;&#x827A;&#x672F;&#x5BB6;&#xFF1F;&#x628A;&#x4F60;&#x71AC;&#x6302;&#x4E86;&#xFF0C;&#x6211;&#x5C31;&#x662F;&#x827A;&#x672F;&#x5BB6;&#x3002; &#x51E1;&#x4E8B;&#x4FDD;&#x6301;&#x6B63;&#x5411;&#x601D;&#x7EF4; &#x5DE5;&#x4F5C;&#x4E86;&#x63A5;&#x8FD1;10&#x5E74;&#x4E86;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x6211;&#x63A5;&#x89E6;&#x7684;&#x4EBA;&#x4E0D;&#x591F;&#x591A;&#xFF0C;&#x771F;&#x6B63;&#x80FD;&#x65F6;&#x523B;&#x4FDD;&#x6301;&#x6B63;&#x80FD;&#x91CF;&#x7684;&#x4EBA;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x4E5F;&#x8FD8;&#x662F;&#x6709;&#x7684;&#x3002; &#x6211;&#x6240;&#x8C13;&#x7684;&#x4FDD;&#x6301;&#x6B63;&#x80FD;&#x91CF;&#xFF0C;&#x4E0D;&#x662F;&#x5B66;&#x96F7;&#x950B;&#xFF0C;&#x4E00;&#x4E0D;&#x6015;&#x82E6;&#x4E8C;&#x4E0D;&#x6015;&#x7D2F;;&#x6216;&#x8005;&#x4E8B;&#x4E8B;&#x4F5B;&#x7CFB;&#xFF0C;&#x4E0D;&#x55D4;&#x4E0D;&#x6012;&#x4E0D;&#x559C;&#x4E0D;&#x60B2;&#x3002;&#x90A3;&#x90FD;&#x662F;&#x6982;&#x5FF5;&#x4EBA;&#xFF0C;&#x65E0;&#x8840;&#x65E0;&#x8089;&#x3002;&#x8FD9;&#x91CC;&#x60F3;&#x8BF4;&#x7684;&#x662F;&#xFF0C;&#x5176;&#x5B9E;&#x51E1;&#x4E8B;&#x90FD;&#x6709;&#x6B63;&#x53CD;&#x4E24;&#x9762;&#x3002;&#x5728;&#x9006;&#x5883;&#x4E2D;&#xFF0C;&#x80FD;&#x770B;&#x5230;&#x6B63;&#x9762;&#xFF0C;&#x4FDD;&#x6301;&#x79EF;&#x6781;&#x5411;&#x4E0A;; &#x5F97;&#x610F;&#x65F6;&#xFF0C;&#x80FD;&#x770B;&#x5230;&#x53CD;&#x9762;&#xFF0C;&#x65F6;&#x523B;&#x8B66;&#x9192;&#x81EA;&#x5DF1;&#xFF0C;&#x80DC;&#x4E0D;&#x9A84;&#x800C;&#x8D25;&#x4E0D;&#x9981;&#x3002; &#x4E0E;&#x4EBA;&#x6C9F;&#x901A;&#x7684;&#x80FD;&#x529B; &#x8FD9;&#x4E2A;&#x4E5F;&#x662F;&#x804C;&#x573A;&#x4E2D;&#x88AB;&#x4EBA;&#x8BF4;&#x70C2;&#x7684;&#x4E00;&#x4E2A;&#x8BDD;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x53C8;&#x6709;&#x591A;&#x5C11;&#x4EBA;&#x80FD;&#x505A;&#x597D;&#xFF1F;&#x53C8;&#x6709;&#x591A;&#x5C11;&#x4EBA;&#x80FD;&#x8BA4;&#x8BC6;&#x5230;&#x5B83;&#x5230;&#x5E95;&#x6709;&#x591A;&#x96BE;&#x3002;&#x6709;&#x53E5;&#x4FD7;&#x8BED;&#x53EB;&#xFF0C;&#x4EBA;&#x7684;&#x5FC3;&#xFF0C;&#x6D77;&#x5E95;&#x9488;&#x3002;&#x6839;&#x672C;&#x5C31;&#x7422;&#x78E8;&#x4E0D;&#x900F;&#x3002;&#x6709;&#x65F6;&#x5019;&#x4F60;&#x8BA4;&#x4E3A;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x53EF;&#x662F;&#x53EF;&#x80FD;&#x5BF9;&#x65B9;&#x6839;&#x672C;&#x5C31;&#x4E0D;&#x662F;&#x8FD9;&#x4E2A;&#x610F;&#x601D;&#x3002;&#x6709;&#x79CD;&#x8BF4;&#x6CD5;&#xFF0C;&#x5F53;&#x4E24;&#x4E2A;&#x4EBA;&#x5728;&#x8BF4;&#x8BDD;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x5B9E;&#x6709;6&#x4E2A;&#x4EBA;&#x5728;&#x53C2;&#x4E0E;:&#x5B9E;&#x9645;&#x7684;&#x4F60;&#xFF0C;&#x4F60;&#x8868;&#x8FBE;&#x51FA;&#x6765;&#x7684;&#x4F60;&#xFF0C;&#x5BF9;&#x65B9;&#x7406;&#x89E3;&#x7684;&#x4F60;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x5BF9;&#x65B9;&#xFF0C;&#x5BF9;&#x65B9;&#x8868;&#x8FBE;&#x51FA;&#x6765;&#x7684;&#x4ED6;&#xFF0C;&#x4EE5;&#x53CA;&#x4F60;&#x7406;&#x89E3;&#x7684;&#x5BF9;&#x65B9;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x65F6;&#x523B;&#x6CE8;&#x610F;&#x4FDD;&#x6301;open&#x72B6;&#x6001;&#xFF0C;&#x4E0D;&#x8981;&#x8BA4;&#x4E3A;&#x4F60;&#x5B8C;&#x5168;&#x7406;&#x89E3;&#x4E86;&#x5BF9;&#x65B9;&#x7684;&#x8BDD;&#xFF0C;&#x8BEF;&#x89E3;&#x4E0D;&#x53EF;&#x80FD;&#x88AB;&#x6D88;&#x9664;&#xFF0C;&#x53EA;&#x80FD;&#x88AB;&#x51CF;&#x5C11;&#x3002;&#x5F53;&#x4F60;&#x5BF9;&#x522B;&#x4EBA;&#x8BF4;&#x8BDD;&#x65F6;&#xFF0C;&#x4E5F;&#x4E0D;&#x8981;&#x6307;&#x671B;&#x4ED6;&#x80FD;&#x5B8C;&#x5168;&#x7406;&#x89E3;&#x4F60;&#x7684;&#x7528;&#x610F;&#xFF0C;&#x65F6;&#x523B;&#x4FDD;&#x6301;&#x6821;&#x51C6;&#xFF0C;&#x624D;&#x662F;&#x7406;&#x60F3;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x5F53;&#x4EA4;&#x6D41;&#x4E00;&#x6BB5;&#x957F;&#x65F6;&#x95F4;&#x7684;&#x611F;&#x609F;&#x65F6;&#xFF0C;&#x9274;&#x4E8E;&#x9605;&#x5386;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x66F4;&#x4E0D;&#x8981;&#x6307;&#x671B;&#x4E00;&#x6B21;&#x80FD;&#x8BB2;&#x6E05;&#x695A;&#xFF0C;&#x4FDD;&#x6301;&#x4E0D;&#x65AD;&#x5730;&#x4EA4;&#x6D41;&#x4E0E;&#x5206;&#x4EAB;&#x624D;&#x662F;&#x738B;&#x9053;&#x3002; &#x4E0D;&#x8FC7;&#x8FD8;&#x662F;&#x90A3;&#x53E5;&#x8BDD;&#x8BF4;&#x8D77;&#x6765;&#x5BB9;&#x6613;&#xFF0C;&#x505A;&#x8D77;&#x6765;&#x96BE;&#x3002;&#x4EBA;&#x603B;&#x662F;&#x6B66;&#x65AD;&#x5730;&#xFF0C;&#x603B;&#x662F;&#x8D8B;&#x5411;&#x4E8E;&#x7528;0/1&#x6765;&#x533A;&#x5206;&#x4E16;&#x754C;&#x3002;&#x8981;&#x4E48;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x8981;&#x4E48;&#x4E0D;&#x7406;&#x89E3;&#x3002;&#x7406;&#x89E3;&#x4E86;&#x5C31;&#x60F3;&#x5F53;&#x7136;&#x5730;&#x6309;&#x7167;&#x81EA;&#x5DF1;&#x7684;&#x60F3;&#x6CD5;&#x53BB;&#x505A;&#xFF0C;&#x4E0D;&#x7406;&#x89E3;&#x5C31;&#x66B4;&#x8DF3;&#x5982;&#x96F7;(&#x6216;&#x8005;&#x7070;&#x5FC3;&#x4E27;&#x6C14;)&#xFF0C;&#x5FC3;&#x91CC;&#x9A82;&#x4E00;&#x53E5;:&#x50BB;&#x903C;!&#x8BB2;&#x5F97;&#x4EC0;&#x4E48;&#x4E71;&#x4E03;&#x516B;&#x7CDF;&#x7684;! &#x4E0E;&#x541B;&#x5171;&#x52C9;,&#x5207;&#x8BB0;,&#x5207;&#x8BB0;&#x3002; &#x5199;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x60F3;&#x8BF4;&#x7684;&#x5176;&#x5B9E;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5DE5;&#x4F5C;&#x591A;&#x5E74;&#x7684;&#x6211;&#x4EEC;&#x9664;&#x4E86;&#x6280;&#x80FD;&#x508D;&#x8EAB;&#xFF0C;&#x4FEE;&#x70BC;&#x81EA;&#x5DF1;&#x624D;&#x80FD;&#x63D0;&#x9AD8;&#x6838;&#x5FC3;&#x7ADE;&#x4E89;&#x529B;&#x3002;&#x9644;&#x8A00;&#x4E2D;&#x9A73;&#x65A5;&#x4E00;&#x4E0B;&#x4E09;&#x70B9;&#x52A3;&#x52BF;&#x3002;&#x4E4B;&#x6240;&#x4EE5;&#x4E0D;&#x6536;&#x5165;&#x6B63;&#x6587;&#xFF0C;&#x4E5F;&#x662F;&#x501F;&#x4EE5;&#x8868;&#x8FBE;&#xFF0C;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x505A;&#x597D;&#x81EA;&#x5DF1;&#xFF0C;&#x6240;&#x6709;&#x52A3;&#x52BF;&#x4E0D;&#x653B;&#x81EA;&#x7834;&#x3002;&#x5BE5;&#x5BE5;&#x6570;&#x8A00;&#xFF0C;&#x4E0E;&#x541B;&#x5171;&#x52C9;&#x3002; &#x9644;: &#x5173;&#x4E8E;&#x4E09;&#x70B9;&#x52A3;&#x52BF; &#x65F6;&#x95F4;&#x4E0D;&#x81EA;&#x7531;&#xFF0C;&#x4E0D;&#x5229;&#x4E8E;&#x52A0;&#x73ED; &#x5E74;&#x8F7B;&#x4EBA;&#x79EF;&#x6781;&#x4E0A;&#x8FDB;&#x662F;&#x597D;&#x4E8B;&#xFF0C;&#x8FD9;&#x4E5F;&#x7ED9;&#x6211;&#x4EEC;&#x8FD9;&#x4E9B;&#x8001;&#x814A;&#x8089;&#x65E0;&#x5F62;&#x7684;&#x538B;&#x529B;&#x3002;&#x8FD9;&#x4E2A;&#x8981;&#x627F;&#x8BA4;&#xFF0C;&#x65F6;&#x95F4;&#x786E;&#x5B9E;&#x662F;&#x5E74;&#x8F7B;&#x4EBA;&#x7684;&#x4F18;&#x52BF;&#x3002;&#x8001;&#x5458;&#x5DE5;&#x5F53;&#x4EE5;&#x79EF;&#x6781;&#x7684;&#x5FC3;&#x6001;&#x53BB;&#x9762;&#x5BF9;&#x3002;&#x4E0D;&#x8981;&#x61C8;&#x6020;&#xFF0C;&#x5426;&#x5219;&#x88AB;&#x8D76;&#x8D85;&#x662F;&#x8FDF;&#x65E9;&#x7684;&#x4E8B;&#x513F;&#x3002;&#x4F46;&#x4E5F;&#x4E0D;&#x5FC5;&#x60F6;&#x6050;&#x3002;&#x56E0;&#x4E3A;&#x4EA7;&#x51FA;&#x7684;&#x4E3B;&#x5BFC;&#x56E0;&#x7D20;&#x662F;&#x6548;&#x7387;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x7EDD;&#x5BF9;&#x65F6;&#x95F4;&#x7684;&#x6295;&#x5165;(&#x4F1A;&#x53E6;&#x5F00;&#x7BC7;&#x6765;&#x63A2;&#x8BA8;)&#x3002;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x6BCF;&#x5929;&#x7684;&#x9AD8;&#x6548;&#x65F6;&#x95F4;&#xFF0C;&#x8FDC;&#x6BD4;&#x52A0;&#x591A;&#x5C11;&#x73ED;&#x91CD;&#x8981;&#x3002; &#x6280;&#x672F;&#x843D;&#x4F0D;&#x4E86;&#xFF0C;&#x4E0D;&#x80FD;&#x63A5;&#x53D7;&#x65B0;&#x4E8B;&#x7269; &#x6280;&#x672F;&#x8FD9;&#x4EF6;&#x4E8B;&#x672C;&#x6765;&#x5C31;&#x662F;&#x52A8;&#x6001;&#x7684;&#xFF0C;&#x5C24;&#x5176;&#x8FD1;&#x51E0;&#x5E74;&#x65B0;&#x6280;&#x672F;&#x5C42;&#x51FA;&#x4E0D;&#x7A77;&#x3002;&#x505A;&#x8F6F;&#x4EF6;&#x7684;&#x5F88;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x611F;&#x53D7;&#x5230;&#x9694;&#x884C;&#x5982;&#x9694;&#x5C71;&#x3002;&#x505A;&#x5E95;&#x5C42;&#x8F6F;&#x4EF6;&#x7684;&#xFF0C;&#x53EF;&#x80FD;&#x8FDE;&#x4E0A;&#x5C42;&#x8F6F;&#x4EF6;&#x7528;&#x5230;&#x7684;&#x540D;&#x8BCD;&#x4F60;&#x90FD;&#x6CA1;&#x542C;&#x8FC7;&#xFF0C;&#x5373;&#x4FBF;&#x4F60;&#x4EEC;&#x7528;&#x540C;&#x4E00;&#x79CD;&#x8BED;&#x8A00;&#x5F00;&#x53D1;&#x3002;&#x4F46;&#x662F;&#x4F60;&#x6709;&#x6CA1;&#x6709;&#x60F3;&#x8FC7;&#xFF0C;&#x5C31;&#x4EE5;&#x7F16;&#x7A0B;&#x6765;&#x8BB2;&#xFF0C;&#x867D;&#x7136;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x5343;&#x5343;&#x4E07;&#x4E07;&#xFF0C;&#x5404;&#x79CD;&#x6846;&#x67B6;&#x66F4;&#x662F;&#x6570;&#x4E0D;&#x80DC;&#x6570;&#xFF0C;&#x4F46;&#x4ED6;&#x4EEC;&#x7684;&#x57FA;&#x7840;&#x53D8;&#x8FC7;&#x5417;&#xFF1F;&#x54EA;&#x79CD;&#x8BED;&#x8A00;&#x6216;&#x6846;&#x67B6;&#x8981;&#x505A;&#x7684;&#x4E0D;&#x662F;&#x5BF9;&#x73B0;&#x5B9E;&#x4E16;&#x754C;&#x7684;&#x62BD;&#x8C61;&#xFF1F;&#x54EA;&#x79CD;&#x6280;&#x672F;&#x4E0D;&#x7528;&#x8C03;&#x8BD5;&#x89E3;&#x51B3;bug&#xFF1F;&#x54EA;&#x79CD;&#x6280;&#x672F;&#x4EA7;&#x751F;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x73B0;&#x5B9E;&#x7684;&#x95EE;&#x9898;&#xFF1F;&#x6240;&#x4EE5;&#x6280;&#x672F;&#x8868;&#x9762;&#x7684;&#x843D;&#x4F0D;&#x5E76;&#x4E0D;&#x53EF;&#x6015;&#xFF0C;&#x4FDD;&#x6301;&#x5BF9;&#x6280;&#x672F;&#x7EC8;&#x6781;&#x5965;&#x4E49;&#x7684;&#x63A2;&#x7A76;&#x624D;&#x662F;&#x5B9D;&#x8D35;&#x7684;&#x3002; &#x6F5C;&#x529B;&#x4E0D;&#x8DB3;&#xFF0C;&#x8A00;&#x4E0B;&#x4E4B;&#x610F;&#xFF0C;&#x4E0D;&#x518D;&#x613F;&#x610F;&#x5B66;&#x4E60;&#x6765;&#x63D0;&#x5347;&#x81EA;&#x5DF1; &#x4EBA;&#x672C;&#x80FD;&#x662F;&#x8D8B;&#x5229;&#x907F;&#x5BB3;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5FC3;&#x7406;&#x4E0A;&#x4F1A;&#x672C;&#x80FD;&#x5730;&#x5B89;&#x4E8E;&#x8212;&#x9002;&#x533A;&#x3002;&#x5E74;&#x957F;&#x8005;&#x6613;&#x4FDD;&#x5B88;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x7684;&#x9605;&#x5386;&#x66F4;&#x591A;&#xFF0C;&#x5FC3;&#x7406;&#x8212;&#x9002;&#x533A;&#x66F4;&#x5927;; &#x5E74;&#x8F7B;&#x8005;&#x7ECF;&#x9A8C;&#x5C11;&#xFF0C;&#x8212;&#x9002;&#x533A;&#x66F4;&#x5C0F;&#xFF0C;&#x8868;&#x73B0;&#x51FA;&#x6613;&#x4E8E;&#x63A5;&#x53D7;&#x65B0;&#x9C9C;&#x4E8B;&#x7269;&#x3002;&#x4F46;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x7EDD;&#x5BF9;&#x7684;&#x3002;&#x63A8;&#x52A8;&#x4EBA;&#x6301;&#x7EED;&#x5730;&#x8D70;&#x51FA;&#x5FC3;&#x7406;&#x8212;&#x9002;&#x533A;&#x7684;&#xFF0C;&#x4E00;&#x5B9A;&#x662F;&#x6E90;&#x4E8E;&#x5185;&#x5FC3;&#x7684;&#xFF0C;&#x5BF9;&#x7EC8;&#x6781;&#x5965;&#x4E49;&#x7684;&#x6E34;&#x6C42;&#x3002;&#x8FD9;&#x901A;&#x5E38;&#x4E0E;&#x5E74;&#x9F84;&#x65E0;&#x5173;&#x3002;&#x6709;&#x4E9B;&#x4EBA;&#x5C11;&#x5E74;&#x6210;&#x540D;&#xFF0C;&#x6709;&#x4E9B;&#x4EBA;&#x5927;&#x5668;&#x665A;&#x6210;&#x3002;&#x6D3B;&#x5230;&#x8001;&#x5B66;&#x5230;&#x8001;&#x3002;&#x5B70;&#x4E0D;&#x89C1;&#x59DC;&#x592A;&#x516C;80&#x4F50;&#x6587;&#x738B;&#xFF0C;&#x9F50;&#x5411;&#x77F3;40&#x5B66;&#x5370;60&#x5B66;&#x753B;&#xFF0C;90&#x65B9;&#x6210;&#x4E39;&#x9752;&#x5999;&#x7B14;&#x3002; %E8%BF%99%E6%98%AF%E6%88%91%E6%9C%80%E6%83%B3%E5%86%99%E7%9A%84%E4%B8%80%E4%B8%AA%E8%AF%9D%E9%A2%98%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%88%91%E8%A7%89%E5%BE%97%E8%BF%99%E4%B9%9F%E6%98%AF%E6%9C%80%E5%A4%9A%E4%BA%BA%E5%9C%A8%E6%80%9D%E8%80%83%E7%AD%94%E6%A1%88%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E5%B0%A4%E5%85%B6%E6%98%AF%E5%83%8F%E6%88%91%E8%BF%99%E6%A0%B7%E9%9D%A2%E4%B8%B435%E5%B2%81%E5%8D%B1%E6%9C%BA%E7%9A%84%E4%BA%BA%E3%80%82%E8%87%AA%E5%B7%B1%E6%80%9D%E8%80%83%E4%BA%86%E5%BE%88%E5%A4%9A%EF%BC%8C%E4%B9%9F%E5%90%AC%E5%88%B0%E5%88%AB%E4%BA%BA%E7%9A%84%E7%BB%8F%E9%AA%8C%E4%B9%8B%E8%B0%88%EF%BC%8C%E5%9C%A8%E5%90%84%E7%A7%8D%E9%9D%A2%E8%AF%95%E5%8F%97%E6%8C%AB%E6%97%B6%EF%BC%8C%E4%B9%9F%E5%8F%8D%E6%80%9D%E5%BE%88%E5%A4%9A%E6%AC%A1%E3%80%82%E5%85%B6%E4%B8%AD%E6%9C%89%E4%BA%9B%E8%AE%B8%E5%BF%83%E5%BE%97%EF%BC%8C%E4%B8%8D%E8%AE%BA%E5%AF%B9%E9%94%99%EF%BC%8C%E4%B8%8E%E5%90%9B%E5%88%86%E4%BA%AB%E3%80%82%0A%E5%81%87%E5%A6%82%E6%9C%89%E8%BF%99%E6%A0%B7%E4%B8%80%E5%A4%A9%EF%BC%8C%E4%BD%A0%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%85%AC%E5%8F%B8%E5%B7%A5%E4%BD%9C%E4%BA%86%E5%BE%88%E5%A4%9A%E5%B9%B4(%E5%9B%A0%E4%B8%BA%E6%9C%AC%E4%BA%BA%E7%BB%8F%E5%8E%86%E6%9C%89%E9%99%90%EF%BC%8C%E5%B0%B1%E8%BF%98%E4%BB%A5%E6%88%91%E6%9C%80%E7%86%9F%E6%82%89%E7%9A%84%E7%A7%91%E6%8A%80%E5%85%AC%E5%8F%B8%E4%B8%BA%E4%BE%8B)%EF%BC%8C%E6%9D%A5%E4%BA%86%E4%B8%80%E4%B8%AA%E5%88%9A%E5%B7%A5%E4%BD%9C2%2C3%E5%B9%B4%E7%9A%84%E5%B0%8F%E4%BC%99%E5%AD%90%E3%80%82%E4%BD%A0%E4%BF%A9%E9%83%BD%E6%98%AF%E7%A8%8B%E5%BA%8F%E5%91%98%EF%BC%8C%E4%BD%A0%E8%A7%89%E5%BE%97%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BC%98%E5%8A%BF%EF%BC%8C%E5%8A%A3%E5%8A%BF%E5%9C%A8%E5%93%AA%E5%84%BF%E5%91%A2%EF%BC%9F%0A%E5%8A%A3%E5%8A%BF%2C%E6%88%91%E4%BB%AC%E5%A5%BD%E5%83%8F%E8%83%BD%E8%AF%B4%E4%B8%80%E5%A4%A7%E5%A0%86%3A%0A1.%20%E7%B2%BE%E5%8A%9B%E4%B8%8D%E8%A1%8C%E4%BA%86%EF%BC%8C%E8%A6%81%E5%85%BC%E9%A1%BE%E5%AE%B6%E5%BA%AD%EF%BC%8C%E8%A8%80%E4%B8%8B%E4%B9%8B%E6%84%8F%EF%BC%8C%E4%B8%8D%E5%88%A9%E4%BA%8E%E5%8A%A0%E7%8F%AD%0A2.%20%E6%8A%80%E6%9C%AF%E8%90%BD%E4%BC%8D%E4%BA%86%EF%BC%8C%E4%B8%8D%E8%83%BD%E6%8E%A5%E5%8F%97%E6%96%B0%E4%BA%8B%E7%89%A9%0A3.%20%E6%BD%9C%E5%8A%9B%E4%B8%8D%E8%B6%B3%EF%BC%8C%E8%A8%80%E4%B8%8B%E4%B9%8B%E6%84%8F%EF%BC%8C%E4%B8%8D%E5%86%8D%E6%84%BF%E6%84%8F%E5%AD%A6%E4%B9%A0%E6%9D%A5%E6%8F%90%E5%8D%87%E8%87%AA%E5%B7%B1%E3%80%82%0A%0A%E4%BC%98%E5%8A%BF%EF%BC%8C%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AA%E6%9C%89%E4%B8%80%E6%9D%A1%EF%BC%8C%E7%BB%8F%E9%AA%8C%E3%80%82%0A%E6%89%80%E8%B0%93%E7%9F%A5%E5%B7%B1%E7%9F%A5%E5%BD%BC%EF%BC%8C%E7%99%BE%E6%88%98%E4%B8%8D%E6%AE%86%E3%80%82%E6%88%91%E4%BB%AC%E5%A6%82%E4%BD%95%E5%8F%91%E6%8C%A5%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BC%98%E5%8A%BF%EF%BC%8C%E5%BC%A5%E8%A1%A5%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8A%A3%E5%8A%BF%EF%BC%8C%E6%89%8D%E8%83%BD%E6%89%93%E8%B5%A2%E8%BF%99%E5%9C%BA%E8%81%8C%E5%9C%BA%E4%B9%8B%E6%88%98%E3%80%82%0A%E7%BB%8F%E9%AA%8C%E5%88%B0%E5%BA%95%E9%87%8D%E8%A6%81%E5%90%97%EF%BC%9F%E5%9C%A8%E5%A6%82%E4%BB%8A%E6%8A%80%E6%9C%AF%E5%8F%98%E9%9D%A9%E5%A6%82%E6%AD%A4%E5%BF%AB%E7%9A%84%E4%BB%8A%E5%A4%A9%EF%BC%8C%E6%88%91%E4%BB%AC%E6%8E%8C%E6%8F%A1%E7%9A%84%E9%82%A3%E4%BA%9B%E8%80%81%E6%8E%89%E7%89%99%E7%9A%84%E6%8A%80%E6%9C%AF%E7%9C%9F%E7%9A%84%E9%87%8D%E8%A6%81%E5%90%97%3FOf%20course%EF%BC%8C%E5%BD%93%E7%84%B6%E3%80%82%E4%B8%80%E4%B8%AA%E9%AB%98%E6%95%88%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%88%E7%8E%87%E5%8F%AF%E4%BB%A5%E6%98%AF%E6%99%AE%E9%80%9A%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%8410%E5%80%8D%EF%BC%8C%E7%94%9A%E8%87%B3100%E5%80%8D%E3%80%82%E4%BD%A0%E5%9C%A8%E6%88%90%E9%95%BF%E8%B7%AF%E4%B8%8A%E8%B8%8F%E8%BF%87%E7%9A%84%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%9D%91%EF%BC%8C%E9%83%BD%E5%B8%AE%E5%8A%A9%E4%BD%A0%E7%A6%BB%E9%AB%98%E6%95%88%E7%A8%8B%E5%BA%8F%E5%91%98%E6%9B%B4%E8%BF%91%E4%B8%80%E6%AD%A5%E3%80%82%E4%BB%96%E5%8D%B3%E4%BE%BF%E5%B7%B2%E7%BB%8F%E6%9C%89%E4%B8%80%E4%BA%9B%E7%BB%8F%E9%AA%8C%E4%BA%86(2~3%E5%B9%B4)%EF%BC%8C%E4%BD%86%E4%BB%96%E8%B8%A9%E8%BF%87%E7%9A%84%E6%8A%80%E6%9C%AF%E4%B8%8A%E7%9A%84%E5%9D%91%E4%B8%80%E5%AE%9A%E6%B2%A1%E4%BD%A0%E5%A4%9A%EF%BC%8C%E4%BD%A0%E4%B8%80%E5%AE%9A%E6%9B%B4%E6%8E%A5%E8%BF%91%E8%BD%AF%E4%BB%B6%E7%BC%96%E7%A8%8B%E7%9A%84%E6%9C%AC%E8%B4%A8%E3%80%82%E5%90%8C%E6%97%B6%EF%BC%8C%E6%9C%AC%E8%A1%8C%E4%B8%9A%E7%9A%84%E7%A7%AF%E7%B4%AF%E4%B9%9F%E6%98%AF%E5%BE%88%E9%87%8D%E8%A6%81%E7%9A%84%E3%80%82%E7%BC%96%E7%A8%8B%E8%BF%99%E4%B8%80%E6%8A%80%E8%83%BD%EF%BC%8C%E8%B7%A8%E8%A1%8C%E4%B8%9A%E6%98%AF%E6%9C%89%E6%95%88%E7%9A%84%EF%BC%8C%E4%BD%86%E9%A2%86%E5%9F%9F%E7%9F%A5%E8%AF%86%E4%B8%8D%E8%A1%8C%E3%80%82%E5%81%9A%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9A%84%EF%BC%8C%E4%B8%80%E5%AE%9A%E6%B2%A1%E6%9C%89%E8%B8%A9%E8%BF%87%E9%80%A0%E6%B1%BD%E8%BD%A6%E7%9A%84%E5%9D%91%E3%80%82%E8%80%8C%E9%A2%86%E5%9F%9F%E7%9F%A5%E8%AF%86%E7%A1%AE%E5%AE%9E%E9%9C%80%E8%A6%81%E5%A4%A7%E9%87%8F%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%BB%8F%E9%AA%8C%E5%92%8C%E6%97%B6%E9%97%B4%E6%9D%A5%E6%B2%89%E6%B7%80%E3%80%82%0A%E6%8B%A5%E6%9C%89%E7%BB%8F%E9%AA%8C%E5%B0%B1%E8%83%BD%E8%B5%A2%E4%BA%86%E5%90%97%EF%BC%9F%E7%AD%94%E6%A1%88%E5%BD%93%E7%84%B6%E6%98%AF%E9%94%99%E9%94%99%E9%94%99%E3%80%82%E6%88%91%E4%BB%AC%E7%9A%84%E5%85%88%E8%BE%88%E5%91%8A%E8%AF%89%E6%88%91%E4%BB%AC%EF%BC%8C%E4%B8%8D%E8%83%BD%E8%BA%BA%E5%9C%A8%E5%8E%86%E5%8F%B2%E7%9A%84%E5%8A%9F%E5%8A%B3%E7%B0%BF%E4%B8%8A%E3%80%82%E7%BB%8F%E9%AA%8C%E5%8F%AA%E8%83%BD%E4%BB%A3%E8%A1%A8%E4%BD%A0%E5%BD%93%E5%89%8D%E7%9A%84%E7%8A%B6%E6%80%81%E3%80%82%E4%BB%8E%E5%85%AC%E5%8F%B8%E7%9A%84%E8%A7%92%E5%BA%A6%E7%9C%8B%EF%BC%8C%E4%BD%A0%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%A4%9A%E4%B8%80%E4%BA%9B%EF%BC%8C%E4%BB%A3%E8%A1%A8%E4%BD%A0%E5%BD%93%E5%89%8D%E7%9A%84%E8%83%BD%E5%8A%9B%E6%AF%94%E9%82%A3%E4%BD%8D%E5%B0%8F%E9%B2%9C%E8%82%89%E5%BC%BA%E4%B8%80%E4%BA%9B%E3%80%82%E5%8F%AA%E8%83%BD%E8%AF%B4%E6%98%8E%E4%BD%A0%E7%9A%84%E8%B5%B7%E8%B7%91%E7%BA%BF%E6%AF%94%E5%88%AB%E4%BA%BA%E9%9D%A0%E5%89%8D%E4%B8%80%E4%BA%9B%E3%80%82%E8%BF%99%E4%BA%9B%E7%BB%8F%E9%AA%8C%EF%BC%8C%E8%BF%99%E4%BD%8D%E5%B0%8F%E9%B2%9C%E8%82%89%E5%90%8C%E5%AD%A6%E5%8F%AA%E8%A6%81%E5%8B%A4%E5%A5%8B%E5%8A%AA%E5%8A%9B%EF%BC%8C%E5%8A%A0%E4%B8%8A%E8%B5%84%E8%B4%A8%E5%B0%9A%E5%8F%AF%EF%BC%8C%E8%BF%BD%E5%9B%9E%E6%9D%A5%E5%88%86%E5%88%86%E9%92%9F%E7%9A%84%E4%BA%8B%E6%83%85%E3%80%82%E6%89%93%E4%B8%AA%E4%B8%8D%E6%81%B0%E5%BD%93%E7%9A%84%E6%AF%94%E6%96%B9%EF%BC%8C%E4%BD%A0%E8%B7%9F%E5%8D%9A%E5%B0%94%E7%89%B9%E6%AF%94%E8%B5%9B%E8%B7%91%EF%BC%8C%E4%BD%A0%E8%B5%B7%E8%B7%91%E7%BA%BF%E6%8F%90%E5%89%8D%E4%B8%AA10%E7%B1%B3%EF%BC%8C%E6%9C%89%E6%AF%9B%E7%94%A8%E3%80%82%0A%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%83%B3%E8%A2%AB%E5%B9%B4%E8%BD%BB%E4%BA%BA%E8%B6%85%E8%B6%8A%EF%BC%8C%E4%BD%A0%E5%BF%85%E9%9C%80%E6%8B%A5%E6%9C%89%E5%8F%AA%E4%BE%9D%E9%9D%A0%E5%8E%9F%E5%A7%8B%E7%A7%AF%E7%B4%AF%E6%97%A0%E6%B3%95%E5%BE%97%E5%88%B0%E7%9A%84%E5%93%81%E8%B4%A8%E3%80%82%E5%A5%BD%E6%AF%94%E5%8F%A4%E4%BB%A3%E7%9A%84%E6%88%98%E4%BA%89%E3%80%82%E5%85%B5%E5%8A%9B%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BE%88%E9%87%8D%E8%A6%81%E7%9A%84%E5%9B%A0%E7%B4%A0%EF%BC%8C%E6%9C%89%E6%97%B6%E5%80%99%E9%9D%A0%E4%BA%BA%E5%A4%9A%E5%B0%B1%E8%83%BD%E8%B5%A2%E3%80%82%E5%BE%81%E5%85%B5%E5%8F%AA%E8%A6%81%E5%90%9B%E4%B8%BB%E8%82%AF%E5%87%BA%E9%92%B1%EF%BC%8C%E6%A8%AA%E5%BE%81%E6%9A%B4%E6%95%9B%EF%BC%8C%E6%8A%93%E5%A3%AE%E4%B8%81%EF%BC%8C%E4%BA%BA%E6%80%BB%E6%98%AF%E8%83%BD%E5%87%91%E5%87%BA%E6%9D%A5%E7%9A%84%E3%80%82%E4%BD%86%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%88%98%E4%BA%89%E8%BF%98%E6%98%AF%E4%BB%B0%E4%BB%97%E4%BC%98%E7%A7%80%E7%9A%84%E6%8C%87%E6%8C%A5%E5%AE%98%E5%92%8C%E6%9D%B0%E5%87%BA%E7%9A%84%E5%86%9B%E4%BA%8B%E5%AE%B6%E3%80%82%E5%90%9B%E4%B8%8D%E8%A7%81%E5%8E%86%E5%8F%B2%E4%B8%8A%E5%A4%9A%E5%B0%91%E4%BB%A5%E5%B0%91%E8%83%9C%E5%A4%9A%EF%BC%8C%E4%BB%A5%E5%BC%B1%E8%83%9C%E5%BC%BA%E7%9A%84%E6%88%98%E4%BE%8B%E3%80%82%E6%AD%A3%E6%89%80%E8%B0%93%E5%8D%83%E5%86%9B%E6%98%93%E5%BE%97%EF%BC%8C%E4%B8%80%E5%B0%86%E9%9A%BE%E6%B1%82%E3%80%82%E5%B7%A5%E4%BD%9C%E4%BA%A6%E6%98%AF%E5%A6%82%E6%AD%A4%EF%BC%8C%E7%BB%8F%E9%AA%8C%E7%9A%84%E7%A7%AF%E7%B4%AF%EF%BC%8C%E4%BE%9D%E9%9D%A0%E6%97%B6%E9%97%B4%E7%9A%84%E6%B2%89%E6%B7%80%EF%BC%8C%E7%B2%BE%E5%8A%9B%E7%9A%84%E4%BB%98%E5%87%BA%E6%80%BB%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%BE%97%E5%88%B0%E7%9A%84%E3%80%82%E4%BD%86%E4%BD%95%E4%B8%BA%E5%B0%86%E6%89%8D%EF%BC%8C%E6%8D%A2%E5%8F%A5%E8%AF%9D%E8%AF%B4%EF%BC%8C%E4%BB%80%E4%B9%88%E6%89%8D%E6%98%AF%E6%88%91%E4%BB%AC%E7%9A%84%E6%A0%B8%E5%BF%83%E7%AB%9E%E4%BA%89%E5%8A%9B%EF%BC%9F%E4%BB%80%E4%B9%88%E6%89%8D%E8%83%BD%E7%AD%91%E6%88%90%E5%9B%B4%E6%8A%A4%E8%81%8C%E5%9C%BA%E7%9A%84%E6%B7%B1%E6%B2%9F%E5%A4%A7%E5%A3%91%EF%BC%9F%E6%88%91%E6%80%BB%E7%BB%93%E5%A6%82%E4%B8%8B%3A%0A*%20%E9%A6%96%E8%A6%81%E7%9A%84%E6%98%AF%E4%B8%89%E8%A7%82%EF%BC%8C%E4%B8%96%E7%95%8C%E8%A7%82%2C%E4%BA%BA%E7%94%9F%E8%A7%82%EF%BC%8C%E4%BB%B7%E5%80%BC%E8%A7%82%0A*%20%E8%89%AF%E5%A5%BD%E7%9A%84%E8%87%AA%E7%9C%81%E4%B8%8E%E8%87%AA%E6%8E%A7%E8%83%BD%E5%8A%9B%EF%BC%8C%E8%89%AF%E5%A5%BD%E7%9A%84%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF%0A*%20%E8%83%BD%E5%AE%A2%E8%A7%82%E7%90%86%E6%99%BA%E5%9C%B0%E5%AF%B9%E5%BE%85%E4%BA%BA%E4%B8%8E%E4%BA%8B%E7%89%A9%EF%BC%8C%E5%87%A1%E4%BA%8B%E4%BF%9D%E6%8C%81%E6%AD%A3%E5%90%91%E6%80%9D%E7%BB%B4%0A*%20%E4%B8%8E%E4%BA%BA%E6%B2%9F%E9%80%9A%E7%9A%84%E8%83%BD%E5%8A%9B%0A*%20%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E7%88%B1%E5%A5%BD%EF%BC%8C%E6%9C%89%E5%AF%B9%E6%96%87%E5%AD%A6%E6%88%96%E8%89%BA%E6%9C%AF%E7%9A%84%E9%89%B4%E8%B5%8F%E8%83%BD%E5%8A%9B%0A%E7%BB%8F%E9%AA%8C%E6%98%AF%E6%8A%80%E6%9C%AF%E5%B1%82%E9%9D%A2%E7%9A%84%EF%BC%8C%E6%98%AF%E5%85%B5%E5%8A%9B%EF%BC%8C%E6%98%AF%E4%BD%A0%E7%9A%84%E7%AD%B9%E7%A0%81%E3%80%82%E5%A6%82%E4%BD%95%E6%8C%81%E7%BB%AD%E5%9C%B0%E6%8F%90%E5%8D%87%E8%87%AA%E5%B7%B1%EF%BC%8C%E5%A6%82%E4%BD%95%E8%BF%90%E7%94%A8%E5%A5%BD%E4%BD%A0%E7%9A%84%E7%AD%B9%E7%A0%81%E6%9D%A5%E6%9E%84%E5%BB%BA%E5%87%BA%E8%89%B2%E7%9A%84%E5%9B%A2%E9%98%9F%E6%94%BB%E5%9F%8E%E6%8B%94%E5%AF%A8%E3%80%82%E8%BF%99%E4%BA%9B%E4%BB%8E%E9%95%BF%E8%BF%9C%E7%9C%8B%EF%BC%8C%E6%88%91%E8%AE%A4%E4%B8%BA%E6%AF%94%E6%8A%80%E6%9C%AF%E6%9C%AC%E8%BA%AB%EF%BC%8C%E6%88%96%E7%BB%8F%E9%AA%8C%E6%9C%AC%E8%BA%AB%E6%9B%B4%E9%87%8D%E8%A6%81%E3%80%82%E6%AF%95%E7%AB%9F%E6%8A%80%E6%9C%AF(%E7%BB%8F%E9%AA%8C)%E6%98%AF%E6%AD%BB%E7%9A%84%EF%BC%8C%E5%AE%83%E4%B8%8D%E8%83%BD%E5%B8%AE%E4%BD%A0%E5%AE%8C%E6%88%90%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%81%9A%E5%87%BA%E4%BA%A7%E5%93%81%E3%80%82%E4%BA%BA%E6%89%8D%E6%98%AF%E6%B4%BB%E7%9A%84%EF%BC%8C%E6%80%8E%E4%B9%88%E6%8F%90%E5%8D%87%E8%87%AA%E5%B7%B1%EF%BC%8C%E6%95%B4%E5%90%88%E8%B5%84%E6%BA%90%EF%BC%8C%E6%89%8D%E8%83%BD%E5%B8%AE%E4%BD%A0%E5%81%9A%E5%87%BA%E5%A5%BD%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%A5%BD%E7%9A%84%E4%BA%A7%E5%93%81%E3%80%82%E6%89%80%E4%BB%A5%E8%BF%99%E4%BA%9B%E8%BD%AF%E6%8A%80%E8%83%BD%E6%89%8D%E6%98%AF%E7%9C%9F%E6%AD%A3%E7%9A%84%E6%A0%B8%E5%BF%83%E7%AB%9E%E4%BA%89%E5%8A%9B%E5%BA%94%E3%80%82%E8%80%8C%E4%B8%94%E6%89%80%E6%9C%89%E7%9A%84%E8%BF%99%E4%BA%9B%E8%BD%AF%E6%8A%80%E8%83%BD%E9%83%BD%E4%B8%8D%E6%98%AF%E9%9D%A0%E4%B8%80%E5%A4%A9%E4%B8%A4%E5%A4%A9%EF%BC%8C%E7%94%9A%E8%87%B3%E4%B8%80%E5%B9%B4%E4%B8%A4%E5%B9%B4%E7%9A%84%E9%80%9F%E6%88%90%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%88%B0%E7%9A%84%E3%80%82%E4%BB%96%E9%9C%80%E8%A6%81%E6%80%9D%E8%80%83%E3%80%81%E6%80%BB%E7%BB%93%E3%80%81%E9%A1%BF%E6%82%9F%EF%BC%8C%E6%9C%89%E6%84%8F%E8%AF%86%E5%9C%B0%E8%AE%AD%E7%BB%83%E8%87%AA%E5%B7%B1%E3%80%82%0A%0A%23%23%20%E4%B8%96%E7%95%8C%E8%A7%82%EF%BC%8C%E4%BA%BA%E7%94%9F%E8%A7%82%EF%BC%8C%E4%BB%B7%E5%80%BC%E8%A7%82%0A%E6%89%80%E8%B0%93%E4%B8%89%E8%A7%82%E4%B8%8D%E6%AD%A3%EF%BC%8C%E4%BD%95%E4%BB%A5%E6%AD%A3%E5%A4%A9%E4%B8%8B%E3%80%82%E6%88%91%E7%90%86%E8%A7%A3%E7%9A%84%E4%B8%89%E8%A7%82%3A%0A*%20%E4%B8%96%E7%95%8C%E8%A7%82%3A%E6%AF%8F%E4%B8%AA%E4%BA%BA%E7%9A%84%E7%A4%BE%E4%BC%9A%E5%9C%B0%E4%BD%8D%E4%B8%8D%E5%90%8C%2C%20%E8%AE%A4%E7%9F%A5%E4%B8%8D%E5%90%8C%EF%BC%8C%E8%A7%82%E5%AF%9F%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%92%E5%BA%A6%E4%B9%9F%E4%B8%8D%E5%90%8C%EF%BC%8C%E9%80%A0%E6%88%90%E7%9A%84%E8%A7%82%E5%BF%B5%E6%88%96%E8%A7%82%E7%82%B9%E7%9A%84%E5%B7%AE%E5%88%AB%E3%80%82%E4%BE%8B%E5%A6%82%3A%E4%BD%A0%E6%80%BB%E8%83%BD%E7%9C%8B%E5%88%B0%E4%B8%80%E4%BB%B6%E4%BA%8B%E7%9A%84%E5%A5%BD%E5%A4%84%E5%92%8C%E5%9D%8F%E5%A4%84%E5%90%97%3F%E4%BD%A0%E6%80%BB%E8%83%BD%E7%90%86%E8%A7%A3%E4%B8%80%E4%BB%B6%E4%BA%8B%E9%99%A4%E4%BA%86%E5%A5%BD%E5%92%8C%E5%9D%8F%EF%BC%8C%E5%AE%83%E5%85%B6%E5%AE%9E%E6%80%BB%E6%98%AF%E5%A4%84%E4%BA%8E%E4%B8%80%E4%B8%AA%E5%8A%A8%E6%80%81%E7%9A%84%E4%B8%AD%E9%97%B4%E6%80%81%E5%90%97%EF%BC%9F%E4%BA%BA%E8%AF%B4%E4%BC%97%E7%94%9F%E5%B9%B3%E7%AD%89%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E8%83%BD%E5%81%9A%E5%88%B0%E5%90%97%EF%BC%9F%0A*%20%E4%BA%BA%E7%94%9F%E8%A7%82%3A%20%E4%BA%BA%E6%B4%BB%E4%B8%80%E4%B8%96%EF%BC%8C%E5%88%B0%E5%BA%95%E4%BB%80%E4%B9%88%E6%89%8D%E6%98%AF%E4%BD%A0%E6%83%B3%E8%A6%81%E7%9A%84%E7%94%9F%E6%B4%BB%E3%80%82%E4%BD%A0%E8%BE%9B%E8%8B%A6%E5%B7%A5%E4%BD%9C%E5%88%B0%E5%BA%95%E6%98%AF%E4%B8%BA%E4%BA%86%E8%B0%81%EF%BC%9F%E6%98%AF%E9%92%B1%E9%87%8D%E8%A6%81%EF%BC%8C%E6%98%AF%E5%BF%AB%E4%B9%90%E9%87%8D%E8%A6%81%EF%BC%8C%E6%98%AF%E5%AE%B6%E5%BA%AD%E9%87%8D%E8%A6%81%EF%BC%8C%E8%BF%98%E6%98%AF%E6%88%90%E5%B0%B1%E6%84%9F%E9%87%8D%E8%A6%81%3F%E7%9B%B4%E5%87%BB%E5%86%85%E5%BF%83%E5%90%97%3F%E6%83%B3%E6%B8%85%E6%A5%9A%E4%BA%86%E5%90%97%3F%0A*%20%E4%BB%B7%E5%80%BC%E8%A7%82%3A%20%E4%BB%80%E4%B9%88%E6%98%AF%E5%AF%B9%E4%BD%A0%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%EF%BC%9F%E9%92%B1%E5%90%97%3F%E6%9C%AA%E6%9D%A5%E7%9A%84%E5%8F%91%E5%B1%95%EF%BC%9F%E8%80%81%E6%9D%BF%E5%AE%89%E6%8E%92%E4%BD%A0%E5%81%9A%E4%B8%80%E4%BB%B6%E7%90%90%E7%A2%8E%E7%9A%84%E4%BA%8B%EF%BC%8C%E4%BD%A0%E8%83%BD%E7%9C%8B%E5%88%B0%E5%AF%B9%E4%BD%A0%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%83%A8%E5%88%86%E5%90%97%3F%0A%E6%8B%A5%E6%9C%89%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84%E4%B8%89%E8%A7%82%EF%BC%8C%E6%89%8D%E8%83%BD%E6%9B%B4%E5%AE%B9%E6%98%93%E6%91%86%E6%AD%A3%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BF%83%E6%80%81%EF%BC%8C%E6%98%8E%E7%A1%AE%E8%87%AA%E5%B7%B1%E5%89%8D%E8%BF%9B%E7%9A%84%E6%96%B9%E5%90%91%EF%BC%8C%E7%90%86%E6%80%A7%E8%80%8C%E5%B9%B3%E5%92%8C%E5%9C%B0%E5%AF%B9%E5%BE%85%E8%BA%AB%E8%BE%B9%E7%9A%84%E4%BA%BA%E5%92%8C%E4%BA%8B%EF%BC%8C%E7%A7%AF%E6%9E%81%E6%AD%A3%E5%90%91%E5%9C%B0%E5%8E%BB%E7%94%9F%E6%B4%BB%E3%80%82%0A%E4%B8%89%E8%A7%82%E7%9A%84%E5%BD%A2%E6%88%90%E6%9C%89%E8%AF%B8%E5%A4%9A%E5%9B%A0%E7%B4%A0--%E5%8E%9F%E7%94%9F%E5%AE%B6%E5%BA%AD%EF%BC%8C%E6%95%99%E8%82%B2%EF%BC%8C%E9%98%85%E5%8E%86%E7%AD%89%E7%AD%89%E3%80%82%E4%B8%80%E4%B8%AA%E4%BA%BA%E7%9A%84%E4%B8%89%E8%A7%82%E5%90%8C%E6%97%B6%E4%B9%9F%E6%98%AF%E4%B8%8D%E6%96%AD%E5%8F%98%E5%8C%96%E7%9D%80%E3%80%82%E4%BD%A0%E8%AF%BB%E8%BF%87%E7%9A%84%E6%AF%8F%E4%B8%80%E6%9C%AC%E4%B9%A6%2C%E6%AF%8F%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E9%83%BD%E5%9C%A8%E6%97%A0%E5%BD%A2%E4%B9%8B%E4%B8%AD%E5%BD%B1%E5%93%8D%E7%9D%80%E4%BD%A0%E3%80%82%E4%BD%86%E5%86%85%E5%9B%A0%E6%80%BB%E6%98%AF%E4%B8%BB%E5%AF%BC%E5%9B%A0%E7%B4%A0%EF%BC%8C%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E6%88%90%E5%B9%B4%E4%BA%BA%EF%BC%8C%E5%88%AB%E4%BA%BA%E5%B7%B2%E7%BB%8F%E5%BE%88%E9%9A%BE%E6%95%99%E4%BC%9A%E4%BD%A0%E4%BB%80%E4%B9%88%E3%80%82%E8%87%AA%E5%B7%B1%E5%A4%9A%E6%80%9D%E8%80%83%EF%BC%8C%E5%A4%9A%E6%B1%82%E8%AF%81%EF%BC%8C%E6%89%8D%E4%BC%9A%E6%88%90%E9%95%BF%E3%80%82%0A%0A%23%23%20%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E7%88%B1%E5%A5%BD%EF%BC%8C%E6%9C%89%E5%AF%B9%E6%96%87%E5%AD%A6%E6%88%96%E8%89%BA%E6%9C%AF%E7%9A%84%E9%89%B4%E8%B5%8F%E8%83%BD%E5%8A%9B%0A%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E7%88%B1%E5%A5%BD%E6%98%AF%E4%B8%80%E4%BB%B6%E5%BE%88%E5%A5%BD%E7%9A%84%E4%BA%8B%E6%83%85%E3%80%82%E6%88%91%E4%BB%AC%E7%9A%84%E4%B8%96%E7%95%8C%E6%9C%AC%E6%9D%A5%E5%B0%B1%E6%98%AF%E5%A4%8D%E6%9D%82%E7%9A%84%E3%80%82%E4%BB%96%E4%B8%8D%E6%98%AF%E5%8F%AA%E7%94%B1%E4%B8%80%E5%A0%86%E9%80%BB%E8%BE%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5%E7%9A%84%EF%BC%8C%E9%82%A3%E6%98%AF%E6%B8%B8%E6%88%8F%EF%BC%8C%E6%98%AF%E8%99%9A%E6%8B%9F%E4%B8%96%E7%95%8C%E3%80%82%E7%8E%B0%E5%AE%9E%E4%B8%96%E7%95%8C%E8%A6%81%E5%A4%8D%E6%9D%82%E5%BE%97%E5%A4%9A%E3%80%82%E5%9C%A8%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%A4%96%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E7%88%B1%E5%A5%BD%EF%BC%8C%E4%BE%8B%E5%A6%82%E8%89%BA%E6%9C%AF%EF%BC%8C%E6%91%84%E5%BD%B1%EF%BC%8C%E9%9F%B3%E4%B9%90%E8%88%9E%E8%B9%88%EF%BC%8C%E4%BA%A6%E6%88%96%E6%98%AF%E8%8A%B1%E9%B8%9F%E8%99%AB%E9%B1%BC%EF%BC%8C%E4%BD%93%E8%82%B2%E8%BF%90%E5%8A%A8%EF%BC%8C%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%B8%AE%E5%8A%A9%E4%BD%A0%E4%BB%8E%E4%B8%8D%E5%90%8C%E7%BB%B4%E5%BA%A6%E5%8E%BB%E7%90%86%E8%A7%A3%E4%B8%96%E7%95%8C%EF%BC%8C%E5%8E%BB%E8%AE%A4%E8%AF%86%E4%BD%A0%E8%87%AA%E5%B7%B1%E3%80%82%E4%BB%8E%E8%80%8C%E5%B8%AE%E5%8A%A9%E4%BD%A0%E6%A0%91%E7%AB%8B%E6%88%96%E4%BF%AE%E6%AD%A3%E4%BD%A0%E7%9A%84%E4%B8%89%E8%A7%82%E3%80%82%E4%BA%BA%E4%BB%AC%E5%B8%B8%E8%AF%B4%E7%9A%84%E9%99%B6%E5%86%B6%E6%83%85%E6%93%8D%EF%BC%8C%E5%A4%A7%E6%8A%B5%E5%A6%82%E6%AD%A4%E3%80%82%E5%8F%A6%E4%B8%80%E6%96%B9%E9%9D%A2%EF%BC%8C%E5%81%9A%E4%BD%A0%E7%88%B1%E5%81%9A%E7%9A%84%E4%BA%8B%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%BA%AB%E5%BF%83%E5%BF%85%E6%98%AF%E6%84%89%E6%82%A6%E7%9A%84%EF%BC%8C%E8%BF%99%E6%A0%B7%E8%83%BD%E6%9B%B4%E5%A5%BD%E5%9C%B0%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B9%8B%E4%BD%99%E6%94%BE%E6%9D%BE%E8%87%AA%E5%B7%B1%EF%BC%8C%E9%87%8A%E6%94%BE%E5%8E%8B%E5%8A%9B%EF%BC%8C%E5%86%8D%E5%B7%A5%E4%BD%9C%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E6%9B%B4%E7%90%86%E6%99%BA%EF%BC%8C%E6%9B%B4%E4%B8%93%E6%B3%A8%E3%80%82%E6%95%88%E7%8E%87%E8%87%AA%E7%84%B6%E5%B0%B1%E9%AB%98%E4%BA%86%E3%80%82%E8%AE%B0%E5%BE%97%E4%B8%8A%E5%AD%A6%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%80%81%E5%B8%88%E7%BB%8F%E5%B8%B8%E6%8F%90%E8%B5%B7%E8%BF%99%E6%A0%B7%E4%B8%80%E7%A7%8D%E4%BA%BA%EF%BC%8C%E6%95%B4%E5%A4%A9%E5%9C%A8%E7%8E%A9%EF%BC%8C%E8%80%83%E8%AF%95%E6%80%BB%E8%83%BD%E5%90%8D%E5%88%97%E5%89%8D%E8%8C%85%E3%80%82%E7%8E%B0%E5%9C%A8%E6%83%B3%E6%9D%A5%E8%BF%99%E4%BA%9B%E4%BA%BA%E9%99%A4%E4%BA%86%E6%99%BA%E5%95%86%E9%AB%98%EF%BC%8C%E7%88%B1%E5%A5%BD%E5%92%8C%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%85%B3%E7%B3%BB%E4%B8%80%E5%AE%9A%E4%B9%9F%E5%A4%84%E7%90%86%E5%BE%97%E5%BE%88%E5%A5%BD%E3%80%82%0A%0A%23%23%20%E8%87%AA%E7%9C%81%E4%B8%8E%E8%87%AA%E6%8E%A7%E8%83%BD%E5%8A%9B%0A%E8%BF%99%E4%B8%AA%E8%AF%B4%E8%B5%B7%E6%9D%A5%E5%AE%B9%E6%98%93%EF%BC%8C%E5%81%9A%E8%B5%B7%E6%9D%A5%E7%9C%9F%E7%9A%84%E5%BE%88%E9%9A%BE%E3%80%82%E9%9C%80%E8%A6%81%E5%A4%A7%E5%AE%B6%E7%94%A8%E5%BF%83%E5%8E%BB%E4%BD%93%E4%BC%9A%E3%80%82%E4%BD%95%E4%B8%BA%E8%87%AA%E7%9C%81%3F%E5%AD%94%E5%AD%90%E6%9B%B0%EF%BC%8C%E5%90%BE%E6%97%A5%E4%B8%89%E7%9C%81%E5%90%BE%E8%BA%AB%E3%80%82%E5%8D%8E%E4%B8%BA%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BB%B7%E5%80%BC%E8%A7%82%E6%9C%89%EF%BC%8C%E5%9D%9A%E6%8C%81%E8%87%AA%E6%88%91%E6%89%B9%E5%88%A4%E3%80%82%E8%BF%99%E5%B0%B1%E6%98%AF%E8%87%AA%E7%9C%81%E3%80%82%E5%BD%93%E5%8F%91%E7%94%9F%E9%97%AE%E9%A2%98%E6%97%B6%EF%BC%8C%E4%BA%BA%E4%BB%AC%E4%BC%9A%E6%9C%AC%E8%83%BD%E5%9C%B0%E8%AE%A4%E4%B8%BA%E9%83%BD%E6%98%AF%E5%88%AB%E4%BA%BA%E7%9A%84%E8%B4%A3%E4%BB%BB%E3%80%82%E5%9B%A0%E4%B8%BA%E4%BD%A0%E5%AF%B9%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%86%E8%A7%A3%E4%B8%80%E5%AE%9A%E8%83%9C%E8%BF%87%E5%AF%B9%E5%88%AB%E4%BA%BA%E7%9A%84%E4%BA%86%E8%A7%A3%E3%80%82%E5%9B%A0%E4%B8%BA%E4%B8%8D%E4%BA%86%E8%A7%A3%E8%80%8C%E6%80%80%E7%96%91%EF%BC%8C%E8%BF%9B%E8%80%8C%E6%9C%89%E6%84%8F%E6%97%A0%E6%84%8F%E7%9A%84%E7%94%A9%E9%94%85%E3%80%82%E5%9C%A8%E7%94%A9%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8D%B3%E4%BE%BF%E5%9C%A8%E7%94%A9%E4%B9%8B%E5%90%8E%2C%E8%83%BD%E4%B8%8D%E8%83%BD%E5%8D%B3%E6%97%B6%E5%9C%B0%E8%AE%A4%E8%AF%86%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F%E6%AD%A4%E4%B8%BA%E8%87%AA%E7%9C%81%E3%80%82%0A%E8%87%AA%E6%8E%A7%E6%98%AF%E4%BD%A0%E8%83%BD%E5%AF%B9%E6%8A%97%E4%BD%A0%E7%9A%84%E6%AC%B2%E6%9C%9B%E5%90%97%EF%BC%9F%E5%BD%93%E4%BD%A0%E5%9C%A8%E5%81%9A%E8%95%83%E8%8C%84%E9%92%9F%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%83%BD%E5%85%8B%E5%88%B6%E8%87%AA%E5%B7%B1%E4%B8%8D%E7%8E%A9%E6%89%8B%E6%9C%BA%E5%90%97%EF%BC%9F%E5%9C%A8%E7%BC%96%E7%A8%8B%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%83%BD%E6%8E%A7%E5%88%B6%E8%87%AA%E5%B7%B1%E6%80%BB%E6%98%AF%E6%83%B3%E6%8A%8A%E4%BB%A3%E7%A0%81%E8%AE%BE%E8%AE%A1%E5%BE%97%E5%A4%A7%E8%80%8C%E5%85%A8%E7%9A%84%E6%AC%B2%E6%9C%9B%E5%90%97%3F%E4%BD%A0%E8%83%BD%E6%97%A0%E8%AE%BA%E5%86%AC%E5%A4%8F%E6%AF%8F%E5%A4%A96%E7%82%B9%E8%B5%B7%E5%BA%8A10%E7%82%B9%E7%9D%A1%E8%A7%89%EF%BC%8C%E4%B8%80%E5%91%A8%E8%BF%90%E5%8A%A83%E6%AC%A1%E5%90%97%EF%BC%9F%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E6%AC%B2%E6%9C%9B%E6%97%A0%E5%A4%84%E4%B8%8D%E5%9C%A8%EF%BC%8C%E7%94%A8%E5%BD%93%E4%B8%8B%E6%B5%81%E8%A1%8C%E7%9A%84%E8%AF%9D%E8%AF%B4%EF%BC%8C%E4%BD%A0%E8%83%BD%E4%BF%9D%E6%8C%81%E5%88%9D%E5%BF%83%E5%90%97%3F%0A%E8%89%AF%E5%A5%BD%E7%9A%84%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF%E4%BE%9D%E8%B5%96%E4%BA%8E%E8%89%AF%E5%A5%BD%E7%9A%84%E8%87%AA%E6%8E%A7%E5%8A%9B%E3%80%82%E8%BF%99%E9%87%8C%E5%8D%95%E7%8B%AC%E5%9C%B0%E6%8F%90%E5%87%BA%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%81%A5%E5%BA%B7%E5%AF%B9%E6%88%91%E4%BB%AC%E5%A4%AA%E9%87%8D%E8%A6%81%E4%BA%86%E3%80%82%E5%8D%8E%E4%B8%BA%E6%9C%89%E5%8F%A5%E8%AF%9D%EF%BC%8C%E5%B7%A5%E4%BD%9C%E6%98%AF%E5%9C%BA%E9%A9%AC%E6%8B%89%E6%9D%BE%EF%BC%8C%E4%B8%8D%E6%98%AF100%E7%B1%B3%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%8D%E9%9C%80%E8%A6%81%E6%97%B6%E5%88%BB%E5%86%B2%E5%88%BA%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E6%9C%80%E5%90%8E%E7%9A%84%E8%83%9C%E5%88%A9%E3%80%82%E5%B7%A5%E4%BD%9C%E4%B8%A2%E4%BA%86%E8%BF%98%E8%83%BD%E6%89%BE%E5%9B%9E%E6%9D%A5%EF%BC%8C%E5%81%A5%E5%BA%B7%E3%80%81%E5%AE%B6%E5%BA%AD%E3%80%81%E6%84%9F%E6%83%85%E4%B8%9F%E4%BA%86%E5%B0%B1%E5%86%8D%E4%B9%9F%E6%B2%A1%E6%9C%89%E4%BA%86%E3%80%82%E6%9C%80%E5%90%8E%E5%A5%97%E7%94%A8%E9%83%AD%E5%BE%B7%E7%BA%B2%E4%B8%80%E5%8F%A5%E8%AF%9D%3A%20%E4%BB%80%E4%B9%88%E6%98%AF%E8%89%BA%E6%9C%AF%E5%AE%B6%EF%BC%9F%E6%8A%8A%E4%BD%A0%E7%86%AC%E6%8C%82%E4%BA%86%EF%BC%8C%E6%88%91%E5%B0%B1%E6%98%AF%E8%89%BA%E6%9C%AF%E5%AE%B6%E3%80%82%0A%0A%23%23%20%E5%87%A1%E4%BA%8B%E4%BF%9D%E6%8C%81%E6%AD%A3%E5%90%91%E6%80%9D%E7%BB%B4%0A%E5%B7%A5%E4%BD%9C%E4%BA%86%E6%8E%A5%E8%BF%9110%E5%B9%B4%E4%BA%86%EF%BC%8C%E5%8F%AF%E8%83%BD%E6%98%AF%E6%88%91%E6%8E%A5%E8%A7%A6%E7%9A%84%E4%BA%BA%E4%B8%8D%E5%A4%9F%E5%A4%9A%EF%BC%8C%E7%9C%9F%E6%AD%A3%E8%83%BD%E6%97%B6%E5%88%BB%E4%BF%9D%E6%8C%81%E6%AD%A3%E8%83%BD%E9%87%8F%E7%9A%84%E4%BA%BA%E4%B8%8D%E5%A4%9A%EF%BC%8C%E4%BD%86%E4%B9%9F%E8%BF%98%E6%98%AF%E6%9C%89%E7%9A%84%E3%80%82%0A%E6%88%91%E6%89%80%E8%B0%93%E7%9A%84%E4%BF%9D%E6%8C%81%E6%AD%A3%E8%83%BD%E9%87%8F%EF%BC%8C%E4%B8%8D%E6%98%AF%E5%AD%A6%E9%9B%B7%E9%94%8B%EF%BC%8C%E4%B8%80%E4%B8%8D%E6%80%95%E8%8B%A6%E4%BA%8C%E4%B8%8D%E6%80%95%E7%B4%AF%3B%E6%88%96%E8%80%85%E4%BA%8B%E4%BA%8B%E4%BD%9B%E7%B3%BB%EF%BC%8C%E4%B8%8D%E5%97%94%E4%B8%8D%E6%80%92%E4%B8%8D%E5%96%9C%E4%B8%8D%E6%82%B2%E3%80%82%E9%82%A3%E9%83%BD%E6%98%AF%E6%A6%82%E5%BF%B5%E4%BA%BA%EF%BC%8C%E6%97%A0%E8%A1%80%E6%97%A0%E8%82%89%E3%80%82%E8%BF%99%E9%87%8C%E6%83%B3%E8%AF%B4%E7%9A%84%E6%98%AF%EF%BC%8C%E5%85%B6%E5%AE%9E%E5%87%A1%E4%BA%8B%E9%83%BD%E6%9C%89%E6%AD%A3%E5%8F%8D%E4%B8%A4%E9%9D%A2%E3%80%82%E5%9C%A8%E9%80%86%E5%A2%83%E4%B8%AD%EF%BC%8C%E8%83%BD%E7%9C%8B%E5%88%B0%E6%AD%A3%E9%9D%A2%EF%BC%8C%E4%BF%9D%E6%8C%81%E7%A7%AF%E6%9E%81%E5%90%91%E4%B8%8A%3B%20%E5%BE%97%E6%84%8F%E6%97%B6%EF%BC%8C%E8%83%BD%E7%9C%8B%E5%88%B0%E5%8F%8D%E9%9D%A2%EF%BC%8C%E6%97%B6%E5%88%BB%E8%AD%A6%E9%86%92%E8%87%AA%E5%B7%B1%EF%BC%8C%E8%83%9C%E4%B8%8D%E9%AA%84%E8%80%8C%E8%B4%A5%E4%B8%8D%E9%A6%81%E3%80%82%0A%0A%23%23%20%E4%B8%8E%E4%BA%BA%E6%B2%9F%E9%80%9A%E7%9A%84%E8%83%BD%E5%8A%9B%0A%E8%BF%99%E4%B8%AA%E4%B9%9F%E6%98%AF%E8%81%8C%E5%9C%BA%E4%B8%AD%E8%A2%AB%E4%BA%BA%E8%AF%B4%E7%83%82%E7%9A%84%E4%B8%80%E4%B8%AA%E8%AF%9D%E9%A2%98%EF%BC%8C%E4%BD%86%E6%98%AF%E5%8F%88%E6%9C%89%E5%A4%9A%E5%B0%91%E4%BA%BA%E8%83%BD%E5%81%9A%E5%A5%BD%EF%BC%9F%E5%8F%88%E6%9C%89%E5%A4%9A%E5%B0%91%E4%BA%BA%E8%83%BD%E8%AE%A4%E8%AF%86%E5%88%B0%E5%AE%83%E5%88%B0%E5%BA%95%E6%9C%89%E5%A4%9A%E9%9A%BE%E3%80%82%E6%9C%89%E5%8F%A5%E4%BF%97%E8%AF%AD%E5%8F%AB%EF%BC%8C%E4%BA%BA%E7%9A%84%E5%BF%83%EF%BC%8C%E6%B5%B7%E5%BA%95%E9%92%88%E3%80%82%E6%A0%B9%E6%9C%AC%E5%B0%B1%E7%90%A2%E7%A3%A8%E4%B8%8D%E9%80%8F%E3%80%82%E6%9C%89%E6%97%B6%E5%80%99%E4%BD%A0%E8%AE%A4%E4%B8%BA%E7%90%86%E8%A7%A3%E4%BA%86%EF%BC%8C%E5%8F%AF%E6%98%AF%E5%8F%AF%E8%83%BD%E5%AF%B9%E6%96%B9%E6%A0%B9%E6%9C%AC%E5%B0%B1%E4%B8%8D%E6%98%AF%E8%BF%99%E4%B8%AA%E6%84%8F%E6%80%9D%E3%80%82%E6%9C%89%E7%A7%8D%E8%AF%B4%E6%B3%95%EF%BC%8C%E5%BD%93%E4%B8%A4%E4%B8%AA%E4%BA%BA%E5%9C%A8%E8%AF%B4%E8%AF%9D%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%85%B6%E5%AE%9E%E6%9C%896%E4%B8%AA%E4%BA%BA%E5%9C%A8%E5%8F%82%E4%B8%8E%3A%E5%AE%9E%E9%99%85%E7%9A%84%E4%BD%A0%EF%BC%8C%E4%BD%A0%E8%A1%A8%E8%BE%BE%E5%87%BA%E6%9D%A5%E7%9A%84%E4%BD%A0%EF%BC%8C%E5%AF%B9%E6%96%B9%E7%90%86%E8%A7%A3%E7%9A%84%E4%BD%A0%EF%BC%8C%E5%AE%9E%E9%99%85%E7%9A%84%E5%AF%B9%E6%96%B9%EF%BC%8C%E5%AF%B9%E6%96%B9%E8%A1%A8%E8%BE%BE%E5%87%BA%E6%9D%A5%E7%9A%84%E4%BB%96%EF%BC%8C%E4%BB%A5%E5%8F%8A%E4%BD%A0%E7%90%86%E8%A7%A3%E7%9A%84%E5%AF%B9%E6%96%B9%E3%80%82%E6%89%80%E4%BB%A5%EF%BC%8C%E6%97%B6%E5%88%BB%E6%B3%A8%E6%84%8F%E4%BF%9D%E6%8C%81open%E7%8A%B6%E6%80%81%EF%BC%8C%E4%B8%8D%E8%A6%81%E8%AE%A4%E4%B8%BA%E4%BD%A0%E5%AE%8C%E5%85%A8%E7%90%86%E8%A7%A3%E4%BA%86%E5%AF%B9%E6%96%B9%E7%9A%84%E8%AF%9D%EF%BC%8C%E8%AF%AF%E8%A7%A3%E4%B8%8D%E5%8F%AF%E8%83%BD%E8%A2%AB%E6%B6%88%E9%99%A4%EF%BC%8C%E5%8F%AA%E8%83%BD%E8%A2%AB%E5%87%8F%E5%B0%91%E3%80%82%E5%BD%93%E4%BD%A0%E5%AF%B9%E5%88%AB%E4%BA%BA%E8%AF%B4%E8%AF%9D%E6%97%B6%EF%BC%8C%E4%B9%9F%E4%B8%8D%E8%A6%81%E6%8C%87%E6%9C%9B%E4%BB%96%E8%83%BD%E5%AE%8C%E5%85%A8%E7%90%86%E8%A7%A3%E4%BD%A0%E7%9A%84%E7%94%A8%E6%84%8F%EF%BC%8C%E6%97%B6%E5%88%BB%E4%BF%9D%E6%8C%81%E6%A0%A1%E5%87%86%EF%BC%8C%E6%89%8D%E6%98%AF%E7%90%86%E6%83%B3%E7%9A%84%E6%96%B9%E5%BC%8F%E3%80%82%E5%BD%93%E4%BA%A4%E6%B5%81%E4%B8%80%E6%AE%B5%E9%95%BF%E6%97%B6%E9%97%B4%E7%9A%84%E6%84%9F%E6%82%9F%E6%97%B6%EF%BC%8C%E9%89%B4%E4%BA%8E%E9%98%85%E5%8E%86%E7%9A%84%E4%B8%8D%E5%90%8C%EF%BC%8C%E6%9B%B4%E4%B8%8D%E8%A6%81%E6%8C%87%E6%9C%9B%E4%B8%80%E6%AC%A1%E8%83%BD%E8%AE%B2%E6%B8%85%E6%A5%9A%EF%BC%8C%E4%BF%9D%E6%8C%81%E4%B8%8D%E6%96%AD%E5%9C%B0%E4%BA%A4%E6%B5%81%E4%B8%8E%E5%88%86%E4%BA%AB%E6%89%8D%E6%98%AF%E7%8E%8B%E9%81%93%E3%80%82%0A%E4%B8%8D%E8%BF%87%E8%BF%98%E6%98%AF%E9%82%A3%E5%8F%A5%E8%AF%9D%E8%AF%B4%E8%B5%B7%E6%9D%A5%E5%AE%B9%E6%98%93%EF%BC%8C%E5%81%9A%E8%B5%B7%E6%9D%A5%E9%9A%BE%E3%80%82%E4%BA%BA%E6%80%BB%E6%98%AF%E6%AD%A6%E6%96%AD%E5%9C%B0%EF%BC%8C%E6%80%BB%E6%98%AF%E8%B6%8B%E5%90%91%E4%BA%8E%E7%94%A80%2F1%E6%9D%A5%E5%8C%BA%E5%88%86%E4%B8%96%E7%95%8C%E3%80%82%E8%A6%81%E4%B9%88%E7%90%86%E8%A7%A3%E4%BA%86%EF%BC%8C%E8%A6%81%E4%B9%88%E4%B8%8D%E7%90%86%E8%A7%A3%E3%80%82%E7%90%86%E8%A7%A3%E4%BA%86%E5%B0%B1%E6%83%B3%E5%BD%93%E7%84%B6%E5%9C%B0%E6%8C%89%E7%85%A7%E8%87%AA%E5%B7%B1%E7%9A%84%E6%83%B3%E6%B3%95%E5%8E%BB%E5%81%9A%EF%BC%8C%E4%B8%8D%E7%90%86%E8%A7%A3%E5%B0%B1%E6%9A%B4%E8%B7%B3%E5%A6%82%E9%9B%B7(%E6%88%96%E8%80%85%E7%81%B0%E5%BF%83%E4%B8%A7%E6%B0%94)%EF%BC%8C%E5%BF%83%E9%87%8C%E9%AA%82%E4%B8%80%E5%8F%A5%3A%E5%82%BB%E9%80%BC!%E8%AE%B2%E5%BE%97%E4%BB%80%E4%B9%88%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F%E7%9A%84!%20%0A%E4%B8%8E%E5%90%9B%E5%85%B1%E5%8B%89%2C%E5%88%87%E8%AE%B0%2C%E5%88%87%E8%AE%B0%E3%80%82%0A%0A%E5%86%99%E4%BA%86%E8%BF%99%E4%B9%88%E5%A4%9A%EF%BC%8C%E6%83%B3%E8%AF%B4%E7%9A%84%E5%85%B6%E5%AE%9E%E4%B9%9F%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E5%B7%A5%E4%BD%9C%E5%A4%9A%E5%B9%B4%E7%9A%84%E6%88%91%E4%BB%AC%E9%99%A4%E4%BA%86%E6%8A%80%E8%83%BD%E5%82%8D%E8%BA%AB%EF%BC%8C%E4%BF%AE%E7%82%BC%E8%87%AA%E5%B7%B1%E6%89%8D%E8%83%BD%E6%8F%90%E9%AB%98%E6%A0%B8%E5%BF%83%E7%AB%9E%E4%BA%89%E5%8A%9B%E3%80%82%E9%99%84%E8%A8%80%E4%B8%AD%E9%A9%B3%E6%96%A5%E4%B8%80%E4%B8%8B%E4%B8%89%E7%82%B9%E5%8A%A3%E5%8A%BF%E3%80%82%E4%B9%8B%E6%89%80%E4%BB%A5%E4%B8%8D%E6%94%B6%E5%85%A5%E6%AD%A3%E6%96%87%EF%BC%8C%E4%B9%9F%E6%98%AF%E5%80%9F%E4%BB%A5%E8%A1%A8%E8%BE%BE%EF%BC%8C%E5%8F%AA%E8%A6%81%E6%88%91%E4%BB%AC%E5%81%9A%E5%A5%BD%E8%87%AA%E5%B7%B1%EF%BC%8C%E6%89%80%E6%9C%89%E5%8A%A3%E5%8A%BF%E4%B8%8D%E6%94%BB%E8%87%AA%E7%A0%B4%E3%80%82%E5%AF%A5%E5%AF%A5%E6%95%B0%E8%A8%80%EF%BC%8C%E4%B8%8E%E5%90%9B%E5%85%B1%E5%8B%89%E3%80%82%0A%0A%23%23%20%E9%99%84%3A%0A%E5%85%B3%E4%BA%8E%E4%B8%89%E7%82%B9%E5%8A%A3%E5%8A%BF%0A%E6%97%B6%E9%97%B4%E4%B8%8D%E8%87%AA%E7%94%B1%EF%BC%8C%E4%B8%8D%E5%88%A9%E4%BA%8E%E5%8A%A0%E7%8F%AD%0A%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%A7%AF%E6%9E%81%E4%B8%8A%E8%BF%9B%E6%98%AF%E5%A5%BD%E4%BA%8B%EF%BC%8C%E8%BF%99%E4%B9%9F%E7%BB%99%E6%88%91%E4%BB%AC%E8%BF%99%E4%BA%9B%E8%80%81%E8%85%8A%E8%82%89%E6%97%A0%E5%BD%A2%E7%9A%84%E5%8E%8B%E5%8A%9B%E3%80%82%E8%BF%99%E4%B8%AA%E8%A6%81%E6%89%BF%E8%AE%A4%EF%BC%8C%E6%97%B6%E9%97%B4%E7%A1%AE%E5%AE%9E%E6%98%AF%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E4%BC%98%E5%8A%BF%E3%80%82%E8%80%81%E5%91%98%E5%B7%A5%E5%BD%93%E4%BB%A5%E7%A7%AF%E6%9E%81%E7%9A%84%E5%BF%83%E6%80%81%E5%8E%BB%E9%9D%A2%E5%AF%B9%E3%80%82%E4%B8%8D%E8%A6%81%E6%87%88%E6%80%A0%EF%BC%8C%E5%90%A6%E5%88%99%E8%A2%AB%E8%B5%B6%E8%B6%85%E6%98%AF%E8%BF%9F%E6%97%A9%E7%9A%84%E4%BA%8B%E5%84%BF%E3%80%82%E4%BD%86%E4%B9%9F%E4%B8%8D%E5%BF%85%E6%83%B6%E6%81%90%E3%80%82%E5%9B%A0%E4%B8%BA%E4%BA%A7%E5%87%BA%E7%9A%84%E4%B8%BB%E5%AF%BC%E5%9B%A0%E7%B4%A0%E6%98%AF%E6%95%88%E7%8E%87%EF%BC%8C%E5%B9%B6%E4%B8%8D%E6%98%AF%E7%BB%9D%E5%AF%B9%E6%97%B6%E9%97%B4%E7%9A%84%E6%8A%95%E5%85%A5(%E4%BC%9A%E5%8F%A6%E5%BC%80%E7%AF%87%E6%9D%A5%E6%8E%A2%E8%AE%A8)%E3%80%82%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%AF%8F%E5%A4%A9%E7%9A%84%E9%AB%98%E6%95%88%E6%97%B6%E9%97%B4%EF%BC%8C%E8%BF%9C%E6%AF%94%E5%8A%A0%E5%A4%9A%E5%B0%91%E7%8F%AD%E9%87%8D%E8%A6%81%E3%80%82%0A%0A%E6%8A%80%E6%9C%AF%E8%90%BD%E4%BC%8D%E4%BA%86%EF%BC%8C%E4%B8%8D%E8%83%BD%E6%8E%A5%E5%8F%97%E6%96%B0%E4%BA%8B%E7%89%A9%0A%E6%8A%80%E6%9C%AF%E8%BF%99%E4%BB%B6%E4%BA%8B%E6%9C%AC%E6%9D%A5%E5%B0%B1%E6%98%AF%E5%8A%A8%E6%80%81%E7%9A%84%EF%BC%8C%E5%B0%A4%E5%85%B6%E8%BF%91%E5%87%A0%E5%B9%B4%E6%96%B0%E6%8A%80%E6%9C%AF%E5%B1%82%E5%87%BA%E4%B8%8D%E7%A9%B7%E3%80%82%E5%81%9A%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%BE%88%E5%AE%B9%E6%98%93%E8%AE%A9%E4%BA%BA%E6%84%9F%E5%8F%97%E5%88%B0%E9%9A%94%E8%A1%8C%E5%A6%82%E9%9A%94%E5%B1%B1%E3%80%82%E5%81%9A%E5%BA%95%E5%B1%82%E8%BD%AF%E4%BB%B6%E7%9A%84%EF%BC%8C%E5%8F%AF%E8%83%BD%E8%BF%9E%E4%B8%8A%E5%B1%82%E8%BD%AF%E4%BB%B6%E7%94%A8%E5%88%B0%E7%9A%84%E5%90%8D%E8%AF%8D%E4%BD%A0%E9%83%BD%E6%B2%A1%E5%90%AC%E8%BF%87%EF%BC%8C%E5%8D%B3%E4%BE%BF%E4%BD%A0%E4%BB%AC%E7%94%A8%E5%90%8C%E4%B8%80%E7%A7%8D%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91%E3%80%82%E4%BD%86%E6%98%AF%E4%BD%A0%E6%9C%89%E6%B2%A1%E6%9C%89%E6%83%B3%E8%BF%87%EF%BC%8C%E5%B0%B1%E4%BB%A5%E7%BC%96%E7%A8%8B%E6%9D%A5%E8%AE%B2%EF%BC%8C%E8%99%BD%E7%84%B6%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E5%8D%83%E5%8D%83%E4%B8%87%E4%B8%87%EF%BC%8C%E5%90%84%E7%A7%8D%E6%A1%86%E6%9E%B6%E6%9B%B4%E6%98%AF%E6%95%B0%E4%B8%8D%E8%83%9C%E6%95%B0%EF%BC%8C%E4%BD%86%E4%BB%96%E4%BB%AC%E7%9A%84%E5%9F%BA%E7%A1%80%E5%8F%98%E8%BF%87%E5%90%97%EF%BC%9F%E5%93%AA%E7%A7%8D%E8%AF%AD%E8%A8%80%E6%88%96%E6%A1%86%E6%9E%B6%E8%A6%81%E5%81%9A%E7%9A%84%E4%B8%8D%E6%98%AF%E5%AF%B9%E7%8E%B0%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E6%8A%BD%E8%B1%A1%EF%BC%9F%E5%93%AA%E7%A7%8D%E6%8A%80%E6%9C%AF%E4%B8%8D%E7%94%A8%E8%B0%83%E8%AF%95%E8%A7%A3%E5%86%B3bug%EF%BC%9F%E5%93%AA%E7%A7%8D%E6%8A%80%E6%9C%AF%E4%BA%A7%E7%94%9F%E4%B8%8D%E6%98%AF%E4%B8%BA%E4%BA%86%E8%A7%A3%E5%86%B3%E7%8E%B0%E5%AE%9E%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F%E6%89%80%E4%BB%A5%E6%8A%80%E6%9C%AF%E8%A1%A8%E9%9D%A2%E7%9A%84%E8%90%BD%E4%BC%8D%E5%B9%B6%E4%B8%8D%E5%8F%AF%E6%80%95%EF%BC%8C%E4%BF%9D%E6%8C%81%E5%AF%B9%E6%8A%80%E6%9C%AF%E7%BB%88%E6%9E%81%E5%A5%A5%E4%B9%89%E7%9A%84%E6%8E%A2%E7%A9%B6%E6%89%8D%E6%98%AF%E5%AE%9D%E8%B4%B5%E7%9A%84%E3%80%82%0A%0A%0A%E6%BD%9C%E5%8A%9B%E4%B8%8D%E8%B6%B3%EF%BC%8C%E8%A8%80%E4%B8%8B%E4%B9%8B%E6%84%8F%EF%BC%8C%E4%B8%8D%E5%86%8D%E6%84%BF%E6%84%8F%E5%AD%A6%E4%B9%A0%E6%9D%A5%E6%8F%90%E5%8D%87%E8%87%AA%E5%B7%B1%0A%E4%BA%BA%E6%9C%AC%E8%83%BD%E6%98%AF%E8%B6%8B%E5%88%A9%E9%81%BF%E5%AE%B3%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E5%BF%83%E7%90%86%E4%B8%8A%E4%BC%9A%E6%9C%AC%E8%83%BD%E5%9C%B0%E5%AE%89%E4%BA%8E%E8%88%92%E9%80%82%E5%8C%BA%E3%80%82%E5%B9%B4%E9%95%BF%E8%80%85%E6%98%93%E4%BF%9D%E5%AE%88%EF%BC%8C%E5%9B%A0%E4%B8%BA%E4%BB%96%E4%BB%AC%E7%9A%84%E9%98%85%E5%8E%86%E6%9B%B4%E5%A4%9A%EF%BC%8C%E5%BF%83%E7%90%86%E8%88%92%E9%80%82%E5%8C%BA%E6%9B%B4%E5%A4%A7%3B%20%E5%B9%B4%E8%BD%BB%E8%80%85%E7%BB%8F%E9%AA%8C%E5%B0%91%EF%BC%8C%E8%88%92%E9%80%82%E5%8C%BA%E6%9B%B4%E5%B0%8F%EF%BC%8C%E8%A1%A8%E7%8E%B0%E5%87%BA%E6%98%93%E4%BA%8E%E6%8E%A5%E5%8F%97%E6%96%B0%E9%B2%9C%E4%BA%8B%E7%89%A9%E3%80%82%E4%BD%86%E8%BF%99%E5%B9%B6%E4%B8%8D%E6%98%AF%E7%BB%9D%E5%AF%B9%E7%9A%84%E3%80%82%E6%8E%A8%E5%8A%A8%E4%BA%BA%E6%8C%81%E7%BB%AD%E5%9C%B0%E8%B5%B0%E5%87%BA%E5%BF%83%E7%90%86%E8%88%92%E9%80%82%E5%8C%BA%E7%9A%84%EF%BC%8C%E4%B8%80%E5%AE%9A%E6%98%AF%E6%BA%90%E4%BA%8E%E5%86%85%E5%BF%83%E7%9A%84%EF%BC%8C%E5%AF%B9%E7%BB%88%E6%9E%81%E5%A5%A5%E4%B9%89%E7%9A%84%E6%B8%B4%E6%B1%82%E3%80%82%E8%BF%99%E9%80%9A%E5%B8%B8%E4%B8%8E%E5%B9%B4%E9%BE%84%E6%97%A0%E5%85%B3%E3%80%82%E6%9C%89%E4%BA%9B%E4%BA%BA%E5%B0%91%E5%B9%B4%E6%88%90%E5%90%8D%EF%BC%8C%E6%9C%89%E4%BA%9B%E4%BA%BA%E5%A4%A7%E5%99%A8%E6%99%9A%E6%88%90%E3%80%82%E6%B4%BB%E5%88%B0%E8%80%81%E5%AD%A6%E5%88%B0%E8%80%81%E3%80%82%E5%AD%B0%E4%B8%8D%E8%A7%81%E5%A7%9C%E5%A4%AA%E5%85%AC80%E4%BD%90%E6%96%87%E7%8E%8B%EF%BC%8C%E9%BD%90%E5%90%91%E7%9F%B340%E5%AD%A6%E5%8D%B060%E5%AD%A6%E7%94%BB%EF%BC%8C90%E6%96%B9%E6%88%90%E4%B8%B9%E9%9D%92%E5%A6%99%E7%AC%94%E3%80%82%0A]]></content>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (15) - RNN & LSTM]]></title>
    <url>%2F2018%2F10%2F02%2FDeep_Learning_(15)_-_RNN_%26_LSTM%2F</url>
    <content type="text"><![CDATA[Edit &#x8FD9;&#x662F;&#x5434;&#x6069;&#x8FBE;&#x4E94;&#x95E8;Deep Learning&#x8BFE;&#x7A0B;&#x7684;&#x6700;&#x540E;&#x4E00;&#x95E8;&#x3002;&#x5F00;&#x7BC7;&#x7B2C;&#x4E00;&#x5468;&#x7684;&#x8BFE;&#x7A0B;&#x5C31;&#x662F;&#x8457;&#x540D;&#x7684;RNN&#x548C;LSTM&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5178;&#x578B;&#x7684;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x95EE;&#x9898;&#x5982;&#x4E0B;&#xFF1A;&#x6328;&#x4E2A;&#x7FFB;&#x8BD1;&#x4E00;&#x4E0B;&#xFF1A;&#x8BED;&#x97F3;&#x8BC6;&#x522B;&#x97F3;&#x4E50;&#x53D1;&#x751F;&#x5668;&#x8BC4;&#x8BBA;&#x8BC6;&#x522B;DNA&#x5E8F;&#x5217;&#x8BC6;&#x522B;&#x673A;&#x5668;&#x7FFB;&#x8BD1;&#x89C6;&#x9891;&#x52A8;&#x4F5C;&#x8BC6;&#x522B;&#x540D;&#x5B57;&#x8BC6;&#x522B;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5171;&#x540C;&#x70B9;&#xFF0C;&#x8F93;&#x5165;&#x6216;&#x8F93;&#x51FA;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x5E8F;&#x5217;&#x3002;&#x4F8B;&#x5982;&#x8BED;&#x97F3;&#x8BC6;&#x522B;&#xFF0C;&#x8F93;&#x5165;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x8FDE;&#x7EED;&#x7684;&#x97F3;&#x9891;&#x5728;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x5E8F;&#x5217;&#xFF0C;&#x89C6;&#x9891;&#x52A8;&#x4F5C;&#x8BC6;&#x522B;&#x4E5F;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#x3002;&#x97F3;&#x4E50;&#x53D1;&#x751F;&#x5668;&#x6CA1;&#x6709;&#x8F93;&#x5165;&#xFF0C;&#x8F93;&#x51FA;&#x662F;&#x4E00;&#x6BB5;&#x97F3;&#x9891;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x58F0;&#x97F3;&#x5728;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x5E8F;&#x5217;&#x3002;&#x5176;&#x4ED6;&#x51E0;&#x4E2A;&#x8F93;&#x5165;&#x662F;&#x4E00;&#x6BB5;&#x5305;&#x542B;&#x8BED;&#x4E49;&#x7684;&#x6587;&#x5B57;&#xFF0C;&#x8F93;&#x51FA;&#x662F;&#x8BC6;&#x522B;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x901A;&#x5E38;&#x5305;&#x542B;&#x8BED;&#x4E49;&#x7684;&#x6587;&#x5B57;&#x4E5F;&#x662F;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x5E8F;&#x5217;&#xFF0C;&#x6587;&#x5B57;&#x53EA;&#x6709;&#x5F62;&#x6210;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x5E8F;&#x5217;&#x624D;&#x4F1A;&#x6709;&#x542B;&#x4E49;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x901A;&#x5E38;&#x5305;&#x542B;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x8FDE;&#x7EED;&#x6570;&#x636E;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x7ECF;&#x5178;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x3002;&#x90A3;&#x5C31;&#x8981;&#x6C42;&#x8F93;&#x5165;&#x5305;&#x542B;&#x6240;&#x6709;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x5207;&#x7247;&#x4EE5;&#x53CA;&#x4E0D;&#x540C;&#x7684;&#x6B65;&#x957F;&#x3002; &#x7ECF;&#x5178;&#x6A21;&#x578B;&#x8F93;&#x51FA;&#x901A;&#x5E38;&#x662F;&#x540C;&#x7B49;&#x7EF4;&#x5EA6;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x800C;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x95EE;&#x9898;&#xFF0C;&#x8F93;&#x51FA;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x4F8B;&#x5982;&#x8BED;&#x97F3;&#x8BC6;&#x522B;&#xFF0C;&#x540C;&#x6837;&#x957F;&#x5EA6;&#x7684;&#x97F3;&#x9891;&#xFF0C;&#x8BC6;&#x522B;&#x8F93;&#x51FA;&#x6587;&#x672C;&#x53EF;&#x80FD;&#x6709;&#x957F;&#x6709;&#x77ED;&#x3002;&#x5982;&#x679C;&#x91C7;&#x7528;&#x7ECF;&#x5178;&#x6A21;&#x578B;&#xFF0C;&#x5219;&#x8981;&#x6C42;&#x8F93;&#x51FA;&#x8865;&#x507F;&#x6210;&#x76F8;&#x7B49;&#x957F;&#x5EA6;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4F30;&#x8BA1;&#x4E00;&#x4E2A;&#x6700;&#x5927;&#x957F;&#x5EA6;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x4E0D;&#x8DB3;&#x7684;&#x957F;&#x5EA6;&#x4EE5;0&#x8865;&#x8DB3;&#x3002; &#x56E0;&#x4E3A;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x95EE;&#x9898;&#xFF0C;&#x65F6;&#x95F4;&#x4E0A;&#x8F83;&#x540E;&#x7684;&#x8F93;&#x5165;&#x53D7;&#x5230;&#x8F83;&#x524D;&#x7684;&#x8F93;&#x5165;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x800C;&#x7ECF;&#x5178;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x6CA1;&#x6709;&#x8FD9;&#x90E8;&#x5206;&#x4FE1;&#x606F;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x901A;&#x8FC7;&#x7EDF;&#x8BA1;&#x5B66;&#x89D2;&#x5EA6;&#xFF0C;&#x4ECD;&#x7136;&#x80FD;&#x591F;&#x8FBE;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x9884;&#x6D4B;&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x8BA1;&#x7B97;&#x91CF;&#x53EF;&#x60F3;&#x800C;&#x77E5;&#xFF0C;&#x5B9E;&#x9645;&#x4E5F;&#x662F;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x4EF7;&#x503C;&#x3002;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x5F15;&#x5165;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x7B97;&#x6CD5;&#x7684;&#x5FC5;&#x8981;&#x6027;&#x3002;RNN&#x548C;LSTM&#x5C31;&#x662F;&#x4E24;&#x4E2A;&#x5584;&#x4E8E;&#x89E3;&#x51B3;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x95EE;&#x9898;&#x7684;&#x8F83;&#x4E3A;&#x5E38;&#x7528;&#x7684;&#x7B97;&#x6CD5;&#x3002;RNN&#x6CE8;&#xFF1A;&#x672C;&#x7AE0;&#x6240;&#x6709;&#x7684;&#x4F8B;&#x5B50;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x89E3;&#x51B3;NLP(Native Language Processing&#x81EA;&#x7136;&#x8BED;&#x8A00;&#x5904;&#x7406;)&#x95EE;&#x9898;&#x8FDB;&#x884C;&#x9610;&#x8FF0;&#x7684;&#x3002;&#x57FA;&#x672C;&#x6A21;&#x578B;&#x95EE;&#x9898;&#xFF1A; &#x68C0;&#x6D4B;&#x51FA;&#x6587;&#x5B57;&#x4E2D;&#x7684;&#x540D;&#x5B57;&#x5B57;&#x7B26;&#x4E32; &#x8F93;&#x5165;&#xFF1A; Harry Potter and Hermione Granger invented a new spell. &#x9996;&#x5148;&#x6709;&#x4E00;&#x4E2A;&#x5B57;&#x5178;&#x5411;&#x91CF;&#xFF0C;&#x901A;&#x5E38;&#x8FD9;&#x4E2A;&#x5B57;&#x5178;&#x5305;&#x542B;10-15&#x4E07;&#x4E2A;&#x5355;&#x8BCD;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;&#x5355;&#x8BCD;&#x662F;&#xFF0C;&#x4F8B;&#x5982;Harry&#x662F;&#xFF0C;Potter&#x662F;&#x7B49;&#x7B49;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;x&#x662F;&#x4E00;&#x4E2A;one-hot&#x5411;&#x91CF;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E0E;&#x5B57;&#x5178;&#x5411;&#x91CF;&#x540C;&#x7EF4;&#x5EA6;&#x7684;&#x5217;&#x5411;&#x91CF;&#xFF0C;&#x4E14;&#x5BF9;&#x5E94;&#x5355;&#x8BCD;&#x4F4D;&#x7F6E;&#x53D6;1&#xFF0C;&#x5176;&#x4ED6;&#x4F4D;&#x7F6E;&#x53D6;0&#x3002; &#x8F93;&#x51FA;&#x662F;&#xFF1A; &#x4E5F;&#x5C31;&#x662F;&#x662F;&#x540D;&#x5B57;&#x7684;&#x5355;&#x8BCD;&#x8F93;&#x51FA;&#x4E3A;1&#xFF0C;&#x5426;&#x5219;&#x4E3A;0&#x3002;Forward Propagation &#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x516C;&#x5F0F;&#x7684;&#x5B8C;&#x6574;&#x6027;&#xFF0C;&#x901A;&#x5E38;&#x7528;&#x96F6;&#x5411;&#x91CF;&#x6765;&#x505A;&#x521D;&#x59CB;&#x503C;&#x3002; &#x901A;&#x5E38;&#x4EE4;&#xFF0C;&#x5219;&#x4E0A;&#x5F0F;&#x8F6C;&#x5316;&#x4E3A; &#x901A;&#x5E38;&#x5199;&#x4F5C;&#xFF0C;&#x4E0A;&#x5F0F;&#x53EF;&#x7B80;&#x5199;&#x4E3A; &#x662F;&#x8F93;&#x5165;&#x72B6;&#x6001;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x662F;&#x8F93;&#x51FA;&#x72B6;&#x6001;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x3002;&#x4E5F;&#x6709;&#x4E0D;&#x7B49;&#x7684;&#x4F8B;&#x5B50;&#x3002;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684;RNNMany-to-one (Sentiment classification) One-to-many (Music generation) Many-to-many ( Name entity recognition)&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x521A;&#x624D;&#x7528;&#x7684;&#x4F8B;&#x5B50;Many-to-many ( Machine translation)Backward Propagation&#x8FD9;&#x91CC;&#x7684;&#x53CD;&#x5411;&#x4F20;&#x64AD;&#x53C8;&#x79F0;&#x4E3A;Backward Propagation through time&#x3002; &#x4E0A;&#x56FE;&#x4E2D;&#x84DD;&#x8272;&#x7684;&#x7BAD;&#x5934;&#x662F;&#x6B63;&#x5411;&#x4F20;&#x64AD;&#xFF0C;&#x7EA2;&#x8272;&#x7684;&#x7BAD;&#x5934;&#x662F;&#x53CD;&#x5411;&#x4F20;&#x64AD; RNN&#x5E94;&#x7528;&#x4E3E;&#x4F8B;: Language Modelling &amp; Sequence SamplingAndrew&#x82B1;&#x4E86;&#x4E24;&#x4E2A;&#x89C6;&#x9891;&#x4ECB;&#x7ECD;&#x4E86;Language Modelling&#x548C;Sequence Sampling&#x3002;&#x540E;&#x8005;&#x57FA;&#x4E8E;&#x524D;&#x8005;&#x6765;&#x751F;&#x6210;&#x8BED;&#x53E5;&#x3002;&#x4E24;&#x8005;&#x5747;&#x57FA;&#x4E8E;&#x7531;RNN&#x8BAD;&#x7EC3;&#x51FA;&#x6765;&#x7684;&#x6A21;&#x578B;&#x3002;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;RNN&#x7F51;&#x7EDC;&#x5982;&#x4E0B;&#xFF0C;&#x5728;&#x5E94;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8F93;&#x5165;&#x5927;&#x91CF;&#x7684;&#x6587;&#x672C;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;Language Modelling&#x5F53;&#x8BAD;&#x7EC3;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x8FDB;&#x884C;modelling&#x3002; &#x4E0E;&#x8BAD;&#x7EC3;&#x65F6;&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x6837;&#x672C;&#x8F93;&#x5165;&#xFF0C;&#x5373;&#xFF1A; &#x7ECF;&#x7F51;&#x7EDC;&#x8F93;&#x51FA;&#x7684;&#x662F;&#x4E00;&#x4E2A;softmax&#x5206;&#x7C7B;&#x5668;&#x7684;&#x6982;&#x7387;&#x5411;&#x91CF;&#xFF0C;&#x5176;&#x957F;&#x5EA6;&#x7B49;&#x4E8E;&#x5B57;&#x5178;&#x5411;&#x91CF;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x6BCF;&#x4E2A;&#x5206;&#x91CF;&#x4EE3;&#x8868;&#x90A3;&#x4E2A;&#x5355;&#x8BCD;&#x5728;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x51FA;&#x73B0;&#x7684;&#x6982;&#x7387;&#x3002;&#x540C;&#x65F6;&#x80FD;&#x8BA1;&#x7B97;&#x51FA;&#x5355;&#x4E2A;softmax&#x7684;&#x4EA4;&#x53C9;&#x71B5;&#x635F;&#x5931;&#x51FD;&#x6570;&#xFF1A; &#x6574;&#x4E2A;&#x7F51;&#x7EDC;&#x8F93;&#x51FA;&#x8FD9;&#x4E00;&#x4E32;&#x6587;&#x5B57;()&#x7684;&#x6982;&#x7387;&#x5C31;&#x662F;&#xFF1A; Sequence Sampling&#x5F53;&#x5F97;&#x5230;&#x6BCF;&#x4E2A;&#x65F6;&#x523B;t&#x7684;softmax&#x8F93;&#x51FA;&#x65F6;&#xFF0C;&#x8FD0;&#x7528;np.random.choice&#x5373;&#x53EF;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x6B64;&#x65F6;&#x523B;&#x7684;&#x5355;&#x8BCD;&#x3002;&#x5F53;&#x4EA7;&#x751F;&#x53E5;&#x5B50;&#x7EC8;&#x6B62;&#x7B26;&lt;EOS&gt;&#x7684;&#x6216;&#x8005;&#x4EA7;&#x751F;&#x8DB3;&#x591F;&#x6570;&#x91CF;&#x7684;&#x5355;&#x8BCD;&#x7684;&#x65F6;&#x5019;&#xFF0C;sampling&#x7EC8;&#x6B62;&#x3002; &#x5982;&#x679C;training set&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5404;&#x79CD;News&#xFF0C;&#x5219;&#x4EA7;&#x751F;&#x7684;sequence&#x8BFB;&#x8D77;&#x6765;&#x5C31;&#x548C;&#x65B0;&#x95FB;&#x4E00;&#x6837;&#x3002;&#x5982;&#x679C;training set&#x4F7F;&#x7528;&#x7684;&#x662F;&#x838E;&#x7FC1;&#x7684;&#x4F5C;&#x54C1;&#xFF0C;&#x4EA7;&#x751F;&#x7684;sequence&#x5C31;&#x4F1A;&#x50CF;&#x51FA;&#x81EA;&#x838E;&#x7FC1;&#x7684;&#x620F;&#x5267;&#x3002;Character-level language model&#x8FD9;&#x79CD;model&#x7684;&#x5B57;&#x5178;&#x5411;&#x91CF;&#x4ECE;&#x6240;&#x6709;&#x7684;&#x8BCD;&#xFF0C;&#x53D8;&#x6210;&#x5B57;&#x6BCD;+&#x6807;&#x70B9;&#x7B26;&#x53F7;&#x3002;&#x5B57;&#x5178;&#x5411;&#x91CF;&#x7EF4;&#x5EA6;&#x5927;&#x5927;&#x964D;&#x4F4E;&#x3002;RNN&#x6A21;&#x578B;&#x5C06;&#x7528;&#x6765;&#x9884;&#x4F30;&#x6BCF;&#x4E00;&#x4E2A;&#x5B57;&#x6BCD;&#x540E;&#x9762;&#x51FA;&#x73B0;&#x5B57;&#x6BCD;&#x7684;&#x6982;&#x7387;&#x3002; pros&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&lt;UKN&gt;(&#x672A;&#x77E5;&#x5355;&#x8BCD;)&#xFF0C;&#x56E0;&#x4E3A;&#x5168;&#x662F;&#x5B57;&#x6BCD;&#x548C;&#x6807;&#x70B9;&#x7B26;&#x53F7;&#x3002; consRNN&#x7684;&#x5E8F;&#x5217;&#x5F88;&#x957F;&#xFF0C;&#x6240;&#x4EE5;&#x8BA1;&#x7B97;&#x91CF;&#x8F83;&#x5927;&#x3002;&#x53E5;&#x5B50;&#x901A;&#x5E38;&#x9700;&#x8981;&#x5355;&#x8BCD;&#x95F4;&#x8BED;&#x4E49;&#x7684;&#x5173;&#x8054;&#xFF0C;&#x5982;&#x679C;&#x4EE5;&#x5B57;&#x6BCD;&#x4E3A;&#x9884;&#x6D4B;&#x5355;&#x4F4D;&#xFF0C;&#x5219;&#x635F;&#x5931;&#x4E86;&#x8FD9;&#x4E00;&#x6709;&#x7528;&#x7684;&#x4FE1;&#x606F;Vanishing Gradient&#x5F53;&#x5E8F;&#x5217;&#x95EE;&#x9898;&#x7684;&#x5E8F;&#x5217;&#x8DB3;&#x591F;&#x957F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E5F;&#x5C31;&#x662F;RNN&#x7F51;&#x7EDC;&#x7684;&#x5C42;&#x6570;&#x5F88;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x540C;&#x6807;&#x51C6;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E00;&#x6837;&#xFF0C;&#x4F1A;&#x9047;&#x5230;&#x68AF;&#x5EA6;&#x7206;&#x70B8;(exploding gradient)&#x548C;&#x68AF;&#x5EA6;&#x6D88;&#x5931;(vanishing gradient)&#x7684;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x5E8F;&#x5217;&#x95EE;&#x9898;&#xFF0C;&#x53C8;&#x6070;&#x6070;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x8FD9;&#x4E00;&#x95EE;&#x9898;&#x3002;&#x4F8B;&#x5982;&#x8FD9;&#x53E5;&#x8BDD;The cat, which already ate &#x2026;, was full.&#x3002;&#x4E3B;&#x53E5;&#x8C13;&#x8BED;was&#x9700;&#x8981;&#x6309;&#x7167;&#x4E3B;&#x8BED;&#x662F;&#x5426;&#x590D;&#x6570;&#x6765;&#x5B9A;&#x3002;&#x5982;&#x679C;&#x4E2D;&#x95F4;&#x7684;&#x4ECE;&#x53E5;&#x53EF;&#x80FD;&#x5F88;&#x957F;&#xFF0C;&#x4E14;&#x53D1;&#x751F;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x95EE;&#x9898;&#xFF0C;&#x5219;&#x540E;&#x7EED;&#x7684;&#x8F93;&#x51FA;&#x4E0D;&#x592A;&#x4F1A;&#x53D7;&#x5230;&#x5E8F;&#x5217;&#x524D;&#x671F;&#x8F93;&#x5165;&#x7684;&#x5F71;&#x54CD;&#x3002;GRU&#x548C;LSTM&#x7684;&#x63D0;&#x51FA;&#xFF0C;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x7684;&#x95EE;&#x9898;&#x3002;&#x68AF;&#x5EA6;&#x7206;&#x70B8;&#x901A;&#x5E38;&#x6BD4;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x5BB9;&#x6613;&#x89E3;&#x51B3;&#xFF0C;&#x53EA;&#x8981;&#x4E3A;&#x68AF;&#x5EA6;&#x503C;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x4E0A;&#x9650;&#x5373;&#x53EF;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x68AF;&#x5EA6;&#x503C;&#x53D8;&#x6210;NaN&#x3002;&#x4F46;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x901A;&#x5E38;&#x4E0D;&#x592A;&#x597D;&#x89E3;&#x51B3;&#x3002;GRU &#x662F;memory cell&#xFF0C;&#x5728;GRU&#x4E2D;&#x8BB0;&#x5F55;&#x6FC0;&#x6D3B;&#x503C;&#xFF0C;&#x5373;&#x662F;t&#x65F6;&#x523B;c&#x7684;&#x66F4;&#x65B0;&#x5907;&#x9009;&#x662F;&#x66F4;&#x65B0;&#x95E8;&#xFF0C;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x7528;&#x66F4;&#x65B0;&#x662F;&#x76F8;&#x5173;&#x95E8;&#xFF0C;&#x4EE3;&#x8868;&#x548C;&#x7684;&#x76F8;&#x5173;&#x6027;&#x6240;&#x6709;&#x7684;W&#xFF0C;b&#x90FD;&#x662F;learnable parameter&#x4EE3;&#x8868;element-wise&#x76F8;&#x4E58;&#x56FE;&#x4E2D;&#x662F;simplified&#x7248;&#x672C;&#x7684;GRU&#xFF0C;&#x6CA1;&#x6709;&#x53C2;&#x6570;LSTM &#xFF1A;&#x66F4;&#x65B0;&#x95E8;&#xFF1A;&#x9057;&#x5FD8;&#x95E8;&#xFF1A; &#x8F93;&#x51FA;&#x95E8;LSTM&#x901A;&#x5E38;&#x6709;&#x5F88;&#x591A;&#x53D8;&#x79CD;&#xFF0C;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x8457;&#x540D;&#x7684;&#x53D8;&#x79CD;&#x5C31;&#x662F;&#x5728;&#x8BA1;&#x7B97;3&#x4E2A;&#x65F6;&#xFF0C;&#x52A0;&#x5165;&#x4E86;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x8FD9;&#x79F0;&#x4E3A;peephole connection(&#x7AA5;&#x89C6;&#x5B54;&#x8FDE;&#x63A5;)&#x5728;&#x6DF1;&#x5EA6;&#x5B66;&#x4E60;&#x7684;&#x53D1;&#x5C55;&#x4E2D;&#xFF0C;LSTM&#x5F88;&#x65E9;&#x5C31;&#x88AB;&#x63D0;&#x51FA;&#xFF0C;GRU&#x53CD;&#x800C;&#x76F8;&#x5BF9;&#x8F83;&#x665A;&#x3002;GRU&#x7684;&#x7279;&#x70B9;&#x662F;&#x8FD0;&#x7528;&#x95E8;&#x6570;&#x8F83;&#x5C11;(2&#x4E2A;)&#xFF0C;&#x8BA1;&#x7B97;&#x8F83;&#x5FEB;&#xFF0C;&#x9002;&#x5408;&#x642D;&#x5EFA;&#x66F4;&#x5927;&#x578B;&#x7684;&#x5E8F;&#x5217;&#x6A21;&#x578B;&#x3002;LSTM&#x6709;3&#x4E2A;&#x95E8;&#x63A7;&#x5236;&#xFF0C;&#x7075;&#x6D3B;&#x6027;&#x66F4;&#x5927;&#xFF0C;&#x4F46;&#x901A;&#x5E38;&#x8BA1;&#x7B97;&#x91CF;&#x4E5F;&#x8F83;&#x5927;&#x3002;Bidirectional RNN&#x5148;&#x4E3E;&#x4E2A;name entity recognition&#x7684;&#x4F8B;&#x5B50;&#xFF1A; He said, &#x201C;Teddy bears are on sale!&#x201D; He said, &#x201C;Teddy Roosevelt was a great President!&#x201D; &#x8FD9;&#x4E24;&#x4E2A;&#x53E5;&#x5B50;&#xFF0C;&#x7B2C;&#x4E00;&#x53E5;&#x4E2D;&#x7684;Teddy&#x4E0D;&#x662F;&#x540D;&#x5B57;&#xFF0C;&#x7B2C;&#x4E8C;&#x53E5;&#x4E2D;&#x7684;Teddy&#x662F;&#x540D;&#x5B57;&#x3002; &#x5F53;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x91CC;&#x8F93;&#x5165;&#x5230;Teddy&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x5224;&#x65AD;&#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x5462;&#xFF1F;&#x5982;&#x679C;&#x53EA;&#x901A;&#x8FC7;&#x524D;&#x9762;&#x8F93;&#x5165;&#x7684;&#x90E8;&#x5206;&#x662F;&#x65E0;&#x6CD5;&#x5224;&#x65AD;&#x7684;&#x3002;&#x5FC5;&#x987B;&#x8981;&#x501F;&#x52A9;&#x540E;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x624D;&#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x7684;&#x5224;&#x65AD;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x6709;&#x4E86;&#x53CC;&#x5411;&#x5FAA;&#x73AF;&#x7F51;&#x7EDC;&#x7684;&#x5FC5;&#x8981;&#x4E86;&#x3002; &#x6700;&#x7EC8;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A; &#x4E2D;&#x95F4;&#x7D2B;&#x8272;&#x7684;&#x8DEF;&#x5F84;&#x662F;&#x6807;&#x51C6;&#x7684;RNN&#xFF0C;&#x7EFF;&#x8272;&#x7684;&#x8DEF;&#x5F84;&#x662F;&#x53CD;&#x5411;&#x8DEF;&#x5F84;&#x3002;&#x7D2B;&#x8272;&#x548C;&#x7EFF;&#x8272;&#x7684;&#x6A21;&#x5757;&#x90FD;&#x53EF;&#x4EE5;&#x91C7;&#x7528;GRU&#x6216;&#x8005;LSTM&#x5355;&#x5143;&#x3002;&#x901A;&#x5E38;&#x5728;NLP&#x7684;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x91C7;&#x7528;LSTM&#x7684;&#x53CC;&#x5411;&#x7F51;&#x7EDC;&#x662F;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x3002;Deep RNN&#x5BF9;&#x4E8E;RNN&#x6765;&#x8BF4;&#x4E00;&#x822C;&#x5F88;&#x5C11;&#x50CF;CNN&#x90A3;&#x6837;&#x5806;&#x53E0;&#x5F88;&#x591A;&#x5C42;&#xFF0C;3&#x5C42;&#x5BF9;RNN&#x6765;&#x8BF4;&#x5C31;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x5E9E;&#x5927;&#x4E86;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x5806;&#x53E0;&#x591A;&#x5C42;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5220;&#x53BB;&#x6C34;&#x5E73;&#x8FDE;&#x63A5;&#x3002; &#x6BCF;&#x4E2A;RNN&#x5355;&#x5143;&#x53EF;&#x4EE5;&#x662F;&#x6807;&#x51C6;RNN&#x5355;&#x5143;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;GRU&#x5355;&#x5143;&#x3001;LSTM&#x5355;&#x5143;&#x751A;&#x81F3;BRNN&#x5355;&#x5143;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x7531;&#x8BBE;&#x7F6E;&#x3002; &#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x5230;&#x662F;&#x6807;&#x51C6;&#x7684;RNN&#x3002;&#x5728;RNN&#x4E4B;&#x4E0A;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6DFB;&#x52A0;&#x6DF1;&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x6765;&#x8F93;&#x51FA;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x4ECE;RNN&#x4E2D;&#x8F93;&#x51FA;&#x3002;&#x53C2;&#x8003;&#x6587;&#x732E;GRU: Cho et al., 2014. On the properties of neural machine translation: Encoder-decoder approachesChung et al., 2014. Empirical Evaluation of Gated Recurrent Neural Networks on Sequence ModelingLSTM: Hochreiter &amp; Schmidhuber 1997. Long short-term memory%23%20Deep%20Learning%20%2815%29%20-%20RNN%20%26%20LSTM%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%u8FD9%u662F%u5434%u6069%u8FBE%u4E94%u95E8Deep%20Learning%u8BFE%u7A0B%u7684%u6700%u540E%u4E00%u95E8%u3002%u5F00%u7BC7%u7B2C%u4E00%u5468%u7684%u8BFE%u7A0B%u5C31%u662F%u8457%u540D%u7684RNN%u548CLSTM%u3002%u8FD9%u4E24%u4E2A%u6A21%u578B%u90FD%u662F%u4E3A%u4E86%u89E3%u51B3%u5E8F%u5217%u6A21%u578B%u7684%u95EE%u9898%u3002%u5178%u578B%u7684%u5E8F%u5217%u6A21%u578B%u95EE%u9898%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%5D%28./1538908031365.png%29%0A%0A%u6328%u4E2A%u7FFB%u8BD1%u4E00%u4E0B%uFF1A%0A-%20%u8BED%u97F3%u8BC6%u522B%0A-%20%u97F3%u4E50%u53D1%u751F%u5668%0A-%20%u8BC4%u8BBA%u8BC6%u522B%0A-%20DNA%u5E8F%u5217%u8BC6%u522B%0A-%20%u673A%u5668%u7FFB%u8BD1%0A-%20%u89C6%u9891%u52A8%u4F5C%u8BC6%u522B%0A-%20%u540D%u5B57%u8BC6%u522B%0A%0A%u8FD9%u4E9B%u95EE%u9898%u90FD%u6709%u4E00%u4E2A%u5171%u540C%u70B9%uFF0C%u8F93%u5165%u6216%u8F93%u51FA%u90FD%u6709%u53EF%u80FD%u662F%u4E00%u4E2A%u65F6%u95F4%u5E8F%u5217%u3002%u4F8B%u5982%u8BED%u97F3%u8BC6%u522B%uFF0C%u8F93%u5165%u5C31%u662F%u4E00%u4E2A%u8FDE%u7EED%u7684%u97F3%u9891%u5728%u65F6%u95F4%u4E0A%u7684%u5E8F%u5217%uFF0C%u89C6%u9891%u52A8%u4F5C%u8BC6%u522B%u4E5F%u662F%u7C7B%u4F3C%u7684%u3002%u97F3%u4E50%u53D1%u751F%u5668%u6CA1%u6709%u8F93%u5165%uFF0C%u8F93%u51FA%u662F%u4E00%u6BB5%u97F3%u9891%uFF0C%u4E5F%u5C31%u662F%u58F0%u97F3%u5728%u65F6%u95F4%u4E0A%u7684%u5E8F%u5217%u3002%u5176%u4ED6%u51E0%u4E2A%u8F93%u5165%u662F%u4E00%u6BB5%u5305%u542B%u8BED%u4E49%u7684%u6587%u5B57%uFF0C%u8F93%u51FA%u662F%u8BC6%u522B%u7684%u7ED3%u679C%u3002%u901A%u5E38%u5305%u542B%u8BED%u4E49%u7684%u6587%u5B57%u4E5F%u662F%u65F6%u95F4%u4E0A%u7684%u5E8F%u5217%uFF0C%u6587%u5B57%u53EA%u6709%u5F62%u6210%u65F6%u95F4%u4E0A%u7684%u5E8F%u5217%u624D%u4F1A%u6709%u542B%u4E49%u3002%0A%0A%23%23%20%u4E3A%u4EC0%u4E48%u8981%u6709%u5E8F%u5217%u6A21%u578B%0A%u5E8F%u5217%u6A21%u578B%u901A%u5E38%u5305%u542B%u65F6%u95F4%u4E0A%u7684%u8FDE%u7EED%u6570%u636E%u3002%u5F53%u7136%uFF0C%u6211%u4EEC%u4ECD%u7136%u53EF%u4EE5%u91C7%u7528%u7ECF%u5178%u7684%u795E%u7ECF%u7F51%u7EDC%u6A21%u578B%u3002%u90A3%u5C31%u8981%u6C42%u8F93%u5165%u5305%u542B%u6240%u6709%u65F6%u95F4%u4E0A%u7684%u5207%u7247%u4EE5%u53CA%u4E0D%u540C%u7684%u6B65%u957F%u3002%0A%u7ECF%u5178%u6A21%u578B%u8F93%u51FA%u901A%u5E38%u662F%u540C%u7B49%u7EF4%u5EA6%u7684%u8F93%u51FA%uFF0C%u800C%u5E8F%u5217%u6A21%u578B%u95EE%u9898%uFF0C%u8F93%u51FA%u6709%u53EF%u80FD%u662F%u4E0D%u540C%u7684%u957F%u5EA6%u3002%u4F8B%u5982%u8BED%u97F3%u8BC6%u522B%uFF0C%u540C%u6837%u957F%u5EA6%u7684%u97F3%u9891%uFF0C%u8BC6%u522B%u8F93%u51FA%u6587%u672C%u53EF%u80FD%u6709%u957F%u6709%u77ED%u3002%u5982%u679C%u91C7%u7528%u7ECF%u5178%u6A21%u578B%uFF0C%u5219%u8981%u6C42%u8F93%u51FA%u8865%u507F%u6210%u76F8%u7B49%u957F%u5EA6%u3002%u4F8B%u5982%uFF0C%u4F30%u8BA1%u4E00%u4E2A%u6700%u5927%u957F%u5EA6%uFF0C%u7136%u540E%u5C06%u4E0D%u8DB3%u7684%u957F%u5EA6%u4EE50%u8865%u8DB3%u3002%0A%u56E0%u4E3A%u5E8F%u5217%u6A21%u578B%u95EE%u9898%uFF0C%u65F6%u95F4%u4E0A%u8F83%u540E%u7684%u8F93%u5165%u53D7%u5230%u8F83%u524D%u7684%u8F93%u5165%u7684%u5F71%u54CD%uFF0C%u800C%u7ECF%u5178%u795E%u7ECF%u7F51%u7EDC%u6CA1%u6709%u8FD9%u90E8%u5206%u4FE1%u606F%uFF0C%u7406%u8BBA%u4E0A%u901A%u8FC7%u7EDF%u8BA1%u5B66%u89D2%u5EA6%uFF0C%u4ECD%u7136%u80FD%u591F%u8FBE%u5230%u6700%u7EC8%u7684%u9884%u6D4B%u7ED3%u679C%uFF0C%u4F46%u8BA1%u7B97%u91CF%u53EF%u60F3%u800C%u77E5%uFF0C%u5B9E%u9645%u4E5F%u662F%u6CA1%u6709%u4F7F%u7528%u4EF7%u503C%u3002%u8FD9%u4E5F%u5C31%u662F%u5F15%u5165%u5E8F%u5217%u6A21%u578B%u7B97%u6CD5%u7684%u5FC5%u8981%u6027%u3002RNN%u548CLSTM%u5C31%u662F%u4E24%u4E2A%u5584%u4E8E%u89E3%u51B3%u5E8F%u5217%u6A21%u578B%u95EE%u9898%u7684%u8F83%u4E3A%u5E38%u7528%u7684%u7B97%u6CD5%u3002%0A%0A%23%23%20RNN%0A**%u6CE8%uFF1A**%u672C%u7AE0%u6240%u6709%u7684%u4F8B%u5B50%u90FD%u662F%u57FA%u4E8E%u89E3%u51B3NLP%28Native%20Language%20Processing%u81EA%u7136%u8BED%u8A00%u5904%u7406%29%u95EE%u9898%u8FDB%u884C%u9610%u8FF0%u7684%u3002%0A%23%23%23%20%u57FA%u672C%u6A21%u578B%0A%u95EE%u9898%uFF1A%0A%u68C0%u6D4B%u51FA%u6587%u5B57%u4E2D%u7684%u540D%u5B57%u5B57%u7B26%u4E32%0A%u8F93%u5165%uFF1A%0AHarry%20Potter%20and%20Hermione%20Granger%20invented%20a%20new%20spell.%0A%u9996%u5148%u6709%u4E00%u4E2A%u5B57%u5178%u5411%u91CF%uFF0C%u901A%u5E38%u8FD9%u4E2A%u5B57%u5178%u5305%u542B10-15%u4E07%u4E2A%u5355%u8BCD%u3002%u6BCF%u4E00%u4E2A%u5355%u8BCD%u662F%24x%5E%7B%3Ci%3E%7D%24%uFF0C%u4F8B%u5982Harry%u662F%24x%5E%7B%3C1%3E%7D%24%uFF0CPotter%u662F%24x%5E%7B%3C2%3E%7D%24%u7B49%u7B49%u3002%u6BCF%u4E00%u4E2Ax%u662F%u4E00%u4E2Aone-hot%u5411%u91CF%u3002%u4E5F%u5C31%u662F%u4E00%u4E2A%u4E0E%u5B57%u5178%u5411%u91CF%u540C%u7EF4%u5EA6%u7684%u5217%u5411%u91CF%uFF0C%u4E14%u5BF9%u5E94%u5355%u8BCD%u4F4D%u7F6E%u53D61%uFF0C%u5176%u4ED6%u4F4D%u7F6E%u53D60%u3002%0A%u8F93%u51FA%u662F%uFF1A%0A%24y%20%3D%20%5B%5Cbegin%7Bmatrix%7D1%20%26%201%20%26%200%20%26%201%20%26%201%20%26%200%20%26%200%20%26%200%20%260%5Cend%7Bmatrix%7D%5D%24%0A%u4E5F%u5C31%u662F%u662F%u540D%u5B57%u7684%u5355%u8BCD%u8F93%u51FA%u4E3A1%uFF0C%u5426%u5219%u4E3A0%u3002%0A%0A%23%23%23%20Forward%20Propagation%0A%21%5BAlt%20text%7C600x0%5D%28./1538919781321.png%29%0A%24a%5E%7B%3C0%3E%7D%20%3D%20%5Coverrightarrow0%24%0A%24a%5E%7B%3C0%3E%7D%24%u662F%u4E3A%u4E86%u4FDD%u8BC1%u516C%u5F0F%u7684%u5B8C%u6574%u6027%uFF0C%u901A%u5E38%u7528%u96F6%u5411%u91CF%u6765%u505A%u521D%u59CB%u503C%u3002%0A%24a%5E%7B%3Ct%3E%7D%20%3D%20g%28W_%7Baa%7Da%5E%7B%3Ct-1%3E%7D%20+%20W_%7Bax%7Dx%5E%7B%3Ct%3E%7D%20+%20b_a%29%24%0A%u901A%u5E38%u4EE4%24W_a%20%3D%20%5Cbegin%7Bbmatrix%7D%20W_%7Baa%7D%20%26%20W%7Bax%7D%5Cend%7Bbmatrix%7D%24%uFF0C%u5219%u4E0A%u5F0F%u8F6C%u5316%u4E3A%0A%24a%5E%7B%3Ct%3E%7D%20%3D%20g%28W_%7Ba%7D%20%5Cbegin%7Bbmatrix%7D%20a%5E%7B%3Ct-1%3E%7D%20%5C%5C%20x%5E%7B%3Ct%3E%7D%20%5Cend%7Bbmatrix%7D+%20b_a%29%24%0A%24%5Chat%20y%5E%7B%3Ct%3E%7D%20%3D%20g%28W_%7Bya%7Da%5E%7B%3Ct%3E%7D%20+b_y%29%24%0A%24W_%7Bya%7D%24%u901A%u5E38%u5199%u4F5C%24W_y%24%uFF0C%u4E0A%u5F0F%u53EF%u7B80%u5199%u4E3A%24%5Chat%20y%5E%7B%3Ct%3E%7D%20%3D%20g%28W_%7By%7Da%5E%7B%3Ct%3E%7D%20+b_y%29%24%0A%24T_x%24%u662F%u8F93%u5165%u72B6%u6001%u7684%u4E2A%u6570%uFF0C%24T_y%24%u662F%u8F93%u51FA%u72B6%u6001%u7684%u4E2A%u6570%uFF0C%u5728%u8FD9%u4E2A%u4F8B%u5B50%u4E2D%24T_y%20%3D%20T_x%24%u3002%u4E5F%u6709%u4E0D%u7B49%u7684%u4F8B%u5B50%u3002%0A%0A%23%23%23%23%20%u5176%u4ED6%u7C7B%u578B%u7684RNN%0AMany-to-one%20%28Sentiment%20classification%29%0A%21%5BAlt%20text%7C300x0%5D%28./1538953445104.png%29%0AOne-to-many%20%28Music%20generation%29%0A%21%5BAlt%20text%7C320x0%5D%28./1538953501761.png%29%0AMany-to-many%20%28%24T_x%20%3D%20T_y%24%20Name%20entity%20recognition%29%u8FD9%u662F%u6211%u4EEC%u521A%u624D%u7528%u7684%u4F8B%u5B50%0A%21%5BAlt%20text%7C300x0%5D%28./1538953612909.png%29%0A%0AMany-to-many%20%28%24T_y%20%5Cneq%20T_x%24%20Machine%20translation%29%0A%21%5BAlt%20text%7C450x0%5D%28./1538953571706.png%29%0A%0A%0A%23%23%23%20Backward%20Propagation%0A%u8FD9%u91CC%u7684%u53CD%u5411%u4F20%u64AD%u53C8%u79F0%u4E3ABackward%20Propagation%20through%20time%u3002%0A%21%5BAlt%20text%7C700x0%5D%28./1538952837860.png%29%0A%u4E0A%u56FE%u4E2D%u84DD%u8272%u7684%u7BAD%u5934%u662F%u6B63%u5411%u4F20%u64AD%uFF0C%u7EA2%u8272%u7684%u7BAD%u5934%u662F%u53CD%u5411%u4F20%u64AD%0A%24%5Cmathcal%20L%5E%7B%3Ct%3E%7D%28%5Chat%20y%5E%7B%3Ct%3E%7D%2C%20y%5E%7B%3Ct%3E%7D%29%20%3D%20-y%5E%7B%3Ct%3E%7Dlog%20%5Chat%20y%5E%7B%3Ct%3E%7D%20-%20%281-y%5E%7B%3Ct%3E%7D%29log%281-%5Chat%20y%5E%7B%3Ct%3E%7D%29%24%0A%24%5Cmathcal%20L%28%5Chat%20y%2C%20y%29%20%3D%20%5CSigma_%7Bt%3D1%7D%5E%7BT_y%7D%20%5Cmathcal%20L%5E%7B%3Ct%3E%7D%20%28%5Chat%20y%5E%7B%3Ct%3E%7D%2C%20y%5E%7B%3Ct%3E%7D%29%24%0A%0A%23%23%23%20RNN%u5E94%u7528%u4E3E%u4F8B%3A%20Language%20Modelling%20%26%20Sequence%20Sampling%0AAndrew%u82B1%u4E86%u4E24%u4E2A%u89C6%u9891%u4ECB%u7ECD%u4E86Language%20Modelling%u548CSequence%20Sampling%u3002%u540E%u8005%u57FA%u4E8E%u524D%u8005%u6765%u751F%u6210%u8BED%u53E5%u3002%u4E24%u8005%u5747%u57FA%u4E8E%u7531RNN%u8BAD%u7EC3%u51FA%u6765%u7684%u6A21%u578B%u3002%u4E00%u4E2A%u57FA%u672C%u7684RNN%u7F51%u7EDC%u5982%u4E0B%uFF0C%u5728%u5E94%u7528%u4E4B%u524D%uFF0C%u6211%u4EEC%u9700%u8981%u8F93%u5165%u5927%u91CF%u7684%u6587%u672C%u8FDB%u884C%u8BAD%u7EC3%0A%21%5BAlt%20text%7C700x0%5D%28./1539138095181.png%29%0A%0A%23%23%23%23%20Language%20Modelling%0A%u5F53%u8BAD%u7EC3%u5B8C%u6BD5%u540E%uFF0C%u6211%u4EEC%u53EF%u4EE5%u7528%u4E0B%u9762%u7684%u7F51%u7EDC%u7ED3%u6784%u8FDB%u884Cmodelling%u3002%0A%21%5BAlt%20text%5D%28./1539137888586.png%29%0A%u4E0E%u8BAD%u7EC3%u65F6%u7684%u7F51%u7EDC%u4E0D%u540C%u7684%u662F%uFF0C%u8FD9%u91CC%u6CA1%u6709%u6837%u672C%u8F93%u5165%uFF0C%u5373%uFF1A%0A%24%24%5Cbegin%7Bcases%7D%20x%5E%7B%3Ct%3E%7D%20%3D%20%5Cvec%200%20%26%20t%3D0%20%5C%5C%20x%5E%7B%3Ct%3E%7D%20%3D%20y%5E%7B%3Ct-1%3E%7D%20%26%20t%20%5Cge%201%5Cend%7Bcases%7D%24%24%0A%u7ECF%u7F51%u7EDC%u8F93%u51FA%u7684%u662F%u4E00%u4E2Asoftmax%u5206%u7C7B%u5668%u7684%u6982%u7387%u5411%u91CF%uFF0C%u5176%u957F%u5EA6%u7B49%u4E8E%u5B57%u5178%u5411%u91CF%u7684%u957F%u5EA6%u3002%u6BCF%u4E2A%u5206%u91CF%u4EE3%u8868%u90A3%u4E2A%u5355%u8BCD%u5728%u8FD9%u4E2A%u4F4D%u7F6E%u51FA%u73B0%u7684%u6982%u7387%u3002%u540C%u65F6%u80FD%u8BA1%u7B97%u51FA%u5355%u4E2Asoftmax%u7684%u4EA4%u53C9%u71B5%u635F%u5931%u51FD%u6570%uFF1A%0A%24%24%5Cmathscr%20L%5E%7B%3Ct%3E%7D%20%28%5Chat%20y%5E%7B%3Ct%3E%7D%2C%20y%5E%7B%3Ct%3E%7D%29%3D%20%5CSigma_i%20y_i%5E%7B%3Ct%3E%7Dlog%5Chat%20y_i%5E%7B%3Ct%3E%7D%24%24%0A%u6574%u4E2A%u7F51%u7EDC%u8F93%u51FA%u8FD9%u4E00%u4E32%u6587%u5B57%28%24%5Chat%20y%5E%7B%3C0%3E%7D%2C%20%5Chat%20y%5E%7B%3C1%3E%7D%2C%20%5Cdots%24%29%u7684%u6982%u7387%u5C31%u662F%uFF1A%0A%24%24%5Cmathscr%20L%20%3D%20%5CSigma_t%20%5Cmathscr%20L%5E%7B%3Ct%3E%7D%28%5Chat%20y%5E%7B%3Ct%3E%7D%2C%20y%5E%7B%3Ct%3E%7D%29%24%24%0A%0A%23%23%23%23%20Sequence%20Sampling%0A%u5F53%u5F97%u5230%u6BCF%u4E2A%u65F6%u523Bt%u7684softmax%u8F93%u51FA%u65F6%uFF0C%u8FD0%u7528np.random.choice%u5373%u53EF%u4EA7%u751F%u4E00%u4E2A%u6B64%u65F6%u523B%u7684%u5355%u8BCD%24y%5E%7B%3Ct%3E%7D%24%u3002%u5F53%u4EA7%u751F%u53E5%u5B50%u7EC8%u6B62%u7B26%60%3CEOS%3E%60%u7684%u6216%u8005%u4EA7%u751F%u8DB3%u591F%u6570%u91CF%u7684%u5355%u8BCD%u7684%u65F6%u5019%uFF0Csampling%u7EC8%u6B62%u3002%0A%u5982%u679Ctraining%20set%u4F7F%u7528%u7684%u662F%u5404%u79CDNews%uFF0C%u5219%u4EA7%u751F%u7684sequence%u8BFB%u8D77%u6765%u5C31%u548C%u65B0%u95FB%u4E00%u6837%u3002%u5982%u679Ctraining%20set%u4F7F%u7528%u7684%u662F%u838E%u7FC1%u7684%u4F5C%u54C1%uFF0C%u4EA7%u751F%u7684sequence%u5C31%u4F1A%u50CF%u51FA%u81EA%u838E%u7FC1%u7684%u620F%u5267%u3002%0A%0A%23%23%23%23%20Character-level%20language%20model%0A%u8FD9%u79CDmodel%u7684%u5B57%u5178%u5411%u91CF%u4ECE%u6240%u6709%u7684%u8BCD%uFF0C%u53D8%u6210%u5B57%u6BCD+%u6807%u70B9%u7B26%u53F7%u3002%u5B57%u5178%u5411%u91CF%u7EF4%u5EA6%u5927%u5927%u964D%u4F4E%u3002RNN%u6A21%u578B%u5C06%u7528%u6765%u9884%u4F30%u6BCF%u4E00%u4E2A%u5B57%u6BCD%u540E%u9762%u51FA%u73B0%u5B57%u6BCD%u7684%u6982%u7387%u3002%0A**pros**%0A-%20%u4E0D%u4F1A%u51FA%u73B0%60%3CUKN%3E%60%28%u672A%u77E5%u5355%u8BCD%29%uFF0C%u56E0%u4E3A%u5168%u662F%u5B57%u6BCD%u548C%u6807%u70B9%u7B26%u53F7%u3002%0A**cons**%0A-%20RNN%u7684%u5E8F%u5217%u5F88%u957F%uFF0C%u6240%u4EE5%u8BA1%u7B97%u91CF%u8F83%u5927%u3002%0A-%20%u53E5%u5B50%u901A%u5E38%u9700%u8981%u5355%u8BCD%u95F4%u8BED%u4E49%u7684%u5173%u8054%uFF0C%u5982%u679C%u4EE5%u5B57%u6BCD%u4E3A%u9884%u6D4B%u5355%u4F4D%uFF0C%u5219%u635F%u5931%u4E86%u8FD9%u4E00%u6709%u7528%u7684%u4FE1%u606F%0A%0A%23%23Vanishing%20Gradient%0A%u5F53%u5E8F%u5217%u95EE%u9898%u7684%u5E8F%u5217%u8DB3%u591F%u957F%u7684%u65F6%u5019%uFF0C%u5B9E%u9645%u4E5F%u5C31%u662FRNN%u7F51%u7EDC%u7684%u5C42%u6570%u5F88%u591A%u7684%u65F6%u5019%uFF0C%u540C%u6807%u51C6%u795E%u7ECF%u7F51%u7EDC%u4E00%u6837%uFF0C%u4F1A%u9047%u5230%u68AF%u5EA6%u7206%u70B8%28exploding%20gradient%29%u548C%u68AF%u5EA6%u6D88%u5931%28vanishing%20gradient%29%u7684%u95EE%u9898%u3002%u4F46%u662F%u5E8F%u5217%u95EE%u9898%uFF0C%u53C8%u6070%u6070%u9700%u8981%u89E3%u51B3%u8FD9%u4E00%u95EE%u9898%u3002%u4F8B%u5982%u8FD9%u53E5%u8BDD%60The%20cat%2C%20which%20already%20ate%20%u2026%2C%20was%20full.%60%u3002%u4E3B%u53E5%u8C13%u8BEDwas%u9700%u8981%u6309%u7167%u4E3B%u8BED%u662F%u5426%u590D%u6570%u6765%u5B9A%u3002%u5982%u679C%u4E2D%u95F4%u7684%u4ECE%u53E5%u53EF%u80FD%u5F88%u957F%uFF0C%u4E14%u53D1%u751F%u68AF%u5EA6%u6D88%u5931%u95EE%u9898%uFF0C%u5219%u540E%u7EED%24%5Chat%20y%5E%7B%3Ct%3E%7D%24%u7684%u8F93%u51FA%u4E0D%u592A%u4F1A%u53D7%u5230%u5E8F%u5217%u524D%u671F%u8F93%u5165%24x%5E%7B%3Ct%3E%7D%24%u7684%u5F71%u54CD%u3002GRU%u548CLSTM%u7684%u63D0%u51FA%uFF0C%u90FD%u662F%u4E3A%u4E86%u89E3%u51B3%u68AF%u5EA6%u6D88%u5931%u7684%u95EE%u9898%u3002%0A%3E%20%u68AF%u5EA6%u7206%u70B8%u901A%u5E38%u6BD4%u68AF%u5EA6%u6D88%u5931%u5BB9%u6613%u89E3%u51B3%uFF0C%u53EA%u8981%u4E3A%u68AF%u5EA6%u503C%u8BBE%u7F6E%u4E00%u4E2A%u4E0A%u9650%u5373%u53EF%uFF0C%u5C31%u4E0D%u4F1A%u5BFC%u81F4%u68AF%u5EA6%u503C%u53D8%u6210NaN%u3002%u4F46%u68AF%u5EA6%u6D88%u5931%u901A%u5E38%u4E0D%u592A%u597D%u89E3%u51B3%u3002%0A%0A%23%23%23%20GRU%0A%21%5BAlt%20text%7C400x0%5D%28./1539162264045.png%29%0A%24%5Ctilde%20c%5E%7B%3Ct%3E%7D%20%3D%20tanh%28W_c%5B%5CGamma_r%20%5Cast%20c%5E%7B%3Ct-1%3E%7D%2C%20x%5E%7B%3Ct%3E%7D%5D%20+%20b_c%29%24%0A%24%5CGamma_u%20%3D%20%5Csigma%20%28W_u%5Bc%5E%7B%3Ct-1%3E%7D%2C%20x%5E%7B%3Ct%3E%7D%5D%20+%20b_u%29%24%0A%24%5CGamma_r%20%3D%20%5Csigma%28W_r%5Bc%5E%7B%3Ct-1%3E%7D%2C%20x%5E%7B%3Ct%3E%7D%5D%20+%20b_r%29%24%0A%24c%5E%7B%3Ct%3E%7D%20%3D%20%5CGamma_u%20%5Cast%20%5Ctilde%20c%5E%7B%3Ct%3E%7D%20+%20%281-%5CGamma_u%29%20%5Cast%20c%5E%7B%3Ct-1%3E%7D%24%0A-%20%24c%5E%7B%3Ct%3E%7D%24%u662Fmemory%20cell%uFF0C%u5728GRU%u4E2D%u8BB0%u5F55%u6FC0%u6D3B%u503C%uFF0C%u5373%24c%5E%7B%3Ct%3E%7D%20%3D%20a%5E%7B%3Ct%3E%7D%24%0A-%20%24%5Ctilde%20c%5E%7B%3Ct%3E%7D%24%u662Ft%u65F6%u523Bc%u7684%u66F4%u65B0%u5907%u9009%0A-%20%24%5CGamma_u%24%u662F%u66F4%u65B0%u95E8%uFF0C%u51B3%u5B9A%u662F%u5426%u7528%24%5Ctilde%20c%5E%7B%3Ct%3E%7D%24%u66F4%u65B0%24c%5E%7B%3Ct%3E%7D%24%0A-%20%24%5CGamma_r%24%u662F%u76F8%u5173%u95E8%uFF0C%u4EE3%u8868%24c%5E%7B%3Ct-1%3E%7D%24%u548C%24%5Ctilde%20c%5E%7B%3Ct%3E%7D%24%u7684%u76F8%u5173%u6027%0A-%20%u6240%u6709%u7684W%uFF0Cb%u90FD%u662Flearnable%20parameter%0A-%20%24%5Cast%24%u4EE3%u8868element-wise%u76F8%u4E58%0A%0A%u56FE%u4E2D%u662Fsimplified%u7248%u672C%u7684GRU%uFF0C%u6CA1%u6709%24%5CGamma_r%24%u53C2%u6570%0A%0A%23%23%23%20LSTM%0A%21%5BAlt%20text%5D%28./1539164098789.png%29%0A%0A%24%5Ctilde%20c%5E%7B%3Ct%3E%7D%20%3D%20tanh%28W_c%5B%5CGamma_r%20%5Cast%20c%5E%7B%3Ct-1%3E%7D%2C%20x%5E%7B%3Ct%3E%7D%5D%20+%20b_c%29%24%0A%24%5CGamma_u%20%3D%20%5Csigma%20%28W_u%5Ba%5E%7B%3Ct-1%3E%7D%2C%20x%5E%7B%3Ct%3E%7D%5D%20+%20b_u%29%24%0A%24%5CGamma_f%20%3D%20%5Csigma%20%28W_f%5Ba%5E%7B%3Ct-1%3E%7D%2C%20x%5E%7B%3Ct%3E%7D%5D%20+%20b_f%29%24%0A%24%5CGamma_o%20%3D%20%5Csigma%20%28W_o%5Ba%5E%7B%3Ct-1%3E%7D%2C%20x%5E%7B%3Ct%3E%7D%5D%20+%20b_o%29%24%0A%24c%5E%7B%3Ct%3E%7D%20%3D%20%5CGamma_u%20%5Cast%20%5Ctilde%20c%5E%7B%3Ct%3E%7D%20+%20%5CGamma_f%20%5Cast%20c%5E%7B%3Ct-1%3E%7D%24%0A%24a%5E%7B%3Ct%3E%7D%20%3D%20%5CGamma_o%20%5Cast%20tanh%28c%5E%7B%3Ct%3E%7D%29%24%0A%0A-%20%24%5CGamma_u%24%uFF1A%u66F4%u65B0%u95E8%0A-%20%24%5CGamma_f%24%uFF1A%u9057%u5FD8%u95E8%0A-%20%24%5CGamma_o%24%uFF1A%20%u8F93%u51FA%u95E8%0A%0A%3ELSTM%u901A%u5E38%u6709%u5F88%u591A%u53D8%u79CD%uFF0C%u4E00%u4E2A%u6BD4%u8F83%u8457%u540D%u7684%u53D8%u79CD%u5C31%u662F%u5728%u8BA1%u7B973%u4E2A%24%5CGamma%24%u65F6%uFF0C%u52A0%u5165%u4E86%24c%5E%7B%3Ct-1%3E%7D%24%u7684%u5F71%u54CD%u3002%u8FD9%u79F0%u4E3Apeephole%20connection%28%u7AA5%u89C6%u5B54%u8FDE%u63A5%29%0A%0A%3E%u5728%u6DF1%u5EA6%u5B66%u4E60%u7684%u53D1%u5C55%u4E2D%uFF0CLSTM%u5F88%u65E9%u5C31%u88AB%u63D0%u51FA%uFF0CGRU%u53CD%u800C%u76F8%u5BF9%u8F83%u665A%u3002GRU%u7684%u7279%u70B9%u662F%u8FD0%u7528%u95E8%u6570%u8F83%u5C11%282%u4E2A%29%uFF0C%u8BA1%u7B97%u8F83%u5FEB%uFF0C%u9002%u5408%u642D%u5EFA%u66F4%u5927%u578B%u7684%u5E8F%u5217%u6A21%u578B%u3002LSTM%u67093%u4E2A%u95E8%u63A7%u5236%uFF0C%u7075%u6D3B%u6027%u66F4%u5927%uFF0C%u4F46%u901A%u5E38%u8BA1%u7B97%u91CF%u4E5F%u8F83%u5927%u3002%0A%0A%23%23%20Bidirectional%20RNN%0A%u5148%u4E3E%u4E2Aname%20entity%20recognition%u7684%u4F8B%u5B50%uFF1A%0AHe%20said%2C%20%u201CTeddy%20bears%20are%20on%20sale%21%u201D%0AHe%20said%2C%20%u201CTeddy%20Roosevelt%20was%20a%20great%20President%21%u201D%0A%u8FD9%u4E24%u4E2A%u53E5%u5B50%uFF0C%u7B2C%u4E00%u53E5%u4E2D%u7684Teddy%u4E0D%u662F%u540D%u5B57%uFF0C%u7B2C%u4E8C%u53E5%u4E2D%u7684Teddy%u662F%u540D%u5B57%u3002%0A%21%5BAlt%20text%7C700x0%5D%28./1539165068192.png%29%0A%u5F53%u8FD9%u4E2A%u7F51%u7EDC%u91CC%u8F93%u5165%u5230Teddy%u4E86%uFF0C%u600E%u4E48%u5224%u65AD%u662F%u4E0D%u662F%u4E00%u4E2A%u540D%u5B57%u7684%u4E00%u90E8%u5206%u5462%uFF1F%u5982%u679C%u53EA%u901A%u8FC7%u524D%u9762%u8F93%u5165%u7684%u90E8%u5206%u662F%u65E0%u6CD5%u5224%u65AD%u7684%u3002%u5FC5%u987B%u8981%u501F%u52A9%u540E%u9762%u7684%u8BED%u53E5%u624D%u53EF%u4EE5%u6B63%u786E%u7684%u5224%u65AD%u3002%u6240%u4EE5%u5C31%u6709%u4E86%u53CC%u5411%u5FAA%u73AF%u7F51%u7EDC%u7684%u5FC5%u8981%u4E86%u3002%0A%u6700%u7EC8%u7F51%u7EDC%u7ED3%u6784%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%7C700x0%5D%28./1539165232978.png%29%0A%u4E2D%u95F4%u7D2B%u8272%u7684%u8DEF%u5F84%u662F%u6807%u51C6%u7684RNN%uFF0C%u7EFF%u8272%u7684%u8DEF%u5F84%u662F%u53CD%u5411%u8DEF%u5F84%u3002%u7D2B%u8272%u548C%u7EFF%u8272%u7684%u6A21%u5757%u90FD%u53EF%u4EE5%u91C7%u7528GRU%u6216%u8005LSTM%u5355%u5143%u3002%u901A%u5E38%u5728NLP%u7684%u5E94%u7528%u4E2D%uFF0C%u91C7%u7528LSTM%u7684%u53CC%u5411%u7F51%u7EDC%u662F%u6BD4%u8F83%u5E38%u89C1%u7684%u3002%0A%0A%23%23%20Deep%20RNN%0A%u5BF9%u4E8ERNN%u6765%u8BF4%u4E00%u822C%u5F88%u5C11%u50CFCNN%u90A3%u6837%u5806%u53E0%u5F88%u591A%u5C42%uFF0C3%u5C42%u5BF9RNN%u6765%u8BF4%u5C31%u5DF2%u7ECF%u975E%u5E38%u5E9E%u5927%u4E86%u3002%u5982%u679C%u9700%u8981%u5806%u53E0%u591A%u5C42%uFF0C%u4E00%u822C%u4F1A%u5220%u53BB%u6C34%u5E73%u8FDE%u63A5%u3002%20%u6BCF%u4E2ARNN%u5355%u5143%u53EF%u4EE5%u662F%u6807%u51C6RNN%u5355%u5143%uFF0C%u4E5F%u53EF%u4EE5%u662FGRU%u5355%u5143%u3001LSTM%u5355%u5143%u751A%u81F3BRNN%u5355%u5143%uFF0C%u53EF%u4EE5%u81EA%u7531%u8BBE%u7F6E%u3002%0A%21%5BAlt%20text%7C500x0%5D%28./1539165553848.png%29%0A%u5982%u4E0A%u56FE%u6240%u793A%uFF0C%24a%5E%7B%5B1%5D%7D%24%u5230%24a%5E%7B%5B3%5D%7D%24%u662F%u6807%u51C6%u7684RNN%u3002%u5728RNN%u4E4B%u4E0A%u53EF%u4EE5%u7EE7%u7EED%u6DFB%u52A0%u6DF1%u5C42%u795E%u7ECF%u7F51%u7EDC%u6765%u8F93%u51FA%24%5Chat%20y%5E%7B%3Ct%3E%7D%24%uFF0C%u800C%u4E0D%u662F%u76F4%u63A5%u4ECERNN%u4E2D%u8F93%u51FA%u3002%0A%0A%23%23%20%u53C2%u8003%u6587%u732E%0AGRU%3A%20%0A-%20Cho%20et%20al.%2C%202014.%20On%20the%20properties%20of%20neural%20machine%20translation%3A%20Encoder-decoder%20approaches%0A-%20Chung%20et%20al.%2C%202014.%20Empirical%20Evaluation%20of%20Gated%20Recurrent%20Neural%20Networks%20on%20Sequence%20Modeling%0A%0ALSTM%3A%20Hochreiter%20%26%20Schmidhuber%201997.%20Long%20short-term%20memory]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (14) - Neural Style Transfer]]></title>
    <url>%2F2018%2F09%2F30%2FDeep_Learning_(14)_-_Neural_Style_Transfer%2F</url>
    <content type="text"><![CDATA[Edit &#x8FD9;&#x662F;&#x5F53;&#x4E0B;&#x5F88;&#x6D41;&#x884C;&#x7684;&#x4E00;&#x4E2A;&#x73A9;&#x6CD5;&#x3002;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A; &#x5C06;&#x539F;&#x672C;&#x7684;&#x98CE;&#x666F;&#x7167;&#x7247;&#x878D;&#x5165;&#x68B5;&#x9AD8;&#x661F;&#x7A7A;&#x753B;&#x4F5C;&#x7684;&#x98CE;&#x683C;&#x3002;&#x8FD8;&#x6709;&#x65F6;&#x4E0B;&#x56FD;&#x5185;&#x5F88;&#x6D41;&#x884C;&#x7684;&#x8138;&#x840C;&#xFF0C;&#x5316;&#x5986;&#x7684;app&#xFF0C;&#x5E94;&#x8BE5;&#x4E5F;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x7B97;&#x6CD5;&#x6B65;&#x9AA4;&#x8981;&#x5408;&#x6210;&#x8FD9;&#x6837;&#x4E00;&#x5F20;&#x6DF7;&#x5408;&#x98CE;&#x683C;&#x7684;&#x56FE;&#x7247;&#x7684;&#x6B65;&#x9AA4;&#x5927;&#x81F4;&#x5982;&#x4E0B;&#xFF1A;Initiate G randomlyUse gradient descent to minimize J(G)&#x5176;&#x4E2D;: , &#x662F;&#x8D85;&#x53C2;&#x6570;C&#x4EE3;&#x8868;Content&#xFF0C;S&#x4EE3;&#x8868;Style&#xFF0C;G&#x4EE3;&#x8868;GeneratedSay you use hidden layer l to compute content cost.Use pre-trained ConvNet. (E.g., VGG network)Let and be the activation of layer l on the imagesIf and are similar, both images have similar content &#x56FE;&#x7247;&#x7684;&#x98CE;&#x683C;&#x5F80;&#x5F80;&#x9690;&#x542B;&#x5728;&#x901A;&#x9053;&#x4E2D;&#x3002;&#x6211;&#x4EEC;&#x5148;&#x770B;&#x770B;&#x4E00;&#x4E2A;&#x6DF1;&#x5C42;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;&#x6BCF;&#x4E00;&#x5C42;&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x3002; &#x4E0A;&#x56FE;&#x662F;&#x7F51;&#x7EDC;&#x5C42;&#x6709;&#x6D45;&#x53CA;&#x6DF1;&#x7684;&#x6570;&#x636E;&#x7247;&#x6BB5;&#x3002;&#x5176;&#x4E2D;&#x6BCF;9&#x4E2A;&#x683C;&#x5B50;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x795E;&#x7ECF;&#x5143;&#x8F93;&#x51FA;&#x3002;&#x5982;&#x679C;&#x653E;&#x5927;&#x770B;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x6D45;&#x5C42;&#x7F51;&#x7EDC;&#x5173;&#x6CE8;&#x7684;&#x90FD;&#x662F;&#x4E00;&#x4E9B;&#x5C40;&#x90E8;&#x7684;&#x7EBF;&#x6761;&#x6216;&#x8005;&#x56FE;&#x6848;&#x3002;&#x8D8A;&#x5F80;&#x6DF1;&#x5C42;&#xFF0C;&#x56FE;&#x50CF;&#x8D8A;&#x5177;&#x4F53;&#xFF0C;3/4/5&#x5C42;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5177;&#x4F53;&#x7684;&#x7269;&#x4F53;&#x5F62;&#x6001;&#x4E86;&#x3002; &#x90A3;&#x4E48;&#xFF0C;&#x8BA1;&#x7B97;&#x98CE;&#x683C;&#x635F;&#x5931;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x4F1A;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF1A;&#x9488;&#x5BF9;&#x7B2C;l&#x5C42;&#xFF0C;&#x8BA1;&#x7B97;&#x5176;&#x98CE;&#x683C;&#x635F;&#x5931;&#x51FD;&#x6570;&#x5C06;&#x8BE5;&#x5C42;&#x6FC0;&#x6D3B;&#x8F93;&#x51FA;&#x7684;volume&#x5207;&#x7247;&#xFF0C;&#x8BA1;&#x7B97;Style Image&#x4E0E;Generated Image&#x7684;correlation &#x8BA1;&#x7B97;&#x635F;&#x5931;&#x51FD;&#x6570; &#x603B;&#x4F53;&#x7684;&#x98CE;&#x683C;&#x635F;&#x5931;&#x51FD;&#x6570;&#x5C31;&#x662F;&#xFF1A; &#x5176;&#x4E2D;&#x662F;&#x4E00;&#x4E2A;&#x8D85;&#x53C2;&#x6570;&#xFF0C;&#x7528;&#x6765;&#x8C03;&#x8282;&#x6BCF;&#x4E00;&#x5C42;&#x7684;&#x6743;&#x91CD;&#x3002;&#x53C2;&#x8003;&#x6587;&#x732E;Neural Style Transfer: Gatys et al., 2015, A neural algorithm of artistic style%23%20Deep%20Learning%20%2814%29%20-%20Neural%20Style%20Transfer%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%u8FD9%u662F%u5F53%u4E0B%u5F88%u6D41%u884C%u7684%u4E00%u4E2A%u73A9%u6CD5%u3002%u4E0B%u9762%u5C31%u662F%u4E00%u4E2A%u4F8B%u5B50%uFF1A%0A%21%5BAlt%20text%7C300x0%5D%28./1538285228968.png%29%0A%u5C06%u539F%u672C%u7684%u98CE%u666F%u7167%u7247%u878D%u5165%u68B5%u9AD8%u661F%u7A7A%u753B%u4F5C%u7684%u98CE%u683C%u3002%u8FD8%u6709%u65F6%u4E0B%u56FD%u5185%u5F88%u6D41%u884C%u7684%u8138%u840C%uFF0C%u5316%u5986%u7684app%uFF0C%u5E94%u8BE5%u4E5F%u662F%u57FA%u4E8E%u8FD9%u4E2A%u5B9E%u73B0%u7684%u3002%0A%0A%23%23%20%u7B97%u6CD5%u6B65%u9AA4%0A%u8981%u5408%u6210%u8FD9%u6837%u4E00%u5F20%u6DF7%u5408%u98CE%u683C%u7684%u56FE%u7247%u7684%u6B65%u9AA4%u5927%u81F4%u5982%u4E0B%uFF1A%0A1.%20Initiate%20G%20randomly%0A2.%20Use%20gradient%20descent%20to%20minimize%20J%28G%29%0A%0A%u5176%u4E2D%3A%0A%24%24J%28G%29%20%3D%20%5Calpha%20J_%7Bcontent%7D%28C%2CG%29%20+%20%5Cbeta%20J_%7Bstyle%7D%28S%2CG%29%24%24%0A-%20%24%5Calpha%24%2C%20%24%5Cbeta%24%u662F%u8D85%u53C2%u6570%0A-%20C%u4EE3%u8868Content%uFF0CS%u4EE3%u8868Style%uFF0CG%u4EE3%u8868Generated%0A%0A%23%23%20%24J_%7Bcontent%7D%28C%2CG%29%24%0A-%20Say%20you%20use%20hidden%20layer%20l%20to%20compute%20content%20cost.%0A-%20Use%20pre-trained%20ConvNet.%20%28E.g.%2C%20VGG%20network%29%0A-%20Let%20%24a%5E%7B%5Bl%5D%28C%29%7D%24%20and%20%24a%5E%7B%5Bl%5D%28G%29%7D%24%20be%20the%20activation%20of%20layer%20l%20on%20the%20images%0A-%20If%20%24a%5E%7B%5Bl%5D%28C%29%7D%24%20and%20%24a%5E%7B%5Bl%5D%28G%29%7D%24%20are%20similar%2C%20both%20images%20have%20similar%20content%0A%09-%20%24J_%7Bcontent%7D%28C%2CG%29%20%3D%20%5Cfrac%20%7B1%7D%7B2%7D%20%5Cbegin%7BVmatrix%7D%20a%5E%7B%5Bl%5D%28C%29%7D%20-%20a%5E%7B%5Bl%5D%28G%29%7D%5Cend%7BVmatrix%7D%5E2%24%0A%0A%23%23%20%24J_%7Bstyle%7D%28S%2CG%29%24%0A%u56FE%u7247%u7684%u98CE%u683C%u5F80%u5F80%u9690%u542B%u5728%u901A%u9053%u4E2D%u3002%u6211%u4EEC%u5148%u770B%u770B%u4E00%u4E2A%u6DF1%u5C42%u5377%u79EF%u795E%u7ECF%u7F51%u7EDC%uFF0C%u6BCF%u4E00%u5C42%u6FC0%u6D3B%u51FD%u6570%u8F93%u51FA%u7684%u6570%u636E%u662F%u4EC0%u4E48%u6837%u7684%u3002%0A%21%5BAlt%20text%5D%28./1538292610814.png%29%0A%u4E0A%u56FE%u662F%u7F51%u7EDC%u5C42%u6709%u6D45%u53CA%u6DF1%u7684%u6570%u636E%u7247%u6BB5%u3002%u5176%u4E2D%u6BCF9%u4E2A%u683C%u5B50%u4EE3%u8868%u4E00%u4E2A%u795E%u7ECF%u5143%u8F93%u51FA%u3002%u5982%u679C%u653E%u5927%u770B%uFF0C%u53EF%u4EE5%u53D1%u73B0%uFF0C%u6D45%u5C42%u7F51%u7EDC%u5173%u6CE8%u7684%u90FD%u662F%u4E00%u4E9B%u5C40%u90E8%u7684%u7EBF%u6761%u6216%u8005%u56FE%u6848%u3002%u8D8A%u5F80%u6DF1%u5C42%uFF0C%u56FE%u50CF%u8D8A%u5177%u4F53%uFF0C3/4/5%u5C42%u5DF2%u7ECF%u53EF%u4EE5%u770B%u5230%u5177%u4F53%u7684%u7269%u4F53%u5F62%u6001%u4E86%u3002%0A%u90A3%u4E48%uFF0C%u8BA1%u7B97%u98CE%u683C%u635F%u5931%u51FD%u6570%uFF0C%u5C31%u4F1A%u662F%u4E0B%u9762%u8FD9%u6837%u4E00%u4E2A%u8FC7%u7A0B%uFF1A%0A%21%5BAlt%20text%7C700x0%5D%28./1538292884877.png%29%0A1.%20%u9488%u5BF9%u7B2Cl%u5C42%uFF0C%u8BA1%u7B97%u5176%u98CE%u683C%u635F%u5931%u51FD%u6570%0A%21%5BAlt%20text%7C500x0%5D%28./1538292978497.png%29%0A2.%20%u5C06%u8BE5%u5C42%u6FC0%u6D3B%u8F93%u51FA%u7684volume%u5207%u7247%uFF0C%u8BA1%u7B97Style%20Image%u4E0EGenerated%20Image%u7684correlation%0A%09-%20%24G_%7Bkk%27%7D%5E%7B%5Bl%5D%28S%29%7D%20%3D%20%5CSigma_%7Bi%3D1%7D%5E%7Bn_H%5E%7B%5Bl%5D%7D%7D%20%5CSigma_%7Bj%3D1%7D%5E%7B%5Bl%5D%7D%20a_%7Bijk%7D%5E%7B%5Bl%5D%28S%29%7D%20a_%7Bijk%27%7D%5E%7B%5Bl%5D%28S%29%7D%24%0A%09-%20%24G_%7Bkk%27%7D%5E%7B%5Bl%5D%28G%29%7D%20%3D%20%5CSigma_%7Bi%3D1%7D%5E%7Bn_H%5E%7B%5Bl%5D%7D%7D%20%5CSigma_%7Bj%3D1%7D%5E%7B%5Bl%5D%7D%20a_%7Bijk%7D%5E%7B%5Bl%5D%28G%29%7D%20a_%7Bijk%27%7D%5E%7B%5Bl%5D%28G%29%7D%24%0A3.%20%u8BA1%u7B97%u635F%u5931%u51FD%u6570%0A%09%24%24%5Cbegin%7Balign%7D%20J_%7Bstyle%7D%5E%7B%5Bl%5D%7D%28S%2C%20G%29%20%26%3D%20%5Ccfrac%20%7B1%7D%7B%282n_H%5E%7B%5Bl%5D%7Dn_W%5E%7B%5Bl%5D%7Dn_C%5E%7B%5Bl%5D%7D%29%5E2%7D%20%5Cbegin%7BVmatrix%7D%20G%5E%7B%5Bl%5D%28S%29%7D%20-%20G%5E%7B%5Bl%5D%28G%29%7D%5Cend%7BVmatrix%7D_F%5E2%20%5C%5C%20%26%3D%20%5Ccfrac%20%7B1%7D%7B%282n_H%5E%7B%5Bl%5D%7Dn_W%5E%7B%5Bl%5D%7Dn_C%5E%7B%5Bl%5D%7D%29%5E2%7D%20%5CSigma_k%20%5CSigma_%7Bk%27%7D%28G_%7Bkk%27%7D%5E%7B%5Bl%5D%28S%29%7D%20-%20G_%7Bkk%27%7D%5E%7B%5Bl%5D%28G%29%7D%29%5E2%5Cend%7Balign%7D%24%24%0A4.%20%u603B%u4F53%u7684%u98CE%u683C%u635F%u5931%u51FD%u6570%u5C31%u662F%uFF1A%0A%24%24J_%7Bstyle%7D%28S%2CG%29%20%3D%20%5CSigma_l%5Clambda%5E%7B%5Bl%5D%7D%20J_%7Bstyle%7D%5E%7B%5Bl%5D%7D%28S%2CG%29%24%24%0A%u5176%u4E2D%24%5Clambda%5E%7B%5Bl%5D%7D%24%u662F%u4E00%u4E2A%u8D85%u53C2%u6570%uFF0C%u7528%u6765%u8C03%u8282%u6BCF%u4E00%u5C42%u7684%u6743%u91CD%u3002%0A%0A%23%23%20%u53C2%u8003%u6587%u732E%0ANeural%20Style%20Transfer%3A%20Gatys%20et%20al.%2C%202015%2C%20A%20neural%20algorithm%20of%20artistic%20style%0A%0A%0A%0A%0A]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (13) - Face Recognition]]></title>
    <url>%2F2018%2F09%2F29%2FDeep_Learning_(13)_-_Face_Recognition%2F</url>
    <content type="text"><![CDATA[Edit&#x672C;&#x7AE0;&#x8BA8;&#x8BBA;&#x7684;&#x662F;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x7684;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7528;&#x4F8B;&#x2014;&#x2014;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x3002;&#x6240;&#x8C13;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#xFF0C;&#x5C31;&#x662F;&#x8F93;&#x5165;&#x4E00;&#x5F20;&#x7167;&#x7247;&#xFF0C;&#x6216;&#x8005;&#x73B0;&#x573A;&#x91C7;&#x96C6;&#x5934;&#x50CF;&#x7167;&#x7247;&#xFF0C;&#x5E76;&#x5339;&#x914D;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6765;&#x7FFB;&#x8BD1;&#x6210;&#x8EAB;&#x4EFD;&#x4FE1;&#x606F;&#x3002;&#x901A;&#x5E38;&#x4E00;&#x4E2A;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x7B97;&#x6CD5;&#x53EF;&#x4EE5;&#x5206;&#x4F5C;&#x4E24;&#x6B65;&#xFF1A;Face verificationFace recognition&#x524D;&#x8005;&#x8F93;&#x5165;&#x7167;&#x7247;&#x548C;ID&#x4FE1;&#x606F;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5339;&#x914D;&#x3002;&#x540E;&#x8005;&#x8F93;&#x5165;&#x7167;&#x7247;&#x4FE1;&#x606F;&#xFF0C;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5DF2;&#x6709;&#x7684;&#x7167;&#x7247;&#x96C6;&#x8FDB;&#x884C;&#x5339;&#x914D;&#x3002;&#x5F53;&#x524D;&#x8005;&#x7B97;&#x6CD5;&#x7CBE;&#x786E;&#x5EA6;&#x8DB3;&#x591F;&#x9AD8;&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x5230;&#x540E;&#x8005;&#x4E2D;&#x3002;One Shot LearningFace recognition&#x9996;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x5C31;&#x662F;One Shot Learning&#x95EE;&#x9898;&#x3002;&#x4F8B;&#x5982;&#x516C;&#x53F8;&#x7684;&#x95E8;&#x7981;&#x7CFB;&#x7EDF;&#xFF0C;&#x901A;&#x5E38;&#x6BCF;&#x4E2A;&#x5458;&#x5DE5;&#x53EA;&#x4E0A;&#x4F20;&#x4E00;&#x5F20;&#x4E2A;&#x4EBA;&#x7167;&#x7247;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x5C31;&#x8981;&#x80FD;&#x591F;&#x6B63;&#x786E;&#x8BC6;&#x522B;&#x8BE5;&#x5458;&#x5DE5;&#x3002;&#x5373;&#x4FBF;&#x6240;&#x6709;&#x7684;&#x5458;&#x5DE5;&#x90FD;&#x4E0A;&#x4F20;&#x4E86;&#x7167;&#x7247;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x6837;&#x672C;&#x96C6;&#x7684;&#x6570;&#x91CF;&#x7EA7;&#x4ECD;&#x7136;&#x4E0D;&#x4F1A;&#x5F88;&#x9AD8;&#x3002;&#x600E;&#x4E48;&#x5728;&#x4E00;&#x4E2A;&#x5C0F;&#x6837;&#x672C;&#x96C6;&#x4E0A;&#x6709;&#x6548;&#x8BAD;&#x7EC3;&#x6765;&#x8FBE;&#x5230;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;One Shot Learning&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x3002;&#x540E;&#x9762;&#x63D0;&#x5230;&#x7684;Siamese&#x7F51;&#x7EDC;&#x5C31;&#x662F;One Shot Learning&#x7684;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;Siamese NetworkSiamese&#x5C31;&#x662F;&#x4E0B;&#x56FE;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x3002;&#x5B83;&#x5305;&#x542B;2&#x4E2A;&#x6216;&#x8005;&#x66F4;&#x591A;&#x4E2A;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#x7684;&#x7F51;&#x7EDC;&#x5206;&#x652F;&#x3002;&#x6BCF;&#x4E2A;&#x5206;&#x652F;&#x5C06;&#x8F93;&#x5165;&#x6570;&#x636E;&#x6620;&#x5C04;&#x6210;&#x6700;&#x7EC8;&#x7684;activation&#x5411;&#x91CF;&#x8F93;&#x51FA;&#x3002;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x8FD9;&#x4E24;&#x4E2A;&#x5411;&#x91CF;&#x7684;&#x76F8;&#x4F3C;&#x5EA6;&#xFF0C;&#x6765;&#x5EA6;&#x91CF;&#x4E24;&#x5E45;&#x56FE;&#x7247;&#x7684;&#x76F8;&#x4F3C;&#x5EA6;&#x3002; &#x5176;&#x4E2D;&#x4E24;&#x8DEF;&#x8F93;&#x51FA;&#x7684;difference&#x7528;&#x4E0B;&#x5F0F;&#x6765;&#x8868;&#x660E;&#xFF1A; &#x5982;&#x679C;&#x8F93;&#x51FA;&#x5C42;&#xFF0C;&#x91C7;&#x7528;sigmoid&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#xFF0C;&#x5219;&#x9884;&#x6D4B;&#x8F93;&#x51FA;&#x4E3A;&#xFF1A; &#x4E0A;&#x9762;&#x662F;&#x8BAD;&#x7EC3;&#x597D;&#x6240;&#x6709;&#x6743;&#x91CD;&#x540E;&#xFF0C;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;Siamese&#x7F51;&#x7EDC;&#x6765;&#x5F97;&#x5230;&#x56FE;&#x7247;&#x5F02;&#x540C;&#x7684;&#x9884;&#x6D4B;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x8BAD;&#x7EC3;&#x4E00;&#x4E2A;Siamese&#x7F51;&#x7EDC;&#x5462;&#xFF1F;&#x8981;&#x8BAD;&#x7EC3;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6A21;&#x578B;&#x7684;&#x635F;&#x5931;&#x51FD;&#x6570;J&#xFF0C;&#x5176;&#x6B21;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6EE1;&#x8DB3;&#x8BAD;&#x7EC3;&#x7684;&#x6837;&#x672C;&#x96C6;&#x3002;Triplet Loss&#x8981;&#x8BAD;&#x7EC3;&#x4E00;&#x4E2A;Siamese&#x7F51;&#x7EDC;&#xFF0C;&#x5B83;&#x7684;&#x8F93;&#x5165;&#x6837;&#x672C;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x9009;&#x62E9; &#x4E00;&#x5171;3&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x5206;&#x6210;&#x4E24;&#x7EC4;&#xFF0C;&#x8BAD;&#x7EC3;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5DE6;&#x8FB9;&#x4E00;&#x7EC4;&#x8F93;&#x51FA;&#x7684;difference&#x51FD;&#x6570;&#x8981;&#x5C0F;&#x4E8E;&#x53F3;&#x8FB9;&#x4E00;&#x7EC4;&#x8F93;&#x51FA;&#x7684;difference&#x51FD;&#x6570;&#x3002;&#x8003;&#x8651;&#x968F;&#x673A;&#x566A;&#x58F0;&#xFF0C;&#x518D;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;margin&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x635F;&#x5931;&#x51FD;&#x6570;&#x5982;&#x4E0B;&#xFF1A; &#x5C31;&#x662F;marginA&#x4EE3;&#x8868;Anchor&#xFF0C;P&#x4EE3;&#x8868;Positive&#xFF0C;N&#x4EE3;&#x8868;Negativem&#x662F;mini-batch&#x4E2D;&#x7684;&#x6837;&#x672C;&#x6570;&#x5982;&#x679C;&#x6709;1k&#x4E2A;&#x4EBA;&#x7684;10k&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x5F88;&#x591A;&#x4E2A;&#x8FD9;&#x6837;APN&#x7684;&#x6837;&#x672C;&#x7EC4;&#x3002;&#x751F;&#x6210;&#x65F6;&#xFF0C;&#x6700;&#x597D;&#x4E0D;&#x8981;&#x91C7;&#x7528;&#x968F;&#x673A;&#x7B97;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x662F;&#x968F;&#x673A;&#x751F;&#x6210;APN&#x7684;&#x8BDD;&#xFF0C;&#x5BFC;&#x81F4;AN&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x56FE;&#x7247;&#x672C;&#x8EAB;&#x5DEE;&#x522B;&#x5C31;&#x5F88;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x6EE1;&#x8DB3;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6837;&#x672C;&#x5C31;&#x662F;&#x65E0;&#x6548;&#x6837;&#x672C;&#x3002;&#x5728;&#x751F;&#x6210;&#x6837;&#x672C;&#x65F6;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x6311;&#x9009;AN&#x5BF9;&#x65F6;&#xFF0C;&#x5C3D;&#x91CF;&#x6311;&#x9009;&#x6BD4;&#x8F83;&#x76F8;&#x4F3C;&#x7684;&#xFF0C;&#x4EE5;&#x8FDB;&#x884C;&#x6709;&#x6548;&#x8BAD;&#x7EC3;&#x3002; &#x901A;&#x8FC7;&#x5BF9;&#x8BE5;&#x635F;&#x5931;&#x51FD;&#x6570;J&#x8FDB;&#x884C;&#x524D;&#x5411;&#x4F20;&#x64AD;&#x548C;&#x53CD;&#x5411;&#x4F20;&#x64AD;&#xFF0C;&#x6765;&#x8FD0;&#x884C;Gradient descent&#x7B97;&#x6CD5;&#xFF0C;&#x8FED;&#x4EE3;&#x5F97;&#x5230;&#x6700;&#x7EC8;Siamese&#x7F51;&#x7EDC;&#x7684;&#x6A21;&#x578B;&#x53C2;&#x6570;&#x3002;&#x53C2;&#x8003;&#x6587;&#x732E;Siamese Network: Taigman et. al., 2014, DeepFace closing the gap to human level performance.Triplet Loss: Schroff et. al., 2015, FaceNet: A unified embedding for face recognition and clustering.Siamese Network &amp; Triplet Loss%23%20Deep%20Learning%20%2813%29%20-%20Face%20Recognition%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%u672C%u7AE0%u8BA8%u8BBA%u7684%u662F%u76EE%u6807%u68C0%u6D4B%u7684%u4E00%u4E2A%u7279%u6B8A%u7528%u4F8B%u2014%u2014%u4EBA%u8138%u8BC6%u522B%u3002%u6240%u8C13%u4EBA%u8138%u8BC6%u522B%uFF0C%u5C31%u662F%u8F93%u5165%u4E00%u5F20%u7167%u7247%uFF0C%u6216%u8005%u73B0%u573A%u91C7%u96C6%u5934%u50CF%u7167%u7247%uFF0C%u5E76%u5339%u914D%u6570%u636E%u5E93%u4E2D%u7684%u6570%u636E%uFF0C%u6765%u7FFB%u8BD1%u6210%u8EAB%u4EFD%u4FE1%u606F%u3002%u901A%u5E38%u4E00%u4E2A%u4EBA%u8138%u8BC6%u522B%u7B97%u6CD5%u53EF%u4EE5%u5206%u4F5C%u4E24%u6B65%uFF1A%0A-%20Face%20verification%0A-%20Face%20recognition%0A%0A%u524D%u8005%u8F93%u5165%u7167%u7247%u548CID%u4FE1%u606F%uFF0C%u5224%u65AD%u662F%u5426%u5339%u914D%u3002%u540E%u8005%u8F93%u5165%u7167%u7247%u4FE1%u606F%uFF0C%u4E0E%u6570%u636E%u5E93%u4E2D%u5DF2%u6709%u7684%u7167%u7247%u96C6%u8FDB%u884C%u5339%u914D%u3002%u5F53%u524D%u8005%u7B97%u6CD5%u7CBE%u786E%u5EA6%u8DB3%u591F%u9AD8%u65F6%uFF0C%u5C31%u53EF%u4EE5%u5E94%u7528%u5230%u540E%u8005%u4E2D%u3002%0A%0A%23%23%20One%20Shot%20Learning%0AFace%20recognition%u9996%u8981%u89E3%u51B3%u7684%u5C31%u662FOne%20Shot%20Learning%u95EE%u9898%u3002%u4F8B%u5982%u516C%u53F8%u7684%u95E8%u7981%u7CFB%u7EDF%uFF0C%u901A%u5E38%u6BCF%u4E2A%u5458%u5DE5%u53EA%u4E0A%u4F20%u4E00%u5F20%u4E2A%u4EBA%u7167%u7247%uFF0C%u90A3%u4E48%u8FD9%u4E2A%u7CFB%u7EDF%u5C31%u8981%u80FD%u591F%u6B63%u786E%u8BC6%u522B%u8BE5%u5458%u5DE5%u3002%u5373%u4FBF%u6240%u6709%u7684%u5458%u5DE5%u90FD%u4E0A%u4F20%u4E86%u7167%u7247%uFF0C%u5176%u5B9E%u8FD9%u4E2A%u6837%u672C%u96C6%u7684%u6570%u91CF%u7EA7%u4ECD%u7136%u4E0D%u4F1A%u5F88%u9AD8%u3002%u600E%u4E48%u5728%u4E00%u4E2A%u5C0F%u6837%u672C%u96C6%u4E0A%u6709%u6548%u8BAD%u7EC3%u6765%u8FBE%u5230%u6BD4%u8F83%u597D%u7684%u6548%u679C%uFF0C%u8FD9%u5C31%u662FOne%20Shot%20Learning%u9700%u8981%u89E3%u51B3%u7684%u95EE%u9898%u3002%u540E%u9762%u63D0%u5230%u7684Siamese%u7F51%u7EDC%u5C31%u662FOne%20Shot%20Learning%u7684%u4E00%u79CD%u89E3%u51B3%u65B9%u6848%u3002%0A%23%23%20Siamese%20Network%0ASiamese%u5C31%u662F%u4E0B%u56FE%u8FD9%u6837%u7684%u4E00%u4E2A%u7F51%u7EDC%u3002%u5B83%u5305%u542B2%u4E2A%u6216%u8005%u66F4%u591A%u4E2A%u5B8C%u5168%u4E00%u6837%u7684%u7F51%u7EDC%u5206%u652F%u3002%u6BCF%u4E2A%u5206%u652F%u5C06%u8F93%u5165%u6570%u636E%u6620%u5C04%u6210%u6700%u7EC8%u7684activation%u5411%u91CF%u8F93%u51FA%u3002%u7136%u540E%u901A%u8FC7%u6BD4%u8F83%u8FD9%u4E24%u4E2A%u5411%u91CF%u7684%u76F8%u4F3C%u5EA6%uFF0C%u6765%u5EA6%u91CF%u4E24%u5E45%u56FE%u7247%u7684%u76F8%u4F3C%u5EA6%u3002%0A%21%5BAlt%20text%7C700x0%5D%28./1538276798191.png%29%0A%u5176%u4E2D%u4E24%u8DEF%u8F93%u51FA%u7684difference%u7528%u4E0B%u5F0F%u6765%u8868%u660E%uFF1A%0A%24%24d%28x%5E%7B%28i%29%7D%2C%20x%5E%7B%28j%29%7D%29%20%3D%20%5Cbegin%7BVmatrix%7D%20f%28x%5E%7B%28i%29%7D%29%20-%20f%28x%5E%7B%28j%29%7D%29%20%5Cend%7BVmatrix%7D_2%5E2%24%24%0A%u5982%u679C%u8F93%u51FA%u5C42%uFF0C%u91C7%u7528sigmoid%u6FC0%u6D3B%u51FD%u6570%uFF0C%u5219%u9884%u6D4B%u8F93%u51FA%u4E3A%uFF1A%0A%24%24%5Chat%20y%20%3D%20%5Csigma%28%20%5CSigma_%7Bk%3D1%7D%5E%7B128%7D%20w_i%5Cbegin%7Bvmatrix%7D%20f%28x%5E%7B%28i%29%7D%29_k%20-%20f%28x%5E%7B%28j%29%7D%29_k%5Cend%7Bvmatrix%7D%20+%20b%29%24%24%0A%0A%u4E0A%u9762%u662F%u8BAD%u7EC3%u597D%u6240%u6709%u6743%u91CD%u540E%uFF0C%u5982%u4F55%u4F7F%u7528%u4E00%u4E2ASiamese%u7F51%u7EDC%u6765%u5F97%u5230%u56FE%u7247%u5F02%u540C%u7684%u9884%u6D4B%u3002%u90A3%u4E48%u5982%u4F55%u8BAD%u7EC3%u4E00%u4E2ASiamese%u7F51%u7EDC%u5462%uFF1F%u8981%u8BAD%u7EC3%u4E00%u4E2A%u7F51%u7EDC%uFF0C%u9996%u5148%u6211%u4EEC%u9700%u8981%u6A21%u578B%u7684%u635F%u5931%u51FD%u6570J%uFF0C%u5176%u6B21%u6211%u4EEC%u9700%u8981%u6EE1%u8DB3%u8BAD%u7EC3%u7684%u6837%u672C%u96C6%u3002%0A%0A%23%23%23%20Triplet%20Loss%0A%u8981%u8BAD%u7EC3%u4E00%u4E2ASiamese%u7F51%u7EDC%uFF0C%u5B83%u7684%u8F93%u5165%u6837%u672C%u53EF%u4EE5%u8FD9%u6837%u9009%u62E9%0A%21%5BAlt%20text%7C500x0%5D%28./1538274930628.png%29%0A%u4E00%u51713%u5F20%u56FE%u7247%uFF0C%u5206%u6210%u4E24%u7EC4%uFF0C%u8BAD%u7EC3%u7684%u76EE%u6807%u662F%u5DE6%u8FB9%u4E00%u7EC4%u8F93%u51FA%u7684difference%u51FD%u6570%u8981%u5C0F%u4E8E%u53F3%u8FB9%u4E00%u7EC4%u8F93%u51FA%u7684difference%u51FD%u6570%u3002%u8003%u8651%u968F%u673A%u566A%u58F0%uFF0C%u518D%u6DFB%u52A0%u4E00%u4E9Bmargin%uFF0C%u53EF%u4EE5%u5F97%u5230%u635F%u5931%u51FD%u6570%u5982%u4E0B%uFF1A%0A%24%24%5Cmathscr%20L%28A%2CP%2CN%29%20%3D%20max%28%5Cbegin%7BVmatrix%7D%20f%28A%29%20-%20f%28P%29%5Cend%7BVmatrix%7D%5E2%20-%20%5Cbegin%7BVmatrix%7D%20f%28A%29%20-%20f%28N%29%5Cend%7BVmatrix%7D%5E2%20+%20%5Calpha%2C%200%29%24%24%0A%24%24%20J%20%3D%20%5CSigma_%7Bi%3D1%7D%5Em%20%5Cmathscr%20L%28A%5E%7B%28i%29%7D%2C%20P%5E%7B%28i%29%7D%2C%20N%5E%7B%28i%29%7D%29%24%24%0A-%20%24%5Calpha%24%u5C31%u662Fmargin%0A-%20A%u4EE3%u8868Anchor%uFF0CP%u4EE3%u8868Positive%uFF0CN%u4EE3%u8868Negative%0A-%20m%u662Fmini-batch%u4E2D%u7684%u6837%u672C%u6570%0A%0A%u5982%u679C%u67091k%u4E2A%u4EBA%u768410k%u5F20%u56FE%u7247%uFF0C%u53EF%u4EE5%u751F%u6210%u5F88%u591A%u4E2A%u8FD9%u6837APN%u7684%u6837%u672C%u7EC4%u3002%u751F%u6210%u65F6%uFF0C%u6700%u597D%u4E0D%u8981%u91C7%u7528%u968F%u673A%u7B97%u6CD5%uFF0C%u56E0%u4E3A%u5982%u679C%u662F%u968F%u673A%u751F%u6210APN%u7684%u8BDD%uFF0C%u5BFC%u81F4AN%u5F88%u6709%u53EF%u80FD%u56FE%u7247%u672C%u8EAB%u5DEE%u522B%u5C31%u5F88%u5927%uFF0C%u6240%u4EE5%u5C31%u5F88%u5BB9%u6613%u6EE1%u8DB3%24%5Cmathscr%20L%28A%2CP%2CN%29%20%5Cge%200%24%uFF0C%u8FD9%u6837%u7684%u6837%u672C%u5C31%u662F%u65E0%u6548%u6837%u672C%u3002%u5728%u751F%u6210%u6837%u672C%u65F6%uFF0C%u5C24%u5176%u662F%u6311%u9009AN%u5BF9%u65F6%uFF0C%u5C3D%u91CF%u6311%u9009%u6BD4%u8F83%u76F8%u4F3C%u7684%uFF0C%u4EE5%u8FDB%u884C%u6709%u6548%u8BAD%u7EC3%u3002%0A%u901A%u8FC7%u5BF9%u8BE5%u635F%u5931%u51FD%u6570J%u8FDB%u884C%u524D%u5411%u4F20%u64AD%u548C%u53CD%u5411%u4F20%u64AD%uFF0C%u6765%u8FD0%u884CGradient%20descent%u7B97%u6CD5%uFF0C%u8FED%u4EE3%u5F97%u5230%u6700%u7EC8Siamese%u7F51%u7EDC%u7684%u6A21%u578B%u53C2%u6570%u3002%0A%0A%23%23%20%u53C2%u8003%u6587%u732E%0A-%20Siamese%20Network%3A%20Taigman%20et.%20al.%2C%202014%2C%20DeepFace%20closing%20the%20gap%20to%20human%20level%20performance.%0A-%20Triplet%20Loss%3A%20Schroff%20et.%20al.%2C%202015%2C%20FaceNet%3A%20A%20unified%20embedding%20for%20face%20recognition%20and%20clustering.%0A-%20%5BSiamese%20Network%20%26%20Triplet%20Loss%5D%28https%3A//towardsdatascience.com/siamese-network-triplet-loss-b4ca82c1aec8%29]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (12) - Object Detection]]></title>
    <url>%2F2018%2F09%2F24%2FDeep_Learning_(12)_-__Object_Detection%2F</url>
    <content type="text"><![CDATA[Edit &#x8FD9;&#x4E00;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;&#x5F53;&#x4E0B;&#x5927;&#x884C;&#x5176;&#x9053;&#x7684;Computer Vision&#x4E2D;&#x7684;Object Detection&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x3002;&#x8BFE;&#x7A0B;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x5176;&#x95F4;&#x4E5F;&#x6DF1;&#x5165;&#x4ECB;&#x7ECD;&#x4E86;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x7B97;&#x6CD5;&#x7684;&#x96C6;&#x5927;&#x6210;&#x8005;YOLO&#x7B97;&#x6CD5;&#x3002;&#x6A21;&#x578B;&#x5B9A;&#x4E49; &#x8F93;&#x5165;&#x662F;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x7ECF;&#x8FC7;CNN&#x7F51;&#x7EDC;&#xFF0C;&#x8F93;&#x51FA;&#x9884;&#x6D4B;&#x6807;&#x7B7E;&#x3002;&#x6807;&#x7B7E;&#x5B9A;&#x4E49;&#x901A;&#x5E38;&#x662F;&#xFF1A; Pc: &#x662F;&#x5426;&#x6709;&#x9700;&#x8981;&#x68C0;&#x6D4B;&#x7684;&#x76EE;&#x6807;: &#x4EE3;&#x8868;bounding box: &#x4EE3;&#x8868;&#x4E09;&#x79CD;&#x5206;&#x7C7B;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;car, pedestrian, motorcycle&#x635F;&#x5931;&#x51FD;&#x6570;(&#x7528;&#x6700;&#x5C0F;&#x4E8C;&#x4E58;&#x6CD5;)&#xFF1A; &#x68C0;&#x6D4B;&#x65B9;&#x6CD5;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x68C0;&#x6D4B;&#x6CD5; &#x68C0;&#x6D4B;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x5982;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x5148;&#x7528;&#x6700;&#x5C0F;&#x7684;&#x7A97;&#x53E3;&#x622A;&#x53D6;&#x56FE;&#x7247;&#x7684;&#x6BCF;&#x4E2A;&#x89D2;&#x843D;&#xFF0C;&#x8DD1;&#x4E00;&#x904D;CNN&#xFF0C;&#x770B;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x547D;&#x4E2D;&#x7684;&#x683C;&#x5B50;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x5C31;&#x6362;&#x5927;&#x4E00;&#x70B9;&#x7684;&#x7A97;&#x53E3;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x5C31;&#x518D;&#x6362;&#x5927;&#x4E00;&#x70B9;&#x7684;&#x7A97;&#x53E3;&#xFF0C;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;&#x3002;&#x8FD9;&#x662F;&#x6700;&#x5BB9;&#x6613;&#x60F3;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x7F3A;&#x70B9;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x91CF;&#x592A;&#x5927;&#xFF0C;&#x6548;&#x7387;&#x6781;&#x4F4E;&#x3002;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x7684;&#x5377;&#x79EF;&#x5B9E;&#x73B0;&#x5176;&#x672C;&#x8D28;&#x8FD8;&#x662F;&#x5229;&#x7528;&#x7A97;&#x53E3;&#x6765;&#x91C7;&#x6837;&#x56FE;&#x7247;&#xFF0C;&#x5E76;&#x8F93;&#x51FA;&#x8BE5;&#x7A97;&#x53E3;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x68C0;&#x6D4B;&#x5BF9;&#x8C61;&#x3002;&#x4F46;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x7C7B;&#x4F3C;&#x4E32;&#x884C;&#x7B97;&#x6CD5;&#xFF0C;&#x5377;&#x79EF;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x4E8E;&#x5E76;&#x884C;&#x7B97;&#x6CD5;&#xFF0C;&#x5176;&#x5171;&#x4EAB;&#x4E86;&#x5F88;&#x591A;&#x8BA1;&#x7B97;&#x6B65;&#x9AA4;&#xFF0C;&#x6548;&#x7387;&#x66F4;&#x9AD8;&#x3002; &#x4E0B;&#x9762;&#x5C06;&#x4F1A;&#x5BF9;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x7B97;&#x6CD5;&#x7F51;&#x7EDC;&#x8FDB;&#x884C;&#x4E00;&#x6B65;&#x6B65;&#x7684;&#x6539;&#x9020;&#xFF0C;&#x6700;&#x7EC8;&#x5B9E;&#x73B0;&#x5377;&#x79EF;&#x7B97;&#x6CD5;&#x6765;&#x4E00;&#x6B21;&#x6027;&#x68C0;&#x6D4B;&#x6240;&#x6709;&#x7A97;&#x53E3;&#x7684;&#x7ED3;&#x679C;&#x3002;1. &#x4F7F;&#x7528;1x1 convolution (Network in network)&#x6765;&#x53D6;&#x4EE3;FC&#x5C42; &#x5047;&#x8BBE;&#x5C31;&#x662F;14x14&#x7684;&#x7A97;&#x53E3;&#x4F7F;&#x7528;&#x5728;14x14&#x7684;&#x56FE;&#x7247;&#x4E0A;&#xFF0C;&#x6700;&#x7EC8;&#x8FD0;&#x7B97;&#x51FA;&#x6765;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x4E2A;1x1x4&#x7684;volume&#xFF0C;&#x4EE3;&#x8868;4&#x4E2A;&#x5206;&#x7C7B;&#x4E0A;&#x7684;&#x7ED3;&#x679C;&#x3002;2. &#x589E;&#x52A0;&#x56FE;&#x50CF;&#x5C3A;&#x5BF8;&#x540E;&#x7684;&#x60C5;&#x51B5; &#x56FE;&#x50CF;&#x5C3A;&#x5BF8;&#x5728;&#x957F;&#x5BBD;&#x65B9;&#x5411;&#x4E0A;&#x90FD;&#x589E;&#x52A0;2&#x4E2A;pixel&#xFF0C;&#x5219;&#x56FE;&#x50CF;&#x5C3A;&#x5BF8;&#x662F;16x16&#x3002;&#x5982;&#x679C;&#x4ECD;&#x7136;&#x91C7;&#x7528;14x14&#x7684;&#x7A97;&#x53E3;&#xFF0C;&#x5219;&#x4F1A;&#x9700;&#x8981;4&#x4E2A;&#x7A97;&#x53E3;&#x6765;&#x68C0;&#x6D4B;&#x8FD9;&#x4E2A;16x16&#x7684;&#x56FE;&#x50CF;&#x3002;&#x7ECF;&#x8FC7;&#x4E0A;&#x8FF0;CNN&#x7F51;&#x7EDC;&#x8FED;&#x4EE3;&#x540E;&#xFF0C;&#x7ED3;&#x679C;&#x662F;4x4x4&#x3002;&#x5176;&#x6BCF;&#x4E00;&#x4E2A;&#x683C;&#x5B50;&#x4EE3;&#x8868;&#x4E86;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x7684;&#x8FD0;&#x7B97;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x7684;&#x5377;&#x79EF;&#x5B9E;&#x73B0;&#x4E86;&#x3002;&#x66F4;&#x5927;&#x4E00;&#x70B9;&#x7684;&#x56FE;&#x50CF;&#x4F1A;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x60C5;&#x51B5;&#x5462;&#xFF1F; &#x540C;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x662F;28x28&#x7684;&#x56FE;&#x50CF;&#xFF0C;&#x5219;&#x4F1A;&#x6709;8&#x4E2A;&#x7A97;&#x53E3;&#x6765;&#x68C0;&#x6D4B;&#xFF0C;&#x6700;&#x7EC8;&#x4EA7;&#x751F;&#x7684;volume&#x662F;8x8x4&#xFF0C;&#x4EE3;&#x8868;&#x8FD9;8&#x4E2A;&#x7A97;&#x53E3;&#x7684;&#x68C0;&#x6D4B;&#x7ED3;&#x679C;&#x3002; &#x5377;&#x79EF;&#x7B97;&#x6CD5;&#x901A;&#x8FC7;&#x4E00;&#x6B21;&#x6027;&#x8FED;&#x4EE3;&#xFF0C;&#x8F93;&#x51FA;&#x4E86;&#x4E00;&#x5E45;&#x56FE;&#x7247;&#x4E0A;&#x6240;&#x6709;&#x5206;&#x7247;&#x7684;&#x68C0;&#x6D4B;&#x7ED3;&#x679C;&#xFF0C;&#x5176;&#x6548;&#x7387;&#x8981;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x7684;&#x8FD0;&#x7B97;&#x6548;&#x7387;&#x3002;YOLO AlgorithmYOLO = You Only Look Once &#x8FD9;&#x662F;&#x516C;&#x8BA4;&#x6BD4;&#x8F83;&#x9AD8;&#x6548;&#x7684;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x7B97;&#x6CD5;&#x3002;&#x636E;&#x8BF4;&#x8FD9;&#x7BC7;&#x8BBA;&#x6587;&#x7684;&#x96BE;&#x5EA6;&#x4E5F;&#x5F88;&#x9AD8;&#xFF0C;&#x6BD4;&#x8F83;&#x96BE;&#x8BFB;&#x61C2;&#x3002;IOUIOU = Intersection Over Union&#xFF0C;&#x7FFB;&#x8BD1;&#x6210;&#x4EA4;&#x5E76;&#x6BD4;&#x3002;&#x4EA4;&#x96C6;&#x548C;&#x5E76;&#x96C6;&#x7684;&#x6BD4;&#x4F8B;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A; &#x84DD;&#x8272;&#x6846;&#x662F;&#x7B97;&#x6CD5;&#x9884;&#x6D4B;&#x51FA;&#x7684;&#x76EE;&#x6807;&#x4F4D;&#x7F6E;&#xFF0C;&#x7EA2;&#x8272;&#x6846;&#x662F;&#x5B9E;&#x9645;&#x76EE;&#x6807;&#x4F4D;&#x7F6E;&#x3002;&#x9EC4;&#x8272;&#x9634;&#x5F71;&#x662F;&#x4EA4;&#x96C6;&#xFF0C;&#x7EFF;&#x8272;&#x9634;&#x5F71;&#x662F;&#x5E76;&#x96C6;&#x3002;&#x90A3;&#x4E48;&#xFF1A; &#x4EE5;IOU&#x7684;&#x5927;&#x5C0F;&#x6765;&#x5224;&#x65AD;&#xFF0C;&#x8FD9;&#x4E00;&#x6B21;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x7684;&#x8D28;&#x91CF;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x8981;&#x6C42;&#x4EA4;&#x5E76;&#x6BD4;&#x8FBE;&#x5230;0.5&#x6216;0.6&#x4EE5;&#x4E0A;&#xFF0C;&#x624D;&#x7B97;&#x4E00;&#x6B21;&#x6709;&#x6548;&#x7684;&#x68C0;&#x6D4B;&#x3002;Non-max Suppression Algorithm&#x7FFB;&#x8BD1;&#x6210;&#x975E;&#x6781;&#x5927;&#x503C;&#x6291;&#x5236;&#x3002; &#x5F53;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x68C0;&#x6D4B;&#x7ED3;&#x679C;&#x7684;&#x65F6;&#x5019;&#xFF1A; &#x7406;&#x8BBA;&#x4E0A;&#xFF0C;&#x4E00;&#x4E2A;&#x7269;&#x4F53;&#x53EA;&#x5C5E;&#x4E8E;&#x4E00;&#x4E2A;box&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x901A;&#x5E38;&#x5728;&#x9884;&#x6D4B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x7269;&#x4F53;&#x56DB;&#x5468;&#x7684;box&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x4EA7;&#x751F;&#x6709;&#x6548;&#x9884;&#x6D4B;&#x3002;Non-max suppression&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x8FC7;&#x6EE4;&#x6389;&#x8D28;&#x91CF;&#x8F83;&#x5DEE;&#x7684;&#x9884;&#x6D4B;&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x7269;&#x4F53;&#x53EA;&#x7559;&#x4E0B;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x9884;&#x6D4B;&#x3002;&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x5982;&#x4E0B; &#x7ECF;&#x8FC7;Non-max suppression&#x8FC7;&#x6EE4;&#x540E;&#xFF0C;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A; &#x6BCF;&#x4E2A;&#x7269;&#x4F53;&#x53EA;&#x4FDD;&#x7559;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x68C0;&#x6D4B;&#x3002;Anchor BoxAnchor Box&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x5E45;&#x56FE;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x5F62;&#x72B6;&#x7684;&#x7269;&#x4F53;&#xFF0C;&#x5176;&#x4E2D;&#x5FC3;&#x70B9;&#x91CD;&#x53E0;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A;grid box&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x7269;&#x4F53;&#xFF0C;&#x8FD9;&#x4E2A;&#x901A;&#x8FC7;&#x4E00;&#x822C;&#x7684;y label&#x662F;&#x6CA1;&#x6CD5;&#x53CD;&#x6620;&#x51FA;&#x6765;&#x7684;&#x3002; &#x901A;&#x5E38;&#x7684;y label&#x662F;&#xFF1A; &#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x8BBE;&#x7F6E;Anchor Box&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x56FE;&#x7247;&#x5C31;&#x8BBE;&#x7F6E;&#x4E24;&#x4E2A;Anchor Box&#x3002;&#x5F53;&#x5982;&#x679C;&#x6709;&#x66F4;&#x591A;&#x7684;&#x56FE;&#x7247;&#x4EA4;&#x53E0;&#x7684;&#x53EF;&#x80FD;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x5C31;&#x8981;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;Anchor Box&#x3002;y&#x4FEE;&#x6B63;&#x6210;&#x4E3A;&#xFF1A; y&#x4E0A;&#x534A;&#x90E8;&#x5206;&#x68C0;&#x6D4B;Anchor Box 1&#x7684;&#x7269;&#x4F53;&#xFF0C;&#x4E0B;&#x534A;&#x90E8;&#x5206;&#x68C0;&#x6D4B;Anchor Box 2&#x7684;&#x7269;&#x4F53;&#x3002;YOLO&#x7B97;&#x6CD5;&#x5148;&#x5C06;&#x6837;&#x672C;&#x56FE;&#x7247;&#x5207;&#x5272;&#x6210;&#x7F51;&#x683C;&#xFF0C;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x7F51;&#x683C;&#x586B;&#x5145;&#x6807;&#x7B7E;y&#x3002;&#x6BCF;&#x4E2A;&#x7F51;&#x683C;&#x7684;&#x5DE6;&#x4E0A;&#x70B9;&#x5750;&#x6807;&#x4E3A;(0,0)&#xFF0C;&#x53F3;&#x4E0B;&#x89D2;&#x5750;&#x6807;&#x4E3A;(1,1)&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x662F;&#x771F;&#x5B9E;&#x7269;&#x4F53;&#x5C3A;&#x5BF8;&#x9488;&#x5BF9;&#x7F51;&#x683C;&#x7684;&#x6BD4;&#x4F8B;&#x3002;&#x6240;&#x4EE5;&#x4E0A;&#x56FE;&#x53F3;&#x8FB9;&#x8F66;&#x5B50;&#x7684;bounding box&#x7684;&#x957F;&#x5BBD;&#x53EF;&#x80FD;&#x662F;0.4x0.9&#xFF0C;&#x5DE6;&#x8FB9;&#x8F66;&#x5B50;&#x7684;&#x957F;&#x5BBD;&#x6BD4;&#x53EF;&#x80FD;&#x662F;0.5x0.6&#x3002;&#x5982;&#x679C;&#x6709;&#x76EE;&#x6807;&#x7269;&#x4F53;&#x5219;&#xFF0C;&#x5426;&#x5219;&#x5982;&#x679C;&#x6709;&#x53EF;&#x80FD;&#x6709;&#x56FE;&#x7247;&#x91CD;&#x53E0;&#x5728;&#x4E00;&#x4E2A;&#x683C;&#x5B50;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x5BF9;&#x5E94;&#x7684;Anchor Box&#x540E;&#x9762;&#x5C31;&#x662F;&#x7ECF;&#x5178;&#x7684;CNN&#x4E86;&#xFF0C;&#x6700;&#x7EC8;&#x5F97;&#x51FA;&#x5BF9;y&#x7684;&#x9884;&#x6D4B; &#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x7684;&#x56FE;&#x50CF;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x5982;&#x4E0B;&#xFF1A; &#x91C7;&#x7528;non-max suppression&#x6765;&#x8FC7;&#x6EE4;&#x51FA;&#x6700;&#x7EC8;&#x7684;&#x9884;&#x6D4B;&#x7ED3;&#x679C;&#x3002;&#x53C2;&#x8003;&#x6587;&#x732E;YOLO: Redmon et al., 2015, You Only Look Once: Unified real-time object detection%23%20Deep%20Learning%20%2812%29%20-%20%20Object%20Detection%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%u8FD9%u4E00%u7AE0%u4E3B%u8981%u4ECB%u7ECD%u4E86%u5F53%u4E0B%u5927%u884C%u5176%u9053%u7684Computer%20Vision%u4E2D%u7684Object%20Detection%uFF0C%u4E5F%u5C31%u662F%u76EE%u6807%u68C0%u6D4B%u3002%u8BFE%u7A0B%u7531%u6D45%u5165%u6DF1%uFF0C%u5176%u95F4%u4E5F%u6DF1%u5165%u4ECB%u7ECD%u4E86%u76EE%u6807%u68C0%u6D4B%u7B97%u6CD5%u7684%u96C6%u5927%u6210%u8005YOLO%u7B97%u6CD5%u3002%0A%23%23%20%u6A21%u578B%u5B9A%u4E49%0A%21%5BAlt%20text%7C600x0%5D%28./1537747343242.png%29%0A%u8F93%u5165%u662F%u4E00%u5F20%u56FE%u7247%uFF0C%u7ECF%u8FC7CNN%u7F51%u7EDC%uFF0C%u8F93%u51FA%u9884%u6D4B%u6807%u7B7E%u3002%u6807%u7B7E%u5B9A%u4E49%u901A%u5E38%u662F%uFF1A%0A%24%24y%20%3D%20%5Cbegin%7Bbmatrix%7D%20Pc%20%5C%5C%20b_x%20%5C%5C%20b_y%20%5C%5C%20b_h%20%5C%5C%20b_w%20%5C%5C%20c_1%20%5C%5C%20c_2%20%5C%5C%20c_3%20%5Cend%7Bbmatrix%7D%24%24%0A-%20Pc%3A%20%u662F%u5426%u6709%u9700%u8981%u68C0%u6D4B%u7684%u76EE%u6807%0A-%20%24b_x%2C%20b_y%2C%20b_h%2C%20b_w%24%3A%20%u4EE3%u8868bounding%20box%0A-%20%24c_1%2C%20c_2%2C%20c_3%24%3A%20%u4EE3%u8868%u4E09%u79CD%u5206%u7C7B%uFF0C%u4F8B%u5982%uFF1Acar%2C%20pedestrian%2C%20motorcycle%0A%0A%u635F%u5931%u51FD%u6570%28%u7528%u6700%u5C0F%u4E8C%u4E58%u6CD5%29%uFF1A%0A%24%24%5Cmathscr%20L%20%28%5Chat%20y%2C%20y%29%20%3D%20%0A%5Cbegin%7Bcases%7D%0A%5CSigma_i%20%28%5Chat%20y_i%20-%20y_i%29%5E2%20%26%20y_1%20%3D%201%20%5C%5C%20%28%5Chat%20y_1%20-%20y_1%29%5E2%20%26%20y_1%20%3D%200%0A%5Cend%7Bcases%7D%24%24%0A%0A%23%23%20%u68C0%u6D4B%u65B9%u6CD5%0A%23%23%23%20%u6ED1%u52A8%u7A97%u53E3%u68C0%u6D4B%u6CD5%0A%21%5BAlt%20text%5D%28./1537828997891.png%29%0A%u68C0%u6D4B%u65B9%u6CD5%u5C31%u662F%u5982%u56FE%u6240%u793A%uFF0C%u5148%u7528%u6700%u5C0F%u7684%u7A97%u53E3%u622A%u53D6%u56FE%u7247%u7684%u6BCF%u4E2A%u89D2%u843D%uFF0C%u8DD1%u4E00%u904DCNN%uFF0C%u770B%u770B%u6709%u6CA1%u6709%u547D%u4E2D%u7684%u683C%u5B50%uFF0C%u5982%u679C%u6CA1%u6709%uFF0C%u5C31%u6362%u5927%u4E00%u70B9%u7684%u7A97%u53E3%uFF0C%u5982%u679C%u8FD8%u6CA1%u6709%u5C31%u518D%u6362%u5927%u4E00%u70B9%u7684%u7A97%u53E3%uFF0C%u4EE5%u6B64%u7C7B%u63A8%u3002%u8FD9%u662F%u6700%u5BB9%u6613%u60F3%u5230%u7684%u65B9%u6CD5%uFF0C%u4F46%u662F%u7F3A%u70B9%u5C31%u662F%u8BA1%u7B97%u91CF%u592A%u5927%uFF0C%u6548%u7387%u6781%u4F4E%u3002%0A%0A%23%23%23%20%u6ED1%u52A8%u7A97%u53E3%u7684%u5377%u79EF%u5B9E%u73B0%0A%u5176%u672C%u8D28%u8FD8%u662F%u5229%u7528%u7A97%u53E3%u6765%u91C7%u6837%u56FE%u7247%uFF0C%u5E76%u8F93%u51FA%u8BE5%u7A97%u53E3%u4E2D%u662F%u5426%u6709%u68C0%u6D4B%u5BF9%u8C61%u3002%u4F46%u6ED1%u52A8%u7A97%u53E3%u7C7B%u4F3C%u4E32%u884C%u7B97%u6CD5%uFF0C%u5377%u79EF%u5B9E%u73B0%u7C7B%u4F3C%u4E8E%u5E76%u884C%u7B97%u6CD5%uFF0C%u5176%u5171%u4EAB%u4E86%u5F88%u591A%u8BA1%u7B97%u6B65%u9AA4%uFF0C%u6548%u7387%u66F4%u9AD8%u3002%0A%u4E0B%u9762%u5C06%u4F1A%u5BF9%u6ED1%u52A8%u7A97%u53E3%u7B97%u6CD5%u7F51%u7EDC%u8FDB%u884C%u4E00%u6B65%u6B65%u7684%u6539%u9020%uFF0C%u6700%u7EC8%u5B9E%u73B0%u5377%u79EF%u7B97%u6CD5%u6765%u4E00%u6B21%u6027%u68C0%u6D4B%u6240%u6709%u7A97%u53E3%u7684%u7ED3%u679C%u3002%0A%23%23%23%23%201.%20%u4F7F%u75281x1%20convolution%20%28Network%20in%20network%29%u6765%u53D6%u4EE3FC%u5C42%0A%21%5BAlt%20text%5D%28./1537916911046.png%29%0A%u5047%u8BBE%u5C31%u662F14x14%u7684%u7A97%u53E3%u4F7F%u7528%u572814x14%u7684%u56FE%u7247%u4E0A%uFF0C%u6700%u7EC8%u8FD0%u7B97%u51FA%u6765%u7684%u7ED3%u679C%u662F%u4E00%u4E2A1x1x4%u7684volume%uFF0C%u4EE3%u88684%u4E2A%u5206%u7C7B%u4E0A%u7684%u7ED3%u679C%u3002%0A%23%23%23%23%202.%20%u589E%u52A0%u56FE%u50CF%u5C3A%u5BF8%u540E%u7684%u60C5%u51B5%0A%21%5BAlt%20text%5D%28./1537917090503.png%29%0A%u56FE%u50CF%u5C3A%u5BF8%u5728%u957F%u5BBD%u65B9%u5411%u4E0A%u90FD%u589E%u52A02%u4E2Apixel%uFF0C%u5219%u56FE%u50CF%u5C3A%u5BF8%u662F16x16%u3002%u5982%u679C%u4ECD%u7136%u91C7%u752814x14%u7684%u7A97%u53E3%uFF0C%u5219%u4F1A%u9700%u89814%u4E2A%u7A97%u53E3%u6765%u68C0%u6D4B%u8FD9%u4E2A16x16%u7684%u56FE%u50CF%u3002%u7ECF%u8FC7%u4E0A%u8FF0CNN%u7F51%u7EDC%u8FED%u4EE3%u540E%uFF0C%u7ED3%u679C%u662F4x4x4%u3002%u5176%u6BCF%u4E00%u4E2A%u683C%u5B50%u4EE3%u8868%u4E86%u4E00%u4E2A%u7A97%u53E3%u7684%u8FD0%u7B97%u7ED3%u679C%u3002%u8FD9%u5B9E%u9645%u4E0A%u5C31%u662F%u6ED1%u52A8%u7A97%u53E3%u7684%u5377%u79EF%u5B9E%u73B0%u4E86%u3002%0A%0A%u66F4%u5927%u4E00%u70B9%u7684%u56FE%u50CF%u4F1A%u662F%u600E%u4E48%u6837%u7684%u60C5%u51B5%u5462%uFF1F%0A%21%5BAlt%20text%5D%28./1537917281175.png%29%0A%u540C%u7406%uFF0C%u5982%u679C%u662F28x28%u7684%u56FE%u50CF%uFF0C%u5219%u4F1A%u67098%u4E2A%u7A97%u53E3%u6765%u68C0%u6D4B%uFF0C%u6700%u7EC8%u4EA7%u751F%u7684volume%u662F8x8x4%uFF0C%u4EE3%u8868%u8FD98%u4E2A%u7A97%u53E3%u7684%u68C0%u6D4B%u7ED3%u679C%u3002%0A%u5377%u79EF%u7B97%u6CD5%u901A%u8FC7%u4E00%u6B21%u6027%u8FED%u4EE3%uFF0C%u8F93%u51FA%u4E86%u4E00%u5E45%u56FE%u7247%u4E0A%u6240%u6709%u5206%u7247%u7684%u68C0%u6D4B%u7ED3%u679C%uFF0C%u5176%u6548%u7387%u8981%u8FDC%u8FDC%u5927%u4E8E%u6ED1%u52A8%u7A97%u53E3%u7684%u8FD0%u7B97%u6548%u7387%u3002%0A%0A%23%23%20YOLO%20Algorithm%0AYOLO%20%3D%20You%20Only%20Look%20Once%0A%u8FD9%u662F%u516C%u8BA4%u6BD4%u8F83%u9AD8%u6548%u7684%u76EE%u6807%u68C0%u6D4B%u7B97%u6CD5%u3002%u636E%u8BF4%u8FD9%u7BC7%u8BBA%u6587%u7684%u96BE%u5EA6%u4E5F%u5F88%u9AD8%uFF0C%u6BD4%u8F83%u96BE%u8BFB%u61C2%u3002%0A%23%23%23%20IOU%0AIOU%20%3D%20Intersection%20Over%20Union%uFF0C%u7FFB%u8BD1%u6210%u4EA4%u5E76%u6BD4%u3002%u4EA4%u96C6%u548C%u5E76%u96C6%u7684%u6BD4%u4F8B%u3002%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1538001652894.png%29%0A%u84DD%u8272%u6846%u662F%u7B97%u6CD5%u9884%u6D4B%u51FA%u7684%u76EE%u6807%u4F4D%u7F6E%uFF0C%u7EA2%u8272%u6846%u662F%u5B9E%u9645%u76EE%u6807%u4F4D%u7F6E%u3002%u9EC4%u8272%u9634%u5F71%u662F%u4EA4%u96C6%uFF0C%u7EFF%u8272%u9634%u5F71%u662F%u5E76%u96C6%u3002%u90A3%u4E48%uFF1A%0A%24%24IOU%28%u4EA4%u5E76%u6BD4%29%20%3D%20%5Ccfrac%20%7B%u9EC4%u8272%u7684%u9762%u79EF%7D%7B%u7EFF%u8272%u7684%u9762%u79EF%7D%24%24%0A%u4EE5IOU%u7684%u5927%u5C0F%u6765%u5224%u65AD%uFF0C%u8FD9%u4E00%u6B21%u76EE%u6807%u68C0%u6D4B%u7684%u8D28%u91CF%u3002%u4F8B%u5982%uFF0C%u6211%u4EEC%u901A%u5E38%u8981%u6C42%u4EA4%u5E76%u6BD4%u8FBE%u52300.5%u62160.6%u4EE5%u4E0A%uFF0C%u624D%u7B97%u4E00%u6B21%u6709%u6548%u7684%u68C0%u6D4B%u3002%0A%0A%23%23%23%20Non-max%20Suppression%20Algorithm%0A%u7FFB%u8BD1%u6210%u975E%u6781%u5927%u503C%u6291%u5236%u3002%0A%u5F53%u6709%u5982%u4E0B%u7684%u68C0%u6D4B%u7ED3%u679C%u7684%u65F6%u5019%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1538002346979.png%29%0A%u7406%u8BBA%u4E0A%uFF0C%u4E00%u4E2A%u7269%u4F53%u53EA%u5C5E%u4E8E%u4E00%u4E2Abox%u3002%u4F46%u662F%uFF0C%u901A%u5E38%u5728%u9884%u6D4B%u7684%u65F6%u5019%uFF0C%u6BCF%u4E00%u4E2A%u7269%u4F53%u56DB%u5468%u7684box%u90FD%u6709%u53EF%u80FD%u4EA7%u751F%u6709%u6548%u9884%u6D4B%u3002Non-max%20suppression%u8981%u505A%u7684%u5C31%u662F%u8FC7%u6EE4%u6389%u8D28%u91CF%u8F83%u5DEE%u7684%u9884%u6D4B%uFF0C%u4E3A%u6BCF%u4E2A%u7269%u4F53%u53EA%u7559%u4E0B%u4E00%u4E2A%u6709%u6548%u9884%u6D4B%u3002%u5177%u4F53%u505A%u6CD5%u5982%u4E0B%0A%21%5BAlt%20text%7C400x0%5D%28./1538002565930.png%29%0A%u7ECF%u8FC7Non-max%20suppression%u8FC7%u6EE4%u540E%uFF0C%u6700%u7EC8%u7ED3%u679C%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1538002626027.png%29%0A%u6BCF%u4E2A%u7269%u4F53%u53EA%u4FDD%u7559%u4E00%u4E2A%u6709%u6548%u68C0%u6D4B%u3002%0A%0A%23%23%23%20Anchor%20Box%0AAnchor%20Box%u8981%u89E3%u51B3%u7684%u95EE%u9898%u5C31%u662F%u50CF%u4E0B%u9762%u8FD9%u5E45%u56FE%uFF0C%u6709%u4E24%u4E2A%u4E0D%u540C%u5F62%u72B6%u7684%u7269%u4F53%uFF0C%u5176%u4E2D%u5FC3%u70B9%u91CD%u53E0%u3002%u4E5F%u5C31%u662F%u4E00%u4E2Agrid%20box%u4E2D%u6709%u4E24%u4E2A%u7269%u4F53%uFF0C%u8FD9%u4E2A%u901A%u8FC7%u4E00%u822C%u7684y%20label%u662F%u6CA1%u6CD5%u53CD%u6620%u51FA%u6765%u7684%u3002%0A%21%5BAlt%20text%5D%28./1538002823587.png%29%0A%u901A%u5E38%u7684y%20label%u662F%uFF1A%0A%24%24y%20%3D%20%5Cbegin%7Bbmatrix%7D%20Pc%20%5C%5C%20b_x%20%5C%5C%20b_y%20%5C%5C%20b_h%20%5C%5C%20b_w%20%5C%5C%20c_1%20%5C%5C%20c_2%20%5C%5C%20c_3%20%5Cend%7Bbmatrix%7D%24%24%0A%u89E3%u51B3%u529E%u6CD5%u5C31%u662F%u8BBE%u7F6EAnchor%20Box%uFF0C%u8FD9%u6837%u7684%u56FE%u7247%u5C31%u8BBE%u7F6E%u4E24%u4E2AAnchor%20Box%u3002%u5F53%u5982%u679C%u6709%u66F4%u591A%u7684%u56FE%u7247%u4EA4%u53E0%u7684%u53EF%u80FD%u7684%u65F6%u5019%uFF0C%u90A3%u5C31%u8981%u8BBE%u7F6E%u591A%u4E2AAnchor%20Box%u3002y%u4FEE%u6B63%u6210%u4E3A%uFF1A%0A%24%24y%20%3D%20%5Cbegin%7Bbmatrix%7D%20Pc%20%5C%5C%20b_x%20%5C%5C%20b_y%20%5C%5C%20b_h%20%5C%5C%20b_w%20%5C%5C%20c_1%20%5C%5C%20c_2%20%5C%5C%20c_3%20%5C%5C%20Pc%20%5C%5C%20b_x%20%5C%5C%20b_y%20%5C%5C%20b_h%20%5C%5C%20b_w%20%5C%5C%20c_1%20%5C%5C%20c_2%20%5C%5C%20c_3%5Cend%7Bbmatrix%7D%24%24%0Ay%u4E0A%u534A%u90E8%u5206%u68C0%u6D4BAnchor%20Box%201%u7684%u7269%u4F53%uFF0C%u4E0B%u534A%u90E8%u5206%u68C0%u6D4BAnchor%20Box%202%u7684%u7269%u4F53%u3002%0A%0A%23%23%23%20YOLO%u7B97%u6CD5%0A%u5148%u5C06%u6837%u672C%u56FE%u7247%u5207%u5272%u6210%u7F51%u683C%uFF0C%u9488%u5BF9%u6BCF%u4E2A%u7F51%u683C%u586B%u5145%u6807%u7B7Ey%u3002%0A%21%5BAlt%20text%7C300x0%5D%28./1538003638979.png%29%0A-%20%u6BCF%u4E2A%u7F51%u683C%u7684%u5DE6%u4E0A%u70B9%u5750%u6807%u4E3A%280%2C0%29%uFF0C%u53F3%u4E0B%u89D2%u5750%u6807%u4E3A%281%2C1%29%u3002%u6240%u4EE5%24b_x%2C%20b_y%20%5Cin%20%280%2C1%29%24%uFF0C%24b_h%2C%20b_w%24%u662F%u771F%u5B9E%u7269%u4F53%u5C3A%u5BF8%u9488%u5BF9%u7F51%u683C%u7684%u6BD4%u4F8B%u3002%u6240%u4EE5%u4E0A%u56FE%u53F3%u8FB9%u8F66%u5B50%u7684bounding%20box%u7684%u957F%u5BBD%u53EF%u80FD%u662F0.4x0.9%uFF0C%u5DE6%u8FB9%u8F66%u5B50%u7684%u957F%u5BBD%u6BD4%u53EF%u80FD%u662F0.5x0.6%u3002%0A-%20%u5982%u679C%u6709%u76EE%u6807%u7269%u4F53%u5219%24P_c%20%3D%201%24%uFF0C%u5426%u5219%24P_c%20%3D%200%24%0A-%20%u5982%u679C%u6709%u53EF%u80FD%u6709%u56FE%u7247%u91CD%u53E0%u5728%u4E00%u4E2A%u683C%u5B50%u7684%u65F6%u5019%uFF0C%u9700%u8981%u8BBE%u7F6E%u5BF9%u5E94%u7684Anchor%20Box%0A%0A%u540E%u9762%u5C31%u662F%u7ECF%u5178%u7684CNN%u4E86%uFF0C%u6700%u7EC8%u5F97%u51FA%u5BF9y%u7684%u9884%u6D4B%24%5Chat%20y%24%0A%21%5BAlt%20text%7C600x0%5D%28./1538051571327.png%29%0A%u6700%u7EC8%u8F93%u51FA%u7684%u56FE%u50CF%uFF0C%u53EF%u80FD%u662F%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%7C300x0%5D%28./1538051783160.png%29%0A%u91C7%u7528non-max%20suppression%u6765%u8FC7%u6EE4%u51FA%u6700%u7EC8%u7684%u9884%u6D4B%u7ED3%u679C%u3002%0A%0A%0A%0A%23%23%20%u53C2%u8003%u6587%u732E%0AYOLO%3A%20Redmon%20et%20al.%2C%202015%2C%20You%20Only%20Look%20Once%3A%20Unified%20real-time%20object%20detection%0A%0A%0A%0A%0A]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (11) - Deep convolutional models]]></title>
    <url>%2F2018%2F09%2F20%2FDeep_Learning_(11)_-__Deep_convolutional_models%2F</url>
    <content type="text"><![CDATA[Edit&#x7EC8;&#x4E8E;&#x8BB2;&#x5230;&#x771F;&#x6B63;&#x7684;deep learning&#x4E86;&#xFF0C;&#x672C;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;&#x51E0;&#x4E2A;&#x7ECF;&#x5178;&#x7684;&#x6DF1;&#x5EA6;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x3002;&#x5305;&#x62EC;&#xFF1A;Classic Networks: LeNet-5AlexNetVGGResNetInception&#x7ECF;&#x5178;&#x7F51;&#x7EDC;&#x90FD;&#x662F;&#x6BD4;&#x8F83;&#x65E9;&#x671F;&#x7684;&#x8FD0;&#x7528;&#x5377;&#x79EF;&#x5C42;&#x642D;&#x5EFA;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;&#x5728;&#x5F53;&#x65F6;&#x53D6;&#x5F97;&#x4E86;&#x4E0D;&#x9519;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x4E5F;&#x63A8;&#x52A8;&#x4E86;&#x6DF1;&#x5EA6;&#x5B66;&#x4E60;&#x793E;&#x533A;&#x7684;&#x8FDB;&#x4E00;&#x6B65;&#x53D1;&#x5C55;&#x3002;&#x8FD9;&#x4E9B;&#x7F51;&#x7EDC;&#x7684;&#x6784;&#x6210;&#x4E5F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x642D;&#x5EFA;&#x6DF1;&#x5EA6;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x3002;ResNet&#x548C;Inception&#x5C31;&#x662F;&#x6700;&#x8FD1;&#x51E0;&#x5E74;&#x7684;&#x7814;&#x7A76;&#x6210;&#x679C;&#x4E86;&#x3002;&#x7531;&#x4E8E;&#x73B0;&#x5728;&#x6DF1;&#x5EA6;&#x5B66;&#x4E60;&#x7406;&#x8BBA;&#x548C;&#x8BA1;&#x7B97;&#x673A;&#x7B97;&#x529B;&#x7684;&#x8FDB;&#x4E00;&#x6B65;&#x53D1;&#x5C55;&#xFF0C;&#x8FD9;&#x4E9B;&#x7F51;&#x7EDC;&#x7684;&#x7ED3;&#x6784;&#x5DF2;&#x7ECF;&#x8FDC;&#x6BD4;&#x7ECF;&#x5178;&#x7F51;&#x7EDC;&#x8981;&#x590D;&#x6742;&#x7684;&#x591A;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B66;&#x4E60;&#x4E86;&#x89E3;&#xFF0C;&#x5E76;&#x5728;&#x771F;&#x6B63;&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x53BB;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x5DF2;&#x6709;&#x7684;&#x7F51;&#x7EDC;&#x3002; &#x6240;&#x6709;&#x7684;&#x7F51;&#x7EDC;&#x90FD;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x8BBA;&#x6587;&#x4ECB;&#x7ECD;&#xFF0C;&#x6211;&#x5C06;&#x5176;&#x5217;&#x5165;&#x53C2;&#x8003;&#x6587;&#x732E;&#x4E00;&#x8282;&#x3002;&#x7ECF;&#x5178;&#x7F51;&#x7EDC;&#x8FD9;&#x4E9B;&#x7ECF;&#x5178;&#x7F51;&#x7EDC;&#x57FA;&#x672C;&#x90FD;&#x57FA;&#x4E8E;&#x7ECF;&#x5178;&#x7684;&#x5377;&#x79EF;&#x7F51;&#x7EDC;(LeNet)&#xFF0C;&#x53EA;&#x662F;&#x7F51;&#x7EDC;&#x7684;&#x5C3A;&#x5BF8;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#xFF0C;&#x53C2;&#x6570;&#x8D8A;&#x6765;&#x8D8A;&#x591A;LeNet-5&#x4E0A;&#x4E00;&#x7AE0;&#x8BB2;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x65F6;&#x5C31;&#x4EE5;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x4E3A;&#x4F8B;&#x5B50;&#x7684;&#x3002;&#x5176;&#x57FA;&#x672C;&#x6784;&#x6210;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;&#x4E24;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x540E;&#x6709;&#x4E00;&#x4E2A;average pooling&#x5C42;&#x6700;&#x540E;&#x4E24;&#x4E2A;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5C42;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#x5728;&#x8F93;&#x51FA;&#x524D;&#x53EF;&#x4EE5;&#x7528;Softmax&#x5C42;&#x6765;&#x505A;&#x591A;&#x5206;&#x7C7B;&#x8BE5;&#x7F51;&#x7EDC;&#x5927;&#x7EA6;&#x6709;60K&#x4E2A;&#x53C2;&#x6570;&#x56E0;&#x4E3A;&#x662F;&#x65E9;&#x671F;&#x7F51;&#x7EDC;&#xFF0C;&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x662F;&#x5F88;&#x6DF1;&#xFF0C;&#x5377;&#x79EF;&#x5C42;&#x6CA1;&#x6709;&#x4F7F;&#x7528;padding&#xFF0C;&#x6240;&#x4EE5;&#x56FE;&#x50CF;&#x5C3A;&#x5BF8;&#x8D8A;&#x6765;&#x8D8A;&#x5C0F;&#xFF0C;&#x91C7;&#x7528;average pooling&#xFF0C;&#x8FD9;&#x5728;&#x540E;&#x671F;&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x592A;&#x5E38;&#x89C1;&#x3002; &#x4E0D;&#x8FC7;&#x4E0D;&#x7BA1;&#x600E;&#x4E48;&#x6837;&#xFF0C;&#x8FD9;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x7ECF;&#x5178;&#x7684;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;AlexNet&#x5176;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A; &#x7F51;&#x7EDC;&#x6784;&#x6210;&#x57FA;&#x672C;&#x4E0E;LeNet&#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x4E0E;LeNet&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x91C7;&#x7528;&#x4E86;max pooling&#xFF0C;&#x91C7;&#x7528;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#xFF0C;&#x6DFB;&#x52A0;&#x4E86;Softmax&#x8F93;&#x51FA;&#x5C42;&#xFF0C;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x4F7F;&#x7528;&#x4E86;padding&#x3002;&#x53C2;&#x6570;&#x7684;&#x6570;&#x91CF;&#x5927;&#x7EA6;&#x5728;60M&#xFF0C;&#x662F;LeNet&#x7684;1000&#x500D;&#x3002;&#x4EA7;&#x751F;&#x8FD9;&#x7BC7;&#x8BBA;&#x6587;&#x65F6;&#xFF0C;GPU&#x6280;&#x672F;&#x8FD8;&#x4E0D;&#x662F;&#x5F88;&#x53D1;&#x8FBE;&#xFF0C;&#x8BBA;&#x6587;&#x82B1;&#x4E86;&#x5F88;&#x591A;&#x7BC7;&#x5E45;&#x8BB2;&#x8FF0;&#x5982;&#x4F55;&#x5C06;&#x6539;&#x7F51;&#x7EDC;&#x62C6;&#x5206;&#x5230;&#x4E0D;&#x540C;&#x7684;GPU&#x4E0A;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#x3002;&#x4F46;&#x8FD9;&#x4E2A;&#x5BF9;&#x73B0;&#x5728;&#x7684;GPU&#x6280;&#x672F;&#x6765;&#x8BF4;&#x5DF2;&#x7ECF;&#x4E0D;&#x91CD;&#x8981;&#x4E86;&#x3002; &#x6587;&#x4E2D;&#x8FD8;&#x63D0;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x53EB;Local Response Normalization&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7406;&#x89E3;&#x3002;VGG - 16&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A; &#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x53D8;&#x7684;&#x66F4;&#x590D;&#x6742;&#x4E86;&#xFF0C;&#x53C2;&#x6570;&#x6570;&#x91CF;&#x8FBE;&#x5230;&#x4E86;138MResNet&#x4E2D;&#x6587;&#x8BD1;&#x4F5C;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x7279;&#x70B9;&#x662F;&#x5728;&#x7ECF;&#x5178;&#x7F51;&#x7EDC;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x52A0;&#x5165;&#x5F88;&#x591A;&#x5982;&#x4E0B;&#x56FE;&#x7684;residual block&#xFF1A; &lt;&#x2014;&#x2014;- &#x8FD9;&#x91CC;&#x7684;&#x5C31;&#x662F;&#x6B8B;&#x5DEE; &#x6574;&#x4E2A;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5927;&#x81F4;&#x5982;&#x4E0B;&#xFF1A; &#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x5C31;&#x7531;5&#x4E2A;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#x7EC4;&#x6210;&#x3002; &#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#x7684;&#x5F15;&#x5165;&#x662F;&#x4E3A;&#x4E86;&#x6539;&#x5584;&#xFF0C;&#x5F53;&#x7ECF;&#x5178;&#x7F51;&#x7EDC;(&#x6216;&#x8005;&#x8FD9;&#x7BC7;&#x8BBA;&#x6587;&#x4E2D;&#x63D0;&#x5230;&#x7684;plain network&#xFF0C;&#x5373;&#x6CA1;&#x6709;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#x7684;&#x7F51;&#x7EDC;)&#x6DF1;&#x5EA6;&#x5F88;&#x5927;&#x65F6;&#x7684;vulnerability&#xFF0C;&#x5373;&#x68AF;&#x5EA6;&#x7206;&#x70B8;&#x548C;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x5E26;&#x6765;&#x7684;&#x95EE;&#x9898;&#x3002; &#x7406;&#x8BBA;&#x4E0A;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7684;&#x7F51;&#x7EDC;&#x89C4;&#x6A21;&#x8D8A;&#x5927;&#xFF0C;&#x6DF1;&#x5EA6;&#x8D8A;&#x5927;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7CBE;&#x5EA6;&#x5E94;&#x8BE5;&#x8D8A;&#x6765;&#x8D8A;&#x9AD8;&#x3002;&#x4F46;&#x56E0;&#x4E3A;&#x521D;&#x59CB;&#x503C;&#x53D6;&#x503C;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6216;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x968F;&#x673A;&#x8BEF;&#x5DEE;&#x7684;&#x5F15;&#x5165;&#xFF0C;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x5728;&#x7F51;&#x7EDC;&#x5C42;&#x6570;&#x8FC7;&#x591A;&#x65F6;&#x4F1A;&#x5BFC;&#x81F4;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x6216;&#x7206;&#x70B8;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5B9E;&#x9645;&#x6548;&#x679C;&#x8FBE;&#x4E0D;&#x5230;&#x7406;&#x8BBA;&#x6548;&#x679C;&#x3002; &#x5728;&#x5F15;&#x5165;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#x89E3;&#x51B3;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x6216;&#x7206;&#x70B8;&#x540E;&#xFF0C;&#x5F80;&#x5F80;&#x80FD;&#x5F97;&#x5230;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x6548;&#x679C;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#x6709;&#x7528;&#xFF1F;(&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x6211;&#x4E5F;&#x4E0D;&#x592A;&#x7406;&#x89E3;&#xFF0C;&#x5148;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;) &#x5BF9;&#x4E8E;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5927;&#x578B;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x540E;&#x9762;&#x63A5;&#x4E00;&#x4E2A;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#x540E;&#xFF0C;&#x6709;&#xFF1A; &#x5982;&#x679C;&#x6709;weight decay(L2 regularization)&#xFF0C;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#xFF0C;&#x5982;&#x679C;&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#x65F6;ReLU&#xFF0C;&#x5219;&#xFF0C;&#x53EF;&#x89C1;&#x65B0;&#x589E;&#x52A0;&#x7684;&#x4E24;&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5E76;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x6574;&#x4F53;&#x7F51;&#x7EDC;&#x7684;performance&#x3002;&#x6240;&#x4EE5;&#x5F97;&#x8BC1;&#xFF0C;&#x7F51;&#x7EDC;&#x6DF1;&#x5EA6;&#x7684;&#x7D2F;&#x79EF;&#x5BF9;&#x6B8B;&#x5DEE;&#x7F51;&#x7EDC;&#x7684;&#x5F71;&#x54CD;&#x8F83;&#x5C0F;&#x3002;InceptionNetwork in network (1x1 convolution) &#x8FD9;&#x91CC;&#x662F;&#x4E00;&#x4E2A;filter&#x7684;&#x56FE;&#x4F8B;&#x3002;&#x4E0E;&#x5176;&#x4ED6;&#x7684;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x4EC5;&#x662F;&#xFF0C;&#x800C;&#x662F;&#xFF0C;&#x5747;&#x662F;&#x5411;&#x91CF;&#x3002;&#x5982;&#x679C;filter&#x6709;&#x5F88;&#x591A;&#x4E2A;&#xFF0C;&#x5219;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x5C0F;&#x578B;2&#x5C42;(1&#x4E2A;&#x9690;&#x85CF;&#x5C42;)&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;&#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x7F51;&#x7EDC;&#x3002; &#x4F7F;&#x7528;1x1 convolution&#x6216;&#x8005;network in network&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x53EF;&#x4EE5;&#x7F29;&#x51CF;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x901A;&#x9053;&#x6570;&#x3002;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x51CF;&#x5C11;&#x8FD0;&#x7B97;&#x91CF;&#x7684;&#x6548;&#x679C;&#x3002;&#x8FD0;&#x7528;Network in network&#x6765;&#x964D;&#x4F4E;&#x8FD0;&#x7B97;&#x91CF; &#x8FD9;&#x6837;&#x4E00;&#x6B21;&#x6620;&#x5C04;&#x7684;&#x8FD0;&#x7B97;&#x91CF;&#x662F;28x28x192x5x5x32 = 120M &#x901A;&#x8FC7;&#x4E00;&#x4E2A;1x1convolution&#x505A;&#x8FC7;&#x5EA6;&#x7684;&#x8BA1;&#x7B97;&#x91CF;&#x662F;28x28x192x1x1x16 + 28x28x16x5x5x32 = 12.4M &#x7F29;&#x5C0F;&#x5230;&#x63A5;&#x8FD1;1/10&#xFF0C;&#x76F8;&#x5F53;&#x53EF;&#x89C2;&#x4E86;&#x3002;&#x800C;&#x4E14;&#x56E0;&#x4E3A;network in network&#x7684;&#x5F15;&#x5165;&#xFF0C;&#x867D;&#x7136;&#x901A;&#x9053;&#x6570;&#x7F29;&#x51CF;&#x4E86;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x6700;&#x7EC8;&#x6A21;&#x578B;&#x7684;performance&#x3002; &#x4E2D;&#x95F4;&#x7684;1x1 convolution&#x53C8;&#x79F0;&#x4E3A;&#x8BE5;&#x7F51;&#x7EDC;&#x7684;bottle neck&#xFF0C;&#x5F88;&#x5F62;&#x8C61;&#x7684;&#x6BD4;&#x55BB;Inception (GoogLeNet) &#x8FD9;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;Inception&#x7F51;&#x7EDC;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x5982;&#x4E0B;&#x7684;Inception Module&#xFF1A; &#x5E26;branch&#x7684;Inception&#x7F51;&#x7EDC; &#x6BCF;&#x4E2A;&#x5206;&#x652F;&#x90FD;&#x6709;&#x4E00;&#x4E2A;Softmax&#x8F93;&#x51FA;&#x5C42;&#x3002;&#x8FD9;&#x4E9B;&#x5206;&#x652F;&#x4E5F;&#x80FD;&#x8F93;&#x51FA;&#x9884;&#x6D4B;&#x503C;&#xFF0C;&#x8FD9;&#x6837;&#x786E;&#x4FDD;&#x7F51;&#x7EDC;&#x7684;&#x6240;&#x6709;&#x9690;&#x85CF;&#x5355;&#x5143;&#x548C;&#x4E2D;&#x95F4;&#x5C42;&#x90FD;&#x53C2;&#x4E0E;&#x4E86;&#x7279;&#x5F81;&#x8BA1;&#x7B97;&#x3002;&#x6309;&#x7167;Andrew&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E9B;&#x5206;&#x652F;&#x53EF;&#x4EE5;&#x8D77;&#x5230;regularization&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x964D;&#x4F4E;&#x7F51;&#x7EDC;&#x8FC7;&#x62DF;&#x5408;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x3002;&#x53C2;&#x8003;&#x6587;&#x732E;LeNet-5: LeCun et al., 1998. Gradient-based learning applied to document recognitionAlexNet: Krizhevsky et al., 2012. ImageNet classification with deep convolutional nerual networksVGG-16: Simonyan &amp; Zisserman 2015. Very deep convolutional networks for large-scale image recognitionResNet: He et al., 2015. Deep residual networks for image recognitionNetwork in network: Lin. et al., 2013. Network in networkInception: Szegedy et al., 2014, Going Deeper with Convolutions%23%20Deep%20Learning%20%2811%29%20-%20%20Deep%20convolutional%20models%0A@%28myblog%29%5Bmachine%20learning%2C%20deep%20learning%5D%0A%0A%u7EC8%u4E8E%u8BB2%u5230%u771F%u6B63%u7684deep%20learning%u4E86%uFF0C%u672C%u7AE0%u4E3B%u8981%u4ECB%u7ECD%u4E86%u51E0%u4E2A%u7ECF%u5178%u7684%u6DF1%u5EA6%u5377%u79EF%u7F51%u7EDC%u3002%u5305%u62EC%uFF1A%0A-%20Classic%20Networks%3A%0A%09-%20LeNet-5%0A%09-%20AlexNet%0A%09-%20VGG%0A-%20ResNet%0A-%20Inception%0A%0A%u7ECF%u5178%u7F51%u7EDC%u90FD%u662F%u6BD4%u8F83%u65E9%u671F%u7684%u8FD0%u7528%u5377%u79EF%u5C42%u642D%u5EFA%u7684%u795E%u7ECF%u7F51%u7EDC%uFF0C%u5728%u5F53%u65F6%u53D6%u5F97%u4E86%u4E0D%u9519%u7684%u6548%u679C%uFF0C%u4E5F%u63A8%u52A8%u4E86%u6DF1%u5EA6%u5B66%u4E60%u793E%u533A%u7684%u8FDB%u4E00%u6B65%u53D1%u5C55%u3002%u8FD9%u4E9B%u7F51%u7EDC%u7684%u6784%u6210%u4E5F%u53EF%u4EE5%u5E2E%u52A9%u6211%u4EEC%u5B66%u4E60%u5982%u4F55%u642D%u5EFA%u6DF1%u5EA6%u5377%u79EF%u7F51%u7EDC%u3002ResNet%u548CInception%u5C31%u662F%u6700%u8FD1%u51E0%u5E74%u7684%u7814%u7A76%u6210%u679C%u4E86%u3002%u7531%u4E8E%u73B0%u5728%u6DF1%u5EA6%u5B66%u4E60%u7406%u8BBA%u548C%u8BA1%u7B97%u673A%u7B97%u529B%u7684%u8FDB%u4E00%u6B65%u53D1%u5C55%uFF0C%u8FD9%u4E9B%u7F51%u7EDC%u7684%u7ED3%u6784%u5DF2%u7ECF%u8FDC%u6BD4%u7ECF%u5178%u7F51%u7EDC%u8981%u590D%u6742%u7684%u591A%u3002%u6211%u4EEC%u53EF%u4EE5%u901A%u8FC7%u5B66%u4E60%u4E86%u89E3%uFF0C%u5E76%u5728%u771F%u6B63%u7684%u751F%u4EA7%u73AF%u5883%u4E2D%u53BB%u5C1D%u8BD5%u4F7F%u7528%u8FD9%u4E9B%u5DF2%u6709%u7684%u7F51%u7EDC%u3002%0A%u6240%u6709%u7684%u7F51%u7EDC%u90FD%u6709%u5BF9%u5E94%u7684%u8BBA%u6587%u4ECB%u7ECD%uFF0C%u6211%u5C06%u5176%u5217%u5165%u53C2%u8003%u6587%u732E%u4E00%u8282%u3002%0A%23%23%20%u7ECF%u5178%u7F51%u7EDC%0A%u8FD9%u4E9B%u7ECF%u5178%u7F51%u7EDC%u57FA%u672C%u90FD%u57FA%u4E8E%u7ECF%u5178%u7684%u5377%u79EF%u7F51%u7EDC%28LeNet%29%uFF0C%u53EA%u662F%u7F51%u7EDC%u7684%u5C3A%u5BF8%u8D8A%u6765%u8D8A%u5927%uFF0C%u53C2%u6570%u8D8A%u6765%u8D8A%u591A%0A%23%23%23%20LeNet-5%0A%u4E0A%u4E00%u7AE0%u8BB2%u5377%u79EF%u7F51%u7EDC%u65F6%u5C31%u4EE5%u8FD9%u4E2A%u7F51%u7EDC%u4E3A%u4F8B%u5B50%u7684%u3002%u5176%u57FA%u672C%u6784%u6210%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1537397452563.png%29%0A-%20%u4E24%u4E2A%u5377%u79EF%u5C42%uFF0C%u6BCF%u4E00%u4E2A%u5377%u79EF%u5C42%u540E%u6709%u4E00%u4E2Aaverage%20pooling%u5C42%0A-%20%u6700%u540E%u4E24%u4E2A%u795E%u7ECF%u7F51%u7EDC%u5C42%u76F4%u63A5%u8F93%u51FA%0A-%20%u5728%u8F93%u51FA%u524D%u53EF%u4EE5%u7528Softmax%u5C42%u6765%u505A%u591A%u5206%u7C7B%0A-%20%u8BE5%u7F51%u7EDC%u5927%u7EA6%u670960K%u4E2A%u53C2%u6570%0A%0A%u56E0%u4E3A%u662F%u65E9%u671F%u7F51%u7EDC%uFF0C%u6240%u4EE5%u5E76%u4E0D%u662F%u5F88%u6DF1%uFF0C%u5377%u79EF%u5C42%u6CA1%u6709%u4F7F%u7528padding%uFF0C%u6240%u4EE5%u56FE%u50CF%u5C3A%u5BF8%u8D8A%u6765%u8D8A%u5C0F%uFF0C%u91C7%u7528average%20pooling%uFF0C%u8FD9%u5728%u540E%u671F%u7684%u7F51%u7EDC%u4E0D%u592A%u5E38%u89C1%u3002%0A%u4E0D%u8FC7%u4E0D%u7BA1%u600E%u4E48%u6837%uFF0C%u8FD9%u90FD%u662F%u4E00%u4E2A%u5F88%u7ECF%u5178%u7684%u5377%u79EF%u795E%u7ECF%u7F51%u7EDC%u3002%0A%0A%23%23%23%20AlexNet%0A%u5176%u7F51%u7EDC%u7ED3%u6784%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1537397767249.png%29%0A%u7F51%u7EDC%u6784%u6210%u57FA%u672C%u4E0ELeNet%u5DEE%u4E0D%u591A%u3002%u4E0ELeNet%u4E0D%u540C%u7684%u662F%uFF0C%u8FD9%u91CC%u91C7%u7528%u4E86max%20pooling%uFF0C%u91C7%u7528%u4E86%u66F4%u591A%u7684%u795E%u7ECF%u7F51%u7EDC%u8FDE%u63A5%uFF0C%u6DFB%u52A0%u4E86Softmax%u8F93%u51FA%u5C42%uFF0C%u4E00%u5B9A%u7A0B%u5EA6%u4E0A%u4F7F%u7528%u4E86padding%u3002%u53C2%u6570%u7684%u6570%u91CF%u5927%u7EA6%u572860M%uFF0C%u662FLeNet%u76841000%u500D%u3002%0A%3E%20%u4EA7%u751F%u8FD9%u7BC7%u8BBA%u6587%u65F6%uFF0CGPU%u6280%u672F%u8FD8%u4E0D%u662F%u5F88%u53D1%u8FBE%uFF0C%u8BBA%u6587%u82B1%u4E86%u5F88%u591A%u7BC7%u5E45%u8BB2%u8FF0%u5982%u4F55%u5C06%u6539%u7F51%u7EDC%u62C6%u5206%u5230%u4E0D%u540C%u7684GPU%u4E0A%u8FDB%u884C%u8BA1%u7B97%u3002%u4F46%u8FD9%u4E2A%u5BF9%u73B0%u5728%u7684GPU%u6280%u672F%u6765%u8BF4%u5DF2%u7ECF%u4E0D%u91CD%u8981%u4E86%u3002%0A%3E%20%u6587%u4E2D%u8FD8%u63D0%u5230%u4E86%u4E00%u4E2A%u6982%u5FF5%u53EBLocal%20Response%20Normalization%uFF0C%u8FD9%u4E5F%u662F%u4E0D%u5E38%u7528%u7684%u6982%u5FF5%uFF0C%u4E0D%u9700%u8981%u7406%u89E3%u3002%0A%23%23%23%20VGG%20-%2016%0A%u7F51%u7EDC%u7ED3%u6784%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1537398631763.png%29%0A%u7F51%u7EDC%u7ED3%u6784%u53D8%u7684%u66F4%u590D%u6742%u4E86%uFF0C%u53C2%u6570%u6570%u91CF%u8FBE%u5230%u4E86138M%0A%0A%23%23%20ResNet%0A%u4E2D%u6587%u8BD1%u4F5C%u6B8B%u5DEE%u7F51%u7EDC%uFF0C%u56E0%u4E3A%u5176%u7279%u70B9%u662F%u5728%u7ECF%u5178%u7F51%u7EDC%u7684%u57FA%u7840%u4E0A%u52A0%u5165%u5F88%u591A%u5982%u4E0B%u56FE%u7684residual%20block%uFF1A%0A%21%5BAlt%20text%7C300x0%5D%28./1537480856087.png%29%0A%24z%5E%7B%5Bl+1%5D%7D%20%3D%20W%5E%7B%5Bl+1%5D%7Da%5E%7B%5Bl%5D%7D%20+%20b%5E%7B%5Bl+1%5D%7D%24%0A%24a%5E%7B%5Bl+1%5D%7D%20%3D%20g%28z%5E%7B%5Bl+1%5D%7D%29%24%0A%24z%5E%7B%5Bl+2%5D%7D%20%3D%20W%5E%7B%5Bl+2%5D%7Da%5E%7B%5Bl+1%5D%7D%20+%20b%5E%7B%5Bl+2%5D%7D%20+%20a%5E%7B%5Bl%5D%7D%24%20%3C-------%20%u8FD9%u91CC%u7684%24a%5E%7B%5Bl%5D%7D%24%u5C31%u662F%u6B8B%u5DEE%0A%24a%5E%7B%5Bl+2%5D%7D%20%3D%20g%28z%5E%7B%5Bl+2%5D%7D%29%24%0A%0A%u6574%u4E2A%u7F51%u7EDC%u7ED3%u6784%u5927%u81F4%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%5D%28./1537481112346.png%29%0A%u8FD9%u6837%u4E00%u4E2A%u7F51%u7EDC%u5C31%u75315%u4E2A%u6B8B%u5DEE%u6A21%u5757%u7EC4%u6210%u3002%0A%u6B8B%u5DEE%u6A21%u5757%u7684%u5F15%u5165%u662F%u4E3A%u4E86%u6539%u5584%uFF0C%u5F53%u7ECF%u5178%u7F51%u7EDC%28%u6216%u8005%u8FD9%u7BC7%u8BBA%u6587%u4E2D%u63D0%u5230%u7684plain%20network%uFF0C%u5373%u6CA1%u6709%u6B8B%u5DEE%u6A21%u5757%u7684%u7F51%u7EDC%29%u6DF1%u5EA6%u5F88%u5927%u65F6%u7684vulnerability%uFF0C%u5373%u68AF%u5EA6%u7206%u70B8%u548C%u68AF%u5EA6%u6D88%u5931%u5E26%u6765%u7684%u95EE%u9898%u3002%0A%21%5BAlt%20text%5D%28./1537481278978.png%29%0A%u7406%u8BBA%u4E0A%u673A%u5668%u5B66%u4E60%u7684%u7F51%u7EDC%u89C4%u6A21%u8D8A%u5927%uFF0C%u6DF1%u5EA6%u8D8A%u5927%u7684%u65F6%u5019%uFF0C%u7CBE%u5EA6%u5E94%u8BE5%u8D8A%u6765%u8D8A%u9AD8%u3002%u4F46%u56E0%u4E3A%u521D%u59CB%u503C%u53D6%u503C%u7684%u95EE%u9898%uFF0C%u6216%u5176%u4ED6%u4EFB%u4F55%u968F%u673A%u8BEF%u5DEE%u7684%u5F15%u5165%uFF0C%u90FD%u6709%u53EF%u80FD%u5728%u7F51%u7EDC%u5C42%u6570%u8FC7%u591A%u65F6%u4F1A%u5BFC%u81F4%u68AF%u5EA6%u6D88%u5931%u6216%u7206%u70B8%uFF0C%u4ECE%u800C%u5BFC%u81F4%u5B9E%u9645%u6548%u679C%u8FBE%u4E0D%u5230%u7406%u8BBA%u6548%u679C%u3002%0A%u5728%u5F15%u5165%u6B8B%u5DEE%u7F51%u7EDC%u89E3%u51B3%u68AF%u5EA6%u6D88%u5931%u6216%u7206%u70B8%u540E%uFF0C%u5F80%u5F80%u80FD%u5F97%u5230%u6BD4%u8F83%u597D%u7684%u6548%u679C%uFF1A%0A%21%5BAlt%20text%5D%28./1537481430062.png%29%0A%0A%3E%u4E3A%u4EC0%u4E48%u6B8B%u5DEE%u7F51%u7EDC%u6709%u7528%uFF1F%28**%u6CE8%uFF1A**%u8FD9%u91CC%u6211%u4E5F%u4E0D%u592A%u7406%u89E3%uFF0C%u5148%u8BB0%u5F55%u4E0B%u6765%29%0A%3E%21%5BAlt%20text%7C500x0%5D%28./1537483365846.png%29%0A%3E%u5BF9%u4E8E%u8FD9%u6837%u4E00%u4E2A%u5927%u578B%u795E%u7ECF%u7F51%u7EDC%u540E%u9762%u63A5%u4E00%u4E2A%u6B8B%u5DEE%u6A21%u5757%u540E%uFF0C%u6709%uFF1A%0A%24a%5E%7B%5Bl+2%5D%7D%20%3D%20g%28W%5E%7B%5Bl+2%5D%7Da%5E%7B%5Bl+1%5D%7D%20+%20b%5E%7B%5Bl+2%5D%7D%20+%20a%5E%7B%5Bl%5D%7D%29%24%0A%u5982%u679C%u6709weight%20decay%28L2%20regularization%29%uFF0C%24W%5Crightarrow0%2C%20b%5Crightarrow%200%24%uFF0C%u5982%u679C%u5F53%24W%20%3D%200%2C%20b%20%3D%200%24%u7684%u65F6%u5019%uFF0C%24a%5E%7B%5Bl+2%5D%7D%20%3D%20g%28a%5E%7B%5Bl%5D%7D%29%24%uFF0C%u5982%u679C%u6FC0%u6D3B%u51FD%u6570%u65F6ReLU%uFF0C%u5219%24a%5E%7B%5Bl+2%5D%7D%20%3D%20a%5E%7B%5Bl%5D%7D%24%uFF0C%u53EF%u89C1%u65B0%u589E%u52A0%u7684%u4E24%u5C42%u795E%u7ECF%u7F51%u7EDC%u5E76%u4E0D%u4F1A%u5F71%u54CD%u6574%u4F53%u7F51%u7EDC%u7684performance%u3002%u6240%u4EE5%u5F97%u8BC1%uFF0C%u7F51%u7EDC%u6DF1%u5EA6%u7684%u7D2F%u79EF%u5BF9%u6B8B%u5DEE%u7F51%u7EDC%u7684%u5F71%u54CD%u8F83%u5C0F%u3002%0A%0A%0A%23%23%20Inception%0A%23%23%23%20Network%20in%20network%20%281x1%20convolution%29%0A%21%5BAlt%20text%5D%28./1537484677052.png%29%0A%u8FD9%u91CC%u662F%u4E00%u4E2Afilter%u7684%u56FE%u4F8B%u3002%u4E0E%u5176%u4ED6%u7684%u5377%u79EF%u7F51%u7EDC%u4E0D%u540C%u7684%u662F%uFF0C%u8FD9%u91CC%u4E0D%u4EC5%u662F%24%286%5Ctimes6%5Ctimes32%29%20%5Cast%20%281%5Ctimes1%5Ctimes32%29%24%uFF0C%u800C%u662F%24a_%7Bi%2Cj%7D%5E%7B%5Bl+1%5D%7D%20%3D%20g%28W%5E%7B%5Bl+1%5D%7Da_%7Bi%2Cj%7D%5E%7B%5Bl%5D%7D%20+%20b%5E%7B%5Bl+1%5D%7D%29%24%uFF0C%24a_%7Bi%2Cj%7D%5E%7B%5Bl+1%5D%7D%2C%20a_%7Bi%2Cj%7D%5E%7B%5Bl%5D%7D%24%u5747%u662F%24%201%5Ctimes32%24%u5411%u91CF%u3002%u5982%u679Cfilter%u6709%u5F88%u591A%u4E2A%uFF0C%u5219%u76F8%u5F53%u4E8E%u4E00%u4E2A%u5C0F%u578B2%u5C42%281%u4E2A%u9690%u85CF%u5C42%29%u7684%u795E%u7ECF%u7F51%u7EDC%u3002%u8FD9%u5C31%u662F%u6240%u8C13%u7684%u7F51%u7EDC%u4E2D%u7684%u7F51%u7EDC%u3002%0A%u4F7F%u75281x1%20convolution%u6216%u8005network%20in%20network%u7684%u597D%u5904%u662F%uFF0C%u53EF%u4EE5%u7F29%u51CF%u8F93%u5165%u56FE%u50CF%u7684%u901A%u9053%u6570%u3002%u4ECE%u800C%u8FBE%u5230%u51CF%u5C11%u8FD0%u7B97%u91CF%u7684%u6548%u679C%u3002%0A%0A%23%23%23%20%u8FD0%u7528Network%20in%20network%u6765%u964D%u4F4E%u8FD0%u7B97%u91CF%0A%21%5BAlt%20text%7C400x0%5D%28./1537485731408.png%29%0A%u8FD9%u6837%u4E00%u6B21%u6620%u5C04%u7684%u8FD0%u7B97%u91CF%u662F28x28x192x5x5x32%20%3D%20120M%0A%21%5BAlt%20text%7C600x0%5D%28./1537485831290.png%29%0A%u901A%u8FC7%u4E00%u4E2A1x1convolution%u505A%u8FC7%u5EA6%u7684%u8BA1%u7B97%u91CF%u662F28x28x192x1x1x16%20+%2028x28x16x5x5x32%20%3D%2012.4M%0A%u7F29%u5C0F%u5230%u63A5%u8FD11/10%uFF0C%u76F8%u5F53%u53EF%u89C2%u4E86%u3002%u800C%u4E14%u56E0%u4E3Anetwork%20in%20network%u7684%u5F15%u5165%uFF0C%u867D%u7136%u901A%u9053%u6570%u7F29%u51CF%u4E86%uFF0C%u4F46%u5E76%u4E0D%u4F1A%u5F71%u54CD%u6700%u7EC8%u6A21%u578B%u7684performance%u3002%0A%u4E2D%u95F4%u76841x1%20convolution%u53C8%u79F0%u4E3A%u8BE5%u7F51%u7EDC%u7684bottle%20neck%uFF0C%u5F88%u5F62%u8C61%u7684%u6BD4%u55BB%0A%21%5BAlt%20text%7C350x0%5D%28./1537486081451.png%29%0A%0A%23%23%23%20Inception%20%28GoogLeNet%29%0A%21%5BAlt%20text%5D%28./1537493512332.png%29%0A%u8FD9%u5C31%u662F%u4E00%u4E2A%u5B8C%u6574%u7684Inception%u7F51%u7EDC%uFF0C%u91CC%u9762%u5305%u542B%u4E86%u5F88%u591A%u5982%u4E0B%u7684Inception%20Module%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1537494165060.png%29%0A%u5E26branch%u7684Inception%u7F51%u7EDC%0A%21%5BAlt%20text%5D%28./1537495522238.png%29%0A%u6BCF%u4E2A%u5206%u652F%u90FD%u6709%u4E00%u4E2ASoftmax%u8F93%u51FA%u5C42%u3002%u8FD9%u4E9B%u5206%u652F%u4E5F%u80FD%u8F93%u51FA%u9884%u6D4B%u503C%uFF0C%u8FD9%u6837%u786E%u4FDD%u7F51%u7EDC%u7684%u6240%u6709%u9690%u85CF%u5355%u5143%u548C%u4E2D%u95F4%u5C42%u90FD%u53C2%u4E0E%u4E86%u7279%u5F81%u8BA1%u7B97%u3002%u6309%u7167Andrew%u7684%u8BF4%u6CD5%uFF0C%u8FD9%u4E9B%u5206%u652F%u53EF%u4EE5%u8D77%u5230regularization%u7684%u4F5C%u7528%uFF0C%u53EF%u4EE5%u6709%u6548%u964D%u4F4E%u7F51%u7EDC%u8FC7%u62DF%u5408%u7684%u53EF%u80FD%u6027%u3002%0A%0A%0A%23%23%20%u53C2%u8003%u6587%u732E%0A-%20LeNet-5%3A%20LeCun%20et%20al.%2C%201998.%20Gradient-based%20learning%20applied%20to%20document%20recognition%0A-%20AlexNet%3A%20Krizhevsky%20et%20al.%2C%202012.%20ImageNet%20classification%20with%20deep%20convolutional%20nerual%20networks%0A-%20VGG-16%3A%20Simonyan%20%26%20Zisserman%202015.%20Very%20deep%20convolutional%20networks%20for%20large-scale%20image%20recognition%0A-%20ResNet%3A%20He%20et%20al.%2C%202015.%20Deep%20residual%20networks%20for%20image%20recognition%0A-%20Network%20in%20network%3A%20Lin.%20et%20al.%2C%202013.%20Network%20in%20network%0A-%20Inception%3A%20Szegedy%20et%20al.%2C%202014%2C%20Going%20Deeper%20with%20Convolutions]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (10) - Convolutional Neural Network]]></title>
    <url>%2F2018%2F09%2F17%2FDeep_Learning_(10)_-__Convolutional_Neural_Network%2F</url>
    <content type="text"><![CDATA[Edit&#x7EC8;&#x4E8E;&#x5230;CNN&#x4E86;&#xFF0C;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x52A0;&#x5165;&#x4E86;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5C31;&#x662F;&#x4E00;&#x4E2A;CNN&#x3002;&#x5377;&#x79EF;&#x7684;&#x5B9A;&#x4E49;&#x5377;&#x79EF;&#x7684;&#x6570;&#x5B66;&#x5B9A;&#x4E49;&#x5728;wiki page&#x4E0A;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x3002;&#x5927;&#x81F4;&#x5982;&#x4E0B;&#xFF1A; &#x800C;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x5377;&#x79EF;&#x7565;&#x6709;&#x5DEE;&#x522B;&#xFF0C;&#x5982;&#x4E0B;&#x6CE8;&#xFF1A;&#x5B9E;&#x9645;&#x4E0A;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x91CC;&#x7684;convolution&#x662F;cross-correlation&#x5377;&#x79EF;&#x53C2;&#x6570;&#x5377;&#x79EF;&#x6838;&#x4E0A;&#x9762;&#x505A;&#x5377;&#x79EF;&#x7684;3x3&#x7684;&#x77E9;&#x9635;&#x5C31;&#x662F;&#x5377;&#x79EF;&#x6838;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;&#x79F0;&#x4F5C;filter&#xFF0C;&#x6EE4;&#x6CE2;&#x5668;&#xFF0C;&#x8FC7;&#x6EE4;&#x5668;&#x7B49;&#x7B49;&#x3002;&#x6307;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#x3002; &#x5728;&#x56FE;&#x50CF;&#x5904;&#x7406;&#x4E2D;&#xFF0C;&#x5377;&#x79EF;&#x901A;&#x5E38;&#x88AB;&#x7528;&#x6765;&#x505A;&#x8FB9;&#x7F18;&#x68C0;&#x6D4B;&#x3002;&#x4F8B;&#x5982;&#x4E0A;&#x56FE;&#x7684;3x3 filter&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x7AD6;&#x8FB9;&#x7F18;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x53D8;&#x6210;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x6765;&#x68C0;&#x6D4B;&#x6A2A;&#x8FB9;&#x7F18;&#xFF1A;: channel number: &#x4E0B;&#x4E00;&#x4E2A;layer&#x8F93;&#x5165;&#x7684;channel number&#xFF0C;&#x672C;&#x5C42;&#x7B49;&#x4E8E;filter numberf&#x662F;&#x5377;&#x79EF;&#x6838;&#x7684;&#x5927;&#x5C0F;&#xFF0C;s&#x662F;&#x6B65;&#x957F;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x8BB2;&#x5230;PaddingPadding&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;padding&#xFF0C;&#x5219;&#x8F93;&#x51FA;&#x77E9;&#x9635;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x65F6;&#xFF0C;&#x603B;&#x5C0F;&#x4E8E;n&#x3002;&#x5982;&#x679C;&#x6709;&#x4E86;padding&#xFF0C;&#x5219;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#x4FEE;&#x6B63;&#x6210;&#x3002;&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x4FEE;&#x8BA2;padding&#x7684;&#x5927;&#x5C0F;&#x6765;&#x8C03;&#x6574;&#x8F93;&#x51FA;&#x77E9;&#x9635;&#x7684;&#x5927;&#x5C0F;&#x3002;StrideStride&#x6307;&#x6B65;&#x957F;&#xFF0C;&#x4E0A;&#x9762;&#x56FE;&#x4E2D;&#x7684;&#x4F8B;&#x5B50;&#x6B65;&#x957F;&#x91C7;&#x7528;&#x7684;&#x662F;1&#xFF0C;&#x6B65;&#x957F;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;&#x5176;&#x4ED6;&#x503C;&#x3002;&#x5F53;&#x6B65;&#x957F;&#x4E3A;s&#xFF0C;padding&#x4E3A;p&#x65F6;&#xFF0C;&#x8F93;&#x51FA;&#x77E9;&#x9635;&#x7684;&#x5C3A;&#x5BF8;&#x4E3A;&#xFF1A; &#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x901A;&#x5E38;&#x5305;&#x62EC;3&#x4E2A;&#x90E8;&#x5206;&#xFF1A;Convolution (CONV)Pooling (POOL)Fully connected (FC)&#x5176;&#x4E2D;&#x7684;Fully connected&#x5C31;&#x662F;&#x7ECF;&#x5178;&#x7684;&#x5168;&#x8FDE;&#x63A5;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x4E0B;&#x56FE;&#x5C31;&#x662F;&#x4E00;&#x5C42;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x7684;&#x5927;&#x81F4;&#x5F62;&#x6001;&#x8F93;&#x5165;&#x662F;6x6x3&#x7684;&#x77E9;&#x9635;&#x7ECF;&#x8FC7;&#x4E24;&#x8DEF;&#x5377;&#x79EF;&#x6838;&#x548C;non-linear activation&#x5F97;&#x5230;4x4x2&#x7684;&#x8F93;&#x51FA;&#x5176;&#x4E2D;b&#x662F;bias&#xFF0C;activation&#x91C7;&#x7528;ReLU&#x8FD9;&#x6837;&#x4E00;&#x5C42;&#x7F51;&#x7EDC;&#x7684;&#x53C2;&#x6570;&#x6709;&#xFF1A;: filter size: padding size: stride: number of filters in layer Input: Output: Each filter has shape: After activations: , with mini-batch: Weights: Bias: &#x5982;&#x679C;&#x4E00;&#x4E2A;64x64&#x7684;&#x6570;&#x636E;&#x8F93;&#x5165;&#xFF0C;&#x91C7;&#x7528;10&#x4E2A;3x3&#x7684;&#x5377;&#x79EF;&#x6838;&#xFF0C;&#x9700;&#x8981;&#x591A;&#x5C11;&#x4E2A;&#x6A21;&#x578B;&#x53C2;&#x6570;&#xFF1F; &#x7B54;&#x6848;&#x662F;&#xFF1A;(3x3+1)*10 = 280&#x4E2A;&#xFF0C;&#x4E0E;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x5C3A;&#x5BF8;&#x65E0;&#x5173;&#x3002;&#x5373;&#x7528;&#x5C0F;&#x5C3A;&#x5BF8;&#x6837;&#x672C;&#x6570;&#x636E;&#x8BAD;&#x7EC3;&#x51FA;&#x6765;&#x7684;&#x5377;&#x79EF;&#x6A21;&#x578B;&#xFF0C;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x9002;&#x7528;&#x4E8E;&#x5927;&#x5C3A;&#x5BF8;&#x7684;&#x56FE;&#x50CF;&#x3002;Pooling&#x7FFB;&#x8BD1;&#x505A;&#x6C60;&#x5316;&#x5C42;&#x3002;&#x4E00;&#x822C;&#x6709;&#x4E24;&#x79CD;&#x6C60;&#x5316;&#x7B56;&#x7565;&#xFF1A;Max poolingAverage pooling&#x524D;&#x8005;&#x4F7F;&#x7528;&#x7684;&#x66F4;&#x591A;&#x4E00;&#x4E9B;&#x3002; &#x5177;&#x4F53;&#x505A;&#x6CD5;&#x7528;&#x4E24;&#x5F20;&#x56FE;&#x8868;&#x793A;&#xFF1A; Max poolingAverage pooling&#x8FD9;&#x91CC;f=2&#x8868;&#x793A;&#xFF0C;&#x57FA;&#x4E8E;2x2&#x7684;&#x77E9;&#x9635;&#x505A;&#x6C60;&#x5316;&#xFF0C;s=2&#x8868;&#x793A;&#x6BCF;&#x6B21;&#x504F;&#x79FB;2&#x83B7;&#x5F97;&#x4E0B;&#x4E00;&#x4E2A;&#x6C60;&#x5316;&#x77E9;&#x9635;&#x3002;f, s&#x90FD;&#x662F;&#x8D85;&#x53C2;&#x6570;&#x3002;&#x6240;&#x4EE5;&#x6C60;&#x5316;&#x5C42;&#x6CA1;&#x6709;learnable parameter&#xFF0C;&#x53EA;&#x6709;hyper parameter&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x6C60;&#x5316;&#x5C42;&#xFF1F;&#x7F51;&#x4E0A;&#x6709;&#x5F88;&#x591A;&#x8BA8;&#x8BBA;&#xFF0C;&#x6458;&#x4E00;&#x6BB5;&#xFF1A;&#x672C;&#x8D28;&#x4E0A;&#xFF0C;&#x662F;&#x5728;&#x7CBE;&#x7B80;feature map&#x6570;&#x636E;&#x91CF;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x6700;&#x5927;&#x5316;&#x4FDD;&#x7559;&#x7A7A;&#x95F4;&#x4FE1;&#x606F;&#x548C;&#x7279;&#x5F81;&#x4FE1;&#x606F;&#xFF0C;&#x7684;&#x5904;&#x7406;&#x6280;&#x5DE7;&#xFF1B;&#x76EE;&#x7684;&#x662F;&#xFF0C;&#x901A;&#x8FC7;feature map&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x6D53;&#x7F29;&#xFF0C;&#x7ED9;&#x5230;&#x540E;&#x9762;hidden layer&#x7684;input&#x5C31;&#x5C0F;&#x4E86;&#xFF0C;&#x8BA1;&#x7B97;&#x6548;&#x7387;&#x80FD;&#x63D0;&#x9AD8;&#xFF1B;CNN&#x7684;invariance&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x672C;&#x8D28;&#x662F;&#x7531;convolution&#x521B;&#x9020;&#x7684;&#xFF1B;&#x6211;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x6709;&#x51E0;&#x4E2A;&#x539F;&#x56E0;(&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x5B9A;&#x5BF9;&#xFF0C;&#x8BF7;&#x65A7;&#x6B63;)&#xFF1A;&#x5377;&#x79EF;&#x6ED1;&#x52A8;&#x7D2F;&#x52A0;&#x65F6;&#xFF0C;&#x533A;&#x57DF;&#x6709;&#x91CD;&#x53E0;&#xFF0C;&#x6240;&#x4EE5;&#x6570;&#x636E;&#x662F;&#x6709;&#x5197;&#x4F59;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x7CBE;&#x7B80;&#x6C60;&#x5316;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x4F4D;&#x79FB;&#x5E26;&#x6765;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x5982;max pooling&#x53EA;&#x53D6;&#x4E00;&#x5C0F;&#x5757;&#x533A;&#x57DF;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x8FD9;&#x6837;&#x867D;&#x7136;&#x6709;&#x5C0F;&#x5C0F;&#x4F4D;&#x79FB;&#xFF0C;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x5BF9;&#x6B64;&#x5E76;&#x4E0D;&#x654F;&#x611F;&#x53EF;&#x4EE5;&#x964D;&#x7EF4;&#xFF0C;&#x51CF;&#x5C11;&#x540E;&#x7EED;&#x6570;&#x636E;&#x8BA1;&#x7B97;&#x91CF;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x8FC7;&#x62DF;&#x5408;&#x7684;&#x98CE;&#x9669;&#xFF0C;&#x4F46;&#x662F;&#x589E;&#x52A0;&#x4E86;&#x6B20;&#x62DF;&#x5408;&#x7684;&#x98CE;&#x9669;&#x3002;&#x5B8C;&#x6574;&#x7684;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5927;&#x6982;&#x957F;&#x8FD9;&#x6837;&#xFF1A;CONV-POOL-CONV-POOL-FC-FC-Softmax&#x6BCF;&#x4E2A;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x540E;&#x8DDF;&#x4E00;&#x4E2A;&#x6C60;&#x5316;&#x5C42;&#xFF0C;&#x5171;&#x4E24;&#x4E2A;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#x4E24;&#x4E2A;&#x6C60;&#x5316;&#x5C42;&#x5377;&#x79EF;&#x5C42;&#x540E;&#xFF0C;&#x8F93;&#x51FA;&#x4E32;&#x884C;&#x5316;&#x5230;&#x4E00;&#x4E2A;&#x5217;&#x5411;&#x91CF;&#x91CC;&#xFF0C;&#x4F5C;&#x4E3A;&#x540E;&#x7EED;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x8F93;&#x5165;FC3&#x548C;FC4&#x662F;&#x4E24;&#x4E2A;&#x5168;&#x8FDE;&#x63A5;&#x7684;&#x6807;&#x51C6;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x6700;&#x540E;&#x662F;Softmax&#x7684;&#x8F93;&#x51FA;&#x5C42;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x6240;&#x6709;&#x7684;&#x53C2;&#x6570;&#x5982;&#x4E0B;&#x8868;&#xFF1A;%23%20Deep%20Learning%20%2810%29%20-%20%20Convolutional%20Neural%20Network%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%u7EC8%u4E8E%u5230CNN%u4E86%uFF0C%u5377%u79EF%u795E%u7ECF%u7F51%u7EDC%u3002%u987E%u540D%u601D%u4E49%uFF0C%u52A0%u5165%u4E86%u5377%u79EF%u5C42%u7684%u795E%u7ECF%u7F51%u7EDC%u5C31%u662F%u4E00%u4E2ACNN%u3002%0A%0A%23%23%20%u5377%u79EF%u7684%u5B9A%u4E49%0A%u5377%u79EF%u7684%u6570%u5B66%u5B9A%u4E49%u5728%5Bwiki%20page%5D%28https%3A//zh.wikipedia.org/wiki/%25E5%258D%25B7%25E7%25A7%25AF%29%u4E0A%u53EF%u4EE5%u627E%u5230%u3002%u5927%u81F4%u5982%u4E0B%uFF1A%0A%24%24h%28x%29%20%3D%20%28f%20%5Cast%20g%29%28x%29%20%3D%20%5Cint_%7B-%5Cinfty%7D%5E%5Cinfty%20f%28%5Ctau%29g%28x-%5Ctau%29dx%24%24%0A%u800C%u673A%u5668%u5B66%u4E60%u4E2D%u4F7F%u7528%u7684%u5377%u79EF%u7565%u6709%u5DEE%u522B%uFF0C%u5982%u4E0B%0A%21%5BAlt%20text%7C500x0%5D%28./1537223810801.png%29%0A%u4E24%u8005%u7684%u5DEE%u522B%u5728%u4E8E%uFF0C%u673A%u5668%u5B66%u4E60%u4E2D%u7684%u5377%u79EF%u6CA1%u6709%u5BF9%u51FD%u6570g%28x%29%u8FDB%u884C%u7FFB%u8F6C%u3002%u800C%u662F%u76F4%u63A5%u4E0E%u6E90%u6570%u636E%u8FDB%u884C%u79FB%u52A8%u76F8%u4E58%u5E76%u7D2F%u79EF%u3002%u524D%u8005%u7FFB%u8F6C%u7684%u610F%u4E49%u5728%u4E8E%uFF0C%u53EF%u4EE5%u8FD0%u7528%u7ED3%u5408%u5F8B%u5373%24%28A%20%5Cast%20B%29%5Cast%20C%20%3D%20A%20%5Cast%20%28B%20%5Cast%20C%29%24%u3002%0A%3E**%u6CE8**%uFF1A%u5B9E%u9645%u4E0A%u673A%u5668%u5B66%u4E60%u91CC%u7684convolution%u662Fcross-correlation%0A%0A%23%23%20%u5377%u79EF%u53C2%u6570%0A%23%23%23%20%u5377%u79EF%u6838%0A%u4E0A%u9762%u505A%u5377%u79EF%u76843x3%u7684%u77E9%u9635%u5C31%u662F%u5377%u79EF%u6838%uFF0C%u53C8%u53EF%u4EE5%u79F0%u4F5Cfilter%uFF0C%u6EE4%u6CE2%u5668%uFF0C%u8FC7%u6EE4%u5668%u7B49%u7B49%u3002%u6307%u7684%u90FD%u662F%u540C%u4E00%u4E2A%u4E1C%u897F%u3002%0A%u5728%u56FE%u50CF%u5904%u7406%u4E2D%uFF0C%u5377%u79EF%u901A%u5E38%u88AB%u7528%u6765%u505A%u8FB9%u7F18%u68C0%u6D4B%u3002%u4F8B%u5982%u4E0A%u56FE%u76843x3%20filter%u53EF%u4EE5%u68C0%u6D4B%u7AD6%u8FB9%u7F18%u3002%u4E5F%u53EF%u4EE5%u53D8%u6210%u4E0B%u9762%u8FD9%u6837%u6765%u68C0%u6D4B%u6A2A%u8FB9%u7F18%uFF1A%0A%21%5BAlt%20text%7C150x0%5D%28./1537224799937.png%29%0A%u90A3%u5230%u5E95%u8FD9%u4E2A%u5377%u79EF%u6838%u8BE5%u5982%u4F55%u53D6%u503C%uFF1F%u5728%u673A%u5668%u5B66%u4E60%u4E2D%uFF0C%u8FD9%u4E2A%u5377%u79EF%u6838%u7684%u53D6%u503C%u5B9E%u9645%u662F%u4E00%u4E2Alearnable%20parameter%u3002%u4E5F%u5C31%u662F%u8BF4%u4ED6%u548C%u795E%u7ECF%u7F51%u7EDC%u4E2D%u7684W%uFF0Cb%u662F%u4E00%u6837%u7684%uFF0C%u4E5F%u662F%u901A%u8FC7%u5B66%u4E60%u83B7%u5F97%u7684%u3002%u4ED6%u662F%u6A21%u578B%u53C2%u6570%u3002%u6211%u4EEC%u9700%u8981%u5B9A%u7684%u8D85%u53C2%u6570%u662F%uFF0C%u91C7%u7528%u591A%u5C11%u4E2A%u5377%u79EF%u6838%u3002%0A%u4F8B%u5982%u8FD9%u4E2A%u4F8B%u5B50%uFF1A%0A%21%5BAlt%20text%7C600x0%5D%28./1537225051999.png%29%0A%u8F93%u5165%u662F%u4E00%u4E2A6x6x3%u77E9%u9635%uFF0C%u4EE3%u8868%u4E00%u4E2A%u56FE%u50CF%u7684RGB%u4E09%u4E2A%u901A%u9053%uFF0C%u5377%u57FA%u5C42%u91C7%u7528%u4E24%u4E2A3x3x3%u7684%u5377%u79EF%u6838%uFF0C%u83B7%u5F974x4x2%u7684%u5377%u79EF%u8F93%u51FA%0A%24%24n_H%20%5Ctimes%20n_W%20%5Ctimes%20n_C%20%5Crightarrow%20%28%5Cfrac%20%7Bn_H-f%7D%7Bs%7D+1%29%20%5Ctimes%20%28%5Cfrac%7Bn_W-f%7D%7Bs%7D%20+%201%29%20%5Ctimes%20n_C%27%24%24%0A-%20%24n_C%24%3A%20%20channel%20number%0A-%20%24n_C%27%24%3A%20%u4E0B%u4E00%u4E2Alayer%u8F93%u5165%u7684channel%20number%uFF0C%u672C%u5C42%u7B49%u4E8Efilter%20number%0A-%20f%u662F%u5377%u79EF%u6838%u7684%u5927%u5C0F%uFF0Cs%u662F%u6B65%u957F%uFF0C%u540E%u9762%u4F1A%u8BB2%u5230%0A%0A%23%23%23%20Padding%0APadding%u8981%u89E3%u51B3%u7684%u95EE%u9898%u5C31%u662F%uFF0C%u5982%u679C%u6CA1%u6709padding%uFF0C%u5219%u8F93%u51FA%u77E9%u9635%u4F1A%u8D8A%u6765%u8D8A%u5C0F%uFF0C%u56E0%u4E3A%u5F53%24f%20%5Cgt%201%24%u65F6%uFF0C%24%5Ccfrac%20%7Bn-f%7D%7Bs%7D%20+%201%24%u603B%u5C0F%u4E8En%u3002%u5982%u679C%u6709%u4E86padding%uFF0C%u5219%u8FD9%u4E2A%u6570%u5B57%u4FEE%u6B63%u6210%24%5Ccfrac%20%7Bn-f+2p%7D%7Bs%7D%20+%201%24%u3002%u6B64%u65F6%u53EF%u4EE5%u4FEE%u8BA2padding%u7684%u5927%u5C0F%u6765%u8C03%u6574%u8F93%u51FA%u77E9%u9635%u7684%u5927%u5C0F%u3002%0A%0A%23%23%23%20Stride%0AStride%u6307%u6B65%u957F%uFF0C%u4E0A%u9762%u56FE%u4E2D%u7684%u4F8B%u5B50%u6B65%u957F%u91C7%u7528%u7684%u662F1%uFF0C%u6B65%u957F%u4E5F%u53EF%u4EE5%u662F%u4EFB%u610F%u5176%u4ED6%u503C%u3002%u5F53%u6B65%u957F%u4E3As%uFF0Cpadding%u4E3Ap%u65F6%uFF0C%u8F93%u51FA%u77E9%u9635%u7684%u5C3A%u5BF8%u4E3A%uFF1A%0A%24%24%5Clfloor%20%5Ccfrac%20%7Bn-f+2p%7D%7Bs%7D%20+%201%20%5Crfloor%20%5Ctimes%20%5Clfloor%20%5Ccfrac%20%7Bn-f+2p%7D%7Bs%7D%20+%201%20%5Crfloor%20%5Ctimes%20n_C%24%24%0A%0A%23%23%20%u5377%u79EF%u795E%u7ECF%u7F51%u7EDC%0A%u4E00%u4E2A%u5B8C%u6574%u7684%u5377%u79EF%u795E%u7ECF%u7F51%u7EDC%u901A%u5E38%u5305%u62EC3%u4E2A%u90E8%u5206%uFF1A%0A-%20Convolution%20%28CONV%29%0A-%20Pooling%20%28POOL%29%0A-%20Fully%20connected%20%28FC%29%0A%0A%u5176%u4E2D%u7684Fully%20connected%u5C31%u662F%u7ECF%u5178%u7684%u5168%u8FDE%u63A5%u795E%u7ECF%u7F51%u7EDC%u3002%0A%0A%23%23%23%20%u5377%u79EF%u7F51%u7EDC%0A%u4E0B%u56FE%u5C31%u662F%u4E00%u5C42%u5377%u79EF%u7F51%u7EDC%u7684%u5927%u81F4%u5F62%u6001%0A%21%5BAlt%20text%7C700x0%5D%28./1537238687912.png%29%0A-%20%u8F93%u5165%u662F6x6x3%u7684%u77E9%u9635%0A-%20%u7ECF%u8FC7%u4E24%u8DEF%u5377%u79EF%u6838%u548Cnon-linear%20activation%u5F97%u52304x4x2%u7684%u8F93%u51FA%0A-%20%u5176%u4E2Db%u662Fbias%uFF0Cactivation%u91C7%u7528ReLU%0A%0A%u8FD9%u6837%u4E00%u5C42%u7F51%u7EDC%u7684%u53C2%u6570%u6709%uFF1A%0A-%20%24f%5E%7B%5Bl%5D%7D%24%3A%20filter%20size%0A-%20%24p%5E%7B%5Bl%5D%7D%24%3A%20padding%20size%0A-%20%24s%5E%7B%5Bl%5D%7D%24%3A%20stride%0A-%20%24n_C%5E%7B%5Bl%5D%7D%24%3A%20number%20of%20filters%20in%20layer%20%24l%24%0A-%20Input%3A%20%24n_H%5E%7B%5Bl-1%5D%7D%20%5Ctimes%20n_W%5E%7B%5Bl-1%5D%7D%20%5Ctimes%20n_C%5E%7B%5Bl-1%5D%7D%24%0A-%20Output%3A%20%24n_H%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_W%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_C%5E%7B%5Bl%5D%7D%24%0A-%20Each%20filter%20has%20shape%3A%20%24f%5E%7B%5Bl%5D%7D%20%5Ctimes%20f%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_C%5E%7B%5Bl-1%5D%7D%24%0A-%20After%20activations%3A%20%24a%5E%7B%5Bl%5D%7D%20%3D%20n_H%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_W%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_C%5E%7B%5Bl%5D%7D%24%2C%20with%20mini-batch%3A%20%24A%5E%7B%5Bl%5D%7D%20%3D%20m%20%5Ctimes%20n_H%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_W%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_C%5E%7B%5Bl%5D%7D%24%0A-%20Weights%3A%20%24f%5E%7B%5Bl%5D%7D%20%5Ctimes%20f%5E%7B%5Bl%5D%7D%20%5Ctimes%20n_C%5E%7B%5Bl-1%5D%7D%20%5Ctimes%20n_C%5E%7B%5Bl%5D%7D%24%0A-%20Bias%3A%20%24n_C%5E%7B%5Bl%5D%7D%24%0A%0A%3E%20%u5982%u679C%u4E00%u4E2A64x64%u7684%u6570%u636E%u8F93%u5165%uFF0C%u91C7%u752810%u4E2A3x3%u7684%u5377%u79EF%u6838%uFF0C%u9700%u8981%u591A%u5C11%u4E2A%u6A21%u578B%u53C2%u6570%uFF1F%0A%3E%20%u7B54%u6848%u662F%uFF1A%283x3+1%29*10%20%3D%20280%u4E2A%uFF0C%u4E0E%u8F93%u5165%u56FE%u50CF%u7684%u5C3A%u5BF8%u65E0%u5173%u3002%u5373%u7528%u5C0F%u5C3A%u5BF8%u6837%u672C%u6570%u636E%u8BAD%u7EC3%u51FA%u6765%u7684%u5377%u79EF%u6A21%u578B%uFF0C%u540C%u6837%u53EF%u4EE5%u9002%u7528%u4E8E%u5927%u5C3A%u5BF8%u7684%u56FE%u50CF%u3002%0A%0A%23%23%23%20Pooling%0A%u7FFB%u8BD1%u505A%u6C60%u5316%u5C42%u3002%u4E00%u822C%u6709%u4E24%u79CD%u6C60%u5316%u7B56%u7565%uFF1A%0A-%20Max%20pooling%0A-%20Average%20pooling%0A%0A%u524D%u8005%u4F7F%u7528%u7684%u66F4%u591A%u4E00%u4E9B%u3002%0A%u5177%u4F53%u505A%u6CD5%u7528%u4E24%u5F20%u56FE%u8868%u793A%uFF1A%0A**Max%20pooling**%0A%21%5BAlt%20text%7C500x0%5D%28./1537240125946.png%29%0A%0A**Average%20pooling**%0A%21%5BAlt%20text%7C500x0%5D%28./1537240211256.png%29%0A%0A%u8FD9%u91CCf%3D2%u8868%u793A%uFF0C%u57FA%u4E8E2x2%u7684%u77E9%u9635%u505A%u6C60%u5316%uFF0Cs%3D2%u8868%u793A%u6BCF%u6B21%u504F%u79FB2%u83B7%u5F97%u4E0B%u4E00%u4E2A%u6C60%u5316%u77E9%u9635%u3002f%2C%20s%u90FD%u662F%u8D85%u53C2%u6570%u3002%u6240%u4EE5%u6C60%u5316%u5C42%u6CA1%u6709learnable%20parameter%uFF0C%u53EA%u6709hyper%20parameter%u3002%0A%0A%0A%u4E3A%u4EC0%u4E48%u8981%u6709%u6C60%u5316%u5C42%uFF1F%u7F51%u4E0A%u6709%u5F88%u591A%u8BA8%u8BBA%uFF0C%u6458%u4E00%u6BB5%uFF1A%0A%3E%u672C%u8D28%u4E0A%uFF0C%u662F%u5728%u7CBE%u7B80feature%20map%u6570%u636E%u91CF%u7684%u540C%u65F6%uFF0C%u6700%u5927%u5316%u4FDD%u7559%u7A7A%u95F4%u4FE1%u606F%u548C%u7279%u5F81%u4FE1%u606F%uFF0C%u7684%u5904%u7406%u6280%u5DE7%uFF1B%u76EE%u7684%u662F%uFF0C%u901A%u8FC7feature%20map%u8FDB%u884C%u538B%u7F29%u6D53%u7F29%uFF0C%u7ED9%u5230%u540E%u9762hidden%20layer%u7684input%u5C31%u5C0F%u4E86%uFF0C%u8BA1%u7B97%u6548%u7387%u80FD%u63D0%u9AD8%uFF1BCNN%u7684invariance%u7684%u80FD%u529B%uFF0C%u672C%u8D28%u662F%u7531convolution%u521B%u9020%u7684%uFF1B%0A%0A%u6211%u7684%u7406%u89E3%uFF0C%u6709%u51E0%u4E2A%u539F%u56E0%28%u53EF%u80FD%u4E0D%u4E00%u5B9A%u5BF9%uFF0C%u8BF7%u65A7%u6B63%29%uFF1A%0A-%20%u5377%u79EF%u6ED1%u52A8%u7D2F%u52A0%u65F6%uFF0C%u533A%u57DF%u6709%u91CD%u53E0%uFF0C%u6240%u4EE5%u6570%u636E%u662F%u6709%u5197%u4F59%u7684%uFF0C%u9700%u8981%u7CBE%u7B80%0A-%20%u6C60%u5316%u53EF%u4EE5%u51CF%u5C11%u4F4D%u79FB%u5E26%u6765%u7684%u5F71%u54CD%uFF0C%u5982max%20pooling%u53EA%u53D6%u4E00%u5C0F%u5757%u533A%u57DF%u7684%u6700%u5927%u503C%uFF0C%u8FD9%u6837%u867D%u7136%u6709%u5C0F%u5C0F%u4F4D%u79FB%uFF0C%u8F93%u51FA%u6570%u636E%u5BF9%u6B64%u5E76%u4E0D%u654F%u611F%0A-%20%u53EF%u4EE5%u964D%u7EF4%uFF0C%u51CF%u5C11%u540E%u7EED%u6570%u636E%u8BA1%u7B97%u91CF%uFF0C%u4E5F%u53EF%u4EE5%u51CF%u5C11%u8FC7%u62DF%u5408%u7684%u98CE%u9669%uFF0C%u4F46%u662F%u589E%u52A0%u4E86%u6B20%u62DF%u5408%u7684%u98CE%u9669%u3002%0A%0A%0A%23%23%23%20%u5B8C%u6574%u7684%u5377%u79EF%u795E%u7ECF%u7F51%u7EDC%0A%u4E00%u4E2A%u5B8C%u6574%u7684%u5377%u79EF%u795E%u7ECF%u7F51%u7EDC%u5927%u6982%u957F%u8FD9%u6837%uFF1A%0A%21%5BAlt%20text%7C800x0%5D%28./1537247393297.png%29%0A%0ACONV-POOL-CONV-POOL-FC-FC-Softmax%0A%0A-%20%u6BCF%u4E2A%u5377%u79EF%u7F51%u7EDC%u540E%u8DDF%u4E00%u4E2A%u6C60%u5316%u5C42%uFF0C%u5171%u4E24%u4E2A%u5377%u79EF%u7F51%u7EDC%u4E24%u4E2A%u6C60%u5316%u5C42%0A-%20%u5377%u79EF%u5C42%u540E%uFF0C%u8F93%u51FA%u4E32%u884C%u5316%u5230%u4E00%u4E2A%u5217%u5411%u91CF%u91CC%uFF0C%u4F5C%u4E3A%u540E%u7EED%u795E%u7ECF%u7F51%u7EDC%u7684%u8F93%u5165%0A-%20FC3%u548CFC4%u662F%u4E24%u4E2A%u5168%u8FDE%u63A5%u7684%u6807%u51C6%u795E%u7ECF%u7F51%u7EDC%0A-%20%u6700%u540E%u662FSoftmax%u7684%u8F93%u51FA%u5C42%0A%0A%u8FD9%u6837%u4E00%u4E2A%u7F51%u7EDC%u6240%u6709%u7684%u53C2%u6570%u5982%u4E0B%u8868%uFF1A%0A%21%5BAlt%20text%7C650x0%5D%28./1537247671438.png%29%0A%0A%0A%0A%0A%0A%0A%0A]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (9) - Transfer learning, Multi-task learning, End-to-end learning]]></title>
    <url>%2F2018%2F09%2F04%2FDeep_Learning_(9)_-_Transfer_learning%2C_Multi-task_learning%2C_End-to-end_learning%2F</url>
    <content type="text"><![CDATA[EditTransfer learning&#x4E2D;&#x6587;&#x8BD1;&#x4F5C;&#x8FC1;&#x79FB;&#x5B66;&#x4E60;&#xFF0C;&#x6307;&#x7684;&#x662F;&#x5C06;task A&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x4E0D;&#x7ECF;&#x8FC7;&#x4FEE;&#x6539;&#xFF0C;&#x66FF;&#x6362;&#x8F93;&#x51FA;&#x5C42;&#x540E;&#xFF0C;&#x76F4;&#x63A5;&#x7528;&#x4F5C;task B&#x7684;&#x6A21;&#x578B;&#x4F7F;&#x7528;&#xFF0C;&#x6216;&#x8005;&#x57FA;&#x4E8E;task A&#x6A21;&#x578B;&#x57FA;&#x7840;&#x4E0A;&#x7EE7;&#x7EED;&#x8BAD;&#x7EC3;&#x79F0;&#x4E3A;task B&#x7684;&#x6A21;&#x578B;&#x3002; &#x4EA7;&#x751F;&#x8FC1;&#x79FB;&#x5B66;&#x4E60;&#x7684;&#x539F;&#x56E0;&#x662F;&#x6837;&#x672C;&#x6570;&#x636E;&#x7684;&#x7EA6;&#x675F;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;task A&#x662F;cat detector&#xFF0C;task B&#x662F;&#x901A;&#x8FC7;X&#x5149;&#x7167;&#x7247;&#x5224;&#x65AD;&#x9AA8;&#x9F84;&#x3002;A&#x7684;&#x6837;&#x672C;&#x5343;&#x5343;&#x4E07;&#x4E07;&#xFF0C;&#x6570;&#x636E;&#x96C6;&#x5E9E;&#x5927;&#xFF0C;B&#x7684;&#x6837;&#x672C;&#x6765;&#x81EA;&#x4E8E;&#x533B;&#x9662;&#x7684;&#x60A3;&#x8005;&#x7167;&#x7247;&#xFF0C;&#x6570;&#x636E;&#x96C6;&#x975E;&#x5E38;&#x6709;&#x9650;&#x3002;&#x4F46;&#x662F;&#x4ED6;&#x4EEC;&#x7684;&#x5E95;&#x5C42;&#x6A21;&#x5757;&#x5E94;&#x8BE5;&#x662F;&#x76F8;&#x540C;&#x7684;&#x6216;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x8FB9;&#x7F18;&#x68C0;&#x6D4B;&#xFF0C;&#x9700;&#x8981;&#x50CF;&#x7D20;&#x5206;&#x6790;&#x7B49;&#x7B49;&#x3002;&#x8003;&#x8651;&#x5230;&#x5E95;&#x5C42;&#x9700;&#x6C42;&#x7684;&#x8FD1;&#x4F3C;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x8003;&#x8651;&#x53EF;&#x4EE5;&#x5171;&#x7528;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#xFF0C;&#x8FDB;&#x800C;&#x4EA7;&#x751F;&#x4E86;&#x8FC1;&#x79FB;&#x5B66;&#x4E60;&#x3002;When transfer learning makes sense? Task A and B have the same input X. You have a lot more data for Task A than Task B. Low level features from A could be helpful for learning B.Multi-task learning&#x4E2D;&#x6587;&#x8BD1;&#x4F5C;&#x591A;&#x4EFB;&#x52A1;&#x5B66;&#x4E60;&#xFF0C;&#x6307;&#x7684;&#x662F;&#x5728;&#x4E00;&#x6B21;&#x5B66;&#x4E60;&#x4E2D;&#x5B8C;&#x6210;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x4E00;&#x4E2A;&#x56FE;&#x7247;&#x91CC;&#xFF0C;&#x540C;&#x65F6;&#x8BC6;&#x522B;&#x591A;&#x4E2A;&#x76EE;&#x6807;&#x3002;&#x6807;&#x51C6;&#x7684;&#x635F;&#x5931;&#x51FD;&#x6570;&#x91CC;&#x662F;&#x6CA1;&#x6709;&#x8FD9;&#x4E00;&#x9879;&#x7684;&#x3002;&#x5982;&#x679C;&#x6837;&#x672C;&#x6570;&#x636E;&#x4E2D;&#x4E00;&#x4E9B;&#x6807;&#x8BB0;&#x4E0D;&#x5B8C;&#x6574;(&#x5982;&#x4E0B;&#x95EE;&#x53F7;&#x9879;)&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0A;&#x8FF0;&#x516C;&#x5F0F;&#xFF0C;&#x53EA;&#x662F;&#x9879;&#x53EA;&#x7D2F;&#x79EF;&#x6709;&#x6807;&#x8BB0;&#x7684;&#x90E8;&#x5206;When multi-task learning makes sense?Traning on a set of tasks that could benefit from having shared low-level features.Usually: Amount of data you have for each task is quite similar.Can train a big enough neural network to do well on all the tasks.End-to-end learning&#x4E2D;&#x6587;&#x8BD1;&#x4F5C;&#x7AEF;&#x5230;&#x7AEF;&#x5B66;&#x4E60;&#x3002;&#x4F55;&#x4E3A;&#x7AEF;&#x5230;&#x7AEF;&#x5B66;&#x4E60;&#xFF1F;&#x770B;&#x4E0B;&#x9762;speech recognition&#x7684;&#x4F8B;&#x5B50;&#xFF1A;&#x542C;&#x8D77;&#x6765;&#x7AEF;&#x5230;&#x7AEF;&#x5B66;&#x4E60;&#x4E0D;&#x662F;&#x5F88;&#x9760;&#x8C31;&#x3002;&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5B66;&#x4E60;&#x76EE;&#x6807;&#xFF0C;&#x80AF;&#x5B9A;&#x90FD;&#x8FD8;&#x662F;&#x91C7;&#x7528;&#x7AEF;&#x5230;&#x7AEF;&#x5B66;&#x4E60;&#x3002;&#x4E0B;&#x9762;&#x770B;&#x7AEF;&#x5230;&#x7AEF;&#x5B66;&#x4E60;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#xFF1A;Pros and Cons ProsLet the data speak. &#x8BF4;&#x5230;&#x5E95;&#x8FD8;&#x662F;&#x76F8;&#x5173;&#x7684;&#x6837;&#x672C;&#x591F;&#x4E0D;&#x591F;&#x3002;&#x4F60;&#x7684;&#x6837;&#x672C;&#x8DB3;&#x4E0D;&#x8DB3;&#x591F;&#x8986;&#x76D6;&#x6240;&#x8981;&#x8FBE;&#x5230;&#x7684;&#x9884;&#x6D4B;&#x590D;&#x6742;&#x7A0B;&#x5EA6;&#x3002;Less hand-designing of components needed. &#x4E0D;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5206;&#x5272;&#x7CFB;&#x7EDF;&#xFF0C;&#x8BBE;&#x8BA1;pipe line&#x3002; ConsMay need large amount of data. &#x7F3A;&#x70B9;&#x81EA;&#x7136;&#x662F;&#x9700;&#x8981;&#x5927;&#x91CF;&#x6570;&#x636E;&#x3002;Excludes potentially useful hand-designed components. &#x518D;&#x5C31;&#x662F;&#x8981;&#x81EA;&#x884C;&#x5206;&#x5272;&#x7CFB;&#x7EDF;&#xFF0C;&#x8BBE;&#x8BA1;pipe line&#x3002;%23%20Deep%20Learning%20%289%29%20-%20Transfer%20learning%2C%20Multi-task%20learning%2C%20End-to-end%20learning%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%23%23%20Transfer%20learning%0A%u4E2D%u6587%u8BD1%u4F5C%u8FC1%u79FB%u5B66%u4E60%uFF0C%u6307%u7684%u662F%u5C06task%20A%u7684%u6A21%u578B%uFF0C%u4E0D%u7ECF%u8FC7%u4FEE%u6539%uFF0C%u66FF%u6362%u8F93%u51FA%u5C42%u540E%uFF0C%u76F4%u63A5%u7528%u4F5Ctask%20B%u7684%u6A21%u578B%u4F7F%u7528%uFF0C%u6216%u8005%u57FA%u4E8Etask%20A%u6A21%u578B%u57FA%u7840%u4E0A%u7EE7%u7EED%u8BAD%u7EC3%u79F0%u4E3Atask%20B%u7684%u6A21%u578B%u3002%0A%u4EA7%u751F%u8FC1%u79FB%u5B66%u4E60%u7684%u539F%u56E0%u662F%u6837%u672C%u6570%u636E%u7684%u7EA6%u675F%u3002%u4E3E%u4E2A%u4F8B%u5B50%uFF0Ctask%20A%u662Fcat%20detector%uFF0Ctask%20B%u662F%u901A%u8FC7X%u5149%u7167%u7247%u5224%u65AD%u9AA8%u9F84%u3002A%u7684%u6837%u672C%u5343%u5343%u4E07%u4E07%uFF0C%u6570%u636E%u96C6%u5E9E%u5927%uFF0CB%u7684%u6837%u672C%u6765%u81EA%u4E8E%u533B%u9662%u7684%u60A3%u8005%u7167%u7247%uFF0C%u6570%u636E%u96C6%u975E%u5E38%u6709%u9650%u3002%u4F46%u662F%u4ED6%u4EEC%u7684%u5E95%u5C42%u6A21%u5757%u5E94%u8BE5%u662F%u76F8%u540C%u7684%u6216%u7C7B%u4F3C%u7684%uFF0C%u90FD%u9700%u8981%u8FB9%u7F18%u68C0%u6D4B%uFF0C%u9700%u8981%u50CF%u7D20%u5206%u6790%u7B49%u7B49%u3002%u8003%u8651%u5230%u5E95%u5C42%u9700%u6C42%u7684%u8FD1%u4F3C%u6027%uFF0C%u6240%u4EE5%u8003%u8651%u53EF%u4EE5%u5171%u7528%u7F51%u7EDC%u6A21%u578B%uFF0C%u8FDB%u800C%u4EA7%u751F%u4E86%u8FC1%u79FB%u5B66%u4E60%u3002%0A%3E%20**When%20transfer%20learning%20makes%20sense%3F**%0A%3E%20Task%20A%20and%20B%20have%20the%20same%20input%20X.%0A%3E%20You%20have%20a%20lot%20more%20data%20for%20Task%20A%20than%20Task%20B.%0A%3E%20Low%20level%20features%20from%20A%20could%20be%20helpful%20for%20learning%20B.%0A%0A%23%23%20Multi-task%20learning%0A%u4E2D%u6587%u8BD1%u4F5C%u591A%u4EFB%u52A1%u5B66%u4E60%uFF0C%u6307%u7684%u662F%u5728%u4E00%u6B21%u5B66%u4E60%u4E2D%u5B8C%u6210%u591A%u4E2A%u4EFB%u52A1%u3002%u4F8B%u5982%uFF1A%u4E00%u4E2A%u56FE%u7247%u91CC%uFF0C%u540C%u65F6%u8BC6%u522B%u591A%u4E2A%u76EE%u6807%u3002%0A%21%5BAlt%20text%5D%28./1536013550836.png%29%0A%u4F8B%u5982%uFF0C%u5728%u8FD9%u4E2A%u56FE%u7247%u91CC%uFF0C%u8981%u8BC6%u522B%u884C%u4EBA%uFF0C%u7EA2%u7EFF%u706F%uFF0C%u6C7D%u8F66%u548C%u505C%u6B62%u6807%u5FD7%uFF0C%u90A3%u4E48%24y%20%5Cin%20R%5E4%24%uFF0C%u635F%u5931%u51FD%u6570%u5C31%u5199%u4F5C%uFF1A%0A%24%24J%20%3D%20%5Cfrac%7B1%7D%7Bm%7D%20%5CSigma_%7Bi%3D1%7D%5Em%20%5CSigma_%7Bj%3D1%7D%5E4%20L%28%5Chat%20y_j%5E%7B%28i%29%7D%2C%20y_j%5E%7B%28i%29%7D%29%24%24%0A%24%24L%28%5Chat%20y_j%5E%7B%28i%29%7D%2C%20y_j%5E%7B%28i%29%7D%29%20%3D%20-y_j%5E%7B%28i%29%7Dlog%5Chat%20y_j%5E%7B%28i%29%7D%20-%20%281-y_j%5E%7B%28i%29%7D%29log%281-%5Chat%20y_j%5E%7B%28i%29%7D%29%24%24%0A-%20%u6807%u51C6%u7684%u635F%u5931%u51FD%u6570%u91CC%u662F%u6CA1%u6709%24%5CSigma_%7Bj%3D1%7D%5E4%24%u8FD9%u4E00%u9879%u7684%u3002%0A-%20%u5982%u679C%u6837%u672C%u6570%u636E%u4E2D%u4E00%u4E9B%24y%5E%7B%28i%29%7D%24%u6807%u8BB0%u4E0D%u5B8C%u6574%28%u5982%u4E0B%u95EE%u53F7%u9879%29%uFF0C%u4ECD%u7136%u53EF%u4EE5%u4F7F%u7528%u4E0A%u8FF0%u516C%u5F0F%uFF0C%u53EA%u662F%24%5CSigma_%7Bj%3D1%7D%5E4%24%u9879%u53EA%u7D2F%u79EF%u6709%u6807%u8BB0%u7684%u90E8%u5206%0A%21%5BAlt%20text%7C250x0%5D%28./1536014022479.png%29%0A%0A%3E%20**When%20multi-task%20learning%20makes%20sense%3F**%0A%3E%20-%20Traning%20on%20a%20set%20of%20tasks%20that%20could%20benefit%20from%20having%20shared%20low-level%20features.%0A%3E%20-%20Usually%3A%20Amount%20of%20data%20you%20have%20for%20each%20task%20is%20quite%20similar.%0A%3E%20-%20Can%20train%20a%20big%20enough%20neural%20network%20to%20do%20well%20on%20all%20the%20tasks.%0A%0A%23%23%20End-to-end%20learning%0A%u4E2D%u6587%u8BD1%u4F5C%u7AEF%u5230%u7AEF%u5B66%u4E60%u3002%u4F55%u4E3A%u7AEF%u5230%u7AEF%u5B66%u4E60%uFF1F%u770B%u4E0B%u9762speech%20recognition%u7684%u4F8B%u5B50%uFF1A%0A%21%5BAlt%20text%7C600x0%5D%28./1536038229382.png%29%0A%u5728%u73B0%u6709%u7684speech%20recognition%u7CFB%u7EDF%uFF0C%u901A%u5E38%u8D70%u7684%u662F%u4E0A%u9762%u7684%u90A3%u6761%u89E3%u51B3%u65B9%u6848%u3002%u4ECE%u8BED%u97F3%u5230%u8BED%u4E49%uFF0C%u6574%u4E2Apipe%20line%u6709%u82E5%u5E72%u4E2Acomponent%u7EC4%u6210%u3002%u6BCF%u4E2Acomponent%u90FD%u6709%u5F88%u591A%u76F8%u5173%u7684paper%u548Cproject%u3002%u800C%u8FD9%u5E76%u4E0D%u662F%u4E00%u4E2A%u7AEF%u5230%u7AEF%u5B66%u4E60%u7684%u89E3%u51B3%u65B9%u6848%u3002%u6240%u8C13%u7684%u7AEF%u5230%u7AEF%u5B66%u4E60%u662F%u4E0B%u9762%u8FD9%u6761%u8DEF%u3002%u76F4%u63A5%u4ECE%u8BED%u97F3%uFF0C%u901A%u8FC7%u8BAD%u7EC3%u5F97%u5230%u8BED%u4E49%u3002%0A%u4E3A%u4EC0%u4E48%u5F53%u524D%u7684%u89E3%u51B3%u65B9%u6848%u6CA1%u6709%u7528%u7AEF%u5230%u7AEF%u5B66%u4E60%u5462%uFF1F%u56E0%u4E3A%u5982%u679C%u8981%u91C7%u7528%u7AEF%u5230%u7AEF%u5B66%u4E60%u6765%u5B9E%u73B0speech%20recognition%uFF0C%u5FC5%u987B%u8981%u6709%u5927%u91CF%u7684%u6837%u672C%u4ECE%u5404%u79CD%u5404%u6837%u7684audio%u7247%u6BB5%u5230%u5BF9%u5E94%u8BED%u4E49%u7684%u6837%u672C%u3002%u7406%u60F3%u60C5%u51B5%u4E0B%uFF0C%u5982%u679C%u8FD9%u79CD%u6709%u6548%u6837%u672C%u8DB3%u591F%u591A%u7684%u8BDD%uFF0C%u662F%u53EF%u4EE5%u91C7%u7528%u7AEF%u5230%u7AEF%u5B66%u4E60%u7684%u3002%0A%0A%u542C%u8D77%u6765%u7AEF%u5230%u7AEF%u5B66%u4E60%u4E0D%u662F%u5F88%u9760%u8C31%u3002%u4E0D%u8FC7%u5982%u679C%u662F%u7B80%u5355%u7684%u5B66%u4E60%u76EE%u6807%uFF0C%u80AF%u5B9A%u90FD%u8FD8%u662F%u91C7%u7528%u7AEF%u5230%u7AEF%u5B66%u4E60%u3002%u4E0B%u9762%u770B%u7AEF%u5230%u7AEF%u5B66%u4E60%u7684%u4F18%u7F3A%u70B9%uFF1A%0A%0A%3E%20**Pros%20and%20Cons**%0A%3E%20**Pros**%0A%3E%20-%20Let%20the%20data%20speak.%20%u8BF4%u5230%u5E95%u8FD8%u662F%u76F8%u5173%u7684%u6837%u672C%u591F%u4E0D%u591F%u3002%u4F60%u7684%u6837%u672C%u8DB3%u4E0D%u8DB3%u591F%u8986%u76D6%u6240%u8981%u8FBE%u5230%u7684%u9884%u6D4B%u590D%u6742%u7A0B%u5EA6%u3002%0A%3E%20-%20Less%20hand-designing%20of%20components%20needed.%20%u4E0D%u9700%u8981%u624B%u52A8%u5206%u5272%u7CFB%u7EDF%uFF0C%u8BBE%u8BA1pipe%20line%u3002%0A%3E%20**Cons**%0A%3E%20-%20May%20need%20large%20amount%20of%20data.%20%u7F3A%u70B9%u81EA%u7136%u662F%u9700%u8981%u5927%u91CF%u6570%u636E%u3002%0A%3E%20-%20Excludes%20potentially%20useful%20hand-designed%20components.%20%u518D%u5C31%u662F%u8981%u81EA%u884C%u5206%u5272%u7CFB%u7EDF%uFF0C%u8BBE%u8BA1pipe%20line%u3002%0A%0A%0A]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (8) - Error Analysis]]></title>
    <url>%2F2018%2F09%2F03%2FDeep_Learning_(8)_-_Error_Analysis%2F</url>
    <content type="text"><![CDATA[Edit&#x8FD9;&#x91CC;&#x6211;&#x89C9;&#x5F97;&#x5E94;&#x5F53;&#x7FFB;&#x4F5C;&#x9519;&#x8BEF;&#x5206;&#x6790;&#xFF0C;&#x800C;&#x975E;&#x8BEF;&#x5DEE;&#x5206;&#x6790;&#x3002;&#x91CD;&#x70B9;&#x9610;&#x8FF0;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x6570;&#x636E;&#x96C6;&#x672C;&#x8EAB;&#x6709;&#x9519;&#x8BEF;&#x600E;&#x4E48;&#x529E;&#x6709;&#x4E9B;&#x60C5;&#x51B5;&#x56E0;&#x4E3A;&#x6837;&#x672C;&#x6570;&#x636E;&#x672C;&#x8EAB;&#x7684;&#x5C40;&#x9650;&#xFF0C;&#x5BFC;&#x81F4;training set&#x548C;dev/test set&#x5206;&#x5E03;&#x4E0D;&#x540C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x662F;&#x5426;&#x51FA;&#x73B0;data mismatch&#xFF1F;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x9519;&#x8BEF;&#x5206;&#x6790;&#x65B9;&#x6CD5;&#x8FD9;&#x91CC;Andrew&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x8BBA;&#x3002;&#x5C31;&#x662F;&#x5728;&#x9700;&#x8981;&#x9519;&#x8BEF;&#x5206;&#x6790;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F8B;&#x5982;&#x73B0;&#x5728;&#x7684;&#x6A21;&#x578B;&#x7ED3;&#x679C;&#x4E0D;&#x6EE1;&#x610F;&#xFF0C;&#x6216;&#x8005;&#x4F60;&#x53D1;&#x73B0;&#x6837;&#x672C;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x518D;&#x6216;&#x8005;&#x540E;&#x9762;&#x63D0;&#x5230;&#x7684;&#x53EF;&#x80FD;&#x4F1A;&#x6709;data mismatch&#x7684;&#x60C5;&#x51B5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x4E0B;&#x9762;&#x63D0;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x53D1;&#x6398;&#x95EE;&#x9898;&#x6216;&#x8005;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684;&#x5730;&#x65B9;&#xFF1A;&#x53D6;&#x5927;&#x7EA6;100&#x4E2A;&#x6837;&#x672C;&#x5728;&#x8FD9;100&#x4E2A;&#x6837;&#x672C;&#x4E2D;&#xFF0C;&#x6570;&#x51FA;&#x9519;&#x8BEF;&#x7684;&#x6837;&#x672C;&#x6570;&#xFF0C;&#x5E76;&#x6807;&#x8BB0;&#x5230;&#x8868;&#x683C;&#x91CC;&#x63A8;&#x65AD;&#x6B63;&#x786E;&#x7684;&#x6837;&#x672C;&#x4E5F;&#x8981;&#x67E5;&#x770B;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x6837;&#x672C;&#x6807;&#x8BB0;&#x9519;&#x8BEF;&#xFF0C;&#x800C;&#x6A21;&#x578B;&#x7F3A;&#x9677;&#x5BFC;&#x81F4;&#x5176;&#x8D1F;&#x8D1F;&#x5F97;&#x6B63;&#xFF0C;&#x4ECE;&#x800C;&#x6070;&#x597D;&#x5F97;&#x51FA;&#x6B63;&#x786E;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x6837;&#x672C;&#x4E5F;&#x8981;&#x6311;&#x51FA;&#x6765;&#x3002;&#x6837;&#x672C;&#x9519;&#x8BEF;&#x600E;&#x4E48;&#x529E;&#xFF1F;In training set&#x901A;&#x5E38;&#x5982;&#x679C;&#x53EA;&#x662F;&#x968F;&#x673A;&#x9519;&#x8BEF;&#xFF0C;&#x56E0;&#x4E3A;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x672C;&#x8EAB;&#x5F88;&#x5584;&#x4E8E;&#x6D88;&#x9664;&#x968F;&#x673A;&#x9519;&#x8BEF;&#x5E26;&#x6765;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x5FC5;&#x7279;&#x522B;&#x7684;&#x53BB;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x968F;&#x673A;&#x7684;&#x6837;&#x672C;&#x9519;&#x8BEF;&#x3002;&#x5982;&#x679C;&#x662F;&#x7CFB;&#x7EDF;&#x9519;&#x8BEF;(systematic)&#xFF0C;&#x4F8B;&#x5982;&#x5C06;&#x6240;&#x6709;&#x7684;&#x767D;&#x8272;&#x5C0F;&#x72D7;&#x8BA4;&#x4F5C;&#x732B;&#x54AA;&#xFF0C;&#x90A3;&#x5C31;&#x9700;&#x8981;&#x53BB;&#x7EA0;&#x6B63;&#x4E86;&#x3002;&#x901A;&#x5E38;&#x8FD9;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x751F;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x6570;&#x636E;&#x91CF;&#x5F88;&#x5927;&#xFF0C;&#x53EA;&#x80FD;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;&#x4E0D;&#x53EF;&#x4FE1;&#x7684;&#x6570;&#x636E;&#x3002;In dev/test setdev/test set&#x4E2D;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x4E86;&#x9519;&#x8BEF;&#x6807;&#x8BB0;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x7EA0;&#x6B63;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;dev/test set&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5E76;&#x4E0D;&#x4F1A;&#x7528;&#x6765;&#x8FED;&#x4EE3;&#xFF0C;&#x800C;&#x662F;&#x7528;&#x6765;&#x5224;&#x65AD;&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x4F18;&#x52A3;&#x3002;&#x5982;&#x679C;&#x6570;&#x636E;&#x4E2D;&#x6709;&#x9519;&#x8BEF;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x4F1A;&#x5F71;&#x54CD;&#x8BC4;&#x5224;&#xFF0C;&#x8FDB;&#x800C;&#x5F71;&#x54CD;&#x6A21;&#x578B;&#x4FEE;&#x6539;&#x7684;&#x65B9;&#x5411;&#x3002;&#x6240;&#x4EE5;dev/test set&#x4E2D;&#x7684;&#x6570;&#x636E;&#x9519;&#x8BEF;&#x662F;&#x6709;&#x5BB3;&#x7684;&#xFF0C;&#x5FC5;&#x8981;&#x65F6;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x7EA0;&#x6B63;&#x3002;&#x5224;&#x65AD;&#x662F;&#x5426;&#x6709;&#x5FC5;&#x8981;&#x4FEE;&#x6B63;&#x7684;&#x65B9;&#x6CD5;&#x4ECD;&#x7136;&#x662F;&#x91C7;&#x7528;&#x524D;&#x4E00;&#x8282;&#x63D0;&#x5230;&#x7684;&#x9519;&#x8BEF;&#x5206;&#x6790;&#x65B9;&#x6CD5;&#xFF0C;&#x518D;&#x52A0;&#x4E0A;&#x4E00;&#x5217;Incorrectly labeled&#x3002;&#x5982;&#x679C;&#x6B64;&#x5217;&#x6570;&#x636E;&#x663E;&#x793A;&#x56E0;&#x4E3A;&#x9519;&#x6807;&#x6570;&#x636E;&#x5BFC;&#x81F4;&#x7684;&#x5224;&#x65AD;&#x9519;&#x8BEF;&#x8FBE;&#x5230;&#x8DB3;&#x591F;&#x7684;&#x767E;&#x5206;&#x6BD4;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x82B1;&#x70B9;&#x65F6;&#x95F4;&#x6765;&#x4FEE;&#x6B63;&#x8FD9;&#x4E9B;dev/test&#x96C6;&#x4E2D;&#x7684;&#x6837;&#x672C;&#x6570;&#x636E;&#x4E86;&#x3002; Some guide lines:Apply same process to your dev and test sets to make sure they continue to come from the same distribution. &#x4FDD;&#x8BC1;dev&#x548C;test&#x96C6;&#x6837;&#x672C;&#x5206;&#x5E03;&#x76F8;&#x540C;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x77DB;&#x76FE;&#x7684;&#x6A21;&#x578B;&#x8BC4;&#x4F30;&#x3002;Consider examining examples your algorithm got right as well as ones it got wrong. &#x8003;&#x8651;&#x8D1F;&#x8D1F;&#x5F97;&#x6B63;&#x7684;&#x60C5;&#x51B5;&#x3002;Train and dev/test data may now come from slightly different distribtuion. &#x56E0;&#x4E3A;&#x8BAD;&#x7EC3;&#x96C6;&#x6837;&#x672C;&#x592A;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x5BF9;&#x968F;&#x673A;&#x9519;&#x8BEF;&#x4E0D;&#x654F;&#x611F;&#xFF0C;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x4E0D;&#x53BB;&#x8C03;&#x6574;&#x8BAD;&#x7EC3;&#x96C6;&#x3002;&#x5982;&#x679C;&#x8C03;&#x6574;&#x4E86;&#x5F00;&#x53D1;&#x548C;&#x6D4B;&#x8BD5;&#x96C6;&#x5C31;&#x53EF;&#x80FD;&#x5F15;&#x5165;data mismatch&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5982;&#x679C;&#x6000;&#x7591;data mismatch&#x53D1;&#x751F;&#x4E86;&#xFF0C;&#x5C31;&#x8981;&#x7528;&#x524D;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x6765;get some insight&#x3002;Build your first system quickly, then iterate.&#x8BAD;&#x7EC3;&#x96C6;&#x4E0E;&#x5F00;&#x53D1;/&#x6D4B;&#x8BD5;&#x96C6;&#x5206;&#x5E03;&#x4E0D;&#x540C;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6709;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;Andrew&#x4E3E;&#x4E86;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;cat detector&#x548C;rear view mirror&#x3002;&#x5F88;&#x751F;&#x52A8;&#x3002;&#x6458;&#x53D6;cat detector&#x6765;&#x4F5C;&#x4E3A;&#x7B14;&#x8BB0;&#xFF1A;&#x5982;&#x4F55;&#x5224;&#x65AD;data mismatch&#x65B9;&#x6CD5;&#x662F;&#x4ECE;&#x8BAD;&#x7EC3;&#x96C6;&#x4E2D;&#x518D;&#x5206;&#x5272;&#x51FA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x96C6;&#x53EB;&#xFF1A;training-dev set (&#x8BAD;&#x7EC3;-&#x5F00;&#x53D1;&#x96C6;) Human Level 4% avoidable bias Training set error 7% variance Training-dev set error 10% data mismatch Dev error 12% degree of overfitting to dev set Test error 12% &#x5F53;dev error&#x4E0E;training-dev error&#x76F8;&#x5DEE;&#x8FC7;&#x5927;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x53D1;&#x751F;&#x4E86;data mismatch&#x95EE;&#x9898;&#x3002;Test error&#x4E0E;dev error&#x901A;&#x5E38;&#x5E94;&#x8BE5;&#x4E00;&#x81F4;&#xFF0C;&#x5982;&#x679C;&#x76F8;&#x5DEE;&#x8FC7;&#x8FDC;&#xFF0C;&#x8BF4;&#x660E;&#x6A21;&#x578B;&#x5728;&#x5F00;&#x53D1;&#x96C6;&#x4E0A;&#x4E5F;&#x51FA;&#x73B0;&#x4E86;overfitting&#x3002;&#x8003;&#x8651;&#x8981;&#x6269;&#x5927;&#x5F00;&#x53D1;&#x96C6;&#x51FA;&#x73B0;data mismatch&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x5F53;&#x53D1;&#x751F;data mismatch&#x7684;&#x65F6;&#x5019;&#xFF1A;Carry out manual error analysis to try to understand difference between training and dev/test setsMake training data more similar; or collect more data similar to dev/test sets.&#x9488;&#x5BF9;&#x7B2C;&#x4E8C;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x6570;&#x636E;&#x5408;&#x6210;(data synthesis)&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4EE5;&#x524D;&#x63D0;&#x5230;&#x8FC7;&#x7684;data augment&#x3002;&#x6570;&#x636E;&#x5408;&#x6210;&#x662F;&#x6709;&#x6548;&#x7684;&#x3002;&#x4F46;&#x662F;&#x8981;&#x5C0F;&#x5FC3;&#x7684;&#x662F;&#xFF0C;&#x6570;&#x636E;&#x5408;&#x6210;&#x901A;&#x5E38;&#x53EA;&#x80FD;&#x6A21;&#x62DF;&#x771F;&#x5B9E;&#x4E16;&#x754C;&#x7684;&#x5F88;&#x5C0F;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4F60;&#x7684;&#x6A21;&#x578B;&#x662F;&#x6709;&#x53EF;&#x80FD;&#x5BF9;&#x8FD9;&#x5F88;&#x5C0F;&#x4E00;&#x90E8;&#x5206;over tune&#x3002;&#x6240;&#x4EE5;&#x8981;&#x6CE8;&#x610F;&#x8FD0;&#x7528;variance tactics&#x6765;&#x5B9A;&#x4F4D;&#x548C;&#x89E3;&#x51B3;&#x6B64;&#x65F6;&#x7684;overfitting&#x3002;%23%20Deep%20Learning%20%288%29%20-%20Error%20Analysis%0A@%28myblog%29%5Bmachine%20learning%2C%20deep%20learning%5D%0A%0A%u8FD9%u91CC%u6211%u89C9%u5F97%u5E94%u5F53%u7FFB%u4F5C%u9519%u8BEF%u5206%u6790%uFF0C%u800C%u975E%u8BEF%u5DEE%u5206%u6790%u3002%u91CD%u70B9%u9610%u8FF0%u4E24%u4E2A%u95EE%u9898%uFF1A%0A-%20%u6570%u636E%u96C6%u672C%u8EAB%u6709%u9519%u8BEF%u600E%u4E48%u529E%0A-%20%u6709%u4E9B%u60C5%u51B5%u56E0%u4E3A%u6837%u672C%u6570%u636E%u672C%u8EAB%u7684%u5C40%u9650%uFF0C%u5BFC%u81F4training%20set%u548Cdev/test%20set%u5206%u5E03%u4E0D%u540C%u600E%u4E48%u529E%uFF1F%u662F%u5426%u51FA%u73B0data%20mismatch%uFF1F%u5982%u679C%u51FA%u73B0%u4E86%uFF0C%u600E%u4E48%u529E%uFF1F%0A%0A%23%23%20%u9519%u8BEF%u5206%u6790%u65B9%u6CD5%0A%u8FD9%u91CCAndrew%u629B%u51FA%u4E00%u4E2A%u65B9%u6CD5%u8BBA%u3002%u5C31%u662F%u5728%u9700%u8981%u9519%u8BEF%u5206%u6790%u7684%u65F6%u5019%uFF0C%u4F8B%u5982%u73B0%u5728%u7684%u6A21%u578B%u7ED3%u679C%u4E0D%u6EE1%u610F%uFF0C%u6216%u8005%u4F60%u53D1%u73B0%u6837%u672C%u6570%u636E%u53EF%u80FD%u6709%u95EE%u9898%uFF0C%u518D%u6216%u8005%u540E%u9762%u63D0%u5230%u7684%u53EF%u80FD%u4F1A%u6709data%20mismatch%u7684%u60C5%u51B5%u7684%u65F6%u5019%uFF0C%u90FD%u53EF%u4EE5%u91C7%u7528%u4E0B%u9762%u63D0%u5230%u7684%u65B9%u6CD5%uFF0C%u6765%u53D1%u6398%u95EE%u9898%u6216%u8005%u9519%u8BEF%u53EF%u80FD%u5B58%u5728%u7684%u5730%u65B9%uFF1A%0A%21%5BAlt%20text%7C550x0%5D%28./1536007558086.png%29%0A-%20%u53D6%u5927%u7EA6100%u4E2A%u6837%u672C%0A-%20%u5728%u8FD9100%u4E2A%u6837%u672C%u4E2D%uFF0C%u6570%u51FA%u9519%u8BEF%u7684%u6837%u672C%u6570%uFF0C%u5E76%u6807%u8BB0%u5230%u8868%u683C%u91CC%0A-%20%u63A8%u65AD%u6B63%u786E%u7684%u6837%u672C%u4E5F%u8981%u67E5%u770B%uFF0C%u6709%u53EF%u80FD%u5B58%u5728%u6837%u672C%u6807%u8BB0%u9519%u8BEF%uFF0C%u800C%u6A21%u578B%u7F3A%u9677%u5BFC%u81F4%u5176%u8D1F%u8D1F%u5F97%u6B63%uFF0C%u4ECE%u800C%u6070%u597D%u5F97%u51FA%u6B63%u786E%u7684%u7ED3%u679C%u3002%u8FD9%u6837%u7684%u6837%u672C%u4E5F%u8981%u6311%u51FA%u6765%u3002%0A%0A%23%23%20%u6837%u672C%u9519%u8BEF%u600E%u4E48%u529E%uFF1F%0A%23%23%23%20In%20training%20set%0A%u901A%u5E38%u5982%u679C%u53EA%u662F%u968F%u673A%u9519%u8BEF%uFF0C%u56E0%u4E3A%u673A%u5668%u5B66%u4E60%u672C%u8EAB%u5F88%u5584%u4E8E%u6D88%u9664%u968F%u673A%u9519%u8BEF%u5E26%u6765%u7684%u5F71%u54CD%uFF0C%u6240%u4EE5%u4E0D%u5FC5%u7279%u522B%u7684%u53BB%u5904%u7406%u8FD9%u4E9B%u968F%u673A%u7684%u6837%u672C%u9519%u8BEF%u3002%u5982%u679C%u662F%u7CFB%u7EDF%u9519%u8BEF%28systematic%29%uFF0C%u4F8B%u5982%u5C06%u6240%u6709%u7684%u767D%u8272%u5C0F%u72D7%u8BA4%u4F5C%u732B%u54AA%uFF0C%u90A3%u5C31%u9700%u8981%u53BB%u7EA0%u6B63%u4E86%u3002%u901A%u5E38%u8FD9%u4E0D%u592A%u53EF%u80FD%uFF0C%u5982%u679C%u53D1%u751F%u4E86%uFF0C%u800C%u4E14%u6570%u636E%u91CF%u5F88%u5927%uFF0C%u53EA%u80FD%u8BF4%u660E%u6211%u4EEC%u4F7F%u7528%u4E86%u4E0D%u53EF%u4FE1%u7684%u6570%u636E%u3002%0A%0A%23%23%23%20In%20dev/test%20set%0Adev/test%20set%u4E2D%u5982%u679C%u53D1%u73B0%u4E86%u9519%u8BEF%u6807%u8BB0%u7684%u6570%u636E%uFF0C%u8FD8%u662F%u9700%u8981%u7EA0%u6B63%u51FA%u6765%u7684%uFF0C%u56E0%u4E3Adev/test%20set%u4E2D%u7684%u6570%u636E%u5E76%u4E0D%u4F1A%u7528%u6765%u8FED%u4EE3%uFF0C%u800C%u662F%u7528%u6765%u5224%u65AD%u6A21%u578B%u4E4B%u95F4%u7684%u4F18%u52A3%u3002%u5982%u679C%u6570%u636E%u4E2D%u6709%u9519%u8BEF%u7684%u5B58%u5728%uFF0C%u4F1A%u5F71%u54CD%u8BC4%u5224%uFF0C%u8FDB%u800C%u5F71%u54CD%u6A21%u578B%u4FEE%u6539%u7684%u65B9%u5411%u3002%u6240%u4EE5dev/test%20set%u4E2D%u7684%u6570%u636E%u9519%u8BEF%u662F%u6709%u5BB3%u7684%uFF0C%u5FC5%u8981%u65F6%u8FD8%u662F%u9700%u8981%u7EA0%u6B63%u3002%u5224%u65AD%u662F%u5426%u6709%u5FC5%u8981%u4FEE%u6B63%u7684%u65B9%u6CD5%u4ECD%u7136%u662F%u91C7%u7528%u524D%u4E00%u8282%u63D0%u5230%u7684%u9519%u8BEF%u5206%u6790%u65B9%u6CD5%uFF0C%u518D%u52A0%u4E0A%u4E00%u5217Incorrectly%20labeled%u3002%u5982%u679C%u6B64%u5217%u6570%u636E%u663E%u793A%u56E0%u4E3A%u9519%u6807%u6570%u636E%u5BFC%u81F4%u7684%u5224%u65AD%u9519%u8BEF%u8FBE%u5230%u8DB3%u591F%u7684%u767E%u5206%u6BD4%uFF0C%u6211%u4EEC%u5C31%u8981%u82B1%u70B9%u65F6%u95F4%u6765%u4FEE%u6B63%u8FD9%u4E9Bdev/test%u96C6%u4E2D%u7684%u6837%u672C%u6570%u636E%u4E86%u3002%0ASome%20guide%20lines%3A%0A-%20Apply%20same%20process%20to%20your%20dev%20and%20test%20sets%20to%20make%20sure%20they%20continue%20to%20come%20from%20the%20same%20distribution.%20%u4FDD%u8BC1dev%u548Ctest%u96C6%u6837%u672C%u5206%u5E03%u76F8%u540C%uFF0C%u5426%u5219%u4F1A%u51FA%u73B0%u77DB%u76FE%u7684%u6A21%u578B%u8BC4%u4F30%u3002%0A-%20Consider%20examining%20examples%20your%20algorithm%20got%20right%20as%20well%20as%20ones%20it%20got%20wrong.%20%u8003%u8651%u8D1F%u8D1F%u5F97%u6B63%u7684%u60C5%u51B5%u3002%0A-%20Train%20and%20dev/test%20data%20may%20now%20come%20from%20slightly%20different%20distribtuion.%20%u56E0%u4E3A%u8BAD%u7EC3%u96C6%u6837%u672C%u592A%u591A%uFF0C%u800C%u4E14%u5BF9%u968F%u673A%u9519%u8BEF%u4E0D%u654F%u611F%uFF0C%u6240%u4EE5%u901A%u5E38%u4E0D%u53BB%u8C03%u6574%u8BAD%u7EC3%u96C6%u3002%u5982%u679C%u8C03%u6574%u4E86%u5F00%u53D1%u548C%u6D4B%u8BD5%u96C6%u5C31%u53EF%u80FD%u5F15%u5165data%20mismatch%u7684%u60C5%u51B5%u3002%u5982%u679C%u6000%u7591data%20mismatch%u53D1%u751F%u4E86%uFF0C%u5C31%u8981%u7528%u524D%u9762%u7684%u65B9%u6CD5%u6765get%20some%20insight%u3002%0A%0A%3E%20**Build%20your%20first%20system%20quickly%2C%20then%20iterate.**%0A%0A%23%23%20%u8BAD%u7EC3%u96C6%u4E0E%u5F00%u53D1/%u6D4B%u8BD5%u96C6%u5206%u5E03%u4E0D%u540C%0A%23%23%23%20%u4E3A%u4EC0%u4E48%u4F1A%u6709%u8FD9%u79CD%u60C5%u51B5%0AAndrew%u4E3E%u4E86%u4E24%u4E2A%u4F8B%u5B50%uFF1Acat%20detector%u548Crear%20view%20mirror%u3002%u5F88%u751F%u52A8%u3002%u6458%u53D6cat%20detector%u6765%u4F5C%u4E3A%u7B14%u8BB0%uFF1A%0A%21%5BAlt%20text%5D%28./1536010240549.png%29%0A%u6211%u4EEC%u8BAD%u7EC3%u7684%u65F6%u5019%u7528%u7684%u662F%u5DE6%u8FB9%u7684%u6570%u636E%u96C6%uFF0C%u6765%u81EA%u4E8E%u7F51%u7EDC%uFF0C%u6E05%u6670%u5EA6%u5F88%u9AD8%uFF0C%u732B%u54AA%u5F62%u6001%u4E5F%u5F88%u5B8C%u6574%u3002%u800Capp%u4E0A%u7EBF%u540E%uFF0C%u9700%u8981%u9884%u6D4B%u7684%u662F%u53F3%u8FB9%u7684%u6570%u636E%uFF0C%u6A21%u7CCA%u4E0D%u6E05%uFF0C%u732B%u54AA%u8868%u60C5%u5404%u5F02%uFF0C%u6548%u679C%u5F88%u5DEE%u3002%u5DE6%u8FB9%u7684%u6570%u636E%u96C6%u6570%u636E%u53EF%u89C2%uFF0C%u6709200%2C000%uFF0C%u53F3%u8FB9%u6570%u636E%u6709%u9650%uFF0C%u53EA%u670910%2C000%u3002%u90A3%u73B0%u5728%u8BE5%u600E%u4E48%u529E%uFF1F%0A%u6309%u7167%u4E4B%u524D%u7406%u60F3%u7684%u72B6%u51B5%uFF0C%u6211%u4EEC%u5E94%u8BE5%u628A%u8FD910k%u7684%u7528%u6237%u6570%u636E%u548C20k%u7684%u8BAD%u7EC3%u6837%u672C%u6570%u636E%u6DF7%u7F16%uFF0C%u518D%u968F%u673A%u5207%u5272%u6210%u8BAD%u7EC3%uFF0C%u5F00%u53D1/%u6D4B%u8BD5%u96C6%u3002%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%7C550x0%5D%28./1536010459428.png%29%0A%u8FD9%u6837%u663E%u7136%u4E0D%u5408%u9002%uFF0C%u56E0%u4E3A%u5F00%u53D1/%u6D4B%u8BD5%u96C6%u9700%u8981%u53CD%u6620%u6211%u4EEC%u7684%u771F%u5B9E%u9700%u6C42%u3002%u6211%u4EEC%u771F%u6B63%u5728%u4E4E%u7684%u662F%u90A3%u4E9B%u6A21%u7CCA%u7684%uFF0C%u8868%u60C5%u5404%u5F02%u7684%u7528%u6237%u732B%u54AA%u56FE%u7247%uFF0C%u800C%u6309%u8FD9%u79CD%u89C4%u5219%u5207%u5272%u51FA%u6765%u7684%u5F00%u53D1/%u6D4B%u8BD5%u96C6%u4E2D%u53EA%u67095%25%u4E0D%u5230%u7684%u6211%u4EEC%u5728%u4E4E%u7684%u6570%u636E%u3002%u663E%u7136%u8FD9%u4E2A%u9879%u76EE%u7684%u76EE%u6807%u8BBE%u504F%u4E86%u3002%0A%u6BD4%u8F83%u597D%u7684%u505A%u6CD5%u662F%uFF0C%u5C06%u7528%u6237%u4E0A%u4F20%u6570%u636E%u4E00%u5206%u4E3A%u4E8C%uFF0C%u5F00%u53D1/%u6D4B%u8BD5%u96C6%u5168%u90E8%u91C7%u7528%u4E00%u534A%uFF0C%u53E6%u4E00%u534A%u5F52%u5165%u8BAD%u7EC3%u96C6%u505A%u8BAD%u7EC3%u3002%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%7C550x0%5D%28./1536010736876.png%29%0A%u8FD9%u6837%u505A%u7684%u597D%u5904%u662F%uFF0C%u76EE%u6807%u51C6%u786E%uFF0C%u574F%u5904%u662F%u53EF%u80FD%u5F15%u5165data%20mismatch%u95EE%u9898%u3002%0A%0A%23%23%23%20%u5982%u4F55%u5224%u65ADdata%20mismatch%0A%u65B9%u6CD5%u662F%u4ECE%u8BAD%u7EC3%u96C6%u4E2D%u518D%u5206%u5272%u51FA%u4E00%u4E2A%u6570%u636E%u96C6%u53EB%uFF1Atraining-dev%20set%20%28%u8BAD%u7EC3-%u5F00%u53D1%u96C6%29%0A%7C%20Human%20Level%20%20%20%20%20%20%20%20%20%20%20%7C%204%25%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20%3A--------------------%20%7C%20%3A-%3A%20%7C%20%3A-------------------------------%20%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%7C%20avoidable%20bias%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20Training%20set%20error%20%20%20%20%7C%207%25%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%7C%20variance%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20Training-dev%20set%20error%7C%2010%25%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%7C%20**data%20mismatch**%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20Dev%20error%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%2012%25%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%7C%20degree%20of%20overfitting%20to%20dev%20set%20%7C%0A%7C%20Test%20error%20%20%20%20%20%20%20%20%20%20%20%20%7C%2012%25%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%u5F53dev%20error%u4E0Etraining-dev%20error%u76F8%u5DEE%u8FC7%u5927%u7684%u65F6%u5019%uFF0C%u5C31%u53EF%u4EE5%u8BA4%u4E3A%u53D1%u751F%u4E86data%20mismatch%u95EE%u9898%u3002%0A%3E*Test%20error%u4E0Edev%20error%u901A%u5E38%u5E94%u8BE5%u4E00%u81F4%uFF0C%u5982%u679C%u76F8%u5DEE%u8FC7%u8FDC%uFF0C%u8BF4%u660E%u6A21%u578B%u5728%u5F00%u53D1%u96C6%u4E0A%u4E5F%u51FA%u73B0%u4E86overfitting%u3002%u8003%u8651%u8981%u6269%u5927%u5F00%u53D1%u96C6*%0A%0A%23%23%23%20%u51FA%u73B0data%20mismatch%u600E%u4E48%u529E%uFF1F%0A%0A%u5F53%u53D1%u751Fdata%20mismatch%u7684%u65F6%u5019%uFF1A%0A-%20Carry%20out%20manual%20error%20analysis%20to%20try%20to%20understand%20difference%20between%20training%20and%20dev/test%20sets%0A-%20Make%20training%20data%20more%20similar%3B%20or%20collect%20more%20data%20similar%20to%20dev/test%20sets.%0A%0A%u9488%u5BF9%u7B2C%u4E8C%u70B9%uFF0C%u53EF%u4EE5%u91C7%u7528%u6570%u636E%u5408%u6210%28data%20synthesis%29%uFF0C%u4E5F%u5C31%u662F%u4EE5%u524D%u63D0%u5230%u8FC7%u7684data%20augment%u3002%u6570%u636E%u5408%u6210%u662F%u6709%u6548%u7684%u3002%u4F46%u662F%u8981%u5C0F%u5FC3%u7684%u662F%uFF0C%u6570%u636E%u5408%u6210%u901A%u5E38%u53EA%u80FD%u6A21%u62DF%u771F%u5B9E%u4E16%u754C%u7684%u5F88%u5C0F%u4E00%u90E8%u5206%uFF0C%u4F60%u7684%u6A21%u578B%u662F%u6709%u53EF%u80FD%u5BF9%u8FD9%u5F88%u5C0F%u4E00%u90E8%u5206over%20tune%u3002%u6240%u4EE5%u8981%u6CE8%u610F%u8FD0%u7528variance%20tactics%u6765%u5B9A%u4F4D%u548C%u89E3%u51B3%u6B64%u65F6%u7684overfitting%u3002%0A]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (7) - Machine Learning Strategy]]></title>
    <url>%2F2018%2F09%2F02%2FDeep_Learning_(7)_-_Machine_Learning_Strategy%2F</url>
    <content type="text"><![CDATA[Edit&#x6240;&#x8C13;Machine Learning Strategy&#x5C31;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x6574;&#x5B66;&#x4E60;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x6765;&#x8FBE;&#x5230;&#x66F4;&#x597D;&#x7684;&#x51C6;&#x786E;&#x7387;&#x3002;Andrew&#x63D0;&#x5230;&#x8FD9;&#x4E00;&#x95E8;&#x8BFE;(Structuring Machine Learning Projects)&#x7684;&#x4E24;&#x5468;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E9B;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x9879;&#x76EE;&#x7684;&#x7ECF;&#x9A8C;&#x4E4B;&#x8C08;&#xFF0C;&#x5728;&#x5B66;&#x6821;&#x7684;&#x8BFE;&#x7A0B;&#x4E2D;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x6709;&#x63D0;&#x53CA;&#x3002;OrthogonalizationOrthogonalization&#xFF0C;&#x8BD1;&#x4F5C;&#x6B63;&#x4EA4;&#x5316;&#xFF0C;&#x7C7B;&#x4F3C;coding&#x65F6;&#x5019;&#x7684;&#x89E3;&#x8026;(decouple)&#x3002;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x6B63;&#x4EA4;&#x5316;&#x7684;&#x8C03;&#x6574;&#x7B56;&#x7565;&#x6765;&#x4FEE;&#x6B63;&#x76F8;&#x5173;&#x6761;&#x4EF6;&#x4E0B;&#x7684;&#x6A21;&#x578B;&#x51C6;&#x786E;&#x7387;&#x3002;&#x4E00;&#x822C;&#x6709;&#x4E0B;&#x9762;4&#x4E2D;&#x7B56;&#x7565;&#xFF1A;When a supervised learning system is design, these are the 4 assumptions that needs to be true and orthogonal.Fit training set well in cost function If it doesn&#x2019;t fit well, the use of a bigger neural network or switching to a better optimization algorithm might help.Fit development set well on cost function If it doesn&#x2019;t fit well, regularization or using bigger training set might help.Fit test set well on cost function If it doesn&#x2019;t fit well, the use of a bigger development set might helpPerforms well in real world If it doesn&#x2019;t perform well, the development test set is not set correctly or the cost function is not evaluating the right thing.Andrew&#x4E5F;&#x63D0;&#x5230;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x4E00;&#x79CD;regularization&#x7684;&#x65B9;&#x6CD5;&#x2014;&#x2014;early stopping&#xFF0C;&#x5C31;&#x4E0D;&#x662F;&#x4E00;&#x79CD;&#x6B63;&#x4EA4;&#x5316;&#x7684;&#x8C03;&#x6574;&#x7B56;&#x7565;&#x3002;&#x4ED6;&#x540C;&#x65F6;&#x60F3;&#x505A;&#x597D;&#x7B2C;1&#x548C;&#x7B2C;2&#x70B9;&#x3002;Setting up your goal&#x505A;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;Idea-&gt;Code-&gt;Experiment-&gt;Idea&#xFF0C;&#x4E0D;&#x65AD;&#x7684;&#x8FED;&#x4EE3;&#x5F97;&#x5230;&#x6700;&#x7EC8;&#x4F18;&#x5316;&#x7684;&#x6A21;&#x578B;&#x3002;Single real number evaluation metric&#x5982;&#x679C;&#x9488;&#x5BF9;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6709;&#x4E24;&#x4E2A;&#x6307;&#x6570;&#x578B;&#x6307;&#x6807;&#xFF0C;&#x8FD9;&#x5C31;&#x5F88;&#x96BE;&#x53D6;&#x820D;&#x3002;&#x8FD9;&#x4F1A;&#x964D;&#x4F4E;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x7684;&#x6548;&#x7387;&#xFF0C;&#x751A;&#x81F3;&#x6700;&#x7EC8;&#x7684;&#x6A21;&#x578B;&#x51C6;&#x786E;&#x5EA6;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x624D;&#x4F1A;&#x63D0;&#x51FA;&#x5355;&#x4E00;&#x8BC4;&#x4EF7;&#x6807;&#x51C6;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;Precision: Of all the images we predicted y=1, what fraction of it have cats? Recall: Of all the images that actually have cats, what fraction of it did we correctly identifying have cats?&#x8FD9;&#x4E24;&#x4E2A;&#x6307;&#x6807;&#x5F53;&#x7136;&#x90FD;&#x662F;&#x8D8A;&#x5927;&#x8D8A;&#x597D;&#xFF0C;&#x90A3;&#x5982;&#x4F55;&#x8BC4;&#x5B9A;Classifier A&#x548C;B&#xFF1F; &#x4E4B;&#x524D;&#x7684;&#x4E00;&#x7BC7;&#x535A;&#x6587;Machine Learning (2) - Neural Network&#x4E2D;&#x5173;&#x4E8E;skewed data&#x7684;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6709;&#x63D0;&#x5230;F1-score&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x901A;&#x8FC7;F1-score&#x6765;&#x6574;&#x5408;precision&#x548C;recall&#x6765;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x6807;&#x51C6;&#x3002; F1-score &#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x53C8;&#x79F0;&#x4E3A;&#x201D;Harmonic Mean&#x201D;&#x3002;&#x8BA1;&#x7B97;Precision&#x548C;Recall&#x7684;&#x201D;&#x5747;&#x503C;&#x201C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x8981;&#x81EA;&#x5DF1;&#x601D;&#x8003;&#x51FA;&#x5982;&#x4F55;&#x80FD;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x6613;&#x4E8E;&#x8BC4;&#x4F30;&#x7684;&#x5355;&#x4E00;&#x6307;&#x6570;&#x6807;&#x51C6;&#x3002;Satisficing and Optimizing&#x8FD9;&#x91CC;&#x6307;&#xFF0C;&#x68C0;&#x9A8C;&#x8BD5;&#x9A8C;&#x7ED3;&#x679C;&#x7684;&#x6307;&#x6807;&#xFF0C;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x5206;&#x6210;&#x4E24;&#x7C7B;&#xFF0C;&#x5373;Satisficing&#x548C;Optimizing&#x3002; Satisficing&#x7C7B;&#x6307;&#x6807;&#x6307;&#x7684;&#x662F;&#x53EA;&#x8981;&#x8FBE;&#x5230;&#x4E00;&#x5B9A;&#x7684;&#x9608;&#x503C;&#xFF0C;&#x518D;&#x4F18;&#x5316;&#x4E5F;&#x4E0D;&#x592A;&#x4F1A;&#x5F71;&#x54CD;&#x8BD5;&#x9A8C;&#x7ED3;&#x679C;&#x7684;&#x4F18;&#x52A3;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x8FBE;&#x5230;100ms&#x5373;&#x53EF;&#xFF0C;80ms&#x548C;90ms&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5DEE;&#x522B;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x5E26;&#x6765;&#x4EC0;&#x4E48;&#x6539;&#x5584;&#x3002; Optimizing&#x7C7B;&#x6307;&#x6807;&#x6307;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x4E9B;&#x6570;&#x503C;&#x7C7B;&#x7684;&#x6307;&#x6807;&#xFF0C;&#x4F8B;&#x5982;&#x51C6;&#x786E;&#x7387;&#xFF0C;&#x4E00;&#x70B9;&#x70B9;&#x6539;&#x5584;&#x90FD;&#x4F1A;&#x5F71;&#x54CD;&#x8BD5;&#x9A8C;&#x7ED3;&#x679C;&#x7684;&#x8BC4;&#x5224;&#x3002; &#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;Train/dev/test distributions&#x5728;&#x505A;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x5BF9;&#x6837;&#x672C;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5206;&#x5272;&#x3002;&#x800C;&#x4E0D;&#x662F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x6837;&#x672C;&#x90FD;&#x7528;&#x4E8E;&#x8BAD;&#x7EC3;&#x3002;&#x4E0A;&#x4E00;&#x7AE0;&#x63D0;&#x5230;&#x8981;&#x5BF9;&#x8BD5;&#x9A8C;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x8BC4;&#x4F30;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x8BC4;&#x4F30;&#x5C31;&#x662F;&#x5728;dev&#x6216;&#x8005;test set&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x7684;dev/test set&#x5BF9;&#x6A21;&#x578B;&#x7684;&#x8FED;&#x4EE3;&#x4EE5;&#x53CA;&#x9879;&#x76EE;&#x7684;&#x63A8;&#x8FDB;&#xFF0C;&#x6709;&#x7740;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x7684;&#x5F71;&#x54CD;&#x3002;Training set: &#x8FED;&#x4EE3;&#x5F97;&#x5230;&#x5404;&#x4E2A;&#x6A21;&#x578B;&#x53C2;&#x6570;(W, b, , )Development (dev) set: &#x5728;&#x4E00;&#x8F6E;&#x5FAA;&#x73AF;&#x4E2D;&#x9A8C;&#x8BC1;training&#x7ED3;&#x679C;&#x7684;&#x6B63;&#x786E;&#x6027;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0B;&#x4E00;&#x8F6E;&#x8C03;&#x6574;&#x6A21;&#x578B;(&#x5305;&#x62EC;&#x8D85;&#x53C2;&#x6570;&#x7684;&#x8C03;&#x6574;&#xFF0C;&#x662F;&#x5426;&#x91C7;&#x7528;&#x6B63;&#x5219;&#x5316;&#xFF0C;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x7684;&#x8C03;&#x6574;&#x7B49;&#x7B49;)Test set: &#x5728;&#x6240;&#x6709;&#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x6765;&#x9A8C;&#x8BC1;&#x6700;&#x7EC8;&#x6A21;&#x578B;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;&#x5982;&#x4F55;&#x5206;&#x5272;&#xFF1F;&#x5728;&#x6837;&#x672C;&#x6570;&#x636E;&#x4E0D;&#x592A;&#x591A;(&#x6570;&#x5343;&#x6570;&#x4E07;&#x7684;&#x7EA7;&#x522B;)&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x822C;&#x5982;&#x4E0B;&#x5206;&#x5272;&#xFF1A;Guide Line&#x540C;&#x4E00;&#x5206;&#x5E03;&#x5206;&#x5272;&#x6837;&#x672C;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;training&#xFF0C;dev&#xFF0C;test set&#x5747;&#x6765;&#x81EA;&#x4E8E;&#x540C;&#x4E00;&#x79CD;&#x5206;&#x5E03;&#x3002;&#x53CD;&#x6620;&#x6700;&#x7EC8;&#x5E94;&#x7528;&#x573A;&#x666F;dev/test set&#x5FC5;&#x987B;&#x53CD;&#x5E94;&#x6700;&#x7EC8;&#x6A21;&#x578B;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;&#x3002; &#x4F8B;&#x5982;cat detector&#xFF0C;&#x8BAD;&#x7EC3;&#xFF0C;&#x6D4B;&#x8BD5;&#x90FD;&#x662F;&#x91C7;&#x7528;&#x7F51;&#x7EDC;&#x4E0A;&#x6E05;&#x6670;&#x5EA6;&#x5F88;&#x9AD8;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x4F46;&#x4F7F;&#x7528;&#x65F6;&#x53D1;&#x73B0;&#x7528;&#x6237;&#x4E0A;&#x4F20;&#x7684;&#x5F88;&#x591A;&#x90FD;&#x662F;&#x6E05;&#x6670;&#x5EA6;&#x4E0D;&#x9AD8;&#x7684;&#x7167;&#x7247;&#xFF0C;&#x90A3;&#x8BC6;&#x522B;&#x7387;&#x80AF;&#x5B9A;&#x662F;&#x4E0D;&#x80FD;&#x4EE4;&#x4EBA;&#x6EE1;&#x610F;&#x7684;&#x3002;&#x8FD9;&#x5C31;&#x662F;dev/test set&#x548C;&#x6700;&#x7EC8;&#x5E94;&#x7528;&#x4E0D;&#x7B26;&#x3002;&#x6539;&#x8FDB;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#xFF0C;&#x8981;&#x4E48;&#x53EF;&#x4EE5;&#x591A;&#x91C7;&#x7528;&#x4E00;&#x4E9B;&#x771F;&#x5B9E;&#x7684;&#x7528;&#x6237;&#x6570;&#x636E;&#xFF0C;&#x6216;&#x8005;&#x91C7;&#x7528;data augmentation&#x6765;&#x4EBA;&#x5DE5;&#x6DFB;&#x52A0;&#x566A;&#x58F0;&#xFF0C;&#x8BA9;&#x539F;&#x672C;&#x6E05;&#x6670;&#x7684;&#x56FE;&#x7247;&#x53D8;&#x6210;&#x6A21;&#x7CCA;&#x7684;&#x3002;&#x603B;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5C31;&#x662F;&#x6539;&#x8FDB;&#x8BAD;&#x7EC3;&#x96C6;&#x548C;&#x6D4B;&#x8BD5;&#x5F00;&#x53D1;&#x96C6;&#x518D;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;&#x3002;&#x5982;&#x679C;&#x6709;&#x7279;&#x522B;&#x4E0D;&#x60F3;&#x8981;&#x7684;&#x6307;&#x6807;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BD4;&#x5982;cat detector&#x4F1A;&#x8BEF;&#x5C06;&#x8272;&#x60C5;&#x56FE;&#x7247;&#x8BC6;&#x522B;&#x4E3A;&#x732B;&#x54AA;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x4E0D;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#xFF0C;&#x4E0D;&#x7BA1;&#x6A21;&#x578B;&#x7CBE;&#x5EA6;&#x6709;&#x591A;&#x9AD8;&#x3002;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x4FEE;&#x6539;metric&#xFF1A; Error: if is non-porn, if is porn.&#x6700;&#x7EC8;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x5411;&#x4E3A;&#x4EC0;&#x4E48;&#x4EE5;&#x4EBA;&#x7C7B;&#x8868;&#x73B0;&#x4F5C;&#x4E3A;&#x5206;&#x6C34;&#x5CAD;&#xFF1F;&#x56E0;&#x4E3A;&#x4EBA;&#x7C7B;&#x5728;&#x81EA;&#x7136;&#x611F;&#x77E5;(Natural Perception)&#x65B9;&#x9762;&#x5DF2;&#x7ECF;&#x5F88;&#x64C5;&#x957F;&#x4E86;&#x3002;&#x800C;&#x5728;&#x6A21;&#x578B;&#x672A;&#x8FBE;&#x5230;&#x4EBA;&#x7C7B;&#x8868;&#x73B0;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5404;&#x79CD;&#x5DE5;&#x5177;&#x6765;&#x6539;&#x5584;&#x4F60;&#x7684;&#x5B66;&#x4E60;&#x6A21;&#x578B;&#x3002;&#x4F46;&#x5F53;&#x6A21;&#x578B;&#x8FBE;&#x5230;&#x6216;&#x8005;&#x8D85;&#x8FC7;&#x4EBA;&#x7C7B;&#x8868;&#x73B0;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x5C31;&#x5931;&#x6548;&#x4E86;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x4E5F;&#x662F;&#x901A;&#x8FC7;&#x4EBA;&#x7C7B;&#x611F;&#x77E5;&#x6765;&#x5236;&#x9020;&#x7684;&#x3002;&#x4EC0;&#x4E48;&#x662F;Avoidable Bias&#xFF1F;&#x901A;&#x5E38;&#x7528;&#x4EBA;&#x7C7B;&#x8868;&#x73B0;&#x6765;&#x8FD1;&#x4F3C;&#x8D1D;&#x53F6;&#x65AF;&#x6700;&#x4F18;&#x8BEF;&#x5DEE;&#x3002;If | human-level error - training error | | training error - development error |, focus on bias (avoidable bias) reduction techniqueIf | human-level error - training error | | training error - development error |, focus on variance reduction technique&#x8D85;&#x8FC7;&#x4EBA;&#x7C7B;&#x8868;&#x73B0;&#x540E;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#xFF0C;&#x6CA1;&#x529E;&#x6CD5;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x597D;&#x7684;&#x529E;&#x6CD5;&#x3002;&#x56E0;&#x4E3A;&#x8D85;&#x8FC7;&#x4EBA;&#x7C7B;&#x8868;&#x73B0;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x6539;&#x5584;&#x6A21;&#x578B;&#x8868;&#x73B0;&#x7684;&#x5DE5;&#x5177;&#x53EF;&#x80FD;&#x90FD;&#x4F1A;&#x5931;&#x6548;&#x3002;&#x6240;&#x4EE5;&#x8981;&#x60F3;&#x524D;&#x8FDB;&#x4E00;&#x6B65;&#x90FD;&#x5F88;&#x56F0;&#x96BE;&#x3002;Andrew&#x5728;&#x6559;&#x7A0B;&#x4E2D;&#x4E5F;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x660E;&#x786E;&#x7684;&#x65B9;&#x5411;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x505A;&#x3002;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x7528;&#x4EBA;&#x7C7B;&#x8868;&#x73B0;&#x6765;&#x8FD1;&#x4F3C;&#x8D1D;&#x53F6;&#x65AF;&#x6700;&#x4F73;&#x8BEF;&#x5DEE;&#x3002;&#x5F53;&#x6A21;&#x578B;&#x8868;&#x73B0;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E00;&#x7EC4;&#x4EBA;&#x7C7B;&#x7684;&#x63A8;&#x65AD;&#x51C6;&#x786E;&#x7387;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x6CA1;&#x529E;&#x6CD5;&#x518D;&#x7528;&#x539F;&#x5148;&#x7684;&#x503C;&#x6765;&#x8FD1;&#x4F3C;&#x8D1D;&#x53F6;&#x65AF;&#x8BEF;&#x5DEE;&#x4E86;&#x3002;&#x603B;&#x7ED3;%23%20Deep%20Learning%20%287%29%20-%20Machine%20Learning%20Strategy%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%u6240%u8C13Machine%20Learning%20Strategy%u5C31%u662F%u5982%u4F55%u8C03%u6574%u5B66%u4E60%u7684%u7B56%u7565%uFF0C%u6765%u8FBE%u5230%u66F4%u597D%u7684%u51C6%u786E%u7387%u3002Andrew%u63D0%u5230%u8FD9%u4E00%u95E8%u8BFE%28Structuring%20Machine%20Learning%20Projects%29%u7684%u4E24%u5468%u7684%u5185%u5BB9%uFF0C%u901A%u5E38%u662F%u4E00%u4E9B%u673A%u5668%u5B66%u4E60%u9879%u76EE%u7684%u7ECF%u9A8C%u4E4B%u8C08%uFF0C%u5728%u5B66%u6821%u7684%u8BFE%u7A0B%u4E2D%u901A%u5E38%u4E0D%u4F1A%u6709%u63D0%u53CA%u3002%0A%0A%23%23%20Orthogonalization%20%0AOrthogonalization%uFF0C%u8BD1%u4F5C%u6B63%u4EA4%u5316%uFF0C%u7C7B%u4F3Ccoding%u65F6%u5019%u7684%u89E3%u8026%28decouple%29%u3002%u901A%u8FC7%u4E00%u4E9B%u6B63%u4EA4%u5316%u7684%u8C03%u6574%u7B56%u7565%u6765%u4FEE%u6B63%u76F8%u5173%u6761%u4EF6%u4E0B%u7684%u6A21%u578B%u51C6%u786E%u7387%u3002%u4E00%u822C%u6709%u4E0B%u97624%u4E2D%u7B56%u7565%uFF1A%0A%3EWhen%20a%20supervised%20learning%20system%20is%20design%2C%20these%20are%20the%204%20assumptions%20that%20needs%20to%20be%20true%20and%20orthogonal.%0A1.%20Fit%20training%20set%20well%20in%20cost%20function%0A-%20If%20it%20doesn%u2019t%20fit%20well%2C%20the%20use%20of%20a%20bigger%20neural%20network%20or%20switching%20to%20a%20better%20optimization%20algorithm%20might%20help.%0A2.%20Fit%20development%20set%20well%20on%20cost%20function%0A-%20If%20it%20doesn%u2019t%20fit%20well%2C%20regularization%20or%20using%20bigger%20training%20set%20might%20help.%0A3.%20Fit%20test%20set%20well%20on%20cost%20function%0A-%20If%20it%20doesn%u2019t%20fit%20well%2C%20the%20use%20of%20a%20bigger%20development%20set%20might%20help%0A4.%20Performs%20well%20in%20real%20world%0A-%20If%20it%20doesn%u2019t%20perform%20well%2C%20the%20development%20test%20set%20is%20not%20set%20correctly%20or%20the%20cost%20function%20is%20not%20evaluating%20the%20right%20thing.%0A%0AAndrew%u4E5F%u63D0%u5230%u4E4B%u524D%u63D0%u5230%u7684%u4E00%u79CDregularization%u7684%u65B9%u6CD5%u2014%u2014early%20stopping%uFF0C%u5C31%u4E0D%u662F%u4E00%u79CD%u6B63%u4EA4%u5316%u7684%u8C03%u6574%u7B56%u7565%u3002%u4ED6%u540C%u65F6%u60F3%u505A%u597D%u7B2C1%u548C%u7B2C2%u70B9%u3002%0A%0A%23%23%20Setting%20up%20your%20goal%0A%u505A%u4E00%u4E2A%u673A%u5668%u5B66%u4E60%u7684%u9879%u76EE%uFF0C%u901A%u5E38%u662F%u4E0B%u9762%u8FD9%u4E2A%u8FC7%u7A0B%uFF0CIdea-%3ECode-%3EExperiment-%3EIdea%uFF0C%u4E0D%u65AD%u7684%u8FED%u4EE3%u5F97%u5230%u6700%u7EC8%u4F18%u5316%u7684%u6A21%u578B%u3002%0A%21%5BAlt%20text%7C350x0%5D%28./1535881797306.png%29%0A%u8FD9%u91CC%u7684Experiment%u4E5F%u5C31%u76F8%u5F53%u4E8E%u6D4B%u8BD5%uFF0C%u901A%u8FC7%u6D4B%u8BD5%u7684%u7ED3%u679C%u662F%u597D%u662F%u574F%uFF0C%u6765%u51B3%u5B9A%u4E0B%u4E00%u6B65%u600E%u4E48%u8C03%u6574%u6A21%u578B%u3002%u6240%u4EE5%u6D4B%u8BD5%u7ED3%u679C%u7684%u8BC4%u4F30%u5C31%u975E%u5E38%u91CD%u8981%u4E86%u3002%u8FD9%u4E00%u7AE0%20%u63D0%u5230%u7684%u51E0%u4E2A%u6280%u5DE7%u90FD%u662F%u5173%u4E8E%u6D4B%u8BD5%u7ED3%u679C%u7684%u8BC4%u4F30%u3002%0A%23%23%23%20Single%20real%20number%20evaluation%20metric%0A%u5982%u679C%u9488%u5BF9%u4E00%u4E2A%u6D4B%u8BD5%u6709%u4E24%u4E2A%u6307%u6570%u578B%u6307%u6807%uFF0C%u8FD9%u5C31%u5F88%u96BE%u53D6%u820D%u3002%u8FD9%u4F1A%u964D%u4F4E%u4E0A%u9762%u8FD9%u4E2A%u5FAA%u73AF%u7684%u6548%u7387%uFF0C%u751A%u81F3%u6700%u7EC8%u7684%u6A21%u578B%u51C6%u786E%u5EA6%u3002%u6240%u4EE5%u8FD9%u91CC%u624D%u4F1A%u63D0%u51FA%u5355%u4E00%u8BC4%u4EF7%u6807%u51C6%u3002%u4F8B%u5982%u4E0B%u9762%u7684%u4F8B%u5B50%uFF1A%0A%21%5BAlt%20text%7C350x0%5D%28./1535927323926.png%29%0A%3E%20Precision%3A%20Of%20all%20the%20images%20we%20predicted%20y%3D1%2C%20what%20fraction%20of%20it%20have%20cats%3F%0A%3E%20Recall%3A%20Of%20all%20the%20images%20that%20actually%20have%20cats%2C%20what%20fraction%20of%20it%20did%20we%20correctly%20identifying%20have%20cats%3F%0A%0A%u8FD9%u4E24%u4E2A%u6307%u6807%u5F53%u7136%u90FD%u662F%u8D8A%u5927%u8D8A%u597D%uFF0C%u90A3%u5982%u4F55%u8BC4%u5B9AClassifier%20A%u548CB%uFF1F%0A%u4E4B%u524D%u7684%u4E00%u7BC7%u535A%u6587%5BMachine%20Learning%20%282%29%20-%20Neural%20Network%5D%28https%3A//zhougy0717.github.io/2017/04/03/Machine%2520Learning%2520%282%29%2520-%2520Neural%2520Network/%29%u4E2D%u5173%u4E8E%5Bskewed%20data%u7684%u4E00%u8282%5D%28https%3A//zhougy0717.github.io/2017/04/03/Machine%2520Learning%2520%282%29%2520-%2520Neural%2520Network/%23x7279x4f8bskewed-data%29%u4E2D%uFF0C%u6709%u63D0%u5230F1-score%u3002%u8FD9%u91CC%u5C31%u662F%u901A%u8FC7F1-score%u6765%u6574%u5408precision%u548Crecall%u6765%u5F97%u5230%u4E00%u4E2A%u7EDF%u4E00%u7684%u6807%u51C6%u3002%0AF1-score%24%20%3D%20%5Cfrac%20%7B2%7D%7B%5Cfrac%7B1%7D%7BP%7D%20+%20%5Cfrac%7B1%7D%7BR%7D%7D%24%0A%u8FD9%u4E2A%u7B97%u6CD5%u53C8%u79F0%u4E3A%22Harmonic%20Mean%22%u3002%0A%0A%u8BA1%u7B97Precision%u548CRecall%u7684%u201D%u5747%u503C%u201C%u53EA%u662F%u4E00%u4E2A%u4F8B%u5B50%uFF0C%u901A%u5E38%u6211%u4EEC%u8981%u81EA%u5DF1%u601D%u8003%u51FA%u5982%u4F55%u80FD%u4EA7%u751F%u4E00%u4E2A%u6613%u4E8E%u8BC4%u4F30%u7684%u5355%u4E00%u6307%u6570%u6807%u51C6%u3002%0A%0A%23%23%23%20Satisficing%20and%20Optimizing%0A%u8FD9%u91CC%u6307%uFF0C%u68C0%u9A8C%u8BD5%u9A8C%u7ED3%u679C%u7684%u6307%u6807%uFF0C%u901A%u5E38%u53EF%u4EE5%u5206%u6210%u4E24%u7C7B%uFF0C%u5373Satisficing%u548COptimizing%u3002%0ASatisficing%u7C7B%u6307%u6807%u6307%u7684%u662F%u53EA%u8981%u8FBE%u5230%u4E00%u5B9A%u7684%u9608%u503C%uFF0C%u518D%u4F18%u5316%u4E5F%u4E0D%u592A%u4F1A%u5F71%u54CD%u8BD5%u9A8C%u7ED3%u679C%u7684%u4F18%u52A3%u3002%u4F8B%u5982%uFF0C%u8FD0%u884C%u65F6%u95F4%u8FBE%u5230100ms%u5373%u53EF%uFF0C80ms%u548C90ms%u7684%u8FD0%u884C%u65F6%u95F4%u5DEE%u522B%uFF0C%u5E76%u4E0D%u80FD%u5E26%u6765%u4EC0%u4E48%u6539%u5584%u3002%0AOptimizing%u7C7B%u6307%u6807%u6307%u7684%u5C31%u662F%u4E00%u4E9B%u6570%u503C%u7C7B%u7684%u6307%u6807%uFF0C%u4F8B%u5982%u51C6%u786E%u7387%uFF0C%u4E00%u70B9%u70B9%u6539%u5584%u90FD%u4F1A%u5F71%u54CD%u8BD5%u9A8C%u7ED3%u679C%u7684%u8BC4%u5224%u3002%0A%u4E0B%u9762%u662F%u4E00%u4E2A%u5177%u4F53%u7684%u4F8B%u5B50%uFF1A%0A%21%5BAlt%20text%7C350x0%5D%28./1535928500755.png%29%0A%u8FD9%u4E2A%u4F8B%u5B50%u91CC%uFF0CRunning%20time%u5C31%u662Fsatisficing%u6307%u6807%uFF0CAccuracy%u5C31%u662Foptimizing%u6307%u6807%u3002%0A%0A%23%23%20Train/dev/test%20distributions%0A%u5728%u505A%u673A%u5668%u5B66%u4E60%u9879%u76EE%u65F6%uFF0C%u901A%u5E38%u9700%u8981%u5BF9%u6837%u672C%u6570%u636E%u8FDB%u884C%u5206%u5272%u3002%u800C%u4E0D%u662F%u5C06%u6240%u6709%u7684%u6837%u672C%u90FD%u7528%u4E8E%u8BAD%u7EC3%u3002%u4E0A%u4E00%u7AE0%u63D0%u5230%u8981%u5BF9%u8BD5%u9A8C%u7ED3%u679C%u8FDB%u884C%u8BC4%u4F30%uFF0C%u800C%u8FD9%u4E2A%u8BC4%u4F30%u5C31%u662F%u5728dev%u6216%u8005test%20set%u4E0A%u8FDB%u884C%u7684%u3002%u6240%u4EE5%u6709%u4E00%u4E2A%u5408%u9002%u7684dev/test%20set%u5BF9%u6A21%u578B%u7684%u8FED%u4EE3%u4EE5%u53CA%u9879%u76EE%u7684%u63A8%u8FDB%uFF0C%u6709%u7740%u81F3%u5173%u91CD%u8981%u7684%u5F71%u54CD%u3002%0A%0A%3E%20-%20Training%20set%3A%20%u8FED%u4EE3%u5F97%u5230%u5404%u4E2A%u6A21%u578B%u53C2%u6570%28W%2C%20b%2C%20%24%5Cbeta%24%2C%20%24%5Cgamma%20%5Cdots%24%29%0A%3E%20-%20Development%20%28dev%29%20set%3A%20%u5728%u4E00%u8F6E%u5FAA%u73AF%u4E2D%u9A8C%u8BC1training%u7ED3%u679C%u7684%u6B63%u786E%u6027%uFF0C%u4EE5%u4FBF%u4E0B%u4E00%u8F6E%u8C03%u6574%u6A21%u578B%28%u5305%u62EC%u8D85%u53C2%u6570%u7684%u8C03%u6574%uFF0C%u662F%u5426%u91C7%u7528%u6B63%u5219%u5316%uFF0C%u7F51%u7EDC%u7ED3%u6784%u7684%u8C03%u6574%u7B49%u7B49%29%0A%3E%20-%20Test%20set%3A%20%u5728%u6240%u6709%u5FAA%u73AF%u7ED3%u675F%u540E%uFF0C%u6765%u9A8C%u8BC1%u6700%u7EC8%u6A21%u578B%u7684%u6B63%u786E%u6027%u3002%0A%0A%23%23%23%20%u5982%u4F55%u5206%u5272%uFF1F%0A%u5728%u6837%u672C%u6570%u636E%u4E0D%u592A%u591A%28%u6570%u5343%u6570%u4E07%u7684%u7EA7%u522B%29%u7684%u65F6%u5019%uFF0C%u4E00%u822C%u5982%u4E0B%u5206%u5272%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1535929236023.png%29%0A%u5F53%u6837%u672C%u8DB3%u591F%u591A%u7684%u65F6%u5019%uFF0C%u4F8B%u5982%u767E%u4E07%u7EA7%uFF0C%u53EF%u4EE5%u5982%u4E0B%u5206%u5272%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1535929370378.png%29%0Adev/test%20set%u7684%u6837%u672C%u53EA%u8981%u80FD%u8FBE%u5230%u6570%u5343%u7684%u7EA7%u522B%u5C31%u8DB3%u591F%u4E86%uFF0C%u518D%u591A%u4E5F%u5E76%u4E0D%u4F1A%u5F97%u5230%u66F4%u597D%u7684%u6548%u679C%u3002%u4E0D%u5982%u5C06%u8FD9%u4E9B%u6837%u672C%u653E%u5165training%u96C6%u3002%0A%0A%23%23%23%20Guide%20Line%0A%21%5BAlt%20text%5D%28./1535930044364.png%29%0A%0A%23%23%23%23%20%u540C%u4E00%u5206%u5E03%0A%u5206%u5272%u6837%u672C%u6570%u636E%u7684%u65F6%u5019%u5FC5%u987B%u4FDD%u8BC1training%uFF0Cdev%uFF0Ctest%20set%u5747%u6765%u81EA%u4E8E%u540C%u4E00%u79CD%u5206%u5E03%u3002%0A%21%5BAlt%20text%7C250x0%5D%28./1535929538718.png%29%0A%u4E0A%u9762%u8FD9%u79CD%u5206%u5272%u5C31%u662F%u9519%u8BEF%u7684%uFF0C%u5C06%u524D4%u4E2A%u56FD%u5BB6%u7684%u6570%u636E%u4F5C%u4E3Adev%20set%uFF0C%u540E%u56DB%u4E2A%u56FD%u5BB6%u6570%u636E%u4F5C%u4E3Atest%20set%u3002%u6B63%u786E%u7684%u505A%u6CD5%u5E94%u5F53%u662F%uFF0C%u5C06%u6240%u6709%u56FD%u5BB6%u7684%u6570%u636E%u5168%u90E8%u6DF7%u7F16%uFF0C%u968F%u673A%u4EA7%u751F%u51FA%u8DB3%u591F%u6570%u91CF%u7684dev%20set%u548Ctest%20set%u3002%0A%0A%23%23%23%23%20%u53CD%u6620%u6700%u7EC8%u5E94%u7528%u573A%u666F%0Adev/test%20set%u5FC5%u987B%u53CD%u5E94%u6700%u7EC8%u6A21%u578B%u7684%u5E94%u7528%u573A%u666F%u3002%0A%u4F8B%u5982cat%20detector%uFF0C%u8BAD%u7EC3%uFF0C%u6D4B%u8BD5%u90FD%u662F%u91C7%u7528%u7F51%u7EDC%u4E0A%u6E05%u6670%u5EA6%u5F88%u9AD8%u7684%u56FE%u7247%uFF0C%u4F46%u4F7F%u7528%u65F6%u53D1%u73B0%u7528%u6237%u4E0A%u4F20%u7684%u5F88%u591A%u90FD%u662F%u6E05%u6670%u5EA6%u4E0D%u9AD8%u7684%u7167%u7247%uFF0C%u90A3%u8BC6%u522B%u7387%u80AF%u5B9A%u662F%u4E0D%u80FD%u4EE4%u4EBA%u6EE1%u610F%u7684%u3002%u8FD9%u5C31%u662Fdev/test%20set%u548C%u6700%u7EC8%u5E94%u7528%u4E0D%u7B26%u3002%u6539%u8FDB%u7684%u529E%u6CD5%u5C31%u662F%uFF0C%u8981%u4E48%u53EF%u4EE5%u591A%u91C7%u7528%u4E00%u4E9B%u771F%u5B9E%u7684%u7528%u6237%u6570%u636E%uFF0C%u6216%u8005%u91C7%u7528data%20augmentation%u6765%u4EBA%u5DE5%u6DFB%u52A0%u566A%u58F0%uFF0C%u8BA9%u539F%u672C%u6E05%u6670%u7684%u56FE%u7247%u53D8%u6210%u6A21%u7CCA%u7684%u3002%u603B%u800C%u8A00%u4E4B%uFF0C%u5C31%u662F%u6539%u8FDB%u8BAD%u7EC3%u96C6%u548C%u6D4B%u8BD5%u5F00%u53D1%u96C6%u518D%u8FDB%u884C%u8BAD%u7EC3%u3002%0A%0A%23%23%23%23%20%u5982%u679C%u6709%u7279%u522B%u4E0D%u60F3%u8981%u7684%u6307%u6807%u600E%u4E48%u529E%uFF1F%0A%u6BD4%u5982cat%20detector%u4F1A%u8BEF%u5C06%u8272%u60C5%u56FE%u7247%u8BC6%u522B%u4E3A%u732B%u54AA%uFF0C%u8FD9%u4E2A%u662F%u4E0D%u53EF%u63A5%u53D7%u7684%uFF0C%u4E0D%u7BA1%u6A21%u578B%u7CBE%u5EA6%u6709%u591A%u9AD8%u3002%u89E3%u51B3%u65B9%u6CD5%u5C31%u662F%u4FEE%u6539metric%uFF1A%0AError%3A%20%24%5Cfrac%20%7B1%7D%7B%5CSigma_i%7Bw%5E%7B%28i%29%7D%7D%7D%20%5CSigma_%7Bi%3D1%7D%5E%7Bm_%7Bdev%7D%7Dw%5E%7B%28i%29%7DI%5C%7By_%7Bpred%7D%5E%7B%28i%29%7D%20%5Cneq%20y%5E%7B%28i%29%7D%5C%7D%24%0A%24w%5E%7B%28i%29%7D%20%3D%201%24%20if%20%24X%5E%7B%28i%29%7D%24%20is%20non-porn%2C%20%24w%5E%7B%28i%29%7D%20%3D%2010%24%20if%20%24X%5E%7B%28i%29%7D%24%20is%20porn.%0A%0A%0A%23%23%20%u6700%u7EC8%u7684%u4F18%u5316%u65B9%u5411%0A%21%5BAlt%20text%7C600x0%5D%28./1535944488653.png%29%0A%u84DD%u8272%u865A%u7EBF%u4EE3%u8868%u4EBA%u7C7B%u7684%u8868%u73B0%uFF0C%u7EFF%u8272%u865A%u7EBF%u4EE3%u8868%u7406%u8BBA%u6781%u9650%uFF0C%u5373Bayes%20Optimal%20Error%28%u8D1D%u53F6%u65AF%u6700%u4F18%u8BEF%u5DEE%29%u3002%u8FD9%u91CC%u63D0%u5230%u7684Bayes%20Optimal%20Error%u662F%u4E00%u4E2A%u7406%u8BBA%u503C%uFF0C%u5B83%u4EE3%u8868%u7740%u901A%u8FC7%u4E00%u5207%u624B%u6BB5%u80FD%u8FBE%u5230%u7684%u6700%u4F18%u72B6%u6001%u3002%0A%u4E0A%u9762%u7684%u66F2%u7EBF%u8868%u793A%uFF0C%u673A%u5668%u5B66%u4E60%u9879%u76EE%u5728%u8FBE%u5230%u4EBA%u7C7B%u6C34%u5E73%u4E4B%u524D%uFF0C%u4F1A%u6709%u4E00%u4E2A%u6BD4%u8F83%u597D%u7684%u6539%u5584%u901F%u7387%uFF0C%u5F53%u8FBE%u5230%u6216%u8D85%u8FC7%u4EBA%u7C7B%u8868%u73B0%u540E%uFF0C%u5373%u8D8B%u4E8E%u5E73%u7F13%uFF0C%u751A%u81F3%u5F88%u96BE%u518D%u6709%u6539%u5584%u7684%u7A7A%u95F4%u3002%0A%0A%23%23%23%20%u4E3A%u4EC0%u4E48%u4EE5%u4EBA%u7C7B%u8868%u73B0%u4F5C%u4E3A%u5206%u6C34%u5CAD%uFF1F%0A%u56E0%u4E3A%u4EBA%u7C7B%u5728%u81EA%u7136%u611F%u77E5%28Natural%20Perception%29%u65B9%u9762%u5DF2%u7ECF%u5F88%u64C5%u957F%u4E86%u3002%u800C%u5728%u6A21%u578B%u672A%u8FBE%u5230%u4EBA%u7C7B%u8868%u73B0%u7684%u65F6%u5019%uFF0C%u4F60%u53EF%u4EE5%u901A%u8FC7%u5404%u79CD%u5DE5%u5177%u6765%u6539%u5584%u4F60%u7684%u5B66%u4E60%u6A21%u578B%u3002%u4F46%u5F53%u6A21%u578B%u8FBE%u5230%u6216%u8005%u8D85%u8FC7%u4EBA%u7C7B%u8868%u73B0%u7684%u65F6%u5019%uFF0C%u8FD9%u4E9B%u5DE5%u5177%u5C31%u5931%u6548%u4E86%u3002%u56E0%u4E3A%u8FD9%u4E9B%u5DE5%u5177%u4E5F%u662F%u901A%u8FC7%u4EBA%u7C7B%u611F%u77E5%u6765%u5236%u9020%u7684%u3002%0A%0A%20%0A%23%23%23%20%u4EC0%u4E48%u662FAvoidable%20Bias%uFF1F%0A%21%5BAlt%20text%7C500x0%5D%28./1535951043543.png%29%0AAvoidable%20Bias%20%3D%20Bayes%20Error%20-%20Training%20Error%0A-%20%u901A%u5E38%u7528%u4EBA%u7C7B%u8868%u73B0%u6765%u8FD1%u4F3C%u8D1D%u53F6%u65AF%u6700%u4F18%u8BEF%u5DEE%u3002%0A-%20If%20%7C%20human-level%20error%20-%20training%20error%20%7C%20%24%5Cge%24%20%7C%20training%20error%20-%20development%20error%20%7C%2C%20focus%20on%20**bias%20%28avoidable%20bias%29**%20reduction%20technique%0A-%20If%20%20%7C%20human-level%20error%20-%20training%20error%20%7C%20%24%5Cle%24%20%7C%20training%20error%20-%20development%20error%20%7C%2C%20focus%20on%20**variance**%20reduction%20technique%0A%0A%0A%23%23%23%20%u8D85%u8FC7%u4EBA%u7C7B%u8868%u73B0%u540E%u600E%u4E48%u529E%uFF1F%0A%u7B54%u6848%u662F%uFF0C%u6CA1%u529E%u6CD5%u6216%u8005%u6CA1%u6709%u597D%u7684%u529E%u6CD5%u3002%u56E0%u4E3A%u8D85%u8FC7%u4EBA%u7C7B%u8868%u73B0%uFF0C%u6240%u6709%u7684%u6539%u5584%u6A21%u578B%u8868%u73B0%u7684%u5DE5%u5177%u53EF%u80FD%u90FD%u4F1A%u5931%u6548%u3002%u6240%u4EE5%u8981%u60F3%u524D%u8FDB%u4E00%u6B65%u90FD%u5F88%u56F0%u96BE%u3002Andrew%u5728%u6559%u7A0B%u4E2D%u4E5F%u6CA1%u6709%u7ED9%u51FA%u660E%u786E%u7684%u65B9%u5411%u5E94%u8BE5%u600E%u4E48%u505A%u3002%u6211%u4EEC%u901A%u5E38%u7528%u4EBA%u7C7B%u8868%u73B0%u6765%u8FD1%u4F3C%u8D1D%u53F6%u65AF%u6700%u4F73%u8BEF%u5DEE%u3002%u5F53%u6A21%u578B%u8868%u73B0%u5DF2%u7ECF%u8D85%u8FC7%u4E00%u7EC4%u4EBA%u7C7B%u7684%u63A8%u65AD%u51C6%u786E%u7387%u7684%u65F6%u5019%uFF0C%u5C31%u6CA1%u529E%u6CD5%u518D%u7528%u539F%u5148%u7684%u503C%u6765%u8FD1%u4F3C%u8D1D%u53F6%u65AF%u8BEF%u5DEE%u4E86%u3002%0A%0A%23%23%20%u603B%u7ED3%0A%21%5BAlt%20text%7C700x0%5D%28./1535959208924.png%29%0A]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (6) - Softmax regression]]></title>
    <url>%2F2018%2F08%2F31%2FDeep_Learning_(6)_-_Softmax_regression%2F</url>
    <content type="text"><![CDATA[Edit&#x8FD9;&#x4E2A;&#x5728;&#x770B;&#x8FD9;&#x4E2A;&#x6559;&#x7A0B;&#x4E4B;&#x524D;&#x5C31;&#x6709;&#x6240;&#x8033;&#x95FB;&#x3002;&#x636E;&#x8BF4;&#x73B0;&#x5728;&#x7684;deep learning&#x6A21;&#x578B;&#x7684;&#x6700;&#x540E;&#x4E00;&#x5C42;&#x90FD;&#x662F;softmax&#x5C42;&#xFF0C;&#x6765;&#x505A;&#x591A;&#x5206;&#x7C7B;(Multi-class Classification)&#x3002;Activation Function: %23%20Deep%20Learning%20%286%29%20-%20Softmax%20regression%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%u8FD9%u4E2A%u5728%u770B%u8FD9%u4E2A%u6559%u7A0B%u4E4B%u524D%u5C31%u6709%u6240%u8033%u95FB%u3002%u636E%u8BF4%u73B0%u5728%u7684deep%20learning%u6A21%u578B%u7684%u6700%u540E%u4E00%u5C42%u90FD%u662Fsoftmax%u5C42%uFF0C%u6765%u505A%u591A%u5206%u7C7B%28Multi-class%20Classification%29%u3002%0A%0AActivation%20Function%3A%0A%24t%20%3D%20e%20%5E%7B%28Z%5E%7B%5BL%5D%7D%29%7D%24%0A%24a%5E%7B%5BL%5D%7D%20%3D%20%5Cfrac%20%7Bt%7D%7B%5CSigma_i%20%7Bt_i%7D%7D%24]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (5) - Batch Normalization]]></title>
    <url>%2F2018%2F08%2F31%2FDeep_Learning_(5)_-_Batch_Normalization%2F</url>
    <content type="text"><![CDATA[Edit&#x5728;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x5EFA;&#x6A21;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x5BF9;&#x8F93;&#x5165;&#x53C2;&#x6570;X&#x8FDB;&#x884C;Normalize&#xFF0C;&#x5373; Normalize&#x7684;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x52A0;&#x901F;&#x6536;&#x655B;&#x3002;&#x770B;&#x4E0B;&#x56FE;&#xFF0C;&#x5F53;&#x6B63;&#x89C4;&#x5316;&#x540E;&#xFF0C;Contour&#x4ECE;&#x692D;&#x5706;&#x53D8;&#x6210;&#x5706;&#xFF0C;&#x4E0D;&#x7BA1;&#x8D77;&#x59CB;&#x70B9;&#x843D;&#x5728;&#x5706;&#x7684;&#x54EA;&#x91CC;&#xFF0C;&#x6700;&#x540E;&#x90FD;&#x53EF;&#x4EE5;&#x6536;&#x655B;&#x5230;&#x4E2D;&#x5FC3;&#x6700;&#x4F18;&#x70B9;&#x3002;&#x800C;&#x5DE6;&#x56FE;&#xFF0C;&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x4E9B;&#x968F;&#x673A;&#x566A;&#x58F0;&#xFF0C;&#x5BFC;&#x81F4;&#x65B9;&#x5411;&#x504F;&#x79BB;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x53D1;&#x6563;&#x3002;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5F88;&#x5C0F;&#x5FC3;&#x7684;&#x9009;&#x62E9;learning rate&#x3002;ImplementBatch Norm&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5BF9;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x6BCF;&#x4E00;&#x5C42;&#x7684;&#x4E2D;&#x95F4;&#x53D8;&#x91CF;&#x4F7F;&#x7528;&#x6B63;&#x89C4;&#x5316;&#xFF1A;&#x53C2;&#x6570;&#xFF0C;&#x63A7;&#x5236;&#x7740;Z&#x7684;&#x5747;&#x503C;&#x548C;&#x65B9;&#x5DEE;&#xFF0C;&#x5B83;&#x4EEC;&#x548C;W&#xFF0C;b&#x4E00;&#x6837;&#x4E5F;&#x662F;&#x6A21;&#x578B;&#x6C42;&#x89E3;&#x7684;&#x53C2;&#x6570;(learnable parameter)&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;? &#x6B63;&#x89C4;&#x5316;&#x6210;&#x5747;&#x503C;&#x4E3A;0&#xFF0C;&#x65B9;&#x5DEE;&#x4E3A;1&#x65F6;&#xFF0C;&#x5F53;&#x91C7;&#x7528;&#x7C7B;&#x4F3C;sigmoid&#x7684;&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#x8F93;&#x51FA;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x8BE5;&#x8282;&#x70B9;&#x8F93;&#x51FA;&#x5747;&#x96C6;&#x4E2D;&#x5728;&#x4E2D;&#x5FC3;&#x7EBF;&#x6027;&#x533A;&#x57DF;&#xFF0C;&#x5219;&#x8BE5;&#x8282;&#x70B9;&#x9000;&#x5316;&#x6210;&#x7EBF;&#x6027;&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8282;&#x70B9;&#x9000;&#x5316;&#x6210;&#x7EBF;&#x6027;&#x8282;&#x70B9;&#xFF0C;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5C31;&#x9000;&#x5316;&#x6210;&#x4E86;logistic regression&#x3002;&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x975E;&#x7EBF;&#x6027;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x968F;&#x673A;&#x6027;&#xFF0C;&#x8981;&#x901A;&#x8FC7;&#x548C;&#x6765;&#x8C03;&#x6574;&#x6BCF;&#x4E2A;&#x72B6;&#x6001;&#x91CF;&#x7684;&#x5206;&#x5E03;&#x51FD;&#x6570;&#x3002; Batch Norm in Neural Networkfor 1&#x2026;num of Mini-batches &#x3000;&#x3000;&#x3000;compute forward path on &#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;In each hidden layer, use BN to repair with &#x3000;&#x3000;&#x3000;Use backprop to compute &#x3000;&#x3000;&#x3000;Update params &#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000; &#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000; &#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000; Work with momentum, RMSprop, Adam&#x8FD9;&#x91CC;&#x6CE8;&#x610F;&#x7701;&#x7565;&#x4E86;, &#x56E0;&#x4E3A;b&#x662F;&#x5E38;&#x91CF;&#xFF0C;&#x4E0E;&#x72B6;&#x6001;&#x8F93;&#x5165;&#x65E0;&#x5173;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6B63;&#x89C4;&#x5316;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x88AB;&#x8BA1;&#x5165;&#x72B6;&#x6001;&#x91CF;&#x7684;&#x671F;&#x671B;&#x503C;Batch Norm at test time&#x5728;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#xFF0C;&#x5BF9;test set&#x672C;&#x8EAB;&#x4E0D;&#x505A;Batch Norm&#xFF0C;&#x56E0;&#x4E3A;test set&#x548C;training set&#x7684;&#x5206;&#x5E03;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;&#x4F46;&#x662F;&#x5728;&#x505A;&#x6B63;&#x5411;&#x4F20;&#x64AD;&#x6C42;&#x9884;&#x6D4B;&#x8F93;&#x51FA;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x56E0;&#x4E3A;&#x5404;&#x4E2A;hidden unit&#x7684;&#x53C2;&#x6570;&#x90FD;&#x662F;&#x6839;&#x636E;Batch Norm&#x8FED;&#x4EE3;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6298;&#x4E2D;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#xFF0C;&#x91C7;&#x7528;exponential weighted average&#x6765;&#x8BB0;&#x5F55;training set&#x7684;&#x548C;&#xFF0C;&#x5728;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x4F7F;&#x7528;&#x3002;&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#xFF1A;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;mini batch&#xFF0C;&#x6BCF;&#x4E00;&#x5C42;&#x8BB0;&#x5F55;&#x548C;&#x4F7F;&#x7528;exponential weighted average across mini batches&#xFF0C;&#x66F4;&#x65B0;, &#x7ED3;&#x675F;training&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BB0;&#x5F55;&#x548C;&#x4F7F;&#x7528;&#x5728;test set&#x91CC;%23%20Deep%20Learning%20%285%29%20-%20Batch%20Normalization%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%u5728%u673A%u5668%u5B66%u4E60%u5EFA%u6A21%u65F6%uFF0C%u901A%u5E38%u4F1A%u5BF9%u8F93%u5165%u53C2%u6570X%u8FDB%u884CNormalize%uFF0C%u5373%0A%24%5Cmu%20%3D%20%5Cfrac%20%7B1%7D%7Bm%7D%20%5CSigma_i%20x%5E%7B%28i%29%7D%24%0A%24X%20%3D%20X-%5Cmu%24%0A%24%5Csigma%5E2%20%3D%20%5Cfrac%20%7B1%7D%7Bm%7D%20%5CSigma_i%20%28x%5E%7B%28i%29%7D-%5Cmu%29%5E2%24%0A%24X%3D%5Cfrac%20%7BX%7D%7B%5Csigma%7D%24%0ANormalize%u7684%u597D%u5904%u662F%u53EF%u4EE5%u52A0%u901F%u6536%u655B%u3002%u770B%u4E0B%u56FE%uFF0C%u5F53%u6B63%u89C4%u5316%u540E%uFF0CContour%u4ECE%u692D%u5706%u53D8%u6210%u5706%uFF0C%u4E0D%u7BA1%u8D77%u59CB%u70B9%u843D%u5728%u5706%u7684%u54EA%u91CC%uFF0C%u6700%u540E%u90FD%u53EF%u4EE5%u6536%u655B%u5230%u4E2D%u5FC3%u6700%u4F18%u70B9%u3002%u800C%u5DE6%u56FE%uFF0C%u53EF%u80FD%u6709%u4E00%u4E9B%u968F%u673A%u566A%u58F0%uFF0C%u5BFC%u81F4%u65B9%u5411%u504F%u79BB%uFF0C%u5C31%u4F1A%u5BFC%u81F4%u6700%u7EC8%u7ED3%u679C%u53D1%u6563%u3002%u6240%u4EE5%u9700%u8981%u5F88%u5C0F%u5FC3%u7684%u9009%u62E9learning%20rate%u3002%0A%21%5BAlt%20text%7C300x0%5D%28./1535670653390.png%29%0A%0A%23%23%20Implement%0ABatch%20Norm%u8981%u505A%u7684%u5C31%u662F%u5BF9%u795E%u7ECF%u7F51%u7EDC%u7684%u6BCF%u4E00%u5C42%u7684%u4E2D%u95F4%u53D8%u91CF%24Z%5E%7B%5Bl%5D%7D%24%u4F7F%u7528%u6B63%u89C4%u5316%uFF1A%0A-%20%24%5Cmu%20%3D%20%5Cfrac%7B1%7D%7Bm%7D%5CSigma_i%20Z%5E%7B%28i%29%7D%24%0A-%20%24%5Csigma%5E2%20%3D%20%5Cfrac%20%7B1%7D%7Bm%7D%20%5CSigma_i%20%28Z%5E%7B%28i%29%7D%20-%20%5Cmu%29%5E2%24%0A-%20%24Z_%7Bnorm%7D%5E%7B%28i%29%7D%20%3D%20%5Cfrac%20%7BZ%5E%7B%28i%29%7D-%5Cmu%7D%7B%5Csqrt%20%7B%5Csigma%5E2%20+%20%5Cepsilon%7D%7D%24%0A-%20%24%5Ctilde%7BZ%7D%5E%7B%28i%29%7D%20%3D%20%5Cgamma%20Z_%7Bnorm%7D%5E%7B%28i%29%7D%20+%20%5Cbeta%24%0A-%20%u53C2%u6570%24%5Cgamma%24%uFF0C%24%5Cbeta%24%u63A7%u5236%u7740Z%u7684%u5747%u503C%u548C%u65B9%u5DEE%uFF0C%u5B83%u4EEC%u548CW%uFF0Cb%u4E00%u6837%u4E5F%u662F%u6A21%u578B%u6C42%u89E3%u7684%u53C2%u6570%28learnable%20parameter%29%u3002%0A%0A%3E%20%u4E3A%u4EC0%u4E48%u8981%u6709%24%5Cgamma%2C%20%5Cbeta%24%3F%0A%3E%20%u6B63%u89C4%u5316%u6210%u5747%u503C%u4E3A0%uFF0C%u65B9%u5DEE%u4E3A1%u65F6%uFF0C%u5F53%u91C7%u7528%u7C7B%u4F3Csigmoid%u7684%u6FC0%u6D3B%u51FD%u6570%u7684%u65F6%u5019%uFF0C%u5219%u6FC0%u6D3B%u51FD%u6570%u8F93%u51FA%uFF0C%u6216%u8005%u8BF4%u8BE5%u8282%u70B9%u8F93%u51FA%u5747%u96C6%u4E2D%u5728%u4E2D%u5FC3%u7EBF%u6027%u533A%u57DF%uFF0C%u5219%u8BE5%u8282%u70B9%u9000%u5316%u6210%u7EBF%u6027%u6FC0%u6D3B%u51FD%u6570%uFF0C%u6240%u6709%u7684%u8282%u70B9%u9000%u5316%u6210%u7EBF%u6027%u8282%u70B9%uFF0C%u795E%u7ECF%u7F51%u7EDC%u5C31%u9000%u5316%u6210%u4E86logistic%20regression%u3002%u4E3A%u4E86%u4FDD%u6301%u975E%u7EBF%u6027%uFF0C%u4E3A%u4E86%u4FDD%u6301%u968F%u673A%u6027%uFF0C%u8981%u901A%u8FC7%24%5Cgamma%24%u548C%24%5Cbeta%24%u6765%u8C03%u6574%u6BCF%u4E2A%u72B6%u6001%u91CF%u7684%u5206%u5E03%u51FD%u6570%u3002%0A%3E%20%21%5BAlt%20text%5D%28./1535683830394.png%29%0A%0A%23%23%20Batch%20Norm%20in%20Neural%20Network%0Afor%201...num%20of%20Mini-batches%0A%u3000%u3000%u3000compute%20forward%20path%20on%20%24X%5E%7B%28t%29%7D%24%0A%u3000%u3000%u3000%u3000%u3000%u3000%u3000In%20each%20hidden%20layer%2C%20use%20BN%20to%20repair%20%24Z%5E%7B%5Bl%5D%7D%24with%20%24%5Ctilde%20%7BZ%7D%5E%7B%5Bl%5D%7D%24%0A%u3000%u3000%u3000Use%20backprop%20to%20compute%20%24dw%5E%7B%5Bl%5D%7D%2C%20d%5Cbeta%5E%7B%5Bl%5D%7D%2C%20d%5Cgamma%5E%7B%5Bl%5D%7D%24%0A%u3000%u3000%u3000Update%20params%20%0A%u3000%u3000%u3000%u3000%u3000%u3000%u3000%24w%5E%7B%5Bl%5D%7D%20%3A%3D%20w%5E%7B%5Bl%5D%7D%20-%20%5Calpha%20%5Ccdot%20dw%5E%7B%28l%29%7D%24%0A%u3000%u3000%u3000%u3000%u3000%u3000%u3000%24%5Cbeta%5E%7B%5Bl%5D%7D%20%3A%3D%20%5Cbeta%5E%7B%5Bl%5D%7D%20-%20%5Calpha%20%5Ccdot%20d%20%5Cbeta%5E%7B%5Bl%5D%7D%24%0A%u3000%u3000%u3000%u3000%u3000%u3000%u3000%24%5Cgamma%5E%7B%5Bl%5D%7D%20%3A%3D%20%5Cgamma%5E%7B%5Bl%5D%7D%20-%20%5Calpha%20%5Ccdot%20d%20%5Cgamma%5E%7B%5Bl%5D%7D%24%0AWork%20with%20momentum%2C%20RMSprop%2C%20Adam%0A%0A%u8FD9%u91CC%u6CE8%u610F%u7701%u7565%u4E86%24db%5E%7B%5Bl%5D%7D%24%2C%20%u56E0%u4E3Ab%u662F%u5E38%u91CF%uFF0C%u4E0E%u72B6%u6001%u8F93%u5165%u65E0%u5173%uFF0C%u6240%u4EE5%u5728%u6B63%u89C4%u5316%u7684%u65F6%u5019%uFF0C%u4F1A%u88AB%u8BA1%u5165%u72B6%u6001%u91CF%u7684%u671F%u671B%u503C%24%5Cbeta%24%0A%0A%23%23%20Batch%20Norm%20at%20test%20time%0A%u5728%u6D4B%u8BD5%u9636%u6BB5%uFF0C%u5BF9test%20set%u672C%u8EAB%u4E0D%u505ABatch%20Norm%uFF0C%u56E0%u4E3Atest%20set%u548Ctraining%20set%u7684%u5206%u5E03%u53EF%u80FD%u4E0D%u540C%u3002%u4F46%u662F%u5728%u505A%u6B63%u5411%u4F20%u64AD%u6C42%u9884%u6D4B%u8F93%u51FA%u7684%u65F6%u5019%uFF0C%u56E0%u4E3A%u5404%u4E2Ahidden%20unit%u7684%u53C2%u6570%u90FD%u662F%u6839%u636EBatch%20Norm%u8FED%u4EE3%u51FA%u6765%u7684%uFF0C%u6240%u4EE5%u6298%u4E2D%u7684%u529E%u6CD5%u5C31%u662F%uFF0C%u91C7%u7528exponential%20weighted%20average%u6765%u8BB0%u5F55training%20set%u7684%24%5Cmu%24%u548C%24%5Csigma%5E2%24%uFF0C%u5728%u6D4B%u8BD5%u9636%u6BB5%u4F7F%u7528%u3002%u5177%u4F53%u6B65%u9AA4%uFF1A%0A-%20%u9488%u5BF9%u6BCF%u4E2Amini%20batch%uFF0C%u6BCF%u4E00%u5C42%u8BB0%u5F55%24%5Cmu%5E%7B%5C%7Bi%5C%7D%5Bl%5D%7D%24%u548C%24%5Csigma%5E%7B2%5C%7Bi%5C%7D%5Bl%5D%7D%24%0A-%20%u4F7F%u7528exponential%20weighted%20average%20across%20mini%20batches%uFF0C%u66F4%u65B0%24%5Cmu%24%2C%20%24%5Csigma%5E2%24%0A-%20%u7ED3%u675Ftraining%u7684%u65F6%u5019%uFF0C%u8BB0%u5F55%24%5Cmu%24%u548C%24%5Csigma%5E2%24%u4F7F%u7528%u5728test%20set%u91CC]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (4) - Hyperparameters]]></title>
    <url>%2F2018%2F08%2F30%2FDeep_Learning_(4)_-_Hyperparameters%2F</url>
    <content type="text"><![CDATA[Edit&#x5728;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7684;&#x6A21;&#x578B;&#x4E2D;&#xFF0C;&#x901A;&#x5E38;&#x6709;&#x4E00;&#x4E9B;&#x8D85;&#x53C2;&#x6570;(Hyperparameter)&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&#x5B66;&#x4E60;&#x7387;()&#xFF0C;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5C42;&#x6570;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E9B;&#x662F;&#x6A21;&#x578B;&#x7684;&#x53C2;&#x6570;&#x3002;&#x76F8;&#x5BF9;&#x8D85;&#x53C2;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x901A;&#x8FC7;&#x5B66;&#x4E60;&#x8C03;&#x4F18;&#x7684;&#x6A21;&#x578B;&#x53C2;&#x6570;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;W&#xFF0C;b&#x7B49;&#x7B49;&#xFF0C;&#x79F0;&#x4E3A;learnable parameter&#x3002;&#x8D85;&#x53C2;&#x6570;&#x901A;&#x5E38;&#x5F71;&#x54CD;Gradient decent&#x8FED;&#x4EE3;&#x7684;&#x6536;&#x655B;&#x901F;&#x5EA6;&#x548C;&#x8D28;&#x91CF;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x5426;&#x6536;&#x655B;&#x3002;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x9700;&#x8981;&#x4E0D;&#x65AD;&#x7684;&#x8C03;&#x6574;&#xFF0C;&#x627E;&#x5230;&#x9002;&#x5408;&#x6A21;&#x578B;&#x7684;&#x8D85;&#x53C2;&#x6570;&#x3002;Tuning Process&#x5728;&#x5F15;&#x5165;&#x5404;&#x79CD;&#x4F18;&#x5316;&#x7B97;&#x6CD5;(Momentum&#xFF0C;RMSprop&#xFF0C;ADAM)&#x4E4B;&#x540E;&#xFF0C;&#x8D85;&#x53C2;&#x6570;&#x7684;&#x79CD;&#x7C7B;&#x53D8;&#x5F97;&#x66F4;&#x591A;&#x8D77;&#x6765;&#xFF1A;Learning rate: Momentum: ADAM: Number of layersNumber of hidden unitsLearning rate decay&#x7B97;&#x6CD5;mini-batch size&#x5728;&#x8C03;&#x8BD5;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;Andrew&#x7ED9;&#x51FA;&#x4E86;&#x4F18;&#x5148;&#x7EA7;&#xFF1A;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E48;&#x591A;&#x8D85;&#x53C2;&#x6570;&#x4E2D;&#xFF1A;Learning rate&#x662F;&#x6700;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8C03;&#x6574;&#x7684;&#xFF0C;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;learning rate&#xFF0C;&#x5426;&#x5219;&#x7B97;&#x6CD5;&#x6709;&#x53D1;&#x6563;&#x7684;&#x53EF;&#x80FD;&#x7B2C;&#x4E8C;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x662F;&#x6A59;&#x8272;&#x7684;&#x6846;&#x6846;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;Momentum , Number of hidden units, mini-batch size&#x4E4B;&#x540E;&#x662F;&#x7D2B;&#x8272;&#x7684;&#x6846;&#x6846;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;Number of layers, &#x9009;&#x62E9;Learning rate decay&#x7684;&#x7B97;&#x6CD5;ADAM&#x7684;&#x53C2;&#x6570;&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x6574;&#xFF0C;&#x7ECF;&#x5178;&#x503C;&#x5F80;&#x5F80;&#x5C31;&#x6709;&#x4E0D;&#x9519;&#x7684;&#x6548;&#x679C;&#xFF0C;Try random values, Don&#x2019;t use grid searchCoarse to fine&#x7C92;&#x5EA6;&#x7531;&#x7C97;&#x5230;&#x7CBE;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x663E;&#x800C;&#x6613;&#x89C1;&#x7684;&#x7B56;&#x7565;&#x4E86;&#x3002;&#x4E0B;&#x56FE;&#x4E5F;&#x5F88;&#x597D;&#x7684;&#x8BF4;&#x660E;&#x4E86;&#xFF1A;Using an appropriate scale to pick hyperparameter&#x8FD9;&#x91CC;&#x610F;&#x601D;&#x662F;&#x6709;&#x4E9B;&#x573A;&#x5408;&#xFF0C;&#x8D85;&#x53C2;&#x6570;&#x7684;&#x8C03;&#x8BD5;&#x8303;&#x56F4;&#x5E0C;&#x671B;&#x662F;&#x6307;&#x6570;&#x4E0A;&#x5747;&#x5300;&#x7684;&#x3002;&#x4F8B;&#x5982;Momentum&#x4E2D;&#x7684;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x60F3;&#x8C03;&#x8BD5;0.9~0.999&#x8303;&#x56F4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x60F3;&#x8C03;&#x8BD5;1-&#xFF0C;&#x53D6;&#xFF0C;%23%20Deep%20Learning%20%284%29%20-%20Hyperparameters%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%u5728%u673A%u5668%u5B66%u4E60%u7684%u6A21%u578B%u4E2D%uFF0C%u901A%u5E38%u6709%u4E00%u4E9B%u8D85%u53C2%u6570%28Hyperparameter%29%uFF0C%u4F8B%u5982%uFF1A%u5B66%u4E60%u7387%28%24%5Calpha%24%29%uFF0C%u795E%u7ECF%u7F51%u7EDC%u5C42%u6570%u7B49%u7B49%u3002%u8FD9%u4E9B%u662F%u6A21%u578B%u7684%u53C2%u6570%u3002%u76F8%u5BF9%u8D85%u53C2%u6570%uFF0C%u6211%u4EEC%u8981%u901A%u8FC7%u5B66%u4E60%u8C03%u4F18%u7684%u6A21%u578B%u53C2%u6570%uFF0C%u4F8B%u5982%uFF1AW%uFF0Cb%u7B49%u7B49%uFF0C%u79F0%u4E3Alearnable%20parameter%u3002%u8D85%u53C2%u6570%u901A%u5E38%u5F71%u54CDGradient%20decent%u8FED%u4EE3%u7684%u6536%u655B%u901F%u5EA6%u548C%u8D28%u91CF%uFF0C%u751A%u81F3%u662F%u5426%u6536%u655B%u3002%u6240%u4EE5%u901A%u5E38%u9700%u8981%u4E0D%u65AD%u7684%u8C03%u6574%uFF0C%u627E%u5230%u9002%u5408%u6A21%u578B%u7684%u8D85%u53C2%u6570%u3002%0A%23%23%20Tuning%20Process%0A%u5728%u5F15%u5165%u5404%u79CD%u4F18%u5316%u7B97%u6CD5%28Momentum%uFF0CRMSprop%uFF0CADAM%29%u4E4B%u540E%uFF0C%u8D85%u53C2%u6570%u7684%u79CD%u7C7B%u53D8%u5F97%u66F4%u591A%u8D77%u6765%uFF1A%0A-%20Learning%20rate%3A%20%24%5Calpha%24%0A-%20Momentum%3A%20%24%5Cbeta%24%0A-%20ADAM%3A%20%24%5Cbeta_1%2C%20%5Cbeta_2%2C%20%5Cepsilon%24%0A-%20Number%20of%20layers%0A-%20Number%20of%20hidden%20units%0A-%20Learning%20rate%20decay%u7B97%u6CD5%0A-%20mini-batch%20size%0A%0A%u5728%u8C03%u8BD5%u8FD9%u4E9B%u53C2%u6570%u7684%u65F6%u5019%uFF0CAndrew%u7ED9%u51FA%u4E86%u4F18%u5148%u7EA7%uFF1A%0A%21%5BAlt%20text%7C250x0%5D%28./1535585275676.png%29%0A%3E%u89E3%u91CA%u4E00%u4E0B%uFF0C%u8FD9%u4E48%u591A%u8D85%u53C2%u6570%u4E2D%uFF1A%0A-%20Learning%20rate%u662F%u6700%u91CD%u8981%u7684%uFF0C%u9996%u5148%u8981%u8C03%u6574%u7684%uFF0C%u9009%u62E9%u5408%u9002%u7684learning%20rate%uFF0C%u5426%u5219%u7B97%u6CD5%u6709%u53D1%u6563%u7684%u53EF%u80FD%0A-%20%u7B2C%u4E8C%u4F18%u5148%u7EA7%u7684%u662F%u6A59%u8272%u7684%u6846%u6846%uFF0C%u5305%u62EC%uFF1AMomentum%20%24%5Cbeta%24%2C%20Number%20of%20hidden%20units%2C%20mini-batch%20size%0A-%20%u4E4B%u540E%u662F%u7D2B%u8272%u7684%u6846%u6846%uFF0C%u5305%u62EC%uFF1ANumber%20of%20layers%2C%20%u9009%u62E9Learning%20rate%20decay%u7684%u7B97%u6CD5%0A-%20ADAM%u7684%u53C2%u6570%u901A%u5E38%u4E0D%u9700%u8981%u8C03%u6574%uFF0C%u7ECF%u5178%u503C%u5F80%u5F80%u5C31%u6709%u4E0D%u9519%u7684%u6548%u679C%uFF0C%24%5Cbeta_1%3D0.9%2C%20%5Cbeta_2%3D0.999%2C%20%5Cepsilon%3D10%5E%7B-8%7D%24%0A%0A%23%23%20Try%20random%20values%2C%20Don%27t%20use%20grid%20search%0A%21%5BAlt%20text%7C650x0%5D%28./1535613475283.png%29%0A%u4E3A%u4EC0%u4E48%u4E0D%u7528grid%20search%uFF1F%u56E0%u4E3A%u8D85%u53C2%u6570%u7684%u91CD%u8981%u6027%u4E0D%u540C%u3002%u5982%u5DE6%u56FE%u7684%u7F51%u683C%u641C%u7D22%uFF0C5%u4E2A%u4E0D%u540C%u7684%24%5Calpha%24%u642D%u914D5%u4E2A%u4E0D%u540C%u7684%24%5Cepsilon%24%uFF0C%u7ED3%u679C%u53D1%u73B0%24%5Cepsilon%24%u5BF9%u7ED3%u679C%u5E76%u6CA1%u6709%u4EC0%u4E48%u5F71%u54CD%u3002%u90A3%u4E48%u8FD925%u6B21%u6D4B%u8BD5%uFF0C%u5176%u5B9E%u53EA%u67095%u7EC4%u662F%u6709%u6548%u7684%u3002%0A%u5982%u679C%u91C7%u7528%u53F3%u56FErandom%20search%uFF0C%u56E0%u4E3A%u6BCF%u7EC4%u7684%24%5Calpha%24%u548C%24%5Cepsilon%24%u5747%u4E0D%u76F8%u540C%uFF0C%u6240%u4EE5%u662F25%u7EC4%u6709%u6548%u6D4B%u8BD5%u3002%u4E5F%u5C31%u662F%u8BF4%u968F%u673A%u6D4B%u8BD5%u7684%u6548%u7387%u8981%u9AD8%u4E8E%u7F51%u683C%u6D4B%u8BD5%u3002%0A%0A%23%23%20Coarse%20to%20fine%0A%u7C92%u5EA6%u7531%u7C97%u5230%u7CBE%uFF0C%u8FD9%u4E2A%u5C31%u662F%u663E%u800C%u6613%u89C1%u7684%u7B56%u7565%u4E86%u3002%u4E0B%u56FE%u4E5F%u5F88%u597D%u7684%u8BF4%u660E%u4E86%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1535613723014.png%29%0A%u7ECF%u8FC7%u6D4B%u8BD5%u53D1%u73B0%u5176%u4E2D3%u70B9%u6548%u679C%u4E0D%u9519%uFF0C%u90A3%u5C31%u7F29%u5C0F%u533A%u57DF%uFF0C%u63D0%u9AD8%u641C%u7D22%u7CBE%u5EA6%u6765%u6D4B%u8BD5%u66F4%u591A%u7684%u70B9%u3002%0A%0A%23%23%20Using%20an%20appropriate%20scale%20to%20pick%20hyperparameter%0A%u8FD9%u91CC%u610F%u601D%u662F%u6709%u4E9B%u573A%u5408%uFF0C%u8D85%u53C2%u6570%u7684%u8C03%u8BD5%u8303%u56F4%u5E0C%u671B%u662F%u6307%u6570%u4E0A%u5747%u5300%u7684%u3002%u4F8B%u5982Momentum%u4E2D%u7684%24%5Cbeta%24%uFF0C%u5F53%u6211%u4EEC%u60F3%u8C03%u8BD50.9%7E0.999%u8303%u56F4%u7684%u65F6%u5019%uFF0C%u5B9E%u9645%u4E0A%u662F%u60F3%u8C03%u8BD51-%24%5Cbeta%20%5Cin%20%5B10%5E%7B-3%7D%2C%2010%5E%7B-1%7D%5D%24%uFF0C%u53D6%24r%20%5Cin%20%5B-3%2C%20-1%5D%24%uFF0C%24%5Cbeta%20%3D%201-10%5Er%24]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (3) - Optimization Algorithms]]></title>
    <url>%2F2018%2F08%2F23%2FDeep_Learning_(3)_-_Optimization_Algorithms%2F</url>
    <content type="text"><![CDATA[EditBatch. vs. Mini-Batch&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x901A;&#x5E38;&#x4F1A;&#x6709;&#x5927;&#x91CF;&#x7684;training sample&#x9700;&#x8981;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#x53EF;&#x80FD;&#x662F;&#x767E;&#x4E07;&#x91CF;&#x7EA7;&#xFF0C;&#x751A;&#x81F3;&#x66F4;&#x9AD8;&#x3002;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x77E9;&#x9635;&#x8FED;&#x4EE3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x8FC7;&#x957F;&#x3002;&#x5F53;sample&#x6570;&#x8FBE;&#x5230;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x91C7;&#x7528;&#x5C06;&#x6574;&#x4E2A;&#x8BAD;&#x7EC3;&#x96C6;&#xFF0C;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x5C0F;&#x96C6;&#x5408;&#xFF0C;&#x5373;mini-batch&#xFF0C;&#x91C7;&#x7528;&#x8FED;&#x4EE3;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x8BA1;&#x7B97;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x5C06;&#x4E00;&#x6B21;&#x77E9;&#x9635;&#x8FD0;&#x7B97;&#x4E32;&#x884C;&#x5316;&#xFF0C;&#x964D;&#x4F4E;&#x8FD0;&#x7B97;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x901F;&#x5EA6;&#x4F1A;&#x5927;&#x5E45;&#x63D0;&#x5347;&#x3002;&#x7F3A;&#x70B9;&#x662F;&#x6536;&#x655B;&#x4F1A;&#x56F0;&#x96BE;&#x4E00;&#x4E9B;&#x3002;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;How to choose mini-batch size?If small training set (m 2000), use batch gradient descent.Typical mini-batch size: 64, 128, 256, 512, -&gt; ~Make sure mini-batch size fit your CPU/GPU memory.Learning Rate Decay&#x52A8;&#x6001;&#x8C03;&#x6574;learning rate&#x7684;&#x7B97;&#x6CD5;&#x6709;&#x5F88;&#x591A;&#x79CD;&#xFF0C;&#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x662F;&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684; epoch_num = 1,2,3, &#x968F;&#x7740;epoch_num&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#xFF0C;&#x8D8A;&#x6765;&#x8D8A;&#x5C0F;&#x3002;Other learning rate decay methods:discrete stair casemanual decay&#x6307;&#x6570;&#x52A0;&#x6743;&#x5E73;&#x5747;&#x76F8;&#x5173;&#x7B97;&#x6CD5;Momentum, RMSprop, Adam&#x90FD;&#x662F;&#x548C;&#x6307;&#x6570;&#x52A0;&#x6743;&#x5E73;&#x5747;&#x7B97;&#x6CD5;(Exponential Weighted Average)&#x76F8;&#x5173;&#x7684;&#x3002;&#x4E0B;&#x9762;&#x4E00;&#x4E00;&#x4ECB;&#x7ECD;&#xFF1A;Exponential Weighted Average&#x516C;&#x5F0F;&#x662F;: &#x5176;&#x7528;&#x610F;&#x5C31;&#x662F;&#x5BF9;&#x8FC7;&#x53BB;&#x4E2A;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5E73;&#x5747;&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x6743;&#x91CD;&#xFF0C;&#x5BF9;&#x672C;&#x8F6E;&#x6570;&#x636E;&#x91C7;&#x7528;&#x6743;&#x91CD;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5219;&#x4F1A;&#x52A0;&#x6743;&#x5E73;&#x5747;&#x524D;10&#x4E2A;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;0.1&#x672C;&#x8F6E;&#x6570;&#x636E;&#x3002;&#x5176;&#x6548;&#x679C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;&#x84DD;&#x70B9;&#x662F;&#x539F;&#x59CB;&#x6570;&#x636E;&#x7EA2;&#x7EBF;&#x91C7;&#x7528;&#xFF0C;&#x7D2F;&#x79EF;&#x524D;10&#x4E2A;&#x6570;&#x636E;&#x7684;&#x5F71;&#x54CD;&#x7EFF;&#x7EBF;&#x91C7;&#x7528;&#xFF0C;&#x7D2F;&#x79EF;&#x524D;20&#x4E2A;&#x6570;&#x636E;&#x7684;&#x5F71;&#x54CD;&#x9EC4;&#x7EBF;&#x91C7;&#x7528;&#xFF0C;&#x7D2F;&#x79EF;&#x524D;2&#x4E2A;&#x6570;&#x636E;&#x7684;&#x5F71;&#x54CD; &#x53EF;&#x89C1;&#xFF0C;&#x91C7;&#x7528;&#x6307;&#x6570;&#x52A0;&#x6743;&#x5E73;&#x5747;&#x540E;&#xFF0C;&#x6570;&#x636E;&#x53D8;&#x5E73;&#x6ED1;&#xFF0C;&#x4E14;&#x8D8A;&#x5927;&#xFF0C;&#x6570;&#x636E;&#x8D8A;&#x5E73;&#x6ED1;&#xFF0C;&#x8D8A;&#x5C0F;&#xFF0C;&#x6570;&#x636E;&#x8D8A;&#x8D8B;&#x8FD1;&#x4E8E;&#x539F;&#x59CB;&#x6570;&#x636E;&#x3002;How it works?&#x5176;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;Bias Correction Exponential Weighted Average&#x4E4B;&#x6240;&#x4EE5;&#x6709;&#x8FD9;&#x4E2A;bias correction&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x6307;&#x6570;&#x52A0;&#x6743;&#x7684;&#x521D;&#x59CB;&#x503C;&#x9009;&#x7684;&#x662F;0&#xFF0C;&#x9020;&#x6210;&#x5F00;&#x59CB;&#x4E00;&#x6BB5;&#x7684;&#x8FED;&#x4EE3;&#xFF0C;&#x4F1A;&#x504F;&#x79BB;&#x771F;&#x5B9E;&#x503C;&#x8F83;&#x8FDC;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7EFF;&#x7EBF;&#x548C;&#x7D2B;&#x7EBF;&#x3002;&#x5F53;&#x5F00;&#x59CB;&#x9636;&#x6BB5;&#xFF0C;t&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x4E5F;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x8BA9;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#x6CA1;&#x90A3;&#x4E48;&#x5C0F;&#xFF0C;&#x4EE5;&#x8FBE;&#x5230;&#x7EA0;&#x6B63;&#x504F;&#x5DEE;&#x7684;&#x6548;&#x679C;&#x3002;MomentumMomentum&#x5C31;&#x662F;&#x6307;&#x6570;&#x52A0;&#x6743;&#x5E73;&#x5747;&#x7B97;&#x6CD5;&#x7684;&#x4E00;&#x79CD;&#x5E94;&#x7528;&#x3002;RMSprop (Root Mean Square prop)RMSprop&#x662F;&#x6839;&#x636E;Momentum&#x884D;&#x751F;&#x51FA;&#x6765;&#x7684;&#x7B97;&#x6CD5;&#x3002;&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;On iteration t:Compute dw and db on current mini-batch&#x4E3A;&#x4E86;&#x533A;&#x5206;Momentum&#x548C;Exponential Weighted Average&#x4E2D;&#x7684;hyper parameter &#xFF0C;&#x6B64;&#x5904;&#x7528;Adam optimization algorithmAdam = Adaptive Moment Estimation Adam = Momentum + Bias Correction + RMSprop &#x5177;&#x4F53;&#x7B97;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A; On iteration t:Compute dw and db on current mini-batch, , , , Hyper parameters (&#x901A;&#x5E38;&#x53BB;&#x7ECF;&#x9A8C;&#x503C;) Local Optima ProblemAndrew&#x89E3;&#x91CA;&#x4E86;&#xFF0C;&#x5728;&#x73B0;&#x4EE3;&#x7684;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x95EE;&#x9898;&#x4E2D;&#xFF0C;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x51FA;&#x73B0;local optima%23%20Deep%20Learning%20%283%29%20-%20Optimization%20Algorithms%0A@%28myblog%29%5Bdeep%20learning%2C%20machine%20learning%5D%0A%0A%23%23%20Batch.%20vs.%20Mini-Batch%0A%u673A%u5668%u5B66%u4E60%u7B97%u6CD5%u901A%u5E38%u4F1A%u6709%u5927%u91CF%u7684training%20sample%u9700%u8981%u5904%u7406%uFF0C%u8FD9%u4E2A%u6570%u5B57%u53EF%u80FD%u662F%u767E%u4E07%u91CF%u7EA7%uFF0C%u751A%u81F3%u66F4%u9AD8%u3002%u8FD9%u4F1A%u5BFC%u81F4%u77E9%u9635%u8FED%u4EE3%u7684%u65F6%u5019%uFF0C%u8BA1%u7B97%u65F6%u95F4%u8FC7%u957F%u3002%u5F53sample%u6570%u8FBE%u5230%u4E00%u5B9A%u6570%u91CF%u7684%u65F6%u5019%uFF0C%u901A%u5E38%u4F1A%u91C7%u7528%u5C06%u6574%u4E2A%u8BAD%u7EC3%u96C6%uFF0C%u5206%u6210%u82E5%u5E72%u5C0F%u96C6%u5408%uFF0C%u5373mini-batch%uFF0C%u91C7%u7528%u8FED%u4EE3%u7684%u65B9%u6CD5%u6765%u8BA1%u7B97%u3002%u8FD9%u6837%u5C31%u5C06%u4E00%u6B21%u77E9%u9635%u8FD0%u7B97%u4E32%u884C%u5316%uFF0C%u964D%u4F4E%u8FD0%u7B97%u590D%u6742%u5EA6%uFF0C%u901F%u5EA6%u4F1A%u5927%u5E45%u63D0%u5347%u3002%u7F3A%u70B9%u662F%u6536%u655B%u4F1A%u56F0%u96BE%u4E00%u4E9B%u3002%u770B%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%7C300x0%5D%28./1534979648469.png%29%0A%u84DD%u7EBF%u662Fbatch%20gradient%20descent%uFF0C%u7D2B%u7EBF%u662Fstochastic%20gradient%20descent%20%28mini-batch%20size%20%3D%201%29%uFF0C%u7EFF%u7EBF%u662Fmini-batch%20gradient%20descent%20%281%24%5Clt%24mini-batch%20size%20%24%5Clt%24%20m%29%u3002%0A%u84DD%u7EBF%u53EF%u4EE5%u5E73%u6ED1%u7684%u6536%u655B%u5230%u6781%u503C%u70B9%uFF0C%u7D2B%u7EBF%u5728%u6781%u503C%u70B9%u9644%u8FD1%u5267%u70C8%u632F%u52A8%uFF0C%u7EFF%u7EBF%u4ECB%u4E8E%u7D2B%u7EBF%u548C%u84DD%u7EBF%u4E4B%u95F4%uFF0C%u5728%u6781%u503C%u70B9%u9644%u8FD1%u5C0F%u5E45%u7684%u5F98%u5F8A%u3002%u53EF%u4EE5%u901A%u8FC7%u52A8%u6001%u8C03%u6574learning%20rate%u6765%u8BA9%u4ED6%u8FDB%u4E00%u6B65%u6536%u655B%u5230%u6781%u503C%u70B9%u3002%0A%0A%23%23%23%20How%20to%20choose%20mini-batch%20size%3F%0A-%20If%20small%20training%20set%20%28m%20%24%5Cle%24%202000%29%2C%20use%20batch%20gradient%20descent.%0A-%20Typical%20mini-batch%20size%3A%2064%2C%20128%2C%20256%2C%20512%2C%20%24%5Cdots%24%20-%3E%20%242%5E6%24%7E%242%5E9%24%0A-%20Make%20sure%20mini-batch%20size%20fit%20your%20CPU/GPU%20memory.%0A%0A%23%23%23%20Learning%20Rate%20Decay%0A%u52A8%u6001%u8C03%u6574learning%20rate%u7684%u7B97%u6CD5%u6709%u5F88%u591A%u79CD%uFF0C%u4E0B%u9762%u8FD9%u79CD%u662F%u6BD4%u8F83%u5E38%u7528%u7684%0A%24%24%5Calpha%20%3D%20%5Cfrac%20%7B1%7D%7B1+decay%5C_rate%20*%20epoch%5C_num%7D%20%5Calpha_0%24%24%0Aepoch_num%20%3D%201%2C2%2C3%2C%24%5Cdots%24%0A%u968F%u7740epoch_num%u8D8A%u6765%u8D8A%u5927%uFF0C%24%5Calpha%24%u8D8A%u6765%u8D8A%u5C0F%u3002%0A%3E%20Other%20learning%20rate%20decay%20methods%3A%0A%3E%20-%20%24%5Calpha%20%3D%200.95%5E%7Bepoch%5C_num%7D%5Calpha0%24%0A%3E%20-%20%24%5Calpha%20%3D%20%5Cfrac%20%7Bk%7D%20%7B%5Csqrt%20%7Bepoch%5C_num%7D%7D%20%5Calpha_0%24%0A%3E%20-%20discrete%20stair%20case%0A%3E%20-%20manual%20decay%0A%0A%23%23%20%u6307%u6570%u52A0%u6743%u5E73%u5747%u76F8%u5173%u7B97%u6CD5%0AMomentum%2C%20RMSprop%2C%20Adam%u90FD%u662F%u548C%u6307%u6570%u52A0%u6743%u5E73%u5747%u7B97%u6CD5%28Exponential%20Weighted%20Average%29%u76F8%u5173%u7684%u3002%u4E0B%u9762%u4E00%u4E00%u4ECB%u7ECD%uFF1A%0A%0A%23%23%23%20Exponential%20Weighted%20Average%0A%u516C%u5F0F%u662F%3A%0A%24%24v_t%20%3D%20%5Cbeta%20v_%7Bt-1%7D%20+%20%281-%5Cbeta%29%5Ctheta_t%24%24%0A%u5176%u7528%u610F%u5C31%u662F%u5BF9%u8FC7%u53BB%24%5Cfrac%20%7B1%7D%7B1-%5Cbeta%7D%24%u4E2A%u6570%u636E%u8FDB%u884C%u5E73%u5747%uFF0C%u5E76%u6DFB%u52A0%u6743%u91CD%24%5Cbeta%24%uFF0C%u5BF9%u672C%u8F6E%u6570%u636E%u91C7%u7528%u6743%u91CD%241-%5Cbeta%24%u3002%u4F8B%u5982%24%5Cbeta%20%3D%200.9%24%uFF0C%u5219%u4F1A%u52A0%u6743%u5E73%u5747%u524D10%u4E2A%u6570%u636E%uFF0C%u5E76%u6DFB%u52A00.1%u672C%u8F6E%u6570%u636E%u3002%u5176%u6548%u679C%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%7C450x0%5D%28./1534980671272.png%29%0A-%20%u84DD%u70B9%u662F%u539F%u59CB%u6570%u636E%0A-%20%u7EA2%u7EBF%u91C7%u7528%24%5Cbeta%20%3D%200.9%24%uFF0C%u7D2F%u79EF%u524D10%u4E2A%u6570%u636E%u7684%u5F71%u54CD%0A-%20%u7EFF%u7EBF%u91C7%u7528%24%5Cbeta%20%3D%200.98%24%uFF0C%u7D2F%u79EF%u524D20%u4E2A%u6570%u636E%u7684%u5F71%u54CD%0A-%20%u9EC4%u7EBF%u91C7%u7528%24%5Cbeta%20%3D%200.5%24%uFF0C%u7D2F%u79EF%u524D2%u4E2A%u6570%u636E%u7684%u5F71%u54CD%0A%u53EF%u89C1%uFF0C%u91C7%u7528%u6307%u6570%u52A0%u6743%u5E73%u5747%u540E%uFF0C%u6570%u636E%u53D8%u5E73%u6ED1%uFF0C%u4E14%24%5Cbeta%24%u8D8A%u5927%uFF0C%u6570%u636E%u8D8A%u5E73%u6ED1%uFF0C%24%5Cbeta%24%u8D8A%u5C0F%uFF0C%u6570%u636E%u8D8A%u8D8B%u8FD1%u4E8E%u539F%u59CB%u6570%u636E%u3002%0A%0A%23%23%23%23%20How%20it%20works%3F%0A%u5176%u5DE5%u4F5C%u539F%u7406%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1534981358549.png%29%0A%u6839%u636E%u7814%u7A76%u6709%u516C%u5F0F%24%281-%5Cepsilon%29%5E%7B%5Cfrac%7B1%7D%7B%5Cepsilon%7D%7D%20%5Capprox%200.35%24%uFF0C%24%5Cepsilon%20%3D%201-%5Cbeta%24%uFF0C%241-%5Cbeta%24%u540E%u7684%u6570%u636E%u6743%u503C%u5C31%u5F88%u5C0F%u4E86%uFF0C%u4F8B%u5982%24%5Cbeta%3D0.9%24%uFF0Ct%3D10%u4EE5%u540E%u6743%u503C%u7EA6%u4E3A%24%5Cbeta%281-%5Cbeta%29%5Et%20%3D%200.1*0.9%5E%7B10%7D%20%5Capprox%200.035%24%uFF0C%u82E5%24%5Cbeta%20%3D%200.98%24%uFF0Ct%3D50%u4EE5%u540E%u6743%u503C%u4E3A%24%5Cbeta%281-%5Cbeta%29%5Et%20%3D%200.02*0.98%5E%7B50%7D%20%5Capprox%200.007%24%uFF0C%u6240%u4EE5%u901A%u5E38%u53EA%u8003%u8651%u524D%24%5Cfrac%20%7B1%7D%7B1-%5Cbeta%7D%24%u4E2A%u6570%u636E%u5E26%u6765%u7684%u5F71%u54CD%u3002%0A%0A%23%23%23%23%20Bias%20Correction%20Exponential%20Weighted%20Average%0A%u4E4B%u6240%u4EE5%u6709%u8FD9%u4E2Abias%20correction%uFF0C%u56E0%u4E3A%u8FD9%u4E2A%u6307%u6570%u52A0%u6743%u7684%u521D%u59CB%u503C%u9009%u7684%u662F0%uFF0C%u9020%u6210%u5F00%u59CB%u4E00%u6BB5%u7684%u8FED%u4EE3%uFF0C%u4F1A%u504F%u79BB%u771F%u5B9E%u503C%u8F83%u8FDC%u3002%u4F8B%u5982%u4E0B%u9762%u7EFF%u7EBF%u548C%u7D2B%u7EBF%u3002%0A%21%5BAlt%20text%5D%28./1535013368575.png%29%0A%u5177%u4F53%u7B97%u6CD5%u5982%u4E0B%uFF1A%0A%24%24v_t%20%3D%20%5Cfrac%20%7Bv_t%7D%7B1-%5Cbeta%5Et%7D%24%24%0A%u5F53%u5F00%u59CB%u9636%u6BB5%uFF0Ct%u6BD4%u8F83%u5C0F%uFF0C%24%5Cfrac%20%7B1%7D%7B1-%5Cbeta%5Et%7D%24%u4E5F%u6BD4%u8F83%u5C0F%uFF0C%u8FD9%u6837%u53EF%u4EE5%u8BA9%u8BA1%u7B97%u51FA%u6765%u7684%24v_t%24%u6CA1%u90A3%u4E48%u5C0F%uFF0C%u4EE5%u8FBE%u5230%u7EA0%u6B63%u504F%u5DEE%u7684%u6548%u679C%u3002%0A%0A%0A%23%23%23%20Momentum%0AMomentum%u5C31%u662F%u6307%u6570%u52A0%u6743%u5E73%u5747%u7B97%u6CD5%u7684%u4E00%u79CD%u5E94%u7528%u3002%0A%21%5BAlt%20text%5D%28./1535016214569.png%29%0A%u901A%u5E38%u6211%u4EEC%u60F3%u52A0%u5FEB%u6A2A%u5411%u7684%u79FB%u52A8%uFF0C%u51CF%u5C11%u7EB5%u5411%u7684%u632F%u52A8%u3002%u6240%u4EE5%u6307%u6570%u52A0%u6743%u5E73%u5747%u53EF%u4EE5%u5E2E%u5FD9%u3002%0A%21%5BAlt%20text%7C450x0%5D%28./1535013718754.png%29%0AMomentum%u901A%u5E38%u4E0D%u7528bias%20correction%u3002%u56E0%u4E3Abias%u53EA%u4F1A%u5F71%u54CD%u524D%u51E0%u8F6E%u8FED%u4EE3%uFF0C%u4E0D%u4F1A%u5F71%u54CD%u5230%u540E%u9762%u8FED%u4EE3%u7684%u6536%u655B%u3002%0A%0A%23%23%23%20RMSprop%20%28Root%20Mean%20Square%20prop%29%0ARMSprop%u662F%u6839%u636EMomentum%u884D%u751F%u51FA%u6765%u7684%u7B97%u6CD5%u3002%u5177%u4F53%u505A%u6CD5%u5982%u4E0B%uFF1A%0A%3E%20On%20iteration%20t%3A%0A-%20Compute%20dw%20and%20db%20on%20current%20mini-batch%0A-%20%24S_%7Bdw%7D%20%3D%20%5Cbeta_2%20S_%7Bdw%7D%20+%20%281-%5Cbeta_2%29dw%5E2%24%0A-%20%24S_%7Bdb%7D%20%3D%20%5Cbeta_2%20S_%7Bdb%7D%20+%20%281-%5Cbeta_2%29db%5E2%24%0A-%20%24w%20%3A%3D%20w-%5Calpha%20%5Cfrac%7Bdw%7D%7B%5Csqrt%20%7BS_%7Bdw%7D%7D%20+%20%5Cepsilon%7D%24%0A-%20%24b%20%3A%3D%20b-%5Calpha%20%5Cfrac%7Bdb%7D%7B%5Csqrt%20%7BS_%7Bdb%7D%7D%20+%20%5Cepsilon%7D%24%0A-%20%24%5Cepsilon%20%3D%2010%5E%7B-8%7D%24%0A%0A%u4E3A%u4E86%u533A%u5206Momentum%u548CExponential%20Weighted%20Average%u4E2D%u7684hyper%20parameter%20%24%5Cbeta%24%uFF0C%u6B64%u5904%u7528%24%5Cbeta_2%24%0A%0A%23%23%23%20Adam%20optimization%20algorithm%0AAdam%20%3D%20Adaptive%20Moment%20Estimation%0AAdam%20%3D%20Momentum%20+%20Bias%20Correction%20+%20RMSprop%0A%u5177%u4F53%u7B97%u6CD5%u5982%u4E0B%uFF1A%0A%3E%20%24v_%7Bdw%7D%20%3D%200%2C%20S_%7Bdw%7D%20%3D%200%2C%20v_%7Bdb%7D%20%3D%200%2C%20S_%7Bdb%7D%20%3D%200%24%0AOn%20iteration%20t%3A%0A-%20Compute%20dw%20and%20db%20on%20current%20mini-batch%0A-%20%24v_%7Bdw%7D%20%3D%20%5Cbeta_1%20v_%7Bdw%7D%20+%20%281-%5Cbeta_1%29dw%24%2C%20%24S_%7Bdw%7D%20%3D%20%5Cbeta_2%20S_%7Bdw%7D%20+%20%281-%5Cbeta_2%29dw%5E2%24%0A-%20%24v_%7Bdb%7D%20%3D%20%5Cbeta_1%20v_%7Bdb%7D%20+%20%281-%5Cbeta_1%29db%24%2C%20%24S_%7Bdb%7D%20%3D%20%5Cbeta_2%20S_%7Bdb%7D%20+%20%281-%5Cbeta_2%29db%5E2%24%0A-%20%24v_%7Bdw%7D%5E%7Bcorrected%7D%20%3D%20%5Cfrac%20%7Bv_%7Bdw%7D%7D%7B1-%5Cbeta_1%5Et%7D%24%2C%20%24v_%7Bdb%7D%5E%7Bcorrected%7D%20%3D%20%5Cfrac%20%7Bv_%7Bdb%7D%7D%7B1-%5Cbeta_1%5Et%7D%24%0A-%20%24S_%7Bdw%7D%5E%7Bcorrected%7D%20%3D%20%5Cfrac%20%7BS_%7Bdw%7D%7D%7B1-%5Cbeta_2%5Et%7D%24%2C%20%24S_%7Bdb%7D%5E%7Bcorrected%7D%20%3D%20%5Cfrac%20%7BS_%7Bdb%7D%7D%7B1-%5Cbeta_2%5Et%7D%24%0A-%20%24w%20%3A%3D%20w-%5Calpha%20%5Cfrac%7Bv_%7Bdw%7D%5E%7Bcorrected%7D%7D%7B%5Csqrt%20%7BS_%7Bdw%7D%5E%7Bcorrected%7D%7D%20+%20%5Cepsilon%7D%24%0A-%20%24b%20%3A%3D%20b-%5Calpha%20%5Cfrac%7Bv_%7Bdb%7D%5E%7Bcorrected%7D%7D%7B%5Csqrt%20%7BS_%7Bdb%7D%5E%7Bcorrected%7D%7D%20+%20%5Cepsilon%7D%24%0A%0A%3E%20Hyper%20parameters%20%28%u901A%u5E38%u53BB%u7ECF%u9A8C%u503C%29%0A%3E%20%21%5BAlt%20text%7C300x0%5D%28./1535017116124.png%29%0A%0A%23%23%20Local%20Optima%20Problem%0AAndrew%u89E3%u91CA%u4E86%uFF0C%u5728%u73B0%u4EE3%u7684%u673A%u5668%u5B66%u4E60%u95EE%u9898%u4E2D%uFF0C%u4E0D%u592A%u53EF%u80FD%u51FA%u73B0local%20optima%0A%21%5BAlt%20text%5D%28./1535017928729.png%29%0A%u4F8B%u5982%u4E0A%u56FE%uFF0C%u770B%u8D77%u6765%u6709%u5F88%u591Alocal%20optima%uFF0C%u6709%u4E00%u4E2Aglobal%20optima%u3002%u4F46%u5176%u5B9E%u73B0%u5B9E%u5E76%u4E0D%u662F%u8FD9%u6837%uFF0C%u56E0%u4E3A%u8FD9%u91CC%u53EA%u662F%u4E09%u7EF4%u56FE%uFF0C%u53EA%u80FD%u753B%u51FA%u5173%u4E8E%u635F%u5931%u51FD%u6570J%u7684%u4E24%u4E2A%u7EF4%u5EA6%u3002%u4F46%u4E8B%u5B9E%u4E0AJ%u4E0Ew%u548Cb%u6709%u5173%uFF0C%u800Cw%u662F%u4E00%u4E2A%u77E9%u9635%uFF0C%u6709%u5F88%u591A%u5143%u7D20%uFF0Clocal%20optima%u8981%u6C42%u6240%u6709%u5143%u7D20%u7684%u5206%u6B65%u90FD%u8981%u6EE1%u8DB3%u6781%u503C%u70B9%u7684%u8981%u6C42%uFF0C%u5728w%u7EF4%u5EA6%u5F88%u9AD8%u65F6%uFF0C%u5E76%u4E0D%u592A%u53EF%u80FD%u51FA%u73B0%u3002%u6240%u4EE5%u4E0D%u9700%u8981%u62C5%u5FC3local%20optima%u7684%u95EE%u9898%u3002%0A%0A%0A]]></content>
      <tags>
        <tag>machine learning</tag>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (2) - Regularization]]></title>
    <url>%2F2018%2F08%2F17%2FDeep_Learning_(2)_-_Regularization%2F</url>
    <content type="text"><![CDATA[Edit&#x5728;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x4E2D;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x5E38;&#x89C1;&#x7684;&#x95EE;&#x9898;&#xFF1A;bias (&#x6216;&#x8005;hIgh bias, underfitting&#xFF0C;&#x6B20;&#x62DF;&#x5408;)variance (&#x6216;&#x8005;high variance, overfitting, &#x8FC7;&#x62DF;&#x5408;)&#x524D;&#x8005;&#x901A;&#x5E38;&#x56E0;&#x4E3A;&#x6A21;&#x578B;&#x4E0D;&#x591F;&#x590D;&#x6742;&#xFF0C;&#x4E0D;&#x8DB3;&#x4EE5;&#x901A;&#x8FC7;&#x73B0;&#x6709;&#x6570;&#x636E;&#x9884;&#x6D4B;&#x51FA;&#x6B63;&#x786E;&#x7684;&#x7ED3;&#x679C;&#x3002;training error&#x8FC7;&#x5927;&#x3002;&#x89E3;&#x51B3;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x589E;&#x5927;&#x8BAD;&#x7EC3;&#x7F51;&#x7EDC;&#x3002; &#x800C;&#x540E;&#x8005;&#x662F;&#x56E0;&#x4E3A;&#x6A21;&#x578B;&#x8FC7;&#x4E8E;&#x4F9D;&#x8D56;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x5BF9;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x6548;&#x679C;&#x4E0D;&#x4F73;&#x3002;training error&#x4E0D;&#x5927;&#xFF0C;&#x4F46;&#x662F;dev error&#x5374;&#x6BD4;&#x8F83;&#x5927;&#x3002;&#x6539;&#x5584;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x6B63;&#x5219;&#x5316;&#xFF0C;&#x5373;Regularization&#x3002;Regularization&#x52A0;&#x5165;&#x6B63;&#x5219;&#x5316;&#x56E0;&#x7D20;&#x7684;&#x635F;&#x5931;&#x51FD;&#x6570;&#x5982;&#x4E0B;&#xFF1A; (1)&#x5F0F;&#x4E2D;&#x6CA1;&#x6709;&#x5BF9;b&#x8FDB;&#x884C;&#x6B63;&#x5219;&#x5316;&#xFF0C;&#x5373;&#x6CA1;&#x6709;&#x3002;&#x539F;&#x56E0;&#x662F;b&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5E38;&#x6570;&#xFF0C;&#x800C;w&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E2A;&#x5927;&#x77E9;&#x9635;&#xFF0C;&#x6570;&#x636E;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x8FC7;&#x62DF;&#x5408;&#x3002;&#x6DFB;&#x52A0;b&#x4E5F;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x901A;&#x5E38;&#x5BF9;&#x8FD0;&#x7B97;&#x7ED3;&#x679C;&#x5F71;&#x54CD;&#x4E0D;&#x5927;&#x3002;(1)&#x5F0F;&#x7684;&#x6B63;&#x5219;&#x9879;&#xFF0C;&#x79F0;&#x4E3A;L2 regularization&#x3002;&#x901A;&#x5E38;&#x6709;&#x4E0B;&#x9762;&#x51E0;&#x79CD;&#xFF1A;L2 regularization (&#x53C8;&#x53EB;weight decay): L1 regularization: Frobenius regularization: Dropout regularization: &#x5728;&#x53E6;&#x4E00;&#x7AE0;&#x5355;&#x72EC;&#x9610;&#x8FF0;&#x3002;L2 regularization = weight decay &#x56E0;&#x4E3A;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x6B63;&#x5219;&#x5316;&#x7684;&#x635F;&#x5931;&#x51FD;&#x6570;&#x6C42;&#x5BFC;&#x65F6;&#x6709;&#xFF1A; &#x6211;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x56E0;&#x4E3A;w&#x5728;&#x51CF;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;&#x53EB;&#x6743;&#x91CD;&#x8870;&#x51CF;&#x3002;Dropout regularizationDropout&#x5C31;&#x662F;&#x968F;&#x673A;&#x5220;&#x9664;&#x4E00;&#x4E9B;hidden unit&#x6765;&#x5B9E;&#x73B0;&#x6B63;&#x5219;&#x5316;&#x3002;Implementation Example (Inverted Dropout)&#x8FD9;&#x662F;&#x6700;&#x5E38;&#x89C1;&#x7684;Dropout&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF0C;&#x53EB;&#x201D;Inverted Dropout&#x201D; (&#x53CD;&#x5411;&#x968F;&#x673A;Dropout)&#x3002;&#x8BA1;&#x7B97;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;d3 = np.random.rand(a3.shape[0], a3.shape[1]) &lt; keep-proba3 = np.multiply(a3, d3)a3 /= keep-prob&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#xFF1A;keep-prob&#x4EE3;&#x8868;&#x4FDD;&#x7559;hidden unit&#x7684;&#x6982;&#x7387;&#x3002;&#x5982;&#x679C;keep-prob = 0.8&#xFF0C;&#x5219;&#x6709;80%&#x7684;unit&#x88AB;&#x4FDD;&#x7559;&#xFF0C;20%&#x7684;unit&#x88AB;&#x5220;&#x9664;&#x4E4B;&#x6240;&#x4EE5;&#x6700;&#x540E;&#x4E00;&#x884C;&#x8981;re-scale&#xFF0C;&#x56E0;&#x4E3A;a3&#x88AB;&#x5220;&#x9664;&#x6389;&#x4E00;&#x4E9B;unit&#xFF0C;&#x4ED6;&#x7684;&#x671F;&#x671B;&#x503C;&#x5C31;&#x53EA;&#x6709;&#x539F;&#x5148;&#x7684;keep-prob&#x7684;&#x6BD4;&#x4F8B;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x9700;&#x8981;re-scale&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x9A8C;&#x8BC1;test set&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x4F1A;&#x6709;scaling&#x7684;&#x95EE;&#x9898;&#x6CE8;&#x610F;&#xFF1A;&#x7B2C;&#x4E00;&#x884C;&#x7528;&#x7684;&#x662F;np.random.rand&#x800C;&#x4E0D;&#x662F;np.random.randn&#x3002;&#x56E0;&#x4E3A;randn&#x83B7;&#x53D6;&#x7684;&#x968F;&#x673A;&#x6570;&#x662F;&#x6B63;&#x6001;&#x5206;&#x6B65;&#xFF0C;&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5C0F;&#x4E8E;keep-prob&#x7684;&#x6982;&#x7387;&#x4E3A;keep-prob&#x3002;rand&#x4EA7;&#x751F;&#x7684;&#x662F;&#x5747;&#x5300;&#x5206;&#x6B65;&#xFF0C;&#x5219;&#x80FD;&#x4FDD;&#x8BC1;&#x3002;Make Prediction at Test Time&#x9A8C;&#x8BC1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x4F7F;&#x7528;Dropout&#x3002;&#x56E0;&#x4E3A;&#x5F15;&#x5165;Dropout&#x5C31;&#x662F;&#x5F15;&#x5165;&#x968F;&#x673A;&#x566A;&#x58F0;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x9884;&#x6D4B;&#x503C;&#x5373;&#x4E0D;&#x7A33;&#x5B9A;&#x3002;&#x6240;&#x4EE5;&#x9A8C;&#x8BC1;&#x65F6;&#x901A;&#x5E38;&#x4E0D;&#x7528;Dropout&#x3002;Other RegularizationAugment data set. &#x5C06;&#x539F;&#x6709;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x5F97;&#x5230;&#x66F4;&#x5927;&#x7684;training set&#x6765;&#x6D88;&#x9664;variance&#x3002;&#x4F8B;&#x5982;&#x65CB;&#x8F6C;&#xFF0C;&#x53CD;&#x8F6C;&#x56FE;&#x7247;Early Stopping &#x5728;variance&#x95EE;&#x9898;&#x8FD8;&#x4E0D;&#x662F;&#x5F88;&#x660E;&#x663E;&#x7684;&#x65F6;&#x5019;stop&#xFF0C;&#x770B;&#x4E0B;&#x56FE;&#xFF0C;&#x5728;&#x4E2D;&#x95F4;&#x7684;&#x70B9;&#x5904;&#x5C31;&#x505C;&#x6B62;&#x8FED;&#x4EE3;&#x3002;Vanishing/Exploding Gradients&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#x548C;&#x68AF;&#x5EA6;&#x7206;&#x70B8;&#x3002;&#x8FD9;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x5F88;&#x6DF1;&#x3002;&#x4EE5;&#x8FD9;&#x6837;&#x7684;&#x7F51;&#x7EDC;&#x4E3E;&#x4F8B;&#x3002;&#x91C7;&#x7528;&#x7EBF;&#x6027;&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#xFF0C;&#x5373;g(z)=z&#xFF0C;&#x5219; &#x6B63;&#x6BD4;&#x4E8E;&#xFF0C;&#x5982;&#x679C;w&#x4E2D;&#x6709;&#x5C0F;&#x4E8E;1&#x7684;&#x6570;&#xFF0C;&#x4E58;n&#x6B21;&#x540E;&#x5C31;&#x4F1A;&#x63A5;&#x8FD1;&#x4E8E;0&#xFF0C;&#x6B64;&#x4E3A;&#x68AF;&#x5EA6;&#x6D88;&#x5931;&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x4E3A;&#x68AF;&#x5EA6;&#x7206;&#x70B8;&#x3002;&#x81F3;&#x4ECA;&#x4ECD;&#x6CA1;&#x6709;&#x5F88;&#x597D;&#x7684;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x6D88;&#x9664;&#x8FD9;&#x4E24;&#x79CD;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x968F;&#x673A;&#x521D;&#x59CB;&#x5316;&#x6743;&#x91CD;&#x77E9;&#x9635;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x6539;&#x8FDB;&#x3002;&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;&#x5F53;&#x91C7;&#x7528;ReLU&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x671F;&#x671B;&#x65B9;&#x5DEE;&#x4E3A;&#xFF0C;(2)&#x5F0F;&#x4E2D;&#x7684;&#x5E38;&#x6570;&#x53D8;&#x6210;2&#x5373;&#x53EF;&#xFF1A; &#x5F53;&#x91C7;&#x7528;tanh&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x516C;&#x5F0F;&#x540C;(2)&#x3002; (2)&#x5F0F;&#x4E2D;&#x7684;&#x5E73;&#x65B9;&#x9879;&#x53C8;&#x53EB;Xavier Initialization&#xFF0C;&#x5373; (3)&#x5F0F;&#x4E2D;&#x7684;&#x5E73;&#x65B9;&#x9879;&#x53EB;He Initialization&#xFF0C;&#x5373;Conclusion for random weight initializationDifferent initializations lead to different resultsRandom initialization is used to break symmetry and make sure different hidden units can learn different thingsDon&#x2019;t intialize to values that are too largeHe initialization works well for networks with ReLU activations.%23%20Deep%20Learning%20%282%29%20-%20Regularization%0A@%28myblog%29%5Bdeep%20learning%5D%0A%0A%u5728%u673A%u5668%u5B66%u4E60%u4E2D%uFF0C%u6709%u4E24%u79CD%u5E38%u89C1%u7684%u95EE%u9898%uFF1A%0A-%20bias%20%28%u6216%u8005hIgh%20bias%2C%20underfitting%uFF0C%u6B20%u62DF%u5408%29%0A-%20variance%20%28%u6216%u8005high%20variance%2C%20overfitting%2C%20%u8FC7%u62DF%u5408%29%0A%0A%u524D%u8005%u901A%u5E38%u56E0%u4E3A%u6A21%u578B%u4E0D%u591F%u590D%u6742%uFF0C%u4E0D%u8DB3%u4EE5%u901A%u8FC7%u73B0%u6709%u6570%u636E%u9884%u6D4B%u51FA%u6B63%u786E%u7684%u7ED3%u679C%u3002training%20error%u8FC7%u5927%u3002%u89E3%u51B3%u7684%u65B9%u6CD5%u53EF%u4EE5%u901A%u8FC7%u589E%u5927%u8BAD%u7EC3%u7F51%u7EDC%u3002%0A%u800C%u540E%u8005%u662F%u56E0%u4E3A%u6A21%u578B%u8FC7%u4E8E%u4F9D%u8D56%u8BAD%u7EC3%u6570%u636E%uFF0C%u800C%u5BF9%u6D4B%u8BD5%u6570%u636E%u6548%u679C%u4E0D%u4F73%u3002training%20error%u4E0D%u5927%uFF0C%u4F46%u662Fdev%20error%u5374%u6BD4%u8F83%u5927%u3002%u6539%u5584%u7684%u529E%u6CD5%u662F%u6B63%u5219%u5316%uFF0C%u5373Regularization%u3002%0A%0A%23%23%20Regularization%0A%u52A0%u5165%u6B63%u5219%u5316%u56E0%u7D20%u7684%u635F%u5931%u51FD%u6570%u5982%u4E0B%uFF1A%0A%24%24J%28w%2C%20b%29%20%3D%20%20%5Cdfrac%7B1%7D%7Bm%7D%20%5CSigma_%7Bi%3D1%7D%5E%7Bm%7D%20%5Cmathscr%20L%28%5Chat%20y%5E%7B%28i%29%7D%2C%20y%5E%7B%28i%29%7D%29%20+%20%5Cfrac%7B%5Clambda%7D%7B2m%7D%20%5Cbegin%7BVmatrix%7Dx%5Cend%7BVmatrix%7D_2%5E2%20%5Ctag%201%24%24%0A%0A%3E%20%281%29%u5F0F%u4E2D%u6CA1%u6709%u5BF9b%u8FDB%u884C%u6B63%u5219%u5316%uFF0C%u5373%u6CA1%u6709%24%5Cfrac%7B%5Clambda%7D%7B2m%7Db%5E2%24%u3002%u539F%u56E0%u662Fb%u53EA%u662F%u4E00%u4E2A%u5E38%u6570%uFF0C%u800Cw%u901A%u5E38%u662F%u4E00%u4E2A%u5927%u77E9%u9635%uFF0C%u6570%u636E%u6BD4%u8F83%u591A%uFF0C%u5BB9%u6613%u51FA%u73B0%u8FC7%u62DF%u5408%u3002%u6DFB%u52A0b%u4E5F%u53EF%u4EE5%uFF0C%u4F46%u901A%u5E38%u5BF9%u8FD0%u7B97%u7ED3%u679C%u5F71%u54CD%u4E0D%u5927%u3002%0A%0A%281%29%u5F0F%u7684%u6B63%u5219%u9879%24%20%5Cfrac%7B%5Clambda%7D%7B2m%7D%20%5Cbegin%7BVmatrix%7Dx%5Cend%7BVmatrix%7D_2%5E2%24%uFF0C%u79F0%u4E3A***L2%20regularization***%u3002%u901A%u5E38%u6709%u4E0B%u9762%u51E0%u79CD%uFF1A%0A-%20L2%20regularization%20%28%u53C8%u53EBweight%20decay%29%3A%20%20%20%24%5Cfrac%7B%5Clambda%7D%7B2m%7D%20%5Cbegin%7BVmatrix%7Dx%5Cend%7BVmatrix%7D_2%5E2%20%3D%20%5CSigma_%7Bj%3D1%7D%5E%7Bn_x%7Dw%5ETw%24%20%0A-%20L1%20regularization%3A%20%24%20%5Cfrac%7B%5Clambda%7D%7B2m%7D%20%5Cbegin%7Bvmatrix%7Dx%5Cend%7Bvmatrix%7D_1%20%20%3D%20%5CSigma_%7Bj%3D1%7D%5E%7Bn_x%7D%20%5Cbegin%7Bvmatrix%7Dx%5Cend%7Bvmatrix%7D%24%0A-%20Frobenius%20regularization%3A%20%24%5Cfrac%7B%5Clambda%7D%7B2m%7D%20%5Cbegin%7BVmatrix%7Dx%5Cend%7BVmatrix%7D_F%5E2%20%3D%20%5CSigma_%7Bi%3D1%7D%5E%7Bn%5E%7B%5Bl-1%5D%7D%7D%5CSigma_%7Bj%3D1%7D%5E%7Bn%5El%7D%28w_%7Bij%7D%5E%7B%5Bl%5D%7D%29%5E2%24%20%0A-%20Dropout%20regularization%3A%20%u5728%u53E6%u4E00%u7AE0%u5355%u72EC%u9610%u8FF0%u3002%0A%0A%3E%20**L2%20regularization%20%3D%20weight%20decay**%0A%3E%20%u56E0%u4E3A%u5F53%u6211%u4EEC%u4F7F%u7528%u6B63%u5219%u5316%u7684%u635F%u5931%u51FD%u6570%u6C42%u5BFC%u65F6%u6709%uFF1A%0A%3E%20%24dw%5E%7B%5Bl%5D%7D%20%3D%20%5Cfrac%20%7B%5Cpartial%20J%7D%7B%5Cpartial%20w%7D%20%3D%20%28from%20%5Cspace%20backprop%29%20+%20%5Cfrac%20%7B%5Clambda%7D%7Bm%7Dw%5E%7B%5Bl%5D%7D%24%0A%3E%20%24w%5E%7B%5Bl%5D%7D%20%3D%20w%5E%7B%5Bl%5D%7D%20-%20%5Calpha%20%5Cspace%20dw%5E%7B%5Bl%5D%7D%20%24%0A%u6211%u7684%u7406%u89E3%uFF0C%u56E0%u4E3Aw%u5728%u51CF%u5C0F%uFF0C%u6240%u4EE5%u53EB%u6743%u91CD%u8870%u51CF%u3002%0A%0A%23%23%20Dropout%20regularization%0ADropout%u5C31%u662F%u968F%u673A%u5220%u9664%u4E00%u4E9Bhidden%20unit%u6765%u5B9E%u73B0%u6B63%u5219%u5316%u3002%0A%21%5BAlt%20text%5D%28./1534490558916.png%29%0A%0A%23%23%23%20Implementation%20Example%20%28Inverted%20Dropout%29%0A%u8FD9%u662F%u6700%u5E38%u89C1%u7684Dropout%u5B9E%u73B0%u65B9%u6CD5%uFF0C%u53EB%22Inverted%20Dropout%22%20%28%u53CD%u5411%u968F%u673ADropout%29%u3002%u8BA1%u7B97%u6B65%u9AA4%u5982%u4E0B%uFF1A%0A%60%60%60python%0Ad3%20%3D%20np.random.rand%28a3.shape%5B0%5D%2C%20a3.shape%5B1%5D%29%20%3C%20keep-prob%0Aa3%20%3D%20np.multiply%28a3%2C%20d3%29%0Aa3%20/%3D%20keep-prob%0A%60%60%60%0A%u89E3%u91CA%u4E00%u4E0B%uFF1A%0A1.%20keep-prob%u4EE3%u8868%u4FDD%u7559hidden%20unit%u7684%u6982%u7387%u3002%u5982%u679Ckeep-prob%20%3D%200.8%uFF0C%u5219%u670980%25%u7684unit%u88AB%u4FDD%u7559%uFF0C20%25%u7684unit%u88AB%u5220%u9664%0A2.%20%u4E4B%u6240%u4EE5%u6700%u540E%u4E00%u884C%u8981re-scale%uFF0C%u56E0%u4E3Aa3%u88AB%u5220%u9664%u6389%u4E00%u4E9Bunit%uFF0C%u4ED6%u7684%u671F%u671B%u503C%u5C31%u53EA%u6709%u539F%u5148%u7684keep-prob%u7684%u6BD4%u4F8B%uFF0C%u6240%u4EE5%u8FD9%u91CC%u9700%u8981re-scale%uFF0C%u8FD9%u6837%u5728%u9A8C%u8BC1test%20set%u7684%u65F6%u5019%u4E0D%u4F1A%u6709scaling%u7684%u95EE%u9898%0A3.%20%u6CE8%u610F%uFF1A%u7B2C%u4E00%u884C%u7528%u7684%u662F%60np.random.rand%60%u800C%u4E0D%u662F%60np.random.randn%60%u3002%u56E0%u4E3A%60randn%60%u83B7%u53D6%u7684%u968F%u673A%u6570%u662F%u6B63%u6001%u5206%u6B65%uFF0C%u6240%u4EE5%u5E76%u4E0D%u80FD%u4FDD%u8BC1%u5C0F%u4E8E%60keep-prob%60%u7684%u6982%u7387%u4E3A%60keep-prob%60%u3002%60rand%60%u4EA7%u751F%u7684%u662F%u5747%u5300%u5206%u6B65%uFF0C%u5219%u80FD%u4FDD%u8BC1%u3002%0A%23%23%23%20Make%20Prediction%20at%20Test%20Time%0A%u9A8C%u8BC1%u7684%u65F6%u5019%uFF0C%u4E0D%u4F7F%u7528Dropout%u3002%u56E0%u4E3A%u5F15%u5165Dropout%u5C31%u662F%u5F15%u5165%u968F%u673A%u566A%u58F0%uFF0C%u4F1A%u5BFC%u81F4%u9884%u6D4B%u503C%u5373%24%5Chat%20y%24%u4E0D%u7A33%u5B9A%u3002%u6240%u4EE5%u9A8C%u8BC1%u65F6%u901A%u5E38%u4E0D%u7528Dropout%u3002%0A%21%5BAlt%20text%7C350x0%5D%28./1534496834899.png%29%0A%0A%23%23%20Other%20Regularization%0A-%20Augment%20data%20set.%0A%09-%20%u5C06%u539F%u6709%u56FE%u7247%u8FDB%u884C%u5904%u7406%u5F97%u5230%u66F4%u5927%u7684training%20set%u6765%u6D88%u9664variance%u3002%u4F8B%u5982%u65CB%u8F6C%uFF0C%u53CD%u8F6C%u56FE%u7247%0A-%20Early%20Stopping%0A%09-%20%u5728variance%u95EE%u9898%u8FD8%u4E0D%u662F%u5F88%u660E%u663E%u7684%u65F6%u5019stop%uFF0C%u770B%u4E0B%u56FE%uFF0C%u5728%u4E2D%u95F4%u7684%u70B9%u5904%u5C31%u505C%u6B62%u8FED%u4EE3%u3002%0A%21%5BAlt%20text%7C500x0%5D%28./1534497836025.png%29%0A%0A%23%23%20Vanishing/Exploding%20Gradients%0A%u68AF%u5EA6%u6D88%u5931%u548C%u68AF%u5EA6%u7206%u70B8%u3002%u8FD9%u662F%u4E3A%u4EC0%u4E48%u795E%u7ECF%u7F51%u7EDC%u4E3A%u4EC0%u4E48%u4E0D%u80FD%u5F88%u6DF1%u3002%0A%21%5BAlt%20text%5D%28./1534498747912.png%29%0A%0A%u4EE5%u8FD9%u6837%u7684%u7F51%u7EDC%u4E3E%u4F8B%u3002%u91C7%u7528%u7EBF%u6027%u6FC0%u6D3B%u51FD%u6570%uFF0C%u5373g%28z%29%3Dz%uFF0C%u5219%0A%24%24%5Chat%20y%3Dw%5E%7B%5Bl%5D%7Dw%5E%7B%5Bl-1%5D%7D%5Cdots%20w%5E1x%24%24%0A%24%5Cfrac%7B%5Cpartial%20J%7D%7Bw%5E%7B%5Bl%5D%7D%7D%24%u6B63%u6BD4%u4E8E%24w%5E%7B%5Bl-1%5D%7D%5Cdots%20w%5E1x%24%uFF0C%u5982%u679Cw%u4E2D%u6709%u5C0F%u4E8E1%u7684%u6570%uFF0C%u4E58n%u6B21%u540E%u5C31%u4F1A%u63A5%u8FD1%u4E8E0%uFF0C%u6B64%u4E3A%u68AF%u5EA6%u6D88%u5931%uFF0C%u53CD%u4E4B%u5219%u4E3A%u68AF%u5EA6%u7206%u70B8%u3002%u81F3%u4ECA%u4ECD%u6CA1%u6709%u5F88%u597D%u7684%u529E%u6CD5%u53EF%u4EE5%u6D88%u9664%u8FD9%u4E24%u79CD%u95EE%u9898%u3002%u4F46%u662F%u53EF%u4EE5%u901A%u8FC7%u968F%u673A%u521D%u59CB%u5316%u6743%u91CD%u77E9%u9635%u7684%u65B9%u5F0F%u6765%u6539%u8FDB%u3002%u5177%u4F53%u505A%u6CD5%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%7C250x0%5D%28./1534546536710.png%29%0A%u5BF9%u4E8E%u8FD9%u6837%u4E00%u4E2A%u5355%u5C42%u7F51%u7EDC%uFF0C%u5E76%u91C7%u7528%u7EBF%u6027%u6FC0%u6D3B%u51FD%u6570%uFF0C%u6709%24z%3Dw_1x_1%20+%20w_2x_2+%5Cdots+w_nx_n%24%uFF0Cn%u8D8A%u5927%u5219%u5E0C%u671B%u6BCF%u4E00%u9879%u90FD%u8D8A%u5C0F%uFF0C%u6240%u4EE5%u5E0C%u671B%u65B9%u5DEE%u503C%u4E3A%24Var%28w_i%29%20%3D%20%5Cfrac%20%7B1%7D%7Bn%7D%24%u3002%u6240%u4EE5%u968F%u673A%u521D%u59CB%u5316w%u65F6%u53EF%u4EE5%u5982%u4E0B%uFF1A%0A%24%24w%5E%7B%5Bl%5D%7D%20%3D%20%5Cmathtt%7Bnp.random.rand%28shape%29%7D%20%5Cast%20%5Cmathtt%7Bnp.sqrt%7D%28%5Cfrac%20%7B1%7D%7Bn%5E%7B%5Bl-1%5D%7D%7D%29%20%5Ctag%202%24%24%0A%u5F53%u91C7%u7528ReLU%u6FC0%u6D3B%u51FD%u6570%u65F6%uFF0C%u671F%u671B%u65B9%u5DEE%u4E3A%24Var%28w_i%29%20%3D%20%5Cfrac%20%7B2%7D%7Bn%7D%24%uFF0C%282%29%u5F0F%u4E2D%u7684%u5E38%u6570%u53D8%u62102%u5373%u53EF%uFF1A%0A%24%24w%5E%7B%5Bl%5D%7D%20%3D%20%5Cmathtt%7Bnp.random.rand%28shape%29%7D%20%5Cast%20%5Cmathtt%7Bnp.sqrt%7D%28%5Cfrac%20%7B2%7D%7Bn%5E%7B%5Bl-1%5D%7D%7D%29%20%5Ctag%203%24%24%0A%u5F53%u91C7%u7528tanh%u6FC0%u6D3B%u51FD%u6570%u65F6%uFF0C%u516C%u5F0F%u540C%282%29%u3002%0A%282%29%u5F0F%u4E2D%u7684%u5E73%u65B9%u9879%u53C8%u53EBXavier%20Initialization%uFF0C%u5373%24%5Csqrt%20%7B%5Cfrac%20%7B1%7D%7Bn%5E%7B%5Bl-1%5D%7D%7D%7D%24%0A%283%29%u5F0F%u4E2D%u7684%u5E73%u65B9%u9879%u53EBHe%20Initialization%uFF0C%u5373%24%5Csqrt%20%7B%5Cfrac%20%7B2%7D%7Bn%5E%7B%5Bl-1%5D%7D%7D%7D%24%0A%0A%3E**Conclusion%20for%20random%20weight%20initialization**%0A-%20Different%20initializations%20lead%20to%20different%20results%0A-%20Random%20initialization%20is%20used%20to%20break%20symmetry%20and%20make%20sure%20different%20hidden%20units%20can%20learn%20different%20things%0A-%20Don%27t%20intialize%20to%20values%20that%20are%20too%20large%0A-%20He%20initialization%20works%20well%20for%20networks%20with%20ReLU%20activations.]]></content>
      <tags>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android单元测试(二) - Roboletric + Powermock]]></title>
    <url>%2F2018%2F04%2F22%2FAndroid%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95(%E4%BA%8C)_-_Roboletric_%2B_Powermock%2F</url>
    <content type="text"><![CDATA[Edit2016&#x5E74;&#x5728;&#x505A;&#x5FAE;&#x4FE1;&#x6253;&#x5370;Android agent app&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7814;&#x7A76;&#x8FC7;&#x5982;&#x4F55;&#x5728;&#x5F00;&#x53D1;Android app&#x7684;&#x65F6;&#x5019;TDD&#x3002;&#x8BE6;&#x7EC6;&#x53C2;&#x8003;&#x6B64;&#x7BC7;&#x535A;&#x6587;Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002; &#x5F53;&#x65F6;&#x7684;&#x6700;&#x7EC8;&#x65B9;&#x6848;&#x662F;&#xFF1A;Powermock + Mockito + JUnit&#x505A;local test&#x3002;&#x56E0;&#x4E3A;&#x8981;Mock&#x5404;&#x79CD;Android SDK&#x4E2D;&#x7684;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x4E00;&#x79CD;&#x88AB;&#x65E0;&#x529B;&#x63A7;&#x5236;&#x7684;&#x6050;&#x60E7;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x505A;Niwatori&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FDF;&#x8FDF;&#x6CA1;&#x6709;&#x5F00;&#x5C55;TDD&#x3002;&#x56E0;&#x4E3A;&#x6700;&#x8FD1;&#x6DFB;&#x52A0;&#x7684;&#x529F;&#x80FD;&#x7A0D;&#x5FAE;&#x6709;&#x70B9;&#x590D;&#x6742;&#x4E86;&#xFF0C;&#x611F;&#x89C9;&#x5404;&#x79CD;&#x4E0D;&#x987A;&#xFF0C;&#x6240;&#x4EE5;&#x8003;&#x8651;&#x91CD;&#x65B0;&#x62FE;&#x8D77;TDD&#x3002;&#x4E8E;&#x662F;&#x6709;&#x4E86;&#x5404;&#x79CD;&#x6298;&#x817E;&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x4E86;&#x4E4B;&#x524D;&#x65E0;&#x529B;&#x7684;&#x6050;&#x60E7;&#x540E;&#x7684;&#x8FD9;&#x4E00;&#x7BC7;&#x3002;&#x4E0D;&#x8FC7;&#x7ED3;&#x679C;&#x597D;&#x7684;&#x662F;&#x770B;&#x8D77;&#x6765;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x6761;Android app TDD&#x5F00;&#x53D1;&#x4E0D;&#x9519;&#x7684;&#x8DEF;&#x5B50;&#x3002;&#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x8981;&#x5F52;&#x529F;&#x4E8E;Roboletric&#x8D77;&#x521D;&#x7684;&#x76F8;&#x8BC6;&#x8FD8;&#x662F;&#x5728;Android developer&#x5B98;&#x7F51;&#x5173;&#x4E8E;&#x6D4B;&#x8BD5;&#x7684;&#x9875;&#x9762;&#x3002;&#x7136;&#x540E;&#x5728;&#x641C;&#x7D22;Powermock&#x7528;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x770B;&#x5230;&#x5F88;&#x591A;&#x5E16;&#x5B50;&#x90FD;&#x63D0;&#x5230;&#x4E86;roboletric&#x3002;&#x56E0;&#x4E3A;&#x8BA4;&#x8BC6;&#x5230;Mockito + Powermock&#x7684;&#x5F31;&#x70B9;(&#x5982;&#x4E0B;)&#xFF0C;&#x6240;&#x4EE5;&#x51B3;&#x5B9A;&#x8F6C;&#x5411;roboletric&#x3002;Mockito&#x4E0D;&#x80FD;mock final class/method&#x4E0D;&#x80FD;mock private/staticPowermock&#x9700;&#x8981;&#x81EA;&#x5DF1;mock&#x5404;&#x79CD;class&#xFF0C;&#x5F53;&#x51FD;&#x6570;&#x5927;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x56E0;&#x4E3A;&#x4F1A;&#x5F15;&#x7528;&#x975E;&#x5E38;&#x591A;&#x7684;Android&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x8BA9;&#x4EBA;&#x611F;&#x5230;&#x5F88;&#x65E0;&#x529B;&#x5728;&#x7F16;&#x8BD1;Android app&#x7684;&#x65F6;&#x5019;&#xFF0C;Android SDK&#x4EE5;android.jar&#x7684;&#x5F62;&#x5F0F;&#x53C2;&#x4E0E;&#x7F16;&#x8BD1;&#x3002;&#x800C;&#x8FD9;&#x4E2A;android.jar&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x7C7B;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;stub&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4E0D;&#x7ECF;&#x8FC7;mock&#x5C31;&#x76F4;&#x63A5;&#x5728;Unit Test&#x4E2D;&#x4F7F;&#x7528;Android&#x7C7B;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;Error java.lang.RuntimeException: Stub!&#x9519;&#x8BEF;&#x3002; Roboletric&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x6D88;&#x9664;&#x8FD9;&#x79CD;&#x9519;&#x8BEF;&#x8BDE;&#x751F;&#x7684;&#x3002;&#x5B83;&#x4E3A;&#x6240;&#x6709;&#x7684;Android&#x7C7B;&#x5B9A;&#x4E49;&#x4E86;&#x53EF;&#x4EE5;&#x8DD1;&#x5728;PC&#x7AEF;JVM&#x4E0B;&#x7684;class&#x3002;&#x800C;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x989D;&#x5916;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x505A;&#x9694;&#x79BB;&#x6D4B;&#x8BD5;&#x4EE5;&#x53CA;UI&#x65B9;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x3002;&#x5165;&#x95E8;&#x9996;&#x5148;&#x63A8;&#x8350;&#x7684;&#x8FD8;&#x662F;&#x5B98;&#x7F51;&#x4E3B;&#x9875;&#x3002;&#x7136;&#x540E;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x4E2D;&#x6587;&#x5E16;&#x5B50;&#xFF1A;Robolectric&#x4F7F;&#x7528;&#x6559;&#x7A0B;: &#x53EF;&#x4EE5;&#x53C2;&#x8003;Properties&#x6587;&#x4EF6;&#x4EE5;&#x53CA;Activity&#x751F;&#x547D;&#x5468;&#x671F;&#x90E8;&#x5206;&#x3002;Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E4B;Robolectric&#x6846;&#x67B6;: &#x53EF;&#x4EE5;&#x53C2;&#x8003;Robolectric&#x914D;&#x7F6E;&#x4EE5;&#x53CA;&#x9488;&#x5BF9;&#x5404;&#x79CD;Android&#x7EC4;&#x4EF6;&#x7684;&#x6D4B;&#x8BD5;&#x65B9;&#x6CD5;&#x90E8;&#x5206;&#x3002;&#x5BF9;&#x4E8E;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x548C;&#x7B2C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x6309;&#x7167;&#x5B98;&#x7F51;&#x7684;&#x6B65;&#x9AA4;&#x53BB;&#x505A;&#x3002;&#x56E0;&#x4E3A;&#x5728;setup&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5F80;&#x5F80;&#x6709;&#x5F88;&#x591A;&#x7248;&#x672C;&#x53F7;&#x4F9D;&#x8D56;&#x8981;&#x5904;&#x7406;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x8FD9;&#x79CD;&#x51FA;&#x8EAB;&#x793E;&#x533A;&#x7684;&#x6846;&#x67B6;&#x3002;&#x5F80;&#x5F80;&#x4F9D;&#x8D56;&#x5904;&#x7406;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x597D;&#x3002;Powermock + Roboletric&#x7528;&#x4E0A;Roboletric&#x4EE5;&#x540E;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x539F;&#x5148;&#x9700;&#x8981;&#x5404;&#x79CD;mock&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x73B0;&#x5728;&#x4E0D;&#x7528;&#x600E;&#x4E48;mock&#x5C31;&#x80FD;&#x7F16;&#x8FC7;&#x4E86;&#xFF0C;&#x751A;&#x81F3;&#x6709;&#x4E9B;listener&#x90FD;&#x80FD;&#x8D77;&#x4F5C;&#x7528;&#x3002;&#x4F46;&#x662F;&#x56E0;&#x4E3A;Roboletric&#x672C;&#x8EAB;&#x53EA;&#x662F;&#x63D0;&#x4F9B;Android SDK&#x7684;&#x526F;&#x672C;&#xFF0C;&#x5BF9;&#x4E8E;&#x6D4B;&#x8BD5;&#x5E76;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5728;&#x884C;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x5176;&#x76EE;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x66F4;power&#x7684;mock&#x5E93;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;&#x67D0;&#x4E9B;class&#x63D0;&#x4F9B;&#x9884;&#x8BBE;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5F02;&#x6216;&#x9700;&#x8981;&#x5BF9;&#x67D0;&#x4E9B;&#x5BF9;&#x8C61;&#x8C03;&#x7528;&#x6B21;&#x6570;&#x8FDB;&#x884C;verify&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD8;&#x662F;&#x9700;&#x8981;powermock&#x7684;&#xFF08;&#x6216;&#x8005;Mockito&#xFF0C;&#x4F46;&#x9274;&#x4E8E;&#x5176;&#x529F;&#x80FD;&#x5B9E;&#x5728;&#x592A;low&#xFF0C;&#x80FD;&#x7528;Powermock&#x7684;&#x5C31;&#x7528;Powermock&#x5427;&#xFF09;&#x3002; &#x5165;&#x95E8;&#x53C2;&#x770B;Roboletric GitHub wiki&#xFF1A;Using PowerMock&#x3002;&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;@RunWith(RobolectricTestRunner.class)@Config(constants = BuildConfig.class)@PowerMockIgnore({ &quot;org.mockito.*&quot;, &quot;org.robolectric.*&quot;, &quot;android.*&quot; })@PrepareForTest(Static.class)public class DeckardActivityTest { @Rule public PowerMockRule rule = new PowerMockRule(); @Test public void testStaticMocking() { PowerMockito.mockStatic(Static.class); Mockito.when(Static.staticMethod()).thenReturn(&quot;hello mock&quot;); assertTrue(Static.staticMethod().equals(&quot;hello mock&quot;)); }}&#x7279;&#x522B;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;&#x56E0;&#x4E3A;class&#x5F00;&#x5934;&#x7528;&#x4E86;@RunWith(RobolectricTestRunner.class)&#x6807;&#x6CE8;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x7528;PowermockTestRunner.class&#x3002;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x52A0;&#x4E0A;&#x4E0B;&#x9762;&#x4E24;&#x884C;&#xFF1A;@Rulepublic PowerMockRule rule = new PowerMockRule();&#x5426;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x5404;&#x79CD;Powermock&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x4F8B;&#x5982;class&#x6CA1;&#x6709;prepare&#x5566;&#xFF0C;&#x4E0D;&#x80FD;mock private&#x51FD;&#x6570;&#x7B49;&#x7B49;&#x3002;&#x56E0;&#x4E3A;Roboletric&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;Shadow&#x7C7B;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x7C7B;&#x548C;mock&#x6709;&#x51B2;&#x7A81;&#x3002;&#x4F8B;&#x5982;Intent intent = mock(Intent.class)&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD9;&#x4E2A;&#x83AB;&#x540D;&#x5176;&#x5999;&#x7684;&#x9519;&#x8BEF;&#x3002;java.lang.LinkageError: loader constraint violation: loader (instance of net/bytebuddy/dynamic/loading/MultipleParentClassLoader) previously initiated loading for a different type with name &quot;org/xmlpull/v1/XmlSerializer&#x6240;&#x4EE5;&#x5C31;&#x8981;&#x52A0;&#x4E0A;@PowerMockIgnore&#x3002;&#x751A;&#x81F3;Ignore&#x7684;&#x5217;&#x8868;&#x8981;&#x66F4;&#x957F;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;@PowerMockIgnore({ &quot;org.mockito.*&quot;, &quot;org.robolectric.*&quot;, &quot;android.*&quot;, &quot;javax.xml.*&quot;, &quot;org.xml.sax.*&quot;, &quot;org.w3c.dom.*&quot;, &quot;org.springframework.context.*&quot;, &quot;org.apache.log4j.*&quot;})&#x8E29;&#x5751;&#x5217;&#x8868;PowerMockito.whenNew is not workingYou need to put the class where the constructor is called into the @PrepareForTest annotation instead of the class which is being constructed - see Mock construction of new objects.&#x603B;&#x7ED3;&#x7528;Roboletric&#x6765;&#x89E3;&#x51B3;Android SDK&#x95EE;&#x9898;&#xFF0C;&#x7528;Powermock+JUnit&#x6765;&#x89E3;&#x51B3;unit test&#x95EE;&#x9898;&#x3002;%23%20Android%u5355%u5143%u6D4B%u8BD5%28%u4E8C%29%20-%20Roboletric%20+%20Powermock%0A@%28myblog%29%5BAndroid%2C%20unittest%5D%0A%0A2016%u5E74%u5728%u505A%u5FAE%u4FE1%u6253%u5370Android%20agent%20app%u7684%u65F6%u5019%uFF0C%u7814%u7A76%u8FC7%u5982%u4F55%u5728%u5F00%u53D1Android%20app%u7684%u65F6%u5019TDD%u3002%u8BE6%u7EC6%u53C2%u8003%u6B64%u7BC7%u535A%u6587%5BAndroid%u5355%u5143%u6D4B%u8BD5%5D%28https%3A//zhougy0717.github.io/2016/10/19/Android%25E5%258D%2595%25E5%2585%2583%25E6%25B5%258B%25E8%25AF%2595/%29%u3002%0A%u5F53%u65F6%u7684%u6700%u7EC8%u65B9%u6848%u662F%uFF1APowermock%20+%20Mockito%20+%20JUnit%u505A%5Blocal%20test%5D%28https%3A//developer.android.com/training/testing/unit-testing/local-unit-tests.html%29%u3002%u56E0%u4E3A%u8981Mock%u5404%u79CDAndroid%20SDK%u4E2D%u7684%u7C7B%uFF0C%u6240%u4EE5%u6709%u4E00%u79CD%u88AB%u65E0%u529B%u63A7%u5236%u7684%u6050%u60E7%u3002%u6240%u4EE5%u5728%u505ANiwatori%u7684%u65F6%u5019%uFF0C%u8FDF%u8FDF%u6CA1%u6709%u5F00%u5C55TDD%u3002%u56E0%u4E3A%u6700%u8FD1%u6DFB%u52A0%u7684%u529F%u80FD%u7A0D%u5FAE%u6709%u70B9%u590D%u6742%u4E86%uFF0C%u611F%u89C9%u5404%u79CD%u4E0D%u987A%uFF0C%u6240%u4EE5%u8003%u8651%u91CD%u65B0%u62FE%u8D77TDD%u3002%u4E8E%u662F%u6709%u4E86%u5404%u79CD%u6298%u817E%uFF0C%u5E76%u9A8C%u8BC1%u4E86%u4E4B%u524D%u65E0%u529B%u7684%u6050%u60E7%u540E%u7684%u8FD9%u4E00%u7BC7%u3002%u4E0D%u8FC7%u7ED3%u679C%u597D%u7684%u662F%u770B%u8D77%u6765%u627E%u5230%u4E86%u4E00%u6761Android%20app%20TDD%u5F00%u53D1%u4E0D%u9519%u7684%u8DEF%u5B50%u3002%0A%0A%u8FD9%u4E00%u5207%u90FD%u8981%u5F52%u529F%u4E8E%0A%23%23%20Roboletric%0A%u8D77%u521D%u7684%u76F8%u8BC6%u8FD8%u662F%u5728%5BAndroid%20developer%u5B98%u7F51%u5173%u4E8E%u6D4B%u8BD5%u7684%u9875%u9762%5D%28https%3A//developer.android.com/training/testing/fundamentals.html%29%u3002%u7136%u540E%u5728%u641C%u7D22Powermock%u7528%u6CD5%u7684%u65F6%u5019%uFF0C%u770B%u5230%u5F88%u591A%u5E16%u5B50%u90FD%u63D0%u5230%u4E86roboletric%u3002%u56E0%u4E3A%u8BA4%u8BC6%u5230Mockito%20+%20Powermock%u7684%u5F31%u70B9%28%u5982%u4E0B%29%uFF0C%u6240%u4EE5%u51B3%u5B9A%u8F6C%u5411roboletric%u3002%0A%3E%20Mockito%0A%3E%20-%20%u4E0D%u80FDmock%20final%20class/method%0A%3E%20-%20%u4E0D%u80FDmock%20private/static%0A%0A%3E%20Powermock%0A%3E%20-%20%u9700%u8981%u81EA%u5DF1mock%u5404%u79CDclass%uFF0C%u5F53%u51FD%u6570%u5927%u4E86%u7684%u65F6%u5019%uFF0C%u56E0%u4E3A%u4F1A%u5F15%u7528%u975E%u5E38%u591A%u7684Android%u7C7B%uFF0C%u6240%u4EE5%u4F1A%u8BA9%u4EBA%u611F%u5230%u5F88%u65E0%u529B%0A%0A%u5728%u7F16%u8BD1Android%20app%u7684%u65F6%u5019%uFF0CAndroid%20SDK%u4EE5android.jar%u7684%u5F62%u5F0F%u53C2%u4E0E%u7F16%u8BD1%u3002%u800C%u8FD9%u4E2Aandroid.jar%u4E2D%u7684%u5404%u4E2A%u7C7B%u5E76%u6CA1%u6709%u5177%u4F53%u7684%u5B9E%u73B0%uFF0C%u53EA%u662F%u4E00%u4E2Astub%u3002%u6240%u4EE5%u5982%u679C%u4E0D%u7ECF%u8FC7mock%u5C31%u76F4%u63A5%u5728Unit%20Test%u4E2D%u4F7F%u7528Android%u7C7B%u5C31%u4F1A%u51FA%u73B0%60Error%20java.lang.RuntimeException%3A%20Stub%21%60%u9519%u8BEF%u3002%0ARoboletric%u5C31%u662F%u4E3A%u4E86%u6D88%u9664%u8FD9%u79CD%u9519%u8BEF%u8BDE%u751F%u7684%u3002%u5B83%u4E3A%u6240%u6709%u7684Android%u7C7B%u5B9A%u4E49%u4E86%u53EF%u4EE5%u8DD1%u5728PC%u7AEFJVM%u4E0B%u7684class%u3002%u800C%u4E14%u63D0%u4F9B%u4E86%u5F88%u591A%u989D%u5916%u7684%u529F%u80FD%uFF0C%u65B9%u4FBF%u5F00%u53D1%u8005%u505A%u9694%u79BB%u6D4B%u8BD5%u4EE5%u53CAUI%u65B9%u9762%u7684%u6D4B%u8BD5%u3002%0A%0A%23%23%23%20%u5165%u95E8%0A%u9996%u5148%u63A8%u8350%u7684%u8FD8%u662F%5B%u5B98%u7F51%u4E3B%u9875%5D%28http%3A//robolectric.org/%29%u3002%u7136%u540E%u8FD8%u6709%u51E0%u4E2A%u4E0D%u9519%u7684%u4E2D%u6587%u5E16%u5B50%uFF1A%0A-%20%5BRobolectric%u4F7F%u7528%u6559%u7A0B%5D%28http%3A//www.cnblogs.com/slgkaifa/p/7354609.html%29%3A%20%u53EF%u4EE5%u53C2%u8003Properties%u6587%u4EF6%u4EE5%u53CAActivity%u751F%u547D%u5468%u671F%u90E8%u5206%u3002%0A-%20%5BAndroid%u5355%u5143%u6D4B%u8BD5%u4E4BRobolectric%u6846%u67B6%5D%28https%3A//maxwell-nc.github.io/android/robolectricTest.html%29%3A%20%u53EF%u4EE5%u53C2%u8003Robolectric%u914D%u7F6E%u4EE5%u53CA%u9488%u5BF9%u5404%u79CDAndroid%u7EC4%u4EF6%u7684%u6D4B%u8BD5%u65B9%u6CD5%u90E8%u5206%u3002%0A%0A%u5BF9%u4E8E%u914D%u7F6E%u73AF%u5883%u548C%u7B2C%u4E00%u4E2A%u7B80%u5355%u7684%u5B9E%u4F8B%uFF0C%u6700%u597D%u662F%u6309%u7167%u5B98%u7F51%u7684%u6B65%u9AA4%u53BB%u505A%u3002%u56E0%u4E3A%u5728setup%u7684%u65F6%u5019%uFF0C%u5F80%u5F80%u6709%u5F88%u591A%u7248%u672C%u53F7%u4F9D%u8D56%u8981%u5904%u7406%uFF0C%u5C24%u5176%u662F%u8FD9%u79CD%u51FA%u8EAB%u793E%u533A%u7684%u6846%u67B6%u3002%u5F80%u5F80%u4F9D%u8D56%u5904%u7406%u4E0D%u662F%u7279%u522B%u597D%u3002%0A%0A%23%23%20Powermock%20+%20Roboletric%0A%u7528%u4E0ARoboletric%u4EE5%u540E%uFF0C%u4F60%u4F1A%u53D1%u73B0%u539F%u5148%u9700%u8981%u5404%u79CDmock%u7684%u51FD%u6570%uFF0C%u73B0%u5728%u4E0D%u7528%u600E%u4E48mock%u5C31%u80FD%u7F16%u8FC7%u4E86%uFF0C%u751A%u81F3%u6709%u4E9Blistener%u90FD%u80FD%u8D77%u4F5C%u7528%u3002%u4F46%u662F%u56E0%u4E3ARoboletric%u672C%u8EAB%u53EA%u662F%u63D0%u4F9BAndroid%20SDK%u7684%u526F%u672C%uFF0C%u5BF9%u4E8E%u6D4B%u8BD5%u5E76%u4E0D%u662F%u90A3%u4E48%u5728%u884C%uFF0C%u6216%u8005%u8BF4%u5176%u76EE%u7684%u5E76%u4E0D%u662F%u4E00%u4E2A%u66F4power%u7684mock%u5E93%u3002%u5F53%u6211%u4EEC%u9700%u8981%u4E3A%u67D0%u4E9Bclass%u63D0%u4F9B%u9884%u8BBE%u7684%u529F%u80FD%uFF0C%u5F02%u6216%u9700%u8981%u5BF9%u67D0%u4E9B%u5BF9%u8C61%u8C03%u7528%u6B21%u6570%u8FDB%u884Cverify%u7684%u65F6%u5019%uFF0C%u8FD8%u662F%u9700%u8981powermock%u7684%uFF08%u6216%u8005Mockito%uFF0C%u4F46%u9274%u4E8E%u5176%u529F%u80FD%u5B9E%u5728%u592Alow%uFF0C%u80FD%u7528Powermock%u7684%u5C31%u7528Powermock%u5427%uFF09%u3002%0A%u5165%u95E8%u53C2%u770BRoboletric%20GitHub%20wiki%uFF1A%5BUsing%20PowerMock%5D%28https%3A//github.com/robolectric/robolectric/wiki/Using-PowerMock%29%u3002%u793A%u4F8B%u5982%u4E0B%uFF1A%0A%60%60%60java%0A@RunWith%28RobolectricTestRunner.class%29%0A@Config%28constants%20%3D%20BuildConfig.class%29%0A@PowerMockIgnore%28%7B%20%22org.mockito.*%22%2C%20%22org.robolectric.*%22%2C%20%22android.*%22%20%7D%29%0A@PrepareForTest%28Static.class%29%0Apublic%20class%20DeckardActivityTest%20%7B%0A%0A%20%20%20%20@Rule%0A%20%20%20%20public%20PowerMockRule%20rule%20%3D%20new%20PowerMockRule%28%29%3B%0A%0A%20%20%20%20@Test%0A%20%20%20%20public%20void%20testStaticMocking%28%29%20%7B%0A%20%20%20%20%20%20%20%20PowerMockito.mockStatic%28Static.class%29%3B%0A%20%20%20%20%20%20%20%20Mockito.when%28Static.staticMethod%28%29%29.thenReturn%28%22hello%20mock%22%29%3B%0A%0A%20%20%20%20%20%20%20%20assertTrue%28Static.staticMethod%28%29.equals%28%22hello%20mock%22%29%29%3B%0A%20%20%20%20%7D%0A%7D%0A%60%60%60%0A%u7279%u522B%u8981%u6CE8%u610F%u7684%u662F%uFF1A%0A1.%20%u56E0%u4E3Aclass%u5F00%u5934%u7528%u4E86%60@RunWith%28RobolectricTestRunner.class%29%60%u6807%u6CE8%uFF0C%u6240%u4EE5%u65E0%u6CD5%u7528%60PowermockTestRunner.class%60%u3002%u6240%u4EE5%u5FC5%u987B%u52A0%u4E0A%u4E0B%u9762%u4E24%u884C%uFF1A%0A%60%60%60%0A@Rule%0Apublic%20PowerMockRule%20rule%20%3D%20new%20PowerMockRule%28%29%3B%0A%60%60%60%0A%u5426%u5219%u4F1A%u51FA%u73B0%u5404%u79CDPowermock%u65E0%u6CD5%u5DE5%u4F5C%u7684%u5F02%u5E38%uFF0C%u4F8B%u5982class%u6CA1%u6709prepare%u5566%uFF0C%u4E0D%u80FDmock%20private%u51FD%u6570%u7B49%u7B49%u3002%0A%0A2.%20%u56E0%u4E3ARoboletric%u63D0%u4F9B%u4E86%u5F88%u591AShadow%u7C7B%uFF0C%u800C%u8FD9%u4E9B%u7C7B%u548Cmock%u6709%u51B2%u7A81%u3002%u4F8B%u5982%60Intent%20intent%20%3D%20mock%28Intent.class%29%60%u5C31%u4F1A%u5BFC%u81F4%u8FD9%u4E2A%u83AB%u540D%u5176%u5999%u7684%u9519%u8BEF%u3002%0A%0A%3E%60java.lang.LinkageError%3A%20loader%20constraint%20violation%3A%20loader%20%28instance%20of%20net/bytebuddy/dynamic/loading/MultipleParentClassLoader%29%20previously%20initiated%20loading%20for%20a%20different%20type%20with%20name%20%22org/xmlpull/v1/XmlSerializer%60%0A%0A%u6240%u4EE5%u5C31%u8981%u52A0%u4E0A%60@PowerMockIgnore%60%u3002%u751A%u81F3Ignore%u7684%u5217%u8868%u8981%u66F4%u957F%uFF0C%u4F8B%u5982%uFF1A%0A%60%60%60%0A@PowerMockIgnore%28%7B%20%0A%09%22org.mockito.*%22%2C%20%0A%09%22org.robolectric.*%22%2C%20%0A%09%22android.*%22%2C%0A%09%22javax.xml.*%22%2C%20%0A%09%22org.xml.sax.*%22%2C%20%0A%09%22org.w3c.dom.*%22%2C%20%20%0A%09%22org.springframework.context.*%22%2C%20%0A%09%22org.apache.log4j.*%22%20%0A%7D%29%0A%60%60%60%0A%0A%23%23%20%u8E29%u5751%u5217%u8868%0A%23%23%23%20PowerMockito.whenNew%20is%20not%20working%0A%3EYou%20need%20to%20put%20the%20class%20**where%20the%20constructor%20is%20called**%20into%20the%20@PrepareForTest%20annotation%20instead%20of%20the%20class%20which%20is%20being%20constructed%20-%20see%20Mock%20construction%20of%20new%20objects.%0A%0A%23%23%20%u603B%u7ED3%0A%u7528Roboletric%u6765%u89E3%u51B3Android%20SDK%u95EE%u9898%uFF0C%u7528Powermock+JUnit%u6765%u89E3%u51B3unit%20test%u95EE%u9898%u3002]]></content>
      <tags>
        <tag>Android</tag>
        <tag>unittest</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Exception Safety issue]]></title>
    <url>%2F2018%2F03%2F26%2FException_Safety_issue%2F</url>
    <content type="text"><![CDATA[Edit&#x95EE;&#x9898;&#x63CF;&#x8FF0;Evaluation Orders and Disorders// Example 1(a)//f( expr1, expr2 );// Example 1(b)//f( g( expr1 ), h( expr2 ) );&#x7F16;&#x8BD1;&#x5668;&#x53EA;&#x8981;&#x6EE1;&#x8DB3;&#x4E0B;&#x9762;&#x7684;&#x89C4;&#x5219;&#xFF0C;&#x4E3A;&#x4E86;&#x4FBF;&#x4E8E;&#x4F18;&#x5316;&#x6267;&#x884C;&#x987A;&#x5E8F;&#xFF0C;&#x800C;C++&#x6807;&#x51C6;&#x5E76;&#x4E0D;&#x8981;&#x6C42;&#x5177;&#x4F53;&#x6307;&#x4EE4;&#x987A;&#x5E8F;&#xFF1A;expr1&#x5728;g&#x6267;&#x884C;&#x4E4B;&#x524D;&#x5B8C;&#x6210;&#xFF0C;expr2&#x5728;h&#x6267;&#x884C;&#x4E4B;&#x524D;&#x5B8C;&#x6210;g, h&#x5728;f&#x6267;&#x884C;&#x4E4B;&#x524D;&#x5B8C;&#x6210;&#x9996;&#x5148;&#xFF0C;&#x5728;&#x51FD;&#x6570;&#x6B63;&#x5F0F;&#x6267;&#x884C;&#x4E4B;&#x524D;&#xFF0C;&#x6240;&#x6709;&#x7684;Expression Evaluation&#x8981;&#x5B8C;&#x6210;&#x3002; &#x5176;&#x6B21;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x4E71;&#x5E8F;&#x3002; &#x6240;&#x4EE5;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x4E0B;&#x9762;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#xFF1A; &#x987A;&#x5E8F;&#x4E00;expr1expr2gh&#x987A;&#x5E8F;&#x4E8C;expr1gexpr2h&#x4E0A;&#x9762;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x90FD;&#x7B26;&#x5408;&#x3002;Exception Safety Problems&#x5F53;C++&#x7F16;&#x8BD1;&#x5668;&#x8C03;&#x7528;new&#x64CD;&#x4F5C;&#x7B26;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x505A;&#x4E24;&#x4EF6;&#x4E8B;&#xFF1A;1. &#x5F00;&#x8F9F;&#x5185;&#x5B58;&#xFF0C;2. &#x8C03;&#x7528;&#x7C7B;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x7684;code&#x5982;&#x679C;&#x5904;&#x7406;&#x5F97;&#x5F53;&#xFF0C;&#x662F;&#x4E0D;&#x4F1A;&#x6709;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF1A;T1* t1 = new T1;T2* t2 = new T2;&#x5F53;T1&#x6784;&#x9020;&#x51FD;&#x6570;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x76F8;&#x5E94;&#x7684;&#x5185;&#x5B58;&#x4F1A;&#x88AB;&#x91CA;&#x653E;&#x6389;&#x3002;&#x5F53;T2&#x6784;&#x9020;&#x51FD;&#x6570;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;T2&#x7684;&#x5185;&#x5B58;&#x4F1A;&#x88AB;&#x91CA;&#x653E;&#xFF0C;T1&#x7684;&#x5185;&#x5B58;&#x4E5F;&#x6709;&#x673A;&#x4F1A;&#x88AB;&#x91CA;&#x653E;&#x3002;&#xFF08;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x4E24;&#x6761;&#x8BED;&#x53E5;&#x4E4B;&#x95F4;&#x52A0;&#x4E0A;&#x5F02;&#x5E38;&#x5904;&#x7406;&#xFF0C;&#x5F53;&#x7136;&#x7528;smart pointer&#x4E5F;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;&#x540E;&#x9762;&#x4F1A;&#x9610;&#x8FF0;smart pointer&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#x4F46;&#x662F;&#x5728;&#x9047;&#x5230;Expression Evaluation&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x60C5;&#x51B5;&#x4F1A;&#x53D8;&#x5F97;&#x590D;&#x6742;&#xFF1A;// In some header file:void f( T1*, T2* );// In some implementation file:f( new T1, new T2 );T2&#x6784;&#x9020;&#x51FD;&#x6570;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x6839;&#x672C;&#x6CA1;&#x6709;&#x673A;&#x4F1A;&#x91CA;&#x653E;T1&#x7684;&#x5185;&#x5B58;&#x3002;&#x7528;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x4E5F;&#x6CA1;&#x529E;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;T1&#x7684;&#x5185;&#x5B58;&#x5F00;&#x8F9F;&#x51FA;&#x6765;&#x8D4B;&#x503C;&#x7ED9;&#x4E86;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#x3002;&#x800C;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x6709;&#x6548;&#x671F;&#x5C31;&#x53EA;&#x5728;&#x90A3;&#x4E2A;&#x62EC;&#x53F7;&#x91CC;&#x3002;&#x4E71;&#x5E8F;&#x8BA9;&#x95EE;&#x9898;&#x66F4;&#x52A0;&#x590D;&#x6742;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x4E0D;&#x77E5;&#x9053;&#x662F;T1&#x5148;&#x6784;&#x9020;&#x8FD8;&#x662F;T2&#x5148;&#x6784;&#x9020;&#xFF0C;&#x4F60;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x4E0B;&#x9762;&#x7684;&#x54EA;&#x79CD;&#x987A;&#x5E8F;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x4E00;&#x79CD;&#x987A;&#x5E8F;&#x90FD;&#x6709;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#x65E0;&#x4ECE;&#x4E0B;&#x624B;&#x3002; &#x987A;&#x5E8F;&#x4E00; 1: allocate memory for T1 2: construct T1 3: allocate memory for T2 4: construct T2 5: call f()&#x987A;&#x5E8F;&#x4E8C; 1: allocate memory for T1 2: allocate memory for T2 3: construct T1 4: construct T2 5: call f()&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7528;auto_ptr// In some header file:void f( auto_ptr&lt;T1&gt;, auto_ptr&lt;T2&gt; );// In some implementation file:f( auto_ptr&lt;T1&gt;( new T1 ), auto_ptr&lt;T2&gt;( new T2 ) );&#x770B;&#x8D77;&#x6765;&#x7528;&#x4E86;smart pointer&#xFF0C;&#x5E94;&#x8BE5;&#x4E0D;&#x5B58;&#x5728;&#x91CA;&#x653E;&#x5185;&#x5B58;&#x7684;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x4F46;&#x5176;&#x5B9E;&#x5E76;&#x6CA1;&#x6709;&#x6539;&#x5584;&#xFF0C;&#x56E0;&#x4E3A;&#x4E71;&#x5E8F;&#x95EE;&#x9898;&#xFF0C;&#x4F60;&#x6CA1;&#x6CD5;&#x4FDD;&#x8BC1;auto_ptr&lt;T1&gt;&#x5728;new T2&#x4E4B;&#x524D;&#x8C03;&#x7528;&#x3002;&#x5982;&#x679C;T2&#x6784;&#x9020;&#x5931;&#x8D25;&#x4E86;&#xFF0C;new T1&#x7684;&#x5185;&#x5B58;&#x5C31;&#x6CC4;&#x9732;&#x4E86;&#x3002;Vice versa&#x3002;&#x7528;&#x53C2;&#x6570;&#x9ED8;&#x8BA4;&#x503C;// In some header file:void f( auto_ptr&lt;T1&gt; = auto_ptr&lt;T1&gt;( new T1 ), auto_ptr&lt;T2&gt; = auto_ptr&lt;T1&gt;( new T2 ) );// In some implementation file:f();&#x6CA1;&#x6709;&#x672C;&#x8D28;&#x7684;&#x6539;&#x5584;&#x3002;&#x56E0;&#x4E3A;&#x867D;&#x7136;&#x53C2;&#x6570;&#x9ED8;&#x8BA4;&#x503C;&#x662F;&#x5728;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#x90A3;&#x4E9B;new&#x548C;auto_ptr&lt;&gt;&#x662F;&#x5728;&#x6267;&#x884C;&#x65F6;&#x624D;&#x4F1A;&#x53BB;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x4E00;&#x6837;&#x4F1A;&#x6709;&#x4E71;&#x5E8F;&#x3002;&#x771F;&#x6B63;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;// In some header file (same as in Example 2b):void f( auto_ptr&lt;T1&gt;, auto_ptr&lt;T2&gt; );// In some implementation file:f( auto_ptr_new&lt;T1&gt;(), auto_ptr_new&lt;T2&gt;() );&#x770B;&#x8D77;&#x6765;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x5047;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5F88;&#x50CF;&#x5BF9;&#x4E0D;&#x5BF9;&#xFF0C;&#x533A;&#x522B;&#x662F;&#x76F8;&#x5E94;&#x7684;new&#x548C;auto_ptr&lt;&gt;&#x6784;&#x9020;&#x51FD;&#x6570;&#x653E;&#x5230;&#x4E00;&#x8D77;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x4E0D;&#x7BA1;&#x662F;auto_ptr_new&lt;T1&gt;()&#x5728;&#x524D;&#xFF0C;&#x8FD8;&#x662F;auto_ptr_new&lt;T2&gt;()&#x5728;&#x524D;&#xFF0C;&#x90FD;&#x4E0D;&#x4F1A;&#x5F15;&#x8D77;Exception Safety&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x4E5F;&#x5C31;&#x662F;&#x7F51;&#x4E0A;&#x7ECF;&#x5E38;&#x6709;&#x4EBA;&#x95EE;&#x5230;&#x7684;&#x201C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;make_xxx_ptr&#xFF0C;&#x800C;&#x4E0D;&#x7528;new xxx_ptr?&#x201D;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#xFF0C;xxx_ptr&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4F55;&#x7684;smart pointer&#xFF08;&#x5305;&#x62EC;&#x4F46;&#x4E0D;&#x9650;&#x4E8E;&#xFF1A;auto_ptr, shared_ptr, unique_ptr&#xFF09;&#xFF1A;&#x53EF;&#x4EE5;&#x907F;&#x514D;Exception Safety&#x95EE;&#x9898;&#x907F;&#x514D;&#x663E;&#x793A;&#x4F7F;&#x7528;new&#x8FD0;&#x7B97;&#x7B26;&#xFF0C;&#x907F;&#x514D;&#x6F5C;&#x5728;&#x95EE;&#x9898;&#x5C40;&#x9650;&#x662F;&#x53EA;&#x80FD;&#x7528;&#x9ED8;&#x8BA4;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x5E26;&#x53C2;&#x6570;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E0B;&#x9762;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF1A;// In some header file:void f( auto_ptr&lt;T1&gt;, auto_ptr&lt;T2&gt; );// In some implementation file:{ auto_ptr&lt;T1&gt; t1( new T1 ); f( t1, auto_ptr&lt;T2&gt;( new T2 ) );}&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x66F4;&#x597D;&#xFF1A;// In some header file:void f( auto_ptr&lt;T1&gt;, auto_ptr&lt;T2&gt; );// In some implementation file:{ auto_ptr&lt;T1&gt; t1( new T1 ); auto_ptr&lt;T2&gt; t2( new T2 ); f( t1, t2 );}&#x603B;&#x7ED3;&#x4EE5;Exception-Safe Function Calls&#x4F5C;&#x8005;&#x7684;guide lines&#x4F5C;&#x603B;&#x7ED3;&#xFF1A;Perform every resource allocation (e.g., new) in its own code statement which immediately gives the new resource to a manager object (e.g., auto_ptr).&#x610F;&#x601D;&#x662F;&#x4E00;&#x884C;&#x5C31;&#x53EA;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x4E14;&#x7ACB;&#x5373;&#x5C06;&#x8BE5;&#x8D44;&#x6E90;&#x4EA4;&#x7ED9;smart pointer&#x7BA1;&#x7406;&#x3002;&#x53C2;&#x8003;&#x6587;&#x732E;Exception-Safe Function Calls GotW #89 Solution: Smart Pointer%23%20Exception%20Safety%20issue%0A@%28myblog%29%5Bc/c++%5D%0A%0A%23%23%20%u95EE%u9898%u63CF%u8FF0%0A%23%23%23%20Evaluation%20Orders%20and%20Disorders%0A%60%60%60%0A//%20%20Example%201%28a%29%0A//%0Af%28%20expr1%2C%20expr2%20%29%3B%0A//%20%20Example%201%28b%29%0A//%0Af%28%20g%28%20expr1%20%29%2C%20h%28%20expr2%20%29%20%29%3B%0A%60%60%60%0A%3E%20%u7F16%u8BD1%u5668%u53EA%u8981%u6EE1%u8DB3%u4E0B%u9762%u7684%u89C4%u5219%uFF0C%u4E3A%u4E86%u4FBF%u4E8E%u4F18%u5316%u6267%u884C%u987A%u5E8F%uFF0C%u800CC++%u6807%u51C6%u5E76%u4E0D%u8981%u6C42%u5177%u4F53%u6307%u4EE4%u987A%u5E8F%uFF1A%0A%3E%201.%20expr1%u5728g%u6267%u884C%u4E4B%u524D%u5B8C%u6210%uFF0Cexpr2%u5728h%u6267%u884C%u4E4B%u524D%u5B8C%u6210%0A%3E%202.%20g%2C%20h%u5728f%u6267%u884C%u4E4B%u524D%u5B8C%u6210%0A%0A%u9996%u5148%uFF0C%u5728%u51FD%u6570%u6B63%u5F0F%u6267%u884C%u4E4B%u524D%uFF0C%u6240%u6709%u7684Expression%20Evaluation%u8981%u5B8C%u6210%u3002%0A%u5176%u6B21%uFF0C%u6709%u53EF%u80FD%u51FA%u73B0%u4E71%u5E8F%u3002%0A%u6240%u4EE5%u6709%u53EF%u80FD%u51FA%u73B0%u4E0B%u9762%u7684%u6267%u884C%u987A%u5E8F%uFF1A%0A**%u987A%u5E8F%u4E00**%0A-%20expr1%0A-%20expr2%0A-%20g%0A-%20h%0A%0A**%u987A%u5E8F%u4E8C**%0A-%20expr1%0A-%20g%0A-%20expr2%0A-%20h%0A%0A%u4E0A%u9762%u4E24%u79CD%u60C5%u51B5%u90FD%u7B26%u5408%u3002%0A%0A%23%23%23%20Exception%20Safety%20Problems%0A%u5F53C++%u7F16%u8BD1%u5668%u8C03%u7528new%u64CD%u4F5C%u7B26%u7684%u65F6%u5019%u4F1A%u505A%u4E24%u4EF6%u4E8B%uFF1A1.%20%u5F00%u8F9F%u5185%u5B58%uFF0C2.%20%u8C03%u7528%u7C7B%u6784%u9020%u51FD%u6570%u3002%u6240%u4EE5%u4E0B%u9762%u7684code%u5982%u679C%u5904%u7406%u5F97%u5F53%uFF0C%u662F%u4E0D%u4F1A%u6709%u5185%u5B58%u6CC4%u6F0F%uFF1A%0A%60%60%60%0AT1*%20t1%20%3D%20new%20T1%3B%0AT2*%20t2%20%3D%20new%20T2%3B%0A%60%60%60%0A%u5F53T1%u6784%u9020%u51FD%u6570%u51FA%u73B0%u5F02%u5E38%u65F6%uFF0C%u76F8%u5E94%u7684%u5185%u5B58%u4F1A%u88AB%u91CA%u653E%u6389%u3002%u5F53T2%u6784%u9020%u51FD%u6570%u51FA%u73B0%u5F02%u5E38%u65F6%uFF0CT2%u7684%u5185%u5B58%u4F1A%u88AB%u91CA%u653E%uFF0CT1%u7684%u5185%u5B58%u4E5F%u6709%u673A%u4F1A%u88AB%u91CA%u653E%u3002%uFF08%u89E3%u51B3%u65B9%u6CD5%u662F%u5728%u4E24%u6761%u8BED%u53E5%u4E4B%u95F4%u52A0%u4E0A%u5F02%u5E38%u5904%u7406%uFF0C%u5F53%u7136%u7528smart%20pointer%u4E5F%u53EF%u4EE5%u89E3%u51B3%u95EE%u9898%u3002%u540E%u9762%u4F1A%u9610%u8FF0smart%20pointer%u7684%u65B9%u6CD5%uFF09%0A%0A%u4F46%u662F%u5728%u9047%u5230Expression%20Evaluation%u7684%u65F6%u5019%uFF0C%u60C5%u51B5%u4F1A%u53D8%u5F97%u590D%u6742%uFF1A%0A%60%60%60%0A//%20%20In%20some%20header%20file%3A%0Avoid%20f%28%20T1*%2C%20T2*%20%29%3B%0A//%20%20In%20some%20implementation%20file%3A%0Af%28%20new%20T1%2C%20new%20T2%20%29%3B%0A%60%60%60%0A-%20T2%u6784%u9020%u51FD%u6570%u5F02%u5E38%u65F6%uFF0C%u6839%u672C%u6CA1%u6709%u673A%u4F1A%u91CA%u653ET1%u7684%u5185%u5B58%u3002%u7528%u5F02%u5E38%u5904%u7406%u4E5F%u6CA1%u529E%u6CD5%uFF0C%u56E0%u4E3AT1%u7684%u5185%u5B58%u5F00%u8F9F%u51FA%u6765%u8D4B%u503C%u7ED9%u4E86%u4E00%u4E2A%u4E34%u65F6%u53D8%u91CF%u3002%u800C%u8FD9%u4E2A%u53D8%u91CF%u7684%u6709%u6548%u671F%u5C31%u53EA%u5728%u90A3%u4E2A%u62EC%u53F7%u91CC%u3002%0A-%20%u4E71%u5E8F%u8BA9%u95EE%u9898%u66F4%u52A0%u590D%u6742%uFF0C%u56E0%u4E3A%u4F60%u4E0D%u77E5%u9053%u662FT1%u5148%u6784%u9020%u8FD8%u662FT2%u5148%u6784%u9020%uFF0C%u4F60%u4E0D%u77E5%u9053%u662F%u4E0B%u9762%u7684%u54EA%u79CD%u987A%u5E8F%uFF0C%u4F46%u662F%u6BCF%u4E00%u79CD%u987A%u5E8F%u90FD%u6709%u95EE%u9898%u3002%u6240%u4EE5%u65E0%u4ECE%u4E0B%u624B%u3002%0A%09-%20%u987A%u5E8F%u4E00%0A%09%09-%201%3A%20allocate%20memory%20for%20T1%0A2%3A%20construct%20T1%0A3%3A%20allocate%20memory%20for%20T2%0A4%3A%20construct%20T2%0A5%3A%20call%20f%28%29%0A%09-%20%u987A%u5E8F%u4E8C%0A%09%09-%201%3A%20allocate%20memory%20for%20T1%0A2%3A%20allocate%20memory%20for%20T2%0A3%3A%20construct%20T1%0A4%3A%20construct%20T2%0A5%3A%20call%20f%28%29%0A%0A%0A%23%23%20%u89E3%u51B3%u65B9%u6848%0A%23%23%23%20%u770B%u8D77%u6765%u50CF%u7684%u89E3%u51B3%u65B9%u6848%0A%23%23%23%23%20%u7528auto_ptr%0A%60%60%60%0A//%20%20In%20some%20header%20file%3A%0Avoid%20f%28%20auto_ptr%3CT1%3E%2C%20auto_ptr%3CT2%3E%20%29%3B%0A//%20%20In%20some%20implementation%20file%3A%0Af%28%20auto_ptr%3CT1%3E%28%20new%20T1%20%29%2C%20auto_ptr%3CT2%3E%28%20new%20T2%20%29%20%29%3B%0A%60%60%60%0A%u770B%u8D77%u6765%u7528%u4E86smart%20pointer%uFF0C%u5E94%u8BE5%u4E0D%u5B58%u5728%u91CA%u653E%u5185%u5B58%u7684%u95EE%u9898%u4E86%u3002%u4F46%u5176%u5B9E%u5E76%u6CA1%u6709%u6539%u5584%uFF0C%u56E0%u4E3A%u4E71%u5E8F%u95EE%u9898%uFF0C%u4F60%u6CA1%u6CD5%u4FDD%u8BC1%60auto_ptr%3CT1%3E%60%u5728%60new%20T2%60%u4E4B%u524D%u8C03%u7528%u3002%u5982%u679CT2%u6784%u9020%u5931%u8D25%u4E86%uFF0C%60new%20T1%60%u7684%u5185%u5B58%u5C31%u6CC4%u9732%u4E86%u3002Vice%20versa%u3002%0A%0A%23%23%23%23%20%u7528%u53C2%u6570%u9ED8%u8BA4%u503C%0A%60%60%60%0A//%20%20In%20some%20header%20file%3A%0Avoid%20f%28%20auto_ptr%3CT1%3E%20%3D%20auto_ptr%3CT1%3E%28%20new%20T1%20%29%2C%0A%20%20%20%20%20%20%20%20auto_ptr%3CT2%3E%20%3D%20auto_ptr%3CT1%3E%28%20new%20T2%20%29%20%29%3B%0A//%20%20In%20some%20implementation%20file%3A%0Af%28%29%3B%0A%60%60%60%0A%u6CA1%u6709%u672C%u8D28%u7684%u6539%u5584%u3002%u56E0%u4E3A%u867D%u7136%u53C2%u6570%u9ED8%u8BA4%u503C%u662F%u5728%u51FD%u6570%u58F0%u660E%u4E2D%uFF0C%u4F46%u662F%u90A3%u4E9B%60new%60%u548C%60auto_ptr%3C%3E%60%u662F%u5728%u6267%u884C%u65F6%u624D%u4F1A%u53BB%u505A%u7684%u4E8B%u60C5%u3002%u4E00%u6837%u4F1A%u6709%u4E71%u5E8F%u3002%0A%0A%23%23%23%20%u771F%u6B63%u7684%u89E3%u51B3%u65B9%u6848%0A%60%60%60%0A//%20%20In%20some%20header%20file%20%28same%20as%20in%20Example%202b%29%3A%0Avoid%20f%28%20auto_ptr%3CT1%3E%2C%20auto_ptr%3CT2%3E%20%29%3B%0A//%20%20In%20some%20implementation%20file%3A%0Af%28%20auto_ptr_new%3CT1%3E%28%29%2C%20auto_ptr_new%3CT2%3E%28%29%20%29%3B%0A%60%60%60%0A%u770B%u8D77%u6765%u548C%u4E4B%u524D%u7684%u5047%u89E3%u51B3%u65B9%u6848%u5F88%u50CF%u5BF9%u4E0D%u5BF9%uFF0C%u533A%u522B%u662F%u76F8%u5E94%u7684%60new%60%u548C%60auto_ptr%3C%3E%60%u6784%u9020%u51FD%u6570%u653E%u5230%u4E00%u8D77%u4E86%u3002%u8FD9%u6837%u4E0D%u7BA1%u662F%60auto_ptr_new%3CT1%3E%28%29%60%u5728%u524D%uFF0C%u8FD8%u662F%60auto_ptr_new%3CT2%3E%28%29%60%u5728%u524D%uFF0C%u90FD%u4E0D%u4F1A%u5F15%u8D77Exception%20Safety%u95EE%u9898%u3002%0A%3E%u8FD9%u4E2A%u65B9%u6848%u4E5F%u5C31%u662F%u7F51%u4E0A%u7ECF%u5E38%u6709%u4EBA%u95EE%u5230%u7684%u201C%u4E3A%u4EC0%u4E48%u8981%u7528make%5C_xxx_ptr%uFF0C%u800C%u4E0D%u7528new%20xxx%5C_ptr%3F%u201D%u7684%u539F%u56E0%u4E4B%u4E00%uFF0Cxxx%5C_ptr%u53EF%u4EE5%u662F%u4EFB%u4F55%u7684smart%20pointer%uFF08%u5305%u62EC%u4F46%u4E0D%u9650%u4E8E%uFF1Aauto_ptr%2C%20shared_ptr%2C%20unique_ptr%uFF09%uFF1A%0A%3E-%20%u53EF%u4EE5%u907F%u514DException%20Safety%u95EE%u9898%0A%3E-%20%u907F%u514D%u663E%u793A%u4F7F%u7528%60new%60%u8FD0%u7B97%u7B26%uFF0C%u907F%u514D%u6F5C%u5728%u95EE%u9898%0A%3E-%20%u5C40%u9650%u662F%u53EA%u80FD%u7528%u9ED8%u8BA4%u6784%u9020%u51FD%u6570%uFF0C%u800C%u65E0%u6CD5%u4F7F%u7528%u5E26%u53C2%u6570%u6784%u9020%u51FD%u6570%0A%0A%u4E0B%u9762%u4E5F%u662F%u4E00%u4E2A%u529E%u6CD5%uFF1A%0A%60%60%60%0A//%20%20In%20some%20header%20file%3A%0Avoid%20f%28%20auto_ptr%3CT1%3E%2C%20auto_ptr%3CT2%3E%20%29%3B%0A//%20%20In%20some%20implementation%20file%3A%0A%7B%0A%20%20auto_ptr%3CT1%3E%20t1%28%20new%20T1%20%29%3B%0A%20%20f%28%20t1%2C%20auto_ptr%3CT2%3E%28%20new%20T2%20%29%20%29%3B%0A%7D%0A%60%60%60%0A%u8FD9%u4E2A%u65B9%u6CD5%u66F4%u597D%uFF1A%0A%60%60%60%0A//%20%20In%20some%20header%20file%3A%0Avoid%20f%28%20auto_ptr%3CT1%3E%2C%20auto_ptr%3CT2%3E%20%29%3B%0A//%20%20In%20some%20implementation%20file%3A%0A%7B%0A%20%20auto_ptr%3CT1%3E%20t1%28%20new%20T1%20%29%3B%0A%20%20auto_ptr%3CT2%3E%20t2%28%20new%20T2%20%29%3B%0A%20%20f%28%20t1%2C%20t2%20%29%3B%0A%7D%0A%60%60%60%0A%0A%23%23%20%u603B%u7ED3%0A%u4EE5%5BException-Safe%20Function%20Calls%5D%28http%3A//www.gotw.ca/gotw/056.htm%29%u4F5C%u8005%u7684guide%20lines%u4F5C%u603B%u7ED3%uFF1A%0A%3EPerform%20every%20resource%20allocation%20%28e.g.%2C%20new%29%20in%20its%20own%20code%20statement%20which%20immediately%20gives%20the%20new%20resource%20to%20a%20manager%20object%20%28e.g.%2C%20auto_ptr%29.%0A%0A%u610F%u601D%u662F%u4E00%u884C%u5C31%u53EA%u5206%u914D%u4E00%u4E2A%u8D44%u6E90%uFF0C%u5E76%u4E14%u7ACB%u5373%u5C06%u8BE5%u8D44%u6E90%u4EA4%u7ED9smart%20pointer%u7BA1%u7406%u3002%0A%0A%23%23%20%u53C2%u8003%u6587%u732E%0A%5BException-Safe%20Function%20Calls%5D%28http%3A//www.gotw.ca/gotw/056.htm%29%0A%5BGotW%20%2389%20Solution%3A%20Smart%20Pointer%5D%28https%3A//herbsutter.com/2013/05/29/gotw-89-solution-smart-pointers/%29]]></content>
      <tags>
        <tag>c/c++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++函数中的按引用调用与返回]]></title>
    <url>%2F2018%2F03%2F08%2FC%2B%2B%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84%E6%8C%89%E5%BC%95%E7%94%A8%E8%B0%83%E7%94%A8%E4%B8%8E%E8%BF%94%E5%9B%9E%2F</url>
    <content type="text"><![CDATA[Edit&#x5728;C++&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x6309;&#x5F15;&#x7528;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;&#x4E0B;class A{}A&amp; func(A&amp; a){ A* b = new A(); b-&gt;param = a.param; return *b;}&#x5F15;&#x7528;&#x65E2;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x6240;&#x6709;&#x7684;&#x4E66;&#x4E0A;&#x90FD;&#x63D0;&#x5230;&#x5F15;&#x7528;&#x5373;&#x53EF;&#x89C6;&#x4E3A;&#x5BF9;&#x8C61;&#x7684;&#x522B;&#x540D;&#x3002;&#x4ED6;&#x6709;&#x5982;&#x4E0B;&#x7279;&#x6027;&#xFF1A;&#x53EF;&#x4EE5;&#x50CF;&#x5BF9;&#x8C61;&#x4E00;&#x6837;&#x64CD;&#x4F5C;&#x5F15;&#x7528;&#xFF0C;&#x4F7F;&#x7528;&quot;.&quot;&#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x800C;&#x65E0;&#x9700;&quot;-&gt;&quot;&#x64CD;&#x4F5C;&#x7B26;&#x5176;&#x5730;&#x5740;&#x4E0E;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x4E00;&#x81F4;&#x6240;&#x8C13;&#x522B;&#x540D;&#xFF0C;&#x5C31;&#x662F;&#x5F15;&#x7528;&#x5DF2;&#x7ECF;&#x4E0E;&#x5BF9;&#x8C61;&#x7ED1;&#x5B9A;&#xFF0C;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x6700;&#x540E;&#x4E00;&#x884C;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x7684;&#x3002;A a;A b;A&amp; c = a;c = b;&#x5F15;&#x7528;&#x662F;C++&#x4E2D;&#x7684;&#x8BED;&#x6CD5;&#x7CD6;&#xFF0C;&#x5176;&#x5B58;&#x5728;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x8BA9;&#x4F20;&#x9012;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#x66F4;&#x5EC9;&#x4EF7;&#x4E00;&#x4E9B;&#xFF0C;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x8C03;&#x7528;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x5176;&#x5B9E;C++&#x4E2D;&#x4E0D;&#x6309;&#x5F15;&#x7528;&#x4F20;&#x9012;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x5BF9;&#x8C61;&#x53C2;&#x6570;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x5982;&#x4E0B;&#xFF1A;class A{}void func (A a);void func (A&amp; a);&#x4E24;&#x8005;&#x5747;&#x53EF;&#x4EE5;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x524D;&#x8005;&#x4F20;&#x9012;&#x65F6;&#x8981;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#xFF0C;&#x5E76;&#x8C03;&#x7528;A&#x7684;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x524D;&#x8005;&#x5728;&#x51FD;&#x6570;&#x4F53;&#x5185;&#xFF0C;&#x5BF9;a&#x7684;&#x4FEE;&#x6539;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x5916;&#x90E8;a&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x5F80;&#x5F80;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x6309;&#x5F15;&#x7528;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5F80;&#x5F80;&#x66F4;&#x597D;&#x7684;&#x5199;&#x6CD5;&#x662F;&#xFF1A;void func (const A&amp; a); // &#x7528;const&#x6765;&#x4FDD;&#x8BC1;a&#x5BF9;&#x8C61;&#x4E0D;&#x88AB;&#x4FEE;&#x6539;&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x5728;&#x5B9A;&#x4E49;&#x8FD0;&#x7B97;&#x7B26;&#x91CD;&#x8F7D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x4F7F;&#x7528;return *this;&#x6765;&#x4FDD;&#x8BC1;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;class A { A&amp; operator=(A&amp; param){ ... return *this; };}A a, b, c;a = b = c;&#x5982;&#x679C;&#x4E0D;&#x6309;&#x5F15;&#x7528;&#x8FD4;&#x56DE;&#xFF0C;&#x53EF;&#x4EE5;&#x5417;&#xFF1F;class A { A operator=(A&amp; param){ ... return *this; };}A a, b, c;a = b = c;&#x7B54;&#x6848;&#x662F;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x533A;&#x522B;&#x662F;&#xFF1A;&#x4E0D;&#x6309;&#x5F15;&#x7528;&#x4F20;&#x9012;&#x65F6;&#xFF0C;b=c&#x7684;&#x64CD;&#x4F5C;&#x8FD4;&#x56DE;&#x65F6;&#x4F1A;&#x5148;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#xFF0C;&#x4EE5;*this&#x4E3A;&#x53C2;&#x6570;&#x8C03;&#x7528;A&#x7684;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8C03;&#x7528;&#x4E00;&#x6B21;A&#x7684;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5C06;&#x8BE5;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#x4F5C;&#x4E3A;&#x7ED3;&#x679C;&#x4F20;&#x9012;&#x7ED9;a&#x7684;=&#x64CD;&#x4F5C;&#x7B26;&#x51FD;&#x6570;&#x3002;&#x6309;&#x5F15;&#x7528;&#x4F20;&#x9012;&#xFF0C;&#x540C;&#x6837;b=c&#x8FD4;&#x56DE;&#x65F6;&#x4F1A;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#xFF0C;&#x5E76;&#x8C03;&#x7528;A&#x7684;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x8BE5;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#x7684;&#x5F15;&#x7528;&#x503C;&#x4F20;&#x7ED9;a&#x7684;=&#x64CD;&#x4F5C;&#x7B26;&#x51FD;&#x6570;&#x3002;&#x53EF;&#x89C1;&#x867D;&#x7136;&#x4E24;&#x8005;&#x90FD;&#x80FD;&#x505A;&#x5230;&#x94FE;&#x5F0F;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x6309;&#x5F15;&#x7528;&#x8FD4;&#x56DE;&#x5C11;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x6B21;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6548;&#x7387;&#x63D0;&#x5347;&#x3002;&#x8FD9;&#x4E0E;&#x5F15;&#x7528;&#x5B58;&#x5728;&#x7684;&#x4EF7;&#x503C;&#x4E5F;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;%23%20C++%u51FD%u6570%u4E2D%u7684%u6309%u5F15%u7528%u8C03%u7528%u4E0E%u8FD4%u56DE%0A@%28myblog%29%5Bc/c++%5D%0A%0A%u5728C++%u4E2D%u63D0%u4F9B%u4E86%u6309%u5F15%u7528%u8C03%u7528%u7684%u65B9%u5F0F%uFF0C%u5982%u4E0B%0A%60%60%60%0Aclass%20A%7B%7D%0AA%26%20func%28A%26%20a%29%0A%7B%0A%09A*%20b%20%3D%20new%20A%28%29%3B%0A%09b-%3Eparam%20%3D%20a.param%3B%0A%09return%20*b%3B%0A%7D%0A%60%60%60%0A%u5F15%u7528%u65E2%u53EF%u4EE5%u4F5C%u4E3A%u53C2%u6570%u4F20%u9012%uFF0C%u4E5F%u53EF%u4EE5%u662F%u8FD4%u56DE%u503C%u3002%u6240%u6709%u7684%u4E66%u4E0A%u90FD%u63D0%u5230%u5F15%u7528%u5373%u53EF%u89C6%u4E3A%u5BF9%u8C61%u7684%u522B%u540D%u3002%u4ED6%u6709%u5982%u4E0B%u7279%u6027%uFF1A%0A1.%20%u53EF%u4EE5%u50CF%u5BF9%u8C61%u4E00%u6837%u64CD%u4F5C%u5F15%u7528%uFF0C%u4F7F%u7528%60%22.%22%60%u64CD%u4F5C%u7B26%uFF0C%u800C%u65E0%u9700%60%22-%3E%22%60%u64CD%u4F5C%u7B26%0A2.%20%u5176%u5730%u5740%u4E0E%u5F15%u7528%u7684%u5BF9%u8C61%u4E00%u81F4%0A3.%20%u6240%u8C13%u522B%u540D%uFF0C%u5C31%u662F%u5F15%u7528%u5DF2%u7ECF%u4E0E%u5BF9%u8C61%u7ED1%u5B9A%uFF0C%u4EE5%u4E0B%u4EE3%u7801%u6700%u540E%u4E00%u884C%u662F%u4E0D%u5141%u8BB8%u7684%u3002%0A%60%60%60%0AA%20a%3B%0AA%20b%3B%0AA%26%20c%20%3D%20a%3B%0Ac%20%3D%20b%3B%0A%60%60%60%0A4.%20%u5F15%u7528%u662FC++%u4E2D%u7684%u8BED%u6CD5%u7CD6%uFF0C%u5176%u5B58%u5728%u7684%u76EE%u7684%u5C31%u662F%u8BA9%u4F20%u9012%u5BF9%u8C61%u7684%u65F6%u5019%u66F4%u5EC9%u4EF7%u4E00%u4E9B%uFF0C%u5C3D%u91CF%u907F%u514D%u8C03%u7528%u6784%u9020%u51FD%u6570%u3002%0A%0A%23%23%20%u4F5C%u4E3A%u53C2%u6570%0A%u5176%u5B9EC++%u4E2D%u4E0D%u6309%u5F15%u7528%u4F20%u9012%u81EA%u5B9A%u4E49%u7C7B%u5BF9%u8C61%u53C2%u6570%u4E5F%u662F%u53EF%u4EE5%u7684%u3002%u5982%u4E0B%uFF1A%0A%60%60%60%0Aclass%20A%7B%7D%0Avoid%20func%20%28A%20a%29%3B%0Avoid%20func%20%28A%26%20a%29%3B%0A%60%60%60%0A%u4E24%u8005%u5747%u53EF%u4EE5%uFF0C%u533A%u522B%u5728%0A1.%20%u524D%u8005%u4F20%u9012%u65F6%u8981%u5206%u914D%u4E00%u4E2A%u4E34%u65F6%u53D8%u91CF%uFF0C%u5E76%u8C03%u7528%60A%60%u7684%u62F7%u8D1D%u6784%u9020%u51FD%u6570%u3002%0A2.%20%u524D%u8005%u5728%u51FD%u6570%u4F53%u5185%uFF0C%u5BF9%60a%60%u7684%u4FEE%u6539%u4E0D%u4F1A%u5F71%u54CD%u5230%u5916%u90E8%60a%60%u5BF9%u8C61%u3002%u8FD9%u5F80%u5F80%u662F%u6211%u4EEC%u60F3%u8981%u7684%u3002%u6240%u4EE5%uFF0C%u6309%u5F15%u7528%u8C03%u7528%u7684%u65F6%u5019%uFF0C%u5F80%u5F80%u66F4%u597D%u7684%u5199%u6CD5%u662F%uFF1A%0A%60%60%60%0Avoid%20func%20%28const%20A%26%20a%29%3B%20//%20%u7528const%u6765%u4FDD%u8BC1a%u5BF9%u8C61%u4E0D%u88AB%u4FEE%u6539%0A%60%60%60%0A%0A%23%23%20%u4F5C%u4E3A%u8FD4%u56DE%u503C%0A%u5728%u5B9A%u4E49%u8FD0%u7B97%u7B26%u91CD%u8F7D%u7684%u65F6%u5019%uFF0C%u6211%u4EEC%u5F80%u5F80%u4F7F%u7528%60return%20*this%3B%60%u6765%u4FDD%u8BC1%u94FE%u5F0F%u8C03%u7528%uFF0C%u4F8B%u5982%uFF1A%0A%60%60%60%0Aclass%20A%20%7B%0A%09A%26%20operator%3D%28A%26%20param%29%7B%0A%09%09...%0A%09%09return%20*this%3B%0A%09%7D%3B%0A%7D%0AA%20a%2C%20b%2C%20c%3B%0Aa%20%3D%20b%20%3D%20c%3B%0A%60%60%60%0A%u5982%u679C%u4E0D%u6309%u5F15%u7528%u8FD4%u56DE%uFF0C%u53EF%u4EE5%u5417%uFF1F%0A%60%60%60%0Aclass%20A%20%7B%0A%09A%20operator%3D%28A%26%20param%29%7B%0A%09%09...%0A%09%09return%20*this%3B%0A%09%7D%3B%0A%7D%0AA%20a%2C%20b%2C%20c%3B%0Aa%20%3D%20b%20%3D%20c%3B%0A%60%60%60%0A%u7B54%u6848%u662F%u4E5F%u662F%u53EF%u4EE5%u7684%u3002%u533A%u522B%u662F%uFF1A%0A-%20%u4E0D%u6309%u5F15%u7528%u4F20%u9012%u65F6%uFF0C%60b%3Dc%60%u7684%u64CD%u4F5C%u8FD4%u56DE%u65F6%u4F1A%u5148%u5206%u914D%u4E00%u4E2A%u4E34%u65F6%u53D8%u91CF%uFF0C%u4EE5%60*this%60%u4E3A%u53C2%u6570%u8C03%u7528%60A%60%u7684%u62F7%u8D1D%u6784%u9020%u51FD%u6570%uFF0C%u7136%u540E%u518D%u8C03%u7528%u4E00%u6B21%60A%60%u7684%u62F7%u8D1D%u6784%u9020%u51FD%u6570%u5C06%u8BE5%u4E34%u65F6%u53D8%u91CF%u4F5C%u4E3A%u7ED3%u679C%u4F20%u9012%u7ED9%60a%60%u7684%60%3D%60%u64CD%u4F5C%u7B26%u51FD%u6570%u3002%0A-%20%u6309%u5F15%u7528%u4F20%u9012%uFF0C%u540C%u6837%60b%3Dc%60%u8FD4%u56DE%u65F6%u4F1A%u5206%u914D%u4E00%u4E2A%u4E34%u65F6%u53D8%u91CF%uFF0C%u5E76%u8C03%u7528%60A%60%u7684%u62F7%u8D1D%u6784%u9020%u51FD%u6570%uFF0C%u7136%u540E%u5C06%u8BE5%u4E34%u65F6%u53D8%u91CF%u7684%u5F15%u7528%u503C%u4F20%u7ED9%60a%60%u7684%60%3D%60%u64CD%u4F5C%u7B26%u51FD%u6570%u3002%0A%0A%u53EF%u89C1%u867D%u7136%u4E24%u8005%u90FD%u80FD%u505A%u5230%u94FE%u5F0F%u64CD%u4F5C%uFF0C%u4F46%u662F%u6309%u5F15%u7528%u8FD4%u56DE%u5C11%u8C03%u7528%u4E86%u4E00%u6B21%u62F7%u8D1D%u6784%u9020%u51FD%u6570%uFF0C%u6548%u7387%u63D0%u5347%u3002%u8FD9%u4E0E%u5F15%u7528%u5B58%u5728%u7684%u4EF7%u503C%u4E5F%u662F%u4E00%u81F4%u7684%u3002%0A%0A]]></content>
      <tags>
        <tag>c/c++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[运算符重载与拷贝构造函数]]></title>
    <url>%2F2018%2F03%2F08%2F%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD%E4%B8%8E%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%2F</url>
    <content type="text"><![CDATA[Edit&#x8FD9;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x5728;C++&#x4E2D;&#x770B;&#x8D77;&#x6765;&#x975E;&#x5E38;&#x57FA;&#x672C;&#xFF0C;&#x4F46;&#x662F;&#x521D;&#x5B66;&#x8005;&#x5F80;&#x5F80;&#x5BB9;&#x6613;&#x72AF;&#x9519;&#x3002;&#x8FD9;&#x91CC;&#x63D0;&#x53CA;&#x7684;&#x662F;=&#x7684;&#x91CD;&#x8F7D;&#x4E0E;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002; &#x5F53;&#x51FA;&#x73B0;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x8C03;&#x7528;=&#x91CD;&#x8F7D;&#x5417;&#xFF1F;class A {}A a;A b = a;&#x7B54;&#x6848;&#x662F;&#x9519;&#xFF0C;&#x8FD9;&#x91CC;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x663E;&#x5F0F;&#x5B9A;&#x4E49;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x5373;&#x8C03;&#x7528;&#x9ED8;&#x8BA4;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x5373;&#x6D45;&#x62F7;&#x8D1D;&#xFF0C;&#x5982;&#x679C;&#x7C7B;&#x5B9A;&#x4E49;&#x4E2D;&#x6D89;&#x53CA;&#x5185;&#x5B58;&#x7684;&#x5206;&#x914D;&#xFF0C;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x3002; =&#x8FD0;&#x7B97;&#x7B26;&#x53EA;&#x4F1A;&#x5728;&#x8D4B;&#x503C;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x5728;&#x6784;&#x9020;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x4F7F;&#x7528;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x5982;&#x4E0B;&#x662F;&#x4F7F;&#x7528;=&#x7684;&#x4F8B;&#x5B50;&#xFF1A;A a;A b;b = a;%23%u8FD0%u7B97%u7B26%u91CD%u8F7D%u4E0E%u62F7%u8D1D%u6784%u9020%u51FD%u6570%0A@%28myblog%29%5Bc/c++%5D%0A%0A%u8FD9%u4E2A%u77E5%u8BC6%u70B9%uFF0C%u5728C++%u4E2D%u770B%u8D77%u6765%u975E%u5E38%u57FA%u672C%uFF0C%u4F46%u662F%u521D%u5B66%u8005%u5F80%u5F80%u5BB9%u6613%u72AF%u9519%u3002%u8FD9%u91CC%u63D0%u53CA%u7684%u662F%60%3D%60%u7684%u91CD%u8F7D%u4E0E%u62F7%u8D1D%u6784%u9020%u51FD%u6570%u3002%0A%u5F53%u51FA%u73B0%u4E0B%u9762%u4EE3%u7801%u7684%u65F6%u5019%uFF0C%u662F%u8C03%u7528%60%3D%60%u91CD%u8F7D%u5417%uFF1F%0A%60%60%60%0Aclass%20A%20%7B%7D%0AA%20a%3B%0AA%20b%20%3D%20a%3B%0A%60%60%60%0A%u7B54%u6848%u662F%u9519%uFF0C%u8FD9%u91CC%u5C06%u4F1A%u8C03%u7528%u62F7%u8D1D%u6784%u9020%u51FD%u6570%u3002%u5982%u679C%u6CA1%u6709%u663E%u5F0F%u5B9A%u4E49%u62F7%u8D1D%u6784%u9020%u51FD%u6570%uFF0C%u5373%u8C03%u7528%u9ED8%u8BA4%u62F7%u8D1D%u6784%u9020%u51FD%u6570%uFF0C%u5373%u6D45%u62F7%u8D1D%uFF0C%u5982%u679C%u7C7B%u5B9A%u4E49%u4E2D%u6D89%u53CA%u5185%u5B58%u7684%u5206%u914D%uFF0C%u5219%u4F1A%u51FA%u73B0%u610F%u60F3%u4E0D%u5230%u7684%u7ED3%u679C%u3002%0A%60%3D%60%u8FD0%u7B97%u7B26%u53EA%u4F1A%u5728%u8D4B%u503C%u7684%u65F6%u5019%u4F7F%u7528%uFF0C%u800C%u5728%u6784%u9020%u7684%u65F6%u5019%u4F1A%u4F7F%u7528%u62F7%u8D1D%u6784%u9020%u51FD%u6570%u3002%u5982%u4E0B%u662F%u4F7F%u7528%60%3D%60%u7684%u4F8B%u5B50%uFF1A%0A%60%60%60%0AA%20a%3B%0AA%20b%3B%0Ab%20%3D%20a%3B%0A%60%60%60]]></content>
      <tags>
        <tag>c/c++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++菱形继承]]></title>
    <url>%2F2018%2F03%2F06%2FC%2B%2B%E8%8F%B1%E5%BD%A2%E7%BB%A7%E6%89%BF%2F</url>
    <content type="text"><![CDATA[Edit C++&#x652F;&#x6301;&#x591A;&#x7EE7;&#x627F;&#xFF0C;&#x5F53;&#x7236;&#x7C7B;&#x7EE7;&#x627F;&#x81EA;&#x540C;&#x4E00;&#x4E2A;&#x8D85;&#x7C7B;&#xFF0C;&#x5219;&#x5373;&#x4E3A;&#x672C;&#x7BC7;&#x6240;&#x8FF0;&#x7684;&#x83F1;&#x5F62;&#x7EE7;&#x627F;&#x3002;&#x7C7B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;&#x4E3B;&#x8981;&#x53C2;&#x8003;&#x4E24;&#x4E2A;&#x94FE;&#x63A5;&#xFF1A;c++&#x865A;&#x7EE7;&#x627F;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x5E03;&#x5C40;Memory Layout for Multiple and Virtual Inheritance - Edsko de Vries, January 2006&#x524D;&#x4E00;&#x7BC7;&#x63D0;&#x5230;&#x7684;VS2003&#x4E0E;&#x540E;&#x6587;&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x76F8;&#x540C;&#xFF0C;&#x524D;&#x4E00;&#x7BC7;&#x4E2D;&#x8FD8;&#x63D0;&#x5230;&#x4E86;Bjarne&#x65B9;&#x6848;&#xFF0C;&#x4E0D;&#x77E5;&#x54EA;&#x4E9B;&#x7F16;&#x8BD1;&#x5668;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6848;&#x3002;&#x6240;&#x4EE5;&#x672C;&#x6587;&#x8BA4;&#x4E3A;&#x524D;&#x8005;&#x65B9;&#x6848;&#x4E3A;&#x4E3B;&#x6D41;&#x65B9;&#x6848;&#xFF0C;&#x52A0;&#x4EE5;&#x9610;&#x8FF0;&#x3002;&#x540E;&#x8005;&#x65B9;&#x6848;&#x53EF;&#x89C6;&#x4E3A;&#x524D;&#x8005;&#x65B9;&#x6848;&#x7684;&#x7565;&#x5FAE;&#x6539;&#x826F;&#x7248;&#x3002;&#x5355;&#x7C7B;&#x865A;&#x7EE7;&#x627F;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;struct A { virtual foo(); int X;}struct B : virtual public A { virtual foo(); virtual fooB(); int Y;}&#x5176;&#x4E2D;VPTR&#x6307;&#x5411;Virtual Table (VTBL)&#xFF0C;VBPTR&#x6307;&#x5411;Virtual Base Table (VBTBL)&#x3002;&#x5176;&#x5185;&#x5BB9;&#x4E3A;&#xFF1A;&#x7B2C;&#x4E00;&#x9879;&#x4E3A;&#x4E0E;&#x672C;&#x7C7B;VPTR&#x7684;&#x504F;&#x79FB;&#x3002;&#x4E00;&#x822C;VPTR&#x603B;&#x662F;&#x5B58;&#x5728;&#x5BF9;&#x8C61;&#x5F00;&#x59CB;&#x5904;&#x3002;&#x6240;&#x4EE5;&#x4E0A;&#x4F8B;&#x4E3A;-4&#x5B57;&#x8282;&#xFF0C;&#x53D6;&#x8865;&#x5373;&#x4E3A;0xFFFFFFFC&#x3002;&#x5982;&#x679C;&#x672C;&#x7C7B;&#x6CA1;&#x6709;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x6CA1;&#x6709;VPTR&#xFF0C;&#x5219;&#x8BE5;&#x503C;&#x4E3A;0&#x3002;&#x4ECE;&#x7B2C;&#x4E8C;&#x9879;&#x5F00;&#x59CB;&#x4E3A;&#x5230;&#x5404;&#x57FA;&#x7C7B;&#x7684;&#x504F;&#x79FB;&#x503C;&#xFF0C;&#x6709;&#x51E0;&#x4E2A;&#x57FA;&#x7C7B;&#xFF0C;&#x8868;&#x9879;&#x5C31;&#x6709;&#x51E0;&#x4E2A;&#x3002;&#x4E0A;&#x4F8B;&#x4E2D;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x57FA;&#x7C7B;&#xFF0C;&#x4E14;&#x672C;&#x7C7B;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4F1A;&#x653E;&#x5728;VBPTR&#x4E4B;&#x540E;&#xFF0C;&#x6240;&#x4EE5;&#x5230;&#x57FA;&#x7C7B;A&#x7684;&#x504F;&#x79FB;&#x91CF;&#x5373;&#x4E3A;8&#x5B57;&#x8282;&#x3002;&#x6CE8;&#x610F;1: &#x53EA;&#x6709;&#x51FA;&#x73B0;&#x4E86;&#x865A;&#x62DF;&#x7EE7;&#x627F;&#xFF0C;&#x624D;&#x4F1A;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x865A;&#x62DF;&#x7EE7;&#x627F;&#xFF0C;&#x5219;&#x7236;&#x7C7B;VPTR&#x53CA;&#x5176;&#x6210;&#x5458;&#x4F1A;&#x6328;&#x7740;&#x5B50;&#x7C7B;VPTR&#x653E;&#x7F6E;&#x3002; &#x6CE8;&#x610F;2: &#x6B64;&#x65F6;VPTR&#x4E2D;&#x5185;&#x5BB9;&#x548C;&#x65E0;&#x865A;&#x7EE7;&#x627F;&#x65F6;&#x7684;&#x5185;&#x5BB9;&#x4E5F;&#x4E0D;&#x540C;&#x3002;&#x82E5;B&#x662F;&#x666E;&#x901A;&#x7EE7;&#x627F;A&#xFF0C;&#x5219;B&#x7C7B;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#x4E3A;&#xFF1A;&#x83F1;&#x5F62;&#x7EE7;&#x627F;&#x5BF9;&#x4E8E;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x83F1;&#x5F62;&#x7EE7;&#x627F;&#xFF1A;struct A{ A(int v=100):X(v){}; virtual void foo(void){}; int X;};struct B :virtual public A{ B(int v=10):Y(v),A(100){}; virtual void foo(void){}; virtual void fooB(void){} int Y;};struct C : virtual public A{ C(int v=20):Z(v),A(100){}; virtual void foo(void){}; virtual void fooC(void){}; int Z;};struct D : public B, public C{ D(int v =40):B(10),C(20),A(100),L(v){}; virtual void foo(void){}; virtual void fooD(void){}; int L;};&#x5176;&#x4E3B;&#x8981;&#x7279;&#x70B9;&#x4E3A;&#xFF1A;ABCD&#x5747;&#x5305;&#x542B;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E2A;&#x7C7B;&#x90FD;&#x6709;&#x865A;&#x51FD;&#x6570;&#x8868;&#x6BCF;&#x4E2A;&#x7C7B;&#x5747;&#x6709;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7236;&#x7C7B;BC&#x5BF9;&#x7956;&#x7C7B;&#x91C7;&#x7528;&#x865A;&#x7EE7;&#x627F;&#x5B50;&#x7C7B;&#x5BF9;&#x4E24;&#x4E2A;&#x7236;&#x7C7B;&#x91C7;&#x7528;&#x666E;&#x901A;&#x7EE7;&#x627F;&#x8FD9;&#x5E94;&#x5F53;&#x662F;&#x6700;&#x590D;&#x6742;&#x7684;&#x60C5;&#x51B5;&#x4E86;&#xFF0C;&#x5F53;&#x6709;&#x4E9B;&#x7C7B;&#x6CA1;&#x6709;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;&#x60C5;&#x51B5;&#x53EF;&#x80FD;&#x7A0D;&#x8BB8;&#x7B80;&#x5355;&#x4E9B;&#x3002;AA&#x7C7B;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x865A;&#x62DF;&#x7EE7;&#x627F;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#x4E3A;&#x666E;&#x901A;&#x5E03;&#x5C40;&#xFF1A;B / CBC&#x7C7B;&#x5747;&#x4E3A;&#x5355;&#x7C7B;&#x865A;&#x7EE7;&#x627F;&#xFF0C;&#x5982;&#x4E0A;&#x8282;&#x6240;&#x8FF0;&#xFF1A;DD&#x7C7B;&#x6700;&#x590D;&#x6742;&#x672C;&#x7C7B;&#x65E0;&#x8986;&#x76D6;&#x5173;&#x7CFB;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x5728;&#x6700;&#x4E00;&#x5F00;&#x59CB;&#x7684;VPTR&#x4E2D;&#xFF0C;&#x6216;&#x8BA4;&#x4E3A;&#x5728;B::VPTR&#x4E2D;&#x672C;&#x7C7B;&#x6210;&#x5458;&#x51FD;&#x6570;&#x5728;&#x6240;&#x6709;&#x76F4;&#x63A5;&#x7236;&#x7C7B;&#x5BF9;&#x8C61;&#x7684;&#x540E;&#x9762;&#x53EA;&#x6709;&#x4E00;&#x4EFD;A&#x5BF9;&#x8C61;&#x672C;&#x7C7B;&#x5982;&#x679C;&#x8986;&#x76D6;&#x4EFB;&#x4F55;&#x7236;&#x7C7B;&#x6216;&#x7956;&#x5148;&#x7C7B;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x4F1A;&#x8986;&#x76D6;&#x5BF9;&#x5E94;&#x5BF9;&#x8C61;&#x7684;VPTR&#x4E2D;&#x7684;&#x9879;&#x76EE;&#x3002;Error: source type is not polymorphic&#x5F53;&#x7956;&#x5148;&#x7C7B;A&#x6CA1;&#x6709;&#x865A;&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;&#x53D1;&#x751F;&#x5411;&#x4E0B;&#x8F6C;&#x578B;&#xFF08;&#x5B50;&#x7C7B;&#x6307;&#x9488;&#x8F6C;&#x6210;&#x7236;&#x7C7B;&#x6307;&#x9488;&#xFF09;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#x3002;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Memory Layout for Multiple and Virtual Inheritance - Edsko de Vries, January 2006 &#x4E2D;Downcasting&#x4E00;&#x8282;&#x3002; &#x8003;&#x8651;&#x8FD9;&#x6837;&#x4E24;&#x4E2A;&#x591A;&#x7EE7;&#x627F;&#x7684;&#x7C7B;&#xFF1A;Bottom* bottom1 = new Bottom();AnotherBottom* bottom2 = new AnotherBottom();Top* top1 = bottom1;Top* top2 = bottom2;Left* left = static_cast&lt;Left*&gt;(top1);Bottom&#x548C;AnotherBottom&#x90FD;&#x7EE7;&#x627F;&#x81EA;Left&#xFF0C;Left&#x865A;&#x7EE7;&#x627F;&#x81EA;Top&#x3002;&#x73B0;&#x5728;&#x8981;&#x628A;&#x4E00;&#x4E2A;Top&#x6307;&#x9488;&#x8F6C;&#x6362;&#x6210;&#x4E00;&#x4E2A;Left&#x6307;&#x9488;&#x3002;&#x4F7F;&#x7528;static_cast&#x4F1A;&#x62A5;error: cannot convert from base `Top&#x2019; to derived type `Left&#x2019; via virtual base `Top&#x2019;&#x3002; &#x56E0;&#x4E3A;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x65F6;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x7684;VPTR&#x548C;&#x5BF9;&#x8C61;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#xFF0C;&#x90FD;&#x662F;&#x5230;&#x8FD0;&#x884C;&#x65F6;&#x624D;&#x5EFA;&#x7ACB;&#x7684;&#x3002;&#x4E8E;&#x662F;&#x60F3;&#x5230;&#x53EF;&#x4EE5;&#x7528;dynamic_cast&#x3002;Left* left = dynamic_cast&lt;Left*&gt;(top1);&#x6B64;&#x65F6;&#x4F1A;&#x62A5;&#x53E6;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF1A;error: cannot dynamic_cast `top&#x2019; (of type `class Top*&#x2019;) to type `class Left*&#x2019; (source type is not polymorphic)&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;Top&#x7C7B;&#x6CA1;&#x6709;&#x865A;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;Bottom&#x548C;AnotherBottom&#x5BF9;&#x8C61;&#x7684;Top&#x90E8;&#x5206;&#x6CA1;&#x6709;VPTR&#x3002;&#x4E8E;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x4E5F;&#x5206;&#x4E0D;&#x6E05;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;int&#x8FD8;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x89E3;&#x51B3;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x4E3A;Top&#x52A0;&#x4E00;&#x4E2A;&#x865A;&#x51FD;&#x6570;&#x3002;&#x6700;&#x65B9;&#x4FBF;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x52A0;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;&#x865A;&#x6790;&#x6784;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;class Top { virtual ~Top(){};}&#x603B;&#x7ED3;&#x5F53;&#x53D1;&#x751F;&#x865A;&#x7EE7;&#x627F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#x4F1A;&#x4EA7;&#x751F;&#x5927;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5728;&#x5F15;&#x5165;VBPTR&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x5176;&#x5404;&#x57FA;&#x7C7B;&#x5BF9;&#x8C61;&#x7684;&#x6392;&#x5E03;&#x987A;&#x5E8F;&#x4E5F;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#x3002;&#x5176;&#x4ED6;&#x53C2;&#x8003;&#x94FE;&#x63A5;&#x8BE6;&#x8C08;C++&#x865A;&#x51FD;&#x6570;&#x8868;&#x90A3;&#x56DE;&#x4E8B;&#xFF08;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x5173;&#x7CFB;, &#x65E0;&#x865A;&#x7EE7;&#x627F;&#xFF09;&#x3010;C++&#x3011;c++&#x5355;&#x7EE7;&#x627F;&#x3001;&#x591A;&#x7EE7;&#x627F;&#x3001;&#x83F1;&#x5F62;&#x7EE7;&#x627F;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#xFF08;&#x865A;&#x51FD;&#x6570;&#x8868;&#x7ED3;&#x6784;&#xFF09; &#xFF08;&#x6B64;&#x7BC7;&#x5305;&#x542B;&#x4E86;&#x5BF9;&#x300A;c++&#x865A;&#x7EE7;&#x627F;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#x300B;&#x4E00;&#x6587;&#x7684;&#x9610;&#x91CA;%23%20C++%u83F1%u5F62%u7EE7%u627F%0A@%28myblog%29%5Bc/c++%5D%0AC++%u652F%u6301%u591A%u7EE7%u627F%uFF0C%u5F53%u7236%u7C7B%u7EE7%u627F%u81EA%u540C%u4E00%u4E2A%u8D85%u7C7B%uFF0C%u5219%u5373%u4E3A%u672C%u7BC7%u6240%u8FF0%u7684%u83F1%u5F62%u7EE7%u627F%u3002%u7C7B%u56FE%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%20%7C300x0%5D%28./1520316988125.png%29%0A%0A%u4E3B%u8981%u53C2%u8003%u4E24%u4E2A%u94FE%u63A5%uFF1A%0A-%20%5Bc++%u865A%u7EE7%u627F%u5BF9%u8C61%u7684%u5185%u5B58%u5E03%u5C40%5D%28http%3A//blog.csdn.net/BlueDog/article/details/4711169%29%0A-%20%5BMemory%20Layout%20for%20Multiple%20and%20Virtual%20Inheritance%20-%20Edsko%20de%20Vries%2C%20January%202006%5D%28https%3A//cs.nyu.edu/courses/fall16/CSCI-UA.0470-001/slides/MemoryLayoutMultipleInheritance.pdf%29%0A%0A%u524D%u4E00%u7BC7%u63D0%u5230%u7684VS2003%u4E0E%u540E%u6587%u4E2D%u7684%u5B9E%u73B0%u65B9%u5F0F%u76F8%u540C%uFF0C%u524D%u4E00%u7BC7%u4E2D%u8FD8%u63D0%u5230%u4E86Bjarne%u65B9%u6848%uFF0C%u4E0D%u77E5%u54EA%u4E9B%u7F16%u8BD1%u5668%u91C7%u7528%u8FD9%u79CD%u65B9%u6848%u3002%u6240%u4EE5%u672C%u6587%u8BA4%u4E3A%u524D%u8005%u65B9%u6848%u4E3A%u4E3B%u6D41%u65B9%u6848%uFF0C%u52A0%u4EE5%u9610%u8FF0%u3002%u540E%u8005%u65B9%u6848%u53EF%u89C6%u4E3A%u524D%u8005%u65B9%u6848%u7684%u7565%u5FAE%u6539%u826F%u7248%u3002%0A%0A%23%23%20%u5355%u7C7B%u865A%u7EE7%u627F%0A%u4EE3%u7801%u5B9E%u73B0%u5982%u4E0B%uFF1A%0A%60%60%60%0Astruct%20A%20%7B%0A%09virtual%20foo%28%29%3B%0A%09int%20X%3B%0A%7D%0Astruct%20B%20%3A%20virtual%20public%20A%20%7B%0A%09virtual%20foo%28%29%3B%0A%09virtual%20fooB%28%29%3B%0A%09int%20Y%3B%0A%7D%0A%60%60%60%0A%21%5BAlt%20text%5D%28./1520393159326.png%29%0A%0A%u5176%u4E2DVPTR%u6307%u5411Virtual%20Table%20%28VTBL%29%uFF0CVBPTR%u6307%u5411Virtual%20Base%20Table%20%28VBTBL%29%u3002%u5176%u5185%u5BB9%u4E3A%uFF1A%0A1.%20%u7B2C%u4E00%u9879%u4E3A%u4E0E%u672C%u7C7BVPTR%u7684%u504F%u79FB%u3002%u4E00%u822CVPTR%u603B%u662F%u5B58%u5728%u5BF9%u8C61%u5F00%u59CB%u5904%u3002%u6240%u4EE5%u4E0A%u4F8B%u4E3A-4%u5B57%u8282%uFF0C%u53D6%u8865%u5373%u4E3A0xFFFFFFFC%u3002%u5982%u679C%u672C%u7C7B%u6CA1%u6709%u865A%u51FD%u6570%uFF0C%u5C31%u6CA1%u6709VPTR%uFF0C%u5219%u8BE5%u503C%u4E3A0%u3002%0A2.%20%u4ECE%u7B2C%u4E8C%u9879%u5F00%u59CB%u4E3A%u5230%u5404%u57FA%u7C7B%u7684%u504F%u79FB%u503C%uFF0C%u6709%u51E0%u4E2A%u57FA%u7C7B%uFF0C%u8868%u9879%u5C31%u6709%u51E0%u4E2A%u3002%u4E0A%u4F8B%u4E2D%uFF0C%u53EA%u6709%u4E00%u4E2A%u57FA%u7C7B%uFF0C%u4E14%u672C%u7C7B%u6210%u5458%u53D8%u91CF%u4F1A%u653E%u5728VBPTR%u4E4B%u540E%uFF0C%u6240%u4EE5%u5230%u57FA%u7C7BA%u7684%u504F%u79FB%u91CF%u5373%u4E3A8%u5B57%u8282%u3002%0A%0A**%u6CE8%u610F1**%3A%20%u53EA%u6709%u51FA%u73B0%u4E86%u865A%u62DF%u7EE7%u627F%uFF0C%u624D%u4F1A%u6709%u8FD9%u6837%u7684%u5185%u5B58%u5E03%u5C40%uFF0C%u5982%u679C%u6CA1%u6709%u865A%u62DF%u7EE7%u627F%uFF0C%u5219%u7236%u7C7BVPTR%u53CA%u5176%u6210%u5458%u4F1A%u6328%u7740%u5B50%u7C7BVPTR%u653E%u7F6E%u3002%0A**%u6CE8%u610F2**%3A%20%u6B64%u65F6VPTR%u4E2D%u5185%u5BB9%u548C%u65E0%u865A%u7EE7%u627F%u65F6%u7684%u5185%u5BB9%u4E5F%u4E0D%u540C%u3002%u82E5B%u662F%u666E%u901A%u7EE7%u627FA%uFF0C%u5219B%u7C7B%u5185%u5B58%u5E03%u5C40%u4E3A%uFF1A%0A%21%5BAlt%20text%5D%28./1520393183452.png%29%0A%0A%23%23%20%u83F1%u5F62%u7EE7%u627F%0A%u5BF9%u4E8E%u8FD9%u6837%u4E00%u4E2A%u83F1%u5F62%u7EE7%u627F%uFF1A%0A%21%5BAlt%20text%5D%28./1520376926158.png%29%0A%u4EE3%u7801%u5B9E%u73B0%u5982%u4E0B%uFF1A%0A%60%60%60%0Astruct%20A%0A%7B%0A%20%20%20%20A%28int%20v%3D100%29%3AX%28v%29%7B%7D%3B%0A%20%20%20%20virtual%20void%20foo%28void%29%7B%7D%3B%0A%20%20%20%20int%20X%3B%0A%7D%3B%0Astruct%20B%20%3Avirtual%20public%20A%0A%7B%0A%20%20%20%20B%28int%20v%3D10%29%3AY%28v%29%2CA%28100%29%7B%7D%3B%0A%20%20%20%20virtual%20void%20foo%28void%29%7B%7D%3B%0A%20%20%20%20virtual%20void%20fooB%28void%29%7B%7D%0A%20%20%20%20int%20Y%3B%0A%7D%3B%0Astruct%20C%20%3A%20virtual%20public%20A%0A%7B%0A%20%20%20%20C%28int%20v%3D20%29%3AZ%28v%29%2CA%28100%29%7B%7D%3B%0A%20%20%20%20virtual%20void%20foo%28void%29%7B%7D%3B%0A%20%20%20%20virtual%20void%20fooC%28void%29%7B%7D%3B%0A%20%20%20%20int%20Z%3B%0A%7D%3B%0Astruct%20D%20%3A%20public%20B%2C%20public%20C%0A%7B%0A%20%20%20%20D%28int%20v%20%3D40%29%3AB%2810%29%2CC%2820%29%2CA%28100%29%2CL%28v%29%7B%7D%3B%0A%20%20%20%20virtual%20void%20foo%28void%29%7B%7D%3B%0A%20%20%20%20virtual%20void%20fooD%28void%29%7B%7D%3B%0A%20%20%20%20int%20L%3B%0A%7D%3B%0A%60%60%60%0A%u5176%u4E3B%u8981%u7279%u70B9%u4E3A%uFF1A%0A-%20ABCD%u5747%u5305%u542B%u865A%u51FD%u6570%uFF0C%u6240%u4EE5%u6BCF%u4E2A%u7C7B%u90FD%u6709%u865A%u51FD%u6570%u8868%0A-%20%u6BCF%u4E2A%u7C7B%u5747%u6709%u6210%u5458%u53D8%u91CF%0A-%20%u7236%u7C7BBC%u5BF9%u7956%u7C7B%u91C7%u7528%u865A%u7EE7%u627F%0A-%20%u5B50%u7C7B%u5BF9%u4E24%u4E2A%u7236%u7C7B%u91C7%u7528%u666E%u901A%u7EE7%u627F%0A%0A%u8FD9%u5E94%u5F53%u662F%u6700%u590D%u6742%u7684%u60C5%u51B5%u4E86%uFF0C%u5F53%u6709%u4E9B%u7C7B%u6CA1%u6709%u865A%u51FD%u6570%uFF0C%u6216%u8005%u6CA1%u6709%u6210%u5458%u53D8%u91CF%u65F6%uFF0C%u60C5%u51B5%u53EF%u80FD%u7A0D%u8BB8%u7B80%u5355%u4E9B%u3002%0A%23%23%23%20A%0AA%u7C7B%u56E0%u4E3A%u6CA1%u6709%u865A%u62DF%u7EE7%u627F%uFF0C%u6240%u4EE5%u5176%u5185%u5B58%u5E03%u5C40%u4E3A%u666E%u901A%u5E03%u5C40%uFF1A%0A%21%5BAlt%20text%5D%28./1520393228683.png%29%0A%0A%23%23%23%20B%20/%20C%0ABC%u7C7B%u5747%u4E3A%u5355%u7C7B%u865A%u7EE7%u627F%uFF0C%u5982%u4E0A%u8282%u6240%u8FF0%uFF1A%0A%21%5BAlt%20text%5D%28./1520393159326.png%29%0A%0A%23%23%23%20D%0AD%u7C7B%u6700%u590D%u6742%0A%21%5BAlt%20text%5D%28./1520393848842.png%29%0A%u9700%u8981%u6CE8%u610F%u7684%u662F%uFF1A%0A1.%20%u672C%u7C7B%u65E0%u8986%u76D6%u5173%u7CFB%u7684%u6210%u5458%u51FD%u6570%u5728%u6700%u4E00%u5F00%u59CB%u7684VPTR%u4E2D%uFF0C%u6216%u8BA4%u4E3A%u5728B%3A%3AVPTR%u4E2D%0A2.%20%u672C%u7C7B%u6210%u5458%u51FD%u6570%u5728%u6240%u6709%u76F4%u63A5%u7236%u7C7B%u5BF9%u8C61%u7684%u540E%u9762%0A3.%20%u53EA%u6709%u4E00%u4EFDA%u5BF9%u8C61%0A4.%20%u672C%u7C7B%u5982%u679C%u8986%u76D6%u4EFB%u4F55%u7236%u7C7B%u6216%u7956%u5148%u7C7B%u7684%u6210%u5458%u51FD%u6570%u4F1A%u8986%u76D6%u5BF9%u5E94%u5BF9%u8C61%u7684VPTR%u4E2D%u7684%u9879%u76EE%u3002%0A%0A%23%23%23%20Error%3A%20source%20type%20is%20not%20polymorphic%0A%u5F53%u7956%u5148%u7C7BA%u6CA1%u6709%u865A%u51FD%u6570%u7684%u65F6%u5019%uFF0C%u5728%u53D1%u751F%u5411%u4E0B%u8F6C%u578B%uFF08%u5B50%u7C7B%u6307%u9488%u8F6C%u6210%u7236%u7C7B%u6307%u9488%uFF09%u7684%u65F6%u5019%u4F1A%u51FA%u95EE%u9898%u3002%u53EF%u4EE5%u67E5%u770B%5BMemory%20Layout%20for%20Multiple%20and%20Virtual%20Inheritance%20-%20Edsko%20de%20Vries%2C%20January%202006%5D%28https%3A//cs.nyu.edu/courses/fall16/CSCI-UA.0470-001/slides/MemoryLayoutMultipleInheritance.pdf%29%20%u4E2DDowncasting%u4E00%u8282%u3002%0A%u8003%u8651%u8FD9%u6837%u4E24%u4E2A%u591A%u7EE7%u627F%u7684%u7C7B%uFF1A%0A%21%5BAlt%20text%5D%28./1520396776572.png%29%0A%60%60%60cpp%0ABottom*%20bottom1%20%3D%20new%20Bottom%28%29%3B%0AAnotherBottom*%20bottom2%20%3D%20new%20AnotherBottom%28%29%3B%0ATop*%20top1%20%3D%20bottom1%3B%0ATop*%20top2%20%3D%20bottom2%3B%0ALeft*%20left%20%3D%20static_cast%3CLeft*%3E%28top1%29%3B%0A%60%60%60%0ABottom%u548CAnotherBottom%u90FD%u7EE7%u627F%u81EALeft%uFF0CLeft%u865A%u7EE7%u627F%u81EATop%u3002%u73B0%u5728%u8981%u628A%u4E00%u4E2ATop%u6307%u9488%u8F6C%u6362%u6210%u4E00%u4E2ALeft%u6307%u9488%u3002%u4F7F%u7528%60static_cast%60%u4F1A%u62A5error%3A%20cannot%20convert%20from%20base%20%5C%60Top%27%20to%20derived%20type%20%5C%60Left%27%20via%20virtual%20base%20%5C%60Top%27%u3002%20%u56E0%u4E3A%u9700%u8981%u8FD0%u884C%u65F6%u4FE1%u606F%uFF0C%u56E0%u4E3A%u6240%u6709%u7684VPTR%u548C%u5BF9%u8C61%u5185%u5B58%u5E03%u5C40%uFF0C%u90FD%u662F%u5230%u8FD0%u884C%u65F6%u624D%u5EFA%u7ACB%u7684%u3002%u4E8E%u662F%u60F3%u5230%u53EF%u4EE5%u7528%60dynamic_cast%60%u3002%0A%60%60%60%0ALeft*%20left%20%3D%20dynamic_cast%3CLeft*%3E%28top1%29%3B%0A%60%60%60%0A%u6B64%u65F6%u4F1A%u62A5%u53E6%u4E00%u4E2A%u9519%u8BEF%uFF1Aerror%3A%20cannot%20dynamic_cast%20%5C%60top%27%20%28of%20type%20%5C%60class%20Top%5C*%27%29%20to%20type%20%5C%60class%20Left%5C*%27%20%28source%20type%20is%20not%20polymorphic%29%u3002%u8FD9%u662F%u56E0%u4E3ATop%u7C7B%u6CA1%u6709%u865A%u51FD%u6570%uFF0C%u6240%u4EE5%u6B64%u65F6Bottom%u548CAnotherBottom%u5BF9%u8C61%u7684Top%u90E8%u5206%u6CA1%u6709VPTR%u3002%u4E8E%u662F%u7F16%u8BD1%u5668%u4E5F%u5206%u4E0D%u6E05%u8FD9%u662F%u4E00%u4E2Aint%u8FD8%u662F%u4E00%u4E2A%u5BF9%u8C61%u3002%u89E3%u51B3%u7684%u65B9%u6CD5%u5C31%u662F%u4E3ATop%u52A0%u4E00%u4E2A%u865A%u51FD%u6570%u3002%u6700%u65B9%u4FBF%u7684%u65B9%u6CD5%u5C31%u662F%u52A0%u4E00%u4E2A%u7A7A%u7684%u865A%u6790%u6784%u51FD%u6570%uFF0C%u5982%u4E0B%uFF1A%0A%60%60%60%0Aclass%20Top%20%7B%0A%20virtual%20%7ETop%28%29%7B%7D%3B%0A%7D%0A%60%60%60%0A%0A%23%23%20%u603B%u7ED3%0A%u5F53%u53D1%u751F%u865A%u7EE7%u627F%u7684%u65F6%u5019%uFF0C%u5BF9%u8C61%u5185%u90E8%u5185%u5B58%u5E03%u5C40%u4F1A%u4EA7%u751F%u5927%u7684%u53D8%u5316%uFF0C%u5728%u5F15%u5165VBPTR%u7684%u540C%u65F6%uFF0C%u5176%u5404%u57FA%u7C7B%u5BF9%u8C61%u7684%u6392%u5E03%u987A%u5E8F%u4E5F%u53D1%u751F%u4E86%u53D8%u5316%u3002%0A%0A%23%23%20%u5176%u4ED6%u53C2%u8003%u94FE%u63A5%0A-%20%5B%u8BE6%u8C08C++%u865A%u51FD%u6570%u8868%u90A3%u56DE%u4E8B%uFF08%u591A%u91CD%u7EE7%u627F%u5173%u7CFB%2C%20%u65E0%u865A%u7EE7%u627F%uFF09%5D%28http%3A//blog.csdn.net/Li_Ning_/article/details/51893748%29%0A-%20%5B%u3010C++%u3011c++%u5355%u7EE7%u627F%u3001%u591A%u7EE7%u627F%u3001%u83F1%u5F62%u7EE7%u627F%u5185%u5B58%u5E03%u5C40%uFF08%u865A%u51FD%u6570%u8868%u7ED3%u6784%uFF09%5D%28http%3A//lib.csdn.net/article/cplusplus/51023%29%20%uFF08%u6B64%u7BC7%u5305%u542B%u4E86%u5BF9%u300Ac++%u865A%u7EE7%u627F%u5BF9%u8C61%u7684%u5185%u5B58%u5E03%u5C40%u300B%u4E00%u6587%u7684%u9610%u91CA%0A]]></content>
      <tags>
        <tag>c/c++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++单类定义多接口]]></title>
    <url>%2F2018%2F03%2F06%2FC%2B%2B%E5%8D%95%E7%B1%BB%E5%AE%9A%E4%B9%89%E5%A4%9A%E6%8E%A5%E5%8F%A3%2F</url>
    <content type="text"><![CDATA[Edit&#x6700;&#x8FD1;&#x505A;ThoughtWorks&#x7684;&#x9762;&#x8BD5;&#x9898;&#xFF0C;&#x7B2C;&#x4E00;&#x904D;&#x7528;&#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x9762;&#x8BD5;&#x5B98;&#x8BF4;&#x6CA1;&#x6709;OO&#x8BBE;&#x8BA1;&#xFF0C;&#x4E8E;&#x662F;&#x4E4E;&#x60F3;&#x70AB;&#x4E00;&#x6CE2;OO&#x8BBE;&#x8BA1;&#xFF0C;&#x7ED3;&#x679C;&#x624D;&#x53D1;&#x73B0;&#xFF0C;&#x539F;&#x6765;C++&#x8FD8;&#x5DEE;&#x7684;&#x5F88;&#x8FDC;&#x3002;&#x5148;&#x6765;&#x8BF4;&#x8BF4;&#x8FD9;&#x4E2A;&#x591A;&#x63A5;&#x53E3;&#x7684;&#x5751;&#x3002;&#x8FD8;&#x4F1A;&#x6709;&#x53E6;&#x5916;&#x7684;&#x7B14;&#x8BB0;&#x9610;&#x8FF0;&#xFF1A;&#x8FD0;&#x7B97;&#x7B26;&#x91CD;&#x8F7D;&#x4E0E;&#x62F7;&#x8D1D;&#x6784;&#x9020;&#x51FD;&#x6570;&#x83F1;&#x5F62;&#x7EE7;&#x627F;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x6309;&#x5F15;&#x7528;&#x8C03;&#x7528;&#x4E0E;&#x8FD4;&#x56DE;&#x4EE5;&#x540E;&#x60F3;&#x5230;&#x518D;&#x52A0;C++&#x4E2D;&#x7684;&#x63A5;&#x53E3;&#x63A5;&#x53E3;&#x662F;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x6309;&#x7167;&#x300A;&#x654F;&#x6377;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;-&#x539F;&#x5219;&#x3001;&#x6A21;&#x5F0F;&#x4E0E;&#x5B9E;&#x8DF5;&#x300B;&#x4E00;&#x4E66;&#x6240;&#x8FF0;&#xFF0C;&#x6240;&#x6709;&#x8F6F;&#x4EF6;&#x9AD8;&#x5C42;&#x4E0D;&#x5E94;&#x4F9D;&#x8D56;&#x4E8E;&#x4F4E;&#x5C42;&#xFF0C;&#x800C;&#x5E94;&#x4F9D;&#x8D56;&#x4E8E;&#x62BD;&#x8C61;&#x51FA;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4F9D;&#x8D56;&#x5012;&#x7F6E;&#x539F;&#x5219;(DIP)&#x3002;Java&#x4E2D;&#x7684;&#x63A5;&#x53E3;&#x7528;interface&#x5B9A;&#x4E49;&#xFF0C;C++&#x4E2D;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x4E13;&#x95E8;&#x7684;&#x5173;&#x952E;&#x5B57;&#x3002;&#x800C;&#x662F;&#x7528;&#x7EAF;&#x865A;&#x51FD;&#x6570;&#x6765;&#x8868;&#x793A;&#x63A5;&#x53E3;&#x3002;&#x5F62;&#x5982;&#xFF1A;class interface{public: virtual void func() = 0;}&#x63A5;&#x53E3;&#x662F;&#x4E0D;&#x80FD;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5305;&#x542B;&#x4E86;&#x7EAF;&#x865A;&#x51FD;&#x6570;&#x3002;&#x5355;&#x7C7B;&#x5B9A;&#x4E49;&#x591A;&#x63A5;&#x53E3;&#x5728;Java&#x4E2D;&#x5F88;&#x5BB9;&#x6613;&#x505A;&#x5230;&#xFF0C;&#x53EA;&#x9700;class A implement IA, IB{}&#x5373;&#x53EF;&#x3002;&#x5728;C++&#x4E2D;&#x53EF;&#x5426;&#x8FD9;&#x4E48;&#x505A;&#x5462;&#xFF1F;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x60F3;&#x5230;C++&#x4E2D;&#x7684;&#x591A;&#x7EE7;&#x627F;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;class IA {public: virtual void funcA() = 0;}class IB {public: virtual void funcB() = 0;}class C : public IA, public IB { void funcA(); void funcB();}&#x6309;&#x7167;&#x6700;&#x521D;&#x7684;&#x8BBE;&#x60F3;&#xFF0C;&#x6211;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#xFF1A;C* c = new C();IA* pA = (IA*)c;IB* pB = (IB*)pA;pA-&gt;funcA(); // &#x8C03;&#x7528;A&#x51FD;&#x6570;pB-&gt;funcB(); // &#x8C03;&#x7528;B&#x51FD;&#x6570;&#x4F46;&#x6211;&#x53D1;&#x73B0;&#xFF0C;&#x73B0;&#x5B9E;&#x4E0E;&#x7406;&#x60F3;&#x5DEE;&#x5F97;&#x5F88;&#x8FDC;&#x3002;pB-&gt;funcB()&#x8C03;&#x7528;&#x7684;&#x5176;&#x5B9E;&#x4E5F;&#x662F;funcA()&#x3002;&#x539F;&#x56E0;&#x4E0E;&#x591A;&#x7EE7;&#x627F;&#x5185;&#x5B58;&#x5206;&#x5E03;&#x4E0E;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x6709;&#x5173;&#x3002; &#x5728;&#x53D1;&#x751F;&#x591A;&#x7EE7;&#x627F;&#x65F6;&#xFF0C;&#x4E00;&#x4E2A;C&#x5BF9;&#x8C61;&#x4E2D;&#x5185;&#x5B58;&#x5206;&#x5E03;&#x5982;&#x4E0B;&#xFF0C;&#x76D7;&#x7528;&#x9648;&#x6D69;&#x7684;&#x535A;&#x5BA2;C++ &#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#x4E2D;&#x7684;&#x56FE;&#xFF1A;Base1* pA = (Base1*)derive;Base2* pB = (Base2*)derive;&#x5F53;&#x53D1;&#x751F;&#x5411;&#x4E0A;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x65F6;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x5747;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E0D;&#x7528;&#x4F9D;&#x8D56;&#x4E8E;&#x5404;&#x79CD;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BC6;&#x522B;&#x5230;&#x6B63;&#x786E;&#x7684;&#x51FD;&#x6570;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x53D1;&#x751F;&#x975E;&#x6B63;&#x5E38;&#x7684;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x9047;&#x5230;&#x95EE;&#x9898;&#x3002;&#x4F8B;&#x5982;&#x524D;&#x6587;&#x6240;&#x8FF0;&#x7684;&#x5C06;Base1&#x578B;&#x6307;&#x9488;&#x76F4;&#x63A5;&#x8F6C;&#x578B;&#x5230;Base2&#x5C31;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#x3002;&#x53EF;&#x53C2;&#x8003;&#x8FD9;&#x4E00;&#x7BC7;&#x535A;&#x6587;&#xFF1A;&#x5F53;C++&#x591A;&#x7EE7;&#x627F;&#x9047;&#x4E0A;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x3002;&#x6587;&#x4E2D;&#x63D0;&#x5230;&#x4E86;&#x4E09;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6211;&#x5C1D;&#x8BD5;&#x4E86;&#x524D;&#x4E24;&#x4E2A;&#xFF0C;&#x5206;&#x522B;&#x7528;static_cast&#x548C;dynamic_cast&#x5747;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;&#x3002;&#x5947;&#x602A;&#x7684;&#x662F;&#xFF0C;dynamic_cast&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x770B;&#x8D77;&#x6765;&#x5728;&#x7F51;&#x4E0A;&#x786E;&#x662F;&#x9887;&#x6709;&#x4E00;&#x4E9B;&#x652F;&#x6301;&#x8005;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x94FE;&#x63A5;&#xFF1A;Multiple inheritance casting from base class to a different derived class Type casting to an interface (Abstract class) in case of Multiple Inheritance in C++ How to perform casting with multiple inheritance &#x5728;&#x6211;&#x81EA;&#x5DF1;&#x7684;code&#x4E2D;&#xFF0C;dynamic_cast&#x4E4B;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x867D;&#x7136;&#x6CA1;&#x6709;&#x629B;&#x51FA;bad cast&#x5F02;&#x5E38;&#xFF0C;&#x4F46;&#x662F;&#x8F6C;&#x6362;&#x7684;&#x7ED3;&#x6784;&#x662F;NULL&#x3002;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x90FD;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x4F46;&#x6700;&#x7EC8;&#x6211;&#x8FD8;&#x662F;&#x627E;&#x5230;&#x4E86;&#x80FD;&#x89E3;&#x51B3;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x5C3D;&#x7BA1;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x50CF;&#x60F3;&#x8C61;&#x4E2D;&#x4F18;&#x96C5;&#x3002;&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x91C7;&#x7528;&#x83F1;&#x5F62;&#x7EE7;&#x627F;&#x6839;&#x636E;&#x67E5;&#x9605;&#x7684;&#x5404;&#x79CD;&#x7F51;&#x7AD9;&#x8D44;&#x6599;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x7EE7;&#x627F;&#x4F1A;&#x589E;&#x52A0;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#xFF0C;&#x4EE5;&#x53CA;&#x8C03;&#x7528;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x3002;&#x4F46;&#x786E;&#x5B9E;&#x80FD;&#x89E3;&#x51B3;&#x4E0A;&#x9762;&#x591A;&#x63A5;&#x53E3;&#x8F6C;&#x578B;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;class IBaseclass IA : virtual public IBase {}class IB : virtual public IBase {}class C : public IA, public IB {}IA* pA = new C();IBase* base = (IBase*)pA;IB* pB = dynamic_cast&lt;IB*&gt;(base);&#x8FD9;&#x6837;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x8BA9;&#x4EBA;&#x5982;&#x9CA0;&#x5728;&#x5589;&#xFF0C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x641E;&#x7684;&#x8FD9;&#x4E48;&#x590D;&#x6742;&#x3002;&#x8F6C;&#x6765;&#x8F6C;&#x53BB;&#xFF0C;&#x53EF;&#x8BFB;&#x6027;&#x6781;&#x5DEE;&#xFF0C;&#x800C;&#x4E14;dynamic_cast&#x8FD8;&#x6709;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x3002; &#x800C;&#x4E14;&#x8FD9;&#x91CC;&#x8FD8;&#x4F1A;&#x9047;&#x5230;source type is not polymorphic&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x4F7F;&#x6DFB;&#x52A0;&#x865A;&#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;class IBase { virtual ~IBase(){};}class IA : virtual public IBase {}class IB : virtual public IBase {}class C : public IA, public IB {}IA* pA = new C();IBase* base = (IBase*)pA;IB* pB = dynamic_cast&lt;IB*&gt;(base);&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x91C7;&#x7528;&#x5355;&#x63A5;&#x53E3;&#x8FD9;&#x4E00;&#x65B9;&#x6848;&#xFF0C;&#x662F;&#x53D7;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x94FE;&#x63A5;&#x7684;&#x542F;&#x53D1;&#xFF1A;Implementing multiple interfaces in a single C++ classAs you found out, you cannot implement two interfaces with one single C++ class directly. However, you could simply define a new Slice interface derived from the two other Slice interfaces, and then implement this new Slice interface with a single C++ class.&#x4F5C;&#x8005;&#x8BF4;C++&#x4E2D;&#x76F4;&#x63A5;&#x5B9A;&#x4E49;&#x591A;&#x63A5;&#x53E3;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x865A;&#x63A5;&#x53E3;&#x7C7B;&#x6765;&#x7EE7;&#x627F;&#x4E24;&#x4E2A;&#x865A;&#x63A5;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;&#x7C7B;&#x76F4;&#x63A5;&#x7EE7;&#x627F;&#x81EA;&#x8FD9;&#x4E2A;&#x865A;&#x7C7B;&#x3002;&#x4EE3;&#x7801;&#x5982;&#x4E0B;:class IA {}class IB {}class IAB : public IA, public IB {}class C : public IAB {}&#x8FD9;&#x6837;&#x8F6C;&#x578B;&#x8D77;&#x6765;&#x5C31;&#x65B9;&#x4FBF;&#x591A;&#x4E86;C* c = new C();IA* pA = (IA*)c;IB* pB = (IB*)pA; // &#x4ECD;&#x4F1A;&#x51FA;&#x9519;&#xFF0C;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x8F6C;IB* pB2 = (IB*)(IAB*)pA; // &#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x4F46;&#x5176;&#x5B9E;&#x4E0A;&#x5C42;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5E94;&#x8BE5;&#x4F9D;&#x8D56;&#x4E8E;IAB&#xFF0C;&#x800C;&#x4E0D;&#x5E94;&#x8BE5;&#x4E5F;&#x4E0D;&#x80FD;&#x591F;&#x53EA;&#x4F9D;&#x8D56;&#x4E8E;IA, IB&#xFF0C;&#x800C;&#x5BF9;IAB&#x4E00;&#x65E0;&#x6240;&#x77E5;&#x3002;&#x603B;&#x7ED3;&#x5728;&#x8BBE;&#x8BA1;&#x63A5;&#x53E3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x8981;&#x6307;&#x671B;&#x7528;&#x591A;&#x7EE7;&#x627F;&#x6765;&#x6A21;&#x4EFF;Java&#x91CC;&#x7684;&#x591A;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x3002;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x5728;&#x591A;&#x7EE7;&#x627F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x6CA1;&#x6709;&#x7EE7;&#x627F;&#x5173;&#x7CFB;(IA &amp; IB)&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x6307;&#x9488;&#x8F6C;&#x578B;&#x3002;&#x867D;&#x7136;&#x83F1;&#x5F62;&#x7EE7;&#x627F;+dynamic_cast&#x53EF;&#x4EE5;&#x505A;&#x5230;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x8BFB;&#x6027;&#x548C;&#x6027;&#x80FD;&#x4F1A;&#x4E0B;&#x964D;&#x3002;&#x53EF;&#x4EE5;&#x7528;&#x65B9;&#x6848;&#x4E8C;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x8FD1;&#x4F3C;&#x7684;&#x591A;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x7B80;&#x4ECB;&#x6709;&#x6548;&#x7684;&#x65B9;&#x6CD5;&#x3002;%23%20C++%u5355%u7C7B%u5B9A%u4E49%u591A%u63A5%u53E3%0A@%28myblog%29%5Bc/c++%5D%0A%0A%u6700%u8FD1%u505AThoughtWorks%u7684%u9762%u8BD5%u9898%uFF0C%u7B2C%u4E00%u904D%u7528%u6700%u7B80%u5355%u7684%u65B9%u6CD5%u5B9E%u73B0%u4E86%uFF0C%u9762%u8BD5%u5B98%u8BF4%u6CA1%u6709OO%u8BBE%u8BA1%uFF0C%u4E8E%u662F%u4E4E%u60F3%u70AB%u4E00%u6CE2OO%u8BBE%u8BA1%uFF0C%u7ED3%u679C%u624D%u53D1%u73B0%uFF0C%u539F%u6765C++%u8FD8%u5DEE%u7684%u5F88%u8FDC%u3002%u5148%u6765%u8BF4%u8BF4%u8FD9%u4E2A%u591A%u63A5%u53E3%u7684%u5751%u3002%u8FD8%u4F1A%u6709%u53E6%u5916%u7684%u7B14%u8BB0%u9610%u8FF0%uFF1A%0A-%20%u8FD0%u7B97%u7B26%u91CD%u8F7D%u4E0E%u62F7%u8D1D%u6784%u9020%u51FD%u6570%0A-%20%u83F1%u5F62%u7EE7%u627F%0A-%20%u51FD%u6570%u4E2D%u7684%u6309%u5F15%u7528%u8C03%u7528%u4E0E%u8FD4%u56DE%0A-%20%u4EE5%u540E%u60F3%u5230%u518D%u52A0%0A%0A%23%23%20C++%u4E2D%u7684%u63A5%u53E3%0A%u63A5%u53E3%u662F%u9762%u5411%u5BF9%u8C61%u5F88%u91CD%u8981%u7684%u6982%u5FF5%u3002%u6309%u7167%u300A%u654F%u6377%u8F6F%u4EF6%u5F00%u53D1-%u539F%u5219%u3001%u6A21%u5F0F%u4E0E%u5B9E%u8DF5%u300B%u4E00%u4E66%u6240%u8FF0%uFF0C%u6240%u6709%u8F6F%u4EF6%u9AD8%u5C42%u4E0D%u5E94%u4F9D%u8D56%u4E8E%u4F4E%u5C42%uFF0C%u800C%u5E94%u4F9D%u8D56%u4E8E%u62BD%u8C61%u51FA%u7684%u63A5%u53E3%u3002%u8FD9%u5C31%u662F%u4F9D%u8D56%u5012%u7F6E%u539F%u5219%28DIP%29%u3002Java%u4E2D%u7684%u63A5%u53E3%u7528%60interface%60%u5B9A%u4E49%uFF0CC++%u4E2D%u6CA1%u6709%u63D0%u4F9B%u4E13%u95E8%u7684%u5173%u952E%u5B57%u3002%u800C%u662F%u7528%u7EAF%u865A%u51FD%u6570%u6765%u8868%u793A%u63A5%u53E3%u3002%u5F62%u5982%uFF1A%0A%60%60%60%0Aclass%20interface%0A%7B%0Apublic%3A%0A%09virtual%20void%20func%28%29%20%3D%200%3B%0A%7D%0A%60%60%60%0A%u63A5%u53E3%u662F%u4E0D%u80FD%u5B9E%u4F8B%u5316%u7684%uFF0C%u56E0%u4E3A%u5305%u542B%u4E86%u7EAF%u865A%u51FD%u6570%u3002%0A%0A%23%23%u5355%u7C7B%u5B9A%u4E49%u591A%u63A5%u53E3%0A%u5728Java%u4E2D%u5F88%u5BB9%u6613%u505A%u5230%uFF0C%u53EA%u9700%60class%20A%20implement%20IA%2C%20IB%7B%7D%60%u5373%u53EF%u3002%u5728C++%u4E2D%u53EF%u5426%u8FD9%u4E48%u505A%u5462%uFF1F%u5F88%u5BB9%u6613%u5C31%u60F3%u5230C++%u4E2D%u7684%u591A%u7EE7%u627F%uFF0C%u5982%u4E0B%uFF1A%0A%60%60%60%0Aclass%20IA%20%7B%0Apublic%3A%0A%09virtual%20void%20funcA%28%29%20%3D%200%3B%0A%7D%0Aclass%20IB%20%7B%0Apublic%3A%0A%09virtual%20void%20funcB%28%29%20%3D%200%3B%0A%7D%0Aclass%20C%20%3A%20public%20IA%2C%20public%20IB%20%7B%0A%09void%20funcA%28%29%3B%0A%09void%20funcB%28%29%3B%0A%7D%0A%60%60%60%0A%u6309%u7167%u6700%u521D%u7684%u8BBE%u60F3%uFF0C%u6211%u5E0C%u671B%u80FD%u591F%uFF1A%0A%60%60%60%0AC*%20c%20%3D%20new%20C%28%29%3B%0AIA*%20pA%20%3D%20%28IA*%29c%3B%0AIB*%20pB%20%3D%20%28IB*%29pA%3B%0ApA-%3EfuncA%28%29%3B%20//%20%u8C03%u7528A%u51FD%u6570%0ApB-%3EfuncB%28%29%3B%20//%20%u8C03%u7528B%u51FD%u6570%0A%60%60%60%0A%u4F46%u6211%u53D1%u73B0%uFF0C%u73B0%u5B9E%u4E0E%u7406%u60F3%u5DEE%u5F97%u5F88%u8FDC%u3002%60pB-%3EfuncB%28%29%60%u8C03%u7528%u7684%u5176%u5B9E%u4E5F%u662F%60funcA%28%29%60%u3002%u539F%u56E0%u4E0E%u591A%u7EE7%u627F%u5185%u5B58%u5206%u5E03%u4E0E%u7C7B%u578B%u8F6C%u6362%u6709%u5173%u3002%0A%u5728%u53D1%u751F%u591A%u7EE7%u627F%u65F6%uFF0C%u4E00%u4E2AC%u5BF9%u8C61%u4E2D%u5185%u5B58%u5206%u5E03%u5982%u4E0B%uFF0C%u76D7%u7528%u9648%u6D69%u7684%u535A%u5BA2%5BC++%20%u5BF9%u8C61%u7684%u5185%u5B58%u5E03%u5C40%5D%28http%3A//blog.csdn.net/haoel/article/details/3081328%29%u4E2D%u7684%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1520307655931.png%29%20%21%5BAlt%20text%5D%28./1520307665220.png%29%0A%0A%60%60%60%0ABase1*%20pA%20%3D%20%28Base1*%29derive%3B%0ABase2*%20pB%20%3D%20%28Base2*%29derive%3B%0A%60%60%60%0A%u5F53%u53D1%u751F%u5411%u4E0A%u7C7B%u578B%u8F6C%u6362%u65F6%uFF0C%u7F16%u8BD1%u5668%u5747%u80FD%u5F88%u597D%u7684%u5DE5%u4F5C%uFF0C%u4E0D%u7528%u4F9D%u8D56%u4E8E%u5404%u79CD%u5F3A%u5236%u8F6C%u6362%uFF0C%u4E5F%u53EF%u4EE5%u8BC6%u522B%u5230%u6B63%u786E%u7684%u51FD%u6570%u3002%u4F46%u662F%u5982%u679C%u53D1%u751F%u975E%u6B63%u5E38%u7684%u7C7B%u578B%u8F6C%u6362%u65F6%uFF0C%u5C31%u4F1A%u9047%u5230%u95EE%u9898%u3002%u4F8B%u5982%u524D%u6587%u6240%u8FF0%u7684%u5C06%60Base1%60%u578B%u6307%u9488%u76F4%u63A5%u8F6C%u578B%u5230%60Base2%60%u5C31%u4F1A%u51FA%u95EE%u9898%u3002%u53EF%u53C2%u8003%u8FD9%u4E00%u7BC7%u535A%u6587%uFF1A%5B%u5F53C++%u591A%u7EE7%u627F%u9047%u4E0A%u7C7B%u578B%u8F6C%u6362%5D%28http%3A//blog.csdn.net/smstong/article/details/24455371%29%u3002%u6587%u4E2D%u63D0%u5230%u4E86%u4E09%u4E2A%u89E3%u51B3%u65B9%u6848%uFF0C%u6211%u5C1D%u8BD5%u4E86%u524D%u4E24%u4E2A%uFF0C%u5206%u522B%u7528%60static_cast%60%u548C%60dynamic_cast%60%u5747%u4E0D%u80FD%u89E3%u51B3%u3002%u5947%u602A%u7684%u662F%uFF0C%60dynamic_cast%60%u7684%u89E3%u51B3%u65B9%u6848%u770B%u8D77%u6765%u5728%u7F51%u4E0A%u786E%u662F%u9887%u6709%u4E00%u4E9B%u652F%u6301%u8005%uFF0C%u770B%u4E0B%u9762%u7684%u94FE%u63A5%uFF1A%0A-%20%5BMultiple%20inheritance%20casting%20from%20base%20class%20to%20a%20different%20derived%20class%0A%5D%28https%3A//stackoverflow.com/questions/15242841/multiple-inheritance-casting-from-base-class-to-a-different-derived-class%29%0A-%20%5BType%20casting%20to%20an%20interface%20%28Abstract%20class%29%20in%20case%20of%20Multiple%20Inheritance%20in%20C++%0A%5D%28https%3A//stackoverflow.com/questions/14121297/type-casting-to-an-interface-abstract-class-in-case-of-multiple-inheritance-in%29%0A-%20%5BHow%20to%20perform%20casting%20with%20multiple%20inheritance%0A%5D%28https%3A//stackoverflow.com/questions/5715865/how-to-perform-casting-with-multiple-inheritance%29%0A%0A%u5728%u6211%u81EA%u5DF1%u7684code%u4E2D%uFF0C%60dynamic_cast%60%u4E4B%u540E%u7684%u7ED3%u679C%u662F%u867D%u7136%u6CA1%u6709%u629B%u51FAbad%20cast%u5F02%u5E38%uFF0C%u4F46%u662F%u8F6C%u6362%u7684%u7ED3%u6784%u662FNULL%u3002%0A%0A%23%23%20%u89E3%u51B3%u65B9%u6848%0A%u4E0A%u9762%u63D0%u5230%u7684%u65B9%u6848%uFF0C%u90FD%u4E0D%u6210%u529F%uFF0C%u4F46%u6700%u7EC8%u6211%u8FD8%u662F%u627E%u5230%u4E86%u80FD%u89E3%u51B3%u7684%u529E%u6CD5%uFF0C%u5C3D%u7BA1%u770B%u8D77%u6765%u4E0D%u50CF%u60F3%u8C61%u4E2D%u4F18%u96C5%u3002%0A%23%23%23%20%u65B9%u6848%u4E00%uFF1A%u91C7%u7528%u83F1%u5F62%u7EE7%u627F%0A%u6839%u636E%u67E5%u9605%u7684%u5404%u79CD%u7F51%u7AD9%u8D44%u6599%uFF0C%u8FD9%u6837%u7684%u7EE7%u627F%u4F1A%u589E%u52A0%u5185%u5B58%u5E03%u5C40%uFF0C%u4EE5%u53CA%u8C03%u7528%u7684%u590D%u6742%u5EA6%u3002%u4F46%u786E%u5B9E%u80FD%u89E3%u51B3%u4E0A%u9762%u591A%u63A5%u53E3%u8F6C%u578B%u7684%u95EE%u9898%u3002%u5177%u4F53%u4EE3%u7801%u5982%u4E0B%uFF1A%0A%60%60%60%0Aclass%20IBase%0Aclass%20IA%20%3A%20virtual%20public%20IBase%20%7B%7D%0Aclass%20IB%20%3A%20virtual%20public%20IBase%20%7B%7D%0Aclass%20C%20%3A%20public%20IA%2C%20public%20IB%20%7B%7D%0A%0AIA*%20pA%20%3D%20new%20C%28%29%3B%0AIBase*%20base%20%3D%20%28IBase*%29pA%3B%0AIB*%20pB%20%3D%20dynamic_cast%3CIB*%3E%28base%29%3B%0A%60%60%60%20%0A%u8FD9%u6837%u7684%u505A%u6CD5%uFF0C%u8BA9%u4EBA%u5982%u9CA0%u5728%u5589%uFF0C%u4E00%u4E2A%u7B80%u5355%u7684%u8C03%u7528%uFF0C%u641E%u7684%u8FD9%u4E48%u590D%u6742%u3002%u8F6C%u6765%u8F6C%u53BB%uFF0C%u53EF%u8BFB%u6027%u6781%u5DEE%uFF0C%u800C%u4E14%60dynamic_cast%60%u8FD8%u6709%u6027%u80FD%u95EE%u9898%u3002%0A%u800C%u4E14%u8FD9%u91CC%u8FD8%u4F1A%u9047%u5230source%20type%20is%20not%20polymorphic%u7684%u95EE%u9898%uFF0C%u89E3%u51B3%u65B9%u6CD5%u4F7F%u6DFB%u52A0%u865A%u6790%u6784%u51FD%u6570%u3002%0A%60%60%60%0Aclass%20IBase%20%7B%0A%09virtual%20%7EIBase%28%29%7B%7D%3B%0A%7D%0Aclass%20IA%20%3A%20virtual%20public%20IBase%20%7B%7D%20%0Aclass%20IB%20%3A%20virtual%20public%20IBase%20%7B%7D%0Aclass%20C%20%3A%20public%20IA%2C%20public%20IB%20%7B%7D%0A%0AIA*%20pA%20%3D%20new%20C%28%29%3B%0AIBase*%20base%20%3D%20%28IBase*%29pA%3B%0AIB*%20pB%20%3D%20dynamic_cast%3CIB*%3E%28base%29%3B%0A%60%60%60%20%0A%0A%23%23%23%20%u65B9%u6848%u4E8C%uFF1A%u91C7%u7528%u5355%u63A5%u53E3%0A%u8FD9%u4E00%u65B9%u6848%uFF0C%u662F%u53D7%u4E86%u4E0B%u9762%u7684%u94FE%u63A5%u7684%u542F%u53D1%uFF1A%5BImplementing%20multiple%20interfaces%20in%20a%20single%20C++%20class%5D%28https%3A//forums.zeroc.com/discussion/4994/implementing-multiple-interfaces-in-a-single-c-class%29%0A%0A%3E%20As%20you%20found%20out%2C%20**you%20cannot%20implement%20two%20interfaces%20with%20one%20single%20C++%20class%20directly**.%20However%2C%20you%20could%20simply%20define%20a%20new%20Slice%20interface%20derived%20from%20the%20two%20other%20Slice%20interfaces%2C%20and%20then%20implement%20this%20new%20Slice%20interface%20with%20a%20single%20C++%20class.%0A%0A%u4F5C%u8005%u8BF4C++%u4E2D%u76F4%u63A5%u5B9A%u4E49%u591A%u63A5%u53E3%u5E76%u4E0D%u662F%u4E00%u4E2A%u597D%u7684%u5B9E%u73B0%uFF0C%u5B9A%u4E49%u4E00%u4E2A%u865A%u63A5%u53E3%u7C7B%u6765%u7EE7%u627F%u4E24%u4E2A%u865A%u63A5%u53E3%uFF0C%u5B9E%u73B0%u7C7B%u76F4%u63A5%u7EE7%u627F%u81EA%u8FD9%u4E2A%u865A%u7C7B%u3002%u4EE3%u7801%u5982%u4E0B%3A%0A%60%60%60%0Aclass%20IA%20%7B%7D%0Aclass%20IB%20%7B%7D%0Aclass%20IAB%20%3A%20public%20IA%2C%20public%20IB%20%7B%7D%0Aclass%20C%20%3A%20public%20IAB%20%7B%7D%0A%60%60%60%0A%u8FD9%u6837%u8F6C%u578B%u8D77%u6765%u5C31%u65B9%u4FBF%u591A%u4E86%0A%60%60%60%0AC*%20c%20%3D%20new%20C%28%29%3B%0AIA*%20pA%20%3D%20%28IA*%29c%3B%0AIB*%20pB%20%3D%20%28IB*%29pA%3B%20//%20%u4ECD%u4F1A%u51FA%u9519%uFF0C%u4E0D%u80FD%u76F4%u63A5%u8F6C%0AIB*%20pB2%20%3D%20%28IB*%29%28IAB*%29pA%3B%20//%20%u53EF%u4EE5%u5DE5%u4F5C%0A%60%60%60%0A%u4F46%u5176%u5B9E%u4E0A%u5C42%u7684%u4EE3%u7801%uFF0C%u5E94%u8BE5%u4F9D%u8D56%u4E8E%60IAB%60%uFF0C%u800C%u4E0D%u5E94%u8BE5%u4E5F%u4E0D%u80FD%u591F%u53EA%u4F9D%u8D56%u4E8E%60IA%60%2C%20%60IB%60%uFF0C%u800C%u5BF9%60IAB%60%u4E00%u65E0%u6240%u77E5%u3002%0A%0A%23%23%20%u603B%u7ED3%0A1.%20%u5728%u8BBE%u8BA1%u63A5%u53E3%u7684%u65F6%u5019%uFF0C%u4E0D%u8981%u6307%u671B%u7528%u591A%u7EE7%u627F%u6765%u6A21%u4EFFJava%u91CC%u7684%u591A%u63A5%u53E3%u5B9A%u4E49%u3002%0A2.%20%u5C3D%u91CF%u907F%u514D%u5728%u591A%u7EE7%u627F%u7684%u65F6%u5019%uFF0C%u9700%u8981%u5728%u6CA1%u6709%u7EE7%u627F%u5173%u7CFB%28%60IA%60%20%26%20%60IB%60%29%u4E4B%u95F4%u8FDB%u884C%u6307%u9488%u8F6C%u578B%u3002%u867D%u7136%u83F1%u5F62%u7EE7%u627F+%60dynamic_cast%60%u53EF%u4EE5%u505A%u5230%uFF0C%u4F46%u662F%u53EF%u8BFB%u6027%u548C%u6027%u80FD%u4F1A%u4E0B%u964D%u3002%0A3.%20%u53EF%u4EE5%u7528%u65B9%u6848%u4E8C%u4E2D%u7684%u65B9%u6CD5%u6765%u5B9E%u73B0%u8FD1%u4F3C%u7684%u591A%u63A5%u53E3%u5B9A%u4E49%u3002%u8FD9%u662F%u4E00%u4E2A%u76F8%u5BF9%u7B80%u4ECB%u6709%u6548%u7684%u65B9%u6CD5%u3002%0A]]></content>
      <tags>
        <tag>c/c++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[XSharedPreference & SharedPreference - XPosed模块中的preference使用]]></title>
    <url>%2F2018%2F01%2F17%2FXSharedPreference%20%26%20SharedPreference%20-%20XPosed%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84preference%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Edit&#x6700;&#x8FD1;&#x5728;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;Xposed&#x6A21;&#x5757;[]Niwatori-One Handed Mode](https://github.com/tkgktyk/Niwatori)&#x3002;&#x539F;&#x4F5C;&#x8005;tkgktyk&#x5DF2;&#x7ECF;&#x505C;&#x6B62;&#x66F4;&#x65B0;&#x4E86;&#xFF0C;&#x5BFC;&#x81F4;&#x6A21;&#x5757;&#x5728;Xposed Framework for Nougat&#x53D1;&#x5E03;&#x4EE5;&#x540E;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x3002;&#x4E8E;&#x662F;&#x6211;fork&#x4E86;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#xFF0C;&#x5F00;&#x59CB;&#x505A;Android Nougat&#x4E0A;&#x7684;&#x9002;&#x914D;&#x5DE5;&#x4F5C;&#xFF0C;&#x5E76;&#x5728;XDA&#x4E0A;&#x53D1;&#x5E03;&#x4E86;&#x66F4;&#x65B0;&#x94FE;&#x63A5;&#x3002; &#x5728;&#x9002;&#x914D;&#x4E86;Nougat&#x4E4B;&#x540E;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x66F4;&#x597D;&#x3002;&#x76EE;&#x524D;&#x60F3;&#x505A;&#x7684;&#x662F;&#x80FD;&#x901A;&#x8FC7;fooview&#x8C03;&#x7528;Niwatori&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x3002;&#x5E76;&#x4E14;&#x8BE5;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x662F;small screen&#x8FD8;&#x662F;slide down&#x7B49;&#x7B49;&#xFF0C;&#x80FD;&#x901A;&#x8FC7;Niwatori&#x672C;&#x8EAB;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;&#x4F46;&#x662F;&#x5728;&#x5F00;&#x53D1;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x52A8;&#x6001;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x52A0;&#x8F7D;&#x9700;&#x8981;&#x4F7F;&#x7528;SDK 25&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x4ECE;SDK 25&#x5F00;&#x59CB;&#xFF0C;&#x539F;&#x5148;SharedPreference&#x7684;&#x6253;&#x5F00;&#x65B9;&#x5F0F;MODE_WORLD_PRIVATE&#x5DF2;&#x7ECF;&#x88AB;&#x7981;&#x6B62;&#x4E86;&#x3002;&#x4F7F;&#x7528;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;security exception&#x3002; &#x6240;&#x4EE5;&#x8981;&#x5347;&#x5230;&#x4F7F;&#x7528;SDK 25&#xFF0C;&#x5FC5;&#x987B;&#x89E3;&#x51B3;preference&#x5F15;&#x7528;&#x7684;&#x95EE;&#x9898;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5230;&#x5E95;&#x4F1A;&#x5728;&#x54EA;&#x91CC;&#x5F71;&#x54CD;&#x5230;&#x6211;&#x4EEC;&#x7684;Xposed&#x6A21;&#x5757;&#x5462;&#xFF1F;Xposed&#x4E2D;&#x7684;preferenceXposed&#x6A21;&#x5757;&#x4E2D;&#x4F7F;&#x7528;preference&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x901A;&#x8FC7;XSharedPreference&#x6765;&#x64CD;&#x4F5C;&#x3002;XSharedPreference&#x5728;Android&#x6807;&#x51C6;&#x7684;SharedPreference&#x7C7B;&#x4E0A;&#x5305;&#x4E86;&#x4E00;&#x5C42;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;security&#x7684;fix&#x6216;&#x8005;work around&#x3002;&#x4F8B;&#x5982;&#xFF1A;XSharedPreference.makeWorldReadable&#x3002;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;&#x52A0;&#x8F7D;app data&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;xml&#x6587;&#x4EF6;&#x6765;&#x8BFB;&#x53D6;&#x3001;&#x5B58;&#x50A8;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E3A;&#xFF08;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF09;&#xFF1A;/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml&#x3002;&#x901A;&#x5E38;Xposed&#x4E2D;&#x5982;&#x4E0B;&#x4F7F;&#x7528;preference&#x4F1A;&#x6309;&#x7167;&#x5982;&#x4E0B;&#x7684;&#x65F6;&#x5E8F;&#x56FE;&#xFF0C;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF1A;XSharedPreference&#x5B9E;&#x4F8B;&#x521B;&#x5EFA;&#x5728;&#x6A21;&#x5757;&#x52A0;&#x8F7D;&#x7684;initZygote&#x4E2D;&#x6570;&#x636E;&#x7684;&#x4F7F;&#x7528;&#x901A;&#x8FC7;&#x94A9;&#x5B50;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x5404;&#x4E2A;app&#x7684;Context&#x5E95;&#x4E0B;&#x6267;&#x884C;&#x4E8E;&#x662F;&#x5F53;MODE_WORLD_READABLE&#x88AB;&#x5E9F;&#x6B62;&#x4EE5;&#x540E;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x5373;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;app1&#x662F;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x67E5;&#x770B;Niwatori&#x7684;preference&#x6587;&#x4EF6;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x6CD5;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x3002;Xposed&#x5B98;&#x65B9;&#x6216;&#x8005;&#x4F5C;&#x8005;rovo89&#x8FD8;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x5B98;&#x65B9;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x603B;&#x662F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x672A;&#x96E8;&#x7EF8;&#x7F2A;&#x7684;&#x52C7;&#x58EB;&#xFF0C;XDA&#x4E0A;&#x6709;&#x4E00;&#x4E2A;&#x5E16;&#x5B50;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;work around&#xFF1A;MODE_WORLD_READABLE in Android N&#x6211;&#x5728;Niwatori&#x4E2D;&#x4E5F;&#x4F7F;&#x7528;&#x4E86;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x4E0D;&#x662F;&#x5B8C;&#x7F8E;&#x89E3;&#x51B3;&#xFF0C;&#x800C;&#x4E14;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x6539;&#x8FDB;&#x3002;&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898;&#x8BE5;work around&#x548C;XSharedPreference.makeWorldReadable&#x540C;&#x7406;&#xFF0C;&#x6211;&#x5982;&#x4E0B;&#x8C03;&#x7528;preference&#xFF1A;mPrefs.makeWorldReadable();Log.e(&quot;Ben&quot;, &quot;package:&quot; + decorView.getContext().getPackageName() + &quot;, &quot; + decorView + &quot;,&quot; + mPrefs.getString(&quot;key_boundary_color_ms&quot;, &quot;default value&quot;));Log.e(&quot;Ben&quot;, &quot;file can read: &quot; + mPrefs.getFile().canRead()); &lt;-- &#x6709;&#x4E9B;app&#x4F1A;&#x662F;true&#xFF0C;&#x6709;&#x4E9B;app&#x4F1A;&#x662F;false&#x5F53;&#x8FD4;&#x56DE;true&#x7684;&#x65F6;&#x5019;&#xFF0C;settings&#x5C31;&#x6210;&#x529F;&#x7684;&#x4F20;&#x5230;&#x4E86;&#x5BF9;&#x5E94;app&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x800C;&#x53EF;&#x4EE5;read&#x65F6;&#x800C;&#x4E0D;&#x53EF;&#x4EE5;read&#xFF0C;&#x6211;&#x4E5F;&#x5F88;&#x82E6;&#x607C;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#x513F;&#x3002;&#x7559;&#x5F85;&#x4EE5;&#x540E;&#x518D;&#x89E3;&#x51B3;&#x4E86;&#x3002;&#x89E3;&#x51B3;&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898; - 20180119&#x4EE5;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;Android 7.0&#x5F00;&#x59CB;&#xFF0C;&#x5373;&#x4ECE;SDK 24&#x5F00;&#x59CB;&#xFF0C;Android&#x52A0;&#x5165;&#x4E86;&#x5F88;&#x591A;security&#x65B9;&#x9762;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x53C2;&#x8003;Android 7.0 Security Features: Direct Boot&#x3002;&#x8FD9;&#x548C;&#x6211;&#x4EEC;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x592A;&#x76F8;&#x5173;&#x3002;&#x76F8;&#x5173;&#x7684;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;Nougat&#x4E0D;&#x5141;&#x8BB8;world readable&#x7684;&#x6587;&#x4EF6;&#x4E86;&#x3002;&#x5982;&#x679C;&#x7528;SDK25&#x7F16;&#x8BD1;&#x7684;app&#x8FD8;&#x7528;MODE_WORLD_READABLE&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x62A5;exception&#x3002; Google&#x4E0A;&#x9C9C;&#x5C11;&#x6709;&#x76F8;&#x5173;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;GravityBox commit - Use device protected storage for preferences and filesXposedBridge issue 1 - Any place to store world readable preferences on Nougat?XposedBridge issue 2 - Preferences of a module cannot be read from different process on some devices running MMXposedBridge issue 3 - XSharedPreferences doesn&#x2019;t work[Q] Xposed for nougat to read prefs ith fbe or without&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;&#xFF0C;&#x662F;XposedBridge issue 1&#x4E2D;GravityBox&#x4F5C;&#x8005;&#x7684;&#x4E00;&#x4E2A;comment&#x63D0;&#x5230;&#x4E86;&#x6700;&#x7EC8;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;&#x8BE5;comment&#x5982;&#x4E0B;&#xFF1A;setStorageDeviceProtectedcreateDeviceProtectedStorageContext&#x5C06;preference&#x6587;&#x4EF6;&#x5B58;&#x5230;/data/user_de/0/&lt;package name&gt;/shared_prefs&#x4E0B;&#x3002;&#x5E76;&#x5728;Xposed&#x7684;context&#x7AEF;&#xFF0C;&#x76F4;&#x63A5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002; &#x4F46;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x9700;&#x5982;&#x6B64;&#x3002;&#x53EA;&#x8981;&#x4FDD;&#x8BC1;package folder&#x7684;&#x6743;&#x9650;&#x81F3;&#x5C11;&#x662F;711&#xFF0C;preference.xml&#x6587;&#x4EF6;&#x6709;&#x53EF;&#x8BFB;&#x6743;&#x9650;&#x5373;&#x53EF;&#x3002;%23%20XSharedPreference%20%26%20SharedPreference%20-%20XPosed%u6A21%u5757%u4E2D%u7684preference%u4F7F%u7528%0A@%28myblog%29%5BAndroid%2C%20xposed%5D%0A%0A%u6700%u8FD1%u5728%u7EF4%u62A4%u4E00%u4E2AXposed%u6A21%u5757%5B%5DNiwatori-One%20Handed%20Mode%5D%28https%3A//github.com/tkgktyk/Niwatori%29%u3002%u539F%u4F5C%u8005tkgktyk%u5DF2%u7ECF%u505C%u6B62%u66F4%u65B0%u4E86%uFF0C%u5BFC%u81F4%u6A21%u5757%u5728Xposed%20Framework%20for%20Nougat%u53D1%u5E03%u4EE5%u540E%uFF0C%u4E0D%u80FD%u4F7F%u7528%u3002%u4E8E%u662F%u6211fork%u4E86%u4E00%u4EFD%u4EE3%u7801%uFF0C%u5F00%u59CB%u505AAndroid%20Nougat%u4E0A%u7684%u9002%u914D%u5DE5%u4F5C%uFF0C%u5E76%u5728XDA%u4E0A%u53D1%u5E03%u4E86%u66F4%u65B0%5B%u94FE%u63A5%5D%28https%3A//forum.xda-developers.com/xposed/modules/mod-niwatori-one-handed-mode-t3730963%29%u3002%0A%u5728%u9002%u914D%u4E86Nougat%u4E4B%u540E%uFF0C%u5E0C%u671B%u80FD%u6DFB%u52A0%u4E00%u4E9B%u65B0%u529F%u80FD%uFF0C%u8BA9%u7528%u6237%u4F53%u9A8C%u66F4%u597D%u3002%u76EE%u524D%u60F3%u505A%u7684%u662F%u80FD%u901A%u8FC7fooview%u8C03%u7528Niwatori%u7684%u5FEB%u6377%u65B9%u5F0F%u3002%u5E76%u4E14%u8BE5%u5FEB%u6377%u65B9%u5F0F%u7684%u529F%u80FD%uFF0C%u4F8B%u5982%u662Fsmall%20screen%u8FD8%u662Fslide%20down%u7B49%u7B49%uFF0C%u80FD%u901A%u8FC7Niwatori%u672C%u8EAB%u8FDB%u884C%u914D%u7F6E%u3002%u4F46%u662F%u5728%u5F00%u53D1%u8FD9%u4E00%u529F%u80FD%u7684%u65F6%u5019%uFF0C%u53D1%u73B0%u52A8%u6001%u5FEB%u6377%u65B9%u5F0F%u7684%u52A0%u8F7D%u9700%u8981%u4F7F%u7528SDK%2025%u4EE5%u4E0A%u7248%u672C%uFF0C%u800C%u4ECESDK%2025%u5F00%u59CB%uFF0C%u539F%u5148SharedPreference%u7684%u6253%u5F00%u65B9%u5F0FMODE%5C_WORLD%5C_PRIVATE%u5DF2%u7ECF%u88AB%u7981%u6B62%u4E86%u3002%u4F7F%u7528%u5B83%u4F1A%u5BFC%u81F4security%20exception%u3002%0A%u6240%u4EE5%u8981%u5347%u5230%u4F7F%u7528SDK%2025%uFF0C%u5FC5%u987B%u89E3%u51B3preference%u5F15%u7528%u7684%u95EE%u9898%u3002%u90A3%u4E48%u8FD9%u4E2A%u6A21%u5F0F%u7684%u53D8%u5316%uFF0C%u5230%u5E95%u4F1A%u5728%u54EA%u91CC%u5F71%u54CD%u5230%u6211%u4EEC%u7684Xposed%u6A21%u5757%u5462%uFF1F%0A%0A%23%23%20Xposed%u4E2D%u7684preference%0AXposed%u6A21%u5757%u4E2D%u4F7F%u7528preference%u7684%u65F6%u5019%uFF0C%u901A%u5E38%u90FD%u662F%u901A%u8FC7XSharedPreference%u6765%u64CD%u4F5C%u3002XSharedPreference%u5728Android%u6807%u51C6%u7684SharedPreference%u7C7B%u4E0A%u5305%u4E86%u4E00%u5C42%uFF0C%u63D0%u4F9B%u4E86%u4E00%u4E9Bsecurity%u7684fix%u6216%u8005work%20around%u3002%u4F8B%u5982%uFF1AXSharedPreference.makeWorldReadable%u3002%u4ED6%u4EEC%u90FD%u662F%u52A0%u8F7Dapp%20data%u6587%u4EF6%u5939%u4E0B%u7684xml%u6587%u4EF6%u6765%u8BFB%u53D6%u3001%u5B58%u50A8%u952E%u503C%u5BF9%u7684%u3002%u8BE5%u6587%u4EF6%u8DEF%u5F84%u4E3A%uFF08%u4EE5Niwatori%u4E3A%u4F8B%uFF09%uFF1A%60/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml%60%u3002%0A%0A%u901A%u5E38Xposed%u4E2D%u5982%u4E0B%u4F7F%u7528preference%u4F1A%u6309%u7167%u5982%u4E0B%u7684%u65F6%u5E8F%u56FE%uFF0C%u4EE5Niwatori%u4E3A%u4F8B%uFF1A%0A%60%60%60%20sequence%0ANote%20left%20of%20Niwatori%3A%20initZygote%0ANote%20left%20of%20Niwatori%3A%20Construct%20a%20XSharedPreference%0ANiwatori-%3EActivity.class%3A%20hook%0AActivity.class-%3Eapp1%3A%20onCreate%0ANote%20right%20of%20app1%3A%20load%20the%20XSharedPreference%0AActivity.class-%3Eapp2%3A%20onCreate%0ANote%20right%20of%20app2%3A%20load%20the%20XSharedPreference%0A%60%60%60%0A-%20XSharedPreference%u5B9E%u4F8B%u521B%u5EFA%u5728%u6A21%u5757%u52A0%u8F7D%u7684%60initZygote%60%u4E2D%0A-%20%u6570%u636E%u7684%u4F7F%u7528%u901A%u8FC7%u94A9%u5B50%u51FD%u6570%uFF0C%u5728%u5404%u4E2Aapp%u7684Context%u5E95%u4E0B%u6267%u884C%0A%0A%u4E8E%u662F%u5F53MODE%5C_WORLD%5C_READABLE%u88AB%u5E9F%u6B62%u4EE5%u540E%uFF0C%u8FD9%u91CC%u5C31%u51FA%u95EE%u9898%u4E86%u3002%u5373%u5728%u9ED8%u8BA4%u60C5%u51B5%u4E0B%uFF0Capp1%u662F%u6CA1%u6709%u6743%u9650%u67E5%u770BNiwatori%u7684preference%u6587%u4EF6%u7684%uFF0C%u4E5F%u5C31%u6CA1%u6CD5%u52A0%u8F7D%u914D%u7F6E%u6570%u636E%u3002%0A%0AXposed%u5B98%u65B9%u6216%u8005%u4F5C%u8005rovo89%u8FD8%u6CA1%u6709%u7ED9%u51FA%u5B98%u65B9%u7684%u89E3%u51B3%u529E%u6CD5%uFF0C%u4F46%u603B%u662F%u4F1A%u6709%u4E00%u4E9B%u672A%u96E8%u7EF8%u7F2A%u7684%u52C7%u58EB%uFF0CXDA%u4E0A%u6709%u4E00%u4E2A%u5E16%u5B50%u7ED9%u51FA%u4E86%u4E00%u4E2Awork%20around%uFF1A%5BMODE_WORLD_READABLE%20in%20Android%20N%5D%28https%3A//forum.xda-developers.com/xposed/development/modeworldreadable-android-n-t3407123%29%0A%0A%u6211%u5728Niwatori%u4E2D%u4E5F%u4F7F%u7528%u4E86%u8BE5%u65B9%u6CD5%uFF0C%u4F46%u4ECD%u7136%u4E0D%u662F%u5B8C%u7F8E%u89E3%u51B3%uFF0C%u800C%u4E14%u76EE%u524D%u8FD8%u4E0D%u77E5%u9053%u5982%u4F55%u6539%u8FDB%u3002%0A%0A%23%23%20%u9057%u7559%u7684%u95EE%u9898%0A%u8BE5work%20around%u548CXSharedPreference.makeWorldReadable%u540C%u7406%uFF0C%u6211%u5982%u4E0B%u8C03%u7528preference%uFF1A%0A%60%60%60%0AmPrefs.makeWorldReadable%28%29%3B%0ALog.e%28%22Ben%22%2C%20%22package%3A%22%20+%20decorView.getContext%28%29.getPackageName%28%29%20+%20%22%2C%20%22%20+%20decorView%20+%20%22%2C%22%20+%20mPrefs.getString%28%22key_boundary_color_ms%22%2C%20%22default%20value%22%29%29%3B%0ALog.e%28%22Ben%22%2C%20%22file%20can%20read%3A%20%22%20+%20mPrefs.getFile%28%29.canRead%28%29%29%3B%20%3C--%20%u6709%u4E9Bapp%u4F1A%u662Ftrue%uFF0C%u6709%u4E9Bapp%u4F1A%u662Ffalse%0A%60%60%60%0A%u5F53%u8FD4%u56DEtrue%u7684%u65F6%u5019%uFF0Csettings%u5C31%u6210%u529F%u7684%u4F20%u5230%u4E86%u5BF9%u5E94app%u4E86%u3002%u8FD9%u4E2A%u65F6%u800C%u53EF%u4EE5read%u65F6%u800C%u4E0D%u53EF%u4EE5read%uFF0C%u6211%u4E5F%u5F88%u82E6%u607C%uFF0C%u4E0D%u77E5%u9053%u662F%u600E%u4E48%u56DE%u4E8B%u513F%u3002%u7559%u5F85%u4EE5%u540E%u518D%u89E3%u51B3%u4E86%u3002%0A%0A%23%23%20%u89E3%u51B3%u9057%u7559%u7684%u95EE%u9898%20-%2020180119%0A%u4EE5%u4E0A%u7684%u95EE%u9898%u5728%u4E8E%uFF0CAndroid%207.0%u5F00%u59CB%uFF0C%u5373%u4ECESDK%2024%u5F00%u59CB%uFF0CAndroid%u52A0%u5165%u4E86%u5F88%u591Asecurity%u65B9%u9762%u7684%u7279%u6027%uFF0C%u53C2%u8003%5BAndroid%207.0%20Security%20Features%3A%20Direct%20Boot%5D%28https%3A//blog.compass-security.com/2016/10/android-7-0-security-features-direct-boot/%29%u3002%u8FD9%u548C%u6211%u4EEC%u7684%u95EE%u9898%u4E0D%u592A%u76F8%u5173%u3002%u76F8%u5173%u7684%u662F%u5982%u4E0A%u6240%u8BF4%uFF0CNougat%u4E0D%u5141%u8BB8world%20readable%u7684%u6587%u4EF6%u4E86%u3002%u5982%u679C%u7528SDK25%u7F16%u8BD1%u7684app%u8FD8%u7528%60MODE_WORLD_READABLE%60%uFF0C%u7CFB%u7EDF%u4F1A%u62A5exception%u3002%0AGoogle%u4E0A%u9C9C%u5C11%u6709%u76F8%u5173%u7684%u89E3%u51B3%u65B9%u6848%uFF0C%u6709%u5982%u4E0B%u51E0%u4E2A%u94FE%u63A5%u53EF%u4EE5%u53C2%u8003%uFF1A%0A-%20%5BGravityBox%20commit%20-%20Use%20device%20protected%20storage%20for%20preferences%20and%20files%5D%28https%3A//github.com/GravityBox/GravityBox/commit/d825b7be445c18de9a90eb8f77c1c5eb2b74deb8%29%0A-%20%5BXposedBridge%20issue%201%20-%20Any%20place%20to%20store%20world%20readable%20preferences%20on%20Nougat%3F%5D%28https%3A//github.com/rovo89/XposedBridge/issues/206%29%0A-%20%5BXposedBridge%20issue%202%20-%20Preferences%20of%20a%20module%20cannot%20be%20read%20from%20different%20process%20on%20some%20devices%20running%20MM%5D%28https%3A//github.com/rovo89/XposedBridge/issues/74%29%0A-%20%5BXposedBridge%20issue%203%20-%20XSharedPreferences%20doesn%27t%20work%5D%28https%3A//github.com/rovo89/XposedBridge/issues/102%29%0A-%20%5B%5BQ%5D%20Xposed%20for%20nougat%20to%20read%20prefs%20ith%20fbe%20or%20without%5D%28https%3A//forum.xda-developers.com/xposed/xposed-nougat-to-read-prefs-ith-fbe-t3690048%29%0A%0A%u7ECF%u8FC7%u9A8C%u8BC1%uFF0C%u662FXposedBridge%20issue%201%u4E2DGravityBox%u4F5C%u8005%u7684%u4E00%u4E2Acomment%u63D0%u5230%u4E86%u6700%u7EC8%u7684%u89E3%u51B3%u65B9%u6CD5%u3002%u8BE5comment%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%5D%28./1516334231370.png%29%0A%u5728%u4E0A%u9762XDA%u7684%u5E16%u5B50%uFF0C%u4EE5%u53CAGravityBox%u7684commit%u4E2D%uFF0C%u6211%u4EEC%u53EF%u4EE5%u770B%u5230GravityBox%u7684%u4F5C%u8005%u91C7%u7528%u4E86Android%207.0%u4E2D%u65B0%u7684SharedPreference%u5B58%u50A8%u65B9%u5F0F%uFF0C%u5373%u901A%u8FC7%u4E0B%u9762%u4E24%u4E2A%u51FD%u6570%uFF1A%0A-%20%60setStorageDeviceProtected%60%0A-%20%60createDeviceProtectedStorageContext%60%0A%0A%u5C06preference%u6587%u4EF6%u5B58%u5230%60/data/user_de/0/%3Cpackage%20name%3E/shared_prefs%60%u4E0B%u3002%u5E76%u5728Xposed%u7684context%u7AEF%uFF0C%u76F4%u63A5%u6253%u5F00%u6587%u4EF6%u8FDB%u884C%u64CD%u4F5C%u3002%0A%u4F46%u5176%u5B9E%u6211%u4EEC%u5E76%u4E0D%u9700%u5982%u6B64%u3002%u53EA%u8981%u4FDD%u8BC1package%20folder%u7684%u6743%u9650%u81F3%u5C11%u662F711%uFF0Cpreference.xml%u6587%u4EF6%u6709%u53EF%u8BFB%u6743%u9650%u5373%u53EF%u3002%0A]]></content>
      <tags>
        <tag>Android</tag>
        <tag>xposed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[XSharedPreference & SharedPreference - XPosed模块中的preference使用]]></title>
    <url>%2F2018%2F01%2F17%2FXSharedPreference_%26_SharedPreference_-_XPosed%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84preference%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Edit&#x6700;&#x8FD1;&#x5728;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;Xposed&#x6A21;&#x5757;[]Niwatori-One Handed Mode](https://github.com/tkgktyk/Niwatori)&#x3002;&#x539F;&#x4F5C;&#x8005;tkgktyk&#x5DF2;&#x7ECF;&#x505C;&#x6B62;&#x66F4;&#x65B0;&#x4E86;&#xFF0C;&#x5BFC;&#x81F4;&#x6A21;&#x5757;&#x5728;Xposed Framework for Nougat&#x53D1;&#x5E03;&#x4EE5;&#x540E;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x3002;&#x4E8E;&#x662F;&#x6211;fork&#x4E86;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#xFF0C;&#x5F00;&#x59CB;&#x505A;Android Nougat&#x4E0A;&#x7684;&#x9002;&#x914D;&#x5DE5;&#x4F5C;&#xFF0C;&#x5E76;&#x5728;XDA&#x4E0A;&#x53D1;&#x5E03;&#x4E86;&#x66F4;&#x65B0;&#x94FE;&#x63A5;&#x3002; &#x5728;&#x9002;&#x914D;&#x4E86;Nougat&#x4E4B;&#x540E;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x66F4;&#x597D;&#x3002;&#x76EE;&#x524D;&#x60F3;&#x505A;&#x7684;&#x662F;&#x80FD;&#x901A;&#x8FC7;fooview&#x8C03;&#x7528;Niwatori&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x3002;&#x5E76;&#x4E14;&#x8BE5;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x662F;small screen&#x8FD8;&#x662F;slide down&#x7B49;&#x7B49;&#xFF0C;&#x80FD;&#x901A;&#x8FC7;Niwatori&#x672C;&#x8EAB;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;&#x4F46;&#x662F;&#x5728;&#x5F00;&#x53D1;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x52A8;&#x6001;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x52A0;&#x8F7D;&#x9700;&#x8981;&#x4F7F;&#x7528;SDK 25&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x4ECE;SDK 25&#x5F00;&#x59CB;&#xFF0C;&#x539F;&#x5148;SharedPreference&#x7684;&#x6253;&#x5F00;&#x65B9;&#x5F0F;MODE_WORLD_PRIVATE&#x5DF2;&#x7ECF;&#x88AB;&#x7981;&#x6B62;&#x4E86;&#x3002;&#x4F7F;&#x7528;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;security exception&#x3002; &#x6240;&#x4EE5;&#x8981;&#x5347;&#x5230;&#x4F7F;&#x7528;SDK 25&#xFF0C;&#x5FC5;&#x987B;&#x89E3;&#x51B3;preference&#x5F15;&#x7528;&#x7684;&#x95EE;&#x9898;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5230;&#x5E95;&#x4F1A;&#x5728;&#x54EA;&#x91CC;&#x5F71;&#x54CD;&#x5230;&#x6211;&#x4EEC;&#x7684;Xposed&#x6A21;&#x5757;&#x5462;&#xFF1F;Xposed&#x4E2D;&#x7684;preferenceXposed&#x6A21;&#x5757;&#x4E2D;&#x4F7F;&#x7528;preference&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x901A;&#x8FC7;XSharedPreference&#x6765;&#x64CD;&#x4F5C;&#x3002;XSharedPreference&#x5728;Android&#x6807;&#x51C6;&#x7684;SharedPreference&#x7C7B;&#x4E0A;&#x5305;&#x4E86;&#x4E00;&#x5C42;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;security&#x7684;fix&#x6216;&#x8005;work around&#x3002;&#x4F8B;&#x5982;&#xFF1A;XSharedPreference.makeWorldReadable&#x3002;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;&#x52A0;&#x8F7D;app data&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;xml&#x6587;&#x4EF6;&#x6765;&#x8BFB;&#x53D6;&#x3001;&#x5B58;&#x50A8;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E3A;&#xFF08;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF09;&#xFF1A;/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml&#x3002;&#x901A;&#x5E38;Xposed&#x4E2D;&#x5982;&#x4E0B;&#x4F7F;&#x7528;preference&#x4F1A;&#x6309;&#x7167;&#x5982;&#x4E0B;&#x7684;&#x65F6;&#x5E8F;&#x56FE;&#xFF0C;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF1A;XSharedPreference&#x5B9E;&#x4F8B;&#x521B;&#x5EFA;&#x5728;&#x6A21;&#x5757;&#x52A0;&#x8F7D;&#x7684;initZygote&#x4E2D;&#x6570;&#x636E;&#x7684;&#x4F7F;&#x7528;&#x901A;&#x8FC7;&#x94A9;&#x5B50;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x5404;&#x4E2A;app&#x7684;Context&#x5E95;&#x4E0B;&#x6267;&#x884C;&#x4E8E;&#x662F;&#x5F53;MODE_WORLD_READABLE&#x88AB;&#x5E9F;&#x6B62;&#x4EE5;&#x540E;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x5373;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;app1&#x662F;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x67E5;&#x770B;Niwatori&#x7684;preference&#x6587;&#x4EF6;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x6CD5;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x3002;Xposed&#x5B98;&#x65B9;&#x6216;&#x8005;&#x4F5C;&#x8005;rovo89&#x8FD8;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x5B98;&#x65B9;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x603B;&#x662F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x672A;&#x96E8;&#x7EF8;&#x7F2A;&#x7684;&#x52C7;&#x58EB;&#xFF0C;XDA&#x4E0A;&#x6709;&#x4E00;&#x4E2A;&#x5E16;&#x5B50;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;work around&#xFF1A;MODE_WORLD_READABLE in Android N&#x6211;&#x5728;Niwatori&#x4E2D;&#x4E5F;&#x4F7F;&#x7528;&#x4E86;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x4E0D;&#x662F;&#x5B8C;&#x7F8E;&#x89E3;&#x51B3;&#xFF0C;&#x800C;&#x4E14;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x6539;&#x8FDB;&#x3002;&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898;&#x8BE5;work around&#x548C;XSharedPreference.makeWorldReadable&#x540C;&#x7406;&#xFF0C;&#x6211;&#x5982;&#x4E0B;&#x8C03;&#x7528;preference&#xFF1A;mPrefs.makeWorldReadable();Log.e(&quot;Ben&quot;, &quot;package:&quot; + decorView.getContext().getPackageName() + &quot;, &quot; + decorView + &quot;,&quot; + mPrefs.getString(&quot;key_boundary_color_ms&quot;, &quot;default value&quot;));Log.e(&quot;Ben&quot;, &quot;file can read: &quot; + mPrefs.getFile().canRead()); &lt;-- &#x6709;&#x4E9B;app&#x4F1A;&#x662F;true&#xFF0C;&#x6709;&#x4E9B;app&#x4F1A;&#x662F;false&#x5F53;&#x8FD4;&#x56DE;true&#x7684;&#x65F6;&#x5019;&#xFF0C;settings&#x5C31;&#x6210;&#x529F;&#x7684;&#x4F20;&#x5230;&#x4E86;&#x5BF9;&#x5E94;app&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x800C;&#x53EF;&#x4EE5;read&#x65F6;&#x800C;&#x4E0D;&#x53EF;&#x4EE5;read&#xFF0C;&#x6211;&#x4E5F;&#x5F88;&#x82E6;&#x607C;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#x513F;&#x3002;&#x7559;&#x5F85;&#x4EE5;&#x540E;&#x518D;&#x89E3;&#x51B3;&#x4E86;&#x3002;&#x89E3;&#x51B3;&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898; - 20180119&#x4EE5;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;Android 7.0&#x5F00;&#x59CB;&#xFF0C;&#x5373;&#x4ECE;SDK 24&#x5F00;&#x59CB;&#xFF0C;Android&#x52A0;&#x5165;&#x4E86;&#x5F88;&#x591A;security&#x65B9;&#x9762;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x53C2;&#x8003;Android 7.0 Security Features: Direct Boot&#x3002;&#x8FD9;&#x548C;&#x6211;&#x4EEC;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x592A;&#x76F8;&#x5173;&#x3002;&#x76F8;&#x5173;&#x7684;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;Nougat&#x4E0D;&#x5141;&#x8BB8;world readable&#x7684;&#x6587;&#x4EF6;&#x4E86;&#x3002;&#x5982;&#x679C;&#x7528;SDK25&#x7F16;&#x8BD1;&#x7684;app&#x8FD8;&#x7528;MODE_WORLD_READABLE&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x62A5;exception&#x3002; Google&#x4E0A;&#x9C9C;&#x5C11;&#x6709;&#x76F8;&#x5173;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;GravityBox commit - Use device protected storage for preferences and filesXposedBridge issue 1 - Any place to store world readable preferences on Nougat?XposedBridge issue 2 - Preferences of a module cannot be read from different process on some devices running MMXposedBridge issue 3 - XSharedPreferences doesn&#x2019;t work[Q] Xposed for nougat to read prefs ith fbe or without&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;&#xFF0C;&#x662F;XposedBridge issue 1&#x4E2D;GravityBox&#x4F5C;&#x8005;&#x7684;&#x4E00;&#x4E2A;comment&#x63D0;&#x5230;&#x4E86;&#x6700;&#x7EC8;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;&#x8BE5;comment&#x5982;&#x4E0B;&#xFF1A;setStorageDeviceProtectedcreateDeviceProtectedStorageContext&#x5C06;preference&#x6587;&#x4EF6;&#x5B58;&#x5230;/data/user_de/0/&lt;package name&gt;/shared_prefs&#x4E0B;&#x3002;&#x5E76;&#x5728;Xposed&#x7684;context&#x7AEF;&#xFF0C;&#x76F4;&#x63A5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002; &#x4F46;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x9700;&#x5982;&#x6B64;&#x3002;&#x53EA;&#x8981;&#x4FDD;&#x8BC1;package folder&#x7684;&#x6743;&#x9650;&#x81F3;&#x5C11;&#x662F;711&#xFF0C;preference.xml&#x6587;&#x4EF6;&#x6709;&#x53EF;&#x8BFB;&#x6743;&#x9650;&#x5373;&#x53EF;&#x3002;%23%20XSharedPreference%20%26%20SharedPreference%20-%20XPosed%u6A21%u5757%u4E2D%u7684preference%u4F7F%u7528%0A@%28myblog%29%5BAndroid%2C%20xposed%5D%0A%0A%u6700%u8FD1%u5728%u7EF4%u62A4%u4E00%u4E2AXposed%u6A21%u5757%5B%5DNiwatori-One%20Handed%20Mode%5D%28https%3A//github.com/tkgktyk/Niwatori%29%u3002%u539F%u4F5C%u8005tkgktyk%u5DF2%u7ECF%u505C%u6B62%u66F4%u65B0%u4E86%uFF0C%u5BFC%u81F4%u6A21%u5757%u5728Xposed%20Framework%20for%20Nougat%u53D1%u5E03%u4EE5%u540E%uFF0C%u4E0D%u80FD%u4F7F%u7528%u3002%u4E8E%u662F%u6211fork%u4E86%u4E00%u4EFD%u4EE3%u7801%uFF0C%u5F00%u59CB%u505AAndroid%20Nougat%u4E0A%u7684%u9002%u914D%u5DE5%u4F5C%uFF0C%u5E76%u5728XDA%u4E0A%u53D1%u5E03%u4E86%u66F4%u65B0%5B%u94FE%u63A5%5D%28https%3A//forum.xda-developers.com/xposed/modules/mod-niwatori-one-handed-mode-t3730963%29%u3002%0A%u5728%u9002%u914D%u4E86Nougat%u4E4B%u540E%uFF0C%u5E0C%u671B%u80FD%u6DFB%u52A0%u4E00%u4E9B%u65B0%u529F%u80FD%uFF0C%u8BA9%u7528%u6237%u4F53%u9A8C%u66F4%u597D%u3002%u76EE%u524D%u60F3%u505A%u7684%u662F%u80FD%u901A%u8FC7fooview%u8C03%u7528Niwatori%u7684%u5FEB%u6377%u65B9%u5F0F%u3002%u5E76%u4E14%u8BE5%u5FEB%u6377%u65B9%u5F0F%u7684%u529F%u80FD%uFF0C%u4F8B%u5982%u662Fsmall%20screen%u8FD8%u662Fslide%20down%u7B49%u7B49%uFF0C%u80FD%u901A%u8FC7Niwatori%u672C%u8EAB%u8FDB%u884C%u914D%u7F6E%u3002%u4F46%u662F%u5728%u5F00%u53D1%u8FD9%u4E00%u529F%u80FD%u7684%u65F6%u5019%uFF0C%u53D1%u73B0%u52A8%u6001%u5FEB%u6377%u65B9%u5F0F%u7684%u52A0%u8F7D%u9700%u8981%u4F7F%u7528SDK%2025%u4EE5%u4E0A%u7248%u672C%uFF0C%u800C%u4ECESDK%2025%u5F00%u59CB%uFF0C%u539F%u5148SharedPreference%u7684%u6253%u5F00%u65B9%u5F0FMODE%5C_WORLD%5C_PRIVATE%u5DF2%u7ECF%u88AB%u7981%u6B62%u4E86%u3002%u4F7F%u7528%u5B83%u4F1A%u5BFC%u81F4security%20exception%u3002%0A%u6240%u4EE5%u8981%u5347%u5230%u4F7F%u7528SDK%2025%uFF0C%u5FC5%u987B%u89E3%u51B3preference%u5F15%u7528%u7684%u95EE%u9898%u3002%u90A3%u4E48%u8FD9%u4E2A%u6A21%u5F0F%u7684%u53D8%u5316%uFF0C%u5230%u5E95%u4F1A%u5728%u54EA%u91CC%u5F71%u54CD%u5230%u6211%u4EEC%u7684Xposed%u6A21%u5757%u5462%uFF1F%0A%0A%23%23%20Xposed%u4E2D%u7684preference%0AXposed%u6A21%u5757%u4E2D%u4F7F%u7528preference%u7684%u65F6%u5019%uFF0C%u901A%u5E38%u90FD%u662F%u901A%u8FC7XSharedPreference%u6765%u64CD%u4F5C%u3002XSharedPreference%u5728Android%u6807%u51C6%u7684SharedPreference%u7C7B%u4E0A%u5305%u4E86%u4E00%u5C42%uFF0C%u63D0%u4F9B%u4E86%u4E00%u4E9Bsecurity%u7684fix%u6216%u8005work%20around%u3002%u4F8B%u5982%uFF1AXSharedPreference.makeWorldReadable%u3002%u4ED6%u4EEC%u90FD%u662F%u52A0%u8F7Dapp%20data%u6587%u4EF6%u5939%u4E0B%u7684xml%u6587%u4EF6%u6765%u8BFB%u53D6%u3001%u5B58%u50A8%u952E%u503C%u5BF9%u7684%u3002%u8BE5%u6587%u4EF6%u8DEF%u5F84%u4E3A%uFF08%u4EE5Niwatori%u4E3A%u4F8B%uFF09%uFF1A%60/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml%60%u3002%0A%0A%u901A%u5E38Xposed%u4E2D%u5982%u4E0B%u4F7F%u7528preference%u4F1A%u6309%u7167%u5982%u4E0B%u7684%u65F6%u5E8F%u56FE%uFF0C%u4EE5Niwatori%u4E3A%u4F8B%uFF1A%0A%60%60%60%20sequence%0ANote%20left%20of%20Niwatori%3A%20initZygote%0ANote%20left%20of%20Niwatori%3A%20Construct%20a%20XSharedPreference%0ANiwatori-%3EActivity.class%3A%20hook%0AActivity.class-%3Eapp1%3A%20onCreate%0ANote%20right%20of%20app1%3A%20load%20the%20XSharedPreference%0AActivity.class-%3Eapp2%3A%20onCreate%0ANote%20right%20of%20app2%3A%20load%20the%20XSharedPreference%0A%60%60%60%0A-%20XSharedPreference%u5B9E%u4F8B%u521B%u5EFA%u5728%u6A21%u5757%u52A0%u8F7D%u7684%60initZygote%60%u4E2D%0A-%20%u6570%u636E%u7684%u4F7F%u7528%u901A%u8FC7%u94A9%u5B50%u51FD%u6570%uFF0C%u5728%u5404%u4E2Aapp%u7684Context%u5E95%u4E0B%u6267%u884C%0A%0A%u4E8E%u662F%u5F53MODE%5C_WORLD%5C_READABLE%u88AB%u5E9F%u6B62%u4EE5%u540E%uFF0C%u8FD9%u91CC%u5C31%u51FA%u95EE%u9898%u4E86%u3002%u5373%u5728%u9ED8%u8BA4%u60C5%u51B5%u4E0B%uFF0Capp1%u662F%u6CA1%u6709%u6743%u9650%u67E5%u770BNiwatori%u7684preference%u6587%u4EF6%u7684%uFF0C%u4E5F%u5C31%u6CA1%u6CD5%u52A0%u8F7D%u914D%u7F6E%u6570%u636E%u3002%0A%0AXposed%u5B98%u65B9%u6216%u8005%u4F5C%u8005rovo89%u8FD8%u6CA1%u6709%u7ED9%u51FA%u5B98%u65B9%u7684%u89E3%u51B3%u529E%u6CD5%uFF0C%u4F46%u603B%u662F%u4F1A%u6709%u4E00%u4E9B%u672A%u96E8%u7EF8%u7F2A%u7684%u52C7%u58EB%uFF0CXDA%u4E0A%u6709%u4E00%u4E2A%u5E16%u5B50%u7ED9%u51FA%u4E86%u4E00%u4E2Awork%20around%uFF1A%5BMODE_WORLD_READABLE%20in%20Android%20N%5D%28https%3A//forum.xda-developers.com/xposed/development/modeworldreadable-android-n-t3407123%29%0A%0A%u6211%u5728Niwatori%u4E2D%u4E5F%u4F7F%u7528%u4E86%u8BE5%u65B9%u6CD5%uFF0C%u4F46%u4ECD%u7136%u4E0D%u662F%u5B8C%u7F8E%u89E3%u51B3%uFF0C%u800C%u4E14%u76EE%u524D%u8FD8%u4E0D%u77E5%u9053%u5982%u4F55%u6539%u8FDB%u3002%0A%0A%23%23%20%u9057%u7559%u7684%u95EE%u9898%0A%u8BE5work%20around%u548CXSharedPreference.makeWorldReadable%u540C%u7406%uFF0C%u6211%u5982%u4E0B%u8C03%u7528preference%uFF1A%0A%60%60%60%0AmPrefs.makeWorldReadable%28%29%3B%0ALog.e%28%22Ben%22%2C%20%22package%3A%22%20+%20decorView.getContext%28%29.getPackageName%28%29%20+%20%22%2C%20%22%20+%20decorView%20+%20%22%2C%22%20+%20mPrefs.getString%28%22key_boundary_color_ms%22%2C%20%22default%20value%22%29%29%3B%0ALog.e%28%22Ben%22%2C%20%22file%20can%20read%3A%20%22%20+%20mPrefs.getFile%28%29.canRead%28%29%29%3B%20%3C--%20%u6709%u4E9Bapp%u4F1A%u662Ftrue%uFF0C%u6709%u4E9Bapp%u4F1A%u662Ffalse%0A%60%60%60%0A%u5F53%u8FD4%u56DEtrue%u7684%u65F6%u5019%uFF0Csettings%u5C31%u6210%u529F%u7684%u4F20%u5230%u4E86%u5BF9%u5E94app%u4E86%u3002%u8FD9%u4E2A%u65F6%u800C%u53EF%u4EE5read%u65F6%u800C%u4E0D%u53EF%u4EE5read%uFF0C%u6211%u4E5F%u5F88%u82E6%u607C%uFF0C%u4E0D%u77E5%u9053%u662F%u600E%u4E48%u56DE%u4E8B%u513F%u3002%u7559%u5F85%u4EE5%u540E%u518D%u89E3%u51B3%u4E86%u3002%0A%0A%23%23%20%u89E3%u51B3%u9057%u7559%u7684%u95EE%u9898%20-%2020180119%0A%u4EE5%u4E0A%u7684%u95EE%u9898%u5728%u4E8E%uFF0CAndroid%207.0%u5F00%u59CB%uFF0C%u5373%u4ECESDK%2024%u5F00%u59CB%uFF0CAndroid%u52A0%u5165%u4E86%u5F88%u591Asecurity%u65B9%u9762%u7684%u7279%u6027%uFF0C%u53C2%u8003%5BAndroid%207.0%20Security%20Features%3A%20Direct%20Boot%5D%28https%3A//blog.compass-security.com/2016/10/android-7-0-security-features-direct-boot/%29%u3002%u8FD9%u548C%u6211%u4EEC%u7684%u95EE%u9898%u4E0D%u592A%u76F8%u5173%u3002%u76F8%u5173%u7684%u662F%u5982%u4E0A%u6240%u8BF4%uFF0CNougat%u4E0D%u5141%u8BB8world%20readable%u7684%u6587%u4EF6%u4E86%u3002%u5982%u679C%u7528SDK25%u7F16%u8BD1%u7684app%u8FD8%u7528%60MODE_WORLD_READABLE%60%uFF0C%u7CFB%u7EDF%u4F1A%u62A5exception%u3002%0AGoogle%u4E0A%u9C9C%u5C11%u6709%u76F8%u5173%u7684%u89E3%u51B3%u65B9%u6848%uFF0C%u6709%u5982%u4E0B%u51E0%u4E2A%u94FE%u63A5%u53EF%u4EE5%u53C2%u8003%uFF1A%0A-%20%5BGravityBox%20commit%20-%20Use%20device%20protected%20storage%20for%20preferences%20and%20files%5D%28https%3A//github.com/GravityBox/GravityBox/commit/d825b7be445c18de9a90eb8f77c1c5eb2b74deb8%29%0A-%20%5BXposedBridge%20issue%201%20-%20Any%20place%20to%20store%20world%20readable%20preferences%20on%20Nougat%3F%5D%28https%3A//github.com/rovo89/XposedBridge/issues/206%29%0A-%20%5BXposedBridge%20issue%202%20-%20Preferences%20of%20a%20module%20cannot%20be%20read%20from%20different%20process%20on%20some%20devices%20running%20MM%5D%28https%3A//github.com/rovo89/XposedBridge/issues/74%29%0A-%20%5BXposedBridge%20issue%203%20-%20XSharedPreferences%20doesn%27t%20work%5D%28https%3A//github.com/rovo89/XposedBridge/issues/102%29%0A-%20%5B%5BQ%5D%20Xposed%20for%20nougat%20to%20read%20prefs%20ith%20fbe%20or%20without%5D%28https%3A//forum.xda-developers.com/xposed/xposed-nougat-to-read-prefs-ith-fbe-t3690048%29%0A%0A%u7ECF%u8FC7%u9A8C%u8BC1%uFF0C%u662FXposedBridge%20issue%201%u4E2DGravityBox%u4F5C%u8005%u7684%u4E00%u4E2Acomment%u63D0%u5230%u4E86%u6700%u7EC8%u7684%u89E3%u51B3%u65B9%u6CD5%u3002%u8BE5comment%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%5D%28./1516334231370.png%29%0A%u5728%u4E0A%u9762XDA%u7684%u5E16%u5B50%uFF0C%u4EE5%u53CAGravityBox%u7684commit%u4E2D%uFF0C%u6211%u4EEC%u53EF%u4EE5%u770B%u5230GravityBox%u7684%u4F5C%u8005%u91C7%u7528%u4E86Android%207.0%u4E2D%u65B0%u7684SharedPreference%u5B58%u50A8%u65B9%u5F0F%uFF0C%u5373%u901A%u8FC7%u4E0B%u9762%u4E24%u4E2A%u51FD%u6570%uFF1A%0A-%20%60setStorageDeviceProtected%60%0A-%20%60createDeviceProtectedStorageContext%60%0A%0A%u5C06preference%u6587%u4EF6%u5B58%u5230%60/data/user_de/0/%3Cpackage%20name%3E/shared_prefs%60%u4E0B%u3002%u5E76%u5728Xposed%u7684context%u7AEF%uFF0C%u76F4%u63A5%u6253%u5F00%u6587%u4EF6%u8FDB%u884C%u64CD%u4F5C%u3002%0A%u4F46%u5176%u5B9E%u6211%u4EEC%u5E76%u4E0D%u9700%u5982%u6B64%u3002%u53EA%u8981%u4FDD%u8BC1package%20folder%u7684%u6743%u9650%u81F3%u5C11%u662F711%uFF0Cpreference.xml%u6587%u4EF6%u6709%u53EF%u8BFB%u6743%u9650%u5373%u53EF%u3002%0A]]></content>
      <tags>
        <tag>Android</tag>
        <tag>xposed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Deep Learning (1) - Neural Network with 1 Hidden Layer]]></title>
    <url>%2F2017%2F12%2F15%2FDeep_Learning_(1)_-_Neural_Network_with_1_Hidden_Layer%2F</url>
    <content type="text"><![CDATA[Edit&#x5728;&#x4E4B;&#x524D;&#x5B66;&#x4E60;Andrew NG&#x7684;Coursera&#x8BFE;&#x7A0B;&#x300A;Machine Learning&#x300B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9488;&#x5BF9;Neural Network&#x505A;&#x8FC7;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;&#xFF1A;Machine Learning (2) - Neural Network&#x3002;&#x5F53;&#x65F6;&#x901A;&#x8FC7;&#x5B66;&#x4E60;&#x77E5;&#x9053;&#x4E86;&#x5982;&#x4F55;&#x8BA1;&#x7B97;2&#x5C42;&#xFF08;1&#x4E2A;&#x9690;&#x85CF;&#x5C42;&#xFF09;Neural Network&#x7684;&#x504F;&#x5BFC;&#x6570;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x7406;&#x89E3;&#x53EA;&#x662F;&#x5C40;&#x9650;&#x4E8E;&#x4E00;&#x5806;&#x516C;&#x5F0F;&#xFF0C;&#x4E0D;&#x591F;&#x6DF1;&#x523B;&#x3002;&#x8FD9;&#x6B21;&#x5728;&#x5B66;&#x4E60;Andrew NG&#x7684;Deep Learning&#x8BFE;&#x7A0B;&#x65F6;&#xFF0C;Andrew&#x5728;&#x4ECB;&#x7ECD;&#x6DF1;&#x5C42;&#x7F51;&#x7EDC;&#x4E4B;&#x524D;&#x4E5F;&#x4ECB;&#x7ECD;&#x4E86;&#x6D45;&#x5C42;&#x7F51;&#x7EDC;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#xFF0C;&#x5305;&#x62EC;&#x5BFC;&#x6570;&#x516C;&#x5F0F;&#x7684;&#x63A8;&#x5BFC;&#x3002;&#x6211;&#x73B0;&#x5728;&#x7EC8;&#x4E8E;&#x7406;&#x89E3;&#x4E86;&#x8FD9;&#x4E9B;&#x516C;&#x5F0F;&#x662F;&#x5982;&#x4F55;&#x6765;&#x7684;&#x4E86;&#x3002;&#x5BF9;&#x6BD4;&#x4E86;&#x4E4B;&#x524D;Machine Learning&#x7684;&#x8BFE;&#x4EF6;&#x548C;&#x7B14;&#x8BB0;&#xFF0C;&#x6211;&#x8BA4;&#x4E3A;&#x6B64;&#x6B21;&#x8BFE;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x7B26;&#x53F7;&#x6807;&#x8BB0;&#x65B9;&#x5F0F;&#x66F4;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x548C;&#x63A8;&#x5BFC;&#x3002; &#x5728;&#x8FD9;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;&#x4E2D;&#xFF0C;&#x6211;&#x4F1A;&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x6D45;&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;forward propagation &amp; backward propagation&#x8BA1;&#x7B97;&#x65B9;&#x6CD5;&#x3002;Forward PropagationBackward Propagation&#x5728;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x5B66;&#x4E60;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x80FD;&#x542C;&#x5230;&#x8FD9;&#x4E2A;&#x8BCD;&#x6C47;&#x3002;&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7384;&#x4E4E;&#xFF0C;&#x5176;&#x5B9E;&#x4ED6;&#x5E76;&#x4E0D;&#x795E;&#x79D8;&#x3002; Backward Propagation&#xFF0C;&#x4E2D;&#x6587;&#x7FFB;&#x8BD1;&#x4E3A;&#x53CD;&#x5411;&#x4F20;&#x64AD;&#x3002;&#x5B83;&#x662F;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x5BFC;&#x6570;&#x7684;&#x3002;&#x4E0B;&#x56FE;&#x4E3A;Logistic Regression&#x7684;&#x8BA1;&#x7B97;&#x56FE;&#xFF1A;&#x4E0A;&#x5F0F;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x6C42;&#x5BFC;&#x6570;&#x65F6;&#x6700;&#x5E38;&#x7528;&#x5230;&#x7684;&#x94FE;&#x5F0F;&#x6CD5;&#x5219;(chain rule)&#x3002;&#x82E5; &#x5219;&#x6709;&#x4E0B;&#x56FE;&#xFF1A;&#x7EA0;&#x9519;&#x4E0A;&#x56FE;&#x5E94;&#x4E3A;&#x5E94;&#x4E3A;&#x5148;&#x770B;Andrew&#x7ED9;&#x51FA;&#x7684;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#xFF1A;sigmoid&#x51FD;&#x6570;&#x7684;&#x5BFC;&#x6570;&#x4E3A;: &#x800C;&#x5176;&#x4ED6;&#x7684;&#x9690;&#x85CF;&#x5C42;&#x91C7;&#x7528;&#x4E3A;&#x5176;&#x6FC0;&#x6D3B;&#x51FD;&#x6570;&#xFF0C;&#x5373;&#x6709;&#x53EF;&#x80FD;&#x662F;tanh&#x6216;&#x8005;ReLU&#xFF0C;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x662F;sigmoid&#x3002;&#x5206;&#x6B65;&#x6C42;&#x5BFC;&#x635F;&#x5931;&#x51FD;&#x6570; &#x5176;&#x5BFC;&#x6570;&#x4E3A;&#xFF1A; &#x4EE3;&#x5165;&#xFF1A; &#x4EE3;&#x5165;&#xFF0C;&#x53EF;&#x5F97;&#xFF1A; &#x4EE3;&#x5165;&#xFF0C;&#x53EF;&#x5F97;&#xFF1A; &#x8FD9;&#x4E2A;&#x5C31;&#x5F88;&#x7B80;&#x5355;&#x4E86; &#x81F3;&#x6B64;&#x5168;&#x90E8;&#x5F97;&#x8BC1;&#x3002;&#x77E9;&#x9635;&#x6C42;&#x5BFC;&#x5728;&#x8BA1;&#x7B97;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x77E9;&#x9635;&#x6C42;&#x5BFC;&#x7684;&#x95EE;&#x9898;&#x3002;&#x662F;&#x5217;&#x5411;&#x91CF;&#xFF0C;&#x662F;&#x578B;&#x77E9;&#x9635;&#xFF0C;&#x662F;&#x5217;&#x5411;&#x91CF;&#x3002; &#x7F51;&#x4E0A;&#x641C;&#x5230;&#x7684;&#x77E9;&#x9635;&#x6C42;&#x5BFC;&#x65B9;&#x6CD5;&#x7684;&#x5E16;&#x5B50;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x90FD;&#x6CA1;&#x6709;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x91CA;&#x4E3A;&#x4EC0;&#x4E48;&#x3002; &#x6839;&#x636E;&#x6211;&#x81EA;&#x5DF1;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x4E2A;&#x5217;&#x5411;&#x91CF;&#x3002;&#x5173;&#x4E8E;&#x7684;&#x5BFC;&#x6570;&#x5C31;&#x662F;&#x5BF9;&#x6240;&#x6709;&#x5217;&#x5411;&#x91CF;&#x7684;&#x5BFC;&#x6570;&#x7684;stack&#x3002; &#x56E0;&#x4E3A; &#x6240;&#x4EE5; stack&#x5230;&#x4E00;&#x5757;&#x513F;&#x5C31;&#x662F; &#x6240;&#x4EE5;&#x5F97;&#x8BC1;&#x3002; VectorizationForward propagation Backward propagation np.sum(A, axis=1, keepdims=True) &#x6C42;&#x53D6;&#x77E9;&#x9635;A&#x5404;&#x884C;&#x7684;&#x548C; axis: =1 &#x6309;&#x884C;&#x6C42;&#x548C;&#xFF0C;=0 &#x6309;&#x5217;&#x6C42;&#x548C;&#xFF0C;&#x6CA1;&#x6709;axis&#x5219;&#x5168;&#x77E9;&#x9635;&#x6C42;&#x548C; keepdims: =True &#x6C42;&#x548C;&#x51FA;&#x6765;&#x540E;&#x4ECD;&#x7136;&#x4FDD;&#x5B58;&#x77E9;&#x9635;&#x7ED3;&#x6784;&#xFF0C;&#x5373;&#x6309;&#x884C;&#x6C42;&#x548C;&#xFF0C;&#x5219;&#x5F97;&#x5230;&#x5217;&#x5411;&#x91CF;&#xFF0C;&#x6309;&#x5217;&#x6C42;&#x548C;&#x5F97;&#x5230;&#x884C;&#x5411;&#x91CF;&#xFF0C;&#x5168;&#x77E9;&#x9635;&#x6C42;&#x548C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;1x1&#x77E9;&#x9635;&#x3002;&#x5206;&#x6790;&#x5148;&#x770B;single training example: &#x8BAD;&#x7EC3;&#x6837;&#x672C;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;stack&#xFF0C;&#x4E5F;&#x7C7B;&#x4F3C;&#x53EF;&#x5F97;&#x5982;&#x4E0B;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x662F;? &#x6700;&#x76F4;&#x89C2;&#x7684;b&#x5E94;&#x8BE5;&#x662F;&#xFF0C;&#x56E0;&#x4E3A; &#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6309;&#x7167;&#x884C;&#x6C42;&#x548C;&#x518D;&#x6309;m&#x6C42;&#x5747;&#x503C;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x4E3A;&#x6A21;&#x578B;&#x53C2;&#x6570;&#xFF0C;&#x4E0E;&#x6837;&#x672C;&#x65E0;&#x5173;&#x3002;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x6837;&#x672C;b, db&#x5E94;&#x5F53;&#x76F8;&#x540C;&#x3002;&#x6240;&#x4EE5;&#x8981;&#x6309;&#x4E0A;&#x9762;&#x8FD9;&#x4E48;&#x7B97;&#x3002;&#x603B;&#x7ED3;&#x5728;&#x6D45;&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x6B63;&#x5411;&#x4F20;&#x64AD;&#x6C42;&#x8282;&#x70B9;&#x503C;&#xFF0C;&#x53CD;&#x5411;&#x4F20;&#x64AD;&#x5229;&#x7528;&#x94FE;&#x5F0F;&#x6CD5;&#x5219;&#x6C42;&#x5BFC;&#x6570;&#x3002;&#x5728;&#x5411;&#x91CF;&#x5316;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9488;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x6837;&#x672C;&#xFF0C;&#x5411;&#x91CF;&#x6309;&#x7167;&#x5217;&#x7EC4;&#x5408;&#x6210;&#x77E9;&#x9635;&#xFF0C;&#x5373;&#x77E9;&#x9635;&#x7684;&#x4E00;&#x5217;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6837;&#x672C;&#x3002;%23%20Deep%20Learning%20%281%29%20-%20Neural%20Network%20with%201%20Hidden%20Layer%0A@%28myblog%29%5Bdeep%20learning%2C%20neural%20network%5D%0A%0A%u5728%u4E4B%u524D%u5B66%u4E60Andrew%20NG%u7684Coursera%u8BFE%u7A0B%u300AMachine%20Learning%u300B%u7684%u65F6%u5019%uFF0C%u9488%u5BF9Neural%20Network%u505A%u8FC7%u4E00%u7BC7%u7B14%u8BB0%uFF1A%5BMachine%20Learning%20%282%29%20-%20Neural%20Network%5D%28https%3A//zhougy0717.github.io/2017/04/03/Machine%2520Learning%2520%282%29%2520-%2520Neural%2520Network/%29%u3002%u5F53%u65F6%u901A%u8FC7%u5B66%u4E60%u77E5%u9053%u4E86%u5982%u4F55%u8BA1%u7B972%u5C42%uFF081%u4E2A%u9690%u85CF%u5C42%uFF09Neural%20Network%u7684%u504F%u5BFC%u6570%u95EE%u9898%u3002%u4F46%u662F%u7406%u89E3%u53EA%u662F%u5C40%u9650%u4E8E%u4E00%u5806%u516C%u5F0F%uFF0C%u4E0D%u591F%u6DF1%u523B%u3002%u8FD9%u6B21%u5728%u5B66%u4E60Andrew%20NG%u7684Deep%20Learning%u8BFE%u7A0B%u65F6%uFF0CAndrew%u5728%u4ECB%u7ECD%u6DF1%u5C42%u7F51%u7EDC%u4E4B%u524D%u4E5F%u4ECB%u7ECD%u4E86%u6D45%u5C42%u7F51%u7EDC%u7684%u57FA%u672C%u539F%u7406%uFF0C%u5305%u62EC%u5BFC%u6570%u516C%u5F0F%u7684%u63A8%u5BFC%u3002%u6211%u73B0%u5728%u7EC8%u4E8E%u7406%u89E3%u4E86%u8FD9%u4E9B%u516C%u5F0F%u662F%u5982%u4F55%u6765%u7684%u4E86%u3002%u5BF9%u6BD4%u4E86%u4E4B%u524DMachine%20Learning%u7684%u8BFE%u4EF6%u548C%u7B14%u8BB0%uFF0C%u6211%u8BA4%u4E3A%u6B64%u6B21%u8BFE%u7A0B%u4E2D%u4F7F%u7528%u7684%u7B26%u53F7%u6807%u8BB0%u65B9%u5F0F%u66F4%u5BB9%u6613%u7406%u89E3%u548C%u63A8%u5BFC%u3002%0A%u5728%u8FD9%u4E00%u7BC7%u7B14%u8BB0%u4E2D%uFF0C%u6211%u4F1A%u4E3B%u8981%u8BB0%u5F55%u6D45%u5C42%u795E%u7ECF%u7F51%u7EDC%u7684forward%20propagation%20%26%20backward%20propagation%u8BA1%u7B97%u65B9%u6CD5%u3002%0A%0A%23%23%20Forward%20Propagation%0A%21%5BAlt%20text%5D%28./1513332445189.png%29%0A%u524D%u5411%u4F20%u64AD%u8BA1%u7B97%u6BCF%u4E2A%u8282%u70B9%u7684%u503C%uFF0C%u540E%u9762%u7684%u53CD%u5411%u4F20%u64AD%u4E2D%u4F1A%u7528%u5230%u3002%0A%21%5BAlt%20text%5D%28./1513574653750.png%29%0A%23%23%20Backward%20Propagation%0A%u5728%u795E%u7ECF%u7F51%u7EDC%u7684%u5B66%u4E60%u4E2D%uFF0C%u6211%u4EEC%u5F80%u5F80%u80FD%u542C%u5230%u8FD9%u4E2A%u8BCD%u6C47%u3002%u542C%u8D77%u6765%u5F88%u7384%u4E4E%uFF0C%u5176%u5B9E%u4ED6%u5E76%u4E0D%u795E%u79D8%u3002%0ABackward%20Propagation%uFF0C%u4E2D%u6587%u7FFB%u8BD1%u4E3A%u53CD%u5411%u4F20%u64AD%u3002%u5B83%u662F%u7528%u6765%u8BA1%u7B97%u5BFC%u6570%u7684%u3002%u4E0B%u56FE%u4E3ALogistic%20Regression%u7684%u8BA1%u7B97%u56FE%uFF1A%0A%21%5BAlt%20text%7C500x0%5D%28./1513330613563.png%29%0A%u6309%u7167%u6C42%u5BFC%u516C%u5F0F%u53EF%u77E5%uFF1A%0A%24%24%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20%5Comega%7D%20%3D%20%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20a%7D%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20a%7D%7B%5Cpartial%20z%7D%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20z%7D%7B%5Cpartial%20%5Comega%7D%24%24%0A%u4E0A%u5F0F%u4E5F%u662F%u6211%u4EEC%u5728%u6C42%u5BFC%u6570%u65F6%u6700%u5E38%u7528%u5230%u7684%u94FE%u5F0F%u6CD5%u5219%28chain%20rule%29%u3002%u82E5%0A%24da%20%3D%20%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20a%7D%24%0A%24dz%20%3D%20%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20z%7D%20%3D%20da%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20a%7D%7B%5Cpartial%20z%7D%24%0A%24d%20%5Comega%20%3D%20%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20%5Comega%7D%20%3D%20dz%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20a%7D%7B%5Cpartial%20%5Comega%7D%24%0A%u5219%u6709%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%7C550x0%5D%28./1513331905347.png%29%0A%u8FD9%u5C31%u662F%u6240%u8C13%u7684%u53CD%u5411%u4F20%u64AD%28Backward%20Propagation%29%u3002%u524D%u4E00%u5C42%u4E3A%u540E%u4E00%u5C42%u63D0%u4F9B%u8FDB%u4E00%u6B65%u8BA1%u7B97%u5BFC%u6570%u7684%u4FE1%u606F%u3002%0A%u63A8%u8FDB%u52302%u5C42%u795E%u7ECF%u7F51%u7EDC%uFF0C%u5C31%u8981%u591A%u7B97%u4E00%u5C42%uFF1A%0A%21%5BAlt%20text%5D%28./1513332172423.png%29%0A%0A%3E**%u7EA0%u9519**%0A-%20%u4E0A%u56FE%24z%5E%7B%5B2%5D%7D%24%u5E94%u4E3A%24%5Comega%5E%7B%5B2%5D%7Da%5E%7B%5B1%5D%7D%20+%20b%5E%7B%5B2%5D%7D%24%0A-%20%24a%5E%7B%5B1%5D%7D%24%u5E94%u4E3A%24g%5E%7B%5B1%5D%7D%28z%5E%7B%5B1%5D%7D%29%24%0A%0A%u5148%u770BAndrew%u7ED9%u51FA%u7684%u8BA1%u7B97%u7ED3%u679C%uFF1A%0A%21%5BAlt%20text%7C280x0%5D%28./1513332236320.png%29%0A%u5982%u679C%u76F4%u63A5%u81EA%u5DF1%u53BB%u7B97%u4F1A%u6709%u4E00%u4E9B%u7591%u95EE%u3002%u8981%u7B97%u51FA%u8FD9%u4E2A%u7ED3%u679C%uFF0C%u5176%u5B9E%u662F%u6709%u4E00%u4E9B%u524D%u63D0%u7684%u3002%0A%21%5BAlt%20text%5D%28./1513332445189.png%29%0A%u5728%u8F93%u51FA%u5C42%uFF0C%u5373%24a%5E%7B%5B2%5D%7D%24%u5C42%uFF0C%u91C7%u7528sigmoid%u6FC0%u6D3B%u51FD%u6570%uFF0C%u5373%0A%24%24a%5E%7B%5B2%5D%7D%20%3D%20%5Csigma%28z%5E%7B%5B2%5D%7D%29%20%3D%20%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-z%7D%7D%24%24%0Asigmoid%u51FD%u6570%u7684%u5BFC%u6570%u4E3A%3A%0A%24%24%5Cdfrac%20%7Bda%7D%7Bdz%7D%20%3D%20%5Cdfrac%20%7Be%5E%7B-z%7D%7D%7B%281+e%5E%7B-z%7D%29%5E2%7D%20%3D%20%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-z%7D%7D%20-%20%5Cdfrac%20%7B1%7D%7B%281+e%5E%7B-z%7D%29%5E2%7D%20%3D%20a%281-a%29%24%24%0A%u800C%u5176%u4ED6%u7684%u9690%u85CF%u5C42%u91C7%u7528%24g%5E%7B%5Bi%5D%7D%28%29%24%u4E3A%u5176%u6FC0%u6D3B%u51FD%u6570%uFF0C%u5373%u6709%u53EF%u80FD%u662Ftanh%u6216%u8005ReLU%uFF0C%u4E5F%u6709%u53EF%u80FD%u662Fsigmoid%u3002%0A%0A%23%23%23%20%u5206%u6B65%u6C42%u5BFC%0A%23%23%23%20%24dz%5E%7B%5B2%5D%7D%24%0A%u635F%u5931%u51FD%u6570%0A%24%24L%20%3D%20-%28ylog%20a%5E%7B%5B2%5D%7D%20+%20%281-y%29log%20%281-a%5E%7B%5B2%5D%7D%29%29%24%24%0A%u5176%u5BFC%u6570%u4E3A%uFF1A%0A%24%24%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20a%7D%20%3D%20-%5Cdfrac%20%7By%7D%7Ba%5E%7B%5B2%5D%7D%7D%20-%20%5Cdfrac%20%7B1-y%7D%7B1-a%5E%7B%5B2%5D%7D%7D%24%24%0A%u4EE3%u5165%uFF1A%0A%24%24dz%5E%7B%5B2%5D%7D%20%3D%20%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20a%7D%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20a%7D%7B%5Cpartial%20z%7D%20%3D%20a%5E%7B%5B2%5D%7D%281-a%5E%7B%5B2%5D%7D%29%28-%5Cdfrac%20%7By%7D%7Ba%5E%7B%5B2%5D%7D%7D%20-%20%5Cdfrac%20%7B1-y%7D%7B1-a%5E%7B%5B2%5D%7D%7D%29%20%3D%20a%5E%7B%5B2%5D%7D%20-%20y%24%24%0A%0A%0A%0A%23%23%23%23%20%24d%5Comega%5E%7B%5B2%5D%7D%20%2C%20b%5E%7B%5B2%5D%7D%24%0A%24%24d%5Comega%5E%7B%5B2%5D%7D%20%3D%20%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%7B%5Cpartial%20%5Comega%5E%7B%5B2%5D%7D%7D%20%3D%20dz%5E%7B%5B2%5D%7Da%5E%7B%5B1%5DT%7D%24%24%0A%24%24db%5E%7B%5B2%5D%7D%20%3D%20%5Cdfrac%20%7B%5Cpartial%20L%7D%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%7B%5Cpartial%20b%5E%7B%5B2%5D%7D%7D%20%3D%20dz%5E%7B%5B2%5D%7D%24%24%0A%0A%23%23%23%23%20%24da%5E%7B%5B1%5D%7D%24%0A%24%24da%5E%7B%5B1%5D%7D%20%3D%20dz%5E%7B%5B2%5D%7D%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%7B%5Cpartial%20a%5E%7B%5B1%5D%7D%7D%24%24%0A%u4EE3%u5165%24%5Cdfrac%20%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%7B%5Cpartial%20a%5E%7B%5B1%5D%7D%7D%20%3D%20%5Comega%5E%7B%5B2%5DT%7D%24%uFF0C%u53EF%u5F97%uFF1A%0A%24%24da%5E%7B%5B1%5D%7D%20%3D%20%5Comega%5E%7B%5B2%5DT%7D%20dz%5E%7B%5B2%5D%7D%24%24%0A%0A%0A%23%23%23%23%20%24dz%5E%7B%5B1%5D%7D%24%0A%24%24dz%5E%7B%5B1%5D%7D%20%3D%20da%5E%7B%5B1%5D%7D%20%5Ccenterdot%20%5Cdfrac%20%7B%5Cpartial%20a%7D%7B%5Cpartial%20z%5E%7B%5B1%5D%7D%7D%24%24%0A%u4EE3%u5165%24%5Cdfrac%20%7B%5Cpartial%20a%7D%7B%5Cpartial%20z%5E%7B%5B1%5D%7D%7D%20%3D%20g%5E%7B%5B1%5D%7D%5Cprime%20%28z%5E%7B%5B1%5D%7D%29%24%uFF0C%u53EF%u5F97%uFF1A%0A%24%24dz%5E%7B%5B1%5D%7D%20%3D%20%5Comega%5E%7B%5B2%5DT%7D%20dz%5E%7B%5B2%5D%7D%20*g%5E%7B%5B1%5D%7D%5Cprime%20%28z%5E%7B%5B1%5D%7D%29%24%24%0A%0A%23%23%23%23%20%24d%5Comega%5E%7B%5B1%5D%7D%20%2C%20db%5E%7B%5B1%5D%7D%24%0A%u8FD9%u4E2A%u5C31%u5F88%u7B80%u5355%u4E86%0A%24%24d%5Comega%5E%7B%5B1%5D%7D%20%3D%20dz%5E%7B%5B1%5D%7Dx%24%24%0A%24%24db%5E%7B%5B1%5D%7D%20%3D%20dz%5E%7B%5B1%5D%7D%24%24%0A%0A%u81F3%u6B64%u5168%u90E8%u5F97%u8BC1%u3002%0A%0A%23%23%23%20%u77E9%u9635%u6C42%u5BFC%0A%u5728%u8BA1%u7B97%24da%5E%7B%5B1%5D%7D%24%u7684%u65F6%u5019%uFF0C%u4F1A%u53D1%u73B0%u8FD9%u91CC%u6709%u4E00%u4E2A%u77E9%u9635%u6C42%u5BFC%u7684%u95EE%u9898%u3002%24z%5E%7B%5B2%5D%7D%24%u662F%u5217%u5411%u91CF%uFF0C%24%5Comega%20%5E%7B%5B2%5D%7D%24%u662F%24n%5E%7B%5B2%5D%7D%5Ctimes%20n%5E%7B%5B1%5D%7D%24%u578B%u77E9%u9635%uFF0C%24a%5E%7B%5B1%5D%7D%24%u662F%u5217%u5411%u91CF%u3002%0A%u7F51%u4E0A%u641C%u5230%u7684%u77E9%u9635%u6C42%u5BFC%u65B9%u6CD5%u7684%u5E16%u5B50%u6709%u5F88%u591A%uFF0C%u4F46%u90FD%u6CA1%u6709%u5F88%u597D%u7684%u89E3%u91CA%u4E3A%u4EC0%u4E48%24%5Cdfrac%20%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%7B%5Cpartial%20%5Comega%5E%7B%5B2%5D%7D%7D%20%3D%20a%5E%7B%5B1%5DT%7D%24%u3002%0A%u6839%u636E%u6211%u81EA%u5DF1%u7684%u7406%u89E3%uFF0C%24%5Comega%20%5E%7B%5B2%5D%7D%24%u53EF%u4EE5%u770B%u4F5C%24n%5E%7B%5B1%5D%7D%24%u4E2A%u5217%u5411%u91CF%u3002%24z%5E%7B%5B2%5D%7D%24%u5173%u4E8E%24%5Comega%5E%7B%5B2%5D%7D%24%u7684%u5BFC%u6570%u5C31%u662F%u5BF9%u6240%u6709%u5217%u5411%u91CF%u7684%u5BFC%u6570%u7684stack%u3002%0A%u56E0%u4E3A%0A%24%24z_%7B%28i%29%7D%20%3D%20%5CSigma_%7Bj%3D0%7D%5E%7Bn%5E%7B%5B1%5D%7D-1%7D%20%5Comega_%7B%28i%29%28j%29%7Da_%7B%28j%29%7D%24%24%0A%u6240%u4EE5%0A%24%24%5Cdfrac%20%7B%5Cpartial%20z%5E%7B%5B2%5D%7D%7D%7B%5Cpartial%20%5Comega_%7B%28j%29%7D%7D%20%3D%20a_%7B%28j%29%7D%24%24%0Astack%u5230%u4E00%u5757%u513F%u5C31%u662F%24%5Ba_%7B%280%29%7D%2C%20a_%7B%281%29%7D...a_%7B%28n-1%29%7D%5D%20%3D%20a%5ET%24%0A%u6240%u4EE5%u5F97%u8BC1%u3002%20%0A%0A%23%23%23%20Vectorization%0A%0A%0A%0A%0A%23%23%23%23%20Forward%20propagation%0A%24Z%5E%7B%5B1%5D%7D%20%3D%20W%5E%7B%5B1%5D%7DX%20+%20b%5E%7B%5B1%5D%7D%24%0A%24A%5E%7B%5B1%5D%7D%20%3D%20g%5E%7B%5B1%5D%7D%28Z%5E%7B%5B1%5D%7D%29%24%0A%24Z%5E%7B%5B2%5D%7D%20%3D%20W%5E%7B%5B2%5D%7DA%5E%7B%5B1%5D%7D%20+%20b%5E%7B%5B2%5D%7D%24%0A%24A%5E%7B%5B2%5D%7D%20%3D%20g%5E%7B%5B2%5D%7D%28Z%5E%7B%5B2%5D%7D%29%20%3D%20%5Csigma%28Z%5E%7B%5B2%5D%7D%29%24%0A%23%23%23%23%20Backward%20propagation%0A%24dZ%5E%7B%5B2%5D%7D%20%3D%20A%5E%7B%5B2%5D%7D%20-%20Y%24%0A%24dW%5E%7B%5B2%5D%7D%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20dZ%5E%7B%5B2%5D%7DA%5E%7B%5B1%5DT%7D%24%0A%24db%5E%7B%5B2%5D%7D%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20np.sum%28dZ%5E%7B%5B2%5D%7D%2C%20axis%3D1%2C%20keepdims%3DTrue%29%24%0A%24dZ%5E%7B%5B1%5D%7D%20%3D%20W%5E%7B%5B2%5DT%7DdZ%5E%7B%5B2%5D%7D%20*%20g%5E%7B%5B1%5D%5Cprime%7D%28Z%5E%7B%5B1%5D%7D%29%24%0A%24dW%5E%7B%5B1%5D%7D%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20dZ%5E%7B%5B1%5D%7DX%5ET%24%0A%24db%5E%7B%5B1%5D%7D%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20np.sum%28dZ%5E%7B%5B1%5D%7D%2C%20axis%3D1%2C%20keepdims%3DTrue%29%24%0A%0A%3E%20**np.sum**%28A%2C%20axis%3D1%2C%20keepdims%3DTrue%29%20%u6C42%u53D6%u77E9%u9635A%u5404%u884C%u7684%u548C%0A%3E%20**axis**%3A%20%3D1%20%u6309%u884C%u6C42%u548C%uFF0C%3D0%20%u6309%u5217%u6C42%u548C%uFF0C%u6CA1%u6709axis%u5219%u5168%u77E9%u9635%u6C42%u548C%0A%3E%20**keepdims**%3A%20%3DTrue%20%u6C42%u548C%u51FA%u6765%u540E%u4ECD%u7136%u4FDD%u5B58%u77E9%u9635%u7ED3%u6784%uFF0C%u5373%u6309%u884C%u6C42%u548C%uFF0C%u5219%u5F97%u5230%u5217%u5411%u91CF%uFF0C%u6309%u5217%u6C42%u548C%u5F97%u5230%u884C%u5411%u91CF%uFF0C%u5168%u77E9%u9635%u6C42%u548C%u5F97%u5230%u4E00%u4E2A1x1%u77E9%u9635%u3002%0A%0A%23%23%23%23%20%u5206%u6790%0A%u5148%u770Bsingle%20training%20example%3A%20%0A%21%5BAlt%20text%5D%28./1513575221043.png%29%0A%u518D%u770Bvectorized%u7248%u672C%uFF1A%0A%21%5BAlt%20text%5D%28./1513577070931.png%29%0A%0A%u8BAD%u7EC3%u6837%u672C%u6309%u7167%u4E0B%u9762%u7684%u65B9%u6CD5stack%uFF0C%24A%5E%7B%5B1%5D%7D%24%u4E5F%u7C7B%u4F3C%u53EF%u5F97%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%7C250x0%5D%28./1513576811182.png%29%0A%u5176%u4F59%u77E9%u9635%24Z%5E%7B%5Bi%5D%7D%2C%20A%5E%7B%5Bi%5D%7D%2C%20W%5E%7B%5Bi%5D%7D%2C%20dZ%5E%7B%5Bi%5D%7D%2C%20dW%5E%7B%5Bi%5D%7D%24%u4E5F%u53EF%u7C7B%u4F3C%u5F97%u5230%u3002%0A%u7A0D%u7A0D%u9700%u8981%u6CE8%u610F%u7684%u662F%u5411%u91CF%24b%5E%7B%5Bi%5D%7D%24%uFF0CAndrew%u5728%u8BFE%u7A0B%u4E2D%u4E5F%u6CA1%u6709%u8FC7%u591A%u7684%u63D0%u5230%u3002%u8FD9%u91CC%u5199%u51FA%u6211%u7684%u7406%u89E3%u3002%0A%u9996%u5148%uFF1A%0A%24%24Z%5E%7B%5Bi%5D%7D%20%3D%20W%5E%7B%5Bi%5D%7DA%5E%7B%5Bi-1%5D%7D%20+%20b%5E%7B%5Bi%5D%7D%24%24%0A%u4E3A%u4EC0%u4E48%24b%5E%7B%5Bi%5D%7D%24%u662F%24db%5E%7B%5Bi%5D%7D%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20np.sum%28dZ%5E%7B%5Bi%5D%7D%2C%20axis%3D1%2C%20keepdims%3DTrue%29%24%3F%0A%u6700%u76F4%u89C2%u7684b%u5E94%u8BE5%u662F%24b%5E%7B%5Bi%5D%7D%2C%20db%5E%7B%5Bi%5D%7D%20%5Cin%20%28n%5E%7B%5Bi-1%5D%7D%2C%20m%29%24%uFF0C%u56E0%u4E3A%24A%5E%7B%5Bi-1%5D%7D%20%5Cin%20%28n%5E%7B%5Bi-1%5D%7D%2C%20m%29%uFF0C%20W%5E%7B%5Bi%5D%7D%20%5Cin%20%28n%5E%7B%5Bi%5D%7D%2C%20n%5E%7B%5Bi-1%5D%7D%29%2C%20Z%5E%7B%5Bi%5D%7D%20%5Cin%20%28n%5E%7B%5Bi%5D%7D%2Cm%29%24%0A%u90A3%u4E3A%u4EC0%u4E48%u8981%u6309%u7167%u884C%u6C42%u548C%u518D%u6309m%u6C42%u5747%u503C%u5462%uFF1F%u56E0%u4E3A%24W%5E%7B%5Bi%5D%7D%2C%20b%5E%7B%5Bi%5D%7D%24%u4E3A%u6A21%u578B%u53C2%u6570%uFF0C%u4E0E%u6837%u672C%u65E0%u5173%u3002%u9488%u5BF9%u6BCF%u4E2A%u6837%u672Cb%2C%20db%u5E94%u5F53%u76F8%u540C%u3002%u6240%u4EE5%u8981%u6309%u4E0A%u9762%u8FD9%u4E48%u7B97%u3002%0A%0A%23%23%20%u603B%u7ED3%0A%u5728%u6D45%u5C42%u795E%u7ECF%u7F51%u7EDC%u4E2D%uFF0C%u6B63%u5411%u4F20%u64AD%u6C42%u8282%u70B9%u503C%uFF0C%u53CD%u5411%u4F20%u64AD%u5229%u7528%u94FE%u5F0F%u6CD5%u5219%u6C42%u5BFC%u6570%u3002%u5728%u5411%u91CF%u5316%u7684%u65F6%u5019%uFF0C%u9488%u5BF9%u6240%u6709%u7684%u6837%u672C%uFF0C%u5411%u91CF%u6309%u7167%u5217%u7EC4%u5408%u6210%u77E9%u9635%uFF0C%u5373%u77E9%u9635%u7684%u4E00%u5217%u5BF9%u5E94%u4E00%u4E2A%u6837%u672C%u3002%0A%0A%0A%0A%0A%0A]]></content>
      <tags>
        <tag>deep learning</tag>
        <tag>neural network</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Angular JS - service, factory & provider]]></title>
    <url>%2F2017%2F10%2F27%2FAngular_JS_-_service%2C_factory_%26_provider%2F</url>
    <content type="text"><![CDATA[Editservice&#x5728;AngularJS&#x4E2D;service&#x662F;&#x5355;&#x4F8B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x7528;service&#x5728;controller&#x4E4B;&#x95F4;&#xFF0C;&#x751A;&#x81F3;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x6765;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x3002;angular.module(&apos;app&apos;, []) .controller(&apos;ctrl&apos;, Ctrl) .service(&apos;CustomService&apos;, CustomService);function CustomService(){ const service = this service.a = &quot;test&quot;}Ctrl.$inject = [&apos;CustomService&apos;]function Ctrl(CustomService){ console.log(CustomService.a)}&#x524D;&#x9762;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x8FD9;&#x4E2A;service&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x540E;&#x9762;&#x4E00;&#x4E2A;&#x662F;&#x8FD9;&#x4E2A;service&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x53EF;&#x4EE5;&#x5982;&#x4E0A;&#x5728;controller&#x4E2D;&#x4F7F;&#x7528;&#x3002;factory&#x5DE5;&#x5382;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x751F;&#x6210;&#x4EFB;&#x610F;&#x60F3;&#x8981;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5F53;&#x5176;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;service&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;&#x548C;.service&#x4F5C;&#x7528;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x5982;&#x4E0B;ShoppingListController2.$inject = [&apos;ShoppingListFactory&apos;];function ShoppingListController2(ShoppingListFactory) { var list2 = this; // Use factory to create new shopping list service var shoppingList = ShoppingListFactory(3); ...}function ShoppingListFactory() { var factory = function (maxItems) { return new ShoppingListService(maxItems); }; return factory;}providerfactory&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;provider&#x3002;&#x770B;Angular JS&#x7684;&#x5B9E;&#x73B0;&#xFF1A;function factory(name, factoryFn, enforce) { return provider(name, { $get: enforce !== false ? enforceReturnValue(name, factoryFn) : factoryFn });}factory&#x51FD;&#x6570;&#x90FD;&#x662F;&#x7528;provider&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002; &#x4E00;&#x4E2A;provider&#x51FD;&#x6570;&#x901A;&#x5E38;&#x5982;&#x4E0B;&#x5B9A;&#x4E49;&#xFF1A;function ServiceProvider() { var provider = this; provider.config = {&#x2026;}; provider.$get = function () { var service = new Service(provider.config.prop); return service; };}provider.$get&#x6765;&#x63D0;&#x4F9B;factory&#x529F;&#x80FD;&#x3002;&#x5B83;&#x8FD8;&#x80FD;&#x63D0;&#x4F9B;&#x5176;&#x4ED6;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x3002;&#x7136;&#x540E;provider&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x5728;module.config&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x53EA;&#x80FD;inject provider&#x3002;.config&#x662F;&#x5728;module&#x5B9A;&#x4E49;&#x4EE5;&#x540E;&#xFF0C;&#x5148;&#x4E8E;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#xFF0C;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x7684;&#x3002;&#x5982;&#x4E0B;&#xFF1A;angular.module(&apos;app&apos;, []) .controller(&apos;ctrl&apos;, Ctrl) .provider(&apos;Service&apos;, ServiceProvider) .config(Config);Config.$inject = [&apos;ServiceProvider&apos;];function Config(ServiceProvider) { ServiceProvider.config.prop = &apos;value&apos;;};&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5728;$get&#x5B9E;&#x4F8B;&#x5316;&#x7684;service&#x5C31;&#x80FD;&#x6839;&#x636E;&#x6A21;&#x5757;&#x7684;&#x4E0D;&#x540C;&#x6765;&#x5B9A;&#x5236;&#x4E0D;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;%23%20Angular%20JS%20-%20service%2C%20factory%20%26%20provider%0A@%28myblog%29%5Bangular%5D%0A%0A%0A%23%23%20service%0A%u5728AngularJS%u4E2Dservice%u662F%u5355%u4F8B%u7684%uFF0C%u6240%u4EE5%u901A%u5E38%u7528service%u5728controller%u4E4B%u95F4%uFF0C%u751A%u81F3%u6A21%u5757%u4E4B%u95F4%u6765%u5171%u4EAB%u6570%u636E%u3002%0A%60%60%60%0Aangular.module%28%27app%27%2C%20%5B%5D%29%0A%20%20.controller%28%27ctrl%27%2C%20Ctrl%29%0A%20%20.service%28%27CustomService%27%2C%20CustomService%29%3B%0A%0Afunction%20CustomService%28%29%7B%0A%09const%20service%20%3D%20this%0A%09service.a%20%3D%20%22test%22%0A%7D%0A%0ACtrl.%24inject%20%3D%20%5B%27CustomService%27%5D%0Afunction%20Ctrl%28CustomService%29%7B%0A%09console.log%28CustomService.a%29%0A%7D%0A%60%60%60%0A%u524D%u9762%u4E00%u4E2A%u5B57%u7B26%u4E32%u662F%u8FD9%u4E2Aservice%u7684%u540D%u5B57%uFF0C%u540E%u9762%u4E00%u4E2A%u662F%u8FD9%u4E2Aservice%u7684%u6784%u9020%u51FD%u6570%u3002%u53EF%u4EE5%u5982%u4E0A%u5728controller%u4E2D%u4F7F%u7528%u3002%0A%0A%23%23%20factory%0A%u5DE5%u5382%u51FD%u6570%uFF0C%u53EF%u4EE5%u7528%u6765%u751F%u6210%u4EFB%u610F%u60F3%u8981%u7684%u4E1C%u897F%uFF0C%u5F53%u5176%u8FD4%u56DE%u4E00%u4E2Aservice%u5B9E%u4F8B%u65F6%uFF0C%u548C.service%u4F5C%u7528%u662F%u76F8%u540C%u7684%uFF0C%u5982%u4E0B%0A%60%60%60%0AShoppingListController2.%24inject%20%3D%20%5B%27ShoppingListFactory%27%5D%3B%0Afunction%20ShoppingListController2%28ShoppingListFactory%29%20%7B%0A%20%20var%20list2%20%3D%20this%3B%0A%0A%20%20//%20Use%20factory%20to%20create%20new%20shopping%20list%20service%0A%20%20var%20shoppingList%20%3D%20ShoppingListFactory%283%29%3B%0A%20%20...%0A%7D%0A%0Afunction%20ShoppingListFactory%28%29%20%7B%0A%20%20var%20factory%20%3D%20function%20%28maxItems%29%20%7B%0A%20%20%20%20return%20new%20ShoppingListService%28maxItems%29%3B%0A%20%20%7D%3B%0A%0A%20%20return%20factory%3B%0A%7D%0A%60%60%60%0A%0A%23%23%20provider%0Afactory%u5176%u5B9E%u662F%u4E00%u79CD%u7279%u6B8A%u7684provider%u3002%u770BAngular%20JS%u7684%u5B9E%u73B0%uFF1A%0A%60%60%60%0Afunction%20factory%28name%2C%20factoryFn%2C%20enforce%29%20%7B%0A%20%20return%20provider%28name%2C%20%7B%0A%20%20%20%20%24get%3A%20enforce%20%21%3D%3D%20false%20%3F%20enforceReturnValue%28name%2C%20factoryFn%29%20%3A%20factoryFn%0A%20%20%7D%29%3B%0A%7D%0A%60%60%60%0Afactory%u51FD%u6570%u90FD%u662F%u7528provider%u6765%u5B9E%u73B0%u7684%u3002%0A%u4E00%u4E2Aprovider%u51FD%u6570%u901A%u5E38%u5982%u4E0B%u5B9A%u4E49%uFF1A%0A%60%60%60%0Afunction%20ServiceProvider%28%29%20%7B%0A%20%20var%20provider%20%3D%20this%3B%0A%20%20provider.config%20%3D%20%7B%u2026%7D%3B%0A%20%20provider.%24get%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20var%20service%20%3D%0A%20%20%20%20%20%20new%20Service%28provider.config.prop%29%3B%0A%20%20%20%20return%20service%3B%0A%20%20%7D%3B%0A%7D%0A%60%60%60%0Aprovider.%5C%24get%u6765%u63D0%u4F9Bfactory%u529F%u80FD%u3002%u5B83%u8FD8%u80FD%u63D0%u4F9B%u5176%u4ED6%u7684%u914D%u7F6E%u9879%u3002%u7136%u540Eprovider%u8FD8%u6709%u4E00%u4E2A%u597D%u5904%u662F%uFF0C%u5728module.config%u51FD%u6570%u4E2D%uFF0C%u53EA%u80FDinject%20provider%u3002.config%u662F%u5728module%u5B9A%u4E49%u4EE5%u540E%uFF0C%u5148%u4E8E%u5176%u4ED6%u670D%u52A1%uFF0C%u7ACB%u5373%u8FD0%u884C%u7684%u3002%u5982%u4E0B%uFF1A%0A%60%60%60javascript%0Aangular.module%28%27app%27%2C%20%5B%5D%29%0A%20%20.controller%28%27ctrl%27%2C%20Ctrl%29%0A%20%20.provider%28%27Service%27%2C%20ServiceProvider%29%0A%20%20.config%28Config%29%3B%0AConfig.%24inject%20%3D%20%5B%27ServiceProvider%27%5D%3B%0Afunction%20Config%28ServiceProvider%29%20%7B%0A%20%20ServiceProvider.config.prop%20%3D%20%27value%27%3B%0A%7D%3B%0A%60%60%60%0A%u8FD9%u6837%u7684%u8BDD%uFF0C%u5728%5C%24get%u5B9E%u4F8B%u5316%u7684service%u5C31%u80FD%u6839%u636E%u6A21%u5757%u7684%u4E0D%u540C%u6765%u5B9A%u5236%u4E0D%u540C%u7684%u529F%u80FD%u3002]]></content>
      <tags>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Angular JS - unit test]]></title>
    <url>%2F2017%2F10%2F27%2FAngular_JS_-_unit_test%2F</url>
    <content type="text"><![CDATA[Edit &#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x4E00;&#x76F4;&#x6CA1;&#x6709;&#x505A;unit testing&#xFF0C;&#x4E5F;&#x4E0D;&#x77E5;&#x9053;&#x600E;&#x4E48;&#x505A;&#x3002;&#x5728;Yaakov Chaikin&#x7684;Coursera&#x8BFE;&#x7A0B;&#x4E2D;&#xFF0C;&#x7B2C;&#x4E94;&#x7AE0;&#x6B63;&#x597D;&#x4ECB;&#x7ECD;&#x4E86;&#x76F8;&#x5173;&#x5185;&#x5BB9;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x987A;&#x4FBF;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x5B9E;&#x8DF5;&#x4E86;&#x4E00;&#x628A;&#x3002;&#x65E0;&#x6570;&#x6B21;&#x7684;&#x5B9E;&#x8DF5;&#x8BC1;&#x660E;&#xFF0C;&#x770B;&#x5F97;&#x5934;&#x5934;&#x662F;&#x9053;&#xFF0C;&#x5199;&#x8D77;&#x6765;&#x5C31;&#x5230;&#x5904;&#x662F;&#x5751;&#x3002;&#x5C0F;&#x5C0F;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x7740;&#x5B9E;&#x82B1;&#x4E86;&#x4E0D;&#x5C11;&#x65F6;&#x95F4;&#x3002;&#x9488;&#x5BF9;&#x524D;&#x7AEF;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x7F51;&#x4E0A;&#x91C7;&#x7528;&#x7684;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;&#x5927;&#x591A;&#x662F;karma + jasmine + chai&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4E4B;&#x524D;&#x5728;&#x540E;&#x7AEF;&#x4EE3;&#x7801;&#x7684;&#x6D4B;&#x8BD5;&#x4E2D;&#x591A;&#x91C7;&#x7528;mocha + should + sinon&#x3002;&#x6240;&#x4EE5;&#x672C;&#x6B21;&#x5B9E;&#x8DF5;&#xFF0C;&#x4ECD;&#x7136;&#x7231;&#x91C7;&#x7528;mocha&#x6846;&#x67B6;&#xFF0C;&#x6765;&#x642D;&#x914D;karma&#x4F7F;&#x7528;&#x3002;karma&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x52A8;&#x5316;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;&#x3002;&#x56E0;&#x5176;&#x4E30;&#x5BCC;&#x7684;&#x914D;&#x7F6E;&#x9009;&#x9879;&#xFF0C;&#x826F;&#x597D;&#x7684;&#x6269;&#x5C55;&#x6027;&#x80FD;&#xFF0C;&#x88AB;&#x5E7F;&#x6CDB;&#x5E94;&#x7528;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5728;&#x524D;&#x7AEF;&#x3002;&#x56E0;&#x4E3A;&#x524D;&#x7AEF;&#x8981;&#x9488;&#x5BF9;&#x5404;&#x79CD;&#x7248;&#x672C;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5404;&#x79CD;&#x6846;&#x67B6;&#xFF0C;&#x5982;&#x679C;&#x5168;&#x90E8;&#x9760;&#x624B;&#x52A8;&#x53BB;&#x9002;&#x914D;&#xFF0C;&#x57FA;&#x672C;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x3002;&#x6240;&#x4EE5;&#x5927;&#x5BB6;&#x90FD;&#x7528;karma&#x4E86;&#x3002;karma setup&#x57FA;&#x672C;&#x914D;&#x7F6E;&#x53C2;&#x8003;&#x524D;&#x7AEF;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E4B;Karma&#x73AF;&#x5883;&#x642D;&#x5EFA;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7B80;&#x5355;&#x5982;&#x4E0B;&#xFF1A;module.exports = function(config) { config.set({ // base path that will be used to resolve all patterns (eg. files, exclude) basePath: &apos;&apos;, // frameworks to use // available frameworks: https://npmjs.org/browse/keyword/karma-adapter frameworks: [...], // list of files / patterns to load in the browser files: [ &apos;...&apos;, {pattern: &apos;...&apos;} ], // list of files to exclude exclude: [ ], // preprocess matching files before serving them to the browser // available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor preprocessors: { }, // test results reporter to use // possible values: &apos;dots&apos;, &apos;progress&apos; // available reporters: https://npmjs.org/browse/keyword/karma-reporter reporters: [&apos;progress&apos;], // web server port port: 9876, // enable / disable colors in the output (reporters and logs) colors: true, // level of logging // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG logLevel: config.LOG_INFO, // enable / disable watching file and executing tests whenever any file changes autoWatch: true, // start these browsers // available browser launchers: https://npmjs.org/browse/keyword/karma-launcher browsers: [&apos;...&apos;], // Continuous Integration mode // if true, Karma captures browsers, runs the tests and exits singleRun: false, // Concurrency level // how many browser should be started simultaneous concurrency: Infinity, // Which plugins to enable plugins: [] })}&#x7B80;&#x5355;&#x7684;&#x89E3;&#x91CA;&#x76EE;&#x524D;&#x7528;&#x5230;&#x7684;&#x9009;&#x9879;&#xFF1A;frameworks: &#x4F7F;&#x7528;&#x5230;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x6240;&#x6709;&#x4F7F;&#x7528;&#x5230;&#x7684;&#xFF0C;&#x8981;&#x5728;&#x4E0B;&#x9762;plugins&#x4E2D;&#x5217;&#x660E;&#x3002;&#x6BD4;&#x5982;&#xFF1A;frameworks&#x4E2D;&#x5305;&#x542B;mocha&#xFF0C;&#x5219;plugins&#x4E0B;&#x5C31;&#x8981;&#x5305;&#x542B;karma-mochabasePath, files, exclude: &#x8FD9;&#x4E09;&#x4E2A;&#x6307;&#x660E;&#x4E86;karma&#x8981;&#x52A0;&#x8F7D;&#x7684;JS&#x6587;&#x4EF6; basePath&#xFF1A;&#x57FA;&#x7840;&#x76EE;&#x5F55;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x5230;files&#xFF0C;exclude&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x5F84;&#x524D;&#x9762;files&#xFF1A;&#x52A0;&#x8F7D;&#x6587;&#x4EF6;&#xFF0C;&#x652F;&#x6301;&#x901A;&#x914D;&#x7B26;&#x548C;&#x6B63;&#x5219;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;&#x5927;&#x62EC;&#x53F7;&#x8FD8;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x3002;&#x901A;&#x914D;&#x7B26;&#x2019;**&#x2019;&#x8868;&#x793A;&#x6240;&#x6709;&#x76EE;&#x5F55;&#xFF0C;&#x2019;*&#x2019;&#x8868;&#x793A;&#x6240;&#x6709;&#x6587;&#x4EF6;&#xFF0C;&#x2019;**/*&#x2019;&#x8868;&#x793A;&#x5176;&#x4E0B;&#x6240;&#x6709;&#x76EE;&#x5F55;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x3002;exclude: &#x53EF;&#x4EE5;&#x5254;&#x9664;files&#x4E2D;&#x4E0D;&#x60F3;&#x8981;&#x7684;&#x6587;&#x4EF6;browsers&#xFF1A;&#x4F7F;&#x7528;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;headless&#x6D4B;&#x8BD5;&#x5219;&#x53EF;&#x7528;PhantomJSkarma with ES6&#x56E0;&#x4E3A;PhantomJS&#x4E0D;&#x652F;&#x6301;ES6&#x8BED;&#x6CD5;(&#x7F51;&#x4E0A;&#x8BF4;&#xFF0C;PhantomJS&#x751A;&#x81F3;&#x5BF9;ES5&#x7684;&#x652F;&#x6301;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x597D;)&#xFF0C;&#x6240;&#x4EE5;karma&#x8981;&#x6D4B;&#x8BD5;&#x5305;&#x542B;ES6&#x8BED;&#x6CD5;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x756A;&#x914D;&#x7F6E;&#x3002;&#x7F51;&#x4E0A;&#x76F8;&#x5173;&#x7684;&#x5E16;&#x5B50;&#x5F88;&#x591A;&#xFF0C;&#x5217;&#x4E3E;&#x5982;&#x4E0B;&#xFF1A;Testing ES6 with Karma, RequireJS, and Angular - karma-es6-shim How to Start Writing Your AngularJS Tests in ES6 - karma-babel-preprocessorWriting Jasmine Unit Tests In ES6 - webpack&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x6709;&#x8FD9;&#x4E48;&#x51E0;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;karma-es6-shimkarma-babel-preprocessorwebpackSlimerJS &#x524D;&#x4E09;&#x79CD;&#x6709;&#x70B9;&#x590D;&#x6742;&#xFF0C;&#x76EE;&#x524D;&#x7684;&#x6211;&#x7684;&#x6280;&#x672F;&#x6808;&#x8FD8;&#x65E0;&#x6CD5;&#x7406;&#x89E3;&#x3002;&#x6700;&#x7EC8;&#x9009;&#x62E9;&#x6700;&#x7B80;&#x5355;&#x7684;SlimerJS&#x3002;&#x5728;Linux&#x4E0A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Xvfb&#x505A;&#x5230;headless&#x6D4B;&#x8BD5;&#xFF0C;Windows&#x4E0A;&#x5C31;&#x8FD9;&#x6837;&#x5427;&#xFF0C;&#x8DF3;&#x4E2A;&#x7A97;&#x53E3;&#x4E5F;&#x4E0D;&#x662F;&#x4EC0;&#x4E48;&#x5927;&#x4E8B;&#x3002;Debug karma test using Chrome&#x8FD9;&#x4E2A;&#x5728;&#x521D;&#x5B66;&#x7684;&#x65F6;&#x5019;&#x8FD8;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x6050;&#x6015;&#x6211;&#x4E5F;&#x8DF3;&#x4E0D;&#x51FA;&#x81EA;&#x5DF1;&#x7ED9;&#x81EA;&#x5DF1;&#x6316;&#x7684;&#x5927;&#x5751;&#x3002; &#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;Debugging Karma Unit Tests &#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#x6253;&#x5F00;&#x8C03;&#x8BD5;&#x9875;&#x9762;&#x548C;Chrome Dev Tool&#x9875;&#x9762;&#xFF0C;&#x5237;&#x65B0;&#x9875;&#x9762;&#x5373;&#x53EF;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x4EE3;&#x7801;&#x5E76;&#x89E6;&#x53D1;&#x65AD;&#x70B9;&#x3002; &#x5C06;&#x547D;&#x4EE4;&#x884C;&#x5199;&#x5165;package.json&#xFF0C;&#x4EE5;&#x540E;&#x8C03;&#x7528;npm&#x5C31;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x6253;&#x5F00;&#x8BE5;&#x8C03;&#x8BD5;&#x5DE5;&#x5177;&#x3002;{... &quot;scripts&quot;: { &quot;start&quot;: &quot;node ./bin/www&quot;, &quot;karma-debug&quot;: &quot;cd public/js &amp;&amp; karma start --browsers=Chrome --single-run=false --debug&quot; }, ...}ngMockngMock&#x4E2D;&#x4E24;&#x4E2A;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5173;&#x952E;&#x8BCD;&#x5C31;&#x662F;&#xFF1A;module, inject&#x3002;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x4EBA;&#x7684;&#x535A;&#x5BA2;&#xFF1A;ngMock Fundamentals for AngularJS - Understanding InjectngMock Fundamentals for AngularJS Unit Testing - Understanding ModulengMock&#x901A;&#x8FC7;module&#x52A0;&#x8F7D;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x4E86;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x6216;&#x8005;&#x5B9A;&#x4E49;&#x533F;&#x540D;module&#x5E76;&#x63D0;&#x4F9B;&#x65B0;&#x7684;service&#xFF0C;&#x6216;&#x8005;&#x590D;&#x5199;&#x5DF2;&#x5B58;&#x5728;&#x7684;service&#x3002;module&#x53EA;&#x662F;&#x5C06;&#x540D;&#x5B57;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x4F4D;&#x7F6E;&#x5B58;&#x5165;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x3002;inject&#x5C06;&#x771F;&#x6B63;&#x7684;&#x52A0;&#x8F7D;&#x6240;&#x6709;module&#x63D0;&#x4F9B;&#x7684;service&#xFF0C;&#x5E76;&#x89E3;&#x51B3;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x76F8;&#x5E94;&#x7684;service&#x5BFC;&#x51FA;&#x5230;test case&#x4E2D;&#x4F7F;&#x7528;&#x3002;&#x5176;&#x5B9E;ngMock&#x4E5F;&#x5C31;&#x662F;&#x505A;&#x4E86;&#x8FD9;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#x3002; &#x4E0B;&#x9762;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x6709;&#x52A9;&#x4E8E;&#x7406;&#x89E3;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#x3002;angular.mock.modulemodule&#x51FD;&#x6570;&#x7684;&#x539F;&#x578B;&#x662F;angular.mock.module(alias, obj, func) module&#x63A5;&#x53D7;&#x4E09;&#x79CD;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#xFF0C;&#x6BCF;&#x4E00;&#x79CD;&#x90FD;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x4F7F;&#x7528;&#xFF0C;&#x7528;&#x6765;&#x5B9A;&#x4E49;&#x6216;&#x52A0;&#x8F7D;&#x5BF9;&#x5E94;&#x6A21;&#x5757;alias: &#x662F;module&#x540D;&#x5B57;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x5728;&#x5F85;&#x6D4B;&#x4EE3;&#x7801;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5728;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;obj: &#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;&#x5B57;&#x5178;&#x7ED3;&#x6784;&#xFF0C;&#x4ED6;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x533F;&#x540D;module&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x4F1A;&#x88AB;&#x5B9A;&#x4E49;&#x6210;$provide.value()function: &#x540C;&#x6837;&#x662F;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x533F;&#x540D;module&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;function&#x53EF;&#x4EE5;&#x7528;$provide&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x6765;&#x5B9A;&#x4E49;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;service&#x3002;function() vs ObjectThe examples we used were similar, so what&#x2019;s the key difference between the function() and Object form? As the Object type gets added as a $provider.value, it is therefore restricted to the capabilities of the value service, most importantly that a value service cannot be injected with other services.&#x5173;&#x4E8E;$provide&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;Angular&#x5B98;&#x65B9;&#x6587;&#x6863;The $provide service has a number of methods for registering components with the $injector. Many of these functions are also exposed on angular.Module.&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x4E9B;serviceprovider(name, provider) - registers a service provider with the $injector constant(name, obj) - registers a value/object that can be accessed by providers and services. value(name, obj) - registers a value/object that can only be accessed by services, not providers. factory(name, fn) - registers a service factory function that will be wrapped in a service provider object, whose $get property will contain the given factory function. service(name, Fn) - registers a constructor function that will be wrapped in a service provider object, whose $get property will instantiate a new object using the given constructor function. decorator(name, decorFn) - registers a decorator function that will be able to modify or replace the implementation of another service.angular.mock.inject$inject&#x662F;ngMock&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x770B;&#x770B;&#x5B98;&#x65B9;&#x7684;&#x5B9A;&#x4E49;The inject function wraps a function into an injectable function. The inject() creates new instance of $injector per test, which is then used for resolving references.inject&#x5C31;&#x662F;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;injector&#xFF0C;&#x90A3;injector&#x53C8;&#x662F;&#x4EC0;&#x4E48;$injector is used to retrieve object instances as defined by provider, instantiate types, invoke methods, and load modules.$injector&#x4E5F;&#x5C31;&#x662F;AngularJS&#x7684;&#x6838;&#x5FC3;&#x3002;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x6240;&#x8C13;&#x7684;&#x201C;DI&#x201D; (Dependency Injection)&#x6A21;&#x5F0F;&#x3002;Angular&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x901A;&#x8FC7;$injector&#x6765;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;service&#x7684;reference&#x3002; &#x6211;&#x4EEC;&#x901A;&#x5E38;&#x5C06;inject&#x653E;&#x5728;beforeEach&#x91CC;&#xFF0C;&#x8FD9;&#x6837;inject&#x5C31;&#x4E3A;&#x6BCF;&#x4E2A;&#x6D4B;&#x8BD5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;injector&#xFF0C;&#x4E3A;&#x8FD9;&#x4E2A;injector&#x51C6;&#x5907;&#x597D;&#x6240;&#x6709;&#x7684;service&#xFF0C;&#x5E76;&#x80FD;&#x901A;&#x8FC7;&#x53C2;&#x6570;&#x5C06;&#x4EFB;&#x610F;&#x5DF2;&#x6709;&#x7684;service&#x5BFC;&#x51FA;&#x3002;Test controllers&#x4E86;&#x89E3;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x91CD;&#x8981;&#x7EC4;&#x4EF6;&#x4E4B;&#x540E;&#xFF0C;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x6D4B;&#x8BD5;&#x7EC4;&#x4EF6;&#x5C31;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E86;&#x3002; &#x76F4;&#x63A5;&#x4E0A;&#x4EE3;&#x7801;&#xFF1A;describe(&apos;main controller&apos;, function() { var $controller var mainCtrl beforeEach(&apos;set up module&apos;, function() { module(function ($provide) { $provide.service(&apos;MockDataService&apos;, function () { const service = this service.data = &apos;test data&apos; }) }) module(&apos;MainModule&apos;) }); beforeEach(&apos;set up controller&apos;, inject(function (_$controller_, MockDataService) { $controller = _$controller_ mainCtrl = $controller(&apos;MainController&apos;, { DataService: MockDataService }) })) it(&apos;should assemble print page URL correctly&apos;, function() { mainCtrl.getData().should.equal(&apos;test data&apos;) });});&#x8FD9;&#x91CC;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x5176;&#x5B9E;&#x524D;&#x6587;&#x4E5F;&#x90FD;&#x6709;&#x63D0;&#x53CA;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;module&#x4E2D;&#x901A;&#x8FC7;$provide&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5047;&#x7684;service&#xFF0C;&#x8FD9;&#x4E2A;service&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5176;&#x540D;&#x5B57;&#x88AB;inject&#x3002;inject&#x4E2D;&#x901A;&#x8FC7;_$controller_&#x6765;&#x5BFC;&#x51FA;controller&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6765;&#x6784;&#x9020;&#x76F8;&#x5E94;&#x7684;&#x5F85;&#x6D4B;controller&#xFF0C;&#x5E76;&#x4F20;&#x5165;&#x5047;&#x7684;service&#x8FBE;&#x5230;mock&#x7684;&#x76EE;&#x7684;&#x3002;Test services&#x4ECD;&#x7136;&#x76F4;&#x63A5;&#x4E0A;&#x4EE3;&#x7801;&#xFF1A;angular.module(&apos;PrinterData&apos;, []).config([&apos;$locationProvider&apos;, function($locationProvider) { $locationProvider.html5Mode(true);}]);describe(&apos;printer data service&apos;, function() { var $httpBackend var PrinterDataService beforeEach(function(){ module(function ($provide) { $provide.provider(&apos;$location&apos;, function () { const provider = this const location = {} location.search = function (){ return { id: &apos;test id&apos;, } } provider.html5Mode = sinon.stub() provider.$get = sinon.stub().returns(location) }) }) }); beforeEach(function() { module(&apos;Data&apos;) inject(function ($injector) { $httpBackend = $injector.get(&apos;$httpBackend&apos;) DataService = $injector.get(&apos;DataService&apos;) }) }); it(&apos;should update if succeeds&apos;, function(done) { $httpBackend.whenGET(/.*/) .respond({ status: &apos;ready&apos; }) DataService.getStatus().then(function (data) { data.should.deepEqual({ status: &apos;ready&apos; }) done() }).catch(function (err) { should.not.exist(err) }) $httpBackend.flush(); });})&#x4E0B;&#x9762;&#x7F57;&#x5217;&#x4E00;&#x4E9B;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#x78B0;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x4EE5;&#x53CA;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x4E9B;&#x7406;&#x89E3;&#x3002;&#x4F7F;&#x7528;$injector&#x6211;&#x4EEC;&#x8BF4;&#x8FC7;inject&#x51FD;&#x6570;&#x5C31;&#x662F;&#x7528;&#x6765;&#x521B;&#x5EFA;$injector&#xFF0C;&#x6240;&#x4EE5;$injector&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x88AB;&#x5BFC;&#x51FA;&#x4F7F;&#x7528;&#x7684;&#x3002;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x4EC0;&#x4E48;service&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;$injector.get&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x53C2;&#x6570;&#x6765;inject&#x5462;&#xFF1F;&#x5F53;&#x7136;&#x662F;&#x56E0;&#x4E3A;&#x53C2;&#x6570;&#x592A;&#x957F;&#x4E86;&#xFF0C;&#x4E0D;&#x597D;&#x770B;&#x3002;&#x3002;&#x3002;mock $http&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x5728;unit test&#x4E2D;&#x5E76;&#x4E0D;&#x771F;&#x6B63;&#x7684;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x800C;&#x901A;&#x5E38;&#x91C7;&#x7528;&#x5047;&#x7684;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x6765;mock&#x3002;&#x8FD9;&#x5C31;&#x9700;&#x8981;&#x7528;&#x5230;$httpBackend service&#x3002;&#x90A3;&#x4E48;$http&#x548C;$httpBackend&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;HTTP backend used by the service that delegates to XMLHttpRequest object or JSONP and deals with browser incompatibilities. You should never need to use this service directly, instead use the higher-level abstractions: $http or $resource. During testing this implementation is swapped with mock $httpBackend which can be trained with responses.&#x5177;&#x4F53;&#x505A;&#x6CD5;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x5DF2;&#x6709;&#xFF0C;&#x8282;&#x5F55;&#x5982;&#x4E0B;&#xFF1A;beforeEach(function() { module(&apos;Data&apos;) inject(function ($injector) { $httpBackend = $injector.get(&apos;$httpBackend&apos;) DataService = $injector.get(&apos;DataService&apos;) }) }); it(&apos;should update if succeeds&apos;, function(done) { $httpBackend.whenGET(/.*/) .respond({ status: &apos;ready&apos; }) DataService.getStatus().then(function (data) { data.should.deepEqual({ status: &apos;ready&apos; }) done() }).catch(function (err) { should.not.exist(err) }) $httpBackend.flush(); });&#x901A;&#x8FC7;$httpBackend.wheGET(...).respond(...)&#x6765;&#x8BBE;&#x7F6E;mock response&#x3002;whenGET&#x8FD8;&#x652F;&#x6301;&#x6B63;&#x5219;&#x5F0F;&#x3002; &#x8C03;&#x7528;&#x5B8C;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x540E;&#x8981;&#x8BB0;&#x5F97;$httpBackend.flush()&#x5C06;&#x8BF7;&#x6C42;&#x771F;&#x6B63;&#x7684;&#x53D1;&#x51FA;&#x3002;&#x5426;&#x5219;&#x8BF7;&#x6C42;&#x5E76;&#x4E0D;&#x4F1A;&#x53D1;&#x51FA;&#xFF0C;&#x76F4;&#x5230;&#x8C03;&#x7528;flush()&#x51FD;&#x6570;&#xFF0C;&#x6216;&#x8005;&#x6D4B;&#x8BD5;&#x8D85;&#x65F6;&#x5931;&#x8D25;&#x3002;&#x5982;&#x4F55;mock $location &amp; $locationProvider&#x5F88;&#x60ED;&#x6127;&#x7684;&#x8BF4;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E0A;&#x6211;&#x82B1;&#x4E86;&#x5F88;&#x4E45;&#x5F88;&#x4E45;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x641C;&#x7D22;&#x4E86;&#x5927;&#x91CF;&#x7684;google&#x7F51;&#x9875;&#xFF0C;&#x6700;&#x540E;&#x8FD8;&#x662F;&#x4F9D;&#x9760;chrome&#x8FFD;&#x8E2A;angular&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x624D;&#x53D1;&#x73B0;&#x539F;&#x6765;&#x662F;&#x81EA;&#x5DF1;&#x7ED9;&#x81EA;&#x5DF1;&#x6316;&#x7684;&#x5751;&#xFF0C;&#x5BF9;service, factory&#x548C;provider&#x7406;&#x89E3;&#x4E0D;&#x900F;&#x5F7B;&#x3002; &#x9996;&#x5148;&#x6765;&#x5C31;&#x4E8B;&#x8BBA;&#x4E8B;&#xFF0C;&#x8BF4;&#x4E00;&#x4E0B;&#x5230;&#x5E95;&#x600E;&#x4E48;&#x5B8C;&#x6210;&#x6211;&#x7684;&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x8981;&#x6D4B;&#x8BD5;DataService&#xFF0C;&#x800C;DataService&#x5B9A;&#x4E49;&#x5728;Data moduleDataService&#x8C03;&#x7528;&#x4E86;$location service&#x3002;&#x9700;&#x8981;&#x5C06;&#x4E4B;mock&#x6389;&#x3002;&#x6700;&#x7B80;&#x5355;&#x7684;&#x60F3;&#x6CD5;&#x5C31;&#x662F;&#x901A;&#x8FC7;inject&#x6765;&#x83B7;&#x5F97;$location service reference&#x3002;&#x5E76;&#x901A;&#x8FC7;sinon.stub&#x6765;&#x8BBE;&#x7F6E;&#x9700;&#x8981;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x3002;inject(function ($injector, $location) { sinon.stub($location, &apos;search&apos;).returns({ id: &apos;test id&apos; }) DataService = $injector.get(&apos;DataService&apos;)})&#x4F46;&#x662F;&#x6211;&#x5012;&#x9709;&#x50AC;&#x7684;&#xFF0C;&#x7ADF;&#x7136;&#x662F;&#x7528;$provide&#x505A;&#x4E86;&#xFF1A;module(function ($provide) { $provide.service(&apos;$location&apos;, function () { const location = this location.search = sinon.stub().returns({ device_id: &apos;test id&apos;, }) })})&#x8FD9;&#x6837;&#x5C31;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x5F53;ngMock&#x52A0;&#x8F7D;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5148;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;$locationProvider&#xFF0C;&#x8FD9;&#x5C31;&#x4F1A;&#x8986;&#x76D6;&#x5176;&#x81EA;&#x5E26;&#x7684;$locationProvider&#x3002;&#x800C;&#x5982;&#x4E0B;&#x7684;module.config&#x65B9;&#x6CD5;&#x4E2D;&#x5BF9;$locationProvider&#x7684;&#x64CD;&#x4F5C;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF1A;angular.module(&apos;PrinterData&apos;, []).config([&apos;$locationProvider&apos;, function($locationProvider) { $locationProvider.html5Mode(true);}]);&#x56E0;&#x4E3A;&#x65B0;&#x5B9A;&#x4E49;&#x7684;$locationProvider&#x4E2D;&#x6CA1;&#x6709;html5Mode&#x6210;&#x5458;&#x3002;&#x4E8E;&#x662F;&#x60F3;&#x4E86;&#x5404;&#x79CD;&#x529E;&#x6CD5;&#x6765;mock $locationProvider&#x3002;&#x7ED3;&#x679C;&#x56E0;&#x4E3A;&#x5BF9;service&#xFF0C;factory&#xFF0C;provider&#x7684;&#x7406;&#x89E3;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x90FD;&#x5931;&#x8D25;&#x4E86;&#x3002;&#x653E;&#x4E00;&#x6BB5;&#x9519;&#x8BEF;&#x7684;&#x4EE3;&#x7801;&#xFF1A;beforeEach(function(){ module(function ($provide) { $provide.service(&apos;$locationProvider&apos;, function () { const location = this location.html5Mode = function(){} }) $provide.factory(&apos;$location&apos;, function () { const locationProvider = this locationProvider.html5Mode = function(){} })})&#x7B2C;&#x4E00;&#x4E2A;&#x7528;$provide.service&#x4F1A;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;$locationProviderProvider &#x7B2C;&#x4E8C;&#x4E2A;&#x7528;$provide.factory&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;$locationProvider&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#xFF0C;&#x6240;&#x4EE5;$location service&#x4E0D;&#x4F1A;&#x88AB;&#x5B9E;&#x4F8B;&#x5316;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;$location service&#x4E86;&#x3002; &#x5982;&#x679C;&#x60F3;&#x901A;&#x8FC7;mock $locationProvider&#x6765;mock $location service&#x7684;&#x8BDD;&#xFF0C;&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x5E94;&#x5F53;&#x662F;&#xFF1A;$provide.provider(&apos;$location&apos;, function () { const provider = this const location = {} location.search = function (){ return { device_id: &apos;test id&apos; } } provider.html5Mode = sinon.stub() provider.$get = sinon.stub().returns(location)})mock&#x6389;provider.$get&#x51FD;&#x6570;&#xFF0C;&#x63D0;&#x4F9B;&#x5047;&#x7684;location&#x670D;&#x52A1;&#x3002;&#x5176;&#x5B9E;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x529E;&#x6CD5;&#xFF0C;&#x4F8B;&#x5982;&#x83B7;&#x5F97;$locationProvider&#x518D;&#x5BF9;$get&#x51FD;&#x6570;&#x8FDB;&#x884C;stub&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x3002;&#x6CA1;&#x6709;&#x518D;&#x4E00;&#x4E00;&#x5C1D;&#x8BD5;&#x4E86;&#x3002;&#x7406;&#x89E3;&#x4E86;&#x9519;&#x8BEF;&#x548C;&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x60F3;&#x518D;&#x53BB;&#x5B9E;&#x73B0;&#x5C31;&#x5F97;&#x5FC3;&#x5E94;&#x624B;&#x4E86;&#x3002;&#x6D4B;&#x8BD5;.config/.run&#x5757;Data module&#x6709;&#x4E00;&#x4E2A;.config&#x5757;&#xFF0C;&#x56E0;&#x4E3A;&#x6A21;&#x5757;&#x52A0;&#x8F7D;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5148;&#x8FD0;&#x884C;&#x5176;.config&#x5757;&#xFF0C;&#x7136;&#x540E;&#x662F;.run&#x5757;&#x3002;&#x56E0;&#x5176;&#x7279;&#x6B8A;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5BF9;&#x5176;&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x7684;&#x670D;&#x52A1;&#x8FDB;&#x884C;mock&#x8981;&#x6CE8;&#x610F;&#x987A;&#x5E8F;&#x3002;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#xFF1A;Testing config and run blocks in AngularJS How to easily test an often neglected part of your application&#x5982;&#x4F55;mock $interval&#x5728;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x8981;&#x91C7;&#x7528;mock&#x7684;&#x624B;&#x6BB5;&#xFF0C;&#x800C;&#x4E0D;&#x771F;&#x6B63;&#x7684;&#x4F7F;&#x7528;&#x65F6;&#x95F4;&#x670D;&#x52A1;&#x3002;&#x5728;sinon&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;fake timer&#x6765;&#x53D6;&#x4EE3;JS&#x4E2D;&#x6807;&#x51C6;&#x7684;setTimeout&#x548C;setInterval&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x4E2A;&#x5728;Angular JS&#x4E2D;&#x5E76;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;$interval&#x670D;&#x52A1;&#x7684;&#x8BDD;&#x3002; &#x56E0;&#x4E3A;&#x5728;&#x5BF9;Angular JS&#x505A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;$interval&#x5E76;&#x4E0D;&#x4F1A;&#x8C03;&#x7528;setInterval&#x3002;&#x539F;&#x56E0;&#x662F;&#x8FD9;&#x91CC;&#x7684;$interval&#x5176;&#x5B9E;&#x662F;ngMock&#x4E2D;&#x7684;$interval&#x3002;&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;$interval.flush(ms)&#x6765;&#x5C06;&#x65F6;&#x949F;&#x63A8;&#x8FDB;&#x82E5;&#x5E72;&#x65F6;&#x95F4;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x613F;&#x610F;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;sinon&#x6765;mock&#x4ECE;$injector&#x4E2D;get&#x51FA;&#x6765;&#x7684;$interval service&#x3002;$timeout service&#x4E5F;&#x7C7B;&#x4F3C;&#xFF0C;&#x6709;&#x540C;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#x5BF9;&#x4ED8;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002;Promise not resolve&#x5728;Angular JS&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x8C03;&#x7528;$q service&#x6765;&#x4F7F;&#x7528;Promise&#xFF0C;&#x800C;$q.defer().promise&#x53EA;&#x5728;$scope&#x7684;digest cycle&#x624D;&#x4F1A;&#x5224;&#x5B9A;resolve&#x8FD8;&#x662F;reject&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x89E6;&#x53D1;$q&#x4EA7;&#x751F;&#x7684;promise&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;$scope.$apply()&#x6216;&#x8005;$scope.$digest()&#x3002;stack overflow&#x4E2D;&#x4E5F;&#x6709;&#x5927;&#x628A;&#x7C7B;&#x4F3C;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x7B54;&#x3002;&#x5177;&#x4F53;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#xFF0C;&#x8BB2;&#x5F97;&#x5F88;&#x900F;&#x5F7B;&#xFF1A;Unit Testing with $q Promises in AngularJS&#x5728;Angular JS&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x7684;Promise&#xFF0C;&#x4F8B;&#x5982;: var promise = new Promise(resolve, reject)&#x3002;&#x4F46;&#x662F;&#x8C8C;&#x4F3C;&#xFF0C;&#x6807;&#x51C6;&#x7684;Promise&#x548C;\q&#x517C;&#x5BB9;&#x7684;&#x5E76;&#x4E0D;&#x5F88;&#x597D;&#xFF0C;&#x4E0B;&#x9762;&#x7684;code&#x5E76;&#x4E0D;&#x4F1A;&#x5DE5;&#x4F5C;&#xFF1A;var promise = $q.all([promise1, promise2])$scope.$apply()promise&#x5E76;&#x4E0D;&#x4F1A;&#x5728;promise1&#x548C;promise2&#x8FD4;&#x56DE;&#x4E4B;&#x540E;&#x8FD4;&#x56DE;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4ED6;&#x6839;&#x672C;&#x5C31;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;&#xFF0C;&#x76F4;&#x5230;&#x6D4B;&#x8BD5;&#x8D85;&#x65F6;&#x5931;&#x8D25;&#x3002;&#x201C;Unexpected request: GET &#x2026;/.html&#x201D; on Karma tests&#x8FD9;&#x662F;Yaakov&#x5728;&#x89C6;&#x9891;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x9700;&#x8981;&#x4F7F;&#x7528;$templateCache&#x7684;&#x60C5;&#x5F62;&#x3002;Yaakov&#x63D0;&#x5230;&#x7528;karma&#x662F;&#x89E3;&#x51B3;&#x8BE5;&#x95EE;&#x9898;&#x6700;&#x597D;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x89C6;&#x9891;&#x5E76;&#x4E0D;&#x6D89;&#x53CA;&#x4ECB;&#x7ECD;karma&#xFF0C;&#x6240;&#x4EE5;&#x5E76;&#x6CA1;&#x6709;&#x8BF4;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x505A;&#x3002; &#x5F53;&#x6211;&#x4EEC;&#x7684;karma test&#x52A0;&#x8F7D;&#x4E86;route.js&#xFF0C;&#x5E76;&#x5728;&#x5176;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;component&#xFF0C;&#x5219;&#x6D4B;&#x8BD5;&#x5728;&#x5B9E;&#x4F8B;&#x5316;&#x8BE5;Angular component&#x7684;&#x65F6;&#x5019;&#x56DE;&#x53BB;&#x7528;$http service&#x6765;GET&#x8BE5;template html&#x6587;&#x4EF6;&#xFF0C;&#x4E8E;&#x662F;&#x4EA7;&#x751F;&#x4E86;&#x8BE5;unexpected request&#x9519;&#x8BEF;&#x3002;Yaakov&#x5728;&#x6559;&#x7A0B;&#x4E2D;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x662F;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x6B21;&#x771F;&#x6B63;&#x7684;AJAX&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8BF7;&#x6C42;&#x8BE5;html&#xFF0C;&#x5E76;&#x5C06;&#x4E4B;&#x5B58;&#x5165;$templateCache&#x4E2D;&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x6709;&#x771F;&#x6B63;&#x7684;GET AJAX&#x4EA7;&#x751F;&#x4E86;&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x4E00;&#x6BB5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;karma&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;&#x5B89;&#x88C5;ng-html2js&#xFF0C;karma-ng-html2js-preprocessor&#x4F7F;&#x7528;ng-html2js&#x5C06;&#x5BF9;&#x5E94;&#x7684;template html&#x8F6C;&#x6210;js&#x6A21;&#x5757;&#xFF0C;&#x5E76;&#x5728;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4E2D;&#x5F15;&#x5165;&#x3002;&#x770B;&#x4E0B;&#x9762;&#x5177;&#x4F53;&#x4EE3;&#x7801; karma.conf.js// list of files / patterns to load in the browserfiles: [ &apos;../html/templates/*.html&apos;, ...],// preprocess matching files before serving them to the browser// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessorpreprocessors: { &apos;../html/templates/home.template.html&apos;: [&apos;ng-html2js&apos;]},ngHtml2JsPreprocessor: { moduleName: &apos;templates&apos;, stripPrefix: &apos;.*/&apos;, prependPrefix: &apos;/html/templates/&apos;},test.jsdescribe(function(){ beforeEach(module(&apos;templates&apos;))})&#x7279;&#x522B;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5BF9;ng-html2js&#x7684;&#x914D;&#x7F6E;ngHtml2JsPreprocessor: { moduleName: &apos;templates&apos;, stripPrefix: &apos;.*/&apos;, prependPrefix: &apos;/html/templates/&apos;},&#x5F53;&#x6CA1;&#x6709;stripPrefix&#x9009;&#x9879;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;Chrome debug&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6240;&#x6709;&#x7684;template&#x90FD;&#x88AB;&#x8F6C;&#x5316;&#x6210;&#x4E86;js&#x6A21;&#x5757;&#xFF0C;&#x4F46;&#x662F;&#x5176;&#x6A21;&#x5757;&#x540D;&#x662F;&#x7C7B;&#x4F3C;c:\path\to\template\template.html&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x800C;&#x6211;&#x5728;route&#x4E2D;&#x7684;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x662F;web&#x8DEF;&#x5F84;templateUrl: &apos;/html/templates/home.template.html&apos;&#x3002;&#x5C31;&#x5BF9;&#x4E0D;&#x4E0A;&#x53F7;&#x4E86;&#x3002;&#x505A;&#x6CD5;&#x662F;&#x901A;&#x8FC7;stripPrefix&#x5C06;&#x6240;&#x6709;&#x7684;&#x524D;&#x7F00;&#x5168;&#x90E8;&#x5265;&#x53BB;&#xFF0C;&#x7136;&#x540E;&#x7528;prependPrefix&#x52A0;&#x4E0A;&#x9700;&#x8981;&#x7684;&#x524D;&#x7F00;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;&#x7F51;&#x4E0A;&#x6709;&#x5F88;&#x591A;&#x5E16;&#x5B50;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x5217;&#x4E24;&#x4E2A;&#x6709;&#x542F;&#x53D1;&#x6027;&#x7684;&#xFF1A;Unit Testing AngularJS directive with templateUrlKarma &#x2018;Unexpected Request&#x2019; when testing angular directive, even with ng-html2js%23%20Angular%20JS%20-%20unit%20test%0A@%28myblog%29%5Bangular%2C%20unittest%5D%0A%u524D%u7AEF%u4EE3%u7801%u4E00%u76F4%u6CA1%u6709%u505Aunit%20testing%uFF0C%u4E5F%u4E0D%u77E5%u9053%u600E%u4E48%u505A%u3002%u5728Yaakov%20Chaikin%u7684%5BCoursera%u8BFE%u7A0B%5D%28https%3A//www.coursera.org/learn/single-page-web-apps-with-angularjs/home/week/5%29%u4E2D%uFF0C%u7B2C%u4E94%u7AE0%u6B63%u597D%u4ECB%u7ECD%u4E86%u76F8%u5173%u5185%u5BB9%u3002%u6240%u4EE5%u5C31%u987A%u4FBF%u5728%u81EA%u5DF1%u7684%u9879%u76EE%u4E2D%u5B9E%u8DF5%u4E86%u4E00%u628A%u3002%u65E0%u6570%u6B21%u7684%u5B9E%u8DF5%u8BC1%u660E%uFF0C%u770B%u5F97%u5934%u5934%u662F%u9053%uFF0C%u5199%u8D77%u6765%u5C31%u5230%u5904%u662F%u5751%u3002%u5C0F%u5C0F%u7684%u5185%u5BB9%uFF0C%u7740%u5B9E%u82B1%u4E86%u4E0D%u5C11%u65F6%u95F4%u3002%0A%0A%u9488%u5BF9%u524D%u7AEF%u7684%u4EE3%u7801%uFF0C%u7F51%u4E0A%u91C7%u7528%u7684%u6D4B%u8BD5%u6846%u67B6%u5927%u591A%u662Fkarma%20+%20jasmine%20+%20chai%u3002%u56E0%u4E3A%u6211%u4E4B%u524D%u5728%u540E%u7AEF%u4EE3%u7801%u7684%u6D4B%u8BD5%u4E2D%u591A%u91C7%u7528mocha%20+%20should%20+%20sinon%u3002%u6240%u4EE5%u672C%u6B21%u5B9E%u8DF5%uFF0C%u4ECD%u7136%u7231%u91C7%u7528mocha%u6846%u67B6%uFF0C%u6765%u642D%u914Dkarma%u4F7F%u7528%u3002%0A%0Akarma%u662F%u4E00%u4E2A%u81EA%u52A8%u5316%u6D4B%u8BD5%u6846%u67B6%u3002%u56E0%u5176%u4E30%u5BCC%u7684%u914D%u7F6E%u9009%u9879%uFF0C%u826F%u597D%u7684%u6269%u5C55%u6027%u80FD%uFF0C%u88AB%u5E7F%u6CDB%u5E94%u7528%uFF0C%u5C24%u5176%u662F%u5728%u524D%u7AEF%u3002%u56E0%u4E3A%u524D%u7AEF%u8981%u9488%u5BF9%u5404%u79CD%u7248%u672C%u7684%u6D4F%u89C8%u5668%uFF0C%u5404%u79CD%u6846%u67B6%uFF0C%u5982%u679C%u5168%u90E8%u9760%u624B%u52A8%u53BB%u9002%u914D%uFF0C%u57FA%u672C%u4E0D%u592A%u53EF%u80FD%u3002%u6240%u4EE5%u5927%u5BB6%u90FD%u7528karma%u4E86%u3002%0A%23%23%20karma%20setup%0A%u57FA%u672C%u914D%u7F6E%u53C2%u8003%5B%u524D%u7AEF%u5355%u5143%u6D4B%u8BD5%u4E4BKarma%u73AF%u5883%u642D%u5EFA%5D%28https%3A//segmentfault.com/a/1190000006895064%29%0A%0A%u914D%u7F6E%u6587%u4EF6%u7B80%u5355%u5982%u4E0B%uFF1A%0A%60%60%60javascript%0Amodule.exports%20%3D%20function%28config%29%20%7B%0A%20%20config.set%28%7B%0A%0A%20%20%20%20//%20base%20path%20that%20will%20be%20used%20to%20resolve%20all%20patterns%20%28eg.%20files%2C%20exclude%29%0A%20%20%20%20basePath%3A%20%27%27%2C%0A%0A%0A%20%20%20%20//%20frameworks%20to%20use%0A%20%20%20%20//%20available%20frameworks%3A%20https%3A//npmjs.org/browse/keyword/karma-adapter%0A%20%20%20%20frameworks%3A%20%5B...%5D%2C%0A%0A%0A%20%20%20%20//%20list%20of%20files%20/%20patterns%20to%20load%20in%20the%20browser%0A%20%20%20%20files%3A%20%5B%0A%20%20%20%20%20%20%27...%27%2C%0A%20%20%20%20%20%20%7Bpattern%3A%20%27...%27%7D%0A%20%20%20%20%5D%2C%0A%0A%0A%20%20%20%20//%20list%20of%20files%20to%20exclude%0A%20%20%20%20exclude%3A%20%5B%0A%20%20%20%20%5D%2C%0A%0A%0A%20%20%20%20//%20preprocess%20matching%20files%20before%20serving%20them%20to%20the%20browser%0A%20%20%20%20//%20available%20preprocessors%3A%20https%3A//npmjs.org/browse/keyword/karma-preprocessor%0A%20%20%20%20preprocessors%3A%20%7B%0A%20%20%20%20%7D%2C%0A%0A%0A%20%20%20%20//%20test%20results%20reporter%20to%20use%0A%20%20%20%20//%20possible%20values%3A%20%27dots%27%2C%20%27progress%27%0A%20%20%20%20//%20available%20reporters%3A%20https%3A//npmjs.org/browse/keyword/karma-reporter%0A%20%20%20%20reporters%3A%20%5B%27progress%27%5D%2C%0A%0A%0A%20%20%20%20//%20web%20server%20port%0A%20%20%20%20port%3A%209876%2C%0A%0A%0A%20%20%20%20//%20enable%20/%20disable%20colors%20in%20the%20output%20%28reporters%20and%20logs%29%0A%20%20%20%20colors%3A%20true%2C%0A%0A%0A%20%20%20%20//%20level%20of%20logging%0A%20%20%20%20//%20possible%20values%3A%20config.LOG_DISABLE%20%7C%7C%20config.LOG_ERROR%20%7C%7C%20config.LOG_WARN%20%7C%7C%20config.LOG_INFO%20%7C%7C%20config.LOG_DEBUG%0A%20%20%20%20logLevel%3A%20config.LOG_INFO%2C%0A%0A%0A%20%20%20%20//%20enable%20/%20disable%20watching%20file%20and%20executing%20tests%20whenever%20any%20file%20changes%0A%20%20%20%20autoWatch%3A%20true%2C%0A%0A%0A%20%20%20%20//%20start%20these%20browsers%0A%20%20%20%20//%20available%20browser%20launchers%3A%20https%3A//npmjs.org/browse/keyword/karma-launcher%0A%20%20%20%20browsers%3A%20%5B%27...%27%5D%2C%0A%0A%0A%20%20%20%20//%20Continuous%20Integration%20mode%0A%20%20%20%20//%20if%20true%2C%20Karma%20captures%20browsers%2C%20runs%20the%20tests%20and%20exits%0A%20%20%20%20singleRun%3A%20false%2C%0A%0A%20%20%20%20//%20Concurrency%20level%0A%20%20%20%20//%20how%20many%20browser%20should%20be%20started%20simultaneous%0A%20%20%20%20concurrency%3A%20Infinity%2C%0A%0A%20%20%20%20//%20Which%20plugins%20to%20enable%0A%20%20%20%20plugins%3A%20%5B%5D%0A%20%20%7D%29%0A%7D%20%0A%60%60%60%0A%0A%u7B80%u5355%u7684%u89E3%u91CA%u76EE%u524D%u7528%u5230%u7684%u9009%u9879%uFF1A%0A-%20frameworks%3A%20%u4F7F%u7528%u5230%u7684%u6846%u67B6%uFF0C%u6240%u6709%u4F7F%u7528%u5230%u7684%uFF0C%u8981%u5728%u4E0B%u9762plugins%u4E2D%u5217%u660E%u3002%u6BD4%u5982%uFF1Aframeworks%u4E2D%u5305%u542Bmocha%uFF0C%u5219plugins%u4E0B%u5C31%u8981%u5305%u542Bkarma-mocha%0A-%20basePath%2C%20files%2C%20exclude%3A%20%u8FD9%u4E09%u4E2A%u6307%u660E%u4E86karma%u8981%u52A0%u8F7D%u7684JS%u6587%u4EF6%0A%09-%20basePath%uFF1A%u57FA%u7840%u76EE%u5F55%uFF0C%u4F1A%u76F4%u63A5%u63D2%u5165%u5230files%uFF0Cexclude%u6307%u5B9A%u7684%u8DEF%u5F84%u524D%u9762%0A%09-%20files%uFF1A%u52A0%u8F7D%u6587%u4EF6%uFF0C%u652F%u6301%u901A%u914D%u7B26%u548C%u6B63%u5219%u5F0F%uFF0C%u901A%u8FC7%u5927%u62EC%u53F7%u8FD8%u53EF%u4EE5%u6DFB%u52A0%u914D%u7F6E%u9009%u9879%u3002%u901A%u914D%u7B26%27%5C*%5C*%27%u8868%u793A%u6240%u6709%u76EE%u5F55%uFF0C%27%5C*%27%u8868%u793A%u6240%u6709%u6587%u4EF6%uFF0C%27%5C*%5C*/*%27%u8868%u793A%u5176%u4E0B%u6240%u6709%u76EE%u5F55%u6240%u6709%u6587%u4EF6%u3002%0A%09-%20exclude%3A%20%u53EF%u4EE5%u5254%u9664files%u4E2D%u4E0D%u60F3%u8981%u7684%u6587%u4EF6%0A-%20browsers%uFF1A%u4F7F%u7528%u7684%u6D4F%u89C8%u5668%uFF0C%u5982%u679C%u60F3%u8981headless%u6D4B%u8BD5%u5219%u53EF%u7528PhantomJS%0A%0A%23%23%23%20karma%20with%20ES6%0A%u56E0%u4E3APhantomJS%u4E0D%u652F%u6301ES6%u8BED%u6CD5%28%u7F51%u4E0A%u8BF4%uFF0CPhantomJS%u751A%u81F3%u5BF9ES5%u7684%u652F%u6301%u90FD%u4E0D%u662F%u5F88%u597D%29%uFF0C%u6240%u4EE5karma%u8981%u6D4B%u8BD5%u5305%u542BES6%u8BED%u6CD5%u7684%u4EE3%u7801%uFF0C%u8FD8%u9700%u8981%u4E00%u756A%u914D%u7F6E%u3002%u7F51%u4E0A%u76F8%u5173%u7684%u5E16%u5B50%u5F88%u591A%uFF0C%u5217%u4E3E%u5982%u4E0B%uFF1A%0A-%20%5BTesting%20ES6%20with%20Karma%2C%20RequireJS%2C%20and%20Angular%5D%28http%3A//radify.io/blog/announcing-karma-es6-shim/%29%20%20-%20karma-es6-shim%20%0A-%20%5BHow%20to%20Start%20Writing%20Your%20AngularJS%20Tests%20in%20ES6%5D%28https%3A//www.barbarianmeetscoding.com/blog/2015/11/16/how-to-start-writing-your-angular-js-tests-in-es6/%29%20-%20karma-babel-preprocessor%0A-%20%5BWriting%20Jasmine%20Unit%20Tests%20In%20ES6%5D%28http%3A//www.syntaxsuccess.com/viewarticle/writing-jasmine-unit-tests-in-es6%29%20-%20webpack%0A%0A%u603B%u7684%u6765%u8BF4%uFF0C%u6709%u8FD9%u4E48%u51E0%u79CD%u89E3%u51B3%u65B9%u6848%uFF1A%0A-%20karma-es6-shim%0A-%20karma-babel-preprocessor%0A-%20webpack%0A-%20SlimerJS%0A%u524D%u4E09%u79CD%u6709%u70B9%u590D%u6742%uFF0C%u76EE%u524D%u7684%u6211%u7684%u6280%u672F%u6808%u8FD8%u65E0%u6CD5%u7406%u89E3%u3002%u6700%u7EC8%u9009%u62E9%u6700%u7B80%u5355%u7684SlimerJS%u3002%u5728Linux%u4E0A%u53EF%u4EE5%u901A%u8FC7Xvfb%u505A%u5230headless%u6D4B%u8BD5%uFF0CWindows%u4E0A%u5C31%u8FD9%u6837%u5427%uFF0C%u8DF3%u4E2A%u7A97%u53E3%u4E5F%u4E0D%u662F%u4EC0%u4E48%u5927%u4E8B%u3002%0A%0A%23%23%23%20Debug%20karma%20test%20using%20Chrome%0A%u8FD9%u4E2A%u5728%u521D%u5B66%u7684%u65F6%u5019%u8FD8%u662F%u5F88%u91CD%u8981%u7684%uFF0C%u5982%u679C%u6CA1%u6709%u8FD9%u4E2A%u5DE5%u5177%uFF0C%u6050%u6015%u6211%u4E5F%u8DF3%u4E0D%u51FA%u81EA%u5DF1%u7ED9%u81EA%u5DF1%u6316%u7684%u5927%u5751%u3002%0A%u53C2%u8003%u94FE%u63A5%uFF1A%5BDebugging%20Karma%20Unit%20Tests%5D%28https%3A//glebbahmutov.com/blog/debugging-karma-unit-tests/index.html%29%0A%u6309%u7167%u4E0A%u9762%u7684%u6B65%u9AA4%u6253%u5F00%u8C03%u8BD5%u9875%u9762%u548CChrome%20Dev%20Tool%u9875%u9762%uFF0C%u5237%u65B0%u9875%u9762%u5373%u53EF%u91CD%u65B0%u52A0%u8F7D%u4EE3%u7801%u5E76%u89E6%u53D1%u65AD%u70B9%u3002%0A%u5C06%u547D%u4EE4%u884C%u5199%u5165package.json%uFF0C%u4EE5%u540E%u8C03%u7528npm%u5C31%u53EF%u4EE5%u65B9%u4FBF%u7684%u6253%u5F00%u8BE5%u8C03%u8BD5%u5DE5%u5177%u3002%0A%60%60%60%0A%7B%0A...%0A%20%20%22scripts%22%3A%20%7B%0A%20%20%20%20%22start%22%3A%20%22node%20./bin/www%22%2C%0A%20%20%20%20%22karma-debug%22%3A%20%22cd%20public/js%20%26%26%20karma%20start%20--browsers%3DChrome%20--single-run%3Dfalse%20--debug%22%0A%20%20%7D%2C%20%0A%20%20...%0A%7D%0A%60%60%60%0A%23%23%20ngMock%0AngMock%u4E2D%u4E24%u4E2A%u6700%u91CD%u8981%u7684%u5173%u952E%u8BCD%u5C31%u662F%uFF1Amodule%2C%20inject%u3002%u53EF%u4EE5%u53C2%u8003%u8FD9%u4E2A%u4EBA%u7684%u535A%u5BA2%uFF1A%0A-%20%5BngMock%20Fundamentals%20for%20AngularJS%20-%20Understanding%20Inject%5D%28http%3A//www.bradoncode.com/blog/2015/05/27/ngmock-fundamentals-angularjs-testing-inject/%29%0A-%20%5BngMock%20Fundamentals%20for%20AngularJS%20Unit%20Testing%20-%20Understanding%20Module%5D%28http%3A//www.bradoncode.com/blog/2015/05/24/ngmock-fundamentals-angularjs-unit-testing/%29%0A%0AngMock%u901A%u8FC7module%u52A0%u8F7D%u5DF2%u7ECF%u5B9A%u4E49%u4E86%u7684%u6A21%u5757%uFF0C%u6216%u8005%u5B9A%u4E49%u533F%u540Dmodule%u5E76%u63D0%u4F9B%u65B0%u7684service%uFF0C%u6216%u8005%u590D%u5199%u5DF2%u5B58%u5728%u7684service%u3002module%u53EA%u662F%u5C06%u540D%u5B57%uFF0C%u4EE5%u53CA%u5BF9%u5E94%u4F4D%u7F6E%u5B58%u5165%u4E00%u4E2A%u6570%u7EC4%u3002inject%u5C06%u771F%u6B63%u7684%u52A0%u8F7D%u6240%u6709module%u63D0%u4F9B%u7684service%uFF0C%u5E76%u89E3%u51B3%u4F9D%u8D56%u5173%u7CFB%uFF0C%u8FD8%u53EF%u4EE5%u5C06%u76F8%u5E94%u7684service%u5BFC%u51FA%u5230test%20case%u4E2D%u4F7F%u7528%u3002%u5176%u5B9EngMock%u4E5F%u5C31%u662F%u505A%u4E86%u8FD9%u4E24%u4EF6%u4E8B%u60C5%u3002%0A%u4E0B%u9762%u7B80%u5355%u4ECB%u7ECD%u4E00%u4E9B%u6709%u52A9%u4E8E%u7406%u89E3%u7684%u77E5%u8BC6%u70B9%u3002%0A%23%23%23%20angular.mock.module%0Amodule%u51FD%u6570%u7684%u539F%u578B%u662F%60angular.mock.module%28alias%2C%20obj%2C%20func%29%60%0Amodule%u63A5%u53D7%u4E09%u79CD%u53C2%u6570%u7C7B%u578B%uFF0C%u6BCF%u4E00%u79CD%u90FD%u53EF%u4EE5%u5355%u72EC%u4F7F%u7528%uFF0C%u7528%u6765%u5B9A%u4E49%u6216%u52A0%u8F7D%u5BF9%u5E94%u6A21%u5757%0A-%20alias%3A%20%u662Fmodule%u540D%u5B57%u5B57%u7B26%u4E32%uFF0C%u53EF%u4EE5%u662F%u5728%u5F85%u6D4B%u4EE3%u7801%u4E2D%u5B9A%u4E49%u7684%uFF0C%u4E5F%u53EF%u4EE5%u662F%u5728%u6D4B%u8BD5%u6587%u4EF6%u4E2D%u5B9A%u4E49%u7684%0A-%20obj%3A%20%u4E00%u4E2A%u666E%u901A%u7684%u5B57%u5178%u7ED3%u6784%uFF0C%u4ED6%u4F1A%u751F%u6210%u4E00%u4E2A%u533F%u540Dmodule%uFF0C%u5176%u4E2D%u7684%u6210%u5458%u4F1A%u88AB%u5B9A%u4E49%u6210%60%24provide.value%28%29%60%0A-%20function%3A%20%u540C%u6837%u662F%u5B9A%u4E49%u4E00%u4E2A%u533F%u540Dmodule%uFF0C%u4E0D%u540C%u7684%u662F%uFF0Cfunction%u53EF%u4EE5%u7528%24provide%u4F5C%u4E3A%u53C2%u6570%uFF0C%u6765%u5B9A%u4E49%u5404%u79CD%u5404%u6837%u7684service%u3002%0A%0A%3E**function%28%29%20vs%20Object**%0A%0A%3EThe%20examples%20we%20used%20were%20similar%2C%20so%20what%u2019s%20the%20key%20difference%20between%20the%20function%28%29%20and%20Object%20form%3F%20As%20the%20Object%20type%20gets%20added%20as%20a%20%24provider.value%2C%20it%20is%20therefore%20restricted%20to%20the%20capabilities%20of%20the%20value%20service%2C%20most%20importantly%20that%20a%20value%20service%20cannot%20be%20injected%20with%20other%20services.%0A%0A%u5173%u4E8E%24provide%uFF0C%u53EF%u4EE5%u53C2%u8003%5BAngular%u5B98%u65B9%u6587%u6863%5D%28https%3A//docs.angularjs.org/api/auto/service/%5C%24provide%29%0A%3EThe%20**%5C%24provide**%20service%20has%20a%20number%20of%20methods%20for%20registering%20components%20with%20the%20**%5C%24injector**.%20Many%20of%20these%20functions%20are%20also%20exposed%20on%20angular.Module.%0A%0A%u5B83%u63D0%u4F9B%u4E86%u4E0B%u9762%u7684%u8FD9%u4E9Bservice%0A%0A%3E**provider**%28name%2C%20provider%29%20-%20registers%20a%20service%20provider%20with%20the%20%5C%24injector%0A**constant**%28name%2C%20obj%29%20-%20registers%20a%20value/object%20that%20can%20be%20accessed%20by%20providers%20and%20services.%0A**value**%28name%2C%20obj%29%20-%20registers%20a%20value/object%20that%20can%20only%20be%20accessed%20by%20services%2C%20not%20providers.%0A**factory**%28name%2C%20fn%29%20-%20registers%20a%20service%20factory%20function%20that%20will%20be%20wrapped%20in%20a%20service%20provider%20object%2C%20whose%20%5C%24get%20property%20will%20contain%20the%20given%20factory%20function.%0A**service**%28name%2C%20Fn%29%20-%20registers%20a%20constructor%20function%20that%20will%20be%20wrapped%20in%20a%20service%20provider%20object%2C%20whose%20%5C%24get%20property%20will%20instantiate%20a%20new%20object%20using%20the%20given%20constructor%20function.%0A**decorator**%28name%2C%20decorFn%29%20-%20registers%20a%20decorator%20function%20that%20will%20be%20able%20to%20modify%20or%20replace%20the%20implementation%20of%20another%20service.%0A%0A%23%23%23%20angular.mock.inject%0A%5C%24inject%u662FngMock%u7684%u6838%u5FC3%uFF0C%u770B%u770B%u5B98%u65B9%u7684%u5B9A%u4E49%0A%3EThe%20inject%20function%20wraps%20a%20function%20into%20an%20injectable%20function.%20The%20inject%28%29%20creates%20new%20instance%20of%20%24injector%20per%20test%2C%20which%20is%20then%20used%20for%20resolving%20references.%0A%0Ainject%u5C31%u662F%u5B9A%u4E49%u4E86%u4E00%u4E2Ainjector%uFF0C%u90A3injector%u53C8%u662F%u4EC0%u4E48%0A%3E%5C%24injector%20is%20used%20to%20retrieve%20object%20instances%20as%20defined%20by%20provider%2C%20instantiate%20types%2C%20invoke%20methods%2C%20and%20load%20modules.%0A%0A%5C%24injector%u4E5F%u5C31%u662FAngularJS%u7684%u6838%u5FC3%u3002%u5B83%u63D0%u4F9B%u4E86%u6240%u8C13%u7684%u201CDI%22%20%28Dependency%20Injection%29%u6A21%u5F0F%u3002Angular%u7684%u6838%u5FC3%u4EE3%u7801%u901A%u8FC7%5C%24injector%u6765%u83B7%u53D6%u5BF9%u5E94service%u7684reference%u3002%0A%u6211%u4EEC%u901A%u5E38%u5C06inject%u653E%u5728beforeEach%u91CC%uFF0C%u8FD9%u6837inject%u5C31%u4E3A%u6BCF%u4E2A%u6D4B%u8BD5%u5B9A%u4E49%u4E00%u4E2Ainjector%uFF0C%u4E3A%u8FD9%u4E2Ainjector%u51C6%u5907%u597D%u6240%u6709%u7684service%uFF0C%u5E76%u80FD%u901A%u8FC7%u53C2%u6570%u5C06%u4EFB%u610F%u5DF2%u6709%u7684service%u5BFC%u51FA%u3002%0A%0A%23%23%23%20Test%20controllers%0A%u4E86%u89E3%u4E86%u4E0A%u9762%u7684%u4E24%u4E2A%u91CD%u8981%u7EC4%u4EF6%u4E4B%u540E%uFF0C%u9488%u5BF9%u4E0D%u540C%u7684%u6D4B%u8BD5%u7EC4%u4EF6%u5C31%u5BB9%u6613%u7406%u89E3%u4E86%u3002%0A%u76F4%u63A5%u4E0A%u4EE3%u7801%uFF1A%0A%60%60%60javascript%0Adescribe%28%27main%20controller%27%2C%20function%28%29%20%7B%0A%20%20var%20%24controller%0A%20%20var%20mainCtrl%0A%20%20beforeEach%28%27set%20up%20module%27%2C%20function%28%29%20%7B%0A%20%20%20%20module%28function%20%28%24provide%29%20%7B%0A%20%20%20%20%20%20%24provide.service%28%27MockDataService%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20const%20service%20%3D%20this%0A%20%20%20%20%20%20%20%20service.data%20%3D%20%27test%20data%27%0A%20%20%20%20%20%20%7D%29%0A%20%20%20%20%7D%29%0A%0A%20%20%20%20module%28%27MainModule%27%29%0A%20%20%7D%29%3B%0A%0A%20%20beforeEach%28%27set%20up%20controller%27%2C%20inject%28function%20%28_%24controller_%2C%20MockDataService%29%20%7B%0A%20%20%20%20%24controller%20%3D%20_%24controller_%0A%20%20%20%20mainCtrl%20%3D%20%24controller%28%27MainController%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20DataService%3A%20MockDataService%0A%20%20%20%20%7D%29%0A%20%20%7D%29%29%20%0A%0A%20%20it%28%27should%20assemble%20print%20page%20URL%20correctly%27%2C%20function%28%29%20%7B%0A%20%20%20%20mainCtrl.getData%28%29.should.equal%28%27test%20data%27%29%0A%20%20%7D%29%3B%0A%7D%29%3B%0A%60%60%60%0A%u8FD9%u91CC%u53EA%u6709%u4E24%u4E2A%u503C%u5F97%u6CE8%u610F%u7684%u5730%u65B9%uFF0C%u5176%u5B9E%u524D%u6587%u4E5F%u90FD%u6709%u63D0%u53CA%u3002%0A1.%20%u7B2C%u4E00%u4E2Amodule%u4E2D%u901A%u8FC7%5C%24provide%u63D0%u4F9B%u4E86%u4E00%u4E2A%u5047%u7684service%uFF0C%u8FD9%u4E2Aservice%u53EF%u4EE5%u901A%u8FC7%u5176%u540D%u5B57%u88ABinject%u3002%0A2.%20inject%u4E2D%u901A%u8FC7%5C_%5C%24controller%5C_%u6765%u5BFC%u51FAcontroller%u7684%u6784%u9020%u51FD%u6570%u3002%u901A%u8FC7%u8FD9%u4E2A%u6784%u9020%u51FD%u6570%u6765%u6784%u9020%u76F8%u5E94%u7684%u5F85%u6D4Bcontroller%uFF0C%u5E76%u4F20%u5165%u5047%u7684service%u8FBE%u5230mock%u7684%u76EE%u7684%u3002%0A%0A%23%23%23%20Test%20services%0A%u4ECD%u7136%u76F4%u63A5%u4E0A%u4EE3%u7801%uFF1A%0A%60%60%60%20javascript%0Aangular.module%28%27PrinterData%27%2C%20%5B%5D%29%0A.config%28%5B%27%24locationProvider%27%2C%20function%28%24locationProvider%29%20%7B%0A%20%20%24locationProvider.html5Mode%28true%29%3B%0A%7D%5D%29%3B%0A%60%60%60%0A%60%60%60javascript%0Adescribe%28%27printer%20data%20service%27%2C%20function%28%29%20%7B%0A%20%20var%20%24httpBackend%0A%20%20var%20PrinterDataService%0A%20%20beforeEach%28function%28%29%7B%0A%20%20%20%20module%28function%20%28%24provide%29%20%7B%0A%20%20%20%20%20%20%24provide.provider%28%27%24location%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20const%20provider%20%3D%20this%0A%20%20%20%20%20%20%20%20const%20location%20%3D%20%7B%7D%0A%20%20%20%20%20%20%20%20location.search%20%3D%20function%20%28%29%7B%0A%20%20%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20id%3A%20%27test%20id%27%2C%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20provider.html5Mode%20%3D%20sinon.stub%28%29%0A%20%20%20%20%20%20%20%20provider.%24get%20%3D%20sinon.stub%28%29.returns%28location%29%0A%20%20%20%20%20%20%7D%29%0A%20%20%20%20%7D%29%0A%20%20%7D%29%3B%0A%20%20beforeEach%28function%28%29%20%7B%0A%20%20%20%20module%28%27Data%27%29%0A%20%20%20%20inject%28function%20%28%24injector%29%20%7B%0A%20%20%20%20%20%20%24httpBackend%20%3D%20%24injector.get%28%27%24httpBackend%27%29%0A%20%20%20%20%20%20DataService%20%3D%20%24injector.get%28%27DataService%27%29%0A%20%20%20%20%7D%29%0A%20%20%7D%29%3B%0A%0A%20%20it%28%27should%20update%20if%20succeeds%27%2C%20function%28done%29%20%7B%0A%20%20%20%20%24httpBackend.whenGET%28/.*/%29%0A%20%20%20%20%20%20.respond%28%7B%0A%20%20%20%20%20%20%20%20status%3A%20%27ready%27%0A%20%20%20%20%20%20%7D%29%0A%20%20%20%20DataService.getStatus%28%29.then%28function%20%28data%29%20%7B%0A%20%20%20%20%20%20data.should.deepEqual%28%7B%0A%20%20%20%20%20%20%20%20status%3A%20%27ready%27%0A%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20done%28%29%0A%20%20%20%20%7D%29.catch%28function%20%28err%29%20%7B%0A%20%20%20%20%20%20should.not.exist%28err%29%0A%20%20%20%20%7D%29%0A%20%20%20%20%0A%20%20%20%20%24httpBackend.flush%28%29%3B%0A%20%20%7D%29%3B%0A%7D%29%0A%60%60%60%0A%u4E0B%u9762%u7F57%u5217%u4E00%u4E9B%u5B9E%u9645%u4F7F%u7528%u4E2D%u78B0%u5230%u7684%u4E00%u4E9B%u95EE%u9898%uFF0C%u4EE5%u53CA%u81EA%u5DF1%u7684%u4E00%u4E9B%u7406%u89E3%u3002%0A%0A%23%23%23%23%20%u4F7F%u7528%5C%24injector%0A%u6211%u4EEC%u8BF4%u8FC7inject%u51FD%u6570%u5C31%u662F%u7528%u6765%u521B%u5EFA%5C%24injector%uFF0C%u6240%u4EE5%5C%24injector%u4E5F%u662F%u53EF%u4EE5%u76F4%u63A5%u88AB%u5BFC%u51FA%u4F7F%u7528%u7684%u3002%u8FD9%u65F6%u9700%u8981%u4EC0%u4E48service%uFF0C%u5C31%u53EF%u4EE5%u76F4%u63A5%u8C03%u7528%5C%24injector.get%u3002%u4E3A%u4EC0%u4E48%u4E0D%u76F4%u63A5%u901A%u8FC7%u53C2%u6570%u6765inject%u5462%uFF1F%u5F53%u7136%u662F%u56E0%u4E3A%u53C2%u6570%u592A%u957F%u4E86%uFF0C%u4E0D%u597D%u770B%u3002%u3002%u3002%0A%23%23%23%23%20mock%20%5C%24http%0A%u4E3A%u4E86%u6D4B%u8BD5%u7A33%u5B9A%u6027%uFF0C%u6211%u4EEC%u5728unit%20test%u4E2D%u5E76%u4E0D%u771F%u6B63%u7684%u8BBF%u95EE%u670D%u52A1%u5668%uFF0C%u800C%u901A%u5E38%u91C7%u7528%u5047%u7684%u670D%u52A1%u5668%u54CD%u5E94%u6765mock%u3002%u8FD9%u5C31%u9700%u8981%u7528%u5230%5C%24httpBackend%20service%u3002%u90A3%u4E48%5C%24http%u548C%5C%24httpBackend%u4E4B%u95F4%u7684%u5173%u7CFB%u662F%u4EC0%u4E48%uFF1F%0A%3EHTTP%20backend%20used%20by%20the%20service%20that%20delegates%20to%20XMLHttpRequest%20object%20or%20JSONP%20and%20deals%20with%20browser%20incompatibilities.%0AYou%20should%20never%20need%20to%20use%20this%20service%20directly%2C%20instead%20use%20the%20higher-level%20abstractions%3A%20%5C%24http%20or%20%5C%24resource.%0ADuring%20testing%20this%20implementation%20is%20swapped%20with%20mock%20%24httpBackend%20which%20can%20be%20trained%20with%20responses.%0A%0A%u5177%u4F53%u505A%u6CD5%uFF0C%u4E0A%u9762%u7684%u4EE3%u7801%u4E2D%u5DF2%u6709%uFF0C%u8282%u5F55%u5982%u4E0B%uFF1A%0A%60%60%60javascript%0AbeforeEach%28function%28%29%20%7B%0A%20%20%20%20module%28%27Data%27%29%0A%20%20%20%20inject%28function%20%28%24injector%29%20%7B%0A%20%20%20%20%20%20%24httpBackend%20%3D%20%24injector.get%28%27%24httpBackend%27%29%0A%20%20%20%20%20%20DataService%20%3D%20%24injector.get%28%27DataService%27%29%0A%20%20%20%20%7D%29%0A%20%20%7D%29%3B%0A%0A%20%20it%28%27should%20update%20if%20succeeds%27%2C%20function%28done%29%20%7B%0A%20%20%20%20%24httpBackend.whenGET%28/.*/%29%0A%20%20%20%20%20%20.respond%28%7B%0A%20%20%20%20%20%20%20%20status%3A%20%27ready%27%0A%20%20%20%20%20%20%7D%29%0A%20%20%20%20DataService.getStatus%28%29.then%28function%20%28data%29%20%7B%0A%20%20%20%20%20%20data.should.deepEqual%28%7B%0A%20%20%20%20%20%20%20%20status%3A%20%27ready%27%0A%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20done%28%29%0A%20%20%20%20%7D%29.catch%28function%20%28err%29%20%7B%0A%20%20%20%20%20%20should.not.exist%28err%29%0A%20%20%20%20%7D%29%0A%20%20%20%20%0A%20%20%20%20%24httpBackend.flush%28%29%3B%0A%20%20%7D%29%3B%0A%60%60%60%0A%u901A%u8FC7%60%24httpBackend.wheGET%28...%29.respond%28...%29%60%u6765%u8BBE%u7F6Emock%20response%u3002%60whenGET%60%u8FD8%u652F%u6301%u6B63%u5219%u5F0F%u3002%0A%u8C03%u7528%u5B8C%u8BF7%u6C42%u51FD%u6570%u540E%u8981%u8BB0%u5F97%60%24httpBackend.flush%28%29%60%u5C06%u8BF7%u6C42%u771F%u6B63%u7684%u53D1%u51FA%u3002%u5426%u5219%u8BF7%u6C42%u5E76%u4E0D%u4F1A%u53D1%u51FA%uFF0C%u76F4%u5230%u8C03%u7528%60flush%28%29%60%u51FD%u6570%uFF0C%u6216%u8005%u6D4B%u8BD5%u8D85%u65F6%u5931%u8D25%u3002%0A%0A%23%23%23%23%20%u5982%u4F55mock%20%5C%24location%20%26%20%5C%24locationProvider%0A%u5F88%u60ED%u6127%u7684%u8BF4%uFF0C%u5728%u8FD9%u4E2A%u95EE%u9898%u4E0A%u6211%u82B1%u4E86%u5F88%u4E45%u5F88%u4E45%u7684%u65F6%u95F4%uFF0C%u641C%u7D22%u4E86%u5927%u91CF%u7684google%u7F51%u9875%uFF0C%u6700%u540E%u8FD8%u662F%u4F9D%u9760chrome%u8FFD%u8E2Aangular%u6838%u5FC3%u4EE3%u7801%u624D%u53D1%u73B0%u539F%u6765%u662F%u81EA%u5DF1%u7ED9%u81EA%u5DF1%u6316%u7684%u5751%uFF0C%u5BF9service%2C%20factory%u548Cprovider%u7406%u89E3%u4E0D%u900F%u5F7B%u3002%0A%u9996%u5148%u6765%u5C31%u4E8B%u8BBA%u4E8B%uFF0C%u8BF4%u4E00%u4E0B%u5230%u5E95%u600E%u4E48%u5B8C%u6210%u6211%u7684%u8FD9%u4E2A%u6D4B%u8BD5%u3002%0A%0A%u56E0%u4E3A%u6211%u8981%u6D4B%u8BD5DataService%uFF0C%u800CDataService%u5B9A%u4E49%u5728Data%20moduleDataService%u8C03%u7528%u4E86%5C%24location%20service%u3002%u9700%u8981%u5C06%u4E4Bmock%u6389%u3002%u6700%u7B80%u5355%u7684%u60F3%u6CD5%u5C31%u662F%u901A%u8FC7inject%u6765%u83B7%u5F97%5C%24location%20service%20reference%u3002%u5E76%u901A%u8FC7sinon.stub%u6765%u8BBE%u7F6E%u9700%u8981%u7684%u8FD4%u56DE%u503C%u3002%0A%0A%60%60%60%0Ainject%28function%20%28%24injector%2C%20%24location%29%20%7B%0A%20%20sinon.stub%28%24location%2C%20%27search%27%29.returns%28%7B%0A%20%20%20%20id%3A%20%27test%20id%27%0A%20%20%7D%29%0A%20%20DataService%20%3D%20%24injector.get%28%27DataService%27%29%0A%7D%29%0A%60%60%60%0A%0A%u4F46%u662F%u6211%u5012%u9709%u50AC%u7684%uFF0C%u7ADF%u7136%u662F%u7528%5C%24provide%u505A%u4E86%uFF1A%0A%60%60%60%0Amodule%28function%20%28%24provide%29%20%7B%0A%20%20%24provide.service%28%27%24location%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20const%20location%20%3D%20this%0A%20%20%20%20location.search%20%3D%20sinon.stub%28%29.returns%28%7B%0A%20%20%20%20%20%20device_id%3A%20%27test%20id%27%2C%0A%20%20%20%20%7D%29%0A%20%20%7D%29%0A%7D%29%0A%60%60%60%0A%u8FD9%u6837%u5C31%u4F1A%u6709%u95EE%u9898%u4E86%uFF0C%u5F53ngMock%u52A0%u8F7D%u8FD9%u4E2A%u6A21%u5757%u7684%u65F6%u5019%uFF0C%u4F1A%u5148%u5B9A%u4E49%u4E00%u4E2A%5C%24locationProvider%uFF0C%u8FD9%u5C31%u4F1A%u8986%u76D6%u5176%u81EA%u5E26%u7684%5C%24locationProvider%u3002%u800C%u5982%u4E0B%u7684module.config%u65B9%u6CD5%u4E2D%u5BF9%5C%24locationProvider%u7684%u64CD%u4F5C%u5C31%u4F1A%u51FA%u73B0%u95EE%u9898%uFF1A%0A%60%60%60%0Aangular.module%28%27PrinterData%27%2C%20%5B%5D%29%0A.config%28%5B%27%24locationProvider%27%2C%20function%28%24locationProvider%29%20%7B%0A%20%20%24locationProvider.html5Mode%28true%29%3B%0A%7D%5D%29%3B%0A%60%60%60%0A%u56E0%u4E3A%u65B0%u5B9A%u4E49%u7684%5C%24locationProvider%u4E2D%u6CA1%u6709html5Mode%u6210%u5458%u3002%u4E8E%u662F%u60F3%u4E86%u5404%u79CD%u529E%u6CD5%u6765mock%20%5C%24locationProvider%u3002%u7ED3%u679C%u56E0%u4E3A%u5BF9service%uFF0Cfactory%uFF0Cprovider%u7684%u7406%u89E3%u4E0D%u6B63%u786E%uFF0C%u90FD%u5931%u8D25%u4E86%u3002%u653E%u4E00%u6BB5%u9519%u8BEF%u7684%u4EE3%u7801%uFF1A%0A%60%60%60%0AbeforeEach%28function%28%29%7B%0A%20%20module%28function%20%28%24provide%29%20%7B%0A%20%20%20%20%24provide.service%28%27%24locationProvider%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20const%20location%20%3D%20this%0A%20%20%20%20%20%20location.html5Mode%20%3D%20function%28%29%7B%7D%0A%20%20%20%20%7D%29%0A%20%20%20%20%24provide.factory%28%27%24location%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20const%20locationProvider%20%3D%20this%0A%20%20%20%20%20%20locationProvider.html5Mode%20%3D%20function%28%29%7B%7D%0A%20%20%20%20%7D%29%0A%7D%29%0A%60%60%60%0A%u7B2C%u4E00%u4E2A%u7528%5C%24provide.service%u4F1A%u5B9A%u4E49%u4E00%u4E2A%5C%24locationProviderProvider%0A%u7B2C%u4E8C%u4E2A%u7528%5C%24provide.factory%u5B9A%u4E49%u4E86%u4E00%u4E2A%5C%24locationProvider%uFF0C%u4F46%u662F%u6CA1%u6709%u8FD4%u56DE%uFF0C%u6240%u4EE5%5C%24location%20service%u4E0D%u4F1A%u88AB%u5B9E%u4F8B%u5316%uFF0C%u4E5F%u5C31%u6CA1%u6709%5C%24location%20service%u4E86%u3002%0A%u5982%u679C%u60F3%u901A%u8FC7mock%20%5C%24locationProvider%u6765mock%20%5C%24location%20service%u7684%u8BDD%uFF0C%u6B63%u786E%u7684%u505A%u6CD5%u5E94%u5F53%u662F%uFF1A%0A%60%60%60%0A%24provide.provider%28%27%24location%27%2C%20function%20%28%29%20%7B%0A%20%20const%20provider%20%3D%20this%0A%20%20const%20location%20%3D%20%7B%7D%0A%20%20location.search%20%3D%20function%20%28%29%7B%0A%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20device_id%3A%20%27test%20id%27%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20provider.html5Mode%20%3D%20sinon.stub%28%29%0A%20%20provider.%24get%20%3D%20sinon.stub%28%29.returns%28location%29%0A%7D%29%0A%60%60%60%0Amock%u6389provider.%5C%24get%u51FD%u6570%uFF0C%u63D0%u4F9B%u5047%u7684location%u670D%u52A1%u3002%u5176%u5B9E%u8FD8%u6709%u5F88%u591A%u529E%u6CD5%uFF0C%u4F8B%u5982%u83B7%u5F97%5C%24locationProvider%u518D%u5BF9%5C%24get%u51FD%u6570%u8FDB%u884Cstub%uFF0C%u4E5F%u53EF%u4EE5%u3002%u6CA1%u6709%u518D%u4E00%u4E00%u5C1D%u8BD5%u4E86%u3002%u7406%u89E3%u4E86%u9519%u8BEF%u548C%u6B63%u786E%u7684%u505A%u6CD5%uFF0C%u60F3%u518D%u53BB%u5B9E%u73B0%u5C31%u5F97%u5FC3%u5E94%u624B%u4E86%u3002%0A%0A%23%23%23%23%20%u6D4B%u8BD5.config/.run%u5757%0AData%20module%u6709%u4E00%u4E2A.config%u5757%uFF0C%u56E0%u4E3A%u6A21%u5757%u52A0%u8F7D%u7684%u65F6%u5019%u4F1A%u5148%u8FD0%u884C%u5176.config%u5757%uFF0C%u7136%u540E%u662F.run%u5757%u3002%u56E0%u5176%u7279%u6B8A%u6027%uFF0C%u6240%u4EE5%u5728%u5BF9%u5176%u4E2D%u4F7F%u7528%u5230%u7684%u670D%u52A1%u8FDB%u884Cmock%u8981%u6CE8%u610F%u987A%u5E8F%u3002%u53EF%u4EE5%u53C2%u8003%u8FD9%u4E2A%u94FE%u63A5%uFF1A%5BTesting%20config%20and%20run%20blocks%20in%20AngularJS%0AHow%20to%20easily%20test%20an%20often%20neglected%20part%20of%20your%20application%5D%28https%3A//medium.com/@a_eife/testing-config-and-run-blocks-in-angularjs-1809bd52977e%29%0A%0A%23%23%23%23%20%u5982%u4F55mock%20%24interval%0A%u5728%u5355%u5143%u6D4B%u8BD5%u4E2D%uFF0C%u6211%u4EEC%u901A%u5E38%u8981%u91C7%u7528mock%u7684%u624B%u6BB5%uFF0C%u800C%u4E0D%u771F%u6B63%u7684%u4F7F%u7528%u65F6%u95F4%u670D%u52A1%u3002%u5728sinon%u4E2D%uFF0C%u53EF%u4EE5%u4F7F%u7528fake%20timer%u6765%u53D6%u4EE3JS%u4E2D%u6807%u51C6%u7684setTimeout%u548CsetInterval%u3002%u4E0D%u8FC7%u8FD9%u4E2A%u5728Angular%20JS%u4E2D%u5E76%u4E0D%u8D77%u4F5C%u7528%uFF0C%u5982%u679C%u6211%u4EEC%u4F7F%u7528%5C%24interval%u670D%u52A1%u7684%u8BDD%u3002%0A%u56E0%u4E3A%u5728%u5BF9Angular%20JS%u505A%u5355%u5143%u6D4B%u8BD5%u7684%u65F6%u5019%uFF0C%5C%24interval%u5E76%u4E0D%u4F1A%u8C03%u7528setInterval%u3002%u539F%u56E0%u662F%u8FD9%u91CC%u7684%5C%24interval%u5176%u5B9E%u662FngMock%u4E2D%u7684%5C%24interval%u3002%u6B64%u65F6%u53EF%u4EE5%u4F7F%u7528%60%24interval.flush%28ms%29%60%u6765%u5C06%u65F6%u949F%u63A8%u8FDB%u82E5%u5E72%u65F6%u95F4%u3002%u5F53%u7136%u5982%u679C%u613F%u610F%uFF0C%u4E5F%u53EF%u4EE5%u7528sinon%u6765mock%u4ECE%5C%24injector%u4E2Dget%u51FA%u6765%u7684%5C%24interval%20service%u3002%5C%24timeout%20service%u4E5F%u7C7B%u4F3C%uFF0C%u6709%u540C%u6837%u7684%u65B9%u6CD5%u5BF9%u4ED8%u5355%u5143%u6D4B%u8BD5%u3002%0A%0A%23%23%23%23%20Promise%20not%20resolve%0A%u5728Angular%20JS%u4E2D%uFF0C%u6211%u4EEC%u5F80%u5F80%u8C03%u7528%5C%24q%20service%u6765%u4F7F%u7528Promise%uFF0C%u800C%5C%24q.defer%28%29.promise%u53EA%u5728%5C%24scope%u7684digest%20cycle%u624D%u4F1A%u5224%u5B9Aresolve%u8FD8%u662Freject%uFF0C%u6240%u4EE5%u8981%u89E6%u53D1%5C%24q%u4EA7%u751F%u7684promise%uFF0C%u4E00%u5B9A%u8981%u8C03%u7528%u5BF9%u5E94%u7684%5C%24scope.%5C%24apply%28%29%u6216%u8005%5C%24scope.%5C%24digest%28%29%u3002stack%20overflow%u4E2D%u4E5F%u6709%u5927%u628A%u7C7B%u4F3C%u95EE%u9898%u7684%u89E3%u7B54%u3002%u5177%u4F53%u4E5F%u53EF%u4EE5%u53C2%u8003%u8FD9%u7BC7%u535A%u5BA2%uFF0C%u8BB2%u5F97%u5F88%u900F%u5F7B%uFF1A%0A-%20%5BUnit%20Testing%20with%20%24q%20Promises%20in%20AngularJS%5D%28http%3A//www.bradoncode.com/blog/2015/07/13/unit-test-promises-angualrjs-q/%29%0A%0A%u5728Angular%20JS%u4E2D%uFF0C%u4E5F%u53EF%u4EE5%u4F7F%u7528%u6807%u51C6%u7684Promise%uFF0C%u4F8B%u5982%3A%20%60var%20promise%20%3D%20new%20Promise%28resolve%2C%20reject%29%60%u3002%u4F46%u662F%u8C8C%u4F3C%uFF0C%u6807%u51C6%u7684Promise%u548C%5Cq%u517C%u5BB9%u7684%u5E76%u4E0D%u5F88%u597D%uFF0C%u4E0B%u9762%u7684code%u5E76%u4E0D%u4F1A%u5DE5%u4F5C%uFF1A%0A%60%60%60%0Avar%20promise%20%3D%20%24q.all%28%5Bpromise1%2C%20promise2%5D%29%0A%24scope.%24apply%28%29%0A%60%60%60%0Apromise%u5E76%u4E0D%u4F1A%u5728promise1%u548Cpromise2%u8FD4%u56DE%u4E4B%u540E%u8FD4%u56DE%uFF0C%u5B9E%u9645%u4E0A%u662F%u4ED6%u6839%u672C%u5C31%u4E0D%u4F1A%u8FD4%u56DE%uFF0C%u76F4%u5230%u6D4B%u8BD5%u8D85%u65F6%u5931%u8D25%u3002%0A%0A%23%23%23%23%20%22Unexpected%20request%3A%20GET%20.../.html%22%20on%20Karma%20tests%0A%u8FD9%u662FYaakov%u5728%u89C6%u9891%u4E2D%u63D0%u5230%u7684%u9700%u8981%u4F7F%u7528%5C%24templateCache%u7684%u60C5%u5F62%u3002Yaakov%u63D0%u5230%u7528karma%u662F%u89E3%u51B3%u8BE5%u95EE%u9898%u6700%u597D%u7684%u529E%u6CD5%uFF0C%u4F46%u662F%u56E0%u4E3A%u89C6%u9891%u5E76%u4E0D%u6D89%u53CA%u4ECB%u7ECDkarma%uFF0C%u6240%u4EE5%u5E76%u6CA1%u6709%u8BF4%u5E94%u8BE5%u600E%u4E48%u505A%u3002%0A%u5F53%u6211%u4EEC%u7684karma%20test%u52A0%u8F7D%u4E86route.js%uFF0C%u5E76%u5728%u5176%u4E2D%u5B9A%u4E49%u4E86component%uFF0C%u5219%u6D4B%u8BD5%u5728%u5B9E%u4F8B%u5316%u8BE5Angular%20component%u7684%u65F6%u5019%u56DE%u53BB%u7528%5C%24http%20service%u6765GET%u8BE5template%20html%u6587%u4EF6%uFF0C%u4E8E%u662F%u4EA7%u751F%u4E86%u8BE5unexpected%20request%u9519%u8BEF%u3002Yaakov%u5728%u6559%u7A0B%u4E2D%u7684%u89E3%u51B3%u529E%u6CD5%u662F%uFF0C%u901A%u8FC7%u4E00%u6B21%u771F%u6B63%u7684AJAX%u4ECE%u670D%u52A1%u5668%u4E0A%u8BF7%u6C42%u8BE5html%uFF0C%u5E76%u5C06%u4E4B%u5B58%u5165%5C%24templateCache%u4E2D%uFF0C%u4E4B%u540E%u5C31%u4E0D%u4F1A%u518D%u6709%u771F%u6B63%u7684GET%20AJAX%u4EA7%u751F%u4E86%u3002%u5176%u5B9E%u8FD9%u4E00%u6BB5%u53EF%u4EE5%u901A%u8FC7%u914D%u7F6Ekarma%u6765%u5B9E%u73B0%u3002%u5177%u4F53%u505A%u6CD5%u5982%u4E0B%uFF1A%0A-%20%u5B89%u88C5ng-html2js%uFF0Ckarma-ng-html2js-preprocessor%0A-%20%u4F7F%u7528ng-html2js%u5C06%u5BF9%u5E94%u7684template%20html%u8F6C%u6210js%u6A21%u5757%uFF0C%u5E76%u5728%u6D4B%u8BD5%u4EE3%u7801%u4E2D%u5F15%u5165%u3002%0A%0A%u770B%u4E0B%u9762%u5177%u4F53%u4EE3%u7801%0Akarma.conf.js%0A%60%60%60%0A//%20list%20of%20files%20/%20patterns%20to%20load%20in%20the%20browser%0Afiles%3A%20%5B%0A%20%20%27../html/templates/*.html%27%2C%0A%20%20...%0A%5D%2C%0A%0A//%20preprocess%20matching%20files%20before%20serving%20them%20to%20the%20browser%0A//%20available%20preprocessors%3A%20https%3A//npmjs.org/browse/keyword/karma-preprocessor%0Apreprocessors%3A%20%7B%0A%20%20%27../html/templates/home.template.html%27%3A%20%5B%27ng-html2js%27%5D%0A%7D%2C%0A%0AngHtml2JsPreprocessor%3A%20%7B%0A%20%20moduleName%3A%20%27templates%27%2C%0A%20%20stripPrefix%3A%20%27.*/%27%2C%0A%20%20prependPrefix%3A%20%27/html/templates/%27%0A%7D%2C%20%0A%60%60%60%0Atest.js%0A%60%60%60%0Adescribe%28function%28%29%7B%0A%20%20beforeEach%28module%28%27templates%27%29%29%0A%7D%29%0A%60%60%60%0A%u7279%u522B%u8981%u6CE8%u610F%u7684%u662F%u5BF9ng-html2js%u7684%u914D%u7F6E%0A%60%60%60%0AngHtml2JsPreprocessor%3A%20%7B%0A%20%20moduleName%3A%20%27templates%27%2C%0A%20%20stripPrefix%3A%20%27.*/%27%2C%0A%20%20prependPrefix%3A%20%27/html/templates/%27%0A%7D%2C%20%0A%60%60%60%0A%u5F53%u6CA1%u6709%60stripPrefix%60%u9009%u9879%u65F6%uFF0C%u901A%u8FC7Chrome%20debug%u53EF%u4EE5%u770B%u5230%uFF0C%u6240%u6709%u7684template%u90FD%u88AB%u8F6C%u5316%u6210%u4E86js%u6A21%u5757%uFF0C%u4F46%u662F%u5176%u6A21%u5757%u540D%u662F%u7C7B%u4F3C%60c%3A%5Cpath%5Cto%5Ctemplate%5Ctemplate.html%60%u7684%u7ED3%u6784%uFF0C%u800C%u6211%u5728route%u4E2D%u7684%u6307%u5B9A%u8DEF%u5F84%u662Fweb%u8DEF%u5F84%60templateUrl%3A%20%27/html/templates/home.template.html%27%60%u3002%u5C31%u5BF9%u4E0D%u4E0A%u53F7%u4E86%u3002%u505A%u6CD5%u662F%u901A%u8FC7%60stripPrefix%60%u5C06%u6240%u6709%u7684%u524D%u7F00%u5168%u90E8%u5265%u53BB%uFF0C%u7136%u540E%u7528%60prependPrefix%60%u52A0%u4E0A%u9700%u8981%u7684%u524D%u7F00%u3002%u8FD9%u6837%u5C31%u53EF%u4EE5%u5DE5%u4F5C%u4E86%u3002%u7F51%u4E0A%u6709%u5F88%u591A%u5E16%u5B50%u8BA8%u8BBA%u8FD9%u4E2A%u95EE%u9898%u3002%u5217%u4E24%u4E2A%u6709%u542F%u53D1%u6027%u7684%uFF1A%0A-%20%5BUnit%20Testing%20AngularJS%20directive%20with%20templateUrl%5D%28https%3A//stackoverflow.com/questions/15214760/unit-testing-angularjs-directive-with-templateurl%29%0A-%20%5BKarma%20%27Unexpected%20Request%27%20when%20testing%20angular%20directive%2C%20even%20with%20ng-html2js%5D%28https%3A//stackoverflow.com/questions/22869668/karma-unexpected-request-when-testing-angular-directive-even-with-ng-html2js%29%0A]]></content>
      <tags>
        <tag>angular</tag>
        <tag>unittest</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Synology]]></title>
    <url>%2F2017%2F10%2F23%2FSynology%2F</url>
    <content type="text"><![CDATA[Edit&#x4FEE;&#x6539;root&#x5BC6;&#x7801;synouser --setpw root xxxHow to &#x201C;unmount /volume1&#x201D;&#x67E5;&#x770B;&#x5360;&#x7528;volume1&#x7684;&#x8FDB;&#x7A0B;&#xFF1A;lsof /volumes&#x5173;&#x95ED;&#x5BF9;&#x5E94;&#x7684;&#x8FDB;&#x7A0B;find /usr/syno/etc.defaults/rc.sysv/ | grep -i &lt;service name&gt;synoservicecfg --status | grep enable | grep -i &lt;service name&gt;&#x53C2;&#x8003;how-to-fsck-on-synology-dsm6&#x626B;&#x63CF;File Systemfsck.ext4 -v -n -f /dev/vg1000/lv #Check the filesystem, with NO changes being writtenfsck.ext4 -v -f -y /dev/vg1000/lv #Check &amp; fix your filesystem&#x67E5;&#x770B;&#x6240;&#x6709;&#x6302;&#x8F7D;&#x70B9;cat /etc/mtab%23%20Synology%0A@%28myblog%29%5Bnas%2C%20synology%5D%0A%0A%23%23%20%u4FEE%u6539root%u5BC6%u7801%0A%60%60%60%0Asynouser%20--setpw%20root%20xxx%0A%60%60%60%0A%0A%23%23%20How%20to%20%22unmount%20/volume1%22%0A%0A1.%20%u67E5%u770B%u5360%u7528volume1%u7684%u8FDB%u7A0B%uFF1A%60lsof%20/volumes%60%0A2.%20%u5173%u95ED%u5BF9%u5E94%u7684%u8FDB%u7A0B%0A%60%60%60%0Afind%20/usr/syno/etc.defaults/rc.sysv/%20%7C%20grep%20-i%20%3Cservice%20name%3E%0Asynoservicecfg%20--status%20%7C%20grep%20enable%20%7C%20grep%20-i%20%3Cservice%20name%3E%0A%60%60%60%0A%u53C2%u8003%5Bhow-to-fsck-on-synology-dsm6%5D%28https%3A//github.com/OliPelz/how-to-fsck-on-synology-dsm6%29%0A%0A%23%23%20%u626B%u63CFFile%20System%0A%60%60%60bash%0Afsck.ext4%20-v%20-n%20-f%20/dev/vg1000/lv%20%23Check%20the%20filesystem%2C%20with%20NO%20changes%20being%20written%0Afsck.ext4%20-v%20-f%20-y%20/dev/vg1000/lv%20%23Check%20%26%20fix%20your%20filesystem%0A%60%60%60%0A%0A%23%23%20%u67E5%u770B%u6240%u6709%u6302%u8F7D%u70B9%0A%60%60%60bash%0Acat%20/etc/mtab%0A%60%60%60]]></content>
      <tags>
        <tag>nas</tag>
        <tag>synology</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ui-router]]></title>
    <url>%2F2017%2F09%2F25%2Fui-router%2F</url>
    <content type="text"><![CDATA[Edit&#x6240;&#x8C13;&#x7684;Single Page Application (SPA)&#x7684;&#x6838;&#x5FC3;&#x5C31;&#x662F;&#x7528;ui-router&#x6765;&#x5207;&#x6362;&#x4E0D;&#x540C;&#x7684;UI state&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x9875;&#x9762;&#x529F;&#x80FD;&#x3002;&#x4F46;&#x662F;&#x76F8;&#x5173;&#x5E93;&#x5E76;&#x4E0D;&#x5728;AngularJS&#x4E2D;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x5E93;&#x7528;&#x7684;&#x6BD4;&#x8F83;&#x591A;ngRouter from Google and communityui-router from community&#x672C;&#x6587;&#x57FA;&#x4E8E;&#x540E;&#x8005;&#x3002;How to use it?&lt;script src=&quot;lib/angular.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;lib/angular-ui-router.min.js&quot;&gt;&lt;/script&gt;&lt;ui-view&gt;&lt;/ui-view&gt;angular.module(&apos;App&apos;,[&apos;ui.router&apos;]);ui-router&#x4F1A;&#x7528;template html&#x6765;&#x66FF;&#x6362;ui-view&#x6807;&#x7B7E;&lt;ui-view&gt;&lt;/ui-view&gt;&#x3002; &#x8FDB;&#x5165;&#x6838;&#x5FC3;&#x914D;&#x7F6E;&#xFF1A;angular.module(&apos;App&apos;).config(RoutesConfig);RoutesConfig.$inject =[&apos;$stateProvider&apos;, &apos;$urlRouterProvider&apos;];function RoutesConfig($stateProvider, $urlRouterProvider) { $urlRouterProvider.otherwise(&apos;/view1&apos;); $stateProvider .state(&apos;view1&apos;, { url: &apos;/view1&apos;, template: &apos;&lt;div&gt;&#x2026;&lt;/div&gt;&apos; }) .state(&apos;view2&apos;, {...});}$urlRouterProvider.otherwise&#x8BBE;&#x7F6E;&#x4E86;&#x9ED8;&#x8BA4;&#x7684;URL&#x3002;$stateProvider&#x8BBE;&#x7F6E;&#x4E86;&#x5404;&#x4E2A;&#x72B6;&#x6001;&#x3002;$stateProvider.state(&apos;itemDetail&apos;, { url: &apos;&apos;, templateUrl: &apos;&apos;, controller: &apos;ItemListController as itemList&apos;, resolve: { }&#x6BCF;&#x4E2A;&#x72B6;&#x6001;&#x90FD;&#x53EF;&#x4EE5;&#x6709;template&#x548C;controller&#x3002;controllercontroller&#x6210;&#x5458;&#x6709;&#x8FD9;&#x4E48;&#x51E0;&#x79CD;&#x5199;&#x6CD5;&#xFF1A;controller: &#x2018;CtrlName as label&#x2019;controller: CtrlNamecontrollerAs: labelresolveThe resolve property is a map object. The map object contains key/value pairs of:key &#x2013; {string}: a name of a dependency to be injected into the controller.factory - {string|function}: If string, then it is an alias for a service.Otherwise if function, then it is injected and the return value is treated as the dependency. If the result is a promise, it is resolved before the controller is instantiated and its value is injected into the controller.&#x3002;Yaakov&#x7684;&#x8BFE;&#x7A0B;&#x6B64;&#x5904;&#x53EF;&#x80FD;&#x6709;&#x9519;&#x8BB9;&#x3002;&#x5E76;&#x4E0D;&#x662F;&#x4EC0;&#x4E48;&#x90FD;&#x80FD;&#x5F80;resolve&#x91CC;&#x653E;&#xFF0C;&#x653E;&#x6570;&#x5B57;&#x4F1A;&#x62A5;&#x9519;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x53C2;&#x770B;GitHub - angular-ui/ui-router&#x4E5F;&#x5C31;&#x662F;factory&#x53EA;&#x6709;&#x4E24;&#x79CD;&#x53EF;&#x80FD;&#xFF0C;string&#x6216;&#x8005;function&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x653E;&#x6570;&#x5B57;&#xFF0C;&#x4F1A;&#x51FA;&#x9519;&#x3002;resolve&#x6210;&#x5458;&#x4F1A;&#x5728;controller&#x5B9E;&#x4F8B;&#x5316;&#x4E4B;&#x524D;&#x88AB;&#x786E;&#x5B9A;&#x3002;&#x5982;&#x679C;promise&#x88AB;reject&#xFF0C;&#x5219;&#x4F1A;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#x5207;&#x6362;&#xFF0C;&#x7136;&#x540E;&#x9519;&#x8BEF;&#x4F1A;&#x88AB;&#x9001;&#x5230;$stateChangeError&#x3002;resolve&#x7684;&#x6210;&#x5458;&#xFF0C;&#x901A;&#x8FC7;inject&#x53EF;&#x4EE5;&#x88AB;controller&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x4E0B;:View1Ctrl.$inject = [&apos;myData&apos;];function View1Ctrl(myData) { var view1 = this; view1.myData = myData;}URL Parameters.state(&apos;view1&apos;, { url: &apos;/view1/{param1}&apos;, templateUrl: &apos;view1.html&apos;, controller: &apos;View1Ctrl as view1&apos;, resolve: { myData: [&apos;$stateParams&apos;, function ($stateParams) { return getDataBasedOn($stateParams.param1); }] }});&#x8FD9;&#x662F;&#x6700;&#x6B63;&#x5E38;&#x7684;&#x5199;&#x6CD5;&#x3002;&#x5728;HTML&#x4E2D;&#x5982;&#x4E0B;&#x4F7F;&#x7528;&#xFF1A;&lt;a ui-sref=&quot;view1({itemId:someVal})&quot;&gt; Link to view with data&lt;/a&gt;&#x6216;&#x8005;$state.go(&apos;contacts&apos;, {param1: value1})&#x6B63;&#x5219;&#x53C2;&#x6570;Examples:/user/{id:[^/]*} - Same as &#x2018;/user/{id}&#x2019; from the previous example./user/{id:[0-9a-fA-F]{1,8&#125;&#125; - Similar to the previous example, but only matches if the id parameter consists of 1 to 8 hex digits./files/{path:.*} - Matches any URL starting with &#x2018;/files/&#x2019; and captures the rest of the path into the parameter &#x2018;path&#x2019;./files/*path - Ditto. Special syntax for catch all.&#x76EE;&#x524D;&#xFF0C;&#x5C1A;&#x672A;&#x5B9E;&#x8DF5;&#x8FC7;&#xFF0C;&#x731C;&#x6D4B;&#x662F;&#x5BF9;URL&#x8FDB;&#x884C;&#x6355;&#x83B7;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x7B26;&#x5408;&#x8BE5;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5219;&#x8BE5;&#x53C2;&#x6570;&#x4E0D;&#x5B58;&#x5728;&#x591A;&#x4E8E;1&#x4E2A;&#x53C2;&#x6570; &#x4F7F;&#x7528;URL&#x53C2;&#x6570;&#x5199;&#x6CD5;&#xFF1A;url: &quot;/contacts?myParam1&amp;myParam2&quot;Using Parameters without Specifying Them in State URLs.state(&apos;contacts&apos;, { url: &quot;/contacts&quot;, params: { param1: null }, templateUrl: &apos;contacts.html&apos;})Router State Transition EventsstateChangeSuccess - fired once the state transition is complete $stateChangeError - fires when an error occurs during transition event.preventDefault() - to prevent the transition from occurringState Inheritance&#x72B6;&#x6001;&#x4E5F;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#xFF0C;&#x7EE7;&#x627F;&#x7684;&#x552F;&#x4E00;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x5D4C;&#x5957;&#x7684;ui-view&#x3002;.state(&apos;view1&apos;, { resolve: { myData: &apos;someVal&apos;; } &#x2026;}).state(&apos;view1.child&apos;, { url: &apos;/detail/{param1}&apos;, templateUrl: &apos;view1Detail.html&apos;, controller: &quot;ChildCtrl as child&quot; &#x2026;});ChildCtrl.$inject = [&apos;myData&apos;];function ChildCtrl (myData) { &#x2026; }&#x72B6;&#x6001;&#x7EE7;&#x627F;&#x7684;&#x65F6;&#x5019;&#xFF0C;resolve&#x6210;&#x5458;&#x4E5F;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#xFF0C;&#x5982;&#x4E0A;&#x3002;%23%20ui-router%0A@%28myblog%29%5Bangular%5D%0A%0A%u6240%u8C13%u7684Single%20Page%20Application%20%28SPA%29%u7684%u6838%u5FC3%u5C31%u662F%u7528ui-router%u6765%u5207%u6362%u4E0D%u540C%u7684UI%20state%uFF0C%u4ECE%u800C%u5B9E%u73B0%u9875%u9762%u529F%u80FD%u3002%u4F46%u662F%u76F8%u5173%u5E93%u5E76%u4E0D%u5728AngularJS%u4E2D%uFF0C%u6709%u4E24%u4E2A%u5E93%u7528%u7684%u6BD4%u8F83%u591A%0A-%20ngRouter%20from%20Google%20and%20community%0A-%20ui-router%20from%20community%0A%0A%u672C%u6587%u57FA%u4E8E%u540E%u8005%u3002%0A%0A%23%23%20How%20to%20use%20it%3F%0A%60%60%60%0A%3Cscript%20src%3D%22lib/angular.min.js%22%3E%3C/script%3E%0A%3Cscript%20src%3D%22lib/angular-ui-router.min.js%22%3E%3C/script%3E%0A%0A%3Cui-view%3E%3C/ui-view%3E%0A%0Aangular.module%28%27App%27%2C%5B%27ui.router%27%5D%29%3B%0A%60%60%60%0Aui-router%u4F1A%u7528template%20html%u6765%u66FF%u6362ui-view%u6807%u7B7E%60%3Cui-view%3E%3C/ui-view%3E%60%u3002%0A%u8FDB%u5165%u6838%u5FC3%u914D%u7F6E%uFF1A%0A%60%60%60%0Aangular.module%28%27App%27%29%0A.config%28RoutesConfig%29%3B%0ARoutesConfig.%24inject%20%3D%0A%5B%27%24stateProvider%27%2C%20%27%24urlRouterProvider%27%5D%3B%0Afunction%20RoutesConfig%28%24stateProvider%2C%20%24urlRouterProvider%29%20%7B%0A%09%24urlRouterProvider.otherwise%28%27/view1%27%29%3B%0A%09%0A%09%24stateProvider%0A%09.state%28%27view1%27%2C%20%7B%0A%09%09url%3A%20%27/view1%27%2C%0A%09%09template%3A%20%27%3Cdiv%3E%u2026%3C/div%3E%27%0A%09%7D%29%0A%09.state%28%27view2%27%2C%20%7B...%7D%29%3B%0A%7D%0A%60%60%60%0A%60%24urlRouterProvider.otherwise%60%u8BBE%u7F6E%u4E86%u9ED8%u8BA4%u7684URL%u3002%60%24stateProvider%60%u8BBE%u7F6E%u4E86%u5404%u4E2A%u72B6%u6001%u3002%0A%0A%60%60%60%0A%24stateProvider%0A.state%28%27itemDetail%27%2C%20%7B%0A%20%20%20%20url%3A%20%27%27%2C%0A%20%20%20%20templateUrl%3A%20%27%27%2C%0A%20%20%20%20controller%3A%20%27ItemListController%20as%20itemList%27%2C%0A%20%20%20%20resolve%3A%20%7B%0A%20%20%20%20%7D%0A%60%60%60%0A%u6BCF%u4E2A%u72B6%u6001%u90FD%u53EF%u4EE5%u6709template%u548Ccontroller%u3002%0A%0A%23%23%23%20controller%0Acontroller%u6210%u5458%u6709%u8FD9%u4E48%u51E0%u79CD%u5199%u6CD5%uFF1A%0A-%20controller%3A%20%u2018CtrlName%20as%20label%u2019%0A-%20controller%3A%20CtrlName%0A-%20controllerAs%3A%20label%0A%0A%23%23%23%20resolve%0AThe%20resolve%20property%20is%20a%20map%20object.%20The%20map%20object%20contains%20key/value%20pairs%20of%3A%0A%0A-%20key%20%u2013%20%7Bstring%7D%3A%20a%20name%20of%20a%20dependency%20to%20be%20injected%20into%20the%20controller.%0A-%20factory%20-%20%7Bstring%7Cfunction%7D%3A%0A%09-%20If%20string%2C%20then%20it%20is%20an%20alias%20for%20a%20service.%0A%09-%20Otherwise%20if%20function%2C%20then%20it%20is%20injected%20and%20the%20return%20value%20is%20treated%20as%20the%20dependency.%20If%20the%20result%20is%20a%20promise%2C%20it%20is%20resolved%20before%20the%20controller%20is%20instantiated%20and%20its%20value%20is%20injected%20into%20the%20controller.%u3002%0A%0A%0A*Yaakov%u7684%u8BFE%u7A0B%u6B64%u5904%u53EF%u80FD%u6709%u9519%u8BB9%u3002%u5E76%u4E0D%u662F%u4EC0%u4E48%u90FD%u80FD%u5F80resolve%u91CC%u653E%uFF0C%u653E%u6570%u5B57%u4F1A%u62A5%u9519%uFF0C%u5177%u4F53%u53EF%u53C2%u770B%5BGitHub%20-%20angular-ui/ui-router%5D%28https%3A//github.com/angular-ui/ui-router/wiki%29*%0A%0A%u4E5F%u5C31%u662Ffactory%u53EA%u6709%u4E24%u79CD%u53EF%u80FD%uFF0Cstring%u6216%u8005function%uFF0C%u5982%u679C%u76F4%u63A5%u653E%u6570%u5B57%uFF0C%u4F1A%u51FA%u9519%u3002resolve%u6210%u5458%u4F1A%u5728controller%u5B9E%u4F8B%u5316%u4E4B%u524D%u88AB%u786E%u5B9A%u3002%u5982%u679Cpromise%u88ABreject%uFF0C%u5219%u4F1A%u53D6%u6D88%u72B6%u6001%u5207%u6362%uFF0C%u7136%u540E%u9519%u8BEF%u4F1A%u88AB%u9001%u5230%24stateChangeError%u3002resolve%u7684%u6210%u5458%uFF0C%u901A%u8FC7inject%u53EF%u4EE5%u88ABcontroller%u4F7F%u7528%uFF0C%u5982%u4E0B%3A%0A%60%60%60%0AView1Ctrl.%24inject%20%3D%20%5B%27myData%27%5D%3B%0Afunction%20View1Ctrl%28myData%29%20%7B%0A%09var%20view1%20%3D%20this%3B%0A%09view1.myData%20%3D%20myData%3B%0A%7D%20%0A%60%60%60%0A%0A%23%23%23%20URL%20Parameters%0A%60%60%60%0A.state%28%27view1%27%2C%20%7B%0A%09url%3A%20%27/view1/%7Bparam1%7D%27%2C%0A%09templateUrl%3A%20%27view1.html%27%2C%0A%09controller%3A%20%27View1Ctrl%20as%20view1%27%2C%0A%09resolve%3A%20%7B%0A%09%09myData%3A%20%5B%27%24stateParams%27%2C%0A%09%09%09function%20%28%24stateParams%29%20%7B%0A%09%09%09return%20getDataBasedOn%28%24stateParams.param1%29%3B%0A%09%09%7D%5D%0A%09%7D%0A%7D%29%3B%0A%60%60%60%0A%u8FD9%u662F%u6700%u6B63%u5E38%u7684%u5199%u6CD5%u3002%u5728HTML%u4E2D%u5982%u4E0B%u4F7F%u7528%uFF1A%0A%60%60%60%0A%3Ca%20ui-sref%3D%22view1%28%7BitemId%3AsomeVal%7D%29%22%3E%0A%09Link%20to%20view%20with%20data%0A%3C/a%3E%0A%60%60%60%0A%u6216%u8005%0A%60%60%60%0A%24state.go%28%27contacts%27%2C%20%7Bparam1%3A%20value1%7D%29%0A%60%60%60%0A%0A**%u6B63%u5219%u53C2%u6570**%0A%3EExamples%3A%0A%0A%3E-%20%60/user/%7Bid%3A%5B%5E/%5D*%7D%60%20-%20Same%20as%20%27/user/%7Bid%7D%27%20from%20the%20previous%20example.%0A%3E-%20%60/user/%7Bid%3A%5B0-9a-fA-F%5D%7B1%2C8%7D%7D%60%20-%20Similar%20to%20the%20previous%20example%2C%20but%20only%20matches%20if%20the%20id%20parameter%20consists%20of%201%20to%208%20hex%20digits.%0A%3E-%20%60/files/%7Bpath%3A.*%7D%60%20-%20Matches%20any%20URL%20starting%20with%20%27/files/%27%20and%20captures%20the%20rest%20of%20the%20path%20into%20the%20parameter%20%27path%27.%0A%3E-%20%60/files/*path%60%20-%20Ditto.%20Special%20syntax%20for%20catch%20all.%0A%0A*%u76EE%u524D%uFF0C%u5C1A%u672A%u5B9E%u8DF5%u8FC7%uFF0C%u731C%u6D4B%u662F%u5BF9URL%u8FDB%u884C%u6355%u83B7%uFF0C%u5982%u679C%u4E0D%u7B26%u5408%u8BE5%u6B63%u5219%u8868%u8FBE%u5F0F%uFF0C%u5219%u8BE5%u53C2%u6570%u4E0D%u5B58%u5728*%0A%0A**%u591A%u4E8E1%u4E2A%u53C2%u6570**%0A%u4F7F%u7528URL%u53C2%u6570%u5199%u6CD5%uFF1A%60url%3A%20%22/contacts%3FmyParam1%26myParam2%22%60%0A%0A**Using%20Parameters%20without%20Specifying%20Them%20in%20State%20URLs**%0A%60%60%60%0A.state%28%27contacts%27%2C%20%7B%0A%09url%3A%20%22/contacts%22%2C%0A%20%20%20%20params%3A%20%7B%0A%20%20%20%20%20%20%20%20param1%3A%20null%0A%20%20%20%20%7D%2C%0A%20%20%20%20templateUrl%3A%20%27contacts.html%27%0A%7D%29%0A%60%60%60%0A%0A%23%23%20Router%20State%20Transition%20Events%0A%24stateChangeStart%20-%20fires%20when%20state%20change%20transition%20begins%0A%24stateChangeSuccess%20-%20fired%20once%20the%20state%20transition%20is%20complete%0A%24stateChangeError%20-%20fires%20when%20an%20error%20occurs%20during%20transition%0Aevent.preventDefault%28%29%20-%20to%20prevent%20the%20transition%20from%20occurring%0A%0A%23%23%20State%20Inheritance%0A%u72B6%u6001%u4E5F%u53EF%u4EE5%u7EE7%u627F%uFF0C%u7EE7%u627F%u7684%u552F%u4E00%u76EE%u7684%u5C31%u662F%u4F7F%u7528%u5D4C%u5957%u7684ui-view%u3002%0A%60%60%60%0A.state%28%27view1%27%2C%20%7B%0A%09resolve%3A%20%7B%0A%09%09myData%3A%20%27someVal%27%3B%0A%09%7D%0A%09%u2026%0A%7D%29%0A.state%28%27view1.child%27%2C%20%7B%0A%09url%3A%20%27/detail/%7Bparam1%7D%27%2C%0A%09templateUrl%3A%20%27view1Detail.html%27%2C%0A%09controller%3A%20%22ChildCtrl%20as%20child%22%0A%09%u2026%0A%7D%29%3B%0AChildCtrl.%24inject%20%3D%20%5B%27myData%27%5D%3B%0Afunction%20ChildCtrl%20%28myData%29%20%7B%20%u2026%20%7D%0A%60%60%60%0A%u72B6%u6001%u7EE7%u627F%u7684%u65F6%u5019%uFF0Cresolve%u6210%u5458%u4E5F%u53EF%u4EE5%u7EE7%u627F%uFF0C%u5982%u4E0A%u3002%0A]]></content>
      <tags>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C/C++ Test Framework - Google Test & Google Mock]]></title>
    <url>%2F2017%2F09%2F12%2FC%2FC%2B%2B_Test_Framework_-_Google_Test_%26_Google_Mock%2F</url>
    <content type="text"><![CDATA[EditGoogle Test&#xFF0C;Google Mock&#x4EE5;&#x4E0B;&#x7B80;&#x79F0;gtest&#xFF0C;gmock&#x3002; &#x5728;&#x63A5;&#x89E6;gtest&#xFF0C;gmock&#x4E4B;&#x524D;&#xFF0C;&#x6D4B;&#x8BD5;C/C++ code&#x4F7F;&#x7528;UnitTest++&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x6D01;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x4E0A;&#x624B;&#x5F88;&#x5FEB;&#x3002;&#x53C2;&#x770B;&#x53E6;&#x4E00;&#x7BC7;&#x535A;&#x6587;UnitTest++&#x7B80;&#x4ECB;&#x3002;&#x6D4B;&#x8BD5;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;&#x591F;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;mock&#x5E93;&#x3002;&#x8FD9;&#x5E26;&#x6765;&#x7684;&#x95EE;&#x9898;&#x662F;&#xFF1A;&#x6D4B;&#x8BD5;&#x9057;&#x7559;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x81EA;&#x884C;fake&#x76F8;&#x5173;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E2A;&#x5728;&#x9057;&#x7559;&#x7CFB;&#x7EDF;&#x5F88;&#x5E9E;&#x5927;&#x65F6;&#xFF0C;&#x8981;&#x9887;&#x8D39;&#x5FC3;&#x529B;&#x3002;&#x800C;&#x4E14;&#x8FC7;&#x591A;&#x6D89;&#x53CA;&#x7EC6;&#x8282;&#xFF0C;&#x5BFC;&#x81F4;&#x6D4B;&#x8BD5;&#x6781;&#x4E0D;&#x7A33;&#x5B9A;&#xFF0C;&#x7CFB;&#x7EDF;&#x4EE3;&#x7801;&#x4EFB;&#x610F;&#x7684;&#x6F14;&#x8FDB;&#xFF0C;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;&#x5927;&#x5806;&#x7684;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#xFF0C;&#x751A;&#x81F3;&#x6D4B;&#x8BD5;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x3002;&#x6D4B;&#x8BD5;case&#x4E4B;&#x95F4;&#x65E0;&#x6CD5;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x8026;&#x3002;&#x7ED3;&#x679C;&#x540C;&#x6837;&#x662F;&#x6D4B;&#x8BD5;&#x4E0D;&#x591F;&#x7A33;&#x5B9A;&#x3002;&#x672F;&#x8BED;&#x662F;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5F88;&#x201C;&#x8106;&#x5F31;&#x201D;&#x3002;Java&#xFF0C;Python&#xFF0C;JavaScript&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;mock&#x5E93;&#x3002;Python&#x7684;Mock&#x7C7B;&#xFF0C;Java&#x7684;Mockito/PowerMock&#xFF0C;JavaScript&#x7684;Sinon&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x5728;&#x7F51;&#x4E0A;&#x641C;&#x7D22;&#x4E86;&#x4E00;&#x4E0B;C/C++&#x7684;Mock&#x5E93;&#xFF0C;&#x4E8E;&#x662F;&#x770B;&#x5230;&#x4E86;gtest&#xFF0C;gmock&#x3002;&#x7136;&#x540E;&#x5C31;&#x6709;&#x4E86;&#x8FD9;&#x4E00;&#x7BC7;&#x3002;&#x7B80;&#x4ECB;&#x4E0D;&#x7528;&#x53BB;&#x7F51;&#x4E0A;&#x8D39;&#x5FC3;&#x627E;&#x6559;&#x7A0B;&#xFF0C;&#x4E24;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x6587;&#x6863;&#x90FD;&#x975E;&#x5E38;&#x68D2;&#x3002;&#x5165;&#x53E3;&#x7EDF;&#x4E00;&#x5728;gtest GitHub&#x9879;&#x76EE;&#x4E3B;&#x9875;&#x4E0A;&#x3002;&#x800C;&#x4E14;&#x8BE5;&#x6587;&#x6863;&#x4E0D;&#x4EC5;&#x5F88;&#x597D;&#x7684;&#x4ECB;&#x7ECD;&#x4E86;gtest&#xFF0C;gmock&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x8FD8;&#x6D89;&#x53CA;&#x4E86;&#x5F88;&#x591A;TDD&#x6216;&#x8005;UnitTest&#x7684;&#x771F;&#x77E5;&#x707C;&#x89C1;&#xFF0C;&#x5F88;&#x503C;&#x5F97;&#x8BFB;&#x4E00;&#x8BFB;&#x3002; &#x8981;&#x4F7F;&#x7528;gtest&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF1A;&#x7F16;&#x8BD1;&#x51FA;gtest&#xFF0C;gmock&#xFF0C;&#x518D;&#x94FE;&#x5165;&#x4F60;&#x7684;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x3002;&#x7F16;&#x8BD1;gtest/gmockgtest&#xFF0C;gmock&#x5747;&#x7528;cmake&#x6765;&#x7BA1;&#x7406;&#x8DE8;&#x5E73;&#x53F0;&#xFF0C;&#x5148;&#x7528;cmake&#x6765;&#x751F;&#x6210;Makefile&#x3002;&#x7528;&#x547D;&#x4EE4;cmake -G &quot;Unix Makefiles&quot; /path/to/CMakeList.txtMakefile&#x7136;&#x540E;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7F16;&#x5199;Makefile&#x3002;&#x6CE8;&#x610F;gmock_main&#x662F;&#x4E00;&#x4E2A;main&#x51FD;&#x6570;&#x6765;&#x8C03;&#x7528;&#x6240;&#x6709;&#x7684;test case&#xFF0C;&#x7701;&#x5F97;&#x81EA;&#x5DF1;&#x5199;main&#x51FD;&#x6570;&#x4E86;&#x3002;CC = gccCPP = g++LINK = g++CFLAGS = -g -Wall -Werror -Wextra -std=gnu99CPPFLAGS = -g -Wall -Werror -WextraLIBS = -L./lib -lgtest -lgmock -lgmock_main -lpthreadC__SOURCES = $(wildcard *.c)CPPSOURCES = $(wildcard *.cpp)OBJECTS = $(patsubst %.c, %.o, $(C__SOURCES)) $(patsubst %.cpp, %.o, $(CPPSOURCES))TARGET = test_exefirst: all%.o: %.c $(CC) $(INCLUDES) -c $(CFLAGS) -o $@ $&lt;%.o: %.cpp $(CPP) $(INCLUDES) -c $(CPPFLAGS) -o $@ $&lt;all: $(TARGET)$(TARGET): $(OBJECTS) $(LINK) $(CPPFLAGS) $(LIBS) -o $(TARGET) $(OBJECTS).PHONY : cleanclean: rm -f $(TARGET) $(OBJECTS)TermsMeaningGoogle Test TermISTQB TermExercise a particular program path with specific input values and verify the resultsTEST()Test CaseA set of several tests related to one componentTest CaseTest SuiteTest#include &quot;gtest/gtest.h&quot;#include &quot;gmock/gmock.h&quot;using ::testing::Return;using ::testing::Test;using ::testing::_;using ::testing::AtLeast;TEST(TestCaseName, should_this_test_do){ ... EXPECT_STREQ(&quot;{}&quot;, str);}&#x4E2D;&#x95F4;&#x7684;&#x90A3;&#x5806;namespace&#x90FD;&#x662F;gtest/gmock&#x5E93;&#x91CC;&#x5B9A;&#x4E49;&#x7684;matcher&#x5B8F;&#x6216;&#x8005;&#x5404;&#x79CD;&#x6709;&#x7528;&#x7684;&#x5B8F;&#x3002;Test Fixture&#x5728;&#x6D4B;&#x8BD5;&#x6709;&#x91CD;&#x590D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x8981;&#x7528;&#x5230;Test Fixture&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;setUp / tearDown&#x3002;class QueueTest : public ::testing::Test { protected: virtual void SetUp() { q1_.Enqueue(1); q2_.Enqueue(2); q2_.Enqueue(3); } // virtual void TearDown() {} Queue&lt;int&gt; q0_; Queue&lt;int&gt; q1_; Queue&lt;int&gt; q2_;};TEST_F(QueueTest, IsEmptyInitially) { EXPECT_EQ(0, q0_.size());}TEST_F(QueueTest, DequeueWorks) { int* n = q0_.Dequeue(); EXPECT_EQ(NULL, n); n = q1_.Dequeue(); ASSERT_TRUE(n != NULL); EXPECT_EQ(1, *n); EXPECT_EQ(0, q1_.size()); delete n; n = q2_.Dequeue(); ASSERT_TRUE(n != NULL); EXPECT_EQ(2, *n); EXPECT_EQ(1, q2_.size()); delete n;}constructor/destructor vs. SetUp/TearDownWhen you need to write per-test set-up and tear-down logic, you have the choice between using the test fixture constructor/destructor or SetUp()/TearDown(). The former is usually preferred, as it has the following benefits:By initializing a member variable in the constructor, we have the option to make it const, which helps prevent accidental changes to its value and makes the tests more obviously correct.In case we need to subclass the test fixture class, the subclass&#x2019; constructor is guaranteed to call the base class&#x2019; constructor first, and the subclass&#x2019; destructor is guaranteed to call the base class&#x2019; destructor afterward. With SetUp()/TearDown(), a subclass may make the mistake of forgetting to call the base class&#x2019; SetUp()/TearDown() or call them at the wrong moment.Benefit for using SetUp/TearDown:If the tear-down operation could throw an exception, you must use TearDown() as opposed to the destructor, as throwing in a destructor leads to undefined behavior and usually will kill your program right away. Note that many standard libraries (like STL) may throw when exceptions are enabled in the compiler. Therefore you should prefer TearDown() if you want to write portable tests that work with or without exceptions.The assertion macros throw an exception when flag &#x2013;gtest_throw_on_failure is specified. Therefore, you shouldn&#x2019;t use Google Test assertions in a destructor if you plan to run your tests with this flag.In a constructor or destructor, you cannot make a virtual function call on this object. (You can call a method declared as virtual, but it will be statically bound.) Therefore, if you need to call a method that will be overriden in a derived class, you have to use SetUp()/TearDown().&#x7B80;&#x8A00;&#x4E4B;&#xFF0C;&#x5728;&#x903B;&#x8F91;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E24;&#x7EC4;&#x7684;&#x4F5C;&#x7528;&#x76F8;&#x540C;&#xFF0C;&#x90FD;&#x662F;&#x6BCF;&#x4E2A;&#x6D4B;&#x8BD5;&#x4E4B;&#x524D;&#x4E4B;&#x540E;&#x4F1A;&#x505A;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x5DE5;&#x4F5C;&#x3002;Constructor/Destructor&#x7684;&#x597D;&#x5904;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x7EE7;&#x627F;&#x3002;setUp/tearDown&#x7684;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x5904;&#x7406;exception&#xFF0C;&#x8FD9;&#x662F;&#x4E0D;&#x80FD;&#x653E;&#x5728;&#x6790;&#x6784;&#x51FD;&#x6570;&#x91CC;&#x7684;&#x3002;SetUpTestCase / TearDownTestCaseTest Case&#x7EA7;&#x522B;&#x7684;SetUp/TearDownclass FooTest : public ::testing::Test { protected: // Per-test-case set-up. // Called before the first test in this test case. // Can be omitted if not needed. static void SetUpTestCase() { shared_resource_ = new ...; } // Per-test-case tear-down. // Called after the last test in this test case. // Can be omitted if not needed. static void TearDownTestCase() { delete shared_resource_; shared_resource_ = NULL; } // You can define per-test set-up and tear-down logic as usual. virtual void SetUp() { ... } virtual void TearDown() { ... } // Some expensive resource shared by all tests. static T* shared_resource_;};SetUp/TearDown EnvironmentFirst, you subclass the ::testing::Environment class to define a test environment, which knows how to set-up and tear-down:Then, you register an instance of your environment class with Google Test by calling the ::testing::AddGlobalTestEnvironment() function: Now, when RUN_ALL_TESTS() is called, it first calls the SetUp() method of the environment object, then runs the tests if there was no fatal failures, and finally calls TearDown() of the environment object.It&#x2019;s OK to register multiple environment objects. In this case, their SetUp() will be called in the order they are registered, and their TearDown() will be called in the reverse order.Note that Google Test takes ownership of the registered environment objects. Therefore do not delete them by yourself.class Environment { public: virtual ~Environment() {} // Override this to define how to set up the environment. virtual void SetUp() {} // Override this to define how to tear down the environment. virtual void TearDown() {}};Environment* AddGlobalTestEnvironment(Environment* env);&#x65AD;&#x8A00;&#x6709;&#x4E24;&#x79CD;&#x65AD;&#x8A00;EXPECT_xxx&#x548C;ASSERT_xxx&#x3002;&#x524D;&#x8005;&#x4F1A;&#x8BA9;&#x6D4B;&#x8BD5;&#x7EC8;&#x6B62;&#xFF0C;&#x540E;&#x8005;&#x4E0D;&#x4F1A;&#xFF0C;&#x53EA;&#x4F1A;&#x8BA9;&#x6D4B;&#x8BD5;fail&#x3002;gmock&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x5207;&#x5230;gtest&#xFF0C;&#x552F;&#x4E00;&#x7684;&#x539F;&#x56E0;&#x5C31;&#x662F;gmock&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x4E13;&#x5F00;&#x4E00;&#x7AE0;&#x91CD;&#x70B9;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x3002;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x5747;&#x6765;&#x81EA;&#x4E8E;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x3002;&#x5185;&#x5BB9;&#x6DF1;&#x5EA6;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x4F9D;&#x6B21;&#x5982;&#x4E0B;&#xFF1A;Google Mock for DummiesCookBook&#x6700;&#x540E;&#x8FD8;&#x6709;&#x53C2;&#x8003;&#x624B;&#x518C;:Cheat Sheet&#x7B80;&#x4ECB;Google C++ Mocking Framework (or Google Mock for short) is a library (sometimes we also call it a &#x201C;framework&#x201D; to make it sound cool) for creating mock classes and using them. It does to C++ what jMock and EasyMock do to Java.&#x4F55;&#x4E3A;Mock&#xFF1F;Mocks are objects pre-programmed with expectations, which form a specification of the calls they are expected to receive.&#x76F8;&#x5E94;&#x7684;&#x8FD8;&#x6709;Fake&#x548C;StubFake objects have working implementations, but usually take some shortcut (perhaps to make the operations less expensive), which makes them not suitable for production. An in-memory file system would be an example of a fake.gmock&#x7684;&#x6587;&#x6863;&#x91CC;&#x53EA;&#x63D0;&#x5230;&#x4E86;Fake&#xFF0C;&#x4ECE;Martin Fowler&#x7684;&#x6587;&#x7AE0;Mocks Aren&#x2019;t Stubs&#x4E2D;&#x6458;&#x5F55;&#x5982;&#x4E0B;:Stubs provide canned answers to calls made during the test, usually not responding at all to anything outside what&#x2019;s programmed in for the test.&#x4E09;&#x8005;&#x4F5C;&#x7528;&#x76F8;&#x540C;&#xFF0C;&#x90FD;&#x662F;&#x6A21;&#x62DF;&#x7CFB;&#x7EDF;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FBE;&#x5230;&#x4EE3;&#x7801;&#x9694;&#x79BB;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x65B9;&#x4FBF;&#x6D4B;&#x8BD5;&#x3002;&#x4F46;&#x662F;Mock&#x7684;&#x7279;&#x70B9;&#x662F;&#x66F4;OO&#x5316;&#xFF0C;&#x4E5F;&#x7B26;&#x5408;TDD&#x6216;&#x8005;BDD&#x7684;&#x601D;&#x60F3;&#x2014;&#x2014;&#x9488;&#x5BF9;&#x4E00;&#x4E2A;object&#x8BBE;&#x7F6E;&#x671F;&#x5F85;&#xFF0C;&#x518D;&#x5BF9;&#x9F50;verify&#x3002;Mocks vs. Stubs - from Martin FowlerIn order to use state verification on the stub, I need to make some extra methods on the stub to help with verification. As a result the stub implements MailService but adds extra test methods.Mock objects always use behavior verification, a stub can go either way. Meszaros refers to stubs that use behavior verification as a Test Spy. The difference is in how exactly the double runs and verifies and I&#x2019;ll leave that for you to explore on your own.Getting StartedClass to Mockclass Turtle { ... virtual ~Turtle() {} virtual void PenUp() = 0; virtual void PenDown() = 0; virtual void Forward(int distance) = 0;};Mock class#include &quot;gmock/gmock.h&quot; // Brings in Google Mock.class MockTurtle : public Turtle { public: ... MOCK_METHOD0(PenUp, void()); MOCK_METHOD0(PenDown, void()); MOCK_METHOD1(Forward, void(int distance));};&#x9488;&#x5BF9;&#x5F85;Mock&#x7684;Turtle class&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;:Note that the destructor of Turtle must be virtual, as is the case for all classes you intend to inherit from - otherwise the destructor of the derived class will not be called when you delete an object through a base pointer, and you&#x2019;ll get corrupted program states like memory leaks.Use it#include &quot;path/to/mock-turtle.h&quot;#include &quot;gmock/gmock.h&quot;#include &quot;gtest/gtest.h&quot;using ::testing::AtLeast; // #1TEST(PainterTest, CanDrawSomething) { MockTurtle turtle; // #2 EXPECT_CALL(turtle, PenDown()) // #3 .Times(AtLeast(1)); Painter painter(&amp;turtle); // #4 EXPECT_TRUE(painter.DrawCircle(0, 0, 10));} // #5int main(int argc, char** argv) { // The following line must be executed to initialize Google Mock // (and Google Test) before running the tests. ::testing::InitGoogleMock(&amp;argc, argv); return RUN_ALL_TESTS();}&#x5982;&#x679C;&#x4F60;&#x613F;&#x610F;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5199;main&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5077;&#x61D2;&#xFF0C;&#x8BB0;&#x5F97;&#x5728;Makefile&#x91CC;link gmock_main&#x3002; &#x6309;Google&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;gmock&#x4E5F;&#x53EF;&#x4EE5;&#x548C;&#x5176;&#x4ED6;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;&#x517C;&#x5BB9;&#xFF0C;&#x4F46;&#x603B;&#x611F;&#x89C9;&#x633A;&#x60AC;&#x7684;&#x3002;&#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x5DE5;&#x5177;Marcher EXPECT_CALL(turtle, Forward(_)); &#xA0;&#xA0;&#xA0;&#xA0; &#x4EE5;&#x4EFB;&#x610F;&#x53C2;&#x6570;&#x8C03;&#x7528;Forward EXPECT_CALL(turtle, Forward(Ge(100))); &#xA0;&#xA0;&#xA0;&#xA0; &#x4EE5;&#x5927;&#x4E8E;100&#x7684;&#x6574;&#x6570;&#x8C03;&#x7528;ForwardCardinalities: How Many Times Will It Be Called?If neither WillOnce() nor WillRepeatedly() is in the EXPECT_CALL(), the inferred cardinality is Times(1).If there are n WillOnce()&#x2019;s but no WillRepeatedly(), where n &gt;= 1, the cardinality is Times(n).If there are n WillOnce()&#x2019;s and one WillRepeatedly(), where n &gt;= 0, the cardinality is Times(AtLeast(n)).EXPECT_CALL(mockObj, func()) .Times(AtLeast(1)) .WillOnce(Return(123)) .WillRepeatedly(Return(456))&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x8981;&#x6C42;func&#x51FD;&#x6570;&#x81F3;&#x5C11;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x8FD4;&#x56DE;123&#xFF0C;&#x4E4B;&#x540E;&#x6BCF;&#x6B21;&#x8FD4;&#x56DE;456&#x3002;Important note: The EXPECT_CALL() statement evaluates the action clause only once, even though the action may be performed many times. Therefore you must be careful about side effects. The following may not do what you want:int n = 100;EXPECT_CALL(turtle, GetX()).Times(4).WillRepeatedly(Return(n++));&#x56E0;&#x4E3A;Return&#x662F;&#x5B8F;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x4F1A;&#x66FF;&#x6362;&#x4E00;&#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7BA1;GetX&#x8C03;&#x7528;&#x51E0;&#x6B21;&#xFF0C;&#x8FD4;&#x56DE;&#x90FD;&#x662F;101&#xFF0C;&#x800C;&#x4E0D;&#x662F;101,102,103,&#x2026;All Expectations Are Sticky &#x6240;&#x8C13;&#x7684;sticky&#x5C31;&#x662F;EXPECT_CALL&#x603B;&#x662F;&#x751F;&#x6548;&#x7684;&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x663E;&#x793A;&#x7684;&#x5C06;&#x5176;&#x5931;&#x6548;&#x3002;&#x5982;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x7684;EXPECT_CALL&#x90FD;&#x4F1A;&#x751F;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4F1A;&#x8986;&#x76D6;&#x524D;&#x9762;&#x6240;&#x6709;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;GetX&#x603B;&#x4F1A;&#x8FD4;&#x56DE;10&#x3002;using ::testing::Return;...for (int i = n; i &gt; 0; i--) { EXPECT_CALL(turtle, GetX()) .WillOnce(Return(10*i));}&#x5982;&#x679C;&#x5E0C;&#x671B;&#x4ED6;&#x8FD4;&#x56DE;&#xFF0C;30,20,10&#xFF0C;&#x2026;&#xFF0C;&#x5E94;&#x8BE5;&#x8FD9;&#x4E48;&#x5199;using ::testing::Return;...for (int i = n; i &gt; 0; i--) { EXPECT_CALL(turtle, GetX()) .WillOnce(Return(10*i)) .RetiresOnSaturation();}RetireOnSaturation&#x5C31;&#x662F;&#x663E;&#x793A;&#x7684;&#x8BA9;&#x5176;&#x5931;&#x6548;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF1A;using ::testing::InSequence;using ::testing::Return;...{ InSequence s; for (int i = 1; i &lt;= n; i++) { EXPECT_CALL(turtle, GetX()) .WillOnce(Return(10*i)) .RetiresOnSaturation(); }}&#x56E0;&#x4E3A;InSequence&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5728;&#x524D;&#x9762;&#x7684;EXPECT_CALL&#x751F;&#x6548;&#x4EE5;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x5931;&#x6548;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x8986;&#x76D6;&#x7684;&#x6548;&#x679C;&#x3002; Ordered vs Unordered Callsusing ::testing::InSequence;...TEST(FooTest, DrawsLineSegment) { ... { InSequence dummy; EXPECT_CALL(turtle, PenDown()); EXPECT_CALL(turtle, Forward(100)); EXPECT_CALL(turtle, PenUp()); } Foo();}Expecting Partially Ordered Calls Google Mock allows you to impose an arbitrary DAG (directed acyclic graph) on the calls. One way to express the DAG is to use the After clause of EXPECT_CALL .using ::testing::Sequence;Sequence s1, s2;EXPECT_CALL(foo, A()) .InSequence(s1, s2);EXPECT_CALL(bar, B()) .InSequence(s1);EXPECT_CALL(bar, C()) .InSequence(s2);EXPECT_CALL(foo, D()) .InSequence(s2);specifies the following DAG (where s1 is A -&gt; B , and s2 is A -&gt; C -&gt; D ): +---&gt; B |A ---| | +---&gt; C ---&gt; DUninteresting Calls &#x8FD9;&#x662F;gmock&#x62A5;&#x7684;warning&#x3002;&#x5F53;&#x9488;&#x5BF9;&#x67D0;&#x4E00;&#x4E2A;&#x5F85;&#x6D4B;&#x51FD;&#x6570;&#x8BBE;&#x7F6E;&#x4E86;EXPECT spec&#xFF0C;&#x5374;&#x5E76;&#x6CA1;&#x6709;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x62A5;&#x8FD9;&#x4E2A;warning&#x3002;&#x6B64;&#x65F6;gmock&#x8BA4;&#x4E3A;&#x4F60;&#x5BF9;&#x8BE5;&#x51FD;&#x6570;&#x5E76;&#x6CA1;&#x6709;&#x5174;&#x8DA3;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x4E2A;EXPECT spec&#x3002;&#x5F53;&#x7136;&#x4F60;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5FFD;&#x7565;&#x8FD9;&#x4E2A;warning&#xFF0C;&#x4F46;&#x6211;&#x8BA4;&#x4E3A;&#x51FA;&#x8FD9;&#x4E2A;warning&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x591A;&#x534A;&#x662F;test&#x6F0F;&#x5199;&#x4E86;&#x4EC0;&#x4E48;&#x3002;Returning Live Values from Mock Methodsusing testing::ByRef;using testing::Return;class MockFoo : public Foo { public: MOCK_METHOD0(GetValue, int());};...int x = 0;MockFoo foo;EXPECT_CALL(foo, GetValue()) // .WillRepeatedly(Return(ByRef(x))); X error .WillRepeatedly(ReturnPointee(x));x = 42;EXPECT_EQ(42, foo.GetValue());&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;case&#x5199;Unit Test&#x5E76;&#x4E0D;&#x50CF;&#x60F3;&#x50CF;&#x7684;&#x90A3;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x8C03;&#x7528;&#x4E86;&#x6846;&#x67B6;&#xFF0C;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x5199;test case&#x5C31;&#x53EF;&#x4EE5;&#x3002;&#x6309;&#x6211;&#x76EE;&#x524D;&#x7684;&#x7406;&#x89E3;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x6311;&#x6218;&#xFF1A;Test Case&#x5982;&#x4F55;&#x89E3;&#x8026;&#x3002;&#x4E0D;&#x8981;&#x6709;&#x91CD;&#x590D;&#x6D4B;&#x8BD5;(overlap)&#x3002; &#x4F8B;&#x5982;&#xFF1A;&#x5728;&#x5199;A&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5199;&#x4E86;&#x6D4B;&#x8BD5;testA&#xFF0C;B&#x51FD;&#x6570;&#x4F1A;&#x8C03;&#x7528;A&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x5199;&#x5B8C;A&#x4E4B;&#x540E;&#x5199;B&#x7684;&#x6D4B;&#x8BD5;testB&#x65F6;&#xFF0C;&#x662F;&#x5426;&#x8981;&#x5C06;A mock/fake/stub&#x6389;? &#x5982;&#x679C;&#x4E0D;&#x5C06;A&#x51FD;&#x6570;Fake&#x6389;&#xFF0C;&#x5219;testA&#x548C;testB&#x4E4B;&#x95F4;&#x5C31;&#x662F;&#x6709;overlap&#x3002;&#x6211;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x6709;&#x53D6;&#x820D;&#xFF0C;&#x6700;&#x4F73;&#x72B6;&#x6001;&#x5E94;&#x5F53;&#x662F;&#x6B64;&#x65F6;&#xFF0C;&#x5C06;testA&#x5220;&#x9664;&#xFF0C;&#x53EA;&#x4FDD;&#x7559;testB&#x3002;&#x4F46;&#x4ECD;&#x5E94;&#x6839;&#x636E;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x800C;&#x5B9A;&#x3002;&#x5982;&#x4F55;&#x9488;&#x5BF9;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x8FDB;&#x884C;mock&#x5316;&#x3002; &#x4F8B;&#x5982;&#x51FA;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x8BED;&#x53E5;: B = new A&#xFF0C;&#x5219;&#x7C7B;B&#x4F9D;&#x8D56;&#x4E8E;&#x7C7B;A&#x3002;&#x4F46;&#x7C7B;A&#x5E76;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x7F16;&#x8BD1;&#x8FDB;test&#x3002;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x52A0;&#x5165;A&#xFF0C;&#x5219;&#x52BF;&#x5FC5;&#x4F1A;&#x5F15;&#x5165;&#x66F4;&#x591A;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x800C;&#x5BFC;&#x81F4;test&#x7F16;&#x8BD1;&#x5D29;&#x6E83;&#x3002;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#x89E3;&#x51B3;&#x65E0;&#x7A77;&#x65E0;&#x5C3D;&#x3002;&#x5728;&#x505A;Android&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;PowerMock&#x53D6;&#x4EE3;Mockito&#x6765;Mock&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x5C06;&#x6784;&#x9020;&#x51FD;&#x6570;Fake&#x5316;&#x6210;&#x7C7B;&#x4F3C;&#x5DE5;&#x5382;&#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x7C7B;&#x5B9E;&#x4F8B;&#x3002;&#x5177;&#x4F53;&#x53C2;&#x770B;&#x8FD9;&#x7BC7;&#x535A;&#x6587;Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002; &#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x6309;&#x7167;&#x73B0;&#x5728;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x5176;&#x5B9E;Mock&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x4E0D;&#x53EF;&#x53D6;&#x7684;&#xFF0C;&#x9996;&#x5148;&#x9020;&#x6210;&#x88AB;&#x6D4B;&#x4EE3;&#x7801;spec&#x4E0D;&#x6E05;&#x6670;&#xFF0C;&#x8BD5;&#x60F3;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x600E;&#x4E48;&#x4F1A;&#x8FD4;&#x56DE;&#x53E6;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x5728;C++&#x4E2D;&#x5F88;&#x96BE;&#x505A;&#x5230;Mock&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x597D;&#x7684;&#x505A;&#x6CD5;&#x5E94;&#x5F53;&#x662F;&#x8FD0;&#x7528;Dependency Injection&#x3002;&#x4F8B;&#x5982;&#xFF1A;class A{}class B{ void func() { A* a = new A; }}&#x7C7B;B&#x5E94;&#x5F53;&#x6539;&#x5199;&#x4E3A;&#xFF1A;class B{ void func(A*) { ... }}&#x5C06;&#x7C7B;A&#x6307;&#x9488;&#x4F20;&#x5165;&#xFF0C;&#x89E3;&#x51B3;dependency&#x7684;&#x95EE;&#x9898;&#x3002;&#x5982;&#x4F55;&#x80FD;&#x591F;&#x8BA9;&#x6D4B;&#x8BD5;&#x7A33;&#x5B9A;&#xFF0C;&#x5728;&#x4EFB;&#x610F;&#x73AF;&#x5883;&#x4E0B;&#x5747;&#x8FD4;&#x56DE;&#x540C;&#x6837;&#x7684;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x3002; &#x8FD9;&#x4E2A;&#x4E00;&#x822C;&#x6D89;&#x53CA;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x4F8B;&#x5982;&#x8C03;&#x7528;&#x7F51;&#x7EDC;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x7F51;&#x7EDC;&#x7684;&#x73AF;&#x5883;&#x5C31;&#x6CA1;&#x6CD5;&#x8FDB;&#x884C;&#x3002;&#x518D;&#x4F8B;&#x5982;&#x6D4B;&#x8BD5;&#x65F6;&#x64CD;&#x4F5C;&#x771F;&#x5B9E;&#x5177;&#x4F53;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x8BE5;&#x6587;&#x4EF6;&#x88AB;&#x6D4B;&#x8BD5;&#x5916;&#x4EBA;&#x4E3A;&#x6216;&#x4EE3;&#x7801;&#x4FEE;&#x6539;&#xFF0C;&#x5219;&#x6D4B;&#x8BD5;&#x53EF;&#x80FD;&#x5C31;&#x4F1A;&#x83AB;&#x540D;&#x5931;&#x8D25;&#x3002; &#x9488;&#x5BF9;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x5728;&#x6D4B;&#x8BD5;&#x4E2D;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x3002;&#x4F8B;&#x5982;&#x524D;&#x8005;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x5BF9;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x8FDB;&#x884C;Mock&#x5316;&#xFF0C;&#x540E;&#x8005;&#x5E94;&#x5F53;&#x5728;&#x6D4B;&#x8BD5;&#x7684;setUp&#x548C;tearDown&#x4E2D;&#x751F;&#x6210;&#x865A;&#x5047;&#x6587;&#x4EF6;&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x5728;&#x6D4B;&#x8BD5;&#x5B8C;&#x6210;&#x65F6;&#x505A;&#x6E05;&#x7406;&#x3002;&#x4F1A;&#x56E0;&#x4E3A;&#x5F88;&#x5C0F;&#x7684;&#x88AB;&#x6D4B;&#x4EE3;&#x7801;&#x6539;&#x52A8;&#xFF0C;&#x800C;&#x5BFC;&#x81F4;&#x5927;&#x9762;&#x79EF;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#xFF0C;&#x751A;&#x81F3;&#x6D4B;&#x8BD5;&#x5D29;&#x6E83;&#x3002; &#x8FD9;&#x4E2A;&#x5C31;&#x662F;gmock&#x6587;&#x6863;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x8981;&#x9488;&#x5BF9;&#x63A5;&#x53E3;&#x7F16;&#x7A0B;&#xFF0C;&#x9488;&#x5BF9;&#x63A5;&#x53E3;&#x6D4B;&#x8BD5;&#x3002;Robert C&#xB7;Martin&#x5728;&#x300A;&#x654F;&#x6377;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#xFF0D;&#x539F;&#x5219;&#x3001;&#x6A21;&#x5F0F;&#x4E0E;&#x5B9E;&#x8DF5;&#x300B;&#x4E00;&#x4E66;&#x4E2D;&#x6709;&#x63D0;&#x51FA;&#xFF1A;&#x6240;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x5E94;&#x4F9D;&#x8D56;&#x4E8E;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#x3002;&#x56E0;&#x4E3A;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#x662F;&#x7ECF;&#x8FC7;&#x62BD;&#x8C61;&#x7684;&#xFF0C;&#x76F8;&#x5BF9;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x8F83;&#x4E3A;&#x7A33;&#x5B9A;&#x3002;&#x800C;&#x88AB;&#x4F9D;&#x8D56;&#x7684;&#x4EE3;&#x7801;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x4FDD;&#x6301;&#x7A33;&#x5B9A;&#xFF0C;&#x8FD9;&#x6837;&#x57FA;&#x4E8E;&#x4E4B;&#x4E0A;&#x7684;&#x4EE3;&#x7801;&#x624D;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x4F9D;&#x8D56;&#x7684;&#x6539;&#x52A8;&#x800C;&#x6539;&#x52A8;&#x3002;&#x4E0B;&#x9762;&#x5217;&#x51FA;&#x51E0;&#x79CD;&#x6211;&#x5728;&#x5B9E;&#x9645;&#x5199;test case&#x65F6;&#x9047;&#x5230;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5728;gmock&#x4E2D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;&#x6309;&#x7167;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x8FD4;&#x56DE;&#x7ED3;&#x679C; - Fake&#x4F8B;&#x5982;:class A{ virtual int func(int a, int b);}EXPECT_CALL(mockA, func()) .WillRepeatedly(a+b);gmock&#x4E2D;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;&#xFF1A;Using Functions/Methods/Functors as Actionsusing ::testing::_;using ::testing::Invoke;class MockFoo : public Foo {public: MOCK_METHOD2(Sum, int(int x, int y)); MOCK_METHOD1(ComplexJob, bool(int x));};int CalculateSum(int x, int y) { return x + y; }class Helper {public: bool ComplexJob(int x);};...MockFoo foo;Helper helper;EXPECT_CALL(foo, Sum(_, _)) .WillOnce(Invoke(CalculateSum));EXPECT_CALL(foo, ComplexJob(_)) .WillOnce(Invoke(&amp;helper, &amp;Helper::ComplexJob));foo.Sum(5, 6); // Invokes CalculateSum(5, 6).foo.ComplexJob(10); // Invokes helper.ComplexJob(10);Mock non-virtual&#x51FD;&#x6570;// A simple packet stream class. None of its members is virtual.class ConcretePacketStream { public: void AppendPacket(Packet* new_packet); const Packet* GetPacket(size_t packet_number) const; size_t NumberOfPackets() const; ...};// A mock packet stream class. It inherits from no other, but defines// GetPacket() and NumberOfPackets().class MockPacketStream { public: MOCK_CONST_METHOD1(GetPacket, const Packet*(size_t packet_number)); MOCK_CONST_METHOD0(NumberOfPackets, size_t()); ...}template &lt;class PacketStream&gt;void CreateConnection(PacketStream* stream) { ... }template &lt;class PacketStream&gt;class PacketReader { public: void ReadPackets(PacketStream* stream, size_t packet_num);};MockPacketStream mock_stream;EXPECT_CALL(mock_stream, ...)...;.. set more expectations on mock_stream ...PacketReader&lt;MockPacketStream&gt; reader(&amp;mock_stream);... exercise reader ...&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF1F; &#x56E0;&#x4E3A;&#x53EA;&#x80FD;&#x8FD9;&#x4E48;&#x505A;&#x3002;&#x666E;&#x901A;&#x7684;mock&#xFF0C;&#x8981;&#x901A;&#x8FC7;&#x7EE7;&#x627F;&#x88AB;&#x6D4B;&#x8BD5;&#x7C7B;&#xFF0C;&#x5E76;&#x91CD;&#x5199;virtual&#x51FD;&#x6570;&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x800C;&#x4E0A;&#x9762;&#x7684;ConcretePacketStream&#x548C;MockPacketStream&#x5E76;&#x4EFB;&#x4F55;&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4F20;&#x5165;&#x540E;&#x8005;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x4E0D;&#x7528;reinterpret_cast&#x662F;&#x4E0D;&#x80FD;&#x8F6C;&#x6210;&#x524D;&#x8005;&#x7684;&#x6307;&#x9488;&#x7684;&#x3002; &#x6240;&#x4EE5;&#x60F3;&#x4E00;&#x4E2A;&#x53D8;&#x901A;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x7528;&#x6A21;&#x677F;&#x7C7B;&#x6765;&#x5B9A;&#x4E49;&#x88AB;&#x6D4B;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x6D4B;&#x8BD5;&#x65F6;&#x4F20;&#x5165;mock&#x7C7B;&#xFF0C;&#x5728;&#x751F;&#x4EA7;&#x65F6;&#xFF0C;&#x4F20;&#x5165;&#x771F;&#x5B9E;&#x7C7B;&#x3002;Mocking Side EffectsEXPECT_CALL(mutator, MutateInt(_)) .WillOnce(DoAll(SetArgPointee&lt;0&gt;(5), Return(true)));EXPECT_CALL(mutator, Mutate(NotNull(), 5)) .WillOnce(SetArrayArgument&lt;0&gt;(values, values + 5));&#x7B2C;&#x4E00;&#x4E2A;&#x5C06;MutateInt&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;int&#xFF0C;&#x8BBE;&#x4E3A;5&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;true&#x3002; &#x7B2C;&#x4E8C;&#x4E2A;&#x5C06;values&#x6570;&#x7EC4;&#x7684;[0,5)&#x62F7;&#x8D1D;&#x5230;&#x53C2;&#x6570;1&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x3002; &#x5982;&#x679C;&#x4ECD;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#xFF0C;&#x5219;&#x7528;DoAll&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;EXPECT_CALL(mutator, MutateInt(_)) .WillOnce(DoAll(SetArgPointee&lt;0&gt;(5), Return(true)));Selecting an Action&#x2019;s Argumentsusing ::testing::_;using ::testing::Invoke;bool MyIsVisibleInQuadrant1(bool visible, const string&amp; name, int x, int y,const map&lt;pair&lt;int, int&gt;, double&gt;&amp; weight,double min_weight, double max_wight) { return IsVisibleInQuadrant1(visible, x, y);}...EXPECT_CALL(mock, Foo(_, _, _, _, _, _, _)) .WillOnce(Invoke(MyIsVisibleInQuadrant1)); // Now it works.&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;adaptor MyIsVisibleInQuadrant1&#xFF0C;&#x6216;&#x8005;&#x7528;gmock&#x63D0;&#x4F9B;&#x7684;&#x65B9;&#x6CD5;&#x4F18;&#x96C5;&#x7684;&#x89E3;&#x51B3;&#x3002;using ::testing::_;using ::testing::Invoke;using ::testing::WithArgs;...EXPECT_CALL(mock, Foo(_, _, _, _, _, _, _)).WillOnce(WithArgs&lt;0, 2, 3&gt;(Invoke(IsVisibleInQuadrant1)));// No need to define your own adaptor.Mocking Private or Protected Methodsclass Foo { public: ... virtual bool Transform(Gadget* g) = 0; protected: virtual void Resume(); private: virtual int GetTimeOut();};class MockFoo : public Foo { public: ... MOCK_METHOD1(Transform, bool(Gadget* g)); // The following must be in the public section, even though the // methods are protected or private in the base class. MOCK_METHOD0(Resume, void()); MOCK_METHOD0(GetTimeOut, int());};C++ allows a subclass to specify a different access level than the base class on a virtual function.MiscKeep in mind that one doesn&#x2019;t have to verify more than one property in one test. In fact, it&#x2019;s a good style to verify only one thing in one test. If you do that, a bug will likely break only one or two tests instead of dozensWhen it&#x2019;s being destroyed, your friendly mock object will automatically verify that all expectations on it have been satisfied, and will generate Google Test failures if not. Currently these are only platforms that support the pthreads library (this includes Linux and Mac). &#x52A0;&#x4E0A;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;&#x2013;gmock_verbose=info&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x6240;&#x6709;EXPECT_CALL&#x7684;&#x5177;&#x4F53;&#x8C03;&#x7528;&#x60C5;&#x51B5;&#x3002;Some useful tips in gtestSelecting TestsIf you set the GTEST_FILTER environment variable or the &#x2013;gtest_filter flag to a filter string, Google Test will only run the tests whose full names (in the form of TestCaseName.TestName) match the filter. The format of a filter is a &#x2018;:&#x2019;-separated list of wildcard patterns (called the positive patterns) optionally followed by a &#x2018;-&#x2019; and another &#x2018;:&#x2019;-separated pattern list (called the negative patterns)../foo_test Has no flag, and thus runs all its tests../foo_test &#x2013;gtest_filter=* Also runs everything, due to the single match-everything * value../foo_test &#x2013;gtest_filter=FooTest.* Runs everything in test case FooTest../foo_test &#x2013;gtest_filter=Null:Constructor Runs any test whose full name contains either &#x201C;Null&#x201D; or &#x201C;Constructor&#x201D;../foo_test &#x2013;gtest_filter=-DeathTest. Runs all non-death tests../foo_test &#x2013;gtest_filter=FooTest.*-FooTest.Bar Runs everything in test case FooTest except FooTest.BarTemporarily Disabling Tests// Tests that Foo does Abc.TEST(FooTest, DISABLED_DoesAbc) { ... }class DISABLED_BarTest : public ::testing::Test { ... };// Tests that Bar does Xyz.TEST_F(DISABLED_BarTest, DoesXyz) { ... }Temporarily Enabling Disabled Testsjust invoke the test program with the &#x2013;gtest_also_run_disabled_tests flag or set the GTEST_ALSO_RUN_DISABLED_TESTS environment variable to a value other than 0.Repeating the Tests$ foo_test &#x2013;gtest_repeat=1000Repeat foo_test 1000 times and don&#x2019;t stop at failures.$ foo_test &#x2013;gtest_repeat=-1A negative count means repeating forever.$ foo_test &#x2013;gtest_repeat=1000 &#x2013;gtest_break_on_failureRepeat foo_test 1000 times, stopping at the first failure. This is especially useful when running under a debugger: when the testfails, it will drop into the debugger and you can then inspect variables and stacks.$ foo_test &#x2013;gtest_repeat=1000 &#x2013;gtest_filter=FooBarRepeat the tests whose name matches the filter 1000 times.%23%20C/C++%20Test%20Framework%20-%20Google%20Test%20%26%20Google%20Mock%0A@%28myblog%29%5BTDD%2C%20gtest%2C%20gmock%5D%0A%0AGoogle%20Test%uFF0CGoogle%20Mock%u4EE5%u4E0B%u7B80%u79F0gtest%uFF0Cgmock%u3002%0A%u5728%u63A5%u89E6gtest%uFF0Cgmock%u4E4B%u524D%uFF0C%u6D4B%u8BD5C/C++%20code%u4F7F%u7528%5BUnitTest++%5D%28https%3A//github.com/unittest-cpp/unittest-cpp%29%u3002%u8FD9%u662F%u4E00%u4E2A%u5F88%u7B80%u6D01%u7684%u6846%u67B6%uFF0C%u4E0A%u624B%u5F88%u5FEB%u3002%u53C2%u770B%u53E6%u4E00%u7BC7%u535A%u6587%5BUnitTest++%u7B80%u4ECB%5D%28https%3A//zhougy0717.github.io/2016/02/29/UnitTest++%25E7%25AE%2580%25E4%25BB%258B/%29%u3002%u6D4B%u8BD5%u76F8%u5173%u7684%u529F%u80FD%u591F%u7528%uFF0C%u4F46%u662F%u6CA1%u6709mock%u5E93%u3002%u8FD9%u5E26%u6765%u7684%u95EE%u9898%u662F%uFF1A%0A1.%20%u6D4B%u8BD5%u9057%u7559%u4EE3%u7801%u7684%u65F6%u5019%uFF0C%u9700%u8981%u81EA%u884Cfake%u76F8%u5173%u4EE3%u7801%u3002%u8FD9%u4E2A%u5728%u9057%u7559%u7CFB%u7EDF%u5F88%u5E9E%u5927%u65F6%uFF0C%u8981%u9887%u8D39%u5FC3%u529B%u3002%u800C%u4E14%u8FC7%u591A%u6D89%u53CA%u7EC6%u8282%uFF0C%u5BFC%u81F4%u6D4B%u8BD5%u6781%u4E0D%u7A33%u5B9A%uFF0C%u7CFB%u7EDF%u4EE3%u7801%u4EFB%u610F%u7684%u6F14%u8FDB%uFF0C%u90FD%u4F1A%u5BFC%u81F4%u5927%u5806%u7684%u6D4B%u8BD5%u5931%u8D25%uFF0C%u751A%u81F3%u6D4B%u8BD5%u65E0%u6CD5%u8FDB%u884C%u3002%0A2.%20%u6D4B%u8BD5case%u4E4B%u95F4%u65E0%u6CD5%u5F88%u597D%u7684%u89E3%u8026%u3002%u7ED3%u679C%u540C%u6837%u662F%u6D4B%u8BD5%u4E0D%u591F%u7A33%u5B9A%u3002%u672F%u8BED%u662F%u6D4B%u8BD5%u4EE3%u7801%u5F88%u201C%u8106%u5F31%u201D%u3002%0A%0AJava%uFF0CPython%uFF0CJavaScript%u90FD%u6709%u81EA%u5DF1%u7684mock%u5E93%u3002Python%u7684Mock%u7C7B%uFF0CJava%u7684Mockito/PowerMock%uFF0CJavaScript%u7684Sinon%u3002%u4E8E%u662F%uFF0C%u5728%u7F51%u4E0A%u641C%u7D22%u4E86%u4E00%u4E0BC/C++%u7684Mock%u5E93%uFF0C%u4E8E%u662F%u770B%u5230%u4E86gtest%uFF0Cgmock%u3002%u7136%u540E%u5C31%u6709%u4E86%u8FD9%u4E00%u7BC7%u3002%0A%0A%23%23%20%u7B80%u4ECB%0A%u4E0D%u7528%u53BB%u7F51%u4E0A%u8D39%u5FC3%u627E%u6559%u7A0B%uFF0C%u4E24%u4E2A%u9879%u76EE%u7684%u6587%u6863%u90FD%u975E%u5E38%u68D2%u3002%u5165%u53E3%u7EDF%u4E00%u5728%5Bgtest%20GitHub%u9879%u76EE%u4E3B%u9875%5D%28https%3A//github.com/google/googletest%29%u4E0A%u3002%u800C%u4E14%u8BE5%u6587%u6863%u4E0D%u4EC5%u5F88%u597D%u7684%u4ECB%u7ECD%u4E86gtest%uFF0Cgmock%u7684%u7528%u6CD5%uFF0C%u5176%u4E2D%u8FD8%u6D89%u53CA%u4E86%u5F88%u591ATDD%u6216%u8005UnitTest%u7684%u771F%u77E5%u707C%u89C1%uFF0C%u5F88%u503C%u5F97%u8BFB%u4E00%u8BFB%u3002%0A%u8981%u4F7F%u7528gtest%u975E%u5E38%u7B80%u5355%uFF1A%u7F16%u8BD1%u51FAgtest%uFF0Cgmock%uFF0C%u518D%u94FE%u5165%u4F60%u7684%u6D4B%u8BD5%u7A0B%u5E8F%u3002%0A%0A%23%23%23%20%u7F16%u8BD1gtest/gmock%0Agtest%uFF0Cgmock%u5747%u7528cmake%u6765%u7BA1%u7406%u8DE8%u5E73%u53F0%uFF0C%u5148%u7528cmake%u6765%u751F%u6210Makefile%u3002%u7528%u547D%u4EE4%60cmake%20-G%20%22Unix%20Makefiles%22%20/path/to/CMakeList.txt%60%0A%0A%23%23%23%20Makefile%0A%u7136%u540E%u6309%u7167%u4E0B%u9762%u7F16%u5199Makefile%u3002%u6CE8%u610Fgmock_main%u662F%u4E00%u4E2Amain%u51FD%u6570%u6765%u8C03%u7528%u6240%u6709%u7684test%20case%uFF0C%u7701%u5F97%u81EA%u5DF1%u5199main%u51FD%u6570%u4E86%u3002%0A%60%60%60%0ACC%20%3D%20gcc%0ACPP%20%3D%20g++%0ALINK%20%3D%20g++%0ACFLAGS%20%3D%20-g%20-Wall%20-Werror%20-Wextra%20-std%3Dgnu99%0ACPPFLAGS%20%3D%20-g%20-Wall%20-Werror%20-Wextra%0ALIBS%20%3D%20-L./lib%20-lgtest%20-lgmock%20-lgmock_main%20-lpthread%0A%0AC__SOURCES%20%3D%20%24%28wildcard%20*.c%29%0ACPPSOURCES%20%3D%20%24%28wildcard%20*.cpp%29%0AOBJECTS%20%3D%20%24%28patsubst%20%25.c%2C%20%25.o%2C%20%24%28C__SOURCES%29%29%20%24%28patsubst%20%25.cpp%2C%20%25.o%2C%20%24%28CPPSOURCES%29%29%0ATARGET%20%3D%20test_exe%0A%0Afirst%3A%20all%0A%0A%25.o%3A%20%25.c%0A%20%20%20%20%24%28CC%29%20%24%28INCLUDES%29%20-c%20%24%28CFLAGS%29%20-o%20%24@%20%24%3C%0A%0A%25.o%3A%20%25.cpp%0A%20%20%20%20%24%28CPP%29%20%24%28INCLUDES%29%20-c%20%24%28CPPFLAGS%29%20-o%20%24@%20%24%3C%0A%0Aall%3A%20%24%28TARGET%29%0A%0A%24%28TARGET%29%3A%20%24%28OBJECTS%29%0A%20%20%20%20%24%28LINK%29%20%24%28CPPFLAGS%29%20%24%28LIBS%29%20-o%20%24%28TARGET%29%20%24%28OBJECTS%29%0A%0A.PHONY%20%3A%20clean%0A%0Aclean%3A%0A%20%20%20%20rm%20-f%20%24%28TARGET%29%20%24%28OBJECTS%29%0A%60%60%60%0A%0A%23%23%23%20Terms%0A%7C%20Meaning%20%20%20%20%7C%20Google%20Test%20Term%20%7C%20ISTQB%20Term%20%7C%0A%7C%20%3A--------%3A%20%7C%20%3A--------------%3A%20%7C%20%3A--------%3A%20%7C%0A%7C%20Exercise%20a%20particular%20program%20path%20with%20specific%20input%20values%20and%20verify%20the%20results%20%7C%20TEST%28%29%20%7C%20Test%20Case%0A%7CA%20set%20of%20several%20tests%20related%20to%20one%20component%20%7C%20Test%20Case%20%7C%20Test%20Suite%0A%0A%23%23%23%20Test%0A%60%60%60%0A%23include%20%22gtest/gtest.h%22%0A%23include%20%22gmock/gmock.h%22%0A%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0Ausing%20%3A%3Atesting%3A%3ATest%3B%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AAtLeast%3B%0A%0ATEST%28TestCaseName%2C%20should_this_test_do%29%0A%7B%0A%09...%0A%20%20%20%20EXPECT_STREQ%28%22%7B%7D%22%2C%20str%29%3B%0A%7D%0A%60%60%60%0A%u4E2D%u95F4%u7684%u90A3%u5806namespace%u90FD%u662Fgtest/gmock%u5E93%u91CC%u5B9A%u4E49%u7684matcher%u5B8F%u6216%u8005%u5404%u79CD%u6709%u7528%u7684%u5B8F%u3002%0A%0A%23%23%23%20Test%20Fixture%0A%u5728%u6D4B%u8BD5%u6709%u91CD%u590D%u7684%u65F6%u5019%uFF0C%u5C31%u8981%u7528%u5230Test%20Fixture%u4E86%uFF0C%u4E5F%u5C31%u662FsetUp%20/%20tearDown%u3002%0A%60%60%60%0Aclass%20QueueTest%20%3A%20public%20%3A%3Atesting%3A%3ATest%20%7B%0A%20protected%3A%0A%20%20virtual%20void%20SetUp%28%29%20%7B%0A%20%20%20%20q1_.Enqueue%281%29%3B%0A%20%20%20%20q2_.Enqueue%282%29%3B%0A%20%20%20%20q2_.Enqueue%283%29%3B%0A%20%20%7D%0A%0A%20%20//%20virtual%20void%20TearDown%28%29%20%7B%7D%0A%0A%20%20Queue%3Cint%3E%20q0_%3B%0A%20%20Queue%3Cint%3E%20q1_%3B%0A%20%20Queue%3Cint%3E%20q2_%3B%0A%7D%3B%0A%0ATEST_F%28QueueTest%2C%20IsEmptyInitially%29%20%7B%0A%20%20EXPECT_EQ%280%2C%20q0_.size%28%29%29%3B%0A%7D%0A%0ATEST_F%28QueueTest%2C%20DequeueWorks%29%20%7B%0A%20%20int*%20n%20%3D%20q0_.Dequeue%28%29%3B%0A%20%20EXPECT_EQ%28NULL%2C%20n%29%3B%0A%0A%20%20n%20%3D%20q1_.Dequeue%28%29%3B%0A%20%20ASSERT_TRUE%28n%20%21%3D%20NULL%29%3B%0A%20%20EXPECT_EQ%281%2C%20*n%29%3B%0A%20%20EXPECT_EQ%280%2C%20q1_.size%28%29%29%3B%0A%20%20delete%20n%3B%0A%0A%20%20n%20%3D%20q2_.Dequeue%28%29%3B%0A%20%20ASSERT_TRUE%28n%20%21%3D%20NULL%29%3B%0A%20%20EXPECT_EQ%282%2C%20*n%29%3B%0A%20%20EXPECT_EQ%281%2C%20q2_.size%28%29%29%3B%0A%20%20delete%20n%3B%0A%7D%0A%60%60%60%0A%23%23%23%23%20constructor/destructor%20vs.%20SetUp/TearDown%0A%3EWhen%20you%20need%20to%20write%20per-test%20set-up%20and%20tear-down%20logic%2C%20you%20have%20the%20choice%20between%20using%20the%20test%20fixture%20constructor/destructor%20or%20SetUp%28%29/TearDown%28%29.%20The%20former%20is%20usually%20preferred%2C%20as%20it%20has%20the%20following%20benefits%3A%0A%0A%3E-%20By%20initializing%20a%20member%20variable%20in%20the%20constructor%2C%20we%20have%20the%20option%20to%20make%20it%20const%2C%20which%20helps%20prevent%20accidental%20changes%20to%20its%20value%20and%20makes%20the%20tests%20more%20obviously%20correct.%0A-%20**In%20case%20we%20need%20to%20subclass%20the%20test%20fixture%20class%2C%20the%20subclass%27%20constructor%20is%20guaranteed%20to%20call%20the%20base%20class%27%20constructor%20first%2C%20and%20the%20subclass%27%20destructor%20is%20guaranteed%20to%20call%20the%20base%20class%27%20destructor%20afterward.%20**With%20SetUp%28%29/TearDown%28%29%2C%20a%20subclass%20may%20make%20the%20mistake%20of%20forgetting%20to%20call%20the%20base%20class%27%20SetUp%28%29/TearDown%28%29%20or%20call%20them%20at%20the%20wrong%20moment.%0A%0A%3E%20Benefit%20for%20using%20SetUp/TearDown%3A%0A%0A%3E-%20If%20the%20tear-down%20operation%20could%20throw%20an%20exception%2C%20you%20must%20use%20TearDown%28%29%20as%20opposed%20to%20the%20destructor%2C%20as%20throwing%20in%20a%20destructor%20leads%20to%20undefined%20behavior%20and%20usually%20will%20kill%20your%20program%20right%20away.%20Note%20that%20many%20standard%20libraries%20%28like%20STL%29%20may%20throw%20when%20exceptions%20are%20enabled%20in%20the%20compiler.%20Therefore%20you%20should%20prefer%20TearDown%28%29%20if%20you%20want%20to%20write%20portable%20tests%20that%20work%20with%20or%20without%20exceptions.%0A-%20The%20assertion%20macros%20throw%20an%20exception%20when%20flag%20--gtest_throw_on_failure%20is%20specified.%20Therefore%2C%20you%20shouldn%27t%20use%20Google%20Test%20assertions%20in%20a%20destructor%20if%20you%20plan%20to%20run%20your%20tests%20with%20this%20flag.%0A-%20In%20a%20constructor%20or%20destructor%2C%20you%20cannot%20make%20a%20virtual%20function%20call%20on%20this%20object.%20%28You%20can%20call%20a%20method%20declared%20as%20virtual%2C%20but%20it%20will%20be%20statically%20bound.%29%20Therefore%2C%20if%20you%20need%20to%20call%20a%20method%20that%20will%20be%20overriden%20in%20a%20derived%20class%2C%20you%20have%20to%20use%20SetUp%28%29/TearDown%28%29.%0A%0A%u7B80%u8A00%u4E4B%uFF0C%u5728%u903B%u8F91%u4E0A%uFF0C%u8FD9%u4E24%u7EC4%u7684%u4F5C%u7528%u76F8%u540C%uFF0C%u90FD%u662F%u6BCF%u4E2A%u6D4B%u8BD5%u4E4B%u524D%u4E4B%u540E%u4F1A%u505A%u4E00%u4E9B%u5904%u7406%u5DE5%u4F5C%u3002Constructor/Destructor%u7684%u597D%u5904%u662F%u63D0%u4F9B%u4E86%u7EE7%u627F%u3002setUp/tearDown%u7684%u597D%u5904%u662F%u53EF%u4EE5%u5904%u7406exception%uFF0C%u8FD9%u662F%u4E0D%u80FD%u653E%u5728%u6790%u6784%u51FD%u6570%u91CC%u7684%u3002%0A%23%23%23%20SetUpTestCase%20/%20TearDownTestCase%0ATest%20Case%u7EA7%u522B%u7684SetUp/TearDown%0A%60%60%60%0Aclass%20FooTest%20%3A%20public%20%3A%3Atesting%3A%3ATest%20%7B%0A%20protected%3A%0A%20%20//%20Per-test-case%20set-up.%0A%20%20//%20Called%20before%20the%20first%20test%20in%20this%20test%20case.%0A%20%20//%20Can%20be%20omitted%20if%20not%20needed.%0A%20%20static%20void%20SetUpTestCase%28%29%20%7B%0A%20%20%20%20shared_resource_%20%3D%20new%20...%3B%0A%20%20%7D%0A%0A%20%20//%20Per-test-case%20tear-down.%0A%20%20//%20Called%20after%20the%20last%20test%20in%20this%20test%20case.%0A%20%20//%20Can%20be%20omitted%20if%20not%20needed.%0A%20%20static%20void%20TearDownTestCase%28%29%20%7B%0A%20%20%20%20delete%20shared_resource_%3B%0A%20%20%20%20shared_resource_%20%3D%20NULL%3B%0A%20%20%7D%0A%0A%20%20//%20You%20can%20define%20per-test%20set-up%20and%20tear-down%20logic%20as%20usual.%0A%20%20virtual%20void%20SetUp%28%29%20%7B%20...%20%7D%0A%20%20virtual%20void%20TearDown%28%29%20%7B%20...%20%7D%0A%0A%20%20//%20Some%20expensive%20resource%20shared%20by%20all%20tests.%0A%20%20static%20T*%20shared_resource_%3B%0A%7D%3B%0A%60%60%60%0A%23%23%23%20SetUp/TearDown%20Environment%20%0A%3E-%20First%2C%20you%20subclass%20the%20%3A%3Atesting%3A%3AEnvironment%20class%20to%20define%20a%20test%20environment%2C%20which%20knows%20how%20to%20set-up%20and%20tear-down%3A%0A%3E-%20Then%2C%20you%20register%20an%20instance%20of%20your%20environment%20class%20with%20Google%20Test%20by%20calling%20the%20%60%3A%3Atesting%3A%3AAddGlobalTestEnvironment%28%29%60%20function%3A%0A%3ENow%2C%20when%20RUN_ALL_TESTS%28%29%20is%20called%2C%20it%20first%20calls%20the%20SetUp%28%29%20method%20of%20the%20environment%20object%2C%20then%20runs%20the%20tests%20if%20there%20was%20no%20fatal%20failures%2C%20and%20finally%20calls%20TearDown%28%29%20of%20the%20environment%20object.%0A-%20It%27s%20OK%20to%20register%20multiple%20environment%20objects.%20In%20this%20case%2C%20their%20SetUp%28%29%20will%20be%20called%20in%20the%20order%20they%20are%20registered%2C%20and%20their%20TearDown%28%29%20will%20be%20called%20in%20the%20reverse%20order.%0A-%20Note%20that%20Google%20Test%20takes%20ownership%20of%20the%20registered%20environment%20objects.%20Therefore%20do%20not%20delete%20them%20by%20yourself.%0A%0A%60%60%60%0Aclass%20Environment%20%7B%0A%20public%3A%0A%20%20virtual%20%7EEnvironment%28%29%20%7B%7D%0A%20%20//%20Override%20this%20to%20define%20how%20to%20set%20up%20the%20environment.%0A%20%20virtual%20void%20SetUp%28%29%20%7B%7D%0A%20%20//%20Override%20this%20to%20define%20how%20to%20tear%20down%20the%20environment.%0A%20%20virtual%20void%20TearDown%28%29%20%7B%7D%0A%7D%3B%0A%0AEnvironment*%20AddGlobalTestEnvironment%28Environment*%20env%29%3B%0A%60%60%60%0A%23%23%23%20%u65AD%u8A00%0A%u6709%u4E24%u79CD%u65AD%u8A00EXPECT%5C_xxx%u548CASSERT%5C_xxx%u3002%u524D%u8005%u4F1A%u8BA9%u6D4B%u8BD5%u7EC8%u6B62%uFF0C%u540E%u8005%u4E0D%u4F1A%uFF0C%u53EA%u4F1A%u8BA9%u6D4B%u8BD5fail%u3002%0A%0A%0A%23%23%20gmock%0A%u4E4B%u6240%u4EE5%u8981%u5207%u5230gtest%uFF0C%u552F%u4E00%u7684%u539F%u56E0%u5C31%u662Fgmock%uFF0C%u6240%u4EE5%u8981%u4E13%u5F00%u4E00%u7AE0%u91CD%u70B9%u4ECB%u7ECD%u4E00%u4E0B%u3002%u6240%u6709%u5185%u5BB9%u5747%u6765%u81EA%u4E8E%u5B98%u65B9%u6587%u6863%u3002%u5185%u5BB9%u6DF1%u5EA6%u7531%u6D45%u5165%u6DF1%uFF0C%u4F9D%u6B21%u5982%u4E0B%uFF1A%0A-%20%5BGoogle%20Mock%20for%20Dummies%5D%28https%3A//github.com/google/googletest/blob/master/googlemock/docs/ForDummies.md%29%0A-%20%5BCookBook%5D%28https%3A//github.com/google/googletest/blob/master/googlemock/docs/CookBook.md%29%0A%0A%u6700%u540E%u8FD8%u6709%u53C2%u8003%u624B%u518C%3A%0A-%20%5BCheat%20Sheet%5D%28https%3A//github.com/google/googletest/blob/master/googlemock/docs/CheatSheet.md%29%0A%0A%23%23%23%20%u7B80%u4ECB%0A%3EGoogle%20C++%20Mocking%20Framework%20%28or%20Google%20Mock%20for%20short%29%20is%20a%20library%20%28sometimes%20we%20also%20call%20it%20a%20%22framework%22%20to%20make%20it%20sound%20cool%29%20for%20creating%20mock%20classes%20and%20using%20them.%20It%20does%20to%20C++%20what%20jMock%20and%20EasyMock%20do%20to%20Java.%0A%0A%23%23%23%23%20%u4F55%u4E3AMock%uFF1F%0A%3E**Mocks**%20are%20objects%20pre-programmed%20with%20expectations%2C%20which%20form%20a%20specification%20of%20the%20calls%20they%20are%20expected%20to%20receive.%0A%0A%u76F8%u5E94%u7684%u8FD8%u6709Fake%u548CStub%0A%3E**Fake**%20objects%20have%20working%20implementations%2C%20but%20usually%20take%20some%20shortcut%20%28perhaps%20to%20make%20the%20operations%20less%20expensive%29%2C%20which%20makes%20them%20not%20suitable%20for%20production.%20An%20in-memory%20file%20system%20would%20be%20an%20example%20of%20a%20fake.%0A%0Agmock%u7684%u6587%u6863%u91CC%u53EA%u63D0%u5230%u4E86Fake%uFF0C%u4ECEMartin%20Fowler%u7684%u6587%u7AE0%5BMocks%20Aren%27t%20Stubs%5D%28https%3A//martinfowler.com/articles/mocksArentStubs.html%29%u4E2D%u6458%u5F55%u5982%u4E0B%3A%0A%3E**Stubs**%20provide%20canned%20answers%20to%20calls%20made%20during%20the%20test%2C%20usually%20not%20responding%20at%20all%20to%20anything%20outside%20what%27s%20programmed%20in%20for%20the%20test.%0A%0A%u4E09%u8005%u4F5C%u7528%u76F8%u540C%uFF0C%u90FD%u662F%u6A21%u62DF%u7CFB%u7EDF%u5176%u4ED6%u90E8%u5206%u7684%u529F%u80FD%uFF0C%u8FBE%u5230%u4EE3%u7801%u9694%u79BB%u7684%u6548%u679C%uFF0C%u65B9%u4FBF%u6D4B%u8BD5%u3002%u4F46%u662FMock%u7684%u7279%u70B9%u662F%u66F4OO%u5316%uFF0C%u4E5F%u7B26%u5408TDD%u6216%u8005BDD%u7684%u601D%u60F3%u2014%u2014%u9488%u5BF9%u4E00%u4E2Aobject%u8BBE%u7F6E%u671F%u5F85%uFF0C%u518D%u5BF9%u9F50verify%u3002%0A%0AMocks%20vs.%20Stubs%20-%20from%20Martin%20Fowler%0A%3EIn%20order%20to%20use%20state%20verification%20on%20the%20stub%2C%20I%20need%20to%20make%20some%20extra%20methods%20on%20the%20stub%20to%20help%20with%20verification.%20As%20a%20result%20the%20stub%20implements%20MailService%20but%20adds%20extra%20test%20methods.%0A%0A%3EMock%20objects%20always%20use%20behavior%20verification%2C%20a%20stub%20can%20go%20either%20way.%20Meszaros%20refers%20to%20stubs%20that%20use%20behavior%20verification%20as%20a%20Test%20Spy.%20The%20difference%20is%20in%20how%20exactly%20the%20double%20runs%20and%20verifies%20and%20I%27ll%20leave%20that%20for%20you%20to%20explore%20on%20your%20own.%0A%0A%23%23%23%23%20Getting%20Started%0AClass%20to%20Mock%0A%60%60%60%0Aclass%20Turtle%20%7B%0A%20%20...%0A%20%20virtual%20%7ETurtle%28%29%20%7B%7D%0A%20%20virtual%20void%20PenUp%28%29%20%3D%200%3B%0A%20%20virtual%20void%20PenDown%28%29%20%3D%200%3B%0A%20%20virtual%20void%20Forward%28int%20distance%29%20%3D%200%3B%0A%7D%3B%0A%60%60%60%0AMock%20class%0A%60%60%60%0A%23include%20%22gmock/gmock.h%22%20%20//%20Brings%20in%20Google%20Mock.%0Aclass%20MockTurtle%20%3A%20public%20Turtle%20%7B%0A%20public%3A%0A%20%20...%0A%20%20MOCK_METHOD0%28PenUp%2C%20void%28%29%29%3B%0A%20%20MOCK_METHOD0%28PenDown%2C%20void%28%29%29%3B%0A%20%20MOCK_METHOD1%28Forward%2C%20void%28int%20distance%29%29%3B%0A%7D%3B%0A%60%60%60%0A%u9488%u5BF9%u5F85Mock%u7684Turtle%20class%u8981%u6CE8%u610F%u7684%u662F%3A%0A%3ENote%20that%20the%20**destructor%20of%20Turtle%20must%20be%20virtual**%2C%20as%20is%20the%20case%20for%20all%20classes%20you%20intend%20to%20inherit%20from%20-%20otherwise%20the%20destructor%20of%20the%20derived%20class%20will%20not%20be%20called%20when%20you%20delete%20an%20object%20through%20a%20base%20pointer%2C%20and%20you%27ll%20get%20corrupted%20program%20states%20like%20memory%20leaks.%0A%0AUse%20it%0A%60%60%60%0A%23include%20%22path/to/mock-turtle.h%22%0A%23include%20%22gmock/gmock.h%22%0A%23include%20%22gtest/gtest.h%22%0Ausing%20%3A%3Atesting%3A%3AAtLeast%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%231%0A%0ATEST%28PainterTest%2C%20CanDrawSomething%29%20%7B%0A%20%20MockTurtle%20turtle%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%232%0A%20%20EXPECT_CALL%28turtle%2C%20PenDown%28%29%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%233%0A%20%20%20%20%20%20.Times%28AtLeast%281%29%29%3B%0A%0A%20%20Painter%20painter%28%26turtle%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%234%0A%0A%20%20EXPECT_TRUE%28painter.DrawCircle%280%2C%200%2C%2010%29%29%3B%0A%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%235%0A%0Aint%20main%28int%20argc%2C%20char**%20argv%29%20%7B%0A%20%20//%20The%20following%20line%20must%20be%20executed%20to%20initialize%20Google%20Mock%0A%20%20//%20%28and%20Google%20Test%29%20before%20running%20the%20tests.%0A%20%20%3A%3Atesting%3A%3AInitGoogleMock%28%26argc%2C%20argv%29%3B%0A%20%20return%20RUN_ALL_TESTS%28%29%3B%0A%7D%0A%60%60%60%0A%u5982%u679C%u4F60%u613F%u610F%u7684%u8BDD%uFF0C%u53EF%u4EE5%u81EA%u5DF1%u5199main%uFF0C%u5982%u679C%u4F60%u60F3%u5077%u61D2%uFF0C%u8BB0%u5F97%u5728Makefile%u91CClink%20gmock_main%u3002%0A%u6309Google%u7684%u8BF4%u6CD5%uFF0Cgmock%u4E5F%u53EF%u4EE5%u548C%u5176%u4ED6%u6D4B%u8BD5%u6846%u67B6%u517C%u5BB9%uFF0C%u4F46%u603B%u611F%u89C9%u633A%u60AC%u7684%u3002%0A%0A%23%23%23%23%20%u4E00%u4E9B%u6709%u7528%u7684%u5DE5%u5177%0A**Marcher**%0A%60EXPECT_CALL%28turtle%2C%20Forward%28_%29%29%3B%60%0A%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%20%u4EE5%u4EFB%u610F%u53C2%u6570%u8C03%u7528Forward%0A%60EXPECT_CALL%28turtle%2C%20Forward%28Ge%28100%29%29%29%3B%60%0A%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%20%u4EE5%u5927%u4E8E100%u7684%u6574%u6570%u8C03%u7528Forward%0A%09%0A**Cardinalities%3A%20How%20Many%20Times%20Will%20It%20Be%20Called%3F**%0A%3E-%20If%20neither%20WillOnce%28%29%20nor%20WillRepeatedly%28%29%20is%20in%20the%20EXPECT_CALL%28%29%2C%20the%20inferred%20cardinality%20is%20Times%281%29.%0A-%20If%20there%20are%20n%20WillOnce%28%29%27s%20but%20no%20WillRepeatedly%28%29%2C%20where%20n%20%3E%3D%201%2C%20the%20cardinality%20is%20Times%28n%29.%0A-%20If%20there%20are%20n%20WillOnce%28%29%27s%20and%20one%20WillRepeatedly%28%29%2C%20where%20n%20%3E%3D%200%2C%20the%20cardinality%20is%20Times%28AtLeast%28n%29%29.%0A%0A%60%60%60%0AEXPECT_CALL%28mockObj%2C%20func%28%29%29%0A%09.Times%28AtLeast%281%29%29%0A%09.WillOnce%28Return%28123%29%29%0A%09.WillRepeatedly%28Return%28456%29%29%0A%60%60%60%0A%u4E0A%u9762%u8FD9%u6BB5%u4EE3%u7801%u8981%u6C42func%u51FD%u6570%u81F3%u5C11%u8FD0%u884C%u4E00%u6B21%uFF0C%u7B2C%u4E00%u6B21%u8FD4%u56DE123%uFF0C%u4E4B%u540E%u6BCF%u6B21%u8FD4%u56DE456%u3002%0A%0A%3E**Important%20note**%3A%20The%20EXPECT_CALL%28%29%20statement%20evaluates%20the%20action%20clause%20only%20once%2C%20even%20though%20the%20action%20may%20be%20performed%20many%20times.%20Therefore%20you%20must%20be%20careful%20about%20side%20effects.%20The%20following%20may%20not%20do%20what%20you%20want%3A%0A%0A%60%60%60%0Aint%20n%20%3D%20100%3B%0AEXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A.Times%284%29%0A.WillRepeatedly%28Return%28n++%29%29%3B%0A%60%60%60%0A%u56E0%u4E3AReturn%u662F%u5B8F%uFF0C%u6240%u4EE5%u53EA%u4F1A%u66FF%u6362%u4E00%u6B21%uFF0C%u6240%u4EE5%u4E0D%u7BA1GetX%u8C03%u7528%u51E0%u6B21%uFF0C%u8FD4%u56DE%u90FD%u662F101%uFF0C%u800C%u4E0D%u662F101%2C102%2C103%2C...%0A%0A**All%20Expectations%20Are%20Sticky**%0A%u6240%u8C13%u7684sticky%u5C31%u662FEXPECT%5C_CALL%u603B%u662F%u751F%u6548%u7684%uFF0C%u9664%u975E%u4F60%u663E%u793A%u7684%u5C06%u5176%u5931%u6548%u3002%u5982%u4E0B%uFF0C%u6240%u6709%u7684EXPECT%5C_CALL%u90FD%u4F1A%u751F%u6548%uFF0C%u90A3%u4E48%u6700%u540E%u4E00%u4E2A%u4F1A%u8986%u76D6%u524D%u9762%u6240%u6709%u7684%uFF0C%u4E5F%u5C31%u662FGetX%u603B%u4F1A%u8FD4%u56DE10%u3002%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0A...%0Afor%20%28int%20i%20%3D%20n%3B%20i%20%3E%200%3B%20i--%29%20%7B%0A%20%20EXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A%20%20%20%20%20%20.WillOnce%28Return%2810*i%29%29%3B%0A%7D%0A%60%60%60%0A%u5982%u679C%u5E0C%u671B%u4ED6%u8FD4%u56DE%uFF0C30%2C20%2C10%uFF0C...%uFF0C%u5E94%u8BE5%u8FD9%u4E48%u5199%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0A...%0Afor%20%28int%20i%20%3D%20n%3B%20i%20%3E%200%3B%20i--%29%20%7B%0A%20%20EXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A%20%20%20%20.WillOnce%28Return%2810*i%29%29%0A%20%20%20%20.RetiresOnSaturation%28%29%3B%0A%7D%0A%60%60%60%0A%60RetireOnSaturation%60%u5C31%u662F%u663E%u793A%u7684%u8BA9%u5176%u5931%u6548%u3002%u8FD8%u6709%u4E00%u4E2A%u529E%u6CD5%uFF1A%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AInSequence%3B%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0A...%0A%7B%0A%20%20InSequence%20s%3B%0A%0A%20%20for%20%28int%20i%20%3D%201%3B%20i%20%3C%3D%20n%3B%20i++%29%20%7B%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A%20%20%20%20%20%20%20%20.WillOnce%28Return%2810*i%29%29%0A%20%20%20%20%20%20%20%20.RetiresOnSaturation%28%29%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%u56E0%u4E3AInSequence%u7684%u5173%u7CFB%uFF0C%u5728%u524D%u9762%u7684EXPECT%5C_CALL%u751F%u6548%u4EE5%u540E%uFF0C%u5C31%u4F1A%u81EA%u52A8%u5931%u6548%uFF0C%u6240%u4EE5%u4E0D%u4F1A%u4EA7%u751F%u8986%u76D6%u7684%u6548%u679C%u3002%0A**Ordered%20vs%20Unordered%20Calls**%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AInSequence%3B...%0ATEST%28FooTest%2C%20DrawsLineSegment%29%20%7B%0A%20%20...%0A%20%20%7B%0A%20%20%20%20InSequence%20dummy%3B%0A%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20PenDown%28%29%29%3B%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20Forward%28100%29%29%3B%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20PenUp%28%29%29%3B%0A%20%20%7D%0A%20%20Foo%28%29%3B%0A%7D%0A%60%60%60%0A**Expecting%20Partially%20Ordered%20Calls**%0AGoogle%20Mock%20allows%20you%20to%20impose%20an%20arbitrary%20DAG%20%28directed%20acyclic%20graph%29%20on%20the%20calls.%20One%20way%20to%20express%20the%20DAG%20is%20to%0Ause%20the%20After%20clause%20of%20EXPECT_CALL%20.%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3ASequence%3B%0ASequence%20s1%2C%20s2%3B%0AEXPECT_CALL%28foo%2C%20A%28%29%29%0A%09.InSequence%28s1%2C%20s2%29%3B%0AEXPECT_CALL%28bar%2C%20B%28%29%29%0A%09.InSequence%28s1%29%3B%0AEXPECT_CALL%28bar%2C%20C%28%29%29%0A%09.InSequence%28s2%29%3B%0AEXPECT_CALL%28foo%2C%20D%28%29%29%0A%09.InSequence%28s2%29%3B%0A%60%60%60%0Aspecifies%20the%20following%20DAG%20%28where%20s1%20is%20A%20-%3E%20B%20%2C%20and%20s2%20is%20A%20-%3E%20C%20-%3E%20D%20%29%3A%0A%60%60%60%0A%09%20+---%3E%20B%0A%20%20%20%20%20%7C%0AA%20---%7C%0A%09%20%7C%0A%09%20+---%3E%20C%20---%3E%20D%0A%60%60%60%0A**Uninteresting%20Calls**%0A%u8FD9%u662Fgmock%u62A5%u7684warning%u3002%u5F53%u9488%u5BF9%u67D0%u4E00%u4E2A%u5F85%u6D4B%u51FD%u6570%u8BBE%u7F6E%u4E86EXPECT%20spec%uFF0C%u5374%u5E76%u6CA1%u6709%u8C03%u7528%u7684%u65F6%u5019%uFF0C%u5C31%u4F1A%u62A5%u8FD9%u4E2Awarning%u3002%u6B64%u65F6gmock%u8BA4%u4E3A%u4F60%u5BF9%u8BE5%u51FD%u6570%u5E76%u6CA1%u6709%u5174%u8DA3%uFF0C%u6240%u4EE5%u5C31%u4E0D%u9700%u8981%u8FD9%u4E2AEXPECT%20spec%u3002%u5F53%u7136%u4F60%u53EF%u4EE5%u9009%u62E9%u5FFD%u7565%u8FD9%u4E2Awarning%uFF0C%u4F46%u6211%u8BA4%u4E3A%u51FA%u8FD9%u4E2Awarning%u7684%u65F6%u5019%uFF0C%u591A%u534A%u662Ftest%u6F0F%u5199%u4E86%u4EC0%u4E48%u3002%0A%0A**Returning%20Live%20Values%20from%20Mock%20Methods**%0A%60%60%60%0Ausing%20testing%3A%3AByRef%3B%0Ausing%20testing%3A%3AReturn%3B%0Aclass%20MockFoo%20%3A%20public%20Foo%20%7B%0A%09public%3A%0A%09%09MOCK_METHOD0%28GetValue%2C%20int%28%29%29%3B%0A%7D%3B%0A...%0Aint%20x%20%3D%200%3B%0AMockFoo%20foo%3B%0AEXPECT_CALL%28foo%2C%20GetValue%28%29%29%0A%09//%20.WillRepeatedly%28Return%28ByRef%28x%29%29%29%3B%20X%20error%0A%09.WillRepeatedly%28ReturnPointee%28x%29%29%3B%0Ax%20%3D%2042%3B%0AEXPECT_EQ%2842%2C%20foo.GetValue%28%29%29%3B%0A%60%60%60%0A%0A%23%23%23%20%u4E00%u4E9B%u6D4B%u8BD5case%0A%u5199Unit%20Test%u5E76%u4E0D%u50CF%u60F3%u50CF%u7684%u90A3%u4E48%u7B80%u5355%uFF0C%u5E76%u4E0D%u662F%u8C03%u7528%u4E86%u6846%u67B6%uFF0C%u9488%u5BF9%u6BCF%u4E2A%u51FD%u6570%u5199test%20case%u5C31%u53EF%u4EE5%u3002%u6309%u6211%u76EE%u524D%u7684%u7406%u89E3%u6709%u4EE5%u4E0B%u51E0%u79CD%u6311%u6218%uFF1A%0A1.%20Test%20Case%u5982%u4F55%u89E3%u8026%u3002%u4E0D%u8981%u6709%u91CD%u590D%u6D4B%u8BD5%28overlap%29%u3002%0A%u4F8B%u5982%uFF1A%u5728%u5199A%u51FD%u6570%u7684%u65F6%u5019%uFF0C%u5199%u4E86%u6D4B%u8BD5testA%uFF0CB%u51FD%u6570%u4F1A%u8C03%u7528A%u51FD%u6570%uFF0C%u90A3%u4E48%u5728%u5199%u5B8CA%u4E4B%u540E%u5199B%u7684%u6D4B%u8BD5testB%u65F6%uFF0C%u662F%u5426%u8981%u5C06A%20mock/fake/stub%u6389%3F%20%u5982%u679C%u4E0D%u5C06A%u51FD%u6570Fake%u6389%uFF0C%u5219testA%u548CtestB%u4E4B%u95F4%u5C31%u662F%u6709overlap%u3002%u6211%u8BA4%u4E3A%u8FD9%u4E4B%u95F4%u53EF%u4EE5%u6709%u53D6%u820D%uFF0C%u6700%u4F73%u72B6%u6001%u5E94%u5F53%u662F%u6B64%u65F6%uFF0C%u5C06testA%u5220%u9664%uFF0C%u53EA%u4FDD%u7559testB%u3002%u4F46%u4ECD%u5E94%u6839%u636E%u5177%u4F53%u60C5%u51B5%u800C%u5B9A%u3002%0A%0A2.%20%u5982%u4F55%u9488%u5BF9%u4F9D%u8D56%u5173%u7CFB%u8FDB%u884Cmock%u5316%u3002%0A%u4F8B%u5982%u51FA%u73B0%u8FD9%u6837%u7684%u8BED%u53E5%3A%20%60B%20%3D%20new%20A%60%uFF0C%u5219%u7C7BB%u4F9D%u8D56%u4E8E%u7C7BA%u3002%u4F46%u7C7BA%u5E76%u6CA1%u6709%u5FC5%u8981%u7F16%u8BD1%u8FDBtest%u3002%u56E0%u4E3A%u4E00%u65E6%u52A0%u5165A%uFF0C%u5219%u52BF%u5FC5%u4F1A%u5F15%u5165%u66F4%u591A%u4F9D%u8D56%u5173%u7CFB%uFF0C%u800C%u5BFC%u81F4test%u7F16%u8BD1%u5D29%u6E83%u3002%u4F9D%u8D56%u5173%u7CFB%u7684%u89E3%u51B3%u65E0%u7A77%u65E0%u5C3D%u3002%u5728%u505AAndroid%u7684%u5355%u5143%u6D4B%u8BD5%u65F6%uFF0C%u53EF%u4EE5%u7528PowerMock%u53D6%u4EE3Mockito%u6765Mock%u6784%u9020%u51FD%u6570%uFF0C%u5C06%u6784%u9020%u51FD%u6570Fake%u5316%u6210%u7C7B%u4F3C%u5DE5%u5382%u51FD%u6570%uFF0C%u8FD4%u56DE%u7C7B%u5B9E%u4F8B%u3002%u5177%u4F53%u53C2%u770B%u8FD9%u7BC7%u535A%u6587%5BAndroid%u5355%u5143%u6D4B%u8BD5%5D%28https%3A//zhougy0717.github.io/2016/10/19/Android%25E5%258D%2595%25E5%2585%2583%25E6%25B5%258B%25E8%25AF%2595/%29%u3002%0A%u4F46%u5B9E%u9645%u4E0A%uFF0C%u6309%u7167%u73B0%u5728%u7684%u7406%u89E3%uFF0C%u5176%u5B9EMock%u6784%u9020%u51FD%u6570%u662F%u4E0D%u53EF%u53D6%u7684%uFF0C%u9996%u5148%u9020%u6210%u88AB%u6D4B%u4EE3%u7801spec%u4E0D%u6E05%u6670%uFF0C%u8BD5%u60F3%u4E00%u4E2A%u6784%u9020%u51FD%u6570%u600E%u4E48%u4F1A%u8FD4%u56DE%u53E6%u4E00%u4E2A%u7C7B%u7684%u5B9E%u4F8B%u3002%u5176%u6B21%uFF0C%u5728C++%u4E2D%u5F88%u96BE%u505A%u5230Mock%u6784%u9020%u51FD%u6570%u3002%u597D%u7684%u505A%u6CD5%u5E94%u5F53%u662F%u8FD0%u7528Dependency%20Injection%u3002%u4F8B%u5982%uFF1A%0A%60%60%60%0Aclass%20A%20%0A%7B%7D%0A%0Aclass%20B%0A%7B%0A%09void%20func%28%29%0A%09%7B%0A%09%09A*%20a%20%3D%20new%20A%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u7C7BB%u5E94%u5F53%u6539%u5199%u4E3A%uFF1A%0A%60%60%60%0Aclass%20B%0A%7B%0A%09void%20func%28A*%29%0A%09%7B%0A%09%09...%0A%09%7D%0A%7D%0A%60%60%60%0A%u5C06%u7C7BA%u6307%u9488%u4F20%u5165%uFF0C%u89E3%u51B3dependency%u7684%u95EE%u9898%u3002%0A%0A3.%20%u5982%u4F55%u80FD%u591F%u8BA9%u6D4B%u8BD5%u7A33%u5B9A%uFF0C%u5728%u4EFB%u610F%u73AF%u5883%u4E0B%u5747%u8FD4%u56DE%u540C%u6837%u7684%u6D4B%u8BD5%u7ED3%u679C%u3002%0A%u8FD9%u4E2A%u4E00%u822C%u6D89%u53CA%u6D4B%u8BD5%u73AF%u5883%u7684%u5F71%u54CD%u3002%u4F8B%u5982%u8C03%u7528%u7F51%u7EDC%u76F8%u5173%u7684%u529F%u80FD%uFF0C%u5728%u6CA1%u6709%u7F51%u7EDC%u7684%u73AF%u5883%u5C31%u6CA1%u6CD5%u8FDB%u884C%u3002%u518D%u4F8B%u5982%u6D4B%u8BD5%u65F6%u64CD%u4F5C%u771F%u5B9E%u5177%u4F53%u6587%u4EF6%uFF0C%u5219%u8BE5%u6587%u4EF6%u88AB%u6D4B%u8BD5%u5916%u4EBA%u4E3A%u6216%u4EE3%u7801%u4FEE%u6539%uFF0C%u5219%u6D4B%u8BD5%u53EF%u80FD%u5C31%u4F1A%u83AB%u540D%u5931%u8D25%u3002%0A%u9488%u5BF9%u8FD9%u4E9B%u60C5%u51B5%uFF0C%u6211%u4EEC%u5E94%u5F53%u5728%u6D4B%u8BD5%u4E2D%u5C3D%u91CF%u907F%u514D%u3002%u4F8B%u5982%u524D%u8005%uFF0C%u6211%u4EEC%u5E94%u5F53%u5BF9%u7F51%u7EDC%u63A5%u53E3%u8FDB%u884CMock%u5316%uFF0C%u540E%u8005%u5E94%u5F53%u5728%u6D4B%u8BD5%u7684setUp%u548CtearDown%u4E2D%u751F%u6210%u865A%u5047%u6587%u4EF6%u7528%u4E8E%u6D4B%u8BD5%uFF0C%u5E76%u5728%u6D4B%u8BD5%u5B8C%u6210%u65F6%u505A%u6E05%u7406%u3002%0A%0A4.%20%u4F1A%u56E0%u4E3A%u5F88%u5C0F%u7684%u88AB%u6D4B%u4EE3%u7801%u6539%u52A8%uFF0C%u800C%u5BFC%u81F4%u5927%u9762%u79EF%u6D4B%u8BD5%u5931%u8D25%uFF0C%u751A%u81F3%u6D4B%u8BD5%u5D29%u6E83%u3002%0A%u8FD9%u4E2A%u5C31%u662Fgmock%u6587%u6863%u4E2D%u63D0%u5230%u7684%u8981%u9488%u5BF9%u63A5%u53E3%u7F16%u7A0B%uFF0C%u9488%u5BF9%u63A5%u53E3%u6D4B%u8BD5%u3002Robert%20C%B7Martin%u5728%u300A%u654F%u6377%u8F6F%u4EF6%u5F00%u53D1%uFF0D%u539F%u5219%u3001%u6A21%u5F0F%u4E0E%u5B9E%u8DF5%u300B%u4E00%u4E66%u4E2D%u6709%u63D0%u51FA%uFF1A%u6240%u6709%u7684%u4EE3%u7801%u90FD%u5E94%u4F9D%u8D56%u4E8E%u62BD%u8C61%u63A5%u53E3%u3002%u56E0%u4E3A%u62BD%u8C61%u63A5%u53E3%u662F%u7ECF%u8FC7%u62BD%u8C61%u7684%uFF0C%u76F8%u5BF9%u5177%u4F53%u7684%u5B9E%u73B0%u4EE3%u7801%u8F83%u4E3A%u7A33%u5B9A%u3002%u800C%u88AB%u4F9D%u8D56%u7684%u4EE3%u7801%u5E94%u8BE5%u5C3D%u53EF%u80FD%u4FDD%u6301%u7A33%u5B9A%uFF0C%u8FD9%u6837%u57FA%u4E8E%u4E4B%u4E0A%u7684%u4EE3%u7801%u624D%u4E0D%u4F1A%u56E0%u4E3A%u4F9D%u8D56%u7684%u6539%u52A8%u800C%u6539%u52A8%u3002%0A%0A%u4E0B%u9762%u5217%u51FA%u51E0%u79CD%u6211%u5728%u5B9E%u9645%u5199test%20case%u65F6%u9047%u5230%u7684%u60C5%u51B5%uFF0C%u5728gmock%u4E2D%u7684%u89E3%u51B3%u65B9%u6848%u3002%0A%0A%23%23%23%20%u6309%u7167%u51FD%u6570%u53C2%u6570%u8FD4%u56DE%u7ED3%u679C%20-%20Fake%0A%u4F8B%u5982%3A%0A%60%60%60%0Aclass%20A%0A%7B%0A%09virtual%20int%20func%28int%20a%2C%20int%20b%29%3B%0A%7D%0A%0AEXPECT_CALL%28mockA%2C%20func%28%29%29%0A%09.WillRepeatedly%28a+b%29%3B%0A%60%60%60%0Agmock%u4E2D%u53EF%u4EE5%u8FD9%u6837%u505A%uFF1AUsing%20Functions/Methods/Functors%20as%20Actions%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AInvoke%3B%0Aclass%20MockFoo%20%3A%20public%20Foo%20%7B%0Apublic%3A%0A%09MOCK_METHOD2%28Sum%2C%20int%28int%20x%2C%20int%20y%29%29%3B%0A%09MOCK_METHOD1%28ComplexJob%2C%20bool%28int%20x%29%29%3B%0A%7D%3B%0Aint%20CalculateSum%28int%20x%2C%20int%20y%29%20%7B%20return%20x%20+%20y%3B%20%7D%0Aclass%20Helper%20%7B%0Apublic%3A%0A%09bool%20ComplexJob%28int%20x%29%3B%0A%7D%3B%0A...%0AMockFoo%20foo%3B%0AHelper%20helper%3B%0AEXPECT_CALL%28foo%2C%20Sum%28_%2C%20_%29%29%0A%09.WillOnce%28Invoke%28CalculateSum%29%29%3B%0AEXPECT_CALL%28foo%2C%20ComplexJob%28_%29%29%0A%09.WillOnce%28Invoke%28%26helper%2C%20%26Helper%3A%3AComplexJob%29%29%3B%0Afoo.Sum%285%2C%206%29%3B%20//%20Invokes%20CalculateSum%285%2C%206%29.%0Afoo.ComplexJob%2810%29%3B%20//%20Invokes%20helper.ComplexJob%2810%29%3B%0A%60%60%60%0A%0A%23%23%23%20Mock%20non-virtual%u51FD%u6570%0A%60%60%60%0A//%20A%20simple%20packet%20stream%20class.%20None%20of%20its%20members%20is%20virtual.%0Aclass%20ConcretePacketStream%20%7B%0A%09public%3A%0A%09%09void%20AppendPacket%28Packet*%20new_packet%29%3B%0A%09%09const%20Packet*%20GetPacket%28size_t%20packet_number%29%20const%3B%0A%09%09size_t%20NumberOfPackets%28%29%20const%3B%0A%09%09...%0A%7D%3B%0A//%20A%20mock%20packet%20stream%20class.%20It%20inherits%20from%20no%20other%2C%20but%20defines%0A//%20GetPacket%28%29%20and%20NumberOfPackets%28%29.%0Aclass%20MockPacketStream%20%7B%0A%09public%3A%0A%09%09MOCK_CONST_METHOD1%28GetPacket%2C%20const%20Packet*%28size_t%20packet_number%29%29%3B%0A%09%09MOCK_CONST_METHOD0%28NumberOfPackets%2C%20size_t%28%29%29%3B%0A%09%09...%0A%7D%0A%0Atemplate%20%3Cclass%20PacketStream%3E%0Avoid%20CreateConnection%28PacketStream*%20stream%29%20%7B%20...%20%7D%0Atemplate%20%3Cclass%20PacketStream%3E%0Aclass%20PacketReader%20%7B%0A%09public%3A%0A%09void%20ReadPackets%28PacketStream*%20stream%2C%20size_t%20packet_num%29%3B%0A%7D%3B%0A%0AMockPacketStream%20mock_stream%3B%0AEXPECT_CALL%28mock_stream%2C%20...%29...%3B%0A..%20set%20more%20expectations%20on%20mock_stream%20...%0APacketReader%3CMockPacketStream%3E%20reader%28%26mock_stream%29%3B%0A...%20exercise%20reader%20...%0A%60%60%60%0A%u4E3A%u4EC0%u4E48%u8981%u8FD9%u4E48%u505A%uFF1F%0A%u56E0%u4E3A%u53EA%u80FD%u8FD9%u4E48%u505A%u3002%u666E%u901A%u7684mock%uFF0C%u8981%u901A%u8FC7%u7EE7%u627F%u88AB%u6D4B%u8BD5%u7C7B%uFF0C%u5E76%u91CD%u5199virtual%u51FD%u6570%u6765%u5B9E%u73B0%u3002%u800C%u4E0A%u9762%u7684ConcretePacketStream%u548CMockPacketStream%u5E76%u4EFB%u4F55%u6CA1%u6709%u5173%u7CFB%uFF0C%u4E5F%u5C31%u662F%u8BF4%uFF0C%u5982%u679C%u4F20%u5165%u540E%u8005%u7684%u6307%u9488%uFF0C%u4E0D%u7528reinterpret_cast%u662F%u4E0D%u80FD%u8F6C%u6210%u524D%u8005%u7684%u6307%u9488%u7684%u3002%0A%u6240%u4EE5%u60F3%u4E00%u4E2A%u53D8%u901A%u7684%u529E%u6CD5%uFF0C%u7528%u6A21%u677F%u7C7B%u6765%u5B9A%u4E49%u88AB%u6D4B%u4EE3%u7801%uFF0C%u5728%u6D4B%u8BD5%u65F6%u4F20%u5165mock%u7C7B%uFF0C%u5728%u751F%u4EA7%u65F6%uFF0C%u4F20%u5165%u771F%u5B9E%u7C7B%u3002%0A%0A%23%23%23%20Mocking%20Side%20Effects%0A%60%60%60%0AEXPECT_CALL%28mutator%2C%20MutateInt%28_%29%29%0A%09.WillOnce%28DoAll%28SetArgPointee%3C0%3E%285%29%2C%20Return%28true%29%29%29%3B%0AEXPECT_CALL%28mutator%2C%20Mutate%28NotNull%28%29%2C%205%29%29%0A%09.WillOnce%28SetArrayArgument%3C0%3E%28values%2C%20values%20+%205%29%29%3B%0A%60%60%60%0A%u7B2C%u4E00%u4E2A%u5C06MutateInt%u7B2C%u4E00%u4E2A%u53C2%u6570%u6307%u9488%u6307%u5411%u7684int%uFF0C%u8BBE%u4E3A5%uFF0C%u5E76%u8FD4%u56DEtrue%u3002%0A%u7B2C%u4E8C%u4E2A%u5C06values%u6570%u7EC4%u7684%5B0%2C5%29%u62F7%u8D1D%u5230%u53C2%u65701%u6307%u5411%u7684%u5730%u5740%u3002%0A%u5982%u679C%u4ECD%u9700%u8981%u8FD4%u56DE%uFF0C%u5219%u7528DoAll%uFF0C%u5982%u4E0B%uFF1A%0A%60%60%60%0AEXPECT_CALL%28mutator%2C%20MutateInt%28_%29%29%0A%20%20%20%20%20%20.WillOnce%28DoAll%28SetArgPointee%3C0%3E%285%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Return%28true%29%29%29%3B%0A%60%60%60%0A%0A%23%23%23%20Selecting%20an%20Action%27s%20Arguments%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AInvoke%3B%0Abool%20MyIsVisibleInQuadrant1%28bool%20visible%2C%20const%20string%26%20name%2C%20int%20x%2C%20int%20y%2C%0Aconst%20map%3Cpair%3Cint%2C%20int%3E%2C%20double%3E%26%20weight%2C%0Adouble%20min_weight%2C%20double%20max_wight%29%20%7B%0A%09return%20IsVisibleInQuadrant1%28visible%2C%20x%2C%20y%29%3B%0A%7D.%0A..%0AEXPECT_CALL%28mock%2C%20Foo%28_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%29%29%0A%09.WillOnce%28Invoke%28MyIsVisibleInQuadrant1%29%29%3B%20//%20Now%20it%20works.%0A%60%60%60%0A%u5B9A%u4E49%u81EA%u5DF1%u7684adaptor%20MyIsVisibleInQuadrant1%uFF0C%u6216%u8005%u7528gmock%u63D0%u4F9B%u7684%u65B9%u6CD5%u4F18%u96C5%u7684%u89E3%u51B3%u3002%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AInvoke%3B%0Ausing%20%3A%3Atesting%3A%3AWithArgs%3B%0A...%0AEXPECT_CALL%28mock%2C%20Foo%28_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%29%29%0A.WillOnce%28WithArgs%3C0%2C%202%2C%203%3E%28Invoke%28IsVisibleInQuadrant1%29%29%29%3B%0A//%20No%20need%20to%20define%20your%20own%20adaptor.%0A%60%60%60%0A%0A%23%23%23%23%20Mocking%20Private%20or%20Protected%20Methods%0A%60%60%60%0Aclass%20Foo%20%7B%0A%09public%3A%0A%09%09...%0A%09%09virtual%20bool%20Transform%28Gadget*%20g%29%20%3D%200%3B%0A%09protected%3A%0A%09%09virtual%20void%20Resume%28%29%3B%0A%09private%3A%0A%09%09virtual%20int%20GetTimeOut%28%29%3B%0A%7D%3B%0Aclass%20MockFoo%20%3A%20public%20Foo%20%7B%0A%09public%3A%0A%09%09...%0A%09%09MOCK_METHOD1%28Transform%2C%20bool%28Gadget*%20g%29%29%3B%0A%09%09//%20The%20following%20must%20be%20in%20the%20public%20section%2C%20even%20though%20the%0A%09%09//%20methods%20are%20protected%20or%20private%20in%20the%20base%20class.%0A%09%09MOCK_METHOD0%28Resume%2C%20void%28%29%29%3B%0A%09%09MOCK_METHOD0%28GetTimeOut%2C%20int%28%29%29%3B%0A%7D%3B%0A%60%60%60%0A%3EC++%20allows%20a%20subclass%20to%20specify%20a%20different%20access%20level%20than%20the%20base%20class%20on%20a%20virtual%20function.%0A%0A%23%23%23%23%20Misc%0AKeep%20in%20mind%20that%20one%20doesn%27t%20have%20to%20verify%20more%20than%20one%20property%20in%20one%20test.%20In%20fact%2C%20it%27s%20a%20good%20style%20to%20verify%20only%20one%0Athing%20in%20one%20test.%20If%20you%20do%20that%2C%20a%20bug%20will%20likely%20break%20only%20one%20or%20two%20tests%20instead%20of%20dozens%0A%0AWhen%20it%27s%20being%20destroyed%2C%20your%20friendly%20mock%20object%20will%20automatically%20verify%20that%20all%20expectations%20on%20it%20have%20been%20satisfied%2C%0Aand%20will%20generate%20Google%20Test%20failures%20if%20not.%20%0A%0ACurrently%20these%20are%20only%20platforms%20that%20support%20the%20pthreads%20library%20%28this%20includes%20Linux%20and%20Mac%29.%20%0A%0A%u52A0%u4E0A%u547D%u4EE4%u884C%u53C2%u6570--gmock_verbose%3Dinfo%u53EF%u4EE5%u663E%u793A%u6240%u6709EXPECT%5C_CALL%u7684%u5177%u4F53%u8C03%u7528%u60C5%u51B5%u3002%0A%0A%23%23%20Some%20useful%20tips%20in%20gtest%0A%23%23%23%20Selecting%20Tests%0A%3E%20If%20you%20set%20the%20**GTEST_FILTER**%20environment%20variable%20or%20the%20**--gtest_filter**%20flag%20to%20a%20filter%20string%2C%20Google%20Test%20will%20only%20run%20the%20tests%20whose%20full%20names%20%28in%20the%20form%20of%20TestCaseName.TestName%29%20match%20the%20filter.%0A%3E%20The%20format%20of%20a%20filter%20is%20a%20%27%3A%27-separated%20list%20of%20wildcard%20patterns%20%28called%20the%20positive%20patterns%29%20optionally%20followed%20by%20a%20%27-%27%20and%20another%20%27%3A%27-separated%20pattern%20list%20%28called%20the%20negative%20patterns%29.%0A%0A-%20./foo_test%20Has%20no%20flag%2C%20and%20thus%20runs%20all%20its%20tests.%0A-%20./foo_test%20--gtest_filter%3D*%20Also%20runs%20everything%2C%20due%20to%20the%20single%20match-everything%20*%20value.%0A-%20./foo_test%20--gtest_filter%3DFooTest.*%20Runs%20everything%20in%20test%20case%20FooTest.%0A-%20./foo_test%20--gtest_filter%3D*Null*%3A*Constructor*%20Runs%20any%20test%20whose%20full%20name%20contains%20either%20%22Null%22%20or%20%22Constructor%22.%0A-%20./foo_test%20--gtest_filter%3D-*DeathTest.*%20Runs%20all%20non-death%20tests.%0A-%20./foo_test%20--gtest_filter%3DFooTest.*-FooTest.Bar%20Runs%20everything%20in%20test%20case%20FooTest%20except%20FooTest.Bar%0A%0ATemporarily%20Disabling%20Tests%0A%60%60%60%0A//%20Tests%20that%20Foo%20does%20Abc.%0ATEST%28FooTest%2C%20DISABLED_DoesAbc%29%20%7B%20...%20%7D%0A%0Aclass%20DISABLED_BarTest%20%3A%20public%20%3A%3Atesting%3A%3ATest%20%7B%20...%20%7D%3B%0A%0A//%20Tests%20that%20Bar%20does%20Xyz.%0ATEST_F%28DISABLED_BarTest%2C%20DoesXyz%29%20%7B%20...%20%7D%0A%60%60%60%0A%0ATemporarily%20Enabling%20Disabled%20Tests%0A%3Ejust%20invoke%20the%20test%20program%20with%20the%20**--gtest_also_run_disabled_tests**%20flag%20or%20set%20the%20**GTEST_ALSO_RUN_DISABLED_TESTS**%20environment%20variable%20to%20a%20value%20other%20than%200.%0A%0A%23%23%23%20Repeating%20the%20Tests%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20%3A--------%3A%20%7C%20%3A--------------%3A%20%7C%20%3A--------%3A%20%7C%0A%7C%5C%24%20foo_test%20--gtest_repeat%3D1000%20%7C%09Repeat%20foo_test%201000%20times%20and%20don%27t%20stop%20at%20failures.%7C%0A%7C%5C%24%20foo_test%20--gtest_repeat%3D-1%09%7CA%20negative%20count%20means%20repeating%20forever.%7C%0A%7C%5C%24%20foo_test%20--gtest_repeat%3D1000%20--gtest_break_on_failure%09%7C%20Repeat%20foo_test%201000%20times%2C%20stopping%20at%20the%20first%20failure.%20This%20is%20especially%20useful%20when%20running%20under%20a%20debugger%3A%20when%20the%20testfails%2C%20it%20will%20drop%20into%20the%20debugger%20and%20you%20can%20then%20inspect%20variables%20and%20stacks.%7C%0A%7C%24%20foo_test%20--gtest_repeat%3D1000%20--gtest_filter%3DFooBar%09%7C%20Repeat%20the%20tests%20whose%20name%20matches%20the%20filter%201000%20times.%7C]]></content>
      <tags>
        <tag>unittest</tag>
        <tag>TDD</tag>
        <tag>gtest</tag>
        <tag>gmock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C/C++ Test Framework - Google Test & Google Mock]]></title>
    <url>%2F2017%2F09%2F12%2FC%2FC%2B%2B%20Test%20Framework%20-%20Google%20Test%20%26%20Google%20Mock%2F</url>
    <content type="text"><![CDATA[EditGoogle Test&#xFF0C;Google Mock&#x4EE5;&#x4E0B;&#x7B80;&#x79F0;gtest&#xFF0C;gmock&#x3002; &#x5728;&#x63A5;&#x89E6;gtest&#xFF0C;gmock&#x4E4B;&#x524D;&#xFF0C;&#x6D4B;&#x8BD5;C/C++ code&#x4F7F;&#x7528;UnitTest++&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x6D01;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x4E0A;&#x624B;&#x5F88;&#x5FEB;&#x3002;&#x53C2;&#x770B;&#x53E6;&#x4E00;&#x7BC7;&#x535A;&#x6587;UnitTest++&#x7B80;&#x4ECB;&#x3002;&#x6D4B;&#x8BD5;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;&#x591F;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;mock&#x5E93;&#x3002;&#x8FD9;&#x5E26;&#x6765;&#x7684;&#x95EE;&#x9898;&#x662F;&#xFF1A;&#x6D4B;&#x8BD5;&#x9057;&#x7559;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x81EA;&#x884C;fake&#x76F8;&#x5173;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E2A;&#x5728;&#x9057;&#x7559;&#x7CFB;&#x7EDF;&#x5F88;&#x5E9E;&#x5927;&#x65F6;&#xFF0C;&#x8981;&#x9887;&#x8D39;&#x5FC3;&#x529B;&#x3002;&#x800C;&#x4E14;&#x8FC7;&#x591A;&#x6D89;&#x53CA;&#x7EC6;&#x8282;&#xFF0C;&#x5BFC;&#x81F4;&#x6D4B;&#x8BD5;&#x6781;&#x4E0D;&#x7A33;&#x5B9A;&#xFF0C;&#x7CFB;&#x7EDF;&#x4EE3;&#x7801;&#x4EFB;&#x610F;&#x7684;&#x6F14;&#x8FDB;&#xFF0C;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;&#x5927;&#x5806;&#x7684;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#xFF0C;&#x751A;&#x81F3;&#x6D4B;&#x8BD5;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x3002;&#x6D4B;&#x8BD5;case&#x4E4B;&#x95F4;&#x65E0;&#x6CD5;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x8026;&#x3002;&#x7ED3;&#x679C;&#x540C;&#x6837;&#x662F;&#x6D4B;&#x8BD5;&#x4E0D;&#x591F;&#x7A33;&#x5B9A;&#x3002;&#x672F;&#x8BED;&#x662F;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5F88;&#x201C;&#x8106;&#x5F31;&#x201D;&#x3002;Java&#xFF0C;Python&#xFF0C;JavaScript&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;mock&#x5E93;&#x3002;Python&#x7684;Mock&#x7C7B;&#xFF0C;Java&#x7684;Mockito/PowerMock&#xFF0C;JavaScript&#x7684;Sinon&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x5728;&#x7F51;&#x4E0A;&#x641C;&#x7D22;&#x4E86;&#x4E00;&#x4E0B;C/C++&#x7684;Mock&#x5E93;&#xFF0C;&#x4E8E;&#x662F;&#x770B;&#x5230;&#x4E86;gtest&#xFF0C;gmock&#x3002;&#x7136;&#x540E;&#x5C31;&#x6709;&#x4E86;&#x8FD9;&#x4E00;&#x7BC7;&#x3002;&#x7B80;&#x4ECB;&#x4E0D;&#x7528;&#x53BB;&#x7F51;&#x4E0A;&#x8D39;&#x5FC3;&#x627E;&#x6559;&#x7A0B;&#xFF0C;&#x4E24;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x6587;&#x6863;&#x90FD;&#x975E;&#x5E38;&#x68D2;&#x3002;&#x5165;&#x53E3;&#x7EDF;&#x4E00;&#x5728;gtest GitHub&#x9879;&#x76EE;&#x4E3B;&#x9875;&#x4E0A;&#x3002;&#x800C;&#x4E14;&#x8BE5;&#x6587;&#x6863;&#x4E0D;&#x4EC5;&#x5F88;&#x597D;&#x7684;&#x4ECB;&#x7ECD;&#x4E86;gtest&#xFF0C;gmock&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x8FD8;&#x6D89;&#x53CA;&#x4E86;&#x5F88;&#x591A;TDD&#x6216;&#x8005;UnitTest&#x7684;&#x771F;&#x77E5;&#x707C;&#x89C1;&#xFF0C;&#x5F88;&#x503C;&#x5F97;&#x8BFB;&#x4E00;&#x8BFB;&#x3002; &#x8981;&#x4F7F;&#x7528;gtest&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF1A;&#x7F16;&#x8BD1;&#x51FA;gtest&#xFF0C;gmock&#xFF0C;&#x518D;&#x94FE;&#x5165;&#x4F60;&#x7684;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x3002;&#x7F16;&#x8BD1;gtest/gmockgtest&#xFF0C;gmock&#x5747;&#x7528;cmake&#x6765;&#x7BA1;&#x7406;&#x8DE8;&#x5E73;&#x53F0;&#xFF0C;&#x5148;&#x7528;cmake&#x6765;&#x751F;&#x6210;Makefile&#x3002;&#x7528;&#x547D;&#x4EE4;cmake -G &quot;Unix Makefiles&quot; /path/to/CMakeList.txtMakefile&#x7136;&#x540E;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7F16;&#x5199;Makefile&#x3002;&#x6CE8;&#x610F;gmock_main&#x662F;&#x4E00;&#x4E2A;main&#x51FD;&#x6570;&#x6765;&#x8C03;&#x7528;&#x6240;&#x6709;&#x7684;test case&#xFF0C;&#x7701;&#x5F97;&#x81EA;&#x5DF1;&#x5199;main&#x51FD;&#x6570;&#x4E86;&#x3002;CC = gccCPP = g++LINK = g++CFLAGS = -g -Wall -Werror -Wextra -std=gnu99CPPFLAGS = -g -Wall -Werror -WextraLIBS = -L./lib -lgtest -lgmock -lgmock_main -lpthreadC__SOURCES = $(wildcard *.c)CPPSOURCES = $(wildcard *.cpp)OBJECTS = $(patsubst %.c, %.o, $(C__SOURCES)) $(patsubst %.cpp, %.o, $(CPPSOURCES))TARGET = test_exefirst: all%.o: %.c $(CC) $(INCLUDES) -c $(CFLAGS) -o $@ $&lt;%.o: %.cpp $(CPP) $(INCLUDES) -c $(CPPFLAGS) -o $@ $&lt;all: $(TARGET)$(TARGET): $(OBJECTS) $(LINK) $(CPPFLAGS) $(LIBS) -o $(TARGET) $(OBJECTS).PHONY : cleanclean: rm -f $(TARGET) $(OBJECTS)TermsMeaningGoogle Test TermISTQB TermExercise a particular program path with specific input values and verify the resultsTEST()Test CaseA set of several tests related to one componentTest CaseTest SuiteTest#include &quot;gtest/gtest.h&quot;#include &quot;gmock/gmock.h&quot;using ::testing::Return;using ::testing::Test;using ::testing::_;using ::testing::AtLeast;TEST(TestCaseName, should_this_test_do){ ... EXPECT_STREQ(&quot;{}&quot;, str);}&#x4E2D;&#x95F4;&#x7684;&#x90A3;&#x5806;namespace&#x90FD;&#x662F;gtest/gmock&#x5E93;&#x91CC;&#x5B9A;&#x4E49;&#x7684;matcher&#x5B8F;&#x6216;&#x8005;&#x5404;&#x79CD;&#x6709;&#x7528;&#x7684;&#x5B8F;&#x3002;Test Fixture&#x5728;&#x6D4B;&#x8BD5;&#x6709;&#x91CD;&#x590D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x8981;&#x7528;&#x5230;Test Fixture&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;setUp / tearDown&#x3002;class QueueTest : public ::testing::Test { protected: virtual void SetUp() { q1_.Enqueue(1); q2_.Enqueue(2); q2_.Enqueue(3); } // virtual void TearDown() {} Queue&lt;int&gt; q0_; Queue&lt;int&gt; q1_; Queue&lt;int&gt; q2_;};TEST_F(QueueTest, IsEmptyInitially) { EXPECT_EQ(0, q0_.size());}TEST_F(QueueTest, DequeueWorks) { int* n = q0_.Dequeue(); EXPECT_EQ(NULL, n); n = q1_.Dequeue(); ASSERT_TRUE(n != NULL); EXPECT_EQ(1, *n); EXPECT_EQ(0, q1_.size()); delete n; n = q2_.Dequeue(); ASSERT_TRUE(n != NULL); EXPECT_EQ(2, *n); EXPECT_EQ(1, q2_.size()); delete n;}constructor/destructor vs. SetUp/TearDownWhen you need to write per-test set-up and tear-down logic, you have the choice between using the test fixture constructor/destructor or SetUp()/TearDown(). The former is usually preferred, as it has the following benefits:By initializing a member variable in the constructor, we have the option to make it const, which helps prevent accidental changes to its value and makes the tests more obviously correct.In case we need to subclass the test fixture class, the subclass&#x2019; constructor is guaranteed to call the base class&#x2019; constructor first, and the subclass&#x2019; destructor is guaranteed to call the base class&#x2019; destructor afterward. With SetUp()/TearDown(), a subclass may make the mistake of forgetting to call the base class&#x2019; SetUp()/TearDown() or call them at the wrong moment.Benefit for using SetUp/TearDown:If the tear-down operation could throw an exception, you must use TearDown() as opposed to the destructor, as throwing in a destructor leads to undefined behavior and usually will kill your program right away. Note that many standard libraries (like STL) may throw when exceptions are enabled in the compiler. Therefore you should prefer TearDown() if you want to write portable tests that work with or without exceptions.The assertion macros throw an exception when flag &#x2013;gtest_throw_on_failure is specified. Therefore, you shouldn&#x2019;t use Google Test assertions in a destructor if you plan to run your tests with this flag.In a constructor or destructor, you cannot make a virtual function call on this object. (You can call a method declared as virtual, but it will be statically bound.) Therefore, if you need to call a method that will be overriden in a derived class, you have to use SetUp()/TearDown().&#x7B80;&#x8A00;&#x4E4B;&#xFF0C;&#x5728;&#x903B;&#x8F91;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E24;&#x7EC4;&#x7684;&#x4F5C;&#x7528;&#x76F8;&#x540C;&#xFF0C;&#x90FD;&#x662F;&#x6BCF;&#x4E2A;&#x6D4B;&#x8BD5;&#x4E4B;&#x524D;&#x4E4B;&#x540E;&#x4F1A;&#x505A;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x5DE5;&#x4F5C;&#x3002;Constructor/Destructor&#x7684;&#x597D;&#x5904;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x7EE7;&#x627F;&#x3002;setUp/tearDown&#x7684;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x5904;&#x7406;exception&#xFF0C;&#x8FD9;&#x662F;&#x4E0D;&#x80FD;&#x653E;&#x5728;&#x6790;&#x6784;&#x51FD;&#x6570;&#x91CC;&#x7684;&#x3002;SetUpTestCase / TearDownTestCaseTest Case&#x7EA7;&#x522B;&#x7684;SetUp/TearDownclass FooTest : public ::testing::Test { protected: // Per-test-case set-up. // Called before the first test in this test case. // Can be omitted if not needed. static void SetUpTestCase() { shared_resource_ = new ...; } // Per-test-case tear-down. // Called after the last test in this test case. // Can be omitted if not needed. static void TearDownTestCase() { delete shared_resource_; shared_resource_ = NULL; } // You can define per-test set-up and tear-down logic as usual. virtual void SetUp() { ... } virtual void TearDown() { ... } // Some expensive resource shared by all tests. static T* shared_resource_;};SetUp/TearDown EnvironmentFirst, you subclass the ::testing::Environment class to define a test environment, which knows how to set-up and tear-down:Then, you register an instance of your environment class with Google Test by calling the ::testing::AddGlobalTestEnvironment() function: Now, when RUN_ALL_TESTS() is called, it first calls the SetUp() method of the environment object, then runs the tests if there was no fatal failures, and finally calls TearDown() of the environment object.It&#x2019;s OK to register multiple environment objects. In this case, their SetUp() will be called in the order they are registered, and their TearDown() will be called in the reverse order.Note that Google Test takes ownership of the registered environment objects. Therefore do not delete them by yourself.class Environment { public: virtual ~Environment() {} // Override this to define how to set up the environment. virtual void SetUp() {} // Override this to define how to tear down the environment. virtual void TearDown() {}};Environment* AddGlobalTestEnvironment(Environment* env);&#x65AD;&#x8A00;&#x6709;&#x4E24;&#x79CD;&#x65AD;&#x8A00;EXPECT_xxx&#x548C;ASSERT_xxx&#x3002;&#x524D;&#x8005;&#x4F1A;&#x8BA9;&#x6D4B;&#x8BD5;&#x7EC8;&#x6B62;&#xFF0C;&#x540E;&#x8005;&#x4E0D;&#x4F1A;&#xFF0C;&#x53EA;&#x4F1A;&#x8BA9;&#x6D4B;&#x8BD5;fail&#x3002;gmock&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x5207;&#x5230;gtest&#xFF0C;&#x552F;&#x4E00;&#x7684;&#x539F;&#x56E0;&#x5C31;&#x662F;gmock&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x4E13;&#x5F00;&#x4E00;&#x7AE0;&#x91CD;&#x70B9;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x3002;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x5747;&#x6765;&#x81EA;&#x4E8E;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x3002;&#x5185;&#x5BB9;&#x6DF1;&#x5EA6;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x4F9D;&#x6B21;&#x5982;&#x4E0B;&#xFF1A;Google Mock for DummiesCookBook&#x6700;&#x540E;&#x8FD8;&#x6709;&#x53C2;&#x8003;&#x624B;&#x518C;:Cheat Sheet&#x7B80;&#x4ECB;Google C++ Mocking Framework (or Google Mock for short) is a library (sometimes we also call it a &#x201C;framework&#x201D; to make it sound cool) for creating mock classes and using them. It does to C++ what jMock and EasyMock do to Java.&#x4F55;&#x4E3A;Mock&#xFF1F;Mocks are objects pre-programmed with expectations, which form a specification of the calls they are expected to receive.&#x76F8;&#x5E94;&#x7684;&#x8FD8;&#x6709;Fake&#x548C;StubFake objects have working implementations, but usually take some shortcut (perhaps to make the operations less expensive), which makes them not suitable for production. An in-memory file system would be an example of a fake.gmock&#x7684;&#x6587;&#x6863;&#x91CC;&#x53EA;&#x63D0;&#x5230;&#x4E86;Fake&#xFF0C;&#x4ECE;Martin Fowler&#x7684;&#x6587;&#x7AE0;Mocks Aren&#x2019;t Stubs&#x4E2D;&#x6458;&#x5F55;&#x5982;&#x4E0B;:Stubs provide canned answers to calls made during the test, usually not responding at all to anything outside what&#x2019;s programmed in for the test.&#x4E09;&#x8005;&#x4F5C;&#x7528;&#x76F8;&#x540C;&#xFF0C;&#x90FD;&#x662F;&#x6A21;&#x62DF;&#x7CFB;&#x7EDF;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FBE;&#x5230;&#x4EE3;&#x7801;&#x9694;&#x79BB;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x65B9;&#x4FBF;&#x6D4B;&#x8BD5;&#x3002;&#x4F46;&#x662F;Mock&#x7684;&#x7279;&#x70B9;&#x662F;&#x66F4;OO&#x5316;&#xFF0C;&#x4E5F;&#x7B26;&#x5408;TDD&#x6216;&#x8005;BDD&#x7684;&#x601D;&#x60F3;&#x2014;&#x2014;&#x9488;&#x5BF9;&#x4E00;&#x4E2A;object&#x8BBE;&#x7F6E;&#x671F;&#x5F85;&#xFF0C;&#x518D;&#x5BF9;&#x9F50;verify&#x3002;Mocks vs. Stubs - from Martin FowlerIn order to use state verification on the stub, I need to make some extra methods on the stub to help with verification. As a result the stub implements MailService but adds extra test methods.Mock objects always use behavior verification, a stub can go either way. Meszaros refers to stubs that use behavior verification as a Test Spy. The difference is in how exactly the double runs and verifies and I&#x2019;ll leave that for you to explore on your own.Getting StartedClass to Mockclass Turtle { ... virtual ~Turtle() {} virtual void PenUp() = 0; virtual void PenDown() = 0; virtual void Forward(int distance) = 0;};Mock class#include &quot;gmock/gmock.h&quot; // Brings in Google Mock.class MockTurtle : public Turtle { public: ... MOCK_METHOD0(PenUp, void()); MOCK_METHOD0(PenDown, void()); MOCK_METHOD1(Forward, void(int distance));};&#x9488;&#x5BF9;&#x5F85;Mock&#x7684;Turtle class&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;:Note that the destructor of Turtle must be virtual, as is the case for all classes you intend to inherit from - otherwise the destructor of the derived class will not be called when you delete an object through a base pointer, and you&#x2019;ll get corrupted program states like memory leaks.Use it#include &quot;path/to/mock-turtle.h&quot;#include &quot;gmock/gmock.h&quot;#include &quot;gtest/gtest.h&quot;using ::testing::AtLeast; // #1TEST(PainterTest, CanDrawSomething) { MockTurtle turtle; // #2 EXPECT_CALL(turtle, PenDown()) // #3 .Times(AtLeast(1)); Painter painter(&amp;turtle); // #4 EXPECT_TRUE(painter.DrawCircle(0, 0, 10));} // #5int main(int argc, char** argv) { // The following line must be executed to initialize Google Mock // (and Google Test) before running the tests. ::testing::InitGoogleMock(&amp;argc, argv); return RUN_ALL_TESTS();}&#x5982;&#x679C;&#x4F60;&#x613F;&#x610F;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5199;main&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5077;&#x61D2;&#xFF0C;&#x8BB0;&#x5F97;&#x5728;Makefile&#x91CC;link gmock_main&#x3002; &#x6309;Google&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;gmock&#x4E5F;&#x53EF;&#x4EE5;&#x548C;&#x5176;&#x4ED6;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;&#x517C;&#x5BB9;&#xFF0C;&#x4F46;&#x603B;&#x611F;&#x89C9;&#x633A;&#x60AC;&#x7684;&#x3002;&#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x5DE5;&#x5177;Marcher EXPECT_CALL(turtle, Forward(_)); &#xA0;&#xA0;&#xA0;&#xA0; &#x4EE5;&#x4EFB;&#x610F;&#x53C2;&#x6570;&#x8C03;&#x7528;Forward EXPECT_CALL(turtle, Forward(Ge(100))); &#xA0;&#xA0;&#xA0;&#xA0; &#x4EE5;&#x5927;&#x4E8E;100&#x7684;&#x6574;&#x6570;&#x8C03;&#x7528;ForwardCardinalities: How Many Times Will It Be Called?If neither WillOnce() nor WillRepeatedly() is in the EXPECT_CALL(), the inferred cardinality is Times(1).If there are n WillOnce()&#x2019;s but no WillRepeatedly(), where n &gt;= 1, the cardinality is Times(n).If there are n WillOnce()&#x2019;s and one WillRepeatedly(), where n &gt;= 0, the cardinality is Times(AtLeast(n)).EXPECT_CALL(mockObj, func()) .Times(AtLeast(1)) .WillOnce(Return(123)) .WillRepeatedly(Return(456))&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x8981;&#x6C42;func&#x51FD;&#x6570;&#x81F3;&#x5C11;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x8FD4;&#x56DE;123&#xFF0C;&#x4E4B;&#x540E;&#x6BCF;&#x6B21;&#x8FD4;&#x56DE;456&#x3002;Important note: The EXPECT_CALL() statement evaluates the action clause only once, even though the action may be performed many times. Therefore you must be careful about side effects. The following may not do what you want:int n = 100;EXPECT_CALL(turtle, GetX()).Times(4).WillRepeatedly(Return(n++));&#x56E0;&#x4E3A;Return&#x662F;&#x5B8F;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x4F1A;&#x66FF;&#x6362;&#x4E00;&#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7BA1;GetX&#x8C03;&#x7528;&#x51E0;&#x6B21;&#xFF0C;&#x8FD4;&#x56DE;&#x90FD;&#x662F;101&#xFF0C;&#x800C;&#x4E0D;&#x662F;101,102,103,&#x2026;All Expectations Are Sticky &#x6240;&#x8C13;&#x7684;sticky&#x5C31;&#x662F;EXPECT_CALL&#x603B;&#x662F;&#x751F;&#x6548;&#x7684;&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x663E;&#x793A;&#x7684;&#x5C06;&#x5176;&#x5931;&#x6548;&#x3002;&#x5982;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x7684;EXPECT_CALL&#x90FD;&#x4F1A;&#x751F;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4F1A;&#x8986;&#x76D6;&#x524D;&#x9762;&#x6240;&#x6709;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;GetX&#x603B;&#x4F1A;&#x8FD4;&#x56DE;10&#x3002;using ::testing::Return;...for (int i = n; i &gt; 0; i--) { EXPECT_CALL(turtle, GetX()) .WillOnce(Return(10*i));}&#x5982;&#x679C;&#x5E0C;&#x671B;&#x4ED6;&#x8FD4;&#x56DE;&#xFF0C;30,20,10&#xFF0C;&#x2026;&#xFF0C;&#x5E94;&#x8BE5;&#x8FD9;&#x4E48;&#x5199;using ::testing::Return;...for (int i = n; i &gt; 0; i--) { EXPECT_CALL(turtle, GetX()) .WillOnce(Return(10*i)) .RetiresOnSaturation();}RetireOnSaturation&#x5C31;&#x662F;&#x663E;&#x793A;&#x7684;&#x8BA9;&#x5176;&#x5931;&#x6548;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF1A;using ::testing::InSequence;using ::testing::Return;...{ InSequence s; for (int i = 1; i &lt;= n; i++) { EXPECT_CALL(turtle, GetX()) .WillOnce(Return(10*i)) .RetiresOnSaturation(); }}&#x56E0;&#x4E3A;InSequence&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5728;&#x524D;&#x9762;&#x7684;EXPECT_CALL&#x751F;&#x6548;&#x4EE5;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x5931;&#x6548;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x8986;&#x76D6;&#x7684;&#x6548;&#x679C;&#x3002; Ordered vs Unordered Callsusing ::testing::InSequence;...TEST(FooTest, DrawsLineSegment) { ... { InSequence dummy; EXPECT_CALL(turtle, PenDown()); EXPECT_CALL(turtle, Forward(100)); EXPECT_CALL(turtle, PenUp()); } Foo();}Expecting Partially Ordered Calls Google Mock allows you to impose an arbitrary DAG (directed acyclic graph) on the calls. One way to express the DAG is to use the After clause of EXPECT_CALL .using ::testing::Sequence;Sequence s1, s2;EXPECT_CALL(foo, A()) .InSequence(s1, s2);EXPECT_CALL(bar, B()) .InSequence(s1);EXPECT_CALL(bar, C()) .InSequence(s2);EXPECT_CALL(foo, D()) .InSequence(s2);specifies the following DAG (where s1 is A -&gt; B , and s2 is A -&gt; C -&gt; D ): +---&gt; B |A ---| | +---&gt; C ---&gt; DUninteresting Calls &#x8FD9;&#x662F;gmock&#x62A5;&#x7684;warning&#x3002;&#x5F53;&#x9488;&#x5BF9;&#x67D0;&#x4E00;&#x4E2A;&#x5F85;&#x6D4B;&#x51FD;&#x6570;&#x8BBE;&#x7F6E;&#x4E86;EXPECT spec&#xFF0C;&#x5374;&#x5E76;&#x6CA1;&#x6709;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x62A5;&#x8FD9;&#x4E2A;warning&#x3002;&#x6B64;&#x65F6;gmock&#x8BA4;&#x4E3A;&#x4F60;&#x5BF9;&#x8BE5;&#x51FD;&#x6570;&#x5E76;&#x6CA1;&#x6709;&#x5174;&#x8DA3;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x4E2A;EXPECT spec&#x3002;&#x5F53;&#x7136;&#x4F60;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5FFD;&#x7565;&#x8FD9;&#x4E2A;warning&#xFF0C;&#x4F46;&#x6211;&#x8BA4;&#x4E3A;&#x51FA;&#x8FD9;&#x4E2A;warning&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x591A;&#x534A;&#x662F;test&#x6F0F;&#x5199;&#x4E86;&#x4EC0;&#x4E48;&#x3002;Returning Live Values from Mock Methodsusing testing::ByRef;using testing::Return;class MockFoo : public Foo { public: MOCK_METHOD0(GetValue, int());};...int x = 0;MockFoo foo;EXPECT_CALL(foo, GetValue()) // .WillRepeatedly(Return(ByRef(x))); X error .WillRepeatedly(ReturnPointee(x));x = 42;EXPECT_EQ(42, foo.GetValue());&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;case&#x5199;Unit Test&#x5E76;&#x4E0D;&#x50CF;&#x60F3;&#x50CF;&#x7684;&#x90A3;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x8C03;&#x7528;&#x4E86;&#x6846;&#x67B6;&#xFF0C;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x5199;test case&#x5C31;&#x53EF;&#x4EE5;&#x3002;&#x6309;&#x6211;&#x76EE;&#x524D;&#x7684;&#x7406;&#x89E3;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x6311;&#x6218;&#xFF1A;Test Case&#x5982;&#x4F55;&#x89E3;&#x8026;&#x3002;&#x4E0D;&#x8981;&#x6709;&#x91CD;&#x590D;&#x6D4B;&#x8BD5;(overlap)&#x3002; &#x4F8B;&#x5982;&#xFF1A;&#x5728;&#x5199;A&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5199;&#x4E86;&#x6D4B;&#x8BD5;testA&#xFF0C;B&#x51FD;&#x6570;&#x4F1A;&#x8C03;&#x7528;A&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x5199;&#x5B8C;A&#x4E4B;&#x540E;&#x5199;B&#x7684;&#x6D4B;&#x8BD5;testB&#x65F6;&#xFF0C;&#x662F;&#x5426;&#x8981;&#x5C06;A mock/fake/stub&#x6389;? &#x5982;&#x679C;&#x4E0D;&#x5C06;A&#x51FD;&#x6570;Fake&#x6389;&#xFF0C;&#x5219;testA&#x548C;testB&#x4E4B;&#x95F4;&#x5C31;&#x662F;&#x6709;overlap&#x3002;&#x6211;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x6709;&#x53D6;&#x820D;&#xFF0C;&#x6700;&#x4F73;&#x72B6;&#x6001;&#x5E94;&#x5F53;&#x662F;&#x6B64;&#x65F6;&#xFF0C;&#x5C06;testA&#x5220;&#x9664;&#xFF0C;&#x53EA;&#x4FDD;&#x7559;testB&#x3002;&#x4F46;&#x4ECD;&#x5E94;&#x6839;&#x636E;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x800C;&#x5B9A;&#x3002;&#x5982;&#x4F55;&#x9488;&#x5BF9;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x8FDB;&#x884C;mock&#x5316;&#x3002; &#x4F8B;&#x5982;&#x51FA;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x8BED;&#x53E5;: B = new A&#xFF0C;&#x5219;&#x7C7B;B&#x4F9D;&#x8D56;&#x4E8E;&#x7C7B;A&#x3002;&#x4F46;&#x7C7B;A&#x5E76;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x7F16;&#x8BD1;&#x8FDB;test&#x3002;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x52A0;&#x5165;A&#xFF0C;&#x5219;&#x52BF;&#x5FC5;&#x4F1A;&#x5F15;&#x5165;&#x66F4;&#x591A;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x800C;&#x5BFC;&#x81F4;test&#x7F16;&#x8BD1;&#x5D29;&#x6E83;&#x3002;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#x89E3;&#x51B3;&#x65E0;&#x7A77;&#x65E0;&#x5C3D;&#x3002;&#x5728;&#x505A;Android&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;PowerMock&#x53D6;&#x4EE3;Mockito&#x6765;Mock&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x5C06;&#x6784;&#x9020;&#x51FD;&#x6570;Fake&#x5316;&#x6210;&#x7C7B;&#x4F3C;&#x5DE5;&#x5382;&#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x7C7B;&#x5B9E;&#x4F8B;&#x3002;&#x5177;&#x4F53;&#x53C2;&#x770B;&#x8FD9;&#x7BC7;&#x535A;&#x6587;Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002; &#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x6309;&#x7167;&#x73B0;&#x5728;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x5176;&#x5B9E;Mock&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x4E0D;&#x53EF;&#x53D6;&#x7684;&#xFF0C;&#x9996;&#x5148;&#x9020;&#x6210;&#x88AB;&#x6D4B;&#x4EE3;&#x7801;spec&#x4E0D;&#x6E05;&#x6670;&#xFF0C;&#x8BD5;&#x60F3;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x600E;&#x4E48;&#x4F1A;&#x8FD4;&#x56DE;&#x53E6;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x5728;C++&#x4E2D;&#x5F88;&#x96BE;&#x505A;&#x5230;Mock&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x597D;&#x7684;&#x505A;&#x6CD5;&#x5E94;&#x5F53;&#x662F;&#x8FD0;&#x7528;Dependency Injection&#x3002;&#x4F8B;&#x5982;&#xFF1A;class A{}class B{ void func() { A* a = new A; }}&#x7C7B;B&#x5E94;&#x5F53;&#x6539;&#x5199;&#x4E3A;&#xFF1A;class B{ void func(A*) { ... }}&#x5C06;&#x7C7B;A&#x6307;&#x9488;&#x4F20;&#x5165;&#xFF0C;&#x89E3;&#x51B3;dependency&#x7684;&#x95EE;&#x9898;&#x3002;&#x5982;&#x4F55;&#x80FD;&#x591F;&#x8BA9;&#x6D4B;&#x8BD5;&#x7A33;&#x5B9A;&#xFF0C;&#x5728;&#x4EFB;&#x610F;&#x73AF;&#x5883;&#x4E0B;&#x5747;&#x8FD4;&#x56DE;&#x540C;&#x6837;&#x7684;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x3002; &#x8FD9;&#x4E2A;&#x4E00;&#x822C;&#x6D89;&#x53CA;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x4F8B;&#x5982;&#x8C03;&#x7528;&#x7F51;&#x7EDC;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x7F51;&#x7EDC;&#x7684;&#x73AF;&#x5883;&#x5C31;&#x6CA1;&#x6CD5;&#x8FDB;&#x884C;&#x3002;&#x518D;&#x4F8B;&#x5982;&#x6D4B;&#x8BD5;&#x65F6;&#x64CD;&#x4F5C;&#x771F;&#x5B9E;&#x5177;&#x4F53;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x8BE5;&#x6587;&#x4EF6;&#x88AB;&#x6D4B;&#x8BD5;&#x5916;&#x4EBA;&#x4E3A;&#x6216;&#x4EE3;&#x7801;&#x4FEE;&#x6539;&#xFF0C;&#x5219;&#x6D4B;&#x8BD5;&#x53EF;&#x80FD;&#x5C31;&#x4F1A;&#x83AB;&#x540D;&#x5931;&#x8D25;&#x3002; &#x9488;&#x5BF9;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x5728;&#x6D4B;&#x8BD5;&#x4E2D;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x3002;&#x4F8B;&#x5982;&#x524D;&#x8005;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x5BF9;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x8FDB;&#x884C;Mock&#x5316;&#xFF0C;&#x540E;&#x8005;&#x5E94;&#x5F53;&#x5728;&#x6D4B;&#x8BD5;&#x7684;setUp&#x548C;tearDown&#x4E2D;&#x751F;&#x6210;&#x865A;&#x5047;&#x6587;&#x4EF6;&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x5728;&#x6D4B;&#x8BD5;&#x5B8C;&#x6210;&#x65F6;&#x505A;&#x6E05;&#x7406;&#x3002;&#x4F1A;&#x56E0;&#x4E3A;&#x5F88;&#x5C0F;&#x7684;&#x88AB;&#x6D4B;&#x4EE3;&#x7801;&#x6539;&#x52A8;&#xFF0C;&#x800C;&#x5BFC;&#x81F4;&#x5927;&#x9762;&#x79EF;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#xFF0C;&#x751A;&#x81F3;&#x6D4B;&#x8BD5;&#x5D29;&#x6E83;&#x3002; &#x8FD9;&#x4E2A;&#x5C31;&#x662F;gmock&#x6587;&#x6863;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x8981;&#x9488;&#x5BF9;&#x63A5;&#x53E3;&#x7F16;&#x7A0B;&#xFF0C;&#x9488;&#x5BF9;&#x63A5;&#x53E3;&#x6D4B;&#x8BD5;&#x3002;Robert C&#xB7;Martin&#x5728;&#x300A;&#x654F;&#x6377;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#xFF0D;&#x539F;&#x5219;&#x3001;&#x6A21;&#x5F0F;&#x4E0E;&#x5B9E;&#x8DF5;&#x300B;&#x4E00;&#x4E66;&#x4E2D;&#x6709;&#x63D0;&#x51FA;&#xFF1A;&#x6240;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x5E94;&#x4F9D;&#x8D56;&#x4E8E;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#x3002;&#x56E0;&#x4E3A;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#x662F;&#x7ECF;&#x8FC7;&#x62BD;&#x8C61;&#x7684;&#xFF0C;&#x76F8;&#x5BF9;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x8F83;&#x4E3A;&#x7A33;&#x5B9A;&#x3002;&#x800C;&#x88AB;&#x4F9D;&#x8D56;&#x7684;&#x4EE3;&#x7801;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x4FDD;&#x6301;&#x7A33;&#x5B9A;&#xFF0C;&#x8FD9;&#x6837;&#x57FA;&#x4E8E;&#x4E4B;&#x4E0A;&#x7684;&#x4EE3;&#x7801;&#x624D;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x4F9D;&#x8D56;&#x7684;&#x6539;&#x52A8;&#x800C;&#x6539;&#x52A8;&#x3002;&#x4E0B;&#x9762;&#x5217;&#x51FA;&#x51E0;&#x79CD;&#x6211;&#x5728;&#x5B9E;&#x9645;&#x5199;test case&#x65F6;&#x9047;&#x5230;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5728;gmock&#x4E2D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;&#x6309;&#x7167;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x8FD4;&#x56DE;&#x7ED3;&#x679C; - Fake&#x4F8B;&#x5982;:class A{ virtual int func(int a, int b);}EXPECT_CALL(mockA, func()) .WillRepeatedly(a+b);gmock&#x4E2D;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;&#xFF1A;Using Functions/Methods/Functors as Actionsusing ::testing::_;using ::testing::Invoke;class MockFoo : public Foo {public: MOCK_METHOD2(Sum, int(int x, int y)); MOCK_METHOD1(ComplexJob, bool(int x));};int CalculateSum(int x, int y) { return x + y; }class Helper {public: bool ComplexJob(int x);};...MockFoo foo;Helper helper;EXPECT_CALL(foo, Sum(_, _)) .WillOnce(Invoke(CalculateSum));EXPECT_CALL(foo, ComplexJob(_)) .WillOnce(Invoke(&amp;helper, &amp;Helper::ComplexJob));foo.Sum(5, 6); // Invokes CalculateSum(5, 6).foo.ComplexJob(10); // Invokes helper.ComplexJob(10);Mock non-virtual&#x51FD;&#x6570;// A simple packet stream class. None of its members is virtual.class ConcretePacketStream { public: void AppendPacket(Packet* new_packet); const Packet* GetPacket(size_t packet_number) const; size_t NumberOfPackets() const; ...};// A mock packet stream class. It inherits from no other, but defines// GetPacket() and NumberOfPackets().class MockPacketStream { public: MOCK_CONST_METHOD1(GetPacket, const Packet*(size_t packet_number)); MOCK_CONST_METHOD0(NumberOfPackets, size_t()); ...}template &lt;class PacketStream&gt;void CreateConnection(PacketStream* stream) { ... }template &lt;class PacketStream&gt;class PacketReader { public: void ReadPackets(PacketStream* stream, size_t packet_num);};MockPacketStream mock_stream;EXPECT_CALL(mock_stream, ...)...;.. set more expectations on mock_stream ...PacketReader&lt;MockPacketStream&gt; reader(&amp;mock_stream);... exercise reader ...&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF1F; &#x56E0;&#x4E3A;&#x53EA;&#x80FD;&#x8FD9;&#x4E48;&#x505A;&#x3002;&#x666E;&#x901A;&#x7684;mock&#xFF0C;&#x8981;&#x901A;&#x8FC7;&#x7EE7;&#x627F;&#x88AB;&#x6D4B;&#x8BD5;&#x7C7B;&#xFF0C;&#x5E76;&#x91CD;&#x5199;virtual&#x51FD;&#x6570;&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x800C;&#x4E0A;&#x9762;&#x7684;ConcretePacketStream&#x548C;MockPacketStream&#x5E76;&#x4EFB;&#x4F55;&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4F20;&#x5165;&#x540E;&#x8005;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x4E0D;&#x7528;reinterpret_cast&#x662F;&#x4E0D;&#x80FD;&#x8F6C;&#x6210;&#x524D;&#x8005;&#x7684;&#x6307;&#x9488;&#x7684;&#x3002; &#x6240;&#x4EE5;&#x60F3;&#x4E00;&#x4E2A;&#x53D8;&#x901A;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x7528;&#x6A21;&#x677F;&#x7C7B;&#x6765;&#x5B9A;&#x4E49;&#x88AB;&#x6D4B;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x6D4B;&#x8BD5;&#x65F6;&#x4F20;&#x5165;mock&#x7C7B;&#xFF0C;&#x5728;&#x751F;&#x4EA7;&#x65F6;&#xFF0C;&#x4F20;&#x5165;&#x771F;&#x5B9E;&#x7C7B;&#x3002;Mocking Side EffectsEXPECT_CALL(mutator, MutateInt(_)) .WillOnce(DoAll(SetArgPointee&lt;0&gt;(5), Return(true)));EXPECT_CALL(mutator, Mutate(NotNull(), 5)) .WillOnce(SetArrayArgument&lt;0&gt;(values, values + 5));&#x7B2C;&#x4E00;&#x4E2A;&#x5C06;MutateInt&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;int&#xFF0C;&#x8BBE;&#x4E3A;5&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;true&#x3002; &#x7B2C;&#x4E8C;&#x4E2A;&#x5C06;values&#x6570;&#x7EC4;&#x7684;[0,5)&#x62F7;&#x8D1D;&#x5230;&#x53C2;&#x6570;1&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x3002; &#x5982;&#x679C;&#x4ECD;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#xFF0C;&#x5219;&#x7528;DoAll&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;EXPECT_CALL(mutator, MutateInt(_)) .WillOnce(DoAll(SetArgPointee&lt;0&gt;(5), Return(true)));Selecting an Action&#x2019;s Argumentsusing ::testing::_;using ::testing::Invoke;bool MyIsVisibleInQuadrant1(bool visible, const string&amp; name, int x, int y,const map&lt;pair&lt;int, int&gt;, double&gt;&amp; weight,double min_weight, double max_wight) { return IsVisibleInQuadrant1(visible, x, y);}...EXPECT_CALL(mock, Foo(_, _, _, _, _, _, _)) .WillOnce(Invoke(MyIsVisibleInQuadrant1)); // Now it works.&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;adaptor MyIsVisibleInQuadrant1&#xFF0C;&#x6216;&#x8005;&#x7528;gmock&#x63D0;&#x4F9B;&#x7684;&#x65B9;&#x6CD5;&#x4F18;&#x96C5;&#x7684;&#x89E3;&#x51B3;&#x3002;using ::testing::_;using ::testing::Invoke;using ::testing::WithArgs;...EXPECT_CALL(mock, Foo(_, _, _, _, _, _, _)).WillOnce(WithArgs&lt;0, 2, 3&gt;(Invoke(IsVisibleInQuadrant1)));// No need to define your own adaptor.Mocking Private or Protected Methodsclass Foo { public: ... virtual bool Transform(Gadget* g) = 0; protected: virtual void Resume(); private: virtual int GetTimeOut();};class MockFoo : public Foo { public: ... MOCK_METHOD1(Transform, bool(Gadget* g)); // The following must be in the public section, even though the // methods are protected or private in the base class. MOCK_METHOD0(Resume, void()); MOCK_METHOD0(GetTimeOut, int());};C++ allows a subclass to specify a different access level than the base class on a virtual function.MiscKeep in mind that one doesn&#x2019;t have to verify more than one property in one test. In fact, it&#x2019;s a good style to verify only one thing in one test. If you do that, a bug will likely break only one or two tests instead of dozensWhen it&#x2019;s being destroyed, your friendly mock object will automatically verify that all expectations on it have been satisfied, and will generate Google Test failures if not. Currently these are only platforms that support the pthreads library (this includes Linux and Mac). &#x52A0;&#x4E0A;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;&#x2013;gmock_verbose=info&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x6240;&#x6709;EXPECT_CALL&#x7684;&#x5177;&#x4F53;&#x8C03;&#x7528;&#x60C5;&#x51B5;&#x3002;Some useful tips in gtestSelecting TestsIf you set the GTEST_FILTER environment variable or the &#x2013;gtest_filter flag to a filter string, Google Test will only run the tests whose full names (in the form of TestCaseName.TestName) match the filter. The format of a filter is a &#x2018;:&#x2019;-separated list of wildcard patterns (called the positive patterns) optionally followed by a &#x2018;-&#x2019; and another &#x2018;:&#x2019;-separated pattern list (called the negative patterns)../foo_test Has no flag, and thus runs all its tests../foo_test &#x2013;gtest_filter=* Also runs everything, due to the single match-everything * value../foo_test &#x2013;gtest_filter=FooTest.* Runs everything in test case FooTest../foo_test &#x2013;gtest_filter=Null:Constructor Runs any test whose full name contains either &#x201C;Null&#x201D; or &#x201C;Constructor&#x201D;../foo_test &#x2013;gtest_filter=-DeathTest. Runs all non-death tests../foo_test &#x2013;gtest_filter=FooTest.*-FooTest.Bar Runs everything in test case FooTest except FooTest.BarTemporarily Disabling Tests// Tests that Foo does Abc.TEST(FooTest, DISABLED_DoesAbc) { ... }class DISABLED_BarTest : public ::testing::Test { ... };// Tests that Bar does Xyz.TEST_F(DISABLED_BarTest, DoesXyz) { ... }Temporarily Enabling Disabled Testsjust invoke the test program with the &#x2013;gtest_also_run_disabled_tests flag or set the GTEST_ALSO_RUN_DISABLED_TESTS environment variable to a value other than 0.Repeating the Tests$ foo_test &#x2013;gtest_repeat=1000Repeat foo_test 1000 times and don&#x2019;t stop at failures.$ foo_test &#x2013;gtest_repeat=-1A negative count means repeating forever.$ foo_test &#x2013;gtest_repeat=1000 &#x2013;gtest_break_on_failureRepeat foo_test 1000 times, stopping at the first failure. This is especially useful when running under a debugger: when the testfails, it will drop into the debugger and you can then inspect variables and stacks.$ foo_test &#x2013;gtest_repeat=1000 &#x2013;gtest_filter=FooBarRepeat the tests whose name matches the filter 1000 times.%23%20C/C++%20Test%20Framework%20-%20Google%20Test%20%26%20Google%20Mock%0A@%28myblog%29%5BTDD%2C%20gtest%2C%20gmock%5D%0A%0AGoogle%20Test%uFF0CGoogle%20Mock%u4EE5%u4E0B%u7B80%u79F0gtest%uFF0Cgmock%u3002%0A%u5728%u63A5%u89E6gtest%uFF0Cgmock%u4E4B%u524D%uFF0C%u6D4B%u8BD5C/C++%20code%u4F7F%u7528%5BUnitTest++%5D%28https%3A//github.com/unittest-cpp/unittest-cpp%29%u3002%u8FD9%u662F%u4E00%u4E2A%u5F88%u7B80%u6D01%u7684%u6846%u67B6%uFF0C%u4E0A%u624B%u5F88%u5FEB%u3002%u53C2%u770B%u53E6%u4E00%u7BC7%u535A%u6587%5BUnitTest++%u7B80%u4ECB%5D%28https%3A//zhougy0717.github.io/2016/02/29/UnitTest++%25E7%25AE%2580%25E4%25BB%258B/%29%u3002%u6D4B%u8BD5%u76F8%u5173%u7684%u529F%u80FD%u591F%u7528%uFF0C%u4F46%u662F%u6CA1%u6709mock%u5E93%u3002%u8FD9%u5E26%u6765%u7684%u95EE%u9898%u662F%uFF1A%0A1.%20%u6D4B%u8BD5%u9057%u7559%u4EE3%u7801%u7684%u65F6%u5019%uFF0C%u9700%u8981%u81EA%u884Cfake%u76F8%u5173%u4EE3%u7801%u3002%u8FD9%u4E2A%u5728%u9057%u7559%u7CFB%u7EDF%u5F88%u5E9E%u5927%u65F6%uFF0C%u8981%u9887%u8D39%u5FC3%u529B%u3002%u800C%u4E14%u8FC7%u591A%u6D89%u53CA%u7EC6%u8282%uFF0C%u5BFC%u81F4%u6D4B%u8BD5%u6781%u4E0D%u7A33%u5B9A%uFF0C%u7CFB%u7EDF%u4EE3%u7801%u4EFB%u610F%u7684%u6F14%u8FDB%uFF0C%u90FD%u4F1A%u5BFC%u81F4%u5927%u5806%u7684%u6D4B%u8BD5%u5931%u8D25%uFF0C%u751A%u81F3%u6D4B%u8BD5%u65E0%u6CD5%u8FDB%u884C%u3002%0A2.%20%u6D4B%u8BD5case%u4E4B%u95F4%u65E0%u6CD5%u5F88%u597D%u7684%u89E3%u8026%u3002%u7ED3%u679C%u540C%u6837%u662F%u6D4B%u8BD5%u4E0D%u591F%u7A33%u5B9A%u3002%u672F%u8BED%u662F%u6D4B%u8BD5%u4EE3%u7801%u5F88%u201C%u8106%u5F31%u201D%u3002%0A%0AJava%uFF0CPython%uFF0CJavaScript%u90FD%u6709%u81EA%u5DF1%u7684mock%u5E93%u3002Python%u7684Mock%u7C7B%uFF0CJava%u7684Mockito/PowerMock%uFF0CJavaScript%u7684Sinon%u3002%u4E8E%u662F%uFF0C%u5728%u7F51%u4E0A%u641C%u7D22%u4E86%u4E00%u4E0BC/C++%u7684Mock%u5E93%uFF0C%u4E8E%u662F%u770B%u5230%u4E86gtest%uFF0Cgmock%u3002%u7136%u540E%u5C31%u6709%u4E86%u8FD9%u4E00%u7BC7%u3002%0A%0A%23%23%20%u7B80%u4ECB%0A%u4E0D%u7528%u53BB%u7F51%u4E0A%u8D39%u5FC3%u627E%u6559%u7A0B%uFF0C%u4E24%u4E2A%u9879%u76EE%u7684%u6587%u6863%u90FD%u975E%u5E38%u68D2%u3002%u5165%u53E3%u7EDF%u4E00%u5728%5Bgtest%20GitHub%u9879%u76EE%u4E3B%u9875%5D%28https%3A//github.com/google/googletest%29%u4E0A%u3002%u800C%u4E14%u8BE5%u6587%u6863%u4E0D%u4EC5%u5F88%u597D%u7684%u4ECB%u7ECD%u4E86gtest%uFF0Cgmock%u7684%u7528%u6CD5%uFF0C%u5176%u4E2D%u8FD8%u6D89%u53CA%u4E86%u5F88%u591ATDD%u6216%u8005UnitTest%u7684%u771F%u77E5%u707C%u89C1%uFF0C%u5F88%u503C%u5F97%u8BFB%u4E00%u8BFB%u3002%0A%u8981%u4F7F%u7528gtest%u975E%u5E38%u7B80%u5355%uFF1A%u7F16%u8BD1%u51FAgtest%uFF0Cgmock%uFF0C%u518D%u94FE%u5165%u4F60%u7684%u6D4B%u8BD5%u7A0B%u5E8F%u3002%0A%0A%23%23%23%20%u7F16%u8BD1gtest/gmock%0Agtest%uFF0Cgmock%u5747%u7528cmake%u6765%u7BA1%u7406%u8DE8%u5E73%u53F0%uFF0C%u5148%u7528cmake%u6765%u751F%u6210Makefile%u3002%u7528%u547D%u4EE4%60cmake%20-G%20%22Unix%20Makefiles%22%20/path/to/CMakeList.txt%60%0A%0A%23%23%23%20Makefile%0A%u7136%u540E%u6309%u7167%u4E0B%u9762%u7F16%u5199Makefile%u3002%u6CE8%u610Fgmock_main%u662F%u4E00%u4E2Amain%u51FD%u6570%u6765%u8C03%u7528%u6240%u6709%u7684test%20case%uFF0C%u7701%u5F97%u81EA%u5DF1%u5199main%u51FD%u6570%u4E86%u3002%0A%60%60%60%0ACC%20%3D%20gcc%0ACPP%20%3D%20g++%0ALINK%20%3D%20g++%0ACFLAGS%20%3D%20-g%20-Wall%20-Werror%20-Wextra%20-std%3Dgnu99%0ACPPFLAGS%20%3D%20-g%20-Wall%20-Werror%20-Wextra%0ALIBS%20%3D%20-L./lib%20-lgtest%20-lgmock%20-lgmock_main%20-lpthread%0A%0AC__SOURCES%20%3D%20%24%28wildcard%20*.c%29%0ACPPSOURCES%20%3D%20%24%28wildcard%20*.cpp%29%0AOBJECTS%20%3D%20%24%28patsubst%20%25.c%2C%20%25.o%2C%20%24%28C__SOURCES%29%29%20%24%28patsubst%20%25.cpp%2C%20%25.o%2C%20%24%28CPPSOURCES%29%29%0ATARGET%20%3D%20test_exe%0A%0Afirst%3A%20all%0A%0A%25.o%3A%20%25.c%0A%20%20%20%20%24%28CC%29%20%24%28INCLUDES%29%20-c%20%24%28CFLAGS%29%20-o%20%24@%20%24%3C%0A%0A%25.o%3A%20%25.cpp%0A%20%20%20%20%24%28CPP%29%20%24%28INCLUDES%29%20-c%20%24%28CPPFLAGS%29%20-o%20%24@%20%24%3C%0A%0Aall%3A%20%24%28TARGET%29%0A%0A%24%28TARGET%29%3A%20%24%28OBJECTS%29%0A%20%20%20%20%24%28LINK%29%20%24%28CPPFLAGS%29%20%24%28LIBS%29%20-o%20%24%28TARGET%29%20%24%28OBJECTS%29%0A%0A.PHONY%20%3A%20clean%0A%0Aclean%3A%0A%20%20%20%20rm%20-f%20%24%28TARGET%29%20%24%28OBJECTS%29%0A%60%60%60%0A%0A%23%23%23%20Terms%0A%7C%20Meaning%20%20%20%20%7C%20Google%20Test%20Term%20%7C%20ISTQB%20Term%20%7C%0A%7C%20%3A--------%3A%20%7C%20%3A--------------%3A%20%7C%20%3A--------%3A%20%7C%0A%7C%20Exercise%20a%20particular%20program%20path%20with%20specific%20input%20values%20and%20verify%20the%20results%20%7C%20TEST%28%29%20%7C%20Test%20Case%0A%7CA%20set%20of%20several%20tests%20related%20to%20one%20component%20%7C%20Test%20Case%20%7C%20Test%20Suite%0A%0A%23%23%23%20Test%0A%60%60%60%0A%23include%20%22gtest/gtest.h%22%0A%23include%20%22gmock/gmock.h%22%0A%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0Ausing%20%3A%3Atesting%3A%3ATest%3B%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AAtLeast%3B%0A%0ATEST%28TestCaseName%2C%20should_this_test_do%29%0A%7B%0A%09...%0A%20%20%20%20EXPECT_STREQ%28%22%7B%7D%22%2C%20str%29%3B%0A%7D%0A%60%60%60%0A%u4E2D%u95F4%u7684%u90A3%u5806namespace%u90FD%u662Fgtest/gmock%u5E93%u91CC%u5B9A%u4E49%u7684matcher%u5B8F%u6216%u8005%u5404%u79CD%u6709%u7528%u7684%u5B8F%u3002%0A%0A%23%23%23%20Test%20Fixture%0A%u5728%u6D4B%u8BD5%u6709%u91CD%u590D%u7684%u65F6%u5019%uFF0C%u5C31%u8981%u7528%u5230Test%20Fixture%u4E86%uFF0C%u4E5F%u5C31%u662FsetUp%20/%20tearDown%u3002%0A%60%60%60%0Aclass%20QueueTest%20%3A%20public%20%3A%3Atesting%3A%3ATest%20%7B%0A%20protected%3A%0A%20%20virtual%20void%20SetUp%28%29%20%7B%0A%20%20%20%20q1_.Enqueue%281%29%3B%0A%20%20%20%20q2_.Enqueue%282%29%3B%0A%20%20%20%20q2_.Enqueue%283%29%3B%0A%20%20%7D%0A%0A%20%20//%20virtual%20void%20TearDown%28%29%20%7B%7D%0A%0A%20%20Queue%3Cint%3E%20q0_%3B%0A%20%20Queue%3Cint%3E%20q1_%3B%0A%20%20Queue%3Cint%3E%20q2_%3B%0A%7D%3B%0A%0ATEST_F%28QueueTest%2C%20IsEmptyInitially%29%20%7B%0A%20%20EXPECT_EQ%280%2C%20q0_.size%28%29%29%3B%0A%7D%0A%0ATEST_F%28QueueTest%2C%20DequeueWorks%29%20%7B%0A%20%20int*%20n%20%3D%20q0_.Dequeue%28%29%3B%0A%20%20EXPECT_EQ%28NULL%2C%20n%29%3B%0A%0A%20%20n%20%3D%20q1_.Dequeue%28%29%3B%0A%20%20ASSERT_TRUE%28n%20%21%3D%20NULL%29%3B%0A%20%20EXPECT_EQ%281%2C%20*n%29%3B%0A%20%20EXPECT_EQ%280%2C%20q1_.size%28%29%29%3B%0A%20%20delete%20n%3B%0A%0A%20%20n%20%3D%20q2_.Dequeue%28%29%3B%0A%20%20ASSERT_TRUE%28n%20%21%3D%20NULL%29%3B%0A%20%20EXPECT_EQ%282%2C%20*n%29%3B%0A%20%20EXPECT_EQ%281%2C%20q2_.size%28%29%29%3B%0A%20%20delete%20n%3B%0A%7D%0A%60%60%60%0A%23%23%23%23%20constructor/destructor%20vs.%20SetUp/TearDown%0A%3EWhen%20you%20need%20to%20write%20per-test%20set-up%20and%20tear-down%20logic%2C%20you%20have%20the%20choice%20between%20using%20the%20test%20fixture%20constructor/destructor%20or%20SetUp%28%29/TearDown%28%29.%20The%20former%20is%20usually%20preferred%2C%20as%20it%20has%20the%20following%20benefits%3A%0A%0A%3E-%20By%20initializing%20a%20member%20variable%20in%20the%20constructor%2C%20we%20have%20the%20option%20to%20make%20it%20const%2C%20which%20helps%20prevent%20accidental%20changes%20to%20its%20value%20and%20makes%20the%20tests%20more%20obviously%20correct.%0A-%20**In%20case%20we%20need%20to%20subclass%20the%20test%20fixture%20class%2C%20the%20subclass%27%20constructor%20is%20guaranteed%20to%20call%20the%20base%20class%27%20constructor%20first%2C%20and%20the%20subclass%27%20destructor%20is%20guaranteed%20to%20call%20the%20base%20class%27%20destructor%20afterward.%20**With%20SetUp%28%29/TearDown%28%29%2C%20a%20subclass%20may%20make%20the%20mistake%20of%20forgetting%20to%20call%20the%20base%20class%27%20SetUp%28%29/TearDown%28%29%20or%20call%20them%20at%20the%20wrong%20moment.%0A%0A%3E%20Benefit%20for%20using%20SetUp/TearDown%3A%0A%0A%3E-%20If%20the%20tear-down%20operation%20could%20throw%20an%20exception%2C%20you%20must%20use%20TearDown%28%29%20as%20opposed%20to%20the%20destructor%2C%20as%20throwing%20in%20a%20destructor%20leads%20to%20undefined%20behavior%20and%20usually%20will%20kill%20your%20program%20right%20away.%20Note%20that%20many%20standard%20libraries%20%28like%20STL%29%20may%20throw%20when%20exceptions%20are%20enabled%20in%20the%20compiler.%20Therefore%20you%20should%20prefer%20TearDown%28%29%20if%20you%20want%20to%20write%20portable%20tests%20that%20work%20with%20or%20without%20exceptions.%0A-%20The%20assertion%20macros%20throw%20an%20exception%20when%20flag%20--gtest_throw_on_failure%20is%20specified.%20Therefore%2C%20you%20shouldn%27t%20use%20Google%20Test%20assertions%20in%20a%20destructor%20if%20you%20plan%20to%20run%20your%20tests%20with%20this%20flag.%0A-%20In%20a%20constructor%20or%20destructor%2C%20you%20cannot%20make%20a%20virtual%20function%20call%20on%20this%20object.%20%28You%20can%20call%20a%20method%20declared%20as%20virtual%2C%20but%20it%20will%20be%20statically%20bound.%29%20Therefore%2C%20if%20you%20need%20to%20call%20a%20method%20that%20will%20be%20overriden%20in%20a%20derived%20class%2C%20you%20have%20to%20use%20SetUp%28%29/TearDown%28%29.%0A%0A%u7B80%u8A00%u4E4B%uFF0C%u5728%u903B%u8F91%u4E0A%uFF0C%u8FD9%u4E24%u7EC4%u7684%u4F5C%u7528%u76F8%u540C%uFF0C%u90FD%u662F%u6BCF%u4E2A%u6D4B%u8BD5%u4E4B%u524D%u4E4B%u540E%u4F1A%u505A%u4E00%u4E9B%u5904%u7406%u5DE5%u4F5C%u3002Constructor/Destructor%u7684%u597D%u5904%u662F%u63D0%u4F9B%u4E86%u7EE7%u627F%u3002setUp/tearDown%u7684%u597D%u5904%u662F%u53EF%u4EE5%u5904%u7406exception%uFF0C%u8FD9%u662F%u4E0D%u80FD%u653E%u5728%u6790%u6784%u51FD%u6570%u91CC%u7684%u3002%0A%23%23%23%20SetUpTestCase%20/%20TearDownTestCase%0ATest%20Case%u7EA7%u522B%u7684SetUp/TearDown%0A%60%60%60%0Aclass%20FooTest%20%3A%20public%20%3A%3Atesting%3A%3ATest%20%7B%0A%20protected%3A%0A%20%20//%20Per-test-case%20set-up.%0A%20%20//%20Called%20before%20the%20first%20test%20in%20this%20test%20case.%0A%20%20//%20Can%20be%20omitted%20if%20not%20needed.%0A%20%20static%20void%20SetUpTestCase%28%29%20%7B%0A%20%20%20%20shared_resource_%20%3D%20new%20...%3B%0A%20%20%7D%0A%0A%20%20//%20Per-test-case%20tear-down.%0A%20%20//%20Called%20after%20the%20last%20test%20in%20this%20test%20case.%0A%20%20//%20Can%20be%20omitted%20if%20not%20needed.%0A%20%20static%20void%20TearDownTestCase%28%29%20%7B%0A%20%20%20%20delete%20shared_resource_%3B%0A%20%20%20%20shared_resource_%20%3D%20NULL%3B%0A%20%20%7D%0A%0A%20%20//%20You%20can%20define%20per-test%20set-up%20and%20tear-down%20logic%20as%20usual.%0A%20%20virtual%20void%20SetUp%28%29%20%7B%20...%20%7D%0A%20%20virtual%20void%20TearDown%28%29%20%7B%20...%20%7D%0A%0A%20%20//%20Some%20expensive%20resource%20shared%20by%20all%20tests.%0A%20%20static%20T*%20shared_resource_%3B%0A%7D%3B%0A%60%60%60%0A%23%23%23%20SetUp/TearDown%20Environment%20%0A%3E-%20First%2C%20you%20subclass%20the%20%3A%3Atesting%3A%3AEnvironment%20class%20to%20define%20a%20test%20environment%2C%20which%20knows%20how%20to%20set-up%20and%20tear-down%3A%0A%3E-%20Then%2C%20you%20register%20an%20instance%20of%20your%20environment%20class%20with%20Google%20Test%20by%20calling%20the%20%60%3A%3Atesting%3A%3AAddGlobalTestEnvironment%28%29%60%20function%3A%0A%3ENow%2C%20when%20RUN_ALL_TESTS%28%29%20is%20called%2C%20it%20first%20calls%20the%20SetUp%28%29%20method%20of%20the%20environment%20object%2C%20then%20runs%20the%20tests%20if%20there%20was%20no%20fatal%20failures%2C%20and%20finally%20calls%20TearDown%28%29%20of%20the%20environment%20object.%0A-%20It%27s%20OK%20to%20register%20multiple%20environment%20objects.%20In%20this%20case%2C%20their%20SetUp%28%29%20will%20be%20called%20in%20the%20order%20they%20are%20registered%2C%20and%20their%20TearDown%28%29%20will%20be%20called%20in%20the%20reverse%20order.%0A-%20Note%20that%20Google%20Test%20takes%20ownership%20of%20the%20registered%20environment%20objects.%20Therefore%20do%20not%20delete%20them%20by%20yourself.%0A%0A%60%60%60%0Aclass%20Environment%20%7B%0A%20public%3A%0A%20%20virtual%20%7EEnvironment%28%29%20%7B%7D%0A%20%20//%20Override%20this%20to%20define%20how%20to%20set%20up%20the%20environment.%0A%20%20virtual%20void%20SetUp%28%29%20%7B%7D%0A%20%20//%20Override%20this%20to%20define%20how%20to%20tear%20down%20the%20environment.%0A%20%20virtual%20void%20TearDown%28%29%20%7B%7D%0A%7D%3B%0A%0AEnvironment*%20AddGlobalTestEnvironment%28Environment*%20env%29%3B%0A%60%60%60%0A%23%23%23%20%u65AD%u8A00%0A%u6709%u4E24%u79CD%u65AD%u8A00EXPECT%5C_xxx%u548CASSERT%5C_xxx%u3002%u524D%u8005%u4F1A%u8BA9%u6D4B%u8BD5%u7EC8%u6B62%uFF0C%u540E%u8005%u4E0D%u4F1A%uFF0C%u53EA%u4F1A%u8BA9%u6D4B%u8BD5fail%u3002%0A%0A%0A%23%23%20gmock%0A%u4E4B%u6240%u4EE5%u8981%u5207%u5230gtest%uFF0C%u552F%u4E00%u7684%u539F%u56E0%u5C31%u662Fgmock%uFF0C%u6240%u4EE5%u8981%u4E13%u5F00%u4E00%u7AE0%u91CD%u70B9%u4ECB%u7ECD%u4E00%u4E0B%u3002%u6240%u6709%u5185%u5BB9%u5747%u6765%u81EA%u4E8E%u5B98%u65B9%u6587%u6863%u3002%u5185%u5BB9%u6DF1%u5EA6%u7531%u6D45%u5165%u6DF1%uFF0C%u4F9D%u6B21%u5982%u4E0B%uFF1A%0A-%20%5BGoogle%20Mock%20for%20Dummies%5D%28https%3A//github.com/google/googletest/blob/master/googlemock/docs/ForDummies.md%29%0A-%20%5BCookBook%5D%28https%3A//github.com/google/googletest/blob/master/googlemock/docs/CookBook.md%29%0A%0A%u6700%u540E%u8FD8%u6709%u53C2%u8003%u624B%u518C%3A%0A-%20%5BCheat%20Sheet%5D%28https%3A//github.com/google/googletest/blob/master/googlemock/docs/CheatSheet.md%29%0A%0A%23%23%23%20%u7B80%u4ECB%0A%3EGoogle%20C++%20Mocking%20Framework%20%28or%20Google%20Mock%20for%20short%29%20is%20a%20library%20%28sometimes%20we%20also%20call%20it%20a%20%22framework%22%20to%20make%20it%20sound%20cool%29%20for%20creating%20mock%20classes%20and%20using%20them.%20It%20does%20to%20C++%20what%20jMock%20and%20EasyMock%20do%20to%20Java.%0A%0A%23%23%23%23%20%u4F55%u4E3AMock%uFF1F%0A%3E**Mocks**%20are%20objects%20pre-programmed%20with%20expectations%2C%20which%20form%20a%20specification%20of%20the%20calls%20they%20are%20expected%20to%20receive.%0A%0A%u76F8%u5E94%u7684%u8FD8%u6709Fake%u548CStub%0A%3E**Fake**%20objects%20have%20working%20implementations%2C%20but%20usually%20take%20some%20shortcut%20%28perhaps%20to%20make%20the%20operations%20less%20expensive%29%2C%20which%20makes%20them%20not%20suitable%20for%20production.%20An%20in-memory%20file%20system%20would%20be%20an%20example%20of%20a%20fake.%0A%0Agmock%u7684%u6587%u6863%u91CC%u53EA%u63D0%u5230%u4E86Fake%uFF0C%u4ECEMartin%20Fowler%u7684%u6587%u7AE0%5BMocks%20Aren%27t%20Stubs%5D%28https%3A//martinfowler.com/articles/mocksArentStubs.html%29%u4E2D%u6458%u5F55%u5982%u4E0B%3A%0A%3E**Stubs**%20provide%20canned%20answers%20to%20calls%20made%20during%20the%20test%2C%20usually%20not%20responding%20at%20all%20to%20anything%20outside%20what%27s%20programmed%20in%20for%20the%20test.%0A%0A%u4E09%u8005%u4F5C%u7528%u76F8%u540C%uFF0C%u90FD%u662F%u6A21%u62DF%u7CFB%u7EDF%u5176%u4ED6%u90E8%u5206%u7684%u529F%u80FD%uFF0C%u8FBE%u5230%u4EE3%u7801%u9694%u79BB%u7684%u6548%u679C%uFF0C%u65B9%u4FBF%u6D4B%u8BD5%u3002%u4F46%u662FMock%u7684%u7279%u70B9%u662F%u66F4OO%u5316%uFF0C%u4E5F%u7B26%u5408TDD%u6216%u8005BDD%u7684%u601D%u60F3%u2014%u2014%u9488%u5BF9%u4E00%u4E2Aobject%u8BBE%u7F6E%u671F%u5F85%uFF0C%u518D%u5BF9%u9F50verify%u3002%0A%0AMocks%20vs.%20Stubs%20-%20from%20Martin%20Fowler%0A%3EIn%20order%20to%20use%20state%20verification%20on%20the%20stub%2C%20I%20need%20to%20make%20some%20extra%20methods%20on%20the%20stub%20to%20help%20with%20verification.%20As%20a%20result%20the%20stub%20implements%20MailService%20but%20adds%20extra%20test%20methods.%0A%0A%3EMock%20objects%20always%20use%20behavior%20verification%2C%20a%20stub%20can%20go%20either%20way.%20Meszaros%20refers%20to%20stubs%20that%20use%20behavior%20verification%20as%20a%20Test%20Spy.%20The%20difference%20is%20in%20how%20exactly%20the%20double%20runs%20and%20verifies%20and%20I%27ll%20leave%20that%20for%20you%20to%20explore%20on%20your%20own.%0A%0A%23%23%23%23%20Getting%20Started%0AClass%20to%20Mock%0A%60%60%60%0Aclass%20Turtle%20%7B%0A%20%20...%0A%20%20virtual%20%7ETurtle%28%29%20%7B%7D%0A%20%20virtual%20void%20PenUp%28%29%20%3D%200%3B%0A%20%20virtual%20void%20PenDown%28%29%20%3D%200%3B%0A%20%20virtual%20void%20Forward%28int%20distance%29%20%3D%200%3B%0A%7D%3B%0A%60%60%60%0AMock%20class%0A%60%60%60%0A%23include%20%22gmock/gmock.h%22%20%20//%20Brings%20in%20Google%20Mock.%0Aclass%20MockTurtle%20%3A%20public%20Turtle%20%7B%0A%20public%3A%0A%20%20...%0A%20%20MOCK_METHOD0%28PenUp%2C%20void%28%29%29%3B%0A%20%20MOCK_METHOD0%28PenDown%2C%20void%28%29%29%3B%0A%20%20MOCK_METHOD1%28Forward%2C%20void%28int%20distance%29%29%3B%0A%7D%3B%0A%60%60%60%0A%u9488%u5BF9%u5F85Mock%u7684Turtle%20class%u8981%u6CE8%u610F%u7684%u662F%3A%0A%3ENote%20that%20the%20**destructor%20of%20Turtle%20must%20be%20virtual**%2C%20as%20is%20the%20case%20for%20all%20classes%20you%20intend%20to%20inherit%20from%20-%20otherwise%20the%20destructor%20of%20the%20derived%20class%20will%20not%20be%20called%20when%20you%20delete%20an%20object%20through%20a%20base%20pointer%2C%20and%20you%27ll%20get%20corrupted%20program%20states%20like%20memory%20leaks.%0A%0AUse%20it%0A%60%60%60%0A%23include%20%22path/to/mock-turtle.h%22%0A%23include%20%22gmock/gmock.h%22%0A%23include%20%22gtest/gtest.h%22%0Ausing%20%3A%3Atesting%3A%3AAtLeast%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%231%0A%0ATEST%28PainterTest%2C%20CanDrawSomething%29%20%7B%0A%20%20MockTurtle%20turtle%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%232%0A%20%20EXPECT_CALL%28turtle%2C%20PenDown%28%29%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%233%0A%20%20%20%20%20%20.Times%28AtLeast%281%29%29%3B%0A%0A%20%20Painter%20painter%28%26turtle%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%234%0A%0A%20%20EXPECT_TRUE%28painter.DrawCircle%280%2C%200%2C%2010%29%29%3B%0A%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%235%0A%0Aint%20main%28int%20argc%2C%20char**%20argv%29%20%7B%0A%20%20//%20The%20following%20line%20must%20be%20executed%20to%20initialize%20Google%20Mock%0A%20%20//%20%28and%20Google%20Test%29%20before%20running%20the%20tests.%0A%20%20%3A%3Atesting%3A%3AInitGoogleMock%28%26argc%2C%20argv%29%3B%0A%20%20return%20RUN_ALL_TESTS%28%29%3B%0A%7D%0A%60%60%60%0A%u5982%u679C%u4F60%u613F%u610F%u7684%u8BDD%uFF0C%u53EF%u4EE5%u81EA%u5DF1%u5199main%uFF0C%u5982%u679C%u4F60%u60F3%u5077%u61D2%uFF0C%u8BB0%u5F97%u5728Makefile%u91CClink%20gmock_main%u3002%0A%u6309Google%u7684%u8BF4%u6CD5%uFF0Cgmock%u4E5F%u53EF%u4EE5%u548C%u5176%u4ED6%u6D4B%u8BD5%u6846%u67B6%u517C%u5BB9%uFF0C%u4F46%u603B%u611F%u89C9%u633A%u60AC%u7684%u3002%0A%0A%23%23%23%23%20%u4E00%u4E9B%u6709%u7528%u7684%u5DE5%u5177%0A**Marcher**%0A%60EXPECT_CALL%28turtle%2C%20Forward%28_%29%29%3B%60%0A%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%20%u4EE5%u4EFB%u610F%u53C2%u6570%u8C03%u7528Forward%0A%60EXPECT_CALL%28turtle%2C%20Forward%28Ge%28100%29%29%29%3B%60%0A%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%20%u4EE5%u5927%u4E8E100%u7684%u6574%u6570%u8C03%u7528Forward%0A%09%0A**Cardinalities%3A%20How%20Many%20Times%20Will%20It%20Be%20Called%3F**%0A%3E-%20If%20neither%20WillOnce%28%29%20nor%20WillRepeatedly%28%29%20is%20in%20the%20EXPECT_CALL%28%29%2C%20the%20inferred%20cardinality%20is%20Times%281%29.%0A-%20If%20there%20are%20n%20WillOnce%28%29%27s%20but%20no%20WillRepeatedly%28%29%2C%20where%20n%20%3E%3D%201%2C%20the%20cardinality%20is%20Times%28n%29.%0A-%20If%20there%20are%20n%20WillOnce%28%29%27s%20and%20one%20WillRepeatedly%28%29%2C%20where%20n%20%3E%3D%200%2C%20the%20cardinality%20is%20Times%28AtLeast%28n%29%29.%0A%0A%60%60%60%0AEXPECT_CALL%28mockObj%2C%20func%28%29%29%0A%09.Times%28AtLeast%281%29%29%0A%09.WillOnce%28Return%28123%29%29%0A%09.WillRepeatedly%28Return%28456%29%29%0A%60%60%60%0A%u4E0A%u9762%u8FD9%u6BB5%u4EE3%u7801%u8981%u6C42func%u51FD%u6570%u81F3%u5C11%u8FD0%u884C%u4E00%u6B21%uFF0C%u7B2C%u4E00%u6B21%u8FD4%u56DE123%uFF0C%u4E4B%u540E%u6BCF%u6B21%u8FD4%u56DE456%u3002%0A%0A%3E**Important%20note**%3A%20The%20EXPECT_CALL%28%29%20statement%20evaluates%20the%20action%20clause%20only%20once%2C%20even%20though%20the%20action%20may%20be%20performed%20many%20times.%20Therefore%20you%20must%20be%20careful%20about%20side%20effects.%20The%20following%20may%20not%20do%20what%20you%20want%3A%0A%0A%60%60%60%0Aint%20n%20%3D%20100%3B%0AEXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A.Times%284%29%0A.WillRepeatedly%28Return%28n++%29%29%3B%0A%60%60%60%0A%u56E0%u4E3AReturn%u662F%u5B8F%uFF0C%u6240%u4EE5%u53EA%u4F1A%u66FF%u6362%u4E00%u6B21%uFF0C%u6240%u4EE5%u4E0D%u7BA1GetX%u8C03%u7528%u51E0%u6B21%uFF0C%u8FD4%u56DE%u90FD%u662F101%uFF0C%u800C%u4E0D%u662F101%2C102%2C103%2C...%0A%0A**All%20Expectations%20Are%20Sticky**%0A%u6240%u8C13%u7684sticky%u5C31%u662FEXPECT%5C_CALL%u603B%u662F%u751F%u6548%u7684%uFF0C%u9664%u975E%u4F60%u663E%u793A%u7684%u5C06%u5176%u5931%u6548%u3002%u5982%u4E0B%uFF0C%u6240%u6709%u7684EXPECT%5C_CALL%u90FD%u4F1A%u751F%u6548%uFF0C%u90A3%u4E48%u6700%u540E%u4E00%u4E2A%u4F1A%u8986%u76D6%u524D%u9762%u6240%u6709%u7684%uFF0C%u4E5F%u5C31%u662FGetX%u603B%u4F1A%u8FD4%u56DE10%u3002%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0A...%0Afor%20%28int%20i%20%3D%20n%3B%20i%20%3E%200%3B%20i--%29%20%7B%0A%20%20EXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A%20%20%20%20%20%20.WillOnce%28Return%2810*i%29%29%3B%0A%7D%0A%60%60%60%0A%u5982%u679C%u5E0C%u671B%u4ED6%u8FD4%u56DE%uFF0C30%2C20%2C10%uFF0C...%uFF0C%u5E94%u8BE5%u8FD9%u4E48%u5199%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0A...%0Afor%20%28int%20i%20%3D%20n%3B%20i%20%3E%200%3B%20i--%29%20%7B%0A%20%20EXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A%20%20%20%20.WillOnce%28Return%2810*i%29%29%0A%20%20%20%20.RetiresOnSaturation%28%29%3B%0A%7D%0A%60%60%60%0A%60RetireOnSaturation%60%u5C31%u662F%u663E%u793A%u7684%u8BA9%u5176%u5931%u6548%u3002%u8FD8%u6709%u4E00%u4E2A%u529E%u6CD5%uFF1A%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AInSequence%3B%0Ausing%20%3A%3Atesting%3A%3AReturn%3B%0A...%0A%7B%0A%20%20InSequence%20s%3B%0A%0A%20%20for%20%28int%20i%20%3D%201%3B%20i%20%3C%3D%20n%3B%20i++%29%20%7B%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20GetX%28%29%29%0A%20%20%20%20%20%20%20%20.WillOnce%28Return%2810*i%29%29%0A%20%20%20%20%20%20%20%20.RetiresOnSaturation%28%29%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%u56E0%u4E3AInSequence%u7684%u5173%u7CFB%uFF0C%u5728%u524D%u9762%u7684EXPECT%5C_CALL%u751F%u6548%u4EE5%u540E%uFF0C%u5C31%u4F1A%u81EA%u52A8%u5931%u6548%uFF0C%u6240%u4EE5%u4E0D%u4F1A%u4EA7%u751F%u8986%u76D6%u7684%u6548%u679C%u3002%0A**Ordered%20vs%20Unordered%20Calls**%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3AInSequence%3B...%0ATEST%28FooTest%2C%20DrawsLineSegment%29%20%7B%0A%20%20...%0A%20%20%7B%0A%20%20%20%20InSequence%20dummy%3B%0A%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20PenDown%28%29%29%3B%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20Forward%28100%29%29%3B%0A%20%20%20%20EXPECT_CALL%28turtle%2C%20PenUp%28%29%29%3B%0A%20%20%7D%0A%20%20Foo%28%29%3B%0A%7D%0A%60%60%60%0A**Expecting%20Partially%20Ordered%20Calls**%0AGoogle%20Mock%20allows%20you%20to%20impose%20an%20arbitrary%20DAG%20%28directed%20acyclic%20graph%29%20on%20the%20calls.%20One%20way%20to%20express%20the%20DAG%20is%20to%0Ause%20the%20After%20clause%20of%20EXPECT_CALL%20.%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3ASequence%3B%0ASequence%20s1%2C%20s2%3B%0AEXPECT_CALL%28foo%2C%20A%28%29%29%0A%09.InSequence%28s1%2C%20s2%29%3B%0AEXPECT_CALL%28bar%2C%20B%28%29%29%0A%09.InSequence%28s1%29%3B%0AEXPECT_CALL%28bar%2C%20C%28%29%29%0A%09.InSequence%28s2%29%3B%0AEXPECT_CALL%28foo%2C%20D%28%29%29%0A%09.InSequence%28s2%29%3B%0A%60%60%60%0Aspecifies%20the%20following%20DAG%20%28where%20s1%20is%20A%20-%3E%20B%20%2C%20and%20s2%20is%20A%20-%3E%20C%20-%3E%20D%20%29%3A%0A%60%60%60%0A%09%20+---%3E%20B%0A%20%20%20%20%20%7C%0AA%20---%7C%0A%09%20%7C%0A%09%20+---%3E%20C%20---%3E%20D%0A%60%60%60%0A**Uninteresting%20Calls**%0A%u8FD9%u662Fgmock%u62A5%u7684warning%u3002%u5F53%u9488%u5BF9%u67D0%u4E00%u4E2A%u5F85%u6D4B%u51FD%u6570%u8BBE%u7F6E%u4E86EXPECT%20spec%uFF0C%u5374%u5E76%u6CA1%u6709%u8C03%u7528%u7684%u65F6%u5019%uFF0C%u5C31%u4F1A%u62A5%u8FD9%u4E2Awarning%u3002%u6B64%u65F6gmock%u8BA4%u4E3A%u4F60%u5BF9%u8BE5%u51FD%u6570%u5E76%u6CA1%u6709%u5174%u8DA3%uFF0C%u6240%u4EE5%u5C31%u4E0D%u9700%u8981%u8FD9%u4E2AEXPECT%20spec%u3002%u5F53%u7136%u4F60%u53EF%u4EE5%u9009%u62E9%u5FFD%u7565%u8FD9%u4E2Awarning%uFF0C%u4F46%u6211%u8BA4%u4E3A%u51FA%u8FD9%u4E2Awarning%u7684%u65F6%u5019%uFF0C%u591A%u534A%u662Ftest%u6F0F%u5199%u4E86%u4EC0%u4E48%u3002%0A%0A**Returning%20Live%20Values%20from%20Mock%20Methods**%0A%60%60%60%0Ausing%20testing%3A%3AByRef%3B%0Ausing%20testing%3A%3AReturn%3B%0Aclass%20MockFoo%20%3A%20public%20Foo%20%7B%0A%09public%3A%0A%09%09MOCK_METHOD0%28GetValue%2C%20int%28%29%29%3B%0A%7D%3B%0A...%0Aint%20x%20%3D%200%3B%0AMockFoo%20foo%3B%0AEXPECT_CALL%28foo%2C%20GetValue%28%29%29%0A%09//%20.WillRepeatedly%28Return%28ByRef%28x%29%29%29%3B%20X%20error%0A%09.WillRepeatedly%28ReturnPointee%28x%29%29%3B%0Ax%20%3D%2042%3B%0AEXPECT_EQ%2842%2C%20foo.GetValue%28%29%29%3B%0A%60%60%60%0A%0A%23%23%23%20%u4E00%u4E9B%u6D4B%u8BD5case%0A%u5199Unit%20Test%u5E76%u4E0D%u50CF%u60F3%u50CF%u7684%u90A3%u4E48%u7B80%u5355%uFF0C%u5E76%u4E0D%u662F%u8C03%u7528%u4E86%u6846%u67B6%uFF0C%u9488%u5BF9%u6BCF%u4E2A%u51FD%u6570%u5199test%20case%u5C31%u53EF%u4EE5%u3002%u6309%u6211%u76EE%u524D%u7684%u7406%u89E3%u6709%u4EE5%u4E0B%u51E0%u79CD%u6311%u6218%uFF1A%0A1.%20Test%20Case%u5982%u4F55%u89E3%u8026%u3002%u4E0D%u8981%u6709%u91CD%u590D%u6D4B%u8BD5%28overlap%29%u3002%0A%u4F8B%u5982%uFF1A%u5728%u5199A%u51FD%u6570%u7684%u65F6%u5019%uFF0C%u5199%u4E86%u6D4B%u8BD5testA%uFF0CB%u51FD%u6570%u4F1A%u8C03%u7528A%u51FD%u6570%uFF0C%u90A3%u4E48%u5728%u5199%u5B8CA%u4E4B%u540E%u5199B%u7684%u6D4B%u8BD5testB%u65F6%uFF0C%u662F%u5426%u8981%u5C06A%20mock/fake/stub%u6389%3F%20%u5982%u679C%u4E0D%u5C06A%u51FD%u6570Fake%u6389%uFF0C%u5219testA%u548CtestB%u4E4B%u95F4%u5C31%u662F%u6709overlap%u3002%u6211%u8BA4%u4E3A%u8FD9%u4E4B%u95F4%u53EF%u4EE5%u6709%u53D6%u820D%uFF0C%u6700%u4F73%u72B6%u6001%u5E94%u5F53%u662F%u6B64%u65F6%uFF0C%u5C06testA%u5220%u9664%uFF0C%u53EA%u4FDD%u7559testB%u3002%u4F46%u4ECD%u5E94%u6839%u636E%u5177%u4F53%u60C5%u51B5%u800C%u5B9A%u3002%0A%0A2.%20%u5982%u4F55%u9488%u5BF9%u4F9D%u8D56%u5173%u7CFB%u8FDB%u884Cmock%u5316%u3002%0A%u4F8B%u5982%u51FA%u73B0%u8FD9%u6837%u7684%u8BED%u53E5%3A%20%60B%20%3D%20new%20A%60%uFF0C%u5219%u7C7BB%u4F9D%u8D56%u4E8E%u7C7BA%u3002%u4F46%u7C7BA%u5E76%u6CA1%u6709%u5FC5%u8981%u7F16%u8BD1%u8FDBtest%u3002%u56E0%u4E3A%u4E00%u65E6%u52A0%u5165A%uFF0C%u5219%u52BF%u5FC5%u4F1A%u5F15%u5165%u66F4%u591A%u4F9D%u8D56%u5173%u7CFB%uFF0C%u800C%u5BFC%u81F4test%u7F16%u8BD1%u5D29%u6E83%u3002%u4F9D%u8D56%u5173%u7CFB%u7684%u89E3%u51B3%u65E0%u7A77%u65E0%u5C3D%u3002%u5728%u505AAndroid%u7684%u5355%u5143%u6D4B%u8BD5%u65F6%uFF0C%u53EF%u4EE5%u7528PowerMock%u53D6%u4EE3Mockito%u6765Mock%u6784%u9020%u51FD%u6570%uFF0C%u5C06%u6784%u9020%u51FD%u6570Fake%u5316%u6210%u7C7B%u4F3C%u5DE5%u5382%u51FD%u6570%uFF0C%u8FD4%u56DE%u7C7B%u5B9E%u4F8B%u3002%u5177%u4F53%u53C2%u770B%u8FD9%u7BC7%u535A%u6587%5BAndroid%u5355%u5143%u6D4B%u8BD5%5D%28https%3A//zhougy0717.github.io/2016/10/19/Android%25E5%258D%2595%25E5%2585%2583%25E6%25B5%258B%25E8%25AF%2595/%29%u3002%0A%u4F46%u5B9E%u9645%u4E0A%uFF0C%u6309%u7167%u73B0%u5728%u7684%u7406%u89E3%uFF0C%u5176%u5B9EMock%u6784%u9020%u51FD%u6570%u662F%u4E0D%u53EF%u53D6%u7684%uFF0C%u9996%u5148%u9020%u6210%u88AB%u6D4B%u4EE3%u7801spec%u4E0D%u6E05%u6670%uFF0C%u8BD5%u60F3%u4E00%u4E2A%u6784%u9020%u51FD%u6570%u600E%u4E48%u4F1A%u8FD4%u56DE%u53E6%u4E00%u4E2A%u7C7B%u7684%u5B9E%u4F8B%u3002%u5176%u6B21%uFF0C%u5728C++%u4E2D%u5F88%u96BE%u505A%u5230Mock%u6784%u9020%u51FD%u6570%u3002%u597D%u7684%u505A%u6CD5%u5E94%u5F53%u662F%u8FD0%u7528Dependency%20Injection%u3002%u4F8B%u5982%uFF1A%0A%60%60%60%0Aclass%20A%20%0A%7B%7D%0A%0Aclass%20B%0A%7B%0A%09void%20func%28%29%0A%09%7B%0A%09%09A*%20a%20%3D%20new%20A%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u7C7BB%u5E94%u5F53%u6539%u5199%u4E3A%uFF1A%0A%60%60%60%0Aclass%20B%0A%7B%0A%09void%20func%28A*%29%0A%09%7B%0A%09%09...%0A%09%7D%0A%7D%0A%60%60%60%0A%u5C06%u7C7BA%u6307%u9488%u4F20%u5165%uFF0C%u89E3%u51B3dependency%u7684%u95EE%u9898%u3002%0A%0A3.%20%u5982%u4F55%u80FD%u591F%u8BA9%u6D4B%u8BD5%u7A33%u5B9A%uFF0C%u5728%u4EFB%u610F%u73AF%u5883%u4E0B%u5747%u8FD4%u56DE%u540C%u6837%u7684%u6D4B%u8BD5%u7ED3%u679C%u3002%0A%u8FD9%u4E2A%u4E00%u822C%u6D89%u53CA%u6D4B%u8BD5%u73AF%u5883%u7684%u5F71%u54CD%u3002%u4F8B%u5982%u8C03%u7528%u7F51%u7EDC%u76F8%u5173%u7684%u529F%u80FD%uFF0C%u5728%u6CA1%u6709%u7F51%u7EDC%u7684%u73AF%u5883%u5C31%u6CA1%u6CD5%u8FDB%u884C%u3002%u518D%u4F8B%u5982%u6D4B%u8BD5%u65F6%u64CD%u4F5C%u771F%u5B9E%u5177%u4F53%u6587%u4EF6%uFF0C%u5219%u8BE5%u6587%u4EF6%u88AB%u6D4B%u8BD5%u5916%u4EBA%u4E3A%u6216%u4EE3%u7801%u4FEE%u6539%uFF0C%u5219%u6D4B%u8BD5%u53EF%u80FD%u5C31%u4F1A%u83AB%u540D%u5931%u8D25%u3002%0A%u9488%u5BF9%u8FD9%u4E9B%u60C5%u51B5%uFF0C%u6211%u4EEC%u5E94%u5F53%u5728%u6D4B%u8BD5%u4E2D%u5C3D%u91CF%u907F%u514D%u3002%u4F8B%u5982%u524D%u8005%uFF0C%u6211%u4EEC%u5E94%u5F53%u5BF9%u7F51%u7EDC%u63A5%u53E3%u8FDB%u884CMock%u5316%uFF0C%u540E%u8005%u5E94%u5F53%u5728%u6D4B%u8BD5%u7684setUp%u548CtearDown%u4E2D%u751F%u6210%u865A%u5047%u6587%u4EF6%u7528%u4E8E%u6D4B%u8BD5%uFF0C%u5E76%u5728%u6D4B%u8BD5%u5B8C%u6210%u65F6%u505A%u6E05%u7406%u3002%0A%0A4.%20%u4F1A%u56E0%u4E3A%u5F88%u5C0F%u7684%u88AB%u6D4B%u4EE3%u7801%u6539%u52A8%uFF0C%u800C%u5BFC%u81F4%u5927%u9762%u79EF%u6D4B%u8BD5%u5931%u8D25%uFF0C%u751A%u81F3%u6D4B%u8BD5%u5D29%u6E83%u3002%0A%u8FD9%u4E2A%u5C31%u662Fgmock%u6587%u6863%u4E2D%u63D0%u5230%u7684%u8981%u9488%u5BF9%u63A5%u53E3%u7F16%u7A0B%uFF0C%u9488%u5BF9%u63A5%u53E3%u6D4B%u8BD5%u3002Robert%20C%B7Martin%u5728%u300A%u654F%u6377%u8F6F%u4EF6%u5F00%u53D1%uFF0D%u539F%u5219%u3001%u6A21%u5F0F%u4E0E%u5B9E%u8DF5%u300B%u4E00%u4E66%u4E2D%u6709%u63D0%u51FA%uFF1A%u6240%u6709%u7684%u4EE3%u7801%u90FD%u5E94%u4F9D%u8D56%u4E8E%u62BD%u8C61%u63A5%u53E3%u3002%u56E0%u4E3A%u62BD%u8C61%u63A5%u53E3%u662F%u7ECF%u8FC7%u62BD%u8C61%u7684%uFF0C%u76F8%u5BF9%u5177%u4F53%u7684%u5B9E%u73B0%u4EE3%u7801%u8F83%u4E3A%u7A33%u5B9A%u3002%u800C%u88AB%u4F9D%u8D56%u7684%u4EE3%u7801%u5E94%u8BE5%u5C3D%u53EF%u80FD%u4FDD%u6301%u7A33%u5B9A%uFF0C%u8FD9%u6837%u57FA%u4E8E%u4E4B%u4E0A%u7684%u4EE3%u7801%u624D%u4E0D%u4F1A%u56E0%u4E3A%u4F9D%u8D56%u7684%u6539%u52A8%u800C%u6539%u52A8%u3002%0A%0A%u4E0B%u9762%u5217%u51FA%u51E0%u79CD%u6211%u5728%u5B9E%u9645%u5199test%20case%u65F6%u9047%u5230%u7684%u60C5%u51B5%uFF0C%u5728gmock%u4E2D%u7684%u89E3%u51B3%u65B9%u6848%u3002%0A%0A%23%23%23%20%u6309%u7167%u51FD%u6570%u53C2%u6570%u8FD4%u56DE%u7ED3%u679C%20-%20Fake%0A%u4F8B%u5982%3A%0A%60%60%60%0Aclass%20A%0A%7B%0A%09virtual%20int%20func%28int%20a%2C%20int%20b%29%3B%0A%7D%0A%0AEXPECT_CALL%28mockA%2C%20func%28%29%29%0A%09.WillRepeatedly%28a+b%29%3B%0A%60%60%60%0Agmock%u4E2D%u53EF%u4EE5%u8FD9%u6837%u505A%uFF1AUsing%20Functions/Methods/Functors%20as%20Actions%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AInvoke%3B%0Aclass%20MockFoo%20%3A%20public%20Foo%20%7B%0Apublic%3A%0A%09MOCK_METHOD2%28Sum%2C%20int%28int%20x%2C%20int%20y%29%29%3B%0A%09MOCK_METHOD1%28ComplexJob%2C%20bool%28int%20x%29%29%3B%0A%7D%3B%0Aint%20CalculateSum%28int%20x%2C%20int%20y%29%20%7B%20return%20x%20+%20y%3B%20%7D%0Aclass%20Helper%20%7B%0Apublic%3A%0A%09bool%20ComplexJob%28int%20x%29%3B%0A%7D%3B%0A...%0AMockFoo%20foo%3B%0AHelper%20helper%3B%0AEXPECT_CALL%28foo%2C%20Sum%28_%2C%20_%29%29%0A%09.WillOnce%28Invoke%28CalculateSum%29%29%3B%0AEXPECT_CALL%28foo%2C%20ComplexJob%28_%29%29%0A%09.WillOnce%28Invoke%28%26helper%2C%20%26Helper%3A%3AComplexJob%29%29%3B%0Afoo.Sum%285%2C%206%29%3B%20//%20Invokes%20CalculateSum%285%2C%206%29.%0Afoo.ComplexJob%2810%29%3B%20//%20Invokes%20helper.ComplexJob%2810%29%3B%0A%60%60%60%0A%0A%23%23%23%20Mock%20non-virtual%u51FD%u6570%0A%60%60%60%0A//%20A%20simple%20packet%20stream%20class.%20None%20of%20its%20members%20is%20virtual.%0Aclass%20ConcretePacketStream%20%7B%0A%09public%3A%0A%09%09void%20AppendPacket%28Packet*%20new_packet%29%3B%0A%09%09const%20Packet*%20GetPacket%28size_t%20packet_number%29%20const%3B%0A%09%09size_t%20NumberOfPackets%28%29%20const%3B%0A%09%09...%0A%7D%3B%0A//%20A%20mock%20packet%20stream%20class.%20It%20inherits%20from%20no%20other%2C%20but%20defines%0A//%20GetPacket%28%29%20and%20NumberOfPackets%28%29.%0Aclass%20MockPacketStream%20%7B%0A%09public%3A%0A%09%09MOCK_CONST_METHOD1%28GetPacket%2C%20const%20Packet*%28size_t%20packet_number%29%29%3B%0A%09%09MOCK_CONST_METHOD0%28NumberOfPackets%2C%20size_t%28%29%29%3B%0A%09%09...%0A%7D%0A%0Atemplate%20%3Cclass%20PacketStream%3E%0Avoid%20CreateConnection%28PacketStream*%20stream%29%20%7B%20...%20%7D%0Atemplate%20%3Cclass%20PacketStream%3E%0Aclass%20PacketReader%20%7B%0A%09public%3A%0A%09void%20ReadPackets%28PacketStream*%20stream%2C%20size_t%20packet_num%29%3B%0A%7D%3B%0A%0AMockPacketStream%20mock_stream%3B%0AEXPECT_CALL%28mock_stream%2C%20...%29...%3B%0A..%20set%20more%20expectations%20on%20mock_stream%20...%0APacketReader%3CMockPacketStream%3E%20reader%28%26mock_stream%29%3B%0A...%20exercise%20reader%20...%0A%60%60%60%0A%u4E3A%u4EC0%u4E48%u8981%u8FD9%u4E48%u505A%uFF1F%0A%u56E0%u4E3A%u53EA%u80FD%u8FD9%u4E48%u505A%u3002%u666E%u901A%u7684mock%uFF0C%u8981%u901A%u8FC7%u7EE7%u627F%u88AB%u6D4B%u8BD5%u7C7B%uFF0C%u5E76%u91CD%u5199virtual%u51FD%u6570%u6765%u5B9E%u73B0%u3002%u800C%u4E0A%u9762%u7684ConcretePacketStream%u548CMockPacketStream%u5E76%u4EFB%u4F55%u6CA1%u6709%u5173%u7CFB%uFF0C%u4E5F%u5C31%u662F%u8BF4%uFF0C%u5982%u679C%u4F20%u5165%u540E%u8005%u7684%u6307%u9488%uFF0C%u4E0D%u7528reinterpret_cast%u662F%u4E0D%u80FD%u8F6C%u6210%u524D%u8005%u7684%u6307%u9488%u7684%u3002%0A%u6240%u4EE5%u60F3%u4E00%u4E2A%u53D8%u901A%u7684%u529E%u6CD5%uFF0C%u7528%u6A21%u677F%u7C7B%u6765%u5B9A%u4E49%u88AB%u6D4B%u4EE3%u7801%uFF0C%u5728%u6D4B%u8BD5%u65F6%u4F20%u5165mock%u7C7B%uFF0C%u5728%u751F%u4EA7%u65F6%uFF0C%u4F20%u5165%u771F%u5B9E%u7C7B%u3002%0A%0A%23%23%23%20Mocking%20Side%20Effects%0A%60%60%60%0AEXPECT_CALL%28mutator%2C%20MutateInt%28_%29%29%0A%09.WillOnce%28DoAll%28SetArgPointee%3C0%3E%285%29%2C%20Return%28true%29%29%29%3B%0AEXPECT_CALL%28mutator%2C%20Mutate%28NotNull%28%29%2C%205%29%29%0A%09.WillOnce%28SetArrayArgument%3C0%3E%28values%2C%20values%20+%205%29%29%3B%0A%60%60%60%0A%u7B2C%u4E00%u4E2A%u5C06MutateInt%u7B2C%u4E00%u4E2A%u53C2%u6570%u6307%u9488%u6307%u5411%u7684int%uFF0C%u8BBE%u4E3A5%uFF0C%u5E76%u8FD4%u56DEtrue%u3002%0A%u7B2C%u4E8C%u4E2A%u5C06values%u6570%u7EC4%u7684%5B0%2C5%29%u62F7%u8D1D%u5230%u53C2%u65701%u6307%u5411%u7684%u5730%u5740%u3002%0A%u5982%u679C%u4ECD%u9700%u8981%u8FD4%u56DE%uFF0C%u5219%u7528DoAll%uFF0C%u5982%u4E0B%uFF1A%0A%60%60%60%0AEXPECT_CALL%28mutator%2C%20MutateInt%28_%29%29%0A%20%20%20%20%20%20.WillOnce%28DoAll%28SetArgPointee%3C0%3E%285%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Return%28true%29%29%29%3B%0A%60%60%60%0A%0A%23%23%23%20Selecting%20an%20Action%27s%20Arguments%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AInvoke%3B%0Abool%20MyIsVisibleInQuadrant1%28bool%20visible%2C%20const%20string%26%20name%2C%20int%20x%2C%20int%20y%2C%0Aconst%20map%3Cpair%3Cint%2C%20int%3E%2C%20double%3E%26%20weight%2C%0Adouble%20min_weight%2C%20double%20max_wight%29%20%7B%0A%09return%20IsVisibleInQuadrant1%28visible%2C%20x%2C%20y%29%3B%0A%7D.%0A..%0AEXPECT_CALL%28mock%2C%20Foo%28_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%29%29%0A%09.WillOnce%28Invoke%28MyIsVisibleInQuadrant1%29%29%3B%20//%20Now%20it%20works.%0A%60%60%60%0A%u5B9A%u4E49%u81EA%u5DF1%u7684adaptor%20MyIsVisibleInQuadrant1%uFF0C%u6216%u8005%u7528gmock%u63D0%u4F9B%u7684%u65B9%u6CD5%u4F18%u96C5%u7684%u89E3%u51B3%u3002%0A%60%60%60%0Ausing%20%3A%3Atesting%3A%3A_%3B%0Ausing%20%3A%3Atesting%3A%3AInvoke%3B%0Ausing%20%3A%3Atesting%3A%3AWithArgs%3B%0A...%0AEXPECT_CALL%28mock%2C%20Foo%28_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%2C%20_%29%29%0A.WillOnce%28WithArgs%3C0%2C%202%2C%203%3E%28Invoke%28IsVisibleInQuadrant1%29%29%29%3B%0A//%20No%20need%20to%20define%20your%20own%20adaptor.%0A%60%60%60%0A%0A%23%23%23%23%20Mocking%20Private%20or%20Protected%20Methods%0A%60%60%60%0Aclass%20Foo%20%7B%0A%09public%3A%0A%09%09...%0A%09%09virtual%20bool%20Transform%28Gadget*%20g%29%20%3D%200%3B%0A%09protected%3A%0A%09%09virtual%20void%20Resume%28%29%3B%0A%09private%3A%0A%09%09virtual%20int%20GetTimeOut%28%29%3B%0A%7D%3B%0Aclass%20MockFoo%20%3A%20public%20Foo%20%7B%0A%09public%3A%0A%09%09...%0A%09%09MOCK_METHOD1%28Transform%2C%20bool%28Gadget*%20g%29%29%3B%0A%09%09//%20The%20following%20must%20be%20in%20the%20public%20section%2C%20even%20though%20the%0A%09%09//%20methods%20are%20protected%20or%20private%20in%20the%20base%20class.%0A%09%09MOCK_METHOD0%28Resume%2C%20void%28%29%29%3B%0A%09%09MOCK_METHOD0%28GetTimeOut%2C%20int%28%29%29%3B%0A%7D%3B%0A%60%60%60%0A%3EC++%20allows%20a%20subclass%20to%20specify%20a%20different%20access%20level%20than%20the%20base%20class%20on%20a%20virtual%20function.%0A%0A%23%23%23%23%20Misc%0AKeep%20in%20mind%20that%20one%20doesn%27t%20have%20to%20verify%20more%20than%20one%20property%20in%20one%20test.%20In%20fact%2C%20it%27s%20a%20good%20style%20to%20verify%20only%20one%0Athing%20in%20one%20test.%20If%20you%20do%20that%2C%20a%20bug%20will%20likely%20break%20only%20one%20or%20two%20tests%20instead%20of%20dozens%0A%0AWhen%20it%27s%20being%20destroyed%2C%20your%20friendly%20mock%20object%20will%20automatically%20verify%20that%20all%20expectations%20on%20it%20have%20been%20satisfied%2C%0Aand%20will%20generate%20Google%20Test%20failures%20if%20not.%20%0A%0ACurrently%20these%20are%20only%20platforms%20that%20support%20the%20pthreads%20library%20%28this%20includes%20Linux%20and%20Mac%29.%20%0A%0A%u52A0%u4E0A%u547D%u4EE4%u884C%u53C2%u6570--gmock_verbose%3Dinfo%u53EF%u4EE5%u663E%u793A%u6240%u6709EXPECT%5C_CALL%u7684%u5177%u4F53%u8C03%u7528%u60C5%u51B5%u3002%0A%0A%23%23%20Some%20useful%20tips%20in%20gtest%0A%23%23%23%20Selecting%20Tests%0A%3E%20If%20you%20set%20the%20**GTEST_FILTER**%20environment%20variable%20or%20the%20**--gtest_filter**%20flag%20to%20a%20filter%20string%2C%20Google%20Test%20will%20only%20run%20the%20tests%20whose%20full%20names%20%28in%20the%20form%20of%20TestCaseName.TestName%29%20match%20the%20filter.%0A%3E%20The%20format%20of%20a%20filter%20is%20a%20%27%3A%27-separated%20list%20of%20wildcard%20patterns%20%28called%20the%20positive%20patterns%29%20optionally%20followed%20by%20a%20%27-%27%20and%20another%20%27%3A%27-separated%20pattern%20list%20%28called%20the%20negative%20patterns%29.%0A%0A-%20./foo_test%20Has%20no%20flag%2C%20and%20thus%20runs%20all%20its%20tests.%0A-%20./foo_test%20--gtest_filter%3D*%20Also%20runs%20everything%2C%20due%20to%20the%20single%20match-everything%20*%20value.%0A-%20./foo_test%20--gtest_filter%3DFooTest.*%20Runs%20everything%20in%20test%20case%20FooTest.%0A-%20./foo_test%20--gtest_filter%3D*Null*%3A*Constructor*%20Runs%20any%20test%20whose%20full%20name%20contains%20either%20%22Null%22%20or%20%22Constructor%22.%0A-%20./foo_test%20--gtest_filter%3D-*DeathTest.*%20Runs%20all%20non-death%20tests.%0A-%20./foo_test%20--gtest_filter%3DFooTest.*-FooTest.Bar%20Runs%20everything%20in%20test%20case%20FooTest%20except%20FooTest.Bar%0A%0ATemporarily%20Disabling%20Tests%0A%60%60%60%0A//%20Tests%20that%20Foo%20does%20Abc.%0ATEST%28FooTest%2C%20DISABLED_DoesAbc%29%20%7B%20...%20%7D%0A%0Aclass%20DISABLED_BarTest%20%3A%20public%20%3A%3Atesting%3A%3ATest%20%7B%20...%20%7D%3B%0A%0A//%20Tests%20that%20Bar%20does%20Xyz.%0ATEST_F%28DISABLED_BarTest%2C%20DoesXyz%29%20%7B%20...%20%7D%0A%60%60%60%0A%0ATemporarily%20Enabling%20Disabled%20Tests%0A%3Ejust%20invoke%20the%20test%20program%20with%20the%20**--gtest_also_run_disabled_tests**%20flag%20or%20set%20the%20**GTEST_ALSO_RUN_DISABLED_TESTS**%20environment%20variable%20to%20a%20value%20other%20than%200.%0A%0A%23%23%23%20Repeating%20the%20Tests%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20%3A--------%3A%20%7C%20%3A--------------%3A%20%7C%20%3A--------%3A%20%7C%0A%7C%5C%24%20foo_test%20--gtest_repeat%3D1000%20%7C%09Repeat%20foo_test%201000%20times%20and%20don%27t%20stop%20at%20failures.%7C%0A%7C%5C%24%20foo_test%20--gtest_repeat%3D-1%09%7CA%20negative%20count%20means%20repeating%20forever.%7C%0A%7C%5C%24%20foo_test%20--gtest_repeat%3D1000%20--gtest_break_on_failure%09%7C%20Repeat%20foo_test%201000%20times%2C%20stopping%20at%20the%20first%20failure.%20This%20is%20especially%20useful%20when%20running%20under%20a%20debugger%3A%20when%20the%20testfails%2C%20it%20will%20drop%20into%20the%20debugger%20and%20you%20can%20then%20inspect%20variables%20and%20stacks.%7C%0A%7C%24%20foo_test%20--gtest_repeat%3D1000%20--gtest_filter%3DFooBar%09%7C%20Repeat%20the%20tests%20whose%20name%20matches%20the%20filter%201000%20times.%7C]]></content>
      <tags>
        <tag>TDD</tag>
        <tag>gtest</tag>
        <tag>gmock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Angular JS - Dependency Injection]]></title>
    <url>%2F2017%2F08%2F25%2FAngular_JS_-_Dependency_Injection%2F</url>
    <content type="text"><![CDATA[Edit angular.module(&apos;MyApp&apos;, []) .controller(&apos;MyController&apos;, MyController) MyController.$inject = [&apos;$scope&apos;] function MyController($scope) { $scope.check = function(){} }MyController&#x662F;controller&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x901A;&#x8FC7;$inject&#x6210;&#x5458;&#x6307;&#x5B9A;&#x9700;&#x8981;inject&#x7684;&#x90E8;&#x5206;(&#x7C7B;&#x6BD4;&#x4E8E;&#x4E0A;&#x56FE;&#x7684;cardProc)&#x3002;Angular&#x5728;&#x8C03;&#x7528;&#x6784;&#x9020;&#x51FD;&#x6570;&#x521B;&#x5EFA;controller&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x628A;&#x9884;&#x5148;&#x4E3A;&#x8FD9;&#x4E00;&#x5757;HTML&#x521B;&#x5EFA;&#x7684;$scope&#x4F20;&#x5165;&#x8BE5;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;%23%20Angular%20JS%20-%20Dependency%20Injection%0A@%28myblog%29%5Bangular%2C%20javascript%5D%0A%0A%0A%21%5BAlt%20text%7C600x0%5D%28./1503652625713.png%29%0A%21%5BAlt%20text%7C600x0%5D%28./1503652641792.png%29%0A%60%60%60%0A%20%20angular.module%28%27MyApp%27%2C%20%5B%5D%29%0A%20%20%20%20.controller%28%27MyController%27%2C%20MyController%29%0A%0A%20%20MyController.%24inject%20%3D%20%5B%27%24scope%27%5D%0A%20%20function%20MyController%28%24scope%29%20%7B%0A%20%20%20%20%24scope.check%20%3D%20function%28%29%7B%7D%0A%20%20%7D%0A%60%60%60%0AMyController%u662Fcontroller%u7684%u6784%u9020%u51FD%u6570%uFF0C%u901A%u8FC7%5C%24inject%u6210%u5458%u6307%u5B9A%u9700%u8981inject%u7684%u90E8%u5206%28%u7C7B%u6BD4%u4E8E%u4E0A%u56FE%u7684cardProc%29%u3002Angular%u5728%u8C03%u7528%u6784%u9020%u51FD%u6570%u521B%u5EFAcontroller%u7684%u65F6%u5019%uFF0C%u4F1A%u628A%u9884%u5148%u4E3A%u8FD9%u4E00%u5757HTML%u521B%u5EFA%u7684%5C%24scope%u4F20%u5165%u8BE5%u6784%u9020%u51FD%u6570%u3002]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Angular JS - $scope]]></title>
    <url>%2F2017%2F08%2F25%2FAngular_JS_-_%24scope%2F</url>
    <content type="text"><![CDATA[Edit$scopeScope is an object that refers to the application model. It is an execution context for expressions. Scopes are arranged in hierarchical structure which mimic the DOM structure of the application. Scopes can watch expressions and propagate events.&#x7B80;&#x5355;&#x8BF4;$scope&#x7528;&#x6765;&#x505A;interpolation&#x3002;angular.module(&apos;scopeExample&apos;, []).controller(&apos;MyController&apos;, [&apos;$scope&apos;, function($scope) { $scope.username = &apos;World&apos;; $scope.sayHello = function() { $scope.greeting = &apos;Hello &apos; + $scope.username + &apos;!&apos;; };}]);When AngularJS evaluates &#123;&#123;name&#125;&#125;, it first looks at the scope associated with the given element for the name property. If no such property is found, it searches the parent scope and so on until the root scope is reached. In JavaScript this behavior is known as prototypical inheritance, and child scopes prototypically inherit from their parents.&#x8FD9;&#x91CC;&#x5F88;&#x91CD;&#x8981;&#x3002;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;code&lt;ul&gt; &lt;li ng-repeat=&quot;item in $ctrl.items&quot; ui-sref=&quot;itemList.itemDetail({itemId: $index})&quot;&gt; &#123;&#123; item.name }} &lt;ui-view&gt;&lt;/ui-view&gt; &lt;/li&gt;&lt;/ul&gt;&#x76F8;&#x5E94;&#x7684;ui-view&#x7528;&#x4E0B;&#x9762;&#x7684;&#x6A21;&#x677F;&#x3002;&#x867D;&#x7136;&#x5728;&#x8BE5;ui-view&#x7684;scope&#x91CC;&#x6CA1;&#x6709;item&#xFF0C;&#x4F46;&#x662F;&#x6309;&#x7740;&#x539F;&#x578B;&#x94FE;&#x5F80;&#x4E0A;&#x5BFB;&#x627E;&#xFF0C;&#x4F1A;&#x5728;&#x4E0A;&#x4E00;&#x7EA7;&#x7684;template&#x4E2D;&#x627E;&#x5230;&#x8BE5;&#x5C5E;&#x6027;&#x3002;&lt;ul ng-if=&quot;itemDetail.id == item.id&quot;&gt; &lt;li&gt;Price: &#123;&#123; item.price_large | currency &#125;&#125;&lt;/li&gt; &lt;li&gt;Description: &#123;&#123; item.description &#125;&#125;&lt;/li&gt;&lt;/ul&gt;MoreScope HierarchiesWhere does Scope come from?Each AngularJS application has exactly one root scope, but may have any number of child scopes. The location where the root scope is attached to the DOM is defined by the location of ng-app directive.ng-controller and ng-repeat, create new child scopes and attach the child scope to the corresponding DOM element. Component directives, which are created with the .component() helper always create an isolate scope.Retrieving Scopes from the DOM.To examine the scope in the debugger:Right click on the element of interest in your browser and select &#x2018;inspect element&#x2019;. You should see the browser debugger with the element you clicked on highlighted.The debugger allows you to access the currently selected element in the console as $0 variable.To retrieve the associated scope in console execute: angular.element($0).scope()The scope() function is only available when $compileProvider.debugInfoEnabled() is true (which is the default).$scope and controllerIn AngularJS, a Controller is defined by a JavaScript constructor function that is used to augment the AngularJS Scope.Use controllers to:Set up the initial state of the $scope object.Add behavior to the $scope object.&#x53EF;&#x89C1;controller&#x5C31;&#x662F;&#x88AB;&#x8BBE;&#x8BA1;&#x7528;&#x6765;&#x64CD;&#x4F5C;scope&#x7684;&#xFF0C;Scopes and controllers interact with each other in the following situations:Controllers use scopes to expose controller methods to templates (see ng-controller).Controllers define methods (behavior) that can mutate the model (properties on the scope).Controllers may register watches on the model. These watches execute immediately after the controller behavior executes.controller&#x901A;&#x8FC7;inject&#x6765;&#x5F97;&#x5230;AngularJS&#x4E3A;&#x5176;&#x521B;&#x5EFA;&#x7684;Scope&#x5B9E;&#x4F8B;&#x3002;angular.module(&apos;scopeExample&apos;, []).controller(&apos;MyController&apos;, MyController)MyController.$inject = [&apos;$scope&apos;]function MyController($scope) { $scope.username = &apos;World&apos;;}$digestHow to setup watchers?$scope.$watch &#x2013; don&#x2019;t do this in a controller &lt;==&#x56E0;&#x4E3A;Angular&#x5DF2;&#x7ECF;&#x5E2E;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x597D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x9014;&#x5F84;&#x5C31;&#x662F;&#x81EA;&#x52A8;&#x7684;watcher&#123;&#123; someProp &#125;&#125;&#x202F;&lt;input &#x2026; ng-model=&#x201D;someProp&#x201D;&gt;&#x53EF;&#x4EE5;&#x7528;$scope.$$watcherCount, $scope.$$atchers&#x4E24;&#x4E2A;&#x5185;&#x90E8;&#x53D8;&#x91CF;&#x770B;&#x5230;&#x8BE5;$scope&#x7684;watchers&#x7684;&#x72B6;&#x6001;$digest vs. $applyDigest Cycle does not get triggered automatically if events are unaware of Angular Solution: &#x2022;&#x202F; Call $digest after your custom code &#x2022;&#x202F; Wrap your custom code inside of $apply &#x2022;&#x202F; Find Angular specific service that handles the same functionality, e.g., $timeout&#x9488;&#x5BF9;&#x8FD9;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x7ED9;&#x51FA;&#x4E0B;&#x9762;&#x7684;sample code$scope.upCounter = function () { setTimeout(function () { $scope.counter++; console.log(&quot;Counter incremented!&quot;); $scope.$digest(); }, 2000);};$scope.upCounter = function () { setTimeout(function () { $scope.$apply(function(){ $scope.counter++; console.log(&quot;Counter incremented!&quot;); }) }, 2000);};$scope.upCounter = function () { $timeout(function () { $scope.counter++; console.log(&quot;Counter incremented!&quot;); }, 2000);};2-way, 1-way, and 1-time binding%23%20Angular%20JS%20-%20%24scope%0A@%28myblog%29%5Bangular%2C%20javascript%5D%0A%0A%0A%23%23%20%24scope%0A%3EScope%20is%20an%20object%20that%20refers%20to%20the%20application%20model.%20It%20is%20an%20execution%20context%20for%20expressions.%20Scopes%20are%20arranged%20in%20hierarchical%20structure%20which%20mimic%20the%20DOM%20structure%20of%20the%20application.%20Scopes%20can%20watch%20expressions%20and%20propagate%20events.%0A%0A%u7B80%u5355%u8BF4%24scope%u7528%u6765%u505Ainterpolation%u3002%0A%0A%60%60%60%0Aangular.module%28%27scopeExample%27%2C%20%5B%5D%29%0A.controller%28%27MyController%27%2C%20%5B%27%24scope%27%2C%20function%28%24scope%29%20%7B%0A%20%20%24scope.username%20%3D%20%27World%27%3B%0A%0A%20%20%24scope.sayHello%20%3D%20function%28%29%20%7B%0A%20%20%20%20%24scope.greeting%20%3D%20%27Hello%20%27%20+%20%24scope.username%20+%20%27%21%27%3B%0A%20%20%7D%3B%0A%7D%5D%29%3B%0A%60%60%60%0A%3EWhen%20AngularJS%20evaluates%20%7B%7Bname%7D%7D%2C%20it%20first%20looks%20at%20the%20scope%20associated%20with%20the%20given%20element%20for%20the%20name%20property.%20**If%20no%20such%20property%20is%20found%2C%20it%20searches%20the%20parent%20scope%20and%20so%20on%20until%20the%20root%20scope%20is%20reached.**%20In%20JavaScript%20this%20behavior%20is%20known%20as%20prototypical%20inheritance%2C%20and%20child%20scopes%20prototypically%20inherit%20from%20their%20parents.%0A%0A%u8FD9%u91CC%u5F88%u91CD%u8981%u3002%u6BD4%u5982%u4E0B%u9762%u7684code%0A%60%60%60%0A%3Cul%3E%0A%20%20%20%20%3Cli%20ng-repeat%3D%22item%20in%20%24ctrl.items%22%0A%20%20%20%20%20%20%20%20ui-sref%3D%22itemList.itemDetail%28%7BitemId%3A%20%24index%7D%29%22%3E%0A%20%20%20%20%20%20%20%20%7B%7B%20item.name%20%7D%7D%0A%20%20%20%20%20%20%20%20%3Cui-view%3E%3C/ui-view%3E%0A%20%20%20%20%3C/li%3E%0A%3C/ul%3E%0A%60%60%60%0A%u76F8%u5E94%u7684ui-view%u7528%u4E0B%u9762%u7684%u6A21%u677F%u3002%u867D%u7136%u5728%u8BE5ui-view%u7684scope%u91CC%u6CA1%u6709item%uFF0C%u4F46%u662F%u6309%u7740%u539F%u578B%u94FE%u5F80%u4E0A%u5BFB%u627E%uFF0C%u4F1A%u5728%u4E0A%u4E00%u7EA7%u7684template%u4E2D%u627E%u5230%u8BE5%u5C5E%u6027%u3002%0A%60%60%60%0A%3Cul%20ng-if%3D%22itemDetail.id%20%3D%3D%20item.id%22%3E%0A%20%20%20%20%3Cli%3EPrice%3A%20%7B%7B%20item.price_large%20%7C%20%20currency%20%7D%7D%3C/li%3E%0A%20%20%20%20%3Cli%3EDescription%3A%20%7B%7B%20item.description%20%7D%7D%3C/li%3E%0A%3C/ul%3E%0A%60%60%60%0A%0A%23%23%23%20More%0A%23%23%23%23%20Scope%20Hierarchies%0A**Where%20does%20Scope%20come%20from%3F**%0A-%20Each%20AngularJS%20application%20has%20exactly%20one%20root%20scope%2C%20but%20may%20have%20any%20number%20of%20child%20scopes.%20The%20location%20where%20the%20root%20scope%20is%20attached%20to%20the%20DOM%20is%20defined%20by%20the%20location%20of%20ng-app%20directive.%0A-%20ng-controller%20and%20ng-repeat%2C%20create%20new%20child%20scopes%20and%20attach%20the%20child%20scope%20to%20the%20corresponding%20DOM%20element.%20%0A-%20Component%20directives%2C%20which%20are%20created%20with%20the%20.component%28%29%20helper%20always%20create%20an%20isolate%20scope.%0A%0A%23%23%23%23%20Retrieving%20Scopes%20from%20the%20DOM.%0A%3E%20To%20examine%20the%20scope%20in%20the%20debugger%3A%0A-%20Right%20click%20on%20the%20element%20of%20interest%20in%20your%20browser%20and%20select%20%27inspect%20element%27.%20You%20should%20see%20the%20browser%20debugger%20with%20the%20element%20you%20clicked%20on%20highlighted.%0A-%20The%20debugger%20allows%20you%20to%20access%20the%20currently%20selected%20element%20in%20the%20console%20as%20%240%20variable.%0A-%20To%20retrieve%20the%20associated%20scope%20in%20console%20execute%3A%20angular.element%28%240%29.scope%28%29%0A%0A*The%20scope%28%29%20function%20is%20only%20available%20when%20%24compileProvider.debugInfoEnabled%28%29%20is%20true%20%28which%20is%20the%20default%29.*%0A%0A%23%23%23%23%20%24scope%20and%20controller%0A%3EIn%20AngularJS%2C%20a%20Controller%20is%20defined%20by%20a%20JavaScript%20constructor%20function%20that%20is%20used%20to%20augment%20the%20AngularJS%20Scope.%0A%3E%0A%3EUse%20controllers%20to%3A%0A%3E-%20Set%20up%20the%20initial%20state%20of%20the%20%24scope%20object.%0A%3E-%20Add%20behavior%20to%20the%20%24scope%20object.%0A%0A%u53EF%u89C1controller%u5C31%u662F%u88AB%u8BBE%u8BA1%u7528%u6765%u64CD%u4F5Cscope%u7684%uFF0C%0A%0A%3EScopes%20and%20controllers%20interact%20with%20each%20other%20in%20the%20following%20situations%3A%0A-%20Controllers%20use%20scopes%20to%20expose%20controller%20methods%20to%20templates%20%28see%20ng-controller%29.%0A-%20Controllers%20define%20methods%20%28behavior%29%20that%20can%20mutate%20the%20model%20%28properties%20on%20the%20scope%29.%0A-%20Controllers%20may%20register%20watches%20on%20the%20model.%20These%20watches%20execute%20immediately%20after%20the%20controller%20behavior%20executes.%0A%0Acontroller%u901A%u8FC7inject%u6765%u5F97%u5230AngularJS%u4E3A%u5176%u521B%u5EFA%u7684Scope%u5B9E%u4F8B%u3002%0A%60%60%60%0Aangular.module%28%27scopeExample%27%2C%20%5B%5D%29%0A.controller%28%27MyController%27%2C%20MyController%29%0AMyController.%24inject%20%3D%20%5B%27%24scope%27%5D%0Afunction%20MyController%28%24scope%29%20%7B%0A%20%20%24scope.username%20%3D%20%27World%27%3B%0A%7D%0A%60%60%60%0A%0A%23%23%20%24digest%0A%21%5BAlt%20text%5D%28./1503646988756.png%29%0A%u4E0A%u56FE%u7684%u610F%u601D%u662F%uFF0C%u5982%u679C%u7528JavaScript%u6807%u51C6%u7684onclick%u6765%u6807%u660Ebutton%20handler%uFF0C%u5219Angular%u5E76%u4E0D%u4F1A%u6FC0%u6D3Bdigest%20loop%u3002%u4F46%u662F%u5982%u679C%u7528%u4E86ng-click%2C%20ng-keyup%u6216%u8005%u662Fng-model%u6765%u7ED1%u5B9A%u6570%u636E%uFF0C%u5219%u4F1A%u5728%u53D1%u751F%u76F8%u5E94%u7684%u4E8B%u4EF6%u65F6%uFF0C%u6FC0%u53D1digest%20loop%u3002digest%20loop%u4F1A%u68C0%u6D4B%u6240%u6709%u7684watcher%u6709%u6CA1%u6709%u53D8%u5316%uFF0C%u5982%u679C%u6709%u53D8%u5316%u5219%u4F1A%u505A%u76F8%u5E94%u7684%u66F4%u65B0%28%u4F8B%u5982%uFF1A%u66F4%u65B0HTML%u4E2D%u7684%7B%7B...%7D%7D%uFF0C%u6216%u8005%u66F4%u65B0controller%u4E2D%u7684%u53D8%u91CF%28ng-model%29%29%u3002%0A%0A%23%23%23%20How%20to%20setup%20watchers%3F%0A%3E*%20%5C%24scope.%5C%24watch%20%u2013%20don%u2019t%20do%20this%20in%20a%20controller%20%3C%3D%3D%u56E0%u4E3AAngular%u5DF2%u7ECF%u5E2E%u6211%u4EEC%u8BBE%u8BA1%u597D%u4E86%uFF0C%u4E0B%u9762%u4E24%u4E2A%u9014%u5F84%u5C31%u662F%u81EA%u52A8%u7684watcher%0A%3E*%20%7B%7B%20someProp%20%7D%7D%0A%3E*%20%u202F%26lt%3Binput%20%u2026%20ng-model%3D%22someProp%22%3E%0A%0A%u53EF%u4EE5%u7528%5C%24scope.%5C%24%5C%24watcherCount%2C%20%5C%24scope.%5C%24%5C%24atchers%u4E24%u4E2A%u5185%u90E8%u53D8%u91CF%u770B%u5230%u8BE5%24scope%u7684watchers%u7684%u72B6%u6001%0A%0A%23%23%23%20%5C%24digest%20vs.%20%5C%24apply%0A%3EDigest%20Cycle%20does%20not%20get%20triggered%20automatically%20if%20events%20are%20unaware%20of%20Angular%0ASolution%3A%0A%u2022%u202F%20Call%20%5C%24digest%20after%20your%20custom%20code%0A%u2022%u202F%20Wrap%20your%20custom%20code%20inside%20of%20%5C%24apply%0A%u2022%u202F%20Find%20Angular%20specific%20service%20that%20handles%20the%20same%20functionality%2C%20e.g.%2C%20%24timeout%0A%0A%u9488%u5BF9%u8FD9%u4E09%u79CD%u60C5%u51B5%uFF0C%u7ED9%u51FA%u4E0B%u9762%u7684sample%20code%0A%60%60%60%0A%24scope.upCounter%20%3D%20function%20%28%29%20%7B%0A%20%20setTimeout%28function%20%28%29%20%7B%0A%20%20%20%20%24scope.counter++%3B%0A%20%20%20%20console.log%28%22Counter%20incremented%21%22%29%3B%0A%20%20%20%20%24scope.%24digest%28%29%3B%0A%20%20%7D%2C%202000%29%3B%0A%7D%3B%0A%60%60%60%0A%0A%60%60%60%0A%24scope.upCounter%20%3D%20function%20%28%29%20%7B%0A%20%20setTimeout%28function%20%28%29%20%7B%0A%20%20%20%20%24scope.%24apply%28function%28%29%7B%0A%20%20%20%20%20%20%24scope.counter++%3B%0A%20%20%20%20%20%20console.log%28%22Counter%20incremented%21%22%29%3B%0A%20%20%20%20%7D%29%0A%20%20%7D%2C%202000%29%3B%0A%7D%3B%0A%60%60%60%0A%0A%60%60%60%0A%24scope.upCounter%20%3D%20function%20%28%29%20%7B%0A%20%20%24timeout%28function%20%28%29%20%7B%0A%20%20%20%20%24scope.counter++%3B%0A%20%20%20%20console.log%28%22Counter%20incremented%21%22%29%3B%0A%20%20%7D%2C%202000%29%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%202-way%2C%201-way%2C%20and%201-time%20binding%0A%21%5BAlt%20text%7C700x0%5D%28./1503653325764.png%29%0A]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Angular JS - controller as]]></title>
    <url>%2F2017%2F08%2F24%2FAngular_JS_-_controller_as%2F</url>
    <content type="text"><![CDATA[EditIf the controller has been attached using the controller as syntax then the controller instance will be assigned to a property on the new scope.&#x9996;&#x5148;&#xFF0C;$scope&#x662F;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#xFF0C;&#x5F53;&#x58F0;&#x660E;&#x4E86;ng-controller&#x4EE5;&#x540E;&#xFF0C;Angular&#x4F1A;&#x4ECE;&#x4E0A;&#x4E00;&#x7EA7;controller&#x7684;$scope&#x6216;$rootScope&#x6784;&#x9020;&#x51FA;&#x65B0;&#x7684;$scope&#x3002; &#x5176;&#x6B21;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;controller as&#x8BED;&#x6CD5;&#x65F6;&#xFF0C;Angular&#x4F1A;&#x6784;&#x9020;&#x65B0;&#x7684;controller&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x8D4B;&#x4E88;&#x65B0;&#x7684;$scope&#x3002;&#x53C2;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;&#x6B64;&#x65F6;&#x539F;&#x5148;&#x7684;controller&#x6784;&#x9020;&#x51FD;&#x6570;&#x5DF2;&#x7ECF;&#x4E0D;&#x80FD;&#x518D;&#x7528;&#x4E8E;HTML&#x91CC;&#x4E86;&#x3002;%23%20Angular%20JS%20-%20controller%20as%0A@%28myblog%29%5Bangular%2C%20javascript%5D%0A%0A%3EIf%20the%20controller%20has%20been%20attached%20using%20the%20controller%20as%20syntax%20then%20the%20controller%20instance%20will%20be%20assigned%20to%20a%20property%20on%20the%20new%20scope.%0A%0A%u9996%u5148%uFF0C%5C%24scope%u662F%u7EE7%u627F%u5173%u7CFB%uFF0C%u5F53%u58F0%u660E%u4E86ng-controller%u4EE5%u540E%uFF0CAngular%u4F1A%u4ECE%u4E0A%u4E00%u7EA7controller%u7684%5C%24scope%u6216%5C%24rootScope%u6784%u9020%u51FA%u65B0%u7684%5C%24scope%u3002%0A%u5176%u6B21%uFF0C%u5F53%u4F7F%u7528controller%20as%u8BED%u6CD5%u65F6%uFF0CAngular%u4F1A%u6784%u9020%u65B0%u7684controller%u5B9E%u4F8B%uFF0C%u5E76%u8D4B%u4E88%u65B0%u7684%5C%24scope%u3002%u53C2%u770B%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1503651999428.png%29%21%5BAlt%20text%7C440x0%5D%28./1503652028318.png%29%0A%0A%u6B64%u65F6%u539F%u5148%u7684controller%u6784%u9020%u51FD%u6570%u5DF2%u7ECF%u4E0D%u80FD%u518D%u7528%u4E8EHTML%u91CC%u4E86%u3002]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Angular JS - Directive]]></title>
    <url>%2F2017%2F08%2F24%2FAngular_JS_-_Directive%2F</url>
    <content type="text"><![CDATA[Edit3 bindings2-way binding &#x201C;=&#x201D;function MyDirective() { var ddo = { scope: { myProp: &apos;=attributeName&apos; } ... }; return ddo;}&lt;!-- index.html --&gt;&lt;my-directive attribute-name=&quot;outerProp&quot;&gt;&lt;/my-directive&gt;&lt;!-- directive.html --&gt;&lt;p&gt;NaN&lt;/p&gt;&#x6240;&#x6709;&#x5BF9;attribute-name&#x6216;&#x8005;my-prop&#x7684;&#x6539;&#x52A8;&#xFF0C;&#x4E24;&#x4E2A;html&#x91CC;&#x90FD;&#x4F1A;&#x505A;&#x540C;&#x6B65;&#x4FEE;&#x6539;1-way binding &#x201C;&lt;&#x201D; and &#x201C;@&#x201D;function MyDirective() { var ddo = { scope: { prop: &apos;&lt;&apos;, }, ... }; return ddo;}&#x4E0E;&#x4E0A;&#x9762;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x6709;index.html&#x624D;&#x80FD;&#x4FEE;&#x6539;prop&#x3002;function MyDirective() { var ddo = { scope: { prop: &apos;@&apos;, }, ... }; return ddo;}&#x8FD9;&#x91CC;prop&#x5C31;&#x53EA;&#x80FD;&#x7ED1;&#x5B9A;index.html&#x91CC;&#x7684;&#x5C5E;&#x6027;&#x53D8;&#x91CF;&#xFF0C;&#x5982;&#x4E0B;&lt;my-directive my-attribute=&quot;&quot;&gt;&lt;/my-directive&gt;&#x53EF;&#x89C1;my-attribute&#x91CC;&#x9762;&#x4E0D;&#x80FD;&#x6709;&#x53D8;&#x91CF;&#xFF08;&#x4F8B;&#x5982;controller&#x6216;&#x8005;controller&#x7684;&#x6210;&#x5458;&#xFF09;&#x3002;&#x800C;&#x4E14;&#x548C;&#x2019;&lt;&#x2019;&#x7C7B;&#x4F3C;&#xFF0C;&#x2019;@&#x2019;&#x4E5F;&#x662F;&#x5355;&#x5411;&#x7684;&#x3002;%23Angular%20JS%20-%20Directive%0A@%28myblog%29%5Bangular%2Cjavascript%5D%0A%0A%23%23%203%20bindings%0A%23%23%23%202-way%20binding%20%22%3D%22%0A%60%60%60%0Afunction%20MyDirective%28%29%20%7B%0A%20%20var%20ddo%20%3D%20%7B%0A%20%20scope%3A%20%7B%0A%20%20%20%20myProp%3A%20%27%3DattributeName%27%0A%20%20%7D%0A%20%20...%0A%20%20%7D%3B%0A%20%20return%20ddo%3B%0A%7D%0A%60%60%60%0A%60%60%60%0A%3C%21--%20index.html%20--%3E%0A%3Cmy-directive%20attribute-name%3D%22outerProp%22%3E%0A%3C/my-directive%3E%0A%0A%3C%21--%20directive.html%20--%3E%0A%3Cp%3E%7B%7Bmy-prop%7D%7D%3C/p%3E%0A%60%60%60%0A%u6240%u6709%u5BF9attribute-name%u6216%u8005my-prop%u7684%u6539%u52A8%uFF0C%u4E24%u4E2Ahtml%u91CC%u90FD%u4F1A%u505A%u540C%u6B65%u4FEE%u6539%0A%23%23%23%201-way%20binding%20%22%3C%22%20and%20%22@%22%0A%60%60%60%0Afunction%20MyDirective%28%29%20%7B%0A%20%20var%20ddo%20%3D%20%7B%0A%20%20scope%3A%20%7B%0A%20%20%20%20prop%3A%20%27%3C%27%2C%0A%20%20%7D%2C%0A%20%20...%0A%20%20%7D%3B%0A%20%20return%20ddo%3B%0A%7D%0A%60%60%60%0A%u4E0E%u4E0A%u9762%u4E0D%u540C%uFF0C%u8FD9%u91CC%u53EA%u6709index.html%u624D%u80FD%u4FEE%u6539prop%u3002%0A%60%60%60%0Afunction%20MyDirective%28%29%20%7B%0A%20%20var%20ddo%20%3D%20%7B%0A%20%20scope%3A%20%7B%0A%20%20%20%20prop%3A%20%27@%27%2C%0A%20%20%7D%2C%0A%20%20...%0A%20%20%7D%3B%0A%20%20return%20ddo%3B%0A%7D%0A%60%60%60%0A%u8FD9%u91CCprop%u5C31%u53EA%u80FD%u7ED1%u5B9Aindex.html%u91CC%u7684%u5C5E%u6027%u53D8%u91CF%uFF0C%u5982%u4E0B%0A%60%60%60%0A%3Cmy-directive%20my-attribute%3D%22%7B%7BouterProp%7D%7D%22%3E%0A%3C/my-directive%3E%0A%60%60%60%0A%u53EF%u89C1my-attribute%u91CC%u9762%u4E0D%u80FD%u6709%u53D8%u91CF%uFF08%u4F8B%u5982controller%u6216%u8005controller%u7684%u6210%u5458%uFF09%u3002%u800C%u4E14%u548C%27%3C%27%u7C7B%u4F3C%uFF0C%27@%27%u4E5F%u662F%u5355%u5411%u7684%u3002]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Angular JS - Modularize]]></title>
    <url>%2F2017%2F08%2F24%2FAngular_JS_-_Modularize%2F</url>
    <content type="text"><![CDATA[EditAngular JS&#x6A21;&#x5757;&#x5316;&#xFF0C;&#x4E3B;&#x8981;&#x501F;&#x52A9;&#x4E8E;3&#x4E2A;&#x65B9;&#x5F0F;&#xFF1A;directive, component, moduledirective &amp; 3 bindings2-way binding &#x201C;=&#x201D;function MyDirective() { var ddo = { scope: { myProp: &apos;=attributeName&apos; } ... }; return ddo;}&lt;!-- index.html --&gt;&lt;my-directive attribute-name=&quot;outerProp&quot;&gt;&lt;/my-directive&gt;&lt;!-- directive.html --&gt;&lt;p&gt;&#123;&#123;my-prop&#125;&#125;&lt;/p&gt;&#x6240;&#x6709;&#x5BF9;attribute-name&#x6216;&#x8005;my-prop&#x7684;&#x6539;&#x52A8;&#xFF0C;&#x4E24;&#x4E2A;html&#x91CC;&#x90FD;&#x4F1A;&#x505A;&#x540C;&#x6B65;&#x4FEE;&#x6539;1-way binding &#x201C;&lt;&#x201D; and &#x201C;@&#x201D;function MyDirective() { var ddo = { scope: { prop: &apos;&lt;&apos;, }, ... }; return ddo;}&#x4E0E;&#x4E0A;&#x9762;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x6709;index.html&#x624D;&#x80FD;&#x4FEE;&#x6539;prop&#x3002;function MyDirective() { var ddo = { scope: { prop: &apos;@&apos;, }, ... }; return ddo;}&#x8FD9;&#x91CC;prop&#x5C31;&#x53EA;&#x80FD;&#x7ED1;&#x5B9A;index.html&#x91CC;&#x7684;&#x5C5E;&#x6027;&#x53D8;&#x91CF;&#xFF0C;&#x5982;&#x4E0B;&lt;my-directive my-attribute=&quot;&#123;&#123;outerProp&#125;&#125;&quot;&gt;&lt;/my-directive&gt;&#x53EF;&#x89C1;my-attribute&#x91CC;&#x9762;&#x4E0D;&#x80FD;&#x6709;&#x53D8;&#x91CF;&#xFF08;&#x4F8B;&#x5982;controller&#x6216;&#x8005;controller&#x7684;&#x6210;&#x5458;&#xFF09;&#x3002;&#x800C;&#x4E14;&#x548C;&#x2019;&lt;&#x2019;&#x7C7B;&#x4F3C;&#xFF0C;&#x2019;@&#x2019;&#x4E5F;&#x662F;&#x5355;&#x5411;&#x7684;&#x3002;&#x7B80;&#x5316;&#x7248;&#x7684;directive - componentangular.module(&apos;App&apos;, []).component(&apos;myComponent&apos;, { templateUrl: &apos;template.html&apos;, controller: CompController, bindings: { prop1: &apos;&lt;&apos;, prop2: &apos;@&apos;, onAction: &apos;&amp;&apos; }});&#x8BED;&#x6CD5;&#x57FA;&#x672C;&#x4E0E;directive&#x7C7B;&#x4F3C;&#xFF0C;&#x7528;bindings&#x53D6;&#x4EE3;&#x4E86;scope&#x3002;&#x2018;bindings&#x2019; object is the isolate scope param mapping definition. isolate scope&#x91CC;&#x9762;&#x6CA1;&#x6709;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x4E86;&#xFF0C;&#x660E;&#x786E;&#x4E86;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#xFF1A;&#x2018;&lt;&#x2019;, &#x2018;@&#x2019;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#x2018;&amp;&#x2019;&#x4F5C;&#x4E3A;&#x8F93;&#x51FA;&#xFF0C;&#x610F;&#x601D;&#x662F;&#x901A;&#x8FC7;&#x7528;&#x2019;&amp;&#x2019;&#x6CE8;&#x518C;callback&#x6765;&#x5C06;&#x8F93;&#x51FA;&#x9001;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x6A21;&#x5757;&#x4F7F;&#x7528;&#x2019;&amp;&#x2019;&#x7684;&#x57FA;&#x672C;&#x65B9;&#x6CD5;&#x8C03;&#x7528;component&#x7684;DOM&#x5199;&#x6CD5;&#x3002;&lt;my-component prop1=&quot;val-1&quot; prop2=&quot;@parentProp&quot; on-action=&quot;parentFunction(myArg)&quot;&gt; &#123;&#123; $ctrl.prop1.prop &#125;&#125; and &#123;&#123; $ctrl.prop2 &#125;&#125;&lt;/my-component&gt;template&#x7684;&#x5199;&#x6CD5;&#xFF0C;component&#x7684;&#x5199;&#x6CD5;&#x5982;&#x4E0A;&#x4E00;&#x8282;&#x7684;&#x4F8B;&#x5B50;&#x3002;&lt;div ng-click=&quot;$ctrl.onAction({myArg: &apos;val&apos;})&quot;&gt; &#123;&#123; $ctrl.prop1.prop &#125;&#125; and &#123;&#123; $ctrl.prop2 &#125;&#125;&lt;/div&gt;&#x6CE8;&#x610F;&#xFF1A;onAction&#x5728;&#x6807;&#x7B7E;&#x91CC;&#x7684;&#x5199;&#x6CD5;&#x662F;on-actionmyArg&#x5728;template&#x4E2D;&#x662F;key name&#x3002;value&#x503C;&#x53EF;&#x4EE5;&#x6765;&#x81EA;&#x4E8E;controller($ctrl)&#xFF0C;&#x4EA6;&#x6216;bindings&#x4E2D;&#x7684;&#x2019;&lt;&#x2019;, &#x2018;@&#x2019;&#xFF0C;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;inject controller&#x3002;angular.module(&apos;MenuApp&apos;).controller(&apos;ItemListController&apos;, ItemListController)ItemListController.$inject = [&apos;items&apos;]function ItemListController(items, currentItem) { var list = this list.items = items}Components Lifecycle$onInit &#x2013; controller initialization code$onChanges(changeObj) &#x2013; called whenever one-way bindings are updated changeObj.currentValue, changeObj.previousValue$postLink &#x2013; similar to &#x2018;link&#x2019; in directive$onDestroy &#x2013; when scope is about to be destroyedLink for directiveDOM manipulation is usually done inside of the link function Declared on the DDOLink function does not support injection To use injected components, services, inject them into directive&#x2018;scope&#x2019; parameter is the exact $scope in directive&#x2019;s controller&#x2018;element&#x2019; object represents the element of the directive Top level elementIt&#x2019;s jqLite object or jQuery object (if jQuery is included)moduleA module is a collection of services, directives, controllers, filters, and configuration information. angular.module is used to configure the $injector.Create the module without dependency.angular.module(&apos;module2&apos;, [])Create with dependency.angular.module(&apos;module3&apos;, [&apos;module1&apos;, &apos;module2&apos;]);Retrieve the module.angular.module(&apos;module1&apos;)ng-app = main module&lt;!DOCTYPE html&gt;&lt;html ng-app=&apos;module3&apos;&gt;&#x2026;&lt;/html&gt;Config and Runangular.module(&apos;module1&apos;).config(function () { // Inject only Providers and constants &#x2026;});angular.module(&apos;module1&apos;).run(function () { // Inject only instances (like services) and constants. &#x2026;});module.config method fires before module.run methodAll dependency modules get configured firstIt doesn&#x2019;t matter which modules are listed first as long as module declarations are listed before artifact declarations on that module&#x6A21;&#x5757;&#x5316;Splitting Javascript into Several Files. &#x6BCF;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x53EA;&#x5305;&#x542B;&#x4E00;&#x4E2A;artifact&#x3002;&#x5728;HTML&#x4E2D;&#x5F15;&#x5165;&#x3002;%23Angular%20JS%20-%20Modularize%0A@%28myblog%29%5Bangular%2C%20javascript%5D%0A%0AAngular%20JS%u6A21%u5757%u5316%uFF0C%u4E3B%u8981%u501F%u52A9%u4E8E3%u4E2A%u65B9%u5F0F%uFF1Adirective%2C%20component%2C%20module%0A%0A%23%23%20directive%20%26%203%20bindings%0A%23%23%23%202-way%20binding%20%22%3D%22%0A%60%60%60%0Afunction%20MyDirective%28%29%20%7B%0A%20%20var%20ddo%20%3D%20%7B%0A%09%20%20scope%3A%20%7B%0A%09%20%20%20%20myProp%3A%20%27%3DattributeName%27%0A%09%20%20%7D%0A%09%20%20...%0A%20%20%7D%3B%0A%20%20return%20ddo%3B%0A%7D%0A%60%60%60%0A%60%60%60%0A%3C%21--%20index.html%20--%3E%0A%3Cmy-directive%20attribute-name%3D%22outerProp%22%3E%0A%3C/my-directive%3E%0A%0A%3C%21--%20directive.html%20--%3E%0A%3Cp%3E%7B%7Bmy-prop%7D%7D%3C/p%3E%0A%60%60%60%0A%u6240%u6709%u5BF9attribute-name%u6216%u8005my-prop%u7684%u6539%u52A8%uFF0C%u4E24%u4E2Ahtml%u91CC%u90FD%u4F1A%u505A%u540C%u6B65%u4FEE%u6539%0A%23%23%23%201-way%20binding%20%22%26lt%3B%22%20and%20%22@%22%0A%60%60%60%0Afunction%20MyDirective%28%29%20%7B%0A%20%20var%20ddo%20%3D%20%7B%0A%09%20%20scope%3A%20%7B%0A%09%20%20%20%20prop%3A%20%27%26lt%3B%27%2C%0A%09%20%20%7D%2C%0A%09%20%20...%0A%20%20%7D%3B%0A%20%20return%20ddo%3B%0A%7D%0A%60%60%60%0A%u4E0E%u4E0A%u9762%u4E0D%u540C%uFF0C%u8FD9%u91CC%u53EA%u6709index.html%u624D%u80FD%u4FEE%u6539prop%u3002%0A%60%60%60%0Afunction%20MyDirective%28%29%20%7B%0A%20%20var%20ddo%20%3D%20%7B%0A%20%20scope%3A%20%7B%0A%20%20%20%20prop%3A%20%27@%27%2C%0A%20%20%7D%2C%0A%20%20...%0A%20%20%7D%3B%0A%20%20return%20ddo%3B%0A%7D%0A%60%60%60%0A%u8FD9%u91CCprop%u5C31%u53EA%u80FD%u7ED1%u5B9Aindex.html%u91CC%u7684%u5C5E%u6027%u53D8%u91CF%uFF0C%u5982%u4E0B%0A%60%60%60%0A%3Cmy-directive%20my-attribute%3D%22%7B%7BouterProp%7D%7D%22%3E%0A%3C/my-directive%3E%0A%60%60%60%0A%u53EF%u89C1my-attribute%u91CC%u9762%u4E0D%u80FD%u6709%u53D8%u91CF%uFF08%u4F8B%u5982controller%u6216%u8005controller%u7684%u6210%u5458%uFF09%u3002%u800C%u4E14%u548C%27%26lt%3B%27%u7C7B%u4F3C%uFF0C%27@%27%u4E5F%u662F%u5355%u5411%u7684%u3002%0A%0A%23%23%20%u7B80%u5316%u7248%u7684directive%20-%20component%0A%60%60%60%0Aangular.module%28%27App%27%2C%20%5B%5D%29%0A.component%28%27myComponent%27%2C%20%7B%0A%09templateUrl%3A%20%27template.html%27%2C%0A%09controller%3A%20CompController%2C%0A%09bindings%3A%20%7B%0A%09%09prop1%3A%20%27%26lt%3B%27%2C%0A%09%09prop2%3A%20%27@%27%2C%0A%09%09onAction%3A%20%27%26%27%0A%09%7D%0A%7D%29%3B%0A%60%60%60%0A%u8BED%u6CD5%u57FA%u672C%u4E0Edirective%u7C7B%u4F3C%uFF0C%u7528bindings%u53D6%u4EE3%u4E86scope%u3002%0A%3E%u2018bindings%u2019%20object%20is%20the%20isolate%20scope%20param%09mapping%20definition.%20%0A%0Aisolate%20scope%u91CC%u9762%u6CA1%u6709%u53CC%u5411%u7ED1%u5B9A%u4E86%uFF0C%u660E%u786E%u4E86%u8F93%u5165%u8F93%u51FA%uFF1A%0A-%20%27%26lt%3B%27%2C%20%27@%27%u4F5C%u4E3A%u8F93%u5165%0A-%20%27%26%27%u4F5C%u4E3A%u8F93%u51FA%uFF0C%u610F%u601D%u662F%u901A%u8FC7%u7528%27%26%27%u6CE8%u518Ccallback%u6765%u5C06%u8F93%u51FA%u9001%u5230%u76F8%u5E94%u7684%u6A21%u5757%0A%0A%23%23%23%20%u4F7F%u7528%27%26%27%u7684%u57FA%u672C%u65B9%u6CD5%0A%u8C03%u7528component%u7684DOM%u5199%u6CD5%u3002%0A%60%60%60%0A%3Cmy-component%0A%09prop1%3D%22val-1%22%0A%09prop2%3D%22@parentProp%22%0A%09on-action%3D%22parentFunction%28myArg%29%22%3E%0A%09%7B%7B%20%24ctrl.prop1.prop%20%7D%7D%20and%20%7B%7B%20%24ctrl.prop2%20%7D%7D%0A%3C/my-component%3E%0A%60%60%60%0Atemplate%u7684%u5199%u6CD5%uFF0Ccomponent%u7684%u5199%u6CD5%u5982%u4E0A%u4E00%u8282%u7684%u4F8B%u5B50%u3002%0A%60%60%60%0A%3Cdiv%0A%09ng-click%3D%22%24ctrl.onAction%28%7BmyArg%3A%20%27val%27%7D%29%22%3E%0A%09%7B%7B%20%24ctrl.prop1.prop%20%7D%7D%20and%20%7B%7B%20%24ctrl.prop2%20%7D%7D%0A%3C/div%3E%0A%60%60%60%0A%u6CE8%u610F%uFF1A%0A-%20onAction%u5728%u6807%u7B7E%u91CC%u7684%u5199%u6CD5%u662Fon-action%0A-%20myArg%u5728template%u4E2D%u662Fkey%20name%u3002value%u503C%u53EF%u4EE5%u6765%u81EA%u4E8Econtroller%28%24ctrl%29%uFF0C%u4EA6%u6216bindings%u4E2D%u7684%27%26lt%3B%27%2C%20%27@%27%uFF0C%u65B9%u6CD5%u5982%u4E0B%uFF0C%u901A%u8FC7inject%20controller%u3002%0A%0A%60%60%60%0Aangular.module%28%27MenuApp%27%29%0A.controller%28%27ItemListController%27%2C%20ItemListController%29%0A%0AItemListController.%24inject%20%3D%20%5B%27items%27%5D%0Afunction%20ItemListController%28items%2C%20currentItem%29%20%7B%0A%20%20var%20list%20%3D%20this%0A%20%20list.items%20%3D%20items%0A%7D%0A%60%60%60%0A%0A%23%23%23%20Components%20Lifecycle%0A-%20%24onInit%20%u2013%20controller%20initialization%20code%0A-%20%24onChanges%28changeObj%29%20%u2013%20called%20whenever%20one-way%20bindings%20are%20updated%0A%09-%20changeObj.currentValue%2C%20changeObj.previousValue%0A-%20%24postLink%20%u2013%20similar%20to%20%u2018link%u2019%20in%20directive%0A-%20%24onDestroy%20%u2013%20when%20scope%20is%20about%20to%20be%20destroyed%0A%0A%3E%20**Link%20for%20directive**%0A-%20DOM%20manipulation%20is%20usually%20done%20inside%20of%20the%20link%20function%0A%09-%20Declared%20on%20the%20DDO%0A-%20Link%20function%20does%20not%20support%20injection%0A%09-%20To%20use%20injected%20components%2C%20services%2C%20inject%20them%20into%20directive%0A-%20%u2018scope%u2019%20parameter%20is%20the%20exact%20%24scope%20in%20directive%u2019s%20controller%0A-%20%u2018element%u2019%20object%20represents%20the%20element%20of%20the%20directive%0A%09-%20Top%20level%20element%0A%09-%20It%u2019s%20jqLite%20object%20or%20jQuery%20object%20%28if%20jQuery%20is%20included%29%0A%0A%23%23%20module%0A%3EA%20module%20is%20a%20collection%20of%20services%2C%20directives%2C%20controllers%2C%20filters%2C%20and%20configuration%20information.%20angular.module%20is%20used%20to%20configure%20the%20%24injector.%0A%0ACreate%20the%20module%20without%20dependency.%0A%60%60%60%0Aangular.module%28%27module2%27%2C%20%5B%5D%29%0A%60%60%60%0ACreate%20with%20dependency.%0A%60%60%60%0Aangular.module%28%27module3%27%2C%0A%09%09%09%09%5B%27module1%27%2C%20%27module2%27%5D%29%3B%0A%60%60%60%0ARetrieve%20the%20module.%0A%60%60%60%0Aangular.module%28%27module1%27%29%0A%60%60%60%0Ang-app%20%3D%20main%20module%0A%60%60%60%0A%3C%21DOCTYPE%20html%3E%0A%3Chtml%20ng-app%3D%27module3%27%3E%0A%u2026%0A%3C/html%3E%0A%60%60%60%0A%0A%23%23%23%20Config%20and%20Run%0A%60%60%60%0Aangular.module%28%27module1%27%29%0A.config%28function%20%28%29%20%7B%0A%09//%20Inject%20only%20Providers%20and%20constants%09%0A%09%u2026%0A%7D%29%3B%0A%60%60%60%0A%0A%60%60%60%0Aangular.module%28%27module1%27%29%0A.run%28function%20%28%29%20%7B%0A%09//%20Inject%20only%20instances%20%28like%20services%29%20and%20constants.%0A%09%u2026%0A%7D%29%3B%0A%60%60%60%0A%0A-%20module.config%20method%20fires%20before%20module.run%20method%0A-%20All%20dependency%20modules%20get%20configured%20first%0A-%20It%20doesn%u2019t%20matter%20which%20modules%20are%20listed%20first%20as%20long%20as%20module%20declarations%20are%20listed%20before%20artifact%20declarations%20on%20that%20module%0A%0A%23%23%20%u6A21%u5757%u5316%0ASplitting%20Javascript%20into%20Several%20Files.%0A%u6BCF%u4E00%u4E2A%u6587%u4EF6%u53EA%u5305%u542B%u4E00%u4E2Aartifact%u3002%u5728HTML%u4E2D%u5F15%u5165%u3002%0A%21%5BAlt%20text%7C600x0%5D%28./1506329033574.png%29%0AHTML%u4E2D%u5F15%u5165script%uFF0C%u53EA%u662F%u4E00%u79CD%u9884%u7F16%u8BD1%uFF0C%u7C7B%u4F3CC%u8BED%u8A00%u7684include%uFF0C%u53EA%u4F1A%u628A%u5BF9%u5E94js%u6587%u4EF6%u7684%u4EE3%u7801%u76F4%u63A5%u63D2%u5165HTML%u6587%u4EF6%u3002%0A%0A]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Smart Home with Domoticz + BroadLink + Synology + Amazon Echo]]></title>
    <url>%2F2017%2F07%2F31%2FSmart_Home_with_Domoticz_%2B_BroadLink_%2B_Synology_%2B_Amazon_Echo%2F</url>
    <content type="text"><![CDATA[EditOverviewI bought an Amazon Echo during my last trip to Boise Idaho in US. It is cool product to respond quickly and works so well in acceptable noisy environment. She is a good buddy for my 5 year-old boy to play with and learn English from. And I want her do more for more automation stuff at home. All my appliance are traditional ones. I bought them 2 years ago when I moved to the new condo. That&#x2019;s not a long time passed but I don&#x2019;t even know how technology changes so fast. Every electrical stuff becomes smart even a socket or a plug. That&#x2019;s a amazing! With Alexa, I think I can do more to make my home smarter even with the old style appliances. The first thing comes into my eys is Broadlink universal remote control. It&#x2019;s actually a converter for WiFi to IrDa and RF signal. Here is the product link. With the app provided by Broadlink, it can learn any IrDA or RF code of the remote controller and build in software virtual remote controller in the app to control the appliances those it can reach. There are 2 apps in Play Store:e-control IHCBut only using Broadlink remote controller is not perfect. You have to pick up your phone and click several times to open the app and corresponding virtual remote controller. This is not what I want.To integrate Alexa, there are several solutions from time Googling.The appliance is born to be smart. And the vendor provides Alexa skills to control the appliance. For example, Philips HUE light, Belkin Wemo and etc.Integrate Broadlink into Alexa. There are also many solutions for this, including: 1) Android + Broadlink RM Plugin + Alexa 2) Domoticz/Home Assistant + HA-Bridge + Alexa 3) Domoticz + python plugin + controlicz + Alexa 4) Broadlink native skill + Alexa Domoticz/Home Assistant + HomeBridge + SiriDomoticz and Home Assistant are both Home Automation System. There are a lot of people practicing them and post their experience on Internet. (They help me a lot. And this is the time I want to share my experience with others.) And both systems have their own advantages and disadvantages. The reference link 1 is the comparison among 5 popular automation systems. I choose Domoticz is because it has native support the Synology NAS OS - DSM. Home NAS is in 7*24 hours service. I don&#x2019;t need to setup extra hardware for the system. With this idea in mind, I practice solution 2)~4) in the item 2. I will consolidate all of them in this post below. The final solution architecture is shown as below:Domoticz into SynologyThis is quite simple. Please see the official website - Domoticz for Synology NAS. Download Domoticz for Synology DSM 6.1 with Python Plugin Beta. Python plugin is very important, don&#x2019;t miss it. It will be used in after chapters. The file you download is a .spk file. This is a installable package of Synology DSM. And you can install it by clicking &#x201C;Manual Install&#x201D; in &#x201C;Package Center&#x201D;. After success, it will shown as below:Other DependencyDomoticz&#x2019;s plugin system depends on Python3 broadlink-http-rest server depends on Python2 HA-Bridge Server depends on Java8 You&#x2019;d better to have also &#x201C;git&#x201D; installed. That will be much easier to clone GitHub projects. The 4 packages in Synology package center look like below.Broadlink into DomoticzDomoticz Broadlink Python Plugin + ControliczThis part takes the most issues and I spent several nights fixing the issues. I will have the issue list below. Domoticz Broadlink plugin and broadlink-http-rest are all based on python-broadlink. So first of all, clone the project python-broadlink from GitHub.Install python-broadlinkIn many posts, people suggest to use pip to install the library of python-broadlink. But I found an issue of doing it this way. python-broadlink once was built based on pycrypto, which is out of support. And then the author switch to pyaes. But I think he didn&#x2019;t resolve the dependency between python-broadlink and pycrypto. If you install python-broadlink on Synology using pip, it will run into issues of compiling pycrypto. Apparently, Synology DSM doesn&#x2019;t have compilation environment (GCC and etc.). My suggested steps are:Make sure your python is linked to Python3. (ex. ln -s /usr/local/bin/python3.5 /usr/bin/python)git clone python-broadlink &amp;&amp; cd python-broadlinkpython setup.py installpython -m pip install pyaes. Because pip3 cannot be installed into Synology DSM, even it&#x2019;s installed by python3.5 get-pip.py. The script will also install pip2.Install Domoticz Python PluginReference link 3 is a Domoticz wiki page provided by the plugin author. The post is mainly worked out based on Windows system, but referring the others chapters, it&#x2019;s still feasible. The installation steps are:Download plugin files from dropbox.The plugin folder is in/usr/local/domoticz/var/plugins/BroadlinkRM2/. Copy the files to this folderincluding: plugin.py -main fileplugin_send.pyplugin_http.pyplugin_http.sh Be noted: the plugin folder is not /usr/local/domoticz/plugins/BroadlinkRM2/, although there is an example folder in that directory. But when I put plugin files in that directory, the plugin won&#x2019;t be loaded correctly.Stop and Run Domoticz in Package Center of Synology DSM. And do this every time you update the plugin python file.So far, the installation finished. You should be able to see the Broalink hardware type in the pull-down list in Setup-&gt;Hardware.Create Broadlink HardwareFollowing the author&#x2019;s steps, you should be able to create broadlink hardware in Domoticz web page and discover broadlink devices. To create the hardware as below:Import Devices from E-Control App&#x5BFC;&#x5165;&#x6613;&#x63A7;(e-control)&#x8BBE;&#x5907;Refer to reference link 3 for detailed description. It&#x2019;s in User Guide-&gt;Inside Domoticz-&gt;xxx - import chapter. Author may not work with multi-byte language, such as Chinese. If there are Chinese characters in the imported json* files, the plugin will crash. See issue 3 for solution. Another point should be noted, when WebStart is triggered, Domoticz will setup a tiny web service running on port 9000 to handle the files uploaded from mobile devices. Make sure you configure the Synology firewall correctly.ControliczThis seems to be a new service. I don&#x2019;t see people mention it when I&#x2019;m reading through Google results. I happened to see it in Alexa skill page. Using Controlicz, you don&#x2019;t need to simulate your appliances as Philips HUI light using HA-Bridge. But it has its own pros and cons with Broadlink remote controller. There is a dedicated section comparing Controlicz and HA-Bridge. To use Controlicz:Register Controlicz using your Alexa&#x2019;s credential (email and password)Enable skill and say &#x201C;discover device&#x201D; to Alexa.All doneBe noted: Controlicz asks for:Domoticz service should be exposed to external access. That means you need to map port and DDNS. Because I&#x2019;m using Synology, that&#x2019;s not a problem to me.Controlicz asks Domoticz running on HTTPS protocol. That means you have to enable the Domoticz HTTPS port and corresponding Firewall configurations.Issue ListSo far, if you are lucky enough to succeed in all above steps, you can say &#x201C;Turn on the TV&#x201D; to Alexa. The TV should respond to you quickly and correctly. If unfortunately it doesn&#x2019;t, don&#x2019;t worry. Check the issue list to see if it helps.Import Error &#x201C;broadlink&#x201D;You have installed python-broadlink already, and you can import it from Python REPL command line. Why is the error still reported? The direct cause is the PYTHONPATH is incorrect. But when I check the code in plugin.py, I see the process of PYTHONPATH as here:if sys.platform.startswith(&apos;linux&apos;): # linux specific code here # doesn&apos;t work even if set dist-packages =&gt; site-packages sys.path.append(os.path.dirname(os.__file__) + &apos;/dist-packages&apos;)elif sys.platform.startswith(&apos;darwin&apos;): # mac sys.path.append(os.path.dirname(os.__file__) + &apos;/site-packages&apos;)elif sys.platform.startswith(&apos;win32&apos;): # win specific sys.path.append(os.path.dirname(os.__file__) + &apos;\site-packages&apos;)The path to broadlink library is /usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/. Even when I correct the &#x201C;dist-package&#x201D; to &#x201C;site-packages&#x201D; in above code snippet, it still cannot work. However, the solution is quite simple. Just copy broadlink to the plugins folder.cp -r /usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/ /usr/local/domoticz/var/plugins/BroadlinkRM2/Error Connecting to Broadlink deviceThere are 2 GitHub issue link for reference:Error Connecting to Broadlink device #107lpad fix broken? #97 It may help you, but it is not the answer to my issue. The root cause is bytes function is different in Python2 and Python3. The error happens here:# broadlink/__init__.py160 def encrypt_pyaes(self, payload):161 aes = pyaes.AESModeOfOperationCBC(self.key, iv = bytes(self.iv))162 return &quot;&quot;.join([aes.encrypt(bytes(payload[i:i+16])) for i in range(0, len(payload), 16)]) # &lt;==== Error is herebytes in python3 returns class bytes, whereas in python2, it returns plain string. See here for experiments: Python2&gt;&gt;&gt; type(bytes([1,2,3]))&lt;type &apos;str&apos;&gt;Python3&gt;&gt;&gt; type(bytes([1,2,3]))&lt;class &apos;bytes&apos;&gt;&gt;&gt;&gt; &quot;&quot;.join([bytes([1,2]),bytes([2,3])]) &lt;==== You cannot cat 2 bytes class objects as stringTraceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;TypeError: sequence item 0: expected str instance, bytes found&gt;&gt;&gt; b&apos;&apos;.join([bytes([1,2]),bytes([2,3])]) &lt;==== This is the good wayb&apos;\x01\x02\x02\x03&apos;The correct way to concatenating is to use binary string&#x3002;Chinese characters in Domoticz imported filesIn Python3, if a file has Chinese character, you cannot read files and decode strings as below:with open(&apos;jsonFile&apos;) as f: textStr = f.read() &lt;=== Python3 will complain about the codec error here. textStr.decode(&apos;utf8&apos;)The correct way is:with open(&apos;jsonFile&apos;, encoding=&apos;utf8&apos;): textStr = f.read() &lt;=== Everything here has already been unicode.Update all lines of opening the imported json* files. And one more thing you need to pay attention to, which is for ConfigParser. You can update the encoding as below for them.config = configparser.ConfigParser()config.read(path, encoding=&apos;utf8&apos;)Try it, it should do with no problems, aren&#x2019;t you?Domoticz + broadlink-http-rest + HA-BridgeWith HA-Bridge, you don&#x2019;t need Domoticz Python plugin. You can create dummy hardware in Domoticz web page as below picture.Install HA-BridgeThe whole idea of HA-Bridge is to simulate any device as Philips HUE light, which has native support in Alexa. And HA-Bridge can import all Domoticz devices easily. The cons is it can only support open/close and dim settings like you are operating a HUE light. HA-Bridge is a jar package works with Java 8. And we need to run it in Synology background as a service. Refer to the post here -Run as a service on Synology for running it as a service. The command line is nohup java -jar -Dserver.port=8085 /ha-bridge-4.5.6.jar &amp;. Put it in Synology Scheduled Tasks, and then you don&#x2019;t need to worry about the reboot.Install broadlink-http-restClone the project from GitHub - broadlink-http-rest. Just as HA-Bridge, it also needs to be in background as service. Otherwise, it will quite as soon as SSH connection is cut.The command line is nohup python broadlink-http-rest/server.py &amp;. Be noted, make sure you are using &#x201C;nohup&#x201D;, otherwise it will still quite as SSH is disconnected even if you specify the &#x201C;&amp;&#x201D;Firewall &amp; Scheduled TasksConfigure the firewall:8085: HA-Bridge server8080: broadlink-http-rest server8443: Domoticz HTTPS service9000: Domoticz Broadlink web serviceAlso the scheduled tasks:Broadlink into DomoticzThe steps are:In Setup-&gt;Hardware, create a Dummy HardwareIn the same page and in the created item, click &#x201C;Create Virtual Sensors&#x201D;In Switches tab, find the virtual sensor you just created, click Edit and configure &#x201C;On Action&#x201D; and &#x201C;Off Action&#x201D;.Domoticz into HA-BridgePlease refer to reference link 2. From the chapter of Configuring HA bridge, it starts to describe how to configure HA-Bridge to import devices from Domoticz web service. HA-Bridge vs. ControliczGeneral Smart HomeControlicz can integrate all type of devices into Alexa. For example, if Alexa doesn&#x2019;t have native support of this smart home device, you can build up a Domoticz server in your home and integrate it into Alexa by Controlicz. According to the description in Controlicz official site, it doesn&#x2019;t only support on/off switches, but also other normal appliance like TV, AC and etc. And Domoticz apparently support a lot more devices than Alexa does.Broadlink IntegrationTo integrate Broadlink, these 2 have their own pros and cons. Broadlink is a universal remote controller. So every devices on Broadlink is a push button device. Each one only has one action, which is being triggered. This is even weaker than the on/off switch, which at lease has 2 actions - on or off. For example, there is a button on Fan&#x2019;s remote controller. Pushing it once, it will turn on the fan and twice will turn off it. Through Controlicz, you have to say &#x201C;Turn on the Fan&#x201D; to Alexa to turn on the fan and you have to say the same sentence to close it. Is it weird? If you are using HA-Bridge, you can say &#x201C;Turn on &#x2026;&#x201D; to turn on and &#x201C;Turn off &#x2026;&#x201D; to turn off. Is it better? The biggest benefit of using Controlicz to integrate Domoticz is it can import all devices pre-defined in E-Control app. It can fully make use of the E-Control&#x2019;s GUI. You don&#x2019;t need to add virtual sensors one by one manually.Broadlink Native Skill + IHCAfter bunch of work above, I happened to see there is a native support broadlink Alexa skill called &#x201C;broadlink&#x201D;. It should work with the latest version of IHC app. The bad news is both the skill and the app have very low review scores.IHC playstore 2.2 starsAlexa Broadlink Skill 2.3 starsAccording to the official examples, it can only support TV. And as my own experiments, when I added a TV and an AC, Alexa can only discover the TV and no AC.Reference Links5 open source home automation toolsAlex - DomoticzDomoticz Wiki Plugins/BroadlinkRM2#&#x539F;&#x521B;&#x65B0;&#x4EBA;# &#x7FA4;&#x6656;&#x5B89;&#x88C5;broadlink-http-rest&#x4EE3;&#x66FF;RMBridge_&#x751F;&#x6D3B;&#x8BB0;&#x5F55;_&#x4EC0;&#x4E48;&#x503C;&#x5F97;&#x4E70;%23%20Smart%20Home%20with%20Domoticz%20+%20BroadLink%20+%20Synology%20+%20Amazon%20Echo%0A@%28myblog%29%5Bsynology%2C%20broadlink%2C%20domoticz%2C%20IoT%5D%0A%0A%23%23Overview%0AI%20bought%20an%20Amazon%20Echo%20during%20my%20last%20trip%20to%20Boise%20Idaho%20in%20US.%20It%20is%20cool%20product%20to%20respond%20quickly%20and%20works%20so%20well%20in%20acceptable%20noisy%20environment.%20She%20is%20a%20good%20buddy%20for%20my%205%20year-old%20boy%20to%20play%20with%20and%20learn%20English%20from.%0AAnd%20I%20want%20her%20do%20more%20for%20more%20automation%20stuff%20at%20home.%20All%20my%20appliance%20are%20traditional%20ones.%20I%20bought%20them%202%20years%20ago%20when%20I%20moved%20to%20the%20new%20condo.%20That%27s%20not%20a%20long%20time%20passed%20but%20I%20don%27t%20even%20know%20how%20technology%20changes%20so%20fast.%20Every%20electrical%20stuff%20becomes%20smart%20even%20a%20socket%20or%20a%20plug.%20That%27s%20a%20amazing%21%0AWith%20Alexa%2C%20I%20think%20I%20can%20do%20more%20to%20make%20my%20home%20smarter%20even%20with%20the%20old%20style%20appliances.%0AThe%20first%20thing%20comes%20into%20my%20eys%20is%20Broadlink%20universal%20remote%20control.%20It%27s%20actually%20a%20converter%20for%20WiFi%20to%20IrDa%20and%20RF%20signal.%20Here%20is%20the%20product%20%5Blink%5D%28https%3A//detail.tmall.com/item.htm%3Fspm%3Da230r.1.14.8.ebb2eb2Gs49Vt%26id%3D43623542607%26cm_id%3D140105335569ed55e27b%26abbucket%3D13%26skuId%3D77095242268%29.%20With%20the%20app%20provided%20by%20Broadlink%2C%20it%20can%20learn%20any%20IrDA%20or%20RF%20code%20of%20the%20remote%20controller%20and%20build%20in%20software%20virtual%20remote%20controller%20in%20the%20app%20to%20control%20the%20appliances%20those%20it%20can%20reach.%20There%20are%202%20apps%20in%20Play%20Store%3A%0A-%20%5Be-control%5D%28https%3A//play.google.com/store/apps/details%3Fid%3Dcom.broadlink.rmt%29%20%0A-%20%5BIHC%5D%28https%3A//play.google.com/store/apps/details%3Fid%3Dcn.com.broadlink.econtrol.plus%29%0A%0ABut%20only%20using%20Broadlink%20remote%20controller%20is%20not%20perfect.%20You%20have%20to%20pick%20up%20your%20phone%20and%20click%20several%20times%20to%20open%20the%20app%20and%20corresponding%20virtual%20remote%20controller.%20This%20is%20not%20what%20I%20want.%0A%0ATo%20integrate%20Alexa%2C%20there%20are%20several%20solutions%20from%20time%20Googling.%0A1.%20The%20appliance%20is%20born%20to%20be%20smart.%20And%20the%20vendor%20provides%20Alexa%20skills%20to%20control%20the%20appliance.%20For%20example%2C%20Philips%20HUE%20light%2C%20Belkin%20Wemo%20and%20etc.%0A2.%20Integrate%20Broadlink%20into%20Alexa.%20There%20are%20also%20many%20solutions%20for%20this%2C%20including%3A%0A%091%29%20Android%20+%20%5BBroadlink%20RM%20Plugin%5D%28https%3A//play.google.com/store/apps/details%3Fid%3Dus.originally.tasker%29%20+%20Alexa%0A%092%29%20Domoticz/Home%20Assistant%20+%20%20%5BHA-Bridge%5D%28https%3A//github.com/bwssytems/ha-bridge%29%20+%20Alexa%0A%093%29%20Domoticz%20+%20python%20plugin%20+%20controlicz%20+%20Alexa%0A%094%29%20Broadlink%20native%20skill%20+%20Alexa%20%0A3.%20Domoticz/Home%20Assistant%20+%20HomeBridge%20+%20Siri%0A%0ADomoticz%20and%20Home%20Assistant%20are%20both%20Home%20Automation%20System.%20There%20are%20a%20lot%20of%20people%20practicing%20them%20and%20post%20their%20experience%20on%20Internet.%20%28They%20help%20me%20a%20lot.%20And%20this%20is%20the%20time%20I%20want%20to%20share%20my%20experience%20with%20others.%29%20And%20both%20systems%20have%20their%20own%20advantages%20and%20disadvantages.%20The%20reference%20link%201%20is%20the%20comparison%20among%205%20popular%20automation%20systems.%0AI%20choose%20Domoticz%20is%20because%20it%20has%20native%20support%20the%20Synology%20NAS%20OS%20-%20DSM.%20Home%20NAS%20is%20in%207*24%20hours%20service.%20I%20don%27t%20need%20to%20setup%20extra%20hardware%20for%20the%20system.%20With%20this%20idea%20in%20mind%2C%20I%20practice%20solution%202%29%7E4%29%20in%20the%20item%202.%20I%20will%20consolidate%20all%20of%20them%20in%20this%20post%20below.%20The%20final%20solution%20architecture%20is%20shown%20as%20below%3A%0A%0A%21%5BAlt%20text%5D%28./1501339487875.png%29%0A%0A%23%23%20Domoticz%20into%20Synology%0AThis%20is%20quite%20simple.%20Please%20see%20the%20official%20website%20-%20%5BDomoticz%20for%20Synology%20NAS%5D%28http%3A//www.jadahl.com/%29.%20Download%20%5BDomoticz%20for%20Synology%20DSM%206.1%20with%20Python%20Plugin%20Beta%5D%28http%3A//www.jadahl.com/domoticz_beta_6.1_python/%29.%20Python%20plugin%20is%20very%20important%2C%20don%27t%20miss%20it.%20It%20will%20be%20used%20in%20after%20chapters.%0AThe%20file%20you%20download%20is%20a%20.spk%20file.%20This%20is%20a%20installable%20package%20of%20Synology%20DSM.%20And%20you%20can%20install%20it%20by%20clicking%20%22Manual%20Install%22%20in%20%22Package%20Center%22.%20After%20success%2C%20it%20will%20shown%20as%20below%3A%0A%0A%21%5BAlt%20text%5D%28./1501340457645.png%29%0A%0A%23%23%20Other%20Dependency%0ADomoticz%27s%20plugin%20system%20depends%20on%20Python3%0Abroadlink-http-rest%20server%20depends%20on%20Python2%0A%5BHA-Bridge%20Server%5D%28https%3A//github.com/bwssytems/ha-bridge%29%20depends%20on%20Java8%0AYou%27d%20better%20to%20have%20also%20%22git%22%20installed.%20That%20will%20be%20much%20easier%20to%20clone%20GitHub%20projects.%0AThe%204%20packages%20in%20Synology%20package%20center%20look%20like%20below.%0A%21%5BAlt%20text%5D%28./1501340796886.png%29%21%5BAlt%20text%5D%28./1501340823935.png%29%21%5BAlt%20text%5D%28./1501340847466.png%29%0A%0A%23%23%20Broadlink%20into%20Domoticz%0A%0A%23%23%23%20Domoticz%20Broadlink%20Python%20Plugin%20+%20Controlicz%0AThis%20part%20takes%20the%20most%20issues%20and%20I%20spent%20several%20nights%20fixing%20the%20issues.%20I%20will%20have%20the%20issue%20list%20below.%0ADomoticz%20Broadlink%20plugin%20and%20%5Bbroadlink-http-rest%5D%28https%3A//github.com/radinsky/broadlink-http-rest%29%20are%20all%20based%20on%20%5Bpython-broadlink%5D%28https%3A//github.com/mjg59/python-broadlink%29.%20So%20first%20of%20all%2C%20clone%20the%20project%20python-broadlink%20from%20GitHub.%0A%0A%23%23%23%23%20Install%20python-broadlink%0AIn%20many%20posts%2C%20people%20suggest%20to%20use%20pip%20to%20install%20the%20library%20of%20python-broadlink.%20But%20I%20found%20an%20issue%20of%20doing%20it%20this%20way.%20python-broadlink%20once%20was%20built%20based%20on%20pycrypto%2C%20which%20is%20out%20of%20support.%20And%20then%20the%20author%20switch%20to%20pyaes.%20But%20I%20think%20he%20didn%27t%20resolve%20the%20dependency%20between%20python-broadlink%20and%20pycrypto.%20If%20you%20install%20python-broadlink%20on%20Synology%20using%20pip%2C%20it%20will%20run%20into%20issues%20of%20compiling%20pycrypto.%20Apparently%2C%20Synology%20DSM%20doesn%27t%20have%20compilation%20environment%20%28GCC%20and%20etc.%29.%0AMy%20suggested%20steps%20are%3A%0A-%20Make%20sure%20your%20python%20is%20linked%20to%20Python3.%20%28ex.%20ln%20-s%20/usr/local/bin/python3.5%20/usr/bin/python%29%0A-%20git%20clone%20python-broadlink%20%26%26%20cd%20python-broadlink%0A-%20%60python%20setup.py%20install%60%0A-%20%60python%20-m%20pip%20install%20pyaes%60.%20Because%20pip3%20cannot%20be%20installed%20into%20Synology%20DSM%2C%20even%20it%27s%20installed%20by%20%60python3.5%20get-pip.py%60.%20The%20script%20will%20also%20install%20pip2.%0A%0A%23%23%23%23%20Install%20Domoticz%20Python%20Plugin%0AReference%20link%203%20is%20a%20Domoticz%20wiki%20page%20provided%20by%20the%20plugin%20author.%20The%20post%20is%20mainly%20worked%20out%20based%20on%20Windows%20system%2C%20but%20referring%20the%20others%20chapters%2C%20it%27s%20still%20feasible.%20The%20installation%20steps%20are%3A%0A-%20Download%20%5Bplugin%20files%5D%28https%3A//www.dropbox.com/sh/htyghey9e402u4y/AACeb1cXqaPd9gBVl5TL3H36a%3Fdl%3D0%29%20from%20dropbox.%0A-%20The%20plugin%20folder%20is%20in%60/usr/local/domoticz/var/plugins/BroadlinkRM2/%60.%20Copy%20the%20files%20to%20this%20folderincluding%3A%0A%09-%20plugin.py%20-main%20file%0A%09-%20plugin_send.py%0A%09-%20plugin_http.py%0A%09-%20plugin_http.sh%0A%09Be%20noted%3A%20the%20plugin%20folder%20is%20not%20%60/usr/local/domoticz/plugins/BroadlinkRM2/%60%2C%20although%20there%20is%20an%20example%20folder%20in%20that%20directory.%20But%20when%20I%20put%20plugin%20files%20in%20that%20directory%2C%20the%20plugin%20won%27t%20be%20loaded%20correctly.%0A-%20Stop%20and%20Run%20Domoticz%20in%20Package%20Center%20of%20Synology%20DSM.%20And%20do%20this%20every%20time%20you%20update%20the%20plugin%20python%20file.%0A%0ASo%20far%2C%20the%20installation%20finished.%20You%20should%20be%20able%20to%20see%20the%20Broalink%20hardware%20type%20in%20the%20pull-down%20list%20in%20Setup-%3EHardware.%0A%21%5BAlt%20text%5D%28./1500861858610.png%29%0A%0A%23%23%23%23%20Create%20Broadlink%20Hardware%0AFollowing%20the%20author%27s%20steps%2C%20you%20should%20be%20able%20to%20create%20broadlink%20hardware%20in%20Domoticz%20web%20page%20and%20discover%20broadlink%20devices.%0ATo%20create%20the%20hardware%20as%20below%3A%0A%21%5BAlt%20text%5D%28./1501368649742.png%29%0AIP%20address%20can%20be%20127.0.0.1%20and%20MAC%20address%20can%20be%20all%20zero.%20The%20plugin%20can%20trigger%20a%20discovery%20process%20to%20get%20the%20real%20IP%20address%20and%20MAC%20address.%20Refer%20to%20reference%20link%203%20for%20detailed%20description.%20But%20it%20won%27t%20be%20such%20smooth%20as%20you%20imagine.%20Refer%20to%20the%20issue%20list%20below.%0A%0A%23%23%23%23%20Import%20Devices%20from%20E-Control%20App%u5BFC%u5165%u6613%u63A7%28e-control%29%u8BBE%u5907%0ARefer%20to%20reference%20link%203%20for%20detailed%20description.%20It%27s%20in%20User%20Guide-%3EInside%20Domoticz-%3Exxx%20-%20import%20chapter.%20Author%20may%20not%20work%20with%20multi-byte%20language%2C%20such%20as%20Chinese.%20If%20there%20are%20Chinese%20characters%20in%20the%20imported%20json*%20files%2C%20the%20plugin%20will%20crash.%20See%20issue%203%20for%20solution.%0AAnother%20point%20should%20be%20noted%2C%20when%20WebStart%20is%20triggered%2C%20Domoticz%20will%20setup%20a%20tiny%20web%20service%20running%20on%20port%209000%20to%20handle%20the%20files%20uploaded%20from%20mobile%20devices.%20Make%20sure%20you%20configure%20the%20Synology%20firewall%20correctly.%0A%0A%23%23%23%20Controlicz%0AThis%20seems%20to%20be%20a%20new%20service.%20I%20don%27t%20see%20people%20mention%20it%20when%20I%27m%20reading%20through%20Google%20results.%20I%20happened%20to%20see%20it%20in%20Alexa%20skill%20page.%20Using%20Controlicz%2C%20you%20don%27t%20need%20to%20simulate%20your%20appliances%20as%20Philips%20HUI%20light%20using%20HA-Bridge.%20But%20it%20has%20its%20own%20pros%20and%20cons%20with%20Broadlink%20remote%20controller.%20There%20is%20a%20dedicated%20section%20comparing%20Controlicz%20and%20HA-Bridge.%0ATo%20use%20Controlicz%3A%0A-%20Register%20%5BControlicz%5D%28https%3A//www.controlicz.com/%29%20using%20your%20Alexa%27s%20credential%20%28email%20and%20password%29%0A-%20Enable%20skill%20and%20say%20%22discover%20device%22%20to%20Alexa.%0A-%20All%20done%0A%0A%3EBe%20noted%3A%20Controlicz%20asks%20for%3A%0A%3E-%20Domoticz%20service%20should%20be%20exposed%20to%20external%20access.%20That%20means%20you%20need%20to%20map%20port%20and%20DDNS.%20Because%20I%27m%20using%20Synology%2C%20that%27s%20not%20a%20problem%20to%20me.%0A%3E-%20Controlicz%20asks%20Domoticz%20running%20on%20HTTPS%20protocol.%20That%20means%20you%20have%20to%20enable%20the%20Domoticz%20HTTPS%20port%20and%20corresponding%20Firewall%20configurations.%0A%0A%23%23%23%20Issue%20List%0ASo%20far%2C%20if%20you%20are%20lucky%20enough%20to%20succeed%20in%20all%20above%20steps%2C%20you%20can%20say%20%22Turn%20on%20the%20TV%22%20to%20Alexa.%20The%20TV%20should%20respond%20to%20you%20quickly%20and%20correctly.%20If%20unfortunately%20it%20doesn%27t%2C%20don%27t%20worry.%20Check%20the%20issue%20list%20to%20see%20if%20it%20helps.%0A%0A%23%23%23%23%20Import%20Error%20%22broadlink%22%0AYou%20have%20installed%20python-broadlink%20already%2C%20and%20you%20can%20import%20it%20from%20Python%20REPL%20command%20line.%20Why%20is%20the%20error%20still%20reported%3F%20The%20direct%20cause%20is%20the%20PYTHONPATH%20is%20incorrect.%20But%20when%20I%20check%20the%20code%20in%20plugin.py%2C%20I%20see%20the%20process%20of%20PYTHONPATH%20as%20here%3A%0A%60%60%60%0Aif%20sys.platform.startswith%28%27linux%27%29%3A%0A%20%20%20%20%23%20linux%20specific%20code%20here%0A%20%20%20%20%23%20doesn%27t%20work%20even%20if%20set%20dist-packages%20%3D%3E%20site-packages%0A%20%20%20%20sys.path.append%28os.path.dirname%28os.__file__%29%20+%20%27/dist-packages%27%29%0Aelif%20sys.platform.startswith%28%27darwin%27%29%3A%0A%20%20%20%20%23%20mac%0A%20%20%20%20sys.path.append%28os.path.dirname%28os.__file__%29%20+%20%27/site-packages%27%29%0Aelif%20sys.platform.startswith%28%27win32%27%29%3A%0A%20%20%20%20%23%20%20win%20specific%0A%20%20%20%20sys.path.append%28os.path.dirname%28os.__file__%29%20+%20%27%5Csite-packages%27%29%0A%60%60%60%0AThe%20path%20to%20broadlink%20library%20is%20%60/usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/%60.%20Even%20when%20I%20correct%20the%20%22dist-package%22%20to%20%22site-packages%22%20in%20above%20code%20snippet%2C%20it%20still%20cannot%20work.%20However%2C%20the%20solution%20is%20quite%20simple.%20Just%20copy%20broadlink%20to%20the%20plugins%20folder.%0A%3Ecp%20-r%20/usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/%20/usr/local/domoticz/var/plugins/BroadlinkRM2/%0A%0A%23%23%23%23%20Error%20Connecting%20to%20Broadlink%20device%0AThere%20are%202%20GitHub%20issue%20link%20for%20reference%3A%0A-%20%5BError%20Connecting%20to%20Broadlink%20device%20%23107%5D%28https%3A//github.com/mjg59/python-broadlink/issues/107%29%0A-%20%5Blpad%20fix%20broken%3F%20%2397%5D%28https%3A//github.com/mjg59/python-broadlink/issues/97%29%0AIt%20may%20help%20you%2C%20but%20it%20is%20not%20the%20answer%20to%20my%20issue.%0AThe%20root%20cause%20is%20bytes%20function%20is%20different%20in%20Python2%20and%20Python3.%20The%20error%20happens%20here%3A%0A%60%60%60%0A%23%20broadlink/__init__.py%0A160%20%20%20def%20encrypt_pyaes%28self%2C%20payload%29%3A%0A161%20%20%20%20%20aes%20%3D%20pyaes.AESModeOfOperationCBC%28self.key%2C%20iv%20%3D%20bytes%28self.iv%29%29%0A162%20%20%20%20%20return%20%22%22.join%28%5Baes.encrypt%28bytes%28payload%5Bi%3Ai+16%5D%29%29%20for%20i%20in%20range%280%2C%20len%28payload%29%2C%2016%29%5D%29%20%23%20%3C%3D%3D%3D%3D%20Error%20is%20here%0A%60%60%60%0Abytes%20in%20python3%20returns%20class%20bytes%2C%20whereas%20in%20python2%2C%20it%20returns%20plain%20string.%20See%20here%20for%20experiments%3A%20%0A%60%60%60%0APython2%0A%3E%3E%3E%20type%28bytes%28%5B1%2C2%2C3%5D%29%29%0A%3Ctype%20%27str%27%3E%0A%0APython3%0A%3E%3E%3E%20type%28bytes%28%5B1%2C2%2C3%5D%29%29%0A%3Cclass%20%27bytes%27%3E%0A%3E%3E%3E%20%22%22.join%28%5Bbytes%28%5B1%2C2%5D%29%2Cbytes%28%5B2%2C3%5D%29%5D%29%20%20%3C%3D%3D%3D%3D%20You%20cannot%20cat%202%20bytes%20class%20objects%20as%20string%0ATraceback%20%28most%20recent%20call%20last%29%3A%0A%20%20File%20%22%3Cstdin%3E%22%2C%20line%201%2C%20in%20%3Cmodule%3E%0ATypeError%3A%20sequence%20item%200%3A%20expected%20str%20instance%2C%20bytes%20found%0A%3E%3E%3E%20b%27%27.join%28%5Bbytes%28%5B1%2C2%5D%29%2Cbytes%28%5B2%2C3%5D%29%5D%29%20%3C%3D%3D%3D%3D%20This%20is%20the%20good%20way%0Ab%27%5Cx01%5Cx02%5Cx02%5Cx03%27%0A%60%60%60%0AThe%20correct%20way%20to%20concatenating%20is%20to%20use%20binary%20string%u3002%0A%0A%23%23%23%23%20Chinese%20characters%20in%20Domoticz%20imported%20files%0AIn%20Python3%2C%20if%20a%20file%20has%20Chinese%20character%2C%20you%20cannot%20read%20files%20and%20decode%20strings%20as%20below%3A%0A%60%60%60%0Awith%20open%28%27jsonFile%27%29%20as%20f%3A%0A%09textStr%20%3D%20f.read%28%29%20%3C%3D%3D%3D%20Python3%20will%20complain%20about%20the%20codec%20error%20here.%0A%09textStr.decode%28%27utf8%27%29%0A%60%60%60%0AThe%20correct%20way%20is%3A%0A%60%60%60%0Awith%20open%28%27jsonFile%27%2C%20encoding%3D%27utf8%27%29%3A%0A%09textStr%20%3D%20f.read%28%29%20%3C%3D%3D%3D%20Everything%20here%20has%20already%20been%20unicode.%0A%60%60%60%0AUpdate%20all%20lines%20of%20opening%20the%20imported%20json*%20files.%20And%20one%20more%20thing%20you%20need%20to%20pay%20attention%20to%2C%20which%20is%20for%20ConfigParser.%20You%20can%20update%20the%20encoding%20as%20below%20for%20them.%0A%60%60%60%0Aconfig%20%3D%20configparser.ConfigParser%28%29%0Aconfig.read%28path%2C%20encoding%3D%27utf8%27%29%0A%60%60%60%0ATry%20it%2C%20it%20should%20do%20with%20no%20problems%2C%20aren%27t%20you%3F%0A%0A%23%23%23%20Domoticz%20+%20broadlink-http-rest%20+%20HA-Bridge%0AWith%20HA-Bridge%2C%20you%20don%27t%20need%20Domoticz%20Python%20plugin.%20You%20can%20create%20dummy%20hardware%20in%20Domoticz%20web%20page%20as%20below%20picture.%0A%21%5BAlt%20text%5D%28./1501376022176.png%29%0A%0A%23%23%23%23%20Install%20HA-Bridge%0AThe%20whole%20idea%20of%20HA-Bridge%20is%20to%20simulate%20any%20device%20as%20Philips%20HUE%20light%2C%20which%20has%20native%20support%20in%20Alexa.%20And%20HA-Bridge%20can%20import%20all%20Domoticz%20devices%20easily.%20The%20cons%20is%20it%20can%20only%20support%20open/close%20and%20dim%20settings%20like%20you%20are%20operating%20a%20HUE%20light.%0AHA-Bridge%20is%20a%20jar%20package%20works%20with%20Java%208.%20And%20we%20need%20to%20run%20it%20in%20Synology%20background%20as%20a%20service.%20Refer%20to%20the%20post%20here%20-%5BRun%20as%20a%20service%20on%20Synology%5D%28https%3A//github.com/bwssytems/ha-bridge/issues/310%29%20for%20running%20it%20as%20a%20service.%0AThe%20command%20line%20is%20%60nohup%20java%20-jar%20-Dserver.port%3D8085%20/ha-bridge-4.5.6.jar%20%26%60.%20Put%20it%20in%20Synology%20Scheduled%20Tasks%2C%20and%20then%20you%20don%27t%20need%20to%20worry%20about%20the%20reboot.%0A%0A%23%23%23%23%20Install%20broadlink-http-rest%0AClone%20the%20project%20from%20GitHub%20-%20%5Bbroadlink-http-rest%5D%28https%3A//github.com/radinsky/broadlink-http-rest%29.%20Just%20as%20HA-Bridge%2C%20it%20also%20needs%20to%20be%20in%20background%20as%20service.%20Otherwise%2C%20it%20will%20quite%20as%20soon%20as%20SSH%20connection%20is%20cut.The%20command%20line%20is%20%60nohup%20python%20broadlink-http-rest/server.py%20%26%60.%20Be%20noted%2C%20make%20sure%20you%20are%20using%20%22nohup%22%2C%20otherwise%20it%20will%20still%20quite%20as%20SSH%20is%20disconnected%20even%20if%20you%20specify%20the%20%22%26%22%0A%0A%23%23%23%23%20Firewall%20%26%20Scheduled%20Tasks%0AConfigure%20the%20firewall%3A%0A%21%5BAlt%20text%5D%28./1501376973009.png%29%0A-%208085%3A%20HA-Bridge%20server%0A-%208080%3A%20broadlink-http-rest%20server%0A-%208443%3A%20Domoticz%20HTTPS%20service%0A-%209000%3A%20Domoticz%20Broadlink%20web%20service%0A%0AAlso%20the%20scheduled%20tasks%3A%0A%21%5BAlt%20text%5D%28./1501377068095.png%29%0A%0A%23%23%23%23%20Broadlink%20into%20Domoticz%0AThe%20steps%20are%3A%0A-%20In%20Setup-%3EHardware%2C%20create%20a%20Dummy%20Hardware%0A-%20In%20the%20same%20page%20and%20in%20the%20created%20item%2C%20click%20%22Create%20Virtual%20Sensors%22%0A-%20In%20Switches%20tab%2C%20find%20the%20virtual%20sensor%20you%20just%20created%2C%20%20click%20Edit%20and%20configure%20%22On%20Action%22%20and%20%22Off%20Action%22.%0A%21%5BAlt%20text%5D%28./1501376159204.png%29%0AHere%20the%20on/off%20action%20is%20to%20use%20broadlink-http-rest%20service%20to%20send%20broadlink%20commands%20for%20controlling%20the%20appliances.%20Before%20sending%20the%20commands%2C%20you%20have%20to%20also%20use%20broadlink-http-rest%20service%20to%20let%20broadlink%20to%20learn%20the%20code.%20For%20example%2C%20type%20http%3A//192.168.1.2%3A8080/learnCommand/open-ac%20in%20your%20browser%2C%20broadlink%20RM%20will%20enter%20learning%20mode.%20The%20orange%20light%20will%20be%20turned%20on.%20Then%20you%20need%20to%20push%20the%20button%20on%20the%20AC%20remote%20controller%20to%20let%20broadlink%20RM%20learn%20the%20IrDA%20or%20RF%20codes.%20You%20can%20use%20any%20names%20for%20this%20command%20instead%20of%20%22open-ac%22.%20As%20soon%20as%20the%20broadlink%20learns%20the%20code%2C%20you%20can%20put%20the%20address%20of%20%20http%3A//192.168.1.2%3A8080/sendCommand/open-ac%20to%20test%20your%20command.%20If%20it%20works%2C%20you%20can%20put%20it%20into%20your%20virtual%20sensor%20configuration%20page.%0A%23%23%23%23%20Domoticz%20into%20HA-Bridge%0APlease%20refer%20to%20reference%20link%202.%20From%20the%20chapter%20of%20Configuring%20HA%20bridge%2C%20it%20starts%20to%20describe%20how%20to%20configure%20HA-Bridge%20to%20import%20devices%20from%20Domoticz%20web%20service.%20%0A%21%5BAlt%20text%5D%28./1501401044317.png%29%0AAfter%20adding%20device%20from%20any%20device%20source%20like%20Domoticz.%0A%21%5BAlt%20text%5D%28./1501403754697.png%29%0ANow%20you%20can%20discover%20the%20devices%20by%20Alexa%20and%20also%20turn%20on/off%20them.%0A%0A%23%23%23%23%20HA-Bridge%20vs.%20Controlicz%0A%23%23%23%23%23%20General%20Smart%20Home%0AControlicz%20can%20integrate%20all%20type%20of%20devices%20into%20Alexa.%20For%20example%2C%20if%20Alexa%20doesn%27t%20have%20native%20support%20of%20this%20smart%20home%20device%2C%20you%20can%20build%20up%20a%20Domoticz%20server%20in%20your%20home%20and%20integrate%20it%20into%20Alexa%20by%20Controlicz.%20According%20to%20the%20description%20in%20Controlicz%20official%20site%2C%20it%20doesn%27t%20only%20support%20on/off%20switches%2C%20but%20also%20other%20normal%20appliance%20like%20TV%2C%20AC%20and%20etc.%20And%20Domoticz%20apparently%20support%20a%20lot%20more%20devices%20than%20Alexa%20does.%0A%21%5BAlt%20text%5D%28./1501404140819.png%29%0AHA-Bridge%20is%20simulating%20HUE%20light.%20To%20Alexa%2C%20these%20HA-Bridge%20based%20device%20is%20a%20HUE%20light.%20So%20it%20can%20only%20support%20on/off%20and%20dim%203%20actions.%0AFrom%20this%20point%20of%20view%2C%20these%202%20should%20not%20be%20put%20together%20for%20comparison.%20Controlicz%20is%20much%20stronger%20than%20HA-Bridge.%0A%0A%23%23%23%23%23%20%20Broadlink%20Integration%0ATo%20integrate%20Broadlink%2C%20these%202%20have%20their%20own%20pros%20and%20cons.%0ABroadlink%20is%20a%20universal%20remote%20controller.%20So%20every%20devices%20on%20Broadlink%20is%20a%20push%20button%20device.%20Each%20one%20only%20has%20one%20action%2C%20which%20is%20being%20triggered.%20This%20is%20even%20weaker%20than%20the%20on/off%20switch%2C%20which%20at%20lease%20has%202%20actions%20-%20on%20or%20off.%0AFor%20example%2C%20there%20is%20a%20button%20on%20Fan%27s%20remote%20controller.%20Pushing%20it%20once%2C%20it%20will%20turn%20on%20the%20fan%20and%20twice%20will%20turn%20off%20it.%20Through%20Controlicz%2C%20you%20have%20to%20say%20%22Turn%20on%20the%20Fan%22%20to%20Alexa%20to%20turn%20on%20the%20fan%20and%20you%20have%20to%20say%20the%20same%20sentence%20to%20close%20it.%20Is%20it%20weird%3F%0AIf%20you%20are%20using%20HA-Bridge%2C%20you%20can%20say%20%22Turn%20on%20...%22%20to%20turn%20on%20and%20%22Turn%20off%20...%22%20to%20turn%20off.%20Is%20it%20better%3F%0AThe%20biggest%20benefit%20of%20using%20Controlicz%20to%20integrate%20Domoticz%20is%20it%20can%20import%20all%20devices%20pre-defined%20in%20E-Control%20app.%20It%20can%20fully%20make%20use%20of%20the%20E-Control%27s%20GUI.%20You%20don%27t%20need%20to%20add%20virtual%20sensors%20one%20by%20one%20manually.%0A%0A%23%23%23%20Broadlink%20Native%20Skill%20+%20IHC%0AAfter%20bunch%20of%20work%20above%2C%20I%20happened%20to%20see%20there%20is%20a%20native%20support%20broadlink%20Alexa%20skill%20called%20%22broadlink%22.%20It%20should%20work%20with%20the%20latest%20version%20of%20IHC%20app.%20The%20bad%20news%20is%20both%20the%20skill%20and%20the%20app%20have%20very%20low%20review%20scores.%0A-%20IHC%20playstore%202.2%20stars%0A-%20Alexa%20Broadlink%20Skill%202.3%20stars%0A%0AAccording%20to%20the%20official%20examples%2C%20it%20can%20only%20support%20TV.%20And%20as%20my%20own%20experiments%2C%20when%20I%20added%20a%20TV%20and%20an%20AC%2C%20Alexa%20can%20only%20discover%20the%20TV%20and%20no%20AC.%0A%0A%0A%23%23%20Reference%20Links%0A1.%20%5B5%20open%20source%20home%20automation%20tools%5D%28https%3A//opensource.com/life/16/3/5-open-source-home-automation-tools%29%0A2.%20%5BAlex%20-%20Domoticz%5D%28https%3A//www.domoticz.com/wiki/Alexa%29%0A3.%20%5BDomoticz%20Wiki%20Plugins/BroadlinkRM2%5D%28http%3A//www.domoticz.com/wiki/Plugins/BroadlinkRM2.html%23First_Time_Users%29%0A4.%20%5B%23%u539F%u521B%u65B0%u4EBA%23%20%u7FA4%u6656%u5B89%u88C5broadlink-http-rest%u4EE3%u66FFRMBridge_%u751F%u6D3B%u8BB0%u5F55_%u4EC0%u4E48%u503C%u5F97%u4E70%5D%28https%3A//post.smzdm.com/p/551024/%29]]></content>
      <tags>
        <tag>synology</tag>
        <tag>IoT</tag>
        <tag>broadlink</tag>
        <tag>domoticz</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Domoticz + BroadLink + Synology + Amazon Echo实现智能家居]]></title>
    <url>%2F2017%2F07%2F24%2FDomoticz_%2B_BroadLink_%2B_Synology_%2B_Amazon_Echo%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%2F</url>
    <content type="text"><![CDATA[EditOverview&#x6B64;&#x4E8B;&#x7F18;&#x8D77;&#x4E8E;&#x5728;&#x7F8E;&#x5E1D;&#x4E70;&#x4E86;Amazon Echo&#xFF0C;&#x60F3;&#x7740;&#x56DE;&#x6765;&#x53EF;&#x4EE5;&#x5728;&#x5BB6;&#x91CC;&#x591A;&#x8BF4;&#x82F1;&#x8BED;&#xFF0C;&#x7ED9;&#x513F;&#x5B50;&#x4E00;&#x4E9B;&#x718F;&#x9676;&#xFF0C;&#x4E5F;&#x662F;&#x4E2A;&#x5927;&#x73A9;&#x5177;&#xFF0C;&#x8BF4;&#x4E0D;&#x5B9A;&#x4EBA;&#x5BB6;&#x4F1A;&#x7231;&#x4E0A;&#x5462;&#x3002;&#x540E;&#x6765;&#x60F3;&#x7740;&#x6574;&#x5929;&#x5BF9;Alexa&#x543C;&#x8FD9;&#x543C;&#x90A3;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x5524;&#x4ED6;&#x5E2E;&#x54B1;&#x5F00;&#x7A7A;&#x8C03;&#xFF0C;&#x5F00;&#x7535;&#x89C6;&#xFF0C;&#x5F00;&#x706F;&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x7528;&#x6574;&#x5929;&#x64CD;&#x5FC3;&#x9065;&#x63A7;&#x5668;&#x4E86;&#x5417;&#x3002;&#x5C24;&#x5176;&#xFF0C;&#x6574;&#x5929;&#x76EF;&#x7740;&#x9065;&#x63A7;&#x5668;&#x7684;&#x4E3B;&#xFF0C;&#x62CE;&#x7740;&#x9065;&#x63A7;&#x5668;&#x4E00;&#x6447;&#x4E00;&#x6446;&#x5C31;&#x8D70;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x6492;&#x7740;&#x6B22;&#x513F;&#x8DD1;&#x56DE;&#x6765;&#xFF0C;&#x9065;&#x63A7;&#x5668;&#x5C31;&#x4E0D;&#x77E5;&#x9053;&#x4E22;&#x54EA;&#x513F;&#x4E86;&#x3002; &#x9996;&#x5148;&#x67E5;&#x5230;&#x7684;&#x662F;BroadLink&#x914D;&#x4EF6;&#xFF0C;&#x8FD9;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;WiFi&#x8F6C;&#x7EA2;&#x5916;+&#x5C04;&#x9891;&#x7684;&#x914D;&#x4EF6;&#x3002;&#x6211;&#x4E70;&#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x3002;&#x901A;&#x8FC7;&#x5176;&#x81EA;&#x5E26;&#x7684;&#x5B66;&#x4E60;&#x6A21;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x5B66;&#x4E60;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x9065;&#x63A7;&#x5668;&#x7684;&#x9065;&#x63A7;&#x7801;&#x3002;&#x914D;&#x5408;Broadlink&#x81EA;&#x5BB6;&#x7684;app&#x5C31;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x9065;&#x63A7;&#x5668;&#x7535;&#x5B50;&#x5316;&#x4E86;&#x3002;Broadlink&#x6709;&#x5B89;&#x5353;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;app&#xFF1A;e-control IHC&#x53EA;&#x6709;play store&#x4E0A;&#x6709;&#x4E0D;&#x591F;&#x5B8C;&#x7F8E;&#x7684;&#x662F;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x638F;&#x51FA;&#x4E2A;&#x624B;&#x673A;&#xFF0C;&#x7FFB;&#x627E;app&#xFF0C;&#x4E00;&#x5806;&#x4E71;&#x70B9;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x6211;&#x60F3;&#x8981;&#x7684;&#x3002;&#x7EE7;&#x7EED;&#x767E;&#x5EA6;&#xFF0C;Google&#xFF0C;&#x5982;&#x679C;&#x8981;&#x6574;&#x5408;Amazon Echo&#x2014;&#x2014;&#x4E0B;&#x6587;&#x7B80;&#x79F0;Alexa&#x4EE5;&#x56FE;&#x65B9;&#x4FBF;&#xFF0C;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#xFF1A;&#x672C;&#x8EAB;&#x662F;&#x667A;&#x80FD;&#x5316;&#x5BB6;&#x5C45;&#xFF0C;&#x5E76;&#x4E14;&#x5382;&#x5BB6;&#x6709;&#x5BF9;&#x5E94;&#x7684;Skill&#xFF0C;enable&#x8BE5;Skill&#x5373;&#x53EF;&#xFF0C;&#x597D;&#x5904;&#x662F;&#x5404;&#x79CD;&#x539F;&#x751F;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;:&#x7A7A;&#x8C03;&#x8BBE;&#x51E0;&#x5EA6;&#xFF0C;&#x706F;&#x5F00;&#x4EC0;&#x4E48;&#x989C;&#x8272;&#x96C6;&#x6210;BroadLink&#xFF0C;&#x8BA9;Alexa&#x64CD;&#x4F5C;BroadLink&#xFF0C;&#x6B64;&#x65B9;&#x6848;&#x4ECD;&#x7136;&#x6709;&#x591A;&#x79CD;&#x5B50;&#x65B9;&#x6848;&#xFF1A; 1) Android + Broadlink RM Plugin + Alexa 2) Domoticz/Home Assistant + HA-Bridge + Alexa 3) Domoticz + python plugin + controlicz + Alexa 4) Broadlink&#x539F;&#x751F;skill + AlexaDomoticz/Home Assistant + HomeBridge + Siri&#x5176;&#x4E2D;Domoticz&#x548C;Home Assistant&#x5747;&#x4E3A;Home Automation System&#xFF0C;&#x7F51;&#x4E0A;&#x4E24;&#x8005;&#x90FD;&#x6709;&#x5F88;&#x591A;&#x4EBA;&#x5B9E;&#x8DF5;&#xFF0C;&#x5404;&#x6709;&#x4F18;&#x52A3;&#x3002;&#x5728;&#x53C2;&#x8003;&#x94FE;&#x63A5;&#x4E2D;&#x4E13;&#x95E8;&#x5BF9;5&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x4E86;&#x6BD4;&#x8F83;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x6709;Synology NAS&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;&#x539F;&#x751F;&#x96C6;&#x6210;&#xFF0C;&#x6240;&#x4EE5;&#x6BEB;&#x4E0D;&#x72B9;&#x8C6B;&#x9009;&#x62E9;&#x4E86;Domoticz&#x3002;&#x5145;&#x5206;&#x53D1;&#x6325;NAS 7*24&#x5C0F;&#x65F6;&#x4E0D;&#x4E0B;&#x7EBF;&#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x5B9E;&#x73B0;&#x667A;&#x80FD;&#x5BB6;&#x5EAD;&#x7F51;&#x5173;&#x3002;&#x9488;&#x5BF9;&#x7B2C;&#x4E8C;&#x70B9;&#x4E2D;&#x7684;&#x540E;3&#x4E2A;(2-4)&#x65B9;&#x6848;&#x5168;&#x90E8;&#x8FDB;&#x884C;&#x4E86;&#x5B9E;&#x73B0;&#x3002;&#x540E;&#x9762;&#x4F1A;&#x4E00;&#x4E00;&#x5217;&#x8FF0;&#x3002;&#x6700;&#x7EC8;&#x65B9;&#x6848;&#x67B6;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;Domoticz into Synology&#x8FD9;&#x4E2A;&#x8D85;&#x7EA7;&#x7B80;&#x5355;&#x3002;&#x6709;&#x5B98;&#x65B9;&#x652F;&#x6301;Domoticz for Synology NAS&#x3002;&#x9009;&#x62E9;Domoticz for Synology DSM 6.1 with Python Plugin Beta&#x3002;python plugin&#x7CFB;&#x7EDF;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x7528;&#x5230;&#x3002; &#x4E0B;&#x8F7D;&#x7684;&#x662F;.spk&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x662F;Synology DSM&#x7CFB;&#x7EDF;&#x7684;&#x5B89;&#x88C5;&#x5305;&#x3002;&#x76F4;&#x63A5;&#x5728;Package Center&#x4E2D;&#x9009;&#x62E9;Manual Install&#x5373;&#x53EF;&#x3002;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x540E;&#x5982;&#x4E0B;&#x56FE;&#x3002;&#x5176;&#x4ED6;&#x4F9D;&#x8D56;&#x5305;Domoticz&#x7684;python&#x63D2;&#x4EF6;&#x7CFB;&#x7EDF;&#x4F9D;&#x8D56;&#x4E8E;Python3 broadlink-http-rest server&#x4F9D;&#x8D56;&#x4E8E;Python2 HA-Bridge Server&#x4F9D;&#x8D56;&#x4E8E; Java8 &#x6700;&#x597D;&#x518D;&#x88C5;&#x4E0A;git&#xFF0C;&#x65B9;&#x4FBF;checkout GitHub&#x4E0A;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE; &#x6240;&#x4EE5;&#x8FD9;&#x56DB;&#x4E2A;&#x5305;&#x90FD;&#x5F97;&#x5B89;&#x88C5;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;Broadlink into DomoticzDomoticz Broadlink Python Plugin + Controlicz&#x8FD9;&#x662F;&#x672C;&#x7BC7;&#x4E2D;&#x6700;&#x7CDF;&#x5FC3;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x9677;&#x9631;&#x65E0;&#x6570;&#x3002;&#x540E;&#x9762;&#x4E13;&#x5F55;&#x8E29;&#x5751;&#x8BB0;&#x5F55;&#x3002; Domoticz Broadlink plugin&#x548C;broadlink-http-rest&#x5747;&#x662F;&#x57FA;&#x4E8E;python-broadlink&#x3002;&#x6240;&#x4EE5;&#x8981;&#x5148;&#x5B89;&#x88C5;python-broadlink&#x3002;&#x5B89;&#x88C5;python-broadlink&#x5728;&#x5F88;&#x591A;&#x6587;&#x7AE0;&#x4E2D;python-broadlink&#x90FD;&#x662F;&#x7528;pip&#x6765;&#x5B89;&#x88C5;&#xFF0C;&#x4F8B;&#x5982;pip3 install broadlink&#x3002;&#x4F46;&#x662F;&#x7531;&#x4E8E;broadlink&#x57FA;&#x4E8E;pycrypto&#xFF0C;&#x800C;&#x5B89;&#x88C5;pycrypto&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8981;&#x5728;&#x672C;&#x5730;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x3002;Synology NAS&#x4E0A;&#x663E;&#x7136;&#x6CA1;&#x6709;&#x7F16;&#x8BD1;&#x73AF;&#x5883;(GCC and etc.)&#x3002;&#x6240;&#x4EE5;&#x5B89;&#x88C5;&#x4F1A;&#x5931;&#x8D25;&#x3002;&#x4F46;&#x662F;&#x6839;&#x636E;&#x4F5C;&#x8005;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x6700;&#x65B0;&#x7684;python-broadlink&#x5E76;&#x4E0D;&#x57FA;&#x4E8E;pycrypto&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;pycrypto&#x5DF2;&#x7ECF;&#x88AB;&#x5F03;&#x5751;&#x4E86;&#x3002;&#x6700;&#x65B0;&#x7684;python-broadlink&#x57FA;&#x4E8E;pyaes&#x5E93;&#x6765;&#x5B9E;&#x73B0;&#x52A0;&#x89E3;&#x5BC6;&#x3002;&#x6240;&#x4EE5;&#x6B63;&#x786E;&#x7684;&#x6B65;&#x9AA4;&#x662F;&#xFF1A;&#x786E;&#x4FDD;&#x4F7F;&#x7528;python3git clone python-broadlink&#x5207;&#x5230;python-broadlink&#x76EE;&#x5F55;&#xFF0C;python setup.py installpython -m pip install pyaes&#x56E0;&#x4E3A;Synology&#x4E0A;&#x65E0;&#x6CD5;&#x5B89;&#x88C5;pip3&#xFF0C;&#x8FD9;&#x662F;&#x53D8;&#x901A;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x4F7F;&#x7528;python get-pip.py&#x5B89;&#x88C5;&#x7684;&#x4ECD;&#x7136;&#x662F;pip2&#x5B89;&#x88C5;Domoticz Python Plugin&#x53C2;&#x8003;&#x94FE;&#x63A5;3&#x662F;&#x63D2;&#x4EF6;&#x4F5C;&#x8005;&#x63D0;&#x4F9B;&#x7684;Domoiticz wiki&#x9875;&#xFF0C;&#x4E0D;&#x8FC7;&#x5168;&#x6587;&#x57FA;&#x4E8E;Windows&#xFF0C;&#x53C2;&#x8003;&#x5176;&#x4E2D;others&#x7AE0;&#x8282;&#xFF0C;&#x4ECD;&#x7136;&#x5F88;&#x597D;&#x7528;&#x3002;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;&#x4E0B;&#x8F7D;plugin filesDomoticz&#x7684;&#x63D2;&#x4EF6;&#x76EE;&#x5F55;&#x5728;/usr/local/domoticz/var/plugins/BroadlinkRM2/&#xFF0C;&#x62F7;&#x8D1D;&#x63D2;&#x4EF6;&#x6587;&#x4EF6;&#x5230;&#x8BE5;&#x76EE;&#x5F55;&#xFF0C;&#x5305;&#x62EC;&#xFF1A; plugin.py &#x2014;&#x2014;&#x63D2;&#x4EF6;&#x7684;&#x4E3B;&#x6587;&#x4EF6;plugin_send.pyplugin_http.pyplugin_http.sh &#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x63D2;&#x4EF6;&#x76EE;&#x5F55;&#x4E0D;&#x662F;/usr/local/domoticz/plugins/BroadlinkRM2/&#xFF0C;&#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x5E95;&#x4E0B;&#x6709;example&#x76EE;&#x5F55;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x63D2;&#x4EF6;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x4F46;&#x5F53;&#x6211;&#x628A;&#x63D2;&#x4EF6;&#x6587;&#x4EF6;&#x653E;&#x5728;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x65F6;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x63D2;&#x4EF6;&#x672A;&#x52A0;&#x8F7D;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5728;Synology DSM&#x7684;Package Center&#x4E2D;&#x91CD;&#x542F;Domoticz&#x3002;&#x6CE8;&#x610F;&#x540E;&#x9762;&#x6BCF;&#x6B21;&#x4FEE;&#x6539;plugin&#x90FD;&#x9700;&#x8981;&#x91CD;&#x542F;Domoticz&#x3002; &#x81F3;&#x6B64;&#x5B89;&#x88C5;&#x5C31;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x5728;Domoticz&#x4E2D;&#x6DFB;&#x52A0;BroadLink&#x8BBE;&#x5907;&#x5982;&#x56FE;&#x3002;&#x6DFB;&#x52A0;Broadlink Hardware&#x6309;&#x7167;&#x63D2;&#x4EF6;&#x4F5C;&#x8005;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x4E0B;&#x9762;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;Hardware&#xFF0C;&#x5E76;&#x53EF;&#x4EE5;Discover Broadlink&#x8BBE;&#x5907;&#xFF0C;&#x6DFB;&#x52A0;Hardware&#x5982;&#x4E0B;&#x56FE;&#xFF1A;&#x5BFC;&#x5165;&#x6613;&#x63A7;(e-control)&#x8BBE;&#x5907;&#x53C2;&#x8003;&#x94FE;&#x63A5;3&#x4E2D;&#x4E5F;&#x6709;&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x3002;&#x5728;User Guide-&gt;Inside Domoticz-&gt;xxx - import&#x3002;&#x53EF;&#x80FD;&#x4F5C;&#x8005;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x975E;&#x591A;&#x5B57;&#x8282;&#x8BED;&#x8A00;&#xFF0C;&#x5728;&#x5904;&#x7406;&#x5BFC;&#x5165;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x82E5;&#x542B;&#x6709;&#x4E2D;&#x6587;&#x5B57;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x5931;&#x8D25;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x53C2;&#x89C1;&#x8E29;&#x5751;&#x8BB0;&#x5F55;&#x4E2D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002; &#x53E6;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x70B9;&#x51FB;WebStart&#x4EE5;&#x540E;&#xFF0C;Domoticz&#x4F1A;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x4E8E;9000&#x7684;web&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7528;&#x4EE5;&#x4E0A;&#x4F20;&#x6613;&#x63A7;&#x7684;&#x8BBE;&#x5907;&#x6587;&#x4EF6;(jsonButton, jsonIrCode, jsonSubIr)&#x3002;&#x8981;&#x6CE8;&#x610F;NAS&#x7684;Firewall&#x914D;&#x7F6E;&#x3002;Controlicz&#x5728;&#x641C;&#x7D22;&#x5230;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x9C9C;&#x6709;&#x63D0;&#x53CA;&#x3002;&#x6211;&#x4E5F;&#x662F;&#x5728;&#x5076;&#x7136;&#x7684;&#x7FFB;&#x9605;&#x4E2D;&#x53D1;&#x73B0;&#x4E86;&#x8FD9;&#x4E2A;Alexa Skill&#x3002;&#x4F7F;&#x7528;Controlicz&#x5C31;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x901A;&#x8FC7;HA-Bridge&#x6765;&#x66F2;&#x7EBF;&#x6551;&#x56FD;&#x4E86;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#x53D1;&#x73B0;&#x8FD8;&#x662F;&#x5404;&#x6709;&#x5229;&#x5F0A;&#x3002;&#x540E;&#x6587;&#x8BB2;&#x5B8C;HA-Bridge&#x7AE0;&#x8282;&#xFF0C;&#x4F1A;&#x63D0;&#x5230;&#x4E24;&#x8005;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#x3002; &#x4F7F;&#x7528;Controlicz&#x7684;&#x65B9;&#x6CD5;&#x662F;&#xFF1A;&#x4F7F;&#x7528;Alexa&#x7684;&#x8D26;&#x53F7;&#x6765;&#x6CE8;&#x518C;ControliczAlexa app&#x4E0A;enable skill&#x5C31;&#x597D;&#x4E86;&#x5BF9;&#x7740;Alexa&#x8BF4;discover device &#x6CE8;&#x610F;&#xFF1A;Controlcz&#x4E2D;&#x8981;&#x6C42;&#xFF1A; Domoticz&#x670D;&#x52A1;&#x5FC5;&#x987B;&#x5916;&#x7F51;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x914D;&#x7F6E;&#x5BB6;&#x91CC;&#x7684;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#xFF0C;&#x4EE5;&#x53CA;DDNS&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x7684;&#x662F;Synology&#xFF0C;&#x8FD9;&#x4E2A;&#x6211;&#x65E9;&#x5C31;&#x5DF2;&#x7ECF;&#x6709;&#x4E86; Controlicz&#x8981;&#x6C42;Domoticz&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x4E8E;HTTPS&#x534F;&#x8BAE;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x4F7F;&#x80FD;8443&#x7AEF;&#x53E3;&#xFF0C;&#x6CE8;&#x610F;NAS&#x7684;Firewall&#x914D;&#x7F6E; &#x8E29;&#x5751;&#x8BB0;&#x5F55;&#x81F3;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x5B8C;&#x6210;&#x4E0A;&#x9762;&#x6240;&#x6709;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5BF9;Alexa&#x8BF4;&#x201D;Turn on the TV&#x201D;&#xFF0C;&#x5E94;&#x8BE5;&#x5DF2;&#x7ECF;&#x4F1A;&#x6709;&#x6B63;&#x786E;&#x54CD;&#x5E94;&#x4E86;&#x3002;&#x4F46;&#x9057;&#x61BE;&#x7684;&#x662F;&#xFF0C;&#x4E2D;&#x95F4;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x8981;&#x505A;&#xFF1A;Import Error &#x201C;broadlink&#x201D;&#x660E;&#x660E;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x4E86;python-broadlink&#xFF0C;&#x800C;&#x4E14;&#x5728;REPL&#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x6B63;&#x786E;import&#xFF0C;&#x4F46;&#x662F;Domoticz log&#x4E2D;&#x59CB;&#x7EC8;&#x62A5;&#x9519;&#x3002;&#x539F;&#x56E0;&#x662F;PYTHONPATH&#x4E0D;&#x6B63;&#x786E;&#x3002;&#x5728;plugin.py&#x4E2D;&#x5DF2;&#x6709;&#x5904;&#x7406;&#xFF1A;if sys.platform.startswith(&apos;linux&apos;): # linux specific code here # doesn&apos;t work even if set dist-packages =&gt; site-packages sys.path.append(os.path.dirname(os.__file__) + &apos;/dist-packages&apos;)elif sys.platform.startswith(&apos;darwin&apos;): # mac sys.path.append(os.path.dirname(os.__file__) + &apos;/site-packages&apos;)elif sys.platform.startswith(&apos;win32&apos;): # win specific sys.path.append(os.path.dirname(os.__file__) + &apos;\site-packages&apos;)&#x6B63;&#x786E;&#x7684;broadlink&#x5E93;&#x8DEF;&#x5F84;&#x662F;`/usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/`&#x3002;&#x4E0A;&#x9762;linux&#x7CFB;&#x7EDF;&#x7684;&#x8DEF;&#x5F84;&#x662F;dist-package&#x3002;&#x4E0D;&#x8FC7;&#x5373;&#x4FBF;&#x6539;&#x6210;site-packages&#xFF0C;&#x4F9D;&#x7136;&#x62A5;&#x540C;&#x6837;&#x7684;&#x9519;&#x8BEF;&#x3002;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x7B80;&#x5355;&#x660E;&#x4E86;&#xFF0C;&#x5C06;broadlink&#x76EE;&#x5F55;&#x62F7;&#x5230;plugins&#x76EE;&#x5F55;&#x4E0B;&#x9762;&#x5373;&#x53EF;cp -r /usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/ /usr/local/domoticz/var/plugins/BroadlinkRM2/Error Connecting to Broadlink device&#x6709;&#x4E24;&#x4E2A;GitHub issue&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x770B;&#xFF1A;Error Connecting to Broadlink device #107lpad fix broken? #97 &#x6216;&#x8BB8;&#x4F1A;&#x6709;&#x5E2E;&#x52A9;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x6211;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x662F;&#x6B63;&#x89E3;&#x3002; Root cause&#x662F;bytes&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x4E0D;&#x5BF9;&#xFF0C;&#x9519;&#x8BEF;&#x7684;&#x5730;&#x65B9;&#x5728;&#x8FD9;&#x91CC;# broadlink/__init__.py160 def encrypt_pyaes(self, payload):161 aes = pyaes.AESModeOfOperationCBC(self.key, iv = bytes(self.iv))162 return &quot;&quot;.join([aes.encrypt(bytes(payload[i:i+16])) for i in range(0, len(payload), 16)]) # &lt;==== Error is herepython3&#x4E2D;bytes&#x8FD4;&#x56DE;class bytes&#xFF0C;&#x800C;python2&#x4E2D;&#x8FD4;&#x56DE;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;Python2&gt;&gt;&gt; type(bytes([1,2,3]))&lt;type &apos;str&apos;&gt;Python3&gt;&gt;&gt; type(bytes([1,2,3]))&lt;class &apos;bytes&apos;&gt;&gt;&gt;&gt; &quot;&quot;.join([bytes([1,2]),bytes([2,3])]) &lt;==== You cannot cat 2 bytes class objects as stringTraceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;TypeError: sequence item 0: expected str instance, bytes found&gt;&gt;&gt; b&apos;&apos;.join([bytes([1,2]),bytes([2,3])]) &lt;==== This is the good wayb&apos;\x01\x02\x02\x03&apos;&#x597D;&#x4E86;&#x4FEE;&#x6539;plugin.py&#x5BF9;&#x5E94;&#x7684;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;Domoticz import&#x6587;&#x4EF6;&#x4E2D;&#x6709;&#x4E2D;&#x6587;&#x7684;&#x95EE;&#x9898;&#x5728;Python3&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x6709;&#x7F16;&#x7801;&#x95EE;&#x9898;&#xFF0C;&#x4F8B;&#x5982;&#x5305;&#x542B;&#x4E2D;&#x6587;&#xFF0C;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x6765;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x5E76;&#x89E3;&#x7801;&#xFF1A;with open(&apos;jsonFile&apos;) as f: textStr = f.read() &lt;=== Python3 will complain about the codec error here. textStr.decode(&apos;utf8&apos;)&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x5E94;&#x5F53;&#x662F;with open(&apos;jsonFile&apos;, encoding=&apos;utf8&apos;): textStr = f.read() &lt;=== Everything here has already been unicode.&#x6240;&#x4EE5;&#x4FEE;&#x6539;&#x6240;&#x6709;plugin.py&#x4E2D;&#x7684;open&#x8BED;&#x53E5;&#x5373;&#x53EF;&#x3002; &#x8FD8;&#x6709;&#x4E00;&#x5904;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x662F;&#x9488;&#x5BF9;ConfigParser&#x7684;&#x7F16;&#x7801;&#x95EE;&#x9898;&#x3002;&#x5982;&#x4E0B;&#x662F;&#x6211;&#x4FEE;&#x6539;&#x597D;&#x7684;&#xFF1A;config = configparser.ConfigParser()config.read(path, encoding=&apos;utf8&apos;)&#x73B0;&#x5728;&#x8BD5;&#x4E00;&#x8BD5;&#xFF0C;&#x8FDE;&#x63A5;&#xFF0C;&#x53D1;&#x73B0;&#xFF0C;&#x5BFC;&#x5165;&#xFF0C;&#x5E94;&#x8BE5;&#x90FD;&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#x5427;&#x3002;Domoticz + broadlink-http-rest + HA-Bridge&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x4E0D;&#x9700;&#x8981;&#x501F;&#x52A9;Broadlink&#x7684;Domoticz python&#x63D2;&#x4EF6;&#xFF0C;&#x800C;&#x662F;&#x5229;&#x7528;Domoticz&#x4E2D;&#x7684;Dummy Hardware&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;&#x5B89;&#x88C5;HA-BridgeHA-Bridge&#x662F;&#x5C06;Alexa&#x4E0D;&#x652F;&#x6301;&#x7684;&#x8BBE;&#x5907;&#x6A21;&#x62DF;&#x6210;Alexa&#x539F;&#x751F;&#x652F;&#x6301;&#x7684;Philips HUE Light&#x3002;&#x800C;HA-Bridge&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5BFC;&#x5165;Domoticz&#x4E2D;&#x7684;&#x6240;&#x6709;&#x8BBE;&#x5907;&#x3002;&#x7F3A;&#x70B9;&#x662F;&#xFF0C;&#x4ED6;&#x53EA;&#x80FD;&#x652F;&#x6301;&#x5F00;&#x5173;&#x548C;&#x8C03;&#x4EAE;&#x5EA6;&#x7684;&#x64CD;&#x4F5C;&#x3002; HA-Bridge&#x662F;&#x4E00;&#x4E2A;java&#x7684;jar&#x5305;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5C06;&#x4E4B;&#x4F5C;&#x4E3A;service&#x8FD0;&#x884C;&#x5728;Synology&#x540E;&#x53F0;&#xFF0C;&#x65B9;&#x6CD5;&#x53C2;&#x770B;Run as a service on Synology&#x3002; &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8FD0;&#x884C;&#x547D;&#x4EE4;nohup java -jar -Dserver.port=8085 /ha-bridge-4.5.6.jar &amp; &#x6CE8;&#x610F;&#x653E;&#x5230;Synology&#x7684;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;&#x91CC;&#x3002;&#x5B89;&#x88C5;broadlink-http-rest&#x4ECE;GitHub&#x4E0A;clone&#x4E0B;broadlink-http-rest&#x3002;&#x7136;&#x540E;&#x548C;HA-Bridge&#x4E00;&#x6837;&#xFF0C;&#x8981;&#x4EE5;service&#x7684;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#x5728;&#x540E;&#x53F0;&#x3002;&#x5426;&#x5219;ssh&#x8FDE;&#x63A5;&#x4E00;&#x65AD;&#x5F00;&#xFF0C;server&#x5C31;&#x9000;&#x51FA;&#x4E86;&#x3002;&#x547D;&#x4EE4;&#x4E3A;nohup python broadlink-http-rest/server.py &amp; &#x6CE8;&#x610F;&#x8981;&#x7528;nohup&#xFF0C;&#x5426;&#x5219;serveer&#x4ECD;&#x7136;&#x4F1A;&#x968F;&#x7740;ssh&#x65AD;&#x5F00;&#x800C;&#x9000;&#x51FA;&#x3002;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;&amp;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;&#x597D;&#x9632;&#x706B;&#x5899;&#xFF1A;8085: HA-Bridge server8080: broadlink-http-rest server8443: Domoticz HTTPS service9000: Domoticz Broadlink web service&#x914D;&#x7F6E;&#x597D;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;&#xFF1A;Broadlink into Domoticz&#x5728;Setup-&gt;Hardware&#x4E0B;&#x5EFA;&#x7ACB;Dummy Hardware&#xFF0C;&#x7136;&#x540E;&#x70B9;&#x51FB;Create Virtual Sensors&#xFF0C;&#x7136;&#x540E;&#x5728;Switches tab&#x91CC;&#x627E;&#x5230;&#x521A;&#x5EFA;&#x597D;&#x7684;virtual sensor&#xFF0C;&#x70B9;&#x51FB;Edit&#xFF0C;&#x6309;&#x4E0B;&#x56FE;&#x914D;&#x7F6E;&#x597D;On Action&#x548C;Off Action&#x3002;Domoticz into HA-Bridge&#x53C2;&#x89C1;&#x53C2;&#x8003;&#x94FE;&#x63A5;2&#xFF0C;&#x4ECE;Configuring HA bridge&#x5F00;&#x59CB;&#x8BB2;&#x5982;&#x4F55;&#x914D;&#x7F6E;Domoticz&#x5230;HA-Bridge service&#x3002;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6DFB;&#x52A0;Domoticz&#x91CC;&#x7684;&#x8BBE;&#x5907;&#x4E86;&#x3002;HA-Bridge vs. ControliczGeneral Smart HomeControlicz&#x53EF;&#x4EE5;&#x6574;&#x5408;Domoticz&#x6240;&#x6709;&#x8BBE;&#x5907;&#x5230;Alexa&#x4E2D;&#xFF0C;&#x8B6C;&#x5982;&#xFF0C;&#x5982;&#x679C;Alexa&#x5E76;&#x4E0D;&#x539F;&#x751F;&#x652F;&#x6301;&#x8BE5;smart home&#x8BBE;&#x5907;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5148;&#x5728;&#x5BB6;&#x91CC;&#x642D;&#x5EFA;Domoticz&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;Controlicz&#x5C06;&#x4E4B;&#x6574;&#x5408;&#x5230;Alexa&#x4E2D;&#x3002;&#x6839;&#x636E;Controlicz&#x5B98;&#x7F51;support&#x5217;&#x8868;&#xFF0C;&#x5176;&#x5E76;&#x4E0D;&#x53EA;&#x5C40;&#x9650;&#x4E8E;&#x5F00;&#x5173;&#x8BBE;&#x5907;&#xFF1A;&#x6574;&#x5408;Broadlink&#x5728;&#x6574;&#x5408;Broadlink&#x4E0A;&#xFF0C;&#x4E24;&#x8005;&#x5C31;&#x5404;&#x6709;&#x80DC;&#x573A;&#x4E86;&#x3002;Broadlink&#x662F;&#x901A;&#x7528;&#x9065;&#x63A7;&#x5668;&#x3002;&#x6240;&#x4EE5;&#x901A;&#x8FC7;Broadlink&#x5BFC;&#x5165;&#x7684;&#x8BBE;&#x5907;&#x90FD;&#x662F;&#x6309;&#x94AE;&#x8BBE;&#x5907;&#xFF0C;&#x6BCF;&#x4E2A;&#x6309;&#x94AE;&#x90FD;&#x662F;&#x4E00;&#x4E2A;Push Button&#x8BBE;&#x5907;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x89E6;&#x53D1;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x6837;&#x4E5F;&#x5408;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x6309;&#x94AE;&#x53EA;&#x6709;&#x89E6;&#x53D1;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5F00;&#x72B6;&#x6001;&#x6216;&#x8005;&#x5173;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x751A;&#x81F3;&#x4E0D;&#x5982;&#x706F;&#x7684;&#x72B6;&#x6001;&#x591A;&#x3002; &#x4F8B;&#x5982;&#xFF1A;&#x4E00;&#x53F0;&#x7535;&#x98CE;&#x6247;&#x7684;&#x5F00;&#x5173;&#x6309;&#x94AE;&#xFF0C;&#x6309;&#x4E00;&#x4E0B;&#x662F;&#x5F00;&#xFF0C;&#x518D;&#x6309;&#x4E00;&#x4E0B;&#x662F;&#x5173;&#x3002;&#x5982;&#x679C;&#x901A;&#x8FC7;Controlicz&#x76F4;&#x63A5;&#x6574;&#x5408;Domoticz&#x6309;&#x94AE;&#x8BBE;&#x5907;&#xFF0C;&#x5219;&#x8981;&#x5F00;&#x7535;&#x98CE;&#x6247;&#xFF0C;&#x8981;&#x5BF9;Alexa&#x8BF4;&#x201C;Turn on the Fan&#x201D;&#xFF0C;&#x8981;&#x5173;&#x5219;&#x8FD8;&#x662F;&#x8BF4;&#x201C;Turn on the Fan&#x201D;&#x3002;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x70B9;&#x5947;&#x602A;&#x3002; &#x5982;&#x679C;&#x662F;HA-Bridge&#xFF0C;&#x9488;&#x5BF9;&#x5F00;&#x5173;&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BF4;&#x201C;Turn on the Fan&#x201D;&#x548C;&#x201C;Turn off the Fan&#x201D;&#x3002;&#x662F;&#x4E0D;&#x662F;&#x597D;&#x591A;&#x4E86;&#x3002; Controlicz&#x6574;&#x5408;Domoticz&#x7684;&#x597D;&#x5904;&#x5C31;&#x662F;&#xFF0C;Domoticz Broadlink Python plugin&#x652F;&#x6301;&#x76F4;&#x63A5;&#x4E00;&#x6B21;&#x6027;&#x4ECE;&#x6613;&#x63A7;&#x5BFC;&#x5165;&#x5DF2;&#x5B9A;&#x4E49;&#x8BBE;&#x5907;&#xFF0C;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x53D1;&#x6325;&#x6613;&#x63A7;GUI&#x7684;&#x7279;&#x70B9;&#xFF0C;&#x7701;&#x5F97;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x8BBE;&#x5907;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x4E86;&#x3002;Broadlink&#x539F;&#x751F;Skill + IHC&#x5728;&#x6574;&#x5B8C;&#x4E0A;&#x9762;&#x90A3;&#x4E00;&#x5927;&#x5806;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x7A81;&#x7136;&#x53D1;&#x73B0;&#x539F;&#x6765;Alexa&#x5DF2;&#x7ECF;&#x6709;Broadlink&#x7684;&#x539F;&#x751F;Skill&#x4E86;&#xFF0C;&#x4F46;&#x8981;&#x914D;&#x5408;&#x6700;&#x65B0;&#x7248;&#x7684;Broadlink IHC app&#x4F7F;&#x7528;&#x3002;&#x4E0D;&#x8FC7;&#x4EE4;&#x4EBA;&#x7CDF;&#x5FC3;&#x7684;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;app&#x7684;&#x8BC4;&#x5206;&#x90FD;&#x4F4E;&#x7684;&#x53EF;&#x601C;&#x3002;IHC playstore 2.2&#x5206;Alexa Broadlink Skill 2.3&#x5206; &#x4ECE;&#x5B98;&#x7F51;&#x7684;example&#x770B;&#x76EE;&#x524D;&#x53EA;&#x652F;&#x6301;TV&#x3002;&#x7ECF;&#x6211;&#x5B9E;&#x8DF5;&#x786E;&#x5B9E;&#x5982;&#x6B64;&#xFF0C;&#x6DFB;&#x52A0;&#x4E86;&#x7535;&#x89C6;&#x548C;&#x7A7A;&#x8C03;&#xFF0C;Alexa&#x5374;&#x53EA;&#x80FD;discover&#x5230;&#x7535;&#x89C6;&#xFF0C;&#x6CA1;&#x6709;&#x7A7A;&#x8C03;&#x3002;&#x53C2;&#x8003;&#x94FE;&#x63A5;5 open source home automation toolsAlex - DomoticzDomoticz Wiki Plugins/BroadlinkRM2#&#x539F;&#x521B;&#x65B0;&#x4EBA;# &#x7FA4;&#x6656;&#x5B89;&#x88C5;broadlink-http-rest&#x4EE3;&#x66FF;RMBridge_&#x751F;&#x6D3B;&#x8BB0;&#x5F55;_&#x4EC0;&#x4E48;&#x503C;&#x5F97;&#x4E70;%23Domoticz%20+%20BroadLink%20+%20Synology%20+%20Amazon%20Echo%u5B9E%u73B0%u667A%u80FD%u5BB6%u5C45%0A@%28myblog%29%5Bsynology%2C%20broadlink%2C%20domoticz%2C%20IoT%5D%0A%0A%23%23Overview%0A%u6B64%u4E8B%u7F18%u8D77%u4E8E%u5728%u7F8E%u5E1D%u4E70%u4E86Amazon%20Echo%uFF0C%u60F3%u7740%u56DE%u6765%u53EF%u4EE5%u5728%u5BB6%u91CC%u591A%u8BF4%u82F1%u8BED%uFF0C%u7ED9%u513F%u5B50%u4E00%u4E9B%u718F%u9676%uFF0C%u4E5F%u662F%u4E2A%u5927%u73A9%u5177%uFF0C%u8BF4%u4E0D%u5B9A%u4EBA%u5BB6%u4F1A%u7231%u4E0A%u5462%u3002%u540E%u6765%u60F3%u7740%u6574%u5929%u5BF9Alexa%u543C%u8FD9%u543C%u90A3%u7684%uFF0C%u5982%u679C%u80FD%u5524%u4ED6%u5E2E%u54B1%u5F00%u7A7A%u8C03%uFF0C%u5F00%u7535%u89C6%uFF0C%u5F00%u706F%uFF0C%u90A3%u5C31%u4E0D%u7528%u6574%u5929%u64CD%u5FC3%u9065%u63A7%u5668%u4E86%u5417%u3002%u5C24%u5176%uFF0C%u6574%u5929%u76EF%u7740%u9065%u63A7%u5668%u7684%u4E3B%uFF0C%u62CE%u7740%u9065%u63A7%u5668%u4E00%u6447%u4E00%u6446%u5C31%u8D70%u4E86%uFF0C%u7136%u540E%u6492%u7740%u6B22%u513F%u8DD1%u56DE%u6765%uFF0C%u9065%u63A7%u5668%u5C31%u4E0D%u77E5%u9053%u4E22%u54EA%u513F%u4E86%u3002%0A%u9996%u5148%u67E5%u5230%u7684%u662FBroadLink%u914D%u4EF6%uFF0C%u8FD9%u5176%u5B9E%u662F%u4E00%u4E2AWiFi%u8F6C%u7EA2%u5916+%u5C04%u9891%u7684%u914D%u4EF6%u3002%u6211%u4E70%u7684%u662F%5B%u8FD9%u4E2A%5D%28https%3A//detail.tmall.com/item.htm%3Fspm%3Da230r.1.14.8.ebb2eb2Gs49Vt%26id%3D43623542607%26cm_id%3D140105335569ed55e27b%26abbucket%3D13%26skuId%3D77095242268%29%u3002%u901A%u8FC7%u5176%u81EA%u5E26%u7684%u5B66%u4E60%u6A21%u5F0F%uFF0C%u53EF%u4EE5%u5B66%u4E60%u4EFB%u4F55%u4E00%u4E2A%u9065%u63A7%u5668%u7684%u9065%u63A7%u7801%u3002%u914D%u5408Broadlink%u81EA%u5BB6%u7684app%u5C31%u5DF2%u7ECF%u53EF%u4EE5%u5B9E%u73B0%u9065%u63A7%u5668%u7535%u5B50%u5316%u4E86%u3002Broadlink%u6709%u5B89%u5353%u4E0A%u6709%u4E24%u4E2Aapp%uFF1A%0A-%20%5Be-control%5D%28https%3A//play.google.com/store/apps/details%3Fid%3Dcom.broadlink.rmt%29%20%0A-%20%5BIHC%5D%28https%3A//play.google.com/store/apps/details%3Fid%3Dcn.com.broadlink.econtrol.plus%29%u53EA%u6709play%20store%u4E0A%u6709%0A%0A%u4E0D%u591F%u5B8C%u7F8E%u7684%u662F%u4ECD%u7136%u9700%u8981%u638F%u51FA%u4E2A%u624B%u673A%uFF0C%u7FFB%u627Eapp%uFF0C%u4E00%u5806%u4E71%u70B9%u3002%u8FD9%u4E0D%u662F%u6211%u60F3%u8981%u7684%u3002%0A%0A%u7EE7%u7EED%u767E%u5EA6%uFF0CGoogle%uFF0C%u5982%u679C%u8981%u6574%u5408Amazon%20Echo%u2014%u2014%u4E0B%u6587%u7B80%u79F0Alexa%u4EE5%u56FE%u65B9%u4FBF%uFF0C%u6709%u4EE5%u4E0B%u51E0%u79CD%u65B9%u6848%uFF1A%0A1.%20%u672C%u8EAB%u662F%u667A%u80FD%u5316%u5BB6%u5C45%uFF0C%u5E76%u4E14%u5382%u5BB6%u6709%u5BF9%u5E94%u7684Skill%uFF0Cenable%u8BE5Skill%u5373%u53EF%uFF0C%u597D%u5904%u662F%u5404%u79CD%u539F%u751F%u7684%u8BBE%u7F6E%uFF0C%u4F8B%u5982%3A%u7A7A%u8C03%u8BBE%u51E0%u5EA6%uFF0C%u706F%u5F00%u4EC0%u4E48%u989C%u8272%0A2.%20%u96C6%u6210BroadLink%uFF0C%u8BA9Alexa%u64CD%u4F5CBroadLink%uFF0C%u6B64%u65B9%u6848%u4ECD%u7136%u6709%u591A%u79CD%u5B50%u65B9%u6848%uFF1A%0A%091%29%20Android%20+%20%5BBroadlink%20RM%20Plugin%5D%28https%3A//play.google.com/store/apps/details%3Fid%3Dus.originally.tasker%29%20+%20Alexa%0A%092%29%20Domoticz/Home%20Assistant%20+%20%20%5BHA-Bridge%5D%28https%3A//github.com/bwssytems/ha-bridge%29%20+%20Alexa%0A%093%29%20Domoticz%20+%20python%20plugin%20+%20controlicz%20+%20Alexa%0A%094%29%20Broadlink%u539F%u751Fskill%20+%20Alexa%0A3.%20Domoticz/Home%20Assistant%20+%20HomeBridge%20+%20Siri%0A%0A%u5176%u4E2DDomoticz%u548CHome%20Assistant%u5747%u4E3AHome%20Automation%20System%uFF0C%u7F51%u4E0A%u4E24%u8005%u90FD%u6709%u5F88%u591A%u4EBA%u5B9E%u8DF5%uFF0C%u5404%u6709%u4F18%u52A3%u3002%u5728%u53C2%u8003%u94FE%u63A5%u4E2D%u4E13%u95E8%u5BF95%u79CD%u4E0D%u540C%u7684%u7CFB%u7EDF%u8FDB%u884C%u4E86%u6BD4%u8F83%u3002%u56E0%u4E3A%u6211%u6709Synology%20NAS%uFF0C%u53C8%u53EF%u4EE5%u539F%u751F%u96C6%u6210%uFF0C%u6240%u4EE5%u6BEB%u4E0D%u72B9%u8C6B%u9009%u62E9%u4E86Domoticz%u3002%u5145%u5206%u53D1%u6325NAS%207*24%u5C0F%u65F6%u4E0D%u4E0B%u7EBF%u7684%u4F18%u52BF%uFF0C%u5B9E%u73B0%u667A%u80FD%u5BB6%u5EAD%u7F51%u5173%u3002%u9488%u5BF9%u7B2C%u4E8C%u70B9%u4E2D%u7684%u540E3%u4E2A%282-4%29%u65B9%u6848%u5168%u90E8%u8FDB%u884C%u4E86%u5B9E%u73B0%u3002%u540E%u9762%u4F1A%u4E00%u4E00%u5217%u8FF0%u3002%u6700%u7EC8%u65B9%u6848%u67B6%u6784%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1501339487875.png%29%0A%0A%23%23%20Domoticz%20into%20Synology%0A%u8FD9%u4E2A%u8D85%u7EA7%u7B80%u5355%u3002%u6709%u5B98%u65B9%u652F%u6301%5BDomoticz%20for%20Synology%20NAS%5D%28http%3A//www.jadahl.com/%29%u3002%u9009%u62E9%5BDomoticz%20for%20Synology%20DSM%206.1%20with%20Python%20Plugin%20Beta%5D%28http%3A//www.jadahl.com/domoticz_beta_6.1_python/%29%u3002python%20plugin%u7CFB%u7EDF%u5F88%u91CD%u8981%uFF0C%u540E%u9762%u4F1A%u7528%u5230%u3002%0A%u4E0B%u8F7D%u7684%u662F.spk%u6587%u4EF6%uFF0C%u8FD9%u662FSynology%20DSM%u7CFB%u7EDF%u7684%u5B89%u88C5%u5305%u3002%u76F4%u63A5%u5728Package%20Center%u4E2D%u9009%u62E9Manual%20Install%u5373%u53EF%u3002%u5B89%u88C5%u6210%u529F%u540E%u5982%u4E0B%u56FE%u3002%0A%21%5BAlt%20text%5D%28./1501340457645.png%29%0A%0A%23%23%20%u5176%u4ED6%u4F9D%u8D56%u5305%0ADomoticz%u7684python%u63D2%u4EF6%u7CFB%u7EDF%u4F9D%u8D56%u4E8EPython3%0Abroadlink-http-rest%20server%u4F9D%u8D56%u4E8EPython2%0A%5BHA-Bridge%20Server%5D%28https%3A//github.com/bwssytems/ha-bridge%29%u4F9D%u8D56%u4E8E%20Java8%0A%u6700%u597D%u518D%u88C5%u4E0Agit%uFF0C%u65B9%u4FBFcheckout%20GitHub%u4E0A%u7684%u5F00%u6E90%u9879%u76EE%0A%u6240%u4EE5%u8FD9%u56DB%u4E2A%u5305%u90FD%u5F97%u5B89%u88C5%uFF0C%u5982%u4E0B%u56FE%0A%21%5BAlt%20text%5D%28./1501340796886.png%29%21%5BAlt%20text%5D%28./1501340823935.png%29%21%5BAlt%20text%5D%28./1501340847466.png%29%0A%0A%23%23%20Broadlink%20into%20Domoticz%0A%0A%23%23%23%20Domoticz%20Broadlink%20Python%20Plugin%20+%20Controlicz%0A%u8FD9%u662F%u672C%u7BC7%u4E2D%u6700%u7CDF%u5FC3%u7684%u90E8%u5206%uFF0C%u9677%u9631%u65E0%u6570%u3002%u540E%u9762%u4E13%u5F55%u8E29%u5751%u8BB0%u5F55%u3002%0ADomoticz%20Broadlink%20plugin%u548C%5Bbroadlink-http-rest%5D%28https%3A//github.com/radinsky/broadlink-http-rest%29%u5747%u662F%u57FA%u4E8E%5Bpython-broadlink%5D%28https%3A//github.com/mjg59/python-broadlink%29%u3002%u6240%u4EE5%u8981%u5148%u5B89%u88C5python-broadlink%u3002%0A%0A%23%23%23%23%20%u5B89%u88C5python-broadlink%0A%u5728%u5F88%u591A%u6587%u7AE0%u4E2Dpython-broadlink%u90FD%u662F%u7528pip%u6765%u5B89%u88C5%uFF0C%u4F8B%u5982%60pip3%20install%20broadlink%60%u3002%u4F46%u662F%u7531%u4E8Ebroadlink%u57FA%u4E8Epycrypto%uFF0C%u800C%u5B89%u88C5pycrypto%u7684%u65F6%u5019%u4F1A%u8981%u5728%u672C%u5730%u8FDB%u884C%u7F16%u8BD1%u3002Synology%20NAS%u4E0A%u663E%u7136%u6CA1%u6709%u7F16%u8BD1%u73AF%u5883%28GCC%20and%20etc.%29%u3002%u6240%u4EE5%u5B89%u88C5%u4F1A%u5931%u8D25%u3002%u4F46%u662F%u6839%u636E%u4F5C%u8005%u7684%u63CF%u8FF0%uFF0C%u6700%u65B0%u7684python-broadlink%u5E76%u4E0D%u57FA%u4E8Epycrypto%u4E86%uFF0C%u56E0%u4E3Apycrypto%u5DF2%u7ECF%u88AB%u5F03%u5751%u4E86%u3002%u6700%u65B0%u7684python-broadlink%u57FA%u4E8Epyaes%u5E93%u6765%u5B9E%u73B0%u52A0%u89E3%u5BC6%u3002%u6240%u4EE5%u6B63%u786E%u7684%u6B65%u9AA4%u662F%uFF1A%0A-%20%u786E%u4FDD%u4F7F%u7528python3%0A-%20git%20clone%20python-broadlink%0A-%20%u5207%u5230python-broadlink%u76EE%u5F55%uFF0C%60python%20setup.py%20install%60%0A-%20%60python%20-m%20pip%20install%20pyaes%60%u56E0%u4E3ASynology%u4E0A%u65E0%u6CD5%u5B89%u88C5pip3%uFF0C%u8FD9%u662F%u53D8%u901A%u7684%u65B9%u6CD5%u3002%u4F7F%u7528%60python%20get-pip.py%60%u5B89%u88C5%u7684%u4ECD%u7136%u662Fpip2%0A%0A%23%23%23%23%20%u5B89%u88C5Domoticz%20Python%20Plugin%0A%u53C2%u8003%u94FE%u63A53%u662F%u63D2%u4EF6%u4F5C%u8005%u63D0%u4F9B%u7684Domoiticz%20wiki%u9875%uFF0C%u4E0D%u8FC7%u5168%u6587%u57FA%u4E8EWindows%uFF0C%u53C2%u8003%u5176%u4E2Dothers%u7AE0%u8282%uFF0C%u4ECD%u7136%u5F88%u597D%u7528%u3002%u6B65%u9AA4%u5982%u4E0B%uFF1A%0A-%20%u4E0B%u8F7D%5Bplugin%20files%5D%28https%3A//www.dropbox.com/sh/htyghey9e402u4y/AACeb1cXqaPd9gBVl5TL3H36a%3Fdl%3D0%29%0A-%20Domoticz%u7684%u63D2%u4EF6%u76EE%u5F55%u5728%60/usr/local/domoticz/var/plugins/BroadlinkRM2/%60%uFF0C%u62F7%u8D1D%u63D2%u4EF6%u6587%u4EF6%u5230%u8BE5%u76EE%u5F55%uFF0C%u5305%u62EC%uFF1A%0A%09-%20plugin.py%20%u2014%u2014%u63D2%u4EF6%u7684%u4E3B%u6587%u4EF6%0A%09-%20plugin_send.py%0A%09-%20plugin_http.py%0A%09-%20plugin_http.sh%0A%09%u8FD9%u91CC%u9700%u8981%u6CE8%u610F%u63D2%u4EF6%u76EE%u5F55%u4E0D%u662F%60/usr/local/domoticz/plugins/BroadlinkRM2/%60%uFF0C%u867D%u7136%u8FD9%u4E2A%u76EE%u5F55%u5E95%u4E0B%u6709example%u76EE%u5F55%u8FD8%u6709%u5176%u4ED6%u63D2%u4EF6%u7684%u76EE%u5F55%uFF0C%u4F46%u5F53%u6211%u628A%u63D2%u4EF6%u6587%u4EF6%u653E%u5728%u8BE5%u76EE%u5F55%u4E0B%u65F6%uFF0C%u4F1A%u51FA%u73B0%u63D2%u4EF6%u672A%u52A0%u8F7D%u7684%u60C5%u51B5%u3002%0A-%20%u5728Synology%20DSM%u7684Package%20Center%u4E2D%u91CD%u542FDomoticz%u3002%u6CE8%u610F%u540E%u9762%u6BCF%u6B21%u4FEE%u6539plugin%u90FD%u9700%u8981%u91CD%u542FDomoticz%u3002%0A%u81F3%u6B64%u5B89%u88C5%u5C31%u6210%u529F%u4E86%uFF0C%u76F4%u63A5%u5728Domoticz%u4E2D%u6DFB%u52A0BroadLink%u8BBE%u5907%u5982%u56FE%u3002%0A%21%5BAlt%20text%5D%28./1500861858610.png%29%0A%0A%23%23%23%23%20%u6DFB%u52A0Broadlink%20Hardware%0A%u6309%u7167%u63D2%u4EF6%u4F5C%u8005%u7684%u6B65%u9AA4%uFF0C%u4E0B%u9762%u5E94%u8BE5%u53EF%u4EE5%u6DFB%u52A0Hardware%uFF0C%u5E76%u53EF%u4EE5Discover%20Broadlink%u8BBE%u5907%uFF0C%u6DFB%u52A0Hardware%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1501368649742.png%29%0AIP%u53EF%u4EE5%u8BBE%u4E3A127.0.0.1%uFF0CMAC%u8BBE%u4E3A%u51680%uFF0C%u7136%u540E%u53EF%u4EE5%u901A%u8FC7%u63D2%u4EF6%u63D0%u4F9B%u7684%u53D1%u73B0%u529F%u80FD%u6765%u8FDE%u63A5broadlink%u8BBE%u5907%u3002%u53C2%u8003%u94FE%u63A53%u4E2D%u5747%u6709%u8BE6%u7EC6%u63CF%u8FF0%u3002%u4F46%u5B9E%u9645%u5E76%u4E0D%u90A3%u4E48%u987A%u5229%uFF0C%u53C2%u8003%u4E0B%u9762%u8E29%u5751%u8BB0%u5F55%u3002%0A%0A%0A%23%23%23%23%20%u5BFC%u5165%u6613%u63A7%28e-control%29%u8BBE%u5907%0A%u53C2%u8003%u94FE%u63A53%u4E2D%u4E5F%u6709%u8BE6%u7EC6%u63CF%u8FF0%u3002%u5728User%20Guide-%3EInside%20Domoticz-%3Exxx%20-%20import%u3002%u53EF%u80FD%u4F5C%u8005%u4F7F%u7528%u7684%u662F%u975E%u591A%u5B57%u8282%u8BED%u8A00%uFF0C%u5728%u5904%u7406%u5BFC%u5165%u6587%u4EF6%u65F6%uFF0C%u82E5%u542B%u6709%u4E2D%u6587%u5B57%uFF0C%u4F1A%u51FA%u73B0%u5931%u8D25%u7684%u60C5%u51B5%u3002%u53C2%u89C1%u8E29%u5751%u8BB0%u5F55%u4E2D%u7684%u89E3%u51B3%u65B9%u6CD5%u3002%0A%u53E6%u5916%u8FD8%u6709%u4E00%u70B9%u8981%u6CE8%u610F%u7684%u662F%uFF0C%u5728%u70B9%u51FBWebStart%u4EE5%u540E%uFF0CDomoticz%u4F1A%u5F00%u542F%u4E00%u4E2A%u8FD0%u884C%u4E8E9000%u7684web%u670D%u52A1%u5668%uFF0C%u7528%u4EE5%u4E0A%u4F20%u6613%u63A7%u7684%u8BBE%u5907%u6587%u4EF6%28jsonButton%2C%20jsonIrCode%2C%20jsonSubIr%29%u3002%u8981%u6CE8%u610FNAS%u7684Firewall%u914D%u7F6E%u3002%0A%0A%23%23%23%20Controlicz%0A%u5728%u641C%u7D22%u5230%u7684%u6587%u7AE0%u4E2D%u9C9C%u6709%u63D0%u53CA%u3002%u6211%u4E5F%u662F%u5728%u5076%u7136%u7684%u7FFB%u9605%u4E2D%u53D1%u73B0%u4E86%u8FD9%u4E2AAlexa%20Skill%u3002%u4F7F%u7528Controlicz%u5C31%u53EF%u4EE5%u4E0D%u7528%u901A%u8FC7HA-Bridge%u6765%u66F2%u7EBF%u6551%u56FD%u4E86%u3002%u4F46%u5B9E%u9645%u4F7F%u7528%u4E2D%u53D1%u73B0%u8FD8%u662F%u5404%u6709%u5229%u5F0A%u3002%u540E%u6587%u8BB2%u5B8CHA-Bridge%u7AE0%u8282%uFF0C%u4F1A%u63D0%u5230%u4E24%u8005%u7684%u4F18%u7F3A%u70B9%u3002%0A%u4F7F%u7528Controlicz%u7684%u65B9%u6CD5%u662F%uFF1A%0A-%20%u4F7F%u7528Alexa%u7684%u8D26%u53F7%u6765%u6CE8%u518C%5BControlicz%5D%28https%3A//www.controlicz.com/%29%0A-%20Alexa%20app%u4E0Aenable%20skill%u5C31%u597D%u4E86%0A-%20%u5BF9%u7740Alexa%u8BF4discover%20device%0A%3E%u6CE8%u610F%uFF1AControlcz%u4E2D%u8981%u6C42%uFF1A%0A%3E-%20Domoticz%u670D%u52A1%u5FC5%u987B%u5916%u7F51%u53EF%u4EE5%u8BBF%u95EE%uFF0C%u6240%u4EE5%u8981%u914D%u7F6E%u5BB6%u91CC%u7684%u7AEF%u53E3%u6620%u5C04%uFF0C%u4EE5%u53CADDNS%uFF0C%u56E0%u4E3A%u4F7F%u7528%u7684%u662FSynology%uFF0C%u8FD9%u4E2A%u6211%u65E9%u5C31%u5DF2%u7ECF%u6709%u4E86%0A%3E-%20Controlicz%u8981%u6C42Domoticz%u670D%u52A1%u8FD0%u884C%u4E8EHTTPS%u534F%u8BAE%uFF0C%u6240%u4EE5%u5FC5%u987B%u4F7F%u80FD8443%u7AEF%u53E3%uFF0C%u6CE8%u610FNAS%u7684Firewall%u914D%u7F6E%0A%0A%23%23%23%20%u8E29%u5751%u8BB0%u5F55%0A%u81F3%u6B64%uFF0C%u5982%u679C%u80FD%u5B8C%u6210%u4E0A%u9762%u6240%u6709%u7684%u6B65%u9AA4%uFF0C%u5BF9Alexa%u8BF4%22Turn%20on%20the%20TV%22%uFF0C%u5E94%u8BE5%u5DF2%u7ECF%u4F1A%u6709%u6B63%u786E%u54CD%u5E94%u4E86%u3002%u4F46%u9057%u61BE%u7684%u662F%uFF0C%u4E2D%u95F4%u8FD8%u6709%u4E00%u4E9B%u4E1C%u897F%u8981%u505A%uFF1A%0A%23%23%23%23%20Import%20Error%20%22broadlink%22%0A%u660E%u660E%u5DF2%u7ECF%u5B89%u88C5%u4E86python-broadlink%uFF0C%u800C%u4E14%u5728REPL%u4E2D%u4E5F%u53EF%u4EE5%u6B63%u786Eimport%uFF0C%u4F46%u662FDomoticz%20log%u4E2D%u59CB%u7EC8%u62A5%u9519%u3002%u539F%u56E0%u662FPYTHONPATH%u4E0D%u6B63%u786E%u3002%u5728plugin.py%u4E2D%u5DF2%u6709%u5904%u7406%uFF1A%0A%60%60%60%0Aif%20sys.platform.startswith%28%27linux%27%29%3A%0A%20%20%20%20%23%20linux%20specific%20code%20here%0A%20%20%20%20%23%20doesn%27t%20work%20even%20if%20set%20dist-packages%20%3D%3E%20site-packages%0A%20%20%20%20sys.path.append%28os.path.dirname%28os.__file__%29%20+%20%27/dist-packages%27%29%0Aelif%20sys.platform.startswith%28%27darwin%27%29%3A%0A%20%20%20%20%23%20mac%0A%20%20%20%20sys.path.append%28os.path.dirname%28os.__file__%29%20+%20%27/site-packages%27%29%0Aelif%20sys.platform.startswith%28%27win32%27%29%3A%0A%20%20%20%20%23%20%20win%20specific%0A%20%20%20%20sys.path.append%28os.path.dirname%28os.__file__%29%20+%20%27%5Csite-packages%27%29%0A%60%60%60%0A%u6B63%u786E%u7684broadlink%u5E93%u8DEF%u5F84%u662F%60/usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/%60%u3002%u4E0A%u9762linux%u7CFB%u7EDF%u7684%u8DEF%u5F84%u662Fdist-package%u3002%u4E0D%u8FC7%u5373%u4FBF%u6539%u6210site-packages%uFF0C%u4F9D%u7136%u62A5%u540C%u6837%u7684%u9519%u8BEF%u3002%u89E3%u51B3%u65B9%u6CD5%u7B80%u5355%u660E%u4E86%uFF0C%u5C06broadlink%u76EE%u5F55%u62F7%u5230plugins%u76EE%u5F55%u4E0B%u9762%u5373%u53EF%0A%3Ecp%20-r%20/usr/local/lib/python3.5/site-packages/broadlink-0.5-py3.5.egg/broadlink/%20/usr/local/domoticz/var/plugins/BroadlinkRM2/%0A%0A%23%23%23%23%20Error%20Connecting%20to%20Broadlink%20device%0A%u6709%u4E24%u4E2AGitHub%20issue%u94FE%u63A5%u53EF%u4EE5%u770B%u4E00%u770B%uFF1A%0A-%20%5BError%20Connecting%20to%20Broadlink%20device%20%23107%5D%28https%3A//github.com/mjg59/python-broadlink/issues/107%29%0A-%20%5Blpad%20fix%20broken%3F%20%2397%5D%28https%3A//github.com/mjg59/python-broadlink/issues/97%29%0A%u6216%u8BB8%u4F1A%u6709%u5E2E%u52A9%uFF0C%u4F46%u5BF9%u4E8E%u6211%u7684%u95EE%u9898%u4E0D%u662F%u6B63%u89E3%u3002%0ARoot%20cause%u662Fbytes%u4F7F%u7528%u65B9%u6CD5%u4E0D%u5BF9%uFF0C%u9519%u8BEF%u7684%u5730%u65B9%u5728%u8FD9%u91CC%0A%60%60%60%0A%23%20broadlink/__init__.py%0A160%20%20%20def%20encrypt_pyaes%28self%2C%20payload%29%3A%0A161%20%20%20%20%20aes%20%3D%20pyaes.AESModeOfOperationCBC%28self.key%2C%20iv%20%3D%20bytes%28self.iv%29%29%0A162%20%20%20%20%20return%20%22%22.join%28%5Baes.encrypt%28bytes%28payload%5Bi%3Ai+16%5D%29%29%20for%20i%20in%20range%280%2C%20len%28payload%29%2C%2016%29%5D%29%20%23%20%3C%3D%3D%3D%3D%20Error%20is%20here%0A%60%60%60%0Apython3%u4E2Dbytes%u8FD4%u56DEclass%20bytes%uFF0C%u800Cpython2%u4E2D%u8FD4%u56DE%u5B57%u7B26%u4E32%uFF0C%u5982%u4E0B%uFF1A%0A%60%60%60%0APython2%0A%3E%3E%3E%20type%28bytes%28%5B1%2C2%2C3%5D%29%29%0A%3Ctype%20%27str%27%3E%0A%0APython3%0A%3E%3E%3E%20type%28bytes%28%5B1%2C2%2C3%5D%29%29%0A%3Cclass%20%27bytes%27%3E%0A%3E%3E%3E%20%22%22.join%28%5Bbytes%28%5B1%2C2%5D%29%2Cbytes%28%5B2%2C3%5D%29%5D%29%20%20%3C%3D%3D%3D%3D%20You%20cannot%20cat%202%20bytes%20class%20objects%20as%20string%0ATraceback%20%28most%20recent%20call%20last%29%3A%0A%20%20File%20%22%3Cstdin%3E%22%2C%20line%201%2C%20in%20%3Cmodule%3E%0ATypeError%3A%20sequence%20item%200%3A%20expected%20str%20instance%2C%20bytes%20found%0A%3E%3E%3E%20b%27%27.join%28%5Bbytes%28%5B1%2C2%5D%29%2Cbytes%28%5B2%2C3%5D%29%5D%29%20%3C%3D%3D%3D%3D%20This%20is%20the%20good%20way%0Ab%27%5Cx01%5Cx02%5Cx02%5Cx03%27%0A%60%60%60%0A%u597D%u4E86%u4FEE%u6539plugin.py%u5BF9%u5E94%u7684%u884C%u5C31%u53EF%u4EE5%u4E86%u3002%0A%0A%23%23%23%23%20Domoticz%20import%u6587%u4EF6%u4E2D%u6709%u4E2D%u6587%u7684%u95EE%u9898%0A%u5728Python3%u4E2D%uFF0C%u5982%u679C%u6587%u4EF6%u6709%u7F16%u7801%u95EE%u9898%uFF0C%u4F8B%u5982%u5305%u542B%u4E2D%u6587%uFF0C%u4E0D%u80FD%u901A%u8FC7%u4EE5%u4E0B%u65B9%u5F0F%u6765%u8BFB%u53D6%u6587%u4EF6%u5E76%u89E3%u7801%uFF1A%0A%60%60%60%0Awith%20open%28%27jsonFile%27%29%20as%20f%3A%0A%09textStr%20%3D%20f.read%28%29%20%3C%3D%3D%3D%20Python3%20will%20complain%20about%20the%20codec%20error%20here.%0A%09textStr.decode%28%27utf8%27%29%0A%60%60%60%0A%u6B63%u786E%u7684%u505A%u6CD5%u5E94%u5F53%u662F%0A%60%60%60%0Awith%20open%28%27jsonFile%27%2C%20encoding%3D%27utf8%27%29%3A%0A%09textStr%20%3D%20f.read%28%29%20%3C%3D%3D%3D%20Everything%20here%20has%20already%20been%20unicode.%0A%60%60%60%0A%u6240%u4EE5%u4FEE%u6539%u6240%u6709plugin.py%u4E2D%u7684open%u8BED%u53E5%u5373%u53EF%u3002%0A%u8FD8%u6709%u4E00%u5904%u8981%u4FEE%u6539%u7684%u662F%u9488%u5BF9ConfigParser%u7684%u7F16%u7801%u95EE%u9898%u3002%u5982%u4E0B%u662F%u6211%u4FEE%u6539%u597D%u7684%uFF1A%0A%60%60%60%0Aconfig%20%3D%20configparser.ConfigParser%28%29%0Aconfig.read%28path%2C%20encoding%3D%27utf8%27%29%0A%60%60%60%0A%u73B0%u5728%u8BD5%u4E00%u8BD5%uFF0C%u8FDE%u63A5%uFF0C%u53D1%u73B0%uFF0C%u5BFC%u5165%uFF0C%u5E94%u8BE5%u90FD%u6CA1%u95EE%u9898%u4E86%u5427%u3002%0A%0A%23%23%23%20Domoticz%20+%20broadlink-http-rest%20+%20HA-Bridge%0A%u8FD9%u4E2A%u65B9%u6848%u4E0D%u9700%u8981%u501F%u52A9Broadlink%u7684Domoticz%20python%u63D2%u4EF6%uFF0C%u800C%u662F%u5229%u7528Domoticz%u4E2D%u7684Dummy%20Hardware%uFF0C%u5982%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1501376022176.png%29%0A%0A%23%23%23%23%20%u5B89%u88C5HA-Bridge%0AHA-Bridge%u662F%u5C06Alexa%u4E0D%u652F%u6301%u7684%u8BBE%u5907%u6A21%u62DF%u6210Alexa%u539F%u751F%u652F%u6301%u7684Philips%20HUE%20Light%u3002%u800CHA-Bridge%u53EF%u4EE5%u76F4%u63A5%u5BFC%u5165Domoticz%u4E2D%u7684%u6240%u6709%u8BBE%u5907%u3002%u7F3A%u70B9%u662F%uFF0C%u4ED6%u53EA%u80FD%u652F%u6301%u5F00%u5173%u548C%u8C03%u4EAE%u5EA6%u7684%u64CD%u4F5C%u3002%0AHA-Bridge%u662F%u4E00%u4E2Ajava%u7684jar%u5305%uFF0C%u6211%u4EEC%u8981%u5C06%u4E4B%u4F5C%u4E3Aservice%u8FD0%u884C%u5728Synology%u540E%u53F0%uFF0C%u65B9%u6CD5%u53C2%u770B%5BRun%20as%20a%20service%20on%20Synology%5D%28https%3A//github.com/bwssytems/ha-bridge/issues/310%29%u3002%0A%u5176%u5B9E%u5C31%u662F%u8FD0%u884C%u547D%u4EE4%60nohup%20java%20-jar%20-Dserver.port%3D8085%20/ha-bridge-4.5.6.jar%20%26%60%0A%u6CE8%u610F%u653E%u5230Synology%u7684%u8BA1%u5212%u4EFB%u52A1%u91CC%u3002%0A%0A%23%23%23%23%20%u5B89%u88C5broadlink-http-rest%0A%u4ECEGitHub%u4E0Aclone%u4E0B%5Bbroadlink-http-rest%5D%28https%3A//github.com/radinsky/broadlink-http-rest%29%u3002%u7136%u540E%u548CHA-Bridge%u4E00%u6837%uFF0C%u8981%u4EE5service%u7684%u65B9%u5F0F%u8FD0%u884C%u5728%u540E%u53F0%u3002%u5426%u5219ssh%u8FDE%u63A5%u4E00%u65AD%u5F00%uFF0Cserver%u5C31%u9000%u51FA%u4E86%u3002%u547D%u4EE4%u4E3A%60nohup%20python%20broadlink-http-rest/server.py%20%26%60%0A%u6CE8%u610F%u8981%u7528nohup%uFF0C%u5426%u5219serveer%u4ECD%u7136%u4F1A%u968F%u7740ssh%u65AD%u5F00%u800C%u9000%u51FA%u3002%0A%0A%23%23%23%23%20%u8BA1%u5212%u4EFB%u52A1%26%u9632%u706B%u5899%0A%u914D%u7F6E%u597D%u9632%u706B%u5899%uFF1A%0A%21%5BAlt%20text%5D%28./1501376973009.png%29%0A-%208085%3A%20HA-Bridge%20server%0A-%208080%3A%20broadlink-http-rest%20server%0A-%208443%3A%20Domoticz%20HTTPS%20service%0A-%209000%3A%20Domoticz%20Broadlink%20web%20service%0A%0A%u914D%u7F6E%u597D%u8BA1%u5212%u4EFB%u52A1%uFF1A%0A%21%5BAlt%20text%5D%28./1501377068095.png%29%0A%0A%23%23%23%23%20Broadlink%20into%20Domoticz%0A%u5728Setup-%3EHardware%u4E0B%u5EFA%u7ACBDummy%20Hardware%uFF0C%u7136%u540E%u70B9%u51FBCreate%20Virtual%20Sensors%uFF0C%u7136%u540E%u5728Switches%20tab%u91CC%u627E%u5230%u521A%u5EFA%u597D%u7684virtual%20sensor%uFF0C%u70B9%u51FBEdit%uFF0C%u6309%u4E0B%u56FE%u914D%u7F6E%u597DOn%20Action%u548COff%20Action%u3002%0A%21%5BAlt%20text%5D%28./1501376159204.png%29%0A%u8FD9%u91CCon%20off%20action%u5C31%u662F%u5229%u7528broadlink-http-rest%20service%u6765%u63A7%u5236broadlink%u5B66%u4E60%uFF0C%u5E76%u53D1%u9001%u547D%u4EE4%u5230broadlink%u6765%u5B9E%u73B0%u9065%u63A7%u529F%u80FD%u3002%u4F8B%u5982%uFF1Ahttp%3A//192.168.1.2%3A8080/learnCommand/kogntiaokai%20%u540Ebroadlink%20rm%u4F1A%u8FDB%u5165%u5B66%u4E60%u72B6%u6001%uFF0C%u4EAE%u9EC4%u706F%u3002%u5BF9%u7740%u6309%u9065%u63A7%u5668%u6309%u94AE%u5C31%u5B66%u4E60%u4E86%u3002%u8FD9%u91CCkongtiaokai%uFF08%u7A7A%u8C03%u5F00%uFF09%u662F%u81EA%u5DF1%u5B9A%u4E49%u7684%u9065%u63A7%u540D%u79F0%uFF0C%u5B66%u4E60%u4E0B%u4E00%u4E2A%u547D%u4EE4%u65F6%u628A%u8FD9%u4E2A%u5730%u65B9%u4FEE%u6539%u4E00%u4E0B%u5C31%u884C%u3002%u5B66%u4E60%u5B8C%u540E%u53EF%u4EE5%u5728%u6D4F%u89C8%u5668%u91CC%u9762%u8F93%u5165%20http%3A//192.168.1.2%3A8080/sendCommand/kongtiaokai%20%u6765%u8BA9broadlink%u53D1%u9001%u521A%u624D%u5B66%u4E60%u7684%u7EA2%u5916%u547D%u4EE4%uFF0C%u6765%u6D4B%u8BD5%u4E0B%u662F%u5426%u5B66%u4E60%u6210%u529F%u3002%0A%0A%23%23%23%23%20Domoticz%20into%20HA-Bridge%0A%u53C2%u89C1%u53C2%u8003%u94FE%u63A52%uFF0C%u4ECEConfiguring%20HA%20bridge%u5F00%u59CB%u8BB2%u5982%u4F55%u914D%u7F6EDomoticz%u5230HA-Bridge%20service%u3002%u7136%u540E%u5C31%u53EF%u4EE5%u76F4%u63A5%u6DFB%u52A0Domoticz%u91CC%u7684%u8BBE%u5907%u4E86%u3002%0A%21%5BAlt%20text%5D%28./1501401044317.png%29%0A%u6DFB%u52A0%u5B8C%u5C31%u662F%u8FD9%u6837%u5566%0A%21%5BAlt%20text%5D%28./1501403754697.png%29%0A%u6B64%u65F6%u5C31%u53EF%u4EE5%u901A%u8FC7Alexa%20discover%u4E86%u3002%u7136%u540E%u53EF%u4EE5%u7528Alexa%20turn%20on/off%u8BBE%u5907%u4E86%u3002%0A%0A%23%23%23%23%20HA-Bridge%20vs.%20Controlicz%0A%23%23%23%23%23%20General%20Smart%20Home%0AControlicz%u53EF%u4EE5%u6574%u5408Domoticz%u6240%u6709%u8BBE%u5907%u5230Alexa%u4E2D%uFF0C%u8B6C%u5982%uFF0C%u5982%u679CAlexa%u5E76%u4E0D%u539F%u751F%u652F%u6301%u8BE5smart%20home%u8BBE%u5907%uFF0C%u5219%u53EF%u4EE5%u5148%u5728%u5BB6%u91CC%u642D%u5EFADomoticz%u670D%u52A1%u5668%uFF0C%u7136%u540E%u901A%u8FC7Controlicz%u5C06%u4E4B%u6574%u5408%u5230Alexa%u4E2D%u3002%u6839%u636EControlicz%u5B98%u7F51support%u5217%u8868%uFF0C%u5176%u5E76%u4E0D%u53EA%u5C40%u9650%u4E8E%u5F00%u5173%u8BBE%u5907%uFF1A%0A%21%5BAlt%20text%5D%28./1501404140819.png%29%0AHA-Bridge%u56E0%u4E3A%u662F%u5C06%u8BBE%u5907%u6A21%u62DF%u6210Philips%20HUE%uFF0C%u6240%u4EE5%u5BF9Alexa%u6765%u8BF4%uFF0C%u8FD9%u4E9B%u8BBE%u5907%u5C31%u53EA%u662F%u4E00%u4E2APhilips%20HUE%20Light%uFF0C%u6240%u4EE5%u53EA%u80FD%u6709%u5F00%u5173%u548C%u8C03%u4EAE%u5EA6%u4E09%u79CD%u52A8%u4F5C%u3002%0A%u4ECE%u8FD9%u4E2A%u89D2%u5EA6%u8BF4%uFF0C%u4E24%u8005%u5E76%u65E0%u53EF%u6BD4%u6027%uFF0CControlicz%u5B8C%u80DC%0A%23%23%23%23%23%20%u6574%u5408Broadlink%0A%u5728%u6574%u5408Broadlink%u4E0A%uFF0C%u4E24%u8005%u5C31%u5404%u6709%u80DC%u573A%u4E86%u3002Broadlink%u662F%u901A%u7528%u9065%u63A7%u5668%u3002%u6240%u4EE5%u901A%u8FC7Broadlink%u5BFC%u5165%u7684%u8BBE%u5907%u90FD%u662F%u6309%u94AE%u8BBE%u5907%uFF0C%u6BCF%u4E2A%u6309%u94AE%u90FD%u662F%u4E00%u4E2APush%20Button%u8BBE%u5907%uFF0C%u6240%u4EE5%u53EA%u6709%u4E00%u4E2A%u89E6%u53D1%u7684%u64CD%u4F5C%u3002%u8FD9%u6837%u4E5F%u5408%u7406%uFF0C%u56E0%u4E3A%u6309%u94AE%u53EA%u6709%u89E6%u53D1%uFF0C%u5E76%u6CA1%u6709%u5F00%u72B6%u6001%u6216%u8005%u5173%u72B6%u6001%u3002%u8FD9%u751A%u81F3%u4E0D%u5982%u706F%u7684%u72B6%u6001%u591A%u3002%0A%u4F8B%u5982%uFF1A%u4E00%u53F0%u7535%u98CE%u6247%u7684%u5F00%u5173%u6309%u94AE%uFF0C%u6309%u4E00%u4E0B%u662F%u5F00%uFF0C%u518D%u6309%u4E00%u4E0B%u662F%u5173%u3002%u5982%u679C%u901A%u8FC7Controlicz%u76F4%u63A5%u6574%u5408Domoticz%u6309%u94AE%u8BBE%u5907%uFF0C%u5219%u8981%u5F00%u7535%u98CE%u6247%uFF0C%u8981%u5BF9Alexa%u8BF4%u201CTurn%20on%20the%20Fan%u201D%uFF0C%u8981%u5173%u5219%u8FD8%u662F%u8BF4%u201CTurn%20on%20the%20Fan%u201D%u3002%u662F%u4E0D%u662F%u6709%u70B9%u5947%u602A%u3002%0A%u5982%u679C%u662FHA-Bridge%uFF0C%u9488%u5BF9%u5F00%u5173%u72B6%u6001%uFF0C%u5C31%u53EF%u4EE5%u8BF4%u201CTurn%20on%20the%20Fan%u201D%u548C%u201CTurn%20off%20the%20Fan%u201D%u3002%u662F%u4E0D%u662F%u597D%u591A%u4E86%u3002%0AControlicz%u6574%u5408Domoticz%u7684%u597D%u5904%u5C31%u662F%uFF0CDomoticz%20Broadlink%20Python%20plugin%u652F%u6301%u76F4%u63A5%u4E00%u6B21%u6027%u4ECE%u6613%u63A7%u5BFC%u5165%u5DF2%u5B9A%u4E49%u8BBE%u5907%uFF0C%u53EF%u4EE5%u5145%u5206%u53D1%u6325%u6613%u63A7GUI%u7684%u7279%u70B9%uFF0C%u7701%u5F97%u4E00%u4E2A%u4E00%u4E2A%u8BBE%u5907%u81EA%u5DF1%u5B9A%u4E49%u4E86%u3002%0A%0A%23%23%23%20Broadlink%u539F%u751FSkill%20+%20IHC%0A%u5728%u6574%u5B8C%u4E0A%u9762%u90A3%u4E00%u5927%u5806%u4E4B%u540E%uFF0C%u6211%u7A81%u7136%u53D1%u73B0%u539F%u6765Alexa%u5DF2%u7ECF%u6709Broadlink%u7684%u539F%u751FSkill%u4E86%uFF0C%u4F46%u8981%u914D%u5408%u6700%u65B0%u7248%u7684Broadlink%20IHC%20app%u4F7F%u7528%u3002%u4E0D%u8FC7%u4EE4%u4EBA%u7CDF%u5FC3%u7684%u662F%u8FD9%u4E24%u4E2Aapp%u7684%u8BC4%u5206%u90FD%u4F4E%u7684%u53EF%u601C%u3002%0A-%20IHC%20playstore%202.2%u5206%0A-%20Alexa%20Broadlink%20Skill%202.3%u5206%0A%u4ECE%u5B98%u7F51%u7684example%u770B%u76EE%u524D%u53EA%u652F%u6301TV%u3002%u7ECF%u6211%u5B9E%u8DF5%u786E%u5B9E%u5982%u6B64%uFF0C%u6DFB%u52A0%u4E86%u7535%u89C6%u548C%u7A7A%u8C03%uFF0CAlexa%u5374%u53EA%u80FDdiscover%u5230%u7535%u89C6%uFF0C%u6CA1%u6709%u7A7A%u8C03%u3002%0A%0A%0A%23%23%u53C2%u8003%u94FE%u63A5%0A1.%20%5B5%20open%20source%20home%20automation%20tools%5D%28https%3A//opensource.com/life/16/3/5-open-source-home-automation-tools%29%0A2.%20%5BAlex%20-%20Domoticz%5D%28https%3A//www.domoticz.com/wiki/Alexa%29%0A3.%20%5BDomoticz%20Wiki%20Plugins/BroadlinkRM2%5D%28http%3A//www.domoticz.com/wiki/Plugins/BroadlinkRM2.html%23First_Time_Users%29%0A4.%20%5B%23%u539F%u521B%u65B0%u4EBA%23%20%u7FA4%u6656%u5B89%u88C5broadlink-http-rest%u4EE3%u66FFRMBridge_%u751F%u6D3B%u8BB0%u5F55_%u4EC0%u4E48%u503C%u5F97%u4E70%5D%28https%3A//post.smzdm.com/p/551024/%29]]></content>
      <tags>
        <tag>synology</tag>
        <tag>IoT</tag>
        <tag>broadlink</tag>
        <tag>domoticz</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NLP记录]]></title>
    <url>%2F2017%2F07%2F05%2FNLP%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[EditNLP&#x8BB0;&#x5F55;OverviewSyntaxNet&#x5B89;&#x88C5;NLTKNLTK vs. spaCyStemming vs. LemmatizationOverview&#x6700;&#x8FD1;&#x6709;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x60F3;&#x505A;chat bot&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5728;IM app&#x4E0A;&#x81EA;&#x52A8;&#x56DE;&#x7B54;&#x95EE;&#x9898;&#x7684;&#x673A;&#x5668;&#x4EBA;&#x3002;&#x8981;&#x56DE;&#x7B54;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x8981;&#x5BF9;&#x95EE;&#x9898;&#x6709;&#x6240;&#x4E86;&#x89E3;&#xFF0C;&#x4E8E;&#x662F;&#x6700;&#x8FD1;&#x770B;&#x4E86;&#x4E00;&#x4E9B;NLP (Natural Language Process)&#x65B9;&#x9762;&#x7684;&#x8D44;&#x6599;&#x3002;&#x6CA1;&#x6709;&#x8FC7;&#x591A;&#x7684;&#x6D89;&#x53CA;&#x57FA;&#x7840;&#x7406;&#x8BBA;&#x4EE5;&#x53CA;&#x6A21;&#x578B;&#x65B9;&#x9762;&#x7684;&#x77E5;&#x8BC6;&#x3002;&#x56E0;&#x4E3A;&#x662F;&#x505A;&#x9879;&#x76EE;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x5E0C;&#x671B;&#x80FD;&#x4ECE;&#x5DE5;&#x7A0B;&#x65B9;&#x9762;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x5E94;&#x7528;&#x3002;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x6D89;&#x53CA;SyntaxNet&#x548C;NLTK&#x3002;&#x524D;&#x8005;&#x662F;Google&#x4E8E;2016&#x5E74;&#x5F00;&#x6E90;&#x7684;NLP&#x9879;&#x76EE;&#xFF0C;&#x5176;&#x5305;&#x542B;&#x4E86;&#x57FA;&#x672C;&#x6A21;&#x578B;&#x4EE5;&#x53CA;&#x57FA;&#x4E8E;TensorFlow&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x800C;&#x4E14;&#x5176;&#x57FA;&#x4E8E;&#x82E5;&#x5E72;&#x8BAD;&#x7EC3;&#x8D44;&#x6599;&#xFF0C;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E2A;pre-trained English model&#x3002;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x88AB;&#x52A0;&#x4EE5;&#x5229;&#x7528;&#x3002;SyntaxNet&#x5B89;&#x88C5;&#x4E00;&#x4E9B;&#x53C2;&#x8003;&#x7F51;&#x9875;NLP&#x521D;&#x7EA7;&#x9009;&#x624B;ubuntu &#x4E0B;&#x5B89;&#x88C5;google SyntaxNetHow to Install and Use SyntaxNet and Parsey McParsefaceSyntaxNet TutorialSyntaxNet: Understanding the Parser&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;demo&#x7A0B;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A;echo &apos;Bob brought the pizza to Alice.&apos; | syntaxnet/demo.sh&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x6811;&#x72B6;&#x7ED3;&#x6784;Input: Bob brought the pizza to Alice .Parse:brought VBD ROOT +-- Bob NNP nsubj +-- pizza NN dobj | +-- the DT det +-- to IN prep | +-- Alice NNP pobj +-- . . punctSyntaxNet&#x81EA;&#x5E26;&#x7684;pre-trained English parser&#x53EB;Parsey McParseface&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x4E2A;parser&#x6765;&#x5206;&#x6790;&#x8BED;&#x53E5;&#x3002;&#x6839;&#x636E;How to Install and Use SyntaxNet and Parsey McParseface&#x4E2D;&#x6240;&#x8FF0;&#xFF0C;Parsey McParseface&#x8F93;&#x51FA;&#x5B9E;&#x4E3A;CoNLL table&#x3002;&#x8FD9;&#x4E2A;table&#x7684;&#x683C;&#x5F0F;&#x5728;models/syntaxnet/syntaxnet/text_formats.cc&#xFF0C;&#x5982;&#x4E0B;&#xFF1A; 50 // CoNLL document format reader for dependency annotated corpora. 51 // The expected format is described e.g. at http://ilk.uvt.nl/conll/#dataformat 52 // 53 // Data should adhere to the following rules: 54 // - Data files contain sentences separated by a blank line. 55 // - A sentence consists of one or tokens, each one starting on a new line. 56 // - A token consists of ten fields described in the table below. 57 // - Fields are separated by a single tab character. 58 // - All data files will contains these ten fields, although only the ID 59 // column is required to contain non-dummy (i.e. non-underscore) values. 60 // Data files should be UTF-8 encoded (Unicode). 61 // 62 // Fields: 63 // 1 ID: Token counter, starting at 1 for each new sentence and increasing 64 // by 1 for every new token. 65 // 2 FORM: Word form or punctuation symbol. 66 // 3 LEMMA: Lemma or stem. 67 // 4 CPOSTAG: Coarse-grained part-of-speech tag or category. 68 // 5 POSTAG: Fine-grained part-of-speech tag. Note that the same POS tag 69 // cannot appear with multiple coarse-grained POS tags. 70 // 6 FEATS: Unordered set of syntactic and/or morphological features. 71 // 7 HEAD: Head of the current token, which is either a value of ID or &apos;0&apos;. 72 // 8 DEPREL: Dependency relation to the HEAD. 73 // 9 PHEAD: Projective head of current token. 74 // 10 PDEPREL: Dependency relation to the PHEAD.&#x76F4;&#x63A5;&#x4F7F;&#x7528;CoNLL table&#x66F4;&#x6613;&#x4E8E;&#x88AB;&#x4EE3;&#x7801;&#x89E3;&#x6790;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;CoNLL table&#x8F93;&#x51FA;&#xFF0C;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x4FEE;&#x6539;demo.sh&#x3002;&#x76F4;&#x63A5;&#x6765;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;INFO:tensorflow:Processed 1 documents1 What _ PRON WP _ 0 ROOT _ _2 is _ VERB VBZ _ 1 cop _ _3 a _ DET DT _ 5 det _ _4 control _ NOUN NN _ 5 nn _ _5 panel _ NOUN NN _ 1 nsubj _ _&#x8FD9;&#x662F;&#x5BF9;What is a control panel&#x7684;&#x8F93;&#x51FA;&#x3002;&#x4E0B;&#x56FE;&#x6E90;&#x4E8E;Inside Google SyntaxNetCoNLL table&#x4E2D;&#x7684;&#x6240;&#x6709;tag&#x7F29;&#x5199;&#x7684;&#x542B;&#x4E49;&#x5728;&#x8FD9;&#x91CC;Universal Dependency Relations&#x9488;&#x5BF9;CPOSTAG &amp; POSTAG&#xFF0C;&#x53EF;&#x53C2;&#x8003;Alphabetical list of part-of-speech tags used in the Penn Treebank ProjectWh- wordsNLTKNLTK is a leading platform for building Python programs to work with human language data. It provides easy-to-use interfaces to over 50 corpora and lexical resources such as WordNet, along with a suite of text processing libraries for classification, tokenization, stemming, tagging, parsing, and semantic reasoning, wrappers for industrial-strength NLP libraries, and an active discussion forum.&#x6211;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x53EF;&#x4EE5;&#x7528;NLTK&#x6765;&#x5BF9;SyntaxNet&#x7684;&#x8F93;&#x51FA;&#x505A;&#x8FDB;&#x4E00;&#x6B65;Stemming/Lemmarization&#x5904;&#x7406;&#x3002;NLTK vs. spaCyStemming vs. Lemmatization&#x8FD9;&#x4E24;&#x4E2A;&#x8BCD;&#x603B;&#x662F;&#x4E00;&#x8D77;&#x51FA;&#x73B0;&#xFF0C;&#x4F5C;&#x7528;&#x5F88;&#x76F8;&#x50CF;&#x3002;&#x533A;&#x522B;&#x662F;&#xFF1A;Lemmatisation is closely related to stemming. The difference is that a stemmer operates on a single word without knowledge of the context, and therefore cannot discriminate between words which have different meanings depending on part of speech. However, stemmers are typically easier to implement and run faster, and the reduced accuracy may not matter for some applications.In computational linguistics, lemmatisation is the algorithmic process of determining the lemma for a given word. Since the process may involve complex tasks such as understanding context and determining the part of speech of a word in a sentence (requiring, for example, knowledge of the grammar of a language) it can be a hard task to implement a lemmatiser for a new language.&#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5C31;&#x662F;Lemmarization&#x662F;&#x5305;&#x542B;&#x6709;&#x4E0A;&#x4E0B;&#x6587;&#x542B;&#x4E49;&#x7684;&#xFF0C;&#x800C;Stemming&#x53EA;&#x662F;&#x5BF9;&#x5355;&#x4E2A;&#x5355;&#x8BCD;&#x8FDB;&#x884C;&#x6620;&#x5C04;&#x3002;NLTK&#x652F;&#x6301;&#x591A;&#x79CD;Stemmer&#xFF0C;&#x5305;&#x62EC;&#x4F46;&#x4E0D;&#x9650;&#x4E8E; Porter stemmer, Lancaster Stemmer, Snowball Stemmer&#x3002;&gt;&gt;&gt; from nltk.stem import SnowballStemmer&gt;&gt;&gt; snowball_stemmer = SnowballStemmer(&#x201C;english&#x201D;)&gt;&gt;&gt; snowball_stemmer.stem(&#x2018;maximum&#x2019;)u&#x2019;maximum&#x2019;&gt;&gt;&gt; snowball_stemmer.stem(&#x2018;presumably&#x2019;)u&#x2019;presum&#x2019;&gt;&gt;&gt; snowball_stemmer.stem(&#x2018;multiply&#x2019;)u&#x2019;multipli&#x2019;NLTK&#x4E2D;&#x7684;Lemarize: &gt;&gt;&gt; from nltk.stem import WordNetLemmatizer&gt;&gt;&gt; wordnet_lemmatizer = WordNetLemmatizer()&gt;&gt;&gt; wordnet_lemmatizer.lemmatize(&#x2018;dogs&#x2019;)u&#x2019;dog&#x2019;&gt;&gt;&gt; wordnet_lemmatizer.lemmatize(&#x2018;churches&#x2019;)u&#x2019;church&#x2019;&gt;&gt;&gt; wordnet_lemmatizer.lemmatize(&#x2018;is&#x2019;, pos=&#x2019;v&#x2019;)u&#x2019;be&#x2019;&gt;&gt;&gt; wordnet_lemmatizer.lemmatize(&#x2018;are&#x2019;, pos=&#x2019;v&#x2019;)u&#x2019;be&#x2019;&gt;&gt;&gt;pos = Part Of Speech%23NLP%u8BB0%u5F55%0A@%28myblog%29%5Bnlp%5D%0A%0A%5BTOC%5D%0A%0A%23%23Overview%0A%u6700%u8FD1%u6709%u4E00%u4E2A%u9879%u76EE%u60F3%u505Achat%20bot%uFF0C%u4E5F%u5C31%u662F%u5728IM%20app%u4E0A%u81EA%u52A8%u56DE%u7B54%u95EE%u9898%u7684%u673A%u5668%u4EBA%u3002%u8981%u56DE%u7B54%u95EE%u9898%uFF0C%u5C31%u8981%u5BF9%u95EE%u9898%u6709%u6240%u4E86%u89E3%uFF0C%u4E8E%u662F%u6700%u8FD1%u770B%u4E86%u4E00%u4E9BNLP%20%28Natural%20Language%20Process%29%u65B9%u9762%u7684%u8D44%u6599%u3002%u6CA1%u6709%u8FC7%u591A%u7684%u6D89%u53CA%u57FA%u7840%u7406%u8BBA%u4EE5%u53CA%u6A21%u578B%u65B9%u9762%u7684%u77E5%u8BC6%u3002%u56E0%u4E3A%u662F%u505A%u9879%u76EE%uFF0C%u66F4%u591A%u7684%u662F%u5E0C%u671B%u80FD%u4ECE%u5DE5%u7A0B%u65B9%u9762%u76F4%u63A5%u8FDB%u884C%u5E94%u7528%u3002%u672C%u6587%u4E3B%u8981%u6D89%u53CA%5BSyntaxNet%5D%28https%3A//github.com/tensorflow/models/tree/master/syntaxnet%29%u548CNLTK%u3002%u524D%u8005%u662FGoogle%u4E8E2016%u5E74%u5F00%u6E90%u7684NLP%u9879%u76EE%uFF0C%u5176%u5305%u542B%u4E86%u57FA%u672C%u6A21%u578B%u4EE5%u53CA%u57FA%u4E8ETensorFlow%u7684%u5B9E%u73B0%u3002%u800C%u4E14%u5176%u57FA%u4E8E%u82E5%u5E72%u8BAD%u7EC3%u8D44%u6599%uFF0C%u5DF2%u7ECF%u6709%u4E00%u4E2Apre-trained%20English%20model%u3002%u53EF%u4EE5%u76F4%u63A5%u88AB%u52A0%u4EE5%u5229%u7528%u3002%0A%0A%23%23%23SyntaxNet%0A%23%23%23%23%u5B89%u88C5%0A%u4E00%u4E9B%u53C2%u8003%u7F51%u9875%0A-%20%5BNLP%u521D%u7EA7%u9009%u624Bubuntu%20%u4E0B%u5B89%u88C5google%20SyntaxNet%5D%28%5D%28http%3A//blog.csdn.net/u012507864/article/details/51478060%29%29%0A-%20%5BHow%20to%20Install%20and%20Use%20SyntaxNet%20and%20Parsey%20McParseface%5D%28http%3A//www.whycouch.com/2016/07/how-to-install-and-use-syntaxnet-and.html%29%0A-%20%5BSyntaxNet%20Tutorial%5D%28https%3A//github.com/tensorflow/models/blob/master/syntaxnet/g3doc/syntaxnet-tutorial.md%29%0A-%20%5BSyntaxNet%3A%20Understanding%20the%20Parser%5D%28http%3A//jduelfer.github.io/syntaxnet%2C/tensorflow/2016/08/20/understanding-the-parser.html%29%0A%0A%u5B89%u88C5%u5B8C%u6210%u540E%uFF0C%u8FD0%u884C%u4E00%u4E2Ademo%u7A0B%u5E8F%u5982%u4E0B%uFF1A%0A%60%60%60%0Aecho%20%27Bob%20brought%20the%20pizza%20to%20Alice.%27%20%7C%20syntaxnet/demo.sh%0A%60%60%60%0A%u7ED3%u679C%u662F%u4E00%u4E2A%u6811%u72B6%u7ED3%u6784%0A%60%60%60%0AInput%3A%20Bob%20brought%20the%20pizza%20to%20Alice%20.%0AParse%3A%0Abrought%20VBD%20ROOT%0A%20+--%20Bob%20NNP%20nsubj%0A%20+--%20pizza%20NN%20dobj%0A%20%7C%20%20%20+--%20the%20DT%20det%0A%20+--%20to%20IN%20prep%0A%20%7C%20%20%20+--%20Alice%20NNP%20pobj%0A%20+--%20.%20.%20punct%0A%60%60%60%0ASyntaxNet%u81EA%u5E26%u7684pre-trained%20English%20parser%u53EBParsey%20McParseface%u3002%u6211%u4EEC%u53EF%u4EE5%u7528%u8FD9%u4E2Aparser%u6765%u5206%u6790%u8BED%u53E5%u3002%u6839%u636E%5BHow%20to%20Install%20and%20Use%20SyntaxNet%20and%20Parsey%20McParseface%5D%28http%3A//www.whycouch.com/2016/07/how-to-install-and-use-syntaxnet-and.html%29%u4E2D%u6240%u8FF0%uFF0CParsey%20McParseface%u8F93%u51FA%u5B9E%u4E3ACoNLL%20table%u3002%u8FD9%u4E2Atable%u7684%u683C%u5F0F%u5728%60models/syntaxnet/syntaxnet/text_formats.cc%60%uFF0C%u5982%u4E0B%uFF1A%0A%60%60%60%0A%2050%20//%20CoNLL%20document%20format%20reader%20for%20dependency%20annotated%20corpora.%0A%2051%20//%20The%20expected%20format%20is%20described%20e.g.%20at%20http%3A//ilk.uvt.nl/conll/%23dataformat%0A%2052%20//%0A%2053%20//%20Data%20should%20adhere%20to%20the%20following%20rules%3A%0A%2054%20//%20%20%20-%20Data%20files%20contain%20sentences%20separated%20by%20a%20blank%20line.%0A%2055%20//%20%20%20-%20A%20sentence%20consists%20of%20one%20or%20tokens%2C%20each%20one%20starting%20on%20a%20new%20line.%0A%2056%20//%20%20%20-%20A%20token%20consists%20of%20ten%20fields%20described%20in%20the%20table%20below.%0A%2057%20//%20%20%20-%20Fields%20are%20separated%20by%20a%20single%20tab%20character.%0A%2058%20//%20%20%20-%20All%20data%20files%20will%20contains%20these%20ten%20fields%2C%20although%20only%20the%20ID%0A%2059%20//%20%20%20%20%20column%20is%20required%20to%20contain%20non-dummy%20%28i.e.%20non-underscore%29%20values.%0A%2060%20//%20Data%20files%20should%20be%20UTF-8%20encoded%20%28Unicode%29.%0A%2061%20//%0A%2062%20//%20Fields%3A%0A%2063%20//%201%20%20ID%3A%20%20%20%20%20%20Token%20counter%2C%20starting%20at%201%20for%20each%20new%20sentence%20and%20increasing%0A%2064%20//%20%20%20%20%20%20%20%20%20%20%20%20%20by%201%20for%20every%20new%20token.%0A%2065%20//%202%20%20FORM%3A%20%20%20%20Word%20form%20or%20punctuation%20symbol.%0A%2066%20//%203%20%20LEMMA%3A%20%20%20Lemma%20or%20stem.%0A%2067%20//%204%20%20CPOSTAG%3A%20Coarse-grained%20part-of-speech%20tag%20or%20category.%0A%2068%20//%205%20%20POSTAG%3A%20%20Fine-grained%20part-of-speech%20tag.%20Note%20that%20the%20same%20POS%20tag%0A%2069%20//%20%20%20%20%20%20%20%20%20%20%20%20%20cannot%20appear%20with%20multiple%20coarse-grained%20POS%20tags.%0A%2070%20//%206%20%20FEATS%3A%20%20%20Unordered%20set%20of%20syntactic%20and/or%20morphological%20features.%0A%2071%20//%207%20%20HEAD%3A%20%20%20%20Head%20of%20the%20current%20token%2C%20which%20is%20either%20a%20value%20of%20ID%20or%20%270%27.%0A%2072%20//%208%20%20DEPREL%3A%20%20Dependency%20relation%20to%20the%20HEAD.%0A%2073%20//%209%20%20PHEAD%3A%20%20%20Projective%20head%20of%20current%20token.%0A%2074%20//%2010%20PDEPREL%3A%20Dependency%20relation%20to%20the%20PHEAD.%0A%60%60%60%0A%u76F4%u63A5%u4F7F%u7528CoNLL%20table%u66F4%u6613%u4E8E%u88AB%u4EE3%u7801%u89E3%u6790%u3002%u5982%u679C%u9700%u8981CoNLL%20table%u8F93%u51FA%uFF0C%u9700%u8981%u6211%u4EEC%u4FEE%u6539demo.sh%u3002%u76F4%u63A5%u6765%u4E2A%u4F8B%u5B50%uFF1A%0A%60%60%60%0AINFO%3Atensorflow%3AProcessed%201%20documents%0A1%20%20%20%20%20%20%20What%20%20%20%20_%20%20%20%20%20%20%20PRON%20%20%20%20WP%20%20%20%20%20%20_%20%20%20%20%20%20%200%20%20%20%20%20%20%20ROOT%20%20%20%20_%20%20%20%20%20%20%20_%0A2%20%20%20%20%20%20%20is%20%20%20%20%20%20_%20%20%20%20%20%20%20VERB%20%20%20%20VBZ%20%20%20%20%20_%20%20%20%20%20%20%201%20%20%20%20%20%20%20cop%20%20%20%20%20_%20%20%20%20%20%20%20_%0A3%20%20%20%20%20%20%20a%20%20%20%20%20%20%20_%20%20%20%20%20%20%20DET%20%20%20%20%20DT%20%20%20%20%20%20_%20%20%20%20%20%20%205%20%20%20%20%20%20%20det%20%20%20%20%20_%20%20%20%20%20%20%20_%0A4%20%20%20%20%20%20%20control%20_%20%20%20%20%20%20%20NOUN%20%20%20%20NN%20%20%20%20%20%20_%20%20%20%20%20%20%205%20%20%20%20%20%20%20nn%20%20%20%20%20%20_%20%20%20%20%20%20%20_%0A5%20%20%20%20%20%20%20panel%20%20%20_%20%20%20%20%20%20%20NOUN%20%20%20%20NN%20%20%20%20%20%20_%20%20%20%20%20%20%201%20%20%20%20%20%20%20nsubj%20%20%20_%20%20%20%20%20%20%20_%0A%60%60%60%0A%u8FD9%u662F%u5BF9What%20is%20a%20control%20panel%u7684%u8F93%u51FA%u3002%u4E0B%u56FE%u6E90%u4E8E%5BInside%20Google%20SyntaxNet%5D%28http%3A//andrewmatteson.name/index.php/2017/02/04/inside-syntaxnet/%29%0A%21%5BAlt%20text%5D%28./1499230365640.png%29%0A%u53EF%u89C1%u7B2C3%2C6%2C9%2C10%u5B57%u6BB5%uFF0CSytanxNet%u5E76%u6CA1%u6709%u8F93%u51FA%0A%0ACoNLL%20table%u4E2D%u7684%u6240%u6709tag%u7F29%u5199%u7684%u542B%u4E49%u5728%u8FD9%u91CC%5BUniversal%20Dependency%20Relations%5D%28http%3A//universaldependencies.org/u/dep/%29%0A%0A%u9488%u5BF9CPOSTAG%20%26%20POSTAG%uFF0C%u53EF%u53C2%u8003%0A-%20%5BAlphabetical%20list%20of%20part-of-speech%20tags%20used%20in%20the%20Penn%20Treebank%20Project%5D%28https%3A//www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html%29%0A-%20%5BWh-%20words%5D%28http%3A//www.ling.upenn.edu/histcorpora/annotation/pos-wh.htm%29%0A%0A%0A%0A%23%23%23NLTK%0A%3E**NLTK**%20is%20a%20leading%20platform%20for%20building%20**Python**%20programs%20to%20work%20with%20human%20language%20data.%20It%20provides%20easy-to-use%20interfaces%20to%20over%2050%20corpora%20and%20lexical%20resources%20such%20as%20WordNet%2C%20along%20with%20a%20suite%20of%20text%20processing%20libraries%20for%20classification%2C%20tokenization%2C%20stemming%2C%20tagging%2C%20parsing%2C%20and%20semantic%20reasoning%2C%20wrappers%20for%20industrial-strength%20NLP%20libraries%2C%20and%20an%20active%20discussion%20forum.%0A%0A%u6211%u7684%u60F3%u6CD5%u662F%u53EF%u4EE5%u7528NLTK%u6765%u5BF9SyntaxNet%u7684%u8F93%u51FA%u505A%u8FDB%u4E00%u6B65Stemming/Lemmarization%u5904%u7406%u3002%0A%0A%23%23%23%23%5BNLTK%20vs.%20spaCy%5D%28http%3A//blog.thedataincubator.com/2016/04/nltk-vs-spacy-natural-language-processing-in-python/%29%0A%0A%23%23%23%23Stemming%20vs.%20Lemmatization%0A%u8FD9%u4E24%u4E2A%u8BCD%u603B%u662F%u4E00%u8D77%u51FA%u73B0%uFF0C%u4F5C%u7528%u5F88%u76F8%u50CF%u3002%u533A%u522B%u662F%uFF1A%0A%3ELemmatisation%20is%20closely%20related%20to%20stemming.%20The%20difference%20is%20that%20**a%20stemmer%20operates%20on%20a%20single%20word%20without%20knowledge%20of%20the%20context**%2C%20and%20therefore%20cannot%20discriminate%20between%20words%20which%20have%20different%20meanings%20depending%20on%20part%20of%20speech.%20However%2C%20stemmers%20are%20typically%20easier%20to%20implement%20and%20run%20faster%2C%20and%20the%20reduced%20accuracy%20may%20not%20matter%20for%20some%20applications.%0A%0A%3EIn%20computational%20linguistics%2C%20lemmatisation%20is%20the%20algorithmic%20process%20of%20determining%20the%20lemma%20for%20a%20given%20word.%20**Since%20the%20process%20may%20involve%20complex%20tasks%20such%20as%20understanding%20context%20and%20determining%20the%20part%20of%20speech%20of%20a%20word%20in%20a%20sentence**%20%28requiring%2C%20for%20example%2C%20knowledge%20of%20the%20grammar%20of%20a%20language%29%20it%20can%20be%20a%20hard%20task%20to%20implement%20a%20lemmatiser%20for%20a%20new%20language.%0A%0A%u7B80%u800C%u8A00%u4E4B%uFF0C%u5C31%u662FLemmarization%u662F%u5305%u542B%u6709%u4E0A%u4E0B%u6587%u542B%u4E49%u7684%uFF0C%u800CStemming%u53EA%u662F%u5BF9%u5355%u4E2A%u5355%u8BCD%u8FDB%u884C%u6620%u5C04%u3002%0A%0ANLTK%u652F%u6301%u591A%u79CDStemmer%uFF0C%u5305%u62EC%u4F46%u4E0D%u9650%u4E8E%20Porter%20stemmer%2C%20Lancaster%20Stemmer%2C%20Snowball%20Stemmer%u3002%0A%60%60%60python%0A%3E%3E%3E%20from%20nltk.stem%20import%20SnowballStemmer%0A%3E%3E%3E%20snowball_stemmer%20%3D%20SnowballStemmer%28%u201Cenglish%u201D%29%0A%3E%3E%3E%20snowball_stemmer.stem%28%u2018maximum%u2019%29%0Au%u2019maximum%u2019%0A%3E%3E%3E%20snowball_stemmer.stem%28%u2018presumably%u2019%29%0Au%u2019presum%u2019%0A%3E%3E%3E%20snowball_stemmer.stem%28%u2018multiply%u2019%29%0Au%u2019multipli%u2019%0A%60%60%60%0ANLTK%u4E2D%u7684Lemarize%3A%20%0A%60%60%60python%0A%3E%3E%3E%20from%20nltk.stem%20import%20WordNetLemmatizer%0A%3E%3E%3E%20wordnet_lemmatizer%20%3D%20WordNetLemmatizer%28%29%0A%3E%3E%3E%20wordnet_lemmatizer.lemmatize%28%u2018dogs%u2019%29%0Au%u2019dog%u2019%0A%3E%3E%3E%20wordnet_lemmatizer.lemmatize%28%u2018churches%u2019%29%0Au%u2019church%u2019%0A%3E%3E%3E%20wordnet_lemmatizer.lemmatize%28%u2018is%u2019%2C%20pos%3D%u2019v%u2019%29%0Au%u2019be%u2019%0A%3E%3E%3E%20wordnet_lemmatizer.lemmatize%28%u2018are%u2019%2C%20pos%3D%u2019v%u2019%29%0Au%u2019be%u2019%0A%3E%3E%3E%0A%60%60%60%0A*%20pos%20%3D%20Part%20Of%20Speech]]></content>
      <tags>
        <tag>nlp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[在GitHub上用Evernote+Hexo搭建个人静态博客]]></title>
    <url>%2F2017%2F07%2F03%2F%E5%9C%A8GitHub%E4%B8%8A%E7%94%A8Evernote%2BHexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[Edit&#x5728;GitHub&#x4E0A;&#x7528;Evernote+Hexo&#x642D;&#x5EFA;&#x4E2A;&#x4EBA;&#x9759;&#x6001;&#x535A;&#x5BA2;&#x5728;GitHub&#x4E0A;&#x642D;&#x5EFA;Hexo&#x535A;&#x5BA2;Everblog&#x8E29;&#x5751;&#x8BB0;&#x5F55;EDAMSystemException: authenticationTokenHTML based Hexo blog&#x672C;&#x5730;&#x56FE;&#x7247;&#x663E;&#x793A;&#x5F15;&#x7528;&#x6587;&#x5B57;&#x4E2D;&#x5BF9;&#x9F50;&#x95EE;&#x9898;&#x5199;&#x535A;&#x5BA2;&#x7684;&#x60F3;&#x6CD5;&#x7531;&#x6765;&#x5DF2;&#x4E45;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x5206;&#x4EAB;&#x624D;&#x6709;&#x66F4;&#x591A;&#x7684;&#x83B7;&#x5F97;&#x3002;&#x56E0;&#x4E3A;&#x5E73;&#x65F6;GitHub&#x7528;&#x7684;&#x5F88;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x9009;&#x62E9;&#x5728;GitHub&#x4E0A;&#x642D;&#x5EFA;&#x535A;&#x5BA2;&#x3002;&#x4E00;&#x5F00;&#x59CB;&#x770B;&#x5230;&#x7684;&#x662F;Jekyll&#xFF0C;&#x540E;&#x6765;&#x770B;&#x5230;&#x7528;Hexo&#x7684;&#x5E16;&#x5B50;&#xFF0C;&#x89C9;&#x5F97;Hexo&#x4E5F;&#x4E0D;&#x9519;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x9009;&#x5B9A;&#x4ECE;Hexo&#x5F00;&#x59CB;&#x4E86;&#x3002; &#x56E0;&#x4E3A;&#x5E73;&#x65F6;&#x591A;&#x7528;Evernote&#x8BB0;&#x5F55;&#x5404;&#x79CD;&#x8BFB;&#x4E66;&#x7B14;&#x8BB0;&#xFF0C;&#x6298;&#x817E;&#x5386;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x5E0C;&#x671B;&#x80FD;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x7528;Evernote&#x4E2D;&#x7B14;&#x8BB0;&#x4F5C;&#x4E3A;blog post&#x7684;&#x5DE5;&#x5177;&#x3002;&#x6700;&#x540E;&#x5728;npm&#x4E0A;&#x53D1;&#x73B0;&#x4E86;everblog&#xFF0C;&#x6B63;&#x597D;&#x7B26;&#x5408;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x4F46;&#x5F53;&#x7136;&#x514D;&#x4E0D;&#x4E86;&#x5404;&#x79CD;&#x8E29;&#x5751;&#x3002;&#x597D;&#x5728;&#x6700;&#x540E;&#x987A;&#x5229;&#x89E3;&#x51B3;&#x3002;&#x672C;&#x6587;&#x4F1A;&#x6709;&#x6240;&#x8BB0;&#x5F55;&#x3002;&#x5728;GitHub&#x4E0A;&#x642D;&#x5EFA;Hexo&#x535A;&#x5BA2;&#x5728;google&#x4E0A;&#x4E00;&#x641C;&#x4E00;&#x5927;&#x645E;&#x3002;&#x8D34;&#x51FA;&#x6211;&#x53C2;&#x8003;&#x7684;&#x94FE;&#x63A5;&#x624B;&#x628A;&#x624B;&#x6559;&#x4F60;&#x4F7F;&#x7528;Hexo + Github Pages&#x642D;&#x5EFA;&#x4E2A;&#x4EBA;&#x72EC;&#x7ACB;&#x535A;&#x5BA2;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#xFF1A;&#x5728;GitHub&#x4E0A;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x5982;&#x6B64;&#x547D;&#x540D;&#x7684;repo: &lt;username&gt;.github.io, e.g. zhougy0717.github.io&#x7528;hexo&#x5DE5;&#x5177;&#x6765;&#x521D;&#x59CB;&#x5316;&#x8FD9;&#x4E2A;repoblog&#x6240;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x90FD;&#x5728;_config.yml&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5305;&#x62EC;deploy&#x7684;&#x4FE1;&#x606F;deploy: type: git repo: https://github.com/zhougy0717/zhougy0717.github.io.git branch: master&#x6240;&#x6709;&#x7684;post&#x5728;source/_posts&#x4E0B;Hexo&#x7684;&#x903B;&#x8F91;&#x662F;&#x5728;_posts&#x4E0B;&#x7528;Markdown&#x5199;&#x535A;&#x5BA2;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;hexo g&#x5BF9;Markdown post&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x751F;&#x6210;html&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;hexo s&#x5C06;&#x751F;&#x6210;&#x7684;&#x7F51;&#x9875;&#x7248;post&#x53D1;&#x5E03;&#x5230;GitHub&#x4E0A;&#x53BB;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x7528;.github.io&#x7684;&#x57DF;&#x540D;&#x8BBF;&#x95EE;&#x5230;&#x8BE5;&#x535A;&#x5BA2;&#x3002;Everblog&#x9879;&#x76EE;&#x5730;&#x5740;: everblog &#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF1A;npm install everblog -g&#x5728;&#x4E3B;&#x76EE;&#x5F55;&#x4E0B;&#x6DFB;&#x52A0;.everblogrc&#xFF0C;&#x5305;&#x542B;&#x5B57;&#x6BB5;&#xFF1A; tokennoteStoreUrlnotebook&#x5728;blog&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x6DFB;&#x52A0;index.jsmodule.exports = require(&apos;everblog-adaptor-hexo-html&apos;)&#x5728;blog&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x8FD0;&#x884C;everblog buildhexo s&#x6D4B;&#x8BD5;&#xFF0C;hexo d&#x90E8;&#x7F72;&#x8E29;&#x5751;&#x8BB0;&#x5F55;EDAMSystemException: authenticationToken&#x5404;&#x79CD;&#x7FFB;&#x770B;Evernote API&#x548C;Evernote Nodejs SDK&#xFF0C; &#x6700;&#x540E;&#x8FD8;&#x662F;&#x7528;&#x4EE3;&#x7801;&#x5355;&#x6B65;&#x5F97;&#x77E5;&#xFF0C;&#x662F;serviceHost&#x7684;&#x95EE;&#x9898;&#x3002;servicceHost&#x9ED8;&#x8BA4;&#x91C7;&#x7528;&#x201D;www.evernote.com&#x201D;&#x3002;&#x800C;&#x8FD9;&#x4E2A;&#x503C;&#x662F;&#x53EF;&#x4EE5;&#x4F20;&#x7ED9;Evernote.Client&#x7684;&#x3002;&#x800C;&#x7531;&#x4E8E;everblog&#x5C06;.everblogrc&#x4E2D;&#x7684;&#x503C;&#x76F4;&#x63A5;&#x4F20;&#x7ED9;Evernote.Client&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;.everblogrc&#x4E2D;&#x6DFB;&#x52A0;serviceHost&#x503C;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x6210;&#x529F;build&#x4E86;&#x3002;HTML based Hexo blog&#x7531;&#x4E8E;Hexo&#x7684;&#x539F;&#x751F;&#x903B;&#x8F91;&#x662F;&#x7528;Markdown&#x5199;blog&#xFF0C;&#x800C;&#x524D;&#x6587;&#x63D0;&#x5230;&#xFF0C;&#x672C;&#x6B21;&#x642D;&#x5EFA;&#x535A;&#x5BA2;&#x5E0C;&#x671B;&#x57FA;&#x4E8E;Evernote&#x3002;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x7528;&#x9A6C;&#x514B;&#x98DE;&#x8C61;&#x5199;&#x5B8C;&#x7B14;&#x8BB0;&#x540E;&#xFF0C;&#x76F4;&#x63A5;&#x53D1;&#x5E03;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x4F46;Windows&#x4E0B;&#x7C7B;MWeb&#x7684;&#x5DE5;&#x5177;&#x90FD;&#x5F97;&#x4ED8;&#x94B1;&#x3002;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x5305;&#x62EC;MWeb&#xFF0C;&#x90FD;&#x9700;&#x81EA;&#x884C;&#x7EF4;&#x62A4;&#x7B14;&#x8BB0;&#x539F;&#x59CB;&#x8D44;&#x6E90;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6E32;&#x67D3;&#x540E;&#x7684;Markdown&#x53D1;&#x5E03;&#x5230;&#x5404;Web Service&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x8FD8;&#x662F;&#x5E0C;&#x671B;&#x80FD;&#x4FDD;&#x7559;Evernote + &#x9A6C;&#x514B;&#x98DE;&#x8C61;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x3002; everblog&#x81EA;&#x5E26;&#x7684;adaptor&#x662F;everblog-adaptor-hexo&#xFF0C;&#x5176;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x662F;&#x5BFC;&#x51FA;&#x7B14;&#x8BB0;&#x4E2D;&#x7684;&#x7EAF;&#x6587;&#x672C;&#xFF0C;&#x7136;&#x540E;&#x751F;&#x6210;Markdown&#x6587;&#x4EF6;&#x53D1;&#x5E03;&#x3002;&#x5176;&#x57FA;&#x4E8E;everblog&#x4F5C;&#x8005;&#x7684;&#x53E6;&#x5916;&#x4E00;&#x4E2A;project&#x2014;&#x2014;enml2text&#x3002;everblog&#x4F5C;&#x8005;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;project&#x2014;&#x2014;enml2html&#x3002; &#x4E8E;&#x662F;&#x6700;&#x540E;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x5F0F;&#x662F;&#xFF0C;&#x5BF9;&#x7B14;&#x8BB0;&#x7684;content&#xFF0C;&#x8C03;&#x7528;enml2html&#x751F;&#x6210;html&#x6587;&#x4EF6;&#x3002;&#x4F46;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x751F;&#x6210;&#x7684;html&#x7684;&#x6587;&#x4EF6;&#x65E0;&#x6CD5;&#x663E;&#x793A;&#x56FE;&#x7247;&#x3002; &#x8FD9;&#x662F;&#x56E0;&#x4E3A;enml2html&#x751F;&#x6210;&#x56FE;&#x7247;&#x8DEF;&#x5F84;&#x7684;&#x65B9;&#x5F0F;&#x8FC7;&#x671F;&#x4E86;&#xFF0C;&#x6839;&#x636E;Evernote developer&#x7F51;&#x9875;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FDB;&#x884C;&#x4E86;&#x66F4;&#x65B0;&#x5E76;&#x63D0;&#x4EA4;&#x4E86;pull request&#x3002;&#x8FD9;&#x65F6;&#x4ECD;&#x7136;&#x6709;&#x53E6;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x5370;&#x8C61;&#x7B14;&#x8BB0;&#x7684;&#x56FE;&#x7247;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x5916;&#x94FE;&#x7684;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x4F60;&#x6CA1;&#x767B;&#x5F55;&#x5370;&#x8C61;&#x7B14;&#x8BB0;&#x7F51;&#x9875;&#x7528;&#x6237;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x535A;&#x5BA2;&#x91CC;&#x9762;&#x7684;&#x56FE;&#x7247;&#x7EDF;&#x7EDF;&#x4E0D;&#x80FD;&#x663E;&#x793A;&#x3002;&#x4E8E;&#x662F;&#x4E4E;&#xFF0C;&#x5C31;&#x53EA;&#x80FD;&#x5C06;&#x56FE;&#x7247;&#x4E0B;&#x8F7D;&#x5230;&#x672C;&#x5730;&#xFF0C;&#x5E76;&#x5728;img src&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x6807;&#x6CE8;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x663E;&#x793A;&#x56FE;&#x7247;&#x4E86;&#x3002;&#x672C;&#x5730;&#x56FE;&#x7247;&#x663E;&#x793A;&#x627F;&#x63A5;&#x4E0A;&#x6587;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;&#x7F51;&#x4E0A;&#x662F;&#x6709;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#x7684;&#x3002;&#x4E8E;&#x662F;&#x641C;&#x5230;&#x8FD9;&#x7BC7;&#x7F51;&#x9875;&#xFF1A;Hexo&#x6846;&#x67B6;&#x4E0B;&#x7ED9;&#x535A;&#x5BA2;&#x63D2;&#x5165;&#x672C;&#x5730;&#x56FE;&#x7247;&#x3002;&#x4E8E;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x7F51;&#x9875;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4FEE;&#x6539;everblog-adaptor-hexo&#x5B9E;&#x73B0;&#x4E0B;&#x8F7D;&#x7F51;&#x9875;&#x5E76;&#x80FD;&#x663E;&#x793A;&#x56FE;&#x7247;&#x3002;&#x4F46;inline&#x56FE;&#x7247;&#xFF08;MathJax&#x6E32;&#x67D3;&#x7684;&#x516C;&#x5F0F;&#x56FE;&#x7247;&#xFF09;&#x5C3A;&#x5BF8;&#x53D8;&#x5F97;&#x5F88;&#x5927;&#xFF0C;&#x67E5;&#x4E86;&#x4E00;&#x4E0B;evernote&#x5BA2;&#x6237;&#x7AEF;&#x5BFC;&#x51FA;&#x7684;html&#xFF0C;&#x8FD9;&#x4E9B;&#x56FE;&#x7247;&#x90FD;&#x5F97;&#x5230;&#x4E86;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x7F29;&#x653E;&#x3002;&#x4E0D;&#x77E5;&#x9053;&#x5176;&#x7F29;&#x653E;&#x903B;&#x8F91;&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x4E0D;&#x60F3;&#x90A3;&#x4E48;&#x591A;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x5BF9;&#x6240;&#x6709;__SVG__&#x5F00;&#x5934;&#x7684;&#x56FE;&#x7247;&#x90FD;&#x8FDB;&#x884C;&#x4E86;47.5%&#x7684;&#x7F29;&#x5C0F;&#x3002;&#x5F15;&#x7528;&#x6587;&#x5B57;&#x4E2D;&#x5BF9;&#x9F50;&#x95EE;&#x9898;Hexo theme&#x7684;&#x95EE;&#x9898;&#x3002;&#x8BD5;&#x4E86;&#x51E0;&#x4E2A;them&#xFF0C;&#x6700;&#x7EC8;&#x7528;&#x7684;&#x662F;freemind&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;%23%20%u5728GitHub%u4E0A%u7528Evernote+Hexo%u642D%u5EFA%u4E2A%u4EBA%u9759%u6001%u535A%u5BA2%0A@%28myblog%29%5Bhexo%2C%20GitHub%5D%0A%0A%5BTOC%5D%0A%0A%u5199%u535A%u5BA2%u7684%u60F3%u6CD5%u7531%u6765%u5DF2%u4E45%uFF0C%u66F4%u591A%u7684%u5206%u4EAB%u624D%u6709%u66F4%u591A%u7684%u83B7%u5F97%u3002%u56E0%u4E3A%u5E73%u65F6GitHub%u7528%u7684%u5F88%u591A%uFF0C%u6240%u4EE5%u9009%u62E9%u5728GitHub%u4E0A%u642D%u5EFA%u535A%u5BA2%u3002%u4E00%u5F00%u59CB%u770B%u5230%u7684%u662FJekyll%uFF0C%u540E%u6765%u770B%u5230%u7528Hexo%u7684%u5E16%u5B50%uFF0C%u89C9%u5F97Hexo%u4E5F%u4E0D%u9519%uFF0C%u4E8E%u662F%u5C31%u9009%u5B9A%u4ECEHexo%u5F00%u59CB%u4E86%u3002%0A%u56E0%u4E3A%u5E73%u65F6%u591A%u7528Evernote%u8BB0%u5F55%u5404%u79CD%u8BFB%u4E66%u7B14%u8BB0%uFF0C%u6298%u817E%u5386%u7A0B%uFF0C%u6240%u4EE5%u5E0C%u671B%u80FD%u627E%u5230%u4E00%u4E2A%u76F4%u63A5%u7528Evernote%u4E2D%u7B14%u8BB0%u4F5C%u4E3Ablog%20post%u7684%u5DE5%u5177%u3002%u6700%u540E%u5728npm%u4E0A%u53D1%u73B0%u4E86everblog%uFF0C%u6B63%u597D%u7B26%u5408%u81EA%u5DF1%u7684%u9700%u6C42%uFF0C%u4F46%u5F53%u7136%u514D%u4E0D%u4E86%u5404%u79CD%u8E29%u5751%u3002%u597D%u5728%u6700%u540E%u987A%u5229%u89E3%u51B3%u3002%u672C%u6587%u4F1A%u6709%u6240%u8BB0%u5F55%u3002%0A%0A%23%23%20%u5728GitHub%u4E0A%u642D%u5EFAHexo%u535A%u5BA2%0A%u5728google%u4E0A%u4E00%u641C%u4E00%u5927%u645E%u3002%u8D34%u51FA%u6211%u53C2%u8003%u7684%u94FE%u63A5%5B%u624B%u628A%u624B%u6559%u4F60%u4F7F%u7528Hexo%20+%20Github%20Pages%u642D%u5EFA%u4E2A%u4EBA%u72EC%u7ACB%u535A%u5BA2%5D%28https%3A//linghucong.js.org/2016/04/15/2016-04-15-hexo-github-pages-blog/%29%0A%0A%u7B80%u5355%u6765%u8BF4%u5C31%u662F%uFF1A%0A1.%20%u5728GitHub%u4E0A%u6CE8%u518C%u4E00%u4E2A%u5982%u6B64%u547D%u540D%u7684repo%3A%20%26lt%3Busername%26gt%3B.github.io%2C%20e.g.%20zhougy0717.github.io%0A2.%20%u7528hexo%u5DE5%u5177%u6765%u521D%u59CB%u5316%u8FD9%u4E2Arepo%0A3.%20blog%u6240%u6709%u7684%u914D%u7F6E%u4FE1%u606F%u90FD%u5728_config.yml%u6587%u4EF6%u4E2D%uFF0C%u5305%u62ECdeploy%u7684%u4FE1%u606F%0A%60%60%60yaml%0Adeploy%3A%0A%20%20type%3A%20git%0A%20%20repo%3A%20https%3A//github.com/zhougy0717/zhougy0717.github.io.git%0A%20%20branch%3A%20master%0A%60%60%60%0A4.%20%u6240%u6709%u7684post%u5728%60source/_posts%60%u4E0B%0A%0AHexo%u7684%u903B%u8F91%u662F%u5728_posts%u4E0B%u7528Markdown%u5199%u535A%u5BA2%uFF0C%u7136%u540E%u8C03%u7528%60hexo%20g%60%u5BF9Markdown%20post%u8FDB%u884C%u6E32%u67D3%u751F%u6210html%uFF0C%u6700%u540E%u8C03%u7528%60hexo%20s%60%u5C06%u751F%u6210%u7684%u7F51%u9875%u7248post%u53D1%u5E03%u5230GitHub%u4E0A%u53BB%uFF0C%u4ECE%u800C%u53EF%u4EE5%u7528.github.io%u7684%u57DF%u540D%u8BBF%u95EE%u5230%u8BE5%u535A%u5BA2%u3002%0A%0A%23%23Everblog%0A%u9879%u76EE%u5730%u5740%3A%20%5Beverblog%5D%28https%3A//github.com/everblogjs/everblog%29%0A%u4F7F%u7528%u65B9%u6CD5%uFF1A%0A1.%20npm%20install%20everblog%20-g%0A2.%20%u5728%u4E3B%u76EE%u5F55%u4E0B%u6DFB%u52A0.everblogrc%uFF0C%u5305%u542B%u5B57%u6BB5%uFF1A%0A%09-%20token%0A%09-%20noteStoreUrl%0A%09-%20notebook%0A3.%20%u5728blog%u6839%u76EE%u5F55%u4E0B%u6DFB%u52A0index.js%0A%60%60%60%20javascript%0Amodule.exports%20%3D%20require%28%27everblog-adaptor-hexo-html%27%29%0A%60%60%60%0A3.%20%u5728blog%u6839%u76EE%u5F55%u4E0B%u8FD0%u884C%60everblog%20build%60%0A4.%20%60hexo%20s%60%u6D4B%u8BD5%uFF0C%60hexo%20d%60%u90E8%u7F72%0A%0A%23%23%23%20%u8E29%u5751%u8BB0%u5F55%0A%23%23%23%23EDAMSystemException%3A%20authenticationToken%0A%u5404%u79CD%u7FFB%u770BEvernote%20API%u548CEvernote%20Nodejs%20SDK%uFF0C%20%u6700%u540E%u8FD8%u662F%u7528%u4EE3%u7801%u5355%u6B65%u5F97%u77E5%uFF0C%u662FserviceHost%u7684%u95EE%u9898%u3002servicceHost%u9ED8%u8BA4%u91C7%u7528%22www.evernote.com%22%u3002%u800C%u8FD9%u4E2A%u503C%u662F%u53EF%u4EE5%u4F20%u7ED9Evernote.Client%u7684%u3002%u800C%u7531%u4E8Eeverblog%u5C06.everblogrc%u4E2D%u7684%u503C%u76F4%u63A5%u4F20%u7ED9Evernote.Client%uFF0C%u6240%u4EE5%u6211%u4EEC%u53EF%u4EE5%u5728.everblogrc%u4E2D%u6DFB%u52A0serviceHost%u503C%u3002%u8FD9%u6837%u5C31%u53EF%u4EE5%u6210%u529Fbuild%u4E86%u3002%0A%0A%23%23%23%23HTML%20based%20Hexo%20blog%0A%u7531%u4E8EHexo%u7684%u539F%u751F%u903B%u8F91%u662F%u7528Markdown%u5199blog%uFF0C%u800C%u524D%u6587%u63D0%u5230%uFF0C%u672C%u6B21%u642D%u5EFA%u535A%u5BA2%u5E0C%u671B%u57FA%u4E8EEvernote%u3002%u8FD9%u6837%u6BCF%u6B21%u7528%u9A6C%u514B%u98DE%u8C61%u5199%u5B8C%u7B14%u8BB0%u540E%uFF0C%u76F4%u63A5%u53D1%u5E03%u5C31%u53EF%u4EE5%u4E86%u3002%u4F46Windows%u4E0B%u7C7BMWeb%u7684%u5DE5%u5177%u90FD%u5F97%u4ED8%u94B1%u3002%u800C%u4E14%u8FD9%u4E9B%u5DE5%u5177%u5305%u62ECMWeb%uFF0C%u90FD%u9700%u81EA%u884C%u7EF4%u62A4%u7B14%u8BB0%u539F%u59CB%u8D44%u6E90%uFF0C%u7136%u540E%u5C06%u6E32%u67D3%u540E%u7684Markdown%u53D1%u5E03%u5230%u5404Web%20Service%u3002%u6240%u4EE5%uFF0C%u8FD8%u662F%u5E0C%u671B%u80FD%u4FDD%u7559Evernote%20+%20%u9A6C%u514B%u98DE%u8C61%u5DE5%u4F5C%u65B9%u5F0F%u3002%0Aeverblog%u81EA%u5E26%u7684adaptor%u662Feverblog-adaptor-hexo%uFF0C%u5176%u5DE5%u4F5C%u65B9%u5F0F%u662F%u5BFC%u51FA%u7B14%u8BB0%u4E2D%u7684%u7EAF%u6587%u672C%uFF0C%u7136%u540E%u751F%u6210Markdown%u6587%u4EF6%u53D1%u5E03%u3002%u5176%u57FA%u4E8Eeverblog%u4F5C%u8005%u7684%u53E6%u5916%u4E00%u4E2Aproject%u2014%u2014enml2text%u3002everblog%u4F5C%u8005%u8FD8%u6709%u4E00%u4E2Aproject%u2014%u2014enml2html%u3002%0A%u4E8E%u662F%u6700%u540E%u7684%u89E3%u51B3%u65B9%u5F0F%u662F%uFF0C%u5BF9%u7B14%u8BB0%u7684content%uFF0C%u8C03%u7528enml2html%u751F%u6210html%u6587%u4EF6%u3002%u4F46%u6709%u4E00%u4E2A%u95EE%u9898%uFF0C%u751F%u6210%u7684html%u7684%u6587%u4EF6%u65E0%u6CD5%u663E%u793A%u56FE%u7247%u3002%0A%u8FD9%u662F%u56E0%u4E3Aenml2html%u751F%u6210%u56FE%u7247%u8DEF%u5F84%u7684%u65B9%u5F0F%u8FC7%u671F%u4E86%uFF0C%u6839%u636EEvernote%20developer%u7F51%u9875%u7684%u65B9%u6CD5%uFF0C%u8FDB%u884C%u4E86%u66F4%u65B0%u5E76%u63D0%u4EA4%u4E86pull%20request%u3002%0A%0A%u8FD9%u65F6%u4ECD%u7136%u6709%u53E6%u4E00%u4E2A%u95EE%u9898%uFF0C%u5C31%u662F%u5370%u8C61%u7B14%u8BB0%u7684%u56FE%u7247%u662F%u4E0D%u5141%u8BB8%u5916%u94FE%u7684%u3002%u4E5F%u5C31%u662F%u5728%u4F60%u6CA1%u767B%u5F55%u5370%u8C61%u7B14%u8BB0%u7F51%u9875%u7528%u6237%u7684%u65F6%u5019%uFF0C%u535A%u5BA2%u91CC%u9762%u7684%u56FE%u7247%u7EDF%u7EDF%u4E0D%u80FD%u663E%u793A%u3002%u4E8E%u662F%u4E4E%uFF0C%u5C31%u53EA%u80FD%u5C06%u56FE%u7247%u4E0B%u8F7D%u5230%u672C%u5730%uFF0C%u5E76%u5728img%20src%u5B57%u6BB5%u8FDB%u884C%u6807%u6CE8%uFF0C%u6765%u5B9E%u73B0%u663E%u793A%u56FE%u7247%u4E86%u3002%0A%0A%23%23%23%23%u672C%u5730%u56FE%u7247%u663E%u793A%0A%u627F%u63A5%u4E0A%u6587%u3002%u5E78%u8FD0%u7684%u662F%uFF0C%u7F51%u4E0A%u662F%u6709%u8FD9%u79CD%u9700%u6C42%u7684%u3002%u4E8E%u662F%u641C%u5230%u8FD9%u7BC7%u7F51%u9875%uFF1A%5BHexo%u6846%u67B6%u4E0B%u7ED9%u535A%u5BA2%u63D2%u5165%u672C%u5730%u56FE%u7247%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/bee73bb9-bb81-45e9-b480-5260a70d3034%29%u3002%u4E8E%u662F%u57FA%u4E8E%u8FD9%u4E2A%u7F51%u9875%u4E2D%u63D0%u5230%u7684%u65B9%u6CD5%uFF0C%u4FEE%u6539everblog-adaptor-hexo%u5B9E%u73B0%u4E0B%u8F7D%u7F51%u9875%u5E76%u80FD%u663E%u793A%u56FE%u7247%u3002%u4F46inline%u56FE%u7247%uFF08MathJax%u6E32%u67D3%u7684%u516C%u5F0F%u56FE%u7247%uFF09%u5C3A%u5BF8%u53D8%u5F97%u5F88%u5927%uFF0C%u67E5%u4E86%u4E00%u4E0Bevernote%u5BA2%u6237%u7AEF%u5BFC%u51FA%u7684html%uFF0C%u8FD9%u4E9B%u56FE%u7247%u90FD%u5F97%u5230%u4E86%u4E00%u5B9A%u7A0B%u5EA6%u7684%u7F29%u653E%u3002%u4E0D%u77E5%u9053%u5176%u7F29%u653E%u903B%u8F91%u662F%u4EC0%u4E48%u3002%u4E0D%u60F3%u90A3%u4E48%u591A%uFF0C%u4E8E%u662F%u6211%u5BF9%u6240%u6709%60__SVG__%60%u5F00%u5934%u7684%u56FE%u7247%u90FD%u8FDB%u884C%u4E8647.5%25%u7684%u7F29%u5C0F%u3002%0A%0A%23%23%23%23%u5F15%u7528%u6587%u5B57%u4E2D%u5BF9%u9F50%u95EE%u9898%0AHexo%20theme%u7684%u95EE%u9898%u3002%u8BD5%u4E86%u51E0%u4E2Athem%uFF0C%u6700%u7EC8%u7528%u7684%u662Ffreemind%u6CA1%u6709%u8FD9%u4E2A%u95EE%u9898%u3002]]></content>
      <tags>
        <tag>GitHub</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Machine Learning (5) - Large Scale Machine Learning]]></title>
    <url>%2F2017%2F06%2F23%2FMachine_Learning_(5)_-_Large_Scale_Machine_Learning%2F</url>
    <content type="text"><![CDATA[EditStochastic gradient descent&#x56DE;&#x5FC6;&#x7EBF;&#x6027;&#x56DE;&#x5F52;&#x7684;cost function&#xFF1A; m&#x662F;sample&#x6570;&#x91CF;&#xFF0C;&#x5F53;m&#x5F88;&#x5927;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F8B;&#x5982;1,000,000&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x6240;&#x6709;&#x7684;sample&#x5168;&#x90E8;&#x6295;&#x5165;&#x8FD0;&#x7B97;&#xFF0C;&#x8FD9;&#x662F;&#x5F88;&#x60CA;&#x4EBA;&#x7684;&#x8FD0;&#x7B97;&#x91CF;&#x3002;Stochastic&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x53EA;&#x7528;&#x4E00;&#x4E2A;sample&#xFF0C;&#x5E76;&#x4E0D;&#x65AD;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x548C;&#x666E;&#x901A;&#x7684;gradient descent&#x76F8;&#x540C;&#x7684;&#x6548;&#x679C;&#x3002;Randomly shuffle datasetRepeat for i = 1, &#x2026;, m for j = 0, &#x2026;, n Mini-batch gradient descent&#x6539;&#x8FDB;&#x7248;&#x7684;stochastic gradient descentBatch gradient descent: Use all m examples in each iteration Stochastic gradient descent: Use1 example in each iteration Mini-batch gradient descent: Use b examples in each iteration Say b = 10, m = 1000 Repeat{for i = 1, 11, 21, 31,&#x2026;,991{ for j = 0,&#x2026;, n }}&#x5728;stochastic&#x7684;&#x56FE;&#x50CF;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8FD9;&#x79CD;&#x7B97;&#x6CD5;&#x548C;batch&#x7B97;&#x6CD5;&#x6BD4;&#x8F83;&#xFF0C;&#x66F4;&#x591A;&#x8FC2;&#x56DE;&#x5A49;&#x8F6C;&#xFF0C;&#x96BE;&#x4E8E;&#x6536;&#x655B;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x53D6;&#x7684;&#x65F6;&#x5019;&#x8981;&#x683C;&#x5916;&#x5C0F;&#x5FC3;&#x3002;&#x4E00;&#x822C;&#x91C7;&#x7528;&#x52A8;&#x6001;&#x8C03;&#x6574;&#x7684;&#x529E;&#x6CD5;&#x8BBE;&#x7F6E;Learning rate is typically held constant. Can slowly decrease over timee if we want to converge. Online learning&#x8FD9;&#x5176;&#x5B9E;&#x662F;stochastic&#x7B97;&#x6CD5;&#x7684;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x3002;&#x56E0;&#x4E3A;&#x5728;&#x6BCF;&#x4E00;&#x6B21;&#x7684;&#x8FED;&#x4EE3;&#x4E2D;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x6240;&#x6709;&#x7684;sample&#x90FD;&#x53C2;&#x4E0E;&#xFF0C;&#x6240;&#x4EE5;&#x7B97;&#x6CD5;&#x53EF;&#x4EE5;&#x4E00;&#x8FB9;&#x624B;&#x673A;&#x6570;&#x636E;&#xFF0C;&#x4E00;&#x8FB9;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#x4F18;&#x5316;&#x3002;Map-reduce and data parallelism%23Machine%20Learning%20%285%29%20-%20Large%20Scale%20Machine%20Learning%0A@%28myblog%29%5B%u6DF1%u5EA6%u5B66%u4E60%5D%0A%0A%0A%23%23Stochastic%20gradient%20descent%0A%0A%u56DE%u5FC6%u7EBF%u6027%u56DE%u5F52%u7684cost%20function%uFF1A%0A%24%24J%28%5Ctheta%29%20%3D%20%5Cdfrac%20%7B1%7D%7B2m%7D%5Csum_%7Bi%3D1%7D%5Em%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29-y%5E%7B%28i%29%7D%29%5E2%24%24%0Am%u662Fsample%u6570%u91CF%uFF0C%u5F53m%u5F88%u5927%u7684%u65F6%u5019%uFF0C%u4F8B%u59821%2C000%2C000%uFF0C%u6211%u4EEC%u9700%u8981%u5C06%u6240%u6709%u7684sample%u5168%u90E8%u6295%u5165%u8FD0%u7B97%uFF0C%u8FD9%u662F%u5F88%u60CA%u4EBA%u7684%u8FD0%u7B97%u91CF%u3002%0A%0AStochastic%u7684%u610F%u601D%u5C31%u662F%u6BCF%u6B21%u53EA%u7528%u4E00%u4E2Asample%uFF0C%u5E76%u4E0D%u65AD%u8FDB%u884C%u8FED%u4EE3%uFF0C%u4ECE%u800C%u8FBE%u5230%u548C%u666E%u901A%u7684gradient%20descent%u76F8%u540C%u7684%u6548%u679C%u3002%0A%0A1.%20%24cost%28%5Ctheta%2C%20%28x%5E%7B%28i%29%7D%29%20-%20y%5E%7B%28i%29%7D%29%5E2%20%3D%20%5Cfrac%7B1%7D%7B2%7D%28h_%7B%5Ctheta%7D%28x%5E%7B%28i%29%7D%29%20-%20y%5E%7B%28i%29%7D%29%5E2%24%0A2.%20%24J_%7Btrain%7D%28%5Ctheta%29%20%3D%20%5Cfrac%20%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Emcost%28%5Ctheta%2C%20%28x%5E%7B%28i%29%7D%2C%20y%5E%7B%28i%29%7D%29%29%24%0A3.%20Randomly%20shuffle%20dataset%0A4.%20Repeat%20%0A%09-%20for%20i%20%3D%201%2C%20...%2C%20m%0A%09%09%20*%20for%20j%20%3D%200%2C%20...%2C%20n%0A%09%09%09%24%5Ctheta_j%20%3A%3D%20%5Ctheta_j%20-%20%5Calpha%28h_%7B%5Ctheta%7D%28x%5E%7B%28i%29%7D%29-y%5E%7B%28i%29%7D%29x_j%5E%7B%28i%29%7D%24%0A%09%09%09%0A%21%5BAlt%20text%5D%28./1498184027550.png%29%0A%0A%23%23Mini-batch%20gradient%20descent%0A%u6539%u8FDB%u7248%u7684stochastic%20gradient%20descent%0A%3EBatch%20gradient%20descent%3A%20Use%20all%20m%20examples%20in%20each%20iteration%0AStochastic%20gradient%20descent%3A%20Use1%20example%20in%20each%20iteration%0AMini-batch%20gradient%20descent%3A%20Use%20b%20examples%20in%20each%20iteration%20%0A%0ASay%20b%20%3D%2010%2C%20m%20%3D%201000%0ARepeat%7B%0A-%20for%20i%20%3D%201%2C%2011%2C%2021%2C%2031%2C...%2C991%7B%0A%09*%20for%20j%20%3D%200%2C...%2C%20n%0A%09%09*%20%24%5Ctheta_j%20%3A%3D%20%5Ctheta_j%20-%20%5Calpha%20%5Cfrac%7B1%7D%7B10%7D%5Csum_%7Bk%3Di%7D%5E%7Bi+9%7D%28h_%7B%5Ctheta%7D%28x%5E%7B%28k%29%7D%29%20-%20y%5E%7B%28k%29%7D%29x_j%5E%7B%28k%29%7D%24%0A%09*%20%7D%0A-%20%7D%0A%0A%u5728stochastic%u7684%u56FE%u50CF%u4E2D%uFF0C%u6211%u4EEC%u53EF%u4EE5%u770B%u5230%uFF0C%u8FD9%u79CD%u7B97%u6CD5%u548Cbatch%u7B97%u6CD5%u6BD4%u8F83%uFF0C%u66F4%u591A%u8FC2%u56DE%u5A49%u8F6C%uFF0C%u96BE%u4E8E%u6536%u655B%u3002%u6240%u4EE5%u5728%u53D6%24%5Calpha%24%u7684%u65F6%u5019%u8981%u683C%u5916%u5C0F%u5FC3%u3002%u4E00%u822C%u91C7%u7528%u52A8%u6001%u8C03%u6574%u7684%u529E%u6CD5%u8BBE%u7F6E%24%5Calpha%24%0A%0A%3ELearning%20rate%20%24%5Calpha%24%20is%20typically%20held%20constant.%20Can%20slowly%20decrease%20%24%5Calpha%24%20over%20timee%20if%20we%20want%20%24%5Ctheta%24%20to%20converge.%0A%3E%24%24Eg%3A%20%5Calpha%20%3D%20%5Cfrac%20%7Bconst1%7D%7BiterationNumber%20+%20const2%7D%24%24%0A%0A%23%23Online%20learning%0A%u8FD9%u5176%u5B9E%u662Fstochastic%u7B97%u6CD5%u7684%u4E00%u4E2A%u5E94%u7528%u3002%u56E0%u4E3A%u5728%u6BCF%u4E00%u6B21%u7684%u8FED%u4EE3%u4E2D%uFF0C%u4E0D%u9700%u8981%u6240%u6709%u7684sample%u90FD%u53C2%u4E0E%uFF0C%u6240%u4EE5%u7B97%u6CD5%u53EF%u4EE5%u4E00%u8FB9%u624B%u673A%u6570%u636E%uFF0C%u4E00%u8FB9%u8FDB%u884C%u8FED%u4EE3%u4F18%u5316%u3002%0A%0A%23%23Map-reduce%20and%20data%20parallelism%0A%21%5BAlt%20text%5D%28./1498184980549.png%29%0A%u6240%u8C13%u7684map-reduce%u4E5F%u5C31%u662F%u5206%u5E03%u5F0F%u8FD0%u7B97%uFF0C%u51CF%u8F7B%u4E00%u5904%u7684%u8BA1%u7B97%u538B%u529B%uFF0C%u4FBF%u4E8E%u96C6%u7FA4%u8FD0%u7B97%u3002]]></content>
      <tags>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Machine Learning (4) - Unsupervised Learning]]></title>
    <url>%2F2017%2F05%2F21%2FMachine_Learning_(4)_-_Unsupervised_Learning%2F</url>
    <content type="text"><![CDATA[EditMachine Learning (4) - Unsupervised LearningClustering - K-means Algorithm&#x6B65;&#x9AA4;&#x8C03;&#x4F18;&#x76EE;&#x7684;Cost Function&#x9009;&#x62E9;cluster numberDimensionality Reduction - Principal Component Analysis (PCA)&#x6B65;&#x9AA4;ReconstructChoose kApplication of PCAAnomaly detection algorithm&#x7ED3;&#x679C;&#x8BC4;&#x4F30;&#x7279;&#x5F81;&#x91CF;&#x7684;&#x9009;&#x53D6;Multivariate Gaussian distributionAnomaly detection vs. supervised learningRecommender SystemsContent-based recommender systemsCollaborative filteringClustering - K-means Algorithm&#x6B65;&#x9AA4;Randomly initialize K cluster centroids . 1) Should have 2) Randomly pick K training examples 3) Set euqal to these K examples.Repeat for i=1 to m := index (from 1 to K) of cluster centroid closest to x^{(i)} &#x5C06;&#x5F52;&#x5230;&#x79BB;&#x5176;&#x6700;&#x8FD1;&#x7684;centroid for k = 1 to K := average (mean) of points assigned to cluster k. &#x6309;&#x7167;&#x5F52;&#x5230;&#x8BE5;centroid&#x7684;&#x6240;&#x6709;sample&#x6765;&#x76F8;&#x5E94;&#x5730;&#x79FB;&#x52A8;&#x8BE5;centroid&#x8C03;&#x4F18;&#x76EE;&#x7684;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x56E0;&#x4E3A;&#x521D;&#x59CB;&#x5316;&#x4E0D;&#x5F53;&#xFF0C;&#x800C;&#x4EA7;&#x751F;local optimaCost Function &#x8C03;&#x4F18;&#x5C31;&#x662F;&#x4F7F;Cost Function&#x6700;&#x5C0F;&#x5316;&#x3002;&#x5177;&#x4F53;&#x7684;&#x505A;&#x6CD5;&#x5C31;&#x662F;&#x591A;&#x505A;&#x51E0;&#x6B21;K-means (Andrew&#x63A8;&#x8350;100&#x6B21;)&#xFF0C;&#x9009;&#x53D6;Cost Function&#x6700;&#x5C0F;&#x7684;&#x4E00;&#x7EC4;&#x3002;&#x9009;&#x62E9;cluster numberElvow method (&#x8098;&#x5173;&#x8282;&#x6CD5;)Dimensionality Reduction - Principal Component Analysis (PCA)Dimensionality Reduction = &#x964D;&#x7EF4;, 3D-&gt;2D&#x6B65;&#x9AA4;Feature scaling/mean normalization. 1) 2) 3) (optional) &#xFF0C;&#x662F;&#x6807;&#x51C6;&#x5DEE;Compute &#x201C;covariance matrix&#x201D; &#x8C03;&#x7528;&#x7CFB;&#x7EDF;&#x5E93;&#xFF0C;Compute &#x201C;eigenvectors&#x201D; of matrix : [U,S,V] = svd(Sigma);Ureduce = U(:,1:k); z = Ureduce&apos;*x;Reconstructx = Ureduce * zChoose kTypically, choose k to be smallest value so that, 0.01 means 99% variance is retained. &#x4FDD;&#x7559;&#x4E86;99%&#x7684;&#x53D8;&#x5316;&#x3002;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x901A;&#x8FC7;svd&#x51FD;&#x6570;&#x8BA1;&#x7B97;variance&#x7684;&#x65B9;&#x6CD5;Start from k=1[U,S,V] = svd(Sigma)Pick the smallest k.Application of PCACompression: &#x8282;&#x7701;&#x6570;&#x636E;&#x7A7A;&#x95F4;&#xFF0C;&#x63D0;&#x5347;&#x8BA1;&#x7B97;&#x901F;&#x5EA6;Visualization: k=2 or k = 3&#x4E0D;&#x8981;&#x6EE5;&#x7528;PCA&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x7528;PCA&#x51CF;&#x5C11;feature set&#x6765;&#x6D88;&#x9664;Overfitting Before implementing PCA, first try running whatever you want to do with the original/raw data . Only if that doesn&#x2019;t do what you want, then implement PCA and consider using Anomaly detection algorithm&#x6211;&#x5C06;&#x4E4B;&#x7FFB;&#x8BD1;&#x4E3A;&#x5F02;&#x5E38;&#x68C0;&#x6D4B;&#x3002;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x5BF9;&#x5C5E;&#x4E8E;&#x6B63;&#x6001;&#xFF08;&#x6216;&#x9AD8;&#x65AF;&#xFF09;&#x5206;&#x5E03;&#x7684;&#x7279;&#x5F81;&#x91CF;&#x7684;&#x975E;&#x6B63;&#x5E38;&#x68C0;&#x6D4B;&#x3002;Choose features that you think might be indicative of anomalous examples.Fit parameters Given new example , compute - &#x6982;&#x7387; Anomaly if &#x9AD8;&#x65AF;&#x5206;&#x5E03;&#x6982;&#x7387;&#x5BC6;&#x5EA6;&#x516C;&#x5F0F;&#xFF1A; &#x7ED3;&#x679C;&#x8BC4;&#x4F30;&#x5982;&#x4F55;&#x5BF9;&#x6570;&#x636E;&#x5206;&#x7C7B;&#x8FDB;&#x884C;training&#x548C;validateAircraft engines motivating example 10000 good(normal) engines 20 flawed engines (anomalous)Training set: 6000 good engines CV: 2000 good engines(y=0), 10 anomalous(y=1) Test: 2000 good engines(y=0), 10 anomalous(y=1) &#x4E5F;&#x5C31;&#x662F;&#x628A;anomalous&#x7684;sample&#x7701;&#x4E0B;&#x6765;&#x505A;validate&#x548C;test&#x7528;&#x7279;&#x5F81;&#x91CF;&#x7684;&#x9009;&#x53D6;&#x5982;&#x679C;&#x7279;&#x5F81;&#x91CF;&#x4E0D;&#x7B26;&#x5408;&#x6B63;&#x6001;&#x5206;&#x5E03;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6309;Andrew&#x7684;&#x5EFA;&#x8BAE;&#x662F;&#x8FDB;&#x884C;&#x53D8;&#x6362;&#xFF0C;&#x5219;&#x80FD;&#x5F97;&#x5230;&#x8FD1;&#x4F3C;&#x6B63;&#x6001;&#x7684;&#x5206;&#x5E03;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;Andrew&#x5728;&#x89C6;&#x9891;&#x4E2D;&#x7528;Octave&#x547D;&#x4EE4;&#x884C;&#x505A;&#x4E86;live demo&#xFF1A;&#x8BB2;&#x4E49;&#x4E2D;&#x63D0;&#x5230;&#x7684;Error Analysis&#x6307;&#x7684;&#x662F;&#xFF1A; &#x6709;&#x4E00;&#x4E9B;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#x662F;&#xFF0C;&#x7279;&#x5F81;&#x5411;&#x91CF;&#x7684;&#x5404;&#x5206;&#x91CF;&#x90FD;&#x5728;&#x5927;&#x6982;&#x7387;&#x7684;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x67D0;&#x4E9B;&#x5206;&#x91CF;&#x7EC4;&#x5408;&#x65F6;&#xFF0C;&#x4F1A;&#x662F;&#x5C0F;&#x6982;&#x7387;&#x4E8B;&#x4EF6;&#xFF0C;&#x5219;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x4EA7;&#x751F;&#x65B0;&#x7684;&#x7279;&#x5F81;&#x5411;&#x91CF;&#x3002;&#x4F8B;&#x5982;&#xFF1A;Andrew&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5F53;CPU load&#x76F8;&#x5BF9;&#x8F83;&#x5927;&#xFF0C;&#x4F46;&#x4ECD;&#x5728;&#x6B63;&#x5E38;&#x8303;&#x56F4;&#xFF0C;&#x4F46;&#x662F;network traffic&#x5374;&#x5F88;&#x5C0F;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x5728;&#x6B63;&#x5E38;&#x8303;&#x56F4;&#x3002;&#x8FD9;&#x65F6;&#x4F60;&#x5C31;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x6BD4;&#x5982;&#x6216;&#x8005;&#x53D6;&#x51B3;&#x4E8E;&#x65B0;&#x7684;&#x7279;&#x5F81;&#x91CF;&#x662F;&#x5426;&#x662F;&#x6B63;&#x6001;&#x5206;&#x5E03;&#x3002;Multivariate Gaussian distribution&#x524D;&#x9762;&#x7684;Anomaly Detection&#x57FA;&#x4E8E;&#x5404;&#x7279;&#x5F81;&#x5206;&#x91CF;&#x662F;&#x72EC;&#x7ACB;&#x5206;&#x5E03;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x975E;&#x72EC;&#x7ACB;&#x5206;&#x5E03;&#x5C31;&#x91C7;&#x7528;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;Error Analysis&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x800C;Multivariate Gaussian&#x5219;&#x662F;&#x5BF9;&#x975E;&#x72EC;&#x7ACB;&#x5206;&#x5E03;&#x7684;&#x8865;&#x5145;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E0A;&#x9762;&#x7684;Anomaly Detection&#x5176;&#x5B9E;&#x662F;Multivariate Gaussian&#x7684;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x3002;Andrew&#x7ED9;&#x51FA;&#x4E86;&#x77E2;&#x91CF;&#x5316;&#x7684;Multivariate Gaussian&#x7684;&#x6982;&#x7387;&#x5BC6;&#x5EA6;&#x516C;&#x5F0F;&#xFF1A; &#x5176;&#x4E2D;&#x79F0;&#x4E3A;Covariance Matrix&#xFF0C;&#x534F;&#x65B9;&#x5DEE;&#x77E9;&#x9635;&#xFF0C;&#x4E3A;&#x7684;&#x884C;&#x5217;&#x5F0F;(determinant)&#xFF0C;&#x53C2;&#x8003;&#xFF1A;wiki - &#x884C;&#x5217;&#x5F0F; &#x7B80;&#x5355;&#x6458;&#x53D6;&#x4E24;&#x5F20;&#x8BA1;&#x7B97;&#x77E9;&#x9635;&#x884C;&#x5217;&#x5F0F;&#x7684;&#x63D2;&#x56FE;&#xFF1A; &#x5728;&#x4E0A;&#x9762;&#x7ED9;&#x51FA;&#x7684;&#x516C;&#x5F0F;&#x91CC;&#xFF0C;Covariance Matrix&#x5373;&#x5C31;&#x7ED9;&#x51FA;&#x4E86;&#x53D8;&#x91CF;&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x5173;&#x6027;&#x7684;&#x4FE1;&#x606F;&#x3002;Original model&#x548C;multivariate model&#x90FD;&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x5230;&#x4E0A;&#x9762;&#x4E3E;&#x7684;CPU load&#x548C;network traffic&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x90A3;&#x8981;&#x5982;&#x4F55;&#x9009;&#x62E9;&#x5462;&#xFF1F;Andrew&#x7ED9;&#x51FA;&#x4E86;&#x5BF9;&#x6BD4;&#xFF1A;Anomaly detection vs. supervised learningRecommender SystemsContent-based recommender systems&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5DF2;&#x77E5;&#x6BCF;&#x90E8;&#x7535;&#x5F71;&#x7684;&#x7279;&#x5F81;(&#x7279;&#x5F81;&#x5411;&#x91CF;)&#xFF0C;&#x4EE5;&#x53CA;&#x7528;&#x6237;&#x5BF9;&#x7535;&#x5F71;&#x7684;&#x8BC4;&#x5206;&#xFF0C;&#x6765;&#x63A8;&#x6D4B;&#x7528;&#x6237;&#x5BF9;&#x6CA1;&#x770B;&#x8FC7;&#x7684;&#x7535;&#x5F71;&#x7684;&#x8BC4;&#x5206;&#x3002;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x8868;&#x683C;&#xFF1A;&#x5176;&#x4E2D;&#xFF1A;: &#x7528;&#x6237;&#x6570;: &#x7535;&#x5F71;&#x6570;: &#x7528;&#x6237;j&#x7ED9;&#x7535;&#x5F71;i&#x8BC4;&#x5206;&#x4E86;: &#x7528;&#x6237;&#x7684;&#x771F;&#x5B9E;&#x8BC4;&#x5206;: hypothesis&#xFF0C;&#x63A8;&#x6D4B;&#x8BC4;&#x5206;Gradient Descent: for k = 0: for k 0: Collaborative filtering&#x5047;&#x8BBE;&#x5728;&#x524D;&#x9762;&#x4E00;&#x8282;&#x7684;training&#x4E2D;&#xFF0C;&#x662F;&#x5DF2;&#x77E5;&#x7684;&#xFF0C;&#x800C;&#x672A;&#x77E5;&#xFF0C;&#x5373;&#x6BCF;&#x90E8;&#x7535;&#x5F71;&#x9488;&#x5BF9;&#x5404;&#x4E2A;&#x7279;&#x5F81;&#x91CF;&#x7684;&#x8BC4;&#x5206;&#x672A;&#x77E5;&#xFF0C;&#x6B64;&#x65F6;&#x901A;&#x8FC7;training&#x4E00;&#x6837;&#x53EF;&#x4EE5;&#x63A8;&#x6D4B;&#x51FA;&#x5404;&#x7535;&#x5F71;&#x7684;&#x8BC4;&#x7EA7;&#x3002;&#x800C;Collabrative Filtering&#x5C31;&#x662F;&#x5728;&#x4E24;&#x624B;&#x7A7A;&#x7A7A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x65E2;&#x6CA1;&#x6709;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#xFF0C;&#x800C;&#x53EA;&#x6709;&#xFF0C;&#x5C31;&#x80FD;&#x9884;&#x6D4B;&#x548C;&#x3002;Initialize to small random values.Minimize using gradient descent (or an advanced optimization algorithm). For a user with parameters and a movie with (learned) features , predict a star rating of &#x56E0;&#x4E3A;&#x5B58;&#x5728;&#x672A;&#x7ED9;&#x4EFB;&#x4F55;&#x7535;&#x5F71;&#x8BC4;&#x5206;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x505A;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x5219;&#x8FD9;&#x4E9B;&#x7528;&#x6237;&#x5BF9;&#x6240;&#x6709;&#x7535;&#x5F71;&#x7684;&#x9884;&#x6D4B;&#x8BC4;&#x4EF7;&#x90FD;&#x4F1A;&#x662F;0&#x5206;&#xFF0C;&#x5177;&#x4F53;Andrew&#x5728;&#x89C6;&#x9891;&#x4E2D;&#x7ED9;&#x51FA;&#x8BBA;&#x8BC1;&#x3002;&#x6240;&#x4EE5;&#x9700;&#x8981;mean normalization&#xFF0C;&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x662F;&#xFF1A; &#x4E0D;&#x7528;&#x6807;&#x51C6;&#x5DEE;&#x9664;&#xFF0C;&#x56E0;&#x4E3A;&#x8BC4;&#x5206;&#x672C;&#x6765;&#x5C31;&#x5728;&#x8FD1;&#x4F3C;&#x7684;range1Collaborative filtering&#x77E2;&#x91CF;&#x5199;&#x6CD5;&#x662F;&#xFF1A; &#x800C;Collaborative filtering algorithm&#x53C8;&#x53EB;Low rank matrix factorization&#x3002;&#x5176;&#x4E2D;&#xFF0C;&#x5C31;&#x662F;Low rank matrix&#x3002;&#x5F53;&#x8981;&#x7ED9;&#x7528;&#x6237;&#x63A8;&#x8350;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8DB3;&#x591F;&#x5C0F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;i&#x548C;j&#x8DB3;&#x591F;&#x76F8;&#x4F3C;&#x3002;%23Machine%20Learning%20%284%29%20-%20Unsupervised%20Learning%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5B%u6DF1%u5EA6%u5B66%u4E60%5D%0A%0A%5BTOC%5D%0A%0A%23%23Clustering%20-%20K-means%20Algorithm%0A%21%5BAlt%20text%7C400x0%5D%28./1495320402756.png%29%0A%21%5BAlt%20text%7C400x0%5D%28./1495320502218.png%29%0A%u6240%u8C13%u7684K-means%u5C31%u662F%u521D%u59CB%u5316%u4E24%u4E2Acluster%20centroid%uFF0C%u7136%u540E%u901A%u8FC7%u4E0D%u65AD%u8FED%u4EE3%uFF0C%u5C06%u4E4B%u79FB%u5230%u7C07%u7684%u4E2D%u592E%uFF0C%u4ECE%u800C%u8FBE%u5230%u5206%u7C7B%u3002%0A%0A%23%23%23%u6B65%u9AA4%0A1.%20Randomly%20initialize%20K%20cluster%20centroids%20.%0A%091%29%20Should%20have%20%24K%20%5Clt%20m%24%0A%092%29%20Randomly%20pick%20K%20training%20examples%0A%093%29%20Set%20%24%5Cmu_1%2C%20%5Cmu_2%2C...%2C%20%5Cmu_K%24%20euqal%20to%20these%20K%20examples.%0A2.%20Repeat%0A%09for%20i%3D1%20to%20m%0A%09%09%24c%5E%7B%28i%29%7D%24%20%3A%3D%20index%20%28from%201%20to%20K%29%20of%20cluster%20centroid%20closest%20to%20x%5E%7B%28i%29%7D%0A%09%09%u5C06%24x%5E%7B%28i%29%7D%24%u5F52%u5230%u79BB%u5176%u6700%u8FD1%u7684centroid%0A%09for%20k%20%3D%201%20to%20K%0A%09%09%24%5Cmu_k%24%20%3A%3D%20average%20%28mean%29%20of%20points%20assigned%20to%20cluster%20k.%0A%09%09%u6309%u7167%u5F52%u5230%u8BE5centroid%u7684%u6240%u6709sample%u6765%u76F8%u5E94%u5730%u79FB%u52A8%u8BE5centroid%0A%0A%23%23%23%u8C03%u4F18%0A%23%23%23%23%u76EE%u7684%0A%u4E3A%u4E86%u907F%u514D%u56E0%u4E3A%u521D%u59CB%u5316%u4E0D%u5F53%uFF0C%u800C%u4EA7%u751Flocal%20optima%0A%23%23%23%23Cost%20Function%0A%24J%28c%5E%7B%281%29%7D%2C%20c%5E%7B%282%29%7D%2C%20...%2C%20c%5E%7B%28m%29%7D%2C%20%5Cmu_1%2C%20%5Cmu_2%2C%20...%20%2C%5Cmu_K%29%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20%5Csum_%7Bi%3D1%7D%5Em%7C%7Cx%5E%7B%28i%29%7D-%5Cmu_%7Bc%5E%7B%28i%29%7D%7D%7C%7C%5E2%24%0A%u8C03%u4F18%u5C31%u662F%u4F7FCost%20Function%u6700%u5C0F%u5316%u3002%u5177%u4F53%u7684%u505A%u6CD5%u5C31%u662F%u591A%u505A%u51E0%u6B21K-means%20%28Andrew%u63A8%u8350100%u6B21%29%uFF0C%u9009%u53D6Cost%20Function%u6700%u5C0F%u7684%u4E00%u7EC4%u3002%0A%0A%23%23%23%u9009%u62E9cluster%20number%0AElvow%20method%20%28%u8098%u5173%u8282%u6CD5%29%0A%21%5BAlt%20text%5D%28./1496198213650.png%29%0A%u4F46%u5982%u679C%u51FA%u73B0%u4E0B%u9762%u7684%u56FE%u50CF%uFF0C%u8098%u5173%u8282%u6CD5%u5C31%u5931%u6548%u4E86%0A%21%5BAlt%20text%5D%28./1496198240034.png%29%0A%u6309%u7167Andrew%u7684%u5EFA%u8BAE%uFF0C%u8FD8%u662F%u9700%u8981%u9886%u57DF%u903B%u8F91%u6765%u5224%u65AD%u9700%u8981%u5206%u4F5C%u51E0%u7C7B%u3002It%20depends%20on%20how%20to%20make%20the%20down%20stream%20or%20later%20process%20happy.%0A%0A%23%23Dimensionality%20Reduction%20-%20Principal%20Component%20Analysis%20%28PCA%29%0ADimensionality%20Reduction%20%3D%20%u964D%u7EF4%2C%203D-%3E2D%0A%23%23%23%u6B65%u9AA4%0A1.%20Feature%20scaling/mean%20normalization.%0A%091%29%20%24%5Cmu_i%20%3D%20%5Cdfrac%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Emx%5E%7B%28i%29%7D_j%24%0A%092%29%20%24x_j%5E%7B%28i%29%7D%3Dx_j%5E%7B%28i%29%7D-%5Cmu_j%24%20%0A%093%29%20%28optional%29%20%24x_j%5E%7B%28i%29%7D%20%3D%20%5Cdfrac%20%7Bx_j%5E%7B%28i%29%7D-%5Cmu_j%7D%7Bs_j%7D%24%20%uFF0C%24s_j%24%u662F%u6807%u51C6%u5DEE%0A2.%20Compute%20%u201Ccovariance%20matrix%u201D%0A%24%24%5CSigma%20%3D%20%5Cdfrac%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5En%28x%5E%7B%28i%29%7D%29%28x%5E%7B%28i%29%7D%29%5ET%24%24%0A3.%20%u8C03%u7528%u7CFB%u7EDF%u5E93%uFF0CCompute%20%u201Ceigenvectors%u201D%20of%20matrix%20%24%5CSigma%24%3A%20%60%5BU%2CS%2CV%5D%20%3D%20svd%28Sigma%29%3B%60%0A4.%20%60Ureduce%20%3D%20U%28%3A%2C1%3Ak%29%3B%20z%20%3D%20Ureduce%27*x%3B%60%0A%0A%23%23%23Reconstruct%0A%60x%20%3D%20Ureduce%20*%20z%60%0A%0A%21%5BAlt%20text%5D%28./1496209550430.png%29%0A%0A%0A%23%23%23%20Choose%20k%0ATypically%2C%20choose%20k%20to%20be%20smallest%20value%20so%20that%2C%0A%24%24%5Cdfrac%20%7B%5Cdfrac%20%7B1%7D%7Bm%7D%7C%7Cx%5E%7B%28i%29%7D-x_%7Bapprox%7D%5E%7B%28i%29%7D%7C%7C%5E2%7D%7B%5Cdfrac%20%7B1%7D%7Bm%7D%7C%7Cx%5E%7B%28i%29%7D%7C%7C%5E2%7D%20%5Cleq%200.01%24%24%0A0.01%20means%2099%25%20variance%20is%20retained.%20%u4FDD%u7559%u4E8699%25%u7684%u53D8%u5316%u3002%0A%0A%u53E6%u5916%u4E00%u79CD%u901A%u8FC7svd%u51FD%u6570%u8BA1%u7B97variance%u7684%u65B9%u6CD5%0A1.%20Start%20from%20k%3D1%0A2.%20%60%5BU%2CS%2CV%5D%20%3D%20svd%28Sigma%29%60%0A2.%20%241%20-%20%5Cdfrac%20%7B%5Csum_%7Bi%3D1%7D%5EkS_%7Bii%7D%7D%7B%5Csum_%7Bi%3D1%7D%5EnS_%7Bii%7D%7D%20%5Cleq%200.01%24%0A3.%20Pick%20the%20smallest%20k.%0A%0A%23%23%23Application%20of%20PCA%0A-%20Compression%3A%20%u8282%u7701%u6570%u636E%u7A7A%u95F4%uFF0C%u63D0%u5347%u8BA1%u7B97%u901F%u5EA6%0A-%20Visualization%3A%20k%3D2%20or%20k%20%3D%203%0A%0A%u4E0D%u8981%u6EE5%u7528PCA%u3002%u4F8B%u5982%uFF0C%u7528PCA%u51CF%u5C11feature%20set%u6765%u6D88%u9664Overfitting%0ABefore%20implementing%20PCA%2C%20first%20try%20running%20whatever%20you%20want%20to%20do%20with%20the%20original/raw%20data%20%24x%5E%7B%28i%29%7D%24.%20Only%20if%20that%20doesn%u2019t%20do%20what%20you%20want%2C%20then%20implement%20PCA%20and%20consider%20using%20%24z%5E%7B%28i%29%7D%24%0A%0A%23%23Anomaly%20detection%20algorithm%0A%u6211%u5C06%u4E4B%u7FFB%u8BD1%u4E3A%u5F02%u5E38%u68C0%u6D4B%u3002%u5B9E%u9645%u5C31%u662F%u5BF9%u5C5E%u4E8E%u6B63%u6001%uFF08%u6216%u9AD8%u65AF%uFF09%u5206%u5E03%u7684%u7279%u5F81%u91CF%u7684%u975E%u6B63%u5E38%u68C0%u6D4B%u3002%0A1.%20Choose%20features%20%24x_i%24%20that%20you%20think%20might%20be%20indicative%20of%20anomalous%20examples.%0A2.%20Fit%20parameters%20%24%5Cmu_1%2C%20...%2C%5Cmu_n%2C%20%5Csigma_1%2C...%2C%5Csigma_n%24%0A%09%24%24%5Cmu_j%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20%5Csum_%7Bi%3D1%7D%5Em%20x_j%5E%7B%28i%29%7D%24%24%0A%09%24%24%5Csigma_j%5E2%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20%5Csum_%7Bi%3D1%7D%5Em%20%28x_j%5E%7B%28i%29%7D%20-%20%5Cmu_j%29%5E2%24%24%0A3.%20Given%20new%20example%20%24x%24%2C%20compute%20%24p%28x%29%24%20-%20%u6982%u7387%0A%09%24%24p%28x%29%20%3D%20%5Cprod_%7Bj%3D1%7D%5En%20p%28x_j%3B%20%5Cmu_j%2C%20%5Csigma_j%5E2%29%20%3D%20%5Cprod_%7Bj%3D1%7D%5En%20%5Cdfrac%20%7B1%7D%7B%5Csqrt%20%7B2%5Cpi%7D%5Csigma_j%7Dexp%20%5Cleft%28%7B-%5Cdfrac%20%7B%28x_j-%5Cmu_j%29%5E2%7D%7B2%20%5Csigma_j%5E2%7D%7D%5Cright%29%24%24%0A4.%20%20Anomaly%20if%20%24p%28x%29%20%5Cle%20%5Cepsilon%24%0A%0A%u9AD8%u65AF%u5206%u5E03%u6982%u7387%u5BC6%u5EA6%u516C%u5F0F%uFF1A%0A%24%24p%28x%29%20%3D%20%5Cdfrac%20%7B1%7D%7B%5Csqrt%20%7B2%5Cpi%7D%5Csigma%7Dexp%20%5Cleft%28%7B-%5Cdfrac%20%7B%28x-%5Cmu%29%5E2%7D%7B2%20%5Csigma%5E2%7D%7D%5Cright%29%24%24%0A%0A%23%23%23%u7ED3%u679C%u8BC4%u4F30%0A%u5982%u4F55%u5BF9%u6570%u636E%u5206%u7C7B%u8FDB%u884Ctraining%u548Cvalidate%0A%0A%3EAircraft%20engines%20motivating%20example%20%0A10000%20%20good%28normal%29%20engines%0A20%20%20flawed%20engines%20%28anomalous%29%0A%0A%3ETraining%20set%3A%206000%20good%20engines%0ACV%3A%202000%20good%20engines%28y%3D0%29%2C%2010%20anomalous%28y%3D1%29%0ATest%3A%202000%20good%20engines%28y%3D0%29%2C%2010%20anomalous%28y%3D1%29%0A%u4E5F%u5C31%u662F%u628Aanomalous%u7684sample%u7701%u4E0B%u6765%u505Avalidate%u548Ctest%u7528%0A%23%23%23%u7279%u5F81%u91CF%u7684%u9009%u53D6%0A%u5982%u679C%u7279%u5F81%u91CF%u4E0D%u7B26%u5408%u6B63%u6001%u5206%u5E03%u600E%u4E48%u529E%uFF1F%u6309Andrew%u7684%u5EFA%u8BAE%u662F%u8FDB%u884C%u53D8%u6362%uFF0C%u5219%u80FD%u5F97%u5230%u8FD1%u4F3C%u6B63%u6001%u7684%u5206%u5E03%uFF0C%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%5D%28./1496744051794.png%29%0A%u4E00%u822C%u7528%u5230%u7684%u65B9%u6CD5%u6709%uFF1A%0A%24x_%7Bnew%7D%20%3D%20log%28x+c%29%24%0A%24x_%7Bnew%7D%20%3D%20x%5E%7B%5Cfrac%20%7B1%7D%7Bn%7D%7D%24%0A%0AAndrew%u5728%u89C6%u9891%u4E2D%u7528Octave%u547D%u4EE4%u884C%u505A%u4E86live%20demo%uFF1A%0A%21%5BAlt%20text%5D%28./1496744359543.png%29%0A%u6211%u4EEC%u5F80%u5F80%u53EF%u4EE5%u901A%u8FC7hist%u547D%u4EE4%u6765%u753B%u56FE%u67E5%u770B%u4FEE%u6B63%u7684%u7279%u5F81%u91CF%u662F%u5426%u5C5E%u4E8E%u6B63%u6001%u5206%u5E03%u3002%0A%0A%u8BB2%u4E49%u4E2D%u63D0%u5230%u7684**Error%20Analysis**%u6307%u7684%u662F%uFF1A%0A%u6709%u4E00%u4E9B%u5F02%u5E38%u60C5%u51B5%u662F%uFF0C%u7279%u5F81%u5411%u91CF%u7684%u5404%u5206%u91CF%u90FD%u5728%u5927%u6982%u7387%u7684%u70B9%uFF0C%u4F46%u662F%u5F53%u67D0%u4E9B%u5206%u91CF%u7EC4%u5408%u65F6%uFF0C%u4F1A%u662F%u5C0F%u6982%u7387%u4E8B%u4EF6%uFF0C%u5219%u6B64%u65F6%u9700%u8981%u4EA7%u751F%u65B0%u7684%u7279%u5F81%u5411%u91CF%u3002%u4F8B%u5982%uFF1AAndrew%u7684%u4F8B%u5B50%uFF0C%u5F53CPU%20load%u76F8%u5BF9%u8F83%u5927%uFF0C%u4F46%u4ECD%u5728%u6B63%u5E38%u8303%u56F4%uFF0C%u4F46%u662Fnetwork%20traffic%u5374%u5F88%u5C0F%uFF0C%u4F46%u4ECD%u7136%u5728%u6B63%u5E38%u8303%u56F4%u3002%u8FD9%u65F6%u4F60%u5C31%u9700%u8981%u4E00%u4E2A%u53D8%u91CF%uFF0C%u6BD4%u5982%24x_5%20%3D%20%5Cfrac%20%7BCPU%5C%20load%7D%20%7Bnetwork%5C%20traffic%7D%24%u6216%u8005%24x_6%20%3D%20%5Cfrac%20%7B%28CPU%5C%20load%29%5E2%7D%7Bnetwork%5C%20traffic%7D%24%u53D6%u51B3%u4E8E%u65B0%u7684%u7279%u5F81%u91CF%u662F%u5426%u662F%u6B63%u6001%u5206%u5E03%u3002%0A%23%23%23Multivariate%20Gaussian%20distribution%0A%u524D%u9762%u7684Anomaly%20Detection%u57FA%u4E8E%u5404%u7279%u5F81%u5206%u91CF%u662F%u72EC%u7ACB%u5206%u5E03%u7684%u60C5%u51B5%uFF0C%u5982%u679C%u662F%u975E%u72EC%u7ACB%u5206%u5E03%u5C31%u91C7%u7528%u4E0A%u9762%u63D0%u5230%u7684**Error%20Analysis**%u7684%u65B9%u6CD5%u3002%u800CMultivariate%20Gaussian%u5219%u662F%u5BF9%u975E%u72EC%u7ACB%u5206%u5E03%u7684%u8865%u5145%uFF0C%u4E5F%u5C31%u662F%u8BF4%u4E0A%u9762%u7684Anomaly%20Detection%u5176%u5B9E%u662FMultivariate%20Gaussian%u7684%u4E00%u79CD%u7279%u6B8A%u60C5%u51B5%u3002%0A%0AAndrew%u7ED9%u51FA%u4E86%u77E2%u91CF%u5316%u7684Multivariate%20Gaussian%u7684%u6982%u7387%u5BC6%u5EA6%u516C%u5F0F%uFF1A%0A%24%24p%28x%3B%5Cmu%2C%20%5CSigma%29%20%3D%20%5Cdfrac%20%7B1%7D%7B%282%5Cpi%29%5E%7B%5Cfrac%20%7Bn%7D%7B2%7D%7D%5Cleft%20%7C%20%5CSigma%5Cright%7C%5E%7B%5Cfrac%7B1%7D%7B2%7D%7D%7Dexp%20%5Cleft%28-%5Cfrac%7B1%7D%7B2%7D%28x-%5Cmu%29%5ET%5CSigma%5E%7B-1%7D%28x-%5Cmu%29%5Cright%29%24%24%0A%24%5Cmu%20%3D%20%5Cfrac%20%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%20x%5E%7B%28i%29%7D%24%0A%24%5CSigma%20%3D%20%5Cfrac%20%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%20%28x%5E%7B%28i%29%7D-%5Cmu%29%28x%5E%7B%28i%29%7D-%5Cmu%29%5ET%24%0A%3E%20%0A%u5176%u4E2D%24%5CSigma%24%u79F0%u4E3ACovariance%20Matrix%uFF0C%u534F%u65B9%u5DEE%u77E9%u9635%uFF0C%24%7C%5CSigma%7C%24%u4E3A%24%5CSigma%24%u7684%u884C%u5217%u5F0F%28determinant%29%uFF0C%u53C2%u8003%uFF1A%0A-%20%5Bwiki%20-%20%u884C%u5217%u5F0F%5D%28https%3A//zh.wikipedia.org/wiki/%25E8%25A1%258C%25E5%2588%2597%25E5%25BC%258F%29%0A%u7B80%u5355%u6458%u53D6%u4E24%u5F20%u8BA1%u7B97%u77E9%u9635%u884C%u5217%u5F0F%u7684%u63D2%u56FE%uFF1A%0A%3E%21%5BAlt%20text%5D%28./1496745897356.png%29%0A%3E%0A%3E%21%5BAlt%20text%5D%28./1496745910661.png%29%0A%3EOctave%u91CC%u9762%u7528%u51FD%u6570%60det%28A%29%60%0A%0A%u5728%u4E0A%u9762%u7ED9%u51FA%u7684%u516C%u5F0F%u91CC%uFF0CCovariance%20Matrix%u5373%24%5CSigma%24%u5C31%u7ED9%u51FA%u4E86%u53D8%u91CF%u4E4B%u95F4%u7684%u76F8%u5173%u6027%u7684%u4FE1%u606F%u3002%0A%0AOriginal%20model%u548Cmultivariate%20model%u90FD%u53EF%u4EE5%u68C0%u6D4B%u5230%u4E0A%u9762%u4E3E%u7684CPU%20load%u548Cnetwork%20traffic%u7684%u4F8B%u5B50%u4E2D%u7684%u60C5%u51B5%u3002%u90A3%u8981%u5982%u4F55%u9009%u62E9%u5462%uFF1FAndrew%u7ED9%u51FA%u4E86%u5BF9%u6BD4%uFF1A%0A%21%5BAlt%20text%5D%28./1496746985199.png%29%0A%u53EF%u89C1%u867D%u7136%u770B%u8D77%u6765Multivariate%u6B63%u89C4%u4E00%u4E9B%uFF0C%u4F46%u662FOriginal%20model%u66F4%u5B9E%u7528%u4E00%u70B9%u3002%0A%23%23%23Anomaly%20detection%20vs.%20supervised%20learning%0A%21%5BAlt%20text%5D%28./1496580685327.png%29%0A%21%5BAlt%20text%5D%28./1496580714267.png%29%0A%0A%23%23Recommender%20Systems%0A%23%23%23Content-based%20recommender%20systems%0A%u8FD9%u4E2A%u95EE%u9898%uFF0C%u5176%u5B9E%u5C31%u662F%u5DF2%u77E5%u6BCF%u90E8%u7535%u5F71%u7684%u7279%u5F81%28%u7279%u5F81%u5411%u91CF%29%uFF0C%u4EE5%u53CA%u7528%u6237%u5BF9%u7535%u5F71%u7684%u8BC4%u5206%uFF0C%u6765%u63A8%u6D4B%u7528%u6237%u5BF9%u6CA1%u770B%u8FC7%u7684%u7535%u5F71%u7684%u8BC4%u5206%u3002%u770B%u4E0B%u9762%u7684%u8868%u683C%uFF1A%0A%21%5BAlt%20text%5D%28./1497231459572.png%29%0A%u65B9%u6CD5%u5C31%u662F%u7EBF%u6027%u56DE%u5F52%uFF0C%u6C42%u4E0B%u9762cost%20function%u7684%u6700%u5C0F%u503C%uFF1A%0A%24%24min_%7B%5Ctheta%5E%7B%281%29%7D%2C%20%5Ctheta%5E%7B%282%29%7D%2C...%2C%20%5Ctheta%5E%7B%28n_u%29%7D%7D%5Cfrac%7B1%7D%7B2%7D%5Csum_%7Bj%3D1%7D%5E%7Bn_u%7D%5Csum_%7Bi%3Ar%28i%2Cj%29%3D1%7D%5Cleft%20%28%28%5Ctheta%5E%7B%28j%29%7D%29%5ETx%5E%7B%28i%29%7D%20-%20y%5E%7B%28i%2Cj%29%7D%5Cright%29%5E2%20+%20%5Cfrac%7B%5Clambda%7D%7B2%7D%5Csum_%7Bj%3D1%7D%5E%7Bn_u%7D%5Csum_%7Bk%3D1%7D%5En%5Cleft%28%5Ctheta_k%5E%7B%28j%29%7D%5Cright%29%5E2%24%24%0A%u5176%u4E2D%uFF1A%0A-%20%24n_u%24%3A%20%u7528%u6237%u6570%0A-%20%24n%24%3A%20%u7535%u5F71%u6570%0A-%20%24i%3Ar%28i%2Cj%29%20%3D%201%24%3A%20%u7528%u6237j%u7ED9%u7535%u5F71i%u8BC4%u5206%u4E86%0A-%20%24y%5E%7B%28i%2Cj%29%7D%24%3A%20%u7528%u6237%u7684%u771F%u5B9E%u8BC4%u5206%0A-%20%24%28%5Ctheta%5E%7B%28j%29%7D%29%5ETx%5E%7B%28i%29%7D%24%3A%20hypothesis%uFF0C%u63A8%u6D4B%u8BC4%u5206%0A%0A**Gradient%20Descent**%3A%0Afor%20k%20%3D%200%3A%0A%24%5Ctheta_k%5E%7B%28j%29%7D%20%3A%3D%20%5Ctheta_k%5E%7B%28j%29%7D%20-%20%5Calpha%5Csum_%7Bi%3Ar%28i%2Cj%29%3D1%7D%5Cleft%28%28%5Ctheta%5E%7B%28j%29%7D%29%5ETx%5E%7B%28i%29%7D-y%5E%7B%28i%2Cj%29%7D%5Cright%29x_k%5E%7B%28i%29%7D%24%20%0Afor%20k%24%5Cneq%24%200%3A%0A%24%5Ctheta_k%5E%7B%28j%29%7D%20%3A%3D%20%5Ctheta_k%5E%7B%28j%29%7D%20-%20%5Calpha%5Cleft%28%5Csum_%7Bi%3Ar%28i%2Cj%29%3D1%7D%5Cleft%28%28%5Ctheta%5E%7B%28j%29%7D%29%5ETx%5E%7B%28i%29%7D-y%5E%7B%28i%2Cj%29%7D%5Cright%29x_k%5E%7B%28i%29%7D%20+%20%5Clambda%5Ctheta_k%5E%7B%28j%29%7D%5Cright%29%24%20%0A%0A%23%23%23Collaborative%20filtering%0A%u5047%u8BBE%u5728%u524D%u9762%u4E00%u8282%u7684training%u4E2D%uFF0C%24%5Ctheta_k%5E%7B%28j%29%7D%24%u662F%u5DF2%u77E5%u7684%uFF0C%u800C%24x%5E%7B%28i%29%7D%24%u672A%u77E5%uFF0C%u5373%u6BCF%u90E8%u7535%u5F71%u9488%u5BF9%u5404%u4E2A%u7279%u5F81%u91CF%u7684%u8BC4%u5206%u672A%u77E5%uFF0C%u6B64%u65F6%u901A%u8FC7training%u4E00%u6837%u53EF%u4EE5%u63A8%u6D4B%u51FA%u5404%u7535%u5F71%u7684%u8BC4%u7EA7%u3002%u800CCollabrative%20Filtering%u5C31%u662F%u5728%u4E24%u624B%u7A7A%u7A7A%u7684%u65F6%u5019%uFF0C%u65E2%u6CA1%u6709%24%5Ctheta%24%uFF0C%u4E5F%u6CA1%u6709%24x%24%uFF0C%u800C%u53EA%u6709%24y%5E%7B%28i%2Cj%29%7D%24%uFF0C%u5C31%u80FD%u9884%u6D4B%24%5Ctheta%24%u548C%24x%24%u3002%0A%0A1.%20Initialize%20%24x%5E%7B%281%29%7D%2C%20x%5E%7B%281%29%7D%2C%20...%2C%20x%5E%7B%28n_m%29%7D%2C%20%5Ctheta%5E%7B%281%29%7D%20%2C%20%5Ctheta%5E%7B%282%29%7D%2C...%2C%5Ctheta%5E%7B%28n_u%29%7D%24%20to%20small%20random%20values.%0A2.%20Minimize%20%24J%28x%5E%7B%281%29%7D%2C%20x%5E%7B%281%29%7D%2C%20...%2C%20x%5E%7B%28n_m%29%7D%2C%20%5Ctheta%5E%7B%281%29%7D%20%2C%20%5Ctheta%5E%7B%282%29%7D%2C...%2C%5Ctheta%5E%7B%28n_u%29%7D%29%24using%20gradient%20descent%20%28or%20an%20advanced%20optimization%20algorithm%29.%0A%24J%20%3D%20%5Cfrac%7B1%7D%7B2%7D%5Csum_%7B%28i%2Cj%29%3Ar%28i%2Cj%29%3D1%7D%5Cleft%28%28%5Ctheta%5E%7B%28j%29%7D%29%5ETx%5E%7B%28i%29%7D%20-%20y%5E%7B%28i%2Cj%29%7D%5Cright%29%5E2%20+%20%5Cfrac%7B%5Clambda%7D%7B2%7D%5Csum_%7Bi%3D1%7D%5E%7Bn_m%7D%5Csum_%7Bk%3D1%7D%5En%5Cleft%28x_k%5E%7B%28i%29%7D%5Cright%29%5E2+%5Cfrac%7B%5Clambda%7D%7B2%7D%5Csum_%7Bi%3D1%7D%5E%7Bn_m%7D%5Csum_%7Bk%3D1%7D%5En%5Cleft%28%5Ctheta_k%5E%7B%28i%29%7D%5Cright%29%5E2%24%0A%21%5BAlt%20text%5D%28./1497233522468.png%29%0A3.%20For%20a%20user%20with%20parameters%20%24%5Ctheta%24%20and%20a%20movie%20with%20%28learned%29%20features%20%24x%24%2C%20predict%20a%20star%20rating%20of%20%24%5Ctheta%5ETx%24%0A%3E%u56E0%u4E3A%u5B58%u5728%u672A%u7ED9%u4EFB%u4F55%u7535%u5F71%u8BC4%u5206%u7684%u7528%u6237%uFF0C%u5982%u679C%u4E0D%u505A%u7279%u6B8A%u5904%u7406%uFF0C%u5219%u8FD9%u4E9B%u7528%u6237%u5BF9%u6240%u6709%u7535%u5F71%u7684%u9884%u6D4B%u8BC4%u4EF7%u90FD%u4F1A%u662F0%u5206%uFF0C%u5177%u4F53Andrew%u5728%u89C6%u9891%u4E2D%u7ED9%u51FA%u8BBA%u8BC1%u3002%u6240%u4EE5%u9700%u8981mean%20normalization%uFF0C%u5177%u4F53%u505A%u6CD5%u662F%uFF1A%0A%3E-%20%24%5Cmu%20%3D%20%5Cfrac%20%7B1%7D%7Bm%7D%20%5Csum_1%5Em%20y%5E%7Bi%7D%24%0A%3E-%20%24Y%20%3D%20Y%20-%20%5Cmu%24%0A%3E-%20%u4E0D%u7528%u6807%u51C6%u5DEE%u9664%uFF0C%u56E0%u4E3A%u8BC4%u5206%u672C%u6765%u5C31%u5728%u8FD1%u4F3C%u7684range%0A%0A1%0A%0A%0ACollaborative%20filtering%u77E2%u91CF%u5199%u6CD5%u662F%uFF1A%0A%24%24h_%7B%5CTheta%7D%20%3D%20X%5CTheta%5ET%24%24%0A%u800CCollaborative%20filtering%20algorithm%u53C8%u53EBLow%20rank%20matrix%20factorization%u3002%u5176%u4E2D%uFF0C%24X%5CTheta%5ET%24%u5C31%u662FLow%20rank%20matrix%u3002%0A%0A%3E%u5F53%u8981%u7ED9%u7528%u6237%u63A8%u8350%u7684%u65F6%u5019%uFF0C%24%7C%7Cx_j%20-%20x_i%7C%7C%24%u8DB3%u591F%u5C0F%u7684%u65F6%u5019%uFF0C%u5C31%u53EF%u4EE5%u8BA4%u4E3Ai%u548Cj%u8DB3%u591F%u76F8%u4F3C%u3002%0A%0A%0A%0A%0A%0A%0A%0A%09%09%0A]]></content>
      <tags>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Machine Learning (3) - Support Vector Machine (SVM)]]></title>
    <url>%2F2017%2F05%2F15%2FMachine_Learning_(3)_-_Support_Vector_Machine_(SVM)%2F</url>
    <content type="text"><![CDATA[Edit SVM&#x4E2D;&#x6587;&#x8BD1;&#x540D;&#xFF1A;&#x652F;&#x6301;&#x5411;&#x91CF;&#x673A;&#x7279;&#x70B9;&#x662F;large margin&#xFF0C;&#x76F8;&#x5BF9;logistic regression&#x53EF;&#x4EE5;&#x5BB9;&#x6613;&#x5F97;&#x5230;&#x5168;&#x5C40;&#x6700;&#x4F18;&#x89E3;&#x3002;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x57FA;&#x4E8E;land marks&#xFF0C;&#x5982;&#x4E0B;HypothesisLogistic Regression&#x7684;Hypothesis&#x4E3A; &#x5BF9;&#x4EE5;&#x4E0A;&#x516C;&#x5F0F;&#x7684;&#x4E24;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x62DF;&#x5408;&#xFF0C;&#x53C2;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;SVM Decision Boundary KernelGaussian Kernel StepsGivenChoose x-&gt;fPredict&#x2019;&#x201C;y=1&#x201D;&#x2019;if Note: Do perform feature scaling before using the Gaussian kernel.Multiclass classification: Use one vs. all method. (Train K SVMs, one to distinguish y= i from the rest, for i = 1, 2,&#x2026;,K), get &#x5BF9;&#x4E8E;&#x65B0;&#x7684;&#x8F93;&#x5165;x&#xFF0C;&#x9009;&#x53D6;&#x4F7F;&#x6700;&#x5927;&#x7684;i&#x3002;ParametersC = - Large C: small Lower&#x2019;bias,&#x2019;high&#x2019;variance. - Small C: big Higher&#x2019;bias,&#x2019;low&#x2019;variance.Large : Features vary more smoothly. Higher bias, lower variance.Small : Features vary less smoothly. Lower bias, higher variance.Andrew&#x63D0;&#x5230;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x5176;&#x4ED6;&#x7684;Kernel&#xFF0C;&#x4F46;&#x662F;&#x7528;&#x5904;&#x4E0D;&#x662F;&#x5F88;&#x591A;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;Polynomial kernelString&#x2019;kernelchiIsquare&#x2019;kernelhistogram intersection kernel,Logistic regression vs. SVMsn = number of features (), m = number of training examplesIf n is large (relative to m): Use logistic regression, or SVM without a kernel (&#x201C;linear kernel&#x201D;).If n is small, m is intermediate: Use SVM with Gaussian kernel.If n is small, m is large: Create/add more features, then use logistic regression or SVM without a kernel.Neural network likely to work well for most of these settings, but may be slower to train.Recommendation for SVM implemetationLIBSVM%23Machine%20Learning%20%283%29%20-%20Support%20Vector%20Machine%20%28SVM%29%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5B%u6DF1%u5EA6%u5B66%u4E60%5D%0ASVM%u4E2D%u6587%u8BD1%u540D%uFF1A%u652F%u6301%u5411%u91CF%u673A%0A%0A%u7279%u70B9%u662Flarge%20margin%uFF0C%u76F8%u5BF9logistic%20regression%u53EF%u4EE5%u5BB9%u6613%u5F97%u5230%u5168%u5C40%u6700%u4F18%u89E3%u3002%0A%0A%23%23%u5DE5%u4F5C%u539F%u7406%0A%u57FA%u4E8Eland%20marks%uFF0C%u5982%u4E0B%0A%21%5BAlt%20text%7C600x0%5D%28./1494841637067.png%29%0A%u5F53%u8BAD%u7EC3%u51FA%24%5Ctheta%24%u503C%u5982%u4E0A%u6240%u793A%uFF0C%u5F53X%u53D6%u503C%u5728%24l%5E%7B%281%29%7D%24%2C%20%24l%5E%7B%282%29%7D%24%u9644%u8FD1%u65F6%uFF0Cy%u9884%u6D4B%u4E3A1%uFF0C%u5F53%u5728%24l%5E%7B%283%29%7D%24%u9644%u8FD1%u65F6%u4E3A0%u3002%u600E%u4E48%u505A%u5230%u7684%u5462%uFF1F%0A%23%23%23Hypothesis%0ALogistic%20Regression%u7684Hypothesis%u4E3A%0A%24h_%7B%5Ctheta%7D%28x%29%20%3D%20%20-y%20%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-%5Ctheta%5ETx%7D%7D%20-%20%281-y%29%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-%5Ctheta%5ETx%7D%7D%24%0A%0A%u5BF9%u4EE5%u4E0A%u516C%u5F0F%u7684%u4E24%u90E8%u5206%u8FDB%u884C%u62DF%u5408%uFF0C%u53C2%u770B%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%7C600x0%5D%28./1494842281122.png%29%0A%u6709%u7528%u7684%u90E8%u5206%u5C31%u662Fz%u8F74%u4E0A%u90A3%u4E00%u7AEF%uFF0C%u659C%u7EBF%u90E8%u5206%u659C%u7387%u65E0%u5173%u7D27%u8981%0A%0ASVM%20Decision%20Boundary%0A%24min_%5Ctheta%20C%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%5By%5E%7B%28i%29%7Dcost_1%28%5Ctheta%5ETx%5E%7B%28i%29%7D%29%20+%20%281-y%5E%7B%28i%29%7D%29cost_0%28%5Ctheta%5ETx%5E%7B%28i%29%7D%29%5D%20+%20%5Cdfrac%7B1%7D%7B2%7D%5Csum_%7Bi%3D1%7D%5E%7Bn%7D%5Ctheta_j%5E2%24%0A%24C%3D%5Cdfrac%7B1%7D%7B%5Clambda%7D%24%0A%0A%23%23%23Kernel%0AGaussian%20Kernel%0A%24f_i%20%3D%20similarity%28x%2C%20l%5E%7B%28i%29%7D%29%20%3D%20exp%28-%5Cdfrac%20%7B%7C%7Cx-l%5E%7B%28i%29%7D%7C%7C%5E2%7D%7B2%5Csigma%5E2%7D%29%24%0A%0A%23%23%23Steps%0A1.%20Given%24%20%28x%5E%7B%281%29%7D%2C%20y%5E%7B%281%29%7D%29%2C%20%28x%5E%7B%282%29%7D%2C%20y%5E%7B%282%29%7D%29%2C...%2C%28x%5E%7B%28m%29%7D%2C%20y%5E%7B%28m%29%7D%29%24%0A2.%20Choose%20%24l%5E%7B%281%29%7D%20%3D%20x%5E%7B%281%29%7D%2C%20l%5E%7B%282%29%7D%20%3D%20x%5E%7B%282%29%7D%2C%20...%2Cl%5E%7B%28m%29%7D%20%3D%20x%5E%7B%28m%29%7D%24%0A3.%20x-%3Ef%0A4.%20Predict%27%u201Cy%3D1%u201D%27if%20%24%5Ctheta%5ETf%20%5Cgeq%200%24%0A%0A**Note**%3A%20Do%20perform%20feature%20scaling%20before%20using%20the%20Gaussian%20kernel.%0A%0AMulticlass%20classification%3A%0AUse%20one%20vs.%20all%20method.%20%28Train%20K%20SVMs%2C%20one%20to%20distinguish%20y%3D%20i%20from%20the%20rest%2C%20for%20i%20%3D%201%2C%202%2C...%2CK%29%2C%20get%20%24%5Ctheta%5E%7B%281%29%7D%2C%20%5Ctheta%5E%7B%282%29%7D%2C...%2C%5Ctheta%5E%7B%28K%29%7D%24%0A%u5BF9%u4E8E%u65B0%u7684%u8F93%u5165x%uFF0C%u9009%u53D6%u4F7F%24%28%5Ctheta%5E%7B%28i%29%7D%29%5ETx%24%u6700%u5927%u7684i%u3002%0A%0A%23%23%23Parameters%0AC%20%3D%20%24%5Cdfrac%20%7B1%7D%7B%5Clambda%7D%24%09%0A%09-%20Large%20C%3A%20small%20%24%5Clambda%24%20Lower%27bias%2C%27high%27variance.%0A%09-%20Small%20C%3A%20big%20%24%5Clambda%24%20Higher%27bias%2C%27low%27variance.%0A%0A%24%5Csigma%5E2%24%0A-%20Large%20%24%5Csigma%5E2%24%3A%20Features%20%24f_i%24%20vary%20more%20smoothly.%20Higher%20bias%2C%20lower%20variance.%0A%20%21%5BAlt%20text%5D%28./1494987748588.png%29%0A-%20Small%20%24%5Csigma%5E2%24%3A%20Features%20%24f_i%24%20vary%20less%20smoothly.%20Lower%20bias%2C%20higher%20variance.%0A%21%5BAlt%20text%5D%28./1494987812098.png%29%0A%0AAndrew%u63D0%u5230%u8FD8%u6709%u5F88%u591A%u5176%u4ED6%u7684Kernel%uFF0C%u4F46%u662F%u7528%u5904%u4E0D%u662F%u5F88%u591A%uFF0C%u5305%u62EC%uFF1A%0A-%20Polynomial%20kernel%0A-%20String%27kernel%0A-%20chiIsquare%27kernel%0A-%20histogram%20intersection%20kernel%2C%0A%0A%23%23Logistic%20regression%20vs.%20SVMs%0An%20%3D%20number%20of%20features%20%28%24x%20%5Cin%20R%5E%7Bn+1%7D%24%29%2C%20m%20%3D%20number%20of%20training%20examples%0A-%20If%20n%20is%20large%20%28relative%20to%20m%29%3A%20Use%20logistic%20regression%2C%20or%20SVM%20without%20a%20kernel%20%28%u201Clinear%20kernel%u201D%29.%0A-%20If%20n%20is%20small%2C%20m%20is%20intermediate%3A%20Use%20SVM%20with%20Gaussian%20kernel.%0A-%20If%20n%20is%20small%2C%20m%20is%20large%3A%20Create/add%20more%20features%2C%20then%20use%20logistic%20regression%20or%20SVM%20without%20a%20kernel.%0A-%20Neural%20network%20likely%20to%20work%20well%20for%20most%20of%20these%20settings%2C%20but%20may%20be%20slower%20to%20train.%0A%0A%23%23%20Recommendation%20for%20SVM%20implemetation%0A%5BLIBSVM%5D%28https%3A//www.csie.ntu.edu.tw/%7Ecjlin/libsvm/%29%0A%0A%0A%0A]]></content>
      <tags>
        <tag>deep learning</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Machine Learning (2) - Neural Network]]></title>
    <url>%2F2017%2F04%2F03%2FMachine_Learning_(2)_-_Neural_Network%2F</url>
    <content type="text"><![CDATA[EditModel: activation of unit i in layer j : matrix of weights controlling function mapping from layer j to layer j+1&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4E09;&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x6BCF;&#x4E00;&#x5C42;&#x90FD;&#x662F;&#x9075;&#x5FAA;Logistic Regression&#x7684;sigmoid function&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x975E;&#x7EBF;&#x6027;&#x7684;&#x3002; The sigmoid function is &#x901A;&#x8FC7;hypothesis function &#x5C31;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;cost function&#x3002;&#x516C;&#x5F0F;&#x5728;Machine Learning (1) - Linear &amp; Logistic Regression &#x6458;&#x53D6;&#x516C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A; Note&#xFF1A;&#x7684;&#x5C3A;&#x5BF8;&#x4E3A;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x4E0A;&#x4E00;&#x5C42;&#x548C;&#x8FD9;&#x4E00;&#x5C42;&#x7684;node&#x6570;&#x91CF;&#x3002;&#x5176;&#x4E2D;&#x7684;+1&#xFF0C;&#x662F;bias&#x8282;&#x70B9;&#xFF0C;&#x5373;&#x5E38;&#x91CF;(+1)&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x4E0D;&#x7B97;&#x5728;&#x8282;&#x70B9;&#x6570;&#x4E2D;&#x77E9;&#x9635;&#x7684;&#x6570;&#x91CF;&#x53D6;&#x51B3;&#x4E8E;&#x7F51;&#x7EDC;&#x5C42;&#x6570;&#xFF0C;&#x5373;3&#x5C42;&#x7F51;&#x7EDC;&#xFF0C;&#x53EA;&#x6709;2&#x4E2A;&#x77E9;&#x9635;Cost Function&#x63A5;&#x7740;&#x4E0A;&#x4E00;&#x7AE0;&#x7684;&#x516C;&#x5F0F;&#xFF0C;&#x7ED9;&#x51FA;&#x5B8C;&#x6574;&#x7684;&#x591A;&#x72B6;&#x6001;&#x5206;&#x7C7B;&#x5E76;&#x4E14;&#x6B63;&#x89C4;&#x5316;&#x7684;cost function&#x5982;&#x4E0B;&#xFF1A; &#x7A0D;&#x4F5C;&#x89E3;&#x91CA;&#xFF1A;&#x516C;&#x5F0F;&#x7684;&#x524D;&#x534A;&#x90E8;&#x5206;&#x662F;&#x539F;&#x7248;&#x7684;hypothesis&#xFF0C;&#x5E76;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x5206;&#x7C7B;&#x8FDB;&#x884C;&#x7D2F;&#x52A0;&#x540E;&#x534A;&#x90E8;&#x5206;&#x662F;&#x6B63;&#x89C4;&#x5316;&#x53C2;&#x6570;&#xFF0C;&#x662F;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x5E73;&#x65B9;&#x7D2F;&#x52A0;&#x3002;&#x4E00;&#x5171;&#x6709;L-1&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;&#x6BCF;&#x4E00;&#x5C42;&#x6709;&#x4E2A;&#x6CE8; &#x6CE8;&#x610F;Regularized&#x9879;&#xFF0C;&#x53EA;&#x7D2F;&#x52A0;&#x9879;&#xFF0C;&#x4E0D;&#x5305;&#x542B;bias&#x9879;Backpropagation Algorithm&#x6709;&#x4E86;cost function&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;Gradient descent&#x4E86;&#xFF0C;&#x57FA;&#x672C;&#x516C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A; &#x4F46;&#x662F;&#x73B0;&#x5728;&#x5F15;&#x5165;&#x4E86;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;&#x6C42;&#x504F;&#x5BFC;&#x6570;&#x5C31;&#x6CA1;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5F15;&#x5165;&#x4E86;Forwardpropagation &amp; Backpropagation&#x3002;&#x610F;&#x5373;&#xFF0C;&#x5411;&#x524D;&#x7B97;&#x4E00;&#x904D;&#xFF0C;&#x518D;&#x5411;&#x56DE;&#x7B97;&#x4E00;&#x904D;&#xFF0C;&#x7EFC;&#x5408;&#x4E24;&#x65B9;&#x9762;&#x7684;&#x6570;&#x636E;&#x5C31;&#x80FD;&#x5F97;&#x51FA;cost function&#x7684;&#x504F;&#x5BFC;&#x6570;&#x3002;&#x8BC1;&#x660E;&#x4E0D;&#x4F1A;&#xFF0C;&#x4F46;&#x662F;Andrew&#x7ED9;&#x51FA;&#x4E86;&#x516C;&#x5F0F;&#x3002; &#x6574;&#x4E2A;&#x7B97;&#x6CD5;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x540C;&#x4E8E;&#x6559;&#x6750;&#x4E2D;&#x7684;4&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;&#x800C;&#x662F;&#x91C7;&#x7528;&#x672C;&#x7BC7;&#x7B14;&#x8BB0;&#x4E2D;&#x7684;&#x4E09;&#x5C42;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF1A;Given training set Set for all (l,i,j)&#x3002; size() = &#xFF0C;&#x4E0E;&#x540C; For i =1 to m &#xA0;&#xA0; 1. Set , both a and x are vectors &#xA0;&#xA0; 2. Perform forward propagation to compute for l=2,3,&#x2026;,L. L=&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5C42;&#x6570; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#x2014;&#x2014;&#x6CE8;&#x610F;&#x52A0;&#x5165;bias&#x9879; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#x2014;&#x2014;&#x6CE8;&#x610F;&#x52A0;&#x5165;bias&#x9879; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 3. Using , compute . y&#x662F;&#x5BF9;&#x8F93;&#x51FA;&#x7684;&#x91CF;&#x6D4B;&#xFF0C;&#x662F;&#x5BF9;&#x8F93;&#x51FA;&#x7684;&#x6A21;&#x578B;&#x4F30;&#x8BA1;&#xFF0C;&#x7B97;&#x662F;&#x6A21;&#x578B;&#x504F;&#x5DEE;&#x3002; &#xA0;&#xA0; 4. Using backpropagation to compute &#xFF0C;&#x8F93;&#x5165;&#x5C42;&#x6CA1;&#x6709;&#xFF0C;&#x5373; &#xA0;&#xA0;&#xA0;&#xA0; &#x2014;&#x2014;&#x6B64;&#x5904;&#x5E94;&#x5F53;&#x6709;&#x8BEF;&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x8003;&#x76F8;&#x5173;&#x7B14;&#x8BB0;&#x6CE8;: &#x9488;&#x5BF9;&#x7684;&#x8BA1;&#x7B97;&#x8981;&#x7279;&#x522B;&#x6CE8;&#x610F;&#x3002;&#x4E0B;&#x9762;&#x4E13;&#x95E8;&#x653E;&#x4E00;&#x8282;&#x89E3;&#x91CA;&#x8BA1;&#x7B97;&#xA0;&#xA0; 5. Compute &#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;Vectorized equation: &#xFF0C;&#x5176;&#x4E2D;j&#x662F;&#x6BCF;&#x4E00;&#x5C42;&#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x7F16;&#x53F7; &#x6CE8;: &#x6B64;&#x5904;&#x7D2F;&#x52A0;&#x6307;&#x7684;&#x662F;&#x9488;&#x5BF9;training samples&#xA0;&#xA0; 6. Final step, compute the partial derivative of &#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0; &#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x7565;&#x663E;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x5C31;&#x662F;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x636E;&#x8BF4;&#x540E;&#x9762;&#x6709;&#x66F4;&#x4F18;&#x96C5;&#x7684;&#x7B97;&#x6CD5;&#x3002;&#x8BA1;&#x7B97;: an error item that measures how much the node was responsible for any errors in our output. &#x6700;&#x7EC8;&#x8BA1;&#x7B97;&#x5F0F;&#x5E94;&#x4E3A;&#xFF1A; g=sigmoid function.&#x7B97;&#x6CD5;&#x8C03;&#x4F18;&#x7B97;&#x6CD5;&#x504F;&#x5DEE;&#x8FC7;&#x5927;&#x6709;&#x4E24;&#x7C7B;&#x95EE;&#x9898;&#xFF1A;Overfitting (&#x8FC7;&#x62DF;&#x5408; / High Variance)Underfitting (&#x6B20;&#x62DF;&#x5408; / High Bias) &#x9488;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x7684;&#x662F;&#xFF1A; &#x8BC6;&#x522B;&#x4ED6;&#x4EEC;&#x91C7;&#x53D6;&#x76F8;&#x5E94;&#x63AA;&#x65BD;&#x5982;&#x4F55;&#x4EA7;&#x751F;&#x6B63;&#x786E;&#x7684;&#x6A21;&#x578B;&#x9996;&#x5148;&#x5C06;training samples&#x5206;&#x6210;&#x4E09;&#x90E8;&#x5206;&#xFF1A;Training set: 60%Cross validation set: 20%Test set: 20% &#x7528;training set&#x6765;&#x6311;&#x9009;&#xFF0C;&#x7528;Cross validation set&#x6765;&#x9009;&#x62E9;&#x591A;&#x9879;&#x5F0F;&#x5E42;&#x6B21;&#xFF0C;&#x6700;&#x540E;&#x7528;test set error &#x6765;&#x8BC4;&#x4F30;&#x7B97;&#x6CD5;&#x7684;&#x4F18;&#x52A3;&#x3002;Polynomial Degree - d&#x53C2;&#x8003;&#x5982;&#x4E0B;&#x56FE;&#x50CF;&#xFF0C;&#x5BF9;&#x4E8E;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x5F53;&#x591A;&#x9879;&#x5F0F;&#x5E42;&#x6B21;&#x5F88;&#x4F4E;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4EA7;&#x751F;Underfitting&#xFF0C;&#x6B64;&#x65F6;&#x548C;&#x90FD;&#x5F88;&#x5927; &#x5F53;&#x591A;&#x9879;&#x5F0F;&#x5E42;&#x6B21;&#x5F88;&#x5927;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4EA7;&#x751F;Overfitting&#xFF0C;&#x6B64;&#x65F6;&#x8FDC;&#x5927;&#x4E8E;&#xFF0C;&#x8FD9;&#x5BF9;&#x6311;&#x9009;d&#x6709;&#x5F88;&#x597D;&#x7684;&#x53C2;&#x8003;&#x610F;&#x4E49;Regularization - Create a list of lambdas (i.e. &#x3BB;&#x2208;{0,0.01,0.02,0.04,&#x2026;10.24});&#x8BA1;&#x7B97;&#x4E0D;&#x5305;&#x542B;&#x7684;train error&#x548C;cross validation error&#x753B;&#x51FA;&#x4E0B;&#x56FE;&#x548C;&#x9009;&#x62E9;d&#x7C7B;&#x4F3C;&#xFF0C;&#x9009;&#x53D6;&#x5408;&#x9002;&#x7684;Random initialization&#x5BF9;&#x7684;&#x521D;&#x59CB;&#x503C;&#x8FDB;&#x884C;&#x968F;&#x673A;&#x5316;&#x3002;&#x5728;ex4&#x7684;&#x7EC3;&#x4E60;&#x4E2D;&#xFF0C;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E0B;&#x516C;&#x5F0F;&#x5BF9;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF1A; &#x8BC6;&#x522B;Overfitting(High Variance)/Underfitting(High Bias)&#x8981;&#x8BC6;&#x522B;&#xFF0C;&#x5C31;&#x8981;&#x901A;&#x8FC7;Learning CurvesHigh Bias:High Variance:What to try next?Getting more training examples: Fixes high varianceTrying smaller sets of features: Fixes high varianceAdding features: Fixes high biasAdding polynomial features: Fixes high biasDecreasing &#x3BB;: Fixes high biasIncreasing &#x3BB;: Fixes high variance.&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#xFF1A; &#x5982;&#x679C;&#x60F3;&#x5F97;&#x5230;&#x597D;&#x7B97;&#x6CD5;&#xFF0C;&#x505A;&#x5230;&#x4E24;&#x65B9;&#x9762;&#x5373;&#x53EF;&#xFF1A;&#x5F15;&#x5165;&#x5F88;&#x591A;&#x53D8;&#x91CF;&#xFF0C;&#x53C2;&#x6570; =&gt; high variance, low bias&#x63D0;&#x4F9B;&#x5927;&#x91CF;training samples =&gt; low varianceError AnalysisStart with a simple algorithm, implement it quickly, and test it early on your cross validation data.Plot learning curves to decide if more data, more features, etc. are likely to help.Manually examine the errors on examples in the cross validation set and try to spot a trend where most of the errors were made.&#x7279;&#x4F8B;skewed data&#x5F53;&#x5904;&#x7406;&#x5206;&#x7C7B;&#x5668;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x5206;&#x7C7B;&#x5360;&#x7EDD;&#x5BF9;&#x591A;&#x6570;&#xFF0C;&#x4F8B;&#x5982;99%&#x3002;&#x90A3;&#x53EF;&#x80FD;&#x6211;&#x4EEC;&#x5BF9;&#x9884;&#x6D4B;&#x6709;&#x504F;&#x5411;&#xFF0C;&#x6BD4;&#x5982;&#x8981;&#x9884;&#x6D4B;&#x764C;&#x75C7;&#xFF0C;&#x5B81;&#x53EF;&#x8BEF;&#x8BCA;&#xFF0C;&#x4E0D;&#x53EF;&#x6F0F;&#x8BCA;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8981;&#x9AD8;Recall&#x3002; &#x547D;&#x4E2D;&#x7387;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53D6;&#x4E0D;&#x540C;&#x7684;threshold&#xFF0C;&#x6765;&#x505A;&#x51FA;&#x4E0B;&#x9762;&#x8FD9;&#x5F20;&#x56FE;&#xFF0C;&#x6839;&#x636E;Recall&#x548C;Precision&#x7684;&#x504F;&#x597D;&#x6765;&#x9009;&#x62E9;&#x9700;&#x8981;&#x7684;threshold&#x3002;&#x5982;&#x4F55;&#x8BC4;&#x4EF7;&#x7B97;&#x6CD5;&#x4F18;&#x52A3;&#xFF1A; -Score (F Score) = %23Machine%20Learning%20%282%29%20-%20Neural%20Network%0A%0A@%28myblog%29%5B%u6DF1%u5EA6%u5B66%u4E60%2C%20deep%20learning%5D%0A%0A%23%23Model%0A%21%5BAlt%20text%5D%28./1491893421634.png%29%0A%0A%24a_i%5E%7B%28j%29%7D%24%3A%20**activation**%20of%20unit%20i%20in%20layer%20j%0A%24%5CTheta%5E%7B%28j%29%7D%24%3A%20matrix%20of%20**weights**%20controlling%20function%20mapping%20from%20layer%20***j***%20to%20layer%20***j+1***%0A%0A%u8FD9%u662F%u4E00%u4E2A%u4E09%u5C42%u795E%u7ECF%u7F51%u7EDC%u3002%u6BCF%u4E00%u5C42%u90FD%u662F%u9075%u5FAALogistic%20Regression%u7684sigmoid%20function%uFF0C%u6240%u4EE5%u662F%u975E%u7EBF%u6027%u7684%u3002%20%0A%24a_1%5E%7B%282%29%7D%20%3D%20g%28%5CTheta_%7B10%7D%5E%7B%281%29%7D%20+%20%5CTheta_%7B11%7D%5E%7B%281%29%7Dx_1%20+%20%5CTheta_%7B12%7D%5E%7B%281%29%7Dx_2%20+%20%5CTheta_%7B13%7D%5E%7B%281%29%7Dx_3%29%20%24%0A%24a_2%5E%7B%282%29%7D%20%3D%20g%28%5CTheta_%7B20%7D%5E%7B%281%29%7D%20+%20%5CTheta_%7B21%7D%5E%7B%281%29%7Dx_1%20+%20%5CTheta_%7B22%7D%5E%7B%281%29%7Dx_2%20+%20%5CTheta_%7B13%7D%5E%7B%281%29%7Dx_3%29%20%24%0A%24a_3%5E%7B%282%29%7D%20%3D%20g%28%5CTheta_%7B30%7D%5E%7B%281%29%7D%20+%20%5CTheta_%7B31%7D%5E%7B%281%29%7Dx_1%20+%20%5CTheta_%7B32%7D%5E%7B%281%29%7Dx_2%20+%20%5CTheta_%7B13%7D%5E%7B%281%29%7Dx_3%29%20%24%0A%0AThe%20sigmoid%20function%20is%20%24g%28z%29%20%3D%20%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-z%7D%7D%24%0A%0A%24%24h_%5CTheta%28x%29%20%3D%20a_1%5E%7B%283%29%7D%20%3D%20g%28%5CTheta_%7B10%7D%5E%7B%282%29%7Da_0%5E%7B%282%29%7D%20+%20%5CTheta_%7B11%7D%5E%7B%282%29%7Da_1%5E%7B2%7D%20+%20%5CTheta_%7B12%7D%5E%7B%282%29%7Da_2%5E%7B%282%29%7D%20+%20%5CTheta_%7B13%7D%5E%7B%282%29%7Da_3%5E%7B%282%29%7D%20%29%24%24%0A%0A%u901A%u8FC7hypothesis%20function%20%24h_%5Ctheta%28x%29%24%u5C31%u53EF%u4EE5%u8BA1%u7B97cost%20function%u3002%u516C%u5F0F%u5728%5BMachine%20Learning%20%281%29%20-%20Linear%20%26%20Logistic%20Regression%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/b780cf32-b71b-44f8-929a-f91664ca0bc9%29%0A%u6458%u53D6%u516C%u5F0F%u5982%u4E0B%uFF1A%0A%24%24J%28%5Ctheta%29%20%3D%20-%5Cdfrac%20%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%5By%5E%7B%28i%29%7Dlog%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29%29%20+%20%281-y%5E%7B%28i%29%7D%29log%281-h_%5Ctheta%28x%5E%7B%28i%29%7D%29%29%5D%24%24%0A%0ANote%uFF1A%0A*%20%24%5CTheta%5E%7B%28j%29%7D%24%u7684%u5C3A%u5BF8%u4E3A%24s_%7Bj+1%7D%20%20%5Ctimes%20%28s_j+1%29%24%uFF0C%u53D6%u51B3%u4E8E%u4E0A%u4E00%u5C42%u548C%u8FD9%u4E00%u5C42%u7684node%u6570%u91CF%u3002%u5176%u4E2D%u7684+1%uFF0C%u662Fbias%u8282%u70B9%uFF0C%u5373%u5E38%u91CF%28+1%29%u8282%u70B9%uFF0C%u800C%u4E0D%u7B97%u5728%u8282%u70B9%u6570%u4E2D%0A*%20%24%5CTheta%24%u77E9%u9635%u7684%u6570%u91CF%u53D6%u51B3%u4E8E%u7F51%u7EDC%u5C42%u6570%uFF0C%u53733%u5C42%u7F51%u7EDC%uFF0C%u53EA%u67092%u4E2A%24%5CTheta%24%u77E9%u9635%0A%0A%23%23Cost%20Function%0A%u63A5%u7740%u4E0A%u4E00%u7AE0%u7684%u516C%u5F0F%uFF0C%u7ED9%u51FA%u5B8C%u6574%u7684%u591A%u72B6%u6001%u5206%u7C7B%u5E76%u4E14%u6B63%u89C4%u5316%u7684cost%20function%u5982%u4E0B%uFF1A%0A%24%24J%28%5CTheta%29%20%3D%20-%5Cdfrac%20%7B1%7D%7Bm%7D%20%5Csum_%7Bi%3D1%7D%5Em%20%5Csum_%7Bk%3D1%7D%5EK%5By_k%5E%7B%28i%29%7Dlog%28h_%5CTheta%28x%5E%7B%28i%29%7D%29%29_k%20+%20%281-y_k%5E%7B%28i%29%7D%29log%281-%28h_%5CTheta%28x%5E%7B%28i%29%7D%29%29_k%29%5D%20+%20%5Cdfrac%20%7B%5Clambda%7D%7B2m%7D%20%5Csum_%7Bl%3D1%7D%5E%7BL-1%7D%20%5Csum_%7Bi%3D1%7D%5E%7Bs_l%7D%20%5Csum_%7Bj%3D1%7D%5E%7Bs_l+1%7D%28%5CTheta_%7Bi%2Cj%7D%5E%7B%28l%29%7D%29%5E2%24%24%0A%u7A0D%u4F5C%u89E3%u91CA%uFF1A%0A*%20%u516C%u5F0F%u7684%u524D%u534A%u90E8%u5206%u662F%u539F%u7248%u7684hypothesis%uFF0C%u5E76%u5BF9%u6240%u6709%u7684%u5206%u7C7B%u8FDB%u884C%u7D2F%u52A0%0A*%20%u540E%u534A%u90E8%u5206%u662F%u6B63%u89C4%u5316%u53C2%u6570%uFF0C%u662F%u5BF9%u6240%u6709%u7684%24%5CTheta%24%u53C2%u6570%u8FDB%u884C%u5E73%u65B9%u7D2F%u52A0%u3002%u4E00%u5171%u6709L-1%u5C42%u795E%u7ECF%u7F51%u7EDC%uFF0C%u6BCF%u4E00%u5C42%u6709%24s_%7Bl+1%7D%5Ctimes%20s_l+1%24%u4E2A%24%5CTheta%24%0A%0A%3E**%u6CE8**%0A%3E%u6CE8%u610FRegularized%u9879%uFF0C%u53EA%u7D2F%u52A0%24s_%7Bj+1%7D%20%5Ctimes%20s_j%24%u9879%uFF0C%u4E0D%u5305%u542Bbias%u9879%24%5CTheta_%7Bi0%7D%24%0A%0A%23%23%23Backpropagation%20Algorithm%0A%u6709%u4E86cost%20function%uFF0C%u5C31%u53EF%u4EE5%u5F00%u59CBGradient%20descent%u4E86%uFF0C%u57FA%u672C%u516C%u5F0F%u5982%u4E0B%uFF1A%0A%24%24%5Ctheta_j%20%3A%3D%20%5Ctheta_j%20-%20%5Cdfrac%20%7B%5Calpha%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29-y%5E%7B%28i%29%7D%29%5Ccenterdot%20x_j%5E%7B%28i%29%7D%24%24%0A%u4F46%u662F%u73B0%u5728%u5F15%u5165%u4E86%u795E%u7ECF%u7F51%u7EDC%uFF0C%u6C42%u504F%u5BFC%u6570%u5C31%u6CA1%u8FD9%u4E48%u7B80%u5355%u4E86%uFF0C%u6240%u4EE5%u5F15%u5165%u4E86Forwardpropagation%20%26%20Backpropagation%u3002%u610F%u5373%uFF0C%u5411%u524D%u7B97%u4E00%u904D%uFF0C%u518D%u5411%u56DE%u7B97%u4E00%u904D%uFF0C%u7EFC%u5408%u4E24%u65B9%u9762%u7684%u6570%u636E%u5C31%u80FD%u5F97%u51FAcost%20function%u7684%u504F%u5BFC%u6570%u3002%u8BC1%u660E%u4E0D%u4F1A%uFF0C%u4F46%u662FAndrew%u7ED9%u51FA%u4E86%u516C%u5F0F%u3002%0A%u6574%u4E2A%u7B97%u6CD5%u8FC7%u7A0B%u5982%u4E0B%uFF0C%u8FD9%u91CC%u4E0D%u540C%u4E8E%u6559%u6750%u4E2D%u76844%u5C42%u795E%u7ECF%u7F51%u7EDC%uFF0C%u800C%u662F%u91C7%u7528%u672C%u7BC7%u7B14%u8BB0%u4E2D%u7684%u4E09%u5C42%u795E%u7ECF%u7F51%u7EDC%uFF1A%0A%3E%20Given%20training%20set%20%24%7B%28x%5E%7B%281%29%7D%2C%20y%5E%7B%281%29%7D%29%2C%20...%2C%20%28x%5E%7B%28m%29%7D%2C%20y%5E%7B%28m%29%7D%29%7D%24%0A%3E%20Set%20%24%5CDelta_%7Bij%7D%5E%7B%28l%29%7D%20%3D%200%20%24%20for%20all%20%28l%2Ci%2Cj%29%u3002%20size%28%24%5CDelta%24%29%20%3D%20%24s_%7Bj+1%7D%20%5Ctimes%20s_%7Bj%7D+1%24%uFF0C%u4E0E%24%5CTheta%24%u540C%0A%3E%20For%20i%20%3D1%20to%20m%0A%09%26nbsp%3B%26nbsp%3B%201.%20Set%20%24a%5E%7B%281%29%7D%20%3D%20x%5E%7B%28i%29%7D%24%2C%20both%20a%20and%20x%20are%20vectors%0A%09%26nbsp%3B%26nbsp%3B%202.%20Perform%20forward%20propagation%20to%20compute%20%24a%5E%7B%28l%29%7D%24%20for%20l%3D2%2C3%2C...%2CL.%20L%3D%u795E%u7ECF%u7F51%u7EDC%u5C42%u6570%0A%09%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%24a%5E%7B%281%29%7D%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%201%20%26%20x%20%5Cend%7Bmatrix%7D%20%5Cright%5D%24%20%u2014%u2014%u6CE8%u610F%u52A0%u5165bias%u9879%0A%09%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%24z%5E%7B%282%29%7D%20%3D%20%5CTheta%5E%7B%281%29%7Da%5E%7B%281%29%7D%24%0A%09%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%24a%5E%7B%282%29%7D%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%201%20%26%20g%28z%5E%7B%282%29%7D%29%5Cend%7Bmatrix%7D%20%5Cright%5D%24%20%u2014%u2014%u6CE8%u610F%u52A0%u5165bias%u9879%0A%09%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%24z%5E%7B%283%29%7D%20%3D%20%5CTheta%5E%7B%282%29%7Da%5E%7B%282%29%7D%24%0A%09%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%24a%5E%7B%283%29%7D%20%3D%20h_%5CTheta%28x%29%20%3D%20g%28z%5E%7B%283%29%7D%29%24%0A%09%3E%0A%20%20%20%26nbsp%3B%26nbsp%3B%203.%20Using%20%24y%5E%7B%28i%29%7D%24%2C%20compute%20%24%5Cdelta%5E%7B%28L%29%7D%20%3D%20a%5E%7B%28L%29%7D-%20y%20%5E%7B%28i%29%7D%24.%20y%u662F%u5BF9%u8F93%u51FA%u7684%u91CF%u6D4B%uFF0C%24a%5E%7B%28L%29%7D%20%3D%20h_%5CTheta%28x%29%24%u662F%u5BF9%u8F93%u51FA%u7684%u6A21%u578B%u4F30%u8BA1%uFF0C%24%5Cdelta%5E%7B%28L-1%29%7D%24%u7B97%u662F%u6A21%u578B%u504F%u5DEE%u3002%0A%20%20%20%26nbsp%3B%26nbsp%3B%204.%20Using%20backpropagation%20to%20compute%20%24%5Cdelta%5E%7B%28L-1%29%7D%2C%20%5Cdelta%5E%7B%28L-2%29%7D%2C%20...%2C%20%5Cdelta%5E%7B%282%29%7D%24%uFF0C%u8F93%u5165%u5C42%u6CA1%u6709%24%5Cdelta%24%uFF0C%u5373%24%5Cdelta%5E%7B%281%29%7D%24%0A%20%20%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%24%5Cdelta%5E%7B%28l%29%7D%3D%28%5CTheta%5E%7B%28l%29%7D%29%5ET%5Cdelta%5E%7B%28l+1%29%7D.*a%5E%7B%28l%29%7D.*%281-a%5E%7B%28l%29%7D%29%24%20%u2014%u2014%u6B64%u5904%u5E94%u5F53%u6709%u8BEF%uFF0C%u5177%u4F53%u53C2%u8003%24%5Cdelta%24%u76F8%u5173%u7B14%u8BB0%0A%20%20%0A%20%3E**%u6CE8%3A**%0A*%u9488%u5BF9%24%5Cdelta%24%u7684%u8BA1%u7B97%u8981%u7279%u522B%u6CE8%u610F%u3002%u4E0B%u9762%u4E13%u95E8%u653E%u4E00%u8282%u89E3%u91CA%24%5Cdelta%24%u8BA1%u7B97*%0A%20%20%20%20%0A%20%3E%26nbsp%3B%26nbsp%3B%205.%20Compute%20%24%5CDelta_%7Bij%7D%5E%7B%28l%29%7D%24%0A%20%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%24%5CDelta_%7Bij%7D%5E%7B%28l%29%7D%20%3A%3D%20%5CDelta_%7Bij%7D%5E%7B%28l%29%7D%20+%20a_j%5E%7B%28l%29%7D%5Cdelta_i%5E%7B%28l+1%29%7D%24%0A%20%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BVectorized%20equation%3A%20%24%5CDelta%5E%7B%28l%29%7D%20%3A%3D%20%5CDelta%5E%7B%28l%29%7D%20+%20%5Cdelta%5E%7B%28l+1%29%7D%28a%5E%7B%28l%29%7D%29%5ET%24%uFF0C%u5176%u4E2Dj%u662F%u6BCF%u4E00%u5C42%u7F51%u7EDC%u4E2D%u7684%u8282%u70B9%u7F16%u53F7%0A%20%3E**%u6CE8%3A**%0A%3E*%u6B64%u5904%u7D2F%u52A0%u6307%u7684%u662F%u9488%u5BF9training%20samples*%0A%0A%3E%20%26nbsp%3B%26nbsp%3B%206.%20Final%20step%2C%20compute%20the%20partial%20derivative%20of%20%24J%28%5CTheta%29%24%0A%20%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%20%24%5Cdfrac%20%7B%5Cpartial%7D%7B%5Cpartial%5CTheta_%7Bij%7D%5E%7B%28l%29%7D%7DJ%28%5CTheta%29%20%3D%20D_%7Bij%7D%5E%7B%28l%29%7D%24%0A%20%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%20%24D_%7Bij%7D%5E%7B%28l%29%7D%20%3A%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20%5CDelta_%7Bij%7D%5E%7B%28l%29%7D%20+%20%5Clambda%20%5CTheta_%7Bij%7D%5E%7B%28l%29%7D%20%5Chspace%7B1em%7D%20if%20%5Chspace%7B0.1em%7D%20j%20%5Cneq%200%24%20%20%0A%20%20%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%20%24D_%7Bij%7D%5E%7B%28l%29%7D%20%3A%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%20%5CDelta_%7Bij%7D%5E%7B%28l%29%7D%20%5Chspace%7B4em%7D%20if%20%5Chspace%7B0.1em%7D%20j%20%3D%200%24%0A%0A%u6574%u4E2A%u8FC7%u7A0B%u7565%u663E%u590D%u6742%uFF0C%u4F46%u662F%u8FD9%u5C31%u662F%u795E%u7ECF%u7F51%u7EDC%u3002%u636E%u8BF4%u540E%u9762%u6709%u66F4%u4F18%u96C5%u7684%u7B97%u6CD5%u3002%0A%0A%23%23%23%u8BA1%u7B97%24%5Cdelta%24%0A%3E%24%5Cdelta%24%3A%20an%20error%20item%20that%20measures%20how%20much%20the%20node%20was%20responsible%20for%20any%20errors%20in%20our%20output.%0A%0A%24cost%28t%29%20%3D%20y%5E%7B%28t%29%7Dlog%28h_%5CTheta%28x%5E%7B%28t%29%7D%29%29%20+%20%281-y%5E%7B%28t%29%7D%29log%281-h_%5CTheta%28x%5E%7B%28t%29%7D%29%29%24%0A%24%5Cdelta_j%5E%7B%28t%29%7D%20%3D%20%5Cdfrac%20%7B%5Cpartial%7D%7B%5Cpartial%20z_j%5E%7B%28l%29%7D%7Dcost%28t%29%20%3D%20%28%5CTheta%5E%7B%28l%29%7D%29%5ET%5Cdelta%5E%7B%28l+1%29%7D.*g%27%28z%29%20%24%0A%24g%27%28z%29%20%3D%20%28%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-z%7D%7D%29%27%20%3D%20g%28z%29%281-g%28z%29%29%24%0A%0A%u6700%u7EC8%u8BA1%u7B97%u5F0F%u5E94%u4E3A%uFF1A%0A%24%24%5Cdelta_j%5E%7B%28t%29%7D%20%3D%20%28%5CTheta%5E%7B%28l%29%7D%29%5ET%5Cdelta%5E%7B%28l+1%29%7D.*g%28%5CTheta%5E%7B%28l-1%29%7D%20a%5E%7B%28l-1%29%7D%29%20.*%281-g%28%5CTheta%5E%7B%28l-1%29%7Da%5E%7B%28l-1%29%7D%29%29%24%24%0A%0Ag%3Dsigmoid%20function.%0A%20%20%0A%23%23%u7B97%u6CD5%u8C03%u4F18%0A%u7B97%u6CD5%u504F%u5DEE%u8FC7%u5927%u6709%u4E24%u7C7B%u95EE%u9898%uFF1A%0A-%20Overfitting%20%28%u8FC7%u62DF%u5408%20/%20High%20Variance%29%0A-%20Underfitting%20%28%u6B20%u62DF%u5408%20/%20High%20Bias%29%0A%u9488%u5BF9%u8FD9%u4E24%u4E2A%u95EE%u9898%uFF0C%u6211%u4EEC%u8981%u505A%u7684%u662F%uFF1A%0A1.%20%u8BC6%u522B%u4ED6%u4EEC%0A2.%20%u91C7%u53D6%u76F8%u5E94%u63AA%u65BD%0A%0A%23%23%23%u5982%u4F55%u4EA7%u751F%u6B63%u786E%u7684%u6A21%u578B%0A%u9996%u5148%u5C06training%20samples%u5206%u6210%u4E09%u90E8%u5206%uFF1A%0A-%20Training%20set%3A%2060%25%0A-%20Cross%20validation%20set%3A%2020%25%0A-%20Test%20set%3A%2020%25%0A%u7528training%20set%u6765%u6311%u9009%24%5CTheta%2C%20%5Clambda%24%uFF0C%u7528Cross%20validation%20set%u6765%u9009%u62E9%u591A%u9879%u5F0F%u5E42%u6B21%uFF0C%u6700%u540E%u7528test%20set%20error%20%24J_%7Btest%7D%28%5CTheta%5E%7B%28d%29%7D%29%24%u6765%u8BC4%u4F30%u7B97%u6CD5%u7684%u4F18%u52A3%u3002%0A%21%5BAlt%20text%7C400x0%5D%28./1502938070114.png%29%0A%0A%0A%23%23%23%23Polynomial%20Degree%20-%20d%0A%u53C2%u8003%u5982%u4E0B%u56FE%u50CF%uFF0C%0A%21%5BAlt%20text%5D%28./1493951705755.png%29%0A%0A%3E%u5BF9%u4E8E%u76F8%u540C%u7684%24%5CTheta%24%uFF0C%u5F53%u591A%u9879%u5F0F%u5E42%u6B21%u5F88%u4F4E%u65F6%uFF0C%u53EF%u80FD%u4F1A%u4EA7%u751FUnderfitting%uFF0C%u6B64%u65F6%24J_cv%24%u548C%24J_training%24%u90FD%u5F88%u5927%0A%u5F53%u591A%u9879%u5F0F%u5E42%u6B21%u5F88%u5927%u65F6%uFF0C%u53EF%u80FD%u4F1A%u4EA7%u751FOverfitting%uFF0C%u6B64%u65F6%24J_cv%24%u8FDC%u5927%u4E8E%24J_training%24%uFF0C%u8FD9%u5BF9%u6311%u9009d%u6709%u5F88%u597D%u7684%u53C2%u8003%u610F%u4E49%0A%0A%23%23%23%23Regularization%20%20-%20%24%5Clambda%24%0A1.%20Create%20a%20list%20of%20lambdas%20%28i.e.%20%u03BB%u2208%7B0%2C0.01%2C0.02%2C0.04%2C...10.24%7D%29%3B%0A2.%20%u8BA1%u7B97%u4E0D%u5305%u542B%24%5Clambda%24%u7684train%20error%u548Ccross%20validation%20error%0A3.%20%u753B%u51FA%u4E0B%u56FE%0A4.%20%u548C%u9009%u62E9d%u7C7B%u4F3C%uFF0C%u9009%u53D6%u5408%u9002%u7684%24%5Clambda%24%0A%0A%21%5BAlt%20text%7C350x0%5D%28./1493952692430.png%29%0A%0A%23%23%23%23Random%20initialization%0A%u5BF9%24%5CTheta%24%u7684%u521D%u59CB%u503C%u8FDB%u884C%u968F%u673A%u5316%u3002%u5728ex4%u7684%u7EC3%u4E60%u4E2D%uFF0C%u7ED9%u51FA%u4E86%u4E00%u4E0B%u516C%u5F0F%u5BF9%24%5CTheta%24%u8FDB%u884C%u521D%u59CB%u5316%uFF1A%0A%24%24%5Cepsilon_%7Binit%7D%20%3D%20%5Cdfrac%7B%5Csqrt%7B6%7D%7D%7B%5Csqrt%20%7BL%5C_in%20+L%5C_out%7D%7D%24%24%0A%24L%5C_in%20%3D%20s_l%24%0A%24L%5C_out%20%3D%20s_%7Bl+1%7D%24%0A%0A%23%23%23%u8BC6%u522BOverfitting%28High%20Variance%29/Underfitting%28High%20Bias%29%0A%u8981%u8BC6%u522B%uFF0C%u5C31%u8981%u901A%u8FC7Learning%20Curves%0A%0A**High%20Bias%3A**%0A%21%5BAlt%20text%7C350x0%5D%28./1493950678949.png%29%0ATest%20error%u548Ctrain%20error%u63A5%u8FD1%uFF0C%u800C%u4E14%u90FD%u5F88%u9AD8%0A%0A**High%20Variance%3A**%0A%21%5BAlt%20text%7C350x0%5D%28./1493952926446.png%29%0ATrain%20error%u63A5%u8FD1%u6B63%u786E%u503C%uFF0C%u4F46%u662Ftest%20error%u8FD8%u662F%u5F88%u9AD8%uFF0C%u968F%u7740training%20set%20size%u53D8%u5927%uFF0Ctest%20error%u4E5F%u5728%u51CF%u5C0F%uFF0C%u4F46%u662F%u51CF%u5C0F%u7684%u901F%u5EA6%u5F88%u6162%u3002%0A%0A%23%23%23What%20to%20try%20next%3F%0A%3E%20-%20Getting%20more%20training%20examples%3A%20Fixes%20high%20variance%0A%3E-%20Trying%20smaller%20sets%20of%20features%3A%20Fixes%20high%20variance%0A%3E-%20Adding%20features%3A%20Fixes%20high%20bias%0A%3E-%20Adding%20polynomial%20features%3A%20Fixes%20high%20bias%0A%3E-%20Decreasing%20%u03BB%3A%20Fixes%20high%20bias%0A%3E-%20Increasing%20%u03BB%3A%20Fixes%20high%20variance.%0A%0A%u8FD8%u6709%u4E00%u4E2A%u529E%u6CD5%u5C31%u662F%uFF1A%0A%u5982%u679C%u60F3%u5F97%u5230%u597D%u7B97%u6CD5%uFF0C%u505A%u5230%u4E24%u65B9%u9762%u5373%u53EF%uFF1A%0A1.%20%u5F15%u5165%u5F88%u591A%u53D8%u91CF%uFF0C%u53C2%u6570%20%3D%3E%20high%20variance%2C%20low%20bias%0A2.%20%u63D0%u4F9B%u5927%u91CFtraining%20samples%20%3D%3E%20low%20variance%0A%23%23%23Error%20Analysis%0A%3E-%20Start%20with%20a%20simple%20algorithm%2C%20implement%20it%20quickly%2C%20and%20test%20it%20early%20on%20your%20cross%20validation%20data.%0A%3E-%20Plot%20learning%20curves%20to%20decide%20if%20more%20data%2C%20more%20features%2C%20etc.%20are%20likely%20to%20help.%0A%3E-%20Manually%20examine%20the%20errors%20on%20examples%20in%20the%20cross%20validation%20set%20and%20try%20to%20spot%20a%20trend%20where%20most%20of%20the%20errors%20were%20made.%0A%0A%23%23%23%u7279%u4F8Bskewed%20data%0A%u5F53%u5904%u7406%u5206%u7C7B%u5668%u65F6%uFF0C%u5982%u679C%u6709%u4E00%u4E2A%u5206%u7C7B%u5360%u7EDD%u5BF9%u591A%u6570%uFF0C%u4F8B%u598299%25%u3002%u90A3%u53EF%u80FD%u6211%u4EEC%u5BF9%u9884%u6D4B%u6709%u504F%u5411%uFF0C%u6BD4%u5982%u8981%u9884%u6D4B%u764C%u75C7%uFF0C%u5B81%u53EF%u8BEF%u8BCA%uFF0C%u4E0D%u53EF%u6F0F%u8BCA%uFF0C%u4E5F%u5C31%u662F%u8981%u9AD8Recall%u3002%0A%21%5BAlt%20text%5D%28./1493953864306.png%29%0A%24Precision%20%3D%20%5Cdfrac%20%7Btrue%5C%20positive%7D%7Btrue%5C%20positive%20+%20false%5C%20positive%7D%24%20%u9884%u6D4B%u547D%u4E2D%u7684%u51C6%u786E%u6027%0A%0A%24Recall%20%3D%20%5Cdfrac%20%7Btrue%5C%20positive%7D%7Btrue%5C%20positive%20+%20false%5C%20negative%7D%24%20%u547D%u4E2D%u7387%0A%0A%24Accuracy%20%3D%20%5Cdfrac%20%7Btrue%5C%20positive%20+%20true%5C%20negative%7D%20%7Boverall%5C%20samples%7D%24%0A%0A%u53EF%u4EE5%u901A%u8FC7%u53D6%u4E0D%u540C%u7684threshold%uFF0C%u6765%u505A%u51FA%u4E0B%u9762%u8FD9%u5F20%u56FE%uFF0C%u6839%u636ERecall%u548CPrecision%u7684%u504F%u597D%u6765%u9009%u62E9%u9700%u8981%u7684threshold%u3002%0A%21%5BAlt%20text%5D%28./1493961624396.png%29%0A%0A**%u5982%u4F55%u8BC4%u4EF7%u7B97%u6CD5%u4F18%u52A3%uFF1A**%0A%24F1%24-Score%20%28F%20Score%29%20%3D%20%242%5Cdfrac%20%7BPR%7D%7BP+R%7D%24%0A%0A%0A]]></content>
      <tags>
        <tag>deep learning</tag>
        <tag>深度学习</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Machine Learning (1) - Linear & Logistic Regression]]></title>
    <url>%2F2017%2F04%2F01%2FMachine_Learning_(1)_-_Linear_%26_Logistic_Regression%2F</url>
    <content type="text"><![CDATA[EditMachine Learning (1) - Linear &amp; Logistic RegressionLinear RegressionCost Function &amp; Gradient DescentHow to choose learning rate - ?Feature ScalingNormal Equation&#x6B63;&#x89C4;&#x89E3;Logistic RegressionCost FunctionOverfitting&#x8FC7;&#x62DF;&#x5408;Regularized Linear RegressionRegularized Logistic RegressionLinear RegressionLinear Regression = &#x7EBF;&#x6027;&#x56DE;&#x5F52;&#x3002;Single Feature Hypothesis: &#x901A;&#x8FC7;&#x6C42;cost function&#x7684;&#x6700;&#x5C0F;&#x503C;&#xFF0C;&#x6765;&#x4F30;&#x7B97;&#x3002; &#x5217;&#x51FA;&#x5355;feature&#x7684;cost function&#xFF0C;&#x4E0D;&#x505A;&#x591A;&#x4ECB;&#x7ECD;&#x3002;&#x91CD;&#x70B9;&#x653E;&#x5728;Multiple Feature Linear Regression&#x3002;Cost Function: Cost Function &amp; Gradient DescentMultiple Feature Hypothesis: Multiple Feature Cost Function: Gradient Descent: j := 0&#x2026;m - Learning rate.How to choose learning rate - ?If is too small: slow convergenceIf is too large: J() may not decrease on every iteration; may not converge.To choose , try: &#x2026;, 0.001, 0.003, 0.01, 0.03, 0.1, 0.3, 1, &#x2026; &#x6BCF;&#x6B21;&#x53D6;3&#x500D;&#x3002;Feature ScalingWe can speed up gradient descent by having each of our input values in roughly the same range. This is because &#x3B8; will descend quickly on small ranges and slowly on large ranges, and so will oscillate inefficiently down to the optimum when the variables are very uneven.&#x7528;&#x4E0B;&#x9762;&#x7684;&#x516C;&#x5F0F;&#x9884;&#x5904;&#x7406;&#x6211;&#x4EEC;&#x7684;training set&#xFF0C;&#x5C31;&#x662F;Feature Scaling is the average of all the values for feature (i) is the range of values (max - min)or is the standard deviation.* standard deviation (&#x6807;&#x51C6;&#x5DEE;)= Normal Equation&#x6B63;&#x89C4;&#x89E3;&#x6CE8;1&#xFF1A;training set&#x7684;&#x6570;&#x91CF;&#x8981;&#x5927;&#x4E8E;feature&#x6570;&#x91CF;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x4E0D;&#x53EF;&#x9006;&#xFF0C;&#x5BFC;&#x81F4;&#x6CA1;&#x6709;&#x89E3;&#x6CE8;2&#xFF1A;&#x6B63;&#x89C4;&#x89E3;&#x4E0D;&#x9700;&#x8981;feature scalingLogistic RegressionHypothesis: Sigmoid Function / Logistic Function The following image shows us what the sigmoid function looks like:&#x8FD9;&#x91CC;&#x7684;Hypothesis&#x65B9;&#x7A0B;&#x662F;&#x4E0D;&#x5E73;&#x6ED1;&#x7684;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x5F88;&#x591A;&#x7684;local optimization&#xFF0C;&#x5BFC;&#x81F4;Gradient Descent&#x4E0D;&#x80FD;&#x6210;&#x529F;&#x6536;&#x655B;&#x3002;&#x7528;&#x6761;&#x4EF6;&#x6982;&#x7387;&#x8868;&#x793A;Hypothesis: y=1&#x7684;&#x6761;&#x4EF6;&#x4E0B;&#xFF0C;x,&#x7684;&#x53D6;&#x503C;&#x6982;&#x7387;&#x3002; Cost Function &#x8FD9;&#x5176;&#x4E2D;&#x7528;Cost&#x51FD;&#x6570;&#x53D6;&#x4EE3;&#x4E86;&#x7EBF;&#x6027;&#x56DE;&#x5F52;&#x4E2D;&#x7684;&#x5C06;Cost&#x51FD;&#x6570;&#x4EE3;&#x5165;&#x6574;&#x4E2A;Cost Function&#x4E2D;&#x53EF;&#x5F97;&#xFF1A; Vectorized implementation: &#x8FDB;&#x4E00;&#x6B65;&#x8BA1;&#x7B97;Gradient Descent&#x7684;&#x8FED;&#x4EE3;&#x7B97;&#x6CD5;&#x4E3A;&#xFF1A; &#x77E2;&#x91CF;&#x5316;&#x5199;&#x6CD5;&#xFF1A; Overfitting&#x8FC7;&#x62DF;&#x5408;Regularized Linear RegressionThe &#x3BB;, or lambda, is the regularization parameter. It determines how much the costs of our theta parameters are inflated.Regularized Logistic RegressionThe second sum, means to explicitly exclude the bias term !!&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x7684;regularized&#x9879;&#xFF0C;&#x4E0D;&#x5305;&#x542B;&#xFF0C;&#x5982;&#x679C;&#x5728;Matlab/Octave&#x4E2D;&#x5C31;&#x662F;&#x3002;%23Machine%20Learning%20%281%29%20-%20Linear%20%26%20Logistic%20Regression%0A%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%0A%0A%0A%5BTOC%5D%0A%0A%21%5BAlt%20text%5D%28./1491028424509.png%29%0A%0A%23%23Linear%20Regression%0ALinear%20Regression%20%3D%20%u7EBF%u6027%u56DE%u5F52%u3002%0A%0ASingle%20Feature%20**Hypothesis**%3A%0A%24%24h_%7B%5Ctheta%7D%28x%29%20%20%3D%20%5Ctheta_%7B0%7D%20+%20%5Ctheta_%7B1%7Dx%24%24%0A%u901A%u8FC7%u6C42cost%20function%u7684%u6700%u5C0F%u503C%uFF0C%u6765%u4F30%u7B97%24%5Ctheta_%7Bi%7D%24%u3002%0A%u5217%u51FA%u5355feature%u7684cost%20function%uFF0C%u4E0D%u505A%u591A%u4ECB%u7ECD%u3002%u91CD%u70B9%u653E%u5728Multiple%20Feature%20Linear%20Regression%u3002%0A%0A**Cost%20Function**%3A%0A%24%24J%28%5Ctheta%29%20%3D%20%5Cdfrac%20%7B1%7D%7B2m%7D%20%5Csum_%7Bi%3D1%7D%5Em%20%28h_%5Ctheta%28x_%7Bi%7D%29%20-%20y_%7Bi%7D%29%5E2%24%24%0A%0A%23%23%23Cost%20Function%20%26%20Gradient%20Descent%0AMultiple%20Feature%20**Hypothesis**%3A%0A%24%24h_%5Ctheta%28x%29%20%3D%20%5Cbegin%20%7Bbmatrix%7D%5Ctheta_0%20%5Chspace%7B1em%7D%20%5Ctheta_1%20%5Chspace%7B1em%7D...%20%5Chspace%7B1em%7D%5Ctheta_n%20%5Cend%7Bbmatrix%7D%20%5Cbegin%7Bbmatrix%7Dx_0%20%5Cnewline%20x_1%20%5Cnewline%20%5Cvdots%20%5Cnewline%20x_n%5Cend%7Bbmatrix%7D%20%3D%20%5Ctheta%5ETx%24%24%0A%0AMultiple%20Feature%20**Cost%20Function**%3A%0A%24%24J%28%5Ctheta%29%20%3D%20%5Cdfrac%20%7B1%7D%7B2m%7D%5Csum_%7Bi%3D1%7D%5Em%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29-y%5E%7B%28i%29%7D%29%5E2%24%24%0A%0AGradient%20Descent%3A%0A%24%24%5Ctheta_j%20%3A%3D%20%5Ctheta_j%20-%20%5Calpha%5Cdfrac%20%7B%5Cpartial%7D%7B%5Cpartial%5Ctheta_j%7D%20J%28%5Ctheta%29%20%3D%20%5Ctheta_j%20-%20%5Calpha%5Cdfrac%20%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29%20-%20y%5E%7B%28i%29%7D%29%5Ccenterdot%20x_j%5E%7B%28i%29%7D%24%24%20%0A-%20j%20%3A%3D%200...m%0A-%20%24%5Calpha%24%20-%20Learning%20rate.%0A%0A%23%23%23How%20to%20choose%20learning%20rate%20-%20%24%5Calpha%24%20%3F%0A-%20If%20%24%5Calpha%24%20is%20too%20small%3A%20slow%20convergence%0A-%20If%20%24%5Calpha%24%20is%20too%20large%3A%20J%28%24%5Ctheta%24%29%20may%20not%20decrease%20on%20every%20iteration%3B%20may%20not%20converge.%0A%0ATo%20choose%20%24%5Calpha%24%2C%20try%3A%0A%09...%2C%200.001%2C%200.003%2C%200.01%2C%200.03%2C%200.1%2C%200.3%2C%201%2C%20...%0A%u6BCF%u6B21%u53D63%u500D%u3002%0A%0A%23%23%23Feature%20Scaling%0A%3EWe%20can%20speed%20up%20gradient%20descent%20by%20having%20each%20of%20our%20input%20values%20in%20**roughly%20the%20same%20range**.%20This%20is%20because%20%u03B8%20will%20descend%20quickly%20on%20small%20ranges%20and%20slowly%20on%20large%20ranges%2C%20and%20so%20will%20oscillate%20inefficiently%20down%20to%20the%20optimum%20when%20the%20variables%20are%20very%20uneven.%0A%0A%u7528%u4E0B%u9762%u7684%u516C%u5F0F%u9884%u5904%u7406%u6211%u4EEC%u7684training%20set%uFF0C%u5C31%u662FFeature%20Scaling%0A%24%24x_i%20%3A%3D%20%5Cdfrac%7Bx_i%20-%20%5Cmu_i%7D%7Bs_i%7D%20%24%24%0A-%20%24%5Cmu_i%24%20is%20the%20average%20of%20all%20the%20values%20for%20feature%20%28i%29%0A-%20%24s_i%24%20is%20the%20range%20of%20values%20%28max%20-%20min%29%0A-%20**or**%20%24s_i%24%20is%20the%20standard%20deviation.%0A%0A%5C*%20*standard%20deviation%20%28%u6807%u51C6%u5DEE%29%3D%20%24%5Csqrt%7B%5Cdfrac%7B1%7D%7BN%7D%5Csum_%7Bi%3D1%7D%5EN%28x_i%20-%20%5Cmu%292%7D%24*%0A%0A%23%23%23Normal%20Equation%u6B63%u89C4%u89E3%0A%24%24%5Ctheta%20%3D%20%28X%5ETX%29%5E%7B-1%7DX%5ETy%24%24%0A*%20%u6CE81%uFF1Atraining%20set%u7684%u6570%u91CF%u8981%u5927%u4E8Efeature%u6570%u91CF%uFF0C%u5426%u5219%24X%5ETX%24%u4F1A%u4E0D%u53EF%u9006%uFF0C%u5BFC%u81F4%u6CA1%u6709%u89E3%0A*%20%u6CE82%uFF1A%u6B63%u89C4%u89E3%u4E0D%u9700%u8981feature%20scaling%0A%0A%23%23Logistic%20Regression%0A**Hypothesis**%3A%0A%24%24h_%5Ctheta%28x%29%20%3D%20g%28%5Ctheta%5ETx%29%24%24%0A**Sigmoid%20Function%20/%20Logistic%20Function**%0A%24%24g%28z%29%20%3D%20%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-z%7D%7D%24%24%0A%24z%20%3D%20%5Ctheta%5ETx%24%0A%0AThe%20following%20image%20shows%20us%20what%20the%20sigmoid%20function%20looks%20like%3A%0A%21%5BAlt%20text%5D%28./1491033397652.png%29%0A%0A%u8FD9%u91CC%u7684Hypothesis%u65B9%u7A0B%u662F%u4E0D%u5E73%u6ED1%u7684%uFF0C%u4F1A%u5BFC%u81F4%u5F88%u591A%u7684local%20optimization%uFF0C%u5BFC%u81F4Gradient%20Descent%u4E0D%u80FD%u6210%u529F%u6536%u655B%u3002%0A%0A%u7528%u6761%u4EF6%u6982%u7387%u8868%u793AHypothesis%3A%0Ay%3D1%u7684%u6761%u4EF6%u4E0B%uFF0Cx%2C%24%5Ctheta%24%u7684%u53D6%u503C%u6982%u7387%u3002%0A%24%24h_%5Ctheta%28x%29%3DP%28y%3D1%5Cmid%20x%3B%u03B8%29%3D1%u2212P%28y%3D0%20%5Cmid%20x%3B%u03B8%29%24%24%0A%24%24P%28y%3D0%20%5Cmid%20x%3B%u03B8%29+P%28y%3D1%20%5Cmid%20x%3B%u03B8%29%3D1%24%24%0A%0A%0A%0A%23%23%23%20Cost%20Function%0A%24%24J%28%5Ctheta%29%20%3D%20-%5Cdfrac%20%7B1%7D%7Bm%7D%20%5Csum_%7Bi%3D1%7D%5EmCost%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29%2C%20y%5E%7B%28i%29%7D%29%24%24%0A%24%24Cost%28h_%5Ctheta%28x%29%2C%20y%29%29%20%3D%20-log%28h_%5Ctheta%28x%29%29%20%20%5Chspace%7B10em%7Dif%20y%20%3D%201%24%24%0A%24%24Cost%28h_%5Ctheta%28x%29%2C%20y%29%29%20%3D%20-log%281-h_%5Ctheta%28x%29%29%20%5Chspace%7B8em%7D%20if%20y%20%3D%200%24%24%0A%0A%24Cost%28h_%5Ctheta%28x%29%2C%20y%29%29%20%3D%200%20%5Chspace%7B3em%7D%20if%20%5Chspace%7B1em%7D%20h_%5Ctheta%28x%29%20%3D%20y%24%0A%24Cost%28h_%5Ctheta%28x%29%2C%20y%29%29%20%5Crightarrow%20%5Cinfty%20%5Chspace%7B2em%7D%20if%20y%3D0%20%5Chspace%7B0.5em%7D%20and%20%5Chspace%7B0.5em%7D%20h_%5Ctheta%28x%29%20%5Crightarrow%201%24%0A%24Cost%28h_%5Ctheta%28x%29%2C%20y%29%29%20%5Crightarrow%20%5Cinfty%20%5Chspace%7B2em%7D%20if%20y%3D1%20%5Chspace%7B0.5em%7D%20and%20%5Chspace%7B0.5em%7D%20h_%5Ctheta%28x%29%20%5Crightarrow%200%24%0A%0A%u8FD9%u5176%u4E2D%u7528Cost%u51FD%u6570%u53D6%u4EE3%u4E86%u7EBF%u6027%u56DE%u5F52%u4E2D%u7684%24%5Cdfrac%20%7B1%7D%7B2%7D%28h_%5Ctheta%28x_i%29-y_i%29%5E2%24%0A%0A%u5C06Cost%u51FD%u6570%u4EE3%u5165%u6574%u4E2ACost%20Function%u4E2D%u53EF%u5F97%uFF1A%0A%24J%28%5Ctheta%29%20%3D%20-%5Cdfrac%20%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%5By%5E%7B%28i%29%7Dlog%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29%29%20+%20%281-y%5E%7B%28i%29%7D%29log%281-h_%5Ctheta%28x%5E%7B%28i%29%7D%29%29%5D%24%0A%0A**Vectorized%20implementation**%3A%0A%24h%3Dg%28X%5Ctheta%29%20%3D%20%5Cdfrac%20%7B1%7D%7B1+e%5E%7B-%5Ctheta%5ETx%7D%7D%24%0A%24J%28%5Ctheta%29%20%3D%20%5Cdfrac%20%7B1%7D%7Bm%7D%5Ccenterdot%20%28-y%5ETlog%28h_%5Ctheta%29-%281-y%29%5ETlog%281-h_%5Ctheta%29%29%24%0A%0A%u8FDB%u4E00%u6B65%u8BA1%u7B97Gradient%20Descent%u7684%u8FED%u4EE3%u7B97%u6CD5%u4E3A%uFF1A%0A%24%24%5Ctheta_j%20%3A%3D%20%5Ctheta_j%20-%20%5Cdfrac%20%7B%5Calpha%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29-y%5E%7B%28i%29%7D%29%5Ccenterdot%20x_j%5E%7B%28i%29%7D%24%24%0A%0A%u77E2%u91CF%u5316%u5199%u6CD5%uFF1A%0A%24%24%5Ctheta%20%3A%3D%20%5Ctheta%20-%20%5Cdfrac%7B%5Calpha%7D%7Bm%7DX%5ET%28g%28X%5Ctheta%29%20-%20%5Cvec%7By%7D%29%24%24%0A%0A%23%23Overfitting%u8FC7%u62DF%u5408%0A%23%23%23Regularized%20Linear%20Regression%0A%24%24J%28%5Ctheta%29%20%3D%20%5Cdfrac%7B1%7D%7B2m%7D%5Csum_%7Bi%3D1%7D%5Em%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29-y%5E%7Bi%7D%29%5E2+%5Clambda%5Csum_%7Bj%3D1%7D%5En%5Ctheta_j%5E2%24%24%0A%3EThe%20%u03BB%2C%20or%20lambda%2C%20is%20the%20regularization%20parameter.%20It%20determines%20how%20much%20the%20costs%20of%20our%20theta%20parameters%20are%20inflated.%0A%23%23%23Regularized%20Logistic%20Regression%0A%24%24J%28%5Ctheta%29%20%3D%20-%5Cdfrac%20%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%5By%5E%7B%28i%29%7Dlog%28h_%5Ctheta%28x%5E%7B%28i%29%7D%29%29%20+%20%281-y%5E%7B%28i%29%7D%29log%281-h_%5Ctheta%28x%5E%7B%28i%29%7D%29%29%5D%20+%20%5Cdfrac%20%7B%5Clambda%7D%7B2m%7D%5Csum_%7Bj%3D1%7D%5En%5Ctheta_j%5E2%24%24%0AThe%20second%20sum%2C%24%5Csum_%7Bj%3D1%7D%5En%5Ctheta_j%5E2%24%20means%20to%20**explicitly%20exclude%20the%20bias%20term**%20%24%5Ctheta_0%24%0A%0A%21%21%u6CE8%u610F%uFF1A%u8FD9%u91CC%u7684regularized%u9879%uFF0C%u4E0D%u5305%u542B%24%5Ctheta_0%24%uFF0C%u5982%u679C%u5728Matlab/Octave%u4E2D%u5C31%u662F%24%5Ctheta_1%24%u3002]]></content>
  </entry>
  <entry>
    <title><![CDATA[Vim终极折腾]]></title>
    <url>%2F2017%2F03%2F23%2FVim%E7%BB%88%E6%9E%81%E6%8A%98%E8%85%BE%2F</url>
    <content type="text"><![CDATA[Edit &#x672C;&#x7BC7;&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB; &#x8DDF;&#x6211;&#x4E00;&#x8D77;&#x5B66;&#x4E60;VIM - The Life Changing Editor &#x7136;&#x540E;&#x5230;&#x8FD9;&#x91CC;&#x8FDB;&#x5165;&#x9AD8;&#x6F6E; spf13/spf13-vim &#x7B2C;&#x4E00;&#x7BC7;&#x770B;&#x4F3C;&#x662F;&#x4E00;&#x7BC7;&#x666E;&#x666E;&#x901A;&#x901A;&#x4ECB;&#x7ECD;Vim&#x63D2;&#x4EF6;&#x7684;&#x535A;&#x5BA2;&#x6587;&#x3002;&#x4F46;&#x662F;&#x4ED6;&#x5728;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x9876;&#x7EA7;&#x63D2;&#x4EF6;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x5F15;&#x5165;&#x4E86;spf13&#x8FD9;&#x4E2A;GitHub&#x4E0A;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x3002;&#x8FD9;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5168;&#x7684;vimrc&#x914D;&#x7F6E;&#x3002;&#x73A9;&#x5BB6;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#x3002;&#x8FD9;&#x4E00;&#x4E0B;&#x6253;&#x5F00;&#x4E86;&#x6F58;&#x591A;&#x62C9;&#x9B54;&#x76D2;&#xFF0C;&#x672C;&#x6765;&#x6015;&#x9EBB;&#x70E6;&#x6298;&#x817E;&#x7684;&#x6211;&#xFF0C;&#x4E00;&#x4E0B;&#x5C31;&#x5165;&#x5751;&#x4E86;&#x3002;&quot; Use fork vimrc if available { if filereadable(expand(&quot;~/.vimrc.fork&quot;)) source ~/.vimrc.fork endif&quot; }&quot; Use local vimrc if available { if filereadable(expand(&quot;~/.vimrc.local&quot;)) source ~/.vimrc.local endif&quot; }&quot; Use local gvimrc if available and gui is running { if has(&apos;gui_running&apos;) if filereadable(expand(&quot;~/.gvimrc.local&quot;)) source ~/.gvimrc.local endif endif&quot; }.vimrc.before - spf13-vim before configuration.vimrc.before.fork - fork before configuration.vimrc.before.local - before user configuration.vimrc.bundles - spf13-vim bundle configuration.vimrc.bundles.fork - fork bundle configuration.vimrc.bundles.local - local user bundle configuration.vimrc - spf13-vim vim configuration.vimrc.fork - fork vim configuration.vimrc.local - local user configuration&#x4F4E;&#x7AEF;&#x73A9;&#x5BB6;&#x53EF;&#x4EE5;&#x7528;.vimrc.*.local&#x6765;&#x505A;&#x672C;&#x5730;&#x5316;&#x5B9A;&#x5236;&#xFF0C;&#x9AD8;&#x7AEF;&#x73A9;&#x5BB6;&#x53EF;&#x4EE5;fork repo&#xFF0C;&#x7136;&#x540E;&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;.vimrc.*.fork&#x505A;&#x5B9A;&#x5236;&#xFF0C;&#x7136;&#x540E;commit&#xFF0C;&#x7136;&#x540E;&#x6240;&#x6709;&#x4F60;&#x7684;Vim&#x73AF;&#x5883;&#x5C31;&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x5230;&#x8FD9;&#x4E00;&#x4EFD;&#x914D;&#x7F6E;&#x4E86;&#x3002; &#x5B8C;&#x5DE5;&#x540E;&#x7684;Vim&#x770B;&#x8D77;&#x6765;&#x8FD9;&#x6837;&#x95EE;&#x9898;powerline fontsWindows&#x8981;&#x5B8C;&#x6210;&#x8FD9;&#x6837;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x6700;&#x7EA0;&#x7ED3;&#x7684;&#x5C31;&#x662F;powerline&#x7684;&#x5B57;&#x4F53;&#x3002;&#x5982;&#x679C;&#x5B57;&#x4F53;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x662F;&#x6CA1;&#x6CD5;&#x51FA;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x5C0F;&#x5C16;&#x89D2;&#x6837;&#x5F0F;&#x7684;&#x3002;&quot; .vimrc.bundlesBundle &apos;powerline/fonts&apos;&#x6240;&#x6709;&#x7684;&#x5B57;&#x4F53;&#x6587;&#x4EF6;&#x90FD;&#x88AB;&#x5B89;&#x88C5;&#x5230;$HOME\.vim\bundle\fonts\&#x3002;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x8C03;&#x7528;&#x5176;&#x4E2D;&#x7684;power script&#x811A;&#x672C;install.ps1&#xFF0C;&#x5C31;&#x4F1A;&#x5B89;&#x88C5;&#x5230;&#x7CFB;&#x7EDF;&#x5B57;&#x4F53;&#x76EE;&#x5F55;&#x3002;&#x7136;&#x540E;&#x5728;Vim&#x4E2D;&#x9009;&#x62E9;&#x5BF9;&#x5E94;&#x7684;&#x5B57;&#x4F53;&#x5C31;&#x597D;&#x4E86;&#x3002;Linux&#x5728;Linux&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x901A;&#x8FC7;putty&#x8BBF;&#x95EE;Linux&#x7684;&#x65F6;&#x5019;&#x5C31;&#x6CA1;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x4E86;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x5168;&#x662F;&#x7528;putty ssh&#x8BBF;&#x95EE;Linux&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x5F00;&#x59CB;&#x4EE5;&#x4E3A;&#x662F;putty&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x7F51;&#x4E0A;&#x641C;&#x51FA;&#x6765;&#x4E00;&#x5806;&#xFF0C;&#x90FD;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x89E3;&#x91CA;&#x3002;Download the patched fonts. I chose DejaVuSansMono as my font since I like it most.Install this font in Windows to make it accessible for all programs.Open PuTTY and make changes to the settings:Under appearance select the patched fontSelect font quality Clear TypeUnder Translation select character set UTF-8Apply settings and restart the PuTTY session&#x4F46;&#x6309;&#x7167;&#x8FD9;&#x6837;&#x505A;&#x5B8C;&#xFF0C;&#x5374;&#x5E76;&#x4E0D;&#x8D77;&#x6548;&#x679C;&#x3002;&#x540E;&#x6765;&#x53D1;&#x73B0;&#x5728;Linux&#x672C;&#x673A;&#x7684;&#x56FE;&#x5F62;&#x754C;&#x9762;&#x4E0B;&#x7528;Terminal&#x5F00;Vim&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x60C5;&#x51B5;&#x3002; &#x5728;&#x7EC8;&#x7AEF;&#x7684;profile&#x4E2D;&#x914D;&#x7F6E;&#x5B57;&#x4F53;&#x8FD8;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x6CA1;&#x6709;&#x6548;&#x679C;&#x3002; &#x7136;&#x540E;&#x627E;&#x5230;Powerline&#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x2014;&#x2014;PowerlineMove the patched font to a valid X font path. Valid font paths can be listed with xset q:mv &apos;SomeFont for Powerline.otf&apos; ~/.fonts/Update font cache for the path the font was moved to (root priveleges may be needed for updating font cache for some paths):fc-cache -vf ~/.fonts/&#x9887;&#x53D7;&#x542F;&#x53D1;&#x3002; &#x7ECF;&#x8FC7;&#x5206;&#x6790;&#xFF0C;&#x5F97;&#x51FA;&#x539F;&#x56E0;&#x662F;&#xFF1A;Linux&#x7684;&#x684C;&#x9762;&#x7CFB;&#x7EDF;&#x5206;&#x4E3A;GNome&#xFF0C;KDE&#x7B49;&#x7B49;&#x3002;&#x4E0D;&#x540C; &#x7684;&#x684C;&#x9762;&#x7CFB;&#x7EDF;&#x6240;&#x91C7;&#x7528;&#x7684;&#x5B57;&#x4F53;&#x76EE;&#x5F55;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x91C7;&#x7528;&#x7684;&#x5B57;&#x4F53;&#x76EE;&#x5F55;&#x5728;[benzhou@plslx111 phx]$ xset q|grep font catalogue:/etc/X11/fontpath.d,built-ins&#x4E0D;&#x540C;&#x7684;&#x684C;&#x9762;&#x73AF;&#x5883;&#x4E5F;&#x5BF9;&#x5E94;&#x4E0D;&#x540C;&#x7684;&#x7EC8;&#x7AEF;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;KDE&#x4E0B;&#x7684;Konsole&#x3002;&#x4FEE;&#x6539;install.sh&#xFF0C;&#x5C06;&#x5B57;&#x4F53;&#x5B89;&#x88C5;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x5B57;&#x4F53;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5E76;&#x5237;&#x65B0;&#x5B57;&#x4F53;&#x7F13;&#x5B58;&#x914D;&#x7F6E;&#x597D;Konsoleputty&#x4E0B;&#x9762;&#x4E00;&#x5207;&#x5B8C;&#x7F8E;Update - 20170606 Linux&#x4E0A;&#x7684;&#x5B57;&#x4F53;&#x5B89;&#x88C5;&#x59CB;&#x7EC8;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x5728;Terminal&#x91CC;&#x9762;&#x65E0;&#x6CD5;&#x627E;&#x5230;powerline&#x5B57;&#x4F53;&#x3002; &#x6700;&#x540E;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x662F;&#xFF0C;&#x5B57;&#x4F53;&#x5B89;&#x88C5;&#x76EE;&#x5F55;&#x5728;/usr/share/fonts&#x3002;&#x628A;~/.vim/bundles/fonts/install.sh&#x4E2D;&#x7684;font_dir&#x8BBE;&#x7F6E;&#x4E3A;&#x5BF9;&#x5E94;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x518D;&#x8FD0;&#x884C;&#x5C31;OK&#x4E86;&#x5B57;&#x4F53;&#x95EE;&#x9898;Windows&#x4E0B;&#x4F7F;&#x7528;Courier New&#x5B57;&#x4F53;&#x611F;&#x89C9;&#x602A;&#x602A;&#x7684;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x8BBE;&#x7F6E;&#x4E86;let g:spf13_no_big_font&#xFF0C;&#x4F46;&#x56E0;&#x4E3A;&#x540E;&#x9762;&#x91C7;&#x7528;&#x4E86;Source Code Pro for Powerline&#x5B57;&#x4F53;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x8FD8;&#x662F;&#x4FDD;&#x6301;1&#x3002;neocomplete&#x4E0D;&#x652F;&#x6301;&#x88C5;&#x5B8C;spf13&#x5E76;&#x6CA1;&#x6709;&#x6DF1;&#x7A76;&#x6BCF;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x5076;&#x5C14;&#x770B;&#x5230;&#x5BF9;neocomplete&#x7684;&#x63A8;&#x8350;&#xFF0C;&#x6240;&#x4EE5;&#x60F3;&#x8BD5;&#x4E00;&#x8BD5;&#x3002;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x8F93;&#x5165;:NeoCompleteEnable&#xFF0C;&#x53D1;&#x73B0;&#x7ADF;&#x7136;&#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x539F;&#x6765;neocomplete&#x9700;&#x8981;Vim&#x5BF9;lua&#x7684;&#x652F;&#x6301;&#x3002;&#x6709;&#x4E24;&#x6761;&#x8DEF;&#x53EF;&#x4EE5;&#x8D70;&#xFF1A;&#x5B89;&#x88C5;vim-nox/vim-athena/vim-gtk/vim-gnome&#x5176;&#x4E2D;&#x4E4B;&#x4E00;&#x81EA;&#x884C;&#x7F16;&#x8BD1;Vim&#xFF0C;&#x5E76;&#x4F7F;&#x80FD;lua&#x652F;&#x6301; &#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x53D1;&#x884C;&#x7248;&#x8FC7;&#x4E8E;&#x9648;&#x65E7;&#xFF0C;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x56DB;&#x4E2A;&#x5305;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x8D70;&#x7B2C;&#x4E8C;&#x6761;&#x8DEF;&#x4E86;&#x3002; &#x547D;&#x4EE4;&#x53EA;&#x6709;&#x4E24;&#x6761;&#xFF1A;[benzhou@plslx111 vim]$ ./configure --enable-rubyinterp \ --enable-pythoninterp \ --with-python-config-dir=/usr/bin/python2.6-config \ # &#x8FD9;&#x4E00;&#x884C;python&#x7684;&#x914D;&#x7F6E;&#x4E5F;&#x8981;&#x5BF9; --enable-perlinterp \ --enable-gui=gtk2 \ --enable-cscope \ --prefix=/usr/local \ --enable-luainterp \ # &#x4E0B;&#x9762;&#x4E24;&#x884C;&#x6700;&#x91CD;&#x8981; --with-lua-prefix=/usr/bn #[benzhou@plslx111 vim]$ make&#x7F16;&#x8BD1;Vim&#xFF0C;&#x5728;configure&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x627E;&#x4E0D;&#x5230;lua&#x7684;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x641C;&#x7D22;&#x4E00;&#x756A;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x6CA1;&#x6709;&#x5B89;&#x88C5;lua-devel&#x7684;&#x5305;&#xFF0C;&#x4E8E;&#x662F;&#x5728;&#x7F51;&#x4E0A;&#x627E;&#x4E86;&#x4E00;&#x4E2A;Fedora&#x7684;RPM&#x5305;&#xFF0C;&#x8FD0;&#x884C;rpm -i&#x5B89;&#x88C5;&#xFF0C;&#x518D;configure&#x5C31;&#x6210;&#x4E86;&#x3002; &#x6253;&#x5F00;Vim&#x547D;&#x4EE4;&#x884C;&#xFF0C;&#x8FD0;&#x884C;echo has(&quot;lua&quot;)&#xFF0C;&#x7ED3;&#x679C;&#x662F;1&#xFF0C;&#x5C31;&#x5927;&#x529F;&#x544A;&#x6210;&#x4E86;&#x3002;Error 523&#x5728;&#x5199;Vim&#x811A;&#x672C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x51FD;&#x6570;&#x51FA;&#x73B0;&#x4E86;E523: Not allowed here&#x3002;&#x6700;&#x540E;&#x67E5;&#x660E;&#x539F;&#x56E0;&#x662F;&#x5728;&#x88AB;map&#x7684;&#x547D;&#x4EE4;&#x4E2D;&#x4E0D;&#x80FD;&#x8C03;&#x7528;execute&#x548C;normal&#x51FD;&#x6570;&#xFF0C;&#x636E;&#x8BF4;&#x662F;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#x3002;&#x8BE6;&#x60C5;&#x67E5;&#x770B;:help e523&#x3002;&#x4E0B;&#x9762;&#x662F;&#x9519;&#x8BEF;&#x7684;.vimrc&#x4EE3;&#x7801;function CscopeFind() execute &quot;cscope add cscope.out&quot;endfunctionnmap &lt;space&gt;s :&lt;C-R&gt;=CscopeFind()&lt;CR&gt;cscope find s &lt;C-R&gt;=expand(&apos;&lt;cword&gt;&apos;)&lt;CR&gt;if &#x5224;&#x65AD;&#x5B57;&#x7B26;&#x4E32;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5751;&#xFF0C;&#x548C;Python&#x7B49;&#x4E3B;&#x6D41;&#x8BED;&#x8A00;&#x4E0D;&#x540C;&#xFF0C;Vim&#x811A;&#x672C;&#x91CC;&#xFF0C;if&#x540E;&#x9762;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x4F1A;&#x88AB;&#x5F3A;&#x5236;&#x8F6C;&#x6362;&#x6210;bool&#x53D8;&#x91CF;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x3002;&#x800C;&#x5B57;&#x7B26;&#x4E32;&#x5BF9;&#x5E94;&#x7684;bool&#x503C;&#x4E3A;0&#x3002;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x7684;echo&#x8BED;&#x53E5;&#x6C38;&#x8FDC;&#x4E5F;&#x6267;&#x884C;&#x4E0D;&#x5230;&#x3002;if (glob(&apos;/existing/file&apos;)) echo (&apos;yes&apos;)endif&#x6B63;&#x786E;&#x7684;&#x5199;&#x6CD5;&#x5E94;&#x5F53;&#x662F;if (!empty(glob(&apos;...&apos;))...endif&#x63D2;&#x4EF6;ctrlP&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#xFF0C;cscope find f&#x5C31;&#x6CA1;&#x5565;&#x5927;&#x7528;&#x4E86;&#x3002;&#x770B;&#x5B98;&#x7F51;&#x7684;&#x57FA;&#x672C;&#x7528;&#x6CD5;&#xFF1A;Press &lt;F5&gt; to purge the cache for the current directory to get new files, remove deleted files and apply new ignore options.Press &lt;c-f&gt; and &lt;c-b&gt; to cycle between modes. (Ben: &#x5728;&#x641C;&#x7D22;&#x6587;&#x4EF6;&#xFF0C;buffer&#xFF0C; funky&#x4E4B;&#x95F4;&#x5FAA;&#x73AF;&#x8DF3;&#x8F6C;)Press &lt;c-d&gt; to switch to filename only search instead of full path. (Ben: &#x8FD9;&#x4E2A;&#x5BF9;&#x4E8E;&#x6211;&#x6BD4;&#x8F83;&#x6709;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x8DEF;&#x5F84;&#x592A;&#x957F;)Press &lt;c-r&gt; to switch to regexp mode.Use &lt;c-j&gt;, &lt;c-k&gt; or the arrow keys to navigate the result list.Use &lt;c-t&gt; or &lt;c-v&gt;, &lt;c-x&gt; to open the selected entry in a new tab or in a new split.Use &lt;c-n&gt;, &lt;c-p&gt; to select the next/previous string in the prompt&#x2019;s history.Use &lt;c-y&gt; to create a new file and its parent directories.Use &lt;c-z&gt; to mark/unmark multiple files and to open them.&#x76EE;&#x524D;&#x6211;&#x7684;&#x914D;&#x7F6E;&lt;leader&gt;-f: &#x6A21;&#x7CCA;&#x641C;&#x7D22;&#x6700;&#x8FD1;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;(MRU)&lt;leader&gt;-p: &#x6A21;&#x7CCA;&#x641C;&#x7D22;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x53CA;&#x5176;&#x5B50;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&lt;leader&gt;fu: &#x8FDB;&#x5165;&#x5F53;&#x524D;&#x6587;&#x4EF6;&#x7684;&#x51FD;&#x6570;&#x5217;&#x8868;&#x641C;&#x7D22;&lt;leader&gt;fU: &#x641C;&#x7D22;&#x5F53;&#x524D;&#x5149;&#x6807;&#x4E0B;&#x5355;&#x8BCD;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;neocompleteomni-complete&#x8FD9;&#x662F;&#x5728;Vim 7.0&#x5F15;&#x5165;&#x7684;&#x81EA;&#x52A8;&#x8865;&#x5168;&#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E;&#x4EFB;&#x4F55;&#x63D2;&#x4EF6;&#x3002;&#x5728;&#x6CA1;&#x6709;neocomplete&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6BD4;&#x5982;Windows&#x4E0B;&#x88C5;neocomplete&#x548C;ycm&#x90FD;&#x5F88;&#x9EBB;&#x70E6;&#xFF0C;&#x5C31;&#x53EA;&#x80FD;&#x7528;&#x539F;&#x751F;&#x7684;&#x8865;&#x5168;&#x3002;&#x5176;&#x5B9E;&#x4E5F;&#x591F;&#x7528;&#x4E86;&#xFF0C;&#x53EA;&#x662F;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x65B9;&#x4FBF;&#x3002; &#x6240;&#x6709;&#x5E2E;&#x52A9;&#x547D;&#x4EE4;&#x5165;&#x53E3;&#xFF1A;:help ins-completion :help compl-omni :help &#x2018;omnifunc&#x2019; :help i_CTRL-X_CTRL-O :help ins-completion-menu :help popupmenu-keys :help &#x2018;completeopt&#x2019; :help compl-omni-filetypes :help omnicppcomplete.txt &#x770B;spf13&#x7684;.vimrc&#x4E2D;&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x53E5;&#xFF1A;Automatically open and close the popup menu / preview window &#x672C;&#x6765;&#x4EE5;&#x4E3A;omni-complete&#x4F1A;&#x50CF;neocomplete&#x4E00;&#x6837;&#x81EA;&#x52A8;&#x5F39;&#x51FA;&#x4E0B;&#x62C9;&#x83DC;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x7ECF;&#x8FC7;&#x4E00;&#x756A;Google&#x548C;help&#x7814;&#x8BFB;&#x3002;&#x8FD9;&#x4E2A;&#x7406;&#x89E3;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x3002;&lt;C-N&gt;/&lt;C-P&gt; &#x8FD9;&#x5C31;&#x4E0D;&#x63D0;&#x4E86;&#xFF0C;&#x6700;&#x57FA;&#x672C;&#x7684;&#x529F;&#x80FD;&#xFF0C;N=next&#xFF0C;P=previous&lt;CTRL-K&gt; &#x5B57;&#x5178;&#x8865;&#x5168;&#xFF0C;&#x67E5;&#x8BE2;dictionary&#x53C2;&#x6570;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x8FDB;&#x884C;&#x8865;&#x5168;&lt;CTRL-I&gt; &#x5F53;&#x524D;&#x6587;&#x4EF6;&#x548C;&#x5305;&#x542B;&#x6587;&#x4EF6;&#x8865;&#x5168;&#xFF0C;I=include&lt;CTRL-]&gt; tag&#x8865;&#x5168;&lt;CTRL-F&gt; &#x6587;&#x4EF6;&#x540D;&#x8865;&#x5168;&lt;CTRL-D&gt; &#x5B8F;&#x8865;&#x5168;&lt;CTRL-V&gt; Vim&#x547D;&#x4EE4;&#x8865;&#x5168;&#xFF0C;V=Vim&lt;CTRL-U&gt; User defined&#x8865;&#x5168;&#xFF0C;U=User&#xFF0C;&#x8865;&#x5168;&#x51FD;&#x6570;&#x901A;&#x8FC7;set completefunc=xxx&#x4F20;&#x5165;&lt;CTRL-O&gt; omni&#x8865;&#x5168;&#xFF0C;O=Omni&#xFF0C;&#x8865;&#x5168;&#x51FD;&#x6570;&#x901A;&#x8FC7;set omnifunc=xxx&#x4F20;&#x5165;&#xFF0C;&#x8FD9;&#x4E2A;Vim&#x81EA;&#x5E26;&#x7684;&#x811A;&#x672C;&#x90FD;&#x5DF2;&#x5199;&#x597D;&#xFF0C;spf13&#x7684;vimrc&#x4E5F;&#x6709;&#x53C2;&#x8003;&#x8BBE;&#x7F6E;&#x4E86;UltiSnips&#x5728;&#x6298;&#x817E;&#x534A;&#x5929;snipMate&#x65E0;&#x679C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8F6C;&#x6295;UltiSnips&#x3002;&#x8BED;&#x6CD5;&#x590D;&#x6742;&#x5EA6;&#x4EE5;&#x53CA;&#x7075;&#x6D3B;&#x6027;&#x8981;&#x5F3A;&#x4E8E;snipMate&#x3002;&#x6CE8;&#x610F;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#x5373;&#x53EF;UltiSnips&#x641C;&#x7D22;&#x6240;&#x6709;runtimepath&#x4E0B;&#x7684;UltiSnips&#x76EE;&#x5F55;&#x4E2D;&#x7684;.snippet&#x7ED3;&#x5C3E;&#x7684;&#x6587;&#x4EF6;UltiSnips&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x652F;&#x6301;snipMateUltiSnips&#x7528;&lt;tab&gt;&#x8865;&#x5168;&#xFF0C;&#x4E0E;omni-complete&#x51B2;&#x7A81;&#xFF0C;&#x4E0D;&#x8FC7;omni-complete&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x7528;&#x6CD5;&#x662F;&lt;C-N&gt;/&lt;C-P&gt;&#x6765;&#x5207;&#x6362;&#x9009;&#x9879;&#xFF0C;&#x4E5F;&#x51D1;&#x5408;&#x80FD;&#x7528;&#x4E86;%23Vim%u7EC8%u6781%u6298%u817E%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5Bvim%5D%0A%u672C%u7BC7%u4ECE%u8FD9%u91CC%u5F00%u59CB%0A%5B%u8DDF%u6211%u4E00%u8D77%u5B66%u4E60VIM%20-%20The%20Life%20Changing%20Editor%5D%28http%3A//ju.outofmemory.cn/entry/79671%29%0A%u7136%u540E%u5230%u8FD9%u91CC%u8FDB%u5165%u9AD8%u6F6E%0A%5Bspf13/spf13-vim%5D%28https%3A//github.com/spf13/spf13-vim%29%0A%u7B2C%u4E00%u7BC7%u770B%u4F3C%u662F%u4E00%u7BC7%u666E%u666E%u901A%u901A%u4ECB%u7ECDVim%u63D2%u4EF6%u7684%u535A%u5BA2%u6587%u3002%u4F46%u662F%u4ED6%u5728%u4ECB%u7ECD%u4E00%u4E9B%u9876%u7EA7%u63D2%u4EF6%u7684%u540C%u65F6%uFF0C%u5F15%u5165%u4E86spf13%u8FD9%u4E2AGitHub%u4E0A%u7684%u5F00%u6E90%u9879%u76EE%u3002%u8FD9%u5176%u5B9E%u5C31%u662F%u4E00%u4E2A%u5F88%u5168%u7684vimrc%u914D%u7F6E%u3002%u73A9%u5BB6%u53EF%u4EE5%u6839%u636E%u81EA%u5DF1%u7684%u9700%u6C42%u8FDB%u884C%u5B9A%u5236%u3002%u8FD9%u4E00%u4E0B%u6253%u5F00%u4E86%u6F58%u591A%u62C9%u9B54%u76D2%uFF0C%u672C%u6765%u6015%u9EBB%u70E6%u6298%u817E%u7684%u6211%uFF0C%u4E00%u4E0B%u5C31%u5165%u5751%u4E86%u3002%0A%21%5BAlt%20text%5D%28./1490225064940.png%29%0A%u9488%u5BF9%u5404%u4E2A%u63D2%u4EF6%u7684%u914D%u7F6E%u90FD%u7528fold%u5904%u7406%u597D%u4E86%uFF0C%u4E00%u76EE%u4E86%u7136%u3002%u4F5C%u8005%u4E5F%u63D0%u4F9B%u597D%u4E86%u5B9A%u5236%u7684%u63A5%u53E3%0A%60%60%60%0A%22%20Use%20fork%20vimrc%20if%20available%20%7B%0A%20%20%20%20if%20filereadable%28expand%28%22%7E/.vimrc.fork%22%29%29%0A%20%20%20%20%20%20%20%20source%20%7E/.vimrc.fork%0A%20%20%20%20endif%0A%22%20%7D%0A%0A%22%20Use%20local%20vimrc%20if%20available%20%7B%0A%20%20%20%20if%20filereadable%28expand%28%22%7E/.vimrc.local%22%29%29%0A%20%20%20%20%20%20%20%20source%20%7E/.vimrc.local%0A%20%20%20%20endif%0A%22%20%7D%0A%0A%22%20Use%20local%20gvimrc%20if%20available%20and%20gui%20is%20running%20%7B%0A%20%20%20%20if%20has%28%27gui_running%27%29%0A%20%20%20%20%20%20%20%20if%20filereadable%28expand%28%22%7E/.gvimrc.local%22%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20source%20%7E/.gvimrc.local%0A%20%20%20%20%20%20%20%20endif%0A%20%20%20%20endif%0A%22%20%7D%0A%60%60%60%0A-%20.vimrc.before%20-%20spf13-vim%20before%20configuration%0A-%20.vimrc.before.fork%20-%20fork%20before%20configuration%0A-%20.vimrc.before.local%20-%20before%20user%20configuration%0A-%20.vimrc.bundles%20-%20spf13-vim%20bundle%20configuration%0A-%20.vimrc.bundles.fork%20-%20fork%20bundle%20configuration%0A-%20.vimrc.bundles.local%20-%20local%20user%20bundle%20configuration%0A-%20.vimrc%20-%20spf13-vim%20vim%20configuration%0A-%20.vimrc.fork%20-%20fork%20vim%20configuration%0A-%20.vimrc.local%20-%20local%20user%20configuration%0A%0A%u4F4E%u7AEF%u73A9%u5BB6%u53EF%u4EE5%u7528.vimrc.*.local%u6765%u505A%u672C%u5730%u5316%u5B9A%u5236%uFF0C%u9AD8%u7AEF%u73A9%u5BB6%u53EF%u4EE5fork%20repo%uFF0C%u7136%u540E%u6DFB%u52A0%u81EA%u5DF1%u7684.vimrc.%5C*.fork%u505A%u5B9A%u5236%uFF0C%u7136%u540Ecommit%uFF0C%u7136%u540E%u6240%u6709%u4F60%u7684Vim%u73AF%u5883%u5C31%u90FD%u53EF%u4EE5%u7528%u5230%u8FD9%u4E00%u4EFD%u914D%u7F6E%u4E86%u3002%0A%u5B8C%u5DE5%u540E%u7684Vim%u770B%u8D77%u6765%u8FD9%u6837%0A%21%5BAlt%20text%5D%28./1490225459173.png%29%0A%0A%23%23%20%u95EE%u9898%0A%23%23%23powerline%20fonts%0A%23%23%23%23Windows%0A%u8981%u5B8C%u6210%u8FD9%u6837%u7684%u6548%u679C%uFF0C%u6700%u7EA0%u7ED3%u7684%u5C31%u662Fpowerline%u7684%u5B57%u4F53%u3002%u5982%u679C%u5B57%u4F53%u4E0D%u6B63%u786E%uFF0C%u662F%u6CA1%u6CD5%u51FA%u73B0%u8FD9%u6837%u7684%u5C0F%u5C16%u89D2%u6837%u5F0F%u7684%u3002%0A%21%5BAlt%20text%5D%28./1490235175286.png%29%0A%u5B9E%u73B0%u8FD9%u4E2A%u6837%u5F0F%u7684%u63D2%u4EF6%u662F%60vim-airline%60%u3002%u5B83%u4F9D%u8D56%u4E8Epowerline%20fonts%u3002%u5728Windows%u4E0B%u8FD8%u662F%u6BD4%u8F83%u597D%u89E3%u51B3%u7684%u3002spf13%u5DF2%u7ECF%u5E2E%u6211%u4EEC%u88C5%u597D%u4E86powerline-fonts%u3002%0A%60%60%60%0A%22%20.vimrc.bundles%0ABundle%20%27powerline/fonts%27%0A%60%60%60%0A%u6240%u6709%u7684%u5B57%u4F53%u6587%u4EF6%u90FD%u88AB%u5B89%u88C5%u5230%60%24HOME%5C.vim%5Cbundle%5Cfonts%5C%60%u3002%u7136%u540E%u6211%u4EEC%u518D%u8C03%u7528%u5176%u4E2D%u7684power%20script%u811A%u672C%60install.ps1%60%uFF0C%u5C31%u4F1A%u5B89%u88C5%u5230%u7CFB%u7EDF%u5B57%u4F53%u76EE%u5F55%u3002%u7136%u540E%u5728Vim%u4E2D%u9009%u62E9%u5BF9%u5E94%u7684%u5B57%u4F53%u5C31%u597D%u4E86%u3002%0A%23%23%23%23Linux%0A%u5728Linux%uFF0C%u5C24%u5176%u662F%u901A%u8FC7putty%u8BBF%u95EELinux%u7684%u65F6%u5019%u5C31%u6CA1%u8FD9%u4E48%u7B80%u5355%u4E86%u3002%u56E0%u4E3A%u6211%u5168%u662F%u7528putty%20ssh%u8BBF%u95EELinux%uFF0C%u6240%u4EE5%u4E00%u5F00%u59CB%u4EE5%u4E3A%u662Fputty%u7684%u95EE%u9898%uFF0C%u7F51%u4E0A%u641C%u51FA%u6765%u4E00%u5806%uFF0C%u90FD%u662F%u8FD9%u6837%u7684%u89E3%u91CA%u3002%0A%3E1.%20Download%20the%20patched%20fonts.%20I%20chose%20DejaVuSansMono%20as%20my%20font%20since%20I%20like%20it%20most.%0A%3E2.%20Install%20this%20font%20in%20Windows%20to%20make%20it%20accessible%20for%20all%20programs.%0A%3E3.%20Open%20PuTTY%20and%20make%20changes%20to%20the%20settings%3A%0A%3E4.%20Under%20appearance%20select%20the%20patched%20font%0A%3E5.%20Select%20font%20quality%20Clear%20Type%0A%3E6.%20Under%20Translation%20select%20character%20set%20UTF-8%0A%3E7.%20Apply%20settings%20and%20restart%20the%20PuTTY%20session%0A%0A%u4F46%u6309%u7167%u8FD9%u6837%u505A%u5B8C%uFF0C%u5374%u5E76%u4E0D%u8D77%u6548%u679C%u3002%u540E%u6765%u53D1%u73B0%u5728Linux%u672C%u673A%u7684%u56FE%u5F62%u754C%u9762%u4E0B%u7528Terminal%u5F00Vim%u4E5F%u662F%u4E00%u6837%u7684%u60C5%u51B5%u3002%0A%u5728%u7EC8%u7AEF%u7684profile%u4E2D%u914D%u7F6E%u5B57%u4F53%u8FD8%u662F%u4E00%u6837%uFF0C%u6CA1%u6709%u6548%u679C%u3002%0A%u7136%u540E%u627E%u5230Powerline%u7684%u5B98%u65B9%u6587%u6863%u2014%u2014%5BPowerline%5D%28http%3A//powerline.readthedocs.io/en/master/installation/linux.html%23fonts-installation%29%0A%3E%201.%20Move%20the%20patched%20font%20to%20a%20valid%20X%20font%20path.%20Valid%20font%20paths%20can%20be%20listed%20with%20%60xset%20q%60%3A%0A%3E%0A%09%60mv%20%27SomeFont%20for%20Powerline.otf%27%20%7E/.fonts/%60%0A%09%0A%3E%202.%20Update%20font%20cache%20for%20the%20path%20the%20font%20was%20moved%20to%20%28root%20priveleges%20may%20be%20needed%20for%20updating%20font%20cache%20for%20some%20paths%29%3A%0A%3E%0A%09%60fc-cache%20-vf%20%7E/.fonts/%60%0A%09%0A%u9887%u53D7%u542F%u53D1%u3002%0A%u7ECF%u8FC7%u5206%u6790%uFF0C%u5F97%u51FA%u539F%u56E0%u662F%uFF1A%0A1.%20Linux%u7684%u684C%u9762%u7CFB%u7EDF%u5206%u4E3AGNome%uFF0CKDE%u7B49%u7B49%u3002%u4E0D%u540C%20%u7684%u684C%u9762%u7CFB%u7EDF%u6240%u91C7%u7528%u7684%u5B57%u4F53%u76EE%u5F55%u662F%u4E0D%u540C%u7684%u3002%u6211%u4EEC%u76EE%u524D%u91C7%u7528%u7684%u5B57%u4F53%u76EE%u5F55%u5728%0A%60%60%60bash%0A%5Bbenzhou@plslx111%20phx%5D%24%20xset%20q%7Cgrep%20font%0A%20%20catalogue%3A/etc/X11/fontpath.d%2Cbuilt-ins%0A%60%60%60%0A2.%20%u4E0D%u540C%u7684%u684C%u9762%u73AF%u5883%u4E5F%u5BF9%u5E94%u4E0D%u540C%u7684%u7EC8%u7AEF%uFF0C%u6BD4%u5982%u6211%u4EEC%u76EE%u524D%u4F7F%u7528%u7684%u5C31%u662FKDE%u4E0B%u7684Konsole%u3002%0A3.%20%u4FEE%u6539install.sh%uFF0C%u5C06%u5B57%u4F53%u5B89%u88C5%u5230%u5BF9%u5E94%u7684%u5B57%u4F53%u76EE%u5F55%u4E0B%uFF0C%u5E76%u5237%u65B0%u5B57%u4F53%u7F13%u5B58%0A4.%20%u914D%u7F6E%u597DKonsole%0A5.%20putty%u4E0B%u9762%u4E00%u5207%u5B8C%u7F8E%0A%0A%3E%20Update%20-%2020170606%0A%3E%20Linux%u4E0A%u7684%u5B57%u4F53%u5B89%u88C5%u59CB%u7EC8%u4E0D%u6210%u529F%uFF0C%u5728Terminal%u91CC%u9762%u65E0%u6CD5%u627E%u5230powerline%u5B57%u4F53%u3002%0A%3E%20%u6700%u540E%u7684%u89E3%u51B3%u529E%u6CD5%u662F%uFF0C%u5B57%u4F53%u5B89%u88C5%u76EE%u5F55%u5728/usr/share/fonts%u3002%u628A%7E/.vim/bundles/fonts/install.sh%u4E2D%u7684font_dir%u8BBE%u7F6E%u4E3A%u5BF9%u5E94%u7684%u8DEF%u5F84%uFF0C%u518D%u8FD0%u884C%u5C31OK%u4E86%0A%0A%23%23%23%u5B57%u4F53%u95EE%u9898%0AWindows%u4E0B%u4F7F%u7528Courier%20New%u5B57%u4F53%u611F%u89C9%u602A%u602A%u7684%uFF0C%u539F%u56E0%u662F%u8BBE%u7F6E%u4E86%60let%20g%3Aspf13_no_big_font%60%uFF0C%u4F46%u56E0%u4E3A%u540E%u9762%u91C7%u7528%u4E86Source%20Code%20Pro%20for%20Powerline%u5B57%u4F53%uFF0C%u6240%u4EE5%u5C31%u8FD8%u662F%u4FDD%u63011%u3002%0A%0A%23%23%23neocomplete%u4E0D%u652F%u6301%0A%u88C5%u5B8Cspf13%u5E76%u6CA1%u6709%u6DF1%u7A76%u6BCF%u4E00%u4E2A%u63D2%u4EF6%u7684%u7528%u6CD5%uFF0C%u5076%u5C14%u770B%u5230%u5BF9neocomplete%u7684%u63A8%u8350%uFF0C%u6240%u4EE5%u60F3%u8BD5%u4E00%u8BD5%u3002%u5728%u547D%u4EE4%u884C%u4E2D%u8F93%u5165%3ANeoCompleteEnable%uFF0C%u53D1%u73B0%u7ADF%u7136%u4E0D%u652F%u6301%uFF0C%u539F%u6765neocomplete%u9700%u8981Vim%u5BF9lua%u7684%u652F%u6301%u3002%u6709%u4E24%u6761%u8DEF%u53EF%u4EE5%u8D70%uFF1A%0A1.%20%u5B89%u88C5vim-nox/vim-athena/vim-gtk/vim-gnome%u5176%u4E2D%u4E4B%u4E00%0A2.%20%u81EA%u884C%u7F16%u8BD1Vim%uFF0C%u5E76%u4F7F%u80FDlua%u652F%u6301%0A%u56E0%u4E3A%u6211%u4EEC%u4F7F%u7528%u7684%u53D1%u884C%u7248%u8FC7%u4E8E%u9648%u65E7%uFF0C%u4E0A%u9762%u63D0%u5230%u7684%u56DB%u4E2A%u5305%u90FD%u6CA1%u6709%uFF0C%u6240%u4EE5%u53EA%u80FD%u8D70%u7B2C%u4E8C%u6761%u8DEF%u4E86%u3002%0A%u547D%u4EE4%u53EA%u6709%u4E24%u6761%uFF1A%0A%60%60%60bash%0A%5Bbenzhou@plslx111%20vim%5D%24%20./configure%20%20--enable-rubyinterp%20%5C%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--enable-pythoninterp%20%5C%20%20%20%20%20%20%20%20%20%20%20%20%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--with-python-config-dir%3D/usr/bin/python2.6-config%20%5C%20%23%20%u8FD9%u4E00%u884Cpython%u7684%u914D%u7F6E%u4E5F%u8981%u5BF9%20%20%20%20%20%20%20%20%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--enable-perlinterp%20%5C%20%20%20%20%20%20%20%20%20%20%20%20%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--enable-gui%3Dgtk2%20%5C%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--enable-cscope%20%5C%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--prefix%3D/usr/local%20%5C%20%20%20%20%20%20%20%20%20%20%20%20%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--enable-luainterp%20%5C%20%20%20%20%20%20%20%20%20%20%23%20%u4E0B%u9762%u4E24%u884C%u6700%u91CD%u8981%20%0A%09%09%09%09%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20--with-lua-prefix%3D/usr/bn%20%20%20%20%20%23%0A%5Bbenzhou@plslx111%20vim%5D%24%20make%0A%60%60%60%0A%u7F16%u8BD1Vim%uFF0C%u5728configure%u7684%u65F6%u5019%uFF0C%u53D1%u73B0%u627E%u4E0D%u5230lua%u7684%u5934%u6587%u4EF6%uFF0C%u641C%u7D22%u4E00%u756A%uFF0C%u539F%u56E0%u662F%u6CA1%u6709%u5B89%u88C5lua-devel%u7684%u5305%uFF0C%u4E8E%u662F%u5728%u7F51%u4E0A%u627E%u4E86%u4E00%u4E2AFedora%u7684RPM%u5305%uFF0C%u8FD0%u884Crpm%20-i%u5B89%u88C5%uFF0C%u518Dconfigure%u5C31%u6210%u4E86%u3002%0A%u6253%u5F00Vim%u547D%u4EE4%u884C%uFF0C%u8FD0%u884C%60echo%20has%28%22lua%22%29%60%uFF0C%u7ED3%u679C%u662F1%uFF0C%u5C31%u5927%u529F%u544A%u6210%u4E86%u3002%0A%0A%23%23%23Error%20523%0A%u5728%u5199Vim%u811A%u672C%u7684%u65F6%u5019%uFF0C%u4E00%u4E2A%u5F88%u7B80%u5355%u7684%u51FD%u6570%u51FA%u73B0%u4E86%60E523%3A%20Not%20allowed%20here%60%u3002%u6700%u540E%u67E5%u660E%u539F%u56E0%u662F%u5728%u88ABmap%u7684%u547D%u4EE4%u4E2D%u4E0D%u80FD%u8C03%u7528execute%u548Cnormal%u51FD%u6570%uFF0C%u636E%u8BF4%u662F%u4E3A%u4E86%u5B89%u5168%u3002%u8BE6%u60C5%u67E5%u770B%60%3Ahelp%20e523%60%u3002%u4E0B%u9762%u662F%u9519%u8BEF%u7684.vimrc%u4EE3%u7801%0A%60%60%60%0Afunction%20CscopeFind%28%29%0A%09execute%20%22cscope%20add%20cscope.out%22%0Aendfunction%0A%0Anmap%20%3Cspace%3Es%20%3A%3CC-R%3E%3DCscopeFind%28%29%3CCR%3Ecscope%20find%20s%20%3CC-R%3E%3Dexpand%28%27%3Ccword%3E%27%29%3CCR%3E%0A%60%60%60%0A%0A%23%23%23if%20%u5224%u65AD%u5B57%u7B26%u4E32%0A%u8FD9%u662F%u4E00%u4E2A%u5751%uFF0C%u548CPython%u7B49%u4E3B%u6D41%u8BED%u8A00%u4E0D%u540C%uFF0CVim%u811A%u672C%u91CC%uFF0Cif%u540E%u9762%u7684%u5B57%u7B26%u4E32%u4F1A%u88AB%u5F3A%u5236%u8F6C%u6362%u6210bool%u53D8%u91CF%uFF0C%u518D%u8FDB%u884C%u5224%u65AD%u3002%u800C%u5B57%u7B26%u4E32%u5BF9%u5E94%u7684bool%u503C%u4E3A0%u3002%u6240%u4EE5%u4E0B%u9762%u7684echo%u8BED%u53E5%u6C38%u8FDC%u4E5F%u6267%u884C%u4E0D%u5230%u3002%0A%60%60%60vim%0Aif%20%28glob%28%27/existing/file%27%29%29%0A%09echo%20%28%27yes%27%29%0Aendif%0A%60%60%60%0A%u6B63%u786E%u7684%u5199%u6CD5%u5E94%u5F53%u662F%0A%60%60%60vim%0Aif%20%28%21empty%28glob%28%27...%27%29%29%0A...%0Aendif%0A%60%60%60%0A%23%23%20%u63D2%u4EF6%0A%23%23%23ctrlP%0A%u6709%u4E86%u8FD9%u4E2A%u63D2%u4EF6%uFF0C%60cscope%20find%20f%60%u5C31%u6CA1%u5565%u5927%u7528%u4E86%u3002%u770B%u5B98%u7F51%u7684%u57FA%u672C%u7528%u6CD5%uFF1A%0A%3E-%20Press%20%60%3CF5%3E%60%20to%20purge%20the%20cache%20for%20the%20current%20directory%20to%20get%20new%20files%2C%20remove%20deleted%20files%20and%20apply%20new%20ignore%20options.%0A%3E-%20Press%20%60%3Cc-f%3E%60%20and%20%60%3Cc-b%3E%60%20to%20cycle%20between%20modes.%20%28Ben%3A%20%u5728%u641C%u7D22%u6587%u4EF6%uFF0Cbuffer%uFF0C%20funky%u4E4B%u95F4%u5FAA%u73AF%u8DF3%u8F6C%29%0A%3E-%20Press%20%60%3Cc-d%3E%60%20to%20switch%20to%20filename%20only%20search%20instead%20of%20full%20path.%20%28Ben%3A%20%u8FD9%u4E2A%u5BF9%u4E8E%u6211%u6BD4%u8F83%u6709%u7528%uFF0C%u56E0%u4E3A%u6211%u4EEC%u7684%u8DEF%u5F84%u592A%u957F%29%0A%3E-%20Press%20%60%3Cc-r%3E%60%20to%20switch%20to%20regexp%20mode.%0A%3E-%20Use%20%60%3Cc-j%3E%60%2C%20%60%3Cc-k%3E%60%20or%20the%20arrow%20keys%20to%20navigate%20the%20result%20list.%0A%3E-%20Use%20%60%3Cc-t%3E%60%20or%20%60%3Cc-v%3E%60%2C%20%60%3Cc-x%3E%60%20to%20open%20the%20selected%20entry%20in%20a%20new%20tab%20or%20in%20a%20new%20split.%0A%3E-%20Use%20%60%3Cc-n%3E%60%2C%20%60%3Cc-p%3E%60%20to%20select%20the%20next/previous%20string%20in%20the%20prompt%27s%20history.%0A%3E-%20Use%20%60%3Cc-y%3E%60%20to%20create%20a%20new%20file%20and%20its%20parent%20directories.%0A%3E-%20Use%20%60%3Cc-z%3E%60%20to%20mark/unmark%20multiple%20files%20and%20%3Cc-o%3E%20to%20open%20them.%0A%0A%u76EE%u524D%u6211%u7684%u914D%u7F6E%0A-%20%26lt%3Bleader%26gt%3B-f%3A%20%u6A21%u7CCA%u641C%u7D22%u6700%u8FD1%u6253%u5F00%u7684%u6587%u4EF6%28MRU%29%0A-%20%26lt%3Bleader%26gt%3B-p%3A%20%u6A21%u7CCA%u641C%u7D22%u5F53%u524D%u76EE%u5F55%u53CA%u5176%u5B50%u76EE%u5F55%u4E0B%u7684%u6240%u6709%u6587%u4EF6%0A-%20%26lt%3Bleader%26gt%3Bfu%3A%20%u8FDB%u5165%u5F53%u524D%u6587%u4EF6%u7684%u51FD%u6570%u5217%u8868%u641C%u7D22%0A-%20%26lt%3Bleader%26gt%3BfU%3A%20%u641C%u7D22%u5F53%u524D%u5149%u6807%u4E0B%u5355%u8BCD%u5BF9%u5E94%u7684%u51FD%u6570%0A%0A%21%5BAlt%20text%5D%28http%3A//zuyunfei.com/images/ctrlp-vim-demo.gif%20%22Ctrlp%u6F14%u793A%22%29%0A%0A%23%23%23neocomplete%0A%0A%23%23%23omni-complete%0A%u8FD9%u662F%u5728Vim%207.0%u5F15%u5165%u7684%u81EA%u52A8%u8865%u5168%u529F%u80FD%uFF0C%u4E0D%u4F9D%u8D56%u4E8E%u4EFB%u4F55%u63D2%u4EF6%u3002%u5728%u6CA1%u6709neocomplete%u7684%u65F6%u5019%uFF0C%u6BD4%u5982Windows%u4E0B%u88C5neocomplete%u548Cycm%u90FD%u5F88%u9EBB%u70E6%uFF0C%u5C31%u53EA%u80FD%u7528%u539F%u751F%u7684%u8865%u5168%u3002%u5176%u5B9E%u4E5F%u591F%u7528%u4E86%uFF0C%u53EA%u662F%u6CA1%u6709%u90A3%u4E48%u65B9%u4FBF%u3002%0A%u6240%u6709%u5E2E%u52A9%u547D%u4EE4%u5165%u53E3%uFF1A%0A%3E%3Ahelp%20ins-completion%0A%3Ahelp%20compl-omni%0A%3Ahelp%20%27omnifunc%27%0A%3Ahelp%20i_CTRL-X_CTRL-O%0A%3Ahelp%20ins-completion-menu%0A%3Ahelp%20popupmenu-keys%0A%3Ahelp%20%27completeopt%27%0A%3Ahelp%20compl-omni-filetypes%0A%3Ahelp%20omnicppcomplete.txt%20%0A%0A%u770Bspf13%u7684.vimrc%u4E2D%u6709%u8FD9%u4E48%u4E00%u53E5%uFF1A%60Automatically%20open%20and%20close%20the%20popup%20menu%20/%20preview%20window%60%0A%u672C%u6765%u4EE5%u4E3Aomni-complete%u4F1A%u50CFneocomplete%u4E00%u6837%u81EA%u52A8%u5F39%u51FA%u4E0B%u62C9%u83DC%u5355%uFF0C%u4F46%u662F%u7ECF%u8FC7%u4E00%u756AGoogle%u548Chelp%u7814%u8BFB%u3002%u8FD9%u4E2A%u7406%u89E3%u662F%u9519%u8BEF%u7684%u3002%0A%21%5BAlt%20text%5D%28./1490863953557.png%29%0A%u6240%u6709%u7684%u4E1C%u897F%u5E76%u4E0D%u4F1A%u81EA%u52A8%u6253%u5F00%uFF0C%u9700%u8981%u7528%60%3CC-X%3E%3CC-O%3E%60%u6216%u8005%60%3CC-N%3E%60%u6216%u8005%60%3CC-P%3E%60%u3002%u5176%u5B9E%60%3CC-X%3E%60%u8FDB%u5165%u4E00%u4E2A%u63D2%u5165%u6A21%u5F0F%u7684%u5B50%u6A21%u5F0F%uFF0C%u7136%u540E%u518D%u6309%u5176%u4ED6%u7684%u7EC4%u5408%u952E%uFF0C%u53EF%u4EE5%u6709%u5BF9%u5E94%u7684%u529F%u80FD%uFF0C%u6458%u8981%u5982%u4E0B%0A*%20%60%3CC-N%3E/%3CC-P%3E%60%20%20%20%20%20%20%20%u8FD9%u5C31%u4E0D%u63D0%u4E86%uFF0C%u6700%u57FA%u672C%u7684%u529F%u80FD%uFF0CN%3Dnext%uFF0CP%3Dprevious%0A*%20%60%3CCTRL-K%3E%60%20%20%20%20%20%20%u5B57%u5178%u8865%u5168%uFF0C%u67E5%u8BE2dictionary%u53C2%u6570%u4E2D%u5BF9%u5E94%u7684%u6587%u4EF6%uFF0C%u8FDB%u884C%u8865%u5168%0A*%20%60%3CCTRL-I%3E%60%20%20%20%20%20%20%u5F53%u524D%u6587%u4EF6%u548C%u5305%u542B%u6587%u4EF6%u8865%u5168%uFF0CI%3Dinclude%0A*%20%60%3CCTRL-%5D%3E%60%20%20%20%20%20%20tag%u8865%u5168%0A*%20%60%3CCTRL-F%3E%60%20%20%20%20%20%20%u6587%u4EF6%u540D%u8865%u5168%0A*%20%60%3CCTRL-D%3E%60%20%20%20%20%20%20%u5B8F%u8865%u5168%0A*%20%60%3CCTRL-V%3E%60%20%20%20%20%20%20Vim%u547D%u4EE4%u8865%u5168%uFF0CV%3DVim%0A*%20%60%3CCTRL-U%3E%60%20%20%20%20%20%20User%20defined%u8865%u5168%uFF0CU%3DUser%uFF0C%u8865%u5168%u51FD%u6570%u901A%u8FC7%60set%20completefunc%3Dxxx%60%u4F20%u5165%0A*%20%60%3CCTRL-O%3E%60%20%20%20%20%20%20omni%u8865%u5168%uFF0CO%3DOmni%uFF0C%u8865%u5168%u51FD%u6570%u901A%u8FC7%60set%20omnifunc%3Dxxx%60%u4F20%u5165%uFF0C%u8FD9%u4E2AVim%u81EA%u5E26%u7684%u811A%u672C%u90FD%u5DF2%u5199%u597D%uFF0Cspf13%u7684vimrc%u4E5F%u6709%u53C2%u8003%u8BBE%u7F6E%u4E86%0A%0A%23%23%23UltiSnips%0A%u5728%u6298%u817E%u534A%u5929snipMate%u65E0%u679C%u7684%u60C5%u51B5%u4E0B%uFF0C%u8F6C%u6295UltiSnips%u3002%u8BED%u6CD5%u590D%u6742%u5EA6%u4EE5%u53CA%u7075%u6D3B%u6027%u8981%u5F3A%u4E8EsnipMate%u3002%u6CE8%u610F%u4EE5%u4E0B%u51E0%u70B9%u5373%u53EF%0A-%20UltiSnips%u641C%u7D22%u6240%u6709runtimepath%u4E0B%u7684UltiSnips%u76EE%u5F55%u4E2D%u7684.snippet%u7ED3%u5C3E%u7684%u6587%u4EF6%0A-%20UltiSnips%u901A%u8FC7%u4E00%u4E2A%u5168%u5C40%u53D8%u91CF%u51B3%u5B9A%u662F%u5426%u652F%u6301snipMate%0A-%20UltiSnips%u7528%60%3Ctab%3E%60%u8865%u5168%uFF0C%u4E0Eomni-complete%u51B2%u7A81%uFF0C%u4E0D%u8FC7omni-complete%u8FD8%u6709%u4E00%u79CD%u7528%u6CD5%u662F%60%3CC-N%3E%60/%60%3CC-P%3E%60%u6765%u5207%u6362%u9009%u9879%uFF0C%u4E5F%u51D1%u5408%u80FD%u7528%u4E86%0A%0A]]></content>
      <tags>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C面向对象]]></title>
    <url>%2F2017%2F03%2F16%2FC%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%2F</url>
    <content type="text"><![CDATA[Edit &#x66FE;&#x7ECF;&#x8C08;&#x5230;&#x9762;&#x76F8;&#x5BF9;&#x8C61;&#xFF0C;&#x5C31;&#x662F;C++&#xFF0C;&#x4E4B;&#x540E;&#x6700;&#x591A;&#x52A0;&#x4E0A;Java&#x3002;&#x540E;&#x6765;&#xFF0C;&#x8BFB;&#x8FC7;&#x7684;&#x4E66;&#x4E0A;&#x8BF4;&#xFF0C;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x5176;&#x5B9E;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x8BBE;&#x8BA1;&#x65B9;&#x5F0F;&#x2014;&#x2014;&#x4E07;&#x4E8B;&#x5373;&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x4E0D;&#x5728;&#x4E4E;&#x7528;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x8BED;&#x8A00;&#x3002;C&#x8BED;&#x8A00;&#xFF0C;&#x4E00;&#x6837;&#x4E5F;&#x53EF;&#x4EE5;&#x505A;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8BBE;&#x8BA1;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x8FD8;&#x66F4;&#x81EA;&#x7531;&#xFF0C;&#x6CA1;&#x6709;C++&#x7684;&#x5404;&#x79CD;&#x9690;&#x85CF;&#x7684;&#x5751;&#x3002;&#x8FD9;&#x7BC7;&#x7B14;&#x8BB0;&#x5C31;&#x5177;&#x4F53;&#x8BF4;&#x8BF4;&#x5982;&#x4F55;&#x7528;C&#x6765;&#x505A;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x3002; &#x5F00;&#x59CB;&#x4E4B;&#x524D;&#xFF0C;&#x7528;&#x4E00;&#x7BC7;&#x7F51;&#x4E0A;&#x6536;&#x5F55;&#x7684;&#x7B14;&#x8BB0;&#x4F5C;&#x4E3A;&#x5165;&#x95E8;&#xFF1A;&#x7528;C&#x8BED;&#x8A00;&#x5199;&#x9762;&#x5411;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x4E00;&#x79CD;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x4F53;&#x9A8C;&#x3002;C&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x5C01;&#x88C5;&#x6784;&#x9020;&#x51FD;&#x6570;&amp;&#x6790;&#x6784;&#x51FD;&#x6570;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x2014;&#x2014;private &amp; protectprivateprotect&#x7EE7;&#x627F;&#x591A;&#x6001;&#x4F8B;&#x5B50;&#x5C01;&#x88C5;&#x5BF9;&#x7C7B;&#x7ED3;&#x6784;&#x7684;&#x5C01;&#x88C5;&#xFF0C;C&#x91CC;&#x9762;&#x7528;struct,&#x76F8;&#x6BD4;C++&#x7F3A;&#x5C11;&#x7684;&#x5C31;&#x662F;&#xFF1A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x548C;&#x6790;&#x6784;&#x51FD;&#x6570;private &amp; protect/** Class definition of BaseLed. * The concrete LED class should inherit from this class. */typedef struct BaseLed{ uint8_t id; /** * Below 4 members are used to record the LED blinking state. */ LedState state; uint16_t onTime; uint16_t offTime; uint16_t blinkCount; /** * Public function members. */ bool (*init)(struct BaseLed*, uint8_t); //!&lt; Init hardware if needed void (*switchit)(struct BaseLed*, LedState); //!&lt; Turn on/off void (*set_brightness)(struct BaseLed*, uint8_t); //!&lt; Set LED&apos;s brightness level}BaseLed;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x4E0A;&#x534A;&#x90E8;&#x5206;&#x662F;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x4E0B;&#x534A;&#x90E8;&#x5206;&#x662F;&#x6210;&#x5458;&#x51FD;&#x6570;&#x3002;&#x6784;&#x9020;&#x51FD;&#x6570;&amp;&#x6790;&#x6784;&#x51FD;&#x6570;C++&#x4E2D;&#xFF0C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5728;&#x4EE5;&#x4E0B;&#x60C5;&#x51B5;&#x4E2D;&#x8C03;&#x7528;&#xFF1A;&#x6BD4;&#x5982;&#x4F60;&#x5728;main&#x91CC;&#x9762;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;A..&#x90A3;&#x4E48;~A()&#x4F1A;&#x5728;main&#x7ED3;&#x675F;&#x65F6;&#x8C03;&#x7528;&#x5982;&#x679C;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;f()&#x91CC;&#x9762;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;A &#x51FD;&#x6570;f&#x7ED3;&#x675F;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x8C03;&#x7528;~A()&#x6216;&#x8005;&#x4F60;delete &#x6307;&#x5411;A&#x7684;&#x6307;&#x9488;..&#x6216;&#x8005;&#x663E;&#x5F0F;&#x7684;&#x8C03;&#x7528;&#x6790;&#x6784;&#x51FD;&#x6570;C++&#x5404;&#x79CD;&#x9690;&#x85CF;&#x7684;&#x5751;&#xFF0C;&#x53C2;&#x8003;&#x7F51;&#x9875;&#x90A3;&#x4E9B;&#x88AB;C++&#x9ED8;&#x9ED8;&#x5730;&#x58F0;&#x660E;&#x548C;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x5728;C&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x91CC;&#x9762;&#xFF0C;&#x5C31;&#x6CA1;&#x6709;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;C&#x8BED;&#x8A00;&#x6839;&#x672C;&#x4E0D;&#x4F1A;&#x4E3A;&#x4F60;&#x751F;&#x6210;&#x9690;&#x85CF;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x5E2E;&#x4F60;&#x8C03;&#x7528;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x5206;&#x914D;&#x5185;&#x5B58;&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x865A;&#x51FD;&#x6570;&#x8868;(VTable)&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x5F97;&#x81EA;&#x5DF1;&#x4EB2;&#x529B;&#x4EB2;&#x4E3A;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x6837;&#x4E5F;&#x597D;&#xFF0C;&#x6240;&#x89C1;&#x5373;&#x6240;&#x5F97;&#x561B;&#x3002;// ClassA.htypedef struct _ClassA{ int a; void (*funcA)(struct _ClassA*, int);}ClassA;ClassA* newA(int);void deleteA(ClassA*)// ClassA.c#include &lt;ClassA.h&gt;void funcA(ClassA* thisObj, int a){}ClassA* newA(int a){ ClassA* Aobj = malloc(sizeof(ClassA)); Aobj-&gt;funcA = funcA; Aobj-&gt;a = a;}void deleteA(ClassA* obj){ free(obj);}// main.c#include &lt;ClassA.h&gt;void main(){ ClassA* aobj = newA(0);}&#x5728;&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x5728;.c&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x9700;&#x8981;&#x8C03;&#x7528;&#x7684;&#x5730;&#x65B9;include&#x5BF9;&#x5E94;&#x7684;&#x5934;&#x6587;&#x4EF6;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x5F53;main&#x51FD;&#x6570;&#x548C;ClassA&#x5B9A;&#x4E49;&#x5728;&#x4E0D;&#x540C;&#x7684;lib&#x4E2D;&#x65F6;&#xFF0C;&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;newA, deleteA&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x4E3A;extern&#x3002;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x2014;&#x2014;private &amp; protect&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x6700;&#x57FA;&#x672C;&#x7684;&#x5C01;&#x88C5;&#x5B9A;&#x4E49;&#x3002;C++&#x4E2D;&#x6700;&#x6709;&#x8DA3;&#x7684;&#x662F;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF0C;&#x5373;&#x9690;&#x85CF;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x53EA;&#x66B4;&#x9732;&#x63A5;&#x53E3;&#x3002;private&#x600E;&#x4E48;&#x505A;&#x5230;private&#x5462;&#xFF1F;&#x7528;&#x7ED3;&#x6784;&#x4F53;&#x628A;private&#x5305;&#x8D77;&#x6765;&#x3002;// ClassA.c#include &lt;ClassA_Private.h&gt;#include &lt;ClassA.h&gt;ClassA* newA(int a){ ClassA* pA = malloc(sizeof(ClassA)); pA-&gt;private_data = malloc(sizeof(ClassA_Private)); ClassA_Private* pPrivate = (ClassA_Private*)(pA-&gt;private_data); pPrivate-&gt;private_a = a;}...// ClassA.htypedef struct _ClassA{ int a; void (*funcA)(struct _ClassA*, int); void* private_data; // void pointer hide all details}ClassA;// ClassA_Private.hstruct _ClassA;typedef _ClassA_Private{ int private_a; void (*private_funcA)(struct _ClassA*, int);}ClassA_Private// main.c#include &lt;ClassA.h&gt;void main(){ ClassA* obj = newA(0); // Below line will bring compile error. // obj-&gt;private_data.private_funcA}&#x5C06;&#x4E0D;&#x60F3;&#x66B4;&#x9732;&#x7684;&#x6570;&#x636E;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#xFF0C;&#x7C7B;&#x5B9A;&#x4E49;&#x7684;&#x5934;&#x6587;&#x4EF6;&#x5305;&#x542B;&#x8BE5;&#x5934;&#x6587;&#x4EF6;&#x3002;&#x5BF9;&#x4E8E;&#x60F3;&#x9690;&#x85CF;&#x7684;&#x5BA2;&#x6237;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x66B4;&#x9732;&#x8BE5;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x5176;&#x4E0D;&#x80FD;&#x5F15;&#x7528;&#x8BE5;private&#x4EE3;&#x7801;&#x3002;protectprotect&#x6570;&#x636E;&#x662F;&#x53EA;&#x80FD;&#x66B4;&#x9732;&#x7ED9;&#x5B50;&#x7C7B;&#x548C;&#x53CB;&#x5143;&#xFF0C;&#x5173;&#x4E8E;&#x53CB;&#x5143;&#xFF0C;&#x53C2;&#x8003;&#x3010;C++&#x57FA;&#x7840;&#x4E4B;&#x5341;&#x3011;&#x53CB;&#x5143;&#x51FD;&#x6570;&#x548C;&#x53CB;&#x5143;&#x7C7B; &#x5728;C&#x91CC;&#x9762;&#xFF0C;&#x5C31;&#x6CA1;&#x8FD9;&#x4E48;&#x591A;&#x82B1;&#x5934;&#x4E86;&#xFF0C;&#x201C;&#x5BF9;&#x4E8E;&#x60F3;&#x9690;&#x85CF;&#x7684;&#x5BA2;&#x6237;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x66B4;&#x9732;&#x8BE5;&#x5934;&#x6587;&#x4EF6;&#x201D;&#x3002;// ChildClassA.h#include &lt;BaseClassA.h&gt;#include &lt;BaseClassA_Private.h&gt;typedef struct _ChildClassA{ BaseClassA parent; ...}// FriendClassA.h#include &lt;BaseClassA.h&gt;#include &lt;BaseClassA_Private.h&gt;typedef struct _ChildClassA{ BaseClassA parent; ...}// main.c#include &lt;BaseClassA.h&gt;&#x7EE7;&#x627F;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x770B;&#x5230;&#x7EE7;&#x627F;&#x7684;&#x57FA;&#x672C;&#x4EE3;&#x7801;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x6807;&#x51C6;&#x7684;&#x7EE7;&#x627F;&#x6211;&#x4EEC;&#x8FD8;&#x8981;&#x505A;&#x7684;&#x66F4;&#x591A;&#x3002;// BaseClassAtypedef struct BaseClass{ int a; void (*funcA)(struct BaseClassA*, int);}BaseClassA;// DerivedClassB#include &lt;BaseClassA.h&gt;typedef struct DerivedClassB{ BaseClassA parent; int special; void (*funcA)(struct DerivedClassB*, int); void (*funcB)(struct DerivedClassB*, int);}DerivedClassB;DerivedClassB* NewB(){ DerivedClassB* newB = malloc(sizeof(DerivedClassB)); newB-&gt;parent.funcA = funcA; newB-&gt;funcA = funcA; return newB;}&#x5B50;&#x7C7B;&#x5305;&#x542B;&#x7236;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x7EE7;&#x627F;&#x3002;&#x5B50;&#x7C7B;&#x540C;&#x540D;&#x51FD;&#x6570;&#x91CD;&#x5199;&#x4E86;&#x7236;&#x7C7B;&#x540C;&#x540D;&#x51FD;&#x6570;&#x3002;&#x4E3A;&#x4E0B;&#x9762;&#x591A;&#x6001;&#x505A;&#x597D;&#x51C6;&#x5907;&#x3002;&#x591A;&#x6001;&#x63A5;&#x7740;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;BaseClassA* pBase = (BaseClassA*)NewB();pBase-&gt;funcA(); // &#x8C03;&#x7528;&#x7684;&#x662F;&#x5B50;&#x7C7B;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x8D4B;&#x4E88;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x591A;&#x6001;&#x4E86;&#x4F8B;&#x5B50;%23C%u9762%u5411%u5BF9%u8C61%0A@%28myblog%29%5Bc/c++%2C%20%u9762%u5411%u5BF9%u8C61%5D%0A%u66FE%u7ECF%u8C08%u5230%u9762%u76F8%u5BF9%u8C61%uFF0C%u5C31%u662FC++%uFF0C%u4E4B%u540E%u6700%u591A%u52A0%u4E0AJava%u3002%u540E%u6765%uFF0C%u8BFB%u8FC7%u7684%u4E66%u4E0A%u8BF4%uFF0C%u9762%u5411%u5BF9%u8C61%u5176%u5B9E%u53EA%u662F%u4E00%u79CD%u8BBE%u8BA1%u65B9%u5F0F%u2014%u2014%u4E07%u4E8B%u5373%u5BF9%u8C61%uFF0C%u800C%u4E0D%u5728%u4E4E%u7528%u7684%u662F%u4EC0%u4E48%u8BED%u8A00%u3002C%u8BED%u8A00%uFF0C%u4E00%u6837%u4E5F%u53EF%u4EE5%u505A%u9762%u5411%u5BF9%u8C61%u8BBE%u8BA1%uFF0C%u6709%u65F6%u5019%u8FD8%u66F4%u81EA%u7531%uFF0C%u6CA1%u6709C++%u7684%u5404%u79CD%u9690%u85CF%u7684%u5751%u3002%u8FD9%u7BC7%u7B14%u8BB0%u5C31%u5177%u4F53%u8BF4%u8BF4%u5982%u4F55%u7528C%u6765%u505A%u9762%u5411%u5BF9%u8C61%u3002%0A%u5F00%u59CB%u4E4B%u524D%uFF0C%u7528%u4E00%u7BC7%u7F51%u4E0A%u6536%u5F55%u7684%u7B14%u8BB0%u4F5C%u4E3A%u5165%u95E8%uFF1A%5B%u7528C%u8BED%u8A00%u5199%u9762%u5411%u7684%u5BF9%u8C61%u662F%u4E00%u79CD%u4EC0%u4E48%u6837%u7684%u4F53%u9A8C%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/29001a8f-6996-413e-b6ad-41c3cbba9c00%29%u3002%0A%0A%5BTOC%5D%0A%0A%23%23%u5C01%u88C5%0A%u5BF9%u7C7B%u7ED3%u6784%u7684%u5C01%u88C5%uFF0CC%u91CC%u9762%u7528%60struct%60%2C%u76F8%u6BD4C++%u7F3A%u5C11%u7684%u5C31%u662F%uFF1A%0A-%20%u6784%u9020%u51FD%u6570%u548C%u6790%u6784%u51FD%u6570%0A-%20private%20%26%20protect%0A%60%60%60%0A/**%20Class%20definition%20of%20BaseLed.%0A%20*%20%20The%20concrete%20LED%20class%20should%20inherit%20from%20this%20class.%0A%20*/%0Atypedef%20struct%20BaseLed%0A%7B%0A%20%20%20%20uint8_t%20id%3B%0A%20%20%20%20/**%0A%20%20%20%20%20*%20Below%204%20members%20are%20used%20to%20record%20the%20LED%20blinking%20state.%0A%20%20%20%20%20*/%0A%20%20%20%20LedState%20state%3B%20%20%20%20%20%20%20%20%20%0A%20%20%20%20uint16_t%20onTime%3B%0A%20%20%20%20uint16_t%20offTime%3B%0A%20%20%20%20uint16_t%20blinkCount%3B%0A%0A%20%20%20%20/**%0A%20%20%20%20%20*%20Public%20function%20members.%0A%20%20%20%20%20*/%0A%20%20%20%20bool%20%28*init%29%28struct%20BaseLed*%2C%20uint8_t%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20//%21%3C%20Init%20hardware%20if%20needed%0A%20%20%20%20void%20%28*switchit%29%28struct%20BaseLed*%2C%20LedState%29%3B%20%20%20%20%20%20%20%20//%21%3C%20Turn%20on/off%0A%20%20%20%20void%20%28*set_brightness%29%28struct%20BaseLed*%2C%20uint8_t%29%3B%20%20%20//%21%3C%20Set%20LED%27s%20brightness%20level%0A%7DBaseLed%3B%0A%60%60%60%0A%u4E0A%u9762%u7684%u4F8B%u5B50%uFF0C%u4E0A%u534A%u90E8%u5206%u662F%u6210%u5458%u53D8%u91CF%uFF0C%u4E0B%u534A%u90E8%u5206%u662F%u6210%u5458%u51FD%u6570%u3002%0A%23%23%23%u6784%u9020%u51FD%u6570%26%u6790%u6784%u51FD%u6570%0AC++%u4E2D%uFF0C%u6784%u9020%u51FD%u6570%u5728%u4EE5%u4E0B%u60C5%u51B5%u4E2D%u8C03%u7528%uFF1A%0A%3E*%20%u6BD4%u5982%u4F60%u5728main%u91CC%u9762%u58F0%u660E%u4E86%u4E00%u4E2A%u7C7BA..%u90A3%u4E48%7EA%28%29%u4F1A%u5728main%u7ED3%u675F%u65F6%u8C03%u7528%0A%3E*%20%u5982%u679C%u5728%u81EA%u5B9A%u4E49%u7684%u51FD%u6570f%28%29%u91CC%u9762%u58F0%u660E%u4E86%u4E00%u4E2AA%20%20%u51FD%u6570f%u7ED3%u675F%u7684%u65F6%u5019%u5C31%u4F1A%u8C03%u7528%7EA%28%29%0A%3E*%20%u6216%u8005%u4F60delete%20%u6307%u5411A%u7684%u6307%u9488..%0A%3E*%20%u6216%u8005%u663E%u5F0F%u7684%u8C03%u7528%u6790%u6784%u51FD%u6570%0A%0AC++%u5404%u79CD%u9690%u85CF%u7684%u5751%uFF0C%u53C2%u8003%u7F51%u9875%5B%u90A3%u4E9B%u88ABC++%u9ED8%u9ED8%u5730%u58F0%u660E%u548C%u8C03%u7528%u7684%u51FD%u6570%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/86f265a4-1139-468b-a941-1897a54ae440%29%0A%0A%u5728C%u9762%u5411%u5BF9%u8C61%u91CC%u9762%uFF0C%u5C31%u6CA1%u6709%u8FD9%u79CD%u95EE%u9898%uFF0C%u56E0%u4E3AC%u8BED%u8A00%u6839%u672C%u4E0D%u4F1A%u4E3A%u4F60%u751F%u6210%u9690%u85CF%u7684%u51FD%u6570%uFF0C%u4E5F%u4E0D%u4F1A%u5E2E%u4F60%u8C03%u7528%u6784%u9020%u51FD%u6570%uFF0C%u5206%u914D%u5185%u5B58%u4E4B%u7C7B%u7684%uFF0C%u4E5F%u6CA1%u6709%u865A%u51FD%u6570%u8868%28VTable%29%u3002%u6240%u6709%u8FD9%u4E00%u5207%u90FD%u5F97%u81EA%u5DF1%u4EB2%u529B%u4EB2%u4E3A%u3002%u4E0D%u8FC7%u8FD9%u6837%u4E5F%u597D%uFF0C%u6240%u89C1%u5373%u6240%u5F97%u561B%u3002%0A%60%60%60%0A//%20ClassA.h%0Atypedef%20struct%20_ClassA%0A%7B%0A%09int%20a%3B%0A%09void%20%28*funcA%29%28struct%20_ClassA*%2C%20int%29%3B%0A%7DClassA%3B%0A%0AClassA*%20newA%28int%29%3B%0Avoid%20deleteA%28ClassA*%29%0A%0A//%20ClassA.c%0A%23include%20%3CClassA.h%3E%0Avoid%20funcA%28ClassA*%20thisObj%2C%20int%20a%29%0A%7B%0A%7D%0A%0AClassA*%20newA%28int%20a%29%0A%7B%0A%09ClassA*%20Aobj%20%3D%20malloc%28sizeof%28ClassA%29%29%3B%0A%09Aobj-%3EfuncA%20%3D%20funcA%3B%0A%09Aobj-%3Ea%20%3D%20a%3B%0A%7D%0A%0Avoid%20deleteA%28ClassA*%20obj%29%0A%7B%0A%09free%28obj%29%3B%0A%7D%0A//%20main.c%0A%23include%20%3CClassA.h%3E%0Avoid%20main%28%29%0A%7B%0A%09ClassA*%20aobj%20%3D%20newA%280%29%3B%0A%7D%0A%60%60%60%0A%u5728%u5934%u6587%u4EF6%u4E2D%u5B9A%u4E49%u7ED3%u6784%u4F53%uFF0C%u5728.c%u6587%u4EF6%u4E2D%u5B9A%u4E49%u6210%u5458%u51FD%u6570%uFF0C%u5728%u9700%u8981%u8C03%u7528%u7684%u5730%u65B9include%u5BF9%u5E94%u7684%u5934%u6587%u4EF6%u3002%u6CE8%u610F%uFF0C%u5F53%60main%60%u51FD%u6570%u548CClassA%u5B9A%u4E49%u5728%u4E0D%u540C%u7684lib%u4E2D%u65F6%uFF0C%u5934%u6587%u4EF6%u4E2D%u7684newA%2C%20deleteA%u9700%u8981%u5B9A%u4E49%u4E3Aextern%u3002%0A%0A%23%23%23%u8BBF%u95EE%u63A7%u5236%u2014%u2014private%20%26%20protect%0A%u4E0A%u9762%u7684%u4F8B%u5B50%u662F%u6700%u57FA%u672C%u7684%u5C01%u88C5%u5B9A%u4E49%u3002C++%u4E2D%u6700%u6709%u8DA3%u7684%u662F%u8BBF%u95EE%u63A7%u5236%uFF0C%u5373%u9690%u85CF%u5177%u4F53%u5B9E%u73B0%uFF0C%u800C%u53EA%u66B4%u9732%u63A5%u53E3%u3002%0A%23%23%23%23private%0A%u600E%u4E48%u505A%u5230private%u5462%uFF1F%u7528%u7ED3%u6784%u4F53%u628Aprivate%u5305%u8D77%u6765%u3002%0A%60%60%60cpp%0A//%20ClassA.c%0A%23include%20%3CClassA_Private.h%3E%0A%23include%20%3CClassA.h%3E%0AClassA*%20newA%28int%20a%29%0A%7B%0A%09ClassA*%20pA%20%3D%20malloc%28sizeof%28ClassA%29%29%3B%0A%09pA-%3Eprivate_data%20%3D%20malloc%28sizeof%28ClassA_Private%29%29%3B%0A%09ClassA_Private*%20pPrivate%20%3D%20%28ClassA_Private*%29%28pA-%3Eprivate_data%29%3B%0A%09pPrivate-%3Eprivate_a%20%3D%20a%3B%0A%7D%0A...%0A%60%60%60%0A%60%60%60%0A//%20ClassA.h%0Atypedef%20struct%20_ClassA%0A%7B%0A%09int%20a%3B%0A%09void%20%28*funcA%29%28struct%20_ClassA*%2C%20int%29%3B%0A%09void*%20private_data%3B%20%20//%20void%20pointer%20hide%20all%20details%0A%7DClassA%3B%0A%60%60%60%0A%60%60%60%0A//%20ClassA_Private.h%0Astruct%20_ClassA%3B%0Atypedef%20_ClassA_Private%0A%7B%0A%09int%20private_a%3B%0A%09void%20%28*private_funcA%29%28struct%20_ClassA*%2C%20int%29%3B%0A%7DClassA_Private%0A%60%60%60%0A%0A%60%60%60%0A//%20main.c%0A%23include%20%3CClassA.h%3E%0Avoid%20main%28%29%0A%7B%0A%09ClassA*%20obj%20%3D%20newA%280%29%3B%0A%09//%20Below%20line%20will%20bring%20compile%20error.%0A%09//%20obj-%3Eprivate_data.private_funcA%0A%7D%0A%60%60%60%0A%u5C06%u4E0D%u60F3%u66B4%u9732%u7684%u6570%u636E%u653E%u5728%u4E00%u4E2A%u7ED3%u6784%u4F53%u4E2D%uFF0C%u7C7B%u5B9A%u4E49%u7684%u5934%u6587%u4EF6%u5305%u542B%u8BE5%u5934%u6587%u4EF6%u3002%u5BF9%u4E8E%u60F3%u9690%u85CF%u7684%u5BA2%u6237%u4EE3%u7801%uFF0C%u4E0D%u66B4%u9732%u8BE5%u5934%u6587%u4EF6%uFF0C%u5219%u5176%u4E0D%u80FD%u5F15%u7528%u8BE5private%u4EE3%u7801%u3002%0A%23%23%23protect%0Aprotect%u6570%u636E%u662F%u53EA%u80FD%u66B4%u9732%u7ED9%u5B50%u7C7B%u548C%u53CB%u5143%uFF0C%u5173%u4E8E%u53CB%u5143%uFF0C%u53C2%u8003%5B%u3010C++%u57FA%u7840%u4E4B%u5341%u3011%u53CB%u5143%u51FD%u6570%u548C%u53CB%u5143%u7C7B%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/b14c761f-a0d8-4c31-b54c-fb0f4a369aae%29%0A%u5728C%u91CC%u9762%uFF0C%u5C31%u6CA1%u8FD9%u4E48%u591A%u82B1%u5934%u4E86%uFF0C%u201C%u5BF9%u4E8E%u60F3%u9690%u85CF%u7684%u5BA2%u6237%u4EE3%u7801%uFF0C%u4E0D%u66B4%u9732%u8BE5%u5934%u6587%u4EF6%u201D%u3002%0A%60%60%60%0A//%20ChildClassA.h%0A%23include%20%3CBaseClassA.h%3E%0A%23include%20%3CBaseClassA_Private.h%3E%0Atypedef%20struct%20_ChildClassA%0A%7B%0A%09BaseClassA%20parent%3B%0A%09...%0A%7D%0A%0A//%20FriendClassA.h%0A%23include%20%3CBaseClassA.h%3E%0A%23include%20%3CBaseClassA_Private.h%3E%0Atypedef%20struct%20_ChildClassA%0A%7B%0A%09BaseClassA%20parent%3B%0A%09...%0A%7D%0A%0A//%20main.c%0A%23include%20%3CBaseClassA.h%3E%0A%60%60%60%0A%23%23%u7EE7%u627F%0A%u4E0A%u9762%u5DF2%u7ECF%u770B%u5230%u7EE7%u627F%u7684%u57FA%u672C%u4EE3%u7801%u4E86%uFF0C%u4F46%u662F%u4E3A%u4E86%u5B9E%u73B0%u6807%u51C6%u7684%u7EE7%u627F%u6211%u4EEC%u8FD8%u8981%u505A%u7684%u66F4%u591A%u3002%0A%60%60%60%0A//%20BaseClassA%0Atypedef%20struct%20BaseClass%0A%7B%0A%09int%20a%3B%0A%09void%20%28*funcA%29%28struct%20BaseClassA*%2C%20int%29%3B%0A%7DBaseClassA%3B%0A%0A//%20DerivedClassB%0A%23include%20%3CBaseClassA.h%3E%0Atypedef%20struct%20DerivedClassB%0A%7B%0A%09BaseClassA%20parent%3B%0A%09int%20special%3B%0A%09void%20%28*funcA%29%28struct%20DerivedClassB*%2C%20int%29%3B%0A%09void%20%28*funcB%29%28struct%20DerivedClassB*%2C%20int%29%3B%0A%7DDerivedClassB%3B%0A%0ADerivedClassB*%20NewB%28%29%0A%7B%0A%09DerivedClassB*%20newB%20%3D%20malloc%28sizeof%28DerivedClassB%29%29%3B%0A%09newB-%3Eparent.funcA%20%3D%20funcA%3B%0A%09newB-%3EfuncA%20%3D%20funcA%3B%0A%09return%20newB%3B%0A%7D%0A%60%60%60%0A%u5B50%u7C7B%u5305%u542B%u7236%u7C7B%u7684%u5B9E%u4F8B%uFF0C%u8FD9%u6837%u5C31%u5B9E%u73B0%u4E86%u7EE7%u627F%u3002%u5B50%u7C7B%u540C%u540D%u51FD%u6570%u91CD%u5199%u4E86%u7236%u7C7B%u540C%u540D%u51FD%u6570%u3002%u4E3A%u4E0B%u9762%u591A%u6001%u505A%u597D%u51C6%u5907%u3002%0A%23%23%u591A%u6001%0A%u63A5%u7740%u4E0A%u9762%u7684%u4F8B%u5B50%0A%60%60%60%0ABaseClassA*%20pBase%20%3D%20%28BaseClassA*%29NewB%28%29%3B%0ApBase-%3EfuncA%28%29%3B%20//%20%u8C03%u7528%u7684%u662F%u5B50%u7C7B%u6784%u9020%u51FD%u6570%u4E2D%u8D4B%u4E88%u7684%u51FD%u6570%uFF0C%u8FD9%u5C31%u662F%u591A%u6001%u4E86%0A%60%60%60%0A%23%23%u4F8B%u5B50%0A]]></content>
      <tags>
        <tag>c/c++</tag>
        <tag>面向对象</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python win32com]]></title>
    <url>%2F2017%2F02%2F10%2FPython_win32com%2F</url>
    <content type="text"><![CDATA[Edit Python&#x592A;&#x5F3A;&#x5927;&#x4E86;&#xFF0C;&#x4F7F;&#x7528;&#x5176;Win32&#x5E93;&#x53EF;&#x4EE5;&#x64CD;&#x4F5C;&#x6240;&#x6709;&#x7684;Windows&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x5728;&#x505A;Dashboard&#x751F;&#x6210;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F7F;&#x7528;win32com&#x6765;&#x64CD;&#x4F5C;Excel&#x548C;PPT&#x6765;&#x83B7;&#x5F97;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x66F4;&#x65B0;PPT&#x6587;&#x4EF6;&#x3002;&#x5728;&#x521D;&#x671F;&#xFF0C;&#x6211;&#x4EEC;&#x91C7;&#x7528;python&#x7684;xlrd&#x548C;pptx&#x6765;&#x64CD;&#x4F5C;Excel&#x548C;PPT&#xFF0C;&#x4F46;&#x662F;&#x53D1;&#x73B0;&#x529F;&#x80FD;&#x5C40;&#x9650;&#x6027;&#x5F88;&#x5927;&#xFF0C;&#x5728;&#x540E;&#x6765;&#x7684;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x6211;&#x53D1;&#x73B0;xlrd&#x548C;pptx&#x4E0D;&#x4EC5;&#x529F;&#x80FD;&#x4E0D;&#x884C;&#xFF0C;&#x6548;&#x7387;&#x4E5F;&#x6781;&#x5176;&#x4F4E;&#x4E0B;&#xFF0C;&#x8FDC;&#x8FDC;&#x6162;&#x4E8E;win32com&#x3002;&#x552F;&#x4E00;&#x7684;&#x597D;&#x5904;&#x5C31;&#x662F;&#xFF0C;&#x5176;&#x53EF;&#x4EE5;&#x8DE8;&#x5E73;&#x53F0;&#xFF0C;&#x800C;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E;Windows&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x3002;&#x4F46;&#x8FD9;&#x4E00;&#x70B9;&#x5BF9;&#x6211;&#x6BEB;&#x65E0;&#x5438;&#x5F15;&#x529B;&#x3002;&#x7F51;&#x4E0A;&#x4F7F;&#x7528;win32com&#x7684;&#x6587;&#x6863;&#x4E0D;&#x662F;&#x5F88;&#x591A;&#xFF0C;&#x627E;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x7BC7;&#xFF0C;&#x8BB2;&#x64CD;&#x4F5C;PPT&#x7684;&#xFF0C;&#x5165;&#x95E8;&#x8FD8;&#x662F;&#x4E0D;&#x9519;&#x7684;[Python] win32com PowerPoint &#xAB; ibluemonkey&#x2019;s Note&#x5176;&#x4ED6;&#x7684;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5FAE;&#x8F6F;&#x7684;VBA&#x6587;&#x6863;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;COM object&#x90FD;&#x6709;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;&#x5217;&#x8868;&#x548C;&#x65B9;&#x6CD5;&#x5217;&#x8868;&#x3002;&#x5BF9;&#x8C61;&#x6A21;&#x578B;&#xFF08;PowerPoint VBA &#x53C2;&#x8003;&#xFF09;&#x4E00;&#x4E9B;&#x7ECF;&#x9A8C;&#x5927;&#x591A;&#x6570;COM&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x503C;&#x90FD;&#x662F;&#x4ECE;1&#x5F00;&#x59CB;Excel&#x5206;&#x4E3A;Workbook-&gt;Worksheet-&gt;ListObjects / ChartObjects&#x5176;&#x5B9E;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x5199;&#x4E00;&#x7BC7;&#x5982;&#x4F55;&#x64CD;&#x4F5C;PPT&#x548C;EXCEL&#xFF0C;&#x82E6;&#x4E8E;&#x6CA1;&#x6709;&#x65F6;&#x95F4; EXCEL&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E9B;&#x6838;&#x5FC3;&#x6982;&#x5FF5;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;PDB&#x5C1D;&#x8BD5;&#x624D;&#x6162;&#x6162;&#x5F97;&#x6765;&#x3002;&#x4F8B;&#x5982;Range&#xFF0C;AutoFIlter&#xFF0C;ListObject&#x3002;&#x5148;&#x5217;&#x5728;&#x8FD9;&#x513F;&#xFF0C;&#x5F85;&#x6709;&#x65F6;&#x95F4;&#x518D;&#x6162;&#x6162;&#x8865;&#x5145;&#x3002;%23Python%20win32com%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5Bpython%2C%20win32com%5D%0APython%u592A%u5F3A%u5927%u4E86%uFF0C%u4F7F%u7528%u5176Win32%u5E93%u53EF%u4EE5%u64CD%u4F5C%u6240%u6709%u7684Windows%u5E94%u7528%u7A0B%u5E8F%u3002%u4F8B%u5982%u6211%u4EEC%u5728%u505ADashboard%u751F%u6210%u5668%u7684%u65F6%u5019%uFF0C%u4F7F%u7528win32com%u6765%u64CD%u4F5CExcel%u548CPPT%u6765%u83B7%u5F97%u6570%u636E%uFF0C%u5E76%u66F4%u65B0PPT%u6587%u4EF6%u3002%u5728%u521D%u671F%uFF0C%u6211%u4EEC%u91C7%u7528python%u7684xlrd%u548Cpptx%u6765%u64CD%u4F5CExcel%u548CPPT%uFF0C%u4F46%u662F%u53D1%u73B0%u529F%u80FD%u5C40%u9650%u6027%u5F88%u5927%uFF0C%u5728%u540E%u6765%u7684%u5F00%u53D1%u4E2D%uFF0C%u6211%u53D1%u73B0xlrd%u548Cpptx%u4E0D%u4EC5%u529F%u80FD%u4E0D%u884C%uFF0C%u6548%u7387%u4E5F%u6781%u5176%u4F4E%u4E0B%uFF0C%u8FDC%u8FDC%u6162%u4E8Ewin32com%u3002%u552F%u4E00%u7684%u597D%u5904%u5C31%u662F%uFF0C%u5176%u53EF%u4EE5%u8DE8%u5E73%u53F0%uFF0C%u800C%u4E0D%u4F9D%u8D56%u4E8EWindows%u64CD%u4F5C%u7CFB%u7EDF%u3002%u4F46%u8FD9%u4E00%u70B9%u5BF9%u6211%u6BEB%u65E0%u5438%u5F15%u529B%u3002%0A%0A%u7F51%u4E0A%u4F7F%u7528win32com%u7684%u6587%u6863%u4E0D%u662F%u5F88%u591A%uFF0C%u627E%u5230%u4E0B%u9762%u8FD9%u7BC7%uFF0C%u8BB2%u64CD%u4F5CPPT%u7684%uFF0C%u5165%u95E8%u8FD8%u662F%u4E0D%u9519%u7684%0A-%20%5B%5BPython%5D%20win32com%20PowerPoint%20%AB%20ibluemonkey%27s%20Note%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/d5ac6ed2-19a4-435d-9b98-69db9ae0107c%29%0A%0A%u5176%u4ED6%u7684%u53EF%u4EE5%u53C2%u8003%u5FAE%u8F6F%u7684VBA%u6587%u6863%uFF0C%u6BCF%u4E00%u4E2ACOM%20object%u90FD%u6709%u5176%u5BF9%u5E94%u7684%u5C5E%u6027%u5217%u8868%u548C%u65B9%u6CD5%u5217%u8868%u3002%0A-%20%5B%u5BF9%u8C61%u6A21%u578B%uFF08PowerPoint%20VBA%20%u53C2%u8003%uFF09%5D%28https%3A//msdn.microsoft.com/zh-cn/library/office/ff743835.aspx%29%0A%0A%23%23%u4E00%u4E9B%u7ECF%u9A8C%0A1.%20%u5927%u591A%u6570COM%u4E2D%u7684%u7D22%u5F15%u503C%u90FD%u662F%u4ECE1%u5F00%u59CB%0A2.%20Excel%u5206%u4E3AWorkbook-%3EWorksheet-%3EListObjects%20/%20ChartObjects%0A%0A%u5176%u5B9E%u53EF%u4EE5%u5355%u72EC%u5199%u4E00%u7BC7%u5982%u4F55%u64CD%u4F5CPPT%u548CEXCEL%uFF0C%u82E6%u4E8E%u6CA1%u6709%u65F6%u95F4%0AEXCEL%u91CC%u9762%u6709%u4E00%u4E9B%u6838%u5FC3%u6982%u5FF5%uFF0C%u90FD%u662F%u901A%u8FC7PDB%u5C1D%u8BD5%u624D%u6162%u6162%u5F97%u6765%u3002%u4F8B%u5982Range%uFF0CAutoFIlter%uFF0CListObject%u3002%u5148%u5217%u5728%u8FD9%u513F%uFF0C%u5F85%u6709%u65F6%u95F4%u518D%u6162%u6162%u8865%u5145%u3002]]></content>
      <tags>
        <tag>python</tag>
        <tag>win32com</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用HTML作为Python程序的UI]]></title>
    <url>%2F2017%2F02%2F06%2F%E4%BD%BF%E7%94%A8HTML%E4%BD%9C%E4%B8%BAPython%E7%A8%8B%E5%BA%8F%E7%9A%84UI%2F</url>
    <content type="text"><![CDATA[Edit&#x95EE;&#x9898;1. SimpleHTTPServer&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7BA1;&#x9053;&#x8F93;&#x51FA;&#x4FE1;&#x606F;&#x5728;&#x505A;&#x7B2C;4&#x6B65;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9047;&#x5230;&#x4E86;&#x5F88;&#x5927;&#x7684;&#x632B;&#x6298;&#x3002;&#x7B2C;1&#x6B65;&#x91C7;&#x7528;subprocess&#x6A21;&#x5757;&#xFF0C;&#x6253;&#x5F00;&#x547D;&#x4EE4;python MyHTTPServer.py&#x3002;&#x5BF9;subprocess&#x7684;&#x4ECB;&#x7ECD;&#x53EF;&#x53C2;&#x8003;&#xFF1A; python&#x5B50;&#x8FDB;&#x7A0B;&#x6A21;&#x5757;subprocess&#x8BE6;&#x89E3;&#x4E0E;&#x5E94;&#x7528;&#x5B9E;&#x4F8B; &#x4E4B;&#x4E00;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x662F;&#xFF1A;popen.communicate/read&#x4F1A;block&#x4E3B;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E14;block&#x65F6;&#xFF0C;&#x65E0;&#x6CD5;&#x7528;ctrl+c&#x9000;&#x51FA;readline&#x59CB;&#x7EC8;&#x8FD4;&#x56DE;&#x7A7A;&#x5B57;&#x7B26;&#x89E3;&#x51B3;&#x6700;&#x540E;&#x89E3;&#x51B3;&#x7684;&#x65B9;&#x6848;&#x5728;&#x8FD9;&#x4E24;&#x4E2A;&#x7F51;&#x9875;&#x4E2D;&#xFF1A;Startserver does not send data back to POpen.communicateBypassing buffering of subprocess output with popen in C or Python&#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;block&#x662F;&#x56E0;&#x4E3A;&#xFF0C;&#x6CA1;&#x6709;&#x5B57;&#x7B26;&#x8F93;&#x51FA;&#x5230;stdout&#xFF0C;&#x56E0;&#x4E3A;&#x5B58;&#x5728;&#x7F13;&#x5B58;&#xFF0C;&#x5BF9;python&#x91C7;&#x7528;-u&#x53EF;&#x4EE5;&#x89E3;&#x51B3;2. Python Requests&#x5E93;&#x5728;&#x8BBF;&#x95EE;localhost&#x65F6;&#x51FA;503 Error&#x53C2;&#x770B;&#x8FD9;&#x4E2A;&#x7F51;&#x9875;&#xFF0C;&#x6765;&#x81EA;Stack Overflow Python requests 503 erros when trying to access localhost:8000 &#x95EE;&#x9898;&#x662F;&#x56E0;&#x4E3A;&#x516C;&#x53F8;&#x4EE3;&#x7406;&#x7981;&#x6B62;&#x81EA;&#x5DF1;ping&#x81EA;&#x5DF1;&#x3002;&#x6574;&#x7406;SimpleHTTPServer&#x57FA;&#x4E8E;BaseHTTPServer&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x4E0B;&#x8F7D;&#x670D;&#x52A1;&#x3002;&#x5B83;&#x662F;python&#x4E3A;BaseHTTPServer&#x63D0;&#x4F9B;&#x7684;&#x4F8B;&#x7A0B;&#x3002;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x57FA;&#x4E8E;&#x5B83;&#x5F00;&#x53D1;&#xFF0C;&#x6216;&#x8005;&#x53C2;&#x8003;&#x5B83;&#xFF0C;&#x5E76;&#x57FA;&#x4E8E;BaseHTTPServer&#x5F00;&#x53D1;&#x3002;%23%u4F7F%u7528HTML%u4F5C%u4E3APython%u7A0B%u5E8F%u7684UI%0A@%28%u5DE5%u4F5C%u7B14%u8BB0%29%5Bpython%2C%20http%5D%0A%60%60%60sequence%0AUpdater-%3ESimpleHTTPServer%3A1.Start%0AUpdater-%3EHTML%3A%202.Open%20in%20Browser%0AHTML-%3ESimpleHTTPServer%3A%203.POST%0ASimpleHTTPServer-%3EUpdater%3A4.PIPE%0AUpdater-%3ESimpleHTTPServer%3A5.Terminate%0A%60%60%60%0A%0A%23%23%u95EE%u9898%0A%23%23%231.%20SimpleHTTPServer%u65E0%u6CD5%u901A%u8FC7%u7BA1%u9053%u8F93%u51FA%u4FE1%u606F%0A%u5728%u505A%u7B2C4%u6B65%u7684%u65F6%u5019%uFF0C%u9047%u5230%u4E86%u5F88%u5927%u7684%u632B%u6298%u3002%u7B2C1%u6B65%u91C7%u7528subprocess%u6A21%u5757%uFF0C%u6253%u5F00%u547D%u4EE4%60python%20MyHTTPServer.py%60%u3002%u5BF9subprocess%u7684%u4ECB%u7ECD%u53EF%u53C2%u8003%uFF1A%0A-%20%5B%20python%u5B50%u8FDB%u7A0B%u6A21%u5757subprocess%u8BE6%u89E3%u4E0E%u5E94%u7528%u5B9E%u4F8B%20%u4E4B%u4E00%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/3fcc11e2-7d72-479f-9228-df72909bd465%29%0A-%20%5B%u5B98%u65B9%u6587%u6863%5D%28https%3A//docs.python.org/2/library/subprocess.html%23subprocess.CalledProcessError%29%0A%0A%u9047%u5230%u7684%u95EE%u9898%u662F%uFF1A%0A-%20popen.communicate/read%u4F1Ablock%u4E3B%u8FDB%u7A0B%uFF0C%u4E14block%u65F6%uFF0C%u65E0%u6CD5%u7528ctrl+c%u9000%u51FA%0A-%20readline%u59CB%u7EC8%u8FD4%u56DE%u7A7A%u5B57%u7B26%0A%0A%23%23%23%23%u89E3%u51B3%0A%u6700%u540E%u89E3%u51B3%u7684%u65B9%u6848%u5728%u8FD9%u4E24%u4E2A%u7F51%u9875%u4E2D%uFF1A%0A-%20%5BStartserver%20does%20not%20send%20data%20back%20to%20POpen.communicate%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/81960cae-4da2-4526-9ec2-3888b3fee1fd%29%0A-%20%5BBypassing%20buffering%20of%20subprocess%20output%20with%20popen%20in%20C%20or%20Python%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/ef454085-44d1-44c6-8862-42a889a855ab%29%0A%0A%u7B80%u800C%u8A00%u4E4B%uFF0Cblock%u662F%u56E0%u4E3A%uFF0C%u6CA1%u6709%u5B57%u7B26%u8F93%u51FA%u5230stdout%uFF0C%u56E0%u4E3A%u5B58%u5728%u7F13%u5B58%uFF0C%u5BF9python%u91C7%u7528%60-u%60%u53EF%u4EE5%u89E3%u51B3%0A%0A%23%23%232.%20Python%20Requests%u5E93%u5728%u8BBF%u95EElocalhost%u65F6%u51FA503%20Error%0A%u53C2%u770B%u8FD9%u4E2A%u7F51%u9875%uFF0C%u6765%u81EAStack%20Overflow%0A%5BPython%20requests%20503%20erros%20when%20trying%20to%20access%20localhost%3A8000%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/272a1b96-68ed-4fc6-8bfa-4160c5f09907%29%0A%u95EE%u9898%u662F%u56E0%u4E3A%u516C%u53F8%u4EE3%u7406%u7981%u6B62%u81EA%u5DF1ping%u81EA%u5DF1%u3002%0A%0A%23%23%u6574%u7406%0ASimpleHTTPServer%u57FA%u4E8EBaseHTTPServer%uFF0C%u5E76%u63D0%u4F9B%u4E86%u6587%u4EF6%u5217%u8868%u4E0B%u8F7D%u670D%u52A1%u3002%u5B83%u662Fpython%u4E3ABaseHTTPServer%u63D0%u4F9B%u7684%u4F8B%u7A0B%u3002%u5F00%u53D1%u8005%u53EF%u4EE5%u57FA%u4E8E%u5B83%u5F00%u53D1%uFF0C%u6216%u8005%u53C2%u8003%u5B83%uFF0C%u5E76%u57FA%u4E8EBaseHTTPServer%u5F00%u53D1%u3002%0A%0A]]></content>
      <tags>
        <tag>python</tag>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python mock初步]]></title>
    <url>%2F2017%2F02%2F06%2Fpython_mock%E5%88%9D%E6%AD%A5%2F</url>
    <content type="text"><![CDATA[Editpython mock&#x521D;&#x6B65;&#x7B80;&#x4ECB;Mock vs. Stub/Fake&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;Mock&#xFF1F;Stubs &amp; Fake&#x4F55;&#x65F6;&#x4F7F;&#x7528;Mock&#x5982;&#x4F55;&#x4F7F;&#x7528;constructor&#x5BF9;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x68C0;&#x6D4B;assert&#x9AD8;&#x9636;&#x7279;&#x6027;MagicMock vs. Mockmock importmock class constructormock&#x5BF9;&#x8C61;&#x7684;&#x81EA;&#x52A8;&#x521B;&#x5EFA;patch&#x5176;&#x4ED6;&#x672A;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x603B;&#x7ED3;&#x4ECE;Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E2D;&#xFF0C;&#x63A5;&#x89E6;&#x5230;Java&#x7684;mock&#x6846;&#x67B6;&#x3002;&#x53C2;&#x770B;&#x8FD9;&#x7BC7;&#x7B14;&#x8BB0;&#x300A;Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x300B;&#x3002;&#x6700;&#x8FD1;&#x5728;&#x505A;Dashboard Generator&#xFF0C;&#x8981;&#x7528;python&#x89E3;&#x6790;excel&#xFF0C;ppt&#x548C;&#x7F51;&#x9875;&#xFF0C;&#x6D4B;&#x8BD5;&#x6548;&#x7387;&#x6781;&#x4F4E;&#x3002;&#x6240;&#x4EE5;&#x8003;&#x8651;&#x5230;&#x53EF;&#x4EE5;&#x7528;mock&#x6765;&#x4EE3;&#x66FF;&#x4E00;&#x4E9B;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#x548C;&#x8D44;&#x6E90;&#x3002;&#x4E8E;&#x662F;&#x63A5;&#x89E6;&#x5230;python&#x7684;mock&#x6846;&#x67B6;&#x3002; python mock&#x5728;3.0&#x4E2D;&#x5DF2;&#x7ECF;&#x96C6;&#x6210;&#x4E3A;&#x5185;&#x7F6E;&#x7C7B;&#xFF0C;&#x4F46;&#x662F;2.7&#x4ECD;&#x7136;&#x9700;&#x8981;&#x7528;pip&#x6765;&#x5B89;&#x88C5;&#x3002;&#x8FD9;&#x4E5F;&#x4E0D;&#x96BE;&#x3002;&#x7136;&#x540E;&#x5728;&#x7F51;&#x4E0A;&#x641C;&#x96C6;&#x4E86;&#x51E0;&#x7BC7;&#x8FD8;&#x4E0D;&#x9519;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;Python Mock&#x7684;&#x5165;&#x95E8;Mocking Python importsUsing Mocks in PythonMock&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7B80;&#x4ECB;&#x56E0;&#x4E3A;&#x662F;python&#x8BED;&#x8A00;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x6240;&#x4EE5;Mock&#x4E0A;&#x624B;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x3002;&#x7A83;&#x4EE5;&#x4E3A;&#x6BD4;Java(Android) Mock&#x8981;&#x5BB9;&#x6613;&#x7684;&#x591A;&#x3002;Mock vs. Stub/Fake&#x53C2;&#x770B;Using Mocks in Python&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x770B;Martin Fowler&#x7684;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;Mocks Aren&#x2019;t Stubs&#x3002; &#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x4E86;Mock&#x548C;Stub/Fake&#x7684;&#x533A;&#x522B;&#x3002;&#x8FD9;&#x662F;&#x6211;&#x4EE5;&#x524D;&#x4E00;&#x76F4;&#x6CA1;&#x6709;&#x6CE8;&#x610F;&#x5230;&#x7684;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;Mock&#xFF1F;A good unit test has to be repeatable, allowing you to isolate and identify a fault. But the test resource might give out stochastic results, or it might have widely varying response times. And as a result, you end up glossing over a potential showstopper.&#x6D4B;&#x8BD5;&#x5FC5;&#x987B;&#x662F;&#x53EF;&#x91CD;&#x590D;&#x7684;&#xFF0C;&#x89E3;&#x8026;&#x7684;&#x3002;&#x4F46;&#x4EE3;&#x7801;&#x7528;&#x5230;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8D44;&#x6E90;&#x5F80;&#x5F80;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x6602;&#x8D35;&#x7684;&#xFF08;&#x6BD4;&#x5982;&#x7F51;&#x9875;&#xFF0C;&#x603B;&#x662F;&#x5728;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;download&#x6587;&#x4EF6;&#xFF0C;&#x975E;&#x5E38;&#x8017;&#x65F6;&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x9996;&#x5148;&#x4E0D;&#x80FD;&#x4F9D;&#x8D56;&#x4E8E;&#x6D4B;&#x8BD5;&#x8D44;&#x6E90;&#xFF0C;&#x5176;&#x6B21;&#x9700;&#x8981;&#x6709;&#x6BD4;&#x8F83;&#x9AD8;&#x7684;&#x6548;&#x7387;&#x3002;These are some of the reasons why you might want to use a mock in place of a test resource. A mock can present the same set of method interfaces as the resource to the test subject. But a mock is easier to setup, easier to manage. It can deliver deterministic results, and it can be customized to suit a particular test. And it can be easily updated to reflect changes in the actual resource.Stubs &amp; FakeStubA stub presents a set of method interfaces to the test subject, the same set the subject would see in an actual test resource. When the test subject calls a stub method, the stub may respond with a predetermined set of results. It may raise an error or exception, also predetermined. A stub may track its interactions with the test subject, but it performs no tasks outside the narrow scope of its programming.FakeA fake also presents a set of method interfaces and tracks its interactions with the test subject. But unlike a stub, a fake actually processes input data from the test subject and produces results based on that data. In short, a fake is a functional, but non-production version of the actual test resource. It lacks the checks and balances found in resource, it uses simpler algorithms, and it seldom, if ever, stores or transports data.Stub&#x548C;Fake&#x90FD;&#x662F;&#x9488;&#x5BF9;&#x63A5;&#x53E3;&#x7684;&#x6A21;&#x62DF;&#xFF0C;&#x5728;&#x9700;&#x8981;&#x5BF9;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x7684;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;Stub&#x6216;&#x8005;Fake&#x3002;&#x4F8B;&#x5982;UnitTest++&#xFF0C;&#x5C31;&#x662F;&#x7528;&#x7684;Stub&#x3002; &#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x6D4B;&#x8BD5;&#x5177;&#x4F53;&#x7684;&#x4EE3;&#x7801;&#x884C;&#x4E3A;&#xFF0C;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x8981;&#x7528;&#x5230;Mock&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x4E86;&#x51E0;&#x6B21;&#xFF0C;&#x7528;&#x7684;&#x4EC0;&#x4E48;&#x53C2;&#x6570;&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x6211;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x5176;&#x5B9E;&#x4ED6;&#x4EEC;&#x4E09;&#x8005;&#x4E4B;&#x95F4;&#x5E76;&#x6CA1;&#x6709;&#x5F88;&#x660E;&#x663E;&#x7684;&#x754C;&#x9650;&#x3002;&#x7528;Mock&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9488;&#x5BF9;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x6A21;&#x62DF;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x6709;&#x529E;&#x6CD5;&#x5C06;&#x4E4B;stub out&#x3002;&#x53EA;&#x662F;Mock&#x5E76;&#x4E0D;&#x64C5;&#x957F;&#xFF0C;&#x65B9;&#x6CD5;&#x4E0D;&#x591F;&#x76F4;&#x89C9;&#x3002;&#x540C;&#x7406;Stub&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x6765;mock&#x6389;&#x4E00;&#x4E9B;&#x5BF9;&#x8C61;&#x3002; Stub/Fake&#x66F4;&#x50CF;&#x662F;&#x5E94;&#x7528;&#x4E8E;&#x9762;&#x5411;&#x63A5;&#x53E3;&#x7F16;&#x7A0B;&#xFF0C;&#x800C;Mock&#x66F4;&#x64C5;&#x957F;&#x4E8E;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x3002;&#x4F55;&#x65F6;&#x4F7F;&#x7528;MockOf course, mocks are not without issues. Designing an accurate mock is difficult, especially if you have no reliable information on the test resource. You can try and find an open-source match, or you can make a guesstimate on the resource&#x2019;s method interface. Whichever you choose, you can update the mock easily later on, should you get more detailed information on the preferred resource. Too many mocks can complicate a test, making it harder for you to track down a failure. Best practice is to limit a test case to one or two mocksor use separate test cases for each mock/subject pairing.&#x5982;&#x4F55;&#x4F7F;&#x7528;constructorclass Mock(spec=None, side_effect=None, return_value=DEFAULT, wraps=None, name=None, spec_set=None, **kwargs)&#x4E3B;&#x8981;&#x53C2;&#x6570;&#x5982;&#x4E0B;&#xFF1A;name: &#x53EA;&#x6709;&#x6807;&#x8BB0;&#x4F5C;&#x7528;&#xFF0C;&#x5728;print&#x6216;&#x8005;repr&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8C03;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x6709;&#x7528;return_value: &#x6700;&#x7B80;&#x5355;&#x7684;&#x5BF9;&#x63A5;&#x53E3;&#x7684;stub&#x5316;side_effect: &#x5176;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x4E3A;&#x5217;&#x8868;&#x6216;&#x51FD;&#x6570;&#xFF0C;&#x82E5;&#x5176;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;DEFAULT&#xFF0C;&#x5219;&#x91C7;&#x7528;return_value&#x7684;&#x503C;&#xFF0C;&#x82E5;&#x5176;&#x8FD4;&#x56DE;&#x503C;&#x4E0D;&#x662F;DEFAULT&#xFF0C;&#x5219;&#x5176;&#x4F1A;&#x8986;&#x76D6;return_value&#x7684;&#x503C;spec: &#x53EF;&#x4EE5;&#x662F;string&#x5217;&#x8868;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;class&#x6216;instance&#x3002;Accessing any attribute not in this list will raise an AttributeError.side_effect&#x4E3A;&#x5217;&#x8868;&gt;&gt;&gt; mock = Mock()&gt;&gt;&gt; mock.side_effect = [3, 2, 1]&gt;&gt;&gt; mock(), mock(), mock()(3, 2, 1)side_effect&#x4E3A;&#x51FD;&#x6570;&#xFF0C;&#x5176;&#x53C2;&#x6570;&#x4E0E;&#x771F;&#x5B9E;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x76F8;&#x540C;&gt;&gt;&gt; side_effect = lambda value: value + 1&gt;&gt;&gt; mock = Mock(side_effect=side_effect)&gt;&gt;&gt; mock(3)4&gt;&gt;&gt; mock(-8)-7&#x5BF9;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x68C0;&#x6D4B;mock&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5C5E;&#x6027;&#xFF1A;calledcall_countcall_argscall_args_list &#x542B;&#x4E49;&#x663E;&#x800C;&#x6613;&#x89C1;&#xFF0C;&#x7528;&#x6CD5;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;method_calls &amp; mock_calls&gt;&gt;&gt; mock = Mock()&gt;&gt;&gt; mock.method()&lt;Mock name=&apos;mock.method()&apos; id=&apos;...&apos;&gt;&gt;&gt;&gt; mock.property.method.attribute()&lt;Mock name=&apos;mock.property.method.attribute()&apos; id=&apos;...&apos;&gt;&gt;&gt;&gt; mock.method_calls[call.method(), call.property.method.attribute()]&gt;&gt;&gt; mock = MagicMock()&gt;&gt;&gt; result = mock(1, 2, 3)&gt;&gt;&gt; mock.first(a=3)&lt;MagicMock name=&apos;mock.first()&apos; id=&apos;...&apos;&gt;&gt;&gt;&gt; mock.second()&lt;MagicMock name=&apos;mock.second()&apos; id=&apos;...&apos;&gt;&gt;&gt;&gt; int(mock)1&gt;&gt;&gt; result(1)&lt;MagicMock name=&apos;mock()()&apos; id=&apos;...&apos;&gt;&gt;&gt;&gt; expected = [call(1, 2, 3), call.first(a=3), call.second(),... call.__int__(), call()(1)]&gt;&gt;&gt; mock.mock_calls == expectedTrueassertMock&#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;assert&#xFF1A;assert_called_onceassert_called_withassert_called_once_withassert_has_callsassert_any_calls &#x524D;&#x9762;&#x4E09;&#x4E2A;&#x5F88;&#x76F4;&#x89C9;&#xFF0C;&#x540E;&#x9762;&#x4E24;&#x4E2A;&#x7A0D;&#x4F5C;&#x89E3;&#x91CA;&#x3002;assert_any_callThe assert assert_any_call() checks if the test subject called a mocked method at any point of the test routine. This is regardless of how many other calls were made between the mocked method and the assert. assert_has_callsThis one looks at a sequence of method calls, checks if they are in the right order and with the right arguments.from mock import Mock, call# The mock specificationclass Foo(object): _fooValue = 123 def callFoo(self): pass def doFoo(self, argValue): pass# create the mock objectmockFoo = Mock(spec = Foo)print mockFoo# returns &lt;Mock spec=&apos;Foo&apos; id=&apos;507120&apos;&gt;mockFoo.callFoo()mockFoo.doFoo(&quot;narf&quot;)mockFoo.doFoo(&quot;zort&quot;)fooCalls = [call.callFoo(), call.dooFoo(&quot;narf&quot;), call.doFoo(&quot;zort&quot;)]mockFoo.assert_has_calls(fooCalls)# AssertionError: Calls not found.# Expected: [call.callFoo(), call.dooFoo(&apos;narf&apos;), call.doFoo(&apos;zort&apos;)]# Actual: [call.callFoo(), call.doFoo(&apos;narf&apos;), call.doFoo(&apos;zort&apos;)]fooCalls = [call.callFoo(), call.dooFoo(&quot;narf&quot;), call.doFoo(&quot;zort&quot;)]mockFoo.assert_has_calls(fooCalls, any_order = True)# AssertionError: (call.dooFoo(&apos;narf&apos;),) not all found in call list&#x9AD8;&#x9636;&#x7279;&#x6027;MagicMock vs. MockWith Mock you can mock magic methods but you have to define them. MagicMock has &#x201C;default implementations of most of the magic methods&#x201C;. If you don&#x2019;t need to test any magic methods, Mock is adequate and doesn&#x2019;t bring a lot of extraneous things into your tests. If you need to test a lot of magic methods MagicMock will save you some time.&#x54EA;&#x4E9B;magic methods&#xFF1F;&#x770B;&#x4E0B;&#x9762;lt: NotImplementedgt: NotImplementedle: NotImplementedge: NotImplementedint : 1contains : Falselen : 1iter : iter([])exit : Falsecomplex : 1jfloat : 1.0bool : Truenonzero : Trueoct : &#x2018;1&#x2019;hex : &#x2018;0x1&#x2019;long : long(1)index : 1hash : default hash for the mockstr : default str for the mockunicode : default unicode for the mocksizeof: default sizeof for the mock&gt;&gt;&gt; mock = MagicMock()&gt;&gt;&gt; int(mock)1&gt;&gt;&gt; len(mock)0&gt;&gt;&gt; hex(mock)&apos;0x1&apos;&gt;&gt;&gt; list(mock)[]&gt;&gt;&gt; object() in mockFalse&#x6240;&#x8C13;magic methods&#x5C31;&#x662F;&#x4E00;&#x4E9B;&#x5185;&#x7F6E;&#x7684;python&#x8FD0;&#x7B97;&#x7B26;&#xFF0C;&#x800C;MagicMock&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x8FD0;&#x7B97;&#x7B26;&#xFF0C;Mock&#x4E0D;&#x652F;&#x6301;mock importMocking Python imports&#x8FD9;&#x91CC;&#x6709;&#x63D0;&#x5230;&#x3002;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x770B;&#x4EE3;&#x7801;# A.pyimport BB.foo()# test.pyA.B = mock.Mock()A.B.foo.return_value = 123mock class constructor&#x76F4;&#x63A5;&#x8D34;&#x4E0A;&#x5B9E;&#x9645;&#x7684;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;mockSMBConnObj = mock.Mock()mockSMBConn = mock.Mock(return_value=mockSMBConnObj) # mock constructormock&#x5BF9;&#x8C61;&#x7684;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x5F53;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;mock&#x5BF9;&#x8C61;&#x4E2D;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5C5E;&#x6027;&#x65F6;&#xFF0C;mock&#x4F1A;&#x81EA;&#x52A8;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x5B50;mock&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x6B63;&#x5728;&#x8BBF;&#x95EE;&#x7684;&#x5C5E;&#x6027;&#x6307;&#x5411;&#x5B83;&#xFF0C;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x5BF9;&#x4E8E;&#x5B9E;&#x73B0;&#x591A;&#x7EA7;&#x5C5E;&#x6027;&#x7684;mock&#x5F88;&#x65B9;&#x4FBF;&#x3002;client = mock.Mock()client.v2_client.get.return_value = &apos;200&apos;&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x4E2D;client.v2_client.get&#x5C31;&#x662F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;mock&#x5BF9;&#x8C61; &#x7C7B;&#x4F3C;&#x81EA;&#x52A8;&#x751F;&#x6210;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x91C7;&#x7528;attach_mock&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;attach_mock&#x4F1A;&#x8BA9;&#x88AB;attach&#x7684;&#x53CC;&#x65B9;&#x5177;&#x6709;&#x7236;&#x5B50;&#x5173;&#x7CFB;&#xFF0C;&#x5219;&#x5BF9;&#x5B50;mock&#x7684;&#x8C03;&#x7528;&#x4F1A;&#x88AB;&#x8BA1;&#x5165;&#x7236;&#x7684;mock_calls&#x3002;&#x53C2;&#x8003;Attaching Mocks as Attributespatch&#x901A;&#x8FC7;patch&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x63A7;&#x5236;Mock&#x5BF9;&#x8C61;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x3002;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x6216;&#x8005;with&#x8BED;&#x53E5;&#x7684;&#x8303;&#x56F4;&#x5185;mock&#x6389;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002; &#x6709;&#x4E0B;&#x9762;decorator&gt;&gt;&gt; @patch(&apos;__main__.SomeClass&apos;)... def function(normal_argument, mock_class):... print mock_class is SomeClass...&gt;&gt;&gt; function(None)Truecontext manager&gt;&gt;&gt; class Class(object):... def method(self):... pass...&gt;&gt;&gt; with patch(&apos;__main__.Class&apos;) as MockClass:... instance = MockClass.return_value... instance.method.return_value = &apos;foo&apos;... assert Class() is instance... assert Class().method() == &apos;foo&apos;patcher&gt;&gt;&gt; Original = Class&gt;&gt;&gt; patcher = patch(&apos;__main__.Class&apos;, spec=True)&gt;&gt;&gt; MockClass = patcher.start()&gt;&gt;&gt; instance = MockClass()&gt;&gt;&gt; assert isinstance(instance, Original)&gt;&gt;&gt; patcher.stop()patch.object&#x548C;patch&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x662F;&#x5199;&#x6CD5;&#x4E0D;&#x540C;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x5BF9;&#x6BD4;&#xFF1A;@patch.object(SomeClass, &apos;class_method&apos;)@patch(&apos;SomeClass.class_method&apos;)patch&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x5176;&#x4ED6;&#x7528;&#x6CD5;&#xFF0C;patch.multiple, patch.dict&#x7B49;&#x7B49;&#x3002;&#x53C2;&#x770B;More Patch&#x5176;&#x4ED6;&#x672A;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x5176;&#x5B9E;&#x8FD8;&#x6709;&#x5F88;&#x591A;mock&#x9AD8;&#x7EA7;&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x6211;&#x60F3;mock&#x6389;win32com&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x641C;&#x5230;&#x7684;&#x8FD9;&#x4E2A;&#x7F51;&#x9875;Mocking out python OS specific imports&#x3002;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF1A; modules = { &quot;_winreg&quot;: mock.MagicMock(), &quot;pythoncom&quot;: mock.MagicMock(), &quot;pywintypes&quot;: mock.MagicMock(), &quot;win32api&quot;: mock.MagicMock(), &quot;win32com&quot;: self.win32com, &quot;win32com.client&quot;: self.win32com.client, &quot;win32file&quot;: mock.MagicMock(), &quot;win32service&quot;: mock.MagicMock(), &quot;win32serviceutil&quot;: mock.MagicMock(), &quot;winerror&quot;: mock.MagicMock(), &quot;wmi&quot;: self.wmimock }self.module_patcher = mock.patch.dict(&quot;sys.modules&quot;, modules)self.module_patcher.start()&#x8FD8;&#x6709;&#x5982;&#x4F55;mock&#x6389;win32com.client&#x7684;&#x5BF9;&#x8C61;&#xFF1F;&#x4F8B;&#x5982;&#xFF0C;&#x5F85;&#x6D4B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;Application = win32com.client.Dispatch(&quot;PowerPoint.Application&quot;)source_ppt = Application.Presentations.Open(path)source_ppt.Slides.InsertFromFile(os.path.abspath(chart), index, 1, 1)&#x56E0;&#x4E3A;&#x5BF9;win32com.client&#x5B9E;&#x73B0;&#x4E00;&#x65E0;&#x6240;&#x77E5;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;mock&#xFF0C;&#x63A8;&#x6D4B;mock&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF0C;&#x8FD8;&#x672A;&#x9A8C;&#x8BC1;mockApp = mock.Mock()with mock.patch(&apos;MyModule.win32com.client.Dispatch&apos;, return_value=mockApp) as mockWin32com: mockPpt = mock.Mock() mockApp.Presnetations.Open.return_value = mockPpt mockPpt.Slides.InsertFromFile.assert_called_once_with(...)&#x56E0;&#x4E3A;python&#x7684;&#x8BED;&#x8A00;&#x7279;&#x6027;&#xFF0C;python&#x7684;Mock&#x6846;&#x67B6;&#x8FD8;&#x662F;&#x6BD4;Java&#x7684;Mock&#x6846;&#x67B6;&#x8981;&#x7075;&#x6D3B;&#x5F88;&#x591A;&#x3002;&#x6BD4;&#x5982;&#xFF1A;&#x5BF9;&#x7C7B;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;Mock&#xFF0C;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#xFF0C;&#x800C;Java&#x5219;&#x9700;&#x8981;&#x7ECF;&#x8FC7;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x3002;&#x8FD8;&#x6709;&#x5BF9;&#x63A5;&#x53E3;&#x7684;fake&#x5316;&#xFF0C;&#x7528;side_effect&#x5F88;&#x5BB9;&#x6613;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;Java Mock&#x5219;&#x8981;&#x7528;&#x5230;when().thenAnswer(){}&#x3002;&#x9EBB;&#x70E6;&#x53C8;&#x4E0D;&#x76F4;&#x89C9;&#x3002;when(...).thenAnswer(new Answer() { @Override public Object answer(InvocationOnMock invocation) throws Throwable { return value; }});%23python%20mock%u521D%u6B65%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5Bpython%2C%20mock%2C%20unittest%5D%0A%0A%5BTOC%5D%0A%0A%u4ECEAndroid%u5355%u5143%u6D4B%u8BD5%u4E2D%uFF0C%u63A5%u89E6%u5230Java%u7684mock%u6846%u67B6%u3002%u53C2%u770B%u8FD9%u7BC7%u7B14%u8BB0%u300A%5BAndroid%u5355%u5143%u6D4B%u8BD5%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/4769d75d-17cc-4dcc-96b8-b746bcae53c1%29%u300B%u3002%u6700%u8FD1%u5728%u505ADashboard%20Generator%uFF0C%u8981%u7528python%u89E3%u6790excel%uFF0Cppt%u548C%u7F51%u9875%uFF0C%u6D4B%u8BD5%u6548%u7387%u6781%u4F4E%u3002%u6240%u4EE5%u8003%u8651%u5230%u53EF%u4EE5%u7528mock%u6765%u4EE3%u66FF%u4E00%u4E9B%u8017%u65F6%u7684%u64CD%u4F5C%u548C%u8D44%u6E90%u3002%u4E8E%u662F%u63A5%u89E6%u5230python%u7684mock%u6846%u67B6%u3002%0Apython%20mock%u57283.0%u4E2D%u5DF2%u7ECF%u96C6%u6210%u4E3A%u5185%u7F6E%u7C7B%uFF0C%u4F46%u662F2.7%u4ECD%u7136%u9700%u8981%u7528pip%u6765%u5B89%u88C5%u3002%u8FD9%u4E5F%u4E0D%u96BE%u3002%u7136%u540E%u5728%u7F51%u4E0A%u641C%u96C6%u4E86%u51E0%u7BC7%u8FD8%u4E0D%u9519%u7684%u6587%u7AE0%uFF0C%u5982%u4E0B%uFF1A%0A-%20%5BPython%20Mock%u7684%u5165%u95E8%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/1cb1675b-d132-408e-a88a-0eeb3d81fcc2%29%0A-%20%5BMocking%20Python%20imports%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/d063563d-dc7d-4373-96a9-a0759de8e970%29%0A-%20%5BUsing%20Mocks%20in%20Python%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/b12c60d1-416d-44da-8d6d-9ad1f39803dd%29%0A-%20%5BMock%u5B98%u65B9%u6587%u6863%5D%28http%3A//www.voidspace.org.uk/python/mock/mock.html%29%0A%0A%23%23%u7B80%u4ECB%0A%u56E0%u4E3A%u662Fpython%u8BED%u8A00%u7684%u7279%u6027%uFF0C%u6240%u4EE5Mock%u4E0A%u624B%u975E%u5E38%u5BB9%u6613%u3002%u7A83%u4EE5%u4E3A%u6BD4Java%28Android%29%20Mock%u8981%u5BB9%u6613%u7684%u591A%u3002%0A%23%23%23Mock%20vs.%20Stub/Fake%0A%u53C2%u770B%5BUsing%20Mocks%20in%20Python%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/b12c60d1-416d-44da-8d6d-9ad1f39803dd%29%uFF0C%u4E5F%u53EF%u4EE5%u53C2%u770BMartin%20Fowler%u7684%u4E00%u7BC7%u6587%u7AE0%5BMocks%20Aren%27t%20Stubs%5D%28https%3A//martinfowler.com/articles/mocksArentStubs.html%29%u3002%0A%u8FD9%u91CC%u63D0%u5230%u4E86Mock%u548CStub/Fake%u7684%u533A%u522B%u3002%u8FD9%u662F%u6211%u4EE5%u524D%u4E00%u76F4%u6CA1%u6709%u6CE8%u610F%u5230%u7684%u3002%0A%0A%23%23%23%23%u4E3A%u4EC0%u4E48%u8981%u7528Mock%uFF1F%0A%3EA%20good%20unit%20test%20has%20to%20be%20**repeatable**%2C%20allowing%20you%20to%20**isolate**%20and%20identify%20a%20fault.%20But%20the%20test%20resource%20might%20give%20out%20stochastic%20results%2C%20or%20it%20might%20have%20widely%20varying%20response%20times.%20And%20as%20a%20result%2C%20you%20end%20up%20glossing%20over%20a%20potential%20showstopper.%0A%0A%u6D4B%u8BD5%u5FC5%u987B%u662F%u53EF%u91CD%u590D%u7684%uFF0C%u89E3%u8026%u7684%u3002%u4F46%u4EE3%u7801%u7528%u5230%u7684%u8FD0%u884C%u65F6%u8D44%u6E90%u5F80%u5F80%u662F%u968F%u673A%u7684%uFF0C%u6216%u8005%u6602%u8D35%u7684%uFF08%u6BD4%u5982%u7F51%u9875%uFF0C%u603B%u662F%u5728%u53D8%u5316%u7684%uFF0C%u6BD4%u5982%uFF0Cdownload%u6587%u4EF6%uFF0C%u975E%u5E38%u8017%u65F6%uFF09%u3002%u6211%u4EEC%u4E0D%u80FD%u8BA9%u6211%u4EEC%u7684%u6D4B%u8BD5%u9996%u5148%u4E0D%u80FD%u4F9D%u8D56%u4E8E%u6D4B%u8BD5%u8D44%u6E90%uFF0C%u5176%u6B21%u9700%u8981%u6709%u6BD4%u8F83%u9AD8%u7684%u6548%u7387%u3002%0A%0A%3EThese%20are%20some%20of%20the%20reasons%20why%20you%20might%20want%20to%20use%20a%20mock%20in%20place%20of%20a%20**test%20resource**.%20A%20mock%20can%20present%20the%20same%20set%20of%20method%20interfaces%20as%20the%20resource%20to%20the%20test%20subject.%20But%20a%20mock%20is%20easier%20to%20setup%2C%20easier%20to%20manage.%20It%20can%20deliver%20deterministic%20results%2C%20and%20it%20can%20be%20customized%20to%20suit%20a%20particular%20test.%20And%20it%20can%20be%20easily%20updated%20to%20reflect%20changes%20in%20the%20actual%20resource.%0A%0A%23%23%23%23Stubs%20%26%20Fake%0AStub%0A%3EA%20stub%20presents%20a%20set%20of%20method%20interfaces%20to%20the%20test%20subject%2C%20the%20same%20set%20the%20subject%20would%20see%20in%20an%20actual%20test%20resource.%20When%20the%20test%20subject%20calls%20a%20stub%20method%2C%20the%20stub%20may%20respond%20with%20a%20predetermined%20set%20of%20results.%20It%20may%20raise%20an%20error%20or%20exception%2C%20also%20predetermined.%20A%20stub%20may%20track%20its%20interactions%20with%20the%20test%20subject%2C%20but%20it%20performs%20no%20tasks%20outside%20the%20narrow%20scope%20of%20its%20programming.%0A%0AFake%0A%3EA%20fake%20also%20presents%20a%20set%20of%20method%20interfaces%20and%20tracks%20its%20interactions%20with%20the%20test%20subject.%20But%20unlike%20a%20stub%2C%20a%20fake%20actually%20processes%20input%20data%20from%20the%20test%20subject%20and%20produces%20results%20based%20on%20that%20data.%20In%20short%2C%20a%20fake%20is%20a%20functional%2C%20but%20non-production%20version%20of%20the%20actual%20test%20resource.%20It%20lacks%20the%20checks%20and%20balances%20found%20in%20resource%2C%20it%20uses%20simpler%20algorithms%2C%20and%20it%20seldom%2C%20if%20ever%2C%20stores%20or%20transports%20data.%0A%0AStub%u548CFake%u90FD%u662F%u9488%u5BF9%u63A5%u53E3%u7684%u6A21%u62DF%uFF0C%u5728%u9700%u8981%u5BF9%u72B6%u6001%u8FDB%u884C%u6D4B%u8BD5%u7684%u60C5%u51B5%u65F6%uFF0C%u6211%u4EEC%u53EF%u4EE5%u7528Stub%u6216%u8005Fake%u3002%u4F8B%u5982UnitTest++%uFF0C%u5C31%u662F%u7528%u7684Stub%u3002%0A%u4F46%u662F%u5982%u679C%u6211%u4EEC%u8981%u6D4B%u8BD5%u5177%u4F53%u7684%u4EE3%u7801%u884C%u4E3A%uFF0C%u6211%u4EEC%u5F80%u5F80%u8981%u7528%u5230Mock%u3002%u6BD4%u5982%uFF0C%u4E00%u4E2A%u51FD%u6570%u8C03%u7528%u4E86%u51E0%u6B21%uFF0C%u7528%u7684%u4EC0%u4E48%u53C2%u6570%uFF0C%u7B49%u7B49%u3002%0A%0A%u6211%u7684%u7406%u89E3%uFF0C%u5176%u5B9E%u4ED6%u4EEC%u4E09%u8005%u4E4B%u95F4%u5E76%u6CA1%u6709%u5F88%u660E%u663E%u7684%u754C%u9650%u3002%u7528Mock%u7684%u65F6%u5019%uFF0C%u9488%u5BF9%u4E00%u4E9B%u9700%u8981%u6A21%u62DF%u7684%u63A5%u53E3%uFF0C%u4ECD%u7136%u53EF%u4EE5%u6709%u529E%u6CD5%u5C06%u4E4Bstub%20out%u3002%u53EA%u662FMock%u5E76%u4E0D%u64C5%u957F%uFF0C%u65B9%u6CD5%u4E0D%u591F%u76F4%u89C9%u3002%u540C%u7406Stub%u4E5F%u53EF%u4EE5%u7528%u6765mock%u6389%u4E00%u4E9B%u5BF9%u8C61%u3002%0AStub/Fake%u66F4%u50CF%u662F%u5E94%u7528%u4E8E%u9762%u5411%u63A5%u53E3%u7F16%u7A0B%uFF0C%u800CMock%u66F4%u64C5%u957F%u4E8E%u9762%u5411%u5BF9%u8C61%u7F16%u7A0B%u3002%0A%0A%23%23%23%23%u4F55%u65F6%u4F7F%u7528Mock%0A%3EOf%20course%2C%20mocks%20are%20not%20without%20issues.%20Designing%20an%20accurate%20mock%20is%20difficult%2C%20especially%20if%20you%20have%20no%20reliable%20information%20on%20the%20test%20resource.%20You%20can%20try%20and%20find%20an%20open-source%20match%2C%20or%20you%20can%20make%20a%20guesstimate%20on%20the%20resource%27s%20method%20interface.%20Whichever%20you%20choose%2C%20you%20can%20update%20the%20mock%20easily%20later%20on%2C%20should%20you%20get%20more%20detailed%20information%20on%20the%20preferred%20resource.%20Too%20many%20mocks%20can%20complicate%20a%20test%2C%20making%20it%20harder%20for%20you%20to%20track%20down%20a%20failure.%20%0A%3E**Best%20practice**%20%0A%3E%20-%20is%20to%20limit%20a%20test%20case%20to%20**one%20or%20two%20mocks**%0A%3E%20-%20or%20use%20**separate%20test%20cases**%20for%20each%20mock/subject%20pairing.%0A%0A%0A%23%23%23%u5982%u4F55%u4F7F%u7528%0A%21%5BAlt%20text%7C400x0%5D%28./1486178612793.png%29%0A%0A%23%23%23%23constructor%0A%60%60%60%0Aclass%20Mock%28spec%3DNone%2C%20side_effect%3DNone%2C%20return_value%3DDEFAULT%2C%20wraps%3DNone%2C%20name%3DNone%2C%20spec_set%3DNone%2C%20**kwargs%29%0A%60%60%60%0A%u4E3B%u8981%u53C2%u6570%u5982%u4E0B%uFF1A%0A-%20name%3A%20%u53EA%u6709%u6807%u8BB0%u4F5C%u7528%uFF0C%u5728print%u6216%u8005repr%u7684%u65F6%u5019%u53EF%u4EE5%u770B%u5230%uFF0C%u8C03%u8BD5%u7684%u65F6%u5019%u6709%u7528%0A-%20return_value%3A%20%u6700%u7B80%u5355%u7684%u5BF9%u63A5%u53E3%u7684stub%u5316%0A-%20side_effect%3A%20%u5176%u53C2%u6570%u53EF%u4EE5%u4E3A%u5217%u8868%u6216%u51FD%u6570%uFF0C%u82E5%u5176%u8FD4%u56DE%u503C%u4E3ADEFAULT%uFF0C%u5219%u91C7%u7528return_value%u7684%u503C%uFF0C%u82E5%u5176%u8FD4%u56DE%u503C%u4E0D%u662FDEFAULT%uFF0C%u5219%u5176%u4F1A%u8986%u76D6return_value%u7684%u503C%0A-%20spec%3A%20%20%u53EF%u4EE5%u662Fstring%u5217%u8868%uFF0C%u4E5F%u53EF%u4EE5%u4E3Aclass%u6216instance%u3002Accessing%20any%20attribute%20not%20in%20this%20list%20will%20raise%20an%20AttributeError.%0A%0Aside_effect%u4E3A%u5217%u8868%0A%60%60%60%0A%3E%3E%3E%20mock%20%3D%20Mock%28%29%0A%3E%3E%3E%20mock.side_effect%20%3D%20%5B3%2C%202%2C%201%5D%0A%3E%3E%3E%20mock%28%29%2C%20mock%28%29%2C%20mock%28%29%0A%283%2C%202%2C%201%29%0A%60%60%60%0Aside_effect%u4E3A%u51FD%u6570%uFF0C%u5176%u53C2%u6570%u4E0E%u771F%u5B9E%u4F20%u5165%u7684%u53C2%u6570%u76F8%u540C%0A%60%60%60%0A%3E%3E%3E%20side_effect%20%3D%20lambda%20value%3A%20value%20+%201%0A%3E%3E%3E%20mock%20%3D%20Mock%28side_effect%3Dside_effect%29%0A%3E%3E%3E%20mock%283%29%0A4%0A%3E%3E%3E%20mock%28-8%29%0A-7%0A%60%60%60%0A%0A%23%23%23%23%u5BF9%u51FD%u6570%u8C03%u7528%u7684%u68C0%u6D4B%0Amock%u5305%u542B%u4EE5%u4E0B%u5C5E%u6027%uFF1A%0A-%20called%0A-%20call_count%0A-%20call_args%0A-%20call_args_list%0A%u542B%u4E49%u663E%u800C%u6613%u89C1%uFF0C%u7528%u6CD5%u53C2%u8003%5B%u5B98%u65B9%u6587%u6863%5D%28http%3A//www.voidspace.org.uk/python/mock/mock.html%29%0A%0Amethod_calls%20%26%20mock_calls%0A%60%60%60%0A%3E%3E%3E%20mock%20%3D%20Mock%28%29%0A%3E%3E%3E%20mock.method%28%29%0A%3CMock%20name%3D%27mock.method%28%29%27%20id%3D%27...%27%3E%0A%3E%3E%3E%20mock.property.method.attribute%28%29%0A%3CMock%20name%3D%27mock.property.method.attribute%28%29%27%20id%3D%27...%27%3E%0A%3E%3E%3E%20mock.method_calls%0A%5Bcall.method%28%29%2C%20call.property.method.attribute%28%29%5D%0A%0A%3E%3E%3E%20mock%20%3D%20MagicMock%28%29%0A%3E%3E%3E%20result%20%3D%20mock%281%2C%202%2C%203%29%0A%3E%3E%3E%20mock.first%28a%3D3%29%0A%3CMagicMock%20name%3D%27mock.first%28%29%27%20id%3D%27...%27%3E%0A%3E%3E%3E%20mock.second%28%29%0A%3CMagicMock%20name%3D%27mock.second%28%29%27%20id%3D%27...%27%3E%0A%3E%3E%3E%20int%28mock%29%0A1%0A%3E%3E%3E%20result%281%29%0A%3CMagicMock%20name%3D%27mock%28%29%28%29%27%20id%3D%27...%27%3E%0A%3E%3E%3E%20expected%20%3D%20%5Bcall%281%2C%202%2C%203%29%2C%20call.first%28a%3D3%29%2C%20call.second%28%29%2C%0A...%20call.__int__%28%29%2C%20call%28%29%281%29%5D%0A%3E%3E%3E%20mock.mock_calls%20%3D%3D%20expected%0ATrue%0A%60%60%60%0A%0A%23%23%23%23assert%0AMock%u63D0%u4F9B%u4E86%u4EE5%u4E0B%u51E0%u79CDassert%uFF1A%0A-%20assert_called_once%0A-%20assert_called_with%0A-%20assert_called_once_with%0A-%20assert_has_calls%0A-%20assert_any_calls%0A%u524D%u9762%u4E09%u4E2A%u5F88%u76F4%u89C9%uFF0C%u540E%u9762%u4E24%u4E2A%u7A0D%u4F5C%u89E3%u91CA%u3002%0A%0Aassert_any_call%0A%3EThe%20assert%20assert_any_call%28%29%20checks%20if%20the%20test%20subject%20called%20a%20mocked%20method%20at%20any%20point%20of%20the%20test%20routine.%20This%20is%20regardless%20of%20how%20many%20other%20calls%20were%20made%20between%20the%20mocked%20method%20and%20the%20assert.%20%0A%0Aassert_has_calls%0A%3EThis%20one%20looks%20at%20a%20sequence%20of%20method%20calls%2C%20checks%20if%20they%20are%20in%20the%20right%20order%20and%20with%20the%20right%20arguments.%0A%0A%60%60%60%0Afrom%20mock%20import%20Mock%2C%20call%0A%20%0A%23%20The%20mock%20specification%0Aclass%20Foo%28object%29%3A%0A%20%20%20%20_fooValue%20%3D%20123%0A%20%20%20%20%20%0A%20%20%20%20def%20callFoo%28self%29%3A%0A%20%20%20%20%20%20%20%20pass%0A%20%20%20%20%20%0A%20%20%20%20def%20doFoo%28self%2C%20argValue%29%3A%0A%20%20%20%20%20%20%20%20pass%0A%20%0A%23%20create%20the%20mock%20object%0AmockFoo%20%3D%20Mock%28spec%20%3D%20Foo%29%0Aprint%20mockFoo%0A%23%20returns%20%3CMock%20spec%3D%27Foo%27%20id%3D%27507120%27%3E%0A%20%0AmockFoo.callFoo%28%29%0AmockFoo.doFoo%28%22narf%22%29%0AmockFoo.doFoo%28%22zort%22%29%0A%20%0AfooCalls%20%3D%20%5Bcall.callFoo%28%29%2C%20call.dooFoo%28%22narf%22%29%2C%20call.doFoo%28%22zort%22%29%5D%0A%20%0AmockFoo.assert_has_calls%28fooCalls%29%0A%23%20AssertionError%3A%20Calls%20not%20found.%0A%23%20Expected%3A%20%5Bcall.callFoo%28%29%2C%20call.dooFoo%28%27narf%27%29%2C%20call.doFoo%28%27zort%27%29%5D%0A%23%20Actual%3A%20%5Bcall.callFoo%28%29%2C%20call.doFoo%28%27narf%27%29%2C%20call.doFoo%28%27zort%27%29%5D%0A%20%0AfooCalls%20%3D%20%5Bcall.callFoo%28%29%2C%20call.dooFoo%28%22narf%22%29%2C%20call.doFoo%28%22zort%22%29%5D%0AmockFoo.assert_has_calls%28fooCalls%2C%20any_order%20%3D%20True%29%0A%23%20AssertionError%3A%20%28call.dooFoo%28%27narf%27%29%2C%29%20not%20all%20found%20in%20call%20list%0A%60%60%60%0A%0A%23%23%u9AD8%u9636%u7279%u6027%0A%23%23%23MagicMock%20vs.%20Mock%0A%3EWith%20Mock%20you%20can%20mock%20magic%20methods%20but%20you%20have%20to%20define%20them.%20MagicMock%20has%20%22%5Bdefault%20implementations%20of%20most%20of%20the%20**magic%20methods**%5D%28http%3A//www.voidspace.org.uk/python/mock/magicmock.html%23mock.MagicMock%29%22.%0A%3EIf%20you%20don%27t%20need%20to%20test%20any%20magic%20methods%2C%20Mock%20is%20adequate%20and%20doesn%27t%20bring%20a%20lot%20of%20extraneous%20things%20into%20your%20tests.%20If%20you%20need%20to%20test%20a%20lot%20of%20magic%20methods%20MagicMock%20will%20save%20you%20some%20time.%0A%0A%u54EA%u4E9Bmagic%20methods%uFF1F%u770B%u4E0B%u9762%0A*%20__lt__%3A%20NotImplemented%0A*%20__gt__%3A%20NotImplemented%0A*%20__le__%3A%20NotImplemented%0A*%20__ge__%3A%20NotImplemented%0A*%20__int__%20%3A%201%0A*%20__contains__%20%3A%20False%0A*%20__len__%20%3A%201%0A*%20__iter__%20%3A%20iter%28%5B%5D%29%0A*%20__exit__%20%3A%20False%0A*%20__complex__%20%3A%201j%0A*%20__float__%20%3A%201.0%0A*%20__bool__%20%3A%20True%0A*%20__nonzero__%20%3A%20True%0A*%20__oct__%20%3A%20%u20181%u2019%0A*%20__hex__%20%3A%20%u20180x1%u2019%0A*%20__long__%20%3A%20long%281%29%0A*%20__index__%20%3A%201%0A*%20__hash__%20%3A%20default%20hash%20for%20the%20mock%0A*%20__str__%20%3A%20default%20str%20for%20the%20mock%0A*%20__unicode__%20%3A%20default%20unicode%20for%20the%20mock%0A*%20__sizeof__%3A%20default%20sizeof%20for%20the%20mock%0A%60%60%60%0A%3E%3E%3E%20mock%20%3D%20MagicMock%28%29%0A%3E%3E%3E%20int%28mock%29%0A1%0A%3E%3E%3E%20len%28mock%29%0A0%0A%3E%3E%3E%20hex%28mock%29%0A%270x1%27%0A%3E%3E%3E%20list%28mock%29%0A%5B%5D%0A%3E%3E%3E%20object%28%29%20in%20mock%0AFalse%0A%60%60%60%0A%u6240%u8C13magic%20methods%u5C31%u662F%u4E00%u4E9B%u5185%u7F6E%u7684python%u8FD0%u7B97%u7B26%uFF0C%u800CMagicMock%u652F%u6301%u8FD9%u4E9B%u8FD0%u7B97%u7B26%uFF0CMock%u4E0D%u652F%u6301%0A%0A%23%23%23mock%20import%0A%5BMocking%20Python%20imports%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/d063563d-dc7d-4373-96a9-a0759de8e970%29%u8FD9%u91CC%u6709%u63D0%u5230%u3002%u5176%u5B9E%u5F88%u7B80%u5355%uFF0C%u770B%u4EE3%u7801%0A%60%60%60%0A%23%20A.py%0Aimport%20B%0AB.foo%28%29%0A%0A%23%20test.py%0AA.B%20%3D%20mock.Mock%28%29%0AA.B.foo.return_value%20%3D%20123%0A%60%60%60%0A%0A%23%23%23mock%20class%20constructor%0A%u76F4%u63A5%u8D34%u4E0A%u5B9E%u9645%u7684%u6D4B%u8BD5%u4EE3%u7801%0A%60%60%60python%0AmockSMBConnObj%20%3D%20mock.Mock%28%29%0AmockSMBConn%20%3D%20mock.Mock%28return_value%3DmockSMBConnObj%29%20%23%20mock%20constructor%0A%60%60%60%0A%0A%23%23%23mock%u5BF9%u8C61%u7684%u81EA%u52A8%u521B%u5EFA%0A%u5F53%u8BBF%u95EE%u4E00%u4E2Amock%u5BF9%u8C61%u4E2D%u4E0D%u5B58%u5728%u7684%u5C5E%u6027%u65F6%uFF0Cmock%u4F1A%u81EA%u52A8%u5EFA%u7ACB%u4E00%u4E2A%u5B50mock%u5BF9%u8C61%uFF0C%u5E76%u4E14%u628A%u6B63%u5728%u8BBF%u95EE%u7684%u5C5E%u6027%u6307%u5411%u5B83%uFF0C%u8FD9%u4E2A%u529F%u80FD%u5BF9%u4E8E%u5B9E%u73B0%u591A%u7EA7%u5C5E%u6027%u7684mock%u5F88%u65B9%u4FBF%u3002%0A%60%60%60%0Aclient%20%3D%20mock.Mock%28%29%0Aclient.v2_client.get.return_value%20%3D%20%27200%27%0A%60%60%60%0A%u4E0A%u9762%u4F8B%u5B50%u4E2D%60client.v2_client.get%60%u5C31%u662F%u81EA%u52A8%u751F%u6210%u7684mock%u5BF9%u8C61%0A%u7C7B%u4F3C%u81EA%u52A8%u751F%u6210%uFF0C%u6211%u4EEC%u8FD8%u53EF%u4EE5%u91C7%u7528%60attach_mock%60%u7684%u65B9%u6CD5%u3002%u4E0D%u540C%u7684%u662F%uFF0Cattach_mock%u4F1A%u8BA9%u88ABattach%u7684%u53CC%u65B9%u5177%u6709%u7236%u5B50%u5173%u7CFB%uFF0C%u5219%u5BF9%u5B50mock%u7684%u8C03%u7528%u4F1A%u88AB%u8BA1%u5165%u7236%u7684mock_calls%u3002%u53C2%u8003%5BAttaching%20Mocks%20as%20Attributes%5D%28http%3A//www.voidspace.org.uk/python/mock/mock.html%23attaching-mocks-as-attributes%29%0A%0A%23%23%23patch%0A%u901A%u8FC7patch%uFF0C%u6211%u4EEC%u53EF%u4EE5%u63A7%u5236Mock%u5BF9%u8C61%u7684%u751F%u5B58%u5468%u671F%u3002%u610F%u601D%u5C31%u662F%u5728%u4E00%u4E2A%u51FD%u6570%u8303%u56F4%u5185%uFF0C%u6216%u8005%u4E00%u4E2A%u7C7B%u7684%u8303%u56F4%u5185%uFF0C%u6216%u8005with%u8BED%u53E5%u7684%u8303%u56F4%u5185mock%u6389%u4E00%u4E2A%u5BF9%u8C61%u3002%0A%u6709%u4E0B%u9762%0A%0Adecorator%0A%60%60%60%0A%3E%3E%3E%20@patch%28%27__main__.SomeClass%27%29%0A...%20def%20function%28normal_argument%2C%20mock_class%29%3A%0A...%20%20%20%20%20print%20mock_class%20is%20SomeClass%0A...%0A%3E%3E%3E%20function%28None%29%0ATrue%0A%60%60%60%0A%0Acontext%20manager%0A%60%60%60%0A%3E%3E%3E%20class%20Class%28object%29%3A%0A...%20%20%20%20%20def%20method%28self%29%3A%0A...%20%20%20%20%20%20%20%20%20pass%0A...%0A%3E%3E%3E%20with%20patch%28%27__main__.Class%27%29%20as%20MockClass%3A%0A...%20%20%20%20%20instance%20%3D%20MockClass.return_value%0A...%20%20%20%20%20instance.method.return_value%20%3D%20%27foo%27%0A...%20%20%20%20%20assert%20Class%28%29%20is%20instance%0A...%20%20%20%20%20assert%20Class%28%29.method%28%29%20%3D%3D%20%27foo%27%0A%60%60%60%0A%0Apatcher%0A%60%60%60%0A%3E%3E%3E%20Original%20%3D%20Class%0A%3E%3E%3E%20patcher%20%3D%20patch%28%27__main__.Class%27%2C%20spec%3DTrue%29%0A%3E%3E%3E%20MockClass%20%3D%20patcher.start%28%29%0A%3E%3E%3E%20instance%20%3D%20MockClass%28%29%0A%3E%3E%3E%20assert%20isinstance%28instance%2C%20Original%29%0A%3E%3E%3E%20patcher.stop%28%29%0A%60%60%60%0A%0Apatch.object%u548Cpatch%u7C7B%u4F3C%uFF0C%u53EA%u662F%u5199%u6CD5%u4E0D%u540C%uFF0C%u770B%u4E0B%u9762%u5BF9%u6BD4%uFF1A%0A%60%60%60%0A@patch.object%28SomeClass%2C%20%27class_method%27%29%0A@patch%28%27SomeClass.class_method%27%29%0A%60%60%60%0A%0Apatch%u8FD8%u6709%u5F88%u591A%u79CD%u5176%u4ED6%u7528%u6CD5%uFF0Cpatch.multiple%2C%20patch.dict%u7B49%u7B49%u3002%u53C2%u770B%5BMore%20Patch%5D%28http%3A//www.voidspace.org.uk/python/mock/patch.html%23patch-dict%29%0A%0A%23%23%23%u5176%u4ED6%u672A%u51B3%u7684%u95EE%u9898%0A%u5176%u5B9E%u8FD8%u6709%u5F88%u591Amock%u9AD8%u7EA7%u7684%u7528%u6CD5%uFF0C%u4F8B%u5982%uFF0C%u5F53%u6211%u60F3mock%u6389win32com%u7684%u65F6%u5019%uFF0C%u641C%u5230%u7684%u8FD9%u4E2A%u7F51%u9875%5BMocking%20out%20python%20OS%20specific%20imports%5D%28http%3A//ilostmynotes.blogspot.com/2014/10/mocking-out-python-os-specific-imports.html%29%u3002%u5176%u4E2D%u6709%u4E00%u6BB5%u4EE3%u7801%uFF1A%0A%60%60%60%0A%20modules%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%22_winreg%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22pythoncom%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22pywintypes%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22win32api%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22win32com%22%3A%20self.win32com%2C%0A%20%20%20%20%20%20%20%20%22win32com.client%22%3A%20self.win32com.client%2C%0A%20%20%20%20%20%20%20%20%22win32file%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22win32service%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22win32serviceutil%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22winerror%22%3A%20mock.MagicMock%28%29%2C%0A%20%20%20%20%20%20%20%20%22wmi%22%3A%20self.wmimock%0A%20%20%20%20%20%20%20%20%7D%0A%0Aself.module_patcher%20%3D%20mock.patch.dict%28%22sys.modules%22%2C%20modules%29%0Aself.module_patcher.start%28%29%0A%60%60%60%0A%u8FD8%u6709%u5982%u4F55mock%u6389win32com.client%u7684%u5BF9%u8C61%uFF1F%u4F8B%u5982%uFF0C%u5F85%u6D4B%u4EE3%u7801%u5982%u4E0B%0A%60%60%60%0AApplication%20%3D%20win32com.client.Dispatch%28%22PowerPoint.Application%22%29%0Asource_ppt%20%3D%20Application.Presentations.Open%28path%29%0Asource_ppt.Slides.InsertFromFile%28os.path.abspath%28chart%29%2C%20index%2C%201%2C%201%29%0A%60%60%60%0A%u56E0%u4E3A%u5BF9%60win32com.client%60%u5B9E%u73B0%u4E00%u65E0%u6240%u77E5%uFF0C%u4E0D%u77E5%u9053%u5982%u4F55mock%uFF0C%u63A8%u6D4Bmock%u4EE3%u7801%u5982%u4E0B%uFF0C%u8FD8%u672A%u9A8C%u8BC1%0A%60%60%60%0AmockApp%20%3D%20mock.Mock%28%29%0Awith%20mock.patch%28%27MyModule.win32com.client.Dispatch%27%2C%20return_value%3DmockApp%29%20as%20mockWin32com%3A%0A%09mockPpt%20%3D%20mock.Mock%28%29%0A%09mockApp.Presnetations.Open.return_value%20%3D%20mockPpt%0A%09mockPpt.Slides.InsertFromFile.assert_called_once_with%28...%29%0A%60%60%60%0A%0A%23%u603B%u7ED3%0A%u56E0%u4E3Apython%u7684%u8BED%u8A00%u7279%u6027%uFF0Cpython%u7684Mock%u6846%u67B6%u8FD8%u662F%u6BD4Java%u7684Mock%u6846%u67B6%u8981%u7075%u6D3B%u5F88%u591A%u3002%u6BD4%u5982%uFF1A%u5BF9%u7C7B%u6784%u9020%u51FD%u6570%u7684Mock%uFF0C%u975E%u5E38%u5BB9%u6613%uFF0C%u800CJava%u5219%u9700%u8981%u7ECF%u8FC7%u7279%u6B8A%u5904%u7406%u3002%u8FD8%u6709%u5BF9%u63A5%u53E3%u7684fake%u5316%uFF0C%u7528side_effect%u5F88%u5BB9%u6613%u5B9E%u73B0%uFF0C%u4F46%u662FJava%20Mock%u5219%u8981%u7528%u5230%60when%28%29.thenAnswer%28%29%7B%7D%60%u3002%u9EBB%u70E6%u53C8%u4E0D%u76F4%u89C9%u3002%0A%60%60%60%0Awhen%28...%29.thenAnswer%28new%20Answer%28%29%20%7B%0A%09@Override%0A%09public%20Object%20answer%28InvocationOnMock%20invocation%29%20throws%20Throwable%20%7B%0A%09%09return%20value%3B%0A%09%7D%0A%7D%29%3B%0A%60%60%60%0A]]></content>
      <tags>
        <tag>python</tag>
        <tag>unittest</tag>
        <tag>mock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[敏捷软件开发－原则、模式与实践]]></title>
    <url>%2F2017%2F01%2F22%2F%E6%95%8F%E6%8D%B7%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%EF%BC%8D%E5%8E%9F%E5%88%99%E3%80%81%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%AE%9E%E8%B7%B5%2F</url>
    <content type="text"><![CDATA[Edit&#x654F;&#x6377;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#xFF0D;&#x539F;&#x5219;&#x3001;&#x6A21;&#x5F0F;&#x4E0E;&#x5B9E;&#x8DF5;&#x7B2C;1-6&#x7AE0;&#x654F;&#x6377;&#x5B9E;&#x8DF5;&#x7684;&#x539F;&#x5219;&#x6781;&#x9650;&#x7F16;&#x7A0B;&#x7B2C;7-12&#x7AE0;SRPOCPLSPDIPISP&#x59D4;&#x6258;&#x591A;&#x91CD;&#x7EE7;&#x627F;ISP&#x7684;&#x4E24;&#x70B9;&#x5EFA;&#x8BAE;&#x7B2C;13-19&#x7AE0;COMMAND &amp; ACTIVE OBJECT&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;COMMAND&#x6A21;&#x5F0F;&#xFF1F;ACTIVE OBJECT&#x5462;&#xFF1F;TEMPLATE METHOD &amp; STRATEGYTEMPLATE METHODSTRATEGYFACADE &amp; MEDIATORFACADEMEDIATORSINGLETON &amp; MONOSTATE&#x4F55;&#x65F6;&#x9700;&#x8981;&#x5355;&#x4F8B;&#xFF1F;SINGLETONMONOSTATENULL OBJECT&#x6A21;&#x5F0F;&#x8FDB;&#x9636;NULL OBJECT&#x7B2C;20-22&#x7AE0;FACTORY&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;FACTORY&#xFF1F;&#x5305;&#x8BBE;&#x8BA1;&#x539F;&#x5219;&#x7C92;&#x5EA6;3&#x539F;&#x5219;&#x2014;&#x2014;&#x5982;&#x4F55;&#x51B3;&#x5B9A;&#x54EA;&#x4E9B;&#x7C7B;&#x5E94;&#x5F53;&#x653E;&#x5165;&#x4E00;&#x4E2A;&#x5305;REP &#x2014;&#x2014;Reuse-Release Equivalence Principle &#x91CD;&#x7528;&#x53D1;&#x5E03;&#x7B49;&#x6548;&#x539F;&#x5219;CRP&#x2014;&#x2014;Common Reuse Principle&#x5171;&#x540C;&#x91CD;&#x7528;&#x539F;&#x5219;CCP&#x2014;&#x2014;Common Close Principle&#x5171;&#x540C;&#x5C01;&#x95ED;&#x539F;&#x5219;&#x7A33;&#x5B9A;&#x6027;&#x539F;&#x5219;&#x89E3;&#x9664;&#x4F9D;&#x8D56;&#x73AF;&#x7684;&#x65B9;&#x6CD5;23-27&#x7AE0;COMPOSITEOBSERVER&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x2014;&#x2014;&#x63A8;&amp;&#x62C9;ABSTRACT SERVER, ADAPTER&amp;BRIDGEABSTRACT SERVER&#x8C01;&#x62E5;&#x6709;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;ADAPTERBRIDGEBridge&#x6A21;&#x5F0F;&#x4E00;&#x4E9B;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#x654F;&#x6377;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x4E2D;&#x7684;Bridge&#x6A21;&#x5F0F;PROXYSTAIRWAY TO HEAVEN&#x7BA1;&#x7406;&#x7B2C;&#x4E09;&#x65B9;API28-30&#x7AE0;VISITORACYCLIC VISITOR&#x6A21;&#x5F0F;&#x4E3A;&#x4F55;&#x6709;ACYCLIC&#x53D8;&#x4F53;ACYCLIC VISITOR&#x4F55;&#x65F6;&#x4F7F;&#x7528;VISITOR&#x6A21;&#x5F0F;&#x62A5;&#x8868;&#x751F;&#x6210;&#x5668;&#x5176;&#x4ED6;DECORATOREXTENSION OBJECT&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;EXTENSION OBJECTSTATESTATE vs. STRATEGYSMC&#x2014;&#x2014;&#x72B6;&#x6001;&#x673A;&#x7F16;&#x8BD1;&#x5668;&#x7B2C;1-6&#x7AE0;&#x654F;&#x6377;&#x5B9E;&#x8DF5;&#x7684;&#x539F;&#x5219;&#x4EBA;&#x6BD4;&#x5DE5;&#x5177;&#x91CD;&#x8981;&#xFF0C;&#x5E94;&#x5148;&#x6784;&#x5EFA;&#x56E2;&#x961F;&#xFF0C;&#x518D;&#x8BA9;&#x56E2;&#x961F;&#x57FA;&#x4E8E;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x76F4;&#x5230;&#x8FEB;&#x5207;&#x9700;&#x8981;&#x5E76;&#x4E14;&#x610F;&#x4E49;&#x91CD;&#x5927;&#x65F6;&#xFF0C;&#x624D;&#x6765;&#x7F16;&#x5236;&#x6587;&#x6863;&#x3002;&#x9488;&#x5BF9;&#x7CFB;&#x7EDF;&#x539F;&#x7406;&#x548C;&#x7ED3;&#x6784;&#x65B9;&#x9762;&#x7684;&#x6587;&#x6863;&#xFF0C;&#x5E94;&#x4EC5;&#x8BBA;&#x8FF0;&#x7CFB;&#x7EDF;&#x7684;&#x9AD8;&#x5C42;&#x7ED3;&#x6784;&#x548C;&#x6982;&#x62EC;&#x7684;&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x5BA2;&#x6237;&#x5408;&#x540C;&#x6307;&#x5BFC;&#x534F;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8BD5;&#x56FE;&#x53BB;&#x89C4;&#x5B9A;&#x9879;&#x76EE;&#x8303;&#x56F4;&#x7684;&#x7EC6;&#x8282;&#x548C;&#x56FA;&#x5B9A;&#x6210;&#x672C;&#x4E0B;&#x7684;&#x8FDB;&#x5EA6;&#x3002;&#x4E3A;&#x4E0B;&#x4E24;&#x5468;&#x505A;&#x8BE6;&#x7EC6;&#x7684;&#x8BA1;&#x5212;&#xFF0C;&#x4E3A;&#x4E0B;&#x4E09;&#x4E2A;&#x6708;&#x505A;&#x7C97;&#x7565;&#x7684;&#x8BA1;&#x5212;&#xFF0C;&#x518D;&#x4EE5;&#x540E;&#x5C31;&#x505A;&#x6781;&#x4E3A;&#x7C97;&#x7CD9;&#x7684;&#x8BA1;&#x5212;&#x3002;&#x6781;&#x9650;&#x7F16;&#x7A0B;&#x5BA2;&#x6237;&#x4F5C;&#x4E3A;&#x56E2;&#x961F;&#x6210;&#x5458; &#xA0; * &#x7528;&#x6237;&#x7D20;&#x6750;(user stories): UML Use Case&#x56FE;&#x7684;Feature&#x3002;&#x53C2;&#x770B;UML Distilled&#x7B14;&#x8BB0;&#x3002;&#x5728;XP&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x548C;&#x5BA2;&#x6237;&#x53CD;&#x590D;&#x8BA8;&#x8BBA;&#xFF0C;&#x4EE5;&#x83B7;&#x53D6;&#x5BF9;&#x4E8E;&#x9700;&#x6C42;&#x7EC6;&#x8282;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x53BB;&#x6355;&#x83B7;&#x90A3;&#x4E9B;&#x7EC6;&#x8282;&#x3002;&#x6211;&#x4EEC;&#x66F4;&#x613F;&#x610F;&#x5BA2;&#x6237;&#x5728;&#x7D22;&#x5F15;&#x5361;&#x7247;&#x4E0A;&#x5199;&#x4E0B;&#x4E00;&#x4E9B;&#x6211;&#x4EEC;&#x8BA4;&#x53EF;&#x7684;&#x8BCD;&#x8BED;&#xFF0C;&#x8FD9;&#x4E9B;&#x8BCD;&#x8BED;&#x53EF;&#x4EE5;&#x63D0;&#x9192;&#x6211;&#x4EEC;&#x8BB0;&#x8D77;&#x8FD9;&#x6B21;&#x4EA4;&#x8C08;&#x3002;&#x57FA;&#x672C;&#x4E0A;&#x5728;&#x548C;&#x5BA2;&#x6237;&#x8FDB;&#x884C;&#x4E66;&#x5199;&#x7684;&#x540C;&#x4E00;&#x523B;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728;&#x8BE5;&#x5361;&#x7247;&#x4E0A;&#x5199;&#x4E0B;&#x5BF9;&#x5E94;&#x4E8E;&#x5361;&#x7247;&#x4E0A;&#x9700;&#x6C42;&#x7684;&#x4F30;&#x7B97;&#x3002;&#x4F30;&#x7B97;&#x65F6;&#x57FA;&#x4E8E;&#x548C;&#x5BA2;&#x6237;&#x8FDB;&#x884C;&#x4EA4;&#x8C08;&#x671F;&#x95F4;&#x6240;&#x5F97;&#x5230;&#x7684;&#x5BF9;&#x4E8E;&#x7EC6;&#x8282;&#x7684;&#x7406;&#x89E3;&#x8FDB;&#x884C;&#x7684;&#x3002;&#x77ED;&#x4EA4;&#x4ED8;&#x5468;&#x671F;&#xFF0C;&#x6BCF;2&#x5468;&#x8FED;&#x4EE3;&#x4E00;&#x6B21;&#xFF0C;&#x5E76;&#x4EA4;&#x4ED8;&#x5BA2;&#x6237;&#x4F7F;&#x7528;&#xFF0C;&#x6BCF;12&#x5468;&#x4E00;&#x6B21;&#x53D1;&#x5E03;&#x6BCF;&#x6B21;&#x4EA4;&#x4ED8;&#x90FD;&#x6709;&#x5BA2;&#x6237;&#x9488;&#x5BF9;feature&#x7684;&#x9A8C;&#x6536;&#x6D4B;&#x8BD5;&#x7ED3;&#x5BF9;&#x7F16;&#x7A0B;&#x96C6;&#x4F53;&#x6240;&#x6709;&#x6743;&#xFF0C;&#x6307;&#x4E0D;&#x56FA;&#x5B9A;expert&#xFF0C;&#x51ED;&#x5174;&#x8DA3;&#x51B3;&#x5B9A;&#x60F3;&#x505A;&#x7684;&#x65B9;&#x5411;&#x3002;&#x6301;&#x7EED;&#x96C6;&#x6210;&#xFF0C;&#x7C7B;&#x540C;&#x7B2C;2&#x70B9;&#x53EF;&#x6301;&#x7EED;&#x7684;&#x5F00;&#x53D1;&#x901F;&#x5EA6;&#x3002;&#x4E0D;&#x5141;&#x8BB8;&#x52A0;&#x73ED;&#xFF0C;&#x7248;&#x672C;&#x53D1;&#x5E03;&#x524D;&#x4E00;&#x4E2A;&#x793C;&#x62DC;&#x4F8B;&#x5916;&#x8F6F;&#x4EF6;&#x9879;&#x76EE;&#x4E0D;&#x662F;&#x5168;&#x901F;&#x7684;&#x77ED;&#x8DD1;&#xFF0C;&#x5B83;&#x662F;&#x9A6C;&#x62C9;&#x677E;&#x957F;&#x8DD1;&#x3002;&#x5F00;&#x653E;&#x7684;&#x5DE5;&#x4F5C;&#x7A7A;&#x95F4;&#x8BA1;&#x5212;&#x6E38;&#x620F;&#x7B80;&#x5355;&#x7684;&#x8BBE;&#x8BA1; XP&#x56E2;&#x961F;&#x603B;&#x662F;&#x5C3D;&#x53EF;&#x80FD;&#x5BFB;&#x627E;&#x80FD;&#x5B9E;&#x73B0;&#x5F53;&#x524D;feature&#x7684;&#x6700;&#x7B80;&#x5355;&#x7684;&#x8BBE;&#x8BA1;&#x91CD;&#x6784;&#x662F;&#x6301;&#x7EED;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x6BCF;&#x9694;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x6216;&#x534A;&#x4E2A;&#x5C0F;&#x65F6;&#x5C31;&#x8981;&#x53BB;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x9690;&#x55BB; &#xFF08;&#x6CA1;&#x770B;&#x61C2;&#xFF09;&#x603B;&#x7ED3;&#xFF0C;&#x8FD9;&#x91CC;&#x6781;&#x9650;&#x7F16;&#x7A0B;&#x5176;&#x5B9E;&#x5F3A;&#x8C03;&#x7684;&#x66F4;&#x591A;&#x7684;&#x662F;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x7684;&#x8FD0;&#x4F5C;&#x65B9;&#x5F0F;&#xFF0C;&#x9700;&#x8981;&#x5404;&#x65B9;&#x9762;&#x8FBE;&#x6210;&#x4E00;&#x81F4;&#xFF0C;&#x624D;&#x80FD;&#x4E25;&#x683C;&#x6309;&#x7167;&#x4ED6;&#x7684;&#x6BCF;&#x4E00;&#x6761;&#x53BB;&#x505A;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5373;&#x4FBF;&#x5728;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x7684;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x6781;&#x9650;&#x7F16;&#x7A0B;&#x8FD8;&#x662F;&#x654F;&#x6377;&#x65B9;&#x6CD5;&#x90FD;&#x4E0D;&#x4E3A;&#x4EBA;&#x6240;&#x77E5;&#xFF0C;&#x6CA1;&#x529E;&#x6CD5;&#x5B8C;&#x5168;&#x5F00;&#x5C55;&#x3002;&#x4F46;&#x662F;&#x91CC;&#x9762;&#x7684;&#x4E00;&#x4E9B;&#x89C2;&#x70B9;&#x5F88;&#x6709;&#x542F;&#x53D1;&#x610F;&#x4E49;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x5230;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x7684;&#x9879;&#x76EE;&#x5F53;&#x4E2D;&#x3002;&#x6BD4;&#x5982;&#x7B2C;&#x4E00;&#x70B9;&#xFF0C;&#x8981;&#x6C42;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5B9E;&#x65F6;&#x540C;&#x5BA2;&#x6237;&#x4EA4;&#x6D41;&#xFF0C;&#x5E76;&#x9009;&#x5B9A;feature&#x6216;&#x53CA;&#x65F6;&#x4FEE;&#x6539;&#x5F00;&#x53D1;&#x65B9;&#x6848;&#x3002;&#x7B2C;&#x4E8C;&#x70B9;&#xFF0C;&#x4E0D;&#x65AD;&#x7684;&#x4EA4;&#x4ED8;&#x3002;&#x5176;&#x5B9E;&#x90FD;&#x53EF;&#x4EE5;&#x9A6C;&#x4E0A;&#x8FD0;&#x7528;&#x4E0A;&#x3002;&#x7B2C;7-12&#x7AE0;&#x867D;&#x7136;&#x4E66;&#x6CA1;&#x770B;&#x5B8C;&#xFF0C;&#x4F46;&#x662F;&#x611F;&#x89C9;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x662F;&#x5168;&#x4E66;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x5373;&#x654F;&#x6377;&#x5F00;&#x53D1;&#x7684;&#x539F;&#x5219;&#x3002;&#x4EC0;&#x4E48;&#x662F;&#x654F;&#x6377;&#x8BBE;&#x8BA1;&#xFF1F; &#x654F;&#x6377;&#x8BBE;&#x8BA1;&#x662F;&#x4E00;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E00;&#x4E2A;&#x6301;&#x7EED;&#x7684;&#x5E94;&#x7528;&#x539F;&#x5219;&#x3001;&#x6A21;&#x5F0F;&#x4EE5;&#x53CA;&#x5B9E;&#x8DF5;&#x6765;&#x6539;&#x8FDB;&#x8F6F;&#x4EF6;&#x7684;&#x7ED3;&#x6784;&#x548C;&#x53EF;&#x8BFB;&#x6027;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x6362;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5C31;&#x662F;&#x4E0D;&#x8981;&#x968F;&#x968F;&#x4FBF;&#x4FBF;&#x6253;&#x8865;&#x4E01;&#xFF0C;&#x8BA9;&#x7A0B;&#x5E8F;&#x80FD;&#x8FD0;&#x884C;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#x4FEE;&#x6539;&#xFF0C;&#x800C;&#x662F;&#x5E94;&#x7528;&#x5404;&#x79CD;&#x65B9;&#x6CD5;&#x4F7F;&#x7A0B;&#x5E8F;&#x66F4;&#x5177;&#x5F39;&#x6027;&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x53C8;&#x4E0D;&#x4E3A;&#x4E86;&#x4FEE;&#x6539;&#x800C;&#x4FEE;&#x6539;&#xFF0C;&#x4E0D;&#x4E3A;&#x4E86;&#x5B50;&#x865A;&#x4E4C;&#x6709;&#x7684;&#x5F39;&#x6027;&#xFF0C;&#x82B1;&#x8D39;&#x989D;&#x5916;&#x7684;&#x7CBE;&#x529B;&#x6765;&#x8FBE;&#x5230;&#x60F3;&#x8C61;&#x4E2D;&#x7684;&#x5F39;&#x6027;&#x8BBE;&#x8BA1;&#x3002;8-12&#x7AE0;&#x4E3A;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8BBE;&#x8BA1;&#x7684;5&#x539F;&#x5219;&#xFF1A;SRP: &#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;OCP: &#x5F00;&#x653E;&#x5C01;&#x95ED;&#x539F;&#x5219;LSP: Linskov&#x66FF;&#x6362;&#x539F;&#x5219;DIP: &#x4F9D;&#x8D56;&#x5012;&#x7F6E;&#x539F;&#x5219;ISP: &#x63A5;&#x53E3;&#x9694;&#x79BB;&#x539F;&#x5219;&#x9010;&#x4E00;&#x6458;&#x5F55;&#x5982;&#x4E0B;&#xFF1A;SRP&#x5728;SRP&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x804C;&#x8D23;&#x5B9A;&#x4E49;&#x4E3A;&#x201C;&#x53D8;&#x5316;&#x7684;&#x539F;&#x56E0;&#x201D;&#x3002;&#x5982;&#x679C;&#x4F60;&#x80FD;&#x60F3;&#x5230;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x7684;&#x52A8;&#x673A;&#x53BB;&#x6539;&#x53D8;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7C7B;&#x5C31;&#x5177;&#x6709;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x7684;&#x804C;&#x8D23;&#x3002; &#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x53D8;&#x5316;&#x65B9;&#x5F0F;&#x603B;&#x662F;&#x5BFC;&#x81F4;&#x8FD9;&#x4E24;&#x4E2A;&#x804C;&#x8D23;&#x540C;&#x65F6;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x5FC5;&#x5206;&#x79BB;&#x4ED6;&#x4EEC;&#x3002;&#x7B2C;&#x4E00;&#x6B21;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x6211;&#x4EEC;&#x5E38;&#x89C1;&#x7684; NA &#x5206;&#x79BB;&#x8FC7;&#x804C;&#x8D23;&#x4EE5;&#x540E; NA &#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#x53D8;&#x5316;&#x9891;&#x7387;&#x975E;&#x5E38;&#x4E0D;&#x4E00;&#x81F4;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x7684;&#x8303;&#x56F4;&#x3002;OCP&#x5BF9;&#x4E8E;&#x6269;&#x5C55;&#x5F00;&#x653E;&#x5BF9;&#x4E8E;&#x4FEE;&#x6539;&#x5173;&#x95ED;&#x600E;&#x4E48;&#x80FD;&#x505A;&#x5230;&#x5462;&#xFF1F;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#xFF1A;&#x62BD;&#x8C61;&#x7C7B;&#x548C;&#x5B83;&#x4EEC;&#x7684;&#x5BA2;&#x6237;&#x7684;&#x5173;&#x7CFB;&#x8981;&#x6BD4;&#x548C;&#x5B9E;&#x73B0;&#x5B83;&#x4EEC;&#x7684;&#x7C7B;&#x7684;&#x5173;&#x7CFB;&#x66F4;&#x5BC6;&#x5207;&#x3002; &#x610F;&#x601D;&#x662F;&#xFF0C;Client&#x4E0E;Client Interface&#x7684;&#x5173;&#x7CFB;&#x8981;&#x6BD4;&#x5176;&#x4E0E;Server&#x7684;&#x5173;&#x7CFB;&#x66F4;&#x5BC6;&#x5207;&#x3002;&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x8FD9;&#x4E2A;&#x539F;&#x5219;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x5F88;&#x6E05;&#x6670;&#x4E86;&#xFF0C;&#x4F46;&#x4F5C;&#x8005;&#x5E0C;&#x671B;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#x66F4;&#x591A;&#x3002;&#x5728;&#x300A;&#x662F;&#x7684;&#xFF0C;&#x6211;&#x8BF4;&#x8C0E;&#x4E86;&#x300B;&#x90A3;&#x4E00;&#x8282;&#x91CC;&#xFF0C;&#x4F5C;&#x8005;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#xFF0C;&#x4E8B;&#x5B9E;&#x5E76;&#x4E0D;&#x603B;&#x50CF;&#x60F3;&#x8C61;&#x4E2D;&#x90A3;&#x4E48;&#x7F8E;&#x597D;&#x3002;&#x5F80;&#x5F80;&#x4F1A;&#x6709;&#x5404;&#x79CD;&#x7A00;&#x5947;&#x53E4;&#x602A;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x5BFC;&#x81F4;&#x539F;&#x5148;&#x7684;&#x8BBE;&#x8BA1;&#x4E0D;&#x80FD;&#x5BF9;&#x8BE5;&#x9700;&#x6C42;&#x5BFC;&#x81F4;&#x7684;&#x53D8;&#x5316;&#x5C01;&#x95ED;&#x3002;&#x4F5C;&#x8005;&#x7ED9;&#x4E86;&#x6211;&#x4EEC;&#x5FE0;&#x544A;&#xFF1A;&#x8BBE;&#x8BA1;&#x4EBA;&#x5458;&#x5FC5;&#x987B;&#x5BF9;&#x4E8E;&#x4ED6;&#x8BBE;&#x8BA1;&#x7684;&#x6A21;&#x5757;&#x5E94;&#x8BE5;&#x5BF9;&#x54EA;&#x79CD;&#x53D8;&#x5316;&#x5C01;&#x95ED;&#x505A;&#x51FA;&#x9009;&#x62E9;&#x3002;&#x4ED6;&#x5FC5;&#x987B;&#x5148;&#x731C;&#x6D4B;&#x51FA;&#x6700;&#x4F18;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x79CD;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x6784;&#x9020;&#x62BD;&#x8C61;&#x6765;&#x9694;&#x79BB;&#x90A3;&#x4E9B;&#x53D8;&#x5316;&#x3002; &#x8FD9;&#x662F;&#x5F88;&#x4E0D;&#x5BB9;&#x6613;&#x505A;&#x5230;&#x7684;&#xFF0C;&#x8981;&#x6839;&#x636E;&#x7ECF;&#x9A8C;&#x731C;&#x6D4B;&#x54EA;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x751F;&#x957F;&#x5386;&#x7A0B;&#x4E2D;&#x6709;&#x53EF;&#x80FD;&#x7684;&#x53D8;&#x5316;&#x3002;&#x5982;&#x4F55;&#x9694;&#x79BB;&#x53D8;&#x5316;&#xFF1A;&#x5728;&#x53D1;&#x73B0;&#x7B2C;&#x4E00;&#x6B21;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x8FDB;&#x884C;&#x62BD;&#x8C61;&#x6539;&#x9020;&#x3002;&#x901A;&#x8FC7;&#x6D4B;&#x8BD5;+&#x5FEB;&#x901F;&#x8FED;&#x4EE3;&#x6765;&#x523A;&#x6FC0;&#x53D8;&#x5316;&#xFF0C;&#x5C3D;&#x5FEB;&#x5C06;&#x53D8;&#x5316;&#x7684;&#x53EF;&#x80FD;&#x66B4;&#x9732;&#x51FA;&#x6765;&#x3002;&#x672C;&#x7AE0;&#x8FD8;&#x4ECB;&#x7ECD;&#x4E86;&#x4E00;&#x79CD;&#x5F88;&#x5B9E;&#x7528;&#x7684;&#x5C01;&#x95ED;&#x53D8;&#x5316;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528;&#x201C;&#x6570;&#x636E;&#x9A71;&#x52A8;&#x201D;&#x65B9;&#x6CD5;&#x3002;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8868;&#x683C;&#x9A71;&#x52A8;&#x3002;&#x5C06;&#x53D8;&#x5316;&#x7684;&#x90E8;&#x5206;&#x603B;&#x7ED3;&#x56FA;&#x5316;&#x5230;&#x8868;&#x683C;&#x4E2D;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5E94;&#x8BE5;&#x4EC5;&#x4EC5;&#x5BF9;&#x7A0B;&#x5E8F;&#x4E2D;&#x5448;&#x73B0;&#x51FA;&#x9891;&#x7E41;&#x53D8;&#x5316;&#x7684;&#x90A3;&#x4E9B;&#x90E8;&#x5206;&#x505A;&#x51FA;&#x62BD;&#x8C61;&#x3002;&#x62D2;&#x7EDD;&#x4E0D;&#x6210;&#x719F;&#x7684;&#x62BD;&#x8C61;&#x548C;&#x62BD;&#x8C61;&#x672C;&#x8EAB;&#x4E00;&#x6837;&#x91CD;&#x8981;LSPLSP - &#x5B50;&#x7C7B;&#x578B;&#xFF08;&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#x5FC5;&#x987B;&#x80FD;&#x591F;&#x66FF;&#x6362;&#x6389;&#x5B83;&#x4EEC;&#x7684;&#x57FA;&#x7C7B;&#x578B;&#xFF08;&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#x3002;Linskov&#x9996;&#x6B21;&#x63D0;&#x51FA;&#x8FD9;&#x4E2A;&#x539F;&#x5219;&#x3002; &#x672C;&#x7AE0;&#x4E3E;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x6B63;&#x65B9;&#x5F62;vs.&#x77E9;&#x5F62;&#x3002;&#x4EE5;&#x5E38;&#x7406;&#x63A8;&#x8BBA;&#x6B63;&#x65B9;&#x5F62;IS-A&#x77E9;&#x5F62;&#xFF0C;&#x6240;&#x4EE5;&#x6B63;&#x65B9;&#x5F62;&#x7684;&#x7C7B;&#x5E94;&#x5F53;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#x81EA;&#x77E9;&#x5F62;&#x7684;&#x7C7B;&#x3002;&#x4F46;&#x4EE5;&#x66FF;&#x6362;&#x539F;&#x5219;&#x770B;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x6B63;&#x65B9;&#x5F62;&#x548C;&#x77E9;&#x5F62;&#x7684;&#x884C;&#x4E3A;&#x5E76;&#x4E0D;&#x4E00;&#x81F4;&#x3002;void g (Rectangle&amp; r){ r.SetWidth(5); r.SetHeight(4); assert(r.Area() == 20);}&#x5982;&#x679C;r&#x4F20;&#x5165;&#x7684;&#x662F;&#x6B63;&#x65B9;&#x5F62;&#x5BF9;&#x8C61;&#xFF0C;&#x5219;&#x5FC5;&#x7136;&#x4F1A;&#x51FA;&#x65AD;&#x8A00;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E0D;&#x7B26;&#x5408;LSP&#x3002;OOD&#x4E2D;IS-A&#x5173;&#x7CFB;&#x662F;&#x5C31;&#x884C;&#x4E3A;&#x65B9;&#x5F0F;&#x800C;&#x8A00;&#x3002;&#x53EF;&#x89C1;&#xFF0C;&#x867D;&#x7136;&#x4EE3;&#x7801;&#x662F;&#x73B0;&#x5B9E;&#x751F;&#x6D3B;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x4F46;&#x4E5F;&#x4E0D;&#x5B8C;&#x5168;&#x662F;&#x3002;&#x5982;&#x4F55;&#x89C4;&#x907F;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x53D1;&#x73B0;&#x8FD9;&#x79CD;&#x5FAE;&#x5999;&#x7684;&#x4E0D;&#x540C;&#x3002;&#x4F5C;&#x8005;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x57FA;&#x4E8E;&#x5951;&#x7EA6;&#x7684;&#x8BBE;&#x8BA1;&#x3002;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x524D;&#x540E;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x6765;&#x786E;&#x5B9A;&#x662F;&#x5426;IS-A&#x5173;&#x7CFB;&#x3002;&#x6D3E;&#x751F;&#x7C7B;&#x4E2D;&#x7684;&#x4F8B;&#x7A0B;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x76F8;&#x7B49;&#x6216;&#x66F4;&#x5F31;&#x7684;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#x6765;&#x66FF;&#x6362;&#x539F;&#x59CB;&#x7684;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x76F8;&#x7B49;&#x6216;&#x66F4;&#x5F3A;&#x7684;&#x540E;&#x7F6E;&#x6761;&#x4EF6;&#x6765;&#x66FF;&#x6362;&#x539F;&#x59CB;&#x7684;&#x540E;&#x7F6E;&#x6761;&#x4EF6;&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E2D;&#x6307;&#x5B9A;&#x524D;&#x540E;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x6765;&#x770B;&#x662F;&#x5426;&#x6EE1;&#x8DB3;IS-A&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6EE1;&#x8DB3;&#x5C31;&#x8981;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1;&#x3002;&#x6240;&#x8C13;&#x6761;&#x4EF6;&#x5F3A;&#xFF0C;&#x5373;&#x7EA6;&#x675F;&#x591A;&#xFF0C;&#x6761;&#x4EF6;&#x5F31;&#xFF0C;&#x5373;&#x7EA6;&#x675F;&#x5C11;&#x3002;&#x5982;&#x4F55;&#x8BA9;&#x4EE3;&#x7801;&#x505A;&#x5230;LSP&#xFF0C;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x6452;&#x5F03;&#x66FE;&#x7ECF;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;&#x5728;&#x5B9E;&#x8DF5;&#x4E2D;&#xFF0C;&#x603B;&#x7ED3;&#x4E24;&#x4E2A;&#x7C7B;&#x884C;&#x4E3A;&#x4E00;&#x81F4;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x5E76;&#x63D0;&#x53D6;&#x51FA;&#x516C;&#x6709;&#x7684;&#x62BD;&#x8C61;&#x7236;&#x7C7B;&#x3002;&#x4E0B;&#x56FE;&#x662F;&#x4F8B;&#x5B50;&#x6709;&#x53EF;&#x80FD;&#x5F15;&#x8D77;&#x8FDD;&#x53CD;LSP&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;&#x6D3E;&#x751F;&#x7C7B;&#x4E2D;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x4E3A;&#x7A7A;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x867D;&#x7136;&#x6CA1;&#x6709;&#x8FDD;&#x53CD;LSP&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x4F1A;&#x5F15;&#x8D77;&#x5F15;&#x7528;&#x7236;&#x7C7B;&#x6307;&#x9488;&#x65F6;&#x7684;&#x5FAE;&#x5999;&#x533A;&#x522B;&#x3002;&#x4ECE;&#x6D3E;&#x751F;&#x7C7B;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x660E;&#x663E;&#x8FDD;&#x72AF;LSP&#xFF0C;&#x5982;&#x679C;&#x8981;&#x9075;&#x5FAA;LSP&#xFF0C;&#x8981;&#x4E48;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7236;&#x7C7B;&#x53CA;&#x4F7F;&#x7528;&#x9884;&#x671F;&#xFF0C;&#x8981;&#x4E48;&#x4E0D;&#x629B;&#x5F02;&#x5E38;&#x3002;&#x603B;&#x7ED3;&#xFF1A;&#x5B50;&#x7C7B;&#x578B;&#x7684;&#x6B63;&#x786E;&#x5B9A;&#x4E49;&#x662F;&#x201C;&#x53EF;&#x66FF;&#x6362;&#x6027;&#x7684;&#x201D;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x53EF;&#x66FF;&#x6362;&#x6027;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x663E;&#x5F0F;&#x6216;&#x8005;&#x9690;&#x5F0F;&#x7684;&#x5951;&#x7EA6;&#x6765;&#x5B9A;&#x4E49;&#x3002;DIP&#x8FD9;&#x4E00;&#x6761;&#x5F88;&#x6709;&#x542F;&#x793A;&#x610F;&#x4E49;&#x3002;&#x4EE5;&#x524D;&#x4ECE;&#x6765;&#x6CA1;&#x8FD9;&#x4E48;&#x60F3;&#x8FC7;&#xFF0C;&#x4F46;&#x7ECF;&#x4F5C;&#x8005;&#x4E00;&#x8BF4;&#xFF0C;&#x5176;&#x5B9E;&#x89E3;&#x7B54;&#x4E4B;&#x524D;&#x5F88;&#x591A;&#x7684;&#x7591;&#x60D1;&#x3002;&#x65E0;&#x8BBA;&#x5982;&#x4F55;&#x9AD8;&#x5C42;&#x6A21;&#x5757;&#x90FD;&#x4E0D;&#x5E94;&#x8BE5;&#x4F9D;&#x8D56;&#x4E8E;&#x4F4E;&#x5C42;&#x6A21;&#x5757;&#x3002;&#x6211;&#x4EEC;&#x66F4;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x91CD;&#x7528;&#x7684;&#x662F;&#x9AD8;&#x5C42;&#x7684;&#x7B56;&#x7565;&#x8BBE;&#x7F6E;&#x6A21;&#x5757;&#x3002; &#x4F55;&#x4E3A;&#x9AD8;&#x5C42;&#x7B56;&#x7565;&#xFF1F; &#x5B83;&#x662F;&#x5E94;&#x7528;&#x80CC;&#x540E;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x662F;&#x90A3;&#x4E9B;&#x4E0D;&#x968F;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x7684;&#x6539;&#x53D8;&#x800C;&#x6539;&#x53D8;&#x7684;&#x771F;&#x7406;Lamp&#x5E76;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E;Button&#xFF0C;&#x800C;&#x662F;Button&#x4F9D;&#x8D56;&#x4E8E;Lamp&#x63D0;&#x4F9B;&#x51FA;&#x7684;&#x63A5;&#x53E3;ButtonServer&#x3002;&#x800C;&#x8FD9;&#x4E2A;interface&#x4E5F;&#x4E0D;&#x5C40;&#x9650;&#x4E8E;Button&#xFF0C;&#x5176;&#x5B9E;&#x53EA;&#x8981;&#x6709;&#x5F00;&#x5173;&#x7B56;&#x7565;&#x7684;&#x5177;&#x4F53;&#x7C7B;&#x90FD;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x3002;&#x4F46;&#x662F;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x4F4E;&#x5C42;&#x7C7B;&#x7EDF;&#x7EDF;&#x4F9D;&#x8D56;&#x4E8E;&#x8FD9;&#x4E2A;&#x9AD8;&#x5C42;&#x63D0;&#x4F9B;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x800C;&#x4F4E;&#x5C42;&#x6A21;&#x5757;&#xFF0C;&#x5982;Button&#x7684;&#x4FEE;&#x6539;&#x5E76;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;Lamp&#x3002; &#x6709;&#x4E00;&#x5929;Lamp&#x9700;&#x8981;&#x4FEE;&#x6539;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x90FD;&#x4F1A;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x9AD8;&#x5C42;&#x5F71;&#x54CD;&#x4F4E;&#x5C42;&#x3002;&#x4F46;&#x662F;Lamp&#x662F;&#x9AD8;&#x5C42;&#x7B56;&#x7565;&#xFF0C;&#x662F;&#x9690;&#x55BB;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x7ECF;&#x5E38;&#x6539;&#x53D8;&#x3002;&#x518D;&#x770B;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x3002; &#x539F;&#x59CB;&#x7684;&#x7B97;&#x6CD5;&#x5982;&#x4E0B;ISP&#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x53EB;&#x63A5;&#x53E3;&#x6C61;&#x67D3;&#x3002; &#x4F55;&#x4E3A;&#x63A5;&#x53E3;&#x6C61;&#x67D3;&#xFF1F;&#x770B;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x63A5;&#x53E3;&#x9694;&#x79BB;&#x539F;&#x5219;&#xFF1A;&#x4E0D;&#x5E94;&#x8BE5;&#x5F3A;&#x8FEB;&#x5BA2;&#x6237;&#x4F9D;&#x8D56;&#x4E8E;&#x5B83;&#x4EEC;&#x4E0D;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5B9E;&#x73B0;ISP&#x7684;&#x4E24;&#x4E2A;&#x9014;&#x5F84;&#x59D4;&#x6258;&#x8FD9;&#x4E2A;&#x4E0D;&#x592A;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6309;&#x4F5C;&#x8005;&#x7684;&#x8BF4;&#x6CD5;&#x4E5F;&#x4E0D;&#x662F;&#x5F88;&#x597D;&#x3002;&#x5F53;Timed Door&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5B9A;&#x65F6;&#x4F8B;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Door Timer Adapter&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4EE5;Timer Client&#x7684;&#x5F62;&#x5F0F;&#x6CE8;&#x518C;&#x7ED9;Timer&#x5F53;Timer&#x8BA1;&#x65F6;&#x5230;&#x8FBE;&#x65F6;&#xFF0C;Door Timer Adapter&#x7684;Timeout&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x8FDB;&#x800C;&#x56E0;&#x4E3A;&#x59D4;&#x6258;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;Timed Door&#x7684;DoorTimeOut&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x5C31;&#x4E0D;&#x9700;&#x8981;Door&#x6765;&#x5B9E;&#x73B0;Timer&#x63A5;&#x53E3;&#xFF0C;&#x9632;&#x6B62;&#x4E86;&#x63A5;&#x53E3;&#x6C61;&#x67D3;&#x3002;&#x7F3A;&#x70B9;&#x662F;&#xFF0C;&#x6BCF;&#x6B21;&#x9700;&#x8981;&#x5B9A;&#x65F6;&#x7A0B;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Door Timer Adapter&#x5BF9;&#x8C61;&#xFF0C;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#x3002;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x770B;&#x4E0A;&#x9762;&#x7684;&#x59D4;&#x6258;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x60F3;&#x5230;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x4E86;&#x3002;&#x53EA;&#x8981;&#x5BF9;TimedDoor&#x91C7;&#x7528;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x65E2;&#x4E0D;&#x5F71;&#x54CD;Door&#x7684;&#x5176;&#x4ED6;&#x5B50;&#x7C7B;&#xFF0C;&#x53C8;&#x80FD;&#x4F7F;TimedDoor&#x5177;&#x6709;Timer&#x548C;Door&#x7684;&#x53CC;&#x91CD;&#x529F;&#x80FD;&#x3002; &#x91C7;&#x7528;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x540E;&#xFF0C;&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x53D8;&#x6210;&#xFF1A;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x70B9;&#x8981;&#x6CE8;&#x610F;&#xFF1A;&#x5E94;&#x8BE5;&#x8FD9;&#x6837;&#x5199;&#xFF1A;&#x4E5F;&#x4E0D;&#x8981;&#x8FD9;&#x6837;&#x5199;&#xFF1A;&#x5F15;&#x7533;&#x4E0B;&#x6765;void g(DepositUI&amp;, TransferUI&amp;);void g(UI&amp;);&#x54EA;&#x79CD;&#x5199;&#x6CD5;&#x597D;&#xFF1F;&#x5176;&#x5B9E;&#x4E00;&#x76EE;&#x4E86;&#x7136;&#x3002;&#x80AF;&#x5B9A;&#x662F;&#x7B2C;&#x4E00;&#x79CD;&#xFF0C;&#x867D;&#x7136;&#x770B;&#x8D77;&#x6765;&#x6709;&#x70B9;&#x5570;&#x55E6;&#x3002;&#x4F5C;&#x8005;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#x4E86;&#xFF1A;&#x65E0;&#x8BBA;&#x662F;&#x5426;&#x6709;&#x6096;&#x5E38;&#x7406;&#xFF0C;&#x591A;&#x53C2;&#x6570;&#x5F62;&#x5F0F;&#x901A;&#x5E38;&#x90FD;&#x5E94;&#x8BE5;&#x4F18;&#x4E8E;&#x5355;&#x53C2;&#x6570;&#x5F62;&#x5F0F;&#x4F7F;&#x7528;&#x3002;ISP&#x7684;&#x4E24;&#x70B9;&#x5EFA;&#x8BAE;&#x5BF9;&#x5BA2;&#x6237;&#x5206;&#x7EC4;&#x3002;&#x5C31;&#x50CF;&#x4E0A;&#x9762;ATM&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5BF9;Transaction&#x5206;&#x7C7B;&#x9694;&#x79BB;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x5BA2;&#x6237;&#x8981;&#x6C42;&#x7684;&#x670D;&#x52A1;&#x53EF;&#x80FD;&#x6709;&#x91CD;&#x53E0;&#xFF0C;&#x5982;&#x679C;&#x91CD;&#x53E0;&#x5C11;&#x5C31;&#x9694;&#x79BB;&#xFF0C;&#x91CD;&#x53E0;&#x591A;&#x5C31;&#x62BD;&#x53D6;&#x516C;&#x5171;&#x62BD;&#x8C61;&#x7C7B;&#x3002;&#x6539;&#x53D8;&#x63A5;&#x53E3;&#x5C3D;&#x91CF;&#x901A;&#x8FC7;&#x65B0;&#x52A0;&#x63A5;&#x53E3;&#x6765;&#x505A;&#xFF0C;&#x907F;&#x514D;&#x4FEE;&#x6539;&#x73B0;&#x6709;&#x63A5;&#x53E3;&#x3002;&#x56E0;&#x4E3A;&#x4F60;&#x7684;&#x5B50;&#x7C7B;&#x53EF;&#x80FD;&#x6B63;&#x5728;&#x7528;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x3002;&#x7B2C;13-19&#x7AE0;&#x672C;&#x4E66;&#x7684;&#x7B2C;&#x4E09;~&#x516D;&#x90E8;&#x5206;&#xFF0C;&#x7ED3;&#x5408;4&#x4E2A;&#x6BD4;&#x8F83;&#x5927;&#x578B;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8BB2;&#x89E3;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;&#x672C;&#x90E8;&#x5206;&#x6D89;&#x53CA;&#x7684;&#x6A21;&#x5F0F;&#x6709;&#xFF1A;COMMAND &amp; ACTIVE OBJECTTEMPLATE METHOD &amp; STRATEGYFACADE &amp; MEDIATORSINGLETON &amp; MONOSTATENULL OBJECT &#x5176;&#x5B9E;&#x6BCF;&#x4E2A;&#x6A21;&#x5F0F;&#xFF0C;&#x5728;&#x770B;&#x4E66;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7ED3;&#x5408;&#x4F5C;&#x8005;&#x7ED9;&#x51FA;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4E5F;&#x77E5;&#x9053;&#x4ED6;&#x5728;&#x8BF4;&#x4EC0;&#x4E48;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x60F3;&#x8981;&#x5E94;&#x7528;&#x5230;&#x5B9E;&#x9645;&#x7684;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x8FD8;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x96BE;&#x5EA6;&#x7684;&#x3002;&#x4F5C;&#x8005;&#x5728;&#x540E;&#x6587;&#x4E2D;&#xFF0C;&#x4E5F;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x6559;&#x8BFB;&#x8005;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x62BD;&#x8C61;&#x603B;&#x7ED3;&#x5BFB;&#x627E;&#x9002;&#x5408;&#x81EA;&#x5DF1;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;&#x4F46;&#x662F;&#x4E0D;&#x7BA1;&#x600E;&#x4E48;&#x8BF4;&#xFF0C;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x7279;&#x70B9;&#x548C;&#x76EE;&#x7684;&#x603B;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x6E05;&#x9192;&#x7684;&#x8BA4;&#x8BC6;&#xFF0C;&#x624D;&#x80FD;&#x7075;&#x6D3B;&#x7684;&#x52A0;&#x4EE5;&#x5E94;&#x7528;&#x3002;COMMAND &amp; ACTIVE OBJECT&#x8FD9;&#x4E24;&#x4E2A;&#x6A21;&#x5F0F;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x5BF9;&#x64CD;&#x4F5C;&#x7684;&#x5C01;&#x88C5;&#x3002;ACTIVE OBJECT&#x6A21;&#x5F0F;&#x57FA;&#x4E8E;COMMAND&#x6A21;&#x5F0F;&#x3002;&#x4E0B;&#x56FE;&#x5C31;&#x662F;COMMAND&#x6A21;&#x5F0F;&#xFF1A;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;COMMAND&#x6A21;&#x5F0F;&#xFF1F;COMMAND&#x6A21;&#x5F0F;&#x53EF;&#x4EE5;&#x5206;&#x79BB;&#x64CD;&#x4F5C;&#x53D1;&#x8D77;&#x8005;&#x548C;&#x64CD;&#x4F5C;&#x672C;&#x8EAB;&#x3002;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x9700;&#x8981;sensor&#x9A71;&#x52A8;&#x4E8B;&#x4EF6;&#x7684;&#x6A21;&#x578B;&#x3002;&#x82E5;&#x4E0D;&#x91C7;&#x7528;COMMAND&#x6A21;&#x5F0F;&#xFF0C;sensor&#x9700;&#x8981;&#x77E5;&#x9053;&#x8C03;&#x7528;&#x4EC0;&#x4E48;&#x51FD;&#x6570;&#x505A;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x3002;&#x82E5;&#x91C7;&#x7528;COMMAND&#x6A21;&#x5F0F;&#x540E;&#xFF0C;&#x9AD8;&#x5C42;&#x7684;&#x638C;&#x63E1;&#x4E8B;&#x4EF6;&#x903B;&#x8F91;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x5BF9;sensor&#x548C;&#x4E8B;&#x4EF6;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#xFF0C;&#x4E4B;&#x540E;sensor&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x4E8B;&#x4EF6;&#x8FDB;&#x884C;&#x65E0;&#x5DEE;&#x522B;&#x7684;&#x8C03;&#x7528;&#xFF08;command-&gt;do()&#xFF09;&#x3002;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x4E8B;&#x4EF6;&#x6267;&#x884C;&#x8005;&#x548C;&#x4E8B;&#x4EF6;&#x672C;&#x8EAB;&#x7684;&#x89E3;&#x8026;&#x3002;ACTIVE OBJECT&#x5462;&#xFF1F;ACTIVE OBJECT&#x57FA;&#x4E8E;COMMAND&#x6A21;&#x5F0F;&#xFF0C;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x7B80;&#x5355;&#x7ED3;&#x6784;&#xFF1A;public class ActiveObject{ Command itsCommands[]; public void run(){ for each command{ do(); } } public void addCommand(Command cmd) { itsCommands.append(cmd); }}&#x8BE5;&#x6A21;&#x5F0F;&#x5206;&#x79BB;&#x4E86;&#x4EFB;&#x52A1;&#x7684;&#x63D0;&#x4EA4;&#x4E0E;&#x4EFB;&#x52A1;&#x7684;&#x8FD0;&#x884C;&#x3002;&#x6309;&#x4F5C;&#x8005;&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x5E76;&#x53C2;&#x8003;&#x7F51;&#x4E0A;&#x5176;&#x4ED6;&#x7684;&#x7B14;&#x8BB0;&#xFF0C;&#x8FD9;&#x4E2A;&#x53E4;&#x8001;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x5F80;&#x5F80;&#x4F1A;&#x5E26;&#x6765;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x597D;&#x6548;&#x679C;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x6A21;&#x62DF;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x7EBF;&#x7A0B;&#x4F8B;&#x7A0B;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;active object&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;Command&#x7684;do&#x63A5;&#x53E3;&#x4E2D;&#x51B3;&#x5B9A;&#x4E0B;&#x4E00;&#x6B65;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x63A7;&#x5236;&#x6574;&#x4E2A;active object&#x8FD0;&#x884C;&#x8FD8;&#x662F;&#x505C;&#x6B62;&#x7684;&#x6548;&#x679C;&#x3002;TEMPLATE METHOD &amp; STRATEGYTEMPLATE METHOD&#x5728;&#x6211;&#x770B;&#x6765;&#xFF0C;TEMPLATE METHOD&#x5E76;&#x4E0D;&#x80FD;&#x79F0;&#x4E3A;&#x4E00;&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x53EA;&#x662F;&#x628A;&#x4E00;&#x4E9B;&#x76F8;&#x540C;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x62BD;&#x8C61;&#x6210;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x57FA;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x6240;&#x6709;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x91CD;&#x7528;&#x8FD9;&#x4E2A;&#x6D41;&#x7A0B;&#x3002;&#x4F46;&#x8FD9;&#x5F80;&#x5F80;&#x6CA6;&#x4E3A;&#x9E21;&#x808B;&#xFF0C;&#x56E0;&#x4E3A;&#x6D3E;&#x751F;&#x7C7B;&#x603B;&#x662F;&#x5728;&#x67D0;&#x4E2A;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x8868;&#x73B0;&#x51FA;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x7136;&#x540E;&#x6574;&#x4E2A;&#x62BD;&#x8C61;&#x7684;&#x7ED3;&#x6784;&#x5C31;&#x88AB;&#x8865;&#x4E01;&#x6253;&#x7684;&#x9762;&#x76EE;&#x5168;&#x975E;&#x3002;&#x4F5C;&#x8005;&#x8BF4;&#xFF0C;&#x5BF9;TEMPLATE METHOD&#x4E00;&#x5B9A;&#x8981;&#x614E;&#x4E4B;&#x53C8;&#x614E;&#xFF0C;&#x5F80;&#x5F80;&#x4F1A;&#x51FA;&#x73B0;&#x6A21;&#x5F0F;&#x6EE5;&#x7528;&#x7684;&#x60C5;&#x51B5;&#x3002; TEMPLATE METHOD&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x5178;&#x578B;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5C31;&#x662F;Bubble Sort&#x3002;&#x4E0D;&#x7BA1;&#x662F;&#x5BF9;&#x6570;&#x5B57;&#x505A;&#x5192;&#x6CE1;&#xFF0C;&#x8FD8;&#x662F;&#x5BF9;&#x5B57;&#x7B26;&#x505A;&#x5192;&#x6CE1;&#xFF0C;&#x8FD8;&#x662F;&#x5BF9;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x505A;&#x5192;&#x6CE1;&#xFF0C;&#x5176;&#x6838;&#x5FC3;&#x7B97;&#x6CD5;&#x603B;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x5176;&#x4E0D;&#x540C;&#x5728;&#x4E8E;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x6BD4;&#x8F83;&#x64CD;&#x4F5C;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x4EA4;&#x6362;&#x64CD;&#x4F5C;&#x5982;&#x6B64;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x7684;&#x4F7F;&#x7528;TEMPLATE METHOD&#x4E86;&#x3002;&#x628A;&#x8FD9;&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;&#x4F5C;&#x4E3A;&#x63A5;&#x53E3;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#xFF0C;&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x7684;&#x6838;&#x5FC3;&#x7B97;&#x6CD5;&#x5C31;&#x662F;TEMPLATE METHOD&#x4E86;&#x3002; &#x6211;&#x89C9;&#x5F97;&#x53EA;&#x6709;&#x5728;&#x8FD9;&#x79CD;&#x8D85;&#x7ECF;&#x5178;&#x7684;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;TEMPLATE METHOD&#x3002;&#x5426;&#x5219;&#x8FD8;&#x662F;&#x8003;&#x8651;&#x5176;&#x4ED6;&#x6A21;&#x5F0F;&#x5427;&#x3002;STRATEGYFACADE &amp; MEDIATORFACADE&#x5F53;&#x60F3;&#x8981;&#x4E3A;&#x4E00;&#x7EC4;&#x5177;&#x6709;&#x590D;&#x6742;&#x4E14;&#x5168;&#x9762;&#x7684;&#x63A5;&#x53E3;&#x7684;&#x5BF9;&#x8C61;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x4E14;&#x7279;&#x5B9A;&#x7684;&#x63A5;&#x53E3;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x961F;FACADE&#x6A21;&#x5F0F; &#x3002;MEDIATORSINGLETON &amp; MONOSTATE&#x8FD9;&#x4E24;&#x4E2A;&#x6A21;&#x5F0F;&#x90FD;&#x662F;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x4E2A;&#x5173;&#x6CE8;&#x7ED3;&#x6784;&#xFF08;SINGLETON&#xFF09;&#xFF0C;&#x4E00;&#x4E2A;&#x5173;&#x6CE8;&#x884C;&#x4E3A;&#xFF08;MONOSTATE&#xFF09;&#x3002;&#x4F55;&#x65F6;&#x9700;&#x8981;&#x5355;&#x4F8B;&#xFF1F;&#x4F5C;&#x8005;&#x5728;&#x672C;&#x7AE0;&#x5F00;&#x7BC7;&#x7684;&#x65F6;&#x5019;&#x8BF4;&#xFF0C;&#x90A3;&#x4E9B;&#x5F3A;&#x5236;&#x5BF9;&#x8C61;&#x5355;&#x4E00;&#x6027;&#x7684;&#x673A;&#x5236;&#x4F3C;&#x4E4E;&#x6709;&#x4E9B;&#x591A;&#x4F59;&#x3002;&#x6BD5;&#x7ADF; &#xFF0C;&#x5728;&#x521D;&#x59CB;&#x5316;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x53EA;&#x521B;&#x5EFA;&#x6BCF;&#x4E2A; &#x5BF9;&#x8C61;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x8BE5;&#x5B9E;&#x4F8B;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x4E5F;&#x662F;&#x6700;&#x597D;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5728;&#x6CA1;&#x6709;&#x6025;&#x8FEB;&#x5E76;&#x4E14;&#x6709;&#x610F;&#x4E49;&#x7684;&#x9700;&#x8981; &#x65F6;&#xFF0C;&#x5E94;&#x8BE5;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x673A;&#x5236;&#x3002;&#x90A3;&#x5230;&#x5E95;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x624D;&#x662F;&#x4F7F;&#x7528;SINGLETON&#x7684;&#x6B63;&#x786E;&#x65F6;&#x673A;&#x5462;&#xFF1F;&#x4F5C;&#x8005;&#x63A5;&#x7740;&#x8BF4;&#x4E86;&#x6211;&#x4EEC;&#x4E5F;&#x5E0C;&#x671B;&#x4EE3;&#x7801;&#x80FD;&#x591F;&#x4F20;&#x8FBE;&#x6211;&#x4EEC;&#x7684;&#x610F;&#x56FE;&#x3002;&#x5982;&#x679C;&#x5F3A;&#x5236;&#x5BF9;&#x8C61;&#x5355;&#x4E00;&#x6027;&#x7684;&#x673A;&#x5236;&#x662F;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4F20;&#x8FBE;&#x610F;&#x56FE;&#x5E26;&#x6765;&#x7684;&#x6536;&#x76CA;&#x5C31;&#x4F1A;&#x80DC;&#x8FC7;&#x5B9E;&#x65BD;&#x8FD9;&#x4E9B;&#x673A;&#x5236;&#x7684;&#x4EE3;&#x4EF7;&#x3002;&#x6240;&#x4EE5;&#x4F7F;&#x7528;&#x5355;&#x4F8B;&#x8981;&#x7B26;&#x5408;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#xFF1A;&#x673A;&#x5236;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x903B;&#x8F91;&#x8981;&#x7B80;&#x5355;&#x9700;&#x8981;&#x4F20;&#x8FBE;&#x53EA;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x7684;&#x610F;&#x56FE;&#x4F5C;&#x8005;&#x5728;&#x672C;&#x7AE0;&#x7ED3;&#x5C3E;&#x5904;&#x6307;&#x51FA;&#xFF1A;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x900F;&#x8FC7;&#x6D3E;&#x751F;&#x53BB;&#x7EA6;&#x675F;&#x4E00;&#x4E2A;&#x73B0;&#x5B58;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4ECB;&#x610F;&#x5B83;&#x7684;&#x6240;&#x6709;&#x8C03;&#x7528;&#x8005;&#x90FD;&#x5FC5;&#x987B;&#x8981;&#x8C03;&#x7528;instance()&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x6743;&#xFF0C;&#x90A3;&#x4E48;SINGLETON&#x662F;&#x6700;&#x5408;&#x9002;&#x7684;&#x3002;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x7C7B;&#x7684;&#x5355;&#x4E00;&#x6027;&#x672C;&#x8D28;&#x5BF9;&#x4F7F;&#x7528;&#x8005;&#x900F;&#x660E;&#xFF0C;&#x6216;&#x8005;&#x5E0C;&#x671B;&#x4F7F;&#x7528;&#x5355;&#x4E00;&#x5BF9;&#x8C61;&#x7684;&#x591A;&#x6001;&#x6D3E;&#x751F;&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x4E48;MONOSTATE&#x662F;&#x6700;&#x9002;&#x5408;&#x7684;&#x3002;&#x5E94;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&#x5DE5;&#x5382;&#x5BF9; &#x8C61;(factories)&#xFF0C;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x3002;&#x7BA1;&#x7406;&#x5668;(managers)&#x5BF9;&#x8C61;&#xFF0C;&#x8D1F;&#x8D23;&#x7BA1;&#x7406;&#x67D0;&#x4E9B;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x5E76;&#x4EE5;&#x5408;&#x9002;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x63A7;&#x5236;&#x5B83;&#x4EEC;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x7C7B;&#x5B9E;&#x4F8B;&#x4E00;&#x65E6;&#x4EA7;&#x751F;&#x8D85;&#x8FC7;&#x4E00;&#x4E2A;&#xFF0C;&#x5C31;&#x4F1A;&#x56E0;&#x4E3A;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x7684;&#x540C;&#x6B65;&#x95EE;&#x9898;&#xFF0C;&#x4EA7;&#x751F;&#x903B;&#x8F91;&#x95EE;&#x9898;&#x3002;SINGLETONpublic class Singleton { private static Singleton theInsLance = null; private Singleton() {} public static Singleton Instance() { if (theIristance == null) theInstance = new Singleton(); return theInstance; }}&#x79C1;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x901A;&#x8FC7;static&#x63A5;&#x53E3;&#x6765;&#x505A;&#x5B9E;&#x4F8B;&#x5316;&#xFF0C;&#x63A7;&#x5236;&#x7C7B;&#x5B9E;&#x4F8B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x3002; &#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x662F;Phoenix&#x4EE3;&#x7801;&#x4E2D;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x3002;class Child : public Parent{ Child(){}}class Factory{ static Parent* Instance () { static Child child; return &amp;child; }}&#x5229;&#x7528;&#x5C40;&#x90E8;&#x7684;static&#x53D8;&#x91CF;&#x5B9E;&#x73B0;&#x5355;&#x4F8B;&#x3002;&#x4E0D;&#x7BA1;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x54EA;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5176;&#x5B9E;&#x4F8B;&#x5316;&#x8FC7;&#x7A0B;&#x90FD;&#x4E0D;&#x662F;&#x7ECF;&#x5178;&#x7684;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x9700;&#x8981;&#x8C03;&#x7528;&#x8005;&#x9075;&#x5FAA;&#x7EA6;&#x5B9A;&#xFF0C;&#x8C03;&#x7528;&#x7279;&#x6B8A;&#x7684;&#x63A5;&#x53E3;&#x4EE5;&#x521B;&#x5EFA;&#x7C7B;&#x5B9E;&#x4F8B;&#x3002;&#x5176;&#x521B;&#x5EFA;&#x7684;&#x5B9E;&#x4F8B;&#x786E;&#x5B9E;&#x90FD;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x5BF9;&#x8C61;&#x3002;MONOSTATE&#x6B64;&#x6A21;&#x5F0F;&#x4E0E;SINGLETON&#x4E0D;&#x540C;&#xFF0C;MONOSTATE&#x5F3A;&#x8C03;&#x7684;&#x662F;&#x6240;&#x6709;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x76F8;&#x540C;&#x7684;&#x884C;&#x4E3A;&#x3002;public class MonoState { private static int itsX; public void setX(int x) { itsX = x; } public int getX(){ return itsX; }}&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x7EA6;&#x5B9A;&#xFF1A;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x6210;&#x5458;&#x5747;&#x4E3A;static&#xFF0C;&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x5747;&#x4E3A;&#x975E;static &#x6240;&#x6709;&#x65B9;&#x6CD5;&#x4E3A;&#x975E;static&#x7684;&#x7528;&#x610F;&#x662F;&#xFF0C;&#x5176;&#x63A5;&#x53E3;&#x5747;&#x53EF;&#x7EE7;&#x627F;&#x5230;&#x6D3E;&#x751F;&#x7C7B;&#x4E2D;&#x3002;&#x6240;&#x6709;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x662F;static&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x4FDD;&#x8BC1;&#x6240;&#x6709;&#x7C7B;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x76F8;&#x540C;&#x5C5E;&#x6027;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E5F;&#x4FDD;&#x8BC1;&#x4E86;MONOSTATE&#x7C7B;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x90FD;&#x5177;&#x6709;MONOSTATE&#x7279;&#x6027;&#x3002;&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x6240;&#x6709;&#x6D3E;&#x751F;&#x7C7B;&#x90FD;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;MONOSTATE&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;NULL OBJECT&#x6A21;&#x5F0F;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5B9E;&#x7528;&#xFF0C;&#x4F46;&#x53C8;&#x603B;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x5FFD;&#x7565;&#x7684;&#x6A21;&#x5F0F;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x5199;code&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x60C5;&#x51B5;&#x5F88;&#x5E38;&#x89C1;&#xFF1A;Employee e = DB.getEmployee(&quot;Bob&quot;);if (e != null &amp;&amp; e.isTimeToPay(today)) e.pay();&#x5148;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5728;&#x5931;&#x8D25;&#x65F6;&#x8FD4;&#x56DE;null&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x505A;&#x4E0B;&#x4E00;&#x6B65;&#x64CD;&#x4F5C;&#x3002;&#x4F7F;&#x7528;NULL OBJECT&#x4EE5;&#x540E;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;Employee e = DB.getEmployee(&quot;Bob&quot;);if (e.isTimeToPay(today)) e.pay();public class NullEmployee { public boolean isTimeToPay(Date data) { return false; }}&#x8FDB;&#x9636;NULL OBJECTimport java.util.Date;public interface Employee{ public boolean isTimeToPay(Date payDate); public void pay(); public static final Employee NULL = new Employee() { public boolean isTimeToPay(Date payDate) { return false; } public void pay() { } };}&#x4F7F;&#x65E0;&#x6548;&#x96C7;&#x5458;&#x7C7B;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;&#x533F;&#x540D;&#x5185;&#x5D4C;&#x7C7B;&#x662F;&#x4E00;&#x79CD;&#x786E;&#x4FDD;&#x8BE5;&#x7C7B;&#x53EA;&#x6709;&#x5355;&#x4E00;&#x5B9E;&#x4F8B;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x5B58;&#x5728;NullEmplyee&#x7C7B;&#x672C;&#x8EAB;&#x3002;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x4EBA;&#x90FD;&#x65E0;&#x6CD5;&#x521B;&#x5EFA;NULL&#x7C7B;&#x5B9E;&#x4F8B;&#x3002;&#x5E76;&#x4E14;static final&#x53D8;&#x91CF;&#x4E5F;&#x4FDD;&#x8BC1;&#x4E86;NULL&#x7684;&#x5355;&#x4F8B;&#x6027;&#x3002;&#x5982;&#x679C;NULL&#x4E0D;&#x80FD;&#x505A;&#x5230;&#x5355;&#x4F8B;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x5F15;&#x53D1;&#x6B67;&#x4E49;&#xFF0C;&#x5BFC;&#x81F4;&#x4E0D;&#x53EF;&#x9884;&#x77E5;&#x7684;&#x9519;&#x8BEF;&#x3002;&#x7B2C;20-22&#x7AE0;&#x672C;&#x90E8;&#x5206;&#x53EA;&#x8BB2;&#x4E86;&#x4E00;&#x4E2A;&#x6A21;&#x5F0F;(FACTORY)&#xFF0C;&#x4F46;&#x653E;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x7528;&#x7684;&#x7AE0;&#x8282;&#x2014;&#x2014;&#x5173;&#x4E8E;&#x5305;&#x7684;&#x8BBE;&#x8BA1;&#x539F;&#x5219;&#x3002;&#x5305;&#x662F;&#x7C7B;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x5F53;&#x8F6F;&#x4EF6;&#x8FBE;&#x5230;&#x4E00;&#x5B9A;&#x89C4;&#x6A21;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x8003;&#x8651;&#x5305;&#x7684;&#x8BBE;&#x8BA1;&#x4E86;&#x3002;&#x6211;&#x89C9;&#x5F97;&#x8FD9;&#x503C;&#x5F97;&#x53CD;&#x590D;&#x9605;&#x8BFB;&#x3002;&#x6211;&#x6253;&#x7B97;&#x98A0;&#x5012;&#x4E66;&#x4E0A;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x5148;&#x7F57;&#x5217;FACTORY&#x6A21;&#x5F0F;&#xFF0C;&#x518D;&#x6765;&#x770B;&#x5305;&#x8BBE;&#x8BA1;&#x89C4;&#x5219;&#x3002;FACTORY&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#xFF0C;&#x662F;&#x6211;&#x9605;&#x8BFB;&#x8FD9;&#x672C;&#x4E66;&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#xFF08;&#x8FD8;&#x6709;&#x7B2C;&#x56DB;&#x90E8;&#x5206;&#x7684;&#x4E09;&#x7AE0;&#x672A;&#x770B;&#xFF09;&#xFF0C;&#x6700;&#x6709;&#x7528;&#x7684;&#x6A21;&#x5F0F;&#x3002;&#x4ED6;&#x56DE;&#x7B54;&#x4E86;&#x6211;&#x5230;&#x5E95;&#x8BE5;&#x5728;&#x54EA;&#x91CC;&#x4F20;&#x5165;&#x591A;&#x6001;&#x7ED1;&#x5B9A;&#x4FE1;&#x606F;&#x3002;class Child1 : Parent{}class Child2 : Parent{}switch (info){ case A: Parent* obj = new Child1(); break; case B: Parent* obj = new Child2(); break;}&#x4E0A;&#x9762;&#x8FD9;&#x4E00;&#x6BB5;&#x4E0D;&#x7BA1;&#x662F;&#x65E9;&#x7ED1;&#x5B9A;&#xFF0C;&#x8FDF;&#x7ED1;&#x5B9A;&#xFF0C;&#x603B;&#x662F;&#x8981;&#x51FA;&#x73B0;&#x7684;&#x3002;&#x653E;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x653E;&#x5728;FACTORY&#x91CC;&#x3002; &#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x653E;&#x5230;FACTORY&#x91CC;&#xFF1F;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;FACTORY&#xFF1F;&#x4F5C;&#x8005;&#x8BF4;&#xFF1A;FACTORY&#x6A21;&#x5F0F;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x53EA;&#x4F9D;&#x8D56;&#x4E8E;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#x5C31;&#x80FD;&#x521B;&#x5EFA;&#x51FA;&#x5177;&#x4F53;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x6240; &#x4EE5; &#xFF0C;&#x5728;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x7684;&#x5F00;&#x53D1;&#x671F;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x5177;&#x4F53;&#x7C7B;&#x662F;&#x9AD9;&#x5EA6;&#x6613;&#x53D8;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x6A21;&#x5F0F;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x3002;&#x4E25;&#x683C;&#x6309;&#x7167;DIP&#x6765;&#x8BB2;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x5BF9;&#x7CFB;&#x7EDF;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x6613;&#x53D8;&#x7C7B;&#x4F7F;&#x7528;&#x5DE5;&#x5382;&#x3002;&#x9488;&#x5BF9;&#x8FD9;&#x53E5;&#x8BDD;&#xFF0C;&#x4F5C;&#x8005;&#x53C8;&#x8BF4;&#xFF1A;&#x6211;&#x4E0D;&#x662F;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x4F7F;&#x7528;&#x4E01;&#x5382;&#x3002;&#x53EA;&#x662F;&#x5728;&#x975E;&#x5E38;&#x9700;&#x8981;&#x5B83;&#x4EEC;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x624D;&#x628A;&#x5B83;&#x4EEC;&#x653E;&#x5165;&#x5230;&#x7CFB;&#x7EDF;&#x4E2D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5FC5;&#x8981;&#x4F7F;&#x7528;PROXY&#x6A21;&#x5F0F;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x80FD;&#x6709;&#x5FC5;&#x8981;&#x4F7F;&#x7528;&#x5DE5;&#x5382;&#x53BB;&#x521B;&#x5EFA;&#x6301;&#x4E45;&#x5316;&#x5BF9;&#x8C61;&#x3002;&#x6216;&#x8005;&#xFF0C;&#x5728;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x671F;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x9047; &#x5230;&#x5FC5;&#x987B;&#x8981;&#x6B3A;&#x9A97;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x521B;&#x5EFA;&#x8005;&#x7684;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7528;&#x5DE5;&#x5382;&#x3002;&#x4F46;&#x662F;&#x6211;&#x4E0D;&#x662F;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x5047;&#x8BBE;&#x5DE5;&#x5382;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x4E00;&#x5F00;&#x59CB;&#xFF0C;&#x4E0D;&#x7406;&#x89E3;&#x8FD9;&#x53E5;&#x8BDD;&#xFF0C;&#x73B0;&#x5728;&#x6DF1;&#x6DF1;&#x4F53;&#x4F1A;&#xFF0C;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x771F;&#x7684;&#x597D;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x6EE5;&#x7528;&#x3002;&#x6211;&#x73B0;&#x5728;&#x5C31;&#x6709;&#x6EE5;&#x7528;&#x7684;&#x503E;&#x5411;&#x3002;public interface IFactory{ public IObject makeObject();}public class Factory implements IFactory{ @Override public IObject makeObject(){ return new Object(); }}public class Invoker{ public void func(){ IFactory factory = new Factory(); IObject = factory.makeObject(); }}Invoker&#x7C7B;&#x5B8C;&#x5168;&#x4F9D;&#x8D56;&#x4E8E;&#x62BD;&#x8C61;&#x7684;&#x63A5;&#x53E3;&#x2014;&#x2014;&#x5DE5;&#x5382;&#x63A5;&#x53E3;&#x548C;Object&#x63A5;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x3002;&#x5728;&#x5F00;&#x53D1;&#x9636;&#x6BB5;&#xFF0C;&#x6216;&#x8005;&#x7C7B;&#x7ED3;&#x6784;&#x4E0D;&#x7A33;&#x5B9A;&#x9636;&#x6BB5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x4FEE;&#x6539;makeObject&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x6765;&#x751F;&#x4EA7;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x5728;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E2D;&#x4E5F;&#x662F;&#x5F88;&#x6709;&#x7528;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x66FF;&#x6362;&#x5177;&#x4F53;&#x7684;&#x5DE5;&#x5382;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;&#x771F;&#x5B9E;&#x7684;&#x7C7B;&#x548C;mock&#x7C7B;&#x4E4B;&#x95F4;&#x7684;&#x5207;&#x6362;&#x3002;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;mockito&#x6765;&#x5E2E;&#x6211;&#x4EEC;&#x505A;&#x8FD9;&#x4E9B;&#x4E8B;&#x60C5;&#x3002;&#x5982;&#x679C;&#x7C7B;&#x5E9E;&#x5927;&#x7684;mockito&#x89E3;&#x51B3;&#x4E0D;&#x4E86;&#xFF0C;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x7C7B;&#x53EF;&#x80FD;&#x4F1A;&#x7ED9;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x65B9;&#x4FBF;&#x3002;&#x4F5C;&#x8005;&#x7684;&#x4F8B;&#x5B50;&#xFF1A; &#x5728; &#x67D0; &#x4E9B; &#x60C5; &#x51B5; &#x4E0B; &#xFF0C; Payroll Test&#x628A; Database&#x7684;&#x5F15;&#x7528;&#x4F20;&#x9012;&#x7ED9;Payrol l&#x662F;&#x76F8;&#x5F53;&#x81EA;&#x7136;&#x7684;&#xFF0C;&#x5728;&#x53E6;&#x4E00;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6709;&#x53EF;&#x80FD;PayrollTest&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x5BF9;Database&#x7684;&#x5F15;&#x7528;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;Payroll&#x53EF;&#x80FD;&#x5B8C;&#x5168;&#x671F;&#x671B;&#x81EA;&#x5DF1;&#x6765;&#x521B;&#x5EFA;Database&#x5B9E;&#x4F8B;&#x3002;&#x5728;&#x6700;&#x540E;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;FACTORY&#x6A21;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;&#x4F20;&#x7ED9;Payroll&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x5BF9;&#x8C61;&#xFF0C;&#x6765;&#x6B3A;&#x9A97;Payroll&#x521B;&#x5EFA;&#x51FA;Database&#x7684;&#x6D4B;&#x8BD5;&#x7248;&#x672C;&#x3002;&#x5305;&#x8BBE;&#x8BA1;&#x539F;&#x5219;&#x7C92;&#x5EA6;3&#x539F;&#x5219;&#x2014;&#x2014;&#x5982;&#x4F55;&#x51B3;&#x5B9A;&#x54EA;&#x4E9B;&#x7C7B;&#x5E94;&#x5F53;&#x653E;&#x5165;&#x4E00;&#x4E2A;&#x5305;REP &#x2014;&#x2014;Reuse-Release Equivalence Principle &#x91CD;&#x7528;&#x53D1;&#x5E03;&#x7B49;&#x6548;&#x539F;&#x5219;&#x4E00;&#x4E2A;&#x5305;&#x4E2D;&#x7684;&#x8F6F;&#x4EF6;&#x8981;&#x4E48;&#x90FD;&#x662F;&#x53EF;&#x91CD;&#x7528;&#x7684;&#xFF0C;&#x8981;&#x4E48;&#x90FD;&#x662F;&#x4E0D;&#x53EF;&#x91CD;&#x7528;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x4E0D;&#x5E0C;&#x671B;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x53D1;&#x73B0;&#x5305;&#x4E2D;&#x6240;&#x5305;&#x542B;&#x7684;&#x7C7B;&#x4E2D;&#xFF0C;&#x4E00;&#x4E9B;&#x662F;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#xFF0C;&#x53E6;&#x4E00;&#x4E9B;&#x5BF9;&#x4ED6;&#x5374;&#x5B8C;&#x5168;&#x4E0D;&#x9002;&#x5408;&#x3002; &#x6211;&#x7406;&#x89E3;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#xFF0C;&#x8003;&#x8651;&#x95EE;&#x9898;&#x8981;&#x4EE5;&#x5305;&#x4E3A;&#x6700;&#x5C0F;&#x7C92;&#x5EA6;&#x3002;&#x7C7B;&#x4F3C;&#x7C7B;&#x8BBE;&#x8BA1;&#x7684;SRP&#xFF0C;&#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;&#x3002;CRP&#x2014;&#x2014;Common Reuse Principle&#x5171;&#x540C;&#x91CD;&#x7528;&#x539F;&#x5219;CRP&#x89C4;&#x5B9A;&#x76F8;&#x4E92;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x7D27;&#x5BC6;&#x8054;&#x7CFB;&#x7684;&#x7C7B;&#x4E0D;&#x5E94;&#x8BE5;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5305;&#x4E2D;CCP&#x2014;&#x2014;Common Close Principle&#x5171;&#x540C;&#x5C01;&#x95ED;&#x539F;&#x5219;&#x8FD9;&#x6761;&#x539F;&#x5219;&#x89C4;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x5305;&#x5C0F;&#x5E94;&#x8BE5;&#x5305;&#x4ECB;&#x591A;&#x4E2A;&#x5F15;&#x8D77;&#x53D8;&#x5316;&#x7684;&#x539F;&#x56E0;&#x3002;&#x7A33;&#x5B9A;&#x6027;&#x539F;&#x5219;&#x5982;&#x4F55;&#x907F;&#x514D;&#x201D;&#x6668;&#x540E;&#x7EFC;&#x5408;&#x75C7;&#x201D;&#x6BCF;&#x5468;&#x6784;&#x5EFA;ADP&#x2014;&#x2014;Acyclic Dependencies Principle&#x65E0;&#x73AF;&#x4F9D;&#x8D56;&#x6709;&#x4F9D;&#x8D56;&#x73AF;&#xFF0C;&#x5219;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x73AF;&#x4E0A;&#x8282;&#x70B9;&#x76F8;&#x5173;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;&#x8FDB;&#x800C;&#x5BFC;&#x81F4;&#x6574;&#x4E2A;&#x8F6F;&#x4EF6;&#x5305;&#x7684;&#x5D29;&#x6E83;&#x3002;&#x6240;&#x4EE5;&#x5207;&#x8BB0;&#xFF0C;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x5206;&#x6790;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x7EDD;&#x4E0D;&#x80FD;&#x6709;&#x4F9D;&#x8D56;&#x73AF;&#x3002;&#x89E3;&#x9664;&#x4F9D;&#x8D56;&#x73AF;&#x7684;&#x65B9;&#x6CD5;&#x4F9D;&#x8D56;&#x5012;&#x7F6E;&#xFF08;DIP&#xFF09;&#x5B9A;&#x4E49;&#x51FA;&#x5171;&#x540C;&#x4F9D;&#x8D56;&#x7684;&#x5305;20.5&amp;20.6&#x662F;&#x672C;&#x7AE0;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x5728;&#x8FD9;&#x4E24;&#x8282;&#x4E2D;&#xFF0C;&#x4F5C;&#x8005;&#x9610;&#x8FF0;&#x4E86;&#x5982;&#x4F55;&#x5B9A;&#x91CF;&#x5730;&#x5206;&#x6790;&#x5305;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x5E76;&#x6307;&#x5BFC;&#x6211;&#x4EEC;&#x7A76;&#x7ADF;&#x6539;&#x5982;&#x4F55;&#x5206;&#x5E03;&#x7A33;&#x5B9A;&#x7C7B;&#x548C;&#x975E;&#x7A33;&#x5B9A;&#x7C7B;&#x3002;&#x8FD9;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;&#x8BA9;&#x6211;&#x5370;&#x8C61;&#x9887;&#x4E3A;&#x6DF1;&#x523B;&#xFF1A;&#x5E76;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x90FD;&#x9002;&#x5408;&#x4F5C;&#x4E3A;&#x7A33;&#x5B9A;&#x7C7B;&#x3002;&#x8FD9;&#x4E00;&#x7AE0;&#x5185;&#x5BB9;&#x9002;&#x5408;&#x53CD;&#x590D;&#x7814;&#x8BFB;&#xFF0C;&#x6211;&#x6253;&#x7B97;&#x7559;&#x505A;&#x4E0B;&#x4E00;&#x6B21;&#x518D;&#x6765;&#x505A;&#x7B14;&#x8BB0;&#x3002;23-27&#x7AE0;COMPOSITE&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x662F;&#x5BF9;COMMAND&#x6A21;&#x5F0F;&#x7684;&#x6269;&#x5C55;&#x3002;&#x4E3A;&#x7684;&#x662F;&#x8BA9;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x884C;&#x4E3A;&#x8868;&#x73B0;&#x7684;&#x50CF;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x4F8B;&#x5982;&#xFF1A;OBSERVER&#x8FD9;&#x4E00;&#x7AE0;&#xFF0C;&#x4F5C;&#x8005;&#x7ED9;&#x51FA;&#x4E86;&#x5982;&#x4F55;&#x4ECE;&#x6700;&#x57FA;&#x672C;&#x7684;coding&#x65B9;&#x5F0F;&#xFF0C;&#x63A8;&#x6F14;&#x51FA;&#x5982;&#x4F55;&#x5957;&#x7528;&#x5408;&#x9002;&#x7684;&#x6A21;&#x5F0F;&#x3002;&#x5176;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x5C31;&#x662F;&#x4E0D;&#x8981;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x4E0D;&#x65AD;&#x7684;&#x91CD;&#x6784;&#x4E2D;&#xFF0C;&#x5411;&#x67D0;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#x4E0D;&#x65AD;&#x9760;&#x8FD1;&#xFF0C;&#x5F53;&#x5176;&#x7ED3;&#x6784;&#x5DF2;&#x7ECF;&#x6F14;&#x5316;&#x6210;&#x67D0;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#x65F6;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x7684;&#x540D;&#x79F0;&#x4FEE;&#x6539;&#x4E3A;&#x8BE5;&#x6A21;&#x5F0F;&#x7684;&#x672F;&#x8BED;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x4F7F;&#x7528;&#x6A21;&#x5F0F;&#x7684;&#x76EE;&#x7684;&#x8FD9;&#x5B9E;&#x9645;&#x662F;&#x672C;&#x7AE0;&#x7684;&#x7CBE;&#x9AD3;&#x3002; &#x4E0D;&#x8FC7;&#x672C;&#x7AE0;&#x5728;&#x9610;&#x8FF0;&#x4E0A;&#x8FF0;&#x8715;&#x5316;&#x6F14;&#x8FDB;&#x7684;&#x8FC7;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4EE5;OBSERVER&#x6A21;&#x5F0F;&#x4E3A;&#x4F8B;&#xFF0C;&#x4E5F;&#x5C06;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x7684;&#x539F;&#x7406;&#x548C;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x8BB2;&#x7684;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#x3002;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x2014;&#x2014;&#x63A8;&amp;&#x62C9;&#x62C9;&#x6A21;&#x5F0F;&#x9002;&#x5408;&#x7B80;&#x5355;&#x7684;&#x4FE1;&#x606F;&#x4EA4;&#x4E92;&#xFF0C;Observer&#x77E5;&#x9053;&#x53BB;Subject&#x62C9;&#x4EC0;&#x4E48;&#x4FE1;&#x606F;&#x3002; &#x817F;&#x6A21;&#x5F0F;&#x9002;&#x5408;&#x590D;&#x6742;&#x4FE1;&#x606F;&#x4EA4;&#x4E92;&#xFF0C;&#x7531;Subject&#x544A;&#x8BC9;Observer&#x4EC0;&#x4E48;&#x4FE1;&#x606F;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#x3002;ABSTRACT SERVER, ADAPTER&amp;BRIDGEABSTRACT SERVER&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x4E24;&#x5E45;&#x56FE;&#xFF1A;&#x5BF9;Switch&#x7684;&#x7EE7;&#x627F;&#xFF0C;&#x603B;&#x662F;&#x5E26;&#x4E0A;&#x4E86;Light&#x4FE1;&#x606F;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x4FEE;&#x6539;&#x9AD8;&#x5C42;Switch&#x4F9D;&#x8D56;&#x4E8E;Light&#x53F3;&#x8FB9;&#x7684;&#x56FE;&#x5C06;Switch&#x63A5;&#x53E3;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#xFF0C;&#x4E0D;&#x7BA1;&#x63A7;&#x5236;&#x4EC0;&#x4E48;&#x8BBE;&#x5907;&#xFF0C;&#x53EA;&#x8981;&#x5B9A;&#x4E49;&#x4E86;&#x8BE5;&#x63A5;&#x53E3;&#x5C31;&#x53EF;&#x4EE5;&#x3002; &#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x59CB;&#x7EC8;&#x8426;&#x7ED5;&#x6211;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x53C8;&#x51FA;&#x73B0;&#x4E86;&#xFF0C;&#x5C31;&#x662F;&#x4F55;&#x65F6;&#x5B9E;&#x4F8B;&#x5316;Light&#x7C7B;&#xFF1F;&#x6309;&#x7167;&#x56FE;25.2&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;Switch&#x5305;&#x542B;&#x4E00;&#x4E2A;Light&#x5BF9;&#x8C61;&#xFF0C;&#x5728;&#x8C03;&#x7528;Switch&#x7684;turnOn&#x65F6;&#xFF0C;&#x59D4;&#x6258;&#x7ED9;Light&#x7684;turnOn&#x3002;&#x90A3;&#x4E48;&#x5230;25.3&#x4E2D;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x662F;Switch&#x6301;&#x6709;&#x4E00;&#x4E2A;Switchable&#x7684;&#x5BF9;&#x8C61;&#xFF08;&#x53EF;&#x80FD;&#x662F;Light&#x6216;&#x8005;Fan&#x7B49;&#x7B49;&#xFF09;&#x3002;&#x90A3;&#x5C31;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x67D0;&#x4E2A;&#x5DE5;&#x5382;&#x6765;&#x4EA7;&#x751F;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7ED9;Switch&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#xFF0C;&#x7531;&#x5BA2;&#x6237;&#x903B;&#x8F91;&#x6765;&#x5B9E;&#x73B0;Switch&#x548C;Switchable&#x5BF9;&#x8C61;&#x7684;&#x7ED1;&#x5B9A;&#x3002;&#x4F8B;&#x5982;Switch.setSwitchable(Light)&#x3002;&#x5728;Switch&#x4E2D;&#x65E0;&#x5DEE;&#x522B;&#x7684;&#x4F7F;&#x7528;Switchable&#x63A5;&#x53E3;&#x3002;&#x4E24;&#x4E2A;&#x90FD;&#x662F;&#x6211;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x4E0D;&#x4E00;&#x5B9A;&#x6B63;&#x786E;&#x3002;&#x4EE5;&#x540E;&#x82E5;&#x6709;&#x673A;&#x4F1A;&#x4E0E;&#x5927;&#x5E08;&#x4EA4;&#x6D41;&#xFF0C;&#x53EF;&#x4EE5;&#x5F53;&#x9762;&#x63D0;&#x51FA;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x8C01;&#x62E5;&#x6709;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x5728;&#x8FD9;&#x4E00;&#x7AE0;&#x4F5C;&#x8005;&#x8FD8;&#x63D0;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x503C;&#x5F97;&#x91CD;&#x89C6;&#x7684;&#x95EE;&#x9898;&#xFF08;&#x5176;&#x5B9E;&#x5728;&#x524D;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x5DF2;&#x7ECF;&#x51FA;&#x73B0;&#x8FC7;&#xFF09;&#xFF0C;&#x5C31;&#x662F;&#x63A5;&#x53E3;&#x5230;&#x5E95;&#x8BE5;&#x548C;&#x8C01;&#x6253;&#x5305;&#xFF1F;&#x770B;&#x4F5C;&#x8005;&#x7684;&#x9610;&#x8FF0;&#xFF1A;&#x5BA2;&#x6237;&#x548C;&#x63A5;&#x95E8;&#x4E4B;&#x95F4;&#x7684;&#x903B;&#x8F91;&#x7ED1;&#x5B9A;&#x5173;&#x7CFB;&#x8981;&#x5F3A;&#x4E8E;&#x63A5;&#x53E3;&#x548C;&#x5B83;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x4E4B;&#x95F4;&#x7684;&#x903B;&#x8F91;&#x7ED1;&#x5B9A;&#x5173;&#x7CFB;&#x3002;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x5F3A;&#x5230;&#x5728;&#x6CA1;&#x6709;Switchable&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C31;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;Switch&#xFF1B;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x53E3;Light&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5374;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Switch&#x3002;&#x903B;&#x8F91;&#x5173;&#x7CFB;&#x7684;&#x5F3A;&#x5EA6;&#x548C;&#x5B9E;&#x4F53; &#x5173;&#x7CFB;&#x7684;&#x5F3A;&#x5EA6;&#x662F;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x7EE7;&#x627F;&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x5173;&#x8054;&#x5F3A;&#x5F97;&#x591A;&#x7684;&#x5B9E;&#x4F53;&#x5173;&#x7CFB;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x6309;&#x7167;&#x903B;&#x8F91;&#x5173;&#x7CFB;&#x7684;&#x5F3A;&#x5F31;&#x6765;&#x51B3;&#x5B9A;&#x5305;&#x7684;&#x8FB9;&#x754C;&#xFF0C;&#x5373;&#x63A5;&#x53E3;&#x7684;&#x5BA2;&#x6237;&#x5E94;&#x5F53;&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;&#x3002;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x662F;&#x5929;&#x7136;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x53C2;&#x8003;&#x7684;&#x662F;&#x7C7B;&#x4E4B;&#x95F4;&#x7684;&#x903B;&#x8F91;&#x5173;&#x7CFB;&#x3002;ADAPTER&#x5148;&#x770B;&#x4EC0;&#x4E48;&#x662F;ADAPTER&#x6A21;&#x5F0F; &#x4E00;&#x822C;&#x5F62;&#x5F0F;&#x7684;ADAPTER&#xFF1A;BRIDGEBridge&#x6A21;&#x5F0F;&#x5728;&#x8FD9;&#x672C;&#x4E66;&#x4E0A;&#x7684;&#x5185;&#x5BB9;&#x6CA1;&#x770B;&#x61C2;&#xFF0C;&#x53BB;&#x53C2;&#x8003;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x5723;&#x7ECF;&#x2014;&#x2014;&#x300A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x300B;&#x3002;&#x4E0D;&#x6127;&#x4E3A;&#x7ECF;&#x5178;&#x4E66;&#xFF0C;&#x8BB2;&#x89E3;&#x7684;&#x5F88;&#x6E05;&#x695A;&#x900F;&#x5F7B;&#x3002; &#x4E66;&#x4E2D;&#x7ED9;&#x7684;&#x4F8B;&#x5B50;&#x662F;Window System&#xFF0C;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;Window&#x7CFB;&#x7EDF;&#x81EA;&#x8EAB;&#x7684;&#x6F14;&#x5316;&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#x5BF9;Window&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x73B0; &#x5982;&#x679C;&#x4ED6;&#x4EEC;&#x90FD;&#x4F9D;&#x8D56;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#xFF0C;&#x90A3;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x7EE7;&#x627F;&#x5931;&#x63A7;&#x7684;&#x73B0;&#x8C61;&#x3002;Bridge&#x6A21;&#x5F0F;&#x7684;&#x51FA;&#x73B0;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7ECF;&#x5178;&#x7684;Bridge&#x6A21;&#x5F0F;&#x3002;&#x62BD;&#x8C61;&#x7684;Window&#x7C7B;&#x548C;&#x5404;&#x5E73;&#x53F0;&#x7684;&#x5B9E;&#x73B0;&#x90E8;&#x5206;&#x5728;&#x5404;&#x81EA;&#x7684;&#x7C7B;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x5206;&#x522B;&#x6F14;&#x5316;&#x3002;Window&#x4E0E;WindowImp&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x79F0;&#x4E3A;&#x6865;&#x63A5;&#x3002;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;class Window{public: virtual void DrawLine(const Point&amp;, const Point&amp;) = 0;protected: WindowImp* GetWindowImp(); //**********private: WindowImp* _imp; View* _contents;}class WindowImp{public: virtual void DrawLineImp(const Point&amp;, const Point&amp;) = 0;}class IconWindow : public Window{public: virtual void DrawLine(const Point&amp; a, const Point&amp; b) { WindowImp* imp = GetWindowImp(); imp-&gt;DrawLineImp(a, b); }}&#x8FD9;&#x91CC;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x662F;Window&#x7C7B;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;Window&#x7684;protected&#x63A5;&#x53E3;&#x6765;&#x8BBF;&#x95EE;&#x5230;&#x5BF9;&#x5E94;&#x7684;Imp&#x63A5;&#x53E3;&#x3002;&#x800C;GetWindowImp&#x53EF;&#x80FD;&#x5229;&#x7528;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#xFF0C;&#x6765;&#x751F;&#x6210;&#x9700;&#x8981;&#x7684;&#x5BF9;&#x8C61;&#x3002;GetWindowImp&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x4E2D;&#x68C0;&#x6D4B;&#x5F53;&#x524D;&#x7684;&#x5E73;&#x53F0;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x5BF9;&#x5E94;&#x7684;WindowImp&#x7C7B;&#x3002;Bridge&#x6A21;&#x5F0F;&#x4E00;&#x4E9B;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#x4EC5;&#x6709;&#x4E00;&#x4E2A;Implementor&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x7684;Implementor&#x7C7B;&#x5B9E;&#x4F8B;&#x5316;Imp&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#xFF1A; &#x5982;&#x679C;&#x6839;&#x62BD;&#x8C61;&#x7C7B;&#x77E5;&#x9053;&#x6240;&#x6709;&#x7684;Implementor&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x5219;&#x53EF;&#x5728;&#x5176;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x6839;&#x636E;&#x9700;&#x8981;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x4E00;&#x4E2A;Implementor&#x7C7B;&#x9996;&#x5148;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x9700;&#x8981;&#x6539;&#x53D8;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x91C7;&#x7528;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x6765;&#x751F;&#x4EA7;&#x5BF9;&#x5E94;&#x7684;Imp&#x7C7B;&#x5BF9;&#x8C61;&#x5728;C++&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7ED3;&#x5408;&#x4E24;&#x4E2A;&#x62BD;&#x8C61;&#x5C42;&#x6B21;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x4F9D;&#x8D56;&#x4E8E;&#x9759;&#x6001;&#x7EE7;&#x627F;&#x3002;&#x56E0;&#x6B64;&#x4E0D;&#x53EF;&#x80FD;&#x7528;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x771F;&#x6B63;&#x7684;Bridge&#x6A21;&#x5F0F;&#x3002;&#x4EE5;Window&#x7CFB;&#x7EDF;&#x4E3A;&#x4F8B;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x7C7B;&#x7EE7;&#x627F;Window&#x548C;WindowImp&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x5E76;&#x6CA1;&#x6709;&#x83B7;&#x5F97;XWindow&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x654F;&#x6377;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x4E2D;&#x7684;Bridge&#x6A21;&#x5F0F;&#x518D;&#x56DE;&#x5230;&#x300A;&#x654F;&#x6377;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x300B;&#x8FD9;&#x672C;&#x4E66;&#xFF0C;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;ModemConnectionController&#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#xFF1A;&#x539F;&#x6709;&#x7684;Modem&#x548C;&#x65B0;&#x7684;DedicatedModem&#x3002;ModemConnectionController&#x4E2D;&#x6240;&#x6709;&#x7684;Imp&#x63A5;&#x53E3;&#x5747;&#x4E3A;Protected&#xFF0C;&#x53EA;&#x80FD;&#x88AB;&#x5176;&#x5B50;&#x7C7B;&#x4F7F;&#x7528;&#x3002;ModemConnectionController&#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x673A;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;&#x5BF9;&#x5E94;Modem&#x7684;&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#xFF0C;&#x5E76;&#x5C06;&#x6240;&#x6709;&#x7684;Imp&#x63A5;&#x53E3;&#x59D4;&#x6258;&#x7ED9;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;&#x7528;&#x4EE3;&#x7801;&#x6765;&#x9610;&#x8FF0;&#x53EF;&#x80FD;&#x66F4;&#x76F4;&#x89C2;&#xFF1A;public interface Modem { public void Dial();}public interface DedicatedModem { public void Send();}public abstract class ModemConnectionController implements Modem, DedicatedModem{ private ModemImplementation _imp; protected ModemImplementation GetImp(int token){ switch (token) { case 1: return new Object(); } } protected void DialImpl(){ return GetImp(mToken).Dial(); // delegate } protected void SendImpl(){ return GetImp(mToken).Send(); // delegate } public void Dial() {} public void Send() {}}public class DedModemController extends ModemConnectionController { public void Dial(){ /* own version of Dial */ } public void Send(){ return DialImpl(); }}public class DedUser { void main(){ DedicatedModem dedModem = (DedicatedModem)new DedModemController; dedModem.Dial(); dedModem.Send(); }}public class OldUser { void main(){ Modem modem = (Modem)new HayesModem; modem.Dial(); modem.Send(); }}&#x56E0;&#x4E3A;*Impl&#x51FD;&#x6570;&#x7684;&#x5B58;&#x5728;&#xFF0C;DedModem&#x53EF;&#x4EE5;&#x6F14;&#x53D8;&#x6210;&#x72EC;&#x7ACB;&#x7684;&#x7C7B;&#x6F14;&#x5316;&#x5E8F;&#x5217;&#x3002;PROXY&#x4E0B;&#x56FE;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;PROXY&#x6A21;&#x5F0F;&#xFF1A;&#x6BCF;&#x4E2A;&#x8981;&#x88AB;&#x4EE3;&#x7406;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x88AB;&#x5206;&#x6210;3&#x4E2A;&#x90E8;&#x5206;&#xFF1A;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x58F0;&#x660E;&#x4E86;&#x5BA2;&#x6237;&#x8981;&#x8C03;&#x7528;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#x4E00;&#x4E2A; &#x7C7B;&#x5728;&#x4E0D;&#x6D89;&#x53CA;&#x6570;&#x636E;&#x5E93;&#x903B;&#x8F91;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x4E86;&#x63A5;&#x53E3;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x4E00;&#x4E2A;&#x77E5;&#x6653;&#x6570;&#x636E;&#x5E93;&#x7684;&#x4EE3;&#x7406;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5E94;&#x8BE5;&#x5DF1;&#x7ECF;&#x6D88;&#x9664;&#x4E86;&#x6240;&#x6709;&#x5173;&#x4E8E;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x662F;&#x7B80;&#x5355;&#x548C;&#x4F18;&#x96C5;&#x7684;&#x9519;&#x8BEF;&#x8BA4;&#x8BC6;&#x3002;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x662F;&#x6709;&#x4EE3;&#x4EF7;&#x7684;&#x3002;&#x89C4;&#x8303;&#x6A21;&#x5F0F;&#x4E2D;&#x6240;&#x9690;&#x542B;&#x7684;&#x7B80;&#x5355;&#x59D4;&#x6258;&#x6A21;&#x578B;&#x5F88;&#x5C11;&#x80FD;&#x591F;&#x88AB;&#x4F18;&#x7F8E;&#x5730;&#x5B9E;&#x73B0;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F1A;&#x53D6;&#x6D88;&#x5BF9;&#x4E8E;&#x7E41;&#x7410;&#x7684;&#x83B7;&#x53D6;&#x548C;&#x8BBE;&#x7F6E;&#x65B9;&#x6CD5;&#x7684;&#x59D4;&#x6258;&#x3002;&#x5173;&#x4E8E;&#x7F13;&#x5B58;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x8BA4;&#x4E3A;ProductProxy&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x6548;&#x7684;&#x3002;&#x5728;&#x6BCF;&#x4E2A;&#x8BBF;&#x95EE;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5B83;&#x90FD;&#x4F1A;&#x53BB;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5982;&#x679C;&#x5B83;&#x628A;ProductData&#x6761;&#x76EE;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#x6765;&#x907F;&#x514D;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x662F;&#x4F1A;&#x66F4;&#x597D;&#x4E00;&#x4E9B;&#x5417;&#xFF1F; &#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x66F4;&#x6539;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x4FC3;&#x4F7F;&#x6211;&#x4EEC;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x60DF;&#x4E00;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x6050;&#x60E7;&#x3002;&#x6B64;&#x65F6; &#xFF0C;&#x8FD8;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x663E;&#x793A;&#x51FA;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x5177;&#x6709;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x3002;&#x6B64; &#x5916;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x5F15;&#x64CE;&#x672C;&#x8EAB;&#x4E5F;&#x4F1A;&#x505A;&#x4E00;&#x4E9B;&#x7F13;&#x5B58;&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x5EFA;&#x7ACB;&#x81EA;&#x5DF1;&#x7684;&#x7F13;&#x5B58;&#x4F1A;&#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x4EC0;&#x4E48;&#x597D;&#x5904;&#x5E76;&#x4E0D;&#x660E;&#x663E;&#x3002;&#x5728;&#x505A;&#x8FD9;&#x4E9B;&#x9EBB;&#x70E6;&#x7684;&#x5DE5;&#x4F5C;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x7B49;&#x5F85;&#xFF0C;&#x76F4;&#x5230;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x7684;&#x8FF9;&#x8C61;&#x3002; &#x5982;&#x679C;&#x4F60;&#x62C5;&#x5FC3;&#x6027;&#x80FD;&#x53EF;&#x80FD;&#x662F;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x5EFA;&#x8BAE;&#x4F60;&#x505A;&#x4E00;&#x4E9B;&#x8BD5;&#x9A8C;&#x53BB;&#x8BC1;&#x660E;&#x5B83;&#x786E;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x5F97;&#x5230;&#x8BC1;&#x5B9E;&#x65F6;&#xFF0C;&#x4F60;&#x624D;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x5982;&#x4F55;&#x53BB;&#x63D0;&#x901F;&#x3002;STAIRWAY TO HEAVENSTAIRWAY TO HEAVEN&#x4F7F;&#x7528;&#x4E86;&#x7C7B;&#x5F62;&#x5F0F;&#xFF08;class form )&#x7684;ADAPTER&#x6A21;&#x5F0F;&#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x4F53;.&#x6838;&#x5FC3;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x4E0A;&#x534A;&#x90E8;&#x5206;&#x7684;Product&#xFF0C;PersistentObject&#x548C;PersistentProduct&#xFF0C;&#x4E0B;&#x9762;Assembly&#x76F8;&#x5173;&#x7684;&#x90E8;&#x5206;&#x662F;&#x5BF9;Product&#x90E8;&#x5206;&#x7684;&#x6269;&#x5C55;PersistentProduct&#x901A;&#x8FC7;Product&#x5F97;&#x5230;&#x4EA7;&#x54C1;&#x903B;&#x8F91;&#xFF0C;&#x901A;&#x8FC7;PersistentObject&#x83B7;&#x5F97;&#x969C;&#x788D;&#xFF08;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x7F51;&#x7EDC;&#x7B49;&#x7B49;&#xFF09;&#x64CD;&#x4F5C;&#x903B;&#x8F91;&#x3002; &#x5BF9;&#x6BD4;&#x770B;PROXY&#x7684;&#x9759;&#x6001;&#x6A21;&#x578B;&#x7BA1;&#x7406;&#x7B2C;&#x4E09;&#x65B9;API&#x5728;&#x6211;&#x4EEC;&#x521A;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x65B9;API&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5F80;&#x5F80;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;&#x4F5C;&#x8005;&#x5728;&#x672C;&#x7AE0;&#x6700;&#x540E;&#x8FD8;&#x63D0;&#x5230;&#x4E86;&#x51E0;&#x4E2A;&#x64CD;&#x4F5C;&#x7B2C;&#x4E09;&#x65B9;API&#x7684;&#x6A21;&#x5F0F;&#xFF1A;Extension ObjectVISITORDecoratorFacade&#x4F5C;&#x8005;&#x6700;&#x540E;&#x7684;&#x7ED3;&#x8BBA;&#x5F88;&#x6709;&#x6307;&#x5BFC;&#x610F;&#x4E49;&#xFF1A;&#x8FDC;&#x5728;&#x771F;&#x6B63;&#x9700;&#x8981;PROXY&#x6A21;&#x5F0F;&#x6216;&#x8005;STAIRWAY TO HEAVEN&#x6A21;&#x5F0F;&#x524D;&#xFF0C;&#x5C31;&#x53BB;&#x9884;&#x6D4B;&#x5BF9;&#x4E8E;&#x5B83;&#x4EEC;&#x7684;&#x9700;&#x8981;&#x662F;&#x975E;&#x5E38;&#x6709;&#x8BF1;&#x60D1;&#x529B;&#x7684;&#x3002;&#x4F46;&#x8FD9;&#x51E0;&#x4E4E;&#x4ECE;&#x6765;&#x90FD;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E3B;&#x610F;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BF9;&#x4E8E;PROXY&#x6A21; &#x5F0F;&#x3002;&#x6211;&#x5EFA;&#x8BAE;&#x5728;&#x5F00;&#x59CB;&#x65F6;&#x5148;&#x4F7F;&#x7528;FACADE&#x6A21;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5FC5;&#x8981;&#x65F6;&#x8FDB;&#x884C;&#x91CD;&#x6784;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4F1A;&#x4E3A;&#x81EA;&#x5DF1;&#x8282;&#x7701;&#x65F6;&#x95F4;&#x5E76;&#x7701;&#x53BB;&#x9EBB;&#x70E6;&#x3002;&#x6211;&#x5728;&#x505A;&#x5FAE;&#x4FE1;IoT&#x6253;&#x5370;&#x5B89;&#x5353;&#x7AEF;&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x662F;&#x8C28;&#x9075;&#x4F5C;&#x8005;&#x7684;&#x6559;&#x8BF2;&#x3002;FACADE&#x6A21;&#x5F0F;&#x524D;&#x9762;&#x6709;&#x4E13;&#x95E8;&#x7684;&#x7AE0;&#x8282;&#x4ECB;&#x7ECD;&#x3002;&#x8FD9;&#x91CC;&#x518D;&#x653E;&#x4E00;&#x4E2A;&#x672C;&#x7AE0;&#x7684;&#x5173;&#x4E8E;FACADE&#x7684;&#x622A;&#x56FE;&#x3002;28-30&#x7AE0;VISITORVISITOR&#x6A21;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x4ED6;&#x53EF;&#x4EE5;&#x7ED9;&#x73B0;&#x6709;&#x7684;&#x6846;&#x67B6;&#x6253;&#x8865;&#x4E01;&#x3002;&#x4F5C;&#x8005;&#x7ED9;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x5173;&#x4E8E;Modem&#x7684;&#x4E00;&#x6B21;&#x6B21;&#x4FEE;&#x6539;&#x53D8;&#x6210;&#x4E00;&#x6B21;&#x6027;&#x64CD;&#x4F5C;&#x3002;&#x5728;Modem&#x7684;&#x63A5;&#x53E3;&#x4E2D;&#x6DFB;&#x52A0;VISITOR&#x63A5;&#x53E3;&#xFF0C;&#x5373;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;accept&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x4EE3;&#x7801;&#x8981;&#x4E3A;Unix&#x914D;&#x7F6E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x5B9E;&#x4F53;Modem&#x7C7B;&#x7684;accept&#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x4F1A;&#x8C03;&#x7528;Visitor-&gt;visit&#xFF0C;&#x5E76;&#x4F20;&#x5165;&#x81EA;&#x8EAB;&#x4E0A;&#x4E0B;&#x6587;&#x5728;visit&#x91CC;&#x9762;&#x5C31;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x5404;&#x4E2A;Modem&#x66B4;&#x9732;&#x51FA;&#x6765;&#x7684;public&#x65B9;&#x6CD5;&#x4E86;&#xFF0C;&#x6CE8;&#x610F;&#x4E0D;&#x662F;Modem&#x63A5;&#x53E3;&#x54E6;&#xFF0C;&#x662F;&#x5177;&#x4F53;&#x7C7B;&#x7684;public&#x65B9;&#x6CD5;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5176;&#x4ED6;&#x7684;&#x8BBF;&#x95EE;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x52A0;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x5E76;&#x5B9A;&#x4E49;ModemVisitor&#x63A5;&#x53E3;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x7C7B;&#x53EF;&#x4EE5;&#x505A;&#x4EFB;&#x610F;&#x60F3;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x4E0D;&#x5C40;&#x9650;&#x4E8E;ModemConfigurator&#x8FD9;&#x91CC;&#x8FD8;&#x5B66;&#x5230;&#x4E00;&#x4E2A;java&#x7684;&#x5C0F;&#x77E5;&#x8BC6;&#xFF1A; &#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6709;private, protected, public&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5199;&#x9ED8;&#x8BA4;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;C++&#x91CC;&#x9ED8;&#x8BA4;&#x662F;privateJava&#x91CC;&#x4E0D;&#x5199;&#x7684;&#x8BDD;&#xFF0C;&#x8868;&#x793A;&#x5305;&#x7EA7;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#xFF0C;&#x610F;&#x5373;&#x53EA;&#x6709;&#x540C;&#x4E00;&#x4E2A;&#x5305;&#x91CC;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x3002;&#x5982;&#x679C;&#x8F6F;&#x4EF6;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5305;&#xFF0C;&#x5C31;&#x7B49;&#x540C;&#x4E8E;public&#x3002;&#x56E0;&#x4E3A;Java&#x4E2D;&#x6CA1;&#x6709;friend&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x8D77;&#x5230;&#x4E00;&#x90E8;&#x5206;friend&#x7684;&#x4F5C;&#x7528;&#x3002;&#x5176;&#x5B9E;&#x4E5F;&#x5C31;&#x662F;Java&#x7684;&#x4F5C;&#x8005;&#x8BA4;&#x4E3A;&#xFF0C;&#x5305;&#x5185;&#x7684;&#x7C7B;&#x90FD;&#x662F;&#x53CB;&#x5143;&#x3002;ACYCLIC VISITOR&#x6A21;&#x5F0F;acyclic &#x2014;&#x2014; &#x65E0;&#x73AF;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x6307;&#x6CA1;&#x6709;&#x4F9D;&#x8D56;&#x73AF;&#x3002;&#x4E3A;&#x4F55;&#x6709;ACYCLIC&#x53D8;&#x4F53;&#x4F5C;&#x8005;&#x5728;&#x672C;&#x8282;&#x4E00;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4ECB;&#x7ECD;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5728;VISITOR&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5F15;&#x5165;ACYCLIC&#x53D8;&#x4F53;&#x3002;&#x4E0D;&#x8FC7;&#x6211;&#x60F3;&#x4E86;&#x597D;&#x4E45;&#xFF0C;&#x4E5F;&#x6CA1;&#x592A;&#x7406;&#x89E3;&#x3002;&#x6682;&#x4E14;&#x7F57;&#x5217;&#x5982;&#x4E0B;&#xFF1A;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x88AB;&#x8BBF;&#x95EE; (Modem)&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x7684;&#x57FA;&#x7C7B;&#x4F9D;&#x8D56;&#x4E8E;&#x8BBF;&#x95EE;&#x8005;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#xFF08;ModemVisitor&#xFF09;&#x7684;&#x57FA;&#x7C7B;&#x3002;&#x540C;&#x6837;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8BBF;&#x95EE;&#x8005;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x7684;&#x57FA;&#x7C7B;&#x4E2D;&#x5BF9;&#x4E8E;&#x88AB;&#x8BBF;&#x95EE;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x6D3E;&#x751F;&#x7C7B;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5C31;&#x6709;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x73AF;&#x628A;&#x6240;&#x6709;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#xFF08;&#x6240;&#x6709;&#x7684;&#x8C03;&#x5236;&#x89E3;&#x8C03;&#x5668;&#xFF09;&#x7ED1;&#x5B9A;&#x5728;&#x4E00; &#x8D77;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5C31;&#x5F88;&#x96BE;&#x5B9E;&#x73B0;&#x5BF9;&#x8BBF;&#x95EE;&#x8005;&#x7ED3;&#x6784;&#x7684;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x5F88;&#x96BE;&#x5411;&#x88AB;&#x8BBF;&#x95EE;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x589E;&#x52A0;&#x65B0;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x3002; &#x5982;&#x679C;&#x7A0B;&#x5E8F;&#x4E2D;&#x8981;&#x66F4;&#x6539;&#x7684;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E0D;&#x9700;&#x8981;&#x7ECF;&#x5E38;&#x5730;&#x589E;&#x52A0;&#x65B0;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;VISITOR&#x6A21;&#x5F0F;&#x5DE5;&#x4F5C;&#x7684;&#x5F88;&#x597D;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5F88;&#x53EF;&#x80FD;&#x53EA;&#x9700;&#x8981;Hayes&#x3001;Zoom&#x4EE5;&#x53CA;Ernie&#xFF0C;&#x6216;&#x8005;&#x5F88;&#x5C11;&#x4F1A;&#x53BB;&#x589E;&#x52A0;&#x65B0;&#x7684;Modem&#x6D3E;&#x751F;&#x7C7B;,&#x90A3;&#x4E48;VISITOR&#x6A21;&#x5F0F;&#x5C06;&#x4F1A;&#x975E;&#x5E38;&#x5408;&#x9002;&#x3002; &#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x88AB;&#x8BBF;&#x95EE;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x975E;&#x5E38;&#x4E0D;&#x7A33;&#x5B9A;&#xFF0C;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x8BB8;&#x591A;&#x65B0;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x6BCF;&#x5F53;&#x5411;&#x88AB;&#x8BBF;&#x95EE; &#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x65F6;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x66F4;&#x6539;&#x5E76;&#x4E14;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;VISITOR&#x57FA;&#x7C7B;&#xFF08;&#x4E5F;&#x5C31;&#x662F;ModemVisitor&#xFF09;&#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x6240;&#x6709;&#x6D3E;&#x751F;&#x7C7B;&#x3002;&#x5728;C++&#x4E2D;&#xFF0C;&#x60C5;&#x51B5;&#x751A;&#x81F3;&#x66F4;&#x7CDF;&#x3002;&#x6BCF;&#x5F53;&#x589E;&#x52A0;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x65F6;&#xFF0C;&#x6574;&#x4E2A;&#x88AB;&#x8BBF;&#x95EE;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x88AB;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3001;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x3002;&#x8C08;&#x4E00;&#x4E0B;&#x6211;&#x7684;&#x7406;&#x89E3;&#x3002;&#x8FD9;&#x53EF;&#x80FD;&#x548C;Java&#x7684;&#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;&#x6709;&#x5173;&#x7CFB;&#x3002;&#x5148;&#x628A;VISITOR&#x4E2D;&#x7684;&#x7C7B;&#x56FE;&#x62F7;&#x8FC7;&#x6765;&#xFF1A;ModemVisitor&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x56E0;&#x4E3A;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;Modem&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x5B9A;&#x4E49;&#x4E86;Modem&#x63A5;&#x53E3;&#x7684;&#x7C7B;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x5173;&#x4E8E;C++&#x7684;&#x63CF;&#x8FF0;&#xFF1A;&#x5728;C++&#x4E2D;&#xFF0C;&#x60C5;&#x51B5;&#x751A;&#x81F3;&#x66F4;&#x7CDF;&#x3002;&#x6BCF;&#x5F53;&#x589E;&#x52A0;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x65F6;&#xFF0C;&#x6574;&#x4E2A;&#x88AB;&#x8BBF;&#x95EE;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x88AB;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3001;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x3002;&#x5728;C++&#x4E2D;&#xFF0C;interface&#x4E00;&#x822C;&#x4F1A;&#x662F;&#x4E00;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x88AB;&#x6240;&#x6709;&#x5B9E;&#x4F53;&#x7C7B;&#x5305;&#x542B;&#xFF0C;&#x4E00;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#x6539;&#x52A8;&#xFF0C;&#x5219;&#x8BE5;&#x7C7B;&#x56FE;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x90FD;&#x4F1A;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;*&#x8FD9;&#x91CC;&#x53EA;&#x5F3A;&#x8C03;&#x7F16;&#x8BD1;&#xFF0C;&#x94FE;&#x63A5;&#x603B;&#x662F;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x505A;&#x7684;&#x3002;ACYCLIC VISITOR&#x7406;&#x89E3;&#x4E86;&#x4E3A;&#x4F55;&#x8981;&#x6709;ACYCLIC&#x53D8;&#x4F53;&#x4EE5;&#x540E;&#xFF0C;&#x518D;&#x770B;&#x4EC0;&#x4E48;&#x662F;ACYCLIC VISITOR&#xFF1A;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;Modem&#x7C7B;&#x90FD;&#x6709;&#x4E00;&#x4E2A;Visitor&#x63A5;&#x53E3;&#xFF0C;&#x6CE8;&#x610F;&#x662F;&#x63A5;&#x53E3;UnixModemConfigurator&#x5B9A;&#x4E49;&#x4E86;&#x6240;&#x6709;Modem&#x7684;Visitor&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x5B9A;&#x4E49;&#x4E86;&#x90A3;&#x4E2A;&#x7A7A;&#x7684;&#x63A5;&#x53E3;ModemVisitor&#x3002;&#x8FD9;&#x6837;Modem&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;ModemVisitor&#x63A5;&#x53E3;&#x8BBF;&#x95EE;&#x5230;UnixModemConfigurator&#x4E86;&#x3002;&#x56E0;&#x4E3A;ModemVisitor&#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x63A5;&#x53E3;&#xFF08;&#x9000;&#x5316;&#x7684;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7BA1;&#x6DFB;&#x52A0;&#x591A;&#x5C11;Modem&#x5B9E;&#x4F53;&#x7C7B;&#xFF0C;ModemVisitor&#x90FD;&#x4E0D;&#x7528;&#x4FEE;&#x6539;&#xFF0C;&#x90A3;Modem&#x63A5;&#x53E3;&#x4E0D;&#x7528;&#x8DDF;&#x7740;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;&#x53EA;&#x6709;&#x65B0;&#x589E;&#x52A0;&#x7684;Modem&#x5B9E;&#x4F53;&#x7C7B;&#x548C;UnixModemConfigurator&#x4F1A;&#x88AB;&#x7F16;&#x8BD1;&#x3002;ACYCLIC VISITOR&#x5F88;&#x5DE7;&#x5999;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x4F9D;&#x8D56;&#x73AF;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4ED6;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#xFF0C;&#x5728;&#x5B9E;&#x4F53;Modem&#x7C7B;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x5BF9;&#x4F20;&#x5165;&#x7684;ModemVisitor&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x5F3A;&#x5236;&#x7C7B;&#x578B;&#x8F6C;&#x5316;&#xFF0C;&#x53D8;&#x6210;&#x5BF9;&#x5E94;&#x7684;Visitor&#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x4F1A;&#x5BF9;&#x6267;&#x884C;&#x6548;&#x7387;&#x5F15;&#x5165;&#x4E0D;&#x786E;&#x5B9A;&#x6027;&#x3002;&#x66F4;&#x7CDF;&#x7CD5;&#x7684;&#x662F;&#xFF0C;&#x8F6C;&#x578B;&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x4F9D;&#x8D56;&#x4E8E;&#x88AB;&#x8BBF;&#x95EE;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x7684;&#x5BBD;&#x5EA6;&#x548C;&#x6DF1;&#x5EA6;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x96BE;&#x8FDB;&#x884C;&#x6D4B;&#x5B9A;&#x3002;&#x7531;&#x4E8E;&#x8F6C;&#x578B;&#x9700;&#x8981;&#x82B1;&#x8D39;&#x5927;&#x91CF;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E9B;&#x65F6;&#x95F4;&#x662F;&#x5C0F;&#x53EF;&#x9884;&#x6D4B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;ACYCLIC VISITOR&#x6A21;&#x5F0F;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x4E25;&#x683C;&#x7684;&#x5B9E;&#x65F6;&#x7CFB;&#x7EDF;&#x3002; &#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E0D;&#x7A33;&#x5B9A;&#xFF0C;&#x5E76;&#x4E14;&#x589E;&#x6688;&#x7F16;&#x8BD1;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#xFF0C;&#x8BE5;&#x6A21;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9; &#x3002;&#x4F55;&#x65F6;&#x4F7F;&#x7528;VISITOR&#x6A21;&#x5F0F;&#x62A5;&#x8868;&#x751F;&#x6210;&#x5668;&#x5176;&#x4ED6;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x5B58;&#x5728;&#x6709;&#x9700;&#x8981;&#x4EE5;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x89E3;&#x91CA;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;VISITOR&#x6A21;&#x5F0F;&#x3002;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x4E0E;&#x89C6;&#x56FE;&#x7684;&#x5206;&#x79BB;&#xFF0C;&#x7C7B;&#x4F3C;MVC&#x7684;&#x6982;&#x5FF5;&#x3002;DECORATOR&#x6700;&#x65E9;&#x63A5;&#x89E6;decorator&#x662F;&#x5728;python&#x7684;@&#x8BED;&#x6CD5;&#xFF0C;&#x53C2;&#x770B;&#x8FD9;&#x7BC7;&#x7B14;&#x8BB0;&#x7406;&#x89E3;Python&#x4E2D;&#x7684;&#x88C5;&#x9970;&#x5668;&#x3002;&#x90A3;&#x65F6;&#x5019;&#x8FD8;&#x4E0D;&#x61C2;&#x4EC0;&#x4E48;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002; &#x6700;&#x8FD1;&#x5728;&#x505A;Android&#x7A0B;&#x5E8F;&#x7684;JUnit&#x4EE3;&#x7801;&#x91CC;&#x4E5F;&#x6709;&#x88C5;&#x9970;&#x5668;&#x3002;&#x53EF;&#x89C1;&#x5176;&#x5E94;&#x7528;&#x4E4B;&#x5E7F;&#x3002; &#x73B0;&#x5728;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x6B63;&#x89C4;&#x7684;Decorator&#x600E;&#x4E48;&#x505A;&#xFF1F;Decorator&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x6D88;&#x9664;&#x91CD;&#x590D;&#x4EE3;&#x7801;&#x3002;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;Decorator&#xFF0C;&#x8981;&#x6D88;&#x9664;&#x59D4;&#x6258;&#x4EE3;&#x7801;&#x7684;&#x91CD;&#x590D;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x7C7B;&#x56FE;&#xFF1A;EXTENSION OBJECTPart&#x7528;HashMap&#x7BA1;&#x7406;PartExtensionPartExtension&#x662F;&#x4E00;&#x4E2A;&#x9000;&#x5316;&#x7684;&#x63A5;&#x53E3;&#xFF08;&#x5373;&#x65E0;&#x65B9;&#x6CD5;&#x7684;&#x63A5;&#x53E3;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8981;&#x505A;&#x5F3A;&#x5236;&#x7C7B;&#x578B;&#x8F6C;&#x6362;PartPiece&#x548C;Assembly&#x5728;&#x6784;&#x9020;&#x7684;&#x65F6;&#x5019;&#x6DFB;&#x52A0;&#x5BF9;&#x5E94;&#x7684;extension object&#xFF0C;&#x5219;&#x5728;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;get&#x51FA;&#x6765;PartPiece&#x548C;Assembly&#x5728;extension&#x6784;&#x9020;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x628A;&#x81EA;&#x5DF1;&#x4F20;&#x7ED9;&#x8BE5;extension&#xFF0C;&#x5219;&#x5B9E;&#x73B0;&#x4E86;Visit&#x529F;&#x80FD;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;EXTENSION OBJECTVisitor&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4E0D;&#x53BB;&#x4FEE;&#x6539;&#x7C7B;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5411;&#x5176;&#x4E2D;&#x6DFB;&#x52A0;&#x65B0;&#x529F;&#x80FD;&#x3002;&#x4F46;&#x662F;&#x6240;&#x6709;&#x7684;&#x8BBF;&#x95EE;&#x529F;&#x80FD;&#x90FD;&#x5728;&#x4E00;&#x4E2A;&#x7C7B;&#x5F53;&#x4E2D;&#xFF0C;&#x5982;&#x6211;&#x4EEC;&#x4F8B;&#x5B50;&#x662F;&#x5728;UnixModemConfigurator&#x4E2D;&#xFF0C;&#x800C;&#x4E14;&#x5BF9;&#x6BCF;&#x4E2A;Modem&#x7C7B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;visit&#x51FD;&#x6570;&#x3002; &#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x9694;&#x79BB;&#x5BF9;&#x5404;&#x4E2A;&#x7C7B;&#x7684;&#x8BBF;&#x95EE;&#x8FDB;&#x884C;&#x9694;&#x79BB;&#xFF0C;&#x6216;&#x8005;&#x9700;&#x8981;&#x5BF9;&#x4E00;&#x4E2A;&#x7C7B;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#xFF0C;VISITOR&#x6A21;&#x5F0F;&#x5C31;&#x505A;&#x4E0D;&#x5230;&#x4E86;&#x3002; &#x4E8E;&#x662F;&#x6709;&#x5347;&#x7EA7;&#x7248;&#x7684;VISITOR&#xFF0C;&#x4E5F;&#x5C31;&#x662F;EXTENSION OBJECT&#x3002;&#x6BCF;&#x4E00;&#x4E2A;&#x7C7B;&#x53EF;&#x4EE5;&#x6709;&#x4EFB;&#x610F;&#x591A;&#x7684;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#xFF0C;&#x4E14;&#x6BCF;&#x4E2A;&#x7C7B;&#x4E4B;&#x95F4;&#x7684;&#x8BBF;&#x95EE;&#x548C;&#x4E0D;&#x540C;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#x4E4B;&#x95F4;&#x90FD;&#x662F;&#x9694;&#x79BB;&#x7684;&#x3002;&#x4F8B;&#x5982;&#x672C;&#x4F8B;&#x4E2D;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x7C7B;&#xFF08;PartPiece &amp; Assembly&#xFF09;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#xFF08;XML &amp; CSV&#xFF09;&#x3002;&#x6240;&#x4EE5;&#x603B;&#x5171;&#x6709;4&#x4E2A;extension object&#x3002;*&#x4F5C;&#x8005;&#x65F6;&#x65F6;&#x5728;&#x63D0;&#x9192;&#x6211;&#x4EEC;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x662F;&#x4ECE;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x6F14;&#x5316;&#x800C;&#x6765;&#xFF0C;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x90FD;&#x521A;&#x597D;&#x8BA9;&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#xFF0C;&#x4E0D;&#x591A;&#x4E5F;&#x4E0D;&#x5C11;&#x3002;&#xFF08;&#x8FD9;&#x4E2A;&#x8282;&#x594F;&#x5F88;&#x96BE;&#x628A;&#x63E1;&#xFF0C;&#x8FD8;&#x5728;&#x5B66;&#x4E60;&#x4E2D;&#xFF09;&#x4E0D;&#x8981;&#x4E3A;&#x4E86;&#x6A21;&#x5F0F;&#x800C;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x662F;&#x5148;&#x6709;&#x4EE3;&#x7801;&#xFF0C;&#x8981;&#x6D88;&#x9664;&#x91CD;&#x590D;&#xFF0C;&#x91CD;&#x6784;&#x65F6;&#x624D;&#x6162;&#x6162;&#x6F14;&#x5316;&#x6210;&#x9002;&#x5F53;&#x7684;&#x6A21;&#x5F0F;&#x3002;&#x800C;&#x6A21;&#x5F0F;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x6807;&#x51C6;&#x7684;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x7ECF;&#x8FC7;&#x4FEE;&#x6539;&#x800C;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x7684;&#x770B;&#x770B;&#x6700;&#x4E00;&#x5F00;&#x59CB;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;public PartExtension getExtension(String extensionType){ if (extensionType.equals(&quot;&quot;XML&quot;)) return new XMLPiecePartExtension(this); else if (extensionType.equals(&quot;CSV&quot;)) return new XMLAssemblyExetnsion(this); return new BadPartExtertsion();}STATESTATE&#x6A21;&#x5F0F;&#x8FD9;&#x5C31;&#x662F;&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;&#x3002;&#x5176;&#x5E94;&#x7528;&#x76F8;&#x5F53;&#x5E7F;&#x6CDB;&#x2014;&#x2014;UI&#xFF0C;&#x6570;&#x636E;&#x63A5;&#x53E3;&#xFF08;&#x4F8B;&#x5982;control panel&#x7684;&#x547D;&#x4EE4;&#xFF09;&#x7B49;&#x7B49;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x5341;&#x5B57;&#x8F6C;&#x95E8;&#x7684;&#x72B6;&#x6001;&#x8FC1;&#x79FB;&#x56FE;&#x3002;&#x770B;&#x770B;&#x771F;&#x6B63;&#x7684;STATE&#x6A21;&#x5F0F;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;TurstyleState&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#xFF0C;&#x4EE3;&#x8868;&#x72B6;&#x6001;&#x672C;&#x8EAB;Turnstyle&#x4EE3;&#x8868;&#x4E86;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x5176;&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;&#x72B6;&#x6001;&#x8FC1;&#x79FB;&#x65F6;&#x4EA7;&#x751F;&#x7684;&#x52A8;&#x4F5C;TurstyleState&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x8D1F;&#x8D23;&#x8C03;&#x7528;Turnstyle&#x7684;&#x72B6;&#x6001;&#x8FC1;&#x79FB;&#x63A5;&#x53E3;&#xFF0C;&#x548C;&#x8FC1;&#x79FB;&#x52A8;&#x4F5C;&#x3002;STATE&#x6A21;&#x5F0F;&#x5F7B;&#x5E95;&#x5730;&#x5206;&#x79BB;&#x4E86;&#x72B6;&#x6001;&#x673A;&#x7684;&#x903B;&#x8F91;&#x548C;&#x52A8;&#x4F5C;&#x3002;&#x52A8;&#x4F5C;&#x662F;&#x5728;Context&#x7C7B;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x800C;&#x903B;&#x8F91;&#x5219;&#x662F;&#x5206;&#x5E03;&#x5728;STATE&#x7C7B;&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x4E2D;&#x3002;&#x8FD9;&#x5C31;&#x4F7F;&#x5F97;&#x4E8C;&#x8005;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x5730;&#x72EC;&#x7ACB;&#x53D8;&#x5316;&#x3001;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;&#x3002;STATE vs. STRATEGY&#x5728;STATE&#x6A21;&#x5F0F;&#x4E2D;&#xFF0C;&#x6D3E;&#x751F;&#x7C7B;&#x6301;&#x6709;&#x56DE;&#x6307;&#x5411;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x7684;&#x5F15;&#x7528;&#x3002;&#x6D3E;&#x751F;&#x7C7B;&#x7684;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x662F;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5F15; &#x7528;&#x9009;&#x62E9;&#x5E76;&#x8C03;&#x7528;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5728;STRATEGY&#x6A21;&#x5F0F;&#x4E2D;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x8FD9;&#x6837;&#x7684;&#x9650;&#x5236;&#x4EE5;&#x53CA;&#x610F;&#x56FE;&#x3002;STRATEGY&#x7684;&#x6D3E;&#x751F;&#x7C7B;&#x4E0D;&#x5FC5;&#x6301;&#x6709;&#x6307;&#x5411;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x53BB;&#x8C03;&#x7528;&#x4E0A;&#x4E0B;&#x6587;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x6240;&#x6709;&#x7684;STATE&#x6A21;&#x5F0F;&#x5B9E;&#x4F8B;&#x540C;&#x6837;&#x4E5F;&#x662F;STRATEGY&#x6A21;&#x5F0F;&#x5B9E;&#x4F8B;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x975E;&#x6240;&#x6709;&#x7684;STRATEGY&#x6A21;&#x5F0F;&#x5B9E;&#x4F8B;&#x90FD;&#x662F;STATE&#x6A21;&#x5F0F;&#x5B9E;&#x4F8B; SMC&#x2014;&#x2014;&#x72B6;&#x6001;&#x673A;&#x7F16;&#x8BD1;&#x5668;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x5668;&#x3002;&#x5728;&#x524D;&#x9762;&#x4ECB;&#x7ECD;STATE&#x6A21;&#x5F0F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x5176;&#x5B9E;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x72B6;&#x6001;&#x8FC1;&#x79FB;&#x8868;&#x3002;&#x8FD9;&#x6837;&#x4E00;&#x7AE0;&#x8868;&#x683C;&#x5176;&#x5B9E;&#x5305;&#x542B;&#x4E86;&#x6574;&#x4E2A;&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;&#x7CFB;&#x7EDF;&#x6240;&#x6709;&#x7684;&#x903B;&#x8F91;&#x3002;&#x800C;SMC&#x5C31;&#x662F;&#x6839;&#x636E;&#x8FD9;&#x6837;&#x4E00;&#x5F20;&#x7C7B;&#x4F3C;&#x7684;&#x8868;&#x683C;&#x6765;&#x751F;&#x6210;STATE&#x6A21;&#x5F0F;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x7C7B;&#x3002;%0A%23%u654F%u6377%u8F6F%u4EF6%u5F00%u53D1%uFF0D%u539F%u5219%u3001%u6A21%u5F0F%u4E0E%u5B9E%u8DF5%0A@%28myblog%29%5B%u8F6F%u4EF6%u5F00%u53D1%2C%20%u8BBE%u8BA1%u6A21%u5F0F%5D%0A%0A%5BTOC%5D%0A%0A%23%23%u7B2C1-6%u7AE0%0A%23%23%23%u654F%u6377%u5B9E%u8DF5%u7684%u539F%u5219%0A1.%20%u4EBA%u6BD4%u5DE5%u5177%u91CD%u8981%uFF0C%u5E94%u5148%u6784%u5EFA%u56E2%u961F%uFF0C%u518D%u8BA9%u56E2%u961F%u57FA%u4E8E%u9700%u8981%u914D%u7F6E%u73AF%u5883%0A2.%20%u76F4%u5230%u8FEB%u5207%u9700%u8981%u5E76%u4E14%u610F%u4E49%u91CD%u5927%u65F6%uFF0C%u624D%u6765%u7F16%u5236%u6587%u6863%u3002%u9488%u5BF9%u7CFB%u7EDF%u539F%u7406%u548C%u7ED3%u6784%u65B9%u9762%u7684%u6587%u6863%uFF0C%u5E94%u4EC5%u8BBA%u8FF0%u7CFB%u7EDF%u7684%u9AD8%u5C42%u7ED3%u6784%u548C%u6982%u62EC%u7684%u8BBE%u8BA1%u539F%u7406%0A3.%20%u5BA2%u6237%u5408%u540C%u6307%u5BFC%u534F%u4F5C%uFF0C%u800C%u4E0D%u662F%u8BD5%u56FE%u53BB%u89C4%u5B9A%u9879%u76EE%u8303%u56F4%u7684%u7EC6%u8282%u548C%u56FA%u5B9A%u6210%u672C%u4E0B%u7684%u8FDB%u5EA6%u3002%0A4.%20%u4E3A%u4E0B%u4E24%u5468%u505A%u8BE6%u7EC6%u7684%u8BA1%u5212%uFF0C%u4E3A%u4E0B%u4E09%u4E2A%u6708%u505A%u7C97%u7565%u7684%u8BA1%u5212%uFF0C%u518D%u4EE5%u540E%u5C31%u505A%u6781%u4E3A%u7C97%u7CD9%u7684%u8BA1%u5212%u3002%0A%0A%23%23%23%u6781%u9650%u7F16%u7A0B%0A1.%20%u5BA2%u6237%u4F5C%u4E3A%u56E2%u961F%u6210%u5458%0A%26nbsp%3B%09%09*%20%u7528%u6237%u7D20%u6750%28user%20stories%29%3A%20UML%20Use%20Case%u56FE%u7684Feature%u3002%u53C2%u770B%5BUML%20Distilled%u7B14%u8BB0%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/40ed6ed0-a555-4b13-9226-6fafe34a9254%3Ftitle%3DUML%2520Distilled%2520%28UML%25E7%25B2%25BE%25E7%25B2%25B9%29%29%u3002%0A%3E%u5728XP%u4E2D%uFF0C%u6211%u4EEC%u548C%u5BA2%u6237%u53CD%u590D%u8BA8%u8BBA%uFF0C%u4EE5%u83B7%u53D6%u5BF9%u4E8E%u9700%u6C42%u7EC6%u8282%u7684%u7406%u89E3%uFF0C**%u4F46%u662F%u4E0D%u53BB%u6355%u83B7%u90A3%u4E9B%u7EC6%u8282**%u3002%u6211%u4EEC%u66F4%u613F%u610F**%u5BA2%u6237%u5728%u7D22%u5F15%u5361%u7247%u4E0A%u5199%u4E0B%u4E00%u4E9B%u6211%u4EEC%u8BA4%u53EF%u7684%u8BCD%u8BED**%uFF0C%u8FD9%u4E9B%u8BCD%u8BED%u53EF%u4EE5%u63D0%u9192%u6211%u4EEC%u8BB0%u8D77%u8FD9%u6B21%u4EA4%u8C08%u3002%u57FA%u672C%u4E0A%u5728%u548C%u5BA2%u6237%u8FDB%u884C%u4E66%u5199%u7684%u540C%u4E00%u523B%uFF0C%u5F00%u53D1%u4EBA%u5458%u5728%u8BE5%u5361%u7247%u4E0A%u5199%u4E0B%u5BF9%u5E94%u4E8E%u5361%u7247%u4E0A%u9700%u6C42%u7684**%u4F30%u7B97**%u3002%u4F30%u7B97%u65F6%u57FA%u4E8E%u548C%u5BA2%u6237%u8FDB%u884C%u4EA4%u8C08%u671F%u95F4%u6240%u5F97%u5230%u7684%u5BF9%u4E8E%u7EC6%u8282%u7684%u7406%u89E3%u8FDB%u884C%u7684%u3002%0A%0A%0A2.%20%u77ED%u4EA4%u4ED8%u5468%u671F%uFF0C%u6BCF2%u5468%u8FED%u4EE3%u4E00%u6B21%uFF0C%u5E76%u4EA4%u4ED8%u5BA2%u6237%u4F7F%u7528%uFF0C%u6BCF12%u5468%u4E00%u6B21%u53D1%u5E03%0A3.%20%u6BCF%u6B21%u4EA4%u4ED8%u90FD%u6709%u5BA2%u6237%u9488%u5BF9feature%u7684%u9A8C%u6536%u6D4B%u8BD5%0A4.%20%u7ED3%u5BF9%u7F16%u7A0B%0A5.%20%u96C6%u4F53%u6240%u6709%u6743%uFF0C%u6307%u4E0D%u56FA%u5B9Aexpert%uFF0C%u51ED%u5174%u8DA3%u51B3%u5B9A%u60F3%u505A%u7684%u65B9%u5411%u3002%0A6.%20%u6301%u7EED%u96C6%u6210%uFF0C%u7C7B%u540C%u7B2C2%u70B9%0A7.%20%u53EF%u6301%u7EED%u7684%u5F00%u53D1%u901F%u5EA6%u3002%u4E0D%u5141%u8BB8%u52A0%u73ED%uFF0C%u7248%u672C%u53D1%u5E03%u524D%u4E00%u4E2A%u793C%u62DC%u4F8B%u5916%0A%3E%u8F6F%u4EF6%u9879%u76EE%u4E0D%u662F%u5168%u901F%u7684%u77ED%u8DD1%uFF0C%u5B83%u662F%u9A6C%u62C9%u677E%u957F%u8DD1%u3002%0A8.%20%u5F00%u653E%u7684%u5DE5%u4F5C%u7A7A%u95F4%0A9.%20%u8BA1%u5212%u6E38%u620F%0A10.%20%u7B80%u5355%u7684%u8BBE%u8BA1%0A%3EXP%u56E2%u961F%u603B%u662F%u5C3D%u53EF%u80FD%u5BFB%u627E%u80FD%u5B9E%u73B0%u5F53%u524Dfeature%u7684%u6700%u7B80%u5355%u7684%u8BBE%u8BA1%0A11.%20%u91CD%u6784%u662F%u6301%u7EED%u8FDB%u884C%u7684%uFF0C%u6BCF%u9694%u4E00%u4E2A%u5C0F%u65F6%u6216%u534A%u4E2A%u5C0F%u65F6%u5C31%u8981%u53BB%u505A%u7684%u4E8B%u60C5%u3002%0A12.%20%u9690%u55BB%20%uFF08%u6CA1%u770B%u61C2%uFF09%0A%0A%u603B%u7ED3%uFF0C%u8FD9%u91CC%u6781%u9650%u7F16%u7A0B%u5176%u5B9E%u5F3A%u8C03%u7684%u66F4%u591A%u7684%u662F%u8F6F%u4EF6%u5F00%u53D1%u56E2%u961F%u7684%u8FD0%u4F5C%u65B9%u5F0F%uFF0C%u9700%u8981%u5404%u65B9%u9762%u8FBE%u6210%u4E00%u81F4%uFF0C%u624D%u80FD%u4E25%u683C%u6309%u7167%u4ED6%u7684%u6BCF%u4E00%u6761%u53BB%u505A%u3002%u4F46%u662F%uFF0C%u5373%u4FBF%u5728%u6211%u4EEC%u73B0%u5728%u7684%u73AF%u5883%u4E0B%uFF0C%u4E0D%u7BA1%u662F%u6781%u9650%u7F16%u7A0B%u8FD8%u662F%u654F%u6377%u65B9%u6CD5%u90FD%u4E0D%u4E3A%u4EBA%u6240%u77E5%uFF0C%u6CA1%u529E%u6CD5%u5B8C%u5168%u5F00%u5C55%u3002%u4F46%u662F%u91CC%u9762%u7684%u4E00%u4E9B%u89C2%u70B9%u5F88%u6709%u542F%u53D1%u610F%u4E49%uFF0C%u4ECD%u7136%u53EF%u4EE5%u5E94%u7528%u5230%u6211%u4EEC%u65E5%u5E38%u7684%u9879%u76EE%u5F53%u4E2D%u3002%u6BD4%u5982%u7B2C%u4E00%u70B9%uFF0C%u8981%u6C42%u5F00%u53D1%u4EBA%u5458%u5B9E%u65F6%u540C%u5BA2%u6237%u4EA4%u6D41%uFF0C%u5E76%u9009%u5B9Afeature%u6216%u53CA%u65F6%u4FEE%u6539%u5F00%u53D1%u65B9%u6848%u3002%u7B2C%u4E8C%u70B9%uFF0C%u4E0D%u65AD%u7684%u4EA4%u4ED8%u3002%u5176%u5B9E%u90FD%u53EF%u4EE5%u9A6C%u4E0A%u8FD0%u7528%u4E0A%u3002%0A%0A%23%23%u7B2C7-12%u7AE0%0A%u867D%u7136%u4E66%u6CA1%u770B%u5B8C%uFF0C%u4F46%u662F%u611F%u89C9%u8FD9%u4E00%u90E8%u5206%u662F%u5168%u4E66%u7684%u6838%u5FC3%uFF0C%u5373%u654F%u6377%u5F00%u53D1%u7684%u539F%u5219%u3002%0A%3E%u4EC0%u4E48%u662F%u654F%u6377%u8BBE%u8BA1%uFF1F%0A%3E%u654F%u6377%u8BBE%u8BA1%u662F%u4E00%u4E2A%u8FC7%u7A0B%uFF0C%u4E00%u4E2A%u6301%u7EED%u7684%u5E94%u7528%u539F%u5219%u3001%u6A21%u5F0F%u4EE5%u53CA%u5B9E%u8DF5%u6765%u6539%u8FDB%u8F6F%u4EF6%u7684%u7ED3%u6784%u548C%u53EF%u8BFB%u6027%u7684%u8FC7%u7A0B%u3002%0A%0A%u6362%u800C%u8A00%u4E4B%uFF0C%u5C31%u662F%u4E0D%u8981%u968F%u968F%u4FBF%u4FBF%u6253%u8865%u4E01%uFF0C%u8BA9%u7A0B%u5E8F%u80FD%u8FD0%u884C%u6EE1%u8DB3%u9700%u6C42%u4FEE%u6539%uFF0C%u800C%u662F%u5E94%u7528%u5404%u79CD%u65B9%u6CD5%u4F7F%u7A0B%u5E8F%u66F4%u5177%u5F39%u6027%u3002%u53E6%u4E00%u65B9%u9762%uFF0C%u53C8%u4E0D%u4E3A%u4E86%u4FEE%u6539%u800C%u4FEE%u6539%uFF0C%u4E0D%u4E3A%u4E86%u5B50%u865A%u4E4C%u6709%u7684%u5F39%u6027%uFF0C%u82B1%u8D39%u989D%u5916%u7684%u7CBE%u529B%u6765%u8FBE%u5230%u60F3%u8C61%u4E2D%u7684%u5F39%u6027%u8BBE%u8BA1%u3002%0A%0A8-12%u7AE0%u4E3A%u6211%u4EEC%u4ECB%u7ECD%u4E86%u9762%u5411%u5BF9%u8C61%u8BBE%u8BA1%u76845%u539F%u5219%uFF1A%0A-%20SRP%3A%20%u5355%u4E00%u804C%u8D23%u539F%u5219%0A-%20OCP%3A%20%u5F00%u653E%u5C01%u95ED%u539F%u5219%0A-%20LSP%3A%20Linskov%u66FF%u6362%u539F%u5219%0A-%20DIP%3A%20%u4F9D%u8D56%u5012%u7F6E%u539F%u5219%0A-%20ISP%3A%20%u63A5%u53E3%u9694%u79BB%u539F%u5219%0A%0A%u9010%u4E00%u6458%u5F55%u5982%u4E0B%uFF1A%0A%0A%23%23%23%20SRP%0A%3E%u5728SRP%u4E2D%uFF0C%u6211%u4EEC%u628A%u804C%u8D23%u5B9A%u4E49%u4E3A%u201C%u53D8%u5316%u7684%u539F%u56E0%u201D%u3002%u5982%u679C%u4F60%u80FD%u60F3%u5230%u591A%u4E8E%u4E00%u4E2A%u7684%u52A8%u673A%u53BB%u6539%u53D8%u4E00%u4E2A%u7C7B%uFF0C%u90A3%u4E48%u8FD9%u4E2A%u7C7B%u5C31%u5177%u6709%u591A%u4E8E%u4E00%u4E2A%u7684%u804C%u8D23%u3002%0A%3E%u5982%u679C%u5E94%u7528%u7A0B%u5E8F%u7684%u53D8%u5316%u65B9%u5F0F%u603B%u662F%u5BFC%u81F4%u8FD9%u4E24%u4E2A%u804C%u8D23%u540C%u65F6%u53D8%u5316%uFF0C%u90A3%u4E48%u5C31%u4E0D%u5FC5%u5206%u79BB%u4ED6%u4EEC%u3002%0A%0A%u7B2C%u4E00%u6B21%u7684%u8BBE%u8BA1%uFF0C%u6211%u4EEC%u5E38%u89C1%u7684%0ANA%0A%u5206%u79BB%u8FC7%u804C%u8D23%u4EE5%u540E%0ANA%0A%u8FD9%u6837%u7684%u8BBE%u8BA1%uFF0C%u5982%u679C%u4E24%u4E2A%u63A5%u53E3%u53D8%u5316%u9891%u7387%u975E%u5E38%u4E0D%u4E00%u81F4%u65F6%uFF0C%u53EF%u4EE5%u51CF%u5C11%u91CD%u65B0%u90E8%u7F72%u7684%u8303%u56F4%u3002%0A%0A%23%23%23OCP%0A1.%20%u5BF9%u4E8E%u6269%u5C55%u5F00%u653E%0A2.%20%u5BF9%u4E8E%u4FEE%u6539%u5173%u95ED%0A%0A%u600E%u4E48%u80FD%u505A%u5230%u5462%uFF1F%u770B%u4E0B%u9762%u7684%u56FE%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1471165809639.png%29%0AClient%u4E0EClient%20Interface%u4E4B%u95F4%u662F%u5173%u8054%u7684%u5173%u7CFB%uFF0C%u8FD9%u91CC%u5E94%u8BE5%u662F%u4F9D%u8D56%u5173%u7CFB%uFF0C%u5373Client%u4F1A%u8C03%u7528Client%20Interface%uFF0CServer%u7EE7%u627F%u81EAClient%20Interface%u3002%u5177%u4F53UML%u56FE%u4F8B%u53EF%u4EE5%u53C2%u8003%u7B14%u8BB0%5BUML%u56FE%20%20%u7B26%u53F7%u7684%u542B%u4E49%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/3f2a96ed-4b1f-444c-83ce-1a403fdd26eb%29%u3002%0A%0A%3E%u62BD%u8C61%u7C7B%u548C%u5B83%u4EEC%u7684%u5BA2%u6237%u7684%u5173%u7CFB%u8981%u6BD4%u548C%u5B9E%u73B0%u5B83%u4EEC%u7684%u7C7B%u7684%u5173%u7CFB%u66F4%u5BC6%u5207%u3002%0A%3E%u610F%u601D%u662F%uFF0CClient%u4E0EClient%20Interface%u7684%u5173%u7CFB%u8981%u6BD4%u5176%u4E0EServer%u7684%u5173%u7CFB%u66F4%u5BC6%u5207%u3002%0A%0A%u8BF4%u5230%u8FD9%u91CC%uFF0C%u8FD9%u4E2A%u539F%u5219%u5176%u5B9E%u5DF2%u7ECF%u5F88%u6E05%u6670%u4E86%uFF0C%u4F46%u4F5C%u8005%u5E0C%u671B%u544A%u8BC9%u6211%u4EEC%u66F4%u591A%u3002%u5728%u300A%u662F%u7684%uFF0C%u6211%u8BF4%u8C0E%u4E86%u300B%u90A3%u4E00%u8282%u91CC%uFF0C%u4F5C%u8005%u544A%u8BC9%u6211%u4EEC%uFF0C%u4E8B%u5B9E%u5E76%u4E0D%u603B%u50CF%u60F3%u8C61%u4E2D%u90A3%u4E48%u7F8E%u597D%u3002%u5F80%u5F80%u4F1A%u6709%u5404%u79CD%u7A00%u5947%u53E4%u602A%u7684%u9700%u6C42%uFF0C%u5BFC%u81F4%u539F%u5148%u7684%u8BBE%u8BA1%u4E0D%u80FD%u5BF9%u8BE5%u9700%u6C42%u5BFC%u81F4%u7684%u53D8%u5316%u5C01%u95ED%u3002%u4F5C%u8005%u7ED9%u4E86%u6211%u4EEC%u5FE0%u544A%uFF1A%0A%3E%u8BBE%u8BA1%u4EBA%u5458%u5FC5%u987B%u5BF9%u4E8E%u4ED6%u8BBE%u8BA1%u7684%u6A21%u5757%u5E94%u8BE5%u5BF9%u54EA%u79CD%u53D8%u5316%u5C01%u95ED%u505A%u51FA%u9009%u62E9%u3002%u4ED6%u5FC5%u987B%u5148%u731C%u6D4B%u51FA%u6700%u4F18%u53EF%u80FD%u53D1%u751F%u53D8%u5316%u7684%u79CD%u7C7B%uFF0C%u7136%u540E%u6784%u9020%u62BD%u8C61%u6765%u9694%u79BB%u90A3%u4E9B%u53D8%u5316%u3002%0A%3E%u8FD9%u662F%u5F88%u4E0D%u5BB9%u6613%u505A%u5230%u7684%uFF0C%u8981%u6839%u636E%u7ECF%u9A8C%u731C%u6D4B%u54EA%u4E9B%u5E94%u7528%u7A0B%u5E8F%u5728%u751F%u957F%u5386%u7A0B%u4E2D%u6709%u53EF%u80FD%u7684%u53D8%u5316%u3002%0A%0A%u5982%u4F55%u9694%u79BB%u53D8%u5316%uFF1A%0A1.%20%u5728%u53D1%u73B0%u7B2C%u4E00%u6B21%u53D8%u5316%u65F6%uFF0C%u8FDB%u884C%u62BD%u8C61%u6539%u9020%u3002%0A2.%20%u901A%u8FC7%u6D4B%u8BD5+%u5FEB%u901F%u8FED%u4EE3%u6765%u523A%u6FC0%u53D8%u5316%uFF0C%u5C3D%u5FEB%u5C06%u53D8%u5316%u7684%u53EF%u80FD%u66B4%u9732%u51FA%u6765%u3002%0A%0A%u672C%u7AE0%u8FD8%u4ECB%u7ECD%u4E86%u4E00%u79CD%u5F88%u5B9E%u7528%u7684%u5C01%u95ED%u53D8%u5316%u7684%u65B9%u6CD5%uFF0C%u4F7F%u7528%u201C%u6570%u636E%u9A71%u52A8%u201D%u65B9%u6CD5%u3002%u5176%u5B9E%u5C31%u662F%u8868%u683C%u9A71%u52A8%u3002%u5C06%u53D8%u5316%u7684%u90E8%u5206%u603B%u7ED3%u56FA%u5316%u5230%u8868%u683C%u4E2D%u3002%0A%0A%3E%u5F00%u53D1%u4EBA%u5458%u5E94%u8BE5%u4EC5%u4EC5%u5BF9%u7A0B%u5E8F%u4E2D%u5448%u73B0%u51FA%u9891%u7E41%u53D8%u5316%u7684%u90A3%u4E9B%u90E8%u5206%u505A%u51FA%u62BD%u8C61%u3002%u62D2%u7EDD%u4E0D%u6210%u719F%u7684%u62BD%u8C61%u548C%u62BD%u8C61%u672C%u8EAB%u4E00%u6837%u91CD%u8981%0A%0A%23%23%23LSP%0A%3E%20LSP%20-%20%u5B50%u7C7B%u578B%uFF08%u7684%u65B9%u6CD5%uFF09%u5FC5%u987B%u80FD%u591F%u66FF%u6362%u6389%u5B83%u4EEC%u7684%u57FA%u7C7B%u578B%uFF08%u7684%u65B9%u6CD5%uFF09%u3002%0A%0ALinskov%u9996%u6B21%u63D0%u51FA%u8FD9%u4E2A%u539F%u5219%u3002%0A%u672C%u7AE0%u4E3E%u7684%u4F8B%u5B50%u662F%u6B63%u65B9%u5F62vs.%u77E9%u5F62%u3002%u4EE5%u5E38%u7406%u63A8%u8BBA%u6B63%u65B9%u5F62IS-A%u77E9%u5F62%uFF0C%u6240%u4EE5%u6B63%u65B9%u5F62%u7684%u7C7B%u5E94%u5F53%u53EF%u4EE5%u7EE7%u627F%u81EA%u77E9%u5F62%u7684%u7C7B%u3002%u4F46%u4EE5%u66FF%u6362%u539F%u5219%u770B%uFF0C%u5728%u67D0%u4E9B%u60C5%u51B5%u4E0B%u6B63%u65B9%u5F62%u548C%u77E9%u5F62%u7684%u884C%u4E3A%u5E76%u4E0D%u4E00%u81F4%u3002%0A%60%60%60%0Avoid%20g%20%28Rectangle%26%20r%29%0A%7B%0A%09r.SetWidth%285%29%3B%0A%09r.SetHeight%284%29%3B%0A%09assert%28r.Area%28%29%20%3D%3D%2020%29%3B%0A%7D%0A%60%60%60%0A%u5982%u679Cr%u4F20%u5165%u7684%u662F%u6B63%u65B9%u5F62%u5BF9%u8C61%uFF0C%u5219%u5FC5%u7136%u4F1A%u51FA%u65AD%u8A00%uFF0C%u6240%u4EE5%u8FD9%u6BB5%u4EE3%u7801%u4E0D%u7B26%u5408LSP%u3002%0A%3EOOD%u4E2D**IS-A**%u5173%u7CFB%u662F%u5C31%u884C%u4E3A%u65B9%u5F0F%u800C%u8A00%u3002%0A%0A%u53EF%u89C1%uFF0C%u867D%u7136%u4EE3%u7801%u662F%u73B0%u5B9E%u751F%u6D3B%u7684%u62BD%u8C61%uFF0C%u4F46%u4E5F%u4E0D%u5B8C%u5168%u662F%u3002%u5982%u4F55%u89C4%u907F%uFF0C%u6216%u8005%u8BF4%u53D1%u73B0%u8FD9%u79CD%u5FAE%u5999%u7684%u4E0D%u540C%u3002%u4F5C%u8005%u7ED9%u51FA%u4E00%u4E2A%u65B9%u6CD5%u5C31%u662F%u57FA%u4E8E%u5951%u7EA6%u7684%u8BBE%u8BA1%u3002%u901A%u8FC7%u8BBE%u7F6E%u524D%u540E%u7F6E%u6761%u4EF6%uFF0C%u6765%u786E%u5B9A%u662F%u5426IS-A%u5173%u7CFB%u3002%0A%3E%u6D3E%u751F%u7C7B%u4E2D%u7684%u4F8B%u7A0B%0A%3E-%20%u53EA%u80FD%u4F7F%u7528%u76F8%u7B49%u6216%u66F4%u5F31%u7684%u524D%u7F6E%u6761%u4EF6%u6765%u66FF%u6362%u539F%u59CB%u7684%u524D%u7F6E%u6761%u4EF6%uFF0C%0A%3E-%20%u53EA%u80FD%u4F7F%u7528%u76F8%u7B49%u6216%u66F4%u5F3A%u7684%u540E%u7F6E%u6761%u4EF6%u6765%u66FF%u6362%u539F%u59CB%u7684%u540E%u7F6E%u6761%u4EF6%u3002%0A%3E-%20%u53EF%u4EE5%u5728%u5355%u5143%u6D4B%u8BD5%u4E2D%u6307%u5B9A%u524D%u540E%u7F6E%u6761%u4EF6%uFF0C%u6765%u770B%u662F%u5426%u6EE1%u8DB3IS-A%u7684%u5173%u7CFB%uFF0C%u5982%u679C%u4E0D%u6EE1%u8DB3%u5C31%u8981%u91CD%u65B0%u8BBE%u8BA1%u3002%0A%0A*%20%u6240%u8C13%u6761%u4EF6%u5F3A%uFF0C%u5373%u7EA6%u675F%u591A%uFF0C%u6761%u4EF6%u5F31%uFF0C%u5373%u7EA6%u675F%u5C11%u3002%0A%0A%u5982%u4F55%u8BA9%u4EE3%u7801%u505A%u5230LSP%uFF0C%u65B9%u6CD5%u5C31%u662F%u6452%u5F03%u66FE%u7ECF%u7684%u62BD%u8C61%u65B9%u6CD5%uFF0C%u901A%u8FC7%u5728%u5B9E%u8DF5%u4E2D%uFF0C%u603B%u7ED3%u4E24%u4E2A%u7C7B%u884C%u4E3A%u4E00%u81F4%u7684%u90E8%u5206%uFF0C%u5E76%u63D0%u53D6%u51FA%u516C%u6709%u7684%u62BD%u8C61%u7236%u7C7B%u3002%u4E0B%u56FE%u662F%u4F8B%u5B50%0A%21%5BAlt%20text%7C400x0%5D%28./1471391264213.png%29%0A%u8FD9%u5E45%u56FEPersistentSet%u76F4%u63A5%u4ECESet%u7EE7%u627F%uFF0C%u5E76%u76F4%u63A5%u59D4%u6258%28delegate%29%u51FA%u53BB%uFF0C%u5176%u59D4%u6258%u7684%u4EE3%u7801%u53EA%u63A5%u53D7%u4E00%u79CD%u53C2%u6570PersistentObject%u3002%u90A3%u8FD9%u4E2A%u65B9%u6CD5%u5C31%u4E0D%u80FD%u66FF%u4EE3Set%u7684%u65B9%u6CD5%uFF0C%u4F1A%u6709%u4E0D%u53EF%u9884%u77E5%u7684%u4E8B%u60C5%u53D1%u751F%u3002%0A%0A%21%5BAlt%20text%7C500x0%5D%28./1471391282049.png%29%0A%u8FD9%u5F20%u56FE%u5C06PersistentSet%u653E%u5230%u4E0ESet%u540C%u7B49%u7684%u4F4D%u7F6E%uFF0C%u4ED6%u4EEC%u5171%u540C%u7EE7%u627F%u4E8E%u4E00%u4E2A%u516C%u5171%u62BD%u8C61%u7236%u7C7B%uFF0CSet%u7684%u5B50%u7C7B%u4E0D%u77E5%u9053PersistentSet%u7C7B%u7684%u5B58%u5728%uFF0C%u6240%u4EE5%u5C31%u4E0D%u4F1A%u6709%u4E0A%u56FE%u7684%u95EE%u9898%u53D1%u751F%u3002%0A%0A%u6709%u53EF%u80FD%u5F15%u8D77%u8FDD%u53CDLSP%u7684%u4E24%u79CD%u60C5%u51B5%uFF1A%0A1.%20%u6D3E%u751F%u7C7B%u4E2D%u65B9%u6CD5%u5B9A%u4E49%u4E3A%u7A7A%u51FD%u6570%uFF0C%u8FD9%u79CD%u60C5%u51B5%u867D%u7136%u6CA1%u6709%u8FDD%u53CDLSP%uFF0C%u4F46%u4ECD%u7136%u4F1A%u5F15%u8D77%u5F15%u7528%u7236%u7C7B%u6307%u9488%u65F6%u7684%u5FAE%u5999%u533A%u522B%u3002%0A2.%20%u4ECE%u6D3E%u751F%u7C7B%u629B%u51FA%u5F02%u5E38%uFF0C%u660E%u663E%u8FDD%u72AFLSP%uFF0C%u5982%u679C%u8981%u9075%u5FAALSP%uFF0C%u8981%u4E48%u9700%u8981%u4FEE%u6539%u7236%u7C7B%u53CA%u4F7F%u7528%u9884%u671F%uFF0C%u8981%u4E48%u4E0D%u629B%u5F02%u5E38%u3002%0A%0A%3E%u603B%u7ED3%uFF1A%u5B50%u7C7B%u578B%u7684%u6B63%u786E%u5B9A%u4E49%u662F%u201C%u53EF%u66FF%u6362%u6027%u7684%u201D%uFF0C%u8FD9%u91CC%u7684%u53EF%u66FF%u6362%u6027%u53EF%u4EE5%u901A%u8FC7%u663E%u5F0F%u6216%u8005%u9690%u5F0F%u7684%u5951%u7EA6%u6765%u5B9A%u4E49%u3002%0A%0A%23%23%23DIP%0A%u8FD9%u4E00%u6761%u5F88%u6709%u542F%u793A%u610F%u4E49%u3002%u4EE5%u524D%u4ECE%u6765%u6CA1%u8FD9%u4E48%u60F3%u8FC7%uFF0C%u4F46%u7ECF%u4F5C%u8005%u4E00%u8BF4%uFF0C%u5176%u5B9E%u89E3%u7B54%u4E4B%u524D%u5F88%u591A%u7684%u7591%u60D1%u3002%0A%0A%3E%u65E0%u8BBA%u5982%u4F55%u9AD8%u5C42%u6A21%u5757%u90FD%u4E0D%u5E94%u8BE5%u4F9D%u8D56%u4E8E%u4F4E%u5C42%u6A21%u5757%u3002%u6211%u4EEC%u66F4%u5E0C%u671B%u80FD%u591F%u91CD%u7528%u7684%u662F%u9AD8%u5C42%u7684%u7B56%u7565%u8BBE%u7F6E%u6A21%u5757%u3002%0A%3E%u4F55%u4E3A%u9AD8%u5C42%u7B56%u7565%uFF1F%0A%3E%u5B83%u662F%u5E94%u7528%u80CC%u540E%u7684%u62BD%u8C61%uFF0C%u662F%u90A3%u4E9B%u4E0D%u968F%u5177%u4F53%u7EC6%u8282%u7684%u6539%u53D8%u800C%u6539%u53D8%u7684%u771F%u7406%0A%21%5BAlt%20text%7C350x0%5D%28./1471477427952.png%29%0ALamp%u662F%u706F%uFF0C%u662F%u5E94%u7528%uFF0C%u662F%u9AD8%u5C42%u6A21%u5757%u3002%u5B83%u4F9D%u8D56%u4E8E%u62BD%u8C61%u6A21%u5757interface%20ButtonServer%uFF0C%u8FD9%u4E2A%u5C31%u662F%u7B56%u7565%uFF0C%u6709%u7684%u5730%u65B9%u79F0%u4E4B%u4E3A%u9690%u55BB%28metaphore%29%0A%0ALamp%u5E76%u4E0D%u4F9D%u8D56%u4E8EButton%uFF0C%u800C%u662FButton%u4F9D%u8D56%u4E8ELamp%u63D0%u4F9B%u51FA%u7684%u63A5%u53E3ButtonServer%u3002%u800C%u8FD9%u4E2Ainterface%u4E5F%u4E0D%u5C40%u9650%u4E8EButton%uFF0C%u5176%u5B9E%u53EA%u8981%u6709%u5F00%u5173%u7B56%u7565%u7684%u5177%u4F53%u7C7B%u90FD%u53EF%u4EE5%u5B9E%u73B0%u8FD9%u4E2A%u63A5%u53E3%u3002%u4F46%u662F%u6240%u6709%u8FD9%u4E9B%u4F4E%u5C42%u7C7B%u7EDF%u7EDF%u4F9D%u8D56%u4E8E%u8FD9%u4E2A%u9AD8%u5C42%u63D0%u4F9B%u7684%u63A5%u53E3%u3002%u800C%u4F4E%u5C42%u6A21%u5757%uFF0C%u5982Button%u7684%u4FEE%u6539%u5E76%u4E0D%u4F1A%u5F71%u54CD%u5230Lamp%u3002%0A%u6709%u4E00%u5929Lamp%u9700%u8981%u4FEE%u6539%u8FD9%u4E2A%u63A5%u53E3%u7684%u65F6%u5019%uFF0C%u6240%u6709%u7684%u7C7B%u90FD%u4F1A%u53D7%u5230%u5F71%u54CD%u3002%u8FD9%u5C31%u662F%u9AD8%u5C42%u5F71%u54CD%u4F4E%u5C42%u3002%u4F46%u662FLamp%u662F%u9AD8%u5C42%u7B56%u7565%uFF0C%u662F%u9690%u55BB%uFF0C%u5E76%u4E0D%u4F1A%u7ECF%u5E38%u6539%u53D8%u3002%0A%0A%u518D%u770B%u8FD9%u4E2A%u4F8B%u5B50%u3002%0A%u539F%u59CB%u7684%u7B97%u6CD5%u5982%u4E0B%0A%21%5BAlt%20text%7C500x0%5D%28./1471477939567.png%29%0A%u8FD9%u91CC%u5939%u6742%u4E86%u5F88%u591A%u4F4E%u5C42%u7684%u7EC6%u8282%uFF0C%u5BFC%u81F4%u9AD8%u5C42%u4F9D%u8D56%u4E8E%u5E95%u5C42%u6A21%u5757%u3002%u8FD9%u6BB5%u4EE3%u7801%u6839%u672C%u4E0D%u80FD%u91CD%u7528%u4E8E%u4E0D%u540C%u7684%u63A7%u5236%u786C%u4EF6%u3002%0A%21%5BAlt%20text%7C400x0%5D%28./1471477820628.png%29%0A%u8FD9%u4E2A%u56FE%u662F%u7528OO%u7684%u65B9%u6CD5%uFF0C%u62BD%u8C61%u51FAThermometer%u548CHeater%u63A5%u53E3%u3002%u8FD9%u6837%u53EA%u8981%u4F4E%u5C42%u6A21%u5757%u80FD%u6EE1%u8DB3%u4E00%u4E2A%u8BFB%u4E00%u4E2A%u53D1%u547D%u4EE4%u5C31%u53EF%u4EE5%u4E86%u3002%u5177%u6709%u5F88%u5927%u7684%u7075%u6D3B%u6027%uFF0C%u4F4E%u5C42%u4F9D%u8D56%u4E8E%u9AD8%u5C42%uFF0C%u4F4E%u5C42%u7684%u6539%u53D8%u4E5F%u4E0D%u4F1A%u5F71%u54CD%u5230%u9AD8%u5C42%u7684%u5B9E%u73B0%u3002%0A%0A%23%23%23ISP%0A%u8FD9%u4E2A%u89C4%u5219%u8981%u89E3%u51B3%u7684%u95EE%u9898%u53EB%u63A5%u53E3%u6C61%u67D3%u3002%0A%u4F55%u4E3A%u63A5%u53E3%u6C61%u67D3%uFF1F%u770B%u4E0B%u9762%u8FD9%u4E2A%u4F8B%u5B50%0A%21%5BAlt%20text%7C400x0%5D%28./1471530170661.png%29%0A%u6709%u4E9B%u95E8%u9700%u8981%u5B9A%u65F6%u529F%u80FD%uFF0C%u5B89%u88C5DIP%uFF0CDoor%u53EF%u4EE5%u5B9E%u73B0TimerClient%u7684%u63A5%u53E3%uFF0C%u4F46%u662F%u5176%u4ED6%u7684%u95E8%u53EF%u80FD%u4E0D%u9700%u8981%u5B9A%u65F6%u7684%u529F%u80FD%uFF0C%u4F46%u662F%u56E0%u4E3A%u8FD9%u6B21%u7EE7%u627F%uFF0C%u5BFC%u81F4%u5176%u4ED6Door%u7684%u6D3E%u751F%u7C7B%u4E5F%u6709%u4E86%u8FD9%u4E9B%u5BF9%u5B83%u4EEC%u6BEB%u65E0%u610F%u4E49%u7684%u63A5%u53E3%uFF0C%u8FD9%u5C31%u662F%u63A5%u53E3%u6C61%u67D3%uFF0C%u6709%u65F6%u5019%u88AB%u53EB%u4F5C%u63A5%u53E3%u53D8%u201C%u80D6%u201D%u3002%0A%0A%3E%u63A5%u53E3%u9694%u79BB%u539F%u5219%uFF1A%u4E0D%u5E94%u8BE5%u5F3A%u8FEB%u5BA2%u6237%u4F9D%u8D56%u4E8E%u5B83%u4EEC%u4E0D%u7528%u7684%u65B9%u6CD5%u3002%0A%0A%u5B9E%u73B0ISP%u7684%u4E24%u4E2A%u9014%u5F84%0A%23%23%23%23%20%u59D4%u6258%0A%u8FD9%u4E2A%u4E0D%u592A%u597D%u7406%u89E3%uFF0C%u800C%u4E14%u8FD9%u4E2A%u65B9%u6CD5%u6309%u4F5C%u8005%u7684%u8BF4%u6CD5%u4E5F%u4E0D%u662F%u5F88%u597D%u3002%0A%21%5BAlt%20text%7C500x0%5D%28./1471530881483.png%29%0A-%20%u5F53Timed%20Door%u9700%u8981%u4E00%u4E2A%u5B9A%u65F6%u4F8B%u7A0B%u7684%u65F6%u5019%uFF0C%u5B83%u5148%u521B%u5EFA%u4E00%u4E2ADoor%20Timer%20Adapter%u5BF9%u8C61%uFF0C%u5E76%u4EE5Timer%20Client%u7684%u5F62%u5F0F%u6CE8%u518C%u7ED9Timer%0A-%20%u5F53Timer%u8BA1%u65F6%u5230%u8FBE%u65F6%uFF0CDoor%20Timer%20Adapter%u7684Timeout%u4F1A%u88AB%u8C03%u7528%0A-%20%u8FDB%u800C%u56E0%u4E3A%u59D4%u6258%uFF0C%u4F1A%u8C03%u7528Timed%20Door%u7684DoorTimeOut%0A%0A%u8FD9%u6837%u505A%uFF0C%u5C31%u4E0D%u9700%u8981Door%u6765%u5B9E%u73B0Timer%u63A5%u53E3%uFF0C%u9632%u6B62%u4E86%u63A5%u53E3%u6C61%u67D3%u3002%u7F3A%u70B9%u662F%uFF0C%u6BCF%u6B21%u9700%u8981%u5B9A%u65F6%u7A0B%u5E8F%u7684%u65F6%u5019%uFF0C%u90FD%u8981%u521B%u5EFA%u4E00%u4E2ADoor%20Timer%20Adapter%u5BF9%u8C61%uFF0C%u6D6A%u8D39%u8D44%u6E90%u3002%0A%0A%23%23%23%23%u591A%u91CD%u7EE7%u627F%0A%u770B%u4E0A%u9762%u7684%u59D4%u6258%u7684%u4F8B%u5B50%uFF0C%u5176%u5B9E%u5C31%u5F88%u5BB9%u6613%u60F3%u5230%u591A%u91CD%u7EE7%u627F%u4E86%u3002%u53EA%u8981%u5BF9TimedDoor%u91C7%u7528%u591A%u91CD%u7EE7%u627F%u5C31%u597D%u4E86%uFF0C%u65E2%u4E0D%u5F71%u54CDDoor%u7684%u5176%u4ED6%u5B50%u7C7B%uFF0C%u53C8%u80FD%u4F7FTimedDoor%u5177%u6709Timer%u548CDoor%u7684%u53CC%u91CD%u529F%u80FD%u3002%0A%u91C7%u7528%u591A%u91CD%u7EE7%u627F%u540E%uFF0C%u4E0A%u9762%u4F8B%u5B50%u7684%u89E3%u51B3%u65B9%u6848%u53D8%u6210%uFF1A%0A%21%5BAlt%20text%7C500x0%5D%28./1471531269827.png%29%0A%0A%u53E6%u5916%u4E00%u4E2A%u4F8B%u5B50%0A%21%5BAlt%20text%5D%28./1471562775035.png%29%0A%0A%u8FD9%u91CC%u6709%u4E24%u70B9%u8981%u6CE8%u610F%uFF1A%0A%21%5BAlt%20text%5D%28./1471562817773.png%29%0A%u867D%u7136%u8BED%u6CD5%u4E0A%u56E0%u4E3A%u591A%u91CD%u7EE7%u627F%uFF0C%u5141%u8BB8%u8FD9%u6837%u5199%u3002%u4F46%u662F%u8FD9%u6837%u4E5F%u662F%u4E00%u79CD%u63A5%u53E3%u6C61%u67D3%uFF0CDepositTransaction%u6839%u672C%u4E0D%u9700%u8981UI%u4E2D%u5176%u4ED6transaction%u7684UI%u3002%0A%0A%u5E94%u8BE5%u8FD9%u6837%u5199%uFF1A%0A%21%5BAlt%20text%5D%28./1471562897916.png%29%0A%0A%u4E5F%u4E0D%u8981%u8FD9%u6837%u5199%uFF1A%0A%21%5BAlt%20text%5D%28./1471562957325.png%29%0A%u628A%u6240%u6709%u5168%u5C40%u53D8%u91CF%u5305%u5230%u4E00%u4E2A%u7C7B%u91CC%u9762%uFF0C%u7B49%u4E8E%u524D%u9762%u7684%u4E8B%u60C5%u767D%u505A%u4E86%u3002%u8FD9%u91CC%u56E0%u4E3A%u6240%u6709%u7684%u7C7B%u90FD%u653E%u5230%u4E00%u8D77%uFF0C%u5C31%u6709%u673A%u4F1A%u4EA7%u751F%u4E92%u76F8%u4F9D%u8D56%u3002%u5982%u679C%u8981%u6DFB%u52A0%u4E00%u4E2A%u65B0%u7C7B%uFF0C%u90A3%u5C31%u4F1A%u6709%u53EF%u80FD%u8981%u4FEE%u6539%u6240%u6709%u7C7B%u3002%u8FD9%u6837%u5C31%u9694%u79BB%u5931%u8D25%u4E86%u3002%0A%0A%u5F15%u7533%u4E0B%u6765%0A%60%60%60%0Avoid%20g%28DepositUI%26%2C%20TransferUI%26%29%3B%0Avoid%20g%28UI%26%29%3B%0A%60%60%60%0A%u54EA%u79CD%u5199%u6CD5%u597D%uFF1F%u5176%u5B9E%u4E00%u76EE%u4E86%u7136%u3002%u80AF%u5B9A%u662F%u7B2C%u4E00%u79CD%uFF0C%u867D%u7136%u770B%u8D77%u6765%u6709%u70B9%u5570%u55E6%u3002%u4F5C%u8005%u544A%u8BC9%u6211%u4EEC%u4E86%uFF1A%0A%3E%u65E0%u8BBA%u662F%u5426%u6709%u6096%u5E38%u7406%uFF0C%u591A%u53C2%u6570%u5F62%u5F0F%u901A%u5E38%u90FD%u5E94%u8BE5%u4F18%u4E8E%u5355%u53C2%u6570%u5F62%u5F0F%u4F7F%u7528%u3002%0A%0A%23%23%23%23ISP%u7684%u4E24%u70B9%u5EFA%u8BAE%0A1.%20%u5BF9%u5BA2%u6237%u5206%u7EC4%u3002%u5C31%u50CF%u4E0A%u9762ATM%u7684%u4F8B%u5B50%uFF0C%u5BF9Transaction%u5206%u7C7B%u9694%u79BB%u3002%u4E0D%u540C%u7684%u5BA2%u6237%u8981%u6C42%u7684%u670D%u52A1%u53EF%u80FD%u6709%u91CD%u53E0%uFF0C%u5982%u679C%u91CD%u53E0%u5C11%u5C31%u9694%u79BB%uFF0C%u91CD%u53E0%u591A%u5C31%u62BD%u53D6%u516C%u5171%u62BD%u8C61%u7C7B%u3002%0A2.%20%u6539%u53D8%u63A5%u53E3%u5C3D%u91CF%u901A%u8FC7%u65B0%u52A0%u63A5%u53E3%u6765%u505A%uFF0C%u907F%u514D%u4FEE%u6539%u73B0%u6709%u63A5%u53E3%u3002%u56E0%u4E3A%u4F60%u7684%u5B50%u7C7B%u53EF%u80FD%u6B63%u5728%u7528%u8FD9%u4E2A%u63A5%u53E3%u3002%0A%0A%23%23%u7B2C13-19%u7AE0%0A%u672C%u4E66%u7684%u7B2C%u4E09%7E%u516D%u90E8%u5206%uFF0C%u7ED3%u54084%u4E2A%u6BD4%u8F83%u5927%u578B%u7684%u4F8B%u5B50%uFF0C%u8BB2%u89E3%u4E86%u4E00%u7CFB%u5217%u8BBE%u8BA1%u6A21%u5F0F%u3002%u672C%u90E8%u5206%u6D89%u53CA%u7684%u6A21%u5F0F%u6709%uFF1A%0A-%20COMMAND%20%26%20ACTIVE%20OBJECT%0A-%20TEMPLATE%20METHOD%20%26%20STRATEGY%0A-%20FACADE%20%26%20MEDIATOR%0A-%20SINGLETON%20%26%20MONOSTATE%0A-%20NULL%20OBJECT%0A%u5176%u5B9E%u6BCF%u4E2A%u6A21%u5F0F%uFF0C%u5728%u770B%u4E66%u7684%u65F6%u5019%uFF0C%u7ED3%u5408%u4F5C%u8005%u7ED9%u51FA%u7684%u4F8B%u5B50%uFF0C%u5F88%u5BB9%u6613%u7406%u89E3%uFF0C%u4E5F%u77E5%u9053%u4ED6%u5728%u8BF4%u4EC0%u4E48%uFF0C%u4F46%u662F%u5982%u679C%u60F3%u8981%u5E94%u7528%u5230%u5B9E%u9645%u7684%u5F00%u53D1%u4E2D%uFF0C%u8FD8%u662F%u6709%u4E00%u5B9A%u96BE%u5EA6%u7684%u3002%u4F5C%u8005%u5728%u540E%u6587%u4E2D%uFF0C%u4E5F%u7ED9%u51FA%u4E00%u4E2A%u4F8B%u5B50%uFF0C%u6559%u8BFB%u8005%u5982%u4F55%u901A%u8FC7%u62BD%u8C61%u603B%u7ED3%u5BFB%u627E%u9002%u5408%u81EA%u5DF1%u7684%u8BBE%u8BA1%u6A21%u5F0F%u3002%u4F46%u662F%u4E0D%u7BA1%u600E%u4E48%u8BF4%uFF0C%u5BF9%u6BCF%u4E00%u4E2A%u8BBE%u8BA1%u6A21%u5F0F%u7684%u7279%u70B9%u548C%u76EE%u7684%u603B%u8981%u6709%u4E00%u4E2A%u6E05%u9192%u7684%u8BA4%u8BC6%uFF0C%u624D%u80FD%u7075%u6D3B%u7684%u52A0%u4EE5%u5E94%u7528%u3002%0A%0A%23%23%23%3Cspan%20id%3D%22jump%22%3ECOMMAND%20%26%20ACTIVE%20OBJECT%3C/span%3E%0A%u8FD9%u4E24%u4E2A%u6A21%u5F0F%u90FD%u662F%u57FA%u4E8E%u5BF9%u64CD%u4F5C%u7684%u5C01%u88C5%u3002ACTIVE%20OBJECT%u6A21%u5F0F%u57FA%u4E8ECOMMAND%u6A21%u5F0F%u3002%u4E0B%u56FE%u5C31%u662FCOMMAND%u6A21%u5F0F%uFF1A%0A%21%5BAlt%20text%7C240x0%5D%28./1477352892193.png%29%0A%23%23%23%23%u4EC0%u4E48%u65F6%u5019%u7528COMMAND%u6A21%u5F0F%uFF1F%0ACOMMAND%u6A21%u5F0F%u53EF%u4EE5%u5206%u79BB%u64CD%u4F5C%u53D1%u8D77%u8005%u548C%u64CD%u4F5C%u672C%u8EAB%u3002%u6BD4%u5982%u4E0B%u9762%u9700%u8981sensor%u9A71%u52A8%u4E8B%u4EF6%u7684%u6A21%u578B%u3002%0A%21%5BAlt%20text%5D%28./1477353059870.png%29%0A%0A%u82E5%u4E0D%u91C7%u7528COMMAND%u6A21%u5F0F%uFF0Csensor%u9700%u8981%u77E5%u9053%u8C03%u7528%u4EC0%u4E48%u51FD%u6570%u505A%u4EC0%u4E48%u64CD%u4F5C%u3002%u82E5%u91C7%u7528COMMAND%u6A21%u5F0F%u540E%uFF0C%u9AD8%u5C42%u7684%u638C%u63E1%u4E8B%u4EF6%u903B%u8F91%u7684%u6A21%u5757%uFF0C%u5BF9sensor%u548C%u4E8B%u4EF6%u8FDB%u884C%u7ED1%u5B9A%uFF0C%u4E4B%u540Esensor%u5C31%u53EF%u4EE5%u5BF9%u4E8B%u4EF6%u8FDB%u884C%u65E0%u5DEE%u522B%u7684%u8C03%u7528%uFF08command-%3Edo%28%29%uFF09%u3002%u4ECE%u800C%u8FBE%u5230**%u4E8B%u4EF6%u6267%u884C%u8005%u548C%u4E8B%u4EF6%u672C%u8EAB%u7684%u89E3%u8026**%u3002%0A%0A%23%23%23%23ACTIVE%20OBJECT%u5462%uFF1F%0AACTIVE%20OBJECT%u57FA%u4E8ECOMMAND%u6A21%u5F0F%uFF0C%u6709%u5982%u4E0B%u7684%u7B80%u5355%u7ED3%u6784%uFF1A%0A%60%60%60%0Apublic%20class%20ActiveObject%7B%0A%09Command%20itsCommands%5B%5D%3B%0A%09public%20void%20run%28%29%7B%0A%09%09for%20each%20command%7B%0A%09%09%09do%28%29%3B%0A%09%09%7D%0A%09%7D%0A%09public%20void%20addCommand%28Command%20cmd%29%20%7B%0A%09%09itsCommands.append%28cmd%29%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u8BE5%u6A21%u5F0F%u5206%u79BB%u4E86%u4EFB%u52A1%u7684%u63D0%u4EA4%u4E0E%u4EFB%u52A1%u7684%u8FD0%u884C%u3002%u6309%u4F5C%u8005%u7684%u8BF4%u6CD5%uFF0C%u5E76%u53C2%u8003%u7F51%u4E0A%u5176%u4ED6%u7684%u7B14%u8BB0%uFF0C%u8FD9%u4E2A%u53E4%u8001%u7684%u8BBE%u8BA1%u6A21%u5F0F%u5F80%u5F80%u4F1A%u5E26%u6765%u610F%u60F3%u4E0D%u5230%u7684%u597D%u6548%u679C%u3002%0A1.%20%u5B83%u53EF%u4EE5%u6A21%u62DF%u591A%u7EBF%u7A0B%u7684%u8FD0%u884C%u3002%u5B9E%u9645%u4E0A%u7EBF%u7A0B%u4F8B%u7A0B%u4E5F%u53EF%u4EE5%u662F%u4E00%u4E2Aactive%20object%0A2.%20%u6211%u4EEC%u53EF%u4EE5%u5728Command%u7684do%u63A5%u53E3%u4E2D%u51B3%u5B9A%u4E0B%u4E00%u6B65%u7684%u64CD%u4F5C%uFF0C%u53EF%u4EE5%u8FBE%u5230%u63A7%u5236%u6574%u4E2Aactive%20object%u8FD0%u884C%u8FD8%u662F%u505C%u6B62%u7684%u6548%u679C%u3002%0A%0A%23%23%23TEMPLATE%20METHOD%20%26%20STRATEGY%0A%23%23%23%23TEMPLATE%20METHOD%0A%u5728%u6211%u770B%u6765%uFF0CTEMPLATE%20METHOD%u5E76%u4E0D%u80FD%u79F0%u4E3A%u4E00%u79CD%u8BBE%u8BA1%u6A21%u5F0F%uFF0C%u53EA%u662F%u628A%u4E00%u4E9B%u76F8%u540C%u7684%u6D41%u7A0B%uFF0C%u62BD%u8C61%u6210%u4E00%u4E2A%u62BD%u8C61%u57FA%u7C7B%uFF0C%u7136%u540E%u6240%u6709%u7684%u6D3E%u751F%u7C7B%u91CD%u7528%u8FD9%u4E2A%u6D41%u7A0B%u3002%u4F46%u8FD9%u5F80%u5F80%u6CA6%u4E3A%u9E21%u808B%uFF0C%u56E0%u4E3A%u6D3E%u751F%u7C7B%u603B%u662F%u5728%u67D0%u4E2A%u4E0D%u786E%u5B9A%u7684%u65F6%u95F4%u8868%u73B0%u51FA%u4E0D%u4E00%u6837%u7684%u884C%u4E3A%uFF0C%u7136%u540E%u6574%u4E2A%u62BD%u8C61%u7684%u7ED3%u6784%u5C31%u88AB%u8865%u4E01%u6253%u7684%u9762%u76EE%u5168%u975E%u3002%u4F5C%u8005%u8BF4%uFF0C%u5BF9TEMPLATE%20METHOD%u4E00%u5B9A%u8981%u614E%u4E4B%u53C8%u614E%uFF0C%u5F80%u5F80%u4F1A%u51FA%u73B0%u6A21%u5F0F%u6EE5%u7528%u7684%u60C5%u51B5%u3002%0ATEMPLATE%20METHOD%u6709%u4E00%u4E2A%u5F88%u5178%u578B%u7684%u4F8B%u5B50%uFF0C%u5C31%u662FBubble%20Sort%u3002%u4E0D%u7BA1%u662F%u5BF9%u6570%u5B57%u505A%u5192%u6CE1%uFF0C%u8FD8%u662F%u5BF9%u5B57%u7B26%u505A%u5192%u6CE1%uFF0C%u8FD8%u662F%u5BF9%u81EA%u5B9A%u4E49%u5BF9%u8C61%u505A%u5192%u6CE1%uFF0C%u5176%u6838%u5FC3%u7B97%u6CD5%u603B%u662F%u4E00%u6837%u7684%u3002%u5176%u4E0D%u540C%u5728%u4E8E%0A1.%20%u4E24%u4E2A%u5BF9%u8C61%u7684%u6BD4%u8F83%u64CD%u4F5C%0A2.%20%u4E24%u4E2A%u5BF9%u8C61%u7684%u4EA4%u6362%u64CD%u4F5C%0A%0A%u5982%u6B64%u5C31%u53EF%u4EE5%u5F88%u597D%u7684%u4F7F%u7528TEMPLATE%20METHOD%u4E86%u3002%u628A%u8FD9%u4E24%u4E2A%u64CD%u4F5C%u4F5C%u4E3A%u63A5%u53E3%u62BD%u8C61%u51FA%u6765%uFF0C%u5192%u6CE1%u6392%u5E8F%u7684%u6838%u5FC3%u7B97%u6CD5%u5C31%u662FTEMPLATE%20METHOD%u4E86%u3002%0A%u6211%u89C9%u5F97%u53EA%u6709%u5728%u8FD9%u79CD%u8D85%u7ECF%u5178%u7684%u73AF%u5883%u4E0B%uFF0C%u624D%u53EF%u4EE5%u4F7F%u7528TEMPLATE%20METHOD%u3002%u5426%u5219%u8FD8%u662F%u8003%u8651%u5176%u4ED6%u6A21%u5F0F%u5427%u3002%0A%0A%23%23%23%23STRATEGY%0A%21%5BAlt%20text%7C300x0%5D%28./1477439436051.png%29%0ASTRATEGY%u662FTEMPLATE%20METHOD%u7684%u6539%u8FDB%u7248%u3002%0A%0A%21%5BAlt%20text%5D%28./1477439257251.png%29%0ASTRATEGY%u7684%u597D%u5904%u662F%uFF0CInt%20Bubble%20Sort%u4E0EBubble%20Sort%u4E92%u76F8%u4E0D%u77E5%u9053%uFF0CInt%20Bubble%20Sort%u53EA%u4F9D%u8D56%u4E8EBubble%20Handler%u63A5%u53E3%uFF0C%u8FD9%u4E5F%u662F%u4E00%u79CD%u4F9D%u8D56%u5012%u7F6E%28DIP%29%u3002%u800CTEMPLATE%20METHOD%u5219%u8FDD%u53CD%u4E86DIP%u3002%u4F46TEMPLATE%20METHOD%u5728%u5B9E%u9645%u5E94%u7528%u4E2D%u662F%u7ECF%u5E38%u51FA%u73B0%u7684%uFF0C%u662F%u4E00%u79CD%u5F88%u7ECF%u5178%u7684%u9762%u5411%u5BF9%u8C61%u91CD%u7528%u5F62%u5F0F%u3002%u57FA%u7C7B%u5B9A%u4E49%u901A%u7528%u7B97%u6CD5%uFF0C%u6D3E%u751F%u7C7B%u901A%u8FC7%u7EE7%u627F%u91CD%u7528%u8BE5%u7B97%u6CD5%u3002%0A%0A%23%23%23FACADE%20%26%20MEDIATOR%0A%23%23%23%23%3Cspan%20id%3D%22facade%22%3EFACADE%3C/span%3E%0A%u5F53%u60F3%u8981%u4E3A%u4E00%u7EC4%u5177%u6709%u590D%u6742%u4E14%u5168%u9762%u7684%u63A5%u53E3%u7684%u5BF9%u8C61%u63D0%u4F9B%u4E00%u4E2A%u7B80%u5355%u4E14%u7279%u5B9A%u7684%u63A5%u53E3%u65F6%uFF0C%u53EF%u4EE5%u4F7F%u7528%u961FFACADE%u6A21%u5F0F%20%u3002%0A%21%5BAlt%20text%7C450x0%5D%28./1478213659914.png%29%0AFACADE%u5728%u5B9E%u9645%u5E94%u7528%u4E2D%u5F88%u591A%uFF0C%u4E4B%u524D%u6211%u4E5F%u662F%u5728%u65E0%u610F%u4E2D%u7528%u5230%u5F88%u591AFACADE%u6A21%u5F0F%uFF0C%u6BD4%u5982%u62BD%u8C61%u5FAE%u535AAPI%u63A5%u53E3%uFF0C%u62BD%u8C61MongoDB%u63A5%u53E3%u3002%u5728%u540E%u6587%u4F1A%u63D0%u5230%uFF0CFACADE%u5B9E%u9645%u662F%u7B80%u5316%u7248%u7684Proxy%u6A21%u5F0F%uFF0C%u5728%u590D%u6742%u5EA6%u4E0D%u9AD8%u7684%u65F6%u5019%uFF0C%u7528FACADE%uFF0C%u4E00%u65E6%u590D%u6742%u5EA6%u5347%u9AD8%u5230%u4E00%u5B9A%u7A0B%u5EA6%u65F6%uFF0C%u53EF%u4EE5%u8003%u8651%u91CD%u6784%u6210Proxy%u6A21%u5F0F%u3002%u5177%u4F53%u4EC0%u4E48%u60C5%u51B5%u4E0B%u9700%u8981%u4F7F%u7528Proxy%uFF0C%u6216%u8005%u4F7F%u7528Proxy%u7684%u597D%u5904%u662F%u4EC0%u4E48%uFF0C%u540E%u6587%u518D%u505A%u8865%u5145%u3002%0A%0A%23%23%23%23MEDIATOR%0A%21%5BAlt%20text%7C450x0%5D%28./1478214139846.png%29%0AMEDIATOR%u7684%u8BCD%u4E49%u662F%u4E2D%u4ECB%uFF0C%u5176%u542B%u4E49%u662F%uFF0C%u5728%u80CC%u540E%u6DFB%u52A0%u5904%u7406%u673A%u5236%u3002%u8FD9%u4E2A%u5B9E%u9645%u4F8B%u5B50%u4E2D%uFF0C%u6240%u8C13mediator%u5C31%u662F%u901A%u8FC7%u76D1%u542C%u6587%u672C%u6846changed%u4E8B%u4EF6%uFF0C%u83B7%u53D6List%u548CTextField%u7684%u5185%u5BB9%u4EE5%u8FDB%u884C%u64CD%u4F5C%u3002%0A%0A%23%23%23SINGLETON%20%26%20MONOSTATE%0A%u8FD9%u4E24%u4E2A%u6A21%u5F0F%u90FD%u662F%u5355%u4F8B%u6A21%u5F0F%uFF0C%u4E00%u4E2A%u5173%u6CE8%u7ED3%u6784%uFF08SINGLETON%uFF09%uFF0C%u4E00%u4E2A%u5173%u6CE8%u884C%u4E3A%uFF08MONOSTATE%uFF09%u3002%0A%23%23%23%23%23%u4F55%u65F6%u9700%u8981%u5355%u4F8B%uFF1F%0A%u4F5C%u8005%u5728%u672C%u7AE0%u5F00%u7BC7%u7684%u65F6%u5019%u8BF4%uFF0C%0A%3E%u90A3%u4E9B%u5F3A%u5236%u5BF9%u8C61%u5355%u4E00%u6027%u7684%u673A%u5236%u4F3C%u4E4E%u6709%u4E9B%u591A%u4F59%u3002%u6BD5%u7ADF%20%uFF0C%u5728%u521D%u59CB%u5316%u5E94%u7528%u7A0B%u5E8F%u65F6%uFF0C%u5B8C%u5168%u53EF%u4EE5%u53EA%u521B%u5EFA%u6BCF%u4E2A%0A%u5BF9%u8C61%u7684%u4E00%u4E2A%u5B9E%u4F8B%uFF0C%u7136%u540E%u4F7F%u7528%u8BE5%u5B9E%u4F8B%u3002%u4E8B%u5B9E%u4E0A%uFF0C**%u8FD9%u901A%u5E38%u4E5F%u662F%u6700%u597D%u7684%u65B9%u6CD5%u3002%u5728%u6CA1%u6709%u6025%u8FEB%u5E76%u4E14%u6709%u610F%u4E49%u7684%u9700%u8981%20%u65F6%uFF0C%u5E94%u8BE5%u907F%u514D%u4F7F%u7528%u8FD9%u4E9B%u673A%u5236**%u3002%0A%0A%u90A3%u5230%u5E95%u4EC0%u4E48%u65F6%u5019%u624D%u662F%u4F7F%u7528SINGLETON%u7684%u6B63%u786E%u65F6%u673A%u5462%uFF1F%u4F5C%u8005%u63A5%u7740%u8BF4%u4E86%0A%3E%u6211%u4EEC%u4E5F%u5E0C%u671B%u4EE3%u7801%u80FD%u591F%u4F20%u8FBE%u6211%u4EEC%u7684%u610F%u56FE%u3002%u5982%u679C%u5F3A%u5236%u5BF9%u8C61%u5355%u4E00%u6027%u7684%u673A%u5236%u662F%u8F7B%u91CF%u7EA7%u7684%uFF0C%u90A3%u4E48**%u4F20%u8FBE%u610F%u56FE**%u5E26%u6765%u7684%u6536%u76CA%u5C31%u4F1A%u80DC%u8FC7%u5B9E%u65BD%u8FD9%u4E9B%u673A%u5236%u7684%u4EE3%u4EF7%u3002%0A%0A%u6240%u4EE5%u4F7F%u7528%u5355%u4F8B%u8981%u7B26%u5408%u4E24%u4E2A%u5143%u7D20%uFF1A%0A1.%20%u673A%u5236%u8F7B%u91CF%u7EA7%uFF0C%u4E5F%u5C31%u662F%u903B%u8F91%u8981%u7B80%u5355%0A2.%20%u9700%u8981%u4F20%u8FBE%u53EA%u5141%u8BB8%u4E00%u4E2A%u5B9E%u4F8B%u7684%u610F%u56FE%0A%0A%u4F5C%u8005%u5728%u672C%u7AE0%u7ED3%u5C3E%u5904%u6307%u51FA%uFF1A%0A%3E%u5982%u679C%u5E0C%u671B%u900F%u8FC7%u6D3E%u751F%u53BB%u7EA6%u675F%u4E00%u4E2A%u73B0%u5B58%u7C7B%uFF0C%u5E76%u4E14%u4E0D%u4ECB%u610F%u5B83%u7684%u6240%u6709%u8C03%u7528%u8005%u90FD%u5FC5%u987B%u8981%u8C03%u7528%60instance%28%29%60%u65B9%u6CD5%u6765%u83B7%u53D6%u8BBF%u95EE%u6743%uFF0C%u90A3%u4E48SINGLETON%u662F%u6700%u5408%u9002%u7684%u3002%u5982%u679C%u5E0C%u671B%u7C7B%u7684%u5355%u4E00%u6027%u672C%u8D28%u5BF9%u4F7F%u7528%u8005%u900F%u660E%uFF0C%u6216%u8005%u5E0C%u671B%u4F7F%u7528%u5355%u4E00%u5BF9%u8C61%u7684%u591A%u6001%u6D3E%u751F%u5BF9%u8C61%uFF0C%u90A3%u4E48MONOSTATE%u662F%u6700%u9002%u5408%u7684%u3002%0A%0A%u5E94%u7528%u573A%u666F%uFF0C%u4F8B%u5982%uFF1A%0A-%20%u5DE5%u5382%u5BF9%20%u8C61%28factories%29%uFF0C%u7528%u6765%u521B%u5EFA%u7CFB%u7EDF%u4E2D%u7684%u5176%u4ED6%u5BF9%u8C61%u3002%0A-%20%u7BA1%u7406%u5668%28managers%29%u5BF9%u8C61%uFF0C%u8D1F%u8D23%u7BA1%u7406%u67D0%u4E9B%u5176%u4ED6%u5BF9%u8C61%u5E76%u4EE5%u5408%u9002%u7684%u65B9%u5F0F%u53BB%u63A7%u5236%u5B83%u4EEC%u3002%0A%0A%u56E0%u4E3A%u8FD9%u4E9B%u7C7B%u5B9E%u4F8B%u4E00%u65E6%u4EA7%u751F%u8D85%u8FC7%u4E00%u4E2A%uFF0C%u5C31%u4F1A%u56E0%u4E3A%u5BF9%u8C61%u4E4B%u95F4%u7684%u540C%u6B65%u95EE%u9898%uFF0C%u4EA7%u751F%u903B%u8F91%u95EE%u9898%u3002%0A%0A%23%23%23%23SINGLETON%0A%60%60%60%0Apublic%20class%20Singleton%20%7B%0A%09private%20static%20Singleton%20theInsLance%20%3D%20null%3B%0A%09private%20Singleton%28%29%20%7B%7D%0A%09public%20static%20Singleton%20Instance%28%29%0A%09%7B%0A%09%09if%20%28theIristance%20%3D%3D%20null%29%0A%09%09%09theInstance%20%3D%20new%20Singleton%28%29%3B%0A%09%09return%20theInstance%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u79C1%u6709%u6784%u9020%u51FD%u6570%uFF0C%u901A%u8FC7static%u63A5%u53E3%u6765%u505A%u5B9E%u4F8B%u5316%uFF0C%u63A7%u5236%u7C7B%u5B9E%u4F8B%u53EA%u6709%u4E00%u4E2A%u3002%0A%u4E0B%u9762%u7684%u4F8B%u5B50%u662FPhoenix%u4EE3%u7801%u4E2D%u6700%u5E38%u89C1%u7684%u5355%u4F8B%u6A21%u5F0F%u3002%0A%60%60%60%0Aclass%20Child%20%3A%20public%20Parent%0A%7B%0A%09Child%28%29%7B%7D%0A%7D%0Aclass%20Factory%7B%0A%09static%20Parent*%20Instance%20%28%29%0A%09%7B%0A%09%09static%20Child%20child%3B%0A%09%09return%20%26child%3B%0A%09%7D%20%0A%7D%0A%60%60%60%0A%u5229%u7528%u5C40%u90E8%u7684static%u53D8%u91CF%u5B9E%u73B0%u5355%u4F8B%u3002%u4E0D%u7BA1%u7528%u4E0A%u9762%u7684%u54EA%u79CD%u65B9%u5F0F%uFF0C%u5176%u5B9E%u4F8B%u5316%u8FC7%u7A0B%u90FD%u4E0D%u662F%u7ECF%u5178%u7684%u9762%u5411%u5BF9%u8C61%u65B9%u6CD5%uFF0C%u800C%u9700%u8981%u8C03%u7528%u8005%u9075%u5FAA%u7EA6%u5B9A%uFF0C%u8C03%u7528%u7279%u6B8A%u7684%u63A5%u53E3%u4EE5%u521B%u5EFA%u7C7B%u5B9E%u4F8B%u3002%u5176%u521B%u5EFA%u7684%u5B9E%u4F8B%u786E%u5B9E%u90FD%u6307%u5411%u540C%u4E00%u4E2A%u771F%u6B63%u7684%u5BF9%u8C61%u3002%0A%0A%23%23%23%23MONOSTATE%0A%u6B64%u6A21%u5F0F%u4E0ESINGLETON%u4E0D%u540C%uFF0CMONOSTATE%u5F3A%u8C03%u7684%u662F%u6240%u6709%u521B%u5EFA%u7684%u5BF9%u8C61%u5177%u6709%u76F8%u540C%u7684%u884C%u4E3A%u3002%0A%60%60%60%0Apublic%20class%20MonoState%20%7B%0A%09private%20static%20int%20itsX%3B%0A%09public%20void%20setX%28int%20x%29%20%7B%0A%09%09itsX%20%3D%20x%3B%0A%09%7D%0A%09public%20int%20getX%28%29%7B%0A%09%09return%20itsX%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u8FD9%u91CC%u6709%u4E00%u4E2A%u7EA6%u5B9A%uFF1A**%u6240%u6709%u7684%u7C7B%u6210%u5458%u5747%u4E3Astatic%uFF0C%u6240%u6709%u7684%u65B9%u6CD5%u5747%u4E3A%u975Estatic**%0A%u6240%u6709%u65B9%u6CD5%u4E3A%u975Estatic%u7684%u7528%u610F%u662F%uFF0C%u5176%u63A5%u53E3%u5747%u53EF%u7EE7%u627F%u5230%u6D3E%u751F%u7C7B%u4E2D%u3002%u6240%u6709%u6210%u5458%u53D8%u91CF%u662Fstatic%uFF0C%u4E00%u65B9%u9762%u4FDD%u8BC1%u6240%u6709%u7C7B%u5BF9%u8C61%u5177%u6709%u76F8%u540C%u5C5E%u6027%uFF0C%u53E6%u4E00%u65B9%u9762%u4E5F%u4FDD%u8BC1%u4E86MONOSTATE%u7C7B%u7684%u6D3E%u751F%u7C7B%u90FD%u5177%u6709MONOSTATE%u7279%u6027%u3002%u800C%u5B9E%u9645%u4E0A%uFF0C%u6240%u6709%u6D3E%u751F%u7C7B%u90FD%u5171%u4EAB%u540C%u4E00%u4E2AMONOSTATE%u7684%u4E00%u90E8%u5206%u3002%0A%0A%23%23%23NULL%20OBJECT%u6A21%u5F0F%0A%u8FD9%u662F%u4E00%u4E2A%u5F88%u5B9E%u7528%uFF0C%u4F46%u53C8%u603B%u662F%u5F88%u5BB9%u6613%u88AB%u5FFD%u7565%u7684%u6A21%u5F0F%u3002%u6211%u4EEC%u5728%u5199code%u7684%u65F6%u5019%uFF0C%u4E0B%u9762%u7684%u60C5%u51B5%u5F88%u5E38%u89C1%uFF1A%0A%60%60%60%0AEmployee%20e%20%3D%20DB.getEmployee%28%22Bob%22%29%3B%0Aif%20%28e%20%21%3D%20null%20%26%26%20e.isTimeToPay%28today%29%29%0A%09e.pay%28%29%3B%0A%60%60%60%0A%u5148%u83B7%u5F97%u4E00%u4E2A%u5BF9%u8C61%uFF0C%u5728%u5931%u8D25%u65F6%u8FD4%u56DEnull%uFF0C%u7136%u540E%u6839%u636E%u8FD4%u56DE%u7684%u7ED3%u679C%u505A%u4E0B%u4E00%u6B65%u64CD%u4F5C%u3002%u4F7F%u7528NULL%20OBJECT%u4EE5%u540E%u7684%u6837%u5B50%uFF0C%u53EF%u80FD%u662F%u8FD9%u6837%u7684%uFF1A%0A%60%60%60%0AEmployee%20e%20%3D%20DB.getEmployee%28%22Bob%22%29%3B%0Aif%20%28e.isTimeToPay%28today%29%29%0A%09e.pay%28%29%3B%0A%0Apublic%20class%20NullEmployee%20%7B%0A%09public%20boolean%20isTimeToPay%28Date%20data%29%20%7B%0A%09%09return%20false%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%23%23%23%23%u8FDB%u9636NULL%20OBJECT%0A%60%60%60%0Aimport%20java.util.Date%3B%0Apublic%20interface%20Employee%0A%7B%0A%09public%20boolean%20isTimeToPay%28Date%20payDate%29%3B%0A%09public%20void%20pay%28%29%3B%0A%09public%20static%20final%20Employee%20NULL%20%3D%20new%20Employee%28%29%0A%09%7B%0A%09%09public%20boolean%20isTimeToPay%28Date%20payDate%29%0A%09%09%7B%0A%09%09%09return%20false%3B%0A%09%09%7D%0A%09%09public%20void%20pay%28%29%0A%09%09%7B%0A%09%09%7D%0A%09%7D%3B%0A%7D%0A%60%60%60%0A%u4F7F%u65E0%u6548%u96C7%u5458%u7C7B%u6210%u4E3A%u4E00%u4E2A%u533F%u540D%u5185%u5D4C%u7C7B%u662F%u4E00%u79CD%u786E%u4FDD%u8BE5%u7C7B%u53EA%u6709%u5355%u4E00%u5B9E%u4F8B%u7684%u65B9%u6CD5%u3002%u5B9E%u9645%u4E0A%u5E76%u4E0D%u5B58%u5728NullEmplyee%u7C7B%u672C%u8EAB%u3002%u5176%u4ED6%u4EFB%u4F55%u4EBA%u90FD%u65E0%u6CD5%u521B%u5EFANULL%u7C7B%u5B9E%u4F8B%u3002%u5E76%u4E14static%20final%u53D8%u91CF%u4E5F%u4FDD%u8BC1%u4E86NULL%u7684%u5355%u4F8B%u6027%u3002**%u5982%u679CNULL%u4E0D%u80FD%u505A%u5230%u5355%u4F8B%u7684%u8BDD%uFF0C%u4F1A%u5F15%u53D1%u6B67%u4E49**%uFF0C%u5BFC%u81F4%u4E0D%u53EF%u9884%u77E5%u7684%u9519%u8BEF%u3002%0A%0A%23%23%u7B2C20-22%u7AE0%0A%u672C%u90E8%u5206%u53EA%u8BB2%u4E86%u4E00%u4E2A%u6A21%u5F0F%28FACTORY%29%uFF0C%u4F46%u653E%u5165%u4E86%u4E00%u4E2A%u5F88%u6709%u7528%u7684%u7AE0%u8282%u2014%u2014%u5173%u4E8E%u5305%u7684%u8BBE%u8BA1%u539F%u5219%u3002%u5305%u662F%u7C7B%u7684%u96C6%u5408%uFF0C%u5F53%u8F6F%u4EF6%u8FBE%u5230%u4E00%u5B9A%u89C4%u6A21%u65F6%uFF0C%u5C31%u9700%u8981%u8003%u8651%u5305%u7684%u8BBE%u8BA1%u4E86%u3002%u6211%u89C9%u5F97%u8FD9%u503C%u5F97%u53CD%u590D%u9605%u8BFB%u3002%u6211%u6253%u7B97%u98A0%u5012%u4E66%u4E0A%u7684%u987A%u5E8F%uFF0C%u5148%u7F57%u5217FACTORY%u6A21%u5F0F%uFF0C%u518D%u6765%u770B%u5305%u8BBE%u8BA1%u89C4%u5219%u3002%0A%0A%23%23%23FACTORY%0A%u8FD9%u4E2A%u6A21%u5F0F%uFF0C%u662F%u6211%u9605%u8BFB%u8FD9%u672C%u4E66%u8FC4%u4ECA%u4E3A%u6B62%uFF08%u8FD8%u6709%u7B2C%u56DB%u90E8%u5206%u7684%u4E09%u7AE0%u672A%u770B%uFF09%uFF0C%u6700%u6709%u7528%u7684%u6A21%u5F0F%u3002%u4ED6%u56DE%u7B54%u4E86%u6211%u5230%u5E95%u8BE5%u5728%u54EA%u91CC%u4F20%u5165%u591A%u6001%u7ED1%u5B9A%u4FE1%u606F%u3002%0A%60%60%60%0Aclass%20Child1%20%3A%20Parent%7B%7D%0Aclass%20Child2%20%3A%20Parent%7B%7D%0Aswitch%20%28info%29%7B%0A%09case%20A%3A%0A%09%09Parent*%20obj%20%3D%20new%20Child1%28%29%3B%0A%09%09break%3B%0A%09case%20B%3A%0A%09%09Parent*%20obj%20%3D%20new%20Child2%28%29%3B%0A%09%09break%3B%0A%7D%0A%60%60%60%0A%u4E0A%u9762%u8FD9%u4E00%u6BB5%u4E0D%u7BA1%u662F%u65E9%u7ED1%u5B9A%uFF0C%u8FDF%u7ED1%u5B9A%uFF0C%u603B%u662F%u8981%u51FA%u73B0%u7684%u3002%u653E%u5728%u54EA%u91CC%uFF1F%u653E%u5728FACTORY%u91CC%u3002%0A%u4E3A%u4EC0%u4E48%u8981%u653E%u5230FACTORY%u91CC%uFF1F%u6362%u53E5%u8BDD%u8BF4%uFF1A%0A%0A%23%23%23%23%u4E3A%u4EC0%u4E48%u8981%u4F7F%u7528FACTORY%uFF1F%0A%u4F5C%u8005%u8BF4%uFF1A%0A%3EFACTORY%u6A21%u5F0F%u5141%u8BB8%u6211%u4EEC%u53EA%u4F9D%u8D56%u4E8E%u62BD%u8C61%u63A5%u53E3%u5C31%u80FD%u521B%u5EFA%u51FA%u5177%u4F53%u5BF9%u8C61%u7684%u5B9E%u4F8B%u3002%u6240%20%u4EE5%20%uFF0C%u5728%u6B63%u5728%u8FDB%u884C%u7684%u5F00%u53D1%u671F%u95F4%uFF0C%u5982%u679C%u5177%u4F53%u7C7B%u662F%u9AD9%u5EA6%u6613%u53D8%u7684%uFF0C%u90A3%u4E48%u8BE5%u6A21%u5F0F%u662F%u975E%u5E38%u6709%u7528%u7684%u3002%0A%0A%u4E25%u683C%u6309%u7167DIP%u6765%u8BB2%uFF0C%u5FC5%u987B%u8981%u5BF9%u7CFB%u7EDF%u4E2D%u6240%u6709%u7684%u6613%u53D8%u7C7B%u4F7F%u7528%u5DE5%u5382%u3002%u9488%u5BF9%u8FD9%u53E5%u8BDD%uFF0C%u4F5C%u8005%u53C8%u8BF4%uFF1A%0A%3E%u6211%u4E0D%u662F%u4E00%u5F00%u59CB%u5C31%u4F7F%u7528%u4E01%u5382%u3002%u53EA%u662F%u5728%u975E%u5E38%u9700%u8981%u5B83%u4EEC%u7684%u60C5%u51B5%u4E0B%uFF0C%u6211%u624D%u628A%u5B83%u4EEC%u653E%u5165%u5230%u7CFB%u7EDF%u4E2D%u3002%u4F8B%u5982%uFF0C%0A%3E%20-%20%u5982%u679C%u6709%u5FC5%u8981%u4F7F%u7528PROXY%u6A21%u5F0F%uFF0C%u90A3%u4E48%u5C31%u53EF%u80FD%u6709%u5FC5%u8981%u4F7F%u7528%u5DE5%u5382%u53BB%u521B%u5EFA%u6301%u4E45%u5316%u5BF9%u8C61%u3002%0A%3E%20-%20%u6216%u8005%uFF0C%u5728%u5355%u5143%u6D4B%u8BD5%u671F%u95F4%uFF0C%u5982%u679C%u9047%20%u5230%u5FC5%u987B%u8981%u6B3A%u9A97%u4E00%u4E2A%u5BF9%u8C61%u7684%u521B%u5EFA%u8005%u7684%u60C5%u51B5%u65F6%uFF0C%u90A3%u4E48%u6211%u5F88%u53EF%u80FD%u4F1A%u4F7F%u7528%u5DE5%u5382%u3002%0A%3E%0A%3E%u4F46%u662F%u6211%u4E0D%u662F%u4E00%u5F00%u59CB%u5C31%u5047%u8BBE%u5DE5%u5382%u662F%u5FC5%u8981%u7684%u3002%0A%0A%u4E00%u5F00%u59CB%uFF0C%u4E0D%u7406%u89E3%u8FD9%u53E5%u8BDD%uFF0C%u73B0%u5728%u6DF1%u6DF1%u4F53%u4F1A%uFF0C%u5DE5%u5382%u6A21%u5F0F%u771F%u7684%u597D%uFF0C%u5F88%u5BB9%u6613%u88AB%u6EE5%u7528%u3002%u6211%u73B0%u5728%u5C31%u6709%u6EE5%u7528%u7684%u503E%u5411%u3002%0A%0A%60%60%60%0Apublic%20interface%20IFactory%7B%0A%09public%20IObject%20makeObject%28%29%3B%0A%7D%0Apublic%20class%20Factory%20implements%20IFactory%7B%0A%09@Override%0A%09public%20IObject%20makeObject%28%29%7B%0A%09%09return%20new%20Object%28%29%3B%0A%09%7D%0A%7D%0Apublic%20class%20Invoker%7B%0A%09public%20void%20func%28%29%7B%0A%09%09IFactory%20factory%20%3D%20new%20Factory%28%29%3B%0A%09%09IObject%20%3D%20factory.makeObject%28%29%3B%0A%09%7D%0A%7D%0A%60%60%60%0AInvoker%u7C7B%u5B8C%u5168%u4F9D%u8D56%u4E8E%u62BD%u8C61%u7684%u63A5%u53E3%u2014%u2014%u5DE5%u5382%u63A5%u53E3%u548CObject%u63A5%u53E3%uFF0C%u800C%u4E0D%u4F9D%u8D56%u4E8E%u5177%u4F53%u7684%u7C7B%u3002%u5728%u5F00%u53D1%u9636%u6BB5%uFF0C%u6216%u8005%u7C7B%u7ED3%u6784%u4E0D%u7A33%u5B9A%u9636%u6BB5%uFF0C%u6211%u4EEC%u53EF%u4EE5%u4EFB%u610F%u4FEE%u6539makeObject%u63A5%u53E3%u7684%u5B9E%u73B0%u6765%u751F%u4EA7%u6211%u4EEC%u9700%u8981%u7684%u5BF9%u8C61%u3002%0A%0A%u5DE5%u5382%u6A21%u5F0F%u5728%u5355%u5143%u6D4B%u8BD5%u4E2D%u4E5F%u662F%u5F88%u6709%u7528%u7684%u3002%u6211%u4EEC%u53EF%u4EE5%u901A%u8FC7%u66FF%u6362%u5177%u4F53%u7684%u5DE5%u5382%u7C7B%u6765%u5B9E%u73B0%u771F%u5B9E%u7684%u7C7B%u548Cmock%u7C7B%u4E4B%u95F4%u7684%u5207%u6362%u3002%u5F53%u7136%u6211%u4EEC%u4E5F%u53EF%u4EE5%u7528mockito%u6765%u5E2E%u6211%u4EEC%u505A%u8FD9%u4E9B%u4E8B%u60C5%u3002%u5982%u679C%u7C7B%u5E9E%u5927%u7684mockito%u89E3%u51B3%u4E0D%u4E86%uFF0C%u4E00%u4E2A%u5DE5%u5382%u7C7B%u53EF%u80FD%u4F1A%u7ED9%u6211%u4EEC%u63D0%u4F9B%u610F%u60F3%u4E0D%u5230%u7684%u65B9%u4FBF%u3002%0A%0A%3E%u4F5C%u8005%u7684%u4F8B%u5B50%uFF1A%0A%3E%u5728%20%u67D0%20%u4E9B%20%u60C5%20%u51B5%20%u4E0B%20%uFF0C%20Payroll%20Test%u628A%20Database%u7684%u5F15%u7528%u4F20%u9012%u7ED9Payrol%20l%u662F%u76F8%u5F53%u81EA%u7136%u7684%uFF0C%u5728%u53E6%u4E00%u4E9B%u60C5%u51B5%u4E0B%uFF0C%u6709%u53EF%u80FDPayrollTest%u5FC5%u987B%u8BBE%u7F6E%u4E00%u4E2A%u5168%u5C40%u53D8%u91CF%u4FDD%u5B58%u5BF9Database%u7684%u5F15%u7528%u3002%u8FD8%u6709%u4E00%u4E9B%u60C5%u51B5%u4E0BPayroll%u53EF%u80FD%u5B8C%u5168%u671F%u671B%u81EA%u5DF1%u6765%u521B%u5EFADatabase%u5B9E%u4F8B%u3002%u5728%u6700%u540E%u4E00%u79CD%u60C5%u51B5%u4E2D%uFF0C%u53EF%u4EE5%u4F7F%u7528FACTORY%u6A21%u5F0F%uFF0C%u901A%u8FC7%u4F20%u7ED9Payroll%u53E6%u5916%u4E00%u4E2A%u5DE5%u5382%u5BF9%u8C61%uFF0C%u6765%u6B3A%u9A97Payroll%u521B%u5EFA%u51FADatabase%u7684%u6D4B%u8BD5%u7248%u672C%u3002%0A%0A%21%5BAlt%20text%7C500x0%5D%28./1478441361359.png%29%0A%0A%23%23%23%u5305%u8BBE%u8BA1%u539F%u5219%0A%23%23%23%23%u7C92%u5EA63%u539F%u5219%u2014%u2014%u5982%u4F55%u51B3%u5B9A%u54EA%u4E9B%u7C7B%u5E94%u5F53%u653E%u5165%u4E00%u4E2A%u5305%0A%23%23%23%23%23REP%20%u2014%u2014Reuse-Release%20Equivalence%20Principle%20%u91CD%u7528%u53D1%u5E03%u7B49%u6548%u539F%u5219%0A%u4E00%u4E2A%u5305%u4E2D%u7684%u8F6F%u4EF6%u8981%u4E48%u90FD%u662F%u53EF%u91CD%u7528%u7684%uFF0C%u8981%u4E48%u90FD%u662F%u4E0D%u53EF%u91CD%u7528%u7684%u3002%u6211%u4EEC%u4E0D%u5E0C%u671B%u4E00%u4E2A%u7528%u6237%u53D1%u73B0%u5305%u4E2D%u6240%u5305%u542B%u7684%u7C7B%u4E2D%uFF0C%u4E00%u4E9B%u662F%u4ED6%u6240%u9700%u8981%u7684%uFF0C%u53E6%u4E00%u4E9B%u5BF9%u4ED6%u5374%u5B8C%u5168%u4E0D%u9002%u5408%u3002%0A%u6211%u7406%u89E3%u7684%u610F%u601D%u5C31%u662F%uFF0C%u8003%u8651%u95EE%u9898%u8981%u4EE5%u5305%u4E3A%u6700%u5C0F%u7C92%u5EA6%u3002%u7C7B%u4F3C%u7C7B%u8BBE%u8BA1%u7684SRP%uFF0C%u5355%u4E00%u804C%u8D23%u539F%u5219%u3002%0A%0A%23%23%23%23%23CRP%u2014%u2014Common%20Reuse%20Principle%u5171%u540C%u91CD%u7528%u539F%u5219%0ACRP%u89C4%u5B9A%u76F8%u4E92%u4E4B%u95F4%u6CA1%u6709%u7D27%u5BC6%u8054%u7CFB%u7684%u7C7B%u4E0D%u5E94%u8BE5%u5728%u540C%u4E00%u4E2A%u5305%u4E2D%0A%0A%23%23%23%23%23CCP%u2014%u2014Common%20Close%20Principle%u5171%u540C%u5C01%u95ED%u539F%u5219%0A%u8FD9%u6761%u539F%u5219%u89C4%u5B9A%u4E86%u4E00%u4E2A%u5305%u5C0F%u5E94%u8BE5%u5305%u4ECB%u591A%u4E2A%u5F15%u8D77%u53D8%u5316%u7684%u539F%u56E0%u3002%0A%0A%23%23%23%23%u7A33%u5B9A%u6027%u539F%u5219%0A%u5982%u4F55%u907F%u514D%22%u6668%u540E%u7EFC%u5408%u75C7%22%0A-%20%u6BCF%u5468%u6784%u5EFA%0A-%20ADP%u2014%u2014Acyclic%20Dependencies%20Principle%u65E0%u73AF%u4F9D%u8D56%0A%0A%u6709%u4F9D%u8D56%u73AF%uFF0C%u5219%u4F1A%u5F71%u54CD%u5230%u73AF%u4E0A%u8282%u70B9%u76F8%u5173%u7684%u6240%u6709%u8282%u70B9%uFF0C%u8FDB%u800C%u5BFC%u81F4%u6574%u4E2A%u8F6F%u4EF6%u5305%u7684%u5D29%u6E83%u3002%u6240%u4EE5%u5207%u8BB0%uFF0C%u4F9D%u8D56%u5173%u7CFB%u5206%u6790%u5F88%u91CD%u8981%uFF0C%u7EDD%u4E0D%u80FD%u6709%u4F9D%u8D56%u73AF%u3002%0A%0A%23%23%23%23%23%u89E3%u9664%u4F9D%u8D56%u73AF%u7684%u65B9%u6CD5%0A%21%5BAlt%20text%7C450x0%5D%28./1478442717383.png%29%0A1.%20%u4F9D%u8D56%u5012%u7F6E%uFF08DIP%uFF09%0A%21%5BAlt%20text%7C600x0%5D%28./1478442749395.png%29%0A2.%20%u5B9A%u4E49%u51FA%u5171%u540C%u4F9D%u8D56%u7684%u5305%0A%0A20.5%2620.6%u662F%u672C%u7AE0%u7684%u6838%u5FC3%uFF0C%u5728%u8FD9%u4E24%u8282%u4E2D%uFF0C%u4F5C%u8005%u9610%u8FF0%u4E86%u5982%u4F55%u5B9A%u91CF%u5730%u5206%u6790%u5305%u7684%u7A33%u5B9A%u6027%uFF0C%u5E76%u6307%u5BFC%u6211%u4EEC%u7A76%u7ADF%u6539%u5982%u4F55%u5206%u5E03%u7A33%u5B9A%u7C7B%u548C%u975E%u7A33%u5B9A%u7C7B%u3002%u8FD9%u5176%u4E2D%u6709%u4E00%u53E5%u8BDD%uFF0C%u8BA9%u6211%u5370%u8C61%u9887%u4E3A%u6DF1%u523B%uFF1A%0A%3E%u5E76%u4E0D%u662F%u6240%u6709%u7684%u7C7B%u90FD%u9002%u5408%u4F5C%u4E3A%u7A33%u5B9A%u7C7B%u3002%0A%0A%u8FD9%u4E00%u7AE0%u5185%u5BB9%u9002%u5408%u53CD%u590D%u7814%u8BFB%uFF0C%u6211%u6253%u7B97%u7559%u505A%u4E0B%u4E00%u6B21%u518D%u6765%u505A%u7B14%u8BB0%u3002%0A%0A%23%2323-27%u7AE0%0A%23%23%23COMPOSITE%0A%u8FD9%u4E2A%u6A21%u5F0F%u662F%u5BF9%5BCOMMAND%5D%28%23jump%29%u6A21%u5F0F%u7684%u6269%u5C55%u3002%u4E3A%u7684%u662F%u8BA9%u591A%u4E2A%u5BF9%u8C61%u7684%u884C%u4E3A%u8868%u73B0%u7684%u50CF%u4E00%u4E2A%u5BF9%u8C61%u3002%u4F8B%u5982%uFF1A%0A%21%5BAlt%20text%5D%28./1478938642614.png%29%0A%u5F53sensor%u9700%u8981%u4E00%u6B21%u8FD0%u884C%u591A%u4E2A%u547D%u4EE4%u7684%u65F6%u5019%u600E%u4E48%u529E%uFF1F%u662F%u4FEE%u6539%uFF0Csensor%uFF0C%u4FEE%u6539%u7ED1%u5B9A%u903B%u8F91%uFF0C%u8FD8%u662F%u4FEE%u6539command%u672C%u8EAB%uFF1F%u6700%u7B80%u5355%u7684%u65B9%u6CD5%u5C31%u662F%u4FEE%u6539%u7ED1%u5B9A%u903B%u8F91%u7684%u65F6%u5019%uFF0C%u6539%u4E3A%u7ED1%u5B9A%u4E00%u4E2Acomposite%u547D%u4EE4%uFF0C%u8FD9%u4E2A%u547D%u4EE4%u7EE7%u627F%u81EAcommand%u63A5%u53E3%uFF0C%u5E76%u4E14%u4ED6%u5305%u542B%u4E86%u591A%u6761%u540C%u6837%u884C%u4E3A%u7684%u547D%u4EE4%u3002%0A%0A%23%23%23OBSERVER%0A%u8FD9%u4E00%u7AE0%uFF0C%u4F5C%u8005%u7ED9%u51FA%u4E86%u5982%u4F55%u4ECE%u6700%u57FA%u672C%u7684coding%u65B9%u5F0F%uFF0C%u63A8%u6F14%u51FA%u5982%u4F55%u5957%u7528%u5408%u9002%u7684%u6A21%u5F0F%u3002%u5176%u57FA%u672C%u601D%u60F3%u5C31%u662F%0A%3E**%u4E0D%u8981%u8FC7%u5EA6%u8BBE%u8BA1%uFF0C%u800C%u662F%u5728%u4E0D%u65AD%u7684%u91CD%u6784%u4E2D%uFF0C%u5411%u67D0%u4E00%u79CD%u6A21%u5F0F%u4E0D%u65AD%u9760%u8FD1%uFF0C%u5F53%u5176%u7ED3%u6784%u5DF2%u7ECF%u6F14%u5316%u6210%u67D0%u4E00%u79CD%u6A21%u5F0F%u65F6%uFF0C%u5C06%u6240%u6709%u7684%u540D%u79F0%u4FEE%u6539%u4E3A%u8BE5%u6A21%u5F0F%u7684%u672F%u8BED%uFF0C%u4ECE%u800C%u8FBE%u5230%u4F7F%u7528%u6A21%u5F0F%u7684%u76EE%u7684**%0A%0A%u8FD9%u5B9E%u9645%u662F%u672C%u7AE0%u7684%u7CBE%u9AD3%u3002%0A%u4E0D%u8FC7%u672C%u7AE0%u5728%u9610%u8FF0%u4E0A%u8FF0%u8715%u5316%u6F14%u8FDB%u7684%u8FC7%u7A0B%u7684%u65F6%u5019%uFF0C%u4EE5OBSERVER%u6A21%u5F0F%u4E3A%u4F8B%uFF0C%u4E5F%u5C06%u8FD9%u4E2A%u6A21%u5F0F%u7684%u539F%u7406%u548C%u4F7F%u7528%u65B9%u6CD5%u8BB2%u7684%u5F88%u6E05%u695A%u4E86%u3002%0A%21%5BAlt%20text%5D%28./1479025492315.png%29%0A%21%5BAlt%20text%5D%28./1479025507770.png%29%0ASubject%u4E3B%u9898%uFF0CObserver%u89C2%u5BDF%u8005%u3002%u89C2%u5BDF%u8005%u5411%u4E3B%u9898%u6CE8%u518C%u81EA%u5DF1%uFF0C%u4E3B%u9898%u5728%u53D1%u751F%u53D8%u5316%u65F6%uFF0C%u66F4%u65B0%u89C2%u5BDF%u8005%u3002Subject%u548CObserver%u662F%u7CFB%u7EDF%u53EF%u91CD%u7528%u63A5%u53E3%uFF0C%u5177%u4F53%u7684%u7C7B%u7EE7%u627F%u81EA%u8FD9%u4E24%u4E2A%u63A5%u53E3%uFF0C%u4ECE%u800C%u5177%u6709OBSERVER%u6A21%u5F0F%u7684%u529F%u80FD%u3002%0A%23%23%23%23%23%u4E24%u79CD%u6A21%u5F0F%u2014%u2014%u63A8%26%u62C9%0A%u62C9%u6A21%u5F0F%u9002%u5408%u7B80%u5355%u7684%u4FE1%u606F%u4EA4%u4E92%uFF0CObserver%u77E5%u9053%u53BBSubject%u62C9%u4EC0%u4E48%u4FE1%u606F%u3002%0A%u817F%u6A21%u5F0F%u9002%u5408%u590D%u6742%u4FE1%u606F%u4EA4%u4E92%uFF0C%u7531Subject%u544A%u8BC9Observer%u4EC0%u4E48%u4FE1%u606F%u53D1%u751F%u4E86%u53D8%u5316%u3002%0A%23%23%23ABSTRACT%20SERVER%2C%20ADAPTER%26BRIDGE%0A%23%23%23%23ABSTRACT%20SERVER%0A%u8FD9%u4E2A%u6A21%u5F0F%u5F88%u7B80%u5355%uFF0C%u5F88%u5BB9%u6613%u7406%u89E3%uFF0C%u770B%u4E0B%u9762%u4E24%u5E45%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1479027605482.png%29%0A%u5DE6%u8FB9%u8FDD%u53CD%u4E86OCP%u548CDIP%0A-%20%u5BF9Switch%u7684%u7EE7%u627F%uFF0C%u603B%u662F%u5E26%u4E0A%u4E86Light%u4FE1%u606F%uFF0C%u6709%u53EF%u80FD%u5BFC%u81F4%u4FEE%u6539%0A-%20%u9AD8%u5C42Switch%u4F9D%u8D56%u4E8ELight%0A%0A%u53F3%u8FB9%u7684%u56FE%u5C06Switch%u63A5%u53E3%u62BD%u8C61%u51FA%u6765%uFF0C%u4E0D%u7BA1%u63A7%u5236%u4EC0%u4E48%u8BBE%u5907%uFF0C%u53EA%u8981%u5B9A%u4E49%u4E86%u8BE5%u63A5%u53E3%u5C31%u53EF%u4EE5%u3002%0A%u5728%u8FD9%u91CC%uFF0C%u59CB%u7EC8%u8426%u7ED5%u6211%u7684%u4E00%u4E2A%u95EE%u9898%u53C8%u51FA%u73B0%u4E86%uFF0C%u5C31%u662F%u4F55%u65F6%u5B9E%u4F8B%u5316Light%u7C7B%uFF1F%u6309%u7167%u56FE25.2%u7684%u903B%u8F91%uFF0C%u5E94%u8BE5%u662FSwitch%u5305%u542B%u4E00%u4E2ALight%u5BF9%u8C61%uFF0C%u5728%u8C03%u7528Switch%u7684turnOn%u65F6%uFF0C%u59D4%u6258%u7ED9Light%u7684turnOn%u3002%0A1.%20%u90A3%u4E48%u523025.3%u4E2D%uFF0C%u5C31%u5E94%u8BE5%u662FSwitch%u6301%u6709%u4E00%u4E2ASwitchable%u7684%u5BF9%u8C61%uFF08%u53EF%u80FD%u662FLight%u6216%u8005Fan%u7B49%u7B49%uFF09%u3002%u90A3%u5C31%u53EF%u80FD%u662F%u7531%u67D0%u4E2A%u5DE5%u5382%u6765%u4EA7%u751F%u8FD9%u4E2A%u5BF9%u8C61%u7ED9Switch%u3002%0A2.%20%u8FD8%u6709%u4E00%u79CD%u53EF%u80FD%u5C31%u662F%uFF0C%u7531%u5BA2%u6237%u903B%u8F91%u6765%u5B9E%u73B0Switch%u548CSwitchable%u5BF9%u8C61%u7684%u7ED1%u5B9A%u3002%u4F8B%u5982%60Switch.setSwitchable%28Light%29%60%u3002%u5728Switch%u4E2D%u65E0%u5DEE%u522B%u7684%u4F7F%u7528Switchable%u63A5%u53E3%u3002%0A%0A%u4E24%u4E2A%u90FD%u662F%u6211%u7684%u7406%u89E3%uFF0C%u4E0D%u4E00%u5B9A%u6B63%u786E%u3002%u4EE5%u540E%u82E5%u6709%u673A%u4F1A%u4E0E%u5927%u5E08%u4EA4%u6D41%uFF0C%u53EF%u4EE5%u5F53%u9762%u63D0%u51FA%u8FD9%u4E2A%u95EE%u9898%u3002%0A%23%23%23%23%u8C01%u62E5%u6709%u8FD9%u4E2A%u63A5%u53E3%0A%u5728%u8FD9%u4E00%u7AE0%u4F5C%u8005%u8FD8%u63D0%u51FA%u4E86%u4E00%u4E2A%u5F88%u503C%u5F97%u91CD%u89C6%u7684%u95EE%u9898%uFF08%u5176%u5B9E%u5728%u524D%u9762%u7684%u7AE0%u8282%u5DF2%u7ECF%u51FA%u73B0%u8FC7%uFF09%uFF0C%u5C31%u662F%u63A5%u53E3%u5230%u5E95%u8BE5%u548C%u8C01%u6253%u5305%uFF1F%u770B%u4F5C%u8005%u7684%u9610%u8FF0%uFF1A%0A%3E**%u5BA2%u6237%u548C%u63A5%u95E8%u4E4B%u95F4%u7684%u903B%u8F91%u7ED1%u5B9A%u5173%u7CFB%u8981%u5F3A%u4E8E%u63A5%u53E3%u548C%u5B83%u7684%u6D3E%u751F%u7C7B%u4E4B%u95F4%u7684%u903B%u8F91%u7ED1%u5B9A%u5173%u7CFB**%u3002%u5B83%u4EEC%u4E4B%u95F4%u7684%u5173%u7CFB%u5F3A%u5230%u5728%u6CA1%u6709Switchable%u7684%u60C5%u51B5%u4E0B%u5C31%u65E0%u6CD5%u4F7F%u7528Switch%uFF1B%u4F46%u662F%uFF0C%u5728%u6CA1%u6709%u53E3Light%u7684%u60C5%u51B5%u4E0B%u5374%u5B8C%u5168%u53EF%u4EE5%u4F7F%u7528Switch%u3002%u903B%u8F91%u5173%u7CFB%u7684%u5F3A%u5EA6%u548C%u5B9E%u4F53%20%u5173%u7CFB%u7684%u5F3A%u5EA6%u662F%u4E0D%u4E00%u81F4%u7684%u3002%u7EE7%u627F%u662F%u4E00%u4E2A%u6BD4%u5173%u8054%u5F3A%u5F97%u591A%u7684%u5B9E%u4F53%u5173%u7CFB%u3002%0A%0A%u6362%u53E5%u8BDD%u8BF4%uFF0C%u6211%u4EEC%u5E94%u5F53%u6309%u7167%u903B%u8F91%u5173%u7CFB%u7684%u5F3A%u5F31%u6765%u51B3%u5B9A%u5305%u7684%u8FB9%u754C%uFF0C%u5373%u63A5%u53E3%u7684%u5BA2%u6237%u5E94%u5F53%u63A5%u53E3%u7684%u5B9A%u4E49%u3002%u7EE7%u627F%u5173%u7CFB%u662F%u5929%u7136%u7684%uFF0C%u6211%u4EEC%u5E94%u5F53%u53C2%u8003%u7684%u662F%u7C7B%u4E4B%u95F4%u7684%u903B%u8F91%u5173%u7CFB%u3002%0A%23%23%23%3Cspan%20id%3D%22adapter%22%3EADAPTER%3C/span%3E%0A%u5148%u770B%u4EC0%u4E48%u662FADAPTER%u6A21%u5F0F%0A%u4E00%u822C%u5F62%u5F0F%u7684ADAPTER%uFF1A%0A%21%5BAlt%20text%7C450x0%5D%28./1479029079969.png%29%0A%u7C7B%u5F62%u5F0F%u7684ADAPTER%uFF1A%0A%21%5BAlt%20text%7C450x0%5D%28./1479029186606.png%29%0A%u4E0D%u540C%u7684%u662F%u524D%u8005%u7528%u7EC4%u5408%uFF0C%u540E%u8005%u7528%u591A%u91CD%u7EE7%u627F%u6765%u7EC4%u7EC7%u9002%u914D%u5668%uFF0C%u539F%u7406%u662F%u4E00%u6837%u7684%u3002%u5176%u5B9E%u7EE7%u627F%u5C31%u662F%u4E00%u79CD%u7EC4%u5408%u3002%0A%u8FD9%u91CC%u5176%u5B9E%u8FD8%u770B%u4E0D%u51FAADAPTER%u7684%u5999%u7528%uFF0C%u6211%u7684%u7406%u89E3%u662FADAPTER%u5728%u4E24%u8FB9%u63A5%u4E0D%u62E2%u7684%u65F6%u5019%u6D3E%u4E0A%u7528%u573A%u7684%u3002%u4F5C%u8005%u7ED9%u7684%u4F8B%u5B50%u662F%u5173%u4E8E%u89E3%u8C03%u5668%u7684%u3002%u5176%u5B9E%u6211%u4EEC%u5728%u5B9E%u9645%u5F00%u53D1%u4E2D%u7ECF%u5E38%u9047%u5230%u7C7B%u4F3C%u7684%u95EE%u9898%u3002ADAPTER%u6A21%u5F0F%u5F88%u6709%u542F%u53D1%u3002%u4E0B%u9762%u6211%u7B80%u5355%u7F57%u5217%u4F5C%u8005%u7684%u4F8B%u5B50%uFF1A%0A%21%5BAlt%20text%7C450x0%5D%28./1479029463531.png%29%0A%u8FD9%u662FModem%u7684%u7ECF%u5178%u4F7F%u7528%u573A%u666F%uFF0C%u6709%u4E0D%u540C%u7684Modem%uFF0C%u4ED6%u4EEC%u9075%u5FAA%u540C%u4E00%u4E2A%u63A5%u53E3%u3002%u4E0A%u5C42%u6309%u7167%u63A5%u53E3%u4F7F%u7528%u8FD9%u4E9BModem%u3002%0A%21%5BAlt%20text%7C500x0%5D%28./1479029552237.png%29%0A%u6709%u4E00%u5929%u8981%u52A0%u5165%u4E00%u79CD%u65B0%u7684Modem%uFF0C%u73B0%u6709%u63A5%u53E3%u53EA%u6709%u4E00%u90E8%u5206%u5BF9%u4E4B%u6709%u610F%u4E49%u3002%u4E0A%u56FE%u662F%u7406%u60F3%u89E3%u51B3%u65B9%u6848%uFF0C%u628A%u539F%u5148%u7684%u63A5%u53E3%u5206%u6210%u4E24%u90E8%u5206%uFF0C%u4F46%u662F%u8FD9%u4E0D%u53EF%u80FD%uFF0C%u56E0%u4E3A%u5F88%u591Acode%u5DF2%u7ECF%u4F9D%u8D56%u4E8E%u8FD9%u4E2A%u63A5%u53E3%u4E86%u3002%0A%21%5BAlt%20text%7C500x0%5D%28./1479029706216.png%29%0A%u89E3%u51B3%u529E%u6CD5%u4E4B%u4E00%uFF0C%u5728%u65B0%u7EE7%u627F%u51FA%u7684%u7C7B%u4E2D%uFF0C%u5BF9%u4E0D%u9700%u8981%u7684%u63A5%u53E3%u505A%u5047%u7684%u5C01%u88C5%u3002%u8FD9%u6837%u662F%u53EF%u884C%u7684%uFF0C%u4F46%u4E5F%u9690%u85CF%u4E86%u98CE%u9669%u3002%u5982%u679C%u6709%u4E00%u5929Modem%u63A5%u53E3%u4E2D%uFF0C%u65B0%u7C7B%u7528%u4E0D%u5230%u7684%u63A5%u53E3%u53D1%u751F%u53D8%u5316%uFF0C%u90A3%u8FD9%u4E2A%u65B0%u7684%u7C7B%u4E5F%u8981%u8DDF%u7740%u53D8%u5316%uFF0C%u8FD9%u662F%u4E0D%u5408%u7406%u7684%uFF0C%u4E5F%u4EE4%u4EBA%u5F88%u6CAE%u4E27%u3002%0A%21%5BAlt%20text%7C500x0%5D%28./1479039815430.png%29%0A%u7528ADAPTER%u6765%u89E3%u51B3%u8FD9%u4E2A%u95EE%u9898%u3002%u6240%u6709%u548C%u539F%u5148%u63A5%u53E3%u517C%u5BB9%u7684%u95EE%u9898%uFF0C%u7531ADAPTER%u6765%u641E%u5B9A%u3002%u65B0%u7684Modem%u7C7Bfocus%u5728%u81EA%u5DF1%u9700%u8981%u7684%u529F%u80FD%u4E0A%u3002ADAPTER%u662F%u4E00%u4E2A%u5F88%u597D%u7684%u9694%u79BB%u7CFB%u7EDF%uFF0C%u89E3%u51B3%u77DB%u76FE%u7684%u5E2E%u624B%u3002%0A%0A%23%23%23%23BRIDGE%0ABridge%u6A21%u5F0F%u5728%u8FD9%u672C%u4E66%u4E0A%u7684%u5185%u5BB9%u6CA1%u770B%u61C2%uFF0C%u53BB%u53C2%u8003%u8BBE%u8BA1%u6A21%u5F0F%u5723%u7ECF%u2014%u2014%5B%u300A%u8BBE%u8BA1%u6A21%u5F0F%u300B%5D%28https%3A//www.amazon.cn/%25E8%25AE%25A1%25E7%25AE%2597%25E6%259C%25BA%25E7%25A7%2591%25E5%25AD%25A6%25E4%25B8%259B%25E4%25B9%25A6-%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F-%25E5%258F%25AF%25E5%25A4%258D%25E7%2594%25A8%25E9%259D%25A2%25E5%2590%2591%25E5%25AF%25B9%25E8%25B1%25A1%25E8%25BD%25AF%25E4%25BB%25B6%25E7%259A%2584%25E5%259F%25BA%25E7%25A1%2580-Erich-Gamma/dp/B001130JN8%29%u3002%u4E0D%u6127%u4E3A%u7ECF%u5178%u4E66%uFF0C%u8BB2%u89E3%u7684%u5F88%u6E05%u695A%u900F%u5F7B%u3002%0A%u4E66%u4E2D%u7ED9%u7684%u4F8B%u5B50%u662FWindow%20System%uFF0C%u770B%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1480073561975.png%29%0A%u7A97%u53E3%u7CFB%u7EDF%u5728%u4E0D%u540C%u7684%u5E73%u53F0%u4E0A%u6709%u5BF9%u5E94%u7684%u5B50%u7C7B%u3002%u5F53%u6211%u4EEC%u8981%u6D3E%u751FWindow%u7C7B%u751F%u6210%u65B0%u7684%u7A97%u53E3%u7C7B%u7684%u65F6%u5019%uFF0C%u5C31%u8981%u9762%u4E34%u9488%u5BF9%u4E0D%u540C%u5E73%u53F0%u6D3E%u751F%u65B0%u7684%u7C7B%u3002%u8FD9%u6837%u5982%u679C%u6709%u5F88%u591A%u7EE7%u627F%u5C42%u6B21%u7684%u8BDD%uFF0C%u7C7B%u5F88%u5FEB%u5C31%u53D8%u7684%u6CA1%u6CD5%u7BA1%u7406%u4E86%u3002%0A%u8FD9%u91CC%u7684%u95EE%u9898%u662F%uFF0C%u6709%u4E24%u4E2A%u7EE7%u627F%u5C42%u6B21%uFF1A%0A1.%20Window%u7CFB%u7EDF%u81EA%u8EAB%u7684%u6F14%u5316%0A2.%20%u5404%u4E2A%u5E73%u53F0%u5BF9Window%u7CFB%u7EDF%u7684%u5B9E%u73B0%0A%u5982%u679C%u4ED6%u4EEC%u90FD%u4F9D%u8D56%u4E8E%u540C%u4E00%u4E2A%u7EE7%u627F%u5173%u7CFB%uFF0C%u90A3%u5C31%u4F1A%u51FA%u73B0%u7C7B%u7EE7%u627F%u5931%u63A7%u7684%u73B0%u8C61%u3002Bridge%u6A21%u5F0F%u7684%u51FA%u73B0%u5C31%u662F%u4E3A%u4E86%u89E3%u51B3%u8FD9%u4E2A%u95EE%u9898%u3002%0A%21%5BAlt%20text%5D%28./1480075355062.png%29%0A%0A%u8FD9%u5C31%u662F%u4E00%u4E2A%u7ECF%u5178%u7684Bridge%u6A21%u5F0F%u3002%u62BD%u8C61%u7684Window%u7C7B%u548C%u5404%u5E73%u53F0%u7684%u5B9E%u73B0%u90E8%u5206%u5728%u5404%u81EA%u7684%u7C7B%u5C42%u6B21%u7ED3%u6784%u4E2D%u5206%u522B%u6F14%u5316%u3002Window%u4E0EWindowImp%u4E4B%u95F4%u7684%u5173%u7CFB%u79F0%u4E3A%u6865%u63A5%u3002%u4EE3%u7801%u793A%u4F8B%u5982%u4E0B%uFF1A%0A%60%60%60%0Aclass%20Window%20%0A%7B%0Apublic%3A%0A%09virtual%20void%20DrawLine%28const%20Point%26%2C%20const%20Point%26%29%20%3D%200%3B%0A%0Aprotected%3A%0A%09WindowImp*%20GetWindowImp%28%29%3B%20//**********%0A%0Aprivate%3A%0A%09WindowImp*%20_imp%3B%0A%09View*%20_contents%3B%0A%7D%0Aclass%20WindowImp%0A%7B%0Apublic%3A%0A%09virtual%20void%20DrawLineImp%28const%20Point%26%2C%20const%20Point%26%29%20%3D%200%3B%0A%7D%0Aclass%20IconWindow%20%3A%20public%20Window%0A%7B%0Apublic%3A%0A%09virtual%20void%20DrawLine%28const%20Point%26%20a%2C%20const%20Point%26%20b%29%0A%09%7B%0A%09%09WindowImp*%20imp%20%3D%20GetWindowImp%28%29%3B%0A%09%09imp-%3EDrawLineImp%28a%2C%20b%29%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u8FD9%u91CC%u5F88%u6709%u610F%u601D%u7684%u662FWindow%u7C7B%u7684%u6D3E%u751F%u7C7B%uFF0C%u901A%u8FC7Window%u7684protected%u63A5%u53E3%u6765%u8BBF%u95EE%u5230%u5BF9%u5E94%u7684Imp%u63A5%u53E3%u3002%u800CGetWindowImp%u53EF%u80FD%u5229%u7528%u4E00%u4E2A%u62BD%u8C61%u5DE5%u5382%uFF0C%u6765%u751F%u6210%u9700%u8981%u7684%u5BF9%u8C61%u3002GetWindowImp%u53EF%u4EE5%u5728%u8FD9%u4E2A%u5DE5%u5382%u4E2D%u68C0%u6D4B%u5F53%u524D%u7684%u5E73%u53F0%u6765%u5B9E%u4F8B%u5316%u5BF9%u5E94%u7684WindowImp%u7C7B%u3002%0A%0A%23%23%23%23Bridge%u6A21%u5F0F%u4E00%u4E9B%u503C%u5F97%u6CE8%u610F%u7684%u5730%u65B9%0A1.%20%u4EC5%u6709%u4E00%u4E2AImplementor%u7684%u65F6%u5019%uFF0C%u6CA1%u6709%u5FC5%u8981%u521B%u5EFA%u4E00%u4E2A%u62BD%u8C61%u7684Implementor%u7C7B%0A2.%20%u5B9E%u4F8B%u5316Imp%u7C7B%u7684%u65B9%u6CD5%u6709%uFF1A%0A%09-%20%u5982%u679C%u6839%u62BD%u8C61%u7C7B%u77E5%u9053%u6240%u6709%u7684Implementor%u5B9E%u73B0%u7C7B%uFF0C%u5219%u53EF%u5728%u5176%u6784%u9020%u51FD%u6570%u4E2D%u6839%u636E%u9700%u8981%u6765%u5B9E%u4F8B%u5316%u4E00%u4E2AImplementor%u7C7B%0A%09-%20%u9996%u5148%u9009%u62E9%u4E00%u4E2A%u9ED8%u8BA4%u7684%u5B9E%u73B0%uFF0C%u7136%u540E%u6839%u636E%u9700%u8981%u6539%u53D8%u8FD9%u4E2A%u5B9E%u73B0%0A%09-%20%u91C7%u7528%u5DE5%u5382%u6A21%u5F0F%u6765%u751F%u4EA7%u5BF9%u5E94%u7684Imp%u7C7B%u5BF9%u8C61%0A3.%20%u5728C++%u4E2D%uFF0C%u53EF%u4EE5%u4F7F%u7528%u591A%u91CD%u7EE7%u627F%u7ED3%u5408%u4E24%u4E2A%u62BD%u8C61%u5C42%u6B21%u3002%u4F46%u662F%u8FD9%u79CD%u529E%u6CD5%u4F9D%u8D56%u4E8E%u9759%u6001%u7EE7%u627F%u3002%u56E0%u6B64%u4E0D%u53EF%u80FD%u7528%u591A%u91CD%u7EE7%u627F%u7684%u65B9%u6CD5%u6765%u5B9E%u73B0%u771F%u6B63%u7684Bridge%u6A21%u5F0F%u3002%u4EE5Window%u7CFB%u7EDF%u4E3A%u4F8B%uFF0C%u5982%u679C%u4E00%u4E2A%u7A97%u53E3%u7C7B%u7EE7%u627FWindow%u548CWindowImp%u62BD%u8C61%u7C7B%uFF0C%u4F46%u662F%u4ED6%u5E76%u6CA1%u6709%u83B7%u5F97XWindow%u7684%u5B9E%u73B0%u3002%0A%0A%23%23%23%23%u654F%u6377%u8F6F%u4EF6%u5F00%u53D1%u4E2D%u7684Bridge%u6A21%u5F0F%0A%u518D%u56DE%u5230%u300A%u654F%u6377%u8F6F%u4EF6%u5F00%u53D1%u300B%u8FD9%u672C%u4E66%uFF0C%u770B%u4E0B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1480115182591.png%29%0A%u56E0%u4E3A%u65B0%u7684Dedicated%20Modem%uFF08%u5373%u53EA%u6709%u6570%u636E%u4F20%u8F93%u529F%u80FD%u7684Modem%uFF09%u7684%u5F15%u5165%uFF0CModem%u7684%u7C7B%u7ED3%u6784%u4E2D%u5C31%u5F15%u5165%u4E86%u4E00%u4E2A%u65B0%u7684%u5C42%u6B21%u7ED3%u6784%u3002%u56E0%u4E3A%u539F%u6709%u7684%u62BD%u8C61%u7ED3%u6784%u603B%u6709%u4E00%u4E9B%u4E0D%u5C3D%u4EBA%u610F%u7684%u5730%u65B9%u3002%u6BD4%u5982%uFF0C%u5728%u539F%u5148%u7684%u8BBE%u8BA1%u4E2D%uFF0C%u53EF%u80FD%u6709%u5728Send%u4E4B%u524D%u8981%u5148Dial%u7684%u7EA6%u675F%uFF0C%u90A3%u4E48%u5728%u65B0%u7684Modem%u7C7B%u4E2D%uFF0C%u5C31%u4E0D%u9002%u5408%u4E86%u3002%u5982%u679C%u60F3%u4E0D%u56E0%u4E3A%u5F15%u5165%u65B0%u7684Modem%u7C7B%u578B%u800C%u9700%u8981%u4FEE%u6539%u4E0A%u5C42%u5E94%u7528%u7A0B%u5E8F%u7684%u8BDD%uFF0C%u5C31%u8981%u7528%u5230Bridge%u6A21%u5F0F%u3002%0A-%20ModemConnectionController%u5B9A%u4E49%u4E86%u4E24%u4E2A%u63A5%u53E3%uFF1A%u539F%u6709%u7684Modem%u548C%u65B0%u7684DedicatedModem%u3002%0A-%20ModemConnectionController%u4E2D%u6240%u6709%u7684Imp%u63A5%u53E3%u5747%u4E3AProtected%uFF0C%u53EA%u80FD%u88AB%u5176%u5B50%u7C7B%u4F7F%u7528%u3002%0A-%20ModemConnectionController%u5728%u9002%u5F53%u7684%u65F6%u673A%uFF0C%u5B9E%u4F8B%u5316%u5BF9%u5E94Modem%u7684%u786C%u4EF6%u5B9E%u73B0%uFF0C%u5E76%u5C06%u6240%u6709%u7684Imp%u63A5%u53E3%u59D4%u6258%u7ED9%u8FD9%u4E2A%u5B9E%u4F8B%u3002%0A%0A%u7528%u4EE3%u7801%u6765%u9610%u8FF0%u53EF%u80FD%u66F4%u76F4%u89C2%uFF1A%0A%60%60%60%0Apublic%20interface%20Modem%20%7B%0A%09public%20void%20Dial%28%29%3B%0A%7D%0Apublic%20interface%20DedicatedModem%20%7B%0A%09public%20void%20Send%28%29%3B%0A%7D%0Apublic%20abstract%20class%20ModemConnectionController%20implements%20Modem%2C%20DedicatedModem%7B%0A%20%20%20%20private%20ModemImplementation%20_imp%3B%0A%09protected%20ModemImplementation%20GetImp%28int%20token%29%7B%0A%09%09switch%20%28token%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20case%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Object%28%29%3B%0A%09%20%20%20%20%7D%0A%20%20%20%20%7D%0A%09%0A%09protected%20void%20DialImpl%28%29%7B%0A%20%20%20%20%20%20%20%20return%20GetImp%28mToken%29.Dial%28%29%3B%20//%20delegate%0A%09%7D%0A%0A%20%20%20%20protected%20void%20SendImpl%28%29%7B%0A%20%20%20%20%20%20%20%20return%20GetImp%28mToken%29.Send%28%29%3B%20//%20delegate%0A%09%7D%0A%0A%20%20%20%20public%20void%20Dial%28%29%20%7B%7D%0A%20%20%20%20public%20void%20Send%28%29%20%7B%7D%0A%7D%0Apublic%20class%20DedModemController%20extends%20ModemConnectionController%20%7B%0A%20%20%20%20public%20void%20Dial%28%29%7B%20/*%20own%20version%20of%20Dial%20*/%20%7D%0A%20%20%20%20public%20void%20Send%28%29%7B%20return%20DialImpl%28%29%3B%20%7D%0A%7D%0Apublic%20class%20DedUser%20%7B%0A%20%20%20%20void%20main%28%29%7B%0A%20%20%20%20%20%20%20%20DedicatedModem%20dedModem%20%3D%20%28DedicatedModem%29new%20DedModemController%3B%0A%20%20%20%20%20%20%20%20dedModem.Dial%28%29%3B%0A%20%20%20%20%20%20%20%20dedModem.Send%28%29%3B%0A%20%20%20%20%7D%0A%7D%0Apublic%20class%20OldUser%20%7B%0A%20%20%20%20void%20main%28%29%7B%0A%20%20%20%20%20%20%20%20Modem%20modem%20%3D%20%28Modem%29new%20HayesModem%3B%0A%20%20%20%20%20%20%20%20modem.Dial%28%29%3B%0A%20%20%20%20%20%20%20%20modem.Send%28%29%3B%0A%20%20%20%20%7D%0A%7D%0A%60%60%60%0A%u56E0%u4E3A*Impl%u51FD%u6570%u7684%u5B58%u5728%uFF0CDedModem%u53EF%u4EE5%u6F14%u53D8%u6210%u72EC%u7ACB%u7684%u7C7B%u6F14%u5316%u5E8F%u5217%u3002%0A%0A%23%23%23PROXY%0A%u4E0B%u56FE%u662F%u4E00%u4E2A%u5178%u578B%u7684PROXY%u6A21%u5F0F%uFF1A%0A%21%5BAlt%20text%7C450x0%5D%28./1480238359796.png%29%0A%3E%u6BCF%u4E2A%u8981%u88AB%u4EE3%u7406%u7684%u5BF9%u8C61%u90FD%u88AB%u5206%u62103%u4E2A%u90E8%u5206%uFF1A%0A%3E1.%20%u4E00%u4E2A%u63A5%u53E3%uFF0C%u58F0%u660E%u4E86%u5BA2%u6237%u8981%u8C03%u7528%u7684%u6240%u6709%u65B9%u6CD5%0A%3E2.%20%u4E00%u4E2A%20%u7C7B%u5728%u4E0D%u6D89%u53CA%u6570%u636E%u5E93%u903B%u8F91%u7684%u60C5%u51B5%u4E0B%u5B9E%u73B0%u4E86%u63A5%u53E3%u4E2D%u7684%u65B9%u6CD5%0A%3E3.%20%u4E00%u4E2A%u77E5%u6653%u6570%u636E%u5E93%u7684%u4EE3%u7406%0A%0A%21%5BAlt%20text%7C500x0%5D%28./1480238530929.png%29%0A%u8FD9%u4E24%u5E45%u56FE%u5176%u5B9E%u5DF2%u7ECF%u5F88%u597D%u7684%u9610%u660E%u4E86PROXY%u6A21%u5F0F%u3002%u4F5C%u8005%u4E5F%u6307%u51FA%uFF0CPROXY%u5176%u5B9E%u662F%u4E00%u4E2A%u5F88%u91CD%u7684%u6A21%u5F0F%uFF0C%u5728%u5B9E%u73B0%u7684%u65F6%u5019%uFF0C%u56E0%u4E3A%u5404%u79CD%u539F%u56E0%uFF08%u662F%u5426%u9700%u8981%u7F13%u5B58%uFF0C%u662F%u5426%u9700%u8981%u8C03%u7528Imp%u5B9E%u73B0%u7B49%u7B49%uFF09%uFF0C%u5E76%u4E0D%u4F1A%u4E25%u683C%u9075%u5B88%u89C4%u8303%u7684%u6A21%u5F0F%u3002%0A%3E%u8FD9%u4E2A%u4F8B%u5B50%u5E94%u8BE5%u5DF1%u7ECF%u6D88%u9664%u4E86%u6240%u6709%u5173%u4E8E%u4F7F%u7528%u4EE3%u7406%u662F%u7B80%u5355%u548C%u4F18%u96C5%u7684%u9519%u8BEF%u8BA4%u8BC6%u3002%u4F7F%u7528%u4EE3%u7406%u662F%u6709%u4EE3%u4EF7%u7684%u3002%u89C4%u8303%u6A21%u5F0F%u4E2D%u6240%u9690%u542B%u7684%u7B80%u5355%u59D4%u6258%u6A21%u578B%u5F88%u5C11%u80FD%u591F%u88AB%u4F18%u7F8E%u5730%u5B9E%u73B0%u3002%u76F8%u53CD%uFF0C%u6211%u4EEC%u7ECF%u5E38%u4F1A%u53D6%u6D88%u5BF9%u4E8E%u7E41%u7410%u7684%u83B7%u53D6%u548C%u8BBE%u7F6E%u65B9%u6CD5%u7684%u59D4%u6258%u3002%0A%0A%u5173%u4E8E%u7F13%u5B58%0A%3E%u4F60%u53EF%u80FD%u4F1A%u8BA4%u4E3AProductProxy%u7684%u5B9E%u73B0%u662F%u975E%u5E38%u4F4E%u6548%u7684%u3002%u5728%u6BCF%u4E2A%u8BBF%u95EE%u65B9%u6CD5%u4E2D%uFF0C%u5B83%u90FD%u4F1A%u53BB%u4F7F%u7528%u6570%u636E%u5E93%u3002%u5982%u679C%u5B83%u628AProductData%u6761%u76EE%u8FDB%u884C%u7F13%u5B58%u6765%u907F%u514D%u8BBF%u95EE%u6570%u636E%u5E93%u4E0D%u662F%u4F1A%u66F4%u597D%u4E00%u4E9B%u5417%uFF1F%0A%3E%u867D%u7136%u8FD9%u4E2A%u66F4%u6539%u975E%u5E38%u7B80%u5355%uFF0C%u4F46%u662F%u4FC3%u4F7F%u6211%u4EEC%u8FD9%u6837%u505A%u7684%u60DF%u4E00%u539F%u56E0%u5C31%u662F%u6211%u4EEC%u7684**%u6050%u60E7**%u3002%u6B64%u65F6%20%uFF0C%u8FD8%u6CA1%u6709%u6570%u636E%u663E%u793A%u51FA%u8FD9%u4E2A%u7A0B%u5E8F%u5177%u6709%u6027%u80FD%u95EE%u9898%u3002%u6B64%20%u5916%uFF0C%u6570%u636E%u5E93%u5F15%u64CE%u672C%u8EAB%u4E5F%u4F1A%u505A%u4E00%u4E9B%u7F13%u5B58%u5904%u7406%uFF0C%u6240%u4EE5%u5EFA%u7ACB%u81EA%u5DF1%u7684%u7F13%u5B58%u4F1A%u7ED9%u6211%u4EEC%u5E26%u6765%u4EC0%u4E48%u597D%u5904%u5E76%u4E0D%u660E%u663E%u3002%u5728%u505A%u8FD9%u4E9B%u9EBB%u70E6%u7684%u5DE5%u4F5C%u524D%uFF0C%u6211%u4EEC%u5E94%u8BE5%u7B49%u5F85%uFF0C%u76F4%u5230%u6211%u4EEC%u770B%u5230%u6027%u80FD%u95EE%u9898%u7684%u8FF9%u8C61%u3002%0A%3E%u5982%u679C%u4F60%u62C5%u5FC3%u6027%u80FD%u53EF%u80FD%u662F%u4E2A%u95EE%u9898%uFF0C%u6211%u5EFA%u8BAE%u4F60%u505A%u4E00%u4E9B%u8BD5%u9A8C%u53BB%u8BC1%u660E%u5B83%u786E%u5B9E%u662F%u4E00%u4E2A%u95EE%u9898%u3002**%u5F53%u4E14%u4EC5%u5F53%u5F97%u5230%u8BC1%u5B9E%u65F6**%uFF0C%u4F60%u624D%u5E94%u8BE5%u8003%u8651%u5982%u4F55%u53BB%u63D0%u901F%u3002%0A%0A%23%23%23STAIRWAY%20TO%20HEAVEN%0ASTAIRWAY%20TO%20HEAVEN%u4F7F%u7528%u4E86%u7C7B%u5F62%u5F0F%uFF08class%20form%20%29%u7684%5BADAPTER%5D%28%23adapter%29%u6A21%u5F0F%u7684%u4E00%u4E2A%u53D8%u4F53.%0A%21%5BAlt%20text%7C300x0%5D%28./1480341485379.png%29%0A%u4F20%u8BF4%u4E2D%u7684%u6B7B%u4EA1%u83F1%u5F62%u3002%u5728%u63D0%u5230%u8FD9%u4E2A%u83F1%u5F62%u7684%u65F6%u5019%uFF0C%u6D89%u53CA%u5230%u4E00%u4E2A%u865A%u62DF%u7EE7%u627F%u7684%u6982%u5FF5%uFF0C%u53EF%u4EE5%u53C2%u8003%u8FD9%u7BC7%u6587%u7AE0%uFF1A%5B%u5173%u4E8EC++%u4E2D%u7684%u865A%u62DF%u7EE7%u627F%u7684%u4E00%u4E9B%u603B%u7ED3%5D%28http%3A//www.cnblogs.com/BeyondAnyTime/archive/2012/06/05/2537451.html%29%u3002%0A-%20%u6838%u5FC3%u90E8%u5206%u5C31%u662F%u4E0A%u534A%u90E8%u5206%u7684Product%uFF0CPersistentObject%u548CPersistentProduct%uFF0C%u4E0B%u9762Assembly%u76F8%u5173%u7684%u90E8%u5206%u662F%u5BF9Product%u90E8%u5206%u7684%u6269%u5C55%0A-%20PersistentProduct%u901A%u8FC7Product%u5F97%u5230%u4EA7%u54C1%u903B%u8F91%uFF0C%u901A%u8FC7PersistentObject%u83B7%u5F97%u969C%u788D%uFF08%u6570%u636E%u5E93%uFF0C%u7F51%u7EDC%u7B49%u7B49%uFF09%u64CD%u4F5C%u903B%u8F91%u3002%0A%u5BF9%u6BD4%u770BPROXY%u7684%u9759%u6001%u6A21%u578B%0A%21%5BAlt%20text%7C450x0%5D%28./1480238359796.png%29%0A%u5176%u5B9E%u4E24%u8005%u7684%u6838%u5FC3%u662F%u4E00%u6837%u7684%u3002%u4E0D%u540C%u7684%u662F%uFF0CSTAIRWAY%20TO%20HEAVEN%u7528%u7684%u662F%u7EE7%u627F%uFF0C%u903B%u8F91%u66F4%u52A0%u6E05%u6670%uFF0C%u66F4%u7B26%u5408OO%u89C2%u5FF5%uFF0CPROXY%u4F7F%u7528%u7684%u662F%u59D4%u6258%28%u7EC4%u5408%29%uFF0C%u5728%u5B9E%u73B0%u7684%u65F6%u5019%u5F80%u5F80%u4E0D%u591F%u7B80%u5355%u3002%0A%u4F5C%u8005%u4E5F%u66F4%u63A8%u8350%u7528STAIRWAY%20TO%20HEAVEN%u6765%u9694%u79BB%u4E1A%u52A1%u89C4%u5219%u548C%u969C%u788D%u903B%u8F91%u3002%u4ED6%u552F%u4E00%u7684%u7F3A%u70B9%u5C31%u662F%u9700%u8981%u8BED%u8A00%u652F%u6301%u591A%u91CD%u7EE7%u627F%u3002%0A%0A%23%23%23%u7BA1%u7406%u7B2C%u4E09%u65B9API%0A%u5728%u6211%u4EEC%u521A%u5F00%u59CB%u4F7F%u7528%u7B2C%u4E09%u65B9API%u7684%u65F6%u5019%uFF0C%u5F80%u5F80%u662F%u8FD9%u6837%u7684%uFF1A%0A%21%5BAlt%20text%7C300x0%5D%28./1480342229279.png%29%0A%u7136%u540E%u6211%u4EEC%u60F3%u51FA%u4E00%u4E2A%u9694%u79BB%u5C42%uFF0C%u662F%u8FD9%u6837%u7684%uFF1A%0A%21%5BAlt%20text%7C350x0%5D%28./1480342297651.png%29%0A%u8FD9%u65F6%u5019%u53D1%u73B0%u662F%u6709%u4F20%u9012%u4F9D%u8D56%u5173%u7CFB%u3002%u5982%u679CAPI%u4E00%u53D1%u751F%u53D8%u52A8%uFF08%u4F8B%u5982%uFF1A%u4F20%u5165%u53C2%u6570%u53D8%u4E86%uFF09%uFF0C%u5219Application%u4EE3%u7801%u4E5F%u8981%u8DDF%u7740%u6539%u3002%u6700%u597D%u80FD%u6709%u4E0B%u9762%u8FD9%u6837%u7684%u4F9D%u8D56%u5173%u7CFB%u5012%u7F6E%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1480342394296.png%29%0APROXY%u548CSTAIRWAY%20TO%20HEAVEN%u5C31%u662F%u89E3%u51B3%u8FD9%u4E2A%u95EE%u9898%u7684%3A%0A%21%5BAlt%20text%7C380x0%5D%28./1480342442529.png%29%0A%21%5BAlt%20text%5D%28./177cde61%20f80d%204a54%20ae25%209fc575e6f156.jpg%20%201200%D71080%20.png%29%0A%0A%u4F5C%u8005%u5728%u672C%u7AE0%u6700%u540E%u8FD8%u63D0%u5230%u4E86%u51E0%u4E2A%u64CD%u4F5C%u7B2C%u4E09%u65B9API%u7684%u6A21%u5F0F%uFF1A%0A-%20Extension%20Object%0A-%20VISITOR%0A-%20Decorator%0A-%20%5BFacade%5D%28%23facade%29%0A%0A%u4F5C%u8005%u6700%u540E%u7684%u7ED3%u8BBA%u5F88%u6709%u6307%u5BFC%u610F%u4E49%uFF1A%0A%3E%u8FDC%u5728%u771F%u6B63%u9700%u8981PROXY%u6A21%u5F0F%u6216%u8005STAIRWAY%20TO%20HEAVEN%u6A21%u5F0F%u524D%uFF0C%u5C31%u53BB%u9884%u6D4B%u5BF9%u4E8E%u5B83%u4EEC%u7684%u9700%u8981%u662F%u975E%u5E38%u6709%u8BF1%u60D1%u529B%u7684%u3002%u4F46%u8FD9%u51E0%u4E4E%u4ECE%u6765%u90FD%u4E0D%u662F%u4E00%u4E2A%u597D%u4E3B%u610F%uFF0C%u7279%u522B%u662F%u5BF9%u4E8EPROXY%u6A21%20%u5F0F%u3002%u6211%u5EFA%u8BAE%u5728%u5F00%u59CB%u65F6%u5148%u4F7F%u7528FACADE%u6A21%u5F0F%uFF0C%u7136%u540E%u5728%u5FC5%u8981%u65F6%u8FDB%u884C%u91CD%u6784%u3002%u5982%u679C%u8FD9%u6837%u505A%u7684%u8BDD%uFF0C%u5C31%u4F1A%u4E3A%u81EA%u5DF1%u8282%u7701%u65F6%u95F4%u5E76%u7701%u53BB%u9EBB%u70E6%u3002%0A%0A%u6211%u5728%u505A%u5FAE%u4FE1IoT%u6253%u5370%u5B89%u5353%u7AEF%u5F00%u53D1%u7684%u65F6%u5019%uFF0C%u4E5F%u662F%u8C28%u9075%u4F5C%u8005%u7684%u6559%u8BF2%u3002FACADE%u6A21%u5F0F%u524D%u9762%u6709%u4E13%u95E8%u7684%u7AE0%u8282%u4ECB%u7ECD%u3002%u8FD9%u91CC%u518D%u653E%u4E00%u4E2A%u672C%u7AE0%u7684%u5173%u4E8EFACADE%u7684%u622A%u56FE%u3002%0A%21%5BAlt%20text%7C380x0%5D%28./1480343121833.png%29%0A%u518D%u653E%u4E00%u4E2A%u4E4B%u524D%u7684%u622A%u56FE%u4F5C%u4E3A%u6BD4%u8F83%uFF1A%0A%21%5BAlt%20text%7C450x0%5D%28./1478213659914.png%29%0A%u6240%u8C13%u7684FACADE%u4E5F%u5C31%u662F%u56FE26.6%uFF0C%u6709%u4F20%u9012%u4F9D%u8D56%u7684Layer%u5C42%uFF0C%u5F53%u6211%u4EEC%u53D1%u73B0%u4F20%u9012%u4F9D%u8D56%u5E26%u6765%u95EE%u9898%u7684%u65F6%u5019%uFF0C%u6211%u4EEC%u53EF%u4EE5%u9009%u62E9%u5C06FACADE%u91CD%u6784%u4E3APROXY%u6216%u8005STAIRWAY%20TO%20HEAVEN%u3002%0A%0A%23%2328-30%u7AE0%0A%23%23%23VISITOR%0AVISITOR%u6A21%u5F0F%u662F%u4E00%u4E2A%u5F88%u597D%u7684%u6A21%u5F0F%uFF0C%u4ED6%u53EF%u4EE5%u7ED9%u73B0%u6709%u7684%u6846%u67B6%u6253%u8865%u4E01%u3002%u4F5C%u8005%u7ED9%u7684%u4F8B%u5B50%u662F%u5173%u4E8EModem%u7684%0A%21%5BAlt%20text%7C400x0%5D%28./1482786464781.png%29%0A%u5F53%u6211%u4EEC%u53D1%u73B0Modem%u7684%u884C%u4E3A%u5728Unix%u5E95%u4E0B%u9700%u8981%u4E00%u4E9B%u7279%u522B%u7684%u4EE3%u7801%uFF0C%u4E8E%u662F%u5F80%u63A5%u53E3%u91CC%u5934%u6DFB%u52A0configureForUnix%uFF0C%u7136%u540E%u4FEE%u6539%u4E86%u5404%u4E2A%u6D3E%u751F%u7C7B%u3002%u63A5%u4E0B%u6765%uFF0C%u5982%u679C%u8981%u4E3AWindows%u6DFB%u52A0%u600E%u4E48%u529E%uFF1F%u5982%u679C%u6CA1%u6709VISITOR%uFF0C%u53EA%u80FD%u518D%u4FEE%u6539%u63A5%u53E3%u548C%u5B9A%u4E49%u4E86%u8BE5%u63A5%u53E3%u7684%u7C7B%u3002%u8FD9%u662F%u5F88%u7E41%u7410%u7684%u4E8B%u60C5%0A%u4E0B%u9762%u770BVISITOR%u6A21%u5F0F%u7684%u89E3%u51B3%u65B9%u6CD5%uFF1A%0A%21%5BAlt%20text%7C550x0%5D%28./1482786625185.png%29%0A%u67E5%u770B%u5177%u4F53%u5B9E%u73B0%u4EE3%u7801%u540E%uFF0C%u624D%u771F%u6B63%u7406%u89E3%u4E86%u8FD9%u5E45%u56FE%u7684%u610F%u601D%uFF1A%0A1.%20%u4E00%u6B21%u6B21%u4FEE%u6539%u53D8%u6210%u4E00%u6B21%u6027%u64CD%u4F5C%u3002%u5728Modem%u7684%u63A5%u53E3%u4E2D%u6DFB%u52A0VISITOR%u63A5%u53E3%uFF0C%u5373%u4E0A%u56FE%u4E2D%u7684accept%u3002%0A2.%20%u5F53%u5BA2%u6237%u4EE3%u7801%u8981%u4E3AUnix%u914D%u7F6E%u7684%u65F6%u5019%uFF0C%u8C03%u7528%u5BF9%u5E94%u5B9E%u4F53Modem%u7C7B%u7684accept%u63A5%u53E3%uFF0C%u8BE5%u63A5%u53E3%u4F1A%u8C03%u7528Visitor-%3Evisit%uFF0C%u5E76%u4F20%u5165%u81EA%u8EAB%u4E0A%u4E0B%u6587%0A3.%20%20%u5728visit%u91CC%u9762%u5C31%u53EF%u4EE5%u8C03%u7528%u5404%u4E2AModem%u66B4%u9732%u51FA%u6765%u7684public%u65B9%u6CD5%u4E86%uFF0C%u6CE8%u610F%u4E0D%u662FModem%u63A5%u53E3%u54E6%uFF0C%u662F%u5177%u4F53%u7C7B%u7684public%u65B9%u6CD5%0A4.%20%20%u5982%u679C%u6211%u4EEC%u9700%u8981%u5176%u4ED6%u7684%u8BBF%u95EE%u4EE3%u7801%uFF0C%u6211%u4EEC%u53EF%u4EE5%u52A0%u4E00%u4E2A%u7C7B%uFF0C%u5E76%u5B9A%u4E49ModemVisitor%u63A5%u53E3%u5C31%u53EF%u4EE5%u4E86%u3002%u8FD9%u4E2A%u7C7B%u53EF%u4EE5%u505A%u4EFB%u610F%u60F3%u505A%u7684%u4E8B%u60C5%uFF0C%u4E0D%u5C40%u9650%u4E8EModemConfigurator%0A%0A%u8FD9%u91CC%u8FD8%u5B66%u5230%u4E00%u4E2Ajava%u7684%u5C0F%u77E5%u8BC6%uFF1A%0A%u6211%u4EEC%u77E5%u9053%u6709private%2C%20protected%2C%20public%uFF0C%u5982%u679C%u4E0D%u5199%u9ED8%u8BA4%u662F%u4EC0%u4E48%uFF1F%0A-%20C++%u91CC%u9ED8%u8BA4%u662Fprivate%0A-%20Java%u91CC%u4E0D%u5199%u7684%u8BDD%uFF0C%u8868%u793A%u5305%u7EA7%u8BBF%u95EE%u6743%u9650%uFF0C%u610F%u5373%u53EA%u6709%u540C%u4E00%u4E2A%u5305%u91CC%u7684%u4EE3%u7801%u53EF%u4EE5%u8C03%u7528%u3002%u5982%u679C%u8F6F%u4EF6%u53EA%u6709%u4E00%u4E2A%u5305%uFF0C%u5C31%u7B49%u540C%u4E8Epublic%u3002%u56E0%u4E3AJava%u4E2D%u6CA1%u6709friend%u5173%u952E%u5B57%uFF0C%u8FD9%u4E00%u529F%u80FD%u53EF%u4EE5%u8D77%u5230%u4E00%u90E8%u5206friend%u7684%u4F5C%u7528%u3002%u5176%u5B9E%u4E5F%u5C31%u662FJava%u7684%u4F5C%u8005%u8BA4%u4E3A%uFF0C%u5305%u5185%u7684%u7C7B%u90FD%u662F%u53CB%u5143%u3002%0A%0A%23%23%23ACYCLIC%20VISITOR%u6A21%u5F0F%0Aacyclic%20%u2014%u2014%20%u65E0%u73AF%u7684%uFF0C%u8FD9%u91CC%u6307%u6CA1%u6709%u4F9D%u8D56%u73AF%u3002%0A%0A%23%23%23%23%u4E3A%u4F55%u6709ACYCLIC%u53D8%u4F53%0A%u4F5C%u8005%u5728%u672C%u8282%u4E00%u5F00%u59CB%u7684%u65F6%u5019%u5C31%u4ECB%u7ECD%u4E86%u4E3A%u4EC0%u4E48%u8981%u5728VISITOR%u7684%u57FA%u7840%u4E0A%u5F15%u5165ACYCLIC%u53D8%u4F53%u3002%u4E0D%u8FC7%u6211%u60F3%u4E86%u597D%u4E45%uFF0C%u4E5F%u6CA1%u592A%u7406%u89E3%u3002%u6682%u4E14%u7F57%u5217%u5982%u4E0B%uFF1A%0A%3E%u8BF7%u6CE8%u610F%uFF0C**%u88AB%u8BBF%u95EE%20%28Modem%29%u5C42%u6B21%u7ED3%u6784%u7684%u57FA%u7C7B%u4F9D%u8D56%u4E8E%u8BBF%u95EE%u8005%u5C42%u6B21%u7ED3%u6784%uFF08ModemVisitor%uFF09%u7684%u57FA%u7C7B**%u3002%u540C%u6837%u8BF7%u6CE8%u610F%uFF0C%u8BBF%u95EE%u8005%u5C42%u6B21%u7ED3%u6784%u7684%u57FA%u7C7B%u4E2D%u5BF9%u4E8E%u88AB%u8BBF%u95EE%u5C42%u6B21%u7ED3%u6784%u4E2D%u7684%u6BCF%u4E2A%u6D3E%u751F%u7C7B%u90FD%u6709%u4E00%u4E2A%u5BF9%u5E94%u51FD%u6570%u3002%u56E0%u6B64%uFF0C%u5C31%u6709%u4E00%u4E2A**%u4F9D%u8D56%u73AF**%u628A%u6240%u6709%u88AB%u8BBF%u95EE%u7684%u6D3E%u751F%u7C7B%uFF08%u6240%u6709%u7684%u8C03%u5236%u89E3%u8C03%u5668%uFF09%u7ED1%u5B9A%u5728%u4E00%20%u8D77%u3002%u8FD9%u6837%uFF0C%u5C31%u5F88%u96BE%u5B9E%u73B0%u5BF9%u8BBF%u95EE%u8005%u7ED3%u6784%u7684%u589E%u91CF%u7F16%u8BD1%uFF0C%u5E76%u4E14%u4E5F%u5F88%u96BE%u5411%u88AB%u8BBF%u95EE%u5C42%u6B21%u7ED3%u6784%u4E2D%u589E%u52A0%u65B0%u7684%u6D3E%u751F%u7C7B%u3002%0A%3E%u5982%u679C%u7A0B%u5E8F%u4E2D%u8981%u66F4%u6539%u7684%u5C42%u6B21%u7ED3%u6784%u4E0D%u9700%u8981%u7ECF%u5E38%u5730%u589E%u52A0%u65B0%u7684%u6D3E%u751F%u7C7B%uFF0C%u90A3%u4E48VISITOR%u6A21%u5F0F%u5DE5%u4F5C%u7684%u5F88%u597D%u3002%u5982%u679C%u6211%u4EEC%u5F88%u53EF%u80FD%u53EA%u9700%u8981Hayes%u3001Zoom%u4EE5%u53CAErnie%uFF0C%u6216%u8005%u5F88%u5C11%u4F1A%u53BB%u589E%u52A0%u65B0%u7684Modem%u6D3E%u751F%u7C7B%2C%u90A3%u4E48VISITOR%u6A21%u5F0F%u5C06%u4F1A%u975E%u5E38%u5408%u9002%u3002%0A%3E%u53E6%u4E00%u65B9%u9762%uFF0C%u5982%u679C%u88AB%u8BBF%u95EE%u5C42%u6B21%u7ED3%u6784%u975E%u5E38%u4E0D%u7A33%u5B9A%uFF0C%u7ECF%u5E38%u9700%u8981%u521B%u5EFA%u8BB8%u591A%u65B0%u7684%u6D3E%u751F%u7C7B%uFF0C%u90A3%u4E48%u6BCF%u5F53%u5411%u88AB%u8BBF%u95EE%20%u5C42%u6B21%u7ED3%u6784%u4E2D%u589E%u52A0%u4E00%u4E2A%u65B0%u7684%u6D3E%u751F%u7C7B%u65F6%uFF0C%u5C31%u5FC5%u987B%u8981%u66F4%u6539%u5E76%u4E14%u91CD%u65B0%u7F16%u8BD1VISITOR%u57FA%u7C7B%uFF08%u4E5F%u5C31%u662FModemVisitor%uFF09%u4EE5%u53CA%u5B83%u7684%u6240%u6709%u6D3E%u751F%u7C7B%u3002%u5728C++%u4E2D%uFF0C%u60C5%u51B5%u751A%u81F3%u66F4%u7CDF%u3002%u6BCF%u5F53%u589E%u52A0%u4EFB%u4F55%u4E00%u4E2A%u65B0%u7684%u6D3E%u751F%u7C7B%u65F6%uFF0C%u6574%u4E2A%u88AB%u8BBF%u95EE%u5C42%u6B21%u7ED3%u6784%u5C31%u5FC5%u987B%u8981%u88AB%u91CD%u65B0%u7F16%u8BD1%u3001%u91CD%u65B0%u90E8%u7F72%u3002%0A%0A%u8C08%u4E00%u4E0B%u6211%u7684%u7406%u89E3%u3002%u8FD9%u53EF%u80FD%u548CJava%u7684%u7F16%u8BD1%u8FC7%u7A0B%u6709%u5173%u7CFB%u3002%u5148%u628AVISITOR%u4E2D%u7684%u7C7B%u56FE%u62F7%u8FC7%u6765%uFF1A%0A%21%5BAlt%20text%7C550x0%5D%28./1482786625185.png%29%0A%u9488%u5BF9%u4F9D%u8D56%u5173%u7CFB%uFF0C%u6211%u4E5F%u6536%u5F55%u8FC7%u4E00%u7BC7%u7B14%u8BB0%u2014%u2014%5B23%u79CD%u8BBE%u8BA1%u6A21%u5F0F-%u4F9D%u8D56%u3001%u5173%u8054%u3001%u805A%u5408%u548C%u7EC4%u5408%u4E4B%u95F4%u533A%u522B%u7684%u7406%u89E3%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/f0dd90c0-b3d0-4576-b603-085cb5bf1e48%29%0Aaccept%u7684%u53C2%u6570%u662FModemVisitor%uFF0C%u6240%u4EE5Modem%u4F9D%u8D56%u4E8EModemVisitor%0A%u6240%u4EE5%u4E00%u65E6%u6DFB%u52A0%u65B0Modem%u6D3E%u751F%u7C7B%uFF0C%u5219%0A-%20ModemVisitor%u8981%u6DFB%u52A0%u4E00%u4E2A%u63A5%u53E3%0A-%20%u56E0%u4E3A%u4F9D%u8D56%u5173%u7CFBModem%u8981%u91CD%u65B0%u7F16%u8BD1%0A-%20%u5B9A%u4E49%u4E86Modem%u63A5%u53E3%u7684%u7C7B%u90FD%u8981%u91CD%u65B0%u7F16%u8BD1%0A%0A%u5173%u4E8EC++%u7684%u63CF%u8FF0%uFF1A%0A%3E%u5728C++%u4E2D%uFF0C%u60C5%u51B5%u751A%u81F3%u66F4%u7CDF%u3002%u6BCF%u5F53%u589E%u52A0%u4EFB%u4F55%u4E00%u4E2A%u65B0%u7684%u6D3E%u751F%u7C7B%u65F6%uFF0C%u6574%u4E2A%u88AB%u8BBF%u95EE%u5C42%u6B21%u7ED3%u6784%u5C31%u5FC5%u987B%u8981%u88AB%u91CD%u65B0%u7F16%u8BD1%u3001%u91CD%u65B0%u90E8%u7F72%u3002%0A%0A%u5728C++%u4E2D%uFF0Cinterface%u4E00%u822C%u4F1A%u662F%u4E00%u4E2A%u5934%u6587%u4EF6%uFF0C%u88AB%u6240%u6709%u5B9E%u4F53%u7C7B%u5305%u542B%uFF0C%u4E00%u4E2A%u5934%u6587%u4EF6%u6539%u52A8%uFF0C%u5219%u8BE5%u7C7B%u56FE%u4E2D%u6240%u6709%u7684%u7C7B%u90FD%u4F1A%u9700%u8981%u91CD%u65B0%u7F16%u8BD1%u3002%0A%0A*%u8FD9%u91CC%u53EA%u5F3A%u8C03%u7F16%u8BD1%uFF0C%u94FE%u63A5%u603B%u662F%u90FD%u8981%u91CD%u65B0%u505A%u7684%u3002%0A%0A%23%23%23%23ACYCLIC%20VISITOR%0A%u7406%u89E3%u4E86%u4E3A%u4F55%u8981%u6709ACYCLIC%u53D8%u4F53%u4EE5%u540E%uFF0C%u518D%u770B%u4EC0%u4E48%u662FACYCLIC%20VISITOR%uFF1A%0A%21%5BAlt%20text%5D%28./1482884059208.png%29%0A%u8FD9%u91CC%u53C8%u5B66%u5230%u4E00%u4E2A%u6280%u5DE7%uFF0C%u539F%u6765%u8FD8%u53EF%u4EE5%u5B9A%u4E49%u4E00%u4E2A%u7A7A%u63A5%u53E3%uFF0C%u7136%u540E%u518D%u4F7F%u7528%u7684%u65F6%u5019%u505A%u5F3A%u5236%u7C7B%u578B%u8F6C%u6362%u3002%u611F%u89C9%u5F88%u5DE7%u5999%u3002%u5177%u4F53%u770B%u8FD9%u4E2A%u7C7B%u56FE%uFF1A%0A1.%20%u9488%u5BF9%u6BCF%u4E2AModem%u7C7B%u90FD%u6709%u4E00%u4E2AVisitor%u63A5%u53E3%uFF0C%u6CE8%u610F%u662F**%u63A5%u53E3**%0A2.%20UnixModemConfigurator%u5B9A%u4E49%u4E86%u6240%u6709Modem%u7684Visitor%u63A5%u53E3%uFF0C%u5E76%u4E14%u4E5F%u5B9A%u4E49%u4E86%u90A3%u4E2A%u7A7A%u7684%u63A5%u53E3ModemVisitor%u3002%u8FD9%u6837Modem%u5C31%u53EF%u4EE5%u901A%u8FC7ModemVisitor%u63A5%u53E3%u8BBF%u95EE%u5230UnixModemConfigurator%u4E86%u3002%0A3.%20%u56E0%u4E3AModemVisitor%u662F%u4E00%u4E2A%u7A7A%u63A5%u53E3%uFF08%u9000%u5316%u7684%uFF09%uFF0C%u6240%u4EE5%u4E0D%u7BA1%u6DFB%u52A0%u591A%u5C11Modem%u5B9E%u4F53%u7C7B%uFF0CModemVisitor%u90FD%u4E0D%u7528%u4FEE%u6539%uFF0C%u90A3Modem%u63A5%u53E3%u4E0D%u7528%u8DDF%u7740%u91CD%u65B0%u7F16%u8BD1%u3002%u53EA%u6709%u65B0%u589E%u52A0%u7684Modem%u5B9E%u4F53%u7C7B%u548CUnixModemConfigurator%u4F1A%u88AB%u7F16%u8BD1%u3002%0A%0AACYCLIC%20VISITOR%u5F88%u5DE7%u5999%u5730%u89E3%u51B3%u4E86%u4F9D%u8D56%u73AF%u7684%u95EE%u9898%u3002%u4ED6%u7684%u7F3A%u70B9%u662F%uFF0C%u5728%u5B9E%u4F53Modem%u7C7B%u4E2D%uFF0C%u9700%u8981%u5BF9%u4F20%u5165%u7684ModemVisitor%u63A5%u53E3%u8FDB%u884C%u5F3A%u5236%u7C7B%u578B%u8F6C%u5316%uFF0C%u53D8%u6210%u5BF9%u5E94%u7684Visitor%u63A5%u53E3%u3002%u8FD9%u4F1A%u5BF9%u6267%u884C%u6548%u7387%u5F15%u5165%u4E0D%u786E%u5B9A%u6027%u3002%0A%0A%3E%u66F4%u7CDF%u7CD5%u7684%u662F%uFF0C%u8F6C%u578B%u82B1%u8D39%u7684%u65F6%u95F4%u4F9D%u8D56%u4E8E%u88AB%u8BBF%u95EE%u5C42%u6B21%u7ED3%u6784%u7684%u5BBD%u5EA6%u548C%u6DF1%u5EA6%uFF0C%u6240%u4EE5%u5F88%u96BE%u8FDB%u884C%u6D4B%u5B9A%u3002%u7531%u4E8E%u8F6C%u578B%u9700%u8981%u82B1%u8D39%u5927%u91CF%u7684%u6267%u884C%u65F6%u95F4%uFF0C%u5E76%u4E14%u8FD9%u4E9B%u65F6%u95F4%u662F%u5C0F%u53EF%u9884%u6D4B%u7684%uFF0C%u6240%u4EE5ACYCLIC%20VISITOR%u6A21%u5F0F%u4E0D%u9002%u7528%u4E8E%u4E25%u683C%u7684%u5B9E%u65F6%u7CFB%u7EDF%u3002%0A%3E%u5BF9%u4E8E%u90A3%u4E9B%u88AB%u8BBF%u95EE%u7684%u5C42%u6B21%u7ED3%u6784%u4E0D%u7A33%u5B9A%uFF0C%u5E76%u4E14%u589E%u6688%u7F16%u8BD1%u6BD4%u8F83%u91CD%u8981%u7684%u7CFB%u7EDF%u6765%u8BF4%uFF0C%u8BE5%u6A21%u5F0F%u662F%u4E00%u4E2A%u4E0D%u9519%u7684%u9009%u62E9%20%u3002%0A%0A%23%23%23%23%u4F55%u65F6%u4F7F%u7528VISITOR%u6A21%u5F0F%0A%23%23%23%23%23%u62A5%u8868%u751F%u6210%u5668%0A%21%5BAlt%20text%7C450x0%5D%28./1482965780669.png%29%0A%23%23%23%23%23%u5176%u4ED6%0A%3E%u4E00%u822C%u6765%u8BF4%uFF0C%u5982%u679C%u4E00%u4E2A%u5E94%u7528%u7A0B%u5E8F%u4E2D%u5B58%u5728%u6709%u9700%u8981%u4EE5%u591A%u79CD%u4E0D%u540C%u65B9%u5F0F%u8FDB%u884C%u89E3%u91CA%u7684%u6570%u636E%u7ED3%u6784%uFF0C%u5C31%u53EF%u4EE5%u4F7F%u7528VISITOR%u6A21%u5F0F%u3002%0A%0A%u5176%u5B9E%u5C31%u662F%u5B9E%u73B0%u6570%u636E%u4E0E%u89C6%u56FE%u7684%u5206%u79BB%uFF0C%u7C7B%u4F3CMVC%u7684%u6982%u5FF5%u3002%0A%0A%23%23%23DECORATOR%0A%u6700%u65E9%u63A5%u89E6decorator%u662F%u5728python%u7684@%u8BED%u6CD5%uFF0C%u53C2%u770B%u8FD9%u7BC7%u7B14%u8BB0%5B%u7406%u89E3Python%u4E2D%u7684%u88C5%u9970%u5668%5D%28https%3A//app.yinxiang.com/shard/s10/nl/161681/a0af7764-4908-4c1c-81af-b4a6bf7822da%29%u3002%u90A3%u65F6%u5019%u8FD8%u4E0D%u61C2%u4EC0%u4E48%u8BBE%u8BA1%u6A21%u5F0F%u3002%0A%u6700%u8FD1%u5728%u505AAndroid%u7A0B%u5E8F%u7684JUnit%u4EE3%u7801%u91CC%u4E5F%u6709%u88C5%u9970%u5668%u3002%u53EF%u89C1%u5176%u5E94%u7528%u4E4B%u5E7F%u3002%0A%u73B0%u5728%u5C31%u53EF%u4EE5%u770B%u4E00%u4E0B%u6B63%u89C4%u7684Decorator%u600E%u4E48%u505A%uFF1F%0A%21%5BAlt%20text%7C450x0%5D%28./1482969133162.png%29%0A%u5982%u679C%u6CA1%u6709Decorator%uFF0C%u5219%u8BBE%u7F6E%u97F3%u91CF%u7684%u4EE3%u7801%uFF0C%u5FC5%u987B%u51FA%u73B0%u5728%u62E8%u53F7%u4E4B%u524D%uFF0C%u4E0D%u7BA1%u901A%u8FC7%u4F55%u79CD%u65B9%u5F0F%u3002%u7528Decorator%u4E4B%u540E%uFF0C%u9700%u8981%u8BBE%u7F6E%u97F3%u91CF%u7684%u62E8%u53F7%u4EE3%u7801%uFF0C%u5C31%u53EF%u4EE5%u7528%u76F8%u5E94%u7684Modem%u5BF9%u8C61%u6765%u5B9E%u4F8B%u5316LoudDialModem%u3002LoudDialModem%u4F1A%u5148%u8BBE%u7F6E%u8BE5Modem%u97F3%u91CF%uFF0C%u518D%u5C06%u62E8%u53F7%u529F%u80FD%u59D4%u6258%u7ED9%u5BF9%u5E94%u7684Modem%u5BF9%u8C61%u3002%0A%0ADecorator%u7684%u4E3B%u8981%u4F5C%u7528%u5C31%u662F%u6D88%u9664%u91CD%u590D%u4EE3%u7801%u3002%0A%0A%u5982%u679C%u6709%u591A%u4E2ADecorator%uFF0C%u8981%u6D88%u9664%u59D4%u6258%u4EE3%u7801%u7684%u91CD%u590D%uFF0C%u53EF%u4EE5%u7528%u4E0B%u9762%u7684%u7C7B%u56FE%uFF1A%0A%21%5BAlt%20text%7C400x0%5D%28./1482970521968.png%29%0A%u8FD9%u6837%u6BCF%u6DFB%u52A0%u4E00%u4E2ADecorator%u53EA%u9700%u8981%u4ECEModemDecorator%u7C7B%u6D3E%u751F%u5C31%u53EF%u4EE5%u4E86%u3002%0A%0A%23%23%23EXTENSION%20OBJECT%0A%21%5BAlt%20text%5D%28./1483086640627.png%29%0AEXTENSION%20OBJECT%u662F%u4E00%u4E2A%u5F88%u91CD%u7684%u6A21%u5F0F%uFF0C%u5B9E%u73B0%u8D77%u6765%u6709%u70B9%u5E9E%u5927%uFF0C%u4F46%u662F%u5F88%u597D%u7406%u89E3%u3002%0A-%20Part%u7528HashMap%u7BA1%u7406PartExtension%0A-%20PartExtension%u662F%u4E00%u4E2A%u9000%u5316%u7684%u63A5%u53E3%uFF08%u5373%u65E0%u65B9%u6CD5%u7684%u63A5%u53E3%uFF09%uFF0C%u6240%u4EE5%u4F7F%u7528%u7684%u65F6%u5019%u4F1A%u8981%u505A%u5F3A%u5236%u7C7B%u578B%u8F6C%u6362%0A-%20PartPiece%u548CAssembly%u5728%u6784%u9020%u7684%u65F6%u5019%u6DFB%u52A0%u5BF9%u5E94%u7684extension%20object%uFF0C%u5219%u5728%u9700%u8981%u7684%u65F6%u5019%u53EF%u4EE5get%u51FA%u6765%0A-%20PartPiece%u548CAssembly%u5728extension%u6784%u9020%u7684%u65F6%u5019%uFF0C%u628A%u81EA%u5DF1%u4F20%u7ED9%u8BE5extension%uFF0C%u5219%u5B9E%u73B0%u4E86Visit%u529F%u80FD%u3002%0A%0A%23%23%23%23%u4E3A%u4EC0%u4E48%u8981%u6709EXTENSION%20OBJECT%0AVisitor%u53EF%u4EE5%u5B9E%u73B0%u4E0D%u53BB%u4FEE%u6539%u7C7B%u5C42%u6B21%u7ED3%u6784%u7684%u60C5%u51B5%u4E0B%uFF0C%u5411%u5176%u4E2D%u6DFB%u52A0%u65B0%u529F%u80FD%u3002%u4F46%u662F%u6240%u6709%u7684%u8BBF%u95EE%u529F%u80FD%u90FD%u5728%u4E00%u4E2A%u7C7B%u5F53%u4E2D%uFF0C%u5982%u6211%u4EEC%u4F8B%u5B50%u662F%u5728UnixModemConfigurator%u4E2D%uFF0C%u800C%u4E14%u5BF9%u6BCF%u4E2AModem%u7C7B%u53EA%u6709%u4E00%u4E2Avisit%u51FD%u6570%u3002%0A%u5F53%u6211%u4EEC%u9700%u8981%u9694%u79BB%u5BF9%u5404%u4E2A%u7C7B%u7684%u8BBF%u95EE%u8FDB%u884C%u9694%u79BB%uFF0C%u6216%u8005%u9700%u8981%u5BF9%u4E00%u4E2A%u7C7B%u6709%u4E0D%u540C%u7684%u8BBF%u95EE%u65B9%u5F0F%uFF0CVISITOR%u6A21%u5F0F%u5C31%u505A%u4E0D%u5230%u4E86%u3002%0A%u4E8E%u662F%u6709%u5347%u7EA7%u7248%u7684VISITOR%uFF0C%u4E5F%u5C31%u662FEXTENSION%20OBJECT%u3002%u6BCF%u4E00%u4E2A%u7C7B%u53EF%u4EE5%u6709%u4EFB%u610F%u591A%u7684%u8BBF%u95EE%u65B9%u5F0F%uFF0C%u4E14%u6BCF%u4E2A%u7C7B%u4E4B%u95F4%u7684%u8BBF%u95EE%u548C%u4E0D%u540C%u8BBF%u95EE%u65B9%u5F0F%u4E4B%u95F4%u90FD%u662F%u9694%u79BB%u7684%u3002%u4F8B%u5982%u672C%u4F8B%u4E2D%uFF0C%u6709%u4E24%u4E2A%u88AB%u8BBF%u95EE%u7684%u7C7B%uFF08PartPiece%20%26%20Assembly%uFF09%uFF0C%u6709%u4E24%u79CD%u8BBF%u95EE%u65B9%u5F0F%uFF08XML%20%26%20CSV%uFF09%u3002%u6240%u4EE5%u603B%u5171%u67094%u4E2Aextension%20object%u3002%0A%0A*%u4F5C%u8005%u65F6%u65F6%u5728%u63D0%u9192%u6211%u4EEC%0A-%20%u6240%u6709%u4EE3%u7801%u662F%u4ECE%u6D4B%u8BD5%u7528%u4F8B%u6F14%u5316%u800C%u6765%uFF0C%u6240%u6709%u4EE3%u7801%u90FD%u521A%u597D%u8BA9%u6D4B%u8BD5%u901A%u8FC7%uFF0C%u4E0D%u591A%u4E5F%u4E0D%u5C11%u3002%uFF08%u8FD9%u4E2A%u8282%u594F%u5F88%u96BE%u628A%u63E1%uFF0C%u8FD8%u5728%u5B66%u4E60%u4E2D%uFF09%0A-%20%u4E0D%u8981%u4E3A%u4E86%u6A21%u5F0F%u800C%u6A21%u5F0F%uFF0C%u800C%u662F%u5148%u6709%u4EE3%u7801%uFF0C%u8981%u6D88%u9664%u91CD%u590D%uFF0C%u91CD%u6784%u65F6%u624D%u6162%u6162%u6F14%u5316%u6210%u9002%u5F53%u7684%u6A21%u5F0F%u3002%u800C%u6A21%u5F0F%u5E76%u4E0D%u4E00%u5B9A%u662F%u6807%u51C6%u7684%uFF0C%u6709%u53EF%u80FD%u662F%u7ECF%u8FC7%u4FEE%u6539%u800C%u9002%u5408%u4F7F%u7528%u7684%0A%0A%u770B%u770B%u6700%u4E00%u5F00%u59CB%u7684%u4EE3%u7801%u53EF%u80FD%u662F%u8FD9%u6837%u7684%0A%60%60%60%0Apublic%20PartExtension%20getExtension%28String%20extensionType%29%0A%7B%0A%09if%20%28extensionType.equals%28%22%22XML%22%29%29%0A%09%09return%20new%20XMLPiecePartExtension%28this%29%3B%0A%09else%20if%20%28extensionType.equals%28%22CSV%22%29%29%0A%09%09return%20new%20XMLAssemblyExetnsion%28this%29%3B%0A%09return%20new%20BadPartExtertsion%28%29%3B%0A%7D%0A%60%60%60%0A%0A%23%23%23STATE%0ASTATE%u6A21%u5F0F%u8FD9%u5C31%u662F%u6709%u9650%u72B6%u6001%u673A%u3002%u5176%u5E94%u7528%u76F8%u5F53%u5E7F%u6CDB%u2014%u2014UI%uFF0C%u6570%u636E%u63A5%u53E3%uFF08%u4F8B%u5982control%20panel%u7684%u547D%u4EE4%uFF09%u7B49%u7B49%u3002%u4E0B%u9762%u662F%u5341%u5B57%u8F6C%u95E8%u7684%u72B6%u6001%u8FC1%u79FB%u56FE%u3002%0A%21%5BAlt%20text%5D%28./1483088195524.png%29%0A%u901A%u5E38%u7684%u5B9E%u73B0%u65B9%u6CD5%uFF0C%u6700%u5BB9%u6613%u60F3%u5230%u7684%u5C31%u662Fswitch/case%uFF08%u8FD9%u4E5F%u662F%u76EE%u524Dcontrol%20panel%u4EE3%u7801%u4E2D%u4F7F%u7528%u7684%uFF09%uFF0C%u518D%u9AD8%u7EA7%u4E00%u70B9%u5C31%u662F%u8FC1%u79FB%u8868%uFF0C%u6BCF%u4E2A%u8868%u9879%u5305%u542B%u4E86%u521D%u59CB%u72B6%u6001%uFF0C%u7ED3%u679C%u72B6%u6001%uFF0C%u89E6%u53D1%u4E8B%u4EF6%u548C%u8FC1%u79FB%u52A8%u4F5C%u3002%0A%0A%u770B%u770B%u771F%u6B63%u7684STATE%u6A21%u5F0F%u662F%u600E%u4E48%u5B9E%u73B0%u7684%uFF1A%0A%21%5BAlt%20text%5D%28./1483089394893.png%29%0A-%20TurstyleState%u7684%u6D3E%u751F%u7C7B%uFF0C%u4EE3%u8868%u72B6%u6001%u672C%u8EAB%0A-%20Turnstyle%u4EE3%u8868%u4E86%u6574%u4E2A%u7CFB%u7EDF%uFF0C%u5176%u5305%u542B%u4E86%u6240%u6709%u72B6%u6001%u5BF9%u8C61%uFF0C%u4E5F%u5305%u542B%u4E86%u6240%u6709%u72B6%u6001%u8FC1%u79FB%u65F6%u4EA7%u751F%u7684%u52A8%u4F5C%0A-%20TurstyleState%u7684%u6D3E%u751F%u7C7B%u8D1F%u8D23%u8C03%u7528Turnstyle%u7684%u72B6%u6001%u8FC1%u79FB%u63A5%u53E3%uFF0C%u548C%u8FC1%u79FB%u52A8%u4F5C%u3002%0A%0ASTATE%u6A21%u5F0F%u5F7B%u5E95%u5730%u5206%u79BB%u4E86%u72B6%u6001%u673A%u7684%u903B%u8F91%u548C%u52A8%u4F5C%u3002%u52A8%u4F5C%u662F%u5728Context%u7C7B%u4E2D%u5B9E%u73B0%u7684%uFF0C%u800C%u903B%u8F91%u5219%u662F%u5206%u5E03%u5728STATE%u7C7B%u7684%u6D3E%u751F%u7C7B%u4E2D%u3002%u8FD9%u5C31%u4F7F%u5F97%u4E8C%u8005%u53EF%u4EE5%u975E%u5E38%u5BB9%u6613%u5730%u72EC%u7ACB%u53D8%u5316%u3001%u4E92%u4E0D%u5F71%u54CD%u3002%0A%0A%23%23%23%23STATE%20vs.%20STRATEGY%0A%3E%u5728STATE%u6A21%u5F0F%u4E2D%uFF0C%u6D3E%u751F%u7C7B%u6301%u6709%u56DE%u6307%u5411%u4E0A%u4E0B%u6587%u7C7B%u7684%u5F15%u7528%u3002%u6D3E%u751F%u7C7B%u7684%u4E3B%u8981%u529F%u80FD%u662F%u4F7F%u7528%u8FD9%u4E2A%u5F15%20%u7528%u9009%u62E9%u5E76%u8C03%u7528%u4E0A%u4E0B%u6587%u7C7B%u4E2D%u7684%u65B9%u6CD5%u3002%u5728STRATEGY%u6A21%u5F0F%u4E2D%uFF0C%u4E0D%u5B58%u5728%u8FD9%u6837%u7684%u9650%u5236%u4EE5%u53CA%u610F%u56FE%u3002STRATEGY%u7684%u6D3E%u751F%u7C7B%u4E0D%u5FC5%u6301%u6709%u6307%u5411%u4E0A%u4E0B%u6587%u7C7B%u7684%u5F15%u7528%uFF0C%u5E76%u4E14%u4E5F%u4E0D%u9700%u8981%u53BB%u8C03%u7528%u4E0A%u4E0B%u6587%u7C7B%u7684%u65B9%u6CD5%u3002%u6240%u4EE5%uFF0C%u6240%u6709%u7684STATE%u6A21%u5F0F%u5B9E%u4F8B%u540C%u6837%u4E5F%u662FSTRATEGY%u6A21%u5F0F%u5B9E%u4F8B%uFF0C%u4F46%u662F%u5E76%u975E%u6240%u6709%u7684STRATEGY%u6A21%u5F0F%u5B9E%u4F8B%u90FD%u662FSTATE%u6A21%u5F0F%u5B9E%u4F8B%20%0A%21%5BAlt%20text%5D%28./1483089759732.png%29%0A%0A%23%23%23%23SMC%u2014%u2014%u72B6%u6001%u673A%u7F16%u8BD1%u5668%0A%u8FD9%u662F%u4E00%u4E2A%u4EE3%u7801%u751F%u6210%u5668%u3002%u5728%u524D%u9762%u4ECB%u7ECDSTATE%u6A21%u5F0F%u7684%u65F6%u5019%uFF0C%u4F1A%u53D1%u73B0%uFF0C%u5176%u5B9E%u6700%u6838%u5FC3%u7684%u90E8%u5206%u5C31%u662F%u72B6%u6001%u8FC1%u79FB%u8868%u3002%u8FD9%u6837%u4E00%u7AE0%u8868%u683C%u5176%u5B9E%u5305%u542B%u4E86%u6574%u4E2A%u6709%u9650%u72B6%u6001%u673A%u7CFB%u7EDF%u6240%u6709%u7684%u903B%u8F91%u3002%u800CSMC%u5C31%u662F%u6839%u636E%u8FD9%u6837%u4E00%u5F20%u7C7B%u4F3C%u7684%u8868%u683C%u6765%u751F%u6210STATE%u6A21%u5F0F%u4E2D%u7684%u5404%u4E2A%u7C7B%u3002%0A%21%5BAlt%20text%5D%28./1483186443050.png%29%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A]]></content>
      <tags>
        <tag>软件开发</tag>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android单元测试]]></title>
    <url>%2F2016%2F10%2F19%2FAndroid%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%2F</url>
    <content type="text"><![CDATA[Edit &#x4ECA;&#x65E5;&#x5728;&#x505A;&#x5FAE;&#x4FE1;IoT&#x6253;&#x5370;&#x673A;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x5176;&#x4E2D;&#x6D89;&#x53CA;&#x5230;&#x7528;Android&#x7A0B;&#x5E8F;&#x8BBF;&#x95EE;WPS&#x670D;&#x52A1;&#x6765;&#x5B9E;&#x73B0;&#x5C06;word&#x6587;&#x6863;&#x53E6;&#x5B58;&#x4E3A;PDF&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x79C9;&#x7740;TDD&#x7684;&#x7CBE;&#x795E;&#xFF0C;&#x5F00;&#x59CB;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x5728;Android&#x4E2D;&#x505A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002;&#x5165;&#x95E8;JUnit&#x9996;&#x5148;&#x770B;&#x5230;&#x7684;&#x662F;Android&#x7684;&#x5B98;&#x7F51;&#x6587;&#x6863;Getting Started with Testing, Building Local Unit Tests&#x3002;&#x6709;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x8DD1;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#xFF0C;&#x53EB;Local Unit Test&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x8DD1;&#x5728;&#x76EE;&#x6807;&#x673A;&#x4E0A;&#xFF0C;&#x53EB;Instrumented Unit Test&#x3002; Local Unit Test&#x57FA;&#x4E8E;JUnit&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x5173;&#x4E8E;Local Unit Test&#x7684;&#x94FE;&#x63A5;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5982;&#x4F55;&#x5728;Android Studio&#x4E2D;&#x4F7F;&#x80FD;JUnit&#x7684;&#x8303;&#x4F8B;&#x4E86;&#x3002;&#x914D;&#x7F6E;&#x597D;Dependencies&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;Android Studio&#x4F1A;&#x53BB;maven&#x5E93;&#x4E2D;&#x6293;&#x53D6;JUnit&#x7684;jar&#x5305;&#x5E76;&#x5BFC;&#x5165;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E86;&#x3002; &#x9047;&#x5230;&#x9519;&#x8BEF;Error:(23, 17)&quot;Failed to resolve: junit:junit:4.12&#xFF0C;&#x5728;build.gradle&#x4E0B;&#x9762;&#x52A0;repositories { maven { url &apos;http://repo1.maven.org/maven2&apos; } jcenter { url &quot;http://jcenter.bintray.com/&quot; }}&#x6216;&#x8005;&#x81EA;&#x884C;&#x53BB;&#x4E0B;&#x8F7D;junit-4.12.jar&#xFF0C;&#x518D;&#x653E;&#x5230;libs&#x76EE;&#x5F55;&#x5E95;&#x4E0B;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;Mockito&#x5728;C++&#x4E2D;&#x505A;Unit Test&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6784;&#x5EFA;stub&#xFF0C;&#x6765;&#x9694;&#x79BB;&#x9700;&#x8981;&#x6D4B;&#x8BD5;&#x7684;code&#x3002;&#x5728;Java&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x73B0;&#x6210;&#x7684;&#x6846;&#x67B6;&#x53EF;&#x4EE5;&#x7528;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;Mockito&#x3002;&#x7F51;&#x4E0A;&#x5173;&#x4E8E;Mockito+Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x7684;&#x6587;&#x7AE0;&#x4E00;&#x641C;&#x4E00;&#x5927;&#x645E;&#x3002;&#x6211;&#x4E5F;&#x7B80;&#x5355;&#x7684;&#x6458;&#x5F55;&#x4E86;&#x51E0;&#x4E2A;&#x3002;Android&#x6D4B;&#x8BD5;&#x4E8C;&#xFF1A;Mockito&#x4E0E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;Android &#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E4B;JUnit&#x548C;MockitoAndroid&#x6700;&#x4F73;Mock&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x65B9;&#x6848;:Junit + Mockito + Powermock Mockito&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x6A21;&#x62DF;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x8FBE;&#x5230;&#x9694;&#x79BB;&#x5F85;&#x6D4B;&#x4EE3;&#x7801;&#x7684;&#x76EE;&#x7684;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#x3002;import android.os.classAclass B { public void methodC (){ classA a = new classA(); a.methodA(); }}&#x8BF7;&#x95EE;&#x8FD9;&#x91CC;&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728;methodC&#x4E2D;&#x6A21;&#x62DF;&#x5BF9;&#x8C61;A&#x7684;&#x884C;&#x4E3A;&#x3002;&#x8BF8;&#x5982;&#x6B64;&#x7C7B;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x4F1A;&#x5728;&#x4E0B;&#x9762;&#x4E00;&#x7AE0;&#x8FDB;&#x884C;&#x7F57;&#x5217;&#x3002;&#x4E8E;&#x662F;&#x5728;Google&#x4E4B;&#x4E2D;&#x5C31;&#x77E5;&#x9053;&#x4E86;PowerMock&#x3002;PowerMockPowerMock&#x662F;Mock&#x6846;&#x67B6;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x4ED6;&#x540C;&#x65F6;&#x652F;&#x6301;EasyMock&#x548C;Mockito&#x3002;&#x7F51;&#x4E0A;&#x7684;&#x6587;&#x7AE0;&#x4E5F;&#x662F;&#x5343;&#x5343;&#x4E07;&#xFF0C;&#x5177;&#x4F53;&#x6D4B;&#x8BD5;&#x8BED;&#x53E5;&#x7684;&#x5199;&#x6CD5;&#x4E5F;&#x662F;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x9760;&#x8C31;&#x7684;&#x8FD8;&#x662F;&#x5B98;&#x7F51;&#x3002;PowerMock&#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;&#x6A21;&#x62DF;&#x7684;&#x9014;&#x5F84;&#xFF1A;&#x6A21;&#x62DF;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6A21;&#x62DF;&#x9759;&#x6001;&#x7C7B;&#x7A81;&#x7834;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x63A7;&#x5236;&#xFF0C;&#x64CD;&#x7EB5;&#x79C1;&#x6709;&#x6210;&#x5458;&#xFF0C;&#x79C1;&#x6709;&#x9759;&#x6001;&#x6210;&#x5458;&#x8C03;&#x7528;&#x79C1;&#x6709;&#x65B9;&#x6CD5;&#x3002;&#x8FDB;&#x9636;&#x5728;&#x5B9E;&#x9645;&#x7684;&#x7F16;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x9047;&#x5230;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;Google&#x4E86;&#x5F88;&#x4E45;&#xFF0C;&#x73B0;&#x5C06;&#x6240;&#x6709;&#x95EE;&#x9898;&#x4EE5;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7F57;&#x5217;&#x4E00;&#x4E0B;&#xFF1A;&#x5BF9;static&#x65B9;&#x6CD5;&#x7684;&#x6A21;&#x62DF;Looper mockLooper = mock(Looper.class);PowerMockito.mockStatic(Looper.class);PowerMockito.when(Looper.class, &quot;getMainLooper&quot;).thenReturn(mockLooper);&#x5BF9;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x6A21;&#x62DF;&#x89E3;&#x51B3;&#x4E0A;&#x4E00;&#x7AE0;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6A21;&#x62DF;classA&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6765;&#x89E3;&#x51B3;&#xFF0C;&#x540C;&#x6837;&#x662F;&#x7528;&#x5230;PowerMockitoPowerMockito.whenNew(Intent.class).withNoArguments().thenReturn(mockIntent);PowerMockito.whenNew(Intent.class).withArguments(anyString()).thenReturn(mockIntent);&#x9488;&#x5BF9;&#x6709;&#x53C2;&#x6570;&#x548C;&#x6CA1;&#x6709;&#x53C2;&#x6570;&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x64CD;&#x4F5C;private&#x6210;&#x5458;// &#x64CD;&#x4F5C;&#x79C1;&#x6709;&#x975E;&#x9759;&#x6001;&#x6210;&#x5458;Whitebox.setInternalState(mockObj, &quot;mPrivateStaticVariable&quot;, value);Whitebox.getInternalState(mockObj, &quot;mPrivateStaticVariable&quot;);// &#x64CD;&#x4F5C;&#x79C1;&#x6709;&#x9759;&#x6001;&#x6210;&#x5458;Whitebox.setInternalState(xxx.class, &quot;mPrivateStaticVariable&quot;, value, xxx.class);Whitebox.getInternalState(xxx.class, &quot;mPrivateStaticVariable&quot;, xxx.class);&#x5C40;&#x90E8;&#x6A21;&#x62DF;&#x8FD9;&#x4E2A;&#x4F1A;&#x7528;&#x5230;Mockito&#x4E2D;&#x7684;spy&#x5173;&#x952E;&#x5B57;&#x3002;&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x5265;&#x79BB;&#x9700;&#x8981;&#x6A21;&#x62DF;&#x7684;&#x7C7B;&#x548C;&#x5F85;&#x6D4B;&#x8BD5;&#x7684;&#x7C7B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5B9E;&#x9645;&#x4E2D;&#x7528;&#x5230;&#x7684;&#x4E0B;&#x9762;&#x7684;&#x7C7B;&#xFF1A;public class ConverterFacade extends Service{ private void bindOfficeService(){ if (bindService(intent, connection, BIND_AUTO_CREATE)) { ... } }}ConverterFacade&#x7EE7;&#x627F;&#x81EA;Android&#x81EA;&#x6709;&#x7684;&#x7C7B;Service&#xFF0C;Service&#x7EE7;&#x627F;&#x81EA;Context&#xFF0C;bindService&#x662F;Context&#x63A5;&#x53E3;&#x7684;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x5BF9;&#x4E4B;&#x8FDB;&#x884C;mock&#xFF0C;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x62A5;&#x9519;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8981;&#x6D4B;&#x8BD5;ConverterFacade&#xFF0C;&#x53C8;&#x4E0D;&#x80FD;&#x5C06;&#x4E4B;mock&#x6389;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x9000;&#x800C;&#x6C42;&#x5176;&#x6B21;&#xFF0C;&#x91C7;&#x7528;partial mock&#x3002;&#x63D2;&#x5165;&#x5B98;&#x7F51;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;Mockito.spy&#x3002;&#x5B98;&#x65B9;&#x5E76;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;spy&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;&#x6A21;&#x62DF;&#x7684;code&#x548C;&#x771F;&#x5B9E;&#x7684;code&#x6DF7;&#x5728;&#x4E00;&#x8D77;&#x3002;Real spies should be used carefully and occasionally. &#x4F8B;&#x5B50;&#xFF1A; List list = new LinkedList(); List spy = spy(list); //optionally, you can stub out some methods: when(spy.size()).thenReturn(100); //using the spy calls real methods spy.add(&quot;one&quot;); spy.add(&quot;two&quot;); //prints &quot;one&quot; - the first element of a list System.out.println(spy.get(0)); //size() method was stubbed - 100 is printed System.out.println(spy.size()); //optionally, you can verify verify(spy).add(&quot;one&quot;); verify(spy).add(&quot;two&quot;);&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;doReturn().when()&#x800C;&#x4E0D;&#x80FD;&#x7528;when().doReturn() //Impossible: real method is called so spy.get(0) throws IndexOutOfBoundsException (the list is yet empty)when(spy.get(0)).thenReturn(&quot;foo&quot;);//You have to use doReturn() for stubbingdoReturn(&quot;foo&quot;).when(spy).get(0);java.lang.NoClassDefFoundError&#x9047;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x6CA1;&#x6709;&#x5BFC;&#x5165;moffice-service-base&#x5305;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x5F04;&#x597D;&#x5C31;&#x884C;&#x4E86;java.lang.ClassNotFoundException This exception indicates that the class was not found on the classpath. This indicates that we were trying to load the class definition, and the class did not exist on the classpath. java.lang.NoClassDefFoundError This exception indicates that the JVM looked in its internal class definition data structure for the definition of a class and did not find it. This is different than saying that it could not be loaded from the classpath. Usually this indicates that we previously attempted to load a class from the classpath, but it failed for some reason - now we&#x2019;re trying to use the class again (and thus need to load it, since it failed last time), but we&#x2019;re not even going to try to load it, because we failed loading it earlier (and reasonably suspect that we would fail again). The earlier failure could be a ClassNotFoundException or an ExceptionInInitializerError (indicating a failure in the static initialization block) or any number of other problems. The point is, a NoClassDefFoundError is not necessarily a classpath problem.mockStatic&#x5BFC;&#x81F4;&#x5185;&#x90E8;&#x7C7B;&#x65E0;&#x6CD5;&#x6709;&#x6548;&#x5F15;&#x7528;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x6210;&#x5458;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x662F;&#xFF0C;&#x4E0D;&#x8981;mockStatic(ConverterFacade.class);&#x8981;mockStatic(ConverterFacade.class, CALLS_REAL_METHODS);&#x6355;&#x83B7;&#x53C2;&#x6570;Message m = mock(Message.class);m.what = 1;Handler mHandler = mock(Handler.class);mHandler.sendMessage(m);m.what = 2;mHandler.sendMessage(m);ArgumentCaptor&lt;Message&gt; argumentCaptor2 = ArgumentCaptor.forClass(Message.class);verify(mHandler, times(2)).sendMessage(argumentCaptor2.capture());List&lt;Message&gt; msgList = argumentCaptor2.getAllValues();ArgumentCaptor&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6355;&#x83B7;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x60C5;&#x51B5;&#x3002;argumentCaptor.getValue()&#x53EF;&#x4EE5;&#x6355;&#x83B7;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF0C;argumentCaptor.getAllValues()&#x53EF;&#x4EE5;&#x6355;&#x83B7;&#x591A;&#x6B21;&#x8C03;&#x7528;&#x6216;&#x8005;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x4F20;&#x9012;&#x591A;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x3002; &#x8FD9;&#x5176;&#x4E2D;&#x7275;&#x6D89;&#x5230;Java&#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5982;&#x4E0A;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#xFF0C;&#x867D;&#x7136;&#x6700;&#x7EC8;&#x5F97;&#x5230;&#x7684;List&#x7684;size&#x662F;2&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;&#x8868;&#x9879;&#x7684;what&#x503C;&#x90FD;&#x6307;&#x5411;2&#xFF0C;&#x7528;Android Studio&#x67E5;&#x770B;&#x5BF9;&#x8C61;&#x5730;&#x5740;&#xFF0C;&#x53D1;&#x73B0;&#x8FD9;&#x4FE9;&#x90FD;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x503C;&#x76F8;&#x540C;&#x4E5F;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x5982;&#x679C;&#x60F3;&#x8981;&#x6355;&#x83B7;&#x5230;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x503C;&#xFF0C;&#x5C31;&#x8981;new&#x4E24;&#x6B21;&#x3002;%23Android%u5355%u5143%u6D4B%u8BD5%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5BAndroid%2C%20unittest%2C%20mockito%2C%20powermock%5D%0A%u4ECA%u65E5%u5728%u505A%u5FAE%u4FE1IoT%u6253%u5370%u673A%u7684%u9879%u76EE%uFF0C%u5176%u4E2D%u6D89%u53CA%u5230%u7528Android%u7A0B%u5E8F%u8BBF%u95EEWPS%u670D%u52A1%u6765%u5B9E%u73B0%u5C06word%u6587%u6863%u53E6%u5B58%u4E3APDF%u7684%u529F%u80FD%u3002%u4E8E%u662F%uFF0C%u79C9%u7740TDD%u7684%u7CBE%u795E%uFF0C%u5F00%u59CB%u5B66%u4E60%u5982%u4F55%u5728Android%u4E2D%u505A%u5355%u5143%u6D4B%u8BD5%u3002%0A%23%23%u5165%u95E8%0A%23%23%23JUnit%0A%u9996%u5148%u770B%u5230%u7684%u662FAndroid%u7684%u5B98%u7F51%u6587%u6863%5BGetting%20Started%20with%20Testing%5D%28https%3A//developer.android.com/training/testing/start/index.html%29%2C%20%5BBuilding%20Local%20Unit%20Tests%5D%28https%3A//developer.android.com/training/testing/unit-testing/local-unit-tests.html%29%u3002%u6709%u4E24%u79CD%u7C7B%u578B%u7684%u6D4B%u8BD5%uFF0C%u4E00%u79CD%u662F%u8DD1%u5728%u4E3B%u673A%u4E0A%u7684%uFF0C%u53EBLocal%20Unit%20Test%uFF0C%u53E6%u4E00%u79CD%u8DD1%u5728%u76EE%u6807%u673A%u4E0A%uFF0C%u53EBInstrumented%20Unit%20Test%u3002%0ALocal%20Unit%20Test%u57FA%u4E8EJUnit%uFF0C%u4E0A%u9762%u7684%u5173%u4E8ELocal%20Unit%20Test%u7684%u94FE%u63A5%u5DF2%u7ECF%u6709%u4E86%u5982%u4F55%u5728Android%20Studio%u4E2D%u4F7F%u80FDJUnit%u7684%u8303%u4F8B%u4E86%u3002%u914D%u7F6E%u597DDependencies%u5C31%u53EF%u4EE5%u4E86%u3002Android%20Studio%u4F1A%u53BBmaven%u5E93%u4E2D%u6293%u53D6JUnit%u7684jar%u5305%u5E76%u5BFC%u5165%u5230%u9879%u76EE%u4E2D%uFF0C%u4E4B%u540E%u5C31%u53EF%u4EE5%u4F7F%u7528%u4E86%u3002%0A%u9047%u5230%u9519%u8BEF%60Error%3A%2823%2C%2017%29%22Failed%20to%20resolve%3A%20junit%3Ajunit%3A4.12%60%uFF0C%u5728build.gradle%u4E0B%u9762%u52A0%0A%60%60%60%0Arepositories%20%7B%0A%20%20%20%20%20%20%20%20maven%20%7B%20url%20%27http%3A//repo1.maven.org/maven2%27%20%7D%0A%20%20%20%20%20%20%20%20jcenter%20%7B%20url%20%22http%3A//jcenter.bintray.com/%22%20%7D%0A%7D%0A%60%60%60%0A%u6216%u8005%u81EA%u884C%u53BB%u4E0B%u8F7Djunit-4.12.jar%uFF0C%u518D%u653E%u5230libs%u76EE%u5F55%u5E95%u4E0B%u5C31%u53EF%u4EE5%u4E86%u3002%0A%0A%23%23%23Mockito%0A%u5728C++%u4E2D%u505AUnit%20Test%u7684%u65F6%u5019%uFF0C%u6211%u4EEC%u5F80%u5F80%u9700%u8981%u81EA%u5DF1%u6784%u5EFAstub%uFF0C%u6765%u9694%u79BB%u9700%u8981%u6D4B%u8BD5%u7684code%u3002%u5728Java%u4E2D%uFF0C%u6211%u4EEC%u6709%u73B0%u6210%u7684%u6846%u67B6%u53EF%u4EE5%u7528%uFF0C%u8FD9%u5C31%u662F%5BMockito%5D%28https%3A//github.com/mockito/mockito%29%u3002%u7F51%u4E0A%u5173%u4E8EMockito+Android%u5355%u5143%u6D4B%u8BD5%u7684%u6587%u7AE0%u4E00%u641C%u4E00%u5927%u645E%u3002%u6211%u4E5F%u7B80%u5355%u7684%u6458%u5F55%u4E86%u51E0%u4E2A%u3002%0A-%20%5BAndroid%u6D4B%u8BD5%u4E8C%uFF1AMockito%u4E0E%u5355%u5143%u6D4B%u8BD5%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/360fa827-de1f-46e7-b815-465c074a5b9e%29%0A-%20%5BAndroid%20%u5355%u5143%u6D4B%u8BD5%u4E4BJUnit%u548CMockito%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/beaaf776-621e-4fdb-9dca-e6eedc6a1029%29%0A-%20%5BAndroid%u6700%u4F73Mock%u5355%u5143%u6D4B%u8BD5%u65B9%u6848%3AJunit%20+%20Mockito%20+%20Powermock%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/78565e6e-82eb-4f74-80c8-177863a6499c%29%0AMockito%u7684%u4E3B%u8981%u4F5C%u7528%u5C31%u662F%u6A21%u62DF%u5916%u90E8%u7C7B%u7684%u884C%u4E3A%uFF0C%u8FBE%u5230%u9694%u79BB%u5F85%u6D4B%u4EE3%u7801%u7684%u76EE%u7684%u3002%u5982%u4E0B%u56FE%u3002%0A%21%5BAlt%20text%5D%28./1476833497231.png%29%0A%u5728Android%u7684%u6D4B%u8BD5%u4E2D%uFF0CMockito%u7684%u4E3B%u8981%u4F5C%u7528%u5C31%u662F%u6A21%u62DF%u6240%u6709Android%u7684%u7C7B%u3002%60ClassA%20mockObj%20%3D%20mock%28ClassA%29%60%u5C31%u4F1A%u751F%u6210%u4E00%u4E2Amock%u7684%u5BF9%u8C61%u3002%u7136%u540E%u6211%u4EEC%u5C31%u53EF%u4EE5%u901A%u8FC7Mockito%u63D0%u4F9B%u7684%u5404%u79CD%u624B%u6BB5%u6765%u5B9A%u5236%u8FD9%u4E2A%u5BF9%u8C61%u7684%u5404%u79CD%u884C%u4E3A%u3002%u4F46%u8FD9%u6709%u5F88%u5927%u7684%u5C40%u9650%u6027%u3002%u770B%u4E0B%u9762%u7684%u4EE3%u7801%0A%60%60%60%0Aimport%20android.os.classA%0Aclass%20B%20%7B%0A%09public%20void%20methodC%20%28%29%7B%0A%09%09classA%20a%20%3D%20new%20classA%28%29%3B%0A%09%09a.methodA%28%29%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u8BF7%u95EE%u8FD9%u91CC%u6211%u8981%u600E%u4E48%u5728methodC%u4E2D%u6A21%u62DF%u5BF9%u8C61A%u7684%u884C%u4E3A%u3002%u8BF8%u5982%u6B64%u7C7B%u5F88%u591A%u95EE%u9898%uFF0C%u4F1A%u5728%u4E0B%u9762%u4E00%u7AE0%u8FDB%u884C%u7F57%u5217%u3002%u4E8E%u662F%u5728Google%u4E4B%u4E2D%u5C31%u77E5%u9053%u4E86PowerMock%u3002%0A%0A%23%23%23PowerMock%0APowerMock%u662FMock%u6846%u67B6%u7684%u6269%u5C55%uFF0C%u4ED6%u540C%u65F6%u652F%u6301EasyMock%u548CMockito%u3002%u7F51%u4E0A%u7684%u6587%u7AE0%u4E5F%u662F%u5343%u5343%u4E07%uFF0C%u5177%u4F53%u6D4B%u8BD5%u8BED%u53E5%u7684%u5199%u6CD5%u4E5F%u662F%u5404%u4E0D%u76F8%u540C%uFF0C%u6240%u4EE5%u6700%u9760%u8C31%u7684%u8FD8%u662F%5B%u5B98%u7F51%5D%28https%3A//github.com/jayway/powermock%29%u3002PowerMock%u63D0%u4F9B%u4E86%u4EE5%u4E0B%u6A21%u62DF%u7684%u9014%u5F84%uFF1A%0A-%20%u6A21%u62DF%u6784%u9020%u51FD%u6570%0A-%20%u6A21%u62DF%u9759%u6001%u7C7B%0A-%20%u7A81%u7834%u8BBF%u95EE%u6743%u9650%u63A7%u5236%uFF0C%u64CD%u7EB5%u79C1%u6709%u6210%u5458%uFF0C%u79C1%u6709%u9759%u6001%u6210%u5458%0A-%20%u8C03%u7528%u79C1%u6709%u65B9%u6CD5%u3002%0A%0A%23%23%u8FDB%u9636%0A%u5728%u5B9E%u9645%u7684%u7F16%u7801%u8FC7%u7A0B%u4E2D%uFF0C%u9047%u5230%u5F88%u591A%u95EE%u9898%uFF0CGoogle%u4E86%u5F88%u4E45%uFF0C%u73B0%u5C06%u6240%u6709%u95EE%u9898%u4EE5%u53CA%u89E3%u51B3%u65B9%u6848%u7F57%u5217%u4E00%u4E0B%uFF1A%0A%23%23%23%20%u5BF9static%u65B9%u6CD5%u7684%u6A21%u62DF%0A%60%60%60%0ALooper%20mockLooper%20%3D%20mock%28Looper.class%29%3B%0APowerMockito.mockStatic%28Looper.class%29%3B%0APowerMockito.when%28Looper.class%2C%20%22getMainLooper%22%29.thenReturn%28mockLooper%29%3B%0A%60%60%60%0A%0A%23%23%23%u5BF9%u6784%u9020%u51FD%u6570%u7684%u6A21%u62DF%0A%u89E3%u51B3%u4E0A%u4E00%u7AE0%u63D0%u5230%u7684%u95EE%u9898%uFF0C%u53EF%u4EE5%u7528%u6A21%u62DFclassA%u7684%u6784%u9020%u51FD%u6570%u6765%u89E3%u51B3%uFF0C%u540C%u6837%u662F%u7528%u5230PowerMockito%0A%60%60%60%0APowerMockito.whenNew%28Intent.class%29.withNoArguments%28%29.thenReturn%28mockIntent%29%3B%0APowerMockito.whenNew%28Intent.class%29.withArguments%28anyString%28%29%29.thenReturn%28mockIntent%29%3B%0A%60%60%60%0A%u9488%u5BF9%u6709%u53C2%u6570%u548C%u6CA1%u6709%u53C2%u6570%u7684%u4E24%u79CD%u60C5%u51B5%0A%0A%23%23%23%u64CD%u4F5Cprivate%u6210%u5458%0A%60%60%60%0A//%20%u64CD%u4F5C%u79C1%u6709%u975E%u9759%u6001%u6210%u5458%0AWhitebox.setInternalState%28mockObj%2C%20%22mPrivateStaticVariable%22%2C%20value%29%3B%0AWhitebox.getInternalState%28mockObj%2C%20%22mPrivateStaticVariable%22%29%3B%0A%0A//%20%u64CD%u4F5C%u79C1%u6709%u9759%u6001%u6210%u5458%0AWhitebox.setInternalState%28xxx.class%2C%20%22mPrivateStaticVariable%22%2C%20value%2C%20xxx.class%29%3B%0AWhitebox.getInternalState%28xxx.class%2C%20%22mPrivateStaticVariable%22%2C%20xxx.class%29%3B%0A%60%60%60%0A%0A%23%23%23%u5C40%u90E8%u6A21%u62DF%0A%u8FD9%u4E2A%u4F1A%u7528%u5230Mockito%u4E2D%u7684spy%u5173%u952E%u5B57%u3002%u5728%u5F88%u591A%u60C5%u51B5%u4E0B%uFF0C%u6211%u4EEC%u65E0%u6CD5%u5265%u79BB%u9700%u8981%u6A21%u62DF%u7684%u7C7B%u548C%u5F85%u6D4B%u8BD5%u7684%u7C7B%u3002%u4F8B%u5982%uFF0C%u5B9E%u9645%u4E2D%u7528%u5230%u7684%u4E0B%u9762%u7684%u7C7B%uFF1A%0A%60%60%60%0Apublic%20class%20ConverterFacade%20extends%20Service%7B%0A%09private%20void%20bindOfficeService%28%29%7B%0A%09%09if%20%28bindService%28intent%2C%20connection%2C%20BIND_AUTO_CREATE%29%29%20%7B%0A%09%09%09...%0A%09%09%7D%0A%09%7D%0A%7D%0A%60%60%60%0AConverterFacade%u7EE7%u627F%u81EAAndroid%u81EA%u6709%u7684%u7C7BService%uFF0CService%u7EE7%u627F%u81EAContext%uFF0CbindService%u662FContext%u63A5%u53E3%u7684%u4E00%u4E2A%u65B9%u6CD5%u3002%u5982%u679C%u4E0D%u5BF9%u4E4B%u8FDB%u884Cmock%uFF0C%u6D4B%u8BD5%u7684%u65F6%u5019%u4F1A%u62A5%u9519%u3002%u56E0%u4E3A%u6211%u4EEC%u8981%u6D4B%u8BD5ConverterFacade%uFF0C%u53C8%u4E0D%u80FD%u5C06%u4E4Bmock%u6389%uFF0C%u6240%u4EE5%u53EA%u80FD%u9000%u800C%u6C42%u5176%u6B21%uFF0C%u91C7%u7528partial%20mock%u3002%u63D2%u5165%u5B98%u7F51%u7684%u4ECB%u7ECD%uFF0C%5BMockito.spy%5D%28http%3A//site.mockito.org/mockito/docs/current/org/mockito/Mockito.html%23spy%28T%29%29%u3002%u5B98%u65B9%u5E76%u4E0D%u63A8%u8350%u4F7F%u7528spy%uFF0C%u56E0%u4E3A%u8FD9%u6837%u4F1A%u8BA9%u6A21%u62DF%u7684code%u548C%u771F%u5B9E%u7684code%u6DF7%u5728%u4E00%u8D77%u3002%0A%3E%20Real%20spies%20should%20be%20used%20**carefully%20and%20occasionally**.%0A%u4F8B%u5B50%uFF1A%0A%60%60%60%0A%20%20%20List%20list%20%3D%20new%20LinkedList%28%29%3B%0A%20%20%20List%20spy%20%3D%20spy%28list%29%3B%0A%0A%20%20%20//optionally%2C%20you%20can%20stub%20out%20some%20methods%3A%0A%20%20%20when%28spy.size%28%29%29.thenReturn%28100%29%3B%0A%0A%20%20%20//using%20the%20spy%20calls%20real%20methods%0A%20%20%20spy.add%28%22one%22%29%3B%0A%20%20%20spy.add%28%22two%22%29%3B%0A%0A%20%20%20//prints%20%22one%22%20-%20the%20first%20element%20of%20a%20list%0A%20%20%20System.out.println%28spy.get%280%29%29%3B%0A%0A%20%20%20//size%28%29%20method%20was%20stubbed%20-%20100%20is%20printed%0A%20%20%20System.out.println%28spy.size%28%29%29%3B%0A%0A%20%20%20//optionally%2C%20you%20can%20verify%0A%20%20%20verify%28spy%29.add%28%22one%22%29%3B%0A%20%20%20verify%28spy%29.add%28%22two%22%29%3B%0A%60%60%60%0A%u4E3A%u4EC0%u4E48%u8981%u7528%60doReturn%28%29.when%28%29%60%u800C%u4E0D%u80FD%u7528%60when%28%29.doReturn%28%29%60%0A%60%60%60%0A%20//Impossible%3A%20real%20method%20is%20called%20so%20spy.get%280%29%20throws%20IndexOutOfBoundsException%20%28the%20list%20is%20yet%20empty%29%0Awhen%28spy.get%280%29%29.thenReturn%28%22foo%22%29%3B%0A%0A//You%20have%20to%20use%20doReturn%28%29%20for%20stubbing%0AdoReturn%28%22foo%22%29.when%28spy%29.get%280%29%3B%0A%60%60%60%0A%0A%23%23%23java.lang.NoClassDefFoundError%0A%u9047%u5230%u4E86%u8FD9%u4E2A%u95EE%u9898%uFF0C%u539F%u56E0%u662F%u6CA1%u6709%u5BFC%u5165moffice-service-base%u5305%u3002%u5728%u8FD9%u91CC%u5F04%u597D%u5C31%u884C%u4E86%0A%21%5BAlt%20text%5D%28./1476841513603.png%29%0A%u4E0D%u8FC7%u521A%u770B%u5230%u8FD9%u4E2Aexception%u7684%u65F6%u5019%uFF0C%u4E5F%u633A%u552C%u4EBA%u7684%u3002%u5728StackOverflow%u4E0A%u641C%u5230%u4E86%u8FD9%u4E2A%u5E16%u5B50%uFF0C%u4E5F%u7B97%u662F%u5BF9%u8FD9%u4E2A%u9519%u8BEF%u7684%u4E00%u4E2A%u5C0F%u5C0F%u7684%u5165%u95E8%uFF1A%0A%3E%20**java.lang.ClassNotFoundException**%0A%3E%20This%20exception%20indicates%20that%20the%20class%20was%20not%20found%20on%20the%20classpath.%20This%20indicates%20that%20we%20were%20trying%20to%20load%20the%20class%20definition%2C%20and%20the%20class%20did%20not%20exist%20on%20the%20classpath.%0A%3E**java.lang.NoClassDefFoundError**%0A%3EThis%20exception%20indicates%20that%20the%20JVM%20looked%20in%20its%20internal%20class%20definition%20data%20structure%20for%20the%20definition%20of%20a%20class%20and%20did%20not%20find%20it.%20This%20is%20different%20than%20saying%20that%20it%20could%20not%20be%20loaded%20from%20the%20classpath.%20Usually%20this%20indicates%20that%20we%20previously%20attempted%20to%20load%20a%20class%20from%20the%20classpath%2C%20but%20it%20failed%20for%20some%20reason%20-%20now%20we%27re%20trying%20to%20use%20the%20class%20again%20%28and%20thus%20need%20to%20load%20it%2C%20since%20it%20failed%20last%20time%29%2C%20but%20we%27re%20not%20even%20going%20to%20try%20to%20load%20it%2C%20because%20we%20failed%20loading%20it%20earlier%20%28and%20reasonably%20suspect%20that%20we%20would%20fail%20again%29.%20The%20earlier%20failure%20could%20be%20a%20ClassNotFoundException%20or%20an%20ExceptionInInitializerError%20%28indicating%20a%20failure%20in%20the%20static%20initialization%20block%29%20or%20any%20number%20of%20other%20problems.%20The%20point%20is%2C%20a%20NoClassDefFoundError%20is%20not%20necessarily%20a%20classpath%20problem.%0A%0A%23%23%23mockStatic%u5BFC%u81F4%u5185%u90E8%u7C7B%u65E0%u6CD5%u6709%u6548%u5F15%u7528%u5916%u90E8%u7C7B%u7684%u6210%u5458%0A%u89E3%u51B3%u65B9%u6CD5%u662F%uFF0C%u4E0D%u8981%60mockStatic%28ConverterFacade.class%29%3B%60%u8981%60mockStatic%28ConverterFacade.class%2C%20CALLS_REAL_METHODS%29%3B%60%0A%0A%23%23%23%u6355%u83B7%u53C2%u6570%0A%60%60%60%0AMessage%20m%20%3D%20mock%28Message.class%29%3B%0Am.what%20%3D%201%3B%0AHandler%20mHandler%20%3D%20mock%28Handler.class%29%3B%0AmHandler.sendMessage%28m%29%3B%0A%0Am.what%20%3D%202%3B%0AmHandler.sendMessage%28m%29%3B%0A%0AArgumentCaptor%3CMessage%3E%20argumentCaptor2%20%3D%20ArgumentCaptor.forClass%28Message.class%29%3B%0Averify%28mHandler%2C%20times%282%29%29.sendMessage%28argumentCaptor2.capture%28%29%29%3B%0AList%3CMessage%3E%20msgList%20%3D%20argumentCaptor2.getAllValues%28%29%3B%0A%60%60%60%0AArgumentCaptor%u53EF%u4EE5%u5E2E%u52A9%u6355%u83B7%u53C2%u6570%u8C03%u7528%u60C5%u51B5%u3002%60argumentCaptor.getValue%28%29%60%u53EF%u4EE5%u6355%u83B7%u6700%u540E%u4E00%u6B21%u8C03%u7528%u7684%u53C2%u6570%uFF0C%60argumentCaptor.getAllValues%28%29%60%u53EF%u4EE5%u6355%u83B7%u591A%u6B21%u8C03%u7528%u6216%u8005%u4E00%u6B21%u8C03%u7528%u4F20%u9012%u591A%u4E2A%u53C2%u6570%u7684%u60C5%u51B5%u3002%0A%u8FD9%u5176%u4E2D%u7275%u6D89%u5230Java%u5BF9%u8C61%u4F20%u9012%u7684%u65B9%u6CD5%u3002%u5982%u4E0A%u7A0B%u5E8F%u4EE3%u7801%uFF0C%u867D%u7136%u6700%u7EC8%u5F97%u5230%u7684List%u7684size%u662F2%uFF0C%u4F46%u662F%u8FD9%u4E24%u4E2A%u8868%u9879%u7684what%u503C%u90FD%u6307%u54112%uFF0C%u7528Android%20Studio%u67E5%u770B%u5BF9%u8C61%u5730%u5740%uFF0C%u53D1%u73B0%u8FD9%u4FE9%u90FD%u6307%u5411%u540C%u4E00%u4E2A%u5BF9%u8C61%uFF0C%u6240%u4EE5%u5176%u503C%u76F8%u540C%u4E5F%u5C31%u4E0D%u96BE%u7406%u89E3%u4E86%u3002%u5982%u679C%u60F3%u8981%u6355%u83B7%u5230%u4E24%u4E2A%u4E0D%u540C%u7684%u503C%uFF0C%u5C31%u8981new%u4E24%u6B21%u3002]]></content>
      <tags>
        <tag>Android</tag>
        <tag>unittest</tag>
        <tag>mockito</tag>
        <tag>powermock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UML Distilled (UML精粹)]]></title>
    <url>%2F2016%2F07%2F27%2FUML_Distilled_(UML%E7%B2%BE%E7%B2%B9)%2F</url>
    <content type="text"><![CDATA[Edit &#x6211;&#x6709;&#x53F2;&#x4EE5;&#x6765;&#xFF0C;&#x89C1;&#x8FC7;&#x7684;&#x7FFB;&#x8BD1;&#x7684;&#x6700;&#x6700;&#x6700;&#x70C2;&#x7684;&#x4E2D;&#x6587;&#x8BD1;&#x672C;&#xFF0C;&#x6CA1;&#x6709;&#x4E4B;&#x4E00;&#x3002;&#x5927;&#x5BB6;&#x8BB0;&#x4F4F;&#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x5F90;&#x5BB6;&#x798F;&#x3002;&#x901A;&#x7BC7;&#x72D7;&#x5C41;&#x4E0D;&#x901A;&#x534A;&#x6587;&#x534A;&#x767D;&#x7684;&#x53D9;&#x8FF0;&#xFF0C;&#x4E1A;&#x52A1;&#x4E0D;&#x7CBE;&#x8FD8;&#x4EE5;&#x4E3A;&#x81EA;&#x5DF1;&#x662F;&#x5B54;&#x5723;&#x4EBA;&#x3002;&#x6BCF;&#x6B21;&#x770B;&#x4ED6;&#x7684;&#x8BD1;&#x672C;&#x5C31;&#x6709;&#x771F;&#x60F3;&#x62BD;&#x4E2B;&#x7684;&#x51B2;&#x52A8;&#x3002; &#x4E66;&#x662F;&#x597D;&#x4E66;&#xFF0C;Martin Fowler-&#x5F88;&#x6709;&#x7ECF;&#x9A8C;&#x7684;UML&#x4E13;&#x5BB6;&#x3002;&#x4E66;&#x4E2D;&#x4E0D;&#x4E4F;&#x4ED6;&#x5173;&#x4E8E;&#x4F7F;&#x7528;UML&#x7684;&#x771F;&#x77E5;&#x707C;&#x89C1;&#x3002;&#x521A;&#x9605;&#x89C8;&#x4E86;&#x7B2C;&#x4E5D;&#x7AE0;&#xFF0C;&#x5FCD;&#x4E0D;&#x4F4F;&#x8981;&#x5199;&#x70B9;&#x7B14;&#x8BB0;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x3002;UML Distilled (UML&#x7CBE;&#x7CB9;)Chapter 8. Deployment DiagramsChapter 9. Use Cases&#x5B9A;&#x4E49;Use ScenarioUse CaseExtensionLevelsFeatureMisc.&#x4F8B;&#x5B50;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;Use CaseChapter 10. State Machine DiagramsWhen to Use State Diagrams&#x4F8B;&#x5B50;&amp;&#x57FA;&#x672C;&#x6982;&#x5FF5;&#x9AD8;&#x7EA7;&#x6982;&#x5FF5;Internal ActivitiesActivity StatesSuperstatesConcurrent StatesImplementing State DiagramsChapter 11. Activity Diagrams&#x57FA;&#x672C;&#x6982;&#x5FF5;When to Use Activity Diagrams&#x9AD8;&#x7EA7;&#x7528;&#x6CD5;PartitionsSignalsTokensFlows and EdgesPins and TransformationsExpansion RegionsFlow FinalJoin SpecificationsChapter 8. Deployment DiagramsThe nodes contain artifacts, which are the physical manifestations of software: usually, files. These files might be executables (such as .exe files, binaries, DLLs, JAR files, assemblies, or scripts), or data files, configuration files, HTML documents, and so on. Listing an artifact within a node shows that the artifact is deployed to that node in the running system.Chapter 9. Use CasesUse cases are well known as an important part of the UML. However, the surprise is that in many ways, the definition of use cases in the UML is rather sparse. Use case&#x5728;UML&#x4E2D;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x4F46;&#x4ED6;&#x7684;&#x5B9A;&#x4E49;&#x5374;&#x6BD4;&#x8F83;&#x968F;&#x610F;&#x3002;What the UML describes is a use case diagram, which shows how use cases relate to each other. UML&#x4E2D;&#x63D0;&#x5230;&#x7684;use case&#xFF0C;&#x5F80;&#x5F80;&#x6307;&#x7684;&#x662F;&#x7528;&#x4F8B;&#x56FE;&#xFF0C;&#x4F46;&#x5176;&#x5B9E;&#x7528;&#x4F8B;&#x56FE;&#x7528;&#x5904;&#x5E76;&#x4E0D;&#x5927;&#xFF0C;&#x771F;&#x6B63;&#x91CD;&#x8981;&#x7684;use case&#x672C;&#x8EAB;&#xFF0C;&#x6309;Martin&#x7684;&#x8BF4;&#x53D1;&#x5C31;&#x662F;&#xFF0C;&#x90A3;&#x4E00;&#x6761;&#x6761;&#x7684;steps&#x548C;extensions&#x3002;&#x5B9A;&#x4E49;Use ScenarioA scenario is a sequence of steps describing an nteraction between a user and a system. Use CaseUse cases are a technique for capturing the functional requirements of a system. A use case is a set of scenarios tied together by a common user goal. Use Case = several Use ScenariosExtensionAn extension within the use case names a condition that results in different interactions from those described in the main success scenario (MSS) and states what those differences are.&#x7FFB;&#x6210;&#x6269;&#x5C55;&#x5427;&#xFF0C;&#x611F;&#x89C9;&#x5C31;&#x662F;steps&#x4E2D;&#x7684;&#x7279;&#x4F8B;&#x3002;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x3002;Levels&#x8FD9;&#x4E2A;&#x5F88;&#x6709;&#x610F;&#x601D;&#x3002;&#x6309;Martin&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x5206;&#x6210;&#x4E09;&#x4E2A;levelSea Level Sea-level use cases typically represent a discrete interaction between a primary actor and the system.Fish Level Use cases that are there only because they are included by sea-level use cases are fish level. Sea level&#x7684;&#x5B50;use case&#xFF0C;&#x88AB;sea level use case&#x5305;&#x542B;&#x3002;Kite Level kite-level use cases show how the sea-level use cases fit into wider business interactions. &#x5728;business case&#x7684;&#x65F6;&#x5019;&#x7528;&#x5230;&#x8FD9;&#x4E2A;level&#x7684;use case&#x3002;Fowler&#x5927;&#x5E08;&#x7ED9;&#x51FA;&#x5EFA;&#x8BAE;&#xFF1A;You should have most of your use cases at the sea level. &#x5728;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C3D;&#x91CF;&#x53EA;&#x7528;sea level&#x7684;use case&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E2D;&#x95F4;&#x7EA7;&#xFF0C;&#x65E2;&#x4E0D;&#x662F;&#x592A;&#x7EC6;&#x4E5F;&#x4E0D;&#x592A;&#x7C97;&#x3002;FeatureMany approaches use features of a system&#x2014;Extreme Programming calls them user stories&#x2014;to help describe requirements. &#x6240;&#x8C13;Feature&#xFF0C;&#x6211;&#x7406;&#x89E3;&#xFF0C;&#x662F;&#x7CFB;&#x7EDF;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x6839;&#x636E;use case&#x8981;&#x7528;&#x5230;&#x7684;&#x7279;&#x6027;&#x6765;&#x5B9A;&#x4E49;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x4EC0;&#x4E48;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x5BF9;&#x6B63;&#x5728;&#x8BBE;&#x8BA1;&#x7684;&#x7CFB;&#x7EDF;&#x7684;requirement&#x3002; &#x4F46;&#x662F;Feature&#x672C;&#x8EAB;&#x4E0E;use case&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF0C;&#x4ED6;&#x4EEC;&#x662F;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x65F6;&#xFF0C;&#x5148;&#x540E;&#x88AB;&#x7528;&#x5230;&#x7684;&#x4E24;&#x4E2A;&#x7528;&#x9014;&#x7684;&#x4E24;&#x4EF6;&#x4E1C;&#x897F;&#x3002;&#x73B0;&#x6709;use case&#xFF0C;&#x518D;&#x6709;features (user stories)&#x3002;&#x6211;&#x8BA4;&#x4E3A;feature&#x8FD9;&#x4E2A;&#x8BCD;&#x66F4;&#x8D34;&#x5207;&#xFF0C;&#x4EE5;&#x533A;&#x5206;use case&#x3002;Fowler&#x5927;&#x5E08;&#x518D;&#x6B21;&#x7ED9;&#x51FA;&#x5EFA;&#x8BAE;&#xFF1A;Although you can go directly to describing features, many people find it helpful to develop use cases first and then generate a list of features. Misc.A pre-condition describes what the system should ensure is true before the system allows the use case to begin. This is useful for telling the programmers what conditions they don&#x2019;t have to check for in their code.A guarantee describes what the system will ensure at the end of the use case. Success guarantees hold after a successful scenario; minimal guarantees hold after any scenario.A trigger specifies the event that gets the use case started.&#x8FD9;&#x4E9B;&#x5728;&#x4E25;&#x683C;&#x5B9A;&#x4E49;use case&#xFF0C;&#x5E76;&#x4FC3;&#x6210;&#x7CFB;&#x7EDF;&#x754C;&#x9650;&#x8BBE;&#x5B9A;&#x65F6;&#x7528;&#x5F97;&#x4E0A;&#x3002; &#x6B64;&#x65F6;Fowler&#x5927;&#x5E08;&#x518D;&#x6B21;&#x7ED9;&#x51FA;&#x5EFA;&#x8BAE;&#xFF1A;It&#x2019;s better to do too little than too much. The amount of detail you need in a use case depends on the amount of risk in that use case. &#x540E;&#x9762;Fowler&#x5927;&#x5E08;&#x63A5;&#x7740;&#x8BF4;&#xFF08;&#x6211;&#x5C31;&#x4E0D;&#x653E;&#x539F;&#x6587;&#x4E86;&#xFF09;&#xFF0C;&#x901A;&#x5E38;&#xFF0C;&#x5728;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x51E0;&#x4E2A;&#x5173;&#x952E;&#x7684;use case&#xFF0C;&#x6162;&#x6162;&#x5730;&#x5176;&#x4ED6;&#x7684;use case&#x4F1A;&#x88AB;&#x6DFB;&#x8FDB;&#x6765;&#x3002;&#x4F60;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x628A;&#x4ED6;&#x4EEC;&#x90FD;&#x5199;&#x4E0B;&#x6765;&#xFF0C;&#x53E3;&#x5934;&#x7684;&#x4EA4;&#x6D41;&#x6548;&#x7387;&#x5F80;&#x5F80;&#x66F4;&#x9AD8;&#x3002; &#x4E0D;&#x8981;&#x82B1;&#x592A;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x753B;&#x7528;&#x4F8B;&#x56FE;&#xFF0C;focus&#x5728;&#x6587;&#x5B57;&#x63CF;&#x8FF0;&#x4E0A;&#x3002;&#x753B;&#x56FE;&#x5BB9;&#x6613;&#x8BA9;&#x4E8B;&#x60C5;&#x53D8;&#x5F97;&#x590D;&#x6742;&#x800C;&#x5931;&#x53BB;&#x7126;&#x70B9;&#xFF0C;&#x5E76;&#x4E14;&#x56FE;&#x8D8A;&#x590D;&#x6742;&#xFF0C;&#x770B;&#x5F97;&#x61C2;&#x7684;&#x4EBA;&#x8D8A;&#x5C11;&#x3002;&#x4F8B;&#x5B50;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;Use CaseUse cases are a valuable tool to help understand the functional requirements of a system. &#x63A5;&#x7740;Fowler&#x5927;&#x5E08;&#x53C8;&#x7ED9;&#x51FA;&#x771F;&#x77E5;&#x707C;&#x89C1;&#xFF1A;A couple of pages per use case is just fine for most cases.&#x4E00;&#x822C;&#x4E00;&#x4E2A;use case&#x4E00;&#x5230;&#x4E24;&#x9875;&#x7EB8;&#x8DB3;&#x77E3;&#x3002;&#x4E0D;&#x8981;&#x592A;&#x591A;&#x6216;&#x592A;&#x5C11;&#x3002; Chapter 10. State Machine DiagramsWhen to Use State DiagramsState diagrams are good at describing the behavior of an object across several use cases. State diagrams are not very good at describing behavior that involves a number of objects collaborating. Many people find that UI and control objects have the kind of behavior that is useful to depict with a state diagram.&#x4F8B;&#x5B50;&amp;&#x57FA;&#x672C;&#x6982;&#x5FF5;When developers talk about objects, they often refer to the state of the objects to mean the combination of all the data in the fields of the objects.&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8BF4;&#x7684;object&#xFF0C;&#x4E00;&#x822C;&#x6307;&#x7684;&#x662F;object&#x7684;&#x67D0;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x3002;&#x9AD8;&#x7EA7;&#x6982;&#x5FF5;Internal ActivitiesActivity Statesregular activities occur &#x201C;instantaneously&#x201D; and cannot be interrupted by regular events, while do-activities can take finite time and can be interruptedSuperstatesConcurrent Stateshistory pseudostate. This indicates that when the clock is switched on, the radio/CD choice goes back to the state the clock was in when it was turned off.&#x4E0A;&#x4E00;&#x6B21;&#x5173;&#x673A;&#x65F6;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x662F;history pseudostate&#x3002; Implementing State Diagrams&#x6709;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;implementnested switchthe State patternstate tables &#x7B2C;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x4E5F;&#x6700;&#x5E38;&#x89C1;&#x5C31;&#x662F;switch-case&#x3002;Fowler&#x5927;&#x5E08;&#x8BF4;&#x4E0D;&#x5EFA;&#x8BAE;&#x7528;&#x8FD9;&#x4E2A;&#xFF0C;&#x5373;&#x4FBF;&#x662F;&#x7B80;&#x5355;&#x7684;case&#x3002;&#x56E0;&#x4E3A;&#x5F88;&#x5BB9;&#x6613;&#x5931;&#x63A7;&#x3002; &#x7B2C;&#x4E8C;&#x4E2A;&#x662F;state&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x5177;&#x4F53;&#x8BF7;&#x89C1;&#xFF3B;Gang of Four&#xFF3D;The state pattern is easier to put together when you need it, and although it needs a new class for each state, it&#x2019;s a small amount of code to write in each case.Obviously, the state table is more work to do once, but then you can use it every time you have a state problem to hold. Chapter 11. Activity Diagrams&#x57FA;&#x672C;&#x6982;&#x5FF5;&#x6211;&#x7FFB;&#x8BD1;&#x4E4B;&#x4E3A;&#x6D3B;&#x52A8;&#x56FE;&#x3002;&#x5176;&#x6700;&#x91CD;&#x8981;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x9610;&#x660E;&#x52A8;&#x4F5C;&#x5E8F;&#x5217;&#x2014;&#x2014;&#x4E32;&#x884C;&amp;&#x5E76;&#x884C;&#x3002;Initial node &amp; activity finalfork &amp; joindecision &amp; merge&#x6BCF;&#x4E00;&#x4E2A;&#x5706;&#x89D2;&#x7684;&#x65B9;&#x6846;&#x6846;&#x662F;&#x4E00;&#x4E2A;action&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8FD9;&#x4E00;&#x5207;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;activity&#x5982;&#x679C;&#x9700;&#x8981;&#x6BCF;&#x4E00;&#x4E2A;action&#x53EF;&#x4EE5;&#x8F6C;&#x5316;&#x6210;&#x4E00;&#x4E2A;&#x5B50;&#x6D3B;&#x52A8;(sub activity)&#x3002;&#x7136;&#x540E;&#x5728;&#x4E3B;&#x56FE;&#x4E2D;&#x7528;&#x4E00;&#x4E2A;&#x53C9;&#x5B50;(rake)&#x8868;&#x793A;&#x3002;When to Use Activity DiagramsThe great strength of activity diagrams lies in the fact that they support and encourage parallel behavior. &#x4E0D;&#x8FC7;&#x5728;&#x8FD9;&#x4E00;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;Fowler&#x5927;&#x5E08;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x6BB5;&#x8BDD;&#x9887;&#x4E3A;&#x8010;&#x4EBA;&#x5BFB;&#x5473;&#xFF1A;In principle, you can take advantages of the forks and joins to describe parallel algorithms for concurrent programs. Although I don&#x2019;t travel in concurrent circles that much, I haven&#x2019;t seen much evidence of people using them there. I think the reason is that **most of the complexity of concurrent programming is in avoiding contention on data, and activity diagrams don&#x2019;t help much with that**.&#x5E76;&#x6CA1;&#x6709;&#x5F88;&#x591A;&#x4EBA;&#x6216;&#x8005;&#x6709;&#x5F88;&#x5F3A;&#x7684;&#x7406;&#x7531;&#x4F7F;&#x7528;&#x6D3B;&#x52A8;&#x56FE;&#x6765;&#x63CF;&#x8FF0;&#x5E76;&#x884C;&#x7ED3;&#x6784;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x6D3B;&#x52A8;&#x56FE;&#x5E76;&#x4E0D;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x63CF;&#x8FF0;&#x5BF9;&#x8D44;&#x6E90;&#x7684;&#x4E89;&#x593A;(contention)&#x3002;&#x9AD8;&#x7EA7;&#x7528;&#x6CD5;Partitions&#x901A;&#x8FC7;&#x6CF3;&#x9053;&#x56FE;&#x6765;&#x9610;&#x660E;actions&#x90FD;&#x7531;&#x54EA;&#x5199;object&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x8FD9;&#x4E2A;&#x5BF9;&#x9610;&#x8FF0;&#x6D41;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x6CA1;&#x4EC0;&#x4E48;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x5728;business process modeling&#x7684;&#x65F6;&#x5019;&#x6BD4;&#x8F83;&#x6709;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x6E05;&#x695A;&#x7684;&#x8868;&#x660E;&#xFF0C;&#x6BCF;&#x4E2A;&#x90E8;&#x95E8;&#x6216;&#x8005;&#x89D2;&#x8272;&#x9700;&#x8981;&#x505A;&#x54EA;&#x4E9B;&#x4E8B;&#x60C5;&#x3002;&#x5178;&#x578B;&#x7684;partitions&#x5982;&#x4E0B;&#x56FE;Signals&#x8FD9;&#x4E2A;&#x5728;&#x63CF;&#x8FF0;&#x6D41;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x6BD4;&#x8F83;&#x6709;&#x7528;&#x3002;&#x4ED6;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x6D3B;&#x52A8;&#x8D77;&#x70B9;&#x7684;&#x63CF;&#x8FF0;&#x3002;&#x6BD4;&#x65B9;&#xFF0C;&#x7CFB;&#x7EDF;&#x54CD;&#x5E94;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x4E8B;&#x4EF6;&#xFF0C;&#x6765;&#x5F00;&#x59CB;&#x4E00;&#x4E2A;activity&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4F8B;&#x5B50;send signalaccept signaltime signalTokens&#x8FD9;&#x4E2A;&#x6309;&#x7167;Fowler&#x5927;&#x5E08;&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x6709;&#x4E9B;UML&#x7684;&#x5927;&#x90E8;&#x5934;&#x8457;&#x4F5C;&#x82B1;&#x4E86;&#x5927;&#x7BC7;&#x5E45;&#x7684;&#x6587;&#x7AE0;&#x4ECB;&#x7ECD;token&#x7684;&#x4F7F;&#x7528;&#x3002;&#x5728;&#x590D;&#x6742;&#x7CFB;&#x7EDF;&#x4E2D;token&#x53EF;&#x4EE5;&#x8BA9;&#x7CFB;&#x7EDF;&#x53EF;&#x6613;&#x4E8E;&#x7406;&#x89E3;&#xFF0C;&#x53EF;&#x89C6;&#x5316;&#x66F4;&#x597D;&#x3002;You can visualize the tokens with coins or counters moving across the diagram. As you get to more complicated examples of activity diagrams, tokens often make it easier to visualize things.Flows and Edges&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E86;&#x51E0;&#x79CD;&#x56FE;&#x4F8B;&#xFF0C;&#x6765;&#x4E30;&#x5BCC;&#x6D3B;&#x52A8;&#x56FE;&#x7684;&#x753B;&#x6CD5;&#x3002;&#x770B;&#x4F8B;&#x5B50;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;Pins and Transformations&#x770B;&#x4E00;&#x4E2A;pin and transformation&#x7684;&#x4F8B;&#x56FE;&#xFF1A;Pins are best when you want to look at the data needed and produced by the various actions. If you use pins, it&#x2019;s safe to show multiple flows coming into the same action. The pin notation reinforces the implicit joinExpansion Regions&#x8FD9;&#x4E2A;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x63CF;&#x8FF0;&#x4E00;&#x4E2A;activity&#x7684;&#x8F93;&#x51FA;&#x4F1A;&#x89E6;&#x53D1;&#x82E5;&#x5E72;&#x4E2A;activity&#x3002;&#x770B;&#x4F8B;&#x56FE;&#xFF1A;Flow FinalFlow Final&#x63D0;&#x4F9B;&#x4E86;&#x63D0;&#x524D;&#x7ED3;&#x675F;&#x4E00;&#x4E2A;activity&#x5206;&#x652F;&#x7684;&#x63CF;&#x8FF0;&#x3002;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x5206;&#x652F;&#x5728;&#x67D0;&#x4E00;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x76F4;&#x63A5;&#x7ED3;&#x675F;&#x4E86;&#x3002;Join Specificationsjoin&#x4E4B;&#x524D;&#x7684;&#x5224;&#x65AD;&#x603B;&#x5F97;&#x770B;&#x6765;&#xFF0C;activity diagram&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x753B;flow chart&#xFF0C;&#x800C;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E0B;&#x66F4;&#x9177;&#x7684;&#x529F;&#x80FD;&#x3002;%23UML%20Distilled%20%28UML%u7CBE%u7CB9%29%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5BUML%5D%0A%u6211%u6709%u53F2%u4EE5%u6765%uFF0C%u89C1%u8FC7%u7684%u7FFB%u8BD1%u7684%u6700%u6700%u6700%u70C2%u7684%u4E2D%u6587%u8BD1%u672C%uFF0C%u6CA1%u6709%u4E4B%u4E00%u3002%u5927%u5BB6%u8BB0%u4F4F%u8FD9%u4E2A%u540D%u5B57%u5F90%u5BB6%u798F%u3002%u901A%u7BC7%u72D7%u5C41%u4E0D%u901A%u534A%u6587%u534A%u767D%u7684%u53D9%u8FF0%uFF0C%u4E1A%u52A1%u4E0D%u7CBE%u8FD8%u4EE5%u4E3A%u81EA%u5DF1%u662F%u5B54%u5723%u4EBA%u3002%u6BCF%u6B21%u770B%u4ED6%u7684%u8BD1%u672C%u5C31%u6709%u771F%u60F3%u62BD%u4E2B%u7684%u51B2%u52A8%u3002%0A%u4E66%u662F%u597D%u4E66%uFF0CMartin%20Fowler-%u5F88%u6709%u7ECF%u9A8C%u7684UML%u4E13%u5BB6%u3002%u4E66%u4E2D%u4E0D%u4E4F%u4ED6%u5173%u4E8E%u4F7F%u7528UML%u7684%u771F%u77E5%u707C%u89C1%u3002%u521A%u9605%u89C8%u4E86%u7B2C%u4E5D%u7AE0%uFF0C%u5FCD%u4E0D%u4F4F%u8981%u5199%u70B9%u7B14%u8BB0%u8BB0%u5F55%u4E00%u4E0B%u3002%0A%0A%5BTOC%5D%0A%0A%23%23Chapter%208.%20Deployment%20Diagrams%0A%21%5BAlt%20text%5D%28./1470561176490.png%29%0A%3EThe%20nodes%20contain%20artifacts%2C%20which%20are%20the%20physical%20manifestations%20of%20software%3A%20usually%2C%20files.%20These%20files%20might%20be%20executables%20%28such%20as%20.exe%20files%2C%20binaries%2C%20DLLs%2C%20JAR%20files%2C%20assemblies%2C%20or%20scripts%29%2C%20or%20data%20files%2C%20configuration%20files%2C%20HTML%20documents%2C%20and%20so%20on.%20Listing%20an%20artifact%20within%20a%20node%20shows%20that%20the%20artifact%20is%20deployed%20to%20that%20node%20in%20the%20running%20system.%0A%23%23Chapter%209.%20Use%20Cases%0A%3EUse%20cases%20are%20well%20known%20as%20an%20important%20part%20of%20the%20UML.%20However%2C%20the%20surprise%20is%20that%20in%20many%20ways%2C%20the%20definition%20of%20use%20cases%20in%20the%20UML%20is%20rather%20sparse.%20%0A%0AUse%20case%u5728UML%u4E2D%u5F88%u91CD%u8981%uFF0C%u4F46%u4ED6%u7684%u5B9A%u4E49%u5374%u6BD4%u8F83%u968F%u610F%u3002%0A%3EWhat%20the%20UML%20describes%20is%20a%20use%20case%20diagram%2C%20which%20shows%20how%20use%20cases%20relate%20to%20each%20other.%20%0A%0AUML%u4E2D%u63D0%u5230%u7684use%20case%uFF0C%u5F80%u5F80%u6307%u7684%u662F%u7528%u4F8B%u56FE%uFF0C%u4F46%u5176%u5B9E%u7528%u4F8B%u56FE%u7528%u5904%u5E76%u4E0D%u5927%uFF0C%u771F%u6B63%u91CD%u8981%u7684use%20case%u672C%u8EAB%uFF0C%u6309Martin%u7684%u8BF4%u53D1%u5C31%u662F%uFF0C%u90A3%u4E00%u6761%u6761%u7684steps%u548Cextensions%u3002%0A%23%23%23%u5B9A%u4E49%0A%23%23%23%23Use%20Scenario%0A%3EA%20scenario%20is%20a%20sequence%20of%20steps%20describing%20an%20nteraction%20between%20a%20user%20and%20a%20system.%20%0A%23%23%23%23Use%20Case%0A%3EUse%20cases%20are%20a%20technique%20for%20capturing%20the%20functional%20requirements%20of%20a%20system.%20%0A%3EA%20use%20case%20is%20a%20set%20of%20scenarios%20tied%20together%20by%20a%20common%20user%20goal.%0A%3E**Use%20Case%20%3D%20several%20Use%20Scenarios**%0A%23%23%23%23Extension%0A%3EAn%20extension%20within%20the%20use%20case%20names%20a%20condition%20that%20results%20in%20different%20interactions%20from%20those%20described%20in%20the%20main%20success%20scenario%20%28MSS%29%20and%20states%20what%20those%20differences%20are.%0A%0A%u7FFB%u6210%u6269%u5C55%u5427%uFF0C%u611F%u89C9%u5C31%u662Fsteps%u4E2D%u7684%u7279%u4F8B%u3002%u5177%u4F53%u53EF%u4EE5%u770B%u4E0B%u9762%u7684%u4F8B%u5B50%u3002%0A%23%23%23%23Levels%0A%u8FD9%u4E2A%u5F88%u6709%u610F%u601D%u3002%u6309Martin%u7684%u8BF4%u6CD5%uFF0C%u5206%u6210%u4E09%u4E2Alevel%0A-%20Sea%20Level%0A%09-%20%20Sea-level%20use%20cases%20typically%20represent%20a%20discrete%20interaction%20between%20a%20primary%20actor%20and%20the%20system.%0A-%20Fish%20Level%0A%09-%20Use%20cases%20that%20are%20there%20only%20because%20they%20are%20included%20by%20sea-level%20use%20cases%20are%20fish%20level.%20Sea%20level%u7684%u5B50use%20case%uFF0C%u88ABsea%20level%20use%20case%u5305%u542B%u3002%0A-%20Kite%20Level%0A%09-%20kite-level%20use%20cases%20show%20how%20the%20sea-level%20use%20cases%20fit%20into%20wider%20business%20interactions.%20%u5728business%20case%u7684%u65F6%u5019%u7528%u5230%u8FD9%u4E2Alevel%u7684use%20case%u3002%0A%0AFowler%u5927%u5E08%u7ED9%u51FA%u5EFA%u8BAE%uFF1A%0A%3E**You%20should%20have%20most%20of%20your%20use%20cases%20at%20the%20sea%20level.%20**%0A%0A%u5728%u7CFB%u7EDF%u8BBE%u8BA1%u7684%u65F6%u5019%uFF0C%u5C3D%u91CF%u53EA%u7528sea%20level%u7684use%20case%uFF0C%u4E5F%u5C31%u662F%u4E2D%u95F4%u7EA7%uFF0C%u65E2%u4E0D%u662F%u592A%u7EC6%u4E5F%u4E0D%u592A%u7C97%u3002%0A%23%23%23%23Feature%0A%3EMany%20approaches%20use%20features%20of%20a%20system%u2014Extreme%20Programming%20calls%20them%20**user%20stories**%u2014to%20help%20describe%20requirements.%20%0A%0A%u6240%u8C13Feature%uFF0C%u6211%u7406%u89E3%uFF0C%u662F%u7CFB%u7EDF%u7684%u7279%u6027%uFF0C%u6839%u636Euse%20case%u8981%u7528%u5230%u7684%u7279%u6027%u6765%u5B9A%u4E49%u7CFB%u7EDF%u9700%u8981%u63D0%u4F9B%u4EC0%u4E48%uFF0C%u8FD9%u662F%u4E00%u79CD%u5BF9%u6B63%u5728%u8BBE%u8BA1%u7684%u7CFB%u7EDF%u7684requirement%u3002%0A%u4F46%u662FFeature%u672C%u8EAB%u4E0Euse%20case%u5E76%u6CA1%u6709%u5BF9%u5E94%u5173%u7CFB%uFF0C%u4ED6%u4EEC%u662F%u7CFB%u7EDF%u8BBE%u8BA1%u65F6%uFF0C%u5148%u540E%u88AB%u7528%u5230%u7684%u4E24%u4E2A%u7528%u9014%u7684%u4E24%u4EF6%u4E1C%u897F%u3002%u73B0%u6709use%20case%uFF0C%u518D%u6709features%20%28user%20stories%29%u3002%u6211%u8BA4%u4E3Afeature%u8FD9%u4E2A%u8BCD%u66F4%u8D34%u5207%uFF0C%u4EE5%u533A%u5206use%20case%u3002%0A%0AFowler%u5927%u5E08%u518D%u6B21%u7ED9%u51FA%u5EFA%u8BAE%uFF1A%0A%3EAlthough%20you%20can%20go%20directly%20to%20describing%20features%2C%20many%20people%20find%20it%20helpful%20to%20**develop%20use%20cases%20first%20and%20then%20generate%20a%20list%20of%20features.**%20%0A%0A%23%23%23%23Misc.%0A-%20A%20**pre-condition**%20describes%20what%20the%20system%20should%20ensure%20is%20true%20before%20the%20system%20allows%0Athe%20use%20case%20to%20begin.%20This%20is%20useful%20for%20telling%20the%20programmers%20what%20conditions%20they%20don%27t%0Ahave%20to%20check%20for%20in%20their%20code.%0A-%20A%20**guarantee**%20describes%20what%20the%20system%20will%20ensure%20at%20the%20end%20of%20the%20use%20case.%20Success%20guarantees%20hold%20after%20a%20successful%20scenario%3B%20minimal%20guarantees%20hold%20after%20any%20scenario.%0A-%20A%20**trigger**%20specifies%20the%20event%20that%20gets%20the%20use%20case%20started.%0A%0A%u8FD9%u4E9B%u5728%u4E25%u683C%u5B9A%u4E49use%20case%uFF0C%u5E76%u4FC3%u6210%u7CFB%u7EDF%u754C%u9650%u8BBE%u5B9A%u65F6%u7528%u5F97%u4E0A%u3002%0A%u6B64%u65F6Fowler%u5927%u5E08%u518D%u6B21%u7ED9%u51FA%u5EFA%u8BAE%uFF1A%0A%3E**It%27s%20better%20to%20do%20too%20little%20than%20too%20much.%20The%20amount%20of%20detail%20you%20need%20in%20a%20use%20case%20depends%20on%20the%20amount%20of%20risk%20in%20that%20use%20case.%20**%0A%0A%u540E%u9762Fowler%u5927%u5E08%u63A5%u7740%u8BF4%uFF08%u6211%u5C31%u4E0D%u653E%u539F%u6587%u4E86%uFF09%uFF0C%u901A%u5E38%uFF0C%u5728%u5F00%u59CB%u7684%u65F6%u5019%uFF0C%u4F60%u53EA%u9700%u8981%u51E0%u4E2A%u5173%u952E%u7684use%20case%uFF0C%u6162%u6162%u5730%u5176%u4ED6%u7684use%20case%u4F1A%u88AB%u6DFB%u8FDB%u6765%u3002%u4F60%u5E76%u4E0D%u9700%u8981%u628A%u4ED6%u4EEC%u90FD%u5199%u4E0B%u6765%uFF0C%u53E3%u5934%u7684%u4EA4%u6D41%u6548%u7387%u5F80%u5F80%u66F4%u9AD8%u3002%0A**%u4E0D%u8981%u82B1%u592A%u591A%u7684%u65F6%u95F4%u753B%u7528%u4F8B%u56FE%uFF0Cfocus%u5728%u6587%u5B57%u63CF%u8FF0%u4E0A%u3002%u753B%u56FE%u5BB9%u6613%u8BA9%u4E8B%u60C5%u53D8%u5F97%u590D%u6742%u800C%u5931%u53BB%u7126%u70B9%uFF0C%u5E76%u4E14%u56FE%u8D8A%u590D%u6742%uFF0C%u770B%u5F97%u61C2%u7684%u4EBA%u8D8A%u5C11%u3002**%0A%23%23%23%u4F8B%u5B50%0A%21%5BAlt%20text%5D%28./1469631172614.png%29%0A%23%23%23%u4EC0%u4E48%u65F6%u5019%u7528Use%20Case%0A%3EUse%20cases%20are%20a%20valuable%20tool%20to%20help%20understand%20the%20functional%20requirements%20of%20a%20system.%20%0A%0A%u63A5%u7740Fowler%u5927%u5E08%u53C8%u7ED9%u51FA%u771F%u77E5%u707C%u89C1%uFF1A%0A%3EA%20couple%20of%20pages%20per%20use%20case%20is%20just%20fine%20for%20most%20cases.%0A%0A%u4E00%u822C%u4E00%u4E2Ause%20case%u4E00%u5230%u4E24%u9875%u7EB8%u8DB3%u77E3%u3002%u4E0D%u8981%u592A%u591A%u6216%u592A%u5C11%u3002%20%0A%23%23Chapter%2010.%20State%20Machine%20Diagrams%0A%23%23%23When%20to%20Use%20State%20Diagrams%0A%3EState%20diagrams%20are%20good%20at%20describing%20the%20behavior%20of%20**an%20object%20across%20several%20use%20cases**.%20State%20diagrams%20are%20not%20very%20good%20at%20describing%20behavior%20that%20involves%20a%20number%20of%20objects%20collaborating.%0A%3EMany%20people%20find%20that%20**UI%20and%20control%20objects**%20have%20the%20kind%20of%20behavior%20that%20is%20useful%20to%20depict%20with%20a%20state%20diagram.%0A%23%23%23%u4F8B%u5B50%26%u57FA%u672C%u6982%u5FF5%0A%21%5BAlt%20text%5D%28./1470056081607.png%29%0A%u7BAD%u5934%u4E0A%u7684%u6587%u5B57%u683C%u5F0F%u4E3A%60trigger-signature%20%5Bguard%5D/activity%60%uFF0C%u4F8B%u5982%60candle%20removed%5Bdoor%20closed%5D/reveal%20lock%60%uFF0C%u610F%u601D%u662F%u5F53%u95E8%u5173%u8D77%u6765%u7684%u65F6%u5019%28guard%29%uFF0C%u8721%u70DB%u88AB%u4ECE%u70DB%u53F0%u62FF%u8D70%28event%29%uFF0C%u9501%u5373%u663E%u73B0%u51FA%u6765%28activity%29%u3002%u8FD9%u4E09%u4E2A%u90E8%u5206%u5747%u4E3A%u53EF%u9009%u9879%uFF0C%u4E0D%u662F%u5FC5%u987B%u6709%u7684%u3002%u5982%u679C%u51E0%u4E2Atransision%u6709%u76F8%u540C%u7684event%u548Cactivity%uFF0C%u90A3%u4E48guard%u5FC5%u987B%u4E92%u65A5%uFF0C%u8FD9%u6837%u624D%u80FD%u786E%u5B9A%u8D70%u54EA%u4E2Atransision%u3002%0AFowler%u5927%u5E08%u8BF4%uFF1A%0A%3EWhen%20developers%20talk%20about%20objects%2C%20they%20often%20refer%20to%20the%20state%20of%20the%20objects%20to%20mean%20the%20combination%20of%20all%20the%20data%20in%20the%20fields%20of%20the%20objects.%0A%0A%u5F00%u53D1%u4EBA%u5458%u8BF4%u7684object%uFF0C%u4E00%u822C%u6307%u7684%u662Fobject%u7684%u67D0%u4E00%u4E2A%u72B6%u6001%u3002%0A%23%23%23%u9AD8%u7EA7%u6982%u5FF5%0A%23%23%23%23Internal%20Activities%0A%21%5BAlt%20text%5D%28./1470057983821.png%29%0A%u4ECE%u81EA%u5DF1%u5230%u81EA%u5DF1%u7684transision%u4E2D%u7684%u6D3B%u52A8%u90E8%u5206%u5C31%u662Finternal%20activity%u3002%0A%23%23%23%23Activity%20States%0A%21%5BAlt%20text%5D%28./1470058049870.png%29%0A%u8017%u65F6%u6BD4%u8F83%u957F%u7684activity%u672C%u8EAB%u4E5F%u53EF%u4EE5%u6210%u4E3A%u4E00%u4E2Astate%uFF0C%u4F8B%u5982searching%u3002%0A%3Eregular%20activities%20occur%20%22instantaneously%22%20and%20cannot%20be%20interrupted%20by%20regular%20events%2C%20while%20**do-activities%20can%20take%20finite%20time%20and%20can%20be%20interrupted**%0A%23%23%23%23Superstates%0A%21%5BAlt%20text%5D%28./1470058186471.png%29%0A%u591A%u4E2Astate%u5171%u4EAB%u76F8%u540C%u7684transition%u548Cinternal%20activities%uFF0C%u8FD9%u6837%u53EF%u4EE5%u62BD%u8C61%u51FAsuperstates%uFF0C%u7136%u540E%u653E%u5230%u4E00%u4E2A%u6846%u6846%u91CC%u3002%0A%23%23%23%23Concurrent%20States%0A%21%5BAlt%20text%5D%28./1470058339705.png%29%0A%u51E0%u4E2Astate%u53EF%u80FD%u662F%u6B63%u4EA4%u7684%uFF08orthogonal%uFF09%uFF0C%u5373%u53EF%u80FD%u662F%u5E76%u884C%u72B6%u6001%u3002%u8FD9%u65F6%u5019%u5C31%u80FD%u8FD9%u6837%u8868%u793A%u3002%0A%3E%20**history%20pseudostate**.%20This%20indicates%20that%20when%20the%20clock%20is%20switched%20on%2C%20the%20radio/CD%20choice%20goes%20back%20to%20the%20state%20the%20clock%20was%20in%20when%20it%20was%20turned%20off.%u4E0A%u4E00%u6B21%u5173%u673A%u65F6%u7684%u72B6%u6001%uFF0C%u5C31%u662Fhistory%20pseudostate%u3002%20%0A%23%23%23Implementing%20State%20Diagrams%0A%u6709%u4E09%u4E2A%u65B9%u6CD5implement%0A-%20%20nested%20switch%0A-%20%20the%20State%20pattern%0A-%20%20state%20tables%0A%u7B2C%u4E00%u4E2A%u6700%u7B80%u5355%u4E5F%u6700%u5E38%u89C1%u5C31%u662Fswitch-case%u3002Fowler%u5927%u5E08%u8BF4%u4E0D%u5EFA%u8BAE%u7528%u8FD9%u4E2A%uFF0C%u5373%u4FBF%u662F%u7B80%u5355%u7684case%u3002%u56E0%u4E3A%u5F88%u5BB9%u6613%u5931%u63A7%u3002%0A%u7B2C%u4E8C%u4E2A%u662Fstate%u8BBE%u8BA1%u6A21%u5F0F%uFF0C%u5177%u4F53%u8BF7%u89C1%uFF3BGang%20of%20Four%uFF3DThe%20state%20pattern%20is%20easier%20to%20put%20together%20when%20you%20need%20it%2C%20and%20although%20it%20needs%20a%20new%20class%20for%20each%20state%2C%20it%27s%20a%20small%20amount%20of%20code%20to%20write%20in%20each%20case.%0A%21%5BAlt%20text%5D%28./1470058566116.png%29%0A%u7B2C%u4E09%u4E2A%u662Fstate%20table%uFF0C%u5F62%u5982%uFF1A%0A%21%5BAlt%20text%5D%28./1470058643590.png%29%0A%3EObviously%2C%20the%20state%20table%20is%20more%20work%20to%20do%20once%2C%20but%20then%20you%20can%20use%20it%20every%20time%20you%20have%20a%20state%20problem%20to%20hold.%20%0A%0A%23%23Chapter%2011.%20Activity%20Diagrams%0A%23%23%23%u57FA%u672C%u6982%u5FF5%0A%u6211%u7FFB%u8BD1%u4E4B%u4E3A%u6D3B%u52A8%u56FE%u3002%u5176%u6700%u91CD%u8981%u7684%u529F%u80FD%u5C31%u662F%u9610%u660E%u52A8%u4F5C%u5E8F%u5217%u2014%u2014%u4E32%u884C%26%u5E76%u884C%u3002%0A%21%5BAlt%20text%5D%28./1469861506321.png%29%0A%u6211%u89C9%u5F97%u6D3B%u52A8%u56FE%u5176%u5B9E%u5C31%u662F%u6D41%u7A0B%u56FE%28flow%20chart%29%uFF0C%u4F5C%u8005%u8BF4activity%20diagram%u4E0Eflow%20chart%u7684%u4E3B%u8981%u5DEE%u522B%u5C31%u662F%uFF0Cactivity%20diagram%u6709%u6807%u51C6%u8BED%u8A00%u6765%u63CF%u8FF0%u5E76%u884C%u7684%u52A8%u4F5C%u3002%0A%u4E00%u526F%u6D3B%u52A8%u56FE%u4E2D%u7684%u57FA%u672C%u6784%u6210%u5143%u7D20%u53EF%u53C2%u770B%u4E0A%u56FE%uFF1A%0A-%20Initial%20node%20%26%20activity%20final%0A-%20fork%20%26%20join%0A-%20decision%20%26%20merge%0A-%20%u6BCF%u4E00%u4E2A%u5706%u89D2%u7684%u65B9%u6846%u6846%u662F%u4E00%u4E2Aaction%uFF0C%u6240%u6709%u7684%u8FD9%u4E00%u5207%u7EC4%u6210%u4E00%u4E2Aactivity%0A%0A%u5982%u679C%u9700%u8981%u6BCF%u4E00%u4E2Aaction%u53EF%u4EE5%u8F6C%u5316%u6210%u4E00%u4E2A%u5B50%u6D3B%u52A8%28sub%20activity%29%u3002%u7136%u540E%u5728%u4E3B%u56FE%u4E2D%u7528%u4E00%u4E2A%u53C9%u5B50%28rake%29%u8868%u793A%u3002%0A%21%5BAlt%20text%5D%28./1469861910016.png%29%0A%0A%23%23%23When%20to%20Use%20Activity%20Diagrams%0A%3EThe%20great%20strength%20of%20activity%20diagrams%20lies%20in%20the%20fact%20that%20they%20support%20and%20encourage%20parallel%20behavior.%20%0A%0A%u4E0D%u8FC7%u5728%u8FD9%u4E00%u7AE0%u8282%u4E2D%uFF0CFowler%u5927%u5E08%u8FD9%u91CC%u6709%u4E00%u6BB5%u8BDD%u9887%u4E3A%u8010%u4EBA%u5BFB%u5473%uFF1A%0A%3EIn%20principle%2C%20you%20can%20take%20advantages%20of%20the%20forks%20and%20joins%20to%20describe%20parallel%20algorithms%20for%20concurrent%20programs.%20Although%20I%20don%27t%20travel%20in%20concurrent%20circles%20that%20much%2C%20I%20haven%27t%20seen%20much%20evidence%20of%20people%20using%20them%20there.%20%0A%3EI%20think%20the%20reason%20is%20that%20**most%20of%20the%20complexity%20of%20concurrent%20programming%20is%20in%20avoiding%0Acontention%20on%20data%2C%20and%20activity%20diagrams%20don%27t%20help%20much%20with%20that**.%0A%0A%u5E76%u6CA1%u6709%u5F88%u591A%u4EBA%u6216%u8005%u6709%u5F88%u5F3A%u7684%u7406%u7531%u4F7F%u7528%u6D3B%u52A8%u56FE%u6765%u63CF%u8FF0%u5E76%u884C%u7ED3%u6784%uFF0C%u539F%u56E0%u662F%u6D3B%u52A8%u56FE%u5E76%u4E0D%u80FD%u5F88%u597D%u7684%u63CF%u8FF0%u5BF9%u8D44%u6E90%u7684%u4E89%u593A%28contention%29%u3002%0A%23%23%23%u9AD8%u7EA7%u7528%u6CD5%0A%23%23%23%23Partitions%0A%u901A%u8FC7%u6CF3%u9053%u56FE%u6765%u9610%u660Eactions%u90FD%u7531%u54EA%u5199object%u6765%u5B8C%u6210%u7684%u3002%u8FD9%u4E2A%u5BF9%u9610%u8FF0%u6D41%u7A0B%u7684%u65F6%u5019%u6CA1%u4EC0%u4E48%u7528%uFF0C%u4F46%u662F%u5728business%20process%20modeling%u7684%u65F6%u5019%u6BD4%u8F83%u6709%u7528%uFF0C%u53EF%u4EE5%u6E05%u695A%u7684%u8868%u660E%uFF0C%u6BCF%u4E2A%u90E8%u95E8%u6216%u8005%u89D2%u8272%u9700%u8981%u505A%u54EA%u4E9B%u4E8B%u60C5%u3002%u5178%u578B%u7684partitions%u5982%u4E0B%u56FE%0A%21%5BAlt%20text%5D%28./1469862941546.png%29%0A%0A%23%23%23%23Signals%0A%u8FD9%u4E2A%u5728%u63CF%u8FF0%u6D41%u7A0B%u7684%u65F6%u5019%u6BD4%u8F83%u6709%u7528%u3002%u4ED6%u63D0%u4F9B%u4E86%u4E00%u79CD%u6D3B%u52A8%u8D77%u70B9%u7684%u63CF%u8FF0%u3002%u6BD4%u65B9%uFF0C%u7CFB%u7EDF%u54CD%u5E94%u4E00%u4E2A%u5916%u90E8%u4E8B%u4EF6%uFF0C%u6765%u5F00%u59CB%u4E00%u4E2Aactivity%u3002%u4E0B%u9762%u662F%u4F8B%u5B50%0A%21%5BAlt%20text%5D%28./1469863153757.png%29%0A%u4F8B%u5B50%u91CC%u9762%u5305%u542B%u4E86%uFF1A%0A-%20send%20signal%0A-%20accept%20signal%0A-%20time%20signal%0A%23%23%23%23Tokens%0A%u8FD9%u4E2A%u6309%u7167Fowler%u5927%u5E08%u7684%u8BF4%u6CD5%uFF0C%u6709%u4E9BUML%u7684%u5927%u90E8%u5934%u8457%u4F5C%u82B1%u4E86%u5927%u7BC7%u5E45%u7684%u6587%u7AE0%u4ECB%u7ECDtoken%u7684%u4F7F%u7528%u3002%u5728%u590D%u6742%u7CFB%u7EDF%u4E2Dtoken%u53EF%u4EE5%u8BA9%u7CFB%u7EDF%u53EF%u6613%u4E8E%u7406%u89E3%uFF0C%u53EF%u89C6%u5316%u66F4%u597D%u3002%0A%3EYou%20can%20visualize%20the%20tokens%20with%20coins%20or%20counters%20moving%20across%20the%20diagram.%20As%20you%20get%20to%20more%20complicated%20examples%20of%20activity%20diagrams%2C%20tokens%20often%20make%20it%20easier%20to%20visualize%20things.%0A%23%23%23%23Flows%20and%20Edges%0A%u8FD9%u91CC%u63D0%u4F9B%u4E86%u51E0%u79CD%u56FE%u4F8B%uFF0C%u6765%u4E30%u5BCC%u6D3B%u52A8%u56FE%u7684%u753B%u6CD5%u3002%u770B%u4F8B%u5B50%u5C31%u53EF%u4EE5%u4E86%uFF1A%0A%21%5BAlt%20text%5D%28./1469863497950.png%29%0A%u540E%u4E24%u4E2A%u56FE%u63D0%u4F9B%u4E86%u5728action%u4E4B%u95F4%u4F20%u9012object%u7684%u65B9%u6CD5%uFF0C%u4ED6%u4EEC%u7565%u6709%u533A%u522B%u3002%u540E%u9762%u4E13%u95E8%u653E%u4E86%u4E00%u8282%u8BB2pin%u3002pin%u53EF%u4EE5%u505A%u53D8%u6362%28transformations%29%uFF0C%u800Cobject%20node%u505A%u4E0D%u5230%u3002%0A%u770B%u7B2C%u4E09%u5E45%u56FE%uFF0Cobject%20node%u7684%u6846%u6846%u662F%u5C16%u89D2%u77E9%u5F62%uFF0C%u800Caction%u662F%u5706%u89D2%u77E9%u5F62%u3002%0A%23%23%23%23Pins%20and%20Transformations%0A%u770B%u4E00%u4E2Apin%20and%20transformation%u7684%u4F8B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1469863936140.png%29%0A%3E%20Pins%20are%20best%20when%20you%20want%20to%20look%20at%20the%20data%20needed%20and%20produced%20by%20the%20various%20actions.%20%0A%3E%20If%20you%20use%20pins%2C%20it%27s%20safe%20to%20show%20multiple%20flows%20coming%20into%20the%20same%20action.%20The%20pin%20notation%0Areinforces%20the%20implicit%20join%0A%23%23%23%23Expansion%20Regions%0A%u8FD9%u4E2A%u4E3B%u8981%u7528%u6765%u63CF%u8FF0%u4E00%u4E2Aactivity%u7684%u8F93%u51FA%u4F1A%u89E6%u53D1%u82E5%u5E72%u4E2Aactivity%u3002%u770B%u4F8B%u56FE%uFF1A%0A%21%5BAlt%20text%5D%28./1469864217899.png%29%0A%u5982%u679C%u6B64%u82E5%u5E72%u4E2Aactivity%u662F%u540C%u4E00%u79CDactivity%u7684%u8BDD%uFF0C%u53EF%u4EE5%u7528expansion%20region%u7684%u7B80%u5199%u6CD5%uFF1A%0A%21%5BAlt%20text%5D%28./1469864349862.png%29%0A%0A%23%23%23%23Flow%20Final%0AFlow%20Final%u63D0%u4F9B%u4E86%u63D0%u524D%u7ED3%u675F%u4E00%u4E2Aactivity%u5206%u652F%u7684%u63CF%u8FF0%u3002%u770B%u4E0B%u9762%u7684%u4F8B%u5B50%uFF0C%u6709%u4E00%u4E2A%u5206%u652F%u5728%u67D0%u4E00%u60C5%u51B5%u4E0B%uFF0C%u76F4%u63A5%u7ED3%u675F%u4E86%u3002%0A%21%5BAlt%20text%5D%28./1469867539007.png%29%0A%0A%23%23%23%23Join%20Specifications%0Ajoin%u4E4B%u524D%u7684%u5224%u65AD%0A%21%5BAlt%20text%5D%28./1469867666058.png%29%0A%0A%u603B%u5F97%u770B%u6765%uFF0Cactivity%20diagram%u53EF%u4EE5%u7528%u6765%u753Bflow%20chart%uFF0C%u800C%u4E14%u63D0%u4F9B%u4E86%u4E00%u4E0B%u66F4%u9177%u7684%u529F%u80FD%u3002%0A]]></content>
      <tags>
        <tag>UML</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Launchy有道翻译插件开发]]></title>
    <url>%2F2016%2F07%2F23%2FLaunchy%E6%9C%89%E9%81%93%E7%BF%BB%E8%AF%91%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%2F</url>
    <content type="text"><![CDATA[Edit &#x4E00;&#x76F4;&#x60F3;&#x505A;&#x4E00;&#x4E2A;&#x65B9;&#x4FBF;&#x67E5;&#x8BCD;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x4E00;&#x5F00;&#x59CB;&#x60F3;&#x501F;&#x52A9;OSX&#x4E0B;&#x9762;&#x6700;&#x706B;&#x7684;Alfred&#xFF0C;&#x505A;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#x3002;&#x7ED3;&#x679C;&#x4EE5;&#x4E3A;&#x8D5A;&#x4FBF;&#x5B9C;&#x6DD8;&#x5B9D;&#x4E0A;50&#x5757;&#x94B1;&#x4E70;&#x4E86;&#x4E00;&#x4E2A;family license&#xFF0C;&#x7ED3;&#x679C;&#x88AB;&#x65E0;&#x826F;&#x5978;&#x5546;&#x9A97;&#x4E86;&#x3002;license&#x6CA1;&#x51E0;&#x5929;&#x5C31;&#x5931;&#x6548;&#x4E86;&#xFF0C;&#x6295;&#x8BC9;&#x65E0;&#x95E8;&#x3002;&#x540E;&#x6765;&#x53D1;&#x73B0;&#x4E00;&#x76F4;&#x5728;&#x7528;&#x7684;Windows&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x795E;&#x5668;Launchy&#xFF0C;&#x4E5F;&#x652F;&#x6301;&#x63D2;&#x4EF6;&#x5F00;&#x53D1;&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x9501;&#x5B9A;&#x76EE;&#x6807;&#xFF0C;&#x505A;&#x4E00;&#x4E2A;Launchy&#x7684;&#x6709;&#x9053;&#x63D2;&#x4EF6;&#x3002; &#x9996;&#x5148;&#x770B;Launchy&#x63D2;&#x4EF6;&#x5F00;&#x53D1;&#x5B98;&#x65B9;&#x9875;&#x3002;&#x4EBA;&#x5BB6;&#x5199;&#x6E05;&#x695A;&#x4E86;&#x73AF;&#x5883;&#x7684;&#x7248;&#x672C;&#x8981;&#x6C42;&#xFF1A;For this setup, we require Visual Studio (preferably 2005 as that is what I use) and QT 4.3.3&#x540E;&#x6765;&#x5C31;&#x56E0;&#x4E3A;&#x7248;&#x672C;&#x95EE;&#x9898;&#x8D70;&#x4E86;&#x5F88;&#x591A;&#x5F2F;&#x8DEF;&#x3002;&#x529F;&#x80FD;&#x6982;&#x8FF0;&#x5FEB;&#x901F;&#x8FDB;&#x5165;&#x63D2;&#x4EF6; - yd&lt;tab&gt;&#x4ECE;&#x526A;&#x8D34;&#x677F;&#x53D6;&#x5355;&#x8BCD;&#xFF0C;&#x6216;&#x81EA;&#x884C;&#x8F93;&#x5165;&#x67E5;&#x5355;&#x8BCD; - &lt;tab&gt;&#x6267;&#x884C;&#x4EFB;&#x610F;&#x7ED3;&#x679C;&#x9879;&#x5747;&#x6253;&#x5F00;&#x5355;&#x8BCD;&#x7684;&#x6709;&#x9053;&#x8BCD;&#x5178;&#x9875;&#x9762;QT&#x73AF;&#x5883;&#x5B89;&#x88C5;QT4 vs.QT5&#x76EE;&#x524D;QT&#x7684;&#x6700;&#x65B0;&#x7248;&#x672C;&#x662F;5.6&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x8D70;&#x5B98;&#x65B9;&#x7528;&#x7F51;&#x7EDC;&#x5B89;&#x88C5;&#x7684;&#x90FD;&#x662F;QT5&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x5F00;&#x59CB;&#xFF0C;&#x50BB;&#x4E4E;&#x4E4E;&#x7684;&#x51C6;&#x5907;&#x628A;&#x539F;&#x5148;&#x7684;&#x63D2;&#x4EF6;&#x6846;&#x67B6;&#x5199;&#x6210;QT5&#x517C;&#x5BB9;&#x3002;QT4&#x5230;QT5&#x505A;&#x4E86;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5F88;&#x591A;&#x7279;&#x6027;&#x4E0D;&#x517C;&#x5BB9;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x53C2;&#x8003;&#x94FE;&#x63A5;&#x5B98;&#x65B9;&#x6307;&#x5F15;Q_EXPORT_PLUGIN2 to Q_PLUGIN_METADATA &#x603B;&#x4E4B;&#x6363;&#x9F13;&#x4E86;&#x5F88;&#x4E45;&#xFF0C;&#x6700;&#x7EC8;&#x653E;&#x5F03;&#x3002;QT&#x5B89;&#x88C5;QT&#x6709;&#x591A;&#x79CD;&#x5B89;&#x88C5;&#x65B9;&#x5F0F;&#xFF1A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x5C31;&#x662F;&#x5B98;&#x7F51;&#xFF0C;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x65B9;&#x5F0F;&#x5B89;&#x88C5;&#xFF0C;&#x6CE8;&#x610F;&#x9009;community&#x548C;open source&#x3002;&#x5176;&#x4ED6;&#x662F;&#x8981;license fee&#x7684;exe&#x5B89;&#x88C5;&#x3002;&#x4EE5;4.8.6&#x4E3A;&#x4F8B;&#xFF0C;&#x5728;QT archive&#x7684;&#x7F51;&#x7AD9;&#x4E0A;&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x5B98;&#x65B9;&#x7528;&#x5404;&#x79CD;&#x7F16;&#x8BD1;&#x5668;&#x7F16;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5B89;&#x88C5;&#x5305;&#x3002;&#x6700;&#x7075;&#x6D3B;&#x7684;&#x5B89;&#x88C5;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x7F16;&#x8BD1;&#x5B89;&#x88C5;&#x4E86;&#x3002;&#x53BB;&#x4E0A;&#x9762;archive&#x7684;&#x7F51;&#x7AD9;&#x4E0B;&#x8F7D;&#x6E90;&#x7801;&#x3002;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x7F16;&#x8BD1;&#x51FA;&#x81EA;&#x5DF1;&#x9700;&#x8981;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x7248;&#x672C;&#x3002;&#x5177;&#x4F53;&#x652F;&#x6301;&#x54EA;&#x4E9B;&#x7F16;&#x8BD1;&#x5E73;&#x53F0;&#x770B;&#x6E90;&#x7801;&#x76EE;&#x5F55;&lt;Qt&gt;\4.6.0\mkspecs\&#xFF0C;&#x4E0B;&#x9762;&#x5217;&#x51FA;&#x4E86;&#x6240;&#x6709;&#x652F;&#x6301;&#x7684;&#x5F00;&#x53D1;&#x5E73;&#x53F0;&#x3002;&#x6709;&#x4E00;&#x70B9;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x6211;&#x6298;&#x817E;QT5&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#xFF0C;QT5&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x652F;&#x6301;VS2015&#x7684;&#x7F16;&#x8BD1;&#x5E73;&#x53F0;&#xFF0C;&#x6700;&#x9AD8;&#x53EA;&#x652F;&#x6301;&#x5230;VS2013&#x3002; &#x56DE;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6309;&#x7167;Launchy&#x5B98;&#x65B9;&#x7684;&#x6307;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;VS2005&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;QT&#x5E93;&#xFF0C;&#x6240;&#x4EE5;archive&#x9875;&#x4E0A;&#x4E5F;&#x6CA1;&#x6709;&#x73B0;&#x6210;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x53EA;&#x597D;&#x81EA;&#x5DF1;&#x7F16;&#x8BD1;&#x3002;&#x4F9D;&#x7136;&#x6709;&#x5B98;&#x65B9;&#x6307;&#x5F15;&#x3002;&#x5176;&#x5B9E;&#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x6240;&#x8C13;&#x4F1A;&#x8005;&#x4E0D;&#x96BE;&#x3002;&#x6709;&#x51E0;&#x4E2A;&#x5730;&#x65B9;&#x8981;&#x6CE8;&#x610F;&#xFF1A;&#x4E0B;&#x8F7D;VS2005&#x7684;&#x65F6;&#x5019;&#x4E00;&#x5B9A;&#x8981;&#x627E;&#x9760;&#x8C31;&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x5426;&#x5219;&#x50CF;&#x6211;&#x4E00;&#x5F00;&#x59CB;&#x88C5;&#x7684;&#x662F;&#x4E2A;&#x7E41;&#x4E2D;&#x7248;&#x672C;&#xFF0C;&#x5404;&#x79CD;&#x9519;&#x8BEF;&#xFF0C;&#x8BA9;&#x4EBA;&#x5F88;&#x662F;&#x90C1;&#x95F7;&#x3002;&#x4E00;&#x5B9A;&#x8981;&#x4ECE;VS&#x7684;command prompt&#x8FDB;&#x53BB;configue&#x548C;compile&#x3002;&#x56E0;&#x4E3A;VS&#x7684;command prompt&#x4F1A;&#x505A;&#x5F88;&#x591A;&#x73AF;&#x5883;&#x914D;&#x7F6E;&#x3002;x86&#x548C;x64&#x662F;&#x4E0D;&#x540C;&#x7684;command prompt&#x5269;&#x4E0B;&#x6765;&#x7684;&#x6309;&#x7167;&#x5B98;&#x65B9;&#x7684;&#x6307;&#x5F15;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x7B80;&#x5355;&#x770B;&#x5982;&#x4E0B;&#xFF1A;configure -platform win32-msvc2005nmakeQT&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x7684;&#x7248;&#x672C;&#x81EA;&#x5E26;&#x4E86;QT Creator&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x5F00;&#x59CB;&#x90FD;&#x662F;&#x7528;&#x4ED6;&#x5728;&#x6298;&#x817E;&#xFF0C;&#x611F;&#x89C9;&#x7528;&#x8D77;&#x6765;&#x8FD8;&#x4E0D;&#x9519;&#xFF0C;&#x6CA1;&#x6709;VS&#x90A3;&#x4E48;&#x81C3;&#x80BF;&#x3002;&#x6362;&#x5230;QT4.8.6&#x4EE5;&#x540E;&#xFF0C;&#x53EF;&#x80FD;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#xFF0C;&#x5F00;&#x4E0D;&#x8D77;&#x6765;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x529E;&#x6CD5;&#x8981;&#x5207;&#x5230;VS2005&#x5E95;&#x4E0B;&#x5F00;&#x53D1;&#x3002;&#x7136;&#x540E;&#x53C8;&#x6478;&#x7D22;&#x4E86;&#x4E00;&#x9635;&#xFF0C;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x4E00;&#x4E2A;VS&#x7684;QT&#x63D2;&#x4EF6;&#x3002;&#x540E;&#x6765;&#x53C8;&#x662F;&#x5728;&#x7248;&#x672C;&#x4E0A;&#x4E00;&#x756A;&#x6298;&#x817E;&#xFF0C;&#x6700;&#x7EC8;&#x9009;&#x5B9A;1.1.11&#xFF0C;&#x914D;&#x5408;VS2005&#x4F7F;&#x7528;&#x65E0;&#x538B;&#x529B;&#x3002;Launchy&#x63D2;&#x4EF6;&#x5F00;&#x53D1;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6309;&#x7167;&#x4F5C;&#x8005;&#x7684;&#x63A8;&#x8350;&#xFF0C;&#x7248;&#x672C;&#x4E00;&#x6B65;&#x4E0D;&#x5DEE;&#xFF0C;&#x6216;&#x8005;&#x5DEE;&#x7684;&#x4E0D;&#x8FDC;&#xFF0C;&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x8DD1;&#x8D77;&#x6765;&#x7684;&#x3002;&#x6700;&#x7EC8;&#x7248;&#x672C;VS2005+QT4.6.0+qt-vs-1.1.11&#x3002; &#x4E2D;&#x95F4;&#x8BD5;&#x8FC7;VS2013&#xFF0C;&#x5982;&#x679C;&#x6574;&#x4E2A;Launchy&#x7528;2013&#x7F16;&#x8BD1;&#xFF0C;&#x63D2;&#x4EF6;&#x4E5F;&#x7528;2013&#x7F16;&#x8BD1;&#x7684;&#x8BDD;&#xFF0C;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x7684;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x79FB;&#x690D;&#x6027;&#x592A;&#x5DEE;&#x4E86;&#xFF0C;&#x7F51;&#x4E0A;&#x4E0B;&#x8F7D;&#x7684;Launchy&#x5C31;&#x6CA1;&#x6CD5;&#x7528;&#x4E86;&#x3002;Launchy&#x63D2;&#x4EF6;&#x7B80;&#x5355;&#x8BF4;&#x4E00;&#x4E0B;Launchy&#x7684;&#x63D2;&#x4EF6;&#x7ED3;&#x6784;&#xFF0C;&#x4EE5;&#x4FBF;&#x672A;&#x6765;&#x5982;&#x679C;&#x8981;&#x8FDB;&#x4E00;&#x6B65;&#x5F00;&#x53D1;&#x53C8;&#x5F97;&#x91CD;&#x65B0;&#x5B66;&#x4E60;&#xFF1A;&#x63D2;&#x4EF6;&#x57FA;&#x4E8E;&#x6D88;&#x606F;&#x5DE5;&#x4F5C; case MSG_INIT: init(); handled = true; break;case MSG_GET_LABELS: // &#x6BCF;&#x4E2A;input&#x53EF;&#x4EE5;&#x6253;label&#xFF0C;&#x4EE5;&#x540E;&#x53EF;&#x4EE5;&#x6839;&#x636E;label&#x6765;&#x7504;&#x522B;&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;&#x63D2;&#x4EF6; getLabels((QList&lt;InputData&gt;*) wParam); handled = true; break;case MSG_GET_ID: getID((uint*) wParam); handled = true; break;case MSG_GET_NAME: getName((QString*) wParam); handled = true; break;case MSG_GET_RESULTS:// &#x5728;&#x8FD9;&#x91CC;&#x4E3A;&#x8F93;&#x5165;&#x63D2;&#x5165;&#x7ED3;&#x679C; getResults((QList&lt;InputData&gt;*) wParam, (QList&lt;CatItem&gt;*) lParam); handled = true; break;case MSG_GET_CATALOG: // catalog&#x662F;Launchy&#x7684;&#x6570;&#x636E;&#x5E93;&#x5165;&#x53E3;&#x3002;&#x5BF9;&#x4E8E;&#x63D2;&#x4EF6;&#x6570;&#x636E;&#x91CF;&#x4E0D;&#x5927;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x8FD9;&#x4E2A; getCatalog((QList&lt;CatItem&gt;*) wParam); handled = true; break;case MSG_LAUNCH_ITEM: // &#x6FC0;&#x53D1;&#x67D0;&#x4E2A;&#x7ED3;&#x679C;&#x9879;&#xFF0C;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;InputData&#x7684;top result //qDebug()&lt;&lt;&quot;Launch&quot;; launchItem((QList&lt;InputData&gt;*) wParam, (CatItem*) lParam); handled = true; break;case MSG_HAS_DIALOG: // Set to true if you provide a gui handled = false; break;case MSG_DO_DIALOG: // This isn&apos;t called unless you return true to MSG_HAS_DIALOG doDialog((QWidget*) wParam, (QWidget**) lParam); break;case MSG_END_DIALOG: // This isn&apos;t called unless you return true to MSG_HAS_DIALOG endDialog((bool) wParam); break;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x8FF7;&#x4FE1;&#x6D3B;&#x52A8;&#x81F3;&#x4ECA;&#x6CA1;&#x7406;&#x89E3;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF1A;void mypluginPlugin::getLabels(QList&lt;InputData&gt;* id){ //&#x6B64;&#x5904;&#x7701;&#x7565;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;... if (id-&gt;first().hasLabel(HASH_myplugin)) { id-&gt;first().setTopResult(CatItem(&quot;&quot;, id-&gt;last().getText(), HASH_myplugin, getIcon())); }}&#x52A0;&#x4E86;&#x8FD9;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EA;&#x51FA;&#x73B0;&#x8DDF;&#x63D2;&#x4EF6;&#x6709;&#x5173;&#x7684;&#x7ED3;&#x679C;&#x9879;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x4F1A;&#x6742;&#x4E03;&#x6742;&#x516B;&#x51FA;&#x73B0;&#x5F88;&#x591A;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x8BF4;InputData&#x7684;top result&#x5F88;&#x5173;&#x952E;&#x3002;&#x8C03;&#x8BD5;&#x5DE5;&#x5177;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x662F;&#x63D2;&#x4EF6;&#x5F00;&#x53D1;&#xFF0C;&#x6CA1;&#x6CD5;&#x5728;&#x7EBF;&#x8C03;&#x8BD5;&#xFF0C;&#x53EA;&#x80FD;&#x7528;qDebug()&lt;&lt;&quot;proxy: &quot;&lt;&lt;proxy;&#x6253;&#x5370;&#x8C03;&#x8BD5;&#x8BED;&#x53E5;&#x3002;&#x53C8;&#x6CA1;&#x6709;&#x547D;&#x4EE4;&#x884C;&#x754C;&#x9762;&#xFF0C;&#x53EA;&#x80FD;&#x501F;&#x52A9;&#x4E00;&#x4E2A;&#x5FAE;&#x8F6F;&#x7684;&#x5DE5;&#x5177;&#x53EB;DebugView&#xFF0C;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x5730;&#x5740;&#x4E0B;&#x8F7D;&#x3002;DebugView&#x5B98;&#x65B9;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x3002; &#x6709;&#x4E86;&#x4ED6;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#x8F93;&#x51FA;&#x4E86;&#x3002;QT&#x76F8;&#x5173;QT&#x8C03;&#x7528;python&#x5176;&#x5B9E;&#x5C31;&#x662F;C++&#x8C03;&#x7528;python&#x3002;&#x7F51;&#x4E0A;&#x641C;&#x5230;&#x7684;&#x4E00;&#x5806;&#x90FD;&#x5927;&#x540C;&#x5C0F;&#x5F02;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;QT&#x4E2D; &#x4F7F;&#x7528;c++&#x8C03;&#x7528;python&#x3002;&#x6700;&#x540E;&#x6211;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x7F16;&#x8BD1;&#x6210;&#x529F;&#xFF0C;&#x8FD0;&#x884C;&#x5931;&#x8D25;&#x3002;&#x539F;&#x56E0;&#xFF0C;&#x6211;&#x603B;&#x7ED3;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x5B9E;&#x548C;QT&#x4EE5;&#x53CA;VS&#x642D;&#x914D;&#x4F7F;&#x7528;&#x65F6;&#x7248;&#x672C;&#x7684;&#x95EE;&#x9898;&#x7C7B;&#x4F3C;&#x3002;C++&#x8C03;&#x7528;python&#x7684;&#x63A5;&#x53E3;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x5728;python27.lib&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x3002;&#x8FD9;&#x4E2A;lib&#x4F7F;&#x7528;&#x7684;&#x7F16;&#x8BD1;&#x5E73;&#x53F0;&#xFF0C;&#x8981;&#x548C;&#x4F60;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x7F16;&#x8BD1;&#x5E73;&#x53F0;&#x4E00;&#x81F4;&#x3002;&#x4E0D;&#x8FC7;&#x770B;&#x8D77;&#x6765;&#x86EE;&#x8BF1;&#x4EBA;&#x7684;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E0D;&#x77E5;&#x9053;&#x6709;&#x591A;&#x5C11;&#x53EF;&#x80FD;&#x80FD;&#x7528;&#x5F97;&#x4E0A;&#x3002;QProcess&#x653E;&#x5F03;python27.lib&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x8F6C;&#x5230;QProcess&#x4E0A;&#x6765;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x5176;&#x5B9E;&#x5C31;&#x662F;QT&#x7B80;&#x5355;&#x7684;&#x8C03;&#x7528;&#x547D;&#x4EE4;&#x884C;&#x7A0B;&#x5E8F;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x53D8;&#x6001;&#x7684;&#x662F;&#x4E00;&#x65E6;&#x547D;&#x4EE4;&#x51FA;&#x9519;&#xFF0C;&#x4EC0;&#x4E48;&#x4FE1;&#x606F;&#x4E5F;&#x6253;&#x4E0D;&#x51FA;&#x6765;&#xFF0C;&#x522B;&#x770B;&#x4ED6;&#x6709;readStandardError&#x63A5;&#x53E3;&#x3002;&#x5728;&#x4F7F;&#x7528;QProcess&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B66;&#x4E60;&#x5230;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#xFF1A;Windows&#x5E95;&#x4E0B;&#x5728;&#x4EE3;&#x7801;&#x91CC;&#x8981;&#x7528;&#x4E2D;&#x6587;&#x5FC5;&#x987B;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x524D;&#x9762;&#x52A0;L&#xFF0C;&#x5982;L&quot;&#x6709;&#x9053;&#x7FFB;&#x8BD1;&quot;&#x3002;&#x8FD9;&#x6837;Windows&#x624D;&#x80FD;&#x8BC6;&#x522B;&#x5230;&#x8FD9;&#x4E2A;&#x662F;WCHAR&#xFF0C;Windows&#x5E73;&#x53F0;&#x7684;&#x53CC;&#x5B57;&#x8282;&#x7F16;&#x7801;QT&#x91CC;&#x9762;&#x6240;&#x6709;&#x7684;QString&#x90FD;&#x662F;unicode&#xFF0C;&#x5982;QString::fromWCharArray(L&quot;&#x6709;&#x9053;&#x7FFB;&#x8BD1;)QJson&#x672C;&#x6765;&#x6253;&#x7B97;&#x627E;&#x4E00;&#x4E2A;&#x5E93;&#x6765;&#x89E3;&#x6790;&#x6709;&#x9053;API&#x8FD4;&#x56DE;&#x7684;json&#x6570;&#x636E;&#xFF0C;&#x4E0D;&#x8FC7;&#x540E;&#x6765;&#x672C;&#x7740;&#x5C0F;&#x800C;&#x7F8E;&#x7684;&#x7CBE;&#x795E;&#xFF0C;&#x653E;&#x5F03;&#x4E86;&#x89E3;&#x6790;&#x6574;&#x4E2A;json&#x6570;&#x636E;&#x7684;&#x4F01;&#x56FE;&#xFF0C;&#x53EA;&#x5355;&#x7EAF;&#x7684;&#x89E3;&#x6790;&#x591A;&#x884C;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x4E0D;&#x8FC7;&#x8FD8;&#x662F;&#x770B;&#x4E86;&#x4E00;&#x4E9B;&#x8D44;&#x6599;&#xFF0C;&#x6240;&#x4EE5;&#x8BB0;&#x4E0B;&#x6765;&#x4E07;&#x4E00;&#x4EE5;&#x540E;&#x7528;&#x5F97;&#x4E0A;&#x3002; QJson&#x662F;&#x4E00;&#x4E2A;QT&#x7684;&#x5F00;&#x6E90;&#x5E93;&#xFF0C;&#x5728;git hub&#x4E0A;&#xFF0C;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x6E90;&#x7801;&#x81EA;&#x5DF1;&#x7F16;&#x8BD1;&#x3002;&#x7F16;&#x51FA;&#x6765;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;.lib&#x548C;&#x4E00;&#x4E2A;.dll&#x3002;&#x5206;&#x522B;&#x653E;&#x5230;C:\Qt\4.6.0\lib&#x548C;C:\Qt\4.6.0\bin\&#x5E95;&#x4E0B;&#xFF0C;&#x5E76;&#x5728;.pro&#x6587;&#x4EF6;&#x91CC;&#x5F15;&#x7528;&#x5C31;&#x53EF;&#x4EE5;&#x7528;&#x4E86;&#x3002;&#x8BB0;&#x5F97;&#x54E6;&#xFF0C;&#x4E0E;&#x4F60;&#x7684;&#x4E3B;&#x7A0B;&#x5E8F;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x7F16;&#x8BD1;&#x5E73;&#x53F0;&#x3002;&#x53E6;&#x5916;QT5&#x5DF2;&#x7ECF;&#x9ED8;&#x8BA4;&#x5185;&#x7F6E;json&#x89E3;&#x6790;&#x5E93;&#x4E86;&#x3002; &#x4F7F;&#x7528;QJson&#x7684;&#x65B9;&#x6CD5;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863; &#x53E6;&#x5916;&#x4E00;&#x79CD;&#x89E3;&#x6790;json&#x6570;&#x636E;&#x7684;&#x601D;&#x8DEF;&#x662F;&#x7528;QT4&#x5185;&#x7F6E;&#x7684;QScriptEngine&#x3002;&#x6CA1;&#x6DF1;&#x7A76;&#x8FC7;&#xFF0C;&#x4F46;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x5E93;&#x662F;&#x8BA9;QT&#x66F4;&#x597D;&#x5730;&#x548C;JavaScript&#x878D;&#x5408;&#x4F7F;&#x7528;&#x8BDE;&#x751F;&#x7684;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x770B;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;-QScriptEngine Printout to String as JSON&#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x94FE;&#x63A5;&#x5728;&#x7EBF;&#x7F16;&#x7801;&#x89E3;&#x7801;JS/HTML&#x683C;&#x5F0F;&#x5316;%23Launchy%u6709%u9053%u7FFB%u8BD1%u63D2%u4EF6%u5F00%u53D1%0A@%28%u5DE5%u4F5C%u7B14%u8BB0%29%5BQT%5D%0A%u4E00%u76F4%u60F3%u505A%u4E00%u4E2A%u65B9%u4FBF%u67E5%u8BCD%u7684%u5DE5%u5177%u3002%u4E00%u5F00%u59CB%u60F3%u501F%u52A9OSX%u4E0B%u9762%u6700%u706B%u7684Alfred%uFF0C%u505A%u4E00%u4E2A%u63D2%u4EF6%u3002%u7ED3%u679C%u4EE5%u4E3A%u8D5A%u4FBF%u5B9C%u6DD8%u5B9D%u4E0A50%u5757%u94B1%u4E70%u4E86%u4E00%u4E2Afamily%20license%uFF0C%u7ED3%u679C%u88AB%u65E0%u826F%u5978%u5546%u9A97%u4E86%u3002license%u6CA1%u51E0%u5929%u5C31%u5931%u6548%u4E86%uFF0C%u6295%u8BC9%u65E0%u95E8%u3002%u540E%u6765%u53D1%u73B0%u4E00%u76F4%u5728%u7528%u7684Windows%u5FEB%u6377%u65B9%u5F0F%u795E%u5668Launchy%uFF0C%u4E5F%u652F%u6301%u63D2%u4EF6%u5F00%u53D1%u3002%u4E8E%u662F%uFF0C%u9501%u5B9A%u76EE%u6807%uFF0C%u505A%u4E00%u4E2ALaunchy%u7684%u6709%u9053%u63D2%u4EF6%u3002%0A%u9996%u5148%u770B%5BLaunchy%u63D2%u4EF6%u5F00%u53D1%u5B98%u65B9%u9875%5D%28http%3A//www.launchy.net/api2.0/%29%u3002%u4EBA%u5BB6%u5199%u6E05%u695A%u4E86%u73AF%u5883%u7684%u7248%u672C%u8981%u6C42%uFF1A%0A%3EFor%20this%20setup%2C%20we%20require%20**Visual%20Studio%20%28preferably%202005**%20as%20that%20is%20what%20I%20use%29%20and%20**QT%204.3.3**%0A%0A%u540E%u6765%u5C31%u56E0%u4E3A%u7248%u672C%u95EE%u9898%u8D70%u4E86%u5F88%u591A%u5F2F%u8DEF%u3002%0A%23%23%u529F%u80FD%u6982%u8FF0%0A1.%20%u5FEB%u901F%u8FDB%u5165%u63D2%u4EF6%20-%20yd%26lt%3Btab%26gt%3B%0A2.%20%u4ECE%u526A%u8D34%u677F%u53D6%u5355%u8BCD%uFF0C%u6216%u81EA%u884C%u8F93%u5165%0A%21%5BAlt%20text%5D%28./1469437387713.png%29%0A%21%5BAlt%20text%5D%28./1469437454898.png%29%0A3.%20%u67E5%u5355%u8BCD%20-%20%26lt%3Btab%26gt%3B%0A%20%21%5BAlt%20text%5D%28./1469437302454.png%29%0A4.%20%u6267%u884C%u4EFB%u610F%u7ED3%u679C%u9879%u5747%u6253%u5F00%u5355%u8BCD%u7684%u6709%u9053%u8BCD%u5178%u9875%u9762%0A%21%5BAlt%20text%5D%28./1469437529508.png%29%0A%0A%23%23QT%u73AF%u5883%u5B89%u88C5%0A%23%23%23QT4%20vs.QT5%0A%u76EE%u524DQT%u7684%u6700%u65B0%u7248%u672C%u662F5.6%uFF0C%u6240%u4EE5%u76F4%u63A5%u8D70%u5B98%u65B9%u7528%u7F51%u7EDC%u5B89%u88C5%u7684%u90FD%u662FQT5%u3002%u6240%u4EE5%u4E00%u5F00%u59CB%uFF0C%u50BB%u4E4E%u4E4E%u7684%u51C6%u5907%u628A%u539F%u5148%u7684%u63D2%u4EF6%u6846%u67B6%u5199%u6210QT5%u517C%u5BB9%u3002QT4%u5230QT5%u505A%u4E86%u5927%u89C4%u6A21%u7684%u53D8%u5316%uFF0C%u5F88%u591A%u7279%u6027%u4E0D%u517C%u5BB9%u3002%u4E0B%u9762%u662F%u4E00%u4E9B%u53C2%u8003%u94FE%u63A5%0A*%20%5B%u5B98%u65B9%u6307%u5F15%5D%28http%3A//wiki.qt.io/Transition_from_Qt_4.x_to_Qt5%29%0A*%20%5BQ_EXPORT_PLUGIN2%20to%20Q_PLUGIN_METADATA%5D%28http%3A//osdir.com/ml/kde-commits/2015-03/msg07583.html%29%0A%u603B%u4E4B%u6363%u9F13%u4E86%u5F88%u4E45%uFF0C%u6700%u7EC8%u653E%u5F03%u3002%0A%23%23%23QT%u5B89%u88C5%0AQT%u6709%u591A%u79CD%u5B89%u88C5%u65B9%u5F0F%uFF1A%0A1.%20%u6700%u7B80%u5355%u7684%u5C31%u662F%5B%u5B98%u7F51%5D%28https%3A//www.qt.io/download/%29%uFF0C%u901A%u8FC7%u7F51%u7EDC%u65B9%u5F0F%u5B89%u88C5%uFF0C%u6CE8%u610F%u9009community%u548Copen%20source%u3002%u5176%u4ED6%u662F%u8981license%20fee%u7684%0A2.%20exe%u5B89%u88C5%u3002%u4EE5%5B4.8.6%5D%28https%3A//download.qt.io/archive/qt/4.8/4.8.6/%29%u4E3A%u4F8B%uFF0C%u5728QT%20archive%u7684%u7F51%u7AD9%u4E0A%u53EF%u4EE5%u4E0B%u8F7D%u5B98%u65B9%u7528%u5404%u79CD%u7F16%u8BD1%u5668%u7F16%u597D%u7684%u4E8C%u8FDB%u5236%u5B89%u88C5%u5305%u3002%0A%21%5BAlt%20text%5D%28./1469352211795.png%29%0A3.%20%u6700%u7075%u6D3B%u7684%u5B89%u88C5%u65B9%u5F0F%u5C31%u662F%u7F16%u8BD1%u5B89%u88C5%u4E86%u3002%u53BB%u4E0A%u9762archive%u7684%u7F51%u7AD9%u4E0B%u8F7D%5B%u6E90%u7801%5D%28https%3A//download.qt.io/archive/qt/4.8/4.8.6/qt-everywhere-opensource-src-4.8.6.zip%29%u3002%u597D%u5904%u662F%u53EF%u4EE5%u7F16%u8BD1%u51FA%u81EA%u5DF1%u9700%u8981%u7684%u7F16%u8BD1%u5668%u7684%u7248%u672C%u3002%u5177%u4F53%u652F%u6301%u54EA%u4E9B%u7F16%u8BD1%u5E73%u53F0%u770B%u6E90%u7801%u76EE%u5F55%60%3CQt%3E%5C4.6.0%5Cmkspecs%5C%60%uFF0C%u4E0B%u9762%u5217%u51FA%u4E86%u6240%u6709%u652F%u6301%u7684%u5F00%u53D1%u5E73%u53F0%u3002%0A%0A%0A%u6709%u4E00%u70B9%u5F88%u6709%u610F%u601D%u7684%u662F%uFF0C%u5728%u6211%u6298%u817EQT5%u7684%u65F6%u5019%u53D1%u73B0%uFF0CQT5%u76EE%u524D%u8FD8%u4E0D%u652F%u6301VS2015%u7684%u7F16%u8BD1%u5E73%u53F0%uFF0C%u6700%u9AD8%u53EA%u652F%u6301%u5230VS2013%u3002%0A%u56DE%u5230%u6211%u4EEC%u7684%u9700%u6C42%u4E0A%uFF0C%u53EF%u4EE5%u770B%u5230%uFF0C%u6309%u7167Launchy%u5B98%u65B9%u7684%u6307%u70B9%uFF0C%u6211%u4EEC%u9700%u8981VS2005%uFF0C%u4EE5%u53CA%u5BF9%u5E94%u7684QT%u5E93%uFF0C%u6240%u4EE5archive%u9875%u4E0A%u4E5F%u6CA1%u6709%u73B0%u6210%u7684%u4E8C%u8FDB%u5236%u5B89%u88C5%u5305%uFF0C%u53EA%u597D%u81EA%u5DF1%u7F16%u8BD1%u3002%u4F9D%u7136%u6709%5B%u5B98%u65B9%u6307%u5F15%5D%28http%3A//doc.qt.io/qt-4.8/install-win.html%29%u3002%u5176%u5B9E%u5F88%u5BB9%u6613%uFF0C%u6240%u8C13%u4F1A%u8005%u4E0D%u96BE%u3002%u6709%u51E0%u4E2A%u5730%u65B9%u8981%u6CE8%u610F%uFF1A%0A1.%20%u4E0B%u8F7DVS2005%u7684%u65F6%u5019%u4E00%u5B9A%u8981%u627E%u9760%u8C31%u7684%u5B89%u88C5%uFF0C%u5426%u5219%u50CF%u6211%u4E00%u5F00%u59CB%u88C5%u7684%u662F%u4E2A%u7E41%u4E2D%u7248%u672C%uFF0C%u5404%u79CD%u9519%u8BEF%uFF0C%u8BA9%u4EBA%u5F88%u662F%u90C1%u95F7%u3002%0A2.%20%u4E00%u5B9A%u8981%u4ECEVS%u7684command%20prompt%u8FDB%u53BBconfigue%u548Ccompile%u3002%u56E0%u4E3AVS%u7684command%20prompt%u4F1A%u505A%u5F88%u591A%u73AF%u5883%u914D%u7F6E%u3002%0A3.%20x86%u548Cx64%u662F%u4E0D%u540C%u7684command%20prompt%0A%0A%u5269%u4E0B%u6765%u7684%u6309%u7167%u5B98%u65B9%u7684%u6307%u5F15%u5C31%u53EF%u4EE5%u4E86%uFF0C%u7B80%u5355%u770B%u5982%u4E0B%uFF1A%0A%60%60%60%0Aconfigure%20-platform%20win32-msvc2005%0Anmake%0A%60%60%60%0A%23%23%23QT%u5F00%u53D1%u73AF%u5883%0A%u5B98%u7F51%u5B89%u88C5%u7684%u7248%u672C%u81EA%u5E26%u4E86QT%20Creator%u3002%u6240%u4EE5%u4E00%u5F00%u59CB%u90FD%u662F%u7528%u4ED6%u5728%u6298%u817E%uFF0C%u611F%u89C9%u7528%u8D77%u6765%u8FD8%u4E0D%u9519%uFF0C%u6CA1%u6709VS%u90A3%u4E48%u81C3%u80BF%u3002%u6362%u5230QT4.8.6%u4EE5%u540E%uFF0C%u53EF%u80FD%u7248%u672C%u8FC7%u4F4E%uFF0C%u5F00%u4E0D%u8D77%u6765%uFF0C%u6240%u4EE5%u6CA1%u529E%u6CD5%u8981%u5207%u5230VS2005%u5E95%u4E0B%u5F00%u53D1%u3002%u7136%u540E%u53C8%u6478%u7D22%u4E86%u4E00%u9635%uFF0C%u9700%u8981%u5B89%u88C5%u4E00%u4E2AVS%u7684QT%u63D2%u4EF6%u3002%u540E%u6765%u53C8%u662F%u5728%u7248%u672C%u4E0A%u4E00%u756A%u6298%u817E%uFF0C%u6700%u7EC8%u9009%u5B9A%5B1.1.11%5D%28https%3A//download.qt.io/official_releases/vsaddin/%29%uFF0C%u914D%u5408VS2005%u4F7F%u7528%u65E0%u538B%u529B%u3002%0A%0A%23%23Launchy%u63D2%u4EF6%u5F00%u53D1%0A%u5176%u5B9E%u5F88%u7B80%u5355%uFF0C%u6309%u7167%u4F5C%u8005%u7684%u63A8%u8350%uFF0C%u7248%u672C%u4E00%u6B65%u4E0D%u5DEE%uFF0C%u6216%u8005%u5DEE%u7684%u4E0D%u8FDC%uFF0C%u90FD%u662F%u53EF%u4EE5%u8DD1%u8D77%u6765%u7684%u3002%u6700%u7EC8%u7248%u672C**VS2005+QT4.6.0+qt-vs-1.1.11**%u3002%0A%u4E2D%u95F4%u8BD5%u8FC7VS2013%uFF0C%u5982%u679C%u6574%u4E2ALaunchy%u75282013%u7F16%u8BD1%uFF0C%u63D2%u4EF6%u4E5F%u75282013%u7F16%u8BD1%u7684%u8BDD%uFF0C%u662F%u53EF%u4EE5%u7528%u7684%u3002%u4F46%u662F%u8FD9%u6837%u79FB%u690D%u6027%u592A%u5DEE%u4E86%uFF0C%u7F51%u4E0A%u4E0B%u8F7D%u7684Launchy%u5C31%u6CA1%u6CD5%u7528%u4E86%u3002%0A%23%23%23Launchy%u63D2%u4EF6%0A%u7B80%u5355%u8BF4%u4E00%u4E0BLaunchy%u7684%u63D2%u4EF6%u7ED3%u6784%uFF0C%u4EE5%u4FBF%u672A%u6765%u5982%u679C%u8981%u8FDB%u4E00%u6B65%u5F00%u53D1%u53C8%u5F97%u91CD%u65B0%u5B66%u4E60%uFF1A%0A%23%23%23%23%u63D2%u4EF6%u57FA%u4E8E%u6D88%u606F%u5DE5%u4F5C%0A%60%60%60%09%0A%09%09case%20MSG_INIT%3A%0A%09init%28%29%3B%0A%09handled%20%3D%20true%3B%0A%09break%3B%0Acase%20MSG_GET_LABELS%3A%20//%20%u6BCF%u4E2Ainput%u53EF%u4EE5%u6253label%uFF0C%u4EE5%u540E%u53EF%u4EE5%u6839%u636Elabel%u6765%u7504%u522B%u5C5E%u4E8E%u54EA%u4E2A%u63D2%u4EF6%0A%09getLabels%28%28QList%3CInputData%3E*%29%20wParam%29%3B%0A%09handled%20%3D%20true%3B%0A%09break%3B%0Acase%20MSG_GET_ID%3A%0A%09getID%28%28uint*%29%20wParam%29%3B%0A%09handled%20%3D%20true%3B%0A%09break%3B%0Acase%20MSG_GET_NAME%3A%0A%09getName%28%28QString*%29%20wParam%29%3B%0A%09handled%20%3D%20true%3B%0A%09break%3B%0Acase%20MSG_GET_RESULTS%3A//%20%u5728%u8FD9%u91CC%u4E3A%u8F93%u5165%u63D2%u5165%u7ED3%u679C%0A%09getResults%28%28QList%3CInputData%3E*%29%20wParam%2C%20%28QList%3CCatItem%3E*%29%20lParam%29%3B%0A%09handled%20%3D%20true%3B%0A%09break%3B%0Acase%20MSG_GET_CATALOG%3A%20//%20catalog%u662FLaunchy%u7684%u6570%u636E%u5E93%u5165%u53E3%u3002%u5BF9%u4E8E%u63D2%u4EF6%u6570%u636E%u91CF%u4E0D%u5927%u7684%u8BDD%uFF0C%u53EF%u4EE5%u5FFD%u7565%u8FD9%u4E2A%0A%09getCatalog%28%28QList%3CCatItem%3E*%29%20wParam%29%3B%0A%09handled%20%3D%20true%3B%0A%09break%3B%0Acase%20MSG_LAUNCH_ITEM%3A%20//%20%u6FC0%u53D1%u67D0%u4E2A%u7ED3%u679C%u9879%uFF0C%u8FD9%u91CC%u8981%u6CE8%u610FInputData%u7684top%20result%0A%09//qDebug%28%29%3C%3C%22Launch%22%3B%0A%09launchItem%28%28QList%3CInputData%3E*%29%20wParam%2C%20%28CatItem*%29%20lParam%29%3B%0A%09handled%20%3D%20true%3B%0A%09break%3B%0Acase%20MSG_HAS_DIALOG%3A%0A%09//%20Set%20to%20true%20if%20you%20provide%20a%20gui%0A%09handled%20%3D%20false%3B%0A%09break%3B%0Acase%20MSG_DO_DIALOG%3A%0A%09//%20This%20isn%27t%20called%20unless%20you%20return%20true%20to%20MSG_HAS_DIALOG%0A%09doDialog%28%28QWidget*%29%20wParam%2C%20%28QWidget**%29%20lParam%29%3B%0A%09break%3B%0Acase%20MSG_END_DIALOG%3A%0A%09//%20This%20isn%27t%20called%20unless%20you%20return%20true%20to%20MSG_HAS_DIALOG%0A%09endDialog%28%28bool%29%20wParam%29%3B%0A%09break%3B%0A%60%60%60%0A%0A%23%23%23%23%u8FD8%u6709%u4E00%u4E9B%u8FF7%u4FE1%u6D3B%u52A8%0A%u81F3%u4ECA%u6CA1%u7406%u89E3%u662F%u4E3A%u4EC0%u4E48%uFF0C%u770B%u4E0B%u9762%u7684%u4EE3%u7801%uFF1A%0A%60%60%60%0Avoid%20mypluginPlugin%3A%3AgetLabels%28QList%3CInputData%3E*%20id%29%0A%7B%0A%09//%u6B64%u5904%u7701%u7565%u4E00%u6BB5%u4EE3%u7801...%0A%09if%20%28id-%3Efirst%28%29.hasLabel%28HASH_myplugin%29%29%0A%09%7B%0A%09%09id-%3Efirst%28%29.setTopResult%28CatItem%28%22%22%2C%20id-%3Elast%28%29.getText%28%29%2C%20HASH_myplugin%2C%20getIcon%28%29%29%29%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u52A0%u4E86%u8FD9%u4E00%u6BB5%u4EE3%u7801%u4E4B%u540E%uFF0C%u5C31%u53EA%u51FA%u73B0%u8DDF%u63D2%u4EF6%u6709%u5173%u7684%u7ED3%u679C%u9879%uFF0C%u5982%u679C%u6CA1%u6709%u8FD9%u4E00%u6BB5%u4EE3%u7801%uFF0C%u5C31%u4F1A%u6742%u4E03%u6742%u516B%u51FA%u73B0%u5F88%u591A%u3002%u6240%u4EE5%u6211%u8BF4InputData%u7684top%20result%u5F88%u5173%u952E%u3002%0A%21%5BAlt%20text%5D%28./1469435667177.png%29%0A%23%23%23%23%u8C03%u8BD5%u5DE5%u5177%0A%u56E0%u4E3A%u6211%u4EEC%u662F%u63D2%u4EF6%u5F00%u53D1%uFF0C%u6CA1%u6CD5%u5728%u7EBF%u8C03%u8BD5%uFF0C%u53EA%u80FD%u7528%60qDebug%28%29%3C%3C%22proxy%3A%20%22%3C%3Cproxy%3B%60%u6253%u5370%u8C03%u8BD5%u8BED%u53E5%u3002%u53C8%u6CA1%u6709%u547D%u4EE4%u884C%u754C%u9762%uFF0C%u53EA%u80FD%u501F%u52A9%u4E00%u4E2A%u5FAE%u8F6F%u7684%u5DE5%u5177%u53EBDebugView%uFF0C%u5728%u4E0B%u9762%u7684%u5730%u5740%u4E0B%u8F7D%u3002%5BDebugView%u5B98%u65B9%u4E0B%u8F7D%u5730%u5740%5D%28https%3A//technet.microsoft.com/en-us/sysinternals/debugview.aspx%29%u3002%0A%u6709%u4E86%u4ED6%u5C31%u53EF%u4EE5%u770B%u8C03%u8BD5%u4FE1%u606F%u8F93%u51FA%u4E86%u3002%0A%23%23%23QT%u76F8%u5173%0A%23%23%23%23QT%u8C03%u7528python%0A%u5176%u5B9E%u5C31%u662FC++%u8C03%u7528python%u3002%u7F51%u4E0A%u641C%u5230%u7684%u4E00%u5806%u90FD%u5927%u540C%u5C0F%u5F02%u3002%u4E3E%u4E2A%u4F8B%u5B50%5BQT%u4E2D%20%u4F7F%u7528c++%u8C03%u7528python%5D%28http%3A//www.cnblogs.com/shenghl/p/4442528.html%29%u3002%u6700%u540E%u6211%u5931%u8D25%u4E86%uFF0C%u7F16%u8BD1%u6210%u529F%uFF0C%u8FD0%u884C%u5931%u8D25%u3002%u539F%u56E0%uFF0C%u6211%u603B%u7ED3%u4E86%u4E00%u4E0B%uFF0C%u5176%u5B9E%u548CQT%u4EE5%u53CAVS%u642D%u914D%u4F7F%u7528%u65F6%u7248%u672C%u7684%u95EE%u9898%u7C7B%u4F3C%u3002C++%u8C03%u7528python%u7684%u63A5%u53E3%u51FD%u6570%u90FD%u662F%u5728python27.lib%u4E2D%u5B9A%u4E49%u7684%u3002%u8FD9%u4E2Alib%u4F7F%u7528%u7684%u7F16%u8BD1%u5E73%u53F0%uFF0C%u8981%u548C%u4F60%u73B0%u5728%u4F7F%u7528%u7684%u7F16%u8BD1%u5E73%u53F0%u4E00%u81F4%u3002%u4E0D%u8FC7%u770B%u8D77%u6765%u86EE%u8BF1%u4EBA%u7684%uFF0C%u4E0D%u8FC7%u4E0D%u77E5%u9053%u6709%u591A%u5C11%u53EF%u80FD%u80FD%u7528%u5F97%u4E0A%u3002%0A%23%23%23%23QProcess%0A%u653E%u5F03python27.lib%u4E4B%u540E%uFF0C%u5C31%u8F6C%u5230QProcess%u4E0A%u6765%u4E86%u3002%u8FD9%u4E2A%u5176%u5B9E%u5C31%u662FQT%u7B80%u5355%u7684%u8C03%u7528%u547D%u4EE4%u884C%u7A0B%u5E8F%u3002%u4F46%u662F%u8FD9%u4E2A%u53D8%u6001%u7684%u662F%u4E00%u65E6%u547D%u4EE4%u51FA%u9519%uFF0C%u4EC0%u4E48%u4FE1%u606F%u4E5F%u6253%u4E0D%u51FA%u6765%uFF0C%u522B%u770B%u4ED6%u6709readStandardError%u63A5%u53E3%u3002%u5728%u4F7F%u7528QProcess%u7684%u65F6%u5019%uFF0C%u5B66%u4E60%u5230%u4EE5%u4E0B%u51E0%u70B9%uFF1A%0A1.%20Windows%u5E95%u4E0B%u5728%u4EE3%u7801%u91CC%u8981%u7528%u4E2D%u6587%u5FC5%u987B%u5728%u5B57%u7B26%u4E32%u524D%u9762%u52A0L%uFF0C%u5982%60L%22%u6709%u9053%u7FFB%u8BD1%22%60%u3002%u8FD9%u6837Windows%u624D%u80FD%u8BC6%u522B%u5230%u8FD9%u4E2A%u662FWCHAR%uFF0CWindows%u5E73%u53F0%u7684%u53CC%u5B57%u8282%u7F16%u7801%0A2.%20QT%u91CC%u9762%u6240%u6709%u7684QString%u90FD%u662Funicode%uFF0C%u5982%60QString%3A%3AfromWCharArray%28L%22%u6709%u9053%u7FFB%u8BD1%29%60%0A%23%23%23%23QJson%0A%u672C%u6765%u6253%u7B97%u627E%u4E00%u4E2A%u5E93%u6765%u89E3%u6790%u6709%u9053API%u8FD4%u56DE%u7684json%u6570%u636E%uFF0C%u4E0D%u8FC7%u540E%u6765%u672C%u7740%u5C0F%u800C%u7F8E%u7684%u7CBE%u795E%uFF0C%u653E%u5F03%u4E86%u89E3%u6790%u6574%u4E2Ajson%u6570%u636E%u7684%u4F01%u56FE%uFF0C%u53EA%u5355%u7EAF%u7684%u89E3%u6790%u591A%u884C%u5B57%u7B26%u4E32%u3002%u4E0D%u8FC7%u8FD8%u662F%u770B%u4E86%u4E00%u4E9B%u8D44%u6599%uFF0C%u6240%u4EE5%u8BB0%u4E0B%u6765%u4E07%u4E00%u4EE5%u540E%u7528%u5F97%u4E0A%u3002%0A%5BQJson%5D%28https%3A//github.com/flavio/qjson%29%u662F%u4E00%u4E2AQT%u7684%u5F00%u6E90%u5E93%uFF0C%u5728git%20hub%u4E0A%uFF0C%u9700%u8981%u4E0B%u8F7D%u6E90%u7801%u81EA%u5DF1%u7F16%u8BD1%u3002%u7F16%u51FA%u6765%u4F1A%u6709%u4E00%u4E2A.lib%u548C%u4E00%u4E2A.dll%u3002%u5206%u522B%u653E%u5230C%3A%5CQt%5C4.6.0%5Clib%u548CC%3A%5CQt%5C4.6.0%5Cbin%5C%u5E95%u4E0B%uFF0C%u5E76%u5728.pro%u6587%u4EF6%u91CC%u5F15%u7528%u5C31%u53EF%u4EE5%u7528%u4E86%u3002%u8BB0%u5F97%u54E6%uFF0C%u4E0E%u4F60%u7684%u4E3B%u7A0B%u5E8F%u7528%u540C%u4E00%u4E2A%u7F16%u8BD1%u5E73%u53F0%u3002%u53E6%u5916QT5%u5DF2%u7ECF%u9ED8%u8BA4%u5185%u7F6Ejson%u89E3%u6790%u5E93%u4E86%u3002%0A%u4F7F%u7528QJson%u7684%u65B9%u6CD5%u770B%5B%u5B98%u65B9%u6587%u6863%5D%28http%3A//qjson.sourceforge.net/docs/%29%0A%u53E6%u5916%u4E00%u79CD%u89E3%u6790json%u6570%u636E%u7684%u601D%u8DEF%u662F%u7528QT4%u5185%u7F6E%u7684QScriptEngine%u3002%u6CA1%u6DF1%u7A76%u8FC7%uFF0C%u4F46%u77E5%u9053%u8FD9%u4E2A%u5E93%u662F%u8BA9QT%u66F4%u597D%u5730%u548CJavaScript%u878D%u5408%u4F7F%u7528%u8BDE%u751F%u7684%uFF0C%u5177%u4F53%u53EF%u4EE5%u770B%u8FD9%u4E2A%u94FE%u63A5-%5BQScriptEngine%20Printout%20to%20String%20as%20JSON%5D%28http%3A//www.qtcentre.org/threads/30874-QScriptEngine-Printout-to-String-as-JSON%29%0A%23%23%23%u4E00%u4E9B%u6709%u7528%u7684%u94FE%u63A5%0A-%20%5B%u5728%u7EBF%u7F16%u7801%u89E3%u7801%5D%28http%3A//bianma.911cha.com/%29%0A-%20%5BJS/HTML%u683C%u5F0F%u5316%5D%28http%3A//tool.chinaz.com/Tools/jsformat.aspx%3Fjdfwkey%3Dwslz01%29%0A%0A]]></content>
      <tags>
        <tag>QT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javascript之Promise]]></title>
    <url>%2F2016%2F03%2F09%2FJavascript%E4%B9%8BPromise%2F</url>
    <content type="text"><![CDATA[EditJavascript&#x4E4B;PromisePromise&#x7684;&#x672F;&#x8BED;&#x5982;&#x4F55;&#x4F7F;&#x7528;Promise&#x6784;&#x9020;&#x51FD;&#x6570;resolve &amp; reject&#x9519;&#x8BEF;&#x5904;&#x7406;&#x9AD8;&#x7EA7;Promise&#x521B;&#x5EFA;&#x5E8F;&#x5217;Promise&#x7684;&#x610F;&#x601D;&#x662F;&#x7EA6;&#x5B9A;&#xFF0C;&#x76F8;&#x5BF9;&#x5E94;&#x7684;&#x8BCD;&#x662F;Defer&#xFF0C;&#x662F;&#x63A8;&#x8FDF;&#x3002;&#x4ED6;&#x7684;&#x7528;&#x610F;&#x662F;&#x5728;&#x5F02;&#x6B65;&#x7684;JavaScript&#x4E16;&#x754C;&#x5F15;&#x5165;&#x540C;&#x6B65;&#x5199;&#x6CD5;&#x3002;&#x770B;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x201C;&#x90AA;&#x6076;&#x91D1;&#x5B57;&#x5854;&#x201D;&#x3002;var fs = require(&apos;fs&apos;);fs.readFile(&apos;sample01.txt&apos;, &apos;utf8&apos;, function (err, data) { fs.readFile(&apos;sample02.txt&apos;, &apos;utf8&apos;, function (err,data) { fs.readFile(&apos;sample03.txt&apos;, &apos;utf8&apos;, function (err, data) { fs.readFile(&apos;sample04.txt&apos;, &apos;utf8&apos;, function (err, data) { }); }); });});&#x65E2;&#x96BE;&#x770B;&#x53C8;&#x96BE;&#x7528;&#x3002;&#x6709;&#x4E86;Promise&#x4EE5;&#x540E;&#xFF0C;&#x8FD9;&#x79CD;&#x5D4C;&#x5957;&#x7684;&#x91D1;&#x5B57;&#x5854;&#x4EE3;&#x7801;&#x5C31;&#x53D8;&#x6210;&#x5E73;&#x7EA7;&#x7684;&#x94FE;&#x5F0F;&#x4EE3;&#x7801;&#x3002;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x8C03;&#x7528;&#x7684;&#x987A;&#x5E8F;&#x3002;JavaScript&#x5B98;&#x65B9;&#x5728;2013&#x5E74;&#x6B63;&#x5F0F;&#x5BA3;&#x5E03;&#x652F;&#x6301;Promise&#x8BED;&#x6CD5;&#xFF0C;&#x5C3D;&#x7BA1;&#x5728;&#x5F88;&#x591A;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#xFF0C;&#x4ECD;&#x7136;&#x6709;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x60C5;&#x51B5;&#x51FA;&#x73B0;&#x3002;&#x4E0D;&#x8FC7;&#x53EF;&#x89C1;&#x8FD9;&#x662F;&#x5927;&#x52BF;&#x6240;&#x8D8B;&#x3002;&#x5728;&#x5B98;&#x65B9;&#x5BA3;&#x5E03;&#x652F;&#x6301;&#x4E4B;&#x524D;&#xFF0C;&#x5DF2;&#x7ECF;&#x6709;&#x5F88;&#x591A;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x505A;&#x4E86;polyfill&#xFF0C;&#x5C31;&#x662F;&#x5BF9;&#x539F;&#x6709;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x4E86;&#x5305;&#x88C5;&#xFF0C;&#x4EE5;&#x4F7F;&#x5176;&#x652F;&#x6301;Promise&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x5E93;&#xFF1A;QwhenWinJSRSVP.js&#x4E0A;&#x9762;&#x8FD9;&#x4E9B;&#x5E93;&#x548C; JavaScript &#x539F;&#x751F; Promise &#x90FD;&#x9075;&#x5B88;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7684;&#x3001;&#x6807;&#x51C6;&#x5316;&#x7684;&#x89C4;&#x8303;&#xFF1A;Promises/A+&#x3002;jQuery&#x7684;Promise-Defer&#x7684;&#x5B9E;&#x73B0;&#x4E0D;&#x7B26;&#x5408;&#x8FD9;&#x4E2A;&#x6807;&#x51C6;&#xFF0C;&#x4F7F;&#x7528;&#x9700;&#x8C28;&#x614E;&#x3002;&#x53E6;&#x5916;&#x5404;&#x79CD;Promise&#x7684;&#x5B9E;&#x73B0;&#x867D;&#x6982;&#x5FF5;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x4ECD;&#x4E0D;&#x5C3D;&#x76F8;&#x540C;&#x3002;&#x770B;&#x4E86;&#x5F88;&#x591A;&#x6587;&#x7AE0;&#xFF0C;&#x4ECD;&#x7136;&#x4E91;&#x91CC;&#x96FE;&#x91CC;&#x3002;&#x521A;&#x5F00;&#x59CB;&#x63A5;&#x89E6;&#x7684;&#x662F;&#x8FD9;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;ES6 JavaScript Promise&#x7684;&#x611F;&#x6027;&#x8BA4;&#x77E5; &#x8BB2;&#x7684;&#x6709;&#x70B9;&#x5570;&#x55E6;&#xFF0C;&#x6587;&#x672B;&#x7F57;&#x5217;&#x7684;&#x53C2;&#x8003;&#x6587;&#x732E;&#x770B;&#x8D77;&#x6765;&#x8FD8;&#x4E0D;&#x9519;&#x3002;&#x540E;&#x6765;&#x9646;&#x9646;&#x7EED;&#x7EED;&#x53C8;google&#x4E86;&#x5F88;&#x591A;&#x6587;&#x7AE0;&#xFF0C;&#x8BB2;&#x7684;&#x4E5F;&#x4E0D;&#x5C3D;&#x76F8;&#x540C;&#xFF0C;&#x7406;&#x89E3;&#x4E0D;&#x80FD;&#x3002;&#x518D;&#x540E;&#x6765;&#x770B;&#x5230;&#x4E86;&#x4E0B;&#x9762;&#x8FD9;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x52A0;&#x4E00;&#x672C;&#x5728;&#x7EBF;&#x4E66;&#xFF0C;&#x611F;&#x89C9;&#x5F88;&#x4E0D;&#x9519;&#x3002;JavaScript PromisesJavaScript Promise&#x8FF7;&#x4F60;&#x4E66;&#xFF08;&#x4E2D;&#x6587;&#x7248;&#xFF09;Promise&#x7684;&#x672F;&#x8BED;&#x80AF;&#x5B9A;&#xFF08;fulfilled&#xFF09; &#x8BE5; Promise &#x5BF9;&#x5E94;&#x7684;&#x64CD;&#x4F5C;&#x6210;&#x529F;&#x4E86; &#x5426;&#x5B9A;&#xFF08;rejected&#xFF09; &#x8BE5; Promise &#x5BF9;&#x5E94;&#x7684;&#x64CD;&#x4F5C;&#x5931;&#x8D25;&#x4E86; &#x7B49;&#x5F85;&#xFF08;pending&#xFF09; &#x8FD8;&#x6CA1;&#x6709;&#x5F97;&#x5230;&#x80AF;&#x5B9A;&#x6216;&#x8005;&#x5426;&#x5B9A;&#x7ED3;&#x679C;&#xFF0C;&#x8FDB;&#x884C;&#x4E2D; &#x7ED3;&#x675F;&#xFF08;settled&#xFF09; &#x5DF2;&#x7ECF;&#x80AF;&#x5B9A;&#x6216;&#x8005;&#x5426;&#x5B9A;&#x4E86;&#x7C7B; Promise (thenable) &#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x662F;&#x201C;&#x7C7B; Promise&#x201D;&#xFF08;&#x62E5;&#x6709;&#x540D;&#x4E3A;&#x201C;then&#x201D;&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#x7684;&#x3002;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x662F;pending&#xFF0C;settled=fulfilled or rejected&#xFF0C;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x53EA;&#x6709;&#x4E00;&#x6B21;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x80FD;&#x9006;&#x8F6C;&#x3002;&#x5982;&#x4F55;&#x4F7F;&#x7528;Promisevar promise = new Promise(function(resolve, reject) { // &#x505A;&#x4E00;&#x4E9B;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x7136;&#x540E;&#x2026;&#x2026; if (/* &#x4E00;&#x5207;&#x6B63;&#x5E38; */) { resolve(&quot;Stuff worked!&quot;); } else { reject(Error(&quot;It broke&quot;)); }})promise.then(function(result) { console.log(result); // &#x201C;&#x5B8C;&#x7F8E;&#xFF01;&#x201D;}, function(err) { console.log(err); // Error: &quot;&#x51FA;&#x95EE;&#x9898;&#x4E86;&quot;});;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6784;&#x9020;&#x5668;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x4F1A;&#x4F20;&#x9012;&#x7ED9;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E24;&#x4E2A;&#x53D8;&#x91CF; resolve &#x548C; reject&#x3002;&#x5728;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E2D;&#x505A;&#x4E00;&#x4E9B;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x8C03;&#x7528; resolve&#xFF0C;&#x5426;&#x5219;&#x8C03;&#x7528; reject&#x3002;&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x8BDD;&#x7684;&#x610F;&#x601D;&#x662F;&#xFF0C;&#x9996;&#x5148;&#xFF0C;Promise&#x5BF9;&#x8C61;&#x7528;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6765;&#x6784;&#x9020;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;code &#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x7531;Promise&#x6765;&#x8D1F;&#x8D23;&#x4F20;&#x9012;(resolve&amp; reject)&#x3002;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E2D;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x81EA;&#x5DF1;&#x9700;&#x8981;&#x505A;&#x7684;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;(asyncOp)&#x3002;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x81EA;&#x884C;&#x5224;&#x65AD;&#x6210;&#x529F;&#x5931;&#x8D25;&#xFF0C;&#x5931;&#x8D25;&#x8C03;&#x7528;reject&#x51FD;&#x6570;&#xFF0C;&#x6210;&#x529F;&#x8C03;&#x7528;resolve&#x51FD;&#x6570;&#x3002;Promise&#x4F7F;&#x7528;&#x65F6;&#x81F3;&#x5C11;&#x4E0E;&#x4E00;&#x4E2A;then&#x914D;&#x5BF9;&#xFF0C;&#x5728;then&#x91CC;&#x9762;&#x505A;asyncOp&#x4E4B;&#x540E;&#x60F3;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x3002;Promise&#x91CC;&#x9762;&#x7684;&#x7ED3;&#x679C;&#x901A;&#x8FC7;resolve&#x548C;reject&#x4F20;&#x9012;&#x7684;&#x53C2;&#x6570;&#xFF08;err&amp;res&#xFF09;&#x4F20;&#x5230;then&#x91CC;&#x3002;function polyFill(){ return new Promise(function (resolve, reject){ fs.asyncOp(function (err, res){ if (err) reject(err); else resolve(res); }); });}polyFill().then(resolveFunc, rejectFunc);resolve &amp; reject&#x8FD9;&#x4E24;&#x4E2A;&#x662F;Promise&#x7C7B;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x8C03;&#x7528;&#xFF1A;promise.resolve(val).then(...);promise.reject(Error(err)).then(...);&#x8FD9;&#x6837;&#x7684;&#x8C03;&#x7528;&#x548C;&#x4E0B;&#x9762;&#x7684;&#x5E38;&#x89C4;&#x8C03;&#x7528;&#x662F;&#x7B49;&#x6548;&#x7684;&#xFF1A;var promise = Promise(function(resolve, reject){ if (good){ resolve(val); } else { reject(Error(err)); }});promise.then(...);&#x5404;&#x8DEF;&#x8D34;&#x5B50;&#x548C;&#x89E3;&#x8BF4;&#x4E2D;&#x90FD;&#x9C9C;&#x5C11;&#x63D0;&#x53CA;resolve&#x548C;reject&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x3002;&#x6211;&#x4E4B;&#x524D;&#x5F15;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x94FE;&#x63A5;&#x90FD;&#x6709;&#x8BF4;&#x5230;&#xFF0C;&#x4F46;&#x6211;&#x611F;&#x89C9;&#x8BB2;&#x7684;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x6E05;&#x695A;&#x3002;&#x4E0B;&#x9762;&#x7406;&#x4E00;&#x4E0B;&#x6211;&#x7684;&#x601D;&#x8DEF;&#xFF1A;resolveresolve&#x603B;&#x662F;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;Promise&#x5BF9;&#x8C61;&#x63A5;&#x6536;&#x5230;promise&#x5BF9;&#x8C61;&#x53C2;&#x6570;&#x7684;&#x65F6;&#x5019;, &#x8FD4;&#x56DE;&#x7684;&#x8FD8;&#x662F;&#x63A5;&#x6536;&#x5230;&#x7684;promise&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x4E14;&#x4E0B;&#x4E00;&#x4E2A;then&#x4F1A;&#x7B49;&#x5230;&#x8FD9;&#x4E2A;Promise&#x5B9A;&#x4E49;&#x7684;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x65F6;&#x624D;&#x4F1A;&#x8FD0;&#x884C;&#x3002;&#x63A5;&#x6536;&#x5230;thenable&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;, &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;promise&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x4E00;&#x4E2A; then &#x65B9;&#x6CD5;&#x63A5;&#x6536;&#x7684;&#x53C2;&#x6570;&#x4E3A;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684;&#x65F6;&#x5019;&#xFF08;&#x5305;&#x62EC;JavaScript&#x5BF9;&#x6216;null&#x7B49;&#xFF09;, &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5C06;&#x8BE5;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x503C;&#x7684;&#x65B0;promise&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x4F1A;&#x88AB;&#x5F53;&#x4F5C;&#x53C2;&#x6570;&#x4F20;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x4E86;resolve&#x51FD;&#x6570;&#x53C2;&#x6570;&#x7684;then&#x91CC;&#x9762;&#x3002; reject reject&#x4E0E;resolve&#x7C7B;&#x4F3C;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;Promise&#x5BF9;&#x8C61;reject&#x901A;&#x5E38;&#x4F20;&#x5165;&#x4E00;&#x4E2A;Error()&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#x7684;&#xFF0C;&#x4F46;Error&#x5BF9;&#x8C61;&#x5305;&#x542B;&#x4E86;&#x8C03;&#x7528;&#x6808;&#xFF0C;&#x65B9;&#x4FBF;&#x8C03;&#x8BD5;&#x3002;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x4E86;reject&#x5DF2;&#x7ECF;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x90E8;&#x5206;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x4E86;&#x3002;&#x5728;Promise&#x91CC;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;catch&#x3002;get(&apos;story.json&apos;).then(function(response) { console.log(&quot;Success!&quot;, response);}).catch(function(error) { console.log(&quot;Failed!&quot;, error);});&#x5728;JavaScript Promises&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#xFF1A;&#x8FD9;&#x91CC;&#x7684; catch &#x5E76;&#x65E0;&#x4EFB;&#x4F55;&#x7279;&#x6B8A;&#x4E4B;&#x5904;&#xFF0C;&#x53EA;&#x662F; then(undefined, func) &#x7684;&#x8BED;&#x6CD5;&#x7CD6;&#x8863;&#xFF0C;&#x66F4;&#x76F4;&#x89C2;&#x4E00;&#x70B9;&#x800C;&#x5DF2;&#x3002;catch&#x76F8;&#x5F53;&#x4E8E;&#xFF1A;get(&apos;story.json&apos;).then(function(response) { console.log(&quot;Success!&quot;, response);}).then(undefined, function(error) { console.log(&quot;Failed!&quot;, error);});&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A; &#x5728;Promise&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x9519;&#x8BEF;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;reject&#x8C03;&#x7528;Promise&#x4E2D;&#x7684;&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;&#x4F1A;&#x843D;&#x5230;Promise&#x540E;&#x9762;&#x7B2C;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x4E86;reject&#x51FD;&#x6570;&#x53C2;&#x6570;&#x7684;then&#x5206;&#x652F;&#x91CC;&#x3002;&#x9AD8;&#x7EA7;Promise&#x521B;&#x5EFA;&#x5E8F;&#x5217;&#x5728;JavaScript Promises&#x4E2D;&#xFF0C;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x4E86;&#x5982;&#x4F55;&#x64CD;&#x4F5C;&#x4E00;&#x7EC4;Promise&#xFF0C;&#x4ECE;&#x771F;&#x6B63;&#x7684;&#x7528;&#x4E00;&#x7EC4;Promise&#x5230;&#x4F7F;&#x7528;Promise.all&#x3002;&#x8FD9;&#x91CC;&#x8BB2;&#x7684;&#x5F88;&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x76F4;&#x63A5;&#x62F7;&#x8FC7;&#x6765;&#x3002;&#x6700;&#x76F4;&#x63A5;&#x7684;&#x6570;&#x7EC4;forEach// &#x4ECE;&#x4E00;&#x4E2A;&#x5B8C;&#x6210;&#x72B6;&#x6001;&#x7684; Promise &#x5F00;&#x59CB;var sequence = Promise.resolve();// &#x904D;&#x5386;&#x6240;&#x6709;&#x7AE0;&#x8282;&#x7684; urlstory.chapterUrls.forEach(function(chapterUrl) { // &#x4ECE; sequence &#x5F00;&#x59CB;&#x628A;&#x64CD;&#x4F5C;&#x63A5;&#x9F99;&#x8D77;&#x6765; sequence = sequence.then(function() { return getJSON(chapterUrl); }).then(function(chapter) { addHtmlToPage(chapter.html); });});&#x7528; array.reduce &#x7CBE;&#x7B80;&#x4E00;&#x4E0B;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF1A;// &#x904D;&#x5386;&#x6240;&#x6709;&#x7AE0;&#x8282;&#x7684; urlstory.chapterUrls.reduce(function(sequence, chapterUrl) { // &#x4ECE; sequence &#x5F00;&#x59CB;&#x628A;&#x64CD;&#x4F5C;&#x63A5;&#x9F99;&#x8D77;&#x6765; return sequence.then(function() { return getJSON(chapterUrl); }).then(function(chapter) { addHtmlToPage(chapter.html); });}, Promise.resolve());&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x540C;&#x65F6;&#x4E0B;&#x8F7D;&#x6240;&#x6709;&#x7AE0;&#x8282;&#xFF0C;&#x5168;&#x90E8;&#x5B8C;&#x6210;&#x540E;&#x4E00;&#x6B21;&#x641E;&#x5B9A;&#xFF0C;&#x6B63;&#x597D;&#x5C31;&#x6709;&#x8FD9;&#x4E48;&#x4E2A; API&#xFF1A;Promise.all(arrayOfPromises).then(function(arrayOfResults) { //...});&#x7136;&#x800C;&#x8FD9;&#x6837;&#x8FD8;&#x662F;&#x6709;&#x63D0;&#x9AD8;&#x7A7A;&#x95F4;&#x3002;&#x5F53;&#x7B2C;&#x4E00;&#x7AE0;&#x5185;&#x5BB9;&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x586B;&#x8FDB;&#x9875;&#x9762;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4ED6;&#x52A0;&#x8F7D;&#x4EFB;&#x52A1;&#x5C1A;&#x672A;&#x5B8C;&#x6210;&#x4E4B;&#x524D;&#x5C31;&#x5F00;&#x59CB;&#x9605;&#x8BFB;&#xFF1B;&#x5F53;&#x7B2C;&#x4E09;&#x7AE0;&#x5230;&#x8FBE;&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x4E0D;&#x52A8;&#x58F0;&#x8272;&#xFF0C;&#x7B2C;&#x4E8C;&#x7AE0;&#x4E5F;&#x5230;&#x8FBE;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x628A;&#x7B2C;&#x4E8C;&#x7AE0;&#x548C;&#x7B2C;&#x4E09;&#x7AE0;&#x5185;&#x5BB9;&#x586B;&#x5165;&#x9875;&#x9762;&#xFF0C;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;&#x3002;&#x4E3A;&#x4E86;&#x8FBE;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x540C;&#x65F6;&#x8BF7;&#x6C42;&#x6240;&#x6709;&#x7684;&#x7AE0;&#x8282;&#x5185;&#x5BB9;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x4F9D;&#x6B21;&#x5C06;&#x5176;&#x586B;&#x5165;&#x9875;&#x9762;&#xFF1A;getJSON(&apos;story.json&apos;).then(function(story) { addHtmlToPage(story.heading); // &#x628A;&#x7AE0;&#x8282; URL &#x6570;&#x7EC4;&#x8F6C;&#x6362;&#x6210;&#x5BF9;&#x5E94;&#x7684; Promise &#x6570;&#x7EC4; // &#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5E76;&#x884C;&#x52A0;&#x8F7D;&#x5B83;&#x4EEC; return story.chapterUrls.map(getJSON) .reduce(function(sequence, chapterPromise) { // &#x4F7F;&#x7528; reduce &#x628A;&#x8FD9;&#x4E9B; Promise &#x63A5;&#x9F99; // &#x4EE5;&#x53CA;&#x5C06;&#x7AE0;&#x8282;&#x5185;&#x5BB9;&#x6DFB;&#x52A0;&#x5230;&#x9875;&#x9762; return sequence.then(function() { // &#x7B49;&#x5F85;&#x5F53;&#x524D; sequence &#x4E2D;&#x6240;&#x6709;&#x7AE0;&#x8282;&#x548C;&#x672C;&#x7AE0;&#x8282;&#x7684;&#x6570;&#x636E;&#x5230;&#x8FBE; return chapterPromise; }).then(function(chapter) { addHtmlToPage(chapter.html); }); }, Promise.resolve());}).then(function() { addTextToPage(&quot;All done&quot;);}).catch(function(err) { // &#x6355;&#x83B7;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x9519;&#x8BEF; addTextToPage(&quot;Argh, broken: &quot; + err.message);}).then(function() { document.querySelector(&apos;.spinner&apos;).style.display = &apos;none&apos;;});%23Javascript%u4E4BPromise%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5Bjavascript%2C%20promise%5D%0A%0A%5BTOC%5D%0A%0APromise%u7684%u610F%u601D%u662F%u7EA6%u5B9A%uFF0C%u76F8%u5BF9%u5E94%u7684%u8BCD%u662FDefer%uFF0C%u662F%u63A8%u8FDF%u3002%u4ED6%u7684%u7528%u610F%u662F%u5728%u5F02%u6B65%u7684JavaScript%u4E16%u754C%u5F15%u5165%u540C%u6B65%u5199%u6CD5%u3002%u770B%u770B%u4E0B%u9762%u7684%u201C%u90AA%u6076%u91D1%u5B57%u5854%u201D%u3002%0A%60%60%60javascript%0Avar%20fs%20%3D%20require%28%27fs%27%29%3B%0Afs.readFile%28%27sample01.txt%27%2C%20%27utf8%27%2C%20function%20%28err%2C%20data%29%20%7B%0A%20%20%20%20fs.readFile%28%27sample02.txt%27%2C%20%27utf8%27%2C%20function%20%28err%2Cdata%29%20%7B%0A%20%20%20%20%20%20%20%20fs.readFile%28%27sample03.txt%27%2C%20%27utf8%27%2C%20function%20%28err%2C%20data%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fs.readFile%28%27sample04.txt%27%2C%20%27utf8%27%2C%20function%20%28err%2C%20data%29%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%29%3B%0A%7D%29%3B%0A%60%60%60%0A%u65E2%u96BE%u770B%u53C8%u96BE%u7528%u3002%u6709%u4E86Promise%u4EE5%u540E%uFF0C%u8FD9%u79CD%u5D4C%u5957%u7684%u91D1%u5B57%u5854%u4EE3%u7801%u5C31%u53D8%u6210%u5E73%u7EA7%u7684%u94FE%u5F0F%u4EE3%u7801%u3002%u800C%u4E14%u53EF%u4EE5%u4FDD%u8BC1%u8C03%u7528%u7684%u987A%u5E8F%u3002%0A%0AJavaScript%u5B98%u65B9%u57282013%u5E74%u6B63%u5F0F%u5BA3%u5E03%u652F%u6301Promise%u8BED%u6CD5%uFF0C%u5C3D%u7BA1%u5728%u5F88%u591A%u6D4F%u89C8%u5668%u7AEF%uFF0C%u4ECD%u7136%u6709%u4E0D%u517C%u5BB9%u7684%u60C5%u51B5%u51FA%u73B0%u3002%u4E0D%u8FC7%u53EF%u89C1%u8FD9%u662F%u5927%u52BF%u6240%u8D8B%u3002%u5728%u5B98%u65B9%u5BA3%u5E03%u652F%u6301%u4E4B%u524D%uFF0C%u5DF2%u7ECF%u6709%u5F88%u591A%u7B2C%u4E09%u65B9%u5E93%u505A%u4E86polyfill%uFF0C%u5C31%u662F%u5BF9%u539F%u6709%u51FD%u6570%u8FDB%u884C%u4E86%u5305%u88C5%uFF0C%u4EE5%u4F7F%u5176%u652F%u6301Promise%u3002%u4F8B%u5982%u4E0B%u9762%u7684%u5E93%uFF1A%0A-%20Q%0A-%20when%0A-%20WinJS%0A-%20RSVP.js%0A%0A%u4E0A%u9762%u8FD9%u4E9B%u5E93%u548C%20JavaScript%20%u539F%u751F%20Promise%20%u90FD%u9075%u5B88%u4E00%u4E2A%u901A%u7528%u7684%u3001%u6807%u51C6%u5316%u7684%u89C4%u8303%uFF1A%5BPromises/A+%5D%28https%3A//github.com/promises-aplus/promises-spec%29%u3002jQuery%u7684Promise-Defer%u7684%u5B9E%u73B0%u4E0D%u7B26%u5408%u8FD9%u4E2A%u6807%u51C6%uFF0C%u4F7F%u7528%u9700%u8C28%u614E%u3002%0A%0A%u53E6%u5916%u5404%u79CDPromise%u7684%u5B9E%u73B0%u867D%u6982%u5FF5%u4E00%u81F4%uFF0C%u4F46%u4ECD%u4E0D%u5C3D%u76F8%u540C%u3002%u770B%u4E86%u5F88%u591A%u6587%u7AE0%uFF0C%u4ECD%u7136%u4E91%u91CC%u96FE%u91CC%u3002%u521A%u5F00%u59CB%u63A5%u89E6%u7684%u662F%u8FD9%u4E00%u7BC7%u6587%u7AE0%uFF1A%0A-%20%5BES6%20JavaScript%20Promise%u7684%u611F%u6027%u8BA4%u77E5%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/9fc4fe1b-7fe2-443c-81cf-ab053fa387e6%29%0A%u8BB2%u7684%u6709%u70B9%u5570%u55E6%uFF0C%u6587%u672B%u7F57%u5217%u7684%u53C2%u8003%u6587%u732E%u770B%u8D77%u6765%u8FD8%u4E0D%u9519%u3002%u540E%u6765%u9646%u9646%u7EED%u7EED%u53C8google%u4E86%u5F88%u591A%u6587%u7AE0%uFF0C%u8BB2%u7684%u4E5F%u4E0D%u5C3D%u76F8%u540C%uFF0C%u7406%u89E3%u4E0D%u80FD%u3002%u518D%u540E%u6765%u770B%u5230%u4E86%u4E0B%u9762%u8FD9%u4E00%u7BC7%u6587%u7AE0%u52A0%u4E00%u672C%u5728%u7EBF%u4E66%uFF0C%u611F%u89C9%u5F88%u4E0D%u9519%u3002%0A-%20%5BJavaScript%20Promises%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/bb1e3fc0-b85b-4fcf-a370-e13ba0573d6e%29%0A-%20%5BJavaScript%20Promise%u8FF7%u4F60%u4E66%uFF08%u4E2D%u6587%u7248%uFF09%5D%28http%3A//liubin.org/promises-book/%23ch2-promise-resolve%29%0A%0A%23%23%20Promise%u7684%u672F%u8BED%0A-%20%u80AF%u5B9A%uFF08fulfilled%uFF09%20%0A%09-%20%u8BE5%20Promise%20%u5BF9%u5E94%u7684%u64CD%u4F5C%u6210%u529F%u4E86%20%0A-%20%u5426%u5B9A%uFF08rejected%uFF09%20%0A%09-%20%u8BE5%20Promise%20%u5BF9%u5E94%u7684%u64CD%u4F5C%u5931%u8D25%u4E86%20%0A-%20%u7B49%u5F85%uFF08pending%uFF09%20%0A%09-%20%u8FD8%u6CA1%u6709%u5F97%u5230%u80AF%u5B9A%u6216%u8005%u5426%u5B9A%u7ED3%u679C%uFF0C%u8FDB%u884C%u4E2D%20%0A-%20%u7ED3%u675F%uFF08settled%uFF09%20%0A%09-%20%u5DF2%u7ECF%u80AF%u5B9A%u6216%u8005%u5426%u5B9A%u4E86%0A-%20%u7C7B%20Promise%20%28thenable%29%0A%09-%20%u4E00%u4E2A%u5BF9%u8C61%u662F%u5426%u662F%u201C%u7C7B%20Promise%u201D%uFF08%u62E5%u6709%u540D%u4E3A%u201Cthen%u201D%u7684%u65B9%u6CD5%uFF09%u7684%u3002%0A%0A%u521D%u59CB%u72B6%u6001%u662Fpending%uFF0Csettled%3Dfulfilled%20or%20rejected%uFF0C%u72B6%u6001%u8F6C%u6362%u53EA%u6709%u4E00%u6B21%uFF0C%u800C%u4E14%u4E0D%u80FD%u9006%u8F6C%u3002%0A%0A%23%23%u5982%u4F55%u4F7F%u7528Promise%0A%60%60%60javascript%0Avar%20promise%20%3D%20new%20Promise%28function%28resolve%2C%20reject%29%20%7B%0A%20%20//%20%u505A%u4E00%u4E9B%u5F02%u6B65%u64CD%u4F5C%u7684%u4E8B%u60C5%uFF0C%u7136%u540E%u2026%u2026%0A%0A%20%20if%20%28/*%20%u4E00%u5207%u6B63%u5E38%20*/%29%20%7B%0A%20%20%20%20resolve%28%22Stuff%20worked%21%22%29%3B%0A%20%20%7D%0A%20%20else%20%7B%0A%20%20%20%20reject%28Error%28%22It%20broke%22%29%29%3B%0A%20%20%7D%0A%7D%29%0A%0Apromise.then%28function%28result%29%20%7B%0A%20%20console.log%28result%29%3B%20//%20%u201C%u5B8C%u7F8E%uFF01%u201D%0A%7D%2C%20function%28err%29%20%7B%0A%20%20console.log%28err%29%3B%20//%20Error%3A%20%22%u51FA%u95EE%u9898%u4E86%22%0A%7D%29%3B%3B%0A%60%60%60%0A%23%23%23%u6784%u9020%u51FD%u6570%0A%3E%u6784%u9020%u5668%u63A5%u53D7%u4E00%u4E2A%u51FD%u6570%u4F5C%u4E3A%u53C2%u6570%uFF0C%u5B83%u4F1A%u4F20%u9012%u7ED9%u8FD9%u4E2A%u56DE%u8C03%u51FD%u6570%u4E24%u4E2A%u53D8%u91CF%20resolve%20%u548C%20reject%u3002%u5728%u56DE%u8C03%u51FD%u6570%u4E2D%u505A%u4E00%u4E9B%u5F02%u6B65%u64CD%u4F5C%uFF0C%u6210%u529F%u4E4B%u540E%u8C03%u7528%20resolve%uFF0C%u5426%u5219%u8C03%u7528%20reject%u3002%0A%0A%u4E0A%u9762%u8FD9%u6BB5%u8BDD%u7684%u610F%u601D%u662F%uFF0C%0A-%20%u9996%u5148%uFF0CPromise%u5BF9%u8C61%u7528%u4E00%u4E2A%u56DE%u8C03%u51FD%u6570%u6765%u6784%u9020%u3002%0A-%20%u5176%u6B21%uFF0C%u770B%u4E0B%u9762%u8FD9%u6BB5code%0A%09-%20%u8FD9%u4E2A%u56DE%u8C03%u51FD%u6570%u6709%u4E24%u4E2A%u53C2%u6570%uFF0C%u8FD9%u4E24%u4E2A%u53C2%u6570%u7531Promise%u6765%u8D1F%u8D23%u4F20%u9012%28resolve%26%20reject%29%u3002%0A%09-%20%u56DE%u8C03%u51FD%u6570%u4E2D%u5B9A%u4E49%u4E00%u4E9B%u81EA%u5DF1%u9700%u8981%u505A%u7684%u5F02%u6B65%u64CD%u4F5C%28asyncOp%29%u3002%0A%09-%20%u5F02%u6B65%u64CD%u4F5C%u7ED3%u675F%u65F6%uFF0C%u81EA%u884C%u5224%u65AD%u6210%u529F%u5931%u8D25%uFF0C%u5931%u8D25%u8C03%u7528reject%u51FD%u6570%uFF0C%u6210%u529F%u8C03%u7528resolve%u51FD%u6570%u3002%0A%09-%20Promise%u4F7F%u7528%u65F6%u81F3%u5C11%u4E0E%u4E00%u4E2Athen%u914D%u5BF9%uFF0C%u5728then%u91CC%u9762%u505AasyncOp%u4E4B%u540E%u60F3%u505A%u7684%u4E8B%u60C5%u3002Promise%u91CC%u9762%u7684%u7ED3%u679C%u901A%u8FC7resolve%u548Creject%u4F20%u9012%u7684%u53C2%u6570%uFF08err%26res%uFF09%u4F20%u5230then%u91CC%u3002%0A%60%60%60javascript%0Afunction%20polyFill%28%29%7B%0A%20%20return%20new%20Promise%28function%20%28resolve%2C%20reject%29%7B%0A%20%20%20%20fs.asyncOp%28function%20%28err%2C%20res%29%7B%0A%20%20%20%20%20%20if%20%28err%29%20%0A%09%20%20%20%20%20%20reject%28err%29%3B%0A%20%20%20%20%20%20else%20%0A%09%20%20%20%20%20%20resolve%28res%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%7D%29%3B%0A%7D%0ApolyFill%28%29.then%28resolveFunc%2C%20rejectFunc%29%3B%0A%60%60%60%0A%23%23%23resolve%20%26%20reject%0A%u8FD9%u4E24%u4E2A%u662FPromise%u7C7B%u7684%u6210%u5458%u51FD%u6570%uFF0C%u4F7F%u7528%u7684%u65F6%u5019%uFF0C%u4E5F%u53EF%u4EE5%u50CF%u4E0B%u9762%u8FD9%u6837%u8C03%u7528%uFF1A%0A%60%60%60javascript%0Apromise.resolve%28val%29.then%28...%29%3B%0Apromise.reject%28Error%28err%29%29.then%28...%29%3B%0A%60%60%60%0A%u8FD9%u6837%u7684%u8C03%u7528%u548C%u4E0B%u9762%u7684%u5E38%u89C4%u8C03%u7528%u662F%u7B49%u6548%u7684%uFF1A%0A%60%60%60javascript%0Avar%20promise%20%3D%20Promise%28function%28resolve%2C%20reject%29%7B%0A%09if%20%28good%29%7B%0A%09%09resolve%28val%29%3B%09%0A%09%7D%0A%09else%20%7B%0A%09%09reject%28Error%28err%29%29%3B%0A%09%7D%0A%7D%29%3B%0Apromise.then%28...%29%3B%0A%60%60%60%0A%u5404%u8DEF%u8D34%u5B50%u548C%u89E3%u8BF4%u4E2D%u90FD%u9C9C%u5C11%u63D0%u53CAresolve%u548Creject%u51FD%u6570%u7684%u53C2%u6570%u662F%u4EC0%u4E48%uFF0C%u6709%u4EC0%u4E48%u7528%u3002%u6211%u4E4B%u524D%u5F15%u7528%u7684%u4E24%u4E2A%u94FE%u63A5%u90FD%u6709%u8BF4%u5230%uFF0C%u4F46%u6211%u611F%u89C9%u8BB2%u7684%u90FD%u4E0D%u662F%u5F88%u6E05%u695A%u3002%u4E0B%u9762%u7406%u4E00%u4E0B%u6211%u7684%u601D%u8DEF%uFF1A%0A%3E%20resolve%0A%3E%20-%20resolve%u603B%u662F%u8FD4%u56DE%u4E00%u4E2APromise%u5BF9%u8C61%0A%3E%20-%20%u63A5%u6536%u5230promise%u5BF9%u8C61%u53C2%u6570%u7684%u65F6%u5019%2C%20%u8FD4%u56DE%u7684%u8FD8%u662F%u63A5%u6536%u5230%u7684promise%u5BF9%u8C61%uFF0C%u800C%u4E14%u4E0B%u4E00%u4E2Athen%u4F1A%u7B49%u5230%u8FD9%u4E2APromise%u5B9A%u4E49%u7684%u5F02%u6B65%u64CD%u4F5C%u7ED3%u675F%u65F6%u624D%u4F1A%u8FD0%u884C%u3002%0A%3E%20-%20%u63A5%u6536%u5230thenable%u7C7B%u578B%u7684%u5BF9%u8C61%u7684%u65F6%u5019%2C%20%u8FD4%u56DE%u4E00%u4E2A%u65B0%u7684promise%u5BF9%u8C61%uFF0C%u8FD9%u4E2A%u5BF9%u8C61%u5177%u6709%u4E00%u4E2A%20then%20%u65B9%u6CD5%0A%3E%20-%20%u63A5%u6536%u7684%u53C2%u6570%u4E3A%u5176%u4ED6%u7C7B%u578B%u7684%u65F6%u5019%uFF08%u5305%u62ECJavaScript%u5BF9%u6216null%u7B49%uFF09%2C%20%u8FD4%u56DE%u4E00%u4E2A%u5C06%u8BE5%u5BF9%u8C61%u4F5C%u4E3A%u503C%u7684%u65B0promise%u5BF9%u8C61%uFF0C%u8FD9%u4E2A%u503C%u4F1A%u88AB%u5F53%u4F5C%u53C2%u6570%u4F20%u5230%u4E0B%u4E00%u4E2A%u5B9A%u4E49%u4E86resolve%u51FD%u6570%u53C2%u6570%u7684then%u91CC%u9762%u3002%0A%3E%20reject%0A%3E%20%20-%20reject%u4E0Eresolve%u7C7B%u4F3C%uFF0C%u8FD4%u56DE%u7684%u4E5F%u662F%u4E00%u4E2APromise%u5BF9%u8C61%0A%3E%20%20-%20reject%u901A%u5E38%u4F20%u5165%u4E00%u4E2A%60Error%28%29%60%u5BF9%u8C61%u3002%u8FD9%u4E0D%u662F%u5FC5%u987B%u7684%uFF0C%u4F46Error%u5BF9%u8C61%u5305%u542B%u4E86%u8C03%u7528%u6808%uFF0C%u65B9%u4FBF%u8C03%u8BD5%u3002%0A%0A%23%23%23%u9519%u8BEF%u5904%u7406%0A%u4E0A%u9762%u63D0%u5230%u4E86reject%u5DF2%u7ECF%u6D89%u53CA%u5230%u4E00%u90E8%u5206%u9519%u8BEF%u5904%u7406%u4E86%u3002%u5728Promise%u91CC%u9762%uFF0C%u6211%u4EEC%u8FD8%u53EF%u4EE5%u7528catch%u3002%0A%60%60%60javascript%0Aget%28%27story.json%27%29.then%28function%28response%29%20%7B%20%0A%09console.log%28%22Success%21%22%2C%20response%29%3B%0A%7D%29.catch%28function%28error%29%20%7B%0A%09console.log%28%22Failed%21%22%2C%20error%29%3B%0A%7D%29%3B%0A%60%60%60%0A%u5728%5BJavaScript%20Promises%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/bb1e3fc0-b85b-4fcf-a370-e13ba0573d6e%29%u8FD9%u91CC%u63D0%u5230%uFF1A%0A%3E%u8FD9%u91CC%u7684%20catch%20%u5E76%u65E0%u4EFB%u4F55%u7279%u6B8A%u4E4B%u5904%uFF0C%u53EA%u662F%20then%28undefined%2C%20func%29%20%u7684%u8BED%u6CD5%u7CD6%u8863%uFF0C%u66F4%u76F4%u89C2%u4E00%u70B9%u800C%u5DF2%u3002catch%u76F8%u5F53%u4E8E%uFF1A%0A%60%60%60javascript%0Aget%28%27story.json%27%29.then%28function%28response%29%20%7B%0A%20%20console.log%28%22Success%21%22%2C%20response%29%3B%0A%7D%29.then%28undefined%2C%20function%28error%29%20%7B%0A%20%20console.log%28%22Failed%21%22%2C%20error%29%3B%0A%7D%29%3B%0A%60%60%60%0A%u603B%u7ED3%u4E00%u4E0B%uFF1A%0A%u5728Promise%u4E2D%u7684%u4EFB%u4F55%u9519%u8BEF%uFF0C%u5305%u62EC%uFF1A%0A-%20reject%u8C03%u7528%0A-%20Promise%u4E2D%u7684%u629B%u51FA%u7684%u5F02%u5E38%0A%0A%u4F1A%u843D%u5230Promise%u540E%u9762%u7B2C%u4E00%u4E2A%u5B9A%u4E49%u4E86reject%u51FD%u6570%u53C2%u6570%u7684then%u5206%u652F%u91CC%u3002%0A%0A%23%23%u9AD8%u7EA7Promise%0A%23%23%23%u521B%u5EFA%u5E8F%u5217%0A%u5728%5BJavaScript%20Promises%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/bb1e3fc0-b85b-4fcf-a370-e13ba0573d6e%29%u4E2D%uFF0C%u8BE6%u7EC6%u89E3%u91CA%u4E86%u5982%u4F55%u64CD%u4F5C%u4E00%u7EC4Promise%uFF0C%u4ECE%u771F%u6B63%u7684%u7528%u4E00%u7EC4Promise%u5230%u4F7F%u7528Promise.all%u3002%u8FD9%u91CC%u8BB2%u7684%u5F88%u597D%u4E86%uFF0C%u6211%u76F4%u63A5%u62F7%u8FC7%u6765%u3002%0A1.%20%u6700%u76F4%u63A5%u7684%u6570%u7EC4forEach%0A%60%60%60javascript%0A//%20%u4ECE%u4E00%u4E2A%u5B8C%u6210%u72B6%u6001%u7684%20Promise%20%u5F00%u59CB%0Avar%20sequence%20%3D%20Promise.resolve%28%29%3B%0A%0A//%20%u904D%u5386%u6240%u6709%u7AE0%u8282%u7684%20url%0Astory.chapterUrls.forEach%28function%28chapterUrl%29%20%7B%0A%20%20//%20%u4ECE%20sequence%20%u5F00%u59CB%u628A%u64CD%u4F5C%u63A5%u9F99%u8D77%u6765%0A%20%20sequence%20%3D%20sequence.then%28function%28%29%20%7B%0A%20%20%20%20return%20getJSON%28chapterUrl%29%3B%0A%20%20%7D%29.then%28function%28chapter%29%20%7B%0A%20%20%20%20addHtmlToPage%28chapter.html%29%3B%0A%20%20%7D%29%3B%0A%7D%29%3B%0A%60%60%60%0A2.%20%u7528%20%5Barray.reduce%5D%28https%3A//developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce%29%20%u7CBE%u7B80%u4E00%u4E0B%u4E0A%u9762%u7684%u4EE3%u7801%uFF1A%0A%60%60%60javascript%0A//%20%u904D%u5386%u6240%u6709%u7AE0%u8282%u7684%20url%0Astory.chapterUrls.reduce%28function%28sequence%2C%20chapterUrl%29%20%7B%0A%20%20//%20%u4ECE%20sequence%20%u5F00%u59CB%u628A%u64CD%u4F5C%u63A5%u9F99%u8D77%u6765%0A%20%20return%20sequence.then%28function%28%29%20%7B%0A%20%20%20%20return%20getJSON%28chapterUrl%29%3B%0A%20%20%7D%29.then%28function%28chapter%29%20%7B%0A%20%20%20%20addHtmlToPage%28chapter.html%29%3B%0A%20%20%7D%29%3B%0A%7D%2C%20Promise.resolve%28%29%29%3B%0A%60%60%60%0A3.%20%u6211%u4EEC%u5E0C%u671B%u540C%u65F6%u4E0B%u8F7D%u6240%u6709%u7AE0%u8282%uFF0C%u5168%u90E8%u5B8C%u6210%u540E%u4E00%u6B21%u641E%u5B9A%uFF0C%u6B63%u597D%u5C31%u6709%u8FD9%u4E48%u4E2A%20API%uFF1A%0A%60%60%60javascript%0APromise.all%28arrayOfPromises%29.then%28function%28arrayOfResults%29%20%7B%0A%20%20//...%0A%7D%29%3B%0A%60%60%60%0A%u7136%u800C%u8FD9%u6837%u8FD8%u662F%u6709%u63D0%u9AD8%u7A7A%u95F4%u3002%u5F53%u7B2C%u4E00%u7AE0%u5185%u5BB9%u52A0%u8F7D%u5B8C%u6BD5%u6211%u4EEC%u53EF%u4EE5%u7ACB%u5373%u586B%u8FDB%u9875%u9762%uFF0C%u8FD9%u6837%u7528%u6237%u53EF%u4EE5%u5728%u5176%u4ED6%u52A0%u8F7D%u4EFB%u52A1%u5C1A%u672A%u5B8C%u6210%u4E4B%u524D%u5C31%u5F00%u59CB%u9605%u8BFB%uFF1B%u5F53%u7B2C%u4E09%u7AE0%u5230%u8FBE%u7684%u65F6%u5019%u6211%u4EEC%u4E0D%u52A8%u58F0%u8272%uFF0C%u7B2C%u4E8C%u7AE0%u4E5F%u5230%u8FBE%u4E4B%u540E%u6211%u4EEC%u518D%u628A%u7B2C%u4E8C%u7AE0%u548C%u7B2C%u4E09%u7AE0%u5185%u5BB9%u586B%u5165%u9875%u9762%uFF0C%u4EE5%u6B64%u7C7B%u63A8%u3002%0A%0A4.%20%u4E3A%u4E86%u8FBE%u5230%u8FD9%u6837%u7684%u6548%u679C%uFF0C%u6211%u4EEC%u540C%u65F6%u8BF7%u6C42%u6240%u6709%u7684%u7AE0%u8282%u5185%u5BB9%uFF0C%u7136%u540E%u521B%u5EFA%u4E00%u4E2A%u5E8F%u5217%u4F9D%u6B21%u5C06%u5176%u586B%u5165%u9875%u9762%uFF1A%0A%60%60%60javascript%0AgetJSON%28%27story.json%27%29.then%28function%28story%29%20%7B%0A%20%20addHtmlToPage%28story.heading%29%3B%0A%0A%20%20//%20%u628A%u7AE0%u8282%20URL%20%u6570%u7EC4%u8F6C%u6362%u6210%u5BF9%u5E94%u7684%20Promise%20%u6570%u7EC4%0A%20%20//%20%u8FD9%u6837%u5C31%u53EF%u4EE5%u5E76%u884C%u52A0%u8F7D%u5B83%u4EEC%0A%20%20return%20story.chapterUrls.map%28getJSON%29%0A%20%20%20%20.reduce%28function%28sequence%2C%20chapterPromise%29%20%7B%0A%20%20%20%20%20%20//%20%u4F7F%u7528%20reduce%20%u628A%u8FD9%u4E9B%20Promise%20%u63A5%u9F99%0A%20%20%20%20%20%20//%20%u4EE5%u53CA%u5C06%u7AE0%u8282%u5185%u5BB9%u6DFB%u52A0%u5230%u9875%u9762%0A%20%20%20%20%20%20return%20sequence.then%28function%28%29%20%7B%0A%20%20%20%20%20%20%20%20//%20%u7B49%u5F85%u5F53%u524D%20sequence%20%u4E2D%u6240%u6709%u7AE0%u8282%u548C%u672C%u7AE0%u8282%u7684%u6570%u636E%u5230%u8FBE%0A%20%20%20%20%20%20%20%20return%20chapterPromise%3B%0A%20%20%20%20%20%20%7D%29.then%28function%28chapter%29%20%7B%0A%20%20%20%20%20%20%20%20addHtmlToPage%28chapter.html%29%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%2C%20Promise.resolve%28%29%29%3B%0A%7D%29.then%28function%28%29%20%7B%0A%20%20addTextToPage%28%22All%20done%22%29%3B%0A%7D%29.catch%28function%28err%29%20%7B%0A%20%20//%20%u6355%u83B7%u8FC7%u7A0B%u4E2D%u7684%u4EFB%u4F55%u9519%u8BEF%0A%20%20addTextToPage%28%22Argh%2C%20broken%3A%20%22%20+%20err.message%29%3B%0A%7D%29.then%28function%28%29%20%7B%0A%20%20document.querySelector%28%27.spinner%27%29.style.display%20%3D%20%27none%27%3B%0A%7D%29%3B%0A%60%60%60%0A%0A]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>promise</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javascript面向对象入门]]></title>
    <url>%2F2016%2F03%2F04%2FJavascript%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[Edit&#x5B66;&#x4E60;&#x7B14;&#x8BB0; javascript &#x9762;&#x5411;&#x5BF9;&#x8C61; Javascript&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x5165;&#x95E8;&#x7C7B;&#x5C01;&#x88C5;&#x7684;Prototype&#x6A21;&#x5F0F;&#x7EE7;&#x627F;&#x901A;&#x8FC7;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7EE7;&#x627F;&#x901A;&#x8FC7;prototype&#x7EE7;&#x627F;&#x76F4;&#x63A5;&#x7EE7;&#x627F;prototype&#x5229;&#x7528;&#x7A7A;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x4E2D;&#x4ECB;&#x901A;&#x8FC7;&#x62F7;&#x8D1D;&#x7EE7;&#x627F;object()&#x65B9;&#x6CD5;&#x6DF1;&#x62F7;&#x8D1D;&#x5199;&#x8FD9;&#x7BC7;&#x7B14;&#x8BB0;&#xFF0C;&#x662F;&#x9605;&#x8BFB;&#x4E86;&#x4EE5;&#x4E0B;&#x8FD9;&#x4E2A;&#x7CFB;&#x5217;&#x4E09;&#x4E2A;&#x7F51;&#x9875;&#xFF0C;&#x60F3;&#x6458;&#x5F55;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#xFF0C;&#x4EE5;&#x540E;&#x4E5F;&#x65B9;&#x4FBF;&#x56DE;&#x5FC6;&#x3002;Javascript &#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#xFF08;&#x4E00;&#xFF09;&#xFF1A;&#x5C01;&#x88C5;Javascript&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#xFF08;&#x4E8C;&#xFF09;&#xFF1A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x7EE7;&#x627F;Javascript&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#xFF08;&#x4E09;&#xFF09;&#xFF1A;&#x975E;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x7EE7;&#x627F;&#x4F5C;&#x8005;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x5A13;&#x5A13;&#x9053;&#x6765;&#xFF0C;&#x8BB2;&#x7684;&#x5F88;&#x900F;&#x5F7B;&#x3002;&#x6587;&#x4E2D;&#x8BB2;&#x4E86;&#x5F88;&#x591A;&#x79CD;javascript&#x5B9E;&#x73B0;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x548C;&#x5404;&#x81EA;&#x7684;&#x4F18;&#x52A3;&#x3002;&#x6211;&#x53EA;&#x8BB0;&#x5F55;&#x4F5C;&#x8005;&#x8BA4;&#x4E3A;&#x6700;&#x597D;&#x7684;&#xFF0C;&#x548C;&#x6211;&#x8BA4;&#x4E3A;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x3002;&#x5728;&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#xFF0C;&#x6709;&#x4E00;&#x4E9B;heads up&#x3002;JS&#x672C;&#x8EAB;&#x662F;&#x4E0D;&#x652F;&#x6301;OO&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x8FD0;&#x7528;&#x5176;&#x81EA;&#x8EAB;&#x7684;&#x5404;&#x79CD;&#x7279;&#x6027;&#xFF0C;&#x4ECD;&#x7136;&#x80FD;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;&#x5C01;&#x88C5;&#x548C;&#x7EE7;&#x627F;&#xFF0C;&#x8FD9;&#x662F;OO&#x7684;&#x7CBE;&#x534E;&#x90E8;&#x5206;JS&#x4E2D;&#x6240;&#x6709;&#x7269;&#x4EF6;&#x90FD;&#x662F;&#x5BF9;&#x8C61; function&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x662F;Function&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x5B57;&#x5178;&#x662F;Object&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x6570;&#x7EC4;&#x662F;Array&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x7B80;&#x5355;&#x53D8;&#x91CF;&#x662F;Number&#x7C7B;&#x5BF9;&#x8C61;&#x7C7B;&#x5C01;&#x88C5;&#x7684;Prototype&#x6A21;&#x5F0F;&#x770B;&#x4E0B;&#x9762;&#x7684;code&#xFF1A;1.function Cat(name,color){2. this.name = name;3. this.color = color;4.}5.6.Cat.prototype.type = &quot;&#x732B;&#x79D1;&#x52A8;&#x7269;&quot;;7.Cat.prototype.eat = function(){alert(&quot;&#x5403;&#x8001;&#x9F20;&quot;)};8.&#x3000;&#x3000;9.var cat1 = new Cat(&quot;&#x5927;&#x6BDB;&quot;,&quot;&#x9EC4;&#x8272;&quot;);10.var cat2 = new Cat(&quot;&#x4E8C;&#x6BDB;&quot;,&quot;&#x9ED1;&#x8272;&quot;);11.12.alert(cat1.type); // &#x732B;&#x79D1;&#x52A8;&#x7269;13.cat1.eat(); // &#x5403;&#x8001;&#x9F20;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x6709;&#x4E00;&#x4E2A;prototype&#x4E0A;&#xFF0C;&#x6BCF;&#x4E2A;prototype&#x6307;&#x5411;&#x53E6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x4E0D;&#x53D8;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x5728;&#x8FD9;&#x4E2A;prototype&#x4E0A;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x51CF;&#x5C11;&#x91CD;&#x590D;&#xFF0C;&#x8282;&#x7701;&#x5185;&#x5B58;&#x7684;&#x4F5C;&#x7528;&#x3002;express&#x4E2D;&#x7684;model&#x5B9A;&#x4E49;&#x5C31;&#x662F;&#x7528;&#x7684;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x7EE7;&#x627F;&#x7EE7;&#x627F;&#x6709;&#x4E24;&#x79CD;&#xFF0C;&#x901A;&#x8FC7;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7EE7;&#x627F;&#x548C;&#x901A;&#x8FC7;&#x5BF9;&#x8C61;&#x62F7;&#x8D1D;&#x7EE7;&#x627F;&#x3002;javascript&#x662F;&#x9762;&#x5411;&#x51FD;&#x6570;&#x7F16;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5BF9;&#x4E8E;&#x7C7B;&#x5B9A;&#x4E49;&#x6765;&#x8BF4;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x4E0A;&#x9762;&#x8BB2;&#x7684;prototype&#x5C31;&#x6709;&#x70B9;&#x7EE7;&#x627F;&#x7684;&#x610F;&#x601D;&#x4E86;&#x3002;&#x4F46;&#x6211;&#x4EEC;&#x7684;prototype&#x5E76;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;&#x5373;&#x6CA1;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4E0D;&#x80FD;&#x79F0;&#x5176;&#x7C7B;&#xFF0C;&#x4E5F;&#x6CA1;&#x6CD5;&#x5B9E;&#x4F8B;&#x5316;&#x3002;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x79F0;&#x5176;&#x4E3A;&#x7EE7;&#x627F;&#x3002;&#x901A;&#x8FC7;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7EE7;&#x627F;&#x901A;&#x8FC7;prototype&#x7EE7;&#x627F;&#x90A3;&#x8981;&#x7EE7;&#x627F;&#x5C31;&#x8981;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;1.function Animal(){2. this.species = &quot;&#x52A8;&#x7269;&quot;;3.}4.Cat.prototype = new Animal();5.Cat.prototype.constructor = Cat;6.var cat1 = new Cat(&quot;&#x5927;&#x6BDB;&quot;,&quot;&#x9EC4;&#x8272;&quot;);7.alert(cat1.species); // &#x52A8;&#x7269;&#x8FD9;&#x6837;&#x5C31;&#x662F;&#x771F;&#x6B63;&#x7684;&#x7EE7;&#x627F;&#x4E86;&#xFF0C;Cat&#x7EE7;&#x627F;&#x81EA;Animal&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x5C0F;&#x628A;&#x620F;&#xFF1A;Cat.prototype.constructor = Cat; &#x8FD9;&#x91CC;&#x7275;&#x6D89;&#x5230;&#x4E00;&#x4E2A;&#x5F88;&#x9976;&#x4EBA;&#x7684;&#x5C0F;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x662F;&#x5F88;&#x591A;&#x4EBA;&#x5728;&#x8BA8;&#x8BBA;&#x7684;&#xFF0C;&#x4E5F;&#x662F;jsoo&#x8EB2;&#x4E0D;&#x5F00;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#xFF1A;constructor&#x7684;&#x4F5C;&#x7528;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#xFF1F; &#x9996;&#x5148;&#xFF0C;&#x5728;js&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x7269;&#x4EF6;&#x7686;&#x4E3A;&#x5BF9;&#x8C61;&#x3002; &#x5176;&#x6B21;&#x6BCF;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x6709;&#x4ED6;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x7531;object.constructor&#x6307;&#x660E;&#x3002; &#x6700;&#x540E;&#xFF0C;&#x6240;&#x6709;object.constructor&#x5747;&#x7B49;&#x4E8E;object.prototype.constructor&#x3002;&#x770B;&#x4E0B;&#x9762;&#x7684;REPL&#x7684;&#x4EE3;&#x7801;&#xFF1A;1.&gt; function Cat(){}2.&gt; function Animal(){}3.&gt; Cat.prototype=new Animal4.&gt; cat = new Cat()5.Animal {} // &#x770B;&#x8FD9;&#x91CC;&#x7684;&#x7ED3;&#x679C;6.&gt; cat.constructor===Animal // &#x518D;&#x770B;&#x8FD9;&#x4E00;&#x884C;7.true8.&gt; Cat.constructor === Function9.true&#x53EF;&#x89C1;&#xFF0C;&#x5982;&#x679C;&#x4FEE;&#x6539;&#x4E86;&#x7C7B;&#x7684;prototype&#xFF0C;&#x5B83;&#x81EA;&#x5DF1;&#x5BF9;&#x8C61;&#x7684;constructor&#x5C31;&#x4F1A;&#x6307;&#x5411;&#x5176;&#x4ED6;&#x7684;&#x5730;&#x65B9;&#x3002;&#x95EE;&#x9898;&#x6765;&#x4E86;&#xFF1A;&#x8FD9;&#x4E48;&#x505A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x5462;&#xFF1F;&#x8FD9;&#x8BA9;&#x6211;&#x767E;&#x601D;&#x4E0D;&#x5F97;&#x5176;&#x89E3;&#x3002;&#x5F15;&#x7528;&#x77E5;&#x4E4E;&#x4E0A;&#x4E00;&#x4E2A;&#x56DE;&#x7B54;&#xFF1A;constructor&#x5C5E;&#x6027;&#x4E0D;&#x5F71;&#x54CD;&#x4EFB;&#x4F55;JavaScript&#x7684;&#x5185;&#x90E8;&#x5C5E;&#x6027;&#x3002;instanceof&#x68C0;&#x6D4B;&#x5BF9;&#x8C61;&#x7684;&#x539F;&#x578B;&#x94FE;&#xFF0C;&#x901A;&#x5E38;&#x4F60;&#x662F;&#x65E0;&#x6CD5;&#x4FEE;&#x6539;&#x7684;&#xFF08;&#x4E0D;&#x8FC7;&#x67D0;&#x4E9B;&#x5F15;&#x64CE;&#x901A;&#x8FC7;&#x79C1;&#x6709;&#x7684;proto&#x5C5E;&#x6027;&#x66B4;&#x9732;&#x51FA;&#x6765;&#xFF09;&#x3002; constructor&#x5176;&#x5B9E;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x5904;&#xFF0C;&#x53EA;&#x662F;JavaScript&#x8BED;&#x8A00;&#x8BBE;&#x8BA1;&#x7684;&#x5386;&#x53F2;&#x9057;&#x7559;&#x7269;&#x3002;&#x7531;&#x4E8E;constructor&#x5C5E;&#x6027;&#x662F;&#x53EF;&#x4EE5;&#x53D8;&#x66F4;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x672A;&#x5FC5;&#x771F;&#x7684;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x63D0;&#x793A;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x4ECE;&#x7F16;&#x7A0B;&#x4E60;&#x60EF;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x8BA9;&#x5BF9;&#x8C61;&#x7684;constructor&#x6307;&#x5411;&#x5176;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x4EE5;&#x7EF4;&#x6301;&#x8FD9;&#x4E2A;&#x60EF;&#x4F8B;&#x3002;&#x7528;instanceof&#x770B;&#x4E0D;&#x51FA;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF0C;&#x53EF;&#x80FD;&#x4E5F;&#x5370;&#x8BC1;&#x4E86;&#x8FD9;&#x4F4D;&#x77E5;&#x4E4E;&#x5927;&#x725B;&#x7684;&#x89C2;&#x70B9;&#x3002;1.&gt; cat = new Cat()2.Animal {}3.&gt; cat instanceof Cat4.true5.&gt; cat instanceof Animal6.true7.&gt; Cat.prototype.constructor=Cat8.[Function: Cat]9.&gt; cat=new Cat()10.Cat {}11.&gt; cat instanceof Cat12.true13.&gt; cat instanceof Animal14.true&#x518D;&#x56DE;&#x5230;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x4F8B;&#x5B50;Cat.prototype = new Animal();&#x8FD9;&#x4E00;&#x53E5;&#x4E5F;&#x9690;&#x542B;&#x7684;&#x505A;&#x4E86;Cat.prototype.constructor = Animal&#x3002;&#x5BFC;&#x81F4;cat.constructor === Cat.prototype.constructor &#x770B;&#x8D77;&#x6765;&#x6709;&#x70B9;&#x4E71;&#xFF0C;cat&#x770B;&#x8D77;&#x6765;&#x662F;&#x7531;Animal&#x6765;&#x6784;&#x9020;&#x7684;&#x4E86;&#x3002; &#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;&#xFF1A;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x4E0D;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x5728;&#x4E00;&#x4E9B;&#x9AD8;&#x7EA7;&#x5E94;&#x7528;&#x573A;&#x5408;&#xFF0C;&#x8981;&#x7528;&#x5230;&#x53CD;&#x5C04;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;constructor&#x8BBE;&#x7F6E;&#x4E0D;&#x5BF9;&#x4F1A;&#x5F15;&#x8D77;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x9EBB;&#x70E6;&#x3002;&#x6839;&#x636E;prototype&#x7EE7;&#x627F;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Javascript&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#xFF08;&#x4E8C;&#xFF09;&#xFF1A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x7EE7;&#x627F;&#x53C8;&#x63D0;&#x51FA;&#x4E86;&#x4E24;&#x79CD;&#x6539;&#x8FDB;&#x578B;&#x7684;&#x7EE7;&#x627F;&#x65B9;&#x6CD5;&#xFF0C;&#x5206;&#x522B;&#x662F;&#x76F4;&#x63A5;&#x7EE7;&#x627F;prototype&#x5229;&#x7528;&#x7A7A;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x4E2D;&#x4ECB;&#x76F4;&#x63A5;&#x7EE7;&#x627F;prototype&#x7C7B;&#x7684;prototype&#x662F;&#x8FD9;&#x4E2A;&#x7C7B;&#x7A33;&#x5B9A;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x60F3;&#x7EE7;&#x627F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x60F3;&#x7EE7;&#x627F;&#x7C7B;&#x4E2D;&#x7A33;&#x5B9A;&#x7684;&#x90E8;&#x5206;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x76F4;&#x63A5;&#x7EE7;&#x627F;&#x7236;&#x7C7B;&#x7684;prototype&#xFF1A;1.function Animal(){2. this.species = &quot;&#x52A8;&#x7269;&quot;;3.}4.Cat.prototype = Aninal.prototype;5.Cat.prototype.constructor = Cat;&#x867D;&#x7136;&#x542C;&#x8D77;&#x6765;&#x6709;&#x7406;&#xFF0C;&#x4E0D;&#x8FC7;&#x771F;&#x7684;&#x8FD9;&#x4E48;&#x505A;&#x8FD8;&#x662F;&#x633A;&#x5947;&#x602A;&#x7684;&#x3002;&#x5B50;&#x7C7B;&#x548C;&#x7236;&#x7C7B;&#x7684;prototype&#x6307;&#x5411;&#x4E86;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;(JSOO&#x4E2D;&#xFF0C;&#x4E07;&#x7269;&#x7686;&#x5BF9;&#x8C61;&#xFF0C;&#x548C;C++/Java&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x6982;&#x5FF5;&#x6709;&#x7A0D;&#x8BB8;&#x533A;&#x522B;)&#x3002; &#x800C;&#x5BF9;Cat.prototype.constructor&#x7684;&#x4FEE;&#x6539;&#x76F4;&#x63A5;&#x5F71;&#x54CD;&#x4E86;Animal.constructor&#x3002;&#x7ED3;&#x8BBA;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0D;&#x597D;&#xFF0C;&#x4E0D;&#x80FD;&#x7528;&#x3002;&#x5229;&#x7528;&#x7A7A;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x4E2D;&#x4ECB;&#x76F4;&#x63A5;&#x4E0A;&#x4EE3;&#x7801;&#xFF1A;1.var F = function(){};2.F.prototype = Animal.prototype;3.Cat.prototype = new F();4.Cat.prototype.constructor = Cat;&#x8FD9;&#x6837;&#x7684;&#x505A;&#x6CD5;&#x9694;&#x79BB;&#x4E86;&#x7236;&#x7C7B;&#x548C;&#x5B50;&#x7C7B;&#x3002;&#x4F18;&#x70B9;&#x662F;&#x8282;&#x7701;&#x5185;&#x5B58; &#x56E0;&#x4E3A;F&#x662F;&#x7A7A;&#x51FD;&#x6570;&#xFF0C;&#x5B9A;&#x4E49;Cat.prototype&#x7684;&#x65F6;&#x5019;&#xFF0C;new&#x7684;&#x662F;F&#x6BD4;new&#x4E00;&#x4E2A;Animal&#x80AF;&#x5B9A;&#x662F;&#x8981;&#x8282;&#x7701;&#x5185;&#x5B58;&#x7684;&#x3002;&#x7F3A;&#x70B9;&#x662F;&#x4E0D;&#x592A;&#x76F4;&#x89C2;&#x3002;&#x4E0D;&#x8FC7;&#x636E;&#x8BF4;&#x6709;&#x4E9B;JS&#x5E93;&#xFF08;YUI&#xFF09;&#x7684;OO&#x5C31;&#x662F;&#x7528;&#x7684;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x3002;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF1A;1.function extend(Child, Parent) {2. var F = function(){};3. F.prototype = Parent.prototype;4. Child.prototype = new F();5. Child.prototype.constructor = Child;6. Child.uber = Parent.prototype;7.}8.9.extend(Cat,Animal);10.var cat1 = new Cat(&quot;&#x5927;&#x6BDB;&quot;,&quot;&#x9EC4;&#x8272;&quot;);11.alert(cat1.species); // &#x52A8;&#x7269;&#x8FD9;&#x91CC;&#x7528;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;uber&#x5C5E;&#x6027;&#x3002;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x610F;&#x601D;&#x662F;&#x4E3A;&#x5B50;&#x5BF9;&#x8C61;&#x8BBE;&#x4E00;&#x4E2A;uber&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x76F4;&#x63A5;&#x6307;&#x5411;&#x7236;&#x5BF9;&#x8C61;&#x7684;prototype&#x5C5E;&#x6027;&#x3002;&#xFF08;uber&#x662F;&#x4E00;&#x4E2A;&#x5FB7;&#x8BED;&#x8BCD;&#xFF0C;&#x610F;&#x601D;&#x662F;&#x201D;&#x5411;&#x4E0A;&#x201D;&#x3001;&#x201D;&#x4E0A;&#x4E00;&#x5C42;&#x201D;&#x3002;&#xFF09;&#x8FD9;&#x7B49;&#x4E8E;&#x5728;&#x5B50;&#x5BF9;&#x8C61;&#x4E0A;&#x6253;&#x5F00;&#x4E00;&#x6761;&#x901A;&#x9053;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x7236;&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x8FD9;&#x4E00;&#x884C;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x7EE7;&#x627F;&#x7684;&#x5B8C;&#x5907;&#x6027;&#xFF0C;&#x7EAF;&#x5C5E;&#x5907;&#x7528;&#x6027;&#x8D28;&#x3002;&#x6211;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x7ED9;&#x5B50;&#x7C7B;&#x80FD;&#x8BBF;&#x95EE;&#x7236;&#x7C7B;&#x51FD;&#x6570;&#x7684;&#x673A;&#x4F1A;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x53EB;uber&#xFF0C;&#x6211;&#x89C9;&#x5F97;&#x5E94;&#x8BE5;&#x662F;&#x7EA6;&#x5B9A;&#x4FD7;&#x6210;&#x7684;&#x3002;1.&gt; function Cat2(){}2.&gt; &apos;uber&apos; in Cat23.false4.&gt;&#x6700;&#x540E;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x53E6;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x91CC;&#x9762;&#x62F7;&#x8D1D;&#x7236;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x8FBE;&#x5230;&#x7EE7;&#x627F;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x8FD9;&#x4E2A;&#x548C;&#x540E;&#x4E00;&#x7AE0;&#x7684;&#x7EE7;&#x627F;&#x65B9;&#x6CD5;&#x6709;&#x5F02;&#x66F2;&#x540C;&#x5DE5;&#x4E4B;&#x6548;&#x3002;&#x533A;&#x522B;&#x662F;&#x8FD9;&#x91CC;&#x662F;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x91CC;&#x505A;&#x62F7;&#x8D1D;&#x3002;1.function extend2(Child, Parent) {2. var p = Parent.prototype;3. var c = Child.prototype;4. for (var i in p) {5. c[i] = p[i];6. }7. c.uber = p;8.}9.10.extend2(Cat, Animal);11.var cat1 = new Cat(&quot;&#x5927;&#x6BDB;&quot;,&quot;&#x9EC4;&#x8272;&quot;);12.alert(cat1.species); // &#x52A8;&#x7269;&#x6CE8;&#x610F;Javascript&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#xFF08;&#x4E8C;&#xFF09;&#xFF1A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x7EE7;&#x627F;&#x4E2D;&#x867D;&#x7136;&#x6CA1;&#x6709;&#x63D0;&#x5230;&#xFF0C;&#x4F46;&#x8FD9;&#x91CC;&#x4ECD;&#x7136;&#x4F1A;&#x6709;&#x6DF1;&#x62F7;&#x8D1D;&#xFF0C;&#x6D45;&#x62F7;&#x8D1D;&#x7684;&#x95EE;&#x9898;&#x3002;&#x901A;&#x8FC7;&#x62F7;&#x8D1D;&#x7EE7;&#x627F;&#x8FD9;&#x91CC;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x548C;&#x6807;&#x51C6;&#x7684;OO&#x5904;&#x7406;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x540C;&#x3002;&#x8FD9;&#x91CC;&#x8981;&#x5904;&#x7406;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x8BA9;&#x4E24;&#x4E2A;&#x666E;&#x901A;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x6709;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#xFF1A;1.var Chinese = {2. nation:&apos;&#x4E2D;&#x56FD;&apos;3.};4.var Doctor ={5. career:&apos;&#x533B;&#x751F;&apos;6.}&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x90FD;&#x662F;&#x666E;&#x901A;&#x7684;&#x5B57;&#x5178;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E0D;&#x50CF;&#x524D;&#x4E00;&#x7AE0;&#x8BF4;&#x7684;&#x662F;&#x7528;function&#x6784;&#x9020;&#x51FA;&#x6765;&#x7684;&#x7C7B;&#xFF0C;&#x518D;&#x7528;new&#x6784;&#x9020;&#x7684;&#x5BF9;&#x8C61;&#x3002; &#x73B0;&#x5728;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x2019;&#x4E2D;&#x56FD;&#x533B;&#x751F;&#x2019;&#x8981;&#x5982;&#x4F55;&#x5B9A;&#x4E49;&#x3002;&#x8FD9;&#x91CC;&#x5F88;&#x5BB9;&#x6613;&#x60F3;&#x5230;&#x5C31;&#x662F;&#x628A;Chinese&#x91CC;&#x9762;&#x7684;&#x5C5E;&#x6027;&#x62F7;&#x7ED9;Doctor&#x5C31;&#x597D;&#x4E86;&#x561B;&#x3002;&#x90A3;&#x8FD9;&#x4E00;&#x7AE0;&#x8BB2;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x5185;&#x5BB9;&#x3002;object()&#x65B9;&#x6CD5;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5176;&#x5B9E;&#x8FD8;&#x662F;&#x5728;&#x7528;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;1.function object(o) {2. function F() {}3. F.prototype = o;4. return new F();5.}6.7.var Doctor = object(Chinese);8.Doctor.career = &apos;&#x533B;&#x751F;&apos;;9.alert(Doctor.nation); //&#x4E2D;&#x56FD;&#x6839;&#x636E;&#x4E0A;&#x4E00;&#x7AE0;&#x6211;&#x4EEC;&#x8BB2;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF1A;Doctor&#x662F;F&#x7C7B;&#x7684;&#x5BF9;&#x8C61;F&#x7C7B;&#x901A;&#x8FC7;prototype&#x7EE7;&#x627F;&#x4E86;Chinese&#x5BF9;&#x8C61;&#x6709;&#x4E0B;&#x9762;&#x7684;&#x7B49;&#x5F0F;1.&gt; Doctor.constructor === Chinese.constructor2.trueDoctor&#x662F;F&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;F&#x7C7B;&#x7684;prototype&#x662F;Chinese&#x5BF9;&#x8C61;&#xFF0C;Doctor&#x7684;constructor&#x6307;&#x5411;&#x4ED6;&#x539F;&#x578B;&#x7684;contructor&#x3002; &#x975E;&#x8981;&#x548C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x626F;&#x4E0A;&#x5173;&#x7CFB;&#xFF0C;&#x662F;&#x60F3;&#x5BF9;&#x4E0A;&#x4E00;&#x7AE0;&#x7684;&#x77E5;&#x8BC6;&#x6D3B;&#x5B66;&#x6D3B;&#x7528;&#x3002;&#x4F5C;&#x8005;&#x628A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5217;&#x5728;&#x8FD9;&#x91CC;&#x7684;&#x7528;&#x610F;&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x8FD9;&#x91CC;&#x7684;&#x65B9;&#x6CD5;&#x8DDF;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;constructor&#x6CA1;&#x534A;&#x6BDB;&#x94B1;&#x5173;&#x7CFB;&#x3002;&#x53EA;&#x662F;&#x5355;&#x7EAF;&#x7684;&#x5C06;Chinese&#x901A;&#x8FC7;prototype&#x4F20;&#x7ED9;Doctor&#x3002;&#x540E;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x4ECE;&#x5F62;&#x5F0F;&#x4E0A;&#x4E5F;&#x548C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E5F;&#x6CA1;&#x534A;&#x6BDB;&#x94B1;&#x5173;&#x7CFB;&#x4E86;&#x3002;&#x6D45;&#x62F7;&#x8D1D;&#x6DF1;&#x62F7;&#x8D1D; &#x4E0D;&#x8BB2;&#x6D45;&#x62F7;&#x8D1D;&#xFF0C;&#x56E0;&#x4E3A;&#x6DF1;&#x62F7;&#x8D1D;&#x5305;&#x542B;&#x4E86;&#x6D45;&#x62F7;&#x8D1D;&#x6DF1;&#x62F7;&#x8D1D;&#x5176;&#x5B9E;&#x62F7;&#x8D1D;&#x5BF9;&#x4E8E;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x672C;&#x8EAB;&#x5C31;&#x662F;&#x6700;&#x76F4;&#x89C9;&#x7684;&#x65B9;&#x6848;&#x3002;&#x76F4;&#x63A5;&#x770B;code&#xFF1A;1.function deepCopy(p, c) {2. var c = c || {};3. for (var i in p) {4. if (typeof p[i] === &apos;object&apos;) {5. c[i] = (p[i].constructor === Array) ? [] : {};6. deepCopy(p[i], c[i]);7. } else {8. c[i] = p[i];9. }10. }11. return c;12.}13.var Doctor = deepCopy(Chinese);&#x8981;&#x7528;&#x6DF1;&#x62F7;&#x8D1D;&#x7684;&#x539F;&#x56E0;&#x662F;Chinese&#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x53EF;&#x80FD;&#x6709;&#x6210;&#x5458;&#x7684;&#x503C;&#x662F;&#x6570;&#x7EC4;&#x6216;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x3002;jQuery&#x5E93;&#x7528;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x79CD;&#x7EE7;&#x627F;&#x65B9;&#x6CD5;&#x3002;%23Javascript%u9762%u5411%u5BF9%u8C61%u5165%u95E8%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5Bjavascript%2C%u9762%u5411%u5BF9%u8C61%5D%0A%0A%5BTOC%5D%0A%0A%u5199%u8FD9%u7BC7%u7B14%u8BB0%uFF0C%u662F%u9605%u8BFB%u4E86%u4EE5%u4E0B%u8FD9%u4E2A%u7CFB%u5217%u4E09%u4E2A%u7F51%u9875%uFF0C%u60F3%u6458%u5F55%u4E00%u4E9B%u4E1C%u897F%uFF0C%u4EE5%u540E%u4E5F%u65B9%u4FBF%u56DE%u5FC6%u3002%0A-%20%5BJavascript%20%u9762%u5411%u5BF9%u8C61%u7F16%u7A0B%uFF08%u4E00%uFF09%uFF1A%u5C01%u88C5%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/f579e44e-fb4a-4bc5-ac4e-4279f39cf00e/%29%0A-%20%5BJavascript%u9762%u5411%u5BF9%u8C61%u7F16%u7A0B%uFF08%u4E8C%uFF09%uFF1A%u6784%u9020%u51FD%u6570%u7684%u7EE7%u627F%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/9f56f8ec-b75a-469d-9320-d3d206766dc1/%29%0A-%20%5BJavascript%u9762%u5411%u5BF9%u8C61%u7F16%u7A0B%uFF08%u4E09%uFF09%uFF1A%u975E%u6784%u9020%u51FD%u6570%u7684%u7EE7%u627F%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/32cfbff4-0cef-44a2-adeb-6953cecc1158/%29%0A%0A%u4F5C%u8005%u7531%u6D45%u5165%u6DF1%uFF0C%u5A13%u5A13%u9053%u6765%uFF0C%u8BB2%u7684%u5F88%u900F%u5F7B%u3002%u6587%u4E2D%u8BB2%u4E86%u5F88%u591A%u79CDjavascript%u5B9E%u73B0%u9762%u5411%u5BF9%u8C61%u7684%u65B9%u6CD5%uFF0C%u548C%u5404%u81EA%u7684%u4F18%u52A3%u3002%u6211%u53EA%u8BB0%u5F55%u4F5C%u8005%u8BA4%u4E3A%u6700%u597D%u7684%uFF0C%u548C%u6211%u8BA4%u4E3A%u6700%u5E38%u89C1%u7684%u3002%0A%0A%u5728%u5F00%u59CB%u4E4B%u524D%uFF0C%u6709%u4E00%u4E9Bheads%20up%u3002%0A-%20JS%u672C%u8EAB%u662F%u4E0D%u652F%u6301OO%u7684%uFF0C%u4F46%u662F%u8FD0%u7528%u5176%u81EA%u8EAB%u7684%u5404%u79CD%u7279%u6027%uFF0C%u4ECD%u7136%u80FD%u5B9E%u73B0%u7C7B%u7684%u5C01%u88C5%u548C%u7EE7%u627F%uFF0C%u8FD9%u662FOO%u7684%u7CBE%u534E%u90E8%u5206%0A-%20JS%u4E2D%u6240%u6709%u7269%u4EF6%u90FD%u662F%u5BF9%u8C61%0A%09-%20function%u5B9A%u4E49%u7684%u51FD%u6570%u662FFunction%u7C7B%u7684%u5BF9%u8C61%0A%09-%20%u5B57%u5178%u662FObject%u7C7B%u7684%u5BF9%u8C61%0A%09-%20%u6570%u7EC4%u662FArray%u7C7B%u7684%u5BF9%u8C61%0A%09-%20%u7B80%u5355%u53D8%u91CF%u662FNumber%u7C7B%u5BF9%u8C61%0A%0A%23%23%u7C7B%u5C01%u88C5%u7684Prototype%u6A21%u5F0F%0A%u770B%u4E0B%u9762%u7684code%uFF1A%0A%60%60%60javascript%0Afunction%20Cat%28name%2Ccolor%29%7B%0A%09this.name%20%3D%20name%3B%0A%09this.color%20%3D%20color%3B%0A%7D%0A%0ACat.prototype.type%20%3D%20%22%u732B%u79D1%u52A8%u7269%22%3B%0ACat.prototype.eat%20%3D%20function%28%29%7Balert%28%22%u5403%u8001%u9F20%22%29%7D%3B%0A%u3000%u3000%0Avar%20cat1%20%3D%20new%20Cat%28%22%u5927%u6BDB%22%2C%22%u9EC4%u8272%22%29%3B%0Avar%20cat2%20%3D%20new%20Cat%28%22%u4E8C%u6BDB%22%2C%22%u9ED1%u8272%22%29%3B%0A%0Aalert%28cat1.type%29%3B%20//%20%u732B%u79D1%u52A8%u7269%0Acat1.eat%28%29%3B%20//%20%u5403%u8001%u9F20%0A%60%60%60%0A%u6BCF%u4E2A%u51FD%u6570%u90FD%u6709%u4E00%u4E2Aprototype%u4E0A%uFF0C%u6BCF%u4E2Aprototype%u6307%u5411%u53E6%u4E00%u4E2A%u5BF9%u8C61%u3002%u4E0D%u53D8%u7684%u5C5E%u6027%uFF0C%u65B9%u6CD5%u53EF%u4EE5%u5B9A%u4E49%u5728%u8FD9%u4E2Aprototype%u4E0A%uFF0C%u4ECE%u800C%u8FBE%u5230%u51CF%u5C11%u91CD%u590D%uFF0C%u8282%u7701%u5185%u5B58%u7684%u4F5C%u7528%u3002%0A%0Aexpress%u4E2D%u7684model%u5B9A%u4E49%u5C31%u662F%u7528%u7684%u8FD9%u79CD%u65B9%u5F0F%u3002%0A%0A%23%23%u7EE7%u627F%0A%u7EE7%u627F%u6709%u4E24%u79CD%uFF0C%u901A%u8FC7%u6784%u9020%u51FD%u6570%u7EE7%u627F%u548C%u901A%u8FC7%u5BF9%u8C61%u62F7%u8D1D%u7EE7%u627F%u3002javascript%u662F%u9762%u5411%u51FD%u6570%u7F16%u7A0B%uFF0C%u8FD9%u4E2A%u51FD%u6570%u5BF9%u4E8E%u7C7B%u5B9A%u4E49%u6765%u8BF4%u5176%u5B9E%u5C31%u662F%u6784%u9020%u51FD%u6570%u3002%u4E0A%u9762%u8BB2%u7684prototype%u5C31%u6709%u70B9%u7EE7%u627F%u7684%u610F%u601D%u4E86%u3002%u4F46%u6211%u4EEC%u7684prototype%u5E76%u6CA1%u6709%u4E00%u4E2A%u51FD%u6570%u4E0E%u4E4B%u5BF9%u5E94%uFF0C%u5373%u6CA1%u6709%u6784%u9020%u51FD%u6570%uFF0C%u6240%u4EE5%u5B83%u4E0D%u80FD%u79F0%u5176%u7C7B%uFF0C%u4E5F%u6CA1%u6CD5%u5B9E%u4F8B%u5316%u3002%u6240%u4EE5%u4E0D%u80FD%u79F0%u5176%u4E3A%u7EE7%u627F%u3002%0A%0A%23%23%23%u901A%u8FC7%u6784%u9020%u51FD%u6570%u7EE7%u627F%0A%23%23%23%23%u901A%u8FC7prototype%u7EE7%u627F%0A%u90A3%u8981%u7EE7%u627F%u5C31%u8981%u6709%u6784%u9020%u51FD%u6570%0A%60%60%60javascript%0Afunction%20Animal%28%29%7B%0A%09this.species%20%3D%20%22%u52A8%u7269%22%3B%0A%7D%0ACat.prototype%20%3D%20new%20Animal%28%29%3B%0ACat.prototype.constructor%20%3D%20Cat%3B%0Avar%20cat1%20%3D%20new%20Cat%28%22%u5927%u6BDB%22%2C%22%u9EC4%u8272%22%29%3B%0Aalert%28cat1.species%29%3B%20//%20%u52A8%u7269%0A%60%60%60%0A%u8FD9%u6837%u5C31%u662F%u771F%u6B63%u7684%u7EE7%u627F%u4E86%uFF0CCat%u7EE7%u627F%u81EAAnimal%u3002%u8FD9%u91CC%u6709%u4E00%u4E2A%u5C0F%u628A%u620F%uFF1A%60Cat.prototype.constructor%20%3D%20Cat%3B%60%0A%u8FD9%u91CC%u7275%u6D89%u5230%u4E00%u4E2A%u5F88%u9976%u4EBA%u7684%u5C0F%u95EE%u9898%uFF0C%u4E5F%u662F%u5F88%u591A%u4EBA%u5728%u8BA8%u8BBA%u7684%uFF0C%u4E5F%u662Fjsoo%u8EB2%u4E0D%u5F00%u7684%u95EE%u9898%uFF0C%u5C31%u662F%uFF1A%0A%3Econstructor%u7684%u4F5C%u7528%u5230%u5E95%u662F%u4EC0%u4E48%uFF1F%0A%u9996%u5148%uFF0C%u5728js%u4E2D%uFF0C%u6240%u6709%u7684%u7269%u4EF6%u7686%u4E3A%u5BF9%u8C61%u3002%0A%u5176%u6B21%u6BCF%u4E00%u4E2A%u5BF9%u8C61%u90FD%u6709%u4ED6%u7684%u6784%u9020%u51FD%u6570%uFF0C%u7531%60object.constructor%60%u6307%u660E%u3002%0A%u6700%u540E%uFF0C%u6240%u6709%60object.constructor%60%u5747%u7B49%u4E8E%60object.prototype.constructor%60%u3002%u770B%u4E0B%u9762%u7684REPL%u7684%u4EE3%u7801%uFF1A%0A%60%60%60javascript%0A%3E%20function%20Cat%28%29%7B%7D%0A%3E%20function%20Animal%28%29%7B%7D%0A%3E%20Cat.prototype%3Dnew%20Animal%0A%3E%20cat%20%3D%20new%20Cat%28%29%0AAnimal%20%7B%7D%20//%20%u770B%u8FD9%u91CC%u7684%u7ED3%u679C%0A%3E%20cat.constructor%3D%3D%3DAnimal%20//%20%u518D%u770B%u8FD9%u4E00%u884C%0Atrue%0A%3E%20Cat.constructor%20%3D%3D%3D%20Function%0Atrue%0A%60%60%60%0A%u53EF%u89C1%uFF0C%u5982%u679C%u4FEE%u6539%u4E86%u7C7B%u7684prototype%uFF0C%u5B83%u81EA%u5DF1%u5BF9%u8C61%u7684constructor%u5C31%u4F1A%u6307%u5411%u5176%u4ED6%u7684%u5730%u65B9%u3002%u95EE%u9898%u6765%u4E86%uFF1A%0A%3E%u8FD9%u4E48%u505A%u6709%u4EC0%u4E48%u95EE%u9898%u5462%uFF1F%0A%0A%u8FD9%u8BA9%u6211%u767E%u601D%u4E0D%u5F97%u5176%u89E3%u3002%u5F15%u7528%u77E5%u4E4E%u4E0A%u4E00%u4E2A%u56DE%u7B54%uFF1A%0A%3Econstructor%u5C5E%u6027%u4E0D%u5F71%u54CD%u4EFB%u4F55JavaScript%u7684%u5185%u90E8%u5C5E%u6027%u3002instanceof%u68C0%u6D4B%u5BF9%u8C61%u7684%u539F%u578B%u94FE%uFF0C%u901A%u5E38%u4F60%u662F%u65E0%u6CD5%u4FEE%u6539%u7684%uFF08%u4E0D%u8FC7%u67D0%u4E9B%u5F15%u64CE%u901A%u8FC7%u79C1%u6709%u7684__proto__%u5C5E%u6027%u66B4%u9732%u51FA%u6765%uFF09%u3002%0A%3E**constructor%u5176%u5B9E%u6CA1%u6709%u4EC0%u4E48%u7528%u5904%uFF0C%u53EA%u662FJavaScript%u8BED%u8A00%u8BBE%u8BA1%u7684%u5386%u53F2%u9057%u7559%u7269**%u3002%u7531%u4E8Econstructor%u5C5E%u6027%u662F%u53EF%u4EE5%u53D8%u66F4%u7684%uFF0C%u6240%u4EE5%u672A%u5FC5%u771F%u7684%u6307%u5411%u5BF9%u8C61%u7684%u6784%u9020%u51FD%u6570%uFF0C%u53EA%u662F%u4E00%u4E2A%u63D0%u793A%u3002**%u4E0D%u8FC7%uFF0C%u4ECE%u7F16%u7A0B%u4E60%u60EF%u4E0A%uFF0C%u6211%u4EEC%u5E94%u8BE5%u5C3D%u91CF%u8BA9%u5BF9%u8C61%u7684constructor%u6307%u5411%u5176%u6784%u9020%u51FD%u6570%uFF0C%u4EE5%u7EF4%u6301%u8FD9%u4E2A%u60EF%u4F8B**%u3002%0A%0A%u7528instanceof%u770B%u4E0D%u51FA%u4EC0%u4E48%u5DEE%u522B%uFF0C%u53EF%u80FD%u4E5F%u5370%u8BC1%u4E86%u8FD9%u4F4D%u77E5%u4E4E%u5927%u725B%u7684%u89C2%u70B9%u3002%0A%60%60%60javascript%0A%3E%20cat%20%3D%20new%20Cat%28%29%0AAnimal%20%7B%7D%0A%3E%20cat%20instanceof%20Cat%0Atrue%0A%3E%20cat%20instanceof%20Animal%0Atrue%0A%3E%20Cat.prototype.constructor%3DCat%0A%5BFunction%3A%20Cat%5D%0A%3E%20cat%3Dnew%20Cat%28%29%0ACat%20%7B%7D%0A%3E%20cat%20instanceof%20Cat%0Atrue%0A%3E%20cat%20instanceof%20Animal%0Atrue%0A%60%60%60%0A%0A%u518D%u56DE%u5230%u6211%u4EEC%u4E4B%u524D%u7684%u4F8B%u5B50%60Cat.prototype%20%3D%20new%20Animal%28%29%3B%60%u8FD9%u4E00%u53E5%u4E5F%u9690%u542B%u7684%u505A%u4E86%60Cat.prototype.constructor%20%3D%20Animal%60%u3002%u5BFC%u81F4%60cat.constructor%20%3D%3D%3D%20Cat.prototype.constructor%60%0A%u770B%u8D77%u6765%u6709%u70B9%u4E71%uFF0Ccat%u770B%u8D77%u6765%u662F%u7531Animal%u6765%u6784%u9020%u7684%u4E86%u3002%0A%u6211%u7684%u7406%u89E3%u662F%uFF1A%0A%3E%u4E00%u822C%u4F7F%u7528%u4E0D%u4F1A%u6709%u95EE%u9898%uFF0C%u5F53%u5728%u4E00%u4E9B%u9AD8%u7EA7%u5E94%u7528%u573A%u5408%uFF0C%u8981%u7528%u5230%u53CD%u5C04%u7684%u65F6%u5019%uFF0C%u5982%u679Cconstructor%u8BBE%u7F6E%u4E0D%u5BF9%u4F1A%u5F15%u8D77%u4E0D%u5FC5%u8981%u7684%u9EBB%u70E6%u3002%0A%0A%u6839%u636Eprototype%u7EE7%u627F%u7684%u65B9%u6CD5%uFF0C%5BJavascript%u9762%u5411%u5BF9%u8C61%u7F16%u7A0B%uFF08%u4E8C%uFF09%uFF1A%u6784%u9020%u51FD%u6570%u7684%u7EE7%u627F%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/9f56f8ec-b75a-469d-9320-d3d206766dc1/%29%u53C8%u63D0%u51FA%u4E86%u4E24%u79CD%u6539%u8FDB%u578B%u7684%u7EE7%u627F%u65B9%u6CD5%uFF0C%u5206%u522B%u662F%0A-%20%u76F4%u63A5%u7EE7%u627Fprototype%0A-%20%u5229%u7528%u7A7A%u5BF9%u8C61%u4F5C%u4E3A%u4E2D%u4ECB%0A%0A%23%23%23%23%u76F4%u63A5%u7EE7%u627Fprototype%0A%u7C7B%u7684prototype%u662F%u8FD9%u4E2A%u7C7B%u7A33%u5B9A%u7684%u90E8%u5206%uFF0C%u5F53%u6211%u4EEC%u60F3%u7EE7%u627F%u7684%u65F6%u5019%uFF0C%u5176%u5B9E%u5C31%u662F%u60F3%u7EE7%u627F%u7C7B%u4E2D%u7A33%u5B9A%u7684%u90E8%u5206%u3002%u6240%u4EE5%u8FD9%u4E2A%u65B9%u6CD5%u5C31%u662F%u76F4%u63A5%u7EE7%u627F%u7236%u7C7B%u7684prototype%uFF1A%0A%60%60%60javascript%0Afunction%20Animal%28%29%7B%0A%09this.species%20%3D%20%22%u52A8%u7269%22%3B%0A%7D%0ACat.prototype%20%3D%20Aninal.prototype%3B%0ACat.prototype.constructor%20%3D%20Cat%3B%0A%60%60%60%0A%u867D%u7136%u542C%u8D77%u6765%u6709%u7406%uFF0C%u4E0D%u8FC7%u771F%u7684%u8FD9%u4E48%u505A%u8FD8%u662F%u633A%u5947%u602A%u7684%u3002%u5B50%u7C7B%u548C%u7236%u7C7B%u7684prototype%u6307%u5411%u4E86%u540C%u4E00%u4E2A**%u5BF9%u8C61**%28JSOO%u4E2D%uFF0C%u4E07%u7269%u7686%u5BF9%u8C61%uFF0C%u548CC++/Java%u4E2D%u7684%u5BF9%u8C61%u6982%u5FF5%u6709%u7A0D%u8BB8%u533A%u522B%29%u3002%0A%u800C%u5BF9Cat.prototype.constructor%u7684%u4FEE%u6539%u76F4%u63A5%u5F71%u54CD%u4E86Animal.constructor%u3002%0A%0A%u7ED3%u8BBA%u5C31%u662F%u8FD9%u4E2A%u65B9%u6CD5%u4E0D%u597D%uFF0C%u4E0D%u80FD%u7528%u3002%0A%0A%23%23%23%23%u5229%u7528%u7A7A%u5BF9%u8C61%u4F5C%u4E3A%u4E2D%u4ECB%0A%u76F4%u63A5%u4E0A%u4EE3%u7801%uFF1A%0A%60%60%60javascript%0Avar%20F%20%3D%20function%28%29%7B%7D%3B%0AF.prototype%20%3D%20Animal.prototype%3B%0ACat.prototype%20%3D%20new%20F%28%29%3B%0ACat.prototype.constructor%20%3D%20Cat%3B%0A%60%60%60%0A%u8FD9%u6837%u7684%u505A%u6CD5%u9694%u79BB%u4E86%u7236%u7C7B%u548C%u5B50%u7C7B%u3002%0A-%20%u4F18%u70B9%u662F%u8282%u7701%u5185%u5B58%0A%09-%20%u56E0%u4E3AF%u662F%u7A7A%u51FD%u6570%uFF0C%u5B9A%u4E49Cat.prototype%u7684%u65F6%u5019%uFF0Cnew%u7684%u662FF%u6BD4new%u4E00%u4E2AAnimal%u80AF%u5B9A%u662F%u8981%u8282%u7701%u5185%u5B58%u7684%u3002%0A-%20%u7F3A%u70B9%u662F%u4E0D%u592A%u76F4%u89C2%u3002%0A%0A%u4E0D%u8FC7%u636E%u8BF4%u6709%u4E9BJS%u5E93%uFF08YUI%uFF09%u7684OO%u5C31%u662F%u7528%u7684%u8FD9%u79CD%u6A21%u5F0F%u3002%0A%0A%u4F7F%u7528%u65B9%u6CD5%uFF1A%0A%60%60%60javascript%0Afunction%20extend%28Child%2C%20Parent%29%20%7B%0A%09var%20F%20%3D%20function%28%29%7B%7D%3B%0A%09F.prototype%20%3D%20Parent.prototype%3B%0A%09Child.prototype%20%3D%20new%20F%28%29%3B%0A%09Child.prototype.constructor%20%3D%20Child%3B%0A%09Child.uber%20%3D%20Parent.prototype%3B%0A%7D%0A%0Aextend%28Cat%2CAnimal%29%3B%0Avar%20cat1%20%3D%20new%20Cat%28%22%u5927%u6BDB%22%2C%22%u9EC4%u8272%22%29%3B%0Aalert%28cat1.species%29%3B%20//%20%u52A8%u7269%0A%60%60%60%0A%0A%u8FD9%u91CC%u7528%u5230%u4E86%u4E00%u4E2A%u7C7B%u7684uber%u5C5E%u6027%u3002%u8FD9%u662F%u4EC0%u4E48%uFF1F%0A%3E%u610F%u601D%u662F%u4E3A%u5B50%u5BF9%u8C61%u8BBE%u4E00%u4E2Auber%u5C5E%u6027%uFF0C%u8FD9%u4E2A%u5C5E%u6027%u76F4%u63A5%u6307%u5411%u7236%u5BF9%u8C61%u7684prototype%u5C5E%u6027%u3002%uFF08uber%u662F%u4E00%u4E2A%u5FB7%u8BED%u8BCD%uFF0C%u610F%u601D%u662F%22%u5411%u4E0A%22%u3001%22%u4E0A%u4E00%u5C42%22%u3002%uFF09%u8FD9%u7B49%u4E8E%u5728%u5B50%u5BF9%u8C61%u4E0A%u6253%u5F00%u4E00%u6761%u901A%u9053%uFF0C%u53EF%u4EE5%u76F4%u63A5%u8C03%u7528%u7236%u5BF9%u8C61%u7684%u65B9%u6CD5%u3002%u8FD9%u4E00%u884C%u653E%u5728%u8FD9%u91CC%uFF0C%u53EA%u662F%u4E3A%u4E86%u5B9E%u73B0%u7EE7%u627F%u7684%u5B8C%u5907%u6027%uFF0C%u7EAF%u5C5E%u5907%u7528%u6027%u8D28%u3002%0A%0A%u6211%u7684%u7406%u89E3%uFF0C%u7ED9%u5B50%u7C7B%u80FD%u8BBF%u95EE%u7236%u7C7B%u51FD%u6570%u7684%u673A%u4F1A%u3002%u4E3A%u4EC0%u4E48%u53EBuber%uFF0C%u6211%u89C9%u5F97%u5E94%u8BE5%u662F%u7EA6%u5B9A%u4FD7%u6210%u7684%u3002%0A%0A%60%60%60javascript%0A%3E%20function%20Cat2%28%29%7B%7D%0A%3E%20%27uber%27%20in%20Cat2%0Afalse%0A%3E%0A%60%60%60%0A%0A%u6700%u540E%u8FD8%u6709%u4E00%u4E2A%u53E6%u7C7B%uFF0C%u901A%u8FC7%u5728%u6784%u9020%u51FD%u6570%u91CC%u9762%u62F7%u8D1D%u7236%u7C7B%u7684%u5C5E%u6027%u8FBE%u5230%u7EE7%u627F%u7684%u6548%u679C%uFF0C%u8FD9%u4E2A%u548C%u540E%u4E00%u7AE0%u7684%u7EE7%u627F%u65B9%u6CD5%u6709%u5F02%u66F2%u540C%u5DE5%u4E4B%u6548%u3002%u533A%u522B%u662F%u8FD9%u91CC%u662F%u5728%u6784%u9020%u51FD%u6570%u91CC%u505A%u62F7%u8D1D%u3002%0A%60%60%60javascript%0Afunction%20extend2%28Child%2C%20Parent%29%20%7B%0A%09var%20p%20%3D%20Parent.prototype%3B%0A%09var%20c%20%3D%20Child.prototype%3B%0A%09for%20%28var%20i%20in%20p%29%20%7B%0A%09%09c%5Bi%5D%20%3D%20p%5Bi%5D%3B%0A%09%7D%0A%09c.uber%20%3D%20p%3B%0A%7D%0A%0Aextend2%28Cat%2C%20Animal%29%3B%0Avar%20cat1%20%3D%20new%20Cat%28%22%u5927%u6BDB%22%2C%22%u9EC4%u8272%22%29%3B%0Aalert%28cat1.species%29%3B%20//%20%u52A8%u7269%0A%60%60%60%0A%u6CE8%u610F%5BJavascript%u9762%u5411%u5BF9%u8C61%u7F16%u7A0B%uFF08%u4E8C%uFF09%uFF1A%u6784%u9020%u51FD%u6570%u7684%u7EE7%u627F%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/9f56f8ec-b75a-469d-9320-d3d206766dc1/%29%u4E2D%u867D%u7136%u6CA1%u6709%u63D0%u5230%uFF0C%u4F46%u8FD9%u91CC%u4ECD%u7136%u4F1A%u6709%u6DF1%u62F7%u8D1D%uFF0C%u6D45%u62F7%u8D1D%u7684%u95EE%u9898%u3002%0A%23%23%23%u901A%u8FC7%u62F7%u8D1D%u7EE7%u627F%0A%u8FD9%u91CC%u89E3%u51B3%u7684%u95EE%u9898%uFF0C%u548C%u6807%u51C6%u7684OO%u5904%u7406%u7684%u95EE%u9898%u4E0D%u540C%u3002%u8FD9%u91CC%u8981%u5904%u7406%u7684%u95EE%u9898%uFF0C%u662F%u8BA9%u4E24%u4E2A%u666E%u901A%u5BF9%u8C61%u4E4B%u95F4%u6709%u7EE7%u627F%u5173%u7CFB%uFF1A%0A%60%60%60javascript%0Avar%20Chinese%20%3D%20%7B%0A%09nation%3A%27%u4E2D%u56FD%27%0A%7D%3B%0Avar%20Doctor%20%3D%7B%0A%09career%3A%27%u533B%u751F%27%0A%7D%0A%60%60%60%0A%u6CE8%u610F%u8FD9%u91CC%u90FD%u662F%u666E%u901A%u7684%u5B57%u5178%u7C7B%u578B%u5BF9%u8C61%uFF0C%u5E76%u4E0D%u50CF%u524D%u4E00%u7AE0%u8BF4%u7684%u662F%u7528function%u6784%u9020%u51FA%u6765%u7684%u7C7B%uFF0C%u518D%u7528new%u6784%u9020%u7684%u5BF9%u8C61%u3002%0A%u73B0%u5728%u8981%u89E3%u51B3%u7684%u95EE%u9898%uFF0C%u662F%27%u4E2D%u56FD%u533B%u751F%27%u8981%u5982%u4F55%u5B9A%u4E49%u3002%u8FD9%u91CC%u5F88%u5BB9%u6613%u60F3%u5230%u5C31%u662F%u628AChinese%u91CC%u9762%u7684%u5C5E%u6027%u62F7%u7ED9Doctor%u5C31%u597D%u4E86%u561B%u3002%u90A3%u8FD9%u4E00%u7AE0%u8BB2%u7684%u5C31%u662F%u8FD9%u4E2A%u5185%u5BB9%u3002%0A%0A%23%23%23%23object%28%29%u65B9%u6CD5%0A%u8FD9%u4E2A%u65B9%u6CD5%u5176%u5B9E%u8FD8%u662F%u5728%u7528%u6784%u9020%u51FD%u6570%u3002%0A%60%60%60javascript%0Afunction%20object%28o%29%20%7B%0A%09function%20F%28%29%20%7B%7D%0A%09F.prototype%20%3D%20o%3B%0A%09return%20new%20F%28%29%3B%0A%7D%0A%0Avar%20Doctor%20%3D%20object%28Chinese%29%3B%0ADoctor.career%20%3D%20%27%u533B%u751F%27%3B%0Aalert%28Doctor.nation%29%3B%20//%u4E2D%u56FD%0A%60%60%60%0A%u6839%u636E%u4E0A%u4E00%u7AE0%u6211%u4EEC%u8BB2%u7684%u6784%u9020%u51FD%u6570%u7684%u77E5%u8BC6%uFF0C%u53EF%u4EE5%u77E5%u9053%uFF1A%0A-%20Doctor%u662FF%u7C7B%u7684%u5BF9%u8C61%0A-%20F%u7C7B%u901A%u8FC7prototype%u7EE7%u627F%u4E86Chinese%u5BF9%u8C61%0A-%20%u6709%u4E0B%u9762%u7684%u7B49%u5F0F%0A%60%60%60javascript%0A%3E%20Doctor.constructor%20%3D%3D%3D%20Chinese.constructor%0Atrue%0A%60%60%60%0ADoctor%u662FF%u7C7B%u7684%u5BF9%u8C61%uFF0CF%u7C7B%u7684prototype%u662FChinese%u5BF9%u8C61%uFF0CDoctor%u7684constructor%u6307%u5411%u4ED6%u539F%u578B%u7684contructor%u3002%0A%u975E%u8981%u548C%u6784%u9020%u51FD%u6570%u626F%u4E0A%u5173%u7CFB%uFF0C%u662F%u60F3%u5BF9%u4E0A%u4E00%u7AE0%u7684%u77E5%u8BC6%u6D3B%u5B66%u6D3B%u7528%u3002%u4F5C%u8005%u628A%u8FD9%u4E2A%u65B9%u6CD5%u5217%u5728%u8FD9%u91CC%u7684%u7528%u610F%uFF0C%u5176%u5B9E%u662F%u8FD9%u91CC%u7684%u65B9%u6CD5%u8DDF%u6784%u9020%u51FD%u6570%uFF0Cconstructor%u6CA1%u534A%u6BDB%u94B1%u5173%u7CFB%u3002**%u53EA%u662F%u5355%u7EAF%u7684%u5C06Chinese%u901A%u8FC7prototype%u4F20%u7ED9Doctor**%u3002%0A%0A%u540E%u9762%u7684%u65B9%u6CD5%u5C31%u4ECE%u5F62%u5F0F%u4E0A%u4E5F%u548C%u6784%u9020%u51FD%u6570%u4E5F%u6CA1%u534A%u6BDB%u94B1%u5173%u7CFB%u4E86%u3002%0A-%20%u6D45%u62F7%u8D1D%0A-%20%u6DF1%u62F7%u8D1D%0A%u4E0D%u8BB2%u6D45%u62F7%u8D1D%uFF0C%u56E0%u4E3A%u6DF1%u62F7%u8D1D%u5305%u542B%u4E86%u6D45%u62F7%u8D1D%0A%0A%23%23%23%23%u6DF1%u62F7%u8D1D%0A%u5176%u5B9E%u62F7%u8D1D%u5BF9%u4E8E%u89E3%u51B3%u8FD9%u4E2A%u95EE%u9898%uFF0C%u672C%u8EAB%u5C31%u662F%u6700%u76F4%u89C9%u7684%u65B9%u6848%u3002%u76F4%u63A5%u770Bcode%uFF1A%0A%60%60%60javascript%0Afunction%20deepCopy%28p%2C%20c%29%20%7B%0A%09var%20c%20%3D%20c%20%7C%7C%20%7B%7D%3B%0A%09for%20%28var%20i%20in%20p%29%20%7B%0A%09%09if%20%28typeof%20p%5Bi%5D%20%3D%3D%3D%20%27object%27%29%20%7B%0A%09%09%09c%5Bi%5D%20%3D%20%28p%5Bi%5D.constructor%20%3D%3D%3D%20Array%29%20%3F%20%5B%5D%20%3A%20%7B%7D%3B%0A%09%09%09deepCopy%28p%5Bi%5D%2C%20c%5Bi%5D%29%3B%0A%09%09%7D%20else%20%7B%0A%09%09%09c%5Bi%5D%20%3D%20p%5Bi%5D%3B%0A%09%09%7D%0A%09%7D%0A%09return%20c%3B%0A%7D%0Avar%20Doctor%20%3D%20deepCopy%28Chinese%29%3B%0A%60%60%60%0A%u8981%u7528%u6DF1%u62F7%u8D1D%u7684%u539F%u56E0%u662FChinese%u5BF9%u8C61%u5185%u90E8%u53EF%u80FD%u6709%u6210%u5458%u7684%u503C%u662F%u6570%u7EC4%u6216%u5176%u4ED6%u5BF9%u8C61%u3002jQuery%u5E93%u7528%u7684%u5C31%u662F%u8FD9%u79CD%u7EE7%u627F%u65B9%u6CD5%u3002%0A%0A]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>面向对象</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UnitTest++简介]]></title>
    <url>%2F2016%2F02%2F29%2FUnitTest%2B%2B%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[EditUnitTest++&#x7B80;&#x4ECB;CMakeImplement Test CasesLinux Test HarnessMono Graphic Panel Driver&#x6D4B;&#x8BD5;&#x67B6;&#x6784;&#x6700;&#x8FD1;&#x62DC;&#x8BFB;&#x4E86;Kent Beck&#x5927;&#x795E;&#x7684;&#x300A;Test-Driven Development By Example&#x300B;&#xFF0C;&#x6709;&#x4E86;&#x8FD9;&#x7BC7;&#x8BFB;&#x4E66;&#x7B14;&#x8BB0;&#x3002;&#x8FD9;&#x672C;&#x4E66;&#x89E3;&#x7B54;&#x4E86;&#x6211;&#x7684;&#x5F88;&#x591A;&#x5F00;&#x53D1;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x56F0;&#x60D1;&#xFF0C;&#x6240;&#x4EE5;&#x51B3;&#x5B9A;&#x4EE5;&#x540E;&#x8D70;&#x4E0A;TDD&#x7684;&#x9053;&#x8DEF;&#x3002;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x5B66;&#x4E60;UnixTest++&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x56E0;&#x4E3A;&#x60E0;&#x666E;&#x6253;&#x5370;&#x673A;&#x7684;Phoenix FW&#x91CC;&#x9762;&#x66FE;&#x7ECF;&#x6709;&#x5148;&#x8F88;&#x505A;&#x8FC7;&#x7C7B;&#x4F3C;unit test&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x79F0;&#x4E4B;&#x4E3A;Linux Test Harness&#x3002;Harnes&#x662F;&#x9A6C;&#x978D;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x5E94;&#x8BE5;&#x662F;&#x60E0;&#x666E;&#x4EBA;&#x81EA;&#x5DF1;&#x53D6;&#x7684;&#x3002;&#x8FD9;&#x4E2A;Linux Test Harness&#x5C31;&#x662F;&#x57FA;&#x4E8E;UnixTest++&#x7684;&#x3002;&#x76EE;&#x524D;&#x6211;&#x7528;&#x7684;&#x662F;&#x6700;&#x65B0;&#x7248;&#xFF0C;v1.5.1&#x3002;&#x76EE;&#x5F55;&#x6811;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A; &#x251C;&#x2500;&#x2500; AUTHORS &#x251C;&#x2500;&#x2500; CMakeLists.txt &#x251C;&#x2500;&#x2500; ChangeLog &#x251C;&#x2500;&#x2500; INSTALL &#x251C;&#x2500;&#x2500; LICENSE &#x251C;&#x2500;&#x2500; Makefile.am &#x251C;&#x2500;&#x2500; README.md &#x251C;&#x2500;&#x2500; UnitTest++ &#x251C;&#x2500;&#x2500; UnitTest++.pc.in &#x251C;&#x2500;&#x2500; appveyor.yml &#x251C;&#x2500;&#x2500; builds &#x251C;&#x2500;&#x2500; configure.ac &#x251C;&#x2500;&#x2500; docs &#x251C;&#x2500;&#x2500; m4 &#x2502; &#x251C;&#x2500;&#x2500; ax_cxx_compile_stdcxx.m4 &#x2502; &#x2514;&#x2500;&#x2500; ax_cxx_compile_stdcxx_11.m4 &#x2514;&#x2500;&#x2500; tests7 directories, 95 files &#x91CD;&#x8981;&#x7684;&#x6587;&#x4EF6;&#x6216;&#x6587;&#x4EF6;&#x5939;&#x6211;&#x6807;&#x6210;&#x4E86;&#x7EA2;&#x8272;&#x3002;CMakeLists.txt UnitTest++&#x662F;&#x57FA;&#x4E8E;CMake&#x7684;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x5177;&#x4F53;&#x8BB2;CMake&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5C31;&#x7C7B;&#x4F3C;&#x4E8E;CMake&#x7684;&#x5DE5;&#x7A0B;&#x6587;&#x4EF6;&#x3002;CMake&#x57FA;&#x4E8E;&#x5B83;&#x751F;&#x6210;Makefile&#x6216;&#x8005;&#x5176;&#x4ED6;&#x5F00;&#x53D1;&#x5E73;&#x53F0;&#x7684;&#x5DE5;&#x7A0B;&#x6587;&#x4EF6;&#x3002;UnitTest++ UnitTest++&#x662F;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x5C31;&#x662F;UnitTest++&#x6240;&#x6709;&#x7684;&#x6E90;&#x7801;tests &#x8FD9;&#x4E2A;&#x662F;UnitTest++&#x672C;&#x8EAB;&#x7684;test case&#x3002;&#x6211;&#x4EEC;&#x5728;&#x5199;&#x81EA;&#x5DF1;&#x7684;test case&#x7684;&#x65F6;&#x5019;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x522B;&#x4EBA;&#x662F;&#x600E;&#x4E48;&#x5199;&#x7684;&#x3002;CMake&#x8FD9;&#x91CC;&#x6536;&#x96C6;&#x4E86;&#x4E24;&#x7BC7;CMake&#x7684;&#x6587;&#x7AE0;&#xFF0C;CMake&#x4F7F;&#x7528;&#x603B;&#x7ED3;&#x548C;CMake &#x5165;&#x95E8;&#x5B9E;&#x6218; CMake&#x610F;&#x4E3A;Cross-platform Make&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x7BA1;&#x7406;C/C++&#x5DE5;&#x7A0B;&#x3002;&#x4F60;&#x6216;&#x8BB8;&#x542C;&#x8FC7;&#x597D;&#x51E0;&#x79CD; Make &#x5DE5;&#x5177;&#xFF0C;&#x4F8B;&#x5982; GNU Make &#xFF0C;QT &#x7684; qmake &#xFF0C;&#x5FAE;&#x8F6F;&#x7684; MS nmake&#xFF0C;BSD Make&#xFF08;pmake&#xFF09;&#xFF0C;Makepp&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E9B; Make &#x5DE5;&#x5177;&#x9075;&#x5FAA;&#x7740;&#x4E0D;&#x540C;&#x7684;&#x89C4;&#x8303;&#x548C;&#x6807;&#x51C6;&#xFF0C;&#x6240;&#x6267;&#x884C;&#x7684; Makefile &#x683C;&#x5F0F;&#x4E5F;&#x5343;&#x5DEE;&#x4E07;&#x522B;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x5E26;&#x6765;&#x4E86;&#x4E00;&#x4E2A;&#x4E25;&#x5CFB;&#x7684;&#x95EE;&#x9898;&#xFF1A;&#x5982;&#x679C;&#x8F6F;&#x4EF6;&#x60F3;&#x8DE8;&#x5E73;&#x53F0;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x4FDD;&#x8BC1;&#x80FD;&#x591F;&#x5728;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x7F16;&#x8BD1;&#x3002;&#x800C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E0A;&#x9762;&#x7684; Make &#x5DE5;&#x5177;&#xFF0C;&#x5C31;&#x5F97;&#x4E3A;&#x6BCF;&#x4E00;&#x79CD;&#x6807;&#x51C6;&#x5199;&#x4E00;&#x6B21; Makefile &#xFF0C;&#x8FD9;&#x5C06;&#x662F;&#x4E00;&#x4EF6;&#x8BA9;&#x4EBA;&#x6293;&#x72C2;&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x5C31;&#x662F;&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x5B83;&#x9996;&#x5148;&#x5141;&#x8BB8;&#x5F00;&#x53D1;&#x8005;&#x7F16;&#x5199;&#x4E00;&#x79CD;&#x5E73;&#x53F0;&#x65E0;&#x5173;&#x7684; CMakeList.txt &#x6587;&#x4EF6;&#x6765;&#x5B9A;&#x5236;&#x6574;&#x4E2A;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x6839;&#x636E;&#x76EE;&#x6807;&#x7528;&#x6237;&#x7684;&#x5E73;&#x53F0;&#x8FDB;&#x4E00;&#x6B65;&#x751F;&#x6210;&#x6240;&#x9700;&#x7684;&#x672C;&#x5730;&#x5316; Makefile &#x548C;&#x5DE5;&#x7A0B;&#x6587;&#x4EF6;&#xFF0C;&#x5982; Unix &#x7684; Makefile &#x6216; Windows &#x7684; Visual Studio &#x5DE5;&#x7A0B;&#x3002;&#x4ECE;&#x800C;&#x505A;&#x5230;&#x201C;Write once, run everywhere&#x201D;&#x3002; &#x5728; linux &#x5E73;&#x53F0;&#x4E0B;&#x4F7F;&#x7528; CMake &#x751F;&#x6210; Makefile &#x5E76;&#x7F16;&#x8BD1;&#x7684;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;&#x7F16;&#x5199; CMake &#x914D;&#x7F6E;&#x6587;&#x4EF6; CMakeLists.txt &#x3002;&#x6267;&#x884C;&#x547D;&#x4EE4;cmake -G &quot;Unix Makefiles&quot; &lt;PATH&gt;&#x751F;&#x6210;Unix&#x8BC6;&#x522B;&#x7684;Makefile[^support]&#xFF0C;&lt;PATH&gt;&#x662F; CMakeLists.txt &#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;ccmake&#xFF0C;ccmake &#x548C; cmake &#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x524D;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;&#x754C;&#x9762;&#x3002;&#x4F7F;&#x7528; make &#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x3002; &#x4EE5;UnitTest++&#x81EA;&#x5E26;&#x7684;CMakeLists.txt&#x4E3A;&#x4F8B;&#xFF1A;cmake_minimum_required(VERSION 2.8.1)project(UnitTest++)# get the main sourcesfile(GLOB headers_ RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} UnitTest++/*.h)file(GLOB sources_ RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} UnitTest++/*.cpp)source_group(&quot;&quot; FILES ${headers_} ${sources_})# get platform specific sourcesif (WIN32) add_definitions(-D_CRT_SECURE_NO_DEPRECATE) set(platformDir_ Win32)else() set(platformDir_ Posix)endif(WIN32)file(GLOB platformHeaders_ RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} UnitTest++/${platformDir_}/*.h)file(GLOB platformSources_ RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} UnitTest++/${platformDir_}/*.cpp)source_group(${platformDir_} FILES ${platformHeaders_} ${platformSources_})# create the libadd_library(UnitTest++ STATIC ${headers_} ${sources_} ${platformHeaders_} ${platformSources_})# build the test runnerfile(GLOB TEST_SRCS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} tests/*.cpp tests/*.h)source_group( &quot;&quot; FILES ${TEST_SRCS})add_executable(TestUnitTest++ ${TEST_SRCS})include_directories(.)if(${UTPP_USE_PLUS_SIGN}) set_target_properties(TestUnitTest++ PROPERTIES OUTPUT_NAME TestUnitTest++)endif()target_link_libraries(TestUnitTest++ UnitTest++)# run unit tests as post build stepadd_custom_command(TARGET TestUnitTest++ POST_BUILD COMMAND TestUnitTest++ COMMENT &quot;Running unit tests&quot;)set, file, add_library&#x7B49;&#x7B49;&#x90FD;&#x662F;&#x547D;&#x4EE4;&#xFF0C;&#x5177;&#x4F53;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x7B14;&#x8BB0;CMake&#x4F7F;&#x7528;&#x603B;&#x7ED3;&#x3002;add_library(UnitTest++&#x2026;)&#x5C06;UnitTest++&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x6210;&#x9759;&#x6001;&#x5E93;add_executable(TestUnitTest++ &#x2026;)&#x751F;&#x6210;UnitTest++&#x5E94;&#x7528;&#x6587;&#x4EF6;target_link_libraries(TestUnitTest++ UnitTest++)&#x5C06;&#x524D;&#x9762;&#x751F;&#x6210;&#x7684;libUnitTest++.a&#x94FE;&#x5165;TestUnitTest++&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x3002;add_custom_command(TARGET TestUnitTest++&#x2026;)&#x8FD9;&#x4E00;&#x884C;&#x51B3;&#x5B9A;&#x4E86;&#x8FD0;&#x884C;make&#x65F6;&#xFF0C;&#x989D;&#x5916;&#x8C03;&#x7528;&#x7684;&#x547D;&#x4EE4;&#x3002;CMake&#x4F7F;&#x7528;&#x603B;&#x7ED3;&#x8FD9;&#x7BC7;&#x7B14;&#x8BB0;&#x91CC;&#x63D0;&#x5230;&#xFF1A;&#x6309;&#x7167;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;file&#x7684;GLOB&#x6307;&#x4EE4;&#x6765;&#x6536;&#x96C6;&#x5DE5;&#x7A0B;&#x7684;&#x6E90;&#x6587;&#x4EF6;&#xFF0C;&#x539F;&#x6587;&#x89E3;&#x91CA;&#x5982;&#x4E0B; We do not recommend using GLOB to collect a list of source files from your source tree. If no CMakeLists.txt file changes when a source is added or removed then the generated build system cannot know when to ask CMake to regenerate. &#x5927;&#x610F;&#x5C31;&#x662F;&#xFF0C;GLOB&#x6536;&#x96C6;&#x7684;&#x6E90;&#x6587;&#x4EF6;&#x589E;&#x52A0;&#x6216;&#x5220;&#x9664;&#xFF0C;&#x800C;CMakeLists.txt&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;CMake&#x4E0D;&#x80FD;&#x8BC6;&#x522B;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x3002;&#x5176;&#x5B9E;&#xFF0C;&#x5F53;CMakeLists.txt&#x4F7F;&#x7528;aux_source_directory&#x548C;file glob&#x67E5;&#x627E;&#x5DE5;&#x7A0B;&#x6E90;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6DFB;&#x52A0;&#x6216;&#x5220;&#x9664;&#x6E90;&#x6587;&#x4EF6;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8FD0;&#x884C;CMake&#x3002;cmake &#x5982;&#x4F55;&#x7F16;&#x51FA;&#x53EF;&#x4EE5;GDB&#x7684;&#x7A0B;&#x5E8F;&#xFF1F;cmake -DCMAKE_BUILD_TYPE=Debug CMakeList.txtImplement Test CasesTest Case&#x7684;&#x7F16;&#x5199;&#x901A;&#x8FC7;UnixTest++&#x672C;&#x8EAB;&#x7684;&#x5B8F;&#x5F15;&#x5165;&#xFF1A; SUITE(MyUnitTests) { TEST(StarterTest) { MonoGraphCpInit(false); CHECK(true); } }&#x8FD0;&#x884C;make&#x4E4B;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x4E3A;&#xFF1A;Running unit tests Success: 2 tests passed. Test time: 7.54 seconds. [100%] Built target MyTestTEST&#x5B8F;&#x5F15;&#x5165;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x4E2A;test case&#xFF0C;SUITE&#x5B8F;&#x5F15;&#x5165;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x5957;&#x4EF6;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x7528;SUITE&#x6216;&#x8005;TEST&#x5B9A;&#x4E49;&#x7684;case&#x90FD;&#x4F1A;&#x88AB;&#x8FD0;&#x884C;&#xFF0C;&#x770B;main code&#x3002;int main(int, const char *[]){ return UnitTest::RunAllTests();}&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6709;UnitTest++&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5176;&#x5B9E;&#x60F3;&#x600E;&#x4E48;&#x6D4B;&#x90FD;&#x53EF;&#x4EE5;&#x3002;&#x7ECF;&#x8FC7;&#x5B66;&#x4E60;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8C03;&#x7528;&#x6307;&#x5B9A;case&#x7684;main code&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x7F16;&#x5199;&#xFF1A; UnitTest::TestReporterStdout reporter; UnitTest::TestRunner runner(reporter); return runner.RunTestsIf(UnitTest::Test::GetTestList(), &quot;MyUnitTests&quot;, UnitTest::True(), 0);&#x8FD9;&#x6BB5;code&#x8C03;&#x7528;&#x4E86;&#x540D;&#x5B57;&#x53EB;MyUnitTests&#x7684;SUITE&#x4E2D;&#x6240;&#x6709;case&#x3002;Linux Test HarnessPhoenix FW&#x91CC;&#x9762;&#x7684;Linux Test Harness&#x662F;&#x57FA;&#x4E8E;UnixTest++&#x7684;&#x3002;&#x53EF;&#x4EE5;&#x53C2;&#x8003;components/GCP/JsonDataModel/linux_test_harness/Makefile&#x3002;&#x5176;&#x4E2D;&#x7528;&#x5230;&#x7684;UnixTest++&#x662F;v1.4&#x7684;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x7528;&#x5230;cmake&#x6765;&#x6784;&#x5EFA;&#x3002;&#x800C;&#x662F;&#x81EA;&#x5DF1;&#x6784;&#x5EFA;&#x7684;Makefile&#x6765;&#x7F16;&#x8BD1;&#x3002;&#x8FD0;&#x7528;&#x6700;&#x65B0;&#x7684;cmake&#x6765;&#x642D;&#x5EFA;Unit Test&#x73AF;&#x5883;&#x611F;&#x89C9;&#x66F4;&#x7B80;&#x5355;&#xFF0C;&#x800C;&#x4E14;&#x7ADF;&#x7136;&#x8FD8;&#x80FD;&#x6709;&#x5E73;&#x53F0;&#x79FB;&#x690D;&#x6027;&#xFF0C;&#x867D;&#x7136;&#x76EE;&#x524D;&#x5BF9;&#x6211;&#x4EEC;&#x6CA1;&#x7528;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD8;&#x662F;&#x5F88;&#x8D5E;&#x7684;&#x3002;&#x5C06;UnixTest++&#x7F16;&#x8BD1;&#x5230;&#x53EF;&#x7528;&#x8FD8;&#x662F;&#x633A;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x6574;&#x5408;Phoenix code&#x6709;&#x90A3;&#x4E48;&#x4E00;&#x70B9;&#x9EBB;&#x70E6;&#x3002;&#x5148;&#x8BB2;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x6D4B;&#x8BD5;Mono Graphic Panel Driver&#x3002;&#x518D;&#x5C06;&#x5177;&#x4F53;&#x642D;&#x5EFA;&#x7684;&#x601D;&#x8DEF;&#x548C;&#x4E00;&#x4E9B;&#x5C0F;tips&#x3002;Mono Graphic Panel Driver&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x7BC7;&#x76F8;&#x5173;&#x7B14;&#x8BB0;Pheonix_Display&#x3002;&#x6211;&#x5176;&#x5B9E;&#x60F3;&#x505A;&#x7684;&#x662F;&#x5728;Mono Graphic Panel Driver&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;Recovery Thread&#x3002;&#x5148;&#x770B;&#x4E0B;&#x6E90;&#x7801;&#x67B6;&#x6784;&#xFF1A;[benzhou@plslx111 phx]$ ls components/bsp/control_panel/ abc buttonLed ccpi clcd inc monoGraph obj pub srcmonoGraph&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x4F1A;&#x8C03;&#x7528;&#x5230;abc&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x6240;&#x4EE5;linux_test_harness&#x5C31;&#x653E;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x3002;&#x5E76;&#x4E14;abc&#x548C;monoGraph&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x88AB;&#x94FE;&#x63A5;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002;&#x6D4B;&#x8BD5;&#x67B6;&#x6784;&#x6700;&#x540E;&#x6211;&#x4EEC;&#x7684;CMakeLists.txt&#x5982;&#x4E0B;&#xFF1A;cmake_minimum_required(VERSION 2.8.1)project(MyTest)set(CMAKE_C_COMPILER &quot;g++&quot;)# enable gdbset(CMAKE_BUILD_TYPE &quot;Debug&quot;)set(CMAKE_CXX_FLAGS_DEBUG &quot;$ENV{CXXFLAGS} -O0 -Wall -g -ggdb&quot;)set(CMAKE_CXX_FLAGS_RELEASE &quot;$ENV{CXXFLAGS} -O3 -Wall&quot;)set(PHX_DIR &quot;${CMAKE_CURRENT_SOURCE_DIR}/../../../../../&quot;)include_directories(..)include_directories(stubs)include_directories(${PHX_DIR}components/bsp/control_panel/monoGraph/pub/)include_directories(${PHX_DIR}components/bsp/control_panel/monoGraph/inc/)include_directories(${PHX_DIR}components/bsp/control_panel/abc/pub/)include_directories(${PHX_DIR}components/bsp/control_panel/abc/inc/)include_directories(${PHX_DIR}components/bsp/control_panel/pub/)include_directories(${PHX_DIR}components/bsp/control_panel/inc/)include_directories(${PHX_DIR}components/primboot/pub/)# get Phoenix code#file(GLOB PHX_SRCS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} ../../../src/*.cpp ../../../src/*.c)aux_source_directory(${PHX_DIR}/components/bsp/control_panel/abc/src PHX_ABC)aux_source_directory(${PHX_DIR}/components/bsp/control_panel/monoGraph/src PHX_MONO)list(APPEND PHX_SRCS ${PHX_ABC} ${PHX_MONO})add_library (PhxFunctions STATIC ${PHX_SRCS})# get the Phoenix stub sourcesaux_source_directory(${PHX_DIR}/components/bsp/control_panel/linux_test_harness/mytests/stubs PHX_STUBS)add_library (StubFunctions STATIC ${PHX_STUBS})# get the main sourcesaux_source_directory(${PHX_DIR}/components/bsp/control_panel/linux_test_harness/mytests TEST_SRCS)add_executable(MyTest ${TEST_SRCS})target_link_libraries(MyTest pthread UnitTest++ PhxFunctions StubFunctions)# run unit tests as post build stepadd_custom_command(TARGET MyTest POST_BUILD COMMAND MyTest COMMENT &quot;Running unit tests&quot;)&#x9664;&#x4E86;UnitTest++&#x6846;&#x67B6;&#x672C;&#x8EAB;&#x7684;&#x5E93;libUnitTest++.a&#x548C;&#x94FE;&#x5165;&#x4E86;&#x4E00;&#x4E2A;pthread&#x5E93;&#x4EE5;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x5B9A;&#x4E49;&#x4E86;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x5E93;PhxFunctions&#x548C;StubFunctions&#x3002;PhxFunctions&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x6D4B;&#x8BD5;&#x7684;code&#xFF0C;&#x5373;abc&#x548C;monoGraph&#x6587;&#x4EF6;&#x5939;StubFunctions&#x662F;&#x4E3A;&#x4E86;&#x7F16;&#x8BD1;&#x901A;&#x8FC7;&#xFF0C;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x4E9B;&#x5B58;&#x6839;&#x51FD;&#x6570;&#x4E3B;&#x8981;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x600E;&#x4E48;&#x5B9A;&#x4E49;&#x8FD9;&#x4E9B;&#x5B58;&#x6839;&#x6587;&#x4EF6;&#x548C;&#x51FD;&#x6570;&#x3002;&#x6839;&#x636E;&#x6211;&#x7684;&#x7ECF;&#x9A8C;&#x548C;TDD&#x601D;&#x60F3;(&#x4E0D;&#x8981;&#x4E3A;&#x4E86;&#x660E;&#x5929;&#x8BBE;&#x8BA1;)&#xFF0C;&#x5E94;&#x8BE5;&#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x6709;&#x627E;&#x4E0D;&#x5230;&#x7684;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x5728;stubs&#x6587;&#x4EF6;&#x5939;&#x91CC;&#x52A0;&#x4E00;&#x4E2A;&#x7A7A;&#x6587;&#x4EF6;&#x5982;&#x679C;&#x6709;&#x627E;&#x4E0D;&#x5230;&#x7684;&#x7C7B;&#x58F0;&#x660E;&#xFF0C;&#x4ECE;FW&#x627E;&#x5230;&#x7C7B;&#x5B9A;&#x4E49;&#x62F7;&#x8D1D;&#x8FC7;&#x6765;&#x5982;&#x679C;&#x6709;&#x627E;&#x4E0D;&#x5230;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x7684;&#x94FE;&#x63A5;&#x9519;&#x8BEF;&#xFF0C;&#x5C31;&#x5728;stub.cpp&#x4E2D;&#x5B9A;&#x4E49;&#x7A7A;&#x51FD;&#x6570;&#x3002;&#x5982;&#x679C;&#x5C06;&#x6765;&#x53D1;&#x73B0;&#x9700;&#x8981;&#x8C03;&#x7528;&#x771F;&#x5B9E;&#x7684;FW&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5C06;&#x90A3;&#x4E2A;&#x51FD;&#x6570;&#x6240;&#x5728;&#x7684;&#x6E90;&#x7801;&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x6210;&#x5E93;&#x94FE;&#x63A5;&#x8FDB;&#x6765;&#x3002;%23UnitTest++%u7B80%u4ECB%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5BTDD%2C%20Programming%2C%20unittest%5D%0A%0A%5BTOC%5D%0A%0A%u6700%u8FD1%u62DC%u8BFB%u4E86Kent%20Beck%u5927%u795E%u7684%u300ATest-Driven%20Development%20By%20Example%u300B%uFF0C%u6709%u4E86%u8FD9%u7BC7%5B%u8BFB%u4E66%u7B14%u8BB0%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/209575d9-d1bc-4aa6-8a79-3d50bfe3d377/%29%u3002%u8FD9%u672C%u4E66%u89E3%u7B54%u4E86%u6211%u7684%u5F88%u591A%u5F00%u53D1%u4E2D%u9047%u5230%u7684%u56F0%u60D1%uFF0C%u6240%u4EE5%u51B3%u5B9A%u4EE5%u540E%u8D70%u4E0ATDD%u7684%u9053%u8DEF%u3002%u90A3%u4E3A%u4EC0%u4E48%u4F1A%u5B66%u4E60UnixTest++%uFF0C%u5176%u5B9E%u662F%u56E0%u4E3A%u60E0%u666E%u6253%u5370%u673A%u7684Phoenix%20FW%u91CC%u9762%u66FE%u7ECF%u6709%u5148%u8F88%u505A%u8FC7%u7C7B%u4F3Cunit%20test%u7684%u4E8B%u60C5%uFF0C%u79F0%u4E4B%u4E3ALinux%20Test%20Harness%u3002Harnes%u662F%u9A6C%u978D%u7684%u610F%u601D%uFF0C%u8FD9%u4E2A%u540D%u5B57%u5E94%u8BE5%u662F%u60E0%u666E%u4EBA%u81EA%u5DF1%u53D6%u7684%u3002%u8FD9%u4E2ALinux%20Test%20Harness%u5C31%u662F%u57FA%u4E8E%5BUnixTest++%5D%28https%3A//github.com/unittest-cpp/unittest-cpp%29%u7684%u3002%u76EE%u524D%u6211%u7528%u7684%u662F%u6700%u65B0%u7248%uFF0Cv1.5.1%u3002%u76EE%u5F55%u6811%u7ED3%u6784%u5982%u4E0B%uFF1A%0A%u251C%u2500%u2500%20AUTHORS%0A%u251C%u2500%u2500%20%3Cfont%20color%3D%22IndianRed%22%3ECMakeLists.txt%3C/font%3E%0A%u251C%u2500%u2500%20ChangeLog%0A%u251C%u2500%u2500%20INSTALL%0A%u251C%u2500%u2500%20LICENSE%0A%u251C%u2500%u2500%20Makefile.am%0A%u251C%u2500%u2500%20README.md%0A%u251C%u2500%u2500%20%3Cfont%20color%3D%22IndianRed%22%3EUnitTest++%3C/font%3E%0A%u251C%u2500%u2500%20UnitTest++.pc.in%0A%u251C%u2500%u2500%20appveyor.yml%0A%u251C%u2500%u2500%20builds%0A%u251C%u2500%u2500%20configure.ac%0A%u251C%u2500%u2500%20docs%0A%u251C%u2500%u2500%20m4%0A%u2502%20%20%20%u251C%u2500%u2500%20ax_cxx_compile_stdcxx.m4%0A%u2502%20%20%20%u2514%u2500%u2500%20ax_cxx_compile_stdcxx_11.m4%0A%u2514%u2500%u2500%20%3Cfont%20color%3D%22IndianRed%22%3Etests%3C/font%3E%0A%0A7%20directories%2C%2095%20files%0A%u91CD%u8981%u7684%u6587%u4EF6%u6216%u6587%u4EF6%u5939%u6211%u6807%u6210%u4E86%u7EA2%u8272%u3002%0A-%20CMakeLists.txt%0A%09-%20UnitTest++%u662F%u57FA%u4E8ECMake%u7684%uFF0C%u540E%u9762%u4F1A%u5177%u4F53%u8BB2CMake%uFF0C%u8FD9%u4E2A%u6587%u4EF6%u5C31%u7C7B%u4F3C%u4E8ECMake%u7684%u5DE5%u7A0B%u6587%u4EF6%u3002CMake%u57FA%u4E8E%u5B83%u751F%u6210Makefile%u6216%u8005%u5176%u4ED6%u5F00%u53D1%u5E73%u53F0%u7684%u5DE5%u7A0B%u6587%u4EF6%u3002%0A-%20UnitTest++%0A%09-%20UnitTest++%u662F%u5F00%u6E90%u9879%u76EE%uFF0C%u8FD9%u4E2A%u6587%u4EF6%u5939%u5C31%u662FUnitTest++%u6240%u6709%u7684%u6E90%u7801%0A-%20tests%0A%09-%20%u8FD9%u4E2A%u662FUnitTest++%u672C%u8EAB%u7684test%20case%u3002%u6211%u4EEC%u5728%u5199%u81EA%u5DF1%u7684test%20case%u7684%u65F6%u5019%u5B8C%u5168%u53EF%u4EE5%u53C2%u8003%u522B%u4EBA%u662F%u600E%u4E48%u5199%u7684%u3002%0A%0A%23%23CMake%0A%u8FD9%u91CC%u6536%u96C6%u4E86%u4E24%u7BC7CMake%u7684%u6587%u7AE0%uFF0C%5BCMake%u4F7F%u7528%u603B%u7ED3%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/d90d734c-12e4-4664-a0d5-af887f4b8b10/%29%u548C%5BCMake%20%u5165%u95E8%u5B9E%u6218%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/50e6782c-3acc-42a7-b582-43fe4a381fc8/%29%0ACMake%u610F%u4E3ACross-platform%20Make%uFF0C%u53EF%u7528%u4E8E%u7BA1%u7406C/C++%u5DE5%u7A0B%u3002%u4F60%u6216%u8BB8%u542C%u8FC7%u597D%u51E0%u79CD%20Make%20%u5DE5%u5177%uFF0C%u4F8B%u5982%20GNU%20Make%20%uFF0CQT%20%u7684%20qmake%20%uFF0C%u5FAE%u8F6F%u7684%20MS%20nmake%uFF0CBSD%20Make%uFF08pmake%uFF09%uFF0CMakepp%uFF0C%u7B49%u7B49%u3002%u8FD9%u4E9B%20Make%20%u5DE5%u5177%u9075%u5FAA%u7740%u4E0D%u540C%u7684%u89C4%u8303%u548C%u6807%u51C6%uFF0C%u6240%u6267%u884C%u7684%20Makefile%20%u683C%u5F0F%u4E5F%u5343%u5DEE%u4E07%u522B%u3002%u8FD9%u6837%u5C31%u5E26%u6765%u4E86%u4E00%u4E2A%u4E25%u5CFB%u7684%u95EE%u9898%uFF1A%u5982%u679C%u8F6F%u4EF6%u60F3%u8DE8%u5E73%u53F0%uFF0C%u5FC5%u987B%u8981%u4FDD%u8BC1%u80FD%u591F%u5728%u4E0D%u540C%u5E73%u53F0%u7F16%u8BD1%u3002%u800C%u5982%u679C%u4F7F%u7528%u4E0A%u9762%u7684%20Make%20%u5DE5%u5177%uFF0C%u5C31%u5F97%u4E3A%u6BCF%u4E00%u79CD%u6807%u51C6%u5199%u4E00%u6B21%20Makefile%20%uFF0C%u8FD9%u5C06%u662F%u4E00%u4EF6%u8BA9%u4EBA%u6293%u72C2%u7684%u5DE5%u4F5C%u3002%u5C31%u662F%u9488%u5BF9%u8FD9%u4E2A%u95EE%u9898%u6240%u8BBE%u8BA1%u7684%u5DE5%u5177%u3002%u5B83%u9996%u5148%u5141%u8BB8%u5F00%u53D1%u8005%u7F16%u5199%u4E00%u79CD%u5E73%u53F0%u65E0%u5173%u7684%20CMakeList.txt%20%u6587%u4EF6%u6765%u5B9A%u5236%u6574%u4E2A%u7F16%u8BD1%u6D41%u7A0B%uFF0C%u7136%u540E%u518D%u6839%u636E%u76EE%u6807%u7528%u6237%u7684%u5E73%u53F0%u8FDB%u4E00%u6B65%u751F%u6210%u6240%u9700%u7684%u672C%u5730%u5316%20Makefile%20%u548C%u5DE5%u7A0B%u6587%u4EF6%uFF0C%u5982%20Unix%20%u7684%20Makefile%20%u6216%20Windows%20%u7684%20Visual%20Studio%20%u5DE5%u7A0B%u3002%u4ECE%u800C%u505A%u5230%u201CWrite%20once%2C%20run%20everywhere%u201D%u3002%0A%09%u5728%20linux%20%u5E73%u53F0%u4E0B%u4F7F%u7528%20CMake%20%u751F%u6210%20Makefile%20%u5E76%u7F16%u8BD1%u7684%u6D41%u7A0B%u5982%u4E0B%uFF1A%0A1.%20%u7F16%u5199%20CMake%20%u914D%u7F6E%u6587%u4EF6%20%60CMakeLists.txt%60%20%u3002%0A2.%20%u6267%u884C%u547D%u4EE4%60cmake%20-G%20%22Unix%20Makefiles%22%20%3CPATH%3E%60%u751F%u6210Unix%u8BC6%u522B%u7684Makefile%5B%5Esupport%5D%uFF0C%26lt%3BPATH%26gt%3B%u662F%20CMakeLists.txt%20%u6240%u5728%u7684%u76EE%u5F55%u3002%u4E5F%u53EF%u4EE5%u7528ccmake%uFF0Cccmake%20%u548C%20cmake%20%u7684%u533A%u522B%u5728%u4E8E%u524D%u8005%u63D0%u4F9B%u4E86%u4E00%u4E2A%u4EA4%u4E92%u5F0F%u7684%u754C%u9762%u3002%0A3.%20%u4F7F%u7528%20make%20%u547D%u4EE4%u8FDB%u884C%u7F16%u8BD1%u3002%0A%u4EE5UnitTest++%u81EA%u5E26%u7684CMakeLists.txt%u4E3A%u4F8B%uFF1A%0A%60%60%60cmake%0Acmake_minimum_required%28VERSION%202.8.1%29%0Aproject%28UnitTest++%29%0A%0A%23%20get%20the%20main%20sources%0Afile%28GLOB%20headers_%20RELATIVE%20%24%7BCMAKE_CURRENT_SOURCE_DIR%7D%20UnitTest++/*.h%29%0Afile%28GLOB%20sources_%20RELATIVE%20%24%7BCMAKE_CURRENT_SOURCE_DIR%7D%20UnitTest++/*.cpp%29%0Asource_group%28%22%22%20FILES%20%24%7Bheaders_%7D%20%24%7Bsources_%7D%29%0A%0A%23%20get%20platform%20specific%20sources%0Aif%20%28WIN32%29%0A%20%20%20%20add_definitions%28-D_CRT_SECURE_NO_DEPRECATE%29%0A%20%20%20%20set%28platformDir_%20Win32%29%0Aelse%28%29%0A%20%20%20%20set%28platformDir_%20Posix%29%0Aendif%28WIN32%29%0A%0Afile%28GLOB%20platformHeaders_%20RELATIVE%20%24%7BCMAKE_CURRENT_SOURCE_DIR%7D%20UnitTest++/%24%7BplatformDir_%7D/*.h%29%0Afile%28GLOB%20platformSources_%20RELATIVE%20%24%7BCMAKE_CURRENT_SOURCE_DIR%7D%20UnitTest++/%24%7BplatformDir_%7D/*.cpp%29%0Asource_group%28%24%7BplatformDir_%7D%20FILES%20%24%7BplatformHeaders_%7D%20%24%7BplatformSources_%7D%29%0A%0A%23%20create%20the%20lib%0Aadd_library%28UnitTest++%20STATIC%20%24%7Bheaders_%7D%20%24%7Bsources_%7D%20%24%7BplatformHeaders_%7D%20%24%7BplatformSources_%7D%29%0A%0A%23%20build%20the%20test%20runner%0Afile%28GLOB%20TEST_SRCS%20RELATIVE%20%24%7BCMAKE_CURRENT_SOURCE_DIR%7D%20tests/*.cpp%20tests/*.h%29%0Asource_group%28%20%22%22%20FILES%20%24%7BTEST_SRCS%7D%29%0Aadd_executable%28TestUnitTest++%20%24%7BTEST_SRCS%7D%29%0Ainclude_directories%28.%29%0A%0Aif%28%24%7BUTPP_USE_PLUS_SIGN%7D%29%0A%20%20%20%20set_target_properties%28TestUnitTest++%20PROPERTIES%20OUTPUT_NAME%20TestUnitTest++%29%0Aendif%28%29%0A%0Atarget_link_libraries%28TestUnitTest++%20UnitTest++%29%0A%0A%23%20run%20unit%20tests%20as%20post%20build%20step%0Aadd_custom_command%28TARGET%20TestUnitTest++%0A%20%20%20%20POST_BUILD%20COMMAND%20TestUnitTest++%0A%20%20%20%20COMMENT%20%22Running%20unit%20tests%22%29%0A%60%60%60%0Aset%2C%20file%2C%20add_library%u7B49%u7B49%u90FD%u662F%u547D%u4EE4%uFF0C%u5177%u4F53%u547D%u4EE4%u53EF%u4EE5%u53C2%u8003%u8FD9%u4E2A%u7B14%u8BB0%5BCMake%u4F7F%u7528%u603B%u7ED3%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/d90d734c-12e4-4664-a0d5-af887f4b8b10/%29%u3002%0A-%20add_library%28UnitTest++...%29%u5C06UnitTest++%u4EE3%u7801%u7F16%u8BD1%u6210%u9759%u6001%u5E93%0A-%20add_executable%28TestUnitTest++%20...%29%u751F%u6210UnitTest++%u5E94%u7528%u6587%u4EF6%0A-%20target_link_libraries%28TestUnitTest++%20UnitTest++%29%u5C06%u524D%u9762%u751F%u6210%u7684libUnitTest++.a%u94FE%u5165TestUnitTest++%u53EF%u6267%u884C%u6587%u4EF6%u3002%0A-%20add_custom_command%28TARGET%20TestUnitTest++...%29%u8FD9%u4E00%u884C%u51B3%u5B9A%u4E86%u8FD0%u884Cmake%u65F6%uFF0C%u989D%u5916%u8C03%u7528%u7684%u547D%u4EE4%u3002%0A%0A%5BCMake%u4F7F%u7528%u603B%u7ED3%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/d90d734c-12e4-4664-a0d5-af887f4b8b10/%29%u8FD9%u7BC7%u7B14%u8BB0%u91CC%u63D0%u5230%uFF1A%0A%3E%u6309%u7167%u5B98%u65B9%u6587%u6863%u7684%u8BF4%u6CD5%uFF0C%u4E0D%u5EFA%u8BAE%u4F7F%u7528file%u7684GLOB%u6307%u4EE4%u6765%u6536%u96C6%u5DE5%u7A0B%u7684%u6E90%u6587%u4EF6%uFF0C%u539F%u6587%u89E3%u91CA%u5982%u4E0B%0A%3Cfont%20color%3D%22Blue%22%3EWe%20do%20not%20recommend%20using%20GLOB%20to%20collect%20a%20list%20of%20source%20files%20from%20your%20source%20tree.%20If%20no%20CMakeLists.txt%20file%20changes%20when%20a%20source%20is%20added%20or%20removed%20then%20the%20generated%20build%20system%20cannot%20know%20when%20to%20ask%20CMake%20to%20regenerate.%3C/font%3E%0A%u5927%u610F%u5C31%u662F%uFF0CGLOB%u6536%u96C6%u7684%u6E90%u6587%u4EF6%u589E%u52A0%u6216%u5220%u9664%uFF0C%u800CCMakeLists.txt%u6CA1%u6709%u53D1%u751F%u4FEE%u6539%u65F6%uFF0CCMake%u4E0D%u80FD%u8BC6%u522B%u8FD9%u4E9B%u6587%u4EF6%u3002%u5176%u5B9E%uFF0C%u5F53CMakeLists.txt%u4F7F%u7528aux_source_directory%u548Cfile%20glob%u67E5%u627E%u5DE5%u7A0B%u6E90%u6587%u4EF6%u65F6%uFF0C%3Cb%3E%3Cfont%20color%3D%22IndianRed%22%3E%u5982%u679C%u6DFB%u52A0%u6216%u5220%u9664%u6E90%u6587%u4EF6%uFF0C%u90FD%u9700%u8981%u91CD%u65B0%u8FD0%u884CCMake%3C/font%3E%3C/b%3E%u3002%0A%0Acmake%20%u5982%u4F55%u7F16%u51FA%u53EF%u4EE5GDB%u7684%u7A0B%u5E8F%uFF1F%0A%3E%60cmake%20-DCMAKE_BUILD_TYPE%3DDebug%20CMakeList.txt%60%0A%23%23Implement%20Test%20Cases%0ATest%20Case%u7684%u7F16%u5199%u901A%u8FC7UnixTest++%u672C%u8EAB%u7684%u5B8F%u5F15%u5165%uFF1A%0A%60%60%60cpp%0A%20%20%20%20SUITE%28MyUnitTests%29%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20TEST%28StarterTest%29%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20MonoGraphCpInit%28false%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20CHECK%28true%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%60%60%60%0A%u8FD0%u884Cmake%u4E4B%u540E%u7684%u8F93%u51FA%u4E3A%uFF1A%0A%3ERunning%20unit%20tests%0ASuccess%3A%202%20tests%20passed.%0ATest%20time%3A%207.54%20seconds.%0A%5B100%25%5D%20Built%20target%20MyTest%0A%0ATEST%u5B8F%u5F15%u5165%u7684%u5C31%u662F%u4E00%u4E2Atest%20case%uFF0CSUITE%u5B8F%u5F15%u5165%u7684%u662F%u4E00%u4E2A%u6D4B%u8BD5%u5957%u4EF6%u3002%u9ED8%u8BA4%u60C5%u51B5%u4E0B%uFF0C%u6240%u6709%u7528SUITE%u6216%u8005TEST%u5B9A%u4E49%u7684case%u90FD%u4F1A%u88AB%u8FD0%u884C%uFF0C%u770Bmain%20code%u3002%0A%60%60%60cpp%0Aint%20main%28int%2C%20const%20char%20*%5B%5D%29%0A%7B%0A%20%20%20return%20UnitTest%3A%3ARunAllTests%28%29%3B%0A%7D%0A%60%60%60%0A%u56E0%u4E3A%u6211%u4EEC%u6709UnitTest++%u7684%u6E90%u7801%uFF0C%u5176%u5B9E%u60F3%u600E%u4E48%u6D4B%u90FD%u53EF%u4EE5%u3002%u7ECF%u8FC7%u5B66%u4E60%uFF0C%u5982%u679C%u60F3%u8C03%u7528%u6307%u5B9Acase%u7684main%20code%u53EF%u4EE5%u5982%u4E0B%u7F16%u5199%uFF1A%0A%60%60%60cpp%0A%20%20%20UnitTest%3A%3ATestReporterStdout%20reporter%3B%0A%20%20%20UnitTest%3A%3ATestRunner%20runner%28reporter%29%3B%0A%20%20%20return%20runner.RunTestsIf%28UnitTest%3A%3ATest%3A%3AGetTestList%28%29%2C%20%22MyUnitTests%22%2C%20UnitTest%3A%3ATrue%28%29%2C%200%29%3B%0A%60%60%60%0A%u8FD9%u6BB5code%u8C03%u7528%u4E86%u540D%u5B57%u53EBMyUnitTests%u7684SUITE%u4E2D%u6240%u6709case%u3002%0A%0A%23%23Linux%20Test%20Harness%0APhoenix%20FW%u91CC%u9762%u7684Linux%20Test%20Harness%u662F%u57FA%u4E8EUnixTest++%u7684%u3002%u53EF%u4EE5%u53C2%u8003%60components/GCP/JsonDataModel/linux_test_harness/Makefile%60%u3002%u5176%u4E2D%u7528%u5230%u7684UnixTest++%u662Fv1.4%u7684%uFF0C%u5E76%u6CA1%u6709%u7528%u5230cmake%u6765%u6784%u5EFA%u3002%u800C%u662F%u81EA%u5DF1%u6784%u5EFA%u7684Makefile%u6765%u7F16%u8BD1%u3002%u8FD0%u7528%u6700%u65B0%u7684cmake%u6765%u642D%u5EFAUnit%20Test%u73AF%u5883%u611F%u89C9%u66F4%u7B80%u5355%uFF0C%u800C%u4E14%u7ADF%u7136%u8FD8%u80FD%u6709%u5E73%u53F0%u79FB%u690D%u6027%uFF0C%u867D%u7136%u76EE%u524D%u5BF9%u6211%u4EEC%u6CA1%u7528%uFF0C%u4E0D%u8FC7%u8FD8%u662F%u5F88%u8D5E%u7684%u3002%u5C06UnixTest++%u7F16%u8BD1%u5230%u53EF%u7528%u8FD8%u662F%u633A%u7B80%u5355%u7684%uFF0C%u4F46%u662F%u8981%u6574%u5408Phoenix%20code%u6709%u90A3%u4E48%u4E00%u70B9%u9EBB%u70E6%u3002%u5148%u8BB2%u4E00%u4E0B%u6211%u4EEC%u7684%u4F7F%u7528%u573A%u666F%uFF0C%u6D4B%u8BD5Mono%20Graphic%20Panel%20Driver%u3002%u518D%u5C06%u5177%u4F53%u642D%u5EFA%u7684%u601D%u8DEF%u548C%u4E00%u4E9B%u5C0Ftips%u3002%0A%0A%23%23%23Mono%20Graphic%20Panel%20Driver%0A%u8FD9%u91CC%u6709%u4E00%u7BC7%u76F8%u5173%u7B14%u8BB0%5BPheonix_Display%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/9cf701b0-e736-43d5-9411-923afacf2344%29%u3002%u6211%u5176%u5B9E%u60F3%u505A%u7684%u662F%u5728Mono%20Graphic%20Panel%20Driver%u4E2D%u6DFB%u52A0%u4E00%u4E2ARecovery%20Thread%u3002%u5148%u770B%u4E0B%u6E90%u7801%u67B6%u6784%uFF1A%0A%3E%5Bbenzhou@plslx111%20phx%5D%24%20ls%20components/bsp/control_panel/%0Aabc%20%20buttonLed%20%20ccpi%20%20clcd%20%20inc%20%20%3Cfont%20color%3D%22IndianRed%22%3EmonoGraph%3C/font%3E%20%20obj%20%20pub%20%20src%0A%0A%60monoGraph%60%u4E2D%u7684%u4EE3%u7801%u4F1A%u8C03%u7528%u5230abc%u6587%u4EF6%u5939%u4E0B%u7684%u4EE3%u7801%u3002%u6240%u4EE5%60linux_test_harness%60%u5C31%u653E%u5728%u8FD9%u4E2A%u6587%u4EF6%u5939%u4E0B%u3002%u5E76%u4E14%60abc%60%u548C%60monoGraph%60%u4E2D%u7684%u4EE3%u7801%u9700%u8981%u88AB%u94FE%u63A5%u5230%u6211%u4EEC%u7684%u6D4B%u8BD5%u7A0B%u5E8F%u4E2D%u3002%0A%0A%23%23%23%u6D4B%u8BD5%u67B6%u6784%0A%u6700%u540E%u6211%u4EEC%u7684%60CMakeLists.txt%60%u5982%u4E0B%uFF1A%0A%60%60%60cmake%0Acmake_minimum_required%28VERSION%202.8.1%29%0Aproject%28MyTest%29%0A%0Aset%28CMAKE_C_COMPILER%20%22g++%22%29%0A%0A%23%20enable%20gdb%0Aset%28CMAKE_BUILD_TYPE%20%22Debug%22%29%0Aset%28CMAKE_CXX_FLAGS_DEBUG%20%22%24ENV%7BCXXFLAGS%7D%20-O0%20-Wall%20-g%20-ggdb%22%29%0Aset%28CMAKE_CXX_FLAGS_RELEASE%20%22%24ENV%7BCXXFLAGS%7D%20-O3%20-Wall%22%29%0A%0Aset%28PHX_DIR%20%22%24%7BCMAKE_CURRENT_SOURCE_DIR%7D/../../../../../%22%29%0A%0Ainclude_directories%28..%29%0Ainclude_directories%28stubs%29%0Ainclude_directories%28%24%7BPHX_DIR%7Dcomponents/bsp/control_panel/monoGraph/pub/%29%0Ainclude_directories%28%24%7BPHX_DIR%7Dcomponents/bsp/control_panel/monoGraph/inc/%29%0Ainclude_directories%28%24%7BPHX_DIR%7Dcomponents/bsp/control_panel/abc/pub/%29%0Ainclude_directories%28%24%7BPHX_DIR%7Dcomponents/bsp/control_panel/abc/inc/%29%0Ainclude_directories%28%24%7BPHX_DIR%7Dcomponents/bsp/control_panel/pub/%29%0Ainclude_directories%28%24%7BPHX_DIR%7Dcomponents/bsp/control_panel/inc/%29%0Ainclude_directories%28%24%7BPHX_DIR%7Dcomponents/primboot/pub/%29%0A%0A%23%20get%20Phoenix%20code%0A%23file%28GLOB%20PHX_SRCS%20RELATIVE%20%24%7BCMAKE_CURRENT_SOURCE_DIR%7D%20../../../src/*.cpp%20../../../src/*.c%29%0Aaux_source_directory%28%24%7BPHX_DIR%7D/components/bsp/control_panel/abc/src%20PHX_ABC%29%0Aaux_source_directory%28%24%7BPHX_DIR%7D/components/bsp/control_panel/monoGraph/src%20PHX_MONO%29%0Alist%28APPEND%20PHX_SRCS%0A%20%20%20%20%24%7BPHX_ABC%7D%0A%20%20%20%20%24%7BPHX_MONO%7D%0A%29%0Aadd_library%20%28PhxFunctions%20STATIC%20%24%7BPHX_SRCS%7D%29%0A%0A%23%20get%20the%20Phoenix%20stub%20sources%0Aaux_source_directory%28%24%7BPHX_DIR%7D/components/bsp/control_panel/linux_test_harness/mytests/stubs%20PHX_STUBS%29%0Aadd_library%20%28StubFunctions%20STATIC%20%24%7BPHX_STUBS%7D%29%0A%0A%23%20get%20the%20main%20sources%0Aaux_source_directory%28%24%7BPHX_DIR%7D/components/bsp/control_panel/linux_test_harness/mytests%20TEST_SRCS%29%0A%0Aadd_executable%28MyTest%20%24%7BTEST_SRCS%7D%29%0A%0Atarget_link_libraries%28MyTest%0A%20%20%20%20pthread%0A%20%20%20%20UnitTest++%0A%20%20%20%20PhxFunctions%0A%20%20%20%20StubFunctions%0A%29%0A%0A%23%20run%20unit%20tests%20as%20post%20build%20step%0Aadd_custom_command%28TARGET%20MyTest%0A%20%20%20%20POST_BUILD%20COMMAND%20MyTest%0A%20%20%20%20COMMENT%20%22Running%20unit%20tests%22%0A%29%0A%60%60%60%0A%u9664%u4E86UnitTest++%u6846%u67B6%u672C%u8EAB%u7684%u5E93libUnitTest++.a%u548C%u94FE%u5165%u4E86%u4E00%u4E2Apthread%u5E93%u4EE5%u5916%uFF0C%u6211%u4EEC%u8FD8%u5B9A%u4E49%u4E86%u53E6%u5916%u4E24%u4E2A%u5E93PhxFunctions%u548CStubFunctions%u3002%0A-%20PhxFunctions%u662F%u6211%u4EEC%u60F3%u6D4B%u8BD5%u7684code%uFF0C%u5373%60abc%60%u548C%60monoGraph%60%u6587%u4EF6%u5939%0A-%20StubFunctions%u662F%u4E3A%u4E86%u7F16%u8BD1%u901A%u8FC7%uFF0C%u5B9A%u4E49%u7684%u4E00%u4E9B%u5B58%u6839%u51FD%u6570%0A%0A%u4E3B%u8981%u9700%u8981%u6CE8%u610F%u7684%u662F%u600E%u4E48%u5B9A%u4E49%u8FD9%u4E9B%u5B58%u6839%u6587%u4EF6%u548C%u51FD%u6570%u3002%u6839%u636E%u6211%u7684%u7ECF%u9A8C%u548CTDD%u601D%u60F3%28%u4E0D%u8981%u4E3A%u4E86%u660E%u5929%u8BBE%u8BA1%29%uFF0C%u5E94%u8BE5%u6CE8%u610F%uFF1A%0A-%20%u5982%u679C%u6709%u627E%u4E0D%u5230%u7684%u5934%u6587%u4EF6%uFF0C%u5728stubs%u6587%u4EF6%u5939%u91CC%u52A0%u4E00%u4E2A%u7A7A%u6587%u4EF6%0A-%20%u5982%u679C%u6709%u627E%u4E0D%u5230%u7684%u7C7B%u58F0%u660E%uFF0C%u4ECEFW%u627E%u5230%u7C7B%u5B9A%u4E49%u62F7%u8D1D%u8FC7%u6765%0A-%20%u5982%u679C%u6709%u627E%u4E0D%u5230%u5B9A%u4E49%u7684%u51FD%u6570%u7684%u94FE%u63A5%u9519%u8BEF%uFF0C%u5C31%u5728stub.cpp%u4E2D%u5B9A%u4E49%u7A7A%u51FD%u6570%u3002%0A-%20%u5982%u679C%u5C06%u6765%u53D1%u73B0%u9700%u8981%u8C03%u7528%u771F%u5B9E%u7684FW%u51FD%u6570%uFF0C%u5C31%u9700%u8981%u5C06%u90A3%u4E2A%u51FD%u6570%u6240%u5728%u7684%u6E90%u7801%u6587%u4EF6%u7F16%u8BD1%u6210%u5E93%u94FE%u63A5%u8FDB%u6765%u3002]]></content>
      <tags>
        <tag>unittest</tag>
        <tag>Programming</tag>
        <tag>TDD</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Test-Driven Development]]></title>
    <url>%2F2016%2F02%2F16%2FTest-Driven_Development%2F</url>
    <content type="text"><![CDATA[Edit&#x5B66;&#x4E60;&#x7B14;&#x8BB0; Programming TDD Test-Driven DevelopmentChapter 25. Test-Driven Development PatternsIsolated TestTest ListTest FirstChapter 26. Red Bar PatternsOne Step TestStarter TestExplanation TestLearning TestRegression TestBreakDo OverChapter 27. Testing PatternsChild TestMock ObjectSelf ShuntLog StringCrash Test DummyBroken TestClean Check-inChapter 28. Green Bar PatternsFake It (&#x2018;Til You Make It)TriangulateOne to ManyChapter 29. xUnit PatternsAssertionFixtureExternal FixtureTest MethodException TestAll TestsChapter 30. Design PatternsCommandValue ObjectNull ObjectTemplate MethodPluggable ObjectPluggable SelectorFactory MethodImposterCompositeCollecting ParameterSingletonChapter 31. RefactoringReconcile DifferencesIsolate ChangeMigrate DataExtract MethodHowWhyInline MethodExtract InterfaceHowWhyMove MethodMethod ObjectHowWhyAdd ParameterMethod Parameter to Constructor ParameterChapter 32. Mastering TDDWhat don&#x2019;t you have to test?How do you know if you have good tests?How does TDD lead to frameworks?How much feedback do you need?When should you delete tests?Can you drive development with application-level tests?How do you switch to TDD midstream?How does TDD relate to the practices of Extreme Programming?&#x6700;&#x8FD1;&#x5728;&#x8BFB;Kent Beck&#x7684;&#x300A;Test-Driven Development By Example&#x300B;&#xFF0C;&#x8BA9;&#x6211;&#x5BF9;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x6709;&#x4E86;&#x65B0;&#x7684;&#x8BA4;&#x8BC6;&#x3002;&#x5199;test&#x5E76;&#x4E0D;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#x800C;&#x6D4B;&#x8BD5;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x589E;&#x5F3A;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x4FE1;&#x5FC3;&#xFF0C;&#x51CF;&#x5C11;&#x7126;&#x8651;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x51CF;&#x5C11;&#x7126;&#x8651;&#x5462;&#xFF0C;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x6B21;&#x53EA;&#x5173;&#x5FC3;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x3002;&#x5982;&#x4F55;&#x4E00;&#x6B21;&#x53EA;&#x5173;&#x5FC3;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;TDD&#x3002;&#x672C;&#x4E66;&#x5206;&#x4E09;&#x4E2A;&#x90E8;&#x5206;The Money ExampleThe xUnit ExamplePatterns for Test-Driven Development &#x524D;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#x8BB2;&#x4E86;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x6765;&#x9610;&#x8FF0;&#x5982;&#x4F55;&#x8FDB;&#x884C;TDD&#x5F00;&#x53D1;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x90E8;&#x5206;&#x7B97;&#x662F;&#x603B;&#x7ED3;&#xFF0C;&#x5168;&#x4E66;&#x7684;&#x7CBE;&#x534E;&#x6240;&#x5728;&#x3002;&#x672C;&#x6587;&#x4E0D;&#x6253;&#x7B97;&#x8BB2;&#x8FD9;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x4F8B;&#x5B50;&#x6700;&#x597D;&#x81EA;&#x5DF1;&#x624B;&#x5199;&#x4E00;&#x904D;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x52A0;&#x6DF1;&#x4E86;&#x89E3;&#x3002;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x6458;&#x5F55;&#x4E00;&#x4E9B;TDD&#x7684;&#x6A21;&#x5F0F;&#x65B9;&#x6CD5;(pattern)&#x3002;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x8BDD;&#x6765;&#x81EA;&#x7B2C;&#x4E00;&#x7AE0;&#xFF0C;&#x63D0;&#x7EB2;&#x6308;&#x9886;&#xFF1A;My goal is for you to see the rhythm of Test-Driven Development (TDD), which can be summed up as follows.Quickly add a test.Run all tests and see the new one fail.Make a little change.Run all tests and see them all succeed.Refactor to remove duplication.The surprises are likely to include.How each test can cover a small increment of functionality.How small and ugly the changes can be to make the new tests run.How often the tests are run.How many teensy-weensy steps make up the refactorings.&#x8FD9;&#x5C31;&#x662F;TDD&#x7684;&#x7CBE;&#x9AD3;&#x3002;&#x6309;&#x4F5C;&#x8005;&#x7684;&#x8BF4;&#x6CD5;&#x5C31;&#x662F;Green/Red/Green/Refactor&#x8282;&#x594F;&#x3002; &#x8FD9;&#x4E5F;&#x56DE;&#x7B54;&#x4E86;&#x6211;&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#x7684;&#x56F0;&#x6270;&#xFF0C;&#x5230;&#x5E95;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x4E00;&#x6BB5;&#x7A0B;&#x5E8F;&#xFF0C;&#x5230;&#x5E95;&#x8981;&#x8003;&#x8651;&#x591A;&#x5C11;&#x79CD;&#x60C5;&#x51B5;&#x3002;&#x6309;&#x7167;TDD&#x7684;&#x5EFA;&#x8BAE;&#x5C31;&#x662F;&#xFF0C;&#x9996;&#x5148;&#x5199;&#x6D4B;&#x8BD5;&#xFF0C;&#x7136;&#x540E;&#x4EE3;&#x7801;&#x600E;&#x4E48;&#x5FEB;&#x600E;&#x4E48;&#x6765;&#xFF0C;&#x4E0D;&#x7BA1;&#x6709;&#x591A;ugly&#xFF0C;&#x7136;&#x540E;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x91CD;&#x590D;&#xFF0C;&#x53CA;&#x65F6;&#x505A;&#x91CD;&#x6784;&#x3002;&#x4E0D;&#x8981;&#x8003;&#x8651;&#x4EC0;&#x4E48;&#x6269;&#x5C55;&#x6027;&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x65B9;&#x5F0F;&#x672C;&#x8EAB;&#x5C31;&#x80FD;&#x63D0;&#x4F9B;&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x63D0;&#x9AD8;&#x4E86;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x548C;&#x91CD;&#x6784;&#x7684;&#x9891;&#x7387;&#xFF0C;&#x65E2;&#x63D0;&#x5347;&#x4E86;&#x7F16;&#x7801;&#x8005;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x4FE1;&#x5FC3;&#xFF0C;&#x4E5F;&#x964D;&#x4F4E;&#x4E86;&#x4E0D;&#x5408;&#x7406;&#x8BBE;&#x8BA1;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x3002;Chapter 25. Test-Driven Development Patterns&#x4E66;&#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x5F88;&#x591A;&#x5F71;&#x50CF;&#x56FE;(Influence Diagram)&#xFF0C;&#x5F88;&#x5F62;&#x8C61;&#x7684;&#x8BF4;&#x660E;&#x4E86;&#xFF0C;&#x5F15;&#x5165;TDD&#x80FD;&#x7ED9;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x7684;&#x5F00;&#x53D1;&#x5DE5;&#x4F5C;&#x5F15;&#x5165;&#x4EC0;&#x4E48;&#x597D;&#x5904;&#x3002; This is a positive feedback loop. The more stress you feel, the less testing you will do. The less testing you do, the more errors you will make. The more errors you make, the more stress you feel. Rinse and repeat.Isolated Test&#x80FD;&#x5C06;&#x5927;&#x5757;&#x7684;&#x6D4B;&#x8BD5;&#x5206;&#x5272;&#x6210;&#x677E;&#x8026;&#x5408;&#x7684;&#x5C0F;&#x6D4B;&#x8BD5;&#x4E0D;&#x5BB9;&#x6613;&#xFF0C;&#x4F46;&#x662F;&#x597D;&#x5904;&#x5927;&#x5927;&#x7684;&#x3002;&#x4F5C;&#x8005;&#x8BF4;&#xFF1A;I never knew exactly how to achieve high cohesion and loose coupling regularly until I started writing isolated tests.Test List&#x6211;&#x4EEC;&#x8981;&#x600E;&#x4E48;&#x5F00;&#x59CB;TDD&#x5462;&#xFF1F;&#x4F5C;&#x8005;&#x7ED9;&#x51FA;&#x4E86;&#x5F88;&#x5177;&#x64CD;&#x4F5C;&#x6027;&#x7684;&#x5EFA;&#x8BAE;&#xFF1A;Before you begin, write a list of all the tests you know you will have to write. &#x8FD9;&#x4E2A;list&#x4E0A;&#x5199;&#x70B9;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;Put on the list examples of every operation that you know you need to implement. &#x8981;&#x54EA;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;for those operations that don&#x2019;t already exist, put the null version of that operation on the list.&#x54EA;&#x4E9B;&#x64CD;&#x4F5C;&#x6CA1;&#x5B9E;&#x73B0;&#xFF0C;&#x5199;&#x4E0A;&#x5B58;&#x6839;&#x3002;List all of the refactorings that you think you will have to do in order to have clean code at the end of this session. &#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x5217;&#x51FA;&#x9700;&#x8981;&#x91CD;&#x6784;&#x7684;&#x5730;&#x65B9;&#x3002;&#x800C;&#x5982;&#x679C;&#x6709;&#x5927;&#x7684;&#x91CD;&#x6784;&#x7684;&#x9700;&#x8981;&#x65F6;&#xFF0C;&#x653E;&#x5230;later list&#x91CC;&#x9762;&#xFF0C;&#x628A;&#x624B;&#x91CC;&#x7684;&#x4E8B;&#x60C5;&#x5904;&#x7406;&#x5B8C;&#xFF0C;&#x518D;&#x53BB;&#x5904;&#x7406;&#x5927;&#x7684;&#x91CD;&#x6784;&#x3002;&#x770B;&#x4F5C;&#x8005;&#x65F6;&#x523B;&#x5728;&#x5F3A;&#x8C03;TDD&#x5C31;&#x662F;tiny steps&#xFF1A;The pure form of TDD, wherein you are never more than one change away from a green bar, is like that three-out-of-four rule.Test First&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5199;&#x6D4B;&#x8BD5;&#xFF1F; &#x7B54;&#xFF1A;&#x5728;&#x5199;code&#x4E4B;&#x524D;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x4F60;&#x5F00;&#x59CB;&#x5199;code&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x5C31;&#x8EAB;&#x9677;&#x6CE5;&#x6F6D;&#xFF0C;&#x65E0;&#x6687;&#x987E;&#x53CA;test case&#x4E86;&#x3002;Chapter 26. Red Bar PatternsOne Step TestEach test should represent one step toward your overall goal.Starter Test&#x5982;&#x4F55;&#x5F00;&#x59CB;&#x5199;&#x6D4B;&#x8BD5;&#xFF1F;&#x4E0D;&#x8981;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x60F3;&#x5199;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x4F1A;&#x4E00;&#x6B21;&#x9762;&#x5BF9;&#x592A;&#x591A;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4F5C;&#x8005;&#x5EFA;&#x8BAE;&#x5C1D;&#x8BD5;&#x4ECE;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x5F00;&#x59CB;&#x3002;&#x8FD9;&#x6837;&#x4EE5;&#x4FBF;&#x4E8E;&#x4F60;&#x4ECE;Greenxun&#x8FC5;&#x901F;&#x5F00;&#x59CB;&#x4F60;&#x7684;Green/Red/Green/Refactor&#x8282;&#x594F;&#x3002;&#x4F5C;&#x8005;&#x4E3E;&#x4E86;&#x4E00;&#x4E2A;&#x4EA7;&#x751F;&#x591A;&#x8FB9;&#x5F62;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;1.Reducer r= new Reducer(new Polygon()); 2.assertEquals(0, reducer.result().npoints);&#x4E0D;&#x592A;&#x61C2;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x4ECE;&#x4E2D;&#x770B;&#x51FA;&#x4F5C;&#x8005;&#x5BF9;TDD&#x7684;&#x89E3;&#x91CA;&#x3002;&#x95EE;&#x9898;&#x672C;&#x8EAB;&#x662F;&#x8981;&#x89E3;&#x4E00;&#x4E2A;&#x964D;&#x4F4E;&#x591A;&#x8FB9;&#x5F62;&#x8FB9;&#x6570;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4F5C;&#x8005;&#x7684;&#x542F;&#x52A8;&#x6D4B;&#x8BD5;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x201C;0&#x201D;&#x8FB9;&#x591A;&#x8FB9;&#x5F62;&#xFF0C;&#x90A3;&#x7ED3;&#x679C;&#x4E00;&#x5B9A;&#x662F;&#x201D;0&#x201D;&#x8FB9;&#x591A;&#x8FB9;&#x5F62;&#x3002;&#x5BF9;&#x5B9E;&#x9645;&#x610F;&#x4E49;&#x5F88;&#x8352;&#x8BDE;&#xFF0C;&#x4F46;&#x5BF9;&#x6D4B;&#x8BD5;&#x6765;&#x8BF4;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x5F00;&#x59CB;&#x3002;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x9884;&#x671F;&#xFF0C;&#x7B80;&#x5355;&#x800C;&#x4E14;&#x53C8;represent one step toward your overall goal&#x3002;Explanation Test&#x8FD9;&#x4E00;&#x7AE0;&#x662F;&#x5728;&#x8BF4;&#x5982;&#x4F55;&#x4E0D;&#x7528;&#x5F3A;&#x8FEB;&#x7684;&#x624B;&#x6BB5;&#x8BA9;&#x975E;TDD&#x7684;&#x56E2;&#x961F;&#x6210;&#x5458;&#x80FD;&#x8F6C;&#x5411;TDD&#x3002;&#x5F53;&#x5F00;&#x53D1;&#x8005;&#x5411;&#x4F60;&#x89E3;&#x91CA;&#x4ED6;&#x7684;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x4F60;&#x90FD;&#x53EF;&#x4EE5;&#x5C06;&#x4E4B;&#x8F6C;&#x5316;&#x4E3A;test case&#x3002; &#x672C;&#x4E66;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x7279;&#x8272;&#x7684;&#x5730;&#x65B9;&#x662F;&#xFF0C;&#x8D2F;&#x7A7F;&#x5168;&#x6587;&#xFF0C;&#x4F5C;&#x8005;&#x603B;&#x662F;&#x5728;&#x7ECF;&#x610F;&#x4E0D;&#x7ECF;&#x610F;&#x95F4;&#x6D41;&#x9732;&#x7740;&#x5404;&#x79CD;&#x5B9D;&#x8D35;&#x7684;&#x5DE5;&#x4F5C;&#x7ECF;&#x9A8C;&#xFF1A;&#x5982;&#x4F55;&#x957F;&#x671F;&#x4FDD;&#x6301;&#x66F4;&#x9AD8;&#x6548;&#x7684;&#x7F16;&#x7A0B;&#xFF1F;&#x5982;&#x679C;&#x4F60;&#x662F;&#x7ECF;&#x7406;&#xFF0C;&#x4F60;&#x5982;&#x4F55;&#x4E0E;&#x4F60;&#x7684;&#x56E2;&#x961F;&#x6210;&#x5458;&#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#xFF1F;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E00;&#x7AE0;&#x5C31;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x53E5;&#x8BDD;&#xFF1A;If you&#x2019;re a manager or a leader, you can&#x2019;t force anyone to change the way they work. What can you do? A simple start is to start asking for explanations in terms of test cases: &#x201C;Let me see if I understand what you&#x2019;re saying.Learning Test&#x8FD9;&#x4E00;&#x7AE0;&#x8BB2;&#x4E86;&#x6D4B;&#x8BD5;&#x9A71;&#x52A8;&#x5F00;&#x53D1;&#x9488;&#x5BF9;&#x96C6;&#x6210;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x7684;&#x4F18;&#x52BF;&#x3002;Regression Test&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x662F;&#x6307;&#x4FEE;&#x6539;&#x4E86;&#x65E7;&#x4EE3;&#x7801;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x4EE5;&#x786E;&#x8BA4;&#x4FEE;&#x6539;&#x6CA1;&#x6709;&#x5F15;&#x5165;&#x65B0;&#x7684;&#x9519;&#x8BEF;&#x6216;&#x5BFC;&#x81F4;&#x5176;&#x4ED6;&#x4EE3;&#x7801;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#x3002; &#x81EA;&#x52A8;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x5C06;&#x5927;&#x5E45;&#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x6D4B;&#x8BD5;&#x3001;&#x7EF4;&#x62A4;&#x5347;&#x7EA7;&#x7B49;&#x9636;&#x6BB5;&#x7684;&#x6210;&#x672C;&#x3002;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x4F5C;&#x4E3A;&#x8F6F;&#x4EF6;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x4E00;&#x4E2A;&#x7EC4;&#x6210;&#x90E8;&#x5206;&#xFF0C;&#x5728;&#x6574;&#x4E2A;&#x8F6F;&#x4EF6;&#x6D4B;&#x8BD5;&#x8FC7;&#x7A0B;&#x4E2D;&#x5360;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5DE5;&#x4F5C;&#x91CF;&#x6BD4;&#x91CD;&#xFF0C;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x7684;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#x90FD;&#x4F1A;&#x8FDB;&#x884C;&#x591A;&#x6B21;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x3002;&#x5728;&#x6E10;&#x8FDB;&#x548C;&#x5FEB;&#x901F;&#x8FED;&#x4EE3;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x65B0;&#x7248;&#x672C;&#x7684;&#x8FDE;&#x7EED;&#x53D1;&#x5E03;&#x4F7F;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x8FDB;&#x884C;&#x7684;&#x66F4;&#x52A0;&#x9891;&#x7E41;&#xFF0C;&#x800C;&#x5728;&#x6781;&#x7AEF;&#x7F16;&#x7A0B;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x66F4;&#x662F;&#x8981;&#x6C42;&#x6BCF;&#x5929;&#x90FD;&#x8FDB;&#x884C;&#x82E5;&#x5E72;&#x6B21;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x901A;&#x8FC7;&#x9009;&#x62E9;&#x6B63;&#x786E;&#x7684;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x7B56;&#x7565;&#x6765;&#x6539;&#x8FDB;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x7684;&#x6548;&#x7387;&#x548C;&#x6709;&#x6548;&#x6027;&#x662F;&#x975E;&#x5E38;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002; &#x2014;&#x2014; &#x767E;&#x5EA6;&#x767E;&#x79D1;&#x672C;&#x4E66;&#x8BB2;&#x7684;&#x56DE;&#x5F52;&#x6D4B;&#x8BD5;&#x6982;&#x5FF5;&#x53EF;&#x80FD;&#x7565;&#x6709;&#x4E0D;&#x540C;&#x3002;&#x6309;&#x7167;&#x6211;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x4F5C;&#x8005;&#x662F;&#x60F3;&#x8BF4;&#xFF0C;&#x5728;&#x8FDB;&#x884C;&#x5B8C;&#x6240;&#x6709;&#x7684;&#x7F16;&#x7801;&#x4EE5;&#x540E;&#xFF0C;&#x4F60;&#x5DF2;&#x7ECF;&#x5BF9;&#x4F60;&#x7684;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x5B8C;&#x6210;&#x4E86;unknownknown&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x56DE;&#x8FC7;&#x5934;&#x770B;&#x770B;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x65F6;&#x5019;&#x91CD;&#x65B0;&#x5199;&#x4E00;&#x4EFD;&#x6D4B;&#x8BD5;&#x4F60;&#x5E94;&#x8BE5;&#x5199;&#x4EC0;&#x4E48;&#x3002;&#x56DE;&#x5230;&#x4F60;&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x6700;&#x521D;&#x7684;&#x60F3;&#x6CD5;&#x6765;&#x5BF9;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x505A;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x3002;&#x4EE5;&#x671F;&#x5BF9;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x6709;&#x4E2A;&#x6574;&#x4F53;&#x7684;&#x8BC4;&#x4EF7;&#x3002;Break&#x52B3;&#x9038;&#x7ED3;&#x5408;&#x5BF9;&#x7A0B;&#x5E8F;&#x5458;&#x662F;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF01;Shower Methodology:If you know what to type, then type. If you don&#x2019;t know what to type, then take a shower, and stay in the shower until you know what to type. TDD Rule: If you don&#x2019;t know what to type, then Fake It. If the right design still isn&#x2019;t clear, then Triangulate. &#x770B;&#x770B;&#x4F5C;&#x8005;&#x63D0;&#x5021;&#x7684;&#x65F6;&#x95F4;&#x7BA1;&#x7406;At the scale of hours, keep a water bottle by your keyboard so that biology provides the motivation for regular breaks.At the scale of a day, commitments after regular work hours can help you to stop when you need sleep before progress.At the scale of a week, weekend commitments help get your conscious, energysucking thoughts off work. (My wife swears I get my best ideas on Friday evening.)At the scale of a year, mandatory vacation policies help you refresh yourself completely. The French do this right&#x2014;two contiguous weeks of vacation aren&#x2019;t enough. You spend the first week decompressing, and the second week getting ready to go back to work. Therefore, three weeks, or better four, are necessary for you to be your most effective the rest of the year.Do OverWhat do you do when you are feeling lost? Throw away the code and start over. &#x4F5C;&#x8005;&#x5728;&#x8FD9;&#x4E00;&#x7AE0;&#x544A;&#x8BC9;&#x4F60;&#xFF0C;&#x4E0D;&#x8981;&#x5728;&#x6CE5;&#x6F6D;&#x8D8A;&#x9677;&#x8D8A;&#x6DF1;&#xFF0C;&#x4E0D;&#x8981;&#x5BB3;&#x6015;&#x91CD;&#x65B0;&#x5F00;&#x59CB;&#x3002;&#x6362;&#x4E2A;&#x4F19;&#x4F34;&#xFF0C;&#x6362;&#x4E2A;&#x601D;&#x8DEF;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x6709;&#x66F4;&#x597D;&#x7684;&#x53D1;&#x73B0;&#x3002;Chapter 27. Testing PatternsChild Test&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x89C9;&#x5F97;&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x592A;&#x5927;&#xFF0C;&#x90A3;&#x5C31;&#x8981;&#x628A;&#x8FD9;&#x4E2A;&#x5927;&#x7684;&#x6D4B;&#x8BD5;&#x7834;&#x6210;&#x82E5;&#x5E72;&#x4E2A;&#x5C0F;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x7136;&#x540E;&#x770B;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x8FDB;&#x5C55;&#x3002;Mock ObjectHow do you test an object that relies on an expensive or complicated resource? Create a fake version of the resource that answers constants. If you want to use Mock Objects, you can&#x2019;t easily store expensive resources in global variables.&#x8981;&#x8BB0;&#x5F97;&#x6E05;&#x7406;&#x73B0;&#x573A;&#xFF0C;&#x5426;&#x5219;&#x4E07;&#x4E00;&#x5176;&#x4ED6;&#x7684;&#x4EE3;&#x7801;&#x628A;&#x4ED6;&#x5F53;&#x4F5C;&#x771F;&#x7684;object&#x5728;&#x4F7F;&#x7528;&#xFF0C;&#x5C31;&#x4F1A;&#x51FA;&#x5927;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#x7F16;&#x7801;&#x6700;&#x57FA;&#x672C;&#x7684;&#x51C6;&#x5219;&#x662F;&#x5C11;&#x7528;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x3002; Mock Objects encourage you down the path of carefully considering the visibility of every object, reducing the coupling in your designs. &#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7528;Mock Object&#xFF0C;&#x4F60;&#x5C31;&#x8981;&#x601D;&#x8003;&#x6211;&#x5230;&#x5E95;&#x8BE5;&#x4E0D;&#x8BE5;&#x628A;&#x8FD9;&#x4E2A;&#x5E9E;&#x7136;&#x5927;&#x7269;&#x66B4;&#x9732;&#x7ED9;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x79CD;&#x601D;&#x8003;&#x6709;&#x52A9;&#x4E8E;&#x51CF;&#x5C0F;&#x8026;&#x5408;&#x6027;&#x3002;Self ShuntHow do you test that one object communicates correctly with another? Have the object under test communicate with the test case instead of with the object it expects.Without Self Shunt1.# ResultListenerTest2.def testNotification(self): 3. result= TestResult() 4. listener= ResultListener() 5. result.addListener(listener) 6. WasRun(&quot;testMethod&quot;).run(result)7. assert 1 == listener.count 8.9.# ResultListener10.class ResultListener:11. def __init__(self): 12. self.count= 0 13. def startTest(self): 14. self.count= self.count + 1 With Self Shunt1.# ResultListenerTest2.def testNotification(self): 3. self.count= 0 4. result= TestResult()5. result.addListener(self)6. WasRun(&quot;testMethod&quot;).run(result) 7. assert 1 == self.count8.def startTest(self):9. self.count= self.count + 1&#x8FD9;&#x91CC;&#x4E3E;&#x5F97;&#x4F8B;&#x5B50;&#x4E0D;&#x662F;&#x5F88;&#x660E;&#x767D;&#x3002;&#x4E2D;&#x6587;&#x8BD1;&#x672C;&#x91CC;&#xFF0C;&#x5C06;self shunt&#x7FFB;&#x8BD1;&#x6210;&#x81EA;&#x5206;&#x6D41;&#xFF0C;&#x611F;&#x89C9;&#x4E5F;&#x662F;&#x5B57;&#x9762;&#x7FFB;&#x8BD1;&#x3002;&#x6211;&#x7406;&#x89E3;&#x8FD9;&#x91CC;&#x60F3;&#x8BF4;&#x7684;&#x662F;&#xFF0C;&#x4E0D;&#x4E00;&#x5B9A;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7C7B;&#x6765;&#x505A;&#x5F53;&#x524D;&#x88AB;&#x6D4B;&#x8BD5;&#x7C7B;&#x6765;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;test case&#x91CC;&#x9762;&#x7528;&#x8BE5;&#x7C7B;&#x66B4;&#x9732;&#x7684;&#x63A5;&#x53E3;&#x6765;&#x505A;&#x4E8B;&#x60C5;&#x3002;Self Shunt may require that you use Extract Interface to get an interface to implement. You will have to decide whether extracting the interface is easier, or if testing the existing class as a black box is easier.&#x8FD9;&#x91CC;&#x53C8;&#x770B;&#x6655;&#x4E86;&#xFF0C;self shunt&#x8DDF;extract interface&#x6709;&#x5565;&#x5173;&#x7CFB;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x6CE8;&#x610F;&#x5230;&#x5728;&#x6211;&#x4EEC;&#x4EE3;&#x7801;&#x7ED3;&#x6784;&#x4E2D;&#x8D85;&#x8FC7;&#x4E00;&#x4E2A;&#x7C7B;&#x4F7F;&#x7528;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7C7B;&#x4E2D;&#x7684;&#x540C;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x6B64;&#x65F6;&#x5E94;&#x8BE5;&#x5C06;&#x8BE5;&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x63D0;&#x53D6;&#x51FA;&#x6765;&#x653E;&#x5230;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF08;interface&#xFF09;&#x4E2D;&#xFF0C;&#x5E76;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x4EE5;&#x4FBF;&#x88AB;&#x7528;&#x6237;&#x7C7B;&#x8BBF;&#x95EE;&#x3001;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x6709;&#x5229;&#x4E8E;&#x6253;&#x7834;&#x539F;&#x6765;&#x591A;&#x4E2A;&#x7C7B;&#x4E0E;&#x8FD9;&#x4E2A;&#x7279;&#x6B8A;&#x7C7B;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002;&#x8FD9;&#x4E2A;&#x91CD;&#x6784;&#x624B;&#x6CD5;&#x5F88;&#x5BB9;&#x6613;&#x5B9E;&#x73B0;&#xFF0C;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x6709;&#x5229;&#x4E8E;&#x677E;&#x8026;&#x5408;&#x3002; &#x2014;&#x2014;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x89E3;&#x91CA;&#x6211;&#x89C9;&#x5F97;&#x8FD9;&#x91CC;&#x4F5C;&#x8005;&#x63D0;&#x5230;&#x7684;extract interface&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x8BF4;&#x7684;&#x91CD;&#x6784;&#x91CC;&#x7684;extract interface&#x3002;&#x8FD9;&#x91CC;&#x8BF4;&#x8981;&#x6D4B;&#x8BD5;A&#x7C7B;&#x548C;B&#x7C7B;&#x901A;&#x4FE1;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x76F4;&#x63A5;&#x7528;B&#x7C7B;&#xFF0C;&#x800C;&#x7528;test case&#x4E0E;A&#x7C7B;&#x901A;&#x4FE1;&#xFF0C;&#x4EE5;&#x6D4B;&#x8BD5;&#x901A;&#x4FE1;&#x7684;A&#x7C7B;&#x7AEF;&#x63A5;&#x53E3;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;extract interface&#x8BF4;&#x7684;&#x662F;&#x4ECE;B&#x7C7B;&#x4E2D;extract&#x63A5;&#x53E3;&#x51FA;&#x6765;&#x5230;test case&#x4E2D;&#x53BB;implement&#x3002;&#x6216;&#x8005;&#x628A;B&#x7C7B;&#x76F4;&#x63A5;&#x5F53;&#x9ED1;&#x76D2;&#x5B50;&#x5728;test case&#x4E2D;&#x4F7F;&#x7528;&#x3002;Log String&#x8FD9;&#x4E2A;&#x5F88;&#x6709;&#x7528;&#x3002;&#x6709;&#x4E9B;&#x51FD;&#x6570;&#x6216;&#x8005;&#x8FC7;&#x7A0B;&#x662F;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x7528;Log String&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x67E5;&#x770B;&#x8BE5;&#x8FC7;&#x7A0B;&#x6216;&#x51FD;&#x6570;&#x6709;&#x6CA1;&#x6709;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x7C7B;&#x4F3C;&#x6211;&#x4EEC;&#x770B;trace log&#x4E00;&#x6837;&#xFF0C;&#x901A;&#x8FC7;&#x770B;trace log&#x80FD;&#x77E5;&#x9053;&#x673A;&#x5668;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;Crash Test DummyHow do you test error code that is unlikely to be invoked? Invoke it anyway with a special object that throws an exception instead of doing real work.Broken Test&#x4F5C;&#x8005;&#x7ECF;&#x5E38;&#x80FD;&#x7ED9;&#x51FA;&#x4E00;&#x4E9B;&#x5F88;&#x5B9E;&#x7528;&#x7684;&#x5C0F;&#x7ECF;&#x9A8C;&#xFF0C;&#x8FD9;&#x91CC;&#x53C8;&#x6765;&#x4E86;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x3002;How do you leave a programming session when you&#x2019;re programming alone? Leave the last test broken.&#x5F53;&#x4F60;&#x8981;&#x8F6C;&#x53BB;&#x505A;&#x53E6;&#x5916;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#xFF0C;&#x800C;&#x624B;&#x5934;&#x4E0A;&#x7684;&#x4E8B;&#x60C5;&#x53C8;&#x6CA1;&#x7ED3;&#x675F;&#x65F6;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x8BA9;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6545;&#x610F;&#x7684;&#x4E0D;&#x901A;&#x8FC7;&#x3002;&#x8FD9;&#x6837;&#x4E0B;&#x6B21;&#x5C31;&#x77E5;&#x9053;&#x4ECE;&#x54EA;&#x513F;&#x5F00;&#x59CB;&#xFF0C;&#x7136;&#x540E;&#x80FD;&#x8FC5;&#x901F;&#x4E0A;&#x624B;&#x3002;&#x918D;&#x9190;&#x704C;&#x9876;&#x554A;&#xFF01;&#x4EE5;&#x524D;&#x90FD;&#x662F;&#x8BA4;&#x4E3A;&#x505A;&#x53E6;&#x5916;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x4E4B;&#x524D;&#x8981;&#x628A;&#x624B;&#x5934;&#x4E0A;&#x7684;&#x4E8B;&#x60C5;&#x5F04;&#x7684;&#x5C3D;&#x5584;&#x5C3D;&#x7F8E;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x7136;&#x3002;&#x600E;&#x4E48;&#x505A;&#x5229;&#x4E8E;&#x540E;&#x671F;&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#xFF0C;&#x90A3;&#x5C31;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x505A;&#x3002;Clean Check-inYou will occasionally find a test broken in the integration suite when you try to check in. What to do? The simplest rule is to just throw away your work and start over. The broken test is pretty strong evidence that you didn&#x2019;t know enough to program what you just programmed. &#x4EC0;&#x4E48;&#x4EC0;&#x4E48;&#xFF1F;&#x7ADF;&#x7136;&#x8981;&#x6211;&#x4EEC;&#x6254;&#x6389;&#x6211;&#x4EEC;&#x505A;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x5F00;&#x59CB;&#x3002;&#x5C31;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x548C;integration&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x4E0D;&#x4E00;&#x81F4;&#x3002; &#x5927;&#x5E08;&#x7684;&#x8BDD;&#x603B;&#x662F;&#x6709;&#x9053;&#x7406;&#x7684;&#xFF0C;&#x4EE5;&#x540E;&#x8981;&#x597D;&#x597D;&#x8003;&#x8651;&#x8FD9;&#x4E00;&#x70B9;&#x3002;Chapter 28. Green Bar PatternsFake It (&#x2018;Til You Make It)&#x505A;&#x5047;&#x4EE3;&#x7801;&#x8BA9;&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4E00;&#x9879;&#x4E00;&#x9879;&#x5730;&#x5B8C;&#x6210;Triangulate&#x4F5C;&#x8005;&#x63D0;&#x5230;&#x7684;&#x6240;&#x8C13;&#x4E09;&#x89D2;&#x6CD5;&#x3002;&#x901A;&#x4FD7;&#x7684;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x53EA;&#x5728;&#x5FC5;&#x8981;&#x7684;&#x65F6;&#x5019;&#x505A;&#x62BD;&#x8C61;&#x6216;&#x901A;&#x7528;&#x5316;&#x5904;&#x7406;&#x3002;&#x901A;&#x5E38;&#x662F;&#x5728;TDD&#x7684;&#x91CD;&#x6784;&#x8FD9;&#x4E00;&#x6B65;&#x5B8C;&#x6210;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x518D;&#x901A;&#x4FD7;&#x70B9;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x591A;&#x5F04;&#x51E0;&#x4E2A;case&#xFF0C;&#x518D;&#x603B;&#x7ED3;&#x5171;&#x540C;&#x70B9;&#xFF0C;&#x4E4B;&#x540E;&#x505A;&#x62BD;&#x8C61; &#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x89D2;&#x5EA6;&#xFF0C;&#x4F5C;&#x8005;&#x53C8;&#x8BF4;&#x4E86;&#xFF1A;I only use Triangulation when I&#x2019;m really, really unsure about the correct abstraction for the calculation. Otherwise I rely on either Obvious Implementation or Fake It.One to ManyHow do you implement an operation that works with collections of objects? Implement it without the collections first, then make it work with collections.&#x4E2D;&#x5FC3;&#x601D;&#x60F3;&#x8FD8;&#x662F;&#x4E00;&#x4E2A;&#xFF0C;&#x4ECE;&#x663E;&#x800C;&#x6613;&#x89C1;&#x7684;&#x5730;&#x65B9;&#x5F00;&#x59CB;&#xFF0C;&#x6BCF;&#x6B21;&#x53EA;&#x505A;&#x4E00;&#x5C0F;&#x6B65;&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x5230;&#x8FBE;&#x6700;&#x7EC8;&#x7684;&#x76EE;&#x7684;&#x5730;&#x3002;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;1.// 1. fake code2.public void testSum() { 3. assertEquals(5, sum(5)); 4.} 5.private int sum(int value) {6. return value;7.}8.9.// 2. add arrays10.public void testSum() {11. assertEquals(5, sum(5, new int[] {5}));12.}13.private int sum(int value, int[] values) {14. return value;15.}16.17.// 3. add real sum functionality18.public void testSum() {19. assertEquals(5, sum(5, new int[] {5}));20.}21.private int sum(int value, int[] values) {22. int sum= 0; 23. for ( int i= 0; i&lt;values.length; i++)24. sum += values[i];25. return sum;26.}27.28.// 4. delete unnecessary code29.public void testSum() { 30. assertEquals(5, sum(new int[] {5}));31.}32.private int sum( int[] values) {33. int sum= 0; 34. for (int i= 0; i&lt;values.length; i++)35. sum += values[i];36. return sum; sum;37.}&#x7EC6;&#x7EC6;&#x4F53;&#x4F1A;&#x5176;&#x95F4;&#x7684;&#x5DEE;&#x522B;&#x5427;&#x3002;Chapter 29. xUnit PatternsAssertionHow do you check that tests worked correctly? Write boolean expressions that automate your judgment about whether the code worked.&#x4F5C;&#x8005;&#x5728;&#x8FD9;&#x4E00;&#x7AE0;&#x53C8;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x6307;&#x5BFC;&#x610F;&#x4E49;&#x7684;&#x89C2;&#x70B9;&#x3002;&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x505A;&#x767D;&#x76D2;&#x6D4B;&#x8BD5;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x505A;&#xFF0C;&#x8BF4;&#x660E;&#x4F60;&#x7684;&#x8BBE;&#x8BA1;&#x6709;&#x95EE;&#x9898;Fixture&#x8FD9;&#x91CC;&#x4F5C;&#x8005;&#x629B;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;&#x6D4B;&#x8BD5;&#x6709;&#x7C7B;&#x4F3C;&#x7684;&#x4EE3;&#x7801;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x4E24;&#x4E2A;&#x9009;&#x62E9;&#xFF1A;test case&#x7C7B;&#x5B9A;&#x4E49;&#x4E2D;&#x62BD;&#x8C61;&#x51FA;&#x7C7B;&#x4F3C;setUp&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6765;&#x505A;&#x91CD;&#x590D;&#x7684;&#x5DE5;&#x4F5C;&#x6216;&#x8005;&#x7528;&#x7C7B;&#x4F3C;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x5668;&#x7684;&#x4E1C;&#x897F;&#x6765;&#x4E3A;&#x6240;&#x6709;&#x9700;&#x8981;&#x7684;&#x6D4B;&#x8BD5;&#x751F;&#x6210;fixture&#x65B9;&#x6CD5;1&#x6709;&#x65F6;&#x5019;&#x66F4;&#x7B26;&#x5408;DRY&#x539F;&#x5219;&#xFF0C;&#x4F46;&#x5B83;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#xFF0C;&#x4F60;&#x8981;&#x8BB0;&#x4F4F;setUp&#x91CC;&#x9762;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x3002;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x90FD;&#x53EF;&#x4EE5;&#xFF0C;&#x9009;&#x62E9;&#x66F4;&#x5408;&#x9002;&#x7684;&#x3002;External Fixture&#x6240;&#x8C13;&#x7684;&#x5916;&#x90E8;fixture&#xFF0C;&#x5C31;&#x662F;&#x8981;&#x4FDD;&#x8BC1;&#x6D4B;&#x8BD5;&#x80FD;&#x6062;&#x590D;&#x73AF;&#x5883;&#x914D;&#x7F6E;&#x3002;&#x5728;&#x6240;&#x6709;&#x6D4B;&#x8BD5;&#x5F00;&#x59CB;&#x524D;&#x8C03;setUp&#xFF0C;&#x6240;&#x6709;&#x6D4B;&#x8BD5;&#x7ED3;&#x675F;&#x540E;&#x8C03;tearDown&#x3002;&#x8FD9;&#x5C31;&#x662F;External FixtureTest Method&#x8FD9;&#x4E00;&#x8282;&#x9488;&#x5BF9;&#x5982;&#x4F55;&#x5199;&#x6D4B;&#x8BD5;&#x65B9;&#x6CD5;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E9B;&#x5EFA;&#x8BAE;&#x3002;hierarchy Module FrameworkClass internal fixtureMethod test case&#x540D;&#x5B57;&#x957F;&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;&#x8981;&#x8BA9;&#x4EE5;&#x540E;&#x7684;&#x8BFB;&#x8005;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x7EBF;&#x7D22;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5199;&#x8FD9;&#x4E2A;test&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x8981;&#x591F;&#x76F4;&#x89C9;&#xFF0C;&#x8981;&#x591F;&#x7B80;&#x6D01;&#xFF08;&#x6700;&#x77ED;3&#x884C;&#xFF09; &#x6CE8;&#x91CA;&#x91CC;&#x5199;outline&#xFF0C;&#x4E00;&#x9897;&#x661F;&#x8868;&#x793A;&#x4E00;&#x7EA7;&#xFF0C;&#x4F5C;&#x8005;&#x8BF4;&#x4ED6;&#x4E00;&#x822C;&#x5199;2-3&#x7EA7;outline1./* Adding to tuple spaces. */ 2./* Taking from tuple spaces. */3./** Taking a non-existent tuple. **/ 4./** Taking an existing tuple. **/ 5./** Taking multiple tuples. **/ 6./* Reading from tuple space. */Exception Test&#x8FD9;&#x4E00;&#x8282;&#x8BF4;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x5F85;&#x6D4B;&#x7684;&#x51FD;&#x6570;&#x9700;&#x8981;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x7528;&#x5982;&#x4E0B;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;1.public void testMissingRate() {2. try {3. exchange.findRate(&quot;USD&quot;, &quot;GBP&quot;); 4. fail(); // &#x5982;&#x679C;&#x6CA1;&#x629B;&#x5F02;&#x5E38;&#x5C31;fail5. } catch (IllegalArgumentException expected) { 6. }7.}All TestsHow do you run all tests together? Make a suite of all the suites&#x2014;one for each package, and one aggregating the package tests for the whole application.1.public class AllTests {2. // &#x8FD9;&#x91CC;&#x6709;&#x4E2A;main&#xFF0C;&#x65B9;&#x4FBF;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x7A0B;&#x5E8F;&#x5F00;&#x59CB;&#x6D4B;&#x8BD5;3. public static void main(String[] args) { 4. junit.swingui.TestRunner.run(AllTests.class); 5. }6. // &#x8FD9;&#x91CC;&#x6709;&#x4E2A;suite&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;test case7. public static Test suite() { 8. TestSuite result= new TestSuite(&quot;TFD tests&quot;); 9. result.addTestSuite(MoneyTest.class); 10. result.addTestSuite(ExchangeTest.class); 11. result.addTestSuite(IdentityRateTest.class); 12. return result;13. }14.}Chapter 30. Design Patterns&#x4F5C;&#x8005;&#x5728;&#x8FD9;&#x4E00;&#x7AE0;&#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E9B;TDD&#x4E2D;&#x4F1A;&#x7528;&#x5230;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;&#x6709;&#x4E9B;&#x662F;&#x5199;&#x6D4B;&#x8BD5;&#x65F6;&#x7528;&#x7684;&#xFF0C;&#x6709;&#x7684;&#x662F;&#x91CD;&#x6784;&#x65F6;&#x7528;&#x7684;&#xFF0C;&#x6709;&#x7684;&#x4E24;&#x8005;&#x7686;&#x53EF;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x672C;&#x7AE0;&#x6240;&#x6709;&#x6A21;&#x5F0F;&#x7684;&#x603B;&#x7EB2;&#x3002; CommandWhat do you do when you need the invocation of a computation to be more complicated than a simple method call? Make an object for the computation and invoke it.&#x8FD9;&#x91CC;&#x6240;&#x8BF4;&#x7684;&#x547D;&#x4EE4;&#x662F;&#x8BF4;&#xFF0C;&#x628A;&#x8981;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;object&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;&#x90A3;&#x4E2A;objectValue Object&#x628A;&#x4E00;&#x4E9B;&#x5E38;&#x91CF;&#x53C2;&#x6570;&#x505A;&#x6210;object&#x6765;&#x4F20;&#x9012;When implementing a Value Object, every operation has to return a fresh object, All Value Objects have to implement equality Null Object1.public boolean setReadOnly() { 2. SecurityManager guard = System.getSecurityManager(); 3. if (guard != null) { ) {4. guard.canWrite(path);5. } 6. return fileSystem.setReadOnly(this);7.}&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;getSecurityManager&#x5728;&#x4E0D;&#x6210;&#x529F;&#x65F6;&#x8FD4;&#x56DE;Null&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;&#x8005;&#x518D;&#x5224;&#x65AD;&#x8FD4;&#x56DE;&#x503C;&#x4EE5;&#x51B3;&#x5B9A;&#x4F1A;&#x4E0D;&#x4F1A;&#x7528;&#x7A7A;&#x6307;&#x9488;&#x6765;&#x8C03;&#x7528;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x4E0D;&#x597D;&#x7684;&#x662F;&#xFF0C;&#x901A;&#x5E38;&#x8FD9;&#x79CD;&#x5224;&#x65AD;&#x4F1A;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x7ED9;&#x4EBA;&#x4E00;&#x79CD;&#x201C;&#x4F1A;&#x4E0D;&#x4F1A;&#x6709;&#x54EA;&#x91CC;&#x6CA1;&#x5224;&#x65AD;&#xFF0C;&#x4EE5;&#x540E;&#x4F1A;&#x5BFC;&#x81F4;crash&#xFF1F;&#x201D;&#x7684;&#x62C5;&#x5FE7;&#x3002; Null Object&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x5C31;&#x662F;&#x8BA9;getSecurityManager&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;object&#x6765;&#x53D6;&#x4EE3;Null&#xFF0C;&#x8FD9;&#x6837;&#x8BA9;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x7EDF;&#x4E00;&#xFF0C;&#x4EE5;&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x4EE3;&#x7801;&#x3002;Template Method&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x3002;When you find two variants of a sequence in two subclasses, you need to gradually move them closer together. Once you&#x2019;ve extracted the parts that are different from other methods, what you are left with is the Template Method. 1.// TestCase2.public void runBare() throws Throwable { 3. setUp(); 4. try { 5. runTest();6. }7. finally {8. tearDown();9. }10.}Pluggable Object&#x4E2D;&#x6587;&#x8BD1;&#x540D;&#x4E3A;&#x63D2;&#x5165;&#x5F0F;&#x5BF9;&#x8C61;&#x3002;&#x5F88;&#x96BE;&#x7406;&#x89E3;&#x54EA;&#x91CC;&#x6709;&#x8FD9;&#x4E2A;&#x6240;&#x8C13;&#x7684;&#x201C;&#x63D2;&#x5165;&#x201D;&#x3002;&#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x6838;&#x5FC3;&#x7684;&#x601D;&#x60F3;&#x5C31;&#x662F;&#x6D88;&#x9664;if...else...&#x7684;&#x60C5;&#x51B5;&#x3002; &#x770B;&#x4F5C;&#x8005;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x89E3;&#x91CA;&#x7684;&#x5F88;&#x6E05;&#x695A;&#xFF1A;1.// Without Pluggable Object2.Figure selected; 3.public void mouseDown() { 4. selected= findFigure();5. if (selected != null) // &#x5230;&#x5904;&#x662F;null&#x5224;&#x65AD;6. select(selected); 7.}8.public void mouseMove() {9. if (selected != null)10. move(selected); 11. else12. moveSelectionRectangle(); 13.}14.public void mouseUp() {15. if (selected == null)16. selectAll();17.} 18.19.// With Pluggable Object20.SelectionMode mode;21.public void mouseDown() {22. selected= findFigure();23. // &#x5168;&#x90E8;&#x5F52;&#x7ED3;&#x5230;mode&#x5B50;&#x7C7B;&#x91CC;&#x9762;&#x53BB;&#x5904;&#x7406;24. if (selected != null)25. mode= SingleSelection(selected);26. else27. mode= MultipleSelection();28.}29.public void mouseMove() {30. mode.mouseMove();31.}32.public void mouseUp() {33. mode.mouseUp();34.}Pluggable Selector&#x8FD9;&#x4E00;&#x8282;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x548C;&#x4E0A;&#x4E00;&#x8282;&#x7684;&#x6781;&#x4E3A;&#x7C7B;&#x4F3C;&#x3002;&#x8FD9;&#x6B21;&#x8981;&#x5904;&#x7406;&#x6389;&#x7684;&#x662F;switch...case...&#x800C;&#x53C8;&#x4E0D;&#x7528;&#x5B50;&#x7C7B;&#x7EE7;&#x627F;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x52A8;&#x6001;&#x8C03;&#x7528;&#x3002;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x53EB;&#x53CD;&#x5C04;&#x3002;&#x53CD;&#x5C04;&#xFF1A;&#x901A;&#x8FC7;&#x81EA;&#x8EAB;&#x7684;&#x5C5E;&#x6027;&#xFF08;&#x5982;&#x7C7B;&#x540D;&#xFF0C;&#x65B9;&#x6CD5;&#x540D;&#xFF09;&#x6765;&#x505A;&#x76F8;&#x5173;&#x903B;&#x8F91;&#x540C;&#x6837;&#x770B;&#x4F5C;&#x8005;&#x7684;&#x4F8B;&#x5B50;1.void print() { 2. Method runMethod= getClass().getMethod(printMessage, null);3. runMethod.invoke(this, new Class[0]);4.}&#x770B;&#x5230;&#x4E86;&#x6CA1;getClass&#xFF0C;getMethod&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x53CD;&#x5C04;&#x3002;&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x65E2;&#x4E0D;&#x9700;&#x8981;switch&#x6765;&#x8C03;&#x7528;&#x4E0D;&#x540C;&#x7684;printxxx&#x51FD;&#x6570;(printHtml, printXml&#x2026;)&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x5B50;&#x7C7B;&#x6765;&#x8C03;&#x7528;&#x4E0D;&#x540C;&#x7684;print&#x51FD;&#x6570;&#x3002; &#x4F5C;&#x8005;&#x5728;&#x672C;&#x8282;&#x6700;&#x540E;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x6BB5;&#x5FE0;&#x544A;&#xFF1A;Pluggable Selector can definitely be overused. The biggest problem with it is tracing code to see whether a method is invoked. Use Pluggable Selector only when you are cleaning up a fairly straightforward situation in which each of a bunch of subclasses has only one method.Factory Method&#x4F5C;&#x8005;&#x8BF4;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x63D0;&#x4F9B;&#x4E86;&#x7075;&#x6D3B;&#x6027;&#x3002;&#x6211;&#x662F;&#x6CA1;&#x770B;&#x51FA;&#x6765;&#x3002;&#x5BF9;&#x6BD4;&#x4E0B;&#x9762;&#x4E24;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x91CC;&#x589E;&#x52A0;&#x4E86;&#x7075;&#x6D3B;&#x6027;&#xFF1F;1.public void testMultiplication() {2. Dollar five= Dollar five= new Dollar(5);3. assertEquals(new Dollar(10), five.times(2)); 4. assertEquals(new Dollar(15), five.times(3));5.}6.7.public void testMultiplication() { 8. Dollar five = Money.dollar(5); // &#x5DE5;&#x5382;&#x65B9;&#x6CD5;9. assertEquals(new Dollar(10), five.times(2)); 10. assertEquals(new Dollar(15), five.times(3)); 11.}12.// Money13.static Dollar dollar( Dollar dollar(int amount) { 14. return new Dollar(amount);15.}&#x4F5C;&#x8005;&#x6700;&#x540E;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x70B9;&#x5FE0;&#x544A;You have to remember that the method is really creating an object, even though it doesn&#x2019;t look like a constructor. Use Factory Method only when you need the flexibility it creates. Imposter&#x4E2D;&#x6587;&#x8BD1;&#x540D;&#x4E3A;&#x5192;&#x540D;&#x9876;&#x66FF;&#x3002;&#x6839;&#x636E;&#x6587;&#x4E2D;&#x7684;&#x9610;&#x8FF0;&#xFF0C;&#x6211;&#x7406;&#x89E3;&#x8FD9;&#x91CC;&#x8BB2;&#x7684;&#x4E0D;&#x662F;&#x4E00;&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x3002;&#x6307;&#x7684;&#x662F;&#x5982;&#x679C;&#x67D0;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x53EA;&#x5C06;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#xFF08;&#x7C7B;&#x3001;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x53D8;&#x91CF;&#x7B49;&#x7B49;&#xFF09;&#x66FF;&#x6362;&#x6210;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x5C31;&#x80FD;&#x5F97;&#x5230;&#x4E00;&#x6BB5;&#x65B0;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x79F0;&#x4E3A;&#x5192;&#x540D;&#x9876;&#x66FF;&#x3002;&#x53D1;&#x73B0;&#x53EF;&#x4EE5;Imposter&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x53D1;&#x73B0;&#x91CD;&#x590D;&#x3002;1.// &#x4E0B;&#x9762;&#x8FD9;&#x4E24;&#x6BB5;&#x4EE3;&#x7801;&#x5C31;&#x53EA;&#x662F;&#x5C06;RectangleFigure&#x6362;&#x6210;OvalFigure&#xFF0C;&#x6B64;&#x662F;&#x4E3A;Imposter&#x5192;&#x540D;&#x9876;&#x66FF;&#x3002;2.testRectangle() {3. Drawing d= new Drawing();4. d.addFigure(new RectangleFigure(0, 10, 50, 100)); RectangleFigure(0, 10, 50, 100));5. RecordingMedium brush= new RecordingMedium(); 6. d.display(brush); 7. assertEquals(&quot;rectangle 0 10 50 100\n&quot;, brush.log());8.}9.10.testOval() {11. Drawing d= new Drawing();12. d.addFigure(new OvalFigure(0, 10, 50, 100)); 13. RecordingMedium brush= new RecordingMedium(); 14. d.display(brush);15. assertEquals(&quot;oval 0 10 50 100\n&quot;, brush.log()); 16.}&#x4F5C;&#x8005;&#x8FD8;&#x63D0;&#x5230;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x5728;&#x91CD;&#x6784;&#x4E2D;&#x7ECF;&#x5E38;&#x7528;&#x5230;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x672C;&#x8D28;&#x5176;&#x5B9E;&#x5C31;&#x662F;Imposter &#x2014;&#x2014; Null Object &amp; Composite&#x3002;Composite&#x6839;&#x636E;&#x4E0A;&#x4E00;&#x7AE0;&#x4F5C;&#x8005;&#x7684;&#x89C2;&#x70B9;&#xFF0C;&#x7EC4;&#x5408;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x5192;&#x540D;&#x9876;&#x66FF;&#x3002;&#x4F5C;&#x8005;&#x5728;&#x672C;&#x8282;&#x5F00;&#x5934;&#x8BF4;&#x4E86;&#xFF1A;How do you implement an object whose behavior is the composition of the behavior of a list of other objects? Make it an Imposter for the component objects.&#x8BA9;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x79F0;&#x4E3A;&#x7EC4;&#x6210;&#x4ED6;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x5192;&#x540D;&#x9876;&#x66FF;&#x8005;&#x3002;&#x8BF4;&#x8D77;&#x6765;&#x5F88;&#x62D7;&#x53E3;&#x3002;&#x770B;&#x4F8B;&#x5B50;&#xFF1A;1.// Transaction2.Transaction(Money value) {3. this.value= value;4.}5.// Account6.Transaction transactions[];7.Money balance() {8. Money sum= Money.zero();9. for (int i= 0; i &lt; transactions.length; i++) 10. sum= sum.plus(transactions[i].value);11. return sum;12.}&#x8FD9;&#x4E2A;&#x5199;&#x6CD5;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#xFF0C;&#x5F53;&#x8981;&#x7B97;OverallAccount&#x65F6;&#xFF0C;&#x6CA1;&#x8F99;&#x4E86;&#xFF0C;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B0;&#x7C7B;&#x6765;&#x5904;&#x7406;&#x3002;&#x4E00;&#x4E2A;OverallAccount&#x662F;&#x4E00;&#x7EC4;Account&#x3002;&#x4F46;OverallAccount&#x5176;&#x5B9E;&#x8981;&#x505A;&#x7684;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x7D2F;&#x52A0;&#xFF0C;&#x548C;Account&#x505A;&#x7684;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x91CD;&#x590D;&#x3002; &#x89E3;&#x51B3;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;Composite&#x3002;&#x628A;&#x8981;&#x7D2F;&#x52A0;&#x7684;&#x4E1C;&#x897F;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#x79F0;&#x4E3A;Holdings&#xFF0C;Account&#x7D2F;&#x52A0;&#x7684;&#x662F;Holdings&#xFF0C;OverallAccount&#x7D2F;&#x52A0;&#x7684;&#x4E5F;&#x662F;Holdings&#x3002;1.Holding holdings[];2.Money balance() {3. Money sum= Money.zero();4. for ( (int i= 0; i &lt; holdings.length; i++)5. sum= sum.plus(holdings[i].balance());6. return sum;7.}&#x5199;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4ECD;&#x7136;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x660E;&#x767D;&#x4F55;&#x4E3A;Composite&#xFF08;&#x62FC;&#x5408;&#xFF0C;&#x590D;&#x5408;&#x7684;&#x610F;&#x601D;&#xFF09;&#x3002;&#x4F46;&#x6211;&#x4EEC;&#x662F;&#x7AD9;&#x5728;&#x5DE8;&#x4EBA;&#x7684;&#x80A9;&#x8180;&#x4E0A;&#xFF0C;&#x5BF9;&#x6BD4;&#x9605;&#x8BFB;&#x4E86;&#x4E2D;&#x6587;&#x8BD1;&#x672C;&#x540E;&#x6709;&#x4E86;&#x4E00;&#x70B9;&#x70B9;&#x611F;&#x89C9;&#x3002;&#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x4E2D;&#x6587;&#x8BD1;&#x540D;&#x4E3A;-&#x9012;&#x5F52;&#x7EC4;&#x5408;&#x3002;&#x6240;&#x8C13;&#x9012;&#x5F52;&#xFF0C;&#x5E94;&#x5F53;&#x6307;&#x7684;&#x662F;&#xFF0C;&#x901A;&#x8FC7;&#x6982;&#x5FF5;&#x4E0A;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x5C06;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#x6DF7;&#x5408;&#x7C7B;&#x5199;&#x6210;&#x4E00;&#x4E9B;&#x66F4;&#x62BD;&#x8C61;&#x7684;&#x6982;&#x5FF5;&#x7684;&#x7EC4;&#x5408;&#x3002;&#x4F8B;&#x5982;: OvreallAccount &lt;- Account &lt;- Transactions OverallAccount &lt;- Holding &amp; Account &lt;-Holding&#x901A;&#x8FC7;&#x9012;&#x5F52;&#x5730;&#x5C06;OverallAccount&#x5192;&#x540D;&#x9876;&#x66FF;&#x6210;Holding&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;OverallAccount&#x6210;&#x4E3A;&#x4E00;&#x4E2A;Account&#x6765;&#x8FBE;&#x5230;&#x6D88;&#x9664;&#x91CD;&#x590D;&#x3002; &#x4F5C;&#x8005;&#x5728;&#x672C;&#x8282;&#x6700;&#x540E;&#x7ED9;&#x51FA;&#x4E86;&#x4F55;&#x65F6;&#x4F7F;&#x7528;Composite&#x7684;&#x5EFA;&#x8BAE;&#xFF1A;As is obvious from this discussion, I&#x2019;m still not able to articulate how to guess when a collection of objects is just a collection of objects and when you really have a Composite. The good news is, since you&#x2019;re getting good at refactoring, the moment the duplication appears, you can introduce Composite and watch program complexity disappear.Collecting Parameter&#x770B;&#x4E0D;&#x61C2;&#xFF0C;&#x4E0D;&#x77E5;&#x6240;&#x4E91;Singleton&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x5F88;&#x8457;&#x540D;&#x7684;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x7528;&#x5230;&#x3002;&#x4F5C;&#x8005;&#x6CA1;&#x6709;&#x8BE6;&#x52A0;&#x9610;&#x91CA;&#xFF0C;&#x53EA;&#x662F;&#x544A;&#x8BEB;&#x8BFB;&#x8005;&#x4E0D;&#x8981;&#x7528;&#x5168;&#x5C40;&#x53D8;&#x91CF;(global variable)&#x3002;&#x6211;&#x731C;&#x4F5C;&#x8005;&#x7684;&#x610F;&#x601D;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x7528;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x5C31;&#x7528;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x7C7B;&#x5BF9;&#x8C61;&#x5427;&#x3002;Chapter 31. Refactoring&#x5728;TDD&#x4E2D;&#xFF0C;&#x91CD;&#x6784;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#xFF0C;&#x4FDD;&#x8BC1;&#x6240;&#x6709;&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x964D;&#x4F4E;&#x91CD;&#x590D;&#xFF08;code&#x4E4B;&#x95F4;&#xFF0C;code&#x4E0E;test&#x4E4B;&#x95F4;&#xFF09;&#x3002;Reconcile DifferencesHow do you unify two similar looking pieces of code? Gradually bring them closer. Unify them only when they are absolutely identical. &#x4E0D;&#x8981;&#x5F3A;&#x5236;&#x6574;&#x5408;&#xFF0C;&#x7B49;&#x4ED6;&#x4EEC;&#x5B8C;&#x5168;&#x76F8;&#x7B49;&#x4E86;&#x518D;&#x8BF4;Such a leap-of-faith refactoring is exactly what we&#x2019;re trying to avoid with our strategy of small steps and concrete feedback. Although you can&#x2019;t always avoid leapy refactorings, you can reduce their incidence. &#x4E0D;&#x8981;&#x505A;&#x8DE8;&#x8D8A;&#x5F0F;&#x7684;&#x91CD;&#x6784;&#x3002;Sometimes you need to approach reconciling differences backward&#x2014;that is, think about how the last step of the change could be trivial, then work backward. &#x53CD;&#x5411;&#x601D;&#x8003;&#xFF0C;&#x5C3D;&#x91CF;&#x8BA9;&#x6BCF;&#x4E00;&#x6B65;&#x90FD;&#x975E;&#x5E38;&#x5C0F;(trivial)&#xFF0C;&#x8FD9;&#x6837;&#x65B9;&#x4FBF;&#x56DE;&#x9000;&#x3002;Isolate Change&#x9694;&#x79BB;&#x6539;&#x52A8;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x505A;&#x7684;&#x4E00;&#x4E9B;&#x62BD;&#x8C61;&#x5C01;&#x88C5;&#x3002;&#x628A;&#x53D8;&#x5316;&#x7684;&#x90E8;&#x5206;&#x7528;&#x63A5;&#x53E3;&#x5305;&#x88C5;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x8FBE;&#x5230;&#x4E86;&#x9694;&#x79BB;&#x7684;&#x6548;&#x679C;&#x3002;Some possible ways to isolate change are Extract Method (the most common), Extract Object, and Method Object.Migrate Data&#x4E0D;&#x77E5;&#x6240;&#x4E91;Extract MethodHow do you make a long, complicated method easier to read? Turn a small part of it into a separate method and call the new method. &#x5C06;&#x4E00;&#x4E2A;&#x5927;&#x51FD;&#x6570;&#x6253;&#x788E;&#xFF0C;&#x4ECE;&#x4E2D;&#x63D0;&#x53D6;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#x51FA;&#x6765;&#x3002;HowFind a region of the method that would make sense as its own method. Bodies of loop, whole loops, and branches of conditionals are common candidates for extraction.Make sure that there are no assignments to temporary variables declared outside the scope of the region to be extracted.Copy the code from the old method to the new method. Compile it.For each temporary variable or parameter of the original method used in the new method, add a parameter to the new method.Call the new method from the original method.Why&#x589E;&#x5F3A;&#x53EF;&#x8BFB;&#x6027;&#x6D88;&#x9664;&#x91CD;&#x590D;&#xFF0C;&#x5F53;&#x4F60;&#x53D1;&#x73B0;&#x6709;&#x4E24;&#x4E2A;&#x5927;&#x51FD;&#x6570;&#xFF0C;&#x6709;&#x4E00;&#x90E8;&#x5206;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x90A3;&#x5C31;&#x53EF;&#x4EE5;&#x63D0;&#x53D6;&#x51FA;&#x6765;&#x79F0;&#x4E3A;&#x65B0;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x901A;&#x8FC7;inline&#x628A;&#x4E00;&#x5806;&#x51FD;&#x6570;&#x653E;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x7136;&#x540E;&#x770B;&#x770B;&#x54EA;&#x91CC;&#x53EF;&#x4EE5;extract &#xFF08;&#x8FD9;&#x4E00;&#x70B9;&#x6211;&#x611F;&#x89C9;&#x5E94;&#x8BE5;&#x653E;&#x5728;How&#x91CC;&#x9762;&#xFF0C;&#x4F5C;&#x8005;&#x662F;&#x60F3;&#x627F;&#x4E0A;&#x542F;&#x4E0B;&#xFF0C;&#x5C06;inline&#x5427;&#xFF09;Inline Methodinline&#x5F88;&#x7384;&#x4E4E;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x628A;&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x590D;&#x5236;&#x5230;&#x8C03;&#x7528;&#x7684;&#x5730;&#x65B9;&#x3002;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x4F5C;&#x8005;&#x6709;&#x8BDD;&#x8BF4;&#xFF1A;You might like the second version better, or you might not. The point to note here is that you can use Inline Method to play around with the flow of control. &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8BA9;&#x4F60;&#x628A;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#x7684;&#x4E1C;&#x897F;&#x653E;&#x5230;&#x4E00;&#x8D77;&#x91CD;&#x65B0;&#x62BD;&#x8C61;&#xFF0C;&#x770B;&#x770B;&#x4F1A;&#x4E0D;&#x4F1A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x91CD;&#x6784;&#x7684;&#x65B9;&#x6CD5;&#x3002;Extract InterfaceHow&#x5982;&#x4F55;&#x5C06;&#x4E00;&#x4E2A;&#x7C7B;&#x62BD;&#x8C61;&#x6210;&#x4E00;&#x4E2A;interface&#x3002;&#x6240;&#x8C13;&#x7684;interface&#x5C31;&#x662F;&#x53EA;&#x6709;&#x7EAF;&#x865A;&#x51FD;&#x6570;&#x7684;&#x7C7B;&#x3002;Declare an interface. Sometimes the name of the existing class should be the name of the interface, in which case you should first rename the class.Have the existing class implement the interface.Add the necessary methods to the interface, expanding the visibility of the methods in the class if necessary.Change type declarations from the class to the interface where possible.Why&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x4E86;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x62BD;&#x8C61;&#x51FA;&#x7236;&#x7C7B;&#x65F6;&#x5F53;&#x4F60;&#x7528;&#x4E86;Mock Object&#xFF0C;&#x73B0;&#x5728;&#x8981;&#x4E3A;&#x8FD9;&#x4E2A;mock object&#x62BD;&#x8C61;&#x51FA;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x63A5;&#x53E3;&#x65F6;&#x3002;&#x4F5C;&#x8005;&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5C0F;&#x6280;&#x5DE7;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x547D;&#x540D;&#x662F;&#x4E00;&#x4E2A;&#x5934;&#x75BC;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4E0D;&#x59A8;&#x5C31;&#x628A;&#x65B0;&#x7684;interface&#x79F0;&#x4E3A;IXXX&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x539F;&#x6765;&#x7684;&#x53EB;File&#xFF0C;&#x65B0;&#x7684;&#x63A5;&#x53E3;&#x5C31;&#x79F0;&#x4E3A;IFileMove Method&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x628A;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x79FB;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7C7B;&#x91CC;&#x9762;&#x3002;&#x4F46;&#x4F5C;&#x8005;&#x63D0;&#x5230;&#x4E86;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0D;&#x9002;&#x7528;&#x3002;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4FEE;&#x6539;&#x4E86;&#x539F;&#x5148;&#x90A3;&#x4E2A;&#x7C7B;&#x7684;&#x6570;&#x636E;&#x3002;Method Object&#x8FD9;&#x4E2A;&#x8BDD;&#x9898;&#x597D;&#x50CF;&#x5F88;&#x65B0;&#x9C9C;&#xFF0C;&#x4E4B;&#x524D;&#x770B;&#x5230;&#x8FC7;&#x5F88;&#x591A;&#x6B21;&#xFF0C;&#x4F46;&#x5E76;&#x6CA1;&#x6709;&#x6DF1;&#x7A76;&#x3002;&#x5148;&#x770B;&#x770B;How&#xFF1A;HowCreate an object with the same parameters as the method.Make the local variables also instance variables of the object.Create one method called run(), whose body is the same as the body of the original method.In the original method, create a new object and invoke run().&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5904;&#xFF1F;Why&#x4E24;&#x4E2A;&#x597D;&#x5904;&#x5728;&#x6DFB;&#x52A0;&#x590D;&#x6742;&#x903B;&#x8F91;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5BF9;&#x4E00;&#x4E2A;&#x8FC7;&#x7A0B;&#x6709;&#x591A;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5BF9;&#x8C61;&#xFF0C;&#x518D;&#x6269;&#x5C55;&#x8D77;&#x6765;&#x5C31;&#x5F88;&#x7B80;&#x5355;&#x5728;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x51FD;&#x6570;&#x91CC;extract interface&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x4E00;&#x6BB5;code&#x9700;&#x8981;5&#xFF0C;6&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x867D;&#x7136;&#x51FD;&#x6570;&#x62BD;&#x53D6;&#x51FA;&#x6765;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5199;&#x6CD5;&#x5E76;&#x6CA1;&#x6709;&#x7B80;&#x5316;&#x591A;&#x5C11;&#x3002;&#x8FD9;&#x65F6;&#x5019;&#x5982;&#x679C;&#x6709;&#x65B9;&#x6CD5;&#x5BF9;&#x8C61;&#xFF0C;&#x5219;&#x5728;&#x7C7B;&#x91CC;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#xFF0C;&#x4F1A;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x4FBF;&#x5229;&#x3002;Add Parameter&#x5C31;&#x662F;&#x52A0;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x6CA1;&#x4EC0;&#x4E48;&#x7279;&#x522B;&#x7684;Method Parameter to Constructor Parameter&#x5C31;&#x662F;&#x628A;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x53D8;&#x6210;&#x7C7B;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF1F;If you pass the same parameter to several different methods in the same object, then you can simplify the API by passing the parameter once (eliminating duplication). You can run this refactoring in reverse if you find that an instance variable is used in only one method.&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7B80;&#x5355;&#x5B9E;&#x7528;&#x3002;Chapter 32. Mastering TDD&#x7ECF;&#x8FC7;31&#x7AE0;&#x7684;&#x5B66;&#x4E60;&#xFF0C;&#x4F5C;&#x8005;&#x8BA4;&#x4E3A;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B8C;&#x5B8C;&#x5168;&#x5168;&#x6709;&#x80FD;&#x529B;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x683C;&#x7684;TDD&#x7A0B;&#x5E8F;&#x5458;&#x4E86;&#x3002;&#x5728;&#x8FD9;&#x4E00;&#x7AE0;&#x91CC;&#xFF0C;&#x4F5C;&#x8005;&#x53C8;&#x603B;&#x7ED3;&#x51FA;&#x5F88;&#x591A;TDD&#x521D;&#x5B66;&#x8005;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x7ED9;&#x4E88;&#x56DE;&#x7B54;&#x3002;&#x7B54;&#x6848;&#x90FD;&#x662F;&#x4E00;&#x4E9B;&#x5F88;&#x5B9E;&#x7528;&#x7684;&#x5FE0;&#x544A;&#xFF0C;&#x7279;&#x6458;&#x53D6;&#x5982;&#x4E0B;&#x3002;What don&#x2019;t you have to test?&#x4F5C;&#x8005;&#x5E76;&#x6CA1;&#x6709;&#x76F2;&#x76EE;&#x5F3A;&#x8C03;&#x6D4B;&#x8BD5;&#x91CD;&#x8981;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x8BF4;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#x90FD;&#x8981;&#x5199;&#x6D4B;&#x8BD5;&#x3002;&#x4F5C;&#x8005;&#x8BF4;&#xFF1A;Unless you have reason to distrust it, don&#x2019;t test code from others. &#x201C;Write tests until fear is transformed into boredom.&#x201D;&#x53EA;&#x5728;&#x4F60;&#x4E0D;&#x76F8;&#x4FE1;&#x4F60;&#x7684;code&#x65F6;&#xFF0C;&#x5BF9;&#x4ED6;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;&#x6D4B;&#x8BD5;&#x4E5F;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#x800C;&#x6D4B;&#x8BD5;&#xFF0C;&#x6216;&#x8005;&#x4E3A;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x5065;&#x58EE;&#xFF0C;&#x6D4B;&#x8BD5;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x4F60;&#x7684;&#x7126;&#x8651;&#x3002;&#x8BA9;&#x4F60;&#x4E0D;&#x8981;&#x4ECE;&#x62C5;&#x5FC3;&#x53D8;&#x6210;&#x70E6;&#x8E81;&#xFF0C;&#x4EC5;&#x6B64;&#x800C;&#x5DF2;&#x3002; &#x54CE;&#xFF01;&#x771F;&#x662F;&#x918D;&#x9190;&#x704C;&#x9876;&#xFF01;&#x76F8;&#x89C1;&#x6068;&#x665A;&#xFF01;How do you know if you have good tests?&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x6D4B;&#x8BD5;&#x4E0D;&#x597D;&#xFF1F;Long setup code. &#x5982;&#x679C;&#x4E3A;&#x4E86;&#x505A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x53EF;&#x80FD;&#x53EA;&#x6709;&#x51E0;&#x884C;&#x65AD;&#x8A00;&#xFF0C;&#x800C;&#x4E3A;&#x6B64;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5DE8;&#x5927;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x8BF4;&#x660E;&#x54EA;&#x91CC;&#x80AF;&#x5B9A;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#x3002;Setup duplication. &#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;&#x6709;&#x51E0;&#x4E2A;&#x6D4B;&#x8BD5;&#x62E5;&#x6709;&#x76F8;&#x540C;&#x6216;&#x76F8;&#x4F3C;&#x7684;setup&#x4EE3;&#x7801;&#xFF0C;&#x90A3;&#x8BF4;&#x660E;&#x4F60;&#x7684;&#x6D4B;&#x8BD5;&#x4E2D;&#x6709;&#x91CD;&#x590D;&#x7684;&#x5730;&#x65B9;&#x3002;Long running tests. TDD tests that run a long time won&#x2019;t be run often. Suites that take longer than ten minutes inevitably get trimmed. &#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x5957;&#x4EF6;&#x4E0D;&#x8981;&#x8D85;&#x8FC7;&#x5341;&#x5206;&#x949F;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x53CD;&#x590D;&#x8FD0;&#x884C;&#x7684;&#x673A;&#x4F1A;&#x5C31;&#x4F1A;&#x6025;&#x5267;&#x964D;&#x4F4E;&#x3002;Fragile tests. Tests that break unexpectedly suggest that one part of the application is surprisingly affecting another part. &#x5982;&#x679C;&#x6D4B;&#x8BD5;&#x88AB;&#x65E0;&#x60C5;&#x6253;&#x65AD;&#xFF0C;&#x8BF4;&#x660E;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x91CC;&#x6709;&#x8026;&#x5408;&#x3002;How does TDD lead to frameworks?&#x53C8;&#x88AB;&#x918D;&#x9190;&#x704C;&#x9876;&#x4E86;&#xFF01;TDD appears to stand this advice on its head: &#x201C;Code for tomorrow, design for today.&#x201D; Here&#x2019;s what happens in practice. &#x4E0D;&#x8981;&#x4E3A;&#x672A;&#x6765;&#x8003;&#x8651;&#x90A3;&#x4E48;&#x591A;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x8BA9;&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#xFF0C;&#x7136;&#x540E;&#x53CA;&#x65F6;&#x7684;&#x505A;&#x91CD;&#x6784;&#x6D88;&#x9664;&#x91CD;&#x590D;&#xFF0C;&#x53CD;&#x800C;&#x80FD;&#x8FBE;&#x5230;&#x66F4;&#x597D;&#x7684;&#x8BBE;&#x8BA1;&#x6846;&#x67B6;&#xFF08;frameworks&#xFF09;&#x3002;How much feedback do you need?&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x76F4;&#x5F3A;&#x8C03;&#x7684;&#x601D;&#x60F3;&#x5F88;&#x4E00;&#x81F4;If our knowledge of the implementation gives us confidence even without a test, then we will not write that test. When should you delete tests?The first criterion for your tests is confidence. Never delete a test if it reduces your confidence in the behavior of the system.The second criterion is communication. If you have two tests that exercise the same path through the code, but they speak to different scenarios for a reader, leave them alone.Can you drive development with application-level tests?&#x4E0D;&#x8981;&#x5C1D;&#x8BD5;&#x505A;&#x5E94;&#x7528;&#x7EA7;&#x522B;&#x7684;testHow do you switch to TDD midstream?&#x8FD9;&#x4E5F;&#x662F;&#x6211;&#x60F3;&#x95EE;&#x7684;&#xFF0C;&#x4F5C;&#x8005;&#x7684;&#x56DE;&#x7B54;&#x662F;&#x8FD9;&#x672C;&#x4E66;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x8FD9;&#x4E2A;&#x800C;&#x5199;&#x7684;&#x3002;There is a whole book (or books) to be written about switching to TDD when you have lots of code. What follows is necessarily only a teaser.&#x600E;&#x4E48;&#x505A;&#xFF1F;So first we have to decide to limit the scope of our changes. Second, we have to break the deadlock between tests and refactoring. &#x600E;&#x4E48;&#x83B7;&#x5F97;feedback 1) We can get feedback other ways than with tests, like working very carefully and with a partner. 2) We can get feedback at a gross level, like system-level tests that we know aren&#x2019;t adequate but give us some confidence. With this feedback, we can make the areas we have to change more accepting of change.How does TDD relate to the practices of Extreme Programming?&#x540D;&#x8BCD;&#x89E3;&#x91CA;&#xFF1A;Extreme Programming - XP&#x6781;&#x9650;&#x7F16;&#x7A0B;&#x6781;&#x9650;&#x7F16;&#x7A0B;&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x3001;&#x7075;&#x5DE7;&#x7684;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x65B9;&#x6CD5;&#xFF1B;&#x540C;&#x65F6;&#x5B83;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x4E25;&#x8C28;&#x548C;&#x5468;&#x5BC6;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x7684;&#x57FA;&#x7840;&#x548C;&#x4EF7;&#x503C;&#x89C2;&#x662F;&#x4EA4;&#x6D41;&#x3001;&#x6734;&#x7D20;&#x3001;&#x53CD;&#x9988;&#x548C;&#x52C7;&#x6C14;&#xFF1B;&#x5373;&#xFF0C;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8F6F;&#x4EF6;&#x9879;&#x76EE;&#x90FD;&#x53EF;&#x4EE5;&#x4ECE;&#x56DB;&#x4E2A;&#x65B9;&#x9762;&#x5165;&#x624B;&#x8FDB;&#x884C;&#x6539;&#x5584;&#xFF1A;&#x52A0;&#x5F3A;&#x4EA4;&#x6D41;&#xFF1B;&#x4ECE;&#x7B80;&#x5355;&#x505A;&#x8D77;&#xFF1B;&#x5BFB;&#x6C42;&#x53CD;&#x9988;&#xFF1B;&#x52C7;&#x4E8E;&#x5B9E;&#x4E8B;&#x6C42;&#x662F;&#x3002;XP&#x662F;&#x4E00;&#x79CD;&#x8FD1;&#x87BA;&#x65CB;&#x5F0F;&#x7684;&#x5F00;&#x53D1;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x5C06;&#x590D;&#x6742;&#x7684;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x5206;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x4E2A;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x5C0F;&#x5468;&#x671F;&#xFF1B;&#x901A;&#x8FC7;&#x79EF;&#x6781;&#x7684;&#x4EA4;&#x6D41;&#x3001;&#x53CD;&#x9988;&#x4EE5;&#x53CA;&#x5176;&#x5B83;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x548C;&#x5BA2;&#x6237;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x6E05;&#x695A;&#x5F00;&#x53D1;&#x8FDB;&#x5EA6;&#x3001;&#x53D8;&#x5316;&#x3001;&#x5F85;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x548C;&#x6F5C;&#x5728;&#x7684;&#x56F0;&#x96BE;&#x7B49;&#xFF0C;&#x5E76;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x53CA;&#x65F6;&#x5730;&#x8C03;&#x6574;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x3002;TDD&#x4E0E;XP&#x7684;&#x5171;&#x901A;&#x4E4B;&#x5904;&#xFF1A;PairingWork freshContinuous integrationSimple designRefactoringContinuous delivery%23Test-Driven%20Development%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5BProgramming%2C%20TDD%5D%0A%0A%5BTOC%5D%0A%0A%u6700%u8FD1%u5728%u8BFBKent%20Beck%u7684%u300ATest-Driven%20Development%20By%20Example%u300B%uFF0C%u8BA9%u6211%u5BF9%u8F6F%u4EF6%u5F00%u53D1%u6709%u4E86%u65B0%u7684%u8BA4%u8BC6%u3002%0A%3E%u5199test%u5E76%u4E0D%u4E3A%u4E86%u6D4B%u8BD5%u800C%u6D4B%u8BD5%uFF0C%u662F%u4E3A%u4E86%u589E%u5F3A%u5BF9%u7A0B%u5E8F%u7684%u4FE1%u5FC3%uFF0C%u51CF%u5C11%u7126%u8651%u3002%u90A3%u4E48%u5982%u4F55%u51CF%u5C11%u7126%u8651%u5462%uFF0C%u662F%u901A%u8FC7%u4E00%u6B21%u53EA%u5173%u5FC3%u4E00%u4EF6%u4E8B%u60C5%u3002%u5982%u4F55%u4E00%u6B21%u53EA%u5173%u5FC3%u4E00%u4EF6%u4E8B%u60C5%uFF0C%u8FD9%u5C31%u662FTDD%u3002%0A%0A%u672C%u4E66%u5206%u4E09%u4E2A%u90E8%u5206%0A1.%20The%20Money%20Example%0A2.%20The%20xUnit%20Example%0A3.%20Patterns%20for%20Test-Driven%20Development%0A%u524D%u4E24%u4E2A%u90E8%u5206%u8BB2%u4E86%u4E24%u4E2A%u4F8B%u5B50%uFF0C%u6765%u9610%u8FF0%u5982%u4F55%u8FDB%u884CTDD%u5F00%u53D1%uFF0C%u6700%u540E%u4E00%u4E2A%u90E8%u5206%u7B97%u662F%u603B%u7ED3%uFF0C%u5168%u4E66%u7684%u7CBE%u534E%u6240%u5728%u3002%u672C%u6587%u4E0D%u6253%u7B97%u8BB2%u8FD9%u4E24%u4E2A%u4F8B%u5B50%u4E86%uFF0C%u56E0%u4E3A%u4F8B%u5B50%u6700%u597D%u81EA%u5DF1%u624B%u5199%u4E00%u904D%uFF0C%u624D%u53EF%u4EE5%u52A0%u6DF1%u4E86%u89E3%u3002%u672C%u6587%u4E3B%u8981%u6458%u5F55%u4E00%u4E9BTDD%u7684%u6A21%u5F0F%u65B9%u6CD5%28pattern%29%u3002%0A%0A%u4E0B%u9762%u8FD9%u6BB5%u8BDD%u6765%u81EA%u7B2C%u4E00%u7AE0%uFF0C%u63D0%u7EB2%u6308%u9886%uFF1A%0A%3EMy%20goal%20is%20for%20you%20to%20see%20the%20rhythm%20of%20Test-Driven%20Development%20%28TDD%29%2C%20which%20can%20be%20summed%20up%20as%20follows.%0A%3E%201.%20Quickly%20add%20a%20test.%0A%3E%202.%20Run%20all%20tests%20and%20see%20the%20new%20one%20fail.%0A%3E%203.%20Make%20a%20little%20change.%0A%3E%204.%20Run%20all%20tests%20and%20see%20them%20all%20succeed.%0A%3E%205.%20Refactor%20to%20remove%20duplication.%0A%0A%3EThe%20surprises%20are%20likely%20to%20include.%0A%3E%20*%20How%20each%20test%20can%20cover%20a%20**small%20increment**%20of%20functionality.%0A%3E%20*%20How%20**small%20and%20ugly%20the%20changes**%20can%20be%20to%20make%20the%20new%20tests%20run.%0A%3E%20*%20How%20often%20the%20tests%20are%20run.%0A%3E%20*%20How%20many%20teensy-weensy%20steps%20make%20up%20the%20refactorings.%0A%0A%u8FD9%u5C31%u662FTDD%u7684%u7CBE%u9AD3%u3002%u6309%u4F5C%u8005%u7684%u8BF4%u6CD5%u5C31%u662F%60Green/Red/Green/Refactor%60%u8282%u594F%u3002%0A%u8FD9%u4E5F%u56DE%u7B54%u4E86%u6211%u4E00%u76F4%u4EE5%u6765%u7684%u56F0%u6270%uFF0C%u5230%u5E95%u5E94%u8BE5%u5982%u4F55%u8BBE%u8BA1%u4E00%u6BB5%u7A0B%u5E8F%uFF0C%u5230%u5E95%u8981%u8003%u8651%u591A%u5C11%u79CD%u60C5%u51B5%u3002%u6309%u7167TDD%u7684%u5EFA%u8BAE%u5C31%u662F%uFF0C%u9996%u5148%u5199%u6D4B%u8BD5%uFF0C%u7136%u540E%u4EE3%u7801%u600E%u4E48%u5FEB%u600E%u4E48%u6765%uFF0C%u4E0D%u7BA1%u6709%u591Augly%uFF0C%u7136%u540E%u5982%u679C%u53D1%u73B0%u91CD%u590D%uFF0C%u53CA%u65F6%u505A%u91CD%u6784%u3002%u4E0D%u8981%u8003%u8651%u4EC0%u4E48%u6269%u5C55%u6027%u4E4B%u7C7B%u7684%uFF0C%u8FD9%u4E2A%u8BBE%u8BA1%u65B9%u5F0F%u672C%u8EAB%u5C31%u80FD%u63D0%u4F9B%u3002%u56E0%u4E3A%u5B83%u63D0%u9AD8%u4E86%u8FD0%u884C%u6D4B%u8BD5%u548C%u91CD%u6784%u7684%u9891%u7387%uFF0C%u65E2%u63D0%u5347%u4E86%u7F16%u7801%u8005%u5BF9%u7A0B%u5E8F%u7684%u4FE1%u5FC3%uFF0C%u4E5F%u964D%u4F4E%u4E86%u4E0D%u5408%u7406%u8BBE%u8BA1%u7684%u53EF%u80FD%u6027%u3002%0A%0A%23%23Chapter%2025.%20Test-Driven%20Development%20Patterns%0A%u4E66%u4E2D%u5F15%u5165%u4E86%u5F88%u591A%u5F71%u50CF%u56FE%28Influence%20Diagram%29%uFF0C%u5F88%u5F62%u8C61%u7684%u8BF4%u660E%u4E86%uFF0C%u5F15%u5165TDD%u80FD%u7ED9%u6211%u4EEC%u65E5%u5E38%u7684%u5F00%u53D1%u5DE5%u4F5C%u5F15%u5165%u4EC0%u4E48%u597D%u5904%u3002%0A%21%5BAlt%20text%5D%28./1455616022147.png%29%0A%3EThis%20is%20a%20positive%20feedback%20loop.%20%0A%3E-%20The%20more%20stress%20you%20feel%2C%20the%20less%20testing%20you%20will%20do.%20%0A%3E-%20The%20less%20testing%20you%20do%2C%20the%20more%20errors%20you%20will%20make.%20%0A%3E-%20The%20more%20errors%20you%20make%2C%20the%20more%20stress%20you%20feel.%20%0A%3E-%20Rinse%20and%20repeat.%0A%0A%23%23%23Isolated%20Test%0A%u80FD%u5C06%u5927%u5757%u7684%u6D4B%u8BD5%u5206%u5272%u6210%u677E%u8026%u5408%u7684%u5C0F%u6D4B%u8BD5%u4E0D%u5BB9%u6613%uFF0C%u4F46%u662F%u597D%u5904%u5927%u5927%u7684%u3002%u4F5C%u8005%u8BF4%uFF1A%0A%3EI%20never%20knew%20exactly%20how%20to%20achieve%20high%20cohesion%20and%20loose%20coupling%20regularly%20until%20I%20started%20writing%20isolated%20tests.%0A%23%23%23Test%20List%0A%u6211%u4EEC%u8981%u600E%u4E48%u5F00%u59CBTDD%u5462%uFF1F%u4F5C%u8005%u7ED9%u51FA%u4E86%u5F88%u5177%u64CD%u4F5C%u6027%u7684%u5EFA%u8BAE%uFF1A%0A%3EBefore%20you%20begin%2C%20write%20a%20list%20of%20all%20the%20tests%20you%20know%20you%20will%20have%20to%20write.%0A%u8FD9%u4E2Alist%u4E0A%u5199%u70B9%u4EC0%u4E48%u5462%uFF1F%0A%3E%201.%20Put%20on%20the%20list%20examples%20of%20every%20operation%20that%20you%20know%20you%20need%20to%20implement.%20%u8981%u54EA%u4E9B%u64CD%u4F5C%u3002%0A%3E%202.%20for%20those%20operations%20that%20don%27t%20already%20exist%2C%20put%20the%20null%20version%20of%20that%20operation%20on%20the%20list.%u54EA%u4E9B%u64CD%u4F5C%u6CA1%u5B9E%u73B0%uFF0C%u5199%u4E0A%u5B58%u6839%u3002%0A%3E%203.%20List%20all%20of%20the%20refactorings%20that%20you%20think%20you%20will%20have%20to%20do%20in%20order%20to%20have%20clean%20code%20at%20the%20end%20of%20this%20session.%20%u5B8C%u6210%u4E4B%u540E%uFF0C%u5217%u51FA%u9700%u8981%u91CD%u6784%u7684%u5730%u65B9%u3002%u800C%u5982%u679C%u6709%u5927%u7684%u91CD%u6784%u7684%u9700%u8981%u65F6%uFF0C%u653E%u5230later%20list%u91CC%u9762%uFF0C%u628A%u624B%u91CC%u7684%u4E8B%u60C5%u5904%u7406%u5B8C%uFF0C%u518D%u53BB%u5904%u7406%u5927%u7684%u91CD%u6784%u3002%0A%0A%u770B%u4F5C%u8005%u65F6%u523B%u5728%u5F3A%u8C03TDD%u5C31%u662Ftiny%20steps%uFF1A%0A%3E%20The%20pure%20form%20of%20TDD%2C%20wherein%20you%20are%20never%20more%20than%20one%20change%20away%20from%20a%20green%20bar%2C%20is%20like%20that%20three-out-of-four%20rule.%0A%23%23%23Test%20First%0A%u4EC0%u4E48%u65F6%u5019%u5199%u6D4B%u8BD5%uFF1F%0A%u7B54%uFF1A%u5728%u5199code%u4E4B%u524D%uFF0C%u56E0%u4E3A%u4E00%u65E6%u4F60%u5F00%u59CB%u5199code%uFF0C%u4F60%u53EF%u80FD%u5C31%u8EAB%u9677%u6CE5%u6F6D%uFF0C%u65E0%u6687%u987E%u53CAtest%20case%u4E86%u3002%0A%0A%23%23Chapter%2026.%20Red%20Bar%20Patterns%0A%23%23%23One%20Step%20Test%0A%3EEach%20test%20should%20represent%20one%20step%20toward%20your%20overall%20goal.%0A%23%23%23Starter%20Test%0A%u5982%u4F55%u5F00%u59CB%u5199%u6D4B%u8BD5%uFF1F%u4E0D%u8981%u4E00%u5F00%u59CB%u5C31%u60F3%u5199%u4E00%u4E2A%u771F%u6B63%u7684%u6D4B%u8BD5%uFF0C%u56E0%u4E3A%u8FD9%u6837%u4F1A%u4E00%u6B21%u9762%u5BF9%u592A%u591A%u7684%u95EE%u9898%u3002%u4F5C%u8005%u5EFA%u8BAE%u5C1D%u8BD5%u4ECE%u4E00%u4E2A%u7B80%u5355%u7684%u6D4B%u8BD5%u8F93%u5165%u8F93%u51FA%u5F00%u59CB%u3002%u8FD9%u6837%u4EE5%u4FBF%u4E8E%u4F60%u4ECEGreenxun%u8FC5%u901F%u5F00%u59CB%u4F60%u7684Green/Red/Green/Refactor%u8282%u594F%u3002%u4F5C%u8005%u4E3E%u4E86%u4E00%u4E2A%u4EA7%u751F%u591A%u8FB9%u5F62%u7684%u4F8B%u5B50%uFF1A%0A%60%60%60%20java%0AReducer%20r%3D%20new%20Reducer%28new%20Polygon%28%29%29%3B%20%0AassertEquals%280%2C%20reducer.result%28%29.npoints%29%3B%0A%60%60%60%0A%u4E0D%u592A%u61C2%u8FD9%u4E2A%u95EE%u9898%uFF0C%u4E0D%u8FC7%u53EF%u4EE5%u4ECE%u4E2D%u770B%u51FA%u4F5C%u8005%u5BF9TDD%u7684%u89E3%u91CA%u3002%u95EE%u9898%u672C%u8EAB%u662F%u8981%u89E3%u4E00%u4E2A%u964D%u4F4E%u591A%u8FB9%u5F62%u8FB9%u6570%u7684%u95EE%u9898%u3002%u4F5C%u8005%u7684%u542F%u52A8%u6D4B%u8BD5%u5C31%u662F%u4E00%u4E2A%u201C0%u201D%u8FB9%u591A%u8FB9%u5F62%uFF0C%u90A3%u7ED3%u679C%u4E00%u5B9A%u662F%220%22%u8FB9%u591A%u8FB9%u5F62%u3002%u5BF9%u5B9E%u9645%u610F%u4E49%u5F88%u8352%u8BDE%uFF0C%u4F46%u5BF9%u6D4B%u8BD5%u6765%u8BF4%u662F%u4E00%u4E2A%u4E0D%u9519%u7684%u5F00%u59CB%u3002%u7B26%u5408%u6211%u4EEC%u7684%u9884%u671F%uFF0C%u7B80%u5355%u800C%u4E14%u53C8%60represent%20one%20step%20toward%20your%20overall%20goal%60%u3002%0A%23%23%23Explanation%20Test%0A%u8FD9%u4E00%u7AE0%u662F%u5728%u8BF4%u5982%u4F55%u4E0D%u7528%u5F3A%u8FEB%u7684%u624B%u6BB5%u8BA9%u975ETDD%u7684%u56E2%u961F%u6210%u5458%u80FD%u8F6C%u5411TDD%u3002%u5F53%u5F00%u53D1%u8005%u5411%u4F60%u89E3%u91CA%u4ED6%u7684%u7A0B%u5E8F%u65F6%uFF0C%u4F60%u90FD%u53EF%u4EE5%u5C06%u4E4B%u8F6C%u5316%u4E3Atest%20case%u3002%0A%u672C%u4E66%u8FD8%u6709%u4E00%u4E2A%u5F88%u6709%u7279%u8272%u7684%u5730%u65B9%u662F%uFF0C%u8D2F%u7A7F%u5168%u6587%uFF0C%u4F5C%u8005%u603B%u662F%u5728%u7ECF%u610F%u4E0D%u7ECF%u610F%u95F4%u6D41%u9732%u7740%u5404%u79CD%u5B9D%u8D35%u7684%u5DE5%u4F5C%u7ECF%u9A8C%uFF1A%u5982%u4F55%u957F%u671F%u4FDD%u6301%u66F4%u9AD8%u6548%u7684%u7F16%u7A0B%uFF1F%u5982%u679C%u4F60%u662F%u7ECF%u7406%uFF0C%u4F60%u5982%u4F55%u4E0E%u4F60%u7684%u56E2%u961F%u6210%u5458%u4E00%u8D77%u5DE5%u4F5C%uFF1F%u7B49%u7B49%u3002%u8FD9%u4E00%u7AE0%u5C31%u6709%u8FD9%u6837%u4E00%u53E5%u8BDD%uFF1A%0A%3EIf%20you%27re%20a%20manager%20or%20a%20leader%2C%20you%20can%27t%20force%20anyone%20to%20change%20the%20way%20they%20work.%0A%3EWhat%20can%20you%20do%3F%20A%20simple%20start%20is%20to%20start%20asking%20for%20explanations%20in%20terms%20of%20test%20cases%3A%20%22Let%20me%20see%20if%20I%20understand%20what%20you%27re%20saying.%0A%0A%23%23%23Learning%20Test%0A%u8FD9%u4E00%u7AE0%u8BB2%u4E86%u6D4B%u8BD5%u9A71%u52A8%u5F00%u53D1%u9488%u5BF9%u96C6%u6210%u7B2C%u4E09%u65B9%u5E93%u7684%u4F18%u52BF%u3002%0A%23%23%23Regression%20Test%0A%3E**%u56DE%u5F52%u6D4B%u8BD5**%u662F%u6307%u4FEE%u6539%u4E86%u65E7%u4EE3%u7801%u540E%uFF0C%u91CD%u65B0%u8FDB%u884C%u6D4B%u8BD5%u4EE5%u786E%u8BA4%u4FEE%u6539%u6CA1%u6709%u5F15%u5165%u65B0%u7684%u9519%u8BEF%u6216%u5BFC%u81F4%u5176%u4ED6%u4EE3%u7801%u4EA7%u751F%u9519%u8BEF%u3002%0A%3E%u81EA%u52A8%u56DE%u5F52%u6D4B%u8BD5%u5C06%u5927%u5E45%u964D%u4F4E%u7CFB%u7EDF%u6D4B%u8BD5%u3001%u7EF4%u62A4%u5347%u7EA7%u7B49%u9636%u6BB5%u7684%u6210%u672C%u3002%u56DE%u5F52%u6D4B%u8BD5%u4F5C%u4E3A%u8F6F%u4EF6%u751F%u547D%u5468%u671F%u7684%u4E00%u4E2A%u7EC4%u6210%u90E8%u5206%uFF0C%u5728%u6574%u4E2A%u8F6F%u4EF6%u6D4B%u8BD5%u8FC7%u7A0B%u4E2D%u5360%u6709%u5F88%u5927%u7684%u5DE5%u4F5C%u91CF%u6BD4%u91CD%uFF0C%u8F6F%u4EF6%u5F00%u53D1%u7684%u5404%u4E2A%u9636%u6BB5%u90FD%u4F1A%u8FDB%u884C%u591A%u6B21%u56DE%u5F52%u6D4B%u8BD5%u3002%u5728%u6E10%u8FDB%u548C%u5FEB%u901F%u8FED%u4EE3%u5F00%u53D1%u4E2D%uFF0C%u65B0%u7248%u672C%u7684%u8FDE%u7EED%u53D1%u5E03%u4F7F%u56DE%u5F52%u6D4B%u8BD5%u8FDB%u884C%u7684%u66F4%u52A0%u9891%u7E41%uFF0C%u800C%u5728%u6781%u7AEF%u7F16%u7A0B%u65B9%u6CD5%u4E2D%uFF0C%u66F4%u662F%u8981%u6C42%u6BCF%u5929%u90FD%u8FDB%u884C%u82E5%u5E72%u6B21%u56DE%u5F52%u6D4B%u8BD5%u3002%u56E0%u6B64%uFF0C%u901A%u8FC7%u9009%u62E9%u6B63%u786E%u7684%u56DE%u5F52%u6D4B%u8BD5%u7B56%u7565%u6765%u6539%u8FDB%u56DE%u5F52%u6D4B%u8BD5%u7684%u6548%u7387%u548C%u6709%u6548%u6027%u662F%u975E%u5E38%u6709%u610F%u4E49%u7684%u3002%0A%u2014%u2014%20**%u767E%u5EA6%u767E%u79D1**%0A%0A%u672C%u4E66%u8BB2%u7684%u56DE%u5F52%u6D4B%u8BD5%u6982%u5FF5%u53EF%u80FD%u7565%u6709%u4E0D%u540C%u3002%u6309%u7167%u6211%u7684%u7406%u89E3%uFF0C%u4F5C%u8005%u662F%u60F3%u8BF4%uFF0C%u5728%u8FDB%u884C%u5B8C%u6240%u6709%u7684%u7F16%u7801%u4EE5%u540E%uFF0C%u4F60%u5DF2%u7ECF%u5BF9%u4F60%u7684%u8981%u5B9E%u73B0%u7684%u6240%u6709%u4E1C%u897F%u5B8C%u6210%u4E86unknown%24%5Crightarrow%20%24known%u7684%u8FC7%u7A0B%u3002%u90A3%u4E48%u73B0%u5728%uFF0C%u4F60%u53EF%u4EE5%u56DE%u8FC7%u5934%u770B%u770B%uFF0C%u5982%u679C%u8FD9%u65F6%u5019%u91CD%u65B0%u5199%u4E00%u4EFD%u6D4B%u8BD5%u4F60%u5E94%u8BE5%u5199%u4EC0%u4E48%u3002%0A%0A%3E%u56DE%u5230%u4F60%u9488%u5BF9%u8FD9%u4E2A%u7CFB%u7EDF%u7684%u6700%u521D%u7684%u60F3%u6CD5%u6765%u5BF9%u6574%u4E2A%u7CFB%u7EDF%u505A%u4E00%u4E2A%u6D4B%u8BD5%u3002%u4EE5%u671F%u5BF9%u6574%u4E2A%u7CFB%u7EDF%u6709%u4E2A%u6574%u4F53%u7684%u8BC4%u4EF7%u3002%0A%23%23%23Break%0A%u52B3%u9038%u7ED3%u5408%u5BF9%u7A0B%u5E8F%u5458%u662F%u975E%u5E38%u975E%u5E38%u975E%u5E38%u91CD%u8981%u7684%uFF01%0A%3E%20**Shower%20Methodology**%3AIf%20you%20know%20what%20to%20type%2C%20then%20type.%20If%20you%20don%27t%20know%20what%20to%20type%2C%20then%20take%20a%20shower%2C%20and%20stay%20in%20the%20shower%20until%20you%20know%20what%20to%20type.%0A%3E**TDD%20Rule**%3A%20If%20you%20don%27t%20know%20what%20to%20type%2C%20then%20Fake%20It.%20If%20the%0Aright%20design%20still%20isn%27t%20clear%2C%20then%20Triangulate.%20%0A%0A%u770B%u770B%u4F5C%u8005%u63D0%u5021%u7684%u65F6%u95F4%u7BA1%u7406%0A%3E*%20At%20the%20scale%20of%20hours%2C%20keep%20a%20water%20bottle%20by%20your%20keyboard%20so%20that%20biology%20provides%20the%20motivation%20for%20regular%20breaks.%0A%3E*%20At%20the%20scale%20of%20a%20day%2C%20commitments%20after%20regular%20work%20hours%20can%20help%20you%20to%20stop%20when%20you%20need%20sleep%20before%20progress.%0A%3E*%20At%20the%20scale%20of%20a%20week%2C%20weekend%20commitments%20help%20get%20your%20conscious%2C%20energysucking%20thoughts%20off%20work.%20%28My%20wife%20swears%20I%20get%20my%20best%20ideas%20on%20Friday%20evening.%29%0A%3E*%20At%20the%20scale%20of%20a%20year%2C%20mandatory%20vacation%20policies%20help%20you%20refresh%20yourself%20completely.%20The%20French%20do%20this%20right%u2014two%20contiguous%20weeks%20of%20vacation%20aren%27t%20enough.%20You%20spend%20the%20first%20week%20decompressing%2C%20and%20the%20second%20week%20getting%20ready%20to%20go%20back%20to%20work.%20Therefore%2C%20three%20weeks%2C%20or%20better%20four%2C%20are%20necessary%20for%20you%20to%20be%20your%20most%20effective%20the%20rest%20of%20the%20year.%0A%23%23%23Do%20Over%0A%3EWhat%20do%20you%20do%20when%20you%20are%20feeling%20lost%3F%20Throw%20away%20the%20code%20and%20start%20over.%0A%u4F5C%u8005%u5728%u8FD9%u4E00%u7AE0%u544A%u8BC9%u4F60%uFF0C%u4E0D%u8981%u5728%u6CE5%u6F6D%u8D8A%u9677%u8D8A%u6DF1%uFF0C%u4E0D%u8981%u5BB3%u6015%u91CD%u65B0%u5F00%u59CB%u3002%u6362%u4E2A%u4F19%u4F34%uFF0C%u6362%u4E2A%u601D%u8DEF%uFF0C%u4F60%u53EF%u80FD%u6709%u66F4%u597D%u7684%u53D1%u73B0%u3002%0A%23%23Chapter%2027.%20Testing%20Patterns%0A%23%23%23Child%20Test%0A%u8FD9%u91CC%u8BF4%u7684%u662F%uFF0C%u5982%u679C%u4F60%u89C9%u5F97%u8FD9%u4E2A%u6D4B%u8BD5%u592A%u5927%uFF0C%u90A3%u5C31%u8981%u628A%u8FD9%u4E2A%u5927%u7684%u6D4B%u8BD5%u7834%u6210%u82E5%u5E72%u4E2A%u5C0F%u7684%u6D4B%u8BD5%uFF0C%u7136%u540E%u770B%u770B%u6709%u6CA1%u6709%u8FDB%u5C55%u3002%0A%23%23%23Mock%20Object%0A%3EHow%20do%20you%20test%20an%20object%20that%20relies%20on%20an%20expensive%20or%20complicated%20resource%3F%20Create%20a%20fake%20version%20of%20the%20resource%20that%20answers%20constants.%0A%3EIf%20you%20want%20to%20use%20Mock%20Objects%2C%20you%20can%27t%20easily%20store%20expensive%20resources%20in%20global%20variables.%u8981%u8BB0%u5F97%u6E05%u7406%u73B0%u573A%uFF0C%u5426%u5219%u4E07%u4E00%u5176%u4ED6%u7684%u4EE3%u7801%u628A%u4ED6%u5F53%u4F5C%u771F%u7684object%u5728%u4F7F%u7528%uFF0C%u5C31%u4F1A%u51FA%u5927%u95EE%u9898%u3002%u6240%u4EE5%u7F16%u7801%u6700%u57FA%u672C%u7684%u51C6%u5219%u662F%u5C11%u7528%u5168%u5C40%u53D8%u91CF%u3002%0A%3EMock%20Objects%20encourage%20you%20down%20the%20path%20of%20carefully%20considering%20the%20visibility%20of%20every%20object%2C%20reducing%20the%20coupling%20in%20your%20designs.%20%u8FD9%u91CC%u8BF4%u7684%u662F%uFF0C%u5982%u679C%u4F60%u7528Mock%20Object%uFF0C%u4F60%u5C31%u8981%u601D%u8003%u6211%u5230%u5E95%u8BE5%u4E0D%u8BE5%u628A%u8FD9%u4E2A%u5E9E%u7136%u5927%u7269%u66B4%u9732%u7ED9%u8FD9%u6BB5%u4EE3%u7801%u3002%u8FD9%u79CD%u601D%u8003%u6709%u52A9%u4E8E%u51CF%u5C0F%u8026%u5408%u6027%u3002%0A%23%23%23Self%20Shunt%0A%3EHow%20do%20you%20test%20that%20one%20object%20communicates%20correctly%20with%20another%3F%20Have%20the%20object%20under%20test%20communicate%20with%20the%20test%20case%20instead%20of%20with%20the%20object%20it%20expects.%0A%0A**Without%20Self%20Shunt**%0A%60%60%60python%0A%23%20ResultListenerTest%0Adef%20testNotification%28self%29%3A%20%0A%09result%3D%20TestResult%28%29%20%0A%09listener%3D%20ResultListener%28%29%20%0A%09result.addListener%28listener%29%20%0A%09WasRun%28%22testMethod%22%29.run%28result%29%0A%09assert%201%20%3D%3D%20listener.count%20%0A%0A%23%20ResultListener%0Aclass%20ResultListener%3A%0A%09def%20__init__%28self%29%3A%20%0A%09%09self.count%3D%200%20%0A%09def%20startTest%28self%29%3A%20%0A%09%09self.count%3D%20self.count%20+%201%20%0A%60%60%60%0A%0A**With%20Self%20Shunt**%0A%60%60%60python%0A%23%20ResultListenerTest%0Adef%20testNotification%28self%29%3A%20%0A%09self.count%3D%200%20%0A%09result%3D%20TestResult%28%29%0A%09result.addListener%28self%29%0A%09WasRun%28%22testMethod%22%29.run%28result%29%20%0A%09assert%201%20%3D%3D%20self.count%0Adef%20startTest%28self%29%3A%0A%09self.count%3D%20self.count%20+%201%0A%60%60%60%0A%0A%u8FD9%u91CC%u4E3E%u5F97%u4F8B%u5B50%u4E0D%u662F%u5F88%u660E%u767D%u3002%u4E2D%u6587%u8BD1%u672C%u91CC%uFF0C%u5C06self%20shunt%u7FFB%u8BD1%u6210%u81EA%u5206%u6D41%uFF0C%u611F%u89C9%u4E5F%u662F%u5B57%u9762%u7FFB%u8BD1%u3002%u6211%u7406%u89E3%u8FD9%u91CC%u60F3%u8BF4%u7684%u662F%uFF0C%u4E0D%u4E00%u5B9A%u8981%u5B9A%u4E49%u4E00%u4E2A%u7C7B%u6765%u505A%u5F53%u524D%u88AB%u6D4B%u8BD5%u7C7B%u6765%u505A%u7684%u4E8B%u60C5%uFF0C%u53EF%u4EE5%u5728test%20case%u91CC%u9762%u7528%u8BE5%u7C7B%u66B4%u9732%u7684%u63A5%u53E3%u6765%u505A%u4E8B%u60C5%u3002%0A%3ESelf%20Shunt%20may%20require%20that%20you%20use%20**Extract%20Interface**%20to%20get%20an%20interface%20to%20implement.%20You%20will%20have%20to%20decide%20whether%20extracting%20the%20interface%20is%20easier%2C%20or%20if%20testing%20the%20existing%20class%20as%20a%20**black%20box**%20is%20easier.%0A%0A%u8FD9%u91CC%u53C8%u770B%u6655%u4E86%uFF0Cself%20shunt%u8DDFextract%20interface%u6709%u5565%u5173%u7CFB%u3002%0A%3E%u5F53%u6211%u4EEC%u6CE8%u610F%u5230%u5728%u6211%u4EEC%u4EE3%u7801%u7ED3%u6784%u4E2D%u8D85%u8FC7%u4E00%u4E2A%u7C7B%u4F7F%u7528%u5230%u53E6%u4E00%u4E2A%u7279%u6B8A%u7C7B%u4E2D%u7684%u540C%u4E00%u4E2A%u65B9%u6CD5%u65F6%uFF0C%u6B64%u65F6%u5E94%u8BE5%u5C06%u8BE5%u7C7B%u4E2D%u7684%u65B9%u6CD5%u63D0%u53D6%u51FA%u6765%u653E%u5230%u4E00%u4E2A%u63A5%u53E3%uFF08interface%uFF09%u4E2D%uFF0C%u5E76%u5BF9%u5916%u63D0%u4F9B%u8FD9%u4E2A%u63A5%u53E3%u4EE5%u4FBF%u88AB%u7528%u6237%u7C7B%u8BBF%u95EE%u3001%u4F7F%u7528%uFF0C%u8FD9%u6837%u6709%u5229%u4E8E%u6253%u7834%u539F%u6765%u591A%u4E2A%u7C7B%u4E0E%u8FD9%u4E2A%u7279%u6B8A%u7C7B%u7684%u4F9D%u8D56%u5173%u7CFB%u3002%u8FD9%u4E2A%u91CD%u6784%u624B%u6CD5%u5F88%u5BB9%u6613%u5B9E%u73B0%uFF0C%u66F4%u91CD%u8981%u7684%u662F%u8FD9%u6837%u505A%u6709%u5229%u4E8E%u677E%u8026%u5408%u3002%20%u2014%u2014%u7F51%u7EDC%u4E0A%u7684%u89E3%u91CA%0A%0A%u6211%u89C9%u5F97%u8FD9%u91CC%u4F5C%u8005%u63D0%u5230%u7684extract%20interface%uFF0C%u5E76%u4E0D%u662F%u6211%u4EEC%u8BF4%u7684%u91CD%u6784%u91CC%u7684extract%20interface%u3002%u8FD9%u91CC%u8BF4%u8981%u6D4B%u8BD5A%u7C7B%u548CB%u7C7B%u901A%u4FE1%uFF0C%u6211%u4EEC%u4E0D%u76F4%u63A5%u7528B%u7C7B%uFF0C%u800C%u7528test%20case%u4E0EA%u7C7B%u901A%u4FE1%uFF0C%u4EE5%u6D4B%u8BD5%u901A%u4FE1%u7684A%u7C7B%u7AEF%u63A5%u53E3%u662F%u5426%u6B63%u786E%u3002extract%20interface%u8BF4%u7684%u662F%u4ECEB%u7C7B%u4E2Dextract%u63A5%u53E3%u51FA%u6765%u5230test%20case%u4E2D%u53BBimplement%u3002%u6216%u8005%u628AB%u7C7B%u76F4%u63A5%u5F53%u9ED1%u76D2%u5B50%u5728test%20case%u4E2D%u4F7F%u7528%u3002%0A%23%23%23Log%20String%0A%u8FD9%u4E2A%u5F88%u6709%u7528%u3002%u6709%u4E9B%u51FD%u6570%u6216%u8005%u8FC7%u7A0B%u662F%u6CA1%u6709%u8FD4%u56DE%u503C%u7684%uFF0C%u6211%u4EEC%u5C31%u53EF%u4EE5%u7528Log%20String%u7684%u65B9%u5F0F%u6765%u67E5%u770B%u8BE5%u8FC7%u7A0B%u6216%u51FD%u6570%u6709%u6CA1%u6709%u88AB%u8C03%u7528%u3002%u7C7B%u4F3C%u6211%u4EEC%u770Btrace%20log%u4E00%u6837%uFF0C%u901A%u8FC7%u770Btrace%20log%u80FD%u77E5%u9053%u673A%u5668%u6267%u884C%u7684%u4EE3%u7801%u662F%u5426%u6B63%u786E%u3002%0A%23%23%23Crash%20Test%20Dummy%0A%3EHow%20do%20you%20test%20error%20code%20that%20is%20unlikely%20to%20be%20invoked%3F%20Invoke%20it%20anyway%20with%20a%20special%20object%20that%20throws%20an%20exception%20instead%20of%20doing%20real%20work.%0A%23%23%23Broken%20Test%0A%u4F5C%u8005%u7ECF%u5E38%u80FD%u7ED9%u51FA%u4E00%u4E9B%u5F88%u5B9E%u7528%u7684%u5C0F%u7ECF%u9A8C%uFF0C%u8FD9%u91CC%u53C8%u6765%u4E86%uFF0C%u770B%u4E0B%u9762%u3002%0A%3EHow%20do%20you%20leave%20a%20programming%20session%20when%20you%27re%20programming%20alone%3F%20Leave%20the%20last%20test%20broken.%0A%0A%u5F53%u4F60%u8981%u8F6C%u53BB%u505A%u53E6%u5916%u4E00%u4EF6%u4E8B%u60C5%uFF0C%u800C%u624B%u5934%u4E0A%u7684%u4E8B%u60C5%u53C8%u6CA1%u7ED3%u675F%u65F6%u600E%u4E48%u529E%uFF1F%u8BA9%u6700%u540E%u4E00%u4E2A%u6D4B%u8BD5%u6545%u610F%u7684%u4E0D%u901A%u8FC7%u3002%u8FD9%u6837%u4E0B%u6B21%u5C31%u77E5%u9053%u4ECE%u54EA%u513F%u5F00%u59CB%uFF0C%u7136%u540E%u80FD%u8FC5%u901F%u4E0A%u624B%u3002%u918D%u9190%u704C%u9876%u554A%uFF01%u4EE5%u524D%u90FD%u662F%u8BA4%u4E3A%u505A%u53E6%u5916%u4E00%u4EF6%u4E8B%u60C5%u4E4B%u524D%u8981%u628A%u624B%u5934%u4E0A%u7684%u4E8B%u60C5%u5F04%u7684%u5C3D%u5584%u5C3D%u7F8E%uFF0C%u5176%u5B9E%u4E0D%u7136%u3002%u600E%u4E48%u505A%u5229%u4E8E%u540E%u671F%u7EE7%u7EED%u8FDB%u884C%uFF0C%u90A3%u5C31%u5E94%u8BE5%u600E%u4E48%u505A%u3002%0A%23%23%23Clean%20Check-in%0A%3EYou%20will%20occasionally%20find%20a%20test%20broken%20in%20the%20integration%20suite%20when%20you%20try%20to%20check%20in.%20What%20to%20do%3F%0A**The%20simplest%20rule**%20is%20to%20just%20throw%20away%20your%20work%20and%20start%20over.%20The%20broken%20test%20is%20pretty%20strong%20evidence%20that%20you%20didn%27t%20know%20enough%20to%20program%20what%20you%20just%20programmed.%0A%u4EC0%u4E48%u4EC0%u4E48%uFF1F%u7ADF%u7136%u8981%u6211%u4EEC%u6254%u6389%u6211%u4EEC%u505A%u7684%uFF0C%u7136%u540E%u91CD%u65B0%u5F00%u59CB%u3002%u5C31%u56E0%u4E3A%u6211%u4EEC%u7684%u6D4B%u8BD5%u548Cintegration%u6D4B%u8BD5%u7ED3%u679C%u4E0D%u4E00%u81F4%u3002%0A%u5927%u5E08%u7684%u8BDD%u603B%u662F%u6709%u9053%u7406%u7684%uFF0C%u4EE5%u540E%u8981%u597D%u597D%u8003%u8651%u8FD9%u4E00%u70B9%u3002%0A%23%23Chapter%2028.%20Green%20Bar%20Patterns%0A%23%23%23Fake%20It%20%28%27Til%20You%20Make%20It%29%0A%u505A%u5047%u4EE3%u7801%u8BA9%u6D4B%u8BD5%u901A%u8FC7%uFF0C%u7136%u540E%u518D%u4E00%u9879%u4E00%u9879%u5730%u5B8C%u6210%0A%23%23%23Triangulate%0A%u4F5C%u8005%u63D0%u5230%u7684%u6240%u8C13%u4E09%u89D2%u6CD5%u3002%u901A%u4FD7%u7684%u8BF4%uFF0C%u5C31%u662F%u53EA%u5728%u5FC5%u8981%u7684%u65F6%u5019%u505A%u62BD%u8C61%u6216%u901A%u7528%u5316%u5904%u7406%u3002%u901A%u5E38%u662F%u5728TDD%u7684%u91CD%u6784%u8FD9%u4E00%u6B65%u5B8C%u6210%u8FD9%u4E2A%u62BD%u8C61%u7684%u8FC7%u7A0B%u3002%u518D%u901A%u4FD7%u70B9%u8BF4%uFF0C%u5C31%u662F%u591A%u5F04%u51E0%u4E2Acase%uFF0C%u518D%u603B%u7ED3%u5171%u540C%u70B9%uFF0C%u4E4B%u540E%u505A%u62BD%u8C61%0A%u4ECE%u53E6%u4E00%u4E2A%u89D2%u5EA6%uFF0C%u4F5C%u8005%u53C8%u8BF4%u4E86%uFF1A%0A%3EI%20only%20use%20Triangulation%20when%20I%27m%20really%2C%20really%20unsure%20about%20the%20correct%20abstraction%20for%20the%20calculation.%20Otherwise%20I%20rely%20on%20either%20Obvious%20Implementation%20or%20Fake%20It.%0A%23%23%23One%20to%20Many%0A%3EHow%20do%20you%20implement%20an%20operation%20that%20works%20with%20collections%20of%20objects%3F%20Implement%20it%20without%20the%20collections%20first%2C%20then%20make%20it%20work%20with%20collections.%0A%0A%u4E2D%u5FC3%u601D%u60F3%u8FD8%u662F%u4E00%u4E2A%uFF0C%u4ECE%u663E%u800C%u6613%u89C1%u7684%u5730%u65B9%u5F00%u59CB%uFF0C%u6BCF%u6B21%u53EA%u505A%u4E00%u5C0F%u6B65%uFF0C%u7136%u540E%u4E00%u6B65%u4E00%u6B65%u5230%u8FBE%u6700%u7EC8%u7684%u76EE%u7684%u5730%u3002%u770B%u4E0B%u9762%u7684%u4F8B%u5B50%uFF1A%0A%60%60%60java%0A//%201.%20fake%20code%0Apublic%20void%20testSum%28%29%20%7B%20%0A%09assertEquals%285%2C%20sum%285%29%29%3B%20%0A%7D%20%0Aprivate%20int%20sum%28int%20value%29%20%7B%0A%09return%20value%3B%0A%7D%0A%0A//%202.%20add%20arrays%0Apublic%20void%20testSum%28%29%20%7B%0A%09assertEquals%285%2C%20sum%285%2C%20new%20int%5B%5D%20%7B5%7D%29%29%3B%0A%7D%0Aprivate%20int%20sum%28int%20value%2C%20int%5B%5D%20values%29%20%7B%0A%09return%20value%3B%0A%7D%0A%0A//%203.%20add%20real%20sum%20functionality%0Apublic%20void%20testSum%28%29%20%7B%0A%09assertEquals%285%2C%20sum%285%2C%20new%20int%5B%5D%20%7B5%7D%29%29%3B%0A%7D%0Aprivate%20int%20sum%28int%20value%2C%20int%5B%5D%20values%29%20%7B%0A%09int%20sum%3D%200%3B%20%0A%09for%20%28%20int%20i%3D%200%3B%20i%3Cvalues.length%3B%20i++%29%0A%09%09sum%20+%3D%20values%5Bi%5D%3B%0A%09return%20sum%3B%0A%7D%0A%0A//%204.%20delete%20unnecessary%20code%0Apublic%20void%20testSum%28%29%20%7B%20%0A%09assertEquals%285%2C%20sum%28new%20int%5B%5D%20%7B5%7D%29%29%3B%0A%7D%0Aprivate%20int%20sum%28%20int%5B%5D%20values%29%20%7B%0A%09int%20sum%3D%200%3B%20%0A%09for%20%28int%20i%3D%200%3B%20i%3Cvalues.length%3B%20i++%29%0A%09%09sum%20+%3D%20values%5Bi%5D%3B%0A%09return%20sum%3B%20sum%3B%0A%7D%0A%60%60%60%0A%u7EC6%u7EC6%u4F53%u4F1A%u5176%u95F4%u7684%u5DEE%u522B%u5427%u3002%0A%23%23Chapter%2029.%20xUnit%20Patterns%0A%23%23%23Assertion%0A%3EHow%20do%20you%20check%20that%20tests%20worked%20correctly%3F%20%0A%3EWrite%20boolean%20expressions%20that%20automate%20your%20judgment%20about%20whether%20the%20code%20worked.%0A%0A%u4F5C%u8005%u5728%u8FD9%u4E00%u7AE0%u53C8%u7ED9%u51FA%u4E86%u4E00%u4E2A%u5F88%u6709%u6307%u5BFC%u610F%u4E49%u7684%u89C2%u70B9%u3002%0A%3E%u5C3D%u91CF%u4E0D%u8981%u505A%u767D%u76D2%u6D4B%u8BD5%uFF0C%u5982%u679C%u4F60%u60F3%u505A%uFF0C%u8BF4%u660E%u4F60%u7684%u8BBE%u8BA1%u6709%u95EE%u9898%0A%23%23%23Fixture%0A%u8FD9%u91CC%u4F5C%u8005%u629B%u51FA%u4E86%u4E00%u4E2A%u95EE%u9898%uFF0C%u5982%u679C%u6709%u591A%u4E2A%u6D4B%u8BD5%u6709%u7C7B%u4F3C%u7684%u4EE3%u7801%u600E%u4E48%u529E%uFF1F%u4E24%u4E2A%u9009%u62E9%uFF1A%0A1.%20test%20case%u7C7B%u5B9A%u4E49%u4E2D%u62BD%u8C61%u51FA%u7C7B%u4F3CsetUp%u7684%u51FD%u6570%uFF0C%u6765%u505A%u91CD%u590D%u7684%u5DE5%u4F5C%0A2.%20%u6216%u8005%u7528%u7C7B%u4F3C%u4EE3%u7801%u751F%u6210%u5668%u7684%u4E1C%u897F%u6765%u4E3A%u6240%u6709%u9700%u8981%u7684%u6D4B%u8BD5%u751F%u6210fixture%0A%0A%u65B9%u6CD51%u6709%u65F6%u5019%u66F4%u7B26%u5408DRY%u539F%u5219%uFF0C%u4F46%u5B83%u7684%u7F3A%u70B9%u662F%uFF0C%u4F60%u8981%u8BB0%u4F4FsetUp%u91CC%u9762%u5230%u5E95%u505A%u4E86%u4EC0%u4E48%u3002%u4E24%u79CD%u65B9%u6CD5%u90FD%u53EF%u4EE5%uFF0C%u9009%u62E9%u66F4%u5408%u9002%u7684%u3002%0A%0A%23%23%23External%20Fixture%0A%u6240%u8C13%u7684%u5916%u90E8fixture%uFF0C%u5C31%u662F%u8981%u4FDD%u8BC1%u6D4B%u8BD5%u80FD%u6062%u590D%u73AF%u5883%u914D%u7F6E%u3002%0A%3E%u5728%u6240%u6709%u6D4B%u8BD5%u5F00%u59CB%u524D%u8C03setUp%uFF0C%u6240%u6709%u6D4B%u8BD5%u7ED3%u675F%u540E%u8C03tearDown%u3002%u8FD9%u5C31%u662FExternal%20Fixture%0A%23%23%23Test%20Method%0A%u8FD9%u4E00%u8282%u9488%u5BF9%u5982%u4F55%u5199%u6D4B%u8BD5%u65B9%u6CD5%u7ED9%u51FA%u4E86%u4E00%u4E9B%u5EFA%u8BAE%u3002%0A1.%20hierarchy%0A*%20Module%20%24%5Crightarrow%24%20Framework%0A*%20Class%20%24%5Crightarrow%24%20internal%20fixture%0A*%20Method%20%24%20%5Crightarrow%24%20test%20case%0A2.%20%u540D%u5B57%u957F%u6CA1%u5173%u7CFB%uFF0C%u8981%u8BA9%u4EE5%u540E%u7684%u8BFB%u8005%u6709%u8DB3%u591F%u7684%u7EBF%u7D22%u77E5%u9053%u4E3A%u4EC0%u4E48%u8981%u5199%u8FD9%u4E2Atest%0A3.%20%u6D4B%u8BD5%u4EE3%u7801%u8981%u591F%u76F4%u89C9%uFF0C%u8981%u591F%u7B80%u6D01%uFF08%u6700%u77ED3%u884C%uFF09%20%0A4.%20%u6CE8%u91CA%u91CC%u5199outline%uFF0C%u4E00%u9897%u661F%u8868%u793A%u4E00%u7EA7%uFF0C%u4F5C%u8005%u8BF4%u4ED6%u4E00%u822C%u51992-3%u7EA7outline%0A%60%60%60%20cpp%0A/*%20Adding%20to%20tuple%20spaces.%20*/%20%0A/*%20Taking%20from%20tuple%20spaces.%20*/%0A/**%20Taking%20a%20non-existent%20tuple.%20**/%20%0A/**%20Taking%20an%20existing%20tuple.%20**/%20%0A/**%20Taking%20multiple%20tuples.%20**/%20%0A/*%20Reading%20from%20tuple%20space.%20*/%0A%60%60%60%0A%23%23%23Exception%20Test%0A%u8FD9%u4E00%u8282%u8BF4%u7684%u662F%uFF0C%u5982%u679C%u5F85%u6D4B%u7684%u51FD%u6570%u9700%u8981%u629B%u51FA%u5F02%u5E38%uFF0C%u7528%u5982%u4E0B%u7684%u65B9%u6CD5%uFF1A%0A%60%60%60java%0Apublic%20void%20testMissingRate%28%29%20%7B%0A%09try%20%7B%0A%09%09exchange.findRate%28%22USD%22%2C%20%22GBP%22%29%3B%20%0A%09%09fail%28%29%3B%20//%20%u5982%u679C%u6CA1%u629B%u5F02%u5E38%u5C31fail%0A%09%7D%20catch%20%28IllegalArgumentException%20expected%29%20%7B%20%0A%09%7D%0A%7D%0A%60%60%60%0A%23%23%23All%20Tests%0A%3EHow%20do%20you%20run%20all%20tests%20together%3F%20Make%20a%20suite%20of%20all%20the%20suites%u2014one%20for%20each%20package%2C%20and%20one%20aggregating%20the%20package%20tests%20for%20the%20whole%20application.%0A%60%60%60java%0Apublic%20class%20AllTests%20%7B%0A%09//%20%u8FD9%u91CC%u6709%u4E2Amain%uFF0C%u65B9%u4FBF%u76F4%u63A5%u8C03%u7528%u7A0B%u5E8F%u5F00%u59CB%u6D4B%u8BD5%0A%09public%20static%20void%20main%28String%5B%5D%20args%29%20%7B%20%0A%09%09junit.swingui.TestRunner.run%28AllTests.class%29%3B%20%0A%09%7D%0A%09//%20%u8FD9%u91CC%u6709%u4E2Asuite%u5305%u542B%u4E86%u6240%u6709test%20case%0A%09public%20static%20Test%20suite%28%29%20%7B%20%0A%09%09TestSuite%20result%3D%20new%20TestSuite%28%22TFD%20tests%22%29%3B%20%0A%09%09result.addTestSuite%28MoneyTest.class%29%3B%20%0A%09%09result.addTestSuite%28ExchangeTest.class%29%3B%20%0A%09%09result.addTestSuite%28IdentityRateTest.class%29%3B%20%0A%09%09return%20result%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%23%23Chapter%2030.%20Design%20Patterns%0A%u4F5C%u8005%u5728%u8FD9%u4E00%u7AE0%u5F15%u5165%u4E86%u4E00%u4E9BTDD%u4E2D%u4F1A%u7528%u5230%u7684%u8BBE%u8BA1%u6A21%u5F0F%u3002%u6709%u4E9B%u662F%u5199%u6D4B%u8BD5%u65F6%u7528%u7684%uFF0C%u6709%u7684%u662F%u91CD%u6784%u65F6%u7528%u7684%uFF0C%u6709%u7684%u4E24%u8005%u7686%u53EF%u3002%u4E0B%u9762%u662F%u672C%u7AE0%u6240%u6709%u6A21%u5F0F%u7684%u603B%u7EB2%u3002%0A%21%5BAlt%20text%5D%28./1456036251528.png%29%0A%23%23%23Command%0A%3EWhat%20do%20you%20do%20when%20you%20need%20the%20invocation%20of%20a%20computation%20to%20be%20more%20complicated%20than%20a%20simple%20method%20call%3F%0A%3EMake%20an%20object%20for%20the%20computation%20and%20invoke%20it.%0A%0A%u8FD9%u91CC%u6240%u8BF4%u7684%u547D%u4EE4%u662F%u8BF4%uFF0C%u628A%u8981%u8C03%u7528%u7684%u65B9%u6CD5%u5C01%u88C5%u6210%u4E00%u4E2Aobject%uFF0C%u7136%u540E%u8C03%u7528%u90A3%u4E2Aobject%0A%0A%23%23%23Value%20Object%0A%u628A%u4E00%u4E9B%u5E38%u91CF%u53C2%u6570%u505A%u6210object%u6765%u4F20%u9012%0A%3EWhen%20implementing%20a%20Value%20Object%2C%20every%20operation%20has%20to%20return%20a%20fresh%20object%2C%20%0A%3EAll%20Value%20Objects%20have%20to%20implement%20equality%20%0A%0A%23%23%23Null%20Object%0A%60%60%60java%0Apublic%20boolean%20setReadOnly%28%29%20%7B%20%0A%09SecurityManager%20guard%20%3D%20System.getSecurityManager%28%29%3B%20%0A%09if%20%28guard%20%21%3D%20null%29%20%7B%20%29%20%7B%0A%09%09guard.canWrite%28path%29%3B%0A%09%7D%20%0A%09return%20fileSystem.setReadOnly%28this%29%3B%0A%7D%0A%60%60%60%0A%u4E0A%u9762%u8FD9%u4E2A%u4F8B%u5B50getSecurityManager%u5728%u4E0D%u6210%u529F%u65F6%u8FD4%u56DENull%uFF0C%u7136%u540E%u8C03%u7528%u8005%u518D%u5224%u65AD%u8FD4%u56DE%u503C%u4EE5%u51B3%u5B9A%u4F1A%u4E0D%u4F1A%u7528%u7A7A%u6307%u9488%u6765%u8C03%u7528%u6210%u5458%u53D8%u91CF%u3002%0A%u8FD9%u662F%u4E00%u4E2A%u5F88%u5E38%u89C1%u7684%u505A%u6CD5%uFF0C%u8FD9%u6837%u505A%u4E0D%u597D%u7684%u662F%uFF0C%u901A%u5E38%u8FD9%u79CD%u5224%u65AD%u4F1A%u975E%u5E38%u975E%u5E38%u591A%uFF0C%u800C%u4E14%u7ED9%u4EBA%u4E00%u79CD%u201C%u4F1A%u4E0D%u4F1A%u6709%u54EA%u91CC%u6CA1%u5224%u65AD%uFF0C%u4EE5%u540E%u4F1A%u5BFC%u81F4crash%uFF1F%u201D%u7684%u62C5%u5FE7%u3002%0ANull%20Object%u8BBE%u8BA1%u6A21%u5F0F%u5C31%u662F%u8BA9getSecurityManager%u8FD4%u56DE%u4E00%u4E2A%u7279%u6B8A%u7684object%u6765%u53D6%u4EE3Null%uFF0C%u8FD9%u6837%u8BA9%u6240%u6709%u7684%u64CD%u4F5C%u90FD%u7EDF%u4E00%uFF0C%u4EE5%u51CF%u5C11%u91CD%u590D%u4EE3%u7801%u3002%0A%0A%23%23%23Template%20Method%0A%u6A21%u677F%u65B9%u6CD5%u3002%0A%3EWhen%20you%20find%20two%20variants%20of%20a%20sequence%20in%20two%20subclasses%2C%20you%20need%20to%20gradually%20move%20them%20closer%20together.%20Once%20you%27ve%20extracted%20the%20parts%20that%20are%20different%20from%20other%20methods%2C%20what%20you%20are%20left%20with%20is%20the%20Template%20Method.%20%0A%60%60%60java%0A//%20TestCase%0Apublic%20void%20runBare%28%29%20throws%20Throwable%20%7B%20%0A%09setUp%28%29%3B%20%0A%09try%20%7B%20%0A%09%09runTest%28%29%3B%0A%09%7D%0A%09finally%20%7B%0A%09%09tearDown%28%29%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23Pluggable%20Object%0A%u4E2D%u6587%u8BD1%u540D%u4E3A%u63D2%u5165%u5F0F%u5BF9%u8C61%u3002%u5F88%u96BE%u7406%u89E3%u54EA%u91CC%u6709%u8FD9%u4E2A%u6240%u8C13%u7684%u201C%u63D2%u5165%u201D%u3002%u8FD9%u4E2A%u8BBE%u8BA1%u6A21%u5F0F%u6838%u5FC3%u7684%u601D%u60F3%u5C31%u662F%u6D88%u9664%60if...else...%60%u7684%u60C5%u51B5%u3002%0A%u770B%u4F5C%u8005%u7684%u4F8B%u5B50%uFF0C%u89E3%u91CA%u7684%u5F88%u6E05%u695A%uFF1A%0A%60%60%60java%0A//%20Without%20Pluggable%20Object%0AFigure%20selected%3B%20%0Apublic%20void%20mouseDown%28%29%20%7B%20%0A%09selected%3D%20findFigure%28%29%3B%0A%09if%20%28selected%20%21%3D%20null%29%20//%20%u5230%u5904%u662Fnull%u5224%u65AD%0A%09%09select%28selected%29%3B%20%0A%7D%0Apublic%20void%20mouseMove%28%29%20%7B%0A%09if%20%28selected%20%21%3D%20null%29%0A%09%09move%28selected%29%3B%20%0A%09else%0A%09%09moveSelectionRectangle%28%29%3B%20%0A%7D%0Apublic%20void%20mouseUp%28%29%20%7B%0A%09if%20%28selected%20%3D%3D%20null%29%0A%09%09selectAll%28%29%3B%0A%7D%20%0A%0A//%20With%20Pluggable%20Object%0ASelectionMode%20mode%3B%0Apublic%20void%20mouseDown%28%29%20%7B%0A%09selected%3D%20findFigure%28%29%3B%0A%09//%20%u5168%u90E8%u5F52%u7ED3%u5230mode%u5B50%u7C7B%u91CC%u9762%u53BB%u5904%u7406%0A%09if%20%28selected%20%21%3D%20null%29%0A%09%09mode%3D%20SingleSelection%28selected%29%3B%0A%09else%0A%09%09mode%3D%20MultipleSelection%28%29%3B%0A%7D%0Apublic%20void%20mouseMove%28%29%20%7B%0A%09mode.mouseMove%28%29%3B%0A%7D%0Apublic%20void%20mouseUp%28%29%20%7B%0A%09mode.mouseUp%28%29%3B%0A%7D%0A%60%60%60%0A%23%23%23Pluggable%20Selector%0A%u8FD9%u4E00%u8282%u7684%u8BBE%u8BA1%u6A21%u5F0F%u548C%u4E0A%u4E00%u8282%u7684%u6781%u4E3A%u7C7B%u4F3C%u3002%u8FD9%u6B21%u8981%u5904%u7406%u6389%u7684%u662F%60switch...case...%60%u800C%u53C8%u4E0D%u7528%u5B50%u7C7B%u7EE7%u627F%u7684%u65B9%u5F0F%u6765%u52A8%u6001%u8C03%u7528%u3002%u8FD9%u91CC%u4F7F%u7528%u7684%u65B9%u6CD5%u53EB%u53CD%u5C04%u3002%0A%3E%u53CD%u5C04%uFF1A%u901A%u8FC7%u81EA%u8EAB%u7684%u5C5E%u6027%uFF08%u5982%u7C7B%u540D%uFF0C%u65B9%u6CD5%u540D%uFF09%u6765%u505A%u76F8%u5173%u903B%u8F91%0A%0A%u540C%u6837%u770B%u4F5C%u8005%u7684%u4F8B%u5B50%0A%60%60%60java%0Avoid%20print%28%29%20%7B%20%0A%09Method%20runMethod%3D%20getClass%28%29.getMethod%28printMessage%2C%20null%29%3B%0A%09runMethod.invoke%28this%2C%20new%20Class%5B0%5D%29%3B%0A%7D%0A%60%60%60%0A%u770B%u5230%u4E86%u6CA1getClass%uFF0CgetMethod%uFF0C%u8FD9%u5C31%u662F%u53CD%u5C04%u3002%u6709%u4E86%u8FD9%u4E2A%u51FD%u6570%u65E2%u4E0D%u9700%u8981switch%u6765%u8C03%u7528%u4E0D%u540C%u7684printxxx%u51FD%u6570%28printHtml%2C%20printXml...%29%uFF0C%u4E5F%u4E0D%u9700%u8981%u5B9A%u4E49%u5B50%u7C7B%u6765%u8C03%u7528%u4E0D%u540C%u7684print%u51FD%u6570%u3002%0A%u4F5C%u8005%u5728%u672C%u8282%u6700%u540E%u7ED9%u51FA%u4E86%u4E00%u6BB5%u5FE0%u544A%uFF1A%0A%3EPluggable%20Selector%20can%20definitely%20be%20overused.%20The%20biggest%20problem%20with%20it%20is%20tracing%20code%20to%20see%20whether%20a%20method%20is%20invoked.%20Use%20Pluggable%20Selector%20only%20when%20you%20are%20cleaning%20up%20a%20fairly%20straightforward%20situation%20in%20which%20each%20of%20a%20bunch%20of%20**subclasses%20has%20only%20one%20method.**%0A%23%23%23Factory%20Method%0A%u4F5C%u8005%u8BF4%u5DE5%u5382%u65B9%u6CD5%u63D0%u4F9B%u4E86%u7075%u6D3B%u6027%u3002%u6211%u662F%u6CA1%u770B%u51FA%u6765%u3002%u5BF9%u6BD4%u4E0B%u9762%u4E24%u6BB5%u4EE3%u7801%uFF0C%u8FD9%u91CC%u589E%u52A0%u4E86%u7075%u6D3B%u6027%uFF1F%0A%60%60%60java%0Apublic%20void%20testMultiplication%28%29%20%7B%0A%09Dollar%20five%3D%20Dollar%20five%3D%20new%20Dollar%285%29%3B%0A%09assertEquals%28new%20Dollar%2810%29%2C%20five.times%282%29%29%3B%20%0A%09assertEquals%28new%20Dollar%2815%29%2C%20five.times%283%29%29%3B%0A%7D%0A%0Apublic%20void%20testMultiplication%28%29%20%7B%20%0A%09Dollar%20five%20%3D%20Money.dollar%285%29%3B%20//%20%u5DE5%u5382%u65B9%u6CD5%0A%09assertEquals%28new%20Dollar%2810%29%2C%20five.times%282%29%29%3B%20%0A%09assertEquals%28new%20Dollar%2815%29%2C%20five.times%283%29%29%3B%20%0A%7D%0A//%20Money%0Astatic%20Dollar%20dollar%28%20Dollar%20dollar%28int%20amount%29%20%7B%20%0A%09return%20new%20Dollar%28amount%29%3B%0A%7D%0A%60%60%60%0A%u4F5C%u8005%u6700%u540E%u7ED9%u51FA%u4E86%u4E00%u70B9%u5FE0%u544A%0A%3E%20You%20have%20to%20remember%20that%20the%20method%20is%20really%20creating%20an%20object%2C%20even%20though%20it%20doesn%27t%20look%20like%20a%20constructor.%20Use%20Factory%20Method%20only%20when%20you%20need%20the%20flexibility%20it%20creates.%20%0A%0A%23%23%23Imposter%0A%u4E2D%u6587%u8BD1%u540D%u4E3A%u5192%u540D%u9876%u66FF%u3002%u6839%u636E%u6587%u4E2D%u7684%u9610%u8FF0%uFF0C%u6211%u7406%u89E3%u8FD9%u91CC%u8BB2%u7684%u4E0D%u662F%u4E00%u79CD**%u8BBE%u8BA1**%u6A21%u5F0F%uFF0C%u800C%u53EA%u662F%u4E00%u79CD%u6A21%u5F0F%uFF0C%u4E00%u79CD%u7279%u6B8A%u60C5%u51B5%u3002%u6307%u7684%u662F%u5982%u679C%u67D0%u4E00%u6BB5%u4EE3%u7801%uFF0C%u53EA%u5C06%u5176%u4E2D%u7684%u4E00%u4E2A%u540D%u5B57%uFF08%u7C7B%u3001%u65B9%u6CD5%u6216%u8005%u53D8%u91CF%u7B49%u7B49%uFF09%u66FF%u6362%u6210%u53E6%u5916%u4E00%u4E2A%u540D%u5B57%uFF0C%u5C31%u80FD%u5F97%u5230%u4E00%u6BB5%u65B0%u7684%u4EE3%u7801%uFF0C%u79F0%u4E3A%u5192%u540D%u9876%u66FF%u3002%u53D1%u73B0%u53EF%u4EE5Imposter%u7684%u60C5%u51B5%uFF0C%u5176%u5B9E%u5C31%u662F%u53D1%u73B0%u91CD%u590D%u3002%0A%60%60%60java%0A//%20%u4E0B%u9762%u8FD9%u4E24%u6BB5%u4EE3%u7801%u5C31%u53EA%u662F%u5C06RectangleFigure%u6362%u6210OvalFigure%uFF0C%u6B64%u662F%u4E3AImposter%u5192%u540D%u9876%u66FF%u3002%0AtestRectangle%28%29%20%7B%0A%09Drawing%20d%3D%20new%20Drawing%28%29%3B%0A%09d.addFigure%28new%20RectangleFigure%280%2C%2010%2C%2050%2C%20100%29%29%3B%20RectangleFigure%280%2C%2010%2C%2050%2C%20100%29%29%3B%0A%09RecordingMedium%20brush%3D%20new%20RecordingMedium%28%29%3B%20%0A%09d.display%28brush%29%3B%20%0A%09assertEquals%28%22rectangle%200%2010%2050%20100%5Cn%22%2C%20brush.log%28%29%29%3B%0A%7D%0A%0AtestOval%28%29%20%7B%0A%09Drawing%20d%3D%20new%20Drawing%28%29%3B%0A%09d.addFigure%28new%20OvalFigure%280%2C%2010%2C%2050%2C%20100%29%29%3B%20%0A%09RecordingMedium%20brush%3D%20new%20RecordingMedium%28%29%3B%20%0A%09d.display%28brush%29%3B%0A%09assertEquals%28%22oval%200%2010%2050%20100%5Cn%22%2C%20brush.log%28%29%29%3B%20%0A%7D%0A%60%60%60%0A%u4F5C%u8005%u8FD8%u63D0%u5230%u53E6%u5916%u4E24%u4E2A%u5728%u91CD%u6784%u4E2D%u7ECF%u5E38%u7528%u5230%u7684%u8BBE%u8BA1%u6A21%u5F0F%uFF0C%u672C%u8D28%u5176%u5B9E%u5C31%u662FImposter%20%u2014%u2014%20Null%20Object%20%26%20Composite%u3002%0A%0A%23%23%23Composite%0A%u6839%u636E%u4E0A%u4E00%u7AE0%u4F5C%u8005%u7684%u89C2%u70B9%uFF0C%u7EC4%u5408%u5176%u5B9E%u5C31%u662F%u4E00%u79CD%u5192%u540D%u9876%u66FF%u3002%u4F5C%u8005%u5728%u672C%u8282%u5F00%u5934%u8BF4%u4E86%uFF1A%0A%3EHow%20do%20you%20implement%20**an%20object**%20whose%20behavior%20is%20the%20composition%20of%20the%20behavior%20of%20a%20list%20of%20other%20objects%3F%20Make%20it%20an%20**Imposter**%20for%20**the%20component%20objects**.%0A%0A%u8BA9%u8FD9%u4E2A%u5BF9%u8C61%u79F0%u4E3A%u7EC4%u6210%u4ED6%u7684%u5BF9%u8C61%u7684%u5192%u540D%u9876%u66FF%u8005%u3002%u8BF4%u8D77%u6765%u5F88%u62D7%u53E3%u3002%u770B%u4F8B%u5B50%uFF1A%0A%60%60%60java%0A//%20Transaction%0ATransaction%28Money%20value%29%20%7B%0A%09this.value%3D%20value%3B%0A%7D%0A//%20Account%0ATransaction%20transactions%5B%5D%3B%0AMoney%20balance%28%29%20%7B%0A%09Money%20sum%3D%20Money.zero%28%29%3B%0A%09for%20%28int%20i%3D%200%3B%20i%20%3C%20transactions.length%3B%20i++%29%20%0A%09%09sum%3D%20sum.plus%28transactions%5Bi%5D.value%29%3B%0A%09return%20sum%3B%0A%7D%0A%60%60%60%0A%u8FD9%u4E2A%u5199%u6CD5%u7684%u7F3A%u70B9%u662F%uFF0C%u5F53%u8981%u7B97OverallAccount%u65F6%uFF0C%u6CA1%u8F99%u4E86%uFF0C%u8981%u5B9A%u4E49%u4E00%u4E2A%u65B0%u7C7B%u6765%u5904%u7406%u3002%u4E00%u4E2AOverallAccount%u662F%u4E00%u7EC4Account%u3002%u4F46OverallAccount%u5176%u5B9E%u8981%u505A%u7684%u4E5F%u662F%u4E00%u79CD%u7D2F%u52A0%uFF0C%u548CAccount%u505A%u7684%u5E76%u6CA1%u6709%u4EC0%u4E48%u533A%u522B%u3002%u8FD9%u5C31%u662F%u91CD%u590D%u3002%0A%u89E3%u51B3%u7684%u529E%u6CD5%u5C31%u662F%u6240%u8C13%u7684Composite%u3002%u628A%u8981%u7D2F%u52A0%u7684%u4E1C%u897F%u62BD%u8C61%u51FA%u6765%u79F0%u4E3AHoldings%uFF0CAccount%u7D2F%u52A0%u7684%u662FHoldings%uFF0COverallAccount%u7D2F%u52A0%u7684%u4E5F%u662FHoldings%u3002%0A%60%60%60java%0AHolding%20holdings%5B%5D%3B%0AMoney%20balance%28%29%20%7B%0A%09Money%20sum%3D%20Money.zero%28%29%3B%0A%09for%20%28%20%28int%20i%3D%200%3B%20i%20%3C%20holdings.length%3B%20i++%29%0A%09sum%3D%20sum.plus%28holdings%5Bi%5D.balance%28%29%29%3B%0A%09return%20sum%3B%0A%7D%0A%60%60%60%0A%u5199%u5230%u8FD9%u91CC%uFF0C%u6211%u4ECD%u7136%u4E0D%u662F%u7279%u522B%u660E%u767D%u4F55%u4E3AComposite%uFF08%u62FC%u5408%uFF0C%u590D%u5408%u7684%u610F%u601D%uFF09%u3002%u4F46%u6211%u4EEC%u662F%u7AD9%u5728%u5DE8%u4EBA%u7684%u80A9%u8180%u4E0A%uFF0C%u5BF9%u6BD4%u9605%u8BFB%u4E86%u4E2D%u6587%u8BD1%u672C%u540E%u6709%u4E86%u4E00%u70B9%u70B9%u611F%u89C9%u3002%u8FD9%u4E2A%u8BBE%u8BA1%u6A21%u5F0F%u7684%u4E2D%u6587%u8BD1%u540D%u4E3A-**%u9012%u5F52%u7EC4%u5408**%u3002%u6240%u8C13%u9012%u5F52%uFF0C%u5E94%u5F53%u6307%u7684%u662F%uFF0C%u901A%u8FC7%u6982%u5FF5%u4E0A%u7684%u62BD%u8C61%uFF0C%u5C06%u4E00%u4E2A%u5927%u7684%u6DF7%u5408%u7C7B%u5199%u6210%u4E00%u4E9B%u66F4%u62BD%u8C61%u7684%u6982%u5FF5%u7684%u7EC4%u5408%u3002%u4F8B%u5982%3A%20%0A%3EOvreallAccount%20%3C-%20Account%20%3C-%20Transactions%0A%3EOverallAccount%20%3C-%20Holding%20%26%20Account%20%3C-Holding%0A%0A%u901A%u8FC7%u9012%u5F52%u5730%u5C06OverallAccount%u5192%u540D%u9876%u66FF%u6210Holding%uFF0C%u4ECE%u800C%u4F7FOverallAccount%u6210%u4E3A%u4E00%u4E2AAccount%u6765%u8FBE%u5230%u6D88%u9664%u91CD%u590D%u3002%0A%u4F5C%u8005%u5728%u672C%u8282%u6700%u540E%u7ED9%u51FA%u4E86%u4F55%u65F6%u4F7F%u7528Composite%u7684%u5EFA%u8BAE%uFF1A%0A%3EAs%20is%20obvious%20from%20this%20discussion%2C%20I%27m%20still%20not%20able%20to%20articulate%20how%20to%20guess%20when%20a%20collection%20of%20objects%20is%20just%20a%20collection%20of%20objects%20and%20when%20you%20really%20have%20a%20Composite.%20The%20good%20news%20is%2C%20since%20you%27re%20getting%20good%20at%20refactoring%2C%20%3Cb%3E%3Cfont%20color%3D%22IndianRed%22%3Ethe%20moment%20the%20duplication%20appears%3C/font%3E%3C/b%3E%2C%20you%20can%20introduce%20Composite%20and%20watch%20program%20complexity%20disappear.%0A%0A%23%23%23Collecting%20Parameter%0A%u770B%u4E0D%u61C2%uFF0C%u4E0D%u77E5%u6240%u4E91%0A%0A%23%23%23Singleton%0A%u8FD9%u4E2A%u5C31%u662F%u5F88%u8457%u540D%u7684%u5355%u4F8B%u6A21%u5F0F%uFF0C%u7ECF%u5E38%u4F1A%u7528%u5230%u3002%u4F5C%u8005%u6CA1%u6709%u8BE6%u52A0%u9610%u91CA%uFF0C%u53EA%u662F%u544A%u8BEB%u8BFB%u8005%u4E0D%u8981%u7528%u5168%u5C40%u53D8%u91CF%28global%20variable%29%u3002%u6211%u731C%u4F5C%u8005%u7684%u610F%u601D%u662F%uFF0C%u5982%u679C%u8981%u7528%u5168%u5C40%u53D8%u91CF%uFF0C%u5C31%u7528%u5355%u4F8B%u6A21%u5F0F%u7684%u7C7B%u5BF9%u8C61%u5427%u3002%0A%0A%23%23Chapter%2031.%20Refactoring%0A%u5728TDD%u4E2D%uFF0C%u91CD%u6784%u8981%u505A%u7684%u5C31%u662F%uFF0C%u4FDD%u8BC1%u6240%u6709%u6D4B%u8BD5%u901A%u8FC7%u7684%u60C5%u51B5%u4E0B%uFF0C%u964D%u4F4E%u91CD%u590D%uFF08code%u4E4B%u95F4%uFF0Ccode%u4E0Etest%u4E4B%u95F4%uFF09%u3002%0A%23%23%23Reconcile%20Differences%0A%3E-%20How%20do%20you%20unify%20two%20similar%20looking%20pieces%20of%20code%3F%20Gradually%20bring%20them%20closer.%20Unify%20them%20only%20when%20they%20are%20absolutely%20identical.%20%u4E0D%u8981%u5F3A%u5236%u6574%u5408%uFF0C%u7B49%u4ED6%u4EEC%u5B8C%u5168%u76F8%u7B49%u4E86%u518D%u8BF4%0A%3E-%20Such%20a%20leap-of-faith%20refactoring%20is%20exactly%20what%20we%27re%20trying%20to%20avoid%20with%20our%20strategy%20of%20small%20steps%20and%20concrete%20feedback.%20Although%20you%20can%27t%20always%20avoid%20leapy%20refactorings%2C%20you%20can%20reduce%20their%20incidence.%20%u4E0D%u8981%u505A%u8DE8%u8D8A%u5F0F%u7684%u91CD%u6784%u3002%0A%3E-%20Sometimes%20you%20need%20to%20approach%20reconciling%20differences%20backward%u2014that%20is%2C%20think%20about%20how%20the%20last%20step%20of%20the%20change%20could%20be%20trivial%2C%20then%20work%20backward.%20%u53CD%u5411%u601D%u8003%uFF0C%u5C3D%u91CF%u8BA9%u6BCF%u4E00%u6B65%u90FD%u975E%u5E38%u5C0F%28trivial%29%uFF0C%u8FD9%u6837%u65B9%u4FBF%u56DE%u9000%u3002%0A%0A%23%23%23Isolate%20Change%0A%u9694%u79BB%u6539%u52A8%uFF0C%u4E5F%u5C31%u662F%u6211%u4EEC%u901A%u5E38%u505A%u7684%u4E00%u4E9B%u62BD%u8C61%u5C01%u88C5%u3002%u628A%u53D8%u5316%u7684%u90E8%u5206%u7528%u63A5%u53E3%u5305%u88C5%u8D77%u6765%uFF0C%u8FD9%u6837%u5C31%u8FBE%u5230%u4E86%u9694%u79BB%u7684%u6548%u679C%u3002%0A%3ESome%20possible%20ways%20to%20isolate%20change%20are%20Extract%20Method%20%28the%20most%20common%29%2C%20Extract%20Object%2C%20and%20Method%20Object.%0A%0A%23%23%23Migrate%20Data%0A%u4E0D%u77E5%u6240%u4E91%0A%0A%23%23%23Extract%20Method%0A%3EHow%20do%20you%20make%20a%20long%2C%20complicated%20method%20easier%20to%20read%3F%20Turn%20a%20small%20part%20of%20it%20into%20a%20separate%20method%20and%20call%20the%20new%20method.%20%u5C06%u4E00%u4E2A%u5927%u51FD%u6570%u6253%u788E%uFF0C%u4ECE%u4E2D%u63D0%u53D6%u4E00%u4E9B%u65B9%u6CD5%u51FA%u6765%u3002%0A%23%23%23%23%20How%0A%3E1.%20Find%20a%20region%20of%20the%20method%20that%20would%20make%20sense%20as%20its%20own%20method.%20Bodies%20of%0Aloop%2C%20whole%20loops%2C%20and%20branches%20of%20conditionals%20are%20common%20candidates%20for%20extraction.%0A%3E2.%20Make%20sure%20that%20there%20are%20no%20assignments%20to%20temporary%20variables%20declared%20outside%20the%0Ascope%20of%20the%20region%20to%20be%20extracted.%0A%3E3.%20Copy%20the%20code%20from%20the%20old%20method%20to%20the%20new%20method.%20Compile%20it.%0A%3E4.%20For%20each%20temporary%20variable%20or%20parameter%20of%20the%20original%20method%20used%20in%20the%20new%0Amethod%2C%20add%20a%20parameter%20to%20the%20new%20method.%0A%3E5.%20Call%20the%20new%20method%20from%20the%20original%20method.%0A%0A%23%23%23%23Why%0A1.%20%u589E%u5F3A%u53EF%u8BFB%u6027%0A2.%20%u6D88%u9664%u91CD%u590D%uFF0C%u5F53%u4F60%u53D1%u73B0%u6709%u4E24%u4E2A%u5927%u51FD%u6570%uFF0C%u6709%u4E00%u90E8%u5206%u662F%u76F8%u540C%u7684%uFF0C%u90A3%u5C31%u53EF%u4EE5%u63D0%u53D6%u51FA%u6765%u79F0%u4E3A%u65B0%u7684%u65B9%u6CD5%u3002%0A3.%20%u901A%u8FC7inline%u628A%u4E00%u5806%u51FD%u6570%u653E%u5728%u4E00%u8D77%uFF0C%u7136%u540E%u770B%u770B%u54EA%u91CC%u53EF%u4EE5extract%20%uFF08%u8FD9%u4E00%u70B9%u6211%u611F%u89C9%u5E94%u8BE5%u653E%u5728How%u91CC%u9762%uFF0C%u4F5C%u8005%u662F%u60F3%u627F%u4E0A%u542F%u4E0B%uFF0C%u5C06inline%u5427%uFF09%0A%0A%23%23%23Inline%20Method%0Ainline%u5F88%u7384%u4E4E%uFF0C%u5176%u5B9E%u5C31%u662F%u628A%u51FD%u6570%u7684%u4EE3%u7801%u590D%u5236%u5230%u8C03%u7528%u7684%u5730%u65B9%u3002%u597D%u5904%u662F%u4EC0%u4E48%uFF0C%u4F5C%u8005%u6709%u8BDD%u8BF4%uFF1A%0A%3EYou%20might%20like%20the%20second%20version%20better%2C%20or%20you%20might%20not.%20The%20point%20to%20note%20here%20is%20that%20you%20can%20use%20Inline%20Method%20to%20play%20around%20with%20the%20**flow%20of%20control**.%20%0A%u5176%u5B9E%u5C31%u662F%u8BA9%u4F60%u628A%u62BD%u8C61%u51FA%u6765%u7684%u4E1C%u897F%u653E%u5230%u4E00%u8D77%u91CD%u65B0%u62BD%u8C61%uFF0C%u770B%u770B%u4F1A%u4E0D%u4F1A%u6709%u66F4%u597D%u7684%u7ED3%u679C%u3002%u8FD9%u4E5F%u662F%u4E00%u79CD%u91CD%u6784%u7684%u65B9%u6CD5%u3002%0A%0A%23%23%23Extract%20Interface%0A%23%23%23%23How%0A%u5982%u4F55%u5C06%u4E00%u4E2A%u7C7B%u62BD%u8C61%u6210%u4E00%u4E2Ainterface%u3002%u6240%u8C13%u7684interface%u5C31%u662F%u53EA%u6709%u7EAF%u865A%u51FD%u6570%u7684%u7C7B%u3002%0A%3E1.%20Declare%20an%20interface.%20Sometimes%20the%20name%20of%20the%20existing%20class%20should%20be%20the%20name%20of%20the%20interface%2C%20in%20which%20case%20you%20should%20first%20rename%20the%20class.%0A%3E2.%20Have%20the%20existing%20class%20implement%20the%20interface.%0A%3E3.%20Add%20the%20necessary%20methods%20to%20the%20interface%2C%20expanding%20the%20visibility%20of%20the%20methods%20in%20the%20class%20if%20necessary.%0A%3E4.%20Change%20type%20declarations%20from%20the%20class%20to%20the%20interface%20where%20possible.%0A%0A%23%23%23%23Why%0A%u8FD9%u91CC%u63D0%u5230%u4E86%u4E24%u79CD%u60C5%u51B5%uFF1A%0A1.%20%u5F53%u4F60%u9700%u8981%u62BD%u8C61%u51FA%u7236%u7C7B%u65F6%0A2.%20%u5F53%u4F60%u7528%u4E86Mock%20Object%uFF0C%u73B0%u5728%u8981%u4E3A%u8FD9%u4E2Amock%20object%u62BD%u8C61%u51FA%u4E00%u4E2A%u771F%u6B63%u7684%u63A5%u53E3%u65F6%u3002%u4F5C%u8005%u8FD9%u91CC%u63D0%u5230%u4E86%u4E00%u4E2A%u5C0F%u6280%u5DE7%uFF0C%u5728%u8FD9%u79CD%u60C5%u51B5%u4E0B%u547D%u540D%u662F%u4E00%u4E2A%u5934%u75BC%u7684%u95EE%u9898%u3002%u4E0D%u59A8%u5C31%u628A%u65B0%u7684interface%u79F0%u4E3AIXXX%uFF0C%u4F8B%u5982%uFF0C%u539F%u6765%u7684%u53EB%60File%60%uFF0C%u65B0%u7684%u63A5%u53E3%u5C31%u79F0%u4E3A%60IFile%60%0A%0A%23%23%23Move%20Method%0A%u5176%u5B9E%u5C31%u662F%u628A%u4E00%u4E2A%u7C7B%u7684%u65B9%u6CD5%u79FB%u5230%u53E6%u5916%u4E00%u4E2A%u7C7B%u91CC%u9762%u3002%u4F46%u4F5C%u8005%u63D0%u5230%u4E86%u4E00%u79CD%u60C5%u51B5%u4E0B%uFF0C%u8FD9%u4E2A%u65B9%u6CD5%u4E0D%u9002%u7528%u3002%u5C31%u662F%u8FD9%u4E2A%u65B9%u6CD5%u4FEE%u6539%u4E86%u539F%u5148%u90A3%u4E2A%u7C7B%u7684%u6570%u636E%u3002%0A%0A%23%23%23Method%20Object%0A%u8FD9%u4E2A%u8BDD%u9898%u597D%u50CF%u5F88%u65B0%u9C9C%uFF0C%u4E4B%u524D%u770B%u5230%u8FC7%u5F88%u591A%u6B21%uFF0C%u4F46%u5E76%u6CA1%u6709%u6DF1%u7A76%u3002%u5148%u770B%u770BHow%uFF1A%0A%23%23%23%23How%0A%3E1.%20Create%20an%20object%20with%20the%20same%20parameters%20as%20the%20method.%0A%3E2.%20Make%20the%20local%20variables%20also%20instance%20variables%20of%20the%20object.%0A%3E3.%20Create%20one%20method%20called%20run%28%29%2C%20whose%20body%20is%20the%20same%20as%20the%20body%20of%20the%20original%20method.%0A%3E4.%20In%20the%20original%20method%2C%20create%20a%20new%20object%20and%20invoke%20run%28%29.%0A%0A%u6709%u4EC0%u4E48%u597D%u5904%uFF1F%0A%23%23%23%23Why%0A%u4E24%u4E2A%u597D%u5904%0A1.%20%u5728%u6DFB%u52A0%u590D%u6742%u903B%u8F91%u7684%u65F6%u5019%uFF0C%u5982%u679C%u6709%u5BF9%u4E00%u4E2A%u8FC7%u7A0B%u6709%u591A%u79CD%u65B9%u6CD5%uFF0C%u90A3%u521B%u5EFA%u4E00%u4E2A%u65B9%u6CD5%u5BF9%u8C61%uFF0C%u518D%u6269%u5C55%u8D77%u6765%u5C31%u5F88%u7B80%u5355%0A2.%20%u5728%u4E00%u4E2A%u590D%u6742%u51FD%u6570%u91CCextract%20interface%u7684%u65F6%u5019%uFF0C%u901A%u5E38%u4E00%u6BB5code%u9700%u89815%uFF0C6%u4E2A%u53C2%u6570%uFF0C%u8FD9%u6837%u7684%u8BDD%uFF0C%u867D%u7136%u51FD%u6570%u62BD%u53D6%u51FA%u6765%u4E86%uFF0C%u4F46%u662F%u5199%u6CD5%u5E76%u6CA1%u6709%u7B80%u5316%u591A%u5C11%u3002%u8FD9%u65F6%u5019%u5982%u679C%u6709%u65B9%u6CD5%u5BF9%u8C61%uFF0C%u5219%u5728%u7C7B%u91CC%u9762%u662F%u4E00%u4E2A%u72EC%u7ACB%u7684%u540D%u5B57%u7A7A%u95F4%uFF0C%u4F1A%u63D0%u4F9B%u989D%u5916%u7684%u4FBF%u5229%u3002%0A%0A%23%23%23Add%20Parameter%0A%u5C31%u662F%u52A0%u4E00%u4E2A%u53C2%u6570%uFF0C%u6CA1%u4EC0%u4E48%u7279%u522B%u7684%0A%0A%23%23%23Method%20Parameter%20to%20Constructor%20Parameter%0A%u5C31%u662F%u628A%u65B9%u6CD5%u8C03%u7528%u7684%u53C2%u6570%uFF0C%u53D8%u6210%u7C7B%u6210%u5458%u53D8%u91CF%u3002%u4E3A%u4EC0%u4E48%u8981%u8FD9%u4E48%u505A%uFF1F%0A%3EIf%20you%20pass%20the%20same%20parameter%20to%20several%20different%20methods%20in%20the%20same%20object%2C%20then%20you%20can%20simplify%20the%20API%20by%20passing%20the%20parameter%20once%20%28eliminating%20duplication%29.%20You%20can%20run%20this%20refactoring%20in%20reverse%20if%20you%20find%20that%20an%20instance%20variable%20is%20used%20in%20only%20one%20method.%0A%0A%u8FD9%u4E2A%u65B9%u6CD5%u7B80%u5355%u5B9E%u7528%u3002%0A%0A%23%23Chapter%2032.%20Mastering%20TDD%0A%u7ECF%u8FC731%u7AE0%u7684%u5B66%u4E60%uFF0C%u4F5C%u8005%u8BA4%u4E3A%u6211%u4EEC%u5DF2%u7ECF%u5B8C%u5B8C%u5168%u5168%u6709%u80FD%u529B%u6210%u4E3A%u4E00%u4E2A%u5408%u683C%u7684TDD%u7A0B%u5E8F%u5458%u4E86%u3002%u5728%u8FD9%u4E00%u7AE0%u91CC%uFF0C%u4F5C%u8005%u53C8%u603B%u7ED3%u51FA%u5F88%u591ATDD%u521D%u5B66%u8005%u7684%u95EE%u9898%uFF0C%u7ED9%u4E88%u56DE%u7B54%u3002%u7B54%u6848%u90FD%u662F%u4E00%u4E9B%u5F88%u5B9E%u7528%u7684%u5FE0%u544A%uFF0C%u7279%u6458%u53D6%u5982%u4E0B%u3002%0A%0A%23%23%23What%20don%27t%20you%20have%20to%20test%3F%0A%u4F5C%u8005%u5E76%u6CA1%u6709%u76F2%u76EE%u5F3A%u8C03%u6D4B%u8BD5%u91CD%u8981%uFF0C%u4E5F%u6CA1%u6709%u8BF4%u4EFB%u4F55%u5730%u65B9%u90FD%u8981%u5199%u6D4B%u8BD5%u3002%u4F5C%u8005%u8BF4%uFF1A%0A%3EUnless%20you%20have%20reason%20to%20distrust%20it%2C%20don%27t%20test%20code%20from%20others.%20%0A%3E%22Write%20tests%20until%20fear%20is%20transformed%20into%20boredom.%22%0A%0A%u53EA%u5728%u4F60%u4E0D%u76F8%u4FE1%u4F60%u7684code%u65F6%uFF0C%u5BF9%u4ED6%u8FDB%u884C%u6D4B%u8BD5%u3002%u6D4B%u8BD5%u4E5F%u4E0D%u662F%u4E3A%u4E86%u6D4B%u8BD5%u800C%u6D4B%u8BD5%uFF0C%u6216%u8005%u4E3A%u4E86%u4EE3%u7801%u7684%u5065%u58EE%uFF0C%u6D4B%u8BD5%u53EA%u662F%u4E3A%u4E86%u51CF%u5C11%u4F60%u7684%u7126%u8651%u3002%u8BA9%u4F60%u4E0D%u8981%u4ECE%u62C5%u5FC3%u53D8%u6210%u70E6%u8E81%uFF0C%u4EC5%u6B64%u800C%u5DF2%u3002%0A%u54CE%uFF01%u771F%u662F%u918D%u9190%u704C%u9876%uFF01%u76F8%u89C1%u6068%u665A%uFF01%0A%0A%23%23%23How%20do%20you%20know%20if%20you%20have%20good%20tests%3F%0A%u4EC0%u4E48%u6837%u7684%u6D4B%u8BD5%u4E0D%u597D%uFF1F%0A%3E1.%20Long%20setup%20code.%20%u5982%u679C%u4E3A%u4E86%u505A%u4E00%u4E2A%u7B80%u5355%u7684%u6D4B%u8BD5%uFF0C%u53EF%u80FD%u53EA%u6709%u51E0%u884C%u65AD%u8A00%uFF0C%u800C%u4E3A%u6B64%u521B%u5EFA%u4E00%u4E2A%u5DE8%u5927%u7684%u5BF9%u8C61%uFF0C%u90A3%u8BF4%u660E%u54EA%u91CC%u80AF%u5B9A%u51FA%u95EE%u9898%u4E86%u3002%0A%3E2.%20Setup%20duplication.%20%u5982%u679C%u4F60%u53D1%u73B0%u6709%u51E0%u4E2A%u6D4B%u8BD5%u62E5%u6709%u76F8%u540C%u6216%u76F8%u4F3C%u7684setup%u4EE3%u7801%uFF0C%u90A3%u8BF4%u660E%u4F60%u7684%u6D4B%u8BD5%u4E2D%u6709%u91CD%u590D%u7684%u5730%u65B9%u3002%0A%3E3.%20Long%20running%20tests.%20TDD%20tests%20that%20run%20a%20long%20time%20won%27t%20be%20run%20often.%20Suites%20that%20take%20longer%20than%20ten%20minutes%0Ainevitably%20get%20trimmed.%20%u4E00%u4E2A%u6D4B%u8BD5%u5957%u4EF6%u4E0D%u8981%u8D85%u8FC7%u5341%u5206%u949F%u3002%u5426%u5219%uFF0C%u53CD%u590D%u8FD0%u884C%u7684%u673A%u4F1A%u5C31%u4F1A%u6025%u5267%u964D%u4F4E%u3002%0A%3E4.%20Fragile%20tests.%20Tests%20that%20break%20unexpectedly%20suggest%20that%20one%20part%20of%20the%20application%20is%20surprisingly%20affecting%20another%20part.%20%u5982%u679C%u6D4B%u8BD5%u88AB%u65E0%u60C5%u6253%u65AD%uFF0C%u8BF4%u660E%u4F60%u7684%u7A0B%u5E8F%u91CC%u6709%u8026%u5408%u3002%0A%0A%23%23%23How%20does%20TDD%20lead%20to%20frameworks%3F%0A%u53C8%u88AB%u918D%u9190%u704C%u9876%u4E86%uFF01%0A%3ETDD%20appears%20to%20stand%20this%20advice%20on%20its%20head%3A%20%3Cb%3E%3Cfont%20color%3D%22IndianRed%22%3E%22Code%20for%20tomorrow%2C%20design%20for%20today.%22%20%3C/font%3E%3C/b%3EHere%27s%20what%20happens%20in%20practice.%20%u4E0D%u8981%u4E3A%u672A%u6765%u8003%u8651%u90A3%u4E48%u591A%uFF0C%u7B80%u5355%u7684%u8BA9%u6D4B%u8BD5%u901A%u8FC7%uFF0C%u7136%u540E%u53CA%u65F6%u7684%u505A%u91CD%u6784%u6D88%u9664%u91CD%u590D%uFF0C%u53CD%u800C%u80FD%u8FBE%u5230%u66F4%u597D%u7684%u8BBE%u8BA1%u6846%u67B6%uFF08frameworks%uFF09%u3002%0A%0A%23%23%23How%20much%20feedback%20do%20you%20need%3F%0A%u8FD9%u91CC%u8BF4%u7684%u548C%u4E4B%u524D%u4E00%u76F4%u5F3A%u8C03%u7684%u601D%u60F3%u5F88%u4E00%u81F4%0A%3E%20If%20our%20knowledge%20of%20the%20implementation%20gives%20us%20confidence%20even%20without%20a%20test%2C%20then%20we%20will%20not%20write%20that%20test.%20%0A%0A%23%23%23When%20should%20you%20delete%20tests%3F%0A%3E1.%20The%20first%20criterion%20for%20your%20tests%20is%20**confidence**.%20Never%20delete%20a%20test%20if%20it%20reduces%20your%20confidence%20in%20the%20behavior%20of%20the%20system.%0A%3E2.%20The%20second%20criterion%20is%20**communication**.%20If%20you%20have%20two%20tests%20that%20exercise%20the%20same%20path%20through%20the%20code%2C%20but%20they%20speak%20to%20different%20scenarios%20for%20a%20reader%2C%20leave%20them%20alone.%0A%0A%23%23%23Can%20you%20drive%20development%20with%20application-level%20tests%3F%0A%u4E0D%u8981%u5C1D%u8BD5%u505A%u5E94%u7528%u7EA7%u522B%u7684test%0A%0A%23%23%23How%20do%20you%20switch%20to%20TDD%20midstream%3F%0A%u8FD9%u4E5F%u662F%u6211%u60F3%u95EE%u7684%uFF0C%u4F5C%u8005%u7684%u56DE%u7B54%u662F%u8FD9%u672C%u4E66%u5C31%u662F%u4E3A%u4E86%u8FD9%u4E2A%u800C%u5199%u7684%u3002%0A%3EThere%20is%20a%20whole%20book%20%28or%20books%29%20to%20be%20written%20about%20switching%20to%20TDD%20when%20you%20have%20lots%20of%20code.%20What%20follows%20is%20necessarily%20only%20a%20teaser.%0A%0A%u600E%u4E48%u505A%uFF1F%0A1.%20So%20first%20we%20have%20to%20decide%20to%20limit%20the%20scope%20of%20our%20changes.%20%0A2.%20Second%2C%20we%20have%20to%20break%20the%20deadlock%20between%20tests%20and%20refactoring.%20%0A%093.%20%u600E%u4E48%u83B7%u5F97feedback%0A%09%091%29%20We%20can%20get%20feedback%20other%20ways%20than%20with%20tests%2C%20like%20working%20very%20carefully%20and%20with%20a%20partner.%20%0A%09%092%29%20We%20can%20get%20feedback%20at%20a%20gross%20level%2C%20like%20system-level%20tests%20that%20we%20know%20aren%27t%20adequate%20but%20give%20us%20some%20confidence.%20With%20this%20feedback%2C%20we%20can%20make%20the%20areas%20we%20have%20to%20change%20more%20accepting%20of%20change.%0A%0A%23%23%23How%20does%20TDD%20relate%20to%20the%20practices%20of%20Extreme%20Programming%3F%0A%u540D%u8BCD%u89E3%u91CA%uFF1A%5BExtreme%20Programming%20-%20XP%5D%28http%3A//baike.baidu.com/link%3Furl%3DNgfFcw4hxjOQHRtEArm4buq177_Xw562MDhrOykDcd-0EOv1xB_Oz3eslAn9X65cFdUel2xI7tTiqB3Gqyz3Ja%29%u6781%u9650%u7F16%u7A0B%0A%3E%u6781%u9650%u7F16%u7A0B%u662F%u4E00%u4E2A%u8F7B%u91CF%u7EA7%u7684%u3001%u7075%u5DE7%u7684%u8F6F%u4EF6%u5F00%u53D1%u65B9%u6CD5%uFF1B%u540C%u65F6%u5B83%u4E5F%u662F%u4E00%u4E2A%u975E%u5E38%u4E25%u8C28%u548C%u5468%u5BC6%u7684%u65B9%u6CD5%u3002%u5B83%u7684%u57FA%u7840%u548C%u4EF7%u503C%u89C2%u662F%u4EA4%u6D41%u3001%u6734%u7D20%u3001%u53CD%u9988%u548C%u52C7%u6C14%uFF1B%u5373%uFF0C%u4EFB%u4F55%u4E00%u4E2A%u8F6F%u4EF6%u9879%u76EE%u90FD%u53EF%u4EE5%u4ECE%u56DB%u4E2A%u65B9%u9762%u5165%u624B%u8FDB%u884C%u6539%u5584%uFF1A%u52A0%u5F3A%u4EA4%u6D41%uFF1B%u4ECE%u7B80%u5355%u505A%u8D77%uFF1B%u5BFB%u6C42%u53CD%u9988%uFF1B%u52C7%u4E8E%u5B9E%u4E8B%u6C42%u662F%u3002XP%u662F%u4E00%u79CD%u8FD1%u87BA%u65CB%u5F0F%u7684%u5F00%u53D1%u65B9%u6CD5%uFF0C%u5B83%u5C06%u590D%u6742%u7684%u5F00%u53D1%u8FC7%u7A0B%u5206%u89E3%u4E3A%u4E00%u4E2A%u4E2A%u76F8%u5BF9%u6BD4%u8F83%u7B80%u5355%u7684%u5C0F%u5468%u671F%uFF1B%u901A%u8FC7%u79EF%u6781%u7684%u4EA4%u6D41%u3001%u53CD%u9988%u4EE5%u53CA%u5176%u5B83%u4E00%u7CFB%u5217%u7684%u65B9%u6CD5%uFF0C%u5F00%u53D1%u4EBA%u5458%u548C%u5BA2%u6237%u53EF%u4EE5%u975E%u5E38%u6E05%u695A%u5F00%u53D1%u8FDB%u5EA6%u3001%u53D8%u5316%u3001%u5F85%u89E3%u51B3%u7684%u95EE%u9898%u548C%u6F5C%u5728%u7684%u56F0%u96BE%u7B49%uFF0C%u5E76%u6839%u636E%u5B9E%u9645%u60C5%u51B5%u53CA%u65F6%u5730%u8C03%u6574%u5F00%u53D1%u8FC7%u7A0B%u3002%0A%0ATDD%u4E0EXP%u7684%u5171%u901A%u4E4B%u5904%uFF1A%0A-%20Pairing%0A-%20Work%20fresh%0A-%20Continuous%20integration%0A-%20Simple%20design%0A-%20Refactoring%0A-%20Continuous%20delivery]]></content>
      <tags>
        <tag>读书笔记</tag>
        <tag>unittest</tag>
        <tag>Programming</tag>
        <tag>TDD</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDB连接]]></title>
    <url>%2F2016%2F01%2F25%2FMongoDB%E8%BF%9E%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[Edit&#x5B66;&#x4E60;&#x7B14;&#x8BB0; mongo &#x540D;&#x8BCD;&#x89E3;&#x91CA;shard&#x5B98;&#x65B9;&#x6587;&#x6863;Sharding Introduction&#xFF1A;Sharding is a method for storing data across multiple machines.&#x4E2D;&#x6587;&#x79F0;&#x4E3A;&#x5206;&#x7247;&#x3002;&#x53C2;&#x8003;8&#x5929;&#x5B66;&#x901A;MongoDB&#x2014;&#x2014;&#x7B2C;&#x516D;&#x5929; &#x5206;&#x7247;&#x6280;&#x672F;&#x3002;sharded cluster&#x7247;&#x7C07;replica setA replica set in MongoDB is a group of mongod processes that maintain the same data set. Replica sets provide redundancy and high availability, and are the basis for all production deployments. &#x6BCF;&#x4E00;&#x4E2A;replica set&#x53EF;&#x4EE5;&#x6709;&#x81EA;&#x5DF1;&#x7684;tag&#x6765;&#x63A7;&#x5236;read preference&#x548C;write concern&#xFF0C;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;Configure Replica Set Tag Sets&#x3002;write concern&#x5B98;&#x65B9;&#x6587;&#x6863;Write ConcernWrite concern describes the level of acknowledgement requested from MongoDB for write operations to a standalone mongod or to replica sets or to sharded clusters. In sharded clusters, mongos instances will pass the write concern on to the shards.Write concern can include the following fields:{ w: \&lt;value\&gt;, j: \&lt;boolean\&gt;, wtimeout: \&lt;number\&gt; }w: 1 - &#x6709;acknowledgement&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;; 0 - &#x6CA1;&#x6709;acknowledgement&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x53EF;&#x80FD;&#x628A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4F20;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;w: &#x2018;majority&#x2019; &amp; &#x2018;\\&#x2019; &#x524D;&#x8005;&#xFF1A;Requests acknowledgment that write operations have propagated to the majority of voting nodes [1], including the primary, and have been written to the on-disk journal for these nodes. &#x6B64;&#x9009;&#x9879;&#x5305;&#x542B;&#x4E86;j: true&#x3002;&#x540E;&#x8005;&#xFF1A;Requests acknowledgement that the write operations have propagated to a replica set member with the specified tag.j: true &amp; false, &#x51B3;&#x5B9A;&#x662F;&#x5426;&#x5199;journalwtimeout: This option specifies a time limit, in milliseconds, for the write concern. wtimeout is only applicable for w values greater than 1.If you specify w: 0 but include j: true, the j: true prevails to request acknowledgement from the standalone mongod or the primary of a replica set.journalA sequential, binary transaction log used to bring the database into a valid state in the event of a hard shutdown. Journaling writes data first to the journal and then to the core data files. MongoDB enables journaling by default for 64-bit builds of MongoDB version 2.0 and newer. Journal files are pre-allocated and exist as files in the data directory. See Journaling.mongosmongos for &#x201C;MongoDB Shard,&#x201D; is a routing service for MongoDB shard configurations that processes queries from the application layer, and determines the location of this data in the sharded cluster, in order to complete these operations. From the perspective of the application, a mongos instance behaves identically to any other MongoDB instance.mongos vs. mongodmongodb&#x91C7;&#x7528;&#x5C06;&#x96C6;&#x5408;&#x8FDB;&#x884C;&#x62C6;&#x5206;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x62C6;&#x5206;&#x7684;&#x6570;&#x636E;&#x5747;&#x644A;&#x5230;&#x51E0;&#x4E2A;&#x7247;&#x4E0A;&#x7684;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002; &#x8FDE;&#x63A5;mongo&#x6570;&#x636E;&#x5E93;&#x6211;&#x6536;&#x96C6;&#x4E86;&#x597D;&#x51E0;&#x7BC7;&#x8BB2;&#x5982;&#x4F55;&#x66F4;&#x597D;&#x7684;&#x8FDE;&#x63A5;mongo&#x6570;&#x636E;&#x5E93;&#x7684;&#x6587;&#x7AE0;&#x3002;&#x53C2;&#x8003;&#x4E0B;&#x9762;&#x7684;&#x7B14;&#x8BB0;&#xFF1A; mongodb&#x9A71;&#x52A8;&#x7684;&#x6B63;&#x786E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5; mongodb &#x8FDE;&#x63A5;&#x7684;&#x95EE;&#x9898; node-mongo-native1.3.19&#x8FDE;&#x63A5;mongo&#x7684;&#x6700;&#x4F18;&#x65B9;&#x6CD5; &#x8FD8;&#x6709;node.js&#x7684;MongoDB driverd&#x7684;&#x5B98;&#x65B9;&#x4ECB;&#x7ECD;&#xFF1A; MongoClient or how to connect in a new and better way &#x8FD8;&#x6709;&#x4EBA;&#x7528;&#x8FDE;&#x63A5;&#x6C60;&#x7684; &#x751F;&#x4EA7;&#x7EA7;Nodejs&#x5F00;&#x53D1;&#x5B9E;&#x8DF5;-&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x6C60;Old Style&#x5148;&#x770B;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;1.var server_options={};2.var db_options={w:-1};3.4.var mongodb = require(&quot;mongodb&quot;),5. mongoserver = new mongodb.Server(&apos;localhost&apos;, 27017,server_options ),6. db = new mongodb.Db(&apos;test&apos;, mongoserver, db_options);7.8.var http=require(&apos;http&apos;);9.10.var server=http.createServer(function(req,res){11. db.open(function(err,db){12. if(err)return console.error(err);13. console.log(&apos;* mongodb connected&apos;);14. db.collection(&apos;foo&apos;).save({test:1},function(err,result){15. res.end(JSON.stringify(result,null,2));16. db.close();17. });18. })19.20.});&#x6BCF;&#x6765;&#x4E00;&#x4E2A;http&#x8BF7;&#x6C42;&#xFF0C;&#x5C31;&#x5F00;&#x5173;&#x4E00;&#x6B21;&#x6570;&#x636E;&#x5E93;&#x3002;&#x66F4;&#x641E;&#x7684;&#x662F;&#xFF0C;new mongodb.Server&#x7684;&#x53C2;&#x6570;server_options&#x91CC;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;poolSize&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;&#x7684;&#x8BDD;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x5C31;&#x662F;5&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6BCF;&#x5F00;&#x4E00;&#x6B21;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5F00;&#x4E86;5&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x3002;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x5728;&#x6570;&#x636E;&#x5E93;&#x8FD0;&#x884C;&#x7EC8;&#x7AEF;&#x4E2D;&#x7ECF;&#x5E38;&#x81F3;&#x5C11;&#x770B;&#x89C1;5&#x4E2A;connections&#x7684;&#x539F;&#x56E0;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;connections&#x75AF;&#x6DA8;&#x7684;&#x539F;&#x56E0;&#x3002; &#x53E6;&#x5916;&#x5728;old style&#x64CD;&#x4F5C;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;close&#x662F;&#x4E0D;&#x4F1A;close&#x8BFB;&#x8FDE;&#x63A5;&#x7684;&#xFF0C;&#x5B83;&#x53EA;&#x4F1A;close&#x5199;&#x8FDE;&#x63A5;&#xFF0C;&#x8981;&#x5F3A;&#x5236;close&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x8981;&#x7528;close(true)&#x3002;close Close the current db connection, including all the child db instances. Emits close event and calls optional callback.close([forceClose], callback) Arguments: [forceClose] (boolean) &#x2013; connection can never be reused.callback (function) &#x2013; this will be called after executing this method. The first parameter will contain the Error object if an error occurred, or null otherwise. While the second parameter will contain the results or null if an error occurred.Returns: nullNew Style&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x4EE3;&#x7801;&#xFF1A;1.var express = require(&apos;express&apos;); 2.var mongodb = require(&apos;mongodb&apos;); var app = express(); 3.4.var MongoClient = require(&apos;mongodb&apos;).MongoClient; 5.var db; 6.7.// Initialize connection once MongoClient.connect(&quot;mongodb://localhost:27017/integration_test&quot;, { 8. db: { 9. native_parser: false 10. }, 11. server: { 12. socketOptions: { 13. connectTimeoutMS: 500 14. } 15. }, 16. replSet: {}, 17. mongos: {} 18.},function(err, database) { 19. if(err) throw err; 20. db = database; 21.22. // Start the application after the database connection is ready 23. app.listen(3000); 24. console.log(&quot;Listening on port 3000&quot;); 25.}); 26.27.// Reuse database object in request handlers 28.app.get(&quot;/&quot;, function(req, res) { 29. db.collection(&quot;replicaset_mongo_client_collection&quot;).find({},function(err, docs) { 30. docs.each(function(err, doc) { 31. if(doc) { 32. console.log(doc); 33. } 34. else {35. res.end(); 36. } 37. });38. }); 39.});MongoClient.connect options&#x4E3B;&#x8981;&#x6709;&#x6765;&#x81EA;4&#x4E2A;&#x65B9;&#x9762;&#x7684;&#x8BBE;&#x7F6E;&#xFF1A;dbserverreplica setmongos &#x540E;&#x4E24;&#x4E2A;&#x9488;&#x5BF9;sharding&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x524D;&#x4E24;&#x4E2A;&#x3002;&#x4ECE;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x91CC;&#x6311;&#x51FA;&#x51E0;&#x6761;&#x914D;&#x7F6E;&#x7F57;&#x5217;&#x4E00;&#x4E0B;&#xFF1A;db: A hash of options at the db level overriding or adjusting functionality not supported by the urlw, {Number/String, &gt; -1 || &#x2018;majority&#x2019;} the write concern for the operation where &lt; 1 is no acknowledgment of write and w &gt;= 1 or w = &#x2018;majority&#x2019; acknowledges the writewtimeout, {Number, 0} set the timeout for waiting for write concern to finish (combines with w option)fsync, (Boolean, default:false) write waits for fsync before returningjournal, (Boolean, default:false) write waits for journal sync before returningreadPreference {String}, the preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).native_parser {Boolean, default:false}, use c++ bson parser.forceServerObjectId {Boolean, default:false}, force server to create _id fields instead of client.pkFactory {Object}, object overriding the basic ObjectID primary key generation.serializeFunctions {Boolean, default:false}, serialize functions.raw {Boolean, default:false}, perform operations using raw bson buffers.recordQueryStats {Boolean, default:false}, record query statistics during execution.retryMiliSeconds {Number, default:5000}, number of milliseconds between retries.numberOfRetries {Number, default:5}, number of retries off connection.bufferMaxEntries {Number, default: -1}, sets a cap on how many operations the driver will buffer up before giving up on getting a working connection, default is -1 which is unlimited.server: A hash of options at the server level not supported by the url.readPreference {String, default:null}, set&#x2019;s the read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST)ssl {Boolean, default:false}, use ssl connection (needs to have a mongod server with ssl support)slaveOk {Boolean, default:false}, legacy option allowing reads from secondary, use readPrefrence instead.poolSize {Number, default:1}, number of connections in the connection pool, set to 1 as default for legacy reasons.socketOptions {Object, default:null}, an object containing socket options to use (noDelay:(boolean), keepAlive:(number), connectTimeoutMS:(number), socketTimeoutMS:(number))logger {Object, default:null}, an object representing a logger that you want to use, needs to support functions debug, log, error ({error:function(message, object) {}, log:function(message, object) {}, debug:function(message, object) {&#125;&#125;).auto_reconnect {Boolean, default:false}, reconnect on error.disableDriverBSONSizeCheck {Boolean, default:false}, force the server to error if the BSON message is to big&#x6211;&#x4EEC;&#x5173;&#x6CE8;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x6211;&#x7528;&#x7C97;&#x4F53;&#x505A;&#x4E86;&#x6807;&#x6CE8;&#x3002;&#x53E6;&#x5916;&#x6211;&#x4EEC;&#x5728;&#x524D;&#x6587;&#x4E2D;&#x63D0;&#x5230;&#xFF0C;&#x6709;&#x4E9B;&#x6587;&#x7AE0;&#x63A8;&#x8350;&#x7528;generic-pool&#x4E3A;mongo&#x8FDE;&#x63A5;&#x63D0;&#x4F9B;&#x8FDE;&#x63A5;&#x6C60;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x53D1;&#x73B0;MongoClient.connect&#x7684;option&#x91CC;&#x5C31;&#x6709;poolSize&#x3002;&#x5728;&#x5B9E;&#x9645;&#x9879;&#x76EE;&#x4E2D;&#x76F4;&#x63A5;&#x5C06;&#x4E4B;&#x8D4B;&#x4E3A;100&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E0D;&#x9519;&#x7684;&#x6548;&#x679C;&#x3002;%23MongoDB%u8FDE%u63A5%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5Bmongo%5D%0A%23%23%u540D%u8BCD%u89E3%u91CA%0A%23%23%23%20shard%0A%u5B98%u65B9%u6587%u6863%5BSharding%20Introduction%5D%28https%3A//docs.mongodb.org/manual/core/sharding-introduction/%29%uFF1A%0A%3E%20Sharding%20is%20a%20method%20for%20storing%20data%20across%20multiple%20machines.%0A%0A%u4E2D%u6587%u79F0%u4E3A%u5206%u7247%u3002%u53C2%u8003%5B8%u5929%u5B66%u901AMongoDB%u2014%u2014%u7B2C%u516D%u5929%20%u5206%u7247%u6280%u672F%5D%28https%3A//www.evernote.com/shard/s24/nl/697376823/c9ca296a-ae2b-4833-bcb5-a37213b4cafc/%29%u3002%0A%0A%23%23%23%20sharded%20cluster%0A%u7247%u7C07%0A%0A%23%23%23%20replica%20set%0A%3EA%20replica%20set%20in%20MongoDB%20is%20a%20group%20of%20mongod%20processes%20that%20maintain%20the%20same%20data%20set.%20Replica%20sets%20provide%20redundancy%20and%20high%20availability%2C%20and%20are%20the%20basis%20for%20all%20production%20deployments.%20%0A%0A%u6BCF%u4E00%u4E2Areplica%20set%u53EF%u4EE5%u6709%u81EA%u5DF1%u7684tag%u6765%u63A7%u5236read%20preference%u548Cwrite%20concern%uFF0C%u53C2%u8003%u5B98%u65B9%u6587%u6863%5BConfigure%20Replica%20Set%20Tag%20Sets%5D%28https%3A//docs.mongodb.org/manual/tutorial/configure-replica-set-tag-sets/%23replica-set-configuration-tag-sets%29%u3002%0A%0A%23%23%23%20write%20concern%0A%u5B98%u65B9%u6587%u6863%5BWrite%20Concern%5D%28https%3A//docs.mongodb.org/manual/reference/write-concern/%29%0A%3EWrite%20concern%20describes%20the%20level%20of%20acknowledgement%20requested%20from%20MongoDB%20for%20write%20operations%20to%20a%20standalone%20mongod%20or%20to%20replica%20sets%20or%20to%20sharded%20clusters.%20In%20sharded%20clusters%2C%20mongos%20instances%20will%20pass%20the%20write%20concern%20on%20to%20the%20shards.%0A%0AWrite%20concern%20can%20include%20the%20following%20fields%3A%0A%3E%7B%20w%3A%20%5C%3Cvalue%5C%3E%2C%20j%3A%20%5C%3Cboolean%5C%3E%2C%20wtimeout%3A%20%5C%3Cnumber%5C%3E%20%7D%0A%3E%20-%20w%3A%201%20-%20%u6709acknowledgement%uFF0C%u9ED8%u8BA4%u503C%3B%200%20-%20%u6CA1%u6709acknowledgement%uFF0C%u6570%u636E%u5E93%u53EF%u80FD%u628A%u9519%u8BEF%u4FE1%u606F%u4F20%u7ED9%u5BA2%u6237%u7AEF%0A%3E%20-%20w%3A%20%u2018majority%u2019%20%26%20%27%5C%3Ctag%20set%3E%5C%27%0A%09*%20%u524D%u8005%uFF1ARequests%20acknowledgment%20that%20write%20operations%20have%20propagated%20to%20the%20majority%20of%20voting%20nodes%20%5B1%5D%2C%20including%20the%20primary%2C%20**and%20have%20been%20written%20to%20the%20on-disk%20journal%20for%20these%20nodes**.%20%u6B64%u9009%u9879%u5305%u542B%u4E86j%3A%20true%u3002%0A%09*%20%u540E%u8005%uFF1ARequests%20acknowledgement%20that%20the%20write%20operations%20have%20propagated%20to%20a%20replica%20set%20member%20with%20the%20specified%20tag.%0A%3E%20-%20j%3A%20true%20%26%20false%2C%20%u51B3%u5B9A%u662F%u5426%u5199journal%0A%3E%20-%20wtimeout%3A%20This%20option%20specifies%20a%20time%20limit%2C%20in%20milliseconds%2C%20for%20the%20write%20concern.%20wtimeout%20is%20only%20applicable%20for%20w%20values%20greater%20than%201.%0A%0A%3EIf%20you%20specify%20w%3A%200%20but%20include%20j%3A%20true%2C%20the%20j%3A%20true%20prevails%20to%20request%20acknowledgement%20from%20the%20standalone%20mongod%20or%20the%20primary%20of%20a%20replica%20set.%0A%0A%23%23%23%20journal%0A%3E%20A%20sequential%2C%20binary%20transaction%20log%20used%20to%20bring%20the%20database%20into%20a%20valid%20state%20in%20the%20event%20of%20a%20hard%20shutdown.%20Journaling%20writes%20data%20first%20to%20the%20journal%20and%20then%20to%20the%20core%20data%20files.%20MongoDB%20enables%20journaling%20by%20default%20for%2064-bit%20builds%20of%20MongoDB%20version%202.0%20and%20newer.%20Journal%20files%20are%20pre-allocated%20and%20exist%20as%20files%20in%20the%20data%20directory.%20See%20%5BJournaling%5D%28https%3A//docs.mongodb.org/manual/core/journaling/%29.%0A%0A%23%23%23%20mongos%0A**%5Bmongos%5D%28https%3A//docs.mongodb.org/manual/reference/program/mongos/%29**%20for%20%u201CMongoDB%20Shard%2C%u201D%20is%20a%20routing%20service%20for%20MongoDB%20shard%20configurations%20that%20processes%20queries%20from%20the%20application%20layer%2C%20and%20determines%20the%20location%20of%20this%20data%20in%20the%20sharded%20cluster%2C%20in%20order%20to%20complete%20these%20operations.%20From%20the%20perspective%20of%20the%20application%2C%20a%20mongos%20instance%20behaves%20identically%20to%20any%20other%20MongoDB%20instance.%0A%0A%23%23mongos%20vs.%20mongod%0Amongodb%u91C7%u7528%u5C06%u96C6%u5408%u8FDB%u884C%u62C6%u5206%uFF0C%u7136%u540E%u5C06%u62C6%u5206%u7684%u6570%u636E%u5747%u644A%u5230%u51E0%u4E2A%u7247%u4E0A%u7684%u4E00%u79CD%u89E3%u51B3%u65B9%u6848%u3002%0A%21%5BAlt%20text%5D%28./1454111696209.png%29%0A%u7B11%u8138%u662F%u7528%u6237%uFF0Cconfig%u662Fconfig%u670D%u52A1%u5668%uFF0C%u4E5F%u662F%u4E00%u4E2Amongod%u7684%u6570%u636E%u5E93%0A%0A%23%23%u8FDE%u63A5mongo%u6570%u636E%u5E93%0A%u6211%u6536%u96C6%u4E86%u597D%u51E0%u7BC7%u8BB2%u5982%u4F55%u66F4%u597D%u7684%u8FDE%u63A5mongo%u6570%u636E%u5E93%u7684%u6587%u7AE0%u3002%u53C2%u8003%u4E0B%u9762%u7684%u7B14%u8BB0%uFF1A%0A%5Bmongodb%u9A71%u52A8%u7684%u6B63%u786E%u4F7F%u7528%u65B9%u6CD5%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/5bc8092d-bccf-40cd-9ad5-9ec0b28611dd/%29%0A%5Bmongodb%20%u8FDE%u63A5%u7684%u95EE%u9898%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/bb648a45-3206-4fb9-b0a4-e4024638f6f5/%29%0A%5Bnode-mongo-native1.3.19%u8FDE%u63A5mongo%u7684%u6700%u4F18%u65B9%u6CD5%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/eac602ff-a873-4d71-bc7b-0a5650905d76/%29%0A%u8FD8%u6709node.js%u7684MongoDB%20driverd%u7684%u5B98%u65B9%u4ECB%u7ECD%uFF1A%0A%5BMongoClient%20or%20how%20to%20connect%20in%20a%20new%20and%20better%20way%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/ee17ecea-566c-4f2f-8138-79cb8ea25d8f/%29%0A%u8FD8%u6709%u4EBA%u7528%u8FDE%u63A5%u6C60%u7684%0A%5B%u751F%u4EA7%u7EA7Nodejs%u5F00%u53D1%u5B9E%u8DF5-%u4F7F%u7528%u8FDE%u63A5%u6C60%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/53bb4dd3-fd7f-4780-93ae-67faee3637a5/%29%0A%23%23%23Old%20Style%0A%u5148%u770B%u4E00%u6BB5%u4EE3%u7801%0A%60%60%60javascript%0Avar%20server_options%3D%7B%7D%3B%0Avar%20db_options%3D%7Bw%3A-1%7D%3B%0A%0Avar%20mongodb%20%3D%20require%28%22mongodb%22%29%2C%0A%20%20%20%20mongoserver%20%3D%20new%20mongodb.Server%28%27localhost%27%2C%2027017%2Cserver_options%20%29%2C%0A%20%20%20%20db%20%3D%20new%20mongodb.Db%28%27test%27%2C%20mongoserver%2C%20db_options%29%3B%0A%0Avar%20http%3Drequire%28%27http%27%29%3B%0A%0Avar%20server%3Dhttp.createServer%28function%28req%2Cres%29%7B%0A%20%20%20%20db.open%28function%28err%2Cdb%29%7B%0A%20%20%20%20%20%20%20%20if%28err%29return%20console.error%28err%29%3B%0A%20%20%20%20%20%20%20%20console.log%28%27*%20mongodb%20connected%27%29%3B%0A%20%20%20%20%20%20%20%20db.collection%28%27foo%27%29.save%28%7Btest%3A1%7D%2Cfunction%28err%2Cresult%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20res.end%28JSON.stringify%28result%2Cnull%2C2%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20db.close%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%29%0A%0A%7D%29%3B%0A%60%60%60%0A%u6BCF%u6765%u4E00%u4E2Ahttp%u8BF7%u6C42%uFF0C%u5C31%u5F00%u5173%u4E00%u6B21%u6570%u636E%u5E93%u3002%u66F4%u641E%u7684%u662F%uFF0C%60new%20mongodb.Server%60%u7684%u53C2%u6570server_options%u91CC%u53EF%u4EE5%u6709%u4E00%u4E2ApoolSize%uFF0C%u5982%u679C%u4E0D%u6307%u5B9A%u7684%u8BDD%uFF0C%u9ED8%u8BA4%u503C%u5C31%u662F5%uFF0C%u4E5F%u5C31%u662F%u8BF4%u6BCF%u5F00%u4E00%u6B21%u6570%u636E%u5E93%uFF0C%u5B9E%u9645%u4E0A%u662F%u5F00%u4E865%u4E2A%u6570%u636E%u5E93%u8FDE%u63A5%u3002%u8FD9%u4E5F%u5C31%u662F%u4E3A%u4EC0%u4E48%u6211%u4EEC%u7ECF%u5E38%u5728%u6570%u636E%u5E93%u8FD0%u884C%u7EC8%u7AEF%u4E2D%u7ECF%u5E38%u81F3%u5C11%u770B%u89C15%u4E2Aconnections%u7684%u539F%u56E0%u3002%u8FD9%u4E5F%u662F%u4E3A%u4EC0%u4E48%u6211%u4EECconnections%u75AF%u6DA8%u7684%u539F%u56E0%u3002%0A%u53E6%u5916%u5728old%20style%u64CD%u4F5C%u4EE3%u7801%u4E2D%uFF0C%u8FD8%u6709%u4E00%u70B9%u503C%u5F97%u6CE8%u610F%u7684%u662F%uFF0Cclose%u662F%u4E0D%u4F1Aclose%u8BFB%u8FDE%u63A5%u7684%uFF0C%u5B83%u53EA%u4F1Aclose%u5199%u8FDE%u63A5%uFF0C%u8981%u5F3A%u5236close%u6240%u6709%u8FDE%u63A5%u8981%u7528close%28true%29%u3002%0A%3E**close**%0AClose%20the%20current%20db%20connection%2C%20including%20all%20the%20child%20db%20instances.%20Emits%20close%20event%20and%20calls%20optional%20callback.%0A%0Aclose%28%5B*forceClose*%5D%2C%20*callback*%29%0A**Arguments**%3A%09%0A*%20**%5BforceClose%5D**%20%28*boolean*%29%20%u2013%20connection%20can%20never%20be%20reused.%0A*%20**callback**%20%28*function*%29%20%u2013%20this%20will%20be%20called%20after%20executing%20this%20method.%20The%20first%20parameter%20will%20contain%20the%20Error%20object%20if%20an%20error%20occurred%2C%20or%20null%20otherwise.%20While%20the%20second%20parameter%20will%20contain%20the%20results%20or%20null%20if%20an%20error%20occurred.%0A%0A**Returns**%3A%09null%0A%23%23%23New%20Style%0A%u53C2%u8003%u5B98%u65B9%u4EE3%u7801%uFF1A%0A%60%60%60javascript%0Avar%20express%20%3D%20require%28%27express%27%29%3B%20%0Avar%20mongodb%20%3D%20require%28%27mongodb%27%29%3B%20var%20app%20%3D%20express%28%29%3B%20%0A%0Avar%20MongoClient%20%3D%20require%28%27mongodb%27%29.MongoClient%3B%20%0Avar%20db%3B%20%0A%0A//%20Initialize%20connection%20once%20MongoClient.connect%28%22mongodb%3A//localhost%3A27017/integration_test%22%2C%20%7B%20%0A%09db%3A%20%7B%20%0A%09%09native_parser%3A%20false%20%0A%09%7D%2C%20%0A%09server%3A%20%7B%20%0A%09%09socketOptions%3A%20%7B%20%0A%09%09%09connectTimeoutMS%3A%20500%20%0A%09%09%7D%20%0A%09%7D%2C%20%0A%09replSet%3A%20%7B%7D%2C%20%0A%09mongos%3A%20%7B%7D%20%0A%7D%2Cfunction%28err%2C%20database%29%20%7B%20%0A%09if%28err%29%20throw%20err%3B%20%0A%09db%20%3D%20database%3B%20%0A%0A%09//%20Start%20the%20application%20after%20the%20database%20connection%20is%20ready%20%0A%09app.listen%283000%29%3B%20%0A%09console.log%28%22Listening%20on%20port%203000%22%29%3B%20%0A%7D%29%3B%20%0A%0A//%20Reuse%20database%20object%20in%20request%20handlers%20%0Aapp.get%28%22/%22%2C%20function%28req%2C%20res%29%20%7B%20%09%09%09%0A%09db.collection%28%22replicaset_mongo_client_collection%22%29.find%28%7B%7D%2Cfunction%28err%2C%20docs%29%20%7B%20%0A%09%09docs.each%28function%28err%2C%20doc%29%20%7B%20%0A%09%09%09if%28doc%29%20%7B%20%0A%09%09%09%09console.log%28doc%29%3B%20%0A%09%09%09%7D%20%0A%09%09%09else%20%7B%0A%09%09%09%09res.end%28%29%3B%20%0A%09%09%09%7D%20%0A%09%09%7D%29%3B%0A%09%7D%29%3B%20%0A%7D%29%3B%0A%60%60%60%0A%23%23%23MongoClient.connect%20options%0A%u4E3B%u8981%u6709%u6765%u81EA4%u4E2A%u65B9%u9762%u7684%u8BBE%u7F6E%uFF1A%0A-%20db%0A-%20server%0A-%20replica%20set%0A-%20mongos%0A%u540E%u4E24%u4E2A%u9488%u5BF9sharding%uFF0C%u8FD9%u6B21%u6211%u4EEC%u4E3B%u8981%u5173%u6CE8%u524D%u4E24%u4E2A%u3002%u4ECE%u5B98%u65B9%u6587%u6863%u91CC%u6311%u51FA%u51E0%u6761%u914D%u7F6E%u7F57%u5217%u4E00%u4E0B%uFF1A%0A%23%23%23%23db%3A%20A%20hash%20of%20options%20at%20the%20db%20level%20overriding%20or%20adjusting%20functionality%20not%20supported%20by%20the%20url%0A-%20**w**%2C%20%7BNumber/String%2C%20%3E%20-1%20%7C%7C%20%u2018majority%u2019%7D%20the%20write%20concern%20for%20the%20operation%20where%20%3C%201%20is%20no%20acknowledgment%20of%20write%20and%20w%20%3E%3D%201%20or%20w%20%3D%20%u2018majority%u2019%20acknowledges%20the%20write%0A-%20wtimeout%2C%20%7BNumber%2C%200%7D%20set%20the%20timeout%20for%20waiting%20for%20write%20concern%20to%20finish%20%28combines%20with%20w%20option%29%0A-%20fsync%2C%20%28Boolean%2C%20default%3Afalse%29%20write%20waits%20for%20fsync%20before%20returning%0A-%20**journal**%2C%20%28Boolean%2C%20default%3Afalse%29%20write%20waits%20for%20journal%20sync%20before%20returning%0A-%20readPreference%20%7BString%7D%2C%20the%20preferred%20read%20preference%20%28ReadPreference.PRIMARY%2C%20ReadPreference.PRIMARY_PREFERRED%2C%20ReadPreference.SECONDARY%2C%20ReadPreference.SECONDARY_PREFERRED%2C%20ReadPreference.NEAREST%29.%0A-%20native_parser%20%7BBoolean%2C%20default%3Afalse%7D%2C%20use%20c++%20bson%20parser.%0A-%20forceServerObjectId%20%7BBoolean%2C%20default%3Afalse%7D%2C%20force%20server%20to%20create%20_id%20fields%20instead%20of%20client.%0A-%20pkFactory%20%7BObject%7D%2C%20object%20overriding%20the%20basic%20ObjectID%20primary%20key%20generation.%0A-%20serializeFunctions%20%7BBoolean%2C%20default%3Afalse%7D%2C%20serialize%20functions.%0A-%20raw%20%7BBoolean%2C%20default%3Afalse%7D%2C%20perform%20operations%20using%20raw%20bson%20buffers.%0A-%20recordQueryStats%20%7BBoolean%2C%20default%3Afalse%7D%2C%20record%20query%20statistics%20during%20execution.%0A-%20retryMiliSeconds%20%7BNumber%2C%20default%3A5000%7D%2C%20number%20of%20milliseconds%20between%20retries.%0A-%20numberOfRetries%20%7BNumber%2C%20default%3A5%7D%2C%20number%20of%20retries%20off%20connection.%0A-%20bufferMaxEntries%20%7BNumber%2C%20default%3A%20-1%7D%2C%20sets%20a%20cap%20on%20how%20many%20operations%20the%20driver%20will%20buffer%20up%20before%20giving%20up%20on%20getting%20a%20working%20connection%2C%20default%20is%20-1%20which%20is%20unlimited.%0A%23%23%23%23server%3A%20A%20hash%20of%20options%20at%20the%20server%20level%20not%20supported%20by%20the%20url.%0A-%20readPreference%20%7BString%2C%20default%3Anull%7D%2C%20set%u2019s%20the%20read%20preference%20%28ReadPreference.PRIMARY%2C%20ReadPreference.PRIMARY_PREFERRED%2C%20ReadPreference.SECONDARY%2C%20ReadPreference.SECONDARY_PREFERRED%2C%20ReadPreference.NEAREST%29%0A-%20ssl%20%7BBoolean%2C%20default%3Afalse%7D%2C%20use%20ssl%20connection%20%28needs%20to%20have%20a%20mongod%20server%20with%20ssl%20support%29%0A-%20slaveOk%20%7BBoolean%2C%20default%3Afalse%7D%2C%20legacy%20option%20allowing%20reads%20from%20secondary%2C%20use%20readPrefrence%20instead.%0A-%20**poolSize**%20%7BNumber%2C%20default%3A1%7D%2C%20number%20of%20connections%20in%20the%20connection%20pool%2C%20set%20to%201%20as%20default%20for%20legacy%20reasons.%0A-%20socketOptions%20%7BObject%2C%20default%3Anull%7D%2C%20an%20object%20containing%20socket%20options%20to%20use%20%28noDelay%3A%28boolean%29%2C%20keepAlive%3A%28number%29%2C%20connectTimeoutMS%3A%28number%29%2C%20socketTimeoutMS%3A%28number%29%29%0A-%20logger%20%7BObject%2C%20default%3Anull%7D%2C%20an%20object%20representing%20a%20logger%20that%20you%20want%20to%20use%2C%20needs%20to%20support%20functions%20debug%2C%20log%2C%20error%20%28%7Berror%3Afunction%28message%2C%20object%29%20%7B%7D%2C%20log%3Afunction%28message%2C%20object%29%20%7B%7D%2C%20debug%3Afunction%28message%2C%20object%29%20%7B%7D%7D%29.%0A-%20auto_reconnect%20%7BBoolean%2C%20default%3Afalse%7D%2C%20reconnect%20on%20error.%0A-%20disableDriverBSONSizeCheck%20%7BBoolean%2C%20default%3Afalse%7D%2C%20force%20the%20server%20to%20error%20if%20the%20BSON%20message%20is%20to%20big%0A%0A%u6211%u4EEC%u5173%u6CE8%u7684%u9009%u9879%uFF0C%u6211%u7528%u7C97%u4F53%u505A%u4E86%u6807%u6CE8%u3002%0A%0A%u53E6%u5916%u6211%u4EEC%u5728%u524D%u6587%u4E2D%u63D0%u5230%uFF0C%u6709%u4E9B%u6587%u7AE0%u63A8%u8350%u7528generic-pool%u4E3Amongo%u8FDE%u63A5%u63D0%u4F9B%u8FDE%u63A5%u6C60%u3002%u4F46%u662F%uFF0C%u6211%u53D1%u73B0%60MongoClient.connect%60%u7684option%u91CC%u5C31%u6709poolSize%u3002%u5728%u5B9E%u9645%u9879%u76EE%u4E2D%u76F4%u63A5%u5C06%u4E4B%u8D4B%u4E3A100%uFF0C%u4E5F%u53EF%u4EE5%u5F97%u5230%u4E0D%u9519%u7684%u6548%u679C%u3002%0A]]></content>
      <tags>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[QuickSort推导 - The Science of Programming]]></title>
    <url>%2F2016%2F01%2F11%2Fquicksort-e6-8e-a8-e5-af-bc-the-science-of-programming-4-trashed%2F</url>
    <content type="text"><![CDATA[QuickSort推导 - The Science of Programming由于近日开发单片机程序的时候，写到一个小循环，不能确定其正确性，进而想到这本书的内容，算是一个小小的回顾。本书的读书笔记参考这篇The Science of Programming。正所谓温故而知新，这次重新摘读又有些新的收获。本想以QuickSort作为一个练习来运用本书的知识，结果尝试了许久，发现越陷越深。最后还是找了书上的例子（书中有QuickSort的例子）。本文最终目标是阐述如何推导QuickSort程序本身。先摘取一些重要的知识点 QuickSort推导 - The Science of Programming 知识点梳理 1. Quantification（量化）[原书4.2节] 2. 何为wp？[原书第7章] 3. 循环检查 Invariant Bound Checklist 4. 如何运用所有的知识来开发一段程序 推测Command 获得Guard 获得不变量Invariant 推导Quick Sort Partition Sort 知识点梳理1. Quantification（量化）[原书4.2节] There exists(E i: m\leqi \ 2. 何为wp？[原书第7章]原书的定义： The Predicate Transformer wp The set of all states such that execution of S begun in any one of them is guaranteed to terminate in a finite amount of time in a state satisfying R. wp通常被用来表达一段程序\{Q\}S\{R\}或者这样写Q\Rightarrow wp(S,R)- Q:前条件- S:执行代码（原文称为commands）- R:后条件 wp的特性 1) wp(S,F) = F2) wp(S ^ Q) ^ wp(S,R) = wp(S,Q ^ R )3) if Q then wp(S, Q ) \Rightarrow wp(S, R)4) wp(S wp(S, R)) \Rightarrow wp(S ,Q v R)5) wp(S, Q) V wp(S, R) = wp(S, Q V R) (for deterministic S) 3. 循环检查定义wp(DO, R) \Rightarrow (E k: 0\leq k: H_k(R)) 用数学语言标记一个循环如下:{Q}{inv P: the invariant}{bound t: the bound function}{init IS: initialization command}do _B_1 \rightarrow _S_1\square \ \cdots\square\ _B_n \rightarrow _S_nod Invariant A predicate P that is true before and after each iteration of a loop. 这就是说P在任何情况下都要成立，于是有- Q \Rightarrow wp(IS, P)- P \Rightarrow wp(DO, P ^ \dalethBB) Bound又叫bound function The function changes at each iteration; the relation remains invariantly true.each iteration decreases t by at least one，so that termination is guaranteed to occur. 检查bound函数确保循环能结束。 Checklist非常重要!!!1. Q \Rightarrow wp(IS, P)2. P ^ Bi \Rightarrow wp(Si, P)3. P ^ \dalethBB \Rightarrow R4. P ^ BB \Rightarrow (t &gt; 0)5. P ^ Bi \Rightarrow wp(“t1; Si“, “t &lt; t1“) 依次验证这5条，就能证明一个循环的正确性了 4. 如何运用所有的知识来开发一段程序推测Command通过后条件R，来推测执行代码(Command)。这就是所谓的Programming as a Goal-Oriented Activity。详情参看原书第14章。 Strategy for developing an alternative command: To invent a guarded command，find a command C whose execution will establish postcondition R in at least some cases; find a Boolean B satisfying B\Rightarrowwp(C,R) and put them together to form B — C (see assumption 2 of the theorem). Continue to invent guarded commandsuntil the precondition of the construct implies that at leastone guard is true (see assumption 1 of the theorem). 获得Guard所有的编程都应该是结果导向的（这与测试驱动开发TDD的思想暗合）。所以后条件R是最先有的。其次，通过P ^ \dalethBB \Rightarrow R能得到BB（即guard）。虽然有公式A\RightarrowB &lt;=&gt; \dalethA V B=T，但是B的获得感觉更多是依靠分析而不是推导。具体例子会在本文最后推导Quick Sort中提及。其中\mathbf B \mathbf B = B_1 V\ B\_2 V \ldots \ B\_n不过由上式可知，此时的guard还是个总的guard，还需要将之分解为各个Bi。 获得不变量Invariant书中给了4种方法：1. Delete a conjunct. For example, predicate A ^ B ^ C can be weakened to A ^ C2. Replace a constant by a variable. For example, predicate x \leqb[1:10], where x is a simple variable，can be weakened to x \leq b[1:i] ^ 1\leq i \leq10，where i is a fresh variable. Since a newvariable has been introduced, its possible set of values must be precisely stated.3. Enlarge the range of a variable. For example, predicate 5 \leq i &lt; 10 can be weakened to 0 \leq i &lt; 10.4. Add a disjunct. For example, predicate A can be weakened to A v B, for some other predicate B. 书中推荐用前三个，根据阅读本书后面部分的经验，最常用的还是第二条。 推导Quick Sort本文以推导快速排序作为结束。快速排序的核心思想就是不断分割，在小数组中递归的作排序，直到小数组的元素个数少于或等于2个，即可进行直接排序了。所以分成Partition和Sort两部分。 Partition一次分割的后条件如下 R: m\leq p R: m\leq p&lt;n \wedge perm(b, B) \wedge b\ |\ {a}^{2.0}| Sort]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[QuickSort推导 - The Science of Programming]]></title>
    <url>%2F2016%2F01%2F11%2Fquicksort-e6-8e-a8-e5-af-bc-the-science-of-programming-3-trashed%2F</url>
    <content type="text"><![CDATA[QuickSort推导 - The Science of Programming https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML.js QuickSort推导 - The Science of Programming由于近日开发单片机程序的时候，写到一个小循环，不能确定其正确性，进而想到这本书的内容，算是一个小小的回顾。本书的读书笔记参考这篇The Science of Programming。正所谓温故而知新，这次重新摘读又有些新的收获。本想以QuickSort作为一个练习来运用本书的知识，结果尝试了许久，发现越陷越深。最后还是找了书上的例子（书中有QuickSort的例子）。本文最终目标是阐述如何推导QuickSort程序本身。先摘取一些重要的知识点 QuickSort推导 - The Science of Programming 知识点梳理 1. Quantification（量化）[原书4.2节] 2. 何为wp？[原书第7章] 3. 循环检查 Invariant Bound Checklist 4. 如何运用所有的知识来开发一段程序 推测Command 获得Guard 获得不变量Invariant 推导Quick Sort Partition Sort 知识点梳理1. Quantification（量化）[原书4.2节] There exists(E i: m\leqi \ 2. 何为wp？[原书第7章]原书的定义： The Predicate Transformer wp The set of all states such that execution of S begun in any one of them is guaranteed to terminate in a finite amount of time in a state satisfying R. wp通常被用来表达一段程序\{Q\}S\{R\}或者这样写Q\Rightarrow wp(S,R)- Q:前条件- S:执行代码（原文称为commands）- R:后条件 wp的特性 1) wp(S,F) = F2) wp(S ^ Q) ^ wp(S,R) = wp(S,Q ^ R )3) if Q then wp(S, Q ) \Rightarrow wp(S, R)4) wp(S wp(S, R)) \Rightarrow wp(S ,Q v R)5) wp(S, Q) V wp(S, R) = wp(S, Q V R) (for deterministic S) 3. 循环检查定义wp(DO, R) \Rightarrow (E k: 0\leq k: H_k(R)) 用数学语言标记一个循环如下:{Q}{inv P: the invariant}{bound t: the bound function}{init IS: initialization command}do _B_1 \rightarrow _S_1\square \ \cdots\square\ _B_n \rightarrow _S_nod Invariant A predicate P that is true before and after each iteration of a loop. 这就是说P在任何情况下都要成立，于是有- Q \Rightarrow wp(IS, P)- P \Rightarrow wp(DO, P ^ \dalethBB) Bound又叫bound function The function changes at each iteration; the relation remains invariantly true.each iteration decreases t by at least one，so that termination is guaranteed to occur. 检查bound函数确保循环能结束。 Checklist非常重要!!!1. Q \Rightarrow wp(IS, P)2. P ^ Bi \Rightarrow wp(Si, P)3. P ^ \dalethBB \Rightarrow R4. P ^ BB \Rightarrow (t &gt; 0)5. P ^ Bi \Rightarrow wp(“t1; Si“, “t &lt; t1“) 依次验证这5条，就能证明一个循环的正确性了 4. 如何运用所有的知识来开发一段程序推测Command通过后条件R，来推测执行代码(Command)。这就是所谓的Programming as a Goal-Oriented Activity。详情参看原书第14章。 Strategy for developing an alternative command: To invent a guarded command，find a command C whose execution will establish postcondition R in at least some cases; find a Boolean B satisfying B\Rightarrowwp(C,R) and put them together to form B — C (see assumption 2 of the theorem). Continue to invent guarded commandsuntil the precondition of the construct implies that at leastone guard is true (see assumption 1 of the theorem). 获得Guard所有的编程都应该是结果导向的（这与测试驱动开发TDD的思想暗合）。所以后条件R是最先有的。其次，通过P ^ \dalethBB \Rightarrow R能得到BB（即guard）。虽然有公式A\RightarrowB &lt;=&gt; \dalethA V B=T，但是B的获得感觉更多是依靠分析而不是推导。具体例子会在本文最后推导Quick Sort中提及。其中\mathbf B \mathbf B = B_1 V\ B\_2 V \ldots \ B\_n不过由上式可知，此时的guard还是个总的guard，还需要将之分解为各个Bi。 获得不变量Invariant书中给了4种方法：1. Delete a conjunct. For example, predicate A ^ B ^ C can be weakened to A ^ C2. Replace a constant by a variable. For example, predicate x \leqb[1:10], where x is a simple variable，can be weakened to x \leq b[1:i] ^ 1\leq i \leq10，where i is a fresh variable. Since a newvariable has been introduced, its possible set of values must be precisely stated.3. Enlarge the range of a variable. For example, predicate 5 \leq i &lt; 10 can be weakened to 0 \leq i &lt; 10.4. Add a disjunct. For example, predicate A can be weakened to A v B, for some other predicate B. 书中推荐用前三个，根据阅读本书后面部分的经验，最常用的还是第二条。 推导Quick Sort本文以推导快速排序作为结束。快速排序的核心思想就是不断分割，在小数组中递归的作排序，直到小数组的元素个数少于或等于2个，即可进行直接排序了。所以分成Partition和Sort两部分。 Partition一次分割的后条件如下 R: m\leq p R: m\leq p&lt;n \wedge perm(b, B) \wedge b\ |\ {a}^{2.0}| Sort]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[QuickSort推导 - The Science of Programming]]></title>
    <url>%2F2016%2F01%2F11%2Fquicksort-e6-8e-a8-e5-af-bc-the-science-of-programming-2-trashed%2F</url>
    <content type="text"><![CDATA[QuickSort推导 - The Science of Programming由于近日开发单片机程序的时候，写到一个小循环，不能确定其正确性，进而想到这本书的内容，算是一个小小的回顾。本书的读书笔记参考这篇The Science of Programming。正所谓温故而知新，这次重新摘读又有些新的收获。本想以QuickSort作为一个练习来运用本书的知识，结果尝试了许久，发现越陷越深。最后还是找了书上的例子（书中有QuickSort的例子）。本文最终目标是阐述如何推导QuickSort程序本身。先摘取一些重要的知识点 QuickSort推导 - The Science of Programming 知识点梳理 1. Quantification（量化）[原书4.2节] 2. 何为wp？[原书第7章] 3. 循环检查 Invariant Bound Checklist 4. 如何运用所有的知识来开发一段程序 推测Command 获得Guard 获得不变量Invariant 推导Quick Sort Partition Sort 知识点梳理1. Quantification（量化）[原书4.2节] There exists(E i: m\leqi \ 2. 何为wp？[原书第7章]原书的定义： The Predicate Transformer wp The set of all states such that execution of S begun in any one of them is guaranteed to terminate in a finite amount of time in a state satisfying R. wp通常被用来表达一段程序\{Q\}S\{R\}或者这样写Q\Rightarrow wp(S,R)- Q:前条件- S:执行代码（原文称为commands）- R:后条件 wp的特性 1) wp(S,F) = F2) wp(S ^ Q) ^ wp(S,R) = wp(S,Q ^ R )3) if Q then wp(S, Q ) \Rightarrow wp(S, R)4) wp(S wp(S, R)) \Rightarrow wp(S ,Q v R)5) wp(S, Q) V wp(S, R) = wp(S, Q V R) (for deterministic S) 3. 循环检查定义wp(DO, R) \Rightarrow (E k: 0\leq k: H_k(R)) 用数学语言标记一个循环如下:{Q}{inv P: the invariant}{bound t: the bound function}{init IS: initialization command}do _B_1 \rightarrow _S_1\square \ \cdots\square\ _B_n \rightarrow _S_nod Invariant A predicate P that is true before and after each iteration of a loop. 这就是说P在任何情况下都要成立，于是有- Q \Rightarrow wp(IS, P)- P \Rightarrow wp(DO, P ^ \dalethBB) Bound又叫bound function The function changes at each iteration; the relation remains invariantly true.each iteration decreases t by at least one，so that termination is guaranteed to occur. 检查bound函数确保循环能结束。 Checklist非常重要!!!1. Q \Rightarrow wp(IS, P)2. P ^ Bi \Rightarrow wp(Si, P)3. P ^ \dalethBB \Rightarrow R4. P ^ BB \Rightarrow (t &gt; 0)5. P ^ Bi \Rightarrow wp(“t1; Si“, “t &lt; t1“) 依次验证这5条，就能证明一个循环的正确性了 4. 如何运用所有的知识来开发一段程序推测Command通过后条件R，来推测执行代码(Command)。这就是所谓的Programming as a Goal-Oriented Activity。详情参看原书第14章。 Strategy for developing an alternative command: To invent a guarded command，find a command C whose execution will establish postcondition R in at least some cases; find a Boolean B satisfying B\Rightarrowwp(C,R) and put them together to form B — C (see assumption 2 of the theorem). Continue to invent guarded commandsuntil the precondition of the construct implies that at leastone guard is true (see assumption 1 of the theorem). 获得Guard所有的编程都应该是结果导向的（这与测试驱动开发TDD的思想暗合）。所以后条件R是最先有的。其次，通过P ^ \dalethBB \Rightarrow R能得到BB（即guard）。虽然有公式A\RightarrowB &lt;=&gt; \dalethA V B=T，但是B的获得感觉更多是依靠分析而不是推导。具体例子会在本文最后推导Quick Sort中提及。其中\mathbf B \mathbf B = B_1 V\ B\_2 V \ldots \ B\_n不过由上式可知，此时的guard还是个总的guard，还需要将之分解为各个Bi。 获得不变量Invariant书中给了4种方法：1. Delete a conjunct. For example, predicate A ^ B ^ C can be weakened to A ^ C2. Replace a constant by a variable. For example, predicate x \leqb[1:10], where x is a simple variable，can be weakened to x \leq b[1:i] ^ 1\leq i \leq10，where i is a fresh variable. Since a newvariable has been introduced, its possible set of values must be precisely stated.3. Enlarge the range of a variable. For example, predicate 5 \leq i &lt; 10 can be weakened to 0 \leq i &lt; 10.4. Add a disjunct. For example, predicate A can be weakened to A v B, for some other predicate B. 书中推荐用前三个，根据阅读本书后面部分的经验，最常用的还是第二条。 推导Quick Sort本文以推导快速排序作为结束。快速排序的核心思想就是不断分割，在小数组中递归的作排序，直到小数组的元素个数少于或等于2个，即可进行直接排序了。所以分成Partition和Sort两部分。 Partition一次分割的后条件如下 R: m\leq p R: m\leq p&lt;n \wedge perm(b, B) \wedge b\ |\ {a}^{2.0}| Sort]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[QuickSort推导 - The Science of Programming]]></title>
    <url>%2F2016%2F01%2F11%2Fquicksort-e6-8e-a8-e5-af-bc-the-science-of-programming-trashed%2F</url>
    <content type="text"><![CDATA[QuickSort推导 - The Science of Programming由于近日开发单片机程序的时候，写到一个小循环，不能确定其正确性，进而想到这本书的内容，算是一个小小的回顾。本书的读书笔记参考这篇The Science of Programming。正所谓温故而知新，这次重新摘读又有些新的收获。本想以QuickSort作为一个练习来运用本书的知识，结果尝试了许久，发现越陷越深。最后还是找了书上的例子（书中有QuickSort的例子）。本文最终目标是阐述如何推导QuickSort程序本身。先摘取一些重要的知识点 QuickSort推导 - The Science of Programming 知识点梳理 1. Quantification（量化）[原书4.2节] 2. 何为wp？[原书第7章] 3. 循环检查 Invariant Bound Checklist 4. 如何运用所有的知识来开发一段程序 推测Command 获得Guard 获得不变量Invariant 推导Quick Sort Partition Sort 知识点梳理1. Quantification（量化）[原书4.2节] There exists(E i: m\leqi \ 2. 何为wp？[原书第7章]原书的定义： The Predicate Transformer wp The set of all states such that execution of S begun in any one of them is guaranteed to terminate in a finite amount of time in a state satisfying R. wp通常被用来表达一段程序\{Q\}S\{R\}或者这样写Q\Rightarrow wp(S,R)- Q:前条件- S:执行代码（原文称为commands）- R:后条件 wp的特性 1) wp(S,F) = F2) wp(S ^ Q) ^ wp(S,R) = wp(S,Q ^ R )3) if Q then wp(S, Q ) \Rightarrow wp(S, R)4) wp(S wp(S, R)) \Rightarrow wp(S ,Q v R)5) wp(S, Q) V wp(S, R) = wp(S, Q V R) (for deterministic S) 3. 循环检查定义wp(DO, R) \Rightarrow (E k: 0\leq k: H_k(R)) 用数学语言标记一个循环如下:{Q}{inv P: the invariant}{bound t: the bound function}{init IS: initialization command}do _B_1 \rightarrow _S_1\square \ \cdots\square\ _B_n \rightarrow _S_nod Invariant A predicate P that is true before and after each iteration of a loop. 这就是说P在任何情况下都要成立，于是有- Q \Rightarrow wp(IS, P)- P \Rightarrow wp(DO, P ^ \dalethBB) Bound又叫bound function The function changes at each iteration; the relation remains invariantly true.each iteration decreases t by at least one，so that termination is guaranteed to occur. 检查bound函数确保循环能结束。 Checklist非常重要!!!1. Q \Rightarrow wp(IS, P)2. P ^ Bi \Rightarrow wp(Si, P)3. P ^ \dalethBB \Rightarrow R4. P ^ BB \Rightarrow (t &gt; 0)5. P ^ Bi \Rightarrow wp(“t1; Si“, “t &lt; t1“) 依次验证这5条，就能证明一个循环的正确性了 4. 如何运用所有的知识来开发一段程序推测Command通过后条件R，来推测执行代码(Command)。这就是所谓的Programming as a Goal-Oriented Activity。详情参看原书第14章。 Strategy for developing an alternative command: To invent a guarded command，find a command C whose execution will establish postcondition R in at least some cases; find a Boolean B satisfying B\Rightarrowwp(C,R) and put them together to form B — C (see assumption 2 of the theorem). Continue to invent guarded commandsuntil the precondition of the construct implies that at leastone guard is true (see assumption 1 of the theorem). 获得Guard所有的编程都应该是结果导向的（这与测试驱动开发TDD的思想暗合）。所以后条件R是最先有的。其次，通过P ^ \dalethBB \Rightarrow R能得到BB（即guard）。虽然有公式A\RightarrowB &lt;=&gt; \dalethA V B=T，但是B的获得感觉更多是依靠分析而不是推导。具体例子会在本文最后推导Quick Sort中提及。其中\mathbf B \mathbf B = B_1 V\ B\_2 V \ldots \ B\_n不过由上式可知，此时的guard还是个总的guard，还需要将之分解为各个Bi。 获得不变量Invariant书中给了4种方法：1. Delete a conjunct. For example, predicate A ^ B ^ C can be weakened to A ^ C2. Replace a constant by a variable. For example, predicate x \leqb[1:10], where x is a simple variable，can be weakened to x \leq b[1:i] ^ 1\leq i \leq10，where i is a fresh variable. Since a newvariable has been introduced, its possible set of values must be precisely stated.3. Enlarge the range of a variable. For example, predicate 5 \leq i &lt; 10 can be weakened to 0 \leq i &lt; 10.4. Add a disjunct. For example, predicate A can be weakened to A v B, for some other predicate B. 书中推荐用前三个，根据阅读本书后面部分的经验，最常用的还是第二条。 推导Quick Sort本文以推导快速排序作为结束。快速排序的核心思想就是不断分割，在小数组中递归的作排序，直到小数组的元素个数少于或等于2个，即可进行直接排序了。所以分成Partition和Sort两部分。 Partition一次分割的后条件如下 R: m\leq p R: m\leq p&lt;n \wedge perm(b, B) \wedge b\ |\ {a}^{2.0}| Sort]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[QuickSort推导 - The Science of Programming]]></title>
    <url>%2F2016%2F01%2F09%2FQuickSort%E6%8E%A8%E5%AF%BC_-_The_Science_of_Programming%2F</url>
    <content type="text"><![CDATA[Edit&#x5B66;&#x4E60;&#x7B14;&#x8BB0; &#x8BFB;&#x4E66;&#x7B14;&#x8BB0; Programming &#x7531;&#x4E8E;&#x8FD1;&#x65E5;&#x5F00;&#x53D1;&#x5355;&#x7247;&#x673A;&#x7A0B;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5199;&#x5230;&#x4E00;&#x4E2A;&#x5C0F;&#x5FAA;&#x73AF;&#xFF0C;&#x4E0D;&#x80FD;&#x786E;&#x5B9A;&#x5176;&#x6B63;&#x786E;&#x6027;&#xFF0C;&#x8FDB;&#x800C;&#x60F3;&#x5230;&#x8FD9;&#x672C;&#x4E66;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x7B97;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x56DE;&#x987E;&#x3002;&#x672C;&#x4E66;&#x7684;&#x8BFB;&#x4E66;&#x7B14;&#x8BB0;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;The Science of Programming&#x3002; &#x6B63;&#x6240;&#x8C13;&#x6E29;&#x6545;&#x800C;&#x77E5;&#x65B0;&#xFF0C;&#x8FD9;&#x6B21;&#x91CD;&#x65B0;&#x6458;&#x8BFB;&#x53C8;&#x6709;&#x4E9B;&#x65B0;&#x7684;&#x6536;&#x83B7;&#x3002;&#x672C;&#x60F3;&#x4EE5;QuickSort&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x7EC3;&#x4E60;&#x6765;&#x8FD0;&#x7528;&#x672C;&#x4E66;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x7ED3;&#x679C;&#x5C1D;&#x8BD5;&#x4E86;&#x8BB8;&#x4E45;&#xFF0C;&#x53D1;&#x73B0;&#x8D8A;&#x9677;&#x8D8A;&#x6DF1;&#x3002;&#x6700;&#x540E;&#x8FD8;&#x662F;&#x627E;&#x4E86;&#x4E66;&#x4E0A;&#x7684;&#x4F8B;&#x5B50;&#xFF08;&#x4E66;&#x4E2D;&#x6709;QuickSort&#x7684;&#x4F8B;&#x5B50;&#xFF09;&#x3002;&#x672C;&#x6587;&#x6700;&#x7EC8;&#x76EE;&#x6807;&#x662F;&#x9610;&#x8FF0;&#x5982;&#x4F55;&#x63A8;&#x5BFC;QuickSort&#x7A0B;&#x5E8F;&#x672C;&#x8EAB;&#x3002;&#x5148;&#x6458;&#x53D6;&#x4E00;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x77E5;&#x8BC6;&#x70B9;,&#x518D;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x77E5;&#x8BC6;&#x70B9;&#x6765;&#x63A8;&#x5BFC;QuickSort&#x3002;QuickSort&#x63A8;&#x5BFC; - The Science of Programming&#x77E5;&#x8BC6;&#x70B9;&#x68B3;&#x7406;1. Quantification&#xFF08;&#x91CF;&#x5316;&#xFF09;[&#x539F;&#x4E66;4.2&#x8282;]2. &#x4F55;&#x4E3A;wp&#xFF1F;[&#x539F;&#x4E66;&#x7B2C;7&#x7AE0;]3. &#x5FAA;&#x73AF;&#x68C0;&#x67E5; (&#x539F;&#x4E66;&#x7B2C;11&#x7AE0;)InvariantBoundChecklist4. &#x5982;&#x4F55;&#x8FD0;&#x7528;&#x6240;&#x6709;&#x7684;&#x77E5;&#x8BC6;&#x6765;&#x5F00;&#x53D1;&#x4E00;&#x6BB5;&#x7A0B;&#x5E8F;&#xFF08;&#x539F;&#x4E66;PART III&#xFF09;&#x63A8;&#x6D4B;Command&#x83B7;&#x5F97;Guard&#xFF08;&#x539F;&#x4E66;&#x7B2C;15&#x7AE0;&#xFF09;&#x83B7;&#x5F97;&#x4E0D;&#x53D8;&#x91CF;Invariant&#xFF08;&#x539F;&#x4E66;&#x7B2C;16&#x7AE0;&#xFF09;&#x63A8;&#x5BFC;Quick Sort &#xFF08;&#x539F;&#x4E66;18.2&#x8282;&#xFF09;Partition &#xFF08;&#x539F;&#x4E66;&#x7EC3;&#x4E60;16.5&#xFF09;&#x7531;R&#x83B7;&#x5F97;P&#x7531;P &#x2138;BB R&#x63A8;&#x7B97;BBBound function&#x63A8;&#x6D4B;command&#x7531;command+P+BB&#x83B7;&#x5F97;Guard&#x9A8C;&#x8BC1;Sort&#x63A8;&#x5BFC;C&#x4EE3;&#x7801;&#x77E5;&#x8BC6;&#x70B9;&#x68B3;&#x7406;1. Quantification&#xFF08;&#x91CF;&#x5316;&#xFF09;[&#x539F;&#x4E66;4.2&#x8282;]There exists (E i: mi\&lt;n: Ei)For all (A i: mi\&lt;n: Ei)Numerial (N i: mi\&lt;n: Ei)&#x4ED6;&#x4EEC;&#x6709;&#x4EE5;&#x4E0B;&#x7279;&#x6027;(E i: mi\&lt;k+1: Ei) = (E i: mi\&lt;k: Ei) V Ek+1 (A i: mi\&lt;n: Ei) = (E i: mi\&lt;n: Ei) (E i: mi\&lt;n: Ei) = (N i: mi\&lt;n: Ei) 1 (A i: mi\&lt;n: Ei) = (N i: mi\&lt;n: Ei) = n-m2. &#x4F55;&#x4E3A;wp&#xFF1F;[&#x539F;&#x4E66;&#x7B2C;7&#x7AE0;]&#x539F;&#x4E66;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;The Predicate Transformer wpThe set of all states such that execution of S begun in any one of them is guaranteed to terminate in a finite amount of time in a state satisfying R.wp&#x901A;&#x5E38;&#x88AB;&#x7528;&#x6765;&#x8868;&#x8FBE;&#x4E00;&#x6BB5;&#x7A0B;&#x5E8F; &#x6216;&#x8005;&#x8FD9;&#x6837;&#x5199; Q:&#x524D;&#x6761;&#x4EF6; S:&#x6267;&#x884C;&#x4EE3;&#x7801;&#xFF08;&#x539F;&#x6587;&#x79F0;&#x4E3A;commands&#xFF09; R:&#x540E;&#x6761;&#x4EF6;wp&#x7684;&#x7279;&#x6027;1) wp(S,F) = F 2) wp(S ^ Q) ^ wp(S,R) = wp(S,Q ^ R ) 3) if Q then wp(S, Q ) wp(S, R) 4) wp(S wp(S, R)) wp(S ,Q v R) 5) wp(S, Q) V wp(S, R) = wp(S, Q V R) (for deterministic S)3. &#x5FAA;&#x73AF;&#x68C0;&#x67E5; (&#x539F;&#x4E66;&#x7B2C;11&#x7AE0;)&#x5B9A;&#x4E49; &#x7528;&#x6570;&#x5B66;&#x8BED;&#x8A00;&#x6807;&#x8BB0;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#x5982;&#x4E0B;: {Q} {inv P: the invariant} {bound t: the bound function} {init IS: initialization command} do B1 S1 Bn Sn odInvariantA predicate P that is true before and after each iteration of a loop. &#x8FD9;&#x5C31;&#x662F;&#x8BF4;P&#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x8981;&#x6210;&#x7ACB;&#xFF0C;&#x4E8E;&#x662F;&#x6709; Q wp(IS, P) P wp(DO, P ^ BB)Bound&#x53C8;&#x53EB;bound functionThe function changes at each iteration; the relation remains invariantly true. each iteration decreases t by at least one&#xFF0C;so that termination is guaranteed to occur.&#x68C0;&#x67E5;bound&#x51FD;&#x6570;&#x786E;&#x4FDD;&#x5FAA;&#x73AF;&#x80FD;&#x7ED3;&#x675F;&#x3002;Checklist&#x975E;&#x5E38;&#x91CD;&#x8981;!!! Q wp(IS, P)P ^ Bi wp(Si, P)P ^ BB RP ^ BB (t &gt; 0)P ^ Bi wp(&#x201C;t1:=t; Si&#x201C;, &#x201C;t &lt; t1&#x201C;) &#x4F9D;&#x6B21;&#x9A8C;&#x8BC1;&#x8FD9;5&#x6761;&#xFF0C;&#x5C31;&#x80FD;&#x8BC1;&#x660E;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#x7684;&#x6B63;&#x786E;&#x6027;&#x4E86;4. &#x5982;&#x4F55;&#x8FD0;&#x7528;&#x6240;&#x6709;&#x7684;&#x77E5;&#x8BC6;&#x6765;&#x5F00;&#x53D1;&#x4E00;&#x6BB5;&#x7A0B;&#x5E8F;&#xFF08;&#x539F;&#x4E66;PART III&#xFF09;&#x63A8;&#x6D4B;Command&#x901A;&#x8FC7;&#x540E;&#x6761;&#x4EF6;R&#xFF0C;&#x6765;&#x63A8;&#x6D4B;&#x6267;&#x884C;&#x4EE3;&#x7801;(Command)&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;Programming as a Goal-Oriented Activity&#x3002;&#x8BE6;&#x60C5;&#x53C2;&#x770B;&#x539F;&#x4E66;&#x7B2C;14&#x7AE0;&#x3002;Strategy for developing an alternative command: To invent a guarded command&#xFF0C;find a command C whose execution will establish postcondition R in at least some cases; find a Boolean B satisfying Bwp(C,R) and put them together to form B C. Continue to invent guarded commands until the precondition of the construct implies that at least one guard is true. - &#x539F;&#x6587;(14.7)&#x83B7;&#x5F97;Guard&#xFF08;&#x539F;&#x4E66;&#x7B2C;15&#x7AE0;&#xFF09;&#x6240;&#x6709;&#x7684;&#x7F16;&#x7A0B;&#x90FD;&#x5E94;&#x8BE5;&#x662F;&#x7ED3;&#x679C;&#x5BFC;&#x5411;&#x7684;&#xFF08;&#x8FD9;&#x4E0E;&#x6D4B;&#x8BD5;&#x9A71;&#x52A8;&#x5F00;&#x53D1;TDD&#x7684;&#x601D;&#x60F3;&#x6697;&#x5408;&#xFF09;&#x3002;&#x6240;&#x4EE5;&#x540E;&#x6761;&#x4EF6;R&#x662F;&#x6700;&#x5148;&#x6709;&#x7684;&#x3002; &#x5176;&#x6B21;&#xFF0C;&#x901A;&#x8FC7;P BB R&#x80FD;&#x5F97;&#x5230;BB&#xFF08;&#x5373;guard&#xFF09;&#x3002;&#x867D;&#x7136;&#x6709;&#x516C;&#x5F0F;AB &lt;=&gt; A V B=T&#xFF0C;&#x4F46;&#x662F;B&#x7684;&#x83B7;&#x5F97;&#x611F;&#x89C9;&#x66F4;&#x591A;&#x662F;&#x4F9D;&#x9760;&#x5206;&#x6790;&#x800C;&#x4E0D;&#x662F;&#x63A8;&#x5BFC;&#x3002;&#x5177;&#x4F53;&#x4F8B;&#x5B50;&#x4F1A;&#x5728;&#x672C;&#x6587;&#x6700;&#x540E;&#x63A8;&#x5BFC;Quick Sort&#x4E2D;&#x63D0;&#x53CA;&#x3002; &#x5176;&#x4E2D; &#x4E0D;&#x8FC7;&#x7531;&#x4E0A;&#x5F0F;&#x53EF;&#x77E5;&#xFF0C;&#x6B64;&#x65F6;&#x7684;guard&#x8FD8;&#x662F;&#x4E2A;&#x603B;&#x7684;guard&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5C06;&#x4E4B;&#x5206;&#x89E3;&#x4E3A;&#x5404;&#x4E2A;Bi&#x3002;&#x83B7;&#x5F97;&#x4E0D;&#x53D8;&#x91CF;Invariant&#xFF08;&#x539F;&#x4E66;&#x7B2C;16&#x7AE0;&#xFF09;&#x4E66;&#x4E2D;&#x7ED9;&#x4E86;4&#x79CD;&#x65B9;&#x6CD5;&#xFF1A; Delete a conjunct. For example, predicate A ^ B ^ C can be weakened to A ^ C Replace a constant by a variable. For example, predicate x b[1:10], where x is a simple variable&#xFF0C;can be weakened to x b[1:i] ^ 110&#xFF0C;where i is a fresh variable. Since a new variable has been introduced, its possible set of values must be precisely stated. Enlarge the range of a variable. For example, predicate 5 i &lt; 10 can be weakened to 0 i &lt; 10. Add a disjunct. For example, predicate A can be weakened to A v B, for some other predicate B.&#x4E66;&#x4E2D;&#x63A8;&#x8350;&#x7528;&#x524D;&#x4E09;&#x4E2A;&#xFF0C;&#x6839;&#x636E;&#x9605;&#x8BFB;&#x672C;&#x4E66;&#x540E;&#x9762;&#x90E8;&#x5206;&#x7684;&#x7ECF;&#x9A8C;&#xFF0C;&#x6700;&#x5E38;&#x7528;&#x7684;&#x8FD8;&#x662F;&#x7B2C;&#x4E8C;&#x6761;&#x3002;&#x63A8;&#x5BFC;Quick Sort &#xFF08;&#x539F;&#x4E66;18.2&#x8282;&#xFF09;&#x672C;&#x6587;&#x4EE5;&#x63A8;&#x5BFC;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x4F5C;&#x4E3A;&#x7ED3;&#x675F;&#x3002; &#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7684;&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x5C31;&#x662F;&#x4E0D;&#x65AD;&#x5206;&#x5272;&#xFF0C;&#x5728;&#x5C0F;&#x6570;&#x7EC4;&#x4E2D;&#x9012;&#x5F52;&#x7684;&#x4F5C;&#x6392;&#x5E8F;&#xFF0C;&#x76F4;&#x5230;&#x5C0F;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x5C11;&#x4E8E;&#x6216;&#x7B49;&#x4E8E;2&#x4E2A;&#xFF0C;&#x5373;&#x53EF;&#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x6392;&#x5E8F;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x5206;&#x6210;Partition&#x548C;Sort&#x4E24;&#x90E8;&#x5206;&#x3002;Partition &#xFF08;&#x539F;&#x4E66;&#x7EC3;&#x4E60;16.5&#xFF09;&#x4E00;&#x6B21;&#x5206;&#x5272;&#x7684;&#x540E;&#x6761;&#x4EF6;&#x5982;&#x4E0B; R: &#x7531;R&#x83B7;&#x5F97;P&#x901A;&#x8FC7;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x4E8C;Replace a constant by a variable.&#x6765;&#x5F97;&#x5230;P&#x3002; P: &#x7531;P BB R&#x63A8;&#x7B97;BB&#x6CE8;&#x610F;&#x662F;&#x63A8;&#x7B97;&#xFF0C;&#x4E0D;&#x662F;&#x4E25;&#x683C;&#x7684;&#x903B;&#x8F91;&#x63A8;&#x5BFC; P (p-q+1=0) R BB = (p-q+1=0) BB = (pq-1)Bound functiont = p-q+1&#x63A8;&#x6D4B;command&#x7531;QuickSort&#x7684;&#x57FA;&#x672C;&#x7B97;&#x6CD5;&#x53EF;&#x77E5;&#xFF0C;&#x6709;&#x4E09;&#x4E2A;&#x53EF;&#x80FD;&#x7684;commandq++p&#x2013;swap(b[p], b[q]) &#x6240;&#x4EE5;&#x73B0;&#x5728;&#x7A0B;&#x5E8F;&#x5F62;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A; do pq-1 &#x3000;if__ p:=p-1 &#x3000; __ q:=q+1 &#x3000; __ swap(b[p], b[q]) &#x3000;fi od&#x7531;command+P+BB&#x83B7;&#x5F97;GuardPBBwp(S,P)S = &#x201C;p:=p-1&#x201D; &#x3000;&#x3000;wp(S,P) = S = &#x201C;q:=q+1&#x201D; &#x8FC7;&#x7A0B;&#x7C7B;&#x4F3C; &#x3000;&#x3000;wp(S,P)=&#x5BF9;&#x4E8E;&#x524D;&#x534A;&#x90E8;&#x5206;&#x7684;&#x8BC1;&#x660E;&#x5982;&#x4E0B;&#xFF1A; P&#x4E2D;&#x6709; BB = (pq-1) q &lt; p q p-1 q+1p &#x5F97;&#x8BC1; &#x5BF9;&#x4E8E;&#x540E;&#x534A;&#x90E8;&#x5206;&#xFF0C;&#x663E;&#x800C;&#x6613;&#x89C1;&#x9700;&#x8981;b[q]x,&#x5373; swap(b[p], b[q]) &#x3000;&#x3000;wp(S,P)=&#x9A8C;&#x8BC1;Q: T R: wp(IS, P) = PBB wp(,P) &#x8FD9;&#x4E2A;&#x663E;&#x7136;&#x4E5F;&#x662F;&#x6210;&#x7ACB;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x6765;&#x7684;PBBR &#x540C;&#x4E0A;&#xFF0C;&#x4EA6;&#x6210;&#x7ACB;PBB(t&gt;0) BB = (pq-1) p-q+10 &#x53C8;&#x7531;P&#x6709; qp+1 p-q+10 t=p-q+1&gt;0 &#x5F97;&#x8BC1;P wp(&#x201C;&#x201D;, &#x201C;t&lt;t1&quot;) &#x5BF9;&#x4E8E;&#x4E09;&#x79CD;,t&#x90FD;&#x663E;&#x7136;&#x4F1A;&#x53D8;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;&#x6EE1;&#x8DB3;&#x7EFC;&#x4E0A;&#xFF0C;5&#x6761;check point&#x90FD;&#x6EE1;&#x8DB3;&#xFF0C;&#x7A0B;&#x5E8F;&#x6B63;&#x786E;&#x6027;&#x53EF;&#x4FDD;&#x8BC1;Sort&#x63A8;&#x5BFC;&#x6839;&#x636E;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x53EF;&#x77E5;&#xFF0C;&#x5BF9;&#x6570;&#x7EC4;&#x6392;&#x5E8F;&#xFF0C;&#x5373;&#x8FDB;&#x884C;&#x82E5;&#x5E72;&#x6B21;&#x5206;&#x5272;&#xFF0C;&#x76F4;&#x81F3;&#x5B50;&#x533A;&#x95F4;&#x5305;&#x542B;2&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x5373;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x6392;&#x5E8F;&#x3002;P: s is a set of pairs (i, j) representing disjoint array sections b[i:j] of b. Further&#xFF0C;b[0:n&#x2014;1] is ordered iff all the disjoint partitions given by set s are.IS: s:={(0,n-1)}R: b[0:n-1] are orderedt: n - ordered&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7A0B;&#x5E8F;&#x5982;&#x4E0B;: s:={(0,n-1)} {Invariant: &#x5982;&#x4E0A;P} do s{} Choose((i,j),s); s:=s-{(i,j)}; &#x3000;&#x3000;&#x3000;if j-i \&lt; 2 Sort b[i:j] directly &#x3000;&#x3000;&#x3000; j-i 2 Partition(b,i,j,p;); &#x3000;&#x3000;&#x3000;fi odC&#x4EE3;&#x7801;&#x6700;&#x7EC8;Quick Sort C&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;:1.#define N 502.#define MAX_SPLIT 50 // This should be logN3.void swap(int* b, int p, int q)4.{5. b[p]=b[p]+b[q];6. b[q]=b[p]-b[q];7. b[p]=b[p]-b[q];8.}9.int Partition (int* b, int m, int n)10.{11. assert(n&gt;m);12. int p=n-1, q=m+1;13. while (p != q-1)14. {15. if (b[p]&gt;x)16. {17. p--;18. }19. else if (b[q]&lt;=x)20. {21. q++;22. }23. else if (b[q]&lt;=x &amp;&amp; b[p]&gt;x)24. {25. swap(b, p ,q);26. p--;27. q++;28. }29. }30. return p;31.}32.void QuickSort(int* b, int n)33.{34. typedef struct 35. {36. int start;37. int end;38. }Pair s[MAX_SPLIT] = {0};39. int count = 1; // how many pairs in s40. s[0].start = 0;41. s[0].end = n-1;42. while (count &gt; 0)43. {44. Pair p;45. memcpy(&amp;p, &amp;s[count-1], sizeof(Pair));46. if(p.end - p.start &lt; 2)47. {48. if (p.start &gt; p.end)49. {50. swap (b, p.start, p.end);51. count --;52. }53. else54. {55. int m = p.start;56. int n = p.end - p.start + 1;57. int x = Partition(b, m, n);58. s[count-1].start = p.start;59. s[count-1].end = x-1;60. s[count].start = x+1;61. s[count].end = p.end;62. count ++;63. }64. } 65. }66.}%23QuickSort%u63A8%u5BFC%20-%20The%20Science%20of%20Programming%0A%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5B%u8BFB%u4E66%u7B14%u8BB0%2C%20Programming%5D%0A%0A%u7531%u4E8E%u8FD1%u65E5%u5F00%u53D1%u5355%u7247%u673A%u7A0B%u5E8F%u7684%u65F6%u5019%uFF0C%u5199%u5230%u4E00%u4E2A%u5C0F%u5FAA%u73AF%uFF0C%u4E0D%u80FD%u786E%u5B9A%u5176%u6B63%u786E%u6027%uFF0C%u8FDB%u800C%u60F3%u5230%u8FD9%u672C%u4E66%u7684%u5185%u5BB9%uFF0C%u7B97%u662F%u4E00%u4E2A%u5C0F%u5C0F%u7684%u56DE%u987E%u3002%u672C%u4E66%u7684%u8BFB%u4E66%u7B14%u8BB0%u53C2%u8003%u8FD9%u7BC7%5BThe%20Science%20of%20Programming%5D%28https%3A//www.evernote.com/shard/s24/nl/697376807/c79122e8-c790-44b7-afa4-93eca3ad662e/%29%u3002%0A%u6B63%u6240%u8C13%u6E29%u6545%u800C%u77E5%u65B0%uFF0C%u8FD9%u6B21%u91CD%u65B0%u6458%u8BFB%u53C8%u6709%u4E9B%u65B0%u7684%u6536%u83B7%u3002%u672C%u60F3%u4EE5QuickSort%u4F5C%u4E3A%u4E00%u4E2A%u7EC3%u4E60%u6765%u8FD0%u7528%u672C%u4E66%u7684%u77E5%u8BC6%uFF0C%u7ED3%u679C%u5C1D%u8BD5%u4E86%u8BB8%u4E45%uFF0C%u53D1%u73B0%u8D8A%u9677%u8D8A%u6DF1%u3002%u6700%u540E%u8FD8%u662F%u627E%u4E86%u4E66%u4E0A%u7684%u4F8B%u5B50%uFF08%u4E66%u4E2D%u6709QuickSort%u7684%u4F8B%u5B50%uFF09%u3002%u672C%u6587%u6700%u7EC8%u76EE%u6807%u662F%u9610%u8FF0%u5982%u4F55%u63A8%u5BFCQuickSort%u7A0B%u5E8F%u672C%u8EAB%u3002%u5148%u6458%u53D6%u4E00%u4E9B%u91CD%u8981%u7684%u77E5%u8BC6%u70B9%2C%u518D%u5229%u7528%u8FD9%u4E9B%u77E5%u8BC6%u70B9%u6765%u63A8%u5BFCQuickSort%u3002%0A%0A%5BTOC%5D%0A%0A%23%23%u77E5%u8BC6%u70B9%u68B3%u7406%0A%23%23%231.%20Quantification%uFF08%u91CF%u5316%uFF09%5B%u539F%u4E664.2%u8282%5D%0A%0A*%20There%20exists%20%20%0A%09%28***E***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%0A*%20For%20all%20%20%0A%09%28***A***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%0A*%20Numerial%20%20%0A%09%28***N***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%0A%09%0A%u4ED6%u4EEC%u6709%u4EE5%u4E0B%u7279%u6027%0A%0A%3E%28***E***%20i%3A%20m%24%5Cleq%24i%5C%3Ck+1%3A%20E%3Csub%3Ei%3C/sub%3E%29%20%3D%20%28***E***%20i%3A%20m%24%5Cleq%24i%5C%3Ck%3A%20E%3Csub%3Ei%3C/sub%3E%29%20V%20E%3Csub%3Ek+1%3C/sub%3E%0A%3E%28***A***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%20%3D%20%24%5Cdaleth%24%28***E***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20%24%5Cdaleth%24E%3Csub%3Ei%3C/sub%3E%29%0A%3E%28***E***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%20%3D%20%28***N***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%20%24%5Cgeq%24%201%0A%3E%28***A***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%20%3D%20%28***N***%20i%3A%20m%24%5Cleq%24i%5C%3Cn%3A%20E%3Csub%3Ei%3C/sub%3E%29%20%3D%20n-m%0A%0A%23%23%232.%20%u4F55%u4E3Awp%uFF1F%5B%u539F%u4E66%u7B2C7%u7AE0%5D%0A%u539F%u4E66%u7684%u5B9A%u4E49%uFF1A%0A%3EThe%20Predicate%20Transformer%20wp%0A%3E%0A%3EThe%20set%20of%20all%20states%20such%20that%20execution%20of%20**S**%20begun%20in%20any%20one%20of%20them%20%3Cfont%20color%3D%22Blue%22%3Eis%20guaranteed%20to%20terminate%20in%20a%20finite%20amount%20of%20time%3C/font%3E%20in%20a%20state%20satisfying%20**R**.%0A%0Awp%u901A%u5E38%u88AB%u7528%u6765%u8868%u8FBE%u4E00%u6BB5%u7A0B%u5E8F%0A%24%24%5C%7BQ%5C%7DS%5C%7BR%5C%7D%24%24%0A%u6216%u8005%u8FD9%u6837%u5199%0A%24%24Q%5CRightarrow%20wp%28S%2CR%29%24%24%0A-%20Q%3A%u524D%u6761%u4EF6%20%20%0A-%20S%3A%u6267%u884C%u4EE3%u7801%uFF08%u539F%u6587%u79F0%u4E3Acommands%uFF09%20%20%0A-%20R%3A%u540E%u6761%u4EF6%0A%0A**wp%u7684%u7279%u6027**%0A%3E1%29%20wp%28S%2CF%29%20%3D%20F%20%20%20%0A%3E2%29%20wp%28S%20%5E%20Q%29%20%5E%20wp%28S%2CR%29%20%3D%20wp%28S%2CQ%20%5E%20R%20%29%20%20%0A%3E3%29%20if%20Q%20then%20wp%28S%2C%20Q%20%29%20%24%5CRightarrow%24%20wp%28S%2C%20R%29%20%20%20%0A%3E4%29%20wp%28S%20wp%28S%2C%20R%29%29%20%24%5CRightarrow%24%20wp%28S%20%2CQ%20v%20R%29%20%20%0A%3E5%29%20wp%28S%2C%20Q%29%20V%20wp%28S%2C%20R%29%20%3D%20wp%28S%2C%20Q%20V%20R%29%20%28for%20deterministic%20S%29%0A%0A%23%23%233.%20%u5FAA%u73AF%u68C0%u67E5%20%28%u539F%u4E66%u7B2C11%u7AE0%29%0A%u5B9A%u4E49%20%20%0A%24%24%20wp%28DO%2C%20R%29%20%5CRightarrow%20%28E%20k%3A%200%5Cleq%20k%3A%20H_k%28R%29%29%24%24%0A%0A%u7528%u6570%u5B66%u8BED%u8A00%u6807%u8BB0%u4E00%u4E2A%u5FAA%u73AF%u5982%u4E0B%3A%20%20%0A%7BQ%7D%20%20%0A%7Binv%20P%3A%20the%20invariant%7D%20%20%0A%7Bbound%20t%3A%20the%20bound%20function%7D%20%20%0A%7Binit%20IS%3A%20initialization%20command%7D%20%20%0A**do**%20*B*%3Csub%3E1%3C/sub%3E%20%24%5Crightarrow%24%20*S*%3Csub%3E1%3C/sub%3E%20%20%0A%20%24%5Csquare%5C%20%5Ccdots%24%20%20%0A%20%24%5Csquare%5C%20%24%20*B*%3Csub%3En%3C/sub%3E%20%24%5Crightarrow%24%20*S*%3Csub%3En%3C/sub%3E%20%20%20%0A**od**%0A%0A%23%23%23%23Invariant%0A%3E%3Cfont%20%20face%3D%22Arial%22%3EA%20predicate%20**P**%20that%20is%20true%20**before%20and%20after%20each%20iteration**%20of%20a%20loop.%3C/font%3E%20%20%0A%0A%u8FD9%u5C31%u662F%u8BF4P%u5728%u4EFB%u4F55%u60C5%u51B5%u4E0B%u90FD%u8981%u6210%u7ACB%uFF0C%u4E8E%u662F%u6709%20%20%0A-%20Q%20%24%5CRightarrow%24%20wp%28IS%2C%20P%29%20%20%0A-%20P%20%24%5CRightarrow%24%20wp%28DO%2C%20P%20%5E%20%24%5Cdaleth%24BB%29%0A%0A%23%23%23%23Bound%0A%u53C8%u53EBbound%20function%0A%3E%3Cfont%20%20face%3D%22Arial%22%3EThe%20function%20changes%20at%20each%20iteration%3B%20the%20relation%20remains%20invariantly%20true.%0A%3E**each%20iteration%20decreases%20t%20by%20at%20least%20one%uFF0Cso%20that%20termination%20is%20guaranteed%20to%20occur.**%3C/font%3E%0A%0A%u68C0%u67E5bound%u51FD%u6570%u786E%u4FDD%u5FAA%u73AF%u80FD%u7ED3%u675F%u3002%0A%0A%23%23%23%23Checklist%0A%3Cfont%20color%3D%22IndianRed%22%20size%3D%226%22%3E%u975E%u5E38%u91CD%u8981%21%21%21%3C/font%3E%20%20%0A%3Ca%20name%3D%22checklist%22%3E%3C/a%3E%20%0A1.%20Q%20%24%5CRightarrow%24%20wp%28IS%2C%20P%29%0A2.%20P%20%5E%20B%3Csub%3Ei%3C/sub%3E%20%24%5CRightarrow%24%20wp%28S%3Csub%3Ei%3C/sub%3E%2C%20P%29%0A3.%20P%20%5E%20%24%5Cdaleth%24**BB**%20%24%5CRightarrow%24%20R%0A4.%20P%20%5E%20**BB**%20%24%5CRightarrow%24%20%28t%20%3E%200%29%0A5.%20P%20%5E%20B%3Csub%3Ei%3C/sub%3E%20%24%5CRightarrow%24%20wp%28%22t%3Csub%3E1%3C/sub%3E%3A%3Dt%3B%20S%3Csub%3Ei%3C/sub%3E%22%2C%20%22t%20%3C%20t%3Csub%3E1%3C/sub%3E%22%29%20%20%0A%0A%u4F9D%u6B21%u9A8C%u8BC1%u8FD95%u6761%uFF0C%u5C31%u80FD%u8BC1%u660E%u4E00%u4E2A%u5FAA%u73AF%u7684%u6B63%u786E%u6027%u4E86%0A%0A%23%23%234.%20%u5982%u4F55%u8FD0%u7528%u6240%u6709%u7684%u77E5%u8BC6%u6765%u5F00%u53D1%u4E00%u6BB5%u7A0B%u5E8F%uFF08%u539F%u4E66PART%20III%uFF09%0A%23%23%23%23%u63A8%u6D4BCommand%0A%u901A%u8FC7%u540E%u6761%u4EF6R%uFF0C%u6765%u63A8%u6D4B%u6267%u884C%u4EE3%u7801%28Command%29%u3002%u8FD9%u5C31%u662F%u6240%u8C13%u7684Programming%20as%20a%20Goal-Oriented%20Activity%u3002%u8BE6%u60C5%u53C2%u770B%u539F%u4E66%u7B2C14%u7AE0%u3002%0A%3E**Strategy%20for%20developing%20an%20alternative%20command**%3A%20To%20invent%20a%20guarded%20command%uFF0Cfind%20a%20command%20C%20whose%20execution%20will%20establish%20postcondition%20R%20in%20at%20least%20some%20cases%3B%20find%20a%20Boolean%20B%20satisfying%20B%24%5CRightarrow%24wp%28C%2CR%29%20and%20put%20them%20together%20to%20form%20B%20%24%5Crightarrow%24C.%20Continue%20to%20invent%20guarded%20commands%20until%20the%20precondition%20of%20the%20construct%20implies%20that%20at%20least%20one%20guard%20is%20true.%20-%20%u539F%u6587%2814.7%29%0A%0A%23%23%23%23%u83B7%u5F97Guard%uFF08%u539F%u4E66%u7B2C15%u7AE0%uFF09%0A%u6240%u6709%u7684%u7F16%u7A0B%u90FD%u5E94%u8BE5%u662F%u7ED3%u679C%u5BFC%u5411%u7684%uFF08%u8FD9%u4E0E%u6D4B%u8BD5%u9A71%u52A8%u5F00%u53D1TDD%u7684%u601D%u60F3%u6697%u5408%uFF09%u3002%u6240%u4EE5%u540E%u6761%u4EF6R%u662F%u6700%u5148%u6709%u7684%u3002%0A%u5176%u6B21%uFF0C%u901A%u8FC7P%20%24%5Cwedge%5C%20%5Cdaleth%24**BB**%20%24%5CRightarrow%24%20R%u80FD%u5F97%u5230**BB**%uFF08%u5373guard%uFF09%u3002%u867D%u7136%u6709%u516C%u5F0FA%24%5CRightarrow%24B%20%3C%3D%3E%20%24%5Cdaleth%24A%20V%20B%3DT%uFF0C%u4F46%u662FB%u7684%u83B7%u5F97%u611F%u89C9%u66F4%u591A%u662F%u4F9D%u9760%u5206%u6790%u800C%u4E0D%u662F%u63A8%u5BFC%u3002%u5177%u4F53%u4F8B%u5B50%u4F1A%u5728%u672C%u6587%u6700%u540E%u63A8%u5BFCQuick%20Sort%u4E2D%u63D0%u53CA%u3002%0A%u5176%u4E2D%0A%24%24%20%5Cmathbf%20B%20%5Cmathbf%20B%20%3D%20B_1%20%5Cwedge%20%5C%20B%5C_2%20%5Cwedge%20%5Cldots%20%5C%20B%5C_n%24%24%0A%u4E0D%u8FC7%u7531%u4E0A%u5F0F%u53EF%u77E5%uFF0C%u6B64%u65F6%u7684guard%u8FD8%u662F%u4E2A%u603B%u7684guard%uFF0C%u8FD8%u9700%u8981%u5C06%u4E4B%u5206%u89E3%u4E3A%u5404%u4E2AB%3Csub%3Ei%3C/sub%3E%u3002%0A%23%23%23%23%u83B7%u5F97%u4E0D%u53D8%u91CFInvariant%uFF08%u539F%u4E66%u7B2C16%u7AE0%uFF09%0A%u4E66%u4E2D%u7ED9%u4E864%u79CD%u65B9%u6CD5%uFF1A%20%20%0A1.%20**Delete%20a%20conjunct.**%20For%20example%2C%20predicate%20A%20%5E%20B%20%5E%20C%20can%20be%20weakened%20to%20A%20%5E%20C%20%20%0A2.%20**Replace%20a%20constant%20by%20a%20variable.**%20For%20example%2C%20predicate%20x%20%24%5Cleq%24b%5B1%3A10%5D%2C%20where%20x%20is%20a%20simple%20variable%uFF0Ccan%20be%20weakened%20to%20x%20%24%5Cleq%24%20b%5B1%3Ai%5D%20%5E%201%24%5Cleq%20i%20%5Cleq%2410%uFF0Cwhere%20i%20is%20a%20fresh%20variable.%20Since%20a%20new%0Avariable%20has%20been%20introduced%2C%20%3Cfont%20color%3D%22IndianRed%22%3Eits%20possible%20set%20of%20values%20must%20be%20precisely%20stated.%3C/font%3E%20%20%0A3.%20**Enlarge%20the%20range%20of%20a%20variable.**%20For%20example%2C%20predicate%205%20%24%5Cleq%24%20i%20%3C%2010%20can%20be%20weakened%20to%200%20%24%5Cleq%24%20i%20%3C%2010.%20%20%0A4.%20**Add%20a%20disjunct.**%20For%20example%2C%20predicate%20A%20can%20be%20weakened%20to%20A%20v%20B%2C%20for%20some%20other%20predicate%20B.%0A%0A%u4E66%u4E2D%u63A8%u8350%u7528%u524D%u4E09%u4E2A%uFF0C%u6839%u636E%u9605%u8BFB%u672C%u4E66%u540E%u9762%u90E8%u5206%u7684%u7ECF%u9A8C%uFF0C%u6700%u5E38%u7528%u7684%u8FD8%u662F%u7B2C%u4E8C%u6761%u3002%0A%0A%23%23%u63A8%u5BFCQuick%20Sort%20%uFF08%u539F%u4E6618.2%u8282%uFF09%0A%u672C%u6587%u4EE5%u63A8%u5BFC%u5FEB%u901F%u6392%u5E8F%u4F5C%u4E3A%u7ED3%u675F%u3002%0A%u5FEB%u901F%u6392%u5E8F%u7684%u6838%u5FC3%u601D%u60F3%u5C31%u662F%u4E0D%u65AD%u5206%u5272%uFF0C%u5728%u5C0F%u6570%u7EC4%u4E2D%u9012%u5F52%u7684%u4F5C%u6392%u5E8F%uFF0C%u76F4%u5230%u5C0F%u6570%u7EC4%u7684%u5143%u7D20%u4E2A%u6570%u5C11%u4E8E%u6216%u7B49%u4E8E2%u4E2A%uFF0C%u5373%u53EF%u8FDB%u884C%u76F4%u63A5%u6392%u5E8F%u4E86%u3002%u6240%u4EE5%u5206%u6210Partition%u548CSort%u4E24%u90E8%u5206%u3002%0A%23%23%23Partition%20%uFF08%u539F%u4E66%u7EC3%u4E6016.5%uFF09%0A%u4E00%u6B21%u5206%u5272%u7684%u540E%u6761%u4EF6%u5982%u4E0B%0AR%3A%20%24m%5Cleq%20p%3Cn%20%5Cwedge%20perm%28b%2C%20B%29%20%5Cwedge%20b%24%21%5BAlt%20text%5D%28./1453770826140.png%29%0A%23%23%23%23%u7531R%u83B7%u5F97P%0A%u901A%u8FC7%u4E0A%u4E00%u8282%u4E2D%u7684%u65B9%u6CD5%u4E8C**Replace%20a%20constant%20by%20a%20variable.**%u6765%u5F97%u5230P%u3002%0AP%3A%20%24m%3Cq%20%5Cleq%20p+1%20%5Cleq%20n%20%5Cwedge%20x%3DB%5Bm%5D%20%5Cwedge%20%24%21%5BAlt%20text%5D%28./1453770875251.png%29%0A%23%23%23%23%u7531P%20%24%5Cwedge%20%5Cdaleth%24**BB**%20%24%5CRightarrow%24R%3Cfont%20color%3D%22IndianRed%22%3E%u63A8%u7B97%3C/font%3EBB%0A%u6CE8%u610F%u662F%u63A8%u7B97%uFF0C%u4E0D%u662F%u4E25%u683C%u7684%u903B%u8F91%u63A8%u5BFC%0A%24%5Cbecause%5C%20%24P%20%24%5Cwedge%24%20%28p-q+1%3D0%29%20%24%5CLeftrightarrow%24%20R%0A%24%5Ctherefore%5C%20%5Cdaleth%24**BB**%20%3D%20%28p-q+1%3D0%29%0A%24%5Ctherefore%5C%20%24**BB**%20%3D%20%28p%24%5Cneq%24q-1%29%0A%23%23%23%23Bound%20function%0At%20%3D%20p-q+1%0A%23%23%23%23%u63A8%u6D4Bcommand%0A%u7531QuickSort%u7684%u57FA%u672C%u7B97%u6CD5%u53EF%u77E5%uFF0C%u6709%u4E09%u4E2A%u53EF%u80FD%u7684command%0A1.%20q++%0A2.%20p--%0A3.%20swap%28b%5Bp%5D%2C%20b%5Bq%5D%29%0A%u6240%u4EE5%u73B0%u5728%u7A0B%u5E8F%u5F62%u5F0F%u5982%u4E0B%uFF1A%0Ado%20p%24%5Cneq%24q-1%0A%u3000if________%20%24%5Crightarrow%24%20p%3A%3Dp-1%0A%u3000%24%5Csquare%24%20________%20%24%5Crightarrow%24%20q%3A%3Dq+1%0A%u3000%24%5Csquare%24%20________%20%24%5Crightarrow%24%20swap%28b%5Bp%5D%2C%20b%5Bq%5D%29%0A%u3000fi%0Aod%0A%23%23%23%23%u7531command+P+BB%u83B7%u5F97Guard%0AP%24%5Cwedge%24**BB**%24%5Cwedge%20B_i%20%5CRightarrow%24wp%28S%2CP%29%0A1.%20S%20%3D%20%22p%3A%3Dp-1%22%0A%u3000%u3000wp%28S%2CP%29%20%3D%20%24%28m%3Cq%20%5Cleq%20p%20%5Cleq%20n%29%20%5Cwedge%20%28x%3DB%5Bm%5D%29%20%5Cwedge%20%24%21%5BAlt%20text%5D%28./1453770917851.png%29%0A%24%5Cbecause%24**BB**%20%3D%20%28p%24%5Cneq%24q-1%29%0A%24%5Ctherefore%24q%5C%3Cp+1%0A%24%5Ctherefore%24q%24%5Cleq%24p%0A%u53EF%u89C1%uFF0C%u8981%u8BC1%u51FAP%24%5Cwedge%24**BB**%24%5Cwedge%20B_i%20%5CRightarrow%24wp%28S%2CP%29%u53EA%u8981%u56FE%u5F62%u4E2D%u7684b%5Bp%5D%u80FD%u6EE1%u8DB3%u5206%u5272%u6761%u4EF6%u5C31%u53EF%u4EE5%u4E86%uFF0C%u6240%u4EE5%u6709%0A%24%24B_i%20%3D%20b%5Bp%5D%3Ex%24%24%0A2.%20S%20%3D%20%22q%3A%3Dq+1%22%0A%u8FC7%u7A0B%u7C7B%u4F3C%0A%u3000%u3000wp%28S%2CP%29%3D%24m%3Cq+1%5Cleq%20p+1%20%5Cleq%20n%20%5Cwedge%24%21%5BAlt%20text%5D%28./1453770962336.png%29%0A%0A%u5BF9%u4E8E%u524D%u534A%u90E8%u5206%u7684%u8BC1%u660E%u5982%u4E0B%uFF1A%0AP%u4E2D%u6709%24m%3Cq%20%5Cleq%20p+1%20%5Cleq%20n%24%0A**BB**%20%3D%20%28p%24%5Cneq%24q-1%29%0A%24%5Ctherefore%24%20q%20%3C%20p%20%24%5CLeftrightarrow%24%20q%20%24%5Cleq%24p-1%20%24%5CLeftrightarrow%24%20q+1%24%5Cleq%24p%0A%u5F97%u8BC1%0A%u5BF9%u4E8E%u540E%u534A%u90E8%u5206%uFF0C%u663E%u800C%u6613%u89C1%u9700%u8981b%5Bq%5D%24%5Cleq%24x%2C%u5373%0A%24%24B_i%20%3D%20%28b%5Bq%5D%20%5Cleq%20x%29%24%24%0A3.%20swap%28b%5Bp%5D%2C%20b%5Bq%5D%29%0A%u3000%u3000wp%28S%2CP%29%3D%24m%3Cq%20%5Cleq%20p+1%20%5Cleq%20n%20%5Cwedge%24%21%5BAlt%20text%5D%28./1453771153446.png%29%0A%u4ECD%u7136%u663E%u800C%u6613%u89C1%u6709%uFF1A%0A%24%24B_i%20%3D%20b%5Bq%5D%20%5Cleq%20x%20%5Cwedge%20b%5Bp%5D%3Ex%24%24%0A%u4F9D%u6B21%3Cfont%20color%3D%22IndianRed%22%20size%3D%225%22%3E%u5206%u5272%u7A0B%u5E8F%3C/font%3E%u5199%u4F5C%uFF1A%0A**do**%20p%24%5Cneq%24q-1%0A%u3000**if**%20b%5Bp%5D%5C%3Ex%20%24%5Crightarrow%24%20p%3A%3Dp-1%0A%u3000%24%5Csquare%24%20b%5Bq%5D%24%5Cleq%24%20x%20%24%5Crightarrow%24%20q%3A%3Dq+1%0A%u3000%24%5Csquare%24%20%28b%5Bq%5D%24%5Cleq%24%20x%29%20%24%5Cwedge%24%20%28b%5Bp%5D%5C%3Ex%29%24%5Crightarrow%24%20swap%28b%5Bp%5D%2C%20b%5Bq%5D%29%3B%20p%2Cq%3A%3Dp-1%2Cq+1%0A%u3000**fi**%0A**od**%0A%23%23%23%23%u9A8C%u8BC1%0AQ%3A%20T%0AR%3A%20%24m%5Cleq%20p%20%5Cleq%20n%20%5Cwedge%20perm%28b%2C%20B%29%20%5Cwedge%20b%24%21%5BAlt%20text%5D%28./1453771195972.png%29%0AP%3A%20%24m%3Cq%20%5Cleq%20p+1%20%5Cleq%20n%20%5Cwedge%20x%3DB%5Bm%5D%20%5Cwedge%20%24%21%5BAlt%20text%5D%28./1453771223774.png%29%0ABound%3A%20t%20%3D%20p-q+1%0AIS%3A%20p%3A%3Dn-1%2C%20q%3A%3Dm+1%0A%u6839%u636E5%u6761%5BCheck%20List%5D%28%23checklist%29%uFF0C%u4F9D%u6B21check%uFF1A%0A1.%20wp%28IS%2C%20P%29%20%3D%20%24m%3Cm+1%5Cleq%20n%20%5Cwedge%20%28x%3DB%5Bm%5D%29%20%5Cwedge%20%24%21%5BAlt%20text%5D%28./1453771263078.png%29%0A%u663E%u7136%u662F%u6210%u7ACB%u7684%0A2.%20P%24%5Cwedge%24**BB**%24%5Cwedge%20B_i%20%5CRightarrow%24%20wp%28%24S_i%24%2CP%29%0A%u8FD9%u4E2A%u663E%u7136%u4E5F%u662F%u6210%u7ACB%u7684%uFF0C%u56E0%u4E3A%u6211%u4EEC%u7684%24B_i%24%u5C31%u662F%u8FD9%u4E48%u6765%u7684%0A3.%20P%24%5Cwedge%20%5Cdaleth%24**BB**%24%5CRightarrow%24R%0A%u540C%u4E0A%uFF0C%u4EA6%u6210%u7ACB%0A4.%20P%24%5Cwedge%24**BB**%24%5CRightarrow%24%28t%5C%3E0%29%0A**BB**%20%3D%20%28p%24%5Cneq%24q-1%29%20%24%5CLeftrightarrow%24%20p-q+1%24%5Cneq%240%0A%u53C8%u7531P%u6709%0Aq%24%5Cleq%24p+1%20%24%5CLeftrightarrow%24%20p-q+1%24%5Cgeq%240%0A%24%5Ctherefore%24%20t%3Dp-q+1%3E0%0A%u5F97%u8BC1%0A5.%20P%24%5Cwedge%20B_i%20%5CRightarrow%24%20wp%28%22%24t_1%3Dt%3BS_i%24%22%2C%20%22t%3Ct1%22%29%0A%u5BF9%u4E8E%u4E09%u79CD%24S_i%24%2Ct%u90FD%u663E%u7136%u4F1A%u53D8%u5C0F%uFF0C%u6240%u4EE5%u6EE1%u8DB3%0A%0A%u7EFC%u4E0A%uFF0C5%u6761check%20point%u90FD%u6EE1%u8DB3%uFF0C%u7A0B%u5E8F%u6B63%u786E%u6027%u53EF%u4FDD%u8BC1%0A%23%23%23Sort%0A%23%23%23%23%u63A8%u5BFC%0A%u6839%u636E%u5FEB%u901F%u6392%u5E8F%u7B97%u6CD5%u53EF%u77E5%uFF0C%u5BF9%u6570%u7EC4%u6392%u5E8F%uFF0C%u5373%u8FDB%u884C%u82E5%u5E72%u6B21%u5206%u5272%uFF0C%u76F4%u81F3%u5B50%u533A%u95F4%u5305%u542B%24%5Cleq%242%u4E2A%u5143%u7D20%uFF0C%u5373%u53EF%u4EE5%u8FDB%u884C%u76F4%u63A5%u6392%u5E8F%u3002%0A*%20P%3A%20*s*%20is%20a%20set%20of%20pairs%20%28i%2C%20j%29%20representing%20disjoint%20array%20sections%20b%5Bi%3Aj%5D%20of%20b.%20Further%uFF0Cb%5B0%3An%u20141%5D%20is%20ordered%20iff%20all%20the%20disjoint%20partitions%20given%20by%20set%20*s*%20are.%0A*%20IS%3A%20*s*%3A%3D%7B%280%2Cn-1%29%7D%0A*%20R%3A%20b%5B0%3An-1%5D%20are%20ordered%0A*%20t%3A%20n%20-%20ordered%0A%0A%u5FEB%u901F%u6392%u5E8F%u7A0B%u5E8F%u5982%u4E0B%3A%0A*s*%3A%3D%7B%280%2Cn-1%29%7D%0A%7B*Invariant*%3A%20%u5982%u4E0AP%7D%0A**do**%20*s*%24%5Cneq%24%7B%7D%20%24%5Crightarrow%24%20Choose%28%28i%2Cj%29%2C*s*%29%3B%20s%3A%3Ds-%7B%28i%2Cj%29%7D%3B%0A%u3000%u3000%u3000**if**%20j-i%20%5C%3C%202%20%24%5Crightarrow%24%20Sort%20b%5Bi%3Aj%5D%20directly%0A%u3000%u3000%u3000%24%5Csquare%24%20j-i%20%24%5Cgeq%242%20%24%5Crightarrow%24%20Partition%28b%2Ci%2Cj%2Cp%3B%29%3B%20%24s%3A%3Ds%5Ccup%20%7B%28i%2Cp-1%29%7D%20%5Ccup%20%7B%28p+1%2Cj%29%7D%24%0A%u3000%u3000%u3000**fi**%0A**od**%0A%23%23%23%23C%u4EE3%u7801%0A%u6700%u7EC8Quick%20Sort%20C%u4EE3%u7801%u5B9E%u73B0%u5982%u4E0B%3A%0A%60%60%60c%0A%23define%20N%09%09%0950%0A%23define%20MAX_SPLIT%20%0950%20//%20This%20should%20be%20logN%0Avoid%20swap%28int*%20b%2C%20int%20p%2C%20int%20q%29%0A%7B%0A%09b%5Bp%5D%3Db%5Bp%5D+b%5Bq%5D%3B%0A%09b%5Bq%5D%3Db%5Bp%5D-b%5Bq%5D%3B%0A%09b%5Bp%5D%3Db%5Bp%5D-b%5Bq%5D%3B%0A%7D%0Aint%20Partition%20%28int*%20b%2C%20int%20m%2C%20int%20n%29%0A%7B%0A%09assert%28n%3Em%29%3B%0A%09int%20p%3Dn-1%2C%20q%3Dm+1%3B%0A%09while%20%28p%20%21%3D%20q-1%29%0A%09%7B%0A%09%09if%20%28b%5Bp%5D%3Ex%29%0A%09%09%7B%0A%09%09%09p--%3B%0A%09%09%7D%0A%09%09else%20if%20%28b%5Bq%5D%3C%3Dx%29%0A%09%09%7B%0A%09%09%09q++%3B%0A%09%09%7D%0A%09%09else%20if%20%28b%5Bq%5D%3C%3Dx%20%26%26%20b%5Bp%5D%3Ex%29%0A%09%09%7B%0A%09%09%09swap%28b%2C%20p%20%2Cq%29%3B%0A%09%09%09p--%3B%0A%09%09%09q++%3B%0A%09%09%7D%0A%09%7D%0A%09return%20p%3B%0A%7D%0Avoid%20QuickSort%28int*%20b%2C%20int%20n%29%0A%7B%0A%09typedef%20struct%20%0A%09%7B%0A%09%09int%20start%3B%0A%09%09int%20end%3B%0A%09%7DPair%20s%5BMAX_SPLIT%5D%20%3D%20%7B0%7D%3B%0A%09int%20count%20%3D%201%3B%20//%20how%20many%20pairs%20in%20s%0A%09s%5B0%5D.start%20%3D%200%3B%0A%09s%5B0%5D.end%20%3D%20n-1%3B%0A%09while%20%28count%20%3E%200%29%0A%09%7B%0A%09%09Pair%20p%3B%0A%09%09memcpy%28%26p%2C%20%26s%5Bcount-1%5D%2C%20sizeof%28Pair%29%29%3B%0A%09%09if%28p.end%20-%20p.start%20%3C%202%29%0A%09%09%7B%0A%09%09%09if%20%28p.start%20%3E%20p.end%29%0A%09%09%09%7B%0A%09%09%09%09swap%20%28b%2C%20p.start%2C%20p.end%29%3B%0A%09%09%09%09count%20--%3B%0A%09%09%09%7D%0A%09%09%09else%0A%09%09%09%7B%0A%09%09%09%09int%20m%20%3D%20p.start%3B%0A%09%09%09%09int%20n%20%3D%20p.end%20-%20p.start%20+%201%3B%0A%09%09%09%09int%20x%20%3D%20Partition%28b%2C%20m%2C%20n%29%3B%0A%09%09%09%09s%5Bcount-1%5D.start%20%3D%20p.start%3B%0A%09%09%09%09s%5Bcount-1%5D.end%20%3D%20x-1%3B%0A%09%09%09%09s%5Bcount%5D.start%20%3D%20x+1%3B%0A%09%09%09%09s%5Bcount%5D.end%20%3D%20p.end%3B%0A%09%09%09%09count%20++%3B%0A%09%09%09%7D%0A%09%09%7D%20%0A%09%7D%0A%7D%0A%60%60%60%0A%0A%0A%0A%0A%0A%0A]]></content>
      <tags>
        <tag>读书笔记</tag>
        <tag>Programming</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[QuickSort推导 - The Science of Programming]]></title>
    <url>%2F2016%2F01%2F04%2Fquicksort-tui-dao-the-science-of-programming-trashed%2F</url>
    <content type="text"><![CDATA[@(学习笔记)[读书笔记, Programming] 由于近日开发单片机程序的时候，写到一个小循环，不能确定其正确性，进而想到这本书的内容，算是一个小小的回顾。本书的读书笔记参考这篇The Science of Programming。正所谓温故而知新，这次重新摘读又有些新的收获。本想以QuickSort作为一个练习来运用本书的知识，结果尝试了许久，发现越陷越深。最后还是找了书上的例子（书中有QuickSort的例子）。本文最终目标是阐述如何推导QuickSort程序本身。先摘取一些重要的知识点,再利用这些知识点来推导QuickSort。 知识点梳理 1. Quantification（量化）[原书4.2节] 2. 何为wp？[原书第7章] 3. 循环检查 (原书第11章) Invariant Bound Checklist 4. 如何运用所有的知识来开发一段程序（原书PART III） 推测Command 获得Guard（原书第15章） 获得不变量Invariant（原书第16章） 推导Quick Sort （原书18.2节） Partition （原书练习16.5） 由R获得P 由P $wedge daleth$BB $Rightarrow$R推算BB Bound function 推测command 由command+P+BB获得Guard 验证 Sort 推导 C代码 知识点梳理1. Quantification（量化）[原书4.2节] There exists(E i: m\(\leq\)i&lt;n: Ei) For all(A i: m\(\leq\)i&lt;n: Ei) Numerial(N i: m\(\leq\)i&lt;n: Ei) 他们有以下特性 (E i: m\(\leq\)i&lt;k+1: Ei) = (E i: m\(\leq\)i&lt;k: Ei) V Ek+1(A i: m\(\leq\)i&lt;n: Ei) = \(\daleth\)(E i: m\(\leq\)i&lt;n: \(\daleth\)Ei)(E i: m\(\leq\)i&lt;n: Ei) = (N i: m\(\leq\)i&lt;n: Ei) \(\geq\) 1(A i: m\(\leq\)i&lt;n: Ei) = (N i: m\(\leq\)i&lt;n: Ei) = n-m 2. 何为wp？[原书第7章]原书的定义： The Predicate Transformer wp The set of all states such that execution of S begun in any one of them is guaranteed to terminate in a finite amount of time in a state satisfying R. wp通常被用来表达一段程序\[\{Q\}S\{R\}\]或者这样写\[Q\Rightarrow wp(S,R)\]- Q:前条件 - S:执行代码（原文称为commands） - R:后条件 wp的特性 1) wp(S,F) = F 2) wp(S ^ Q) ^ wp(S,R) = wp(S,Q ^ R ) 3) if Q then wp(S, Q ) \(\Rightarrow\) wp(S, R) 4) wp(S wp(S, R)) \(\Rightarrow\) wp(S ,Q v R) 5) wp(S, Q) V wp(S, R) = wp(S, Q V R) (for deterministic S) 3. 循环检查 (原书第11章)定义 \[ wp(DO, R) \Rightarrow (E k: 0\leq k: H_k(R))\] 用数学语言标记一个循环如下: {Q} {inv P: the invariant} {bound t: the bound function} {init IS: initialization command} do _B_1 \(\rightarrow\) _S_1 \(\square\ \cdots\) \(\square\ \) _B_n \(\rightarrow\) _S_n od Invariant A predicate P that is true before and after each iteration of a loop. 这就是说P在任何情况下都要成立，于是有 - Q \(\Rightarrow\) wp(IS, P) - P \(\Rightarrow\) wp(DO, P ^ \(\daleth\)BB) Bound又叫bound function The function changes at each iteration; the relation remains invariantly true.each iteration decreases t by at least one，so that termination is guaranteed to occur. 检查bound函数确保循环能结束。 Checklist非常重要!!! 1. Q \(\Rightarrow\) wp(IS, P)2. P ^ Bi \(\Rightarrow\) wp(Si, P)3. P ^ \(\daleth\)BB \(\Rightarrow\) R4. P ^ BB \(\Rightarrow\) (t &gt; 0)5. P ^ Bi \(\Rightarrow\) wp(t1:=t; Si, t &lt; t1) 依次验证这5条，就能证明一个循环的正确性了 4. 如何运用所有的知识来开发一段程序（原书PART III）推测Command通过后条件R，来推测执行代码(Command)。这就是所谓的Programming as a Goal-Oriented Activity。详情参看原书第14章。 Strategy for developing an alternative command: To invent a guarded command，find a command C whose execution will establish postcondition R in at least some cases; find a Boolean B satisfying B\(\Rightarrow\)wp(C,R) and put them together to form B \(\rightarrow\)C. Continue to invent guarded commands until the precondition of the construct implies that at least one guard is true. - 原文(14.7) 获得Guard（原书第15章）所有的编程都应该是结果导向的（这与测试驱动开发TDD的思想暗合）。所以后条件R是最先有的。其次，通过P \(\wedge\ \daleth\)BB \(\Rightarrow\) R能得到BB（即guard）。虽然有公式A\(\Rightarrow\)B &lt;=&gt; \(\daleth\)A V B=T，但是B的获得感觉更多是依靠分析而不是推导。具体例子会在本文最后推导Quick Sort中提及。其中\[ \mathbf B \mathbf B = B_1 \wedge \ B\_2 \wedge \ldots \ B\_n\]不过由上式可知，此时的guard还是个总的guard，还需要将之分解为各个Bi。 获得不变量Invariant（原书第16章）书中给了4种方法： 1. Delete a conjunct. For example, predicate A ^ B ^ C can be weakened to A ^ C 2. Replace a constant by a variable. For example, predicate x \(\leq\)b[1:10], where x is a simple variable，can be weakened to x \(\leq\) b[1:i] ^ 1\(\leq i \leq\)10，where i is a fresh variable. Since a newvariable has been introduced, its possible set of values must be precisely stated. 3. Enlarge the range of a variable. For example, predicate 5 \(\leq\) i &lt; 10 can be weakened to 0 \(\leq\) i &lt; 10. 4. Add a disjunct. For example, predicate A can be weakened to A v B, for some other predicate B. 书中推荐用前三个，根据阅读本书后面部分的经验，最常用的还是第二条。 推导Quick Sort （原书18.2节）本文以推导快速排序作为结束。快速排序的核心思想就是不断分割，在小数组中递归的作排序，直到小数组的元素个数少于或等于2个，即可进行直接排序了。所以分成Partition和Sort两部分。 Partition （原书练习16.5）一次分割的后条件如下R: \(m\leq p&lt;n \wedge perm(b, B) \wedge b\) 由R获得P通过上一节中的方法二Replace a constant by a variable.来得到P。P: \(m&lt;q \leq p+1 \leq n \wedge x=B[m] \wedge \) 由P \(\wedge \daleth\)BB \(\Rightarrow\)R推算BB注意是推算，不是严格的逻辑推导\(\because\ \)P \(\wedge\) (p-q+1=0) \(\Leftrightarrow\) R\(\therefore\ \daleth\)BB = (p-q+1=0)\(\therefore\ \)BB = (p\(\neq\)q-1) Bound functiont = p-q+1 推测command由QuickSort的基本算法可知，有三个可能的command1. q++2. p–3. swap(b[p], b[q])所以现在程序形式如下：do p\(\neq\)q-1 if__ \(\rightarrow\) p:=p-1 \(\square\) __ \(\rightarrow\) q:=q+1 \(\square\) __ \(\rightarrow\) swap(b[p], b[q]) fiod 由command+P+BB获得GuardP\(\wedge\)BB\(\wedge B_i \Rightarrow\)wp(S,P)1. S = p:=p-1 wp(S,P) = \((m]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Markdown对数学公式的支持]]></title>
    <url>%2F2015%2F12%2F26%2FMarkdown%E5%AF%B9%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E7%9A%84%E6%94%AF%E6%8C%81%2F</url>
    <content type="text"><![CDATA[EditMarkdown&#x5BF9;&#x6570;&#x5B66;&#x516C;&#x5F0F;&#x7684;&#x652F;&#x6301;MathJax Markdown&#x7684;&#x4E66;&#x5199;&#x5DE5;&#x5177;&#x591A;&#x5982;&#x725B;&#x6BDB;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E0D;&#x5C3D;&#x76F8;&#x540C;&#xFF0C;&#x6709;&#x4E9B;&#x652F;&#x6301;LaTex&#x6709;&#x4E9B;&#x4E0D;&#x652F;&#x6301;&#x3002;&#x652F;&#x6301;&#x8005;&#x5982;&#x9A6C;&#x514B;&#x98DE;&#x8C61;&#xFF0C;CMD&#x5DE5;&#x4F5C;&#x7AD9;&#xFF1B;&#x4E0D;&#x652F;&#x6301;&#x8005;&#x5982;&#x6211;&#x6B63;&#x5728;&#x7528;&#x7684;MacDown&#x3002;&#x4E0D;&#x8FC7;&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;&#x56E0;&#x4E3A;Markdown&#x4E0E;HTML&#x7684;&#x5929;&#x751F;&#x8054;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x7684;&#x5185;&#x5D4C;MathJax&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;MathJax&#x5B98;&#x65B9;&#x6587;&#x6863;&#x8BF4;&#x8981;&#x5C06;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x6807;&#x7B7E;&#x52A0;&#x5230;&#x7F51;&#x9875;&#x7684;&#x4E2D;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x4EEC;&#x52A0;&#x5230;&#x4E2D;&#x4F7F;&#x7528;&#x6548;&#x679C;&#x4E5F;&#x662F;&#x4E00;&#x6837;1.&lt;script type=&quot;text/javascript&quot;2. src=&quot;https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML.js&quot;&gt;3.&lt;/script&gt;&#x68C0;&#x9A8C;&#x4E00;&#x4E0B;&#x6548;&#x679C;&#x884C;&#x7EA7;: $\daleth$ - Science of Programming&#x4E2D;&#x5E38;&#x7528;&#x7684;&#x7B26;&#x53F7;&#xFF0C;&#x8868;&#x793A;&#x53D6;&#x53CD;&#x5757;&#x7EA7; $$bla..bla..bla$$ &#x53E6;&#x5916;&#x4E00;&#x70B9;&#x8FD8;&#x9700;&#x8981;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;Markdown&#x4E2D;&#x884C;&#x5185;&#x5185;&#x5D4C;&#x6570;&#x5B66;&#x516C;&#x5F0F;&#x7684;&#x6807;&#x8BB0;&#x662F;$...$&#xFF0C;&#x800C;MathJax&#x9ED8;&#x8BA4;&#x5E76;&#x4E0D;&#x652F;&#x6301;&#x8BE5;&#x6807;&#x8BB0;&#xFF0C;&#x5B98;&#x65B9;&#x7684;&#x8BF4;&#x6CD5;&#x662F;That is because dollar signs appear too often in non-mathematical settings, which could cause some text to be treated as mathematics unexpectedly.MathJax&#x4E2D;&#x9ED8;&#x8BA4;&#x7684;&#x884C;&#x5185;&#x5185;&#x5D4C;&#x516C;&#x5F0F;&#x6807;&#x8BB0;&#x662F;\(...\)&#xFF0C;&#x5199;&#x4F5C;\\(...\\)&#xFF0C;&#x4F8B;&#x5982;\\(\daleth\\)&#x52A0;&#x4E0A;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5C31;&#x80FD;&#x8BA9;MathJax&#x652F;&#x6301;$...$&#x4E86;1.&lt;script type=&quot;text/x-mathjax-config&quot;&gt; MathJax.Hub.Config({ 2. tex2jax: {inlineMath: [[&apos;$&apos;,&apos;$&apos;], [&apos;\\(&apos;,&apos;\\)&apos;]]} }); &lt;/script&gt; 3.&lt;script type=&quot;text/javascript&quot; src=&quot;path-to-mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;&gt;&lt;/script&gt;&#x800C;&#x9A6C;&#x514B;&#x98DE;&#x8C61;&#x4E2D;&#x7684;MathJax&#x53EF;&#x80FD;&#x7ECF;&#x8FC7;&#x5B9A;&#x5236;&#xFF0C;&#x662F;&#x9ED8;&#x8BA4;&#x652F;&#x6301;$...$&#x5185;&#x5D4C;&#x7684;%3Cscript%20type%3D%22text/javascript%22%0A%09%20src%3D%22https%3A//cdn.mathjax.org/mathjax/latest/MathJax.js%3Fconfig%3DTeX-AMS-MML_HTMLorMML.js%22%3E%0A%3C/script%3E%0A%5BTOC%5D%0A%23Markdown%u5BF9%u6570%u5B66%u516C%u5F0F%u7684%u652F%u6301%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5BMarkdown%5D%0AMarkdown%u7684%u4E66%u5199%u5DE5%u5177%u591A%u5982%u725B%u6BDB%uFF0C%u4F46%u662F%u5B9E%u73B0%u65B9%u5F0F%u4E0D%u5C3D%u76F8%u540C%uFF0C%u6709%u4E9B%u652F%u6301LaTex%u6709%u4E9B%u4E0D%u652F%u6301%u3002%u652F%u6301%u8005%u5982%u9A6C%u514B%u98DE%u8C61%uFF0CCMD%u5DE5%u4F5C%u7AD9%uFF1B%u4E0D%u652F%u6301%u8005%u5982%u6211%u6B63%u5728%u7528%u7684MacDown%u3002%u4E0D%u8FC7%u6CA1%u5173%u7CFB%uFF0C%u56E0%u4E3AMarkdown%u4E0EHTML%u7684%u5929%u751F%u8054%u7CFB%uFF0C%u6211%u4EEC%u53EF%u4EE5%u5F88%u597D%u7684%u5185%u5D4C%5BMathJax%5D%28http%3A//docs.mathjax.org/en/latest/start.html%23mathjax-cdn%29%u6765%u89E3%u51B3%u8FD9%u4E2A%u95EE%u9898%u3002%0A%0A%23%23MathJax%0A%u5B98%u65B9%u6587%u6863%u8BF4%u8981%u5C06%u4E0B%u9762%u8FD9%u4E2A%u6807%u7B7E%u52A0%u5230%u7F51%u9875%u7684%3Chead%3E%u4E2D%uFF0C%u4E0D%u8FC7%u6211%u4EEC%u52A0%u5230%3Cbody%3E%u4E2D%u4F7F%u7528%u6548%u679C%u4E5F%u662F%u4E00%u6837%0A%09%0A%09%3Cscript%20type%3D%22text/javascript%22%0A%09%20%20src%3D%22https%3A//cdn.mathjax.org/mathjax/latest/MathJax.js%3Fconfig%3DTeX-AMS-MML_HTMLorMML.js%22%3E%0A%09%3C/script%3E%0A%09%0A%09%0A%u68C0%u9A8C%u4E00%u4E0B%u6548%u679C%0A%0A*%20%u884C%u7EA7%3A%20%0A%20%20%20%20%5C%24%5Cdaleth%5C%24%0A%24%5Cdaleth%24%20-%20Science%20of%20Programming%u4E2D%u5E38%u7528%u7684%u7B26%u53F7%uFF0C%u8868%u793A%u53D6%u53CD%0A*%20%u5757%u7EA7%0A%20%20%20%20%5C%24%5C%24bla..bla..bla%5C%24%5C%24%0A%24%24x%3D%5Cfrac%7B-b%5Cpm%5Csqrt%7Bb%5E2-4ac%7D%7D%7B2a%7D%24%24%0A%0A%u53E6%u5916%u4E00%u70B9%u8FD8%u9700%u8981%u8BF4%u660E%u7684%u662F%uFF0CMarkdown%u4E2D%u884C%u5185%u5185%u5D4C%u6570%u5B66%u516C%u5F0F%u7684%u6807%u8BB0%u662F%60%24...%24%60%uFF0C%u800CMathJax%u9ED8%u8BA4%u5E76%u4E0D%u652F%u6301%u8BE5%u6807%u8BB0%uFF0C%u5B98%u65B9%u7684%u8BF4%u6CD5%u662F%0A%3EThat%20is%20because%20dollar%20signs%20appear%20too%20often%20in%20non-mathematical%20settings%2C%20which%20could%20cause%20some%20text%20to%20be%20treated%20as%20mathematics%20unexpectedly.%0A%0AMathJax%u4E2D%u9ED8%u8BA4%u7684%u884C%u5185%u5185%u5D4C%u516C%u5F0F%u6807%u8BB0%u662F%60%5C%28...%5C%29%60%uFF0C%u5199%u4F5C%60%5C%5C%28...%5C%5C%29%60%uFF0C%u4F8B%u5982%60%5C%5C%28%5Cdaleth%5C%5C%29%60%u52A0%u4E0A%u4E0B%u9762%u8FD9%u6BB5%u4EE3%u7801%u5C31%u80FD%u8BA9MathJax%u652F%u6301%60%24...%24%60%u4E86%0A%60%60%60xml%0A%3Cscript%20type%3D%22text/x-mathjax-config%22%3E%20MathJax.Hub.Config%28%7B%20%0A%20%20%20%20tex2jax%3A%20%7BinlineMath%3A%20%5B%5B%27%24%27%2C%27%24%27%5D%2C%20%5B%27%5C%5C%28%27%2C%27%5C%5C%29%27%5D%5D%7D%20%7D%29%3B%20%3C/script%3E%20%0A%3Cscript%20type%3D%22text/javascript%22%20src%3D%22path-to-mathjax/MathJax.js%3Fconfig%3DTeX-AMS-MML_HTMLorMML%22%3E%3C/script%3E%0A%60%60%60%0A%0A%u800C%u9A6C%u514B%u98DE%u8C61%u4E2D%u7684MathJax%u53EF%u80FD%u7ECF%u8FC7%u5B9A%u5236%uFF0C%u662F%u9ED8%u8BA4%u652F%u6301%60%24...%24%60%u5185%u5D4C%u7684%0A]]></content>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[The Science of Programming]]></title>
    <url>%2F2013%2F08%2F08%2FThe_Science_of_Programming%2F</url>
    <content type="text"><![CDATA[Chp 1. Propositionsconjunction: b ^ cdisjunction: b V cimplication: b =&gt; c1.4 Precedence Rules for OperatorsThe order of evaluation of different, adjacent operators is given by the list: not (has highest precedence and binds tightest), and&#xFF0C; or&#xFF0C; imp&#xFF0C;equals1.6 Propositions as Sets of StatesA proposition represents, or describes&#xFF0C;the set of states in which it is true.Weak &amp; StrongProposition b is weaker than c if c =&gt;b. Correspondingly, c is said to be stronger than b. The weakest proposition is T (or any tautology), because it represents the set of all states; the strongest is F.Chp 2. Reasoning using Equivalence TransformationsAn equivalence is an equality that is a tautology.12&#x6761;law&#xFF0C;&#x6240;&#x6709;&#x8BC1;&#x660E;&#x7684;&#x57FA;&#x7840;1. Commutative Laws (These allow us to reorder the operands of and, or and equality):(E1 ^ E2) = (E2 ^ E1)(E1 v E2) = (E2 v E1)(E1 = E2 ) = (E2 = E1)2. Associative Laws (These allow us to dispense with parentheses when dealing with sequences of and and sequences of or):E1 ^ (E2 ^ E3) = (E1 ^ E2)^E3 (so write both as E1^E2^E3)E1 v (E2 v E3) = ( E1 v E2 ) v E33. Distributive Laws (These are useful in factoring a proposition, in the same way that we rewrite 2*(3+4) as (2*3)+(2*4)):E1 v ( E2 ^ E3 ) = (E1 v E2) ^ (E1 v E3 )E1 ^ (E2 v E3) = ( E1 ^ E 2 ) v ( E1 ^ E3 )4. De Morgan&#x2019;s Laws (After Augustus De Morgan, a 19th century English mathematician who&#xFF0C;along with Boole&#xFF0C;laid much of the founda&#xAD;tions for mathematical logic):&#x2510;(E1 ^ E2 ) = &#x2510;E1 v &#x2510;E2&#x2510;(E1 v E2) = &#x2510;E1 ^ &#x2510;E25. Law of Negation: &#x2510;(&#x2510;E1) = E16. Law of the Excluded Middle: E1 v &#x2510;E1 = T7. Law of Contradiction: E1 ^ &#x2510;El = F8. Law of Implication: E1 =&gt;E2 = &#x2510;E1 v E29. Law of Equality: (El = E2) = (E1 =&gt; E2)^(E2=&gt;E1)10. Laws of or-simplification:E1 v E1 = E1E1 v T = TE1 v F = E1E1 v (E1 ^ E2 ) = El11. Laws of and-simplification:E1 ^ E1 = E1E1 ^ T = E1E1 ^ F = FE1 ^ (E1 v E2) = E112. Law of Identity: E1 = E1&#x6BD4;&#x8F83;&#x4E0D;&#x5BB9;&#x6613;&#x60F3;&#x5230;&#x7684;&#x662F;&#x7B2C;8&#x6761;&#x548C;&#x7B2C;9&#x6761;&#xFF0C;&#x8981;&#x7262;&#x8BB0;&#xFF0C;&#x4E4B;&#x540E;&#x7684;&#x8BC1;&#x660E;&#x4F1A;&#x7ECF;&#x5E38;&#x7528;&#x5230;&#x3002;&#x53E6;&#x5916;&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x672C;&#x5B9A;&#x7406;&#x4E2D;&#x8FD8;&#x53EF;&#x4EE5;&#x63A8;&#x5BFC;&#x51FA;&#x4EE5;&#x4E0B;&#x7684;&#x5F15;&#x7406;&#x3002;&#x91CD;&#x8981;&#x5F15;&#x7406;&#xFF1A;(E1=&gt;E2) =&gt; (E1^E2=&gt;E1)&#x8BC1;&#x660E;&#xFF1A;1) E1^E2=&gt;E1=T 2) E1=&gt;E1^E2=T= &#x2513;(E1^E2)VE2 = &#x2513;E1V(E1^E2)= &#x2513;E1V&#x2513;E2VE2 = (&#x2513;E1VE1)^(&#x2513;E1VE2)= T = T ^ T = T&#x8FD9;&#x4E2A;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5BB9;&#x6613;&#x80FD;&#x770B;&#x51FA;&#x6765;&#xFF0C;&#x6240;&#x4EE5;&#x7ED9;&#x51FA;&#x8BC1;&#x660E;&#x3002;&#x8FD9;&#x4E2A;&#x63A8;&#x5BFC;&#x8868;&#x793A;: &#x5982;&#x679C;E1=&gt;E2&#xFF0C;&#x8868;&#x793A;E1&#x662F;E2&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x96C6;Chp 3. A Natural Deduction System (skip)Chp 4. Predicatescand &amp; corThe operands of these new operators can be any of three values: F, T and U (for Undefined).cand/cor &#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x5B9A;&#x7406;2. Associativity:E1 cand (E2 cand E3) = (E1 cand E2) cand E3E1 cor (E2 cor E3) = (E1 cor E2) cor E33. Distributivity:E1 cand (E2 cor E3) = (E1 cand E2) cor (E1 cand E3)E1 cor (E2 cand E3) = (E1 cor E2) cand (E1 cor E3)4. De Morgan:&#x2510;(E1 cand E2) = &#x2510;E1 cor &#x2510;E2&#x2510;(El cor E2) = &#x2510;E1 cand &#x2510;E26. Excluded Middle: E1 cor &#x2510;E1 = T (provided E1 is well-defined)7. Contradiction: E1 cand &#x2510;E1 = F (provided E1 is well-defined)10. cor-simplificationE1 cor E1 = E1E1 cor T = T (provided El is well-defined)E1 cor F = E1E1 cor (E1 cand E2) = E111. cand-simplificationE1 cand E1 = E1E1 cand T = E1E1 cand F = F (provided El is well-defined)E1 cand (E1 cor E2) = E14.2 Quantificationsummarize: (&#x2211;: i: 0&lt;i&lt;n:xi)&#x8FDE;&#x4E58;&#x79EF;: (&#x220F;: i: 0&lt;i&lt;n:xi)exist one: (E: i: 0&lt;i&lt;n: xi)for all: (A: i: 0&lt;i&lt;n: xi)free &amp; bound(A i:m ( i &lt; n : x*i &gt;0)m, n and x are free identifiers of the predicate. Identif&#xAD;ier i is bound.4.4 Textual Substitution&#x4EC0;&#x4E48;&#x53EB;bound&#x5B57;&#x7B26;&#xFF1F;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;But this is not the desired predicate&#xFF0C;because the i in y &#x2014;i has become &#xA0;bound to the quantifier A, since it now occurs within the scope of A.&#x8981;&#x8FD9;&#x6837;&#x66FF;&#x6362;&#xFF0C;&#x628A;bound&#x5B57;&#x7B26;&#x5148;&#x66FF;&#x6362;&#x6210;&#x5176;&#x4ED6;&#x7684;&#x5B57;&#x7B26;&#xFF0C;&#x4EE5;&#x514D;&#x9020;&#x6210;confuse&#x3002;Chp 5. Notations and Conventions for ArraysArray b is considered to be a (partial) function: b is a simple variable that contains a function from subscript values to integers.However, when developing a program to meet the specification it is often advantageous to expand the abbrevia&#xAD;tions into their full form&#xFF0C;because the full form can give more insight into program development.Chp 6. Using Assertions To Document Programs{Q}S{R}Q is called the precondition or input assertion of S; R the postcondition, output assertion or result assertion.6.3 Proof OutlinesA predicate placed in a program is called an assertion, we assert it is true at that point of execution. A program together with an assertion between each pair of statements is called a proof outline.Part II The Semantics of a Small LanguageChapter 7 The Predicate Transformer wpwp( S, R)The set of all states such that execution of S begun in any one of them is guaranteed to terminate in a finite amount of time in a state satisfying R.We call wp( S, R ) the weakest precondition of S with respect to R&#xFF0C;since it represents the set of all states such that execution begun in any one of them will terminate with R true.weakest&#x8868;&#x793A;&#x66F4;&#x5BB9;&#x6613;&#x8FBE;&#x5230;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x8868;&#x793A;&#x6700;&#x5927;&#x5B50;&#x96C6;&#xFF0C;&#x4E00;&#x822C;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x627E;&#x5230;&#x7B26;&#x5408;Q=&gt;wp(S, R)&#x7684;Q&#x3002;&#x7406;&#x89E3;&#x8FD9;&#x70B9;&#x5BF9;&#x672A;&#x6765;&#x7684;&#x63A8;&#x5BFC;&#x5F88;&#x91CD;&#x8981;&#x3002;Some properties of wpLaw of the Excluded Miracle: wp ( S, F) = FDistributivity of Conjunction: wp ( S,Q ) ^ wp ( S,R ) = wp(S, Q ^ R )Law of Monotonicity: if Q=&gt;R then wp ( S, Q ) ^ w p ( S, R)&#x8BC1;&#x660E;&#xFF1A;&#x5229;&#x7528;&#x5F15;&#x7406;Q=&gt;R =&gt; Q^R=Q&#xFF0C;&#x5219;&#x6709;wp(S,Q)=wp(S, Q^R)=wp(S,Q)^wp(S,R)&#xFF0C;&#x2513;wp(S,Q)=&#x2513;(wp(S,Q)^wp(S,R))=&#x2513;wp(S,Q)V&#x2513;wp(S,R)&#x2513;wp(S,Q)Vwp(S,R)=&#x2513;wp(S,Q)V&#x2513;wp(S,R)Vwp(S,R)=T&#xFF0C;&#x5F97;&#x8BC1;Distributivity of Disjunction: wp(S,Q) V wp(S,R) = wp(S,QVR)&#x8BC1;&#x660E;&#xFF1A;&#x539F;&#x5F0F;&#x7B49;&#x4EF7;&#x4E8E;(wp(S,Q)=&gt;wp(S,QVR))^(wp(S,R)=&gt;wp(S,QVR))&#x53EF;&#x4EE5;&#x8BC1;&#x660E;Q=&gt;QVR&#xFF0C;&#x5219;&#x4E0A;&#x5F0F;&#x6839;&#x636E;7.5&#x6709;&#x5DE6;&#x53F3;&#x534A;&#x90E8;&#x5206;&#x5747;&#x4E3A;T&#xFF0C;&#x5373;T^T=T&#xFF0C;&#x5F97;&#x8BC1;wp( S, Q ) ^ wp ( S, R) = w p ( S, Q ^ R) (for deterministic S)Chapter 8 The Commands skip&#xFF0C;abort and Compositionskip &amp; abortwp(skip, R) = Rwp(abort, R) = F(8.3) Definition. wp(&#x201C;S1; S2&#x201D;&#xFF0C;R) = wp(S1, wp(S2, R)).Chapter 9 The Assignment Command*&#x56E0;&#x4E3A;&#x7F16;&#x8F91;&#x5668;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x672C;&#x7B14;&#x8BB0;&#x6240;&#x6709;&#x7684;Definition: wp( &quot;x:= e&quot;, R) = domain(e) cand Rx/edomain(e) is a predicate that describes the set of all states in which e may be evaluated - i.e. is well-defined. It must exclude all states in which evaluation of e would be undefined.Execution of an assignment may change only the variable indicated and evaluation of an expression may change no variable. The ban on side effects is extremely important, for it allows us to con&#xAD;sider expressions as conventional mathematical entities.The definition of wp was used to derive the assignment&#xFF0C;and not only to show that the assignment was correct. &#x8FD9;&#x53E5;&#x8BDD;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x540E;&#x9762;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x7684;&#x5E94;&#x7528;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x90FD;&#x662F;&#x5BF9;&#x8FD9;&#x53E5;&#x8BDD;&#x7684;&#x9610;&#x91CA;&#x3002;P137&#x9875;&#x7684;Remark&#xFF0C;&#x601D;&#x8DEF;&#x5F88;&#x72EC;&#x7279;&#xFF0C;&#x6CA1;&#x6709;&#x5728;&#x672C;&#x4E66;&#x540E;&#x9762;&#x53D1;&#x73B0;&#x5BF9;&#x8BE5;&#x4F8B;&#x5B50;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x7F57;&#x5217;&#x5982;&#x4E0B;&#xFF0C;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x662F;&#x5F88;&#x7406;&#x89E3;9.3 Assignment to an Array Element&#x672C;&#x8282;&#x7528;&#x5230;&#x4E4B;&#x524D;&#x7AE0;&#x8282;&#x63D0;&#x51FA;&#x7684;&#x6570;&#x7EC4;&#x7684;&#x51FD;&#x6570;&#x8868;&#x793A;&#x6CD5;&#xFF0C;&#x5BF9;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x53C2;&#x770B;P140 Example 3&#x3002;&#x5C55;&#x5F00;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x5230;&#x4E24;&#x5206;&#x6CD5;&#xFF0C;=i&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x548C;&#x2260;i&#x7684;&#x60C5;&#x51B5;Chapter 10 The Alternative CommandIF&#xFF1A;BB: B1 v B2 v...v Bn&#x2460; BB is well-defined&#x2461; at least one guard is true&#x2462; Bi =&gt;wp(Si, R)&#x9898;&#x76EE;: S = (10.4), R = i&lt;=m ^ p=(N j: 0&lt;=j&lt;i: b[j]&gt;0)&#x8BC1;&#x660E;&#xFF08;chp10_eg2_prove.txt&#xFF09;:&#x8003;&#x8651;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5F0F;&#x5B50;(b[i]&gt;0 =&gt; i+1&lt;=m ^ p+1=(N j:0&lt;=j&lt;i+1: b[j]&gt;0)) ^ (b[i]&lt;0 =&gt; i+1&lt;=m ^ p=(N j:0&lt;=j&lt;i+1: b[j]&gt;0))1.&#x56E0;&#x4E3A;&#x6709;b[i]&gt;0&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x5F0F;&#x5DE6;&#x534A;&#x8FB9;&#x7B49;&#x4EF7;&#x4E8E;(b[i]&gt;0 =&gt; i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0))2.&#x540C;&#x7406;&#x4E0A;&#x5F0F;&#x53F3;&#x8FB9;&#x7B49;&#x4EF7;&#x4E3A;(b[i]&lt;0 =&gt; i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0))&#x6240;&#x4EE5;example 2&#x7684;&#x8BC1;&#x660E;&#x7B49;&#x4EF7;&#x5982;&#x4E0B;&#xFF1A;b[i]&#x2260;0 ^ (b[i]&gt;0 =&gt; i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0)) ^ (b[i]&lt;0 =&gt; i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0))= b[i]&#x2260;0 ^ (b[i]&#x2264;0 V (i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0))) ^ (b[i]&#x2265;0 V (i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0)))= b[i]&#x2260;0 ^ ((b[i]&#x2264;0 ^ b[i]&#x2265;0) V (i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0)))= b[i]&#x2260;0 ^ (b[i]=0 V (i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0))= b[i]&#x2260;0 ^ i&lt;m ^ p=(N j:0&lt;=j&lt;i: b[j]&gt;0)* For purposes of efficiency the programmer could strengthen the guards to excise the nondeterminism. &#x7A0B;&#x5E8F;&#x5458;&#x901A;&#x5E38;&#x901A;&#x8FC7;&#x52A0;&#x5F3A;&#x6761;&#x4EF6;&#xFF0C;&#x6765;&#x6D88;&#x9664;&#x4E0D;&#x786E;&#x5B9A;&#x6027;&#x4EE5;&#x63D0;&#x9AD8;&#x7A0B;&#x5E8F;&#x6548;&#x7387;&#x3002;Chapter 11 The Iterative CommandChoosing a true guard executing its command is called performing an iteration of the loop.H0(R) = &#x2510;BB ^ RThe following predicate H0(R) represents the set of states in which execution of DO terminates in 0 iterations with R true, because the guards are initially false.Iteration: Choosing a true guard executing its command is called performing an iteration of the loop.Hk(R) = H0(R) v wp (IF&#xFF0C;Hk-1(R))&#xFF0C;for k&gt;0.InvariantA predicate P that is true before and after each iteration of a loop is called an invariant relation, or simply an invariant, of the loop.Checklist for understanding a loop1. Show that P is true before execution of the loop begins.2. Show that {P ^ Bi}Si{P}, for 1&#x2264;i&#x2264;n. That is&#xFF0C;execution of each guarded command terminates with P true, so that P is indeed an invariant of the loop.3. Show that P^&#x2510;BB =&gt; R , i.e. upon termination the desired result is true.4. Show that P^BB =&gt;t&gt;0&#xFF0C;so that t is bounded from below as long as the loop has not terminated.5. Show that {P^Bi } t1:=t; Si {t&lt;t1}, for 1&#x2264;i&#x2264;n, so that each loop iteration is guaranteed to decrease the bound func&#xAD;tion.2,3&#x4E24;&#x6761;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5148;&#x5F97;&#x5230;P,&#x518D;&#x901A;&#x8FC7;3&#x5F97;&#x5230;BB&#xFF0C;&#x518D;&#x901A;&#x8FC7;2&#x5F97;&#x5230;Si&#x3002;1&#x7528;&#x6765;&#x83B7;&#x5F97;&#x521D;&#x59CB;&#x6761;&#x4EF6;&#x3002;4,5&#x7528;&#x6765;&#x83B7;&#x5F97;bound function&#xFF0C;&#x7528;&#x6765;&#x9A8C;&#x8BC1;loop&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;&#x7EB5;&#x89C2;&#x6574;&#x4E66;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A;check list&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x672C;&#x4E66;&#x7684;&#x6838;&#x5FC3;&#x3002;Chapter 12 Procedure Call (skip)Part III The Development of Programs&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x662F;&#x7406;&#x8BBA;&#x63A8;&#x5BFC;&#x7684;&#x57FA;&#x7840;&#x5B9A;&#x7406;&#xFF0C;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x5C06;&#x8BE5;&#x57FA;&#x7840;&#x5B9A;&#x7406;&#x4E0A;&#x5347;&#x5230;&#x5BF9;&#x7A0B;&#x5E8F;&#x7279;&#x5F81;&#x7684;&#x63A8;&#x5BFC;&#xFF0C;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x5C06;&#x6B64;&#x63A8;&#x5BFC;&#x5E94;&#x7528;&#x5230;&#x5F00;&#x53D1;&#x7A0B;&#x5E8F;&#x4EE5;&#x53CA;&#x9A8C;&#x8BC1;&#x7A0B;&#x5E8F;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;Chapter 13 IntroductionIt is just too difficult to prove an already existing program correct, and it is far better to use the proof-of-correctness ideas throughout the program&#xAD;ming process for insight.formality &amp; common senseWhat is needed is a fine balance between the two.Principle: Use theory to provide insight; use common sense and intuition where it is suitable, but fall back on the formal theory for support when difficulties and com&#xAD;plexities arise. &#x7406;&#x89E3;&#x8FD9;&#x6BB5;&#x8BDD;&#x5F88;&#x91CD;&#x8981;Principle: Know the properties of the objects that are to be manipulated by a program.Chapter 14 Programming as a Goal-Oriented ActivityPrinciple: Programming is a goal-oriented activity.Principle: Before attempting to solve a problem, make absolutely sure you know what the problem is.Principle: Before developing a program, make precise and refine the pre- and postconditions.&#x8FD9;&#x4E09;&#x6761;&#x8981;&#x597D;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x5F88;&#x91CD;&#x8981;Strategy for developing an alternative command:&#x2460;find a command C whose execution will establish postcondition R in at least some cases.&#x2461;find a Boolean B satisfying B=&gt;wp(C, R)&#x2462;repeat &#x2460;&#x2461; ---&gt; B1vB2v...vBn = T&#x5173;&#x4E8E;&#x63A8;&#x5BFC;&#x7684;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#x5982;&#x4E0B;&#xFF1A;eg1 (P186) &amp; eg2 (P189)]]></content>
      <tags>
        <tag>读书笔记</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cortex M3 (STM32)]]></title>
    <url>%2F2013%2F05%2F22%2FCortex_M3_(STM32)%2F</url>
    <content type="text"><![CDATA[1.&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xA0; &#xA0; &#xA0;&#x6709;&#x4E24;&#x6839;boot pin&#xFF0C;&#x6765;&#x9009;&#x62E9;&#x542F;&#x52A8;&#x8BBE;&#x5907;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x4ECE;flash&#x542F;&#x52A8;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE;system memory&#x6216;&#x8005;SRAM&#x542F;&#x52A8;&#x3002;&#xA0; &#xA0; &#xA0;&#x5982;&#x679C;&#x8D70;system memory&#x542F;&#x52A8;&#x7684;&#x8BDD;&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x8D70;ST&#x56FA;&#x5316;&#x5728;&#x8FD9;&#x7247;&#x5B58;&#x50A8;&#x533A;&#x7684;Embedded boot loader&#x3002;&#x8FD9;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;bootloader&#xFF0C;&#x4ED6;&#x80FD;&#x63D0;&#x4F9B;&#x7ED9;&#x6211;&#x4EEC;&#x5F88;&#x591A;&#x5176;&#x4ED6;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;IAP&#xFF08;In-Application Programming&#xFF09;&#x518D;&#x770B;memory map&#xFF0C;&#x4EE5;STM32F103ZET6&#x4E3A;&#x4F8B;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x770B;block 00x0000 0000 ~ 0x0007 FFFF&#x8FD9;&#x4E00;&#x6BB5;&#xFF0C;&#x4F1A;&#x88AB;boot pin&#x8FDE;&#x63A5;&#x5230;flash&#xFF08;sram&#xFF0C;system memory&#xFF09;&#x4E0A;&#x7CFB;&#x7EDF;&#x4E0A;&#x7535;&#x540E;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x8DD1;reset&#x6D41;&#x7A0B;&#xFF0C;&#x5F53;&#x8FDB;&#x5165;&#x8F6F;&#x4EF6;&#x6D41;&#x7A0B;&#x65F6;&#xFF0C;&#x5982;&#x4E0B;&#x8FDB;&#x884C;&#x5728;&#x79BB;&#x5F00;&#x590D;&#x4F4D;&#x72B6;&#x6001;&#x540E;&#xFF0C;CM3&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x5C31;&#x662F;&#x8BFB;&#x53D6;&#x4E0B;&#x5217;&#x4E24;&#x4E2A; 32&#x4F4D;&#x6574;&#x6570;&#x7684;&#x503C;&#xFF1A;&#xA0; &#xA0; &#xA0;&#x4ECE;&#x5730;&#x5740; 0x0000,0000&#x5904;&#x53D6;&#x51FA; MSP&#x7684;&#x521D;&#x59CB;&#x503C;&#x3002;&#xA0;&#xA0; &#xA0; &#xA0;&#x4ECE;&#x5730;&#x5740; 0x0000,0004 &#x5904;&#x53D6;&#x51FA; PC &#x7684;&#x521D;&#x59CB;&#x503C;&#x2014;&#x2014;&#x8FD9;&#x4E2A;&#x503C;&#x662F;&#x590D;&#x4F4D;&#x5411;&#x91CF;&#xFF0C;LSB &#x5FC5;&#x987B;&#x662F; 1&#x3002;&#x7136;&#x540E;&#x4ECE;&#x8FD9;&#x4E2A;&#x503C;&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x5730;&#x5740;&#x5904;&#x53D6;&#x6307;&#x3002;&#x7CFB;&#x7EDF;reset&#x5411;&#x91CF;&#x4E00;&#x5B9A;&#x662F;&#x8981;&#x5728;0&#x5730;&#x5740;&#x5904;&#xFF0C;&#x800C;&#x5F02;&#x5E38;&#x5411;&#x91CF;&#x8868;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;SCB_VTOR&#x6765;&#x4FEE;&#x6539;&#x3002;&#x800C;&#x4E14;&#x5411;&#x91CF;&#x8868;&#x7684;&#x7ED3;&#x6784;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x8BE6;&#x60C5;&#x8BF7;&#x89C1;&#x4E0B;&#x56FE;&#x518D;&#x770B;DMR&#x7684;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x4EE3;&#x7801;&#xFF1A;__root&#xA0; const&#xA0; APP_INTVECT_ELEM&#xA0; __vector_table[] @ &quot;.intvec&quot; = {&#xA0;&#xA0;&#xA0; { .Ptr = (void *)__sfe( &quot;CSTACK&quot; )}, &#xA0;/*&#xA0; 0, SP start value. */&#xA0;&#xA0;&#xA0; __iar_program_start, &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;/*&#xA0; 1, PC start value. */&#xA0;&#xA0;&#xA0; App_NMI_ISR, &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;/*&#xA0; 2, NMI. &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;*/&#xA0;&#xA0;&#xA0; App_Fault_ISR, &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;/*&#xA0; 3, Hard Fault. &#xA0; &#xA0; */&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;}APP_INTVECT_ELEM&#xA0;&#xA0;&#x662F;&#x4E00;&#x4E2A;uniontypedef&#xA0; union {&#xA0;&#xA0;&#xA0; CPU_FNCT_VOID&#xA0;&#xA0; Fnct;&#xA0;&#xA0;&#xA0; void&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; *Ptr;} APP_INTVECT_ELEM;&#x7B2C;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x5C31;&#x662F;MSP&#xFF08;Main Stack Pointer&#xFF09;&#x503C;&#xFF0C;__sfe( &quot;CSTACK&quot; )&#x6307;CSTACK&#x6BB5;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x56E0;&#x4E3A;Coretex M3&#x7684;&#x5806;&#x6808;&#x662F;&#x5411;&#x4E0A;&#x751F;&#x957F;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x503C;&#x6B63;&#x597D;&#x662F;&#x6808;&#x5E95;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x6210;&#x5458;__iar_program_start&#x5219;&#x662F;IAR&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x51FD;&#x6570;&#xFF0C;&#x5176;&#x6E90;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x53EF;&#x89C1;&#xFF0C;&#x4F46;&#x4ED6;&#x4F1A;&#x8C03;&#x7528;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#x6765;&#x5B8C;&#x6210;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4EE5;&#x53CA;&#x5916;&#x90E8;memory&#x7684;&#x521D;&#x59CB;&#x5316;&#x3002;&#x5176;&#x5185;&#x5BB9;&#x53EF;&#x53C2;&#x8003;[&#x539F;&#x521B;]&#x5728;main()&#x4E4B;&#x524D;&#xFF0C;IAR&#x90FD;&#x505A;&#x4E86;&#x5565;&#xFF1F; - jk&#x7684;&#x4E13;&#x680F; - &#x535A;&#x5BA2;&#x9891;&#x9053; - CSDN.NET]]></content>
      <tags>
        <tag>arm</tag>
        <tag>单片机</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[哈希搜索]]></title>
    <url>%2F2013%2F04%2F29%2F%E5%93%88%E5%B8%8C%E6%90%9C%E7%B4%A2%2F</url>
    <content type="text"><![CDATA[&#x54C8;&#x5E0C;&#x641C;&#x7D22;&#x662F;&#x5178;&#x578B;&#x7684;&#x4EE5;&#x7A7A;&#x95F4;&#x6362;&#x65F6;&#x95F4;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;&#x4E0D;&#x8BBA;&#x5176;&#x5EFA;&#x7ACB;&#x54C8;&#x5E0C;&#x8868;&#x65F6;&#x95F4;&#xFF0C;&#x8FD8;&#x662F;&#x641C;&#x7D22;&#x65F6;&#x95F4;&#x5747;&#x5C0F;&#x4E8E;&#x4F18;&#x8D28;&#x7B97;&#x6CD5;&#xFF1A;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x548C;&#x4E8C;&#x5206;&#x641C;&#x7D22;&#x3002;&#x5728;&#x6570;&#x7EC4;&#x5C3A;&#x5BF8;&#x4E3A;1&#x4E07;&#xFF0C;&#x54C8;&#x5E0C;&#x53C2;&#x6570;&#x4E3A;1000&#xFF08;&#x54C8;&#x5E0C;&#x51FD;&#x6570;&#x662F;val%HASH_ARG&#xFF09;&#x65F6;&#xFF0C;&#x5176;&#x65F6;&#x95F4;&#x53C2;&#x6570;&#x4E3A;qsort takes: 1755060 ns (1.75 ms)build hash table takes: 1181122 ns (1.18 ms)Array size: 10000, Value range: 10000average search time:binary search: 166 nshash search: 48 ns&#x5176;&#x6392;&#x5E8F;&#x65F6;&#x95F4;&#x51CF;&#x5C11;30%&#xFF0C;&#x5355;&#x6B21;&#x641C;&#x7D22;&#x65F6;&#x95F4;&#x51CF;&#x5C11;70%&#x3002;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x5F88;&#x591A;&#x3002;&#x7F3A;&#x70B9;&#x662F;&#x7531;&#x4E8E;&#x5F15;&#x5165;hash_node&#x7ED3;&#x6784;&#xFF0C;1&#x4E07;&#x4E2A;&#x6574;&#x6570;&#xFF0C;&#x5927;&#x5C0F;&#x4E3A;4Bx1w&#xFF0C;&#x9700;&#x8981;&#x6269;&#x5C55;&#x51FA;16Bx1w&#xFF0C;&#x7A7A;&#x95F4;&#x4F7F;&#x7528;&#x63D0;&#x5347;&#x4E86;4&#x500D;&#x3002;&#x53E6;&#x6709;&#x7A7A;&#x95F4;&#x63D0;&#x5347;&#x4E24;&#x500D;&#x7684;&#x7B97;&#x6CD5;&#xFF08;&#x53C2;&#x8003;&#x6563;&#x5217;&#x6CD5;&#x89E3;&#x51B3;1000&#x4E2A;&#x6574;&#x6570;&#x7684;&#x641C;&#x7D22; - cqnuztq&#x7684;&#x4E13;&#x680F; - &#x535A;&#x5BA2;&#x9891;&#x9053; - CSDN.NET&#xFF09;&#x5F53;&#x6570;&#x7EC4;&#x5C3A;&#x5BF8;&#x8FDB;&#x4E00;&#x6B65;&#x4E0A;&#x5347;&#xFF08;10w&#xFF09;&#xFF0C;&#x800C;&#x503C;&#x57DF;&#x4E0D;&#x53D8;&#x65F6;&#xFF0C;&#x65F6;&#x95F4;&#x53C2;&#x6570;&#x4E3A;qsort takes: 25675050 ns (25.67 ms)build hash table takes: 47017148 ns (47.02 ms)Array size: 100000, Value range: 10000average search time:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; binary search: 220 ns&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; hash search: 276 ns&#x6B64;&#x65F6;&#x54C8;&#x5E0C;&#x641C;&#x7D22;&#x5DF2;&#x7ECF;&#x5728;&#x6392;&#x5E8F;&#x548C;&#x641C;&#x7D22;&#x4E0A;&#xFF0C;&#x5168;&#x9762;&#x843D;&#x540E;&#x4E86;&#x3002;&#x7A76;&#x5176;&#x539F;&#x56E0;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;&#x6570;&#x7EC4;&#x5C3A;&#x5BF8;&#x4E0A;&#x5347;&#xFF0C;&#x4F46;&#x54C8;&#x5E0C;&#x51FD;&#x6570;&#x548C;&#x54C8;&#x5E0C;&#x53C2;&#x6570;&#x5E76;&#x6CA1;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#x54C8;&#x5E0C;&#x51B2;&#x7A81;&#x6570;&#x5927;&#x5927;&#x4E0A;&#x5347;&#x3002;&#x8003;&#x8651;&#x51B2;&#x7A81;&#x7684;&#x6982;&#x7387;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E2A;&#x54C8;&#x5E0C;&#x7D22;&#x5F15;&#x4E0B;&#x7684;&#x51B2;&#x7A81;&#x6570;&#x7EA6;&#x4E3A;&#xFF08;ARRAY_SIZE / HASH_ARG&#xFF09;&#xFF0C;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x53D6;&#x503C;&#x4E3A;&#x4F8B;&#xFF0C;&#x5219;&#x51B2;&#x7A81;&#x6570;&#x4E3A;100&#xFF0C;&#x5373;&#x5176;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;100&#xFF0C;&#x800C;&#x4E8C;&#x5206;&#x641C;&#x7D22;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x4E3A;logn = 16.6&#xFF0C;&#x5DF2;&#x7ECF;&#x8FDC;&#x5C0F;&#x4E8E;&#x54C8;&#x5E0C;&#x641C;&#x7D22;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x4E86;&#x3002;&#x7EFC;&#x4E0A;&#xFF0C;&#x54C8;&#x5E0C;&#x641C;&#x7D22;&#x9002;&#x7528;&#x4E8E;&#x5C5E;&#x6027;&#x503C;&#x8303;&#x56F4;&#x8FDC;&#x5C0F;&#x4E8E;&#x6570;&#x7EC4;&#x4E2A;&#x6570;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x7B14;&#x8BB0;&#x4E2D;&#x6709;&#x4F7F;&#x7528;&#x54C8;&#x5E0C;&#x641C;&#x7D22;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x9610;&#x8FF0;&#x4E86;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#xFF08;&#x4ECE;&#x5927;&#x91CF;&#x6574;&#x6570;&#x4E2D;&#x9009;&#x53D6;&#x6700;&#x5C0F;/&#x5927;&#x7684;&#x82E5;&#x5E72;&#x4E2A; &#xAB; GoCalf Blog&#xFF09;&#x3002;&#x4F46;&#x6570;&#x7EC4;&#x8303;&#x56F4;&#x4E0D;&#x80FD;&#x8FC7;&#x5927;&#xFF0C;&#x5BFC;&#x81F4;&#x51B2;&#x7A81;&#x6570;&#x4E0A;&#x5347;&#x8FC7;&#x5FEB;&#x3002;&#x6216;&#x8005;&#x8BF4;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x54C8;&#x5E0C;&#x641C;&#x7D22;&#x7684;&#x6548;&#x7387;&#xFF0C;&#x6700;&#x597D;&#x80FD;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x80FD;&#x6D88;&#x9664;&#x51B2;&#x7A81;&#x7684;&#x54C8;&#x5E0C;&#x51FD;&#x6570;&#x3002;&#x4E0B;&#x9762;&#x9644;&#x4E0A;&#x6E90;&#x7801;// Hash search// Ben @ 2013-04-29#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt;struct hash_node{&#xA0;&#xA0;&#xA0;&#xA0; int inited;&#xA0;&#xA0;&#xA0;&#xA0; int key;&#xA0;&#xA0;&#xA0;&#xA0; int pos;&#xA0;&#xA0;&#xA0;&#xA0; struct hash_node* next;};#define HASH_ARG&#xA0;&#xA0;&#xA0;&#xA0; 1000static struct hash_node hash_table[HASH_ARG];void build_hash_table(int* L, int size){&#xA0;&#xA0;&#xA0;&#xA0; memset ((char*)hash_table, 0, sizeof(hash_table));&#xA0;&#xA0;&#xA0;&#xA0; int i;&#xA0;&#xA0;&#xA0;&#xA0; for (i=0; i&lt;size; i++)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int index = hash(L[i]);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (hash_table[index].inited == 1)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; struct hash_node* n = &amp;hash_table[index];&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; while (n-&gt;next != NULL)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; n = n-&gt;next;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; n-&gt;next = (struct hash_node*)malloc(sizeof(struct hash_node));&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; n-&gt;next-&gt;inited = 1;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; n-&gt;next-&gt;key = L[i];&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; n-&gt;next-&gt;pos = i;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; n-&gt;next-&gt;next = NULL;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; hash_table[index].inited = 1;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; hash_table[index].key = L[i];&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; hash_table[index].pos = i;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0; }}void destroy_hash_table(){&#xA0;&#xA0;&#xA0;&#xA0; int i;&#xA0;&#xA0;&#xA0;&#xA0; for(i=0; i&lt;HASH_ARG; i++)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; struct hash_node* n = hash_table[i].next;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; while (n != NULL)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; struct hash_node* tmp = n-&gt;next;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; free(n);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; n = tmp;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0; }}int hash(int val){&#xA0;&#xA0;&#xA0;&#xA0; return val%HASH_ARG;}int hsearch(int t, int* L, int size){&#xA0;&#xA0;&#xA0;&#xA0; int index = hash(t);&#xA0;&#xA0;&#xA0;&#xA0; struct hash_node* i = &amp;hash_table[index];&#xA0;&#xA0;&#xA0;&#xA0; while (i != NULL)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (t == i-&gt;key)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; i = i-&gt;next;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0; if (i ==&#xA0; NULL)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return -1;&#xA0;&#xA0;&#xA0;&#xA0; else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return i-&gt;pos;}]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[快速排序-qsort]]></title>
    <url>%2F2013%2F04%2F10%2F%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F-qsort%2F</url>
    <content type="text"><![CDATA[&#x6709;&#x51E0;&#x70B9;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#xFF1A;1.&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x662F;nlogn&#xFF0C;&#x63A8;&#x5230;&#x300A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x300B;&#x4E0A;&#x6709;&#xFF0C;&#x770B;&#x4E0D;&#x61C2;&#x3002;&#x5728;&#x8BB0;&#x5F55;&#x4E3A;&#x6709;&#x5E8F;&#x65F6;&#xFF0C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x9000;&#x5316;&#x6210;&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x3002;2.&#x6CE8;&#x610F;&#x662F;low&#x8DDF;high&#x8BB0;&#x5F55;&#x4EA4;&#x6362;&#xFF0C;&#x800C;&#x5E76;&#x975E;&#x8DDF;&#x67A2;&#x8F74;&#x8BB0;&#x5F55;&#x4EA4;&#x6362;&#x3002;&#x524D;&#x8005;&#x624D;&#x80FD;&#x4FDD;&#x8BC1;low&#xFF0C;high&#x4E24;&#x90E8;&#x5206;&#x7684;&#x57FA;&#x672C;&#x6709;&#x5E8F;&#x3002;&#x53EA;&#x4E0D;&#x8FC7;&#x8981;&#x6CE8;&#x610F;&#xFF0C;low&#xFF0C;high&#x8BB0;&#x5F55;&#x4EA4;&#x6362;&#x540E;&#xFF0C;low&#x8BB0;&#x5F55;&#x672C;&#x8EAB;&#x5B58;&#x5728;&#x5076;&#x7136;&#x6027;&#xFF0C;&#x5373;&#x5176;&#x8DDF;&#x67A2;&#x8F74;&#x8BB0;&#x5F55;&#x7684;&#x76F8;&#x5BF9;&#x5927;&#x5C0F;&#x4E0D;&#x786E;&#x5B9A;&#x3002;&#x9700;&#x8981;&#x6BD4;&#x8F83;&#xFF0C;&#x7136;&#x540E;&#x505A;&#x51FA;&#x4EA4;&#x6362;&#x52A8;&#x4F5C;&#xFF0C;&#x624D;&#x80FD;&#x4FDD;&#x8BC1;&#x524D;&#x540E;&#x4E24;&#x4E2A;&#x5206;&#x652F;&#x7684;&#x57FA;&#x672C;&#x6709;&#x5E8F;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x7EFF;&#x8272;&#x6CE8;&#x91CA;&#x90E8;&#x5206;&#x6240;&#x6307;&#x51FA;&#x7684;&#x3002;================2013/5/2&#x66F4;&#x65B0;===========================Programming Pearls&#x7B2C;11&#x7AE0;&#xFF0C;&#x7740;&#x91CD;&#x4ECB;&#x7ECD;&#x4E86;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF0C;&#x5176;&#x8BB2;&#x89E3;&#x7684;&#x6DF1;&#x5EA6;&#x548C;&#x7B97;&#x6CD5;&#x7684;&#x4F18;&#x7F8E;&#x5EA6;&#x90FD;&#x8FDC;&#x5927;&#x4E8E;&#x4E25;&#x851A;&#x654F;&#x7684;&#x300A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x300B;&#x7B2C;&#x5341;&#x7AE0;&#x6240;&#x4ECB;&#x7ECD;&#x7684;&#x3002;&#x6311;&#x4E00;&#x79CD;&#x6BD4;&#x8F83;&#x57FA;&#x672C;&#x7684;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF0C;&#x5E76;&#x505A;&#x4E00;&#x4E9B;&#x7B14;&#x8BB0;// &#x89E3;&#x51B3;&#x4E86;&#x539F;&#x5148;swap&#x76F8;&#x540C;&#x53D8;&#x91CF;&#x7684;&#x95EE;&#x9898;#define swap(a, b) \&#xA0;&#xA0;&#xA0;&#xA0; if (a!=b)\&#xA0;&#xA0;&#xA0;&#xA0; {\&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; a = (a)+(b);\&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; b = (a)-(b);\&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; a = (a)-(b);\&#xA0;&#xA0;&#xA0;&#xA0; }void qsort(int* L, int size){&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // &#x786E;&#x4FDD;&#x9012;&#x5F52;&#x5FAA;&#x73AF;&#x80FD;&#x7ED3;&#x675F;&#xFF0C;&#x800C;&#x975E;&#x6B7B;&#x5FAA;&#x73AF;&#xA0;&#xA0;&#xA0;&#xA0; if (size &lt;= 1)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// i,j&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4ECE;&#x4E24;&#x4FA7;&#x5F00;&#x59CB;&#x626B;&#x63CF;&#xFF0C;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // while&#x5FAA;&#x73AF;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5C06;&#x6570;&#x7EC4;&#x8F6C;&#x53D8;&#x4E3A;&#x5982;&#x4E0B;&#x56FE;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;//&#xA0;i&#x53D8;&#x91CF;&#x4E3A;&#x4E86;&#x627E;&#x6BD4;t&#x5927;&#x7684;&#x6570;&#xFF0C;j&#x53D8;&#x91CF;&#x4E3A;&#x4E86;&#x627E;&#x6BD4;t&#x5C0F;&#x7684;&#x6570;&#xA0;&#xA0;&#xA0;&#xA0; int t = L[0];&#xA0;&#xA0;&#xA0;&#xA0; int i = 0, j = size;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; while (1)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; do&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; i ++;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; } while (i&lt;size &amp;&amp; L[i]&lt;t);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // &#x6B64;&#x65F6;i&#x6709;&#x4E24;&#x79CD;&#x53EF;&#x80FD;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // 1&#xFF09;i==u, 2&#xFF09;x[i]&gt;=t&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; do&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; j --;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; } while (L[j]&gt;t);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // &#x6B64;&#x65F6;j&#x53EA;&#x6709;&#x4E00;&#x79CD;&#x53EF;&#x80FD;&#xFF1A;x[j]&lt;=t&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // &#x5F53;i,j&#x4EA4;&#x53C9;&#x65F6;&#xFF0C;&#x8BF4;&#x660E;&#x6574;&#x4E2A;&#x6570;&#x7EC4;&#x626B;&#x63CF;&#x5B8C;&#x6BD5;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (i&gt;j)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; swap (L[i], L[j]);&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0; swap(L[0], L[j]);&#xA0;&#xA0;&#xA0;&#xA0; qsort(L, j);&#xA0;&#xA0;&#xA0;&#xA0; qsort(&amp;L[j+1], size-1-j);}&#x6574;&#x4E2A;&#x7B97;&#x6CD5;&#x7684;&#x5173;&#x952E;&#x662F;&#x5728;&#x90A3;&#x4E2A;while(1)&#x5FAA;&#x73AF;&#xFF0C;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x6B64;&#x5FAA;&#x73AF;&#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x7684;&#x7ED3;&#x675F;&#x3002;&#x8981;&#x4FDD;&#x8BC1;&#x6B63;&#x786E;&#xFF0C;&#x8981;&#x4FDD;&#x8BC1;&#x4EE5;&#x4E0B;&#x4E09;&#x70B9;&#xFF1A;&#xA0; &#xA0; &#xA0;1. &#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x540E;&#xFF0C;j&#x70B9;&#x5DE6;&#x4FA7;&#x7684;&#x90FD;&#x8981;&#x5C0F;&#x4E8E;t&#xFF0C;j&#x70B9;&#x53F3;&#x4FA7;&#x90FD;&#x8981;&#x5927;&#x4E8E;t&#xA0; &#xA0; &#xA0;2. &#x5FAA;&#x73AF;&#x4E0D;&#x53D8;&#x5F0F;&#x662F;i &lt;= j&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;3. &#x4FDD;&#x8BC1;&#x5728;&#x4EA4;&#x6362;&#x65F6;&#xFF0C;i&#x3001;j&#x6CA1;&#x6709;&#x4EA4;&#x53C9;============================================================#include &lt;stdio.h&gt;#include &lt;time.h&gt;// &#x6CE8;&#x610F;&#xFF1A;&#x4E0D;&#x52A0;{}&#xFF0C;&#x4F1A;&#x5F71;&#x54CD;&#x5230;if&#x5206;&#x652F;#define swap(a, b) \{\&#xA0;&#xA0;&#xA0;&#xA0; a = (a)+(b);\&#xA0;&#xA0;&#xA0;&#xA0; b = (a)-(b);\&#xA0;&#xA0;&#xA0;&#xA0; a = (a)-(b);\}#define dim(a) (sizeof(a)/sizeof(a[0]))void qsort(int* L, int size);main(){&#xA0;&#xA0;&#xA0;&#xA0; int i;&#xA0;&#xA0;&#xA0;&#xA0; int a[10] = {0};&#xA0;&#xA0;&#xA0;&#xA0; srand(time(NULL));&#xA0;&#xA0;&#xA0;&#xA0; for (i=0; i&lt;dim(a); i++)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; a[i] = rand() % 100;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0; qsort(a, dim(a));&#xA0;&#xA0;&#xA0;&#xA0; printf(&quot;a: &quot;);&#xA0;&#xA0;&#xA0;&#xA0; for (i=0; i&lt;dim(a); i++)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; printf(&quot;%d &quot;, a[i]);&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0; printf(&quot;\n&quot;);}void qsort(int* L, int size){&#xA0;&#xA0;&#xA0;&#xA0; switch (size)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; case 0:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; printf (&quot;empty array is input.\n&quot;);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; case 1:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; printf (&quot;input array has only 1 member.\n&quot;);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; case 2:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (L[0] &gt; L[1])&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; swap(L[0], L[1]);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; default:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int low = 1, high = size - 1;&#xA0;&#xA0;&#xA0;&#xA0; while(low &lt; high)&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; while (low&lt;high &amp;&amp; L[low] &lt;= L[0])&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; low ++;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (low != high)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; swap(L[low], L[high]);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; while (low&lt;high &amp;&amp; L[high] &gt;= L[0])&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; high --;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (low != high)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; swap(L[low], L[high]);&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;//////////////////////&#xA0; &#xA0; &#xA0;// &#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;low&#x7684;&#x4F4D;&#x7F6E;&#x5B58;&#x5728;&#x968F;&#x673A;&#x6027;&#xFF0C;&#x300A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x300B;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x6CE8;&#x610F;&#x5230;&#x8FD9;&#x70B9;&#xA0;&#xA0;&#xA0;&#xA0; if (L[0] &gt; L[low])&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; swap(L[0], L[low])&#xA0;&#xA0;&#xA0;&#xA0; else if (L[0] &lt; L[low])&#xA0;&#xA0;&#xA0;&#xA0; {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; low --;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (low != 0)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; swap(L[0], L[low])&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;//////////////////////&#xA0;&#xA0;&#xA0;&#xA0; qsort(L, low);&#xA0;&#xA0;&#xA0;&#xA0; if (low &lt; size-1)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; qsort(&amp;L[low+1], size-low-1);}]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[swap cache]]></title>
    <url>%2F2013%2F02%2F16%2Fswap_cache%2F</url>
    <content type="text"><![CDATA[1.&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F1A;&#x7528;&#x5230;swap&#xFF1F;&#xA0; &#xA0; &#xA0;1&#xFF09;&#x6362;&#x51FA;&#xA0; &#xA0; &#xA0;&#x5F53;&#x5185;&#x6838;&#x5728;&#x5206;&#x914D;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x8C03;&#x7528;__alloc_pages&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7A7A;&#x95F2;&#x9875;&#xFF0C;&#x5185;&#x6838;&#x4F1A;&#x542F;&#x52A8;&#x9875;&#x9762;&#x4EA4;&#x6362;&#x673A;&#x5236;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;try_to_free_pages&#x3002;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;1293 &#xA0; &#xA0;page = get_page_from_freelist(gfp_mask, order,1294&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; zonelist, ALLOC_NO_WATERMARKS);1295&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (page)1296&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto got_pg;1306 &#xA0; &#xA0;if (!w ait)1307&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto nopage;13161317&#xA0;&#xA0;&#xA0;&#xA0; did_some_progress = try_to_free_pages(zonelist-&gt;zones, gfp_mask);&#xA0; &#xA0; &#xA0;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x5206;&#x914D;&#x8005;&#x5141;&#x8BB8;&#x7B49;&#x5F85;&#xFF0C;&#x5219;&#x4F1A;&#x5F00;&#x59CB;&#x56DE;&#x6536;&#x9875;&#x9762;&#x3002;&#x518D;&#x5F80;&#x4E0B;&#x7684;&#x8C03;&#x7528;&#x5173;&#x7CFB;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;try_to_free_pages-&gt;shrink_zones-&gt;shrink_zone-&gt;shrink_inactive_list-&gt;add_to_swap-&gt;pageout-&gt;(swapper_space.a_ops-&gt;writepage)&#xA0; &#xA0; &#xA0;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5757;&#x8BBE;&#x5907;&#x63A5;&#x53E3;&#xFF0C;&#x5C06;page&#x5199;&#x5230;&#x78C1;&#x76D8;&#x4EA4;&#x6362;&#x5206;&#x533A;&#x7684;swap file&#x4E0A;&#x3002;&#xA0; &#xA0; &#xA0;2&#xFF09;&#x6362;&#x5165;&#xA0; &#xA0; &#xA0;&#x5F53;&#x5F15;&#x53D1;&#x7F3A;&#x9875;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x5185;&#x6838;&#x8C03;&#x7528;handle_pte_fault&#xFF0C;&#x5F53;&#x68C0;&#x6D4B;&#x5230;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;!pte_present(entry) &lt;=&gt; (pte_val(pte) &amp; L_PTE_PRESENT == 0)&#xA0; &#xA0; &#xA0;&#x6B64;&#x65F6;&#x4F1A;&#x8C03;&#x7528;do_swap_page-&gt;read_swap_cache_async-&gt;swap_readpage&#x6765;&#x8BFB;&#x5165;&#x6362;&#x51FA;&#x7684;&#x9875;&#x6570;&#x636E;&#x5230;&#x65B0;&#x7684;&#x4E00;&#x9875;&#xFF0C;&#x539F;&#x5148;&#x7684;&#x9875;&#x9762;&#x4F1A;&#x91CA;&#x653E;&#x6210;hot page&#x5230;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x3002;2.swap&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xA0; &#xA0; &#xA0;swap&#x5C31;&#x662F;&#x4EA4;&#x6362;&#xFF0C;&#x6BCF;&#x6B21;&#x9700;&#x8981;&#x4EA4;&#x6362;&#x54EA;&#x4E9B;&#xFF0C;&#x548C;linux&#x7684;&#x9875;&#x56DE;&#x6536;&#x673A;&#x5236;&#x4E5F;&#x5C31;&#x662F;&#x8457;&#x540D;&#x7684;LRU&#x7B97;&#x6CD5;&#xFF0C;&#x6709;&#x4E9B;&#x76F8;&#x4F3C;&#x3002;&#x5F7C;&#x662F;&#x51B3;&#x5B9A;&#x8981;&#x56DE;&#x6536;&#x54EA;&#x4E9B;&#x3002;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x4E5F;&#x63D0;&#x5230;&#x8FC7;LRU&#x8FD9;&#x4E2A;&#x540D;&#x8BCD;&#x3002;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x4ED6;&#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x7B97;&#x6CD5;&#x4E86;&#x3002;LRU = Least Recently Used&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;LRU&#x7B97;&#x6CD5;&#x3002;&#xA0; &#xA0; &#xA0;&#x5BF9;&#x4E8E;&#x4EA4;&#x6362;&#x7B97;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x9875;&#x9762;&#x7684;&#x65B0;&#x65E7;&#x7A0B;&#x5EA6;&#x4E0D;&#x9700;&#x8981;&#x5F04;&#x7684;&#x90A3;&#x4E48;&#x6E05;&#x695A;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x77E5;&#x9053;&#x6709;&#x4E24;&#x4E2A;list&#xFF1A;active_list &amp; inactive_list&#x3002;&#x6BCF;&#x6B21;try_to_free_pages&#x5728;&#x4EA4;&#x6362;&#x65F6;&#xFF0C;&#x5C06;active page&#x653E;&#x4E00;&#x90E8;&#x5206;&#x5230;inactive list&#xFF0C;&#x518D;&#x5C06;inactive page&#x91CA;&#x653E;&#x4E00;&#x90E8;&#x5206;&#x5230;&#x78C1;&#x76D8;&#x4E0A;&#x3002;&#x5176;&#x6838;&#x5FC3;&#x51FD;&#x6570;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;shrink_zone&#x3002;&#xA0; &#xA0; &#xA0;1&#xFF09;&#x9996;&#x5148;&#x6765;&#x770B;try_to_free_pages&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for (priority = DEF_PRIORITY; priority &gt;= 0; priority--) {&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;nr_reclaimed += shrink_zones(priority, zones, &amp;sc);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;shrink_slab(sc.nr_scanned, gfp_mask, lru_pages);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }&#xA0; &#xA0; &#xA0;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;priority&#x7684;&#x673A;&#x5236;&#x3002;&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x4F18;&#x5148;&#x7EA7;&#x673A;&#x5236;&#xFF0C;&#x53EA;&#x662F;&#x6BCF;&#x6B21;&#x5C3D;&#x91CF;&#x5C11;&#x7684;&#x626B;&#x63CF;&#x9875;&#x9762;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x901F;&#x7387;&#x3002;&#x5230;shrink_zone&#x91CC;&#x9762;&#x6709;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; zone-&gt;nr_scan_active +=&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;(zone_page_state(zone, NR_ACTIVE) &gt;&gt; priority) + 1;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x4E00;&#x6BB5;&#x6211;&#x4E00;&#x5EA6;&#x770B;&#x4E86;&#x597D;&#x4E45;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x8981;&#x8003;&#x8651;&#x7684;&#x90A3;&#x4E48;&#x6B7B;&#x3002;&#x4ED6;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4E00;&#x6B65;&#x6B65;&#x589E;&#x52A0;&#x626B;&#x63CF;&#x9875;&#x9762;&#x7684;&#x6570;&#x91CF;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5F53;priority&#xA0;= 12~1&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x626B;&#x63CF;&#x6570;&#x91CF;&#x6BCF;&#x6B21;&#x589E;&#x52A0;zone-&gt;nr_active/(2^priority)&#x4E2A;&#x9875;&#x9762;&#x3002;&#x5982;&#x679C;&#x5230;priority&#xA0;=1&#x7684;&#x65F6;&#x5019;&#xFF0C;nr_scan_active&#x4ECD;&#x7136;&#x6CA1;&#x8FBE;&#x5230;sc-&gt;swap_cluster_max&#xFF08;32&#xFF09;&#x7684;&#x8BDD;&#xFF0C;&#x5373;scan&#x7684;&#x603B;&#x6570;&#x7684;&#x7406;&#x8BBA;&#x503C;&#x4E3A;zone-&gt;nr_active*(1-1/(2^12))&#xFF0C;&#x5219;priority=0&#xFF0C;&#x6B64;&#x65F6;scan&#x603B;&#x6570;&#x5C06;&#x8D85;&#x8FC7;zone-&gt;nr_active&#x7684;&#x603B;&#x6570;&#x3002;&#x90A3;&#x662F;&#x4E0D;&#x662F;&#x5C31;&#x6709;&#x95EE;&#x9898;&#x4E86;&#x5462;&#xFF1F;&#x5F53;&#x7136;&#x4E0D;&#x662F;&#xFF0C;&#x56E0;&#x4E3A;&#x540E;&#x9762;&#x518D;&#x505A;&#x9875;&#x9762;&#x8F6C;&#x79FB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x68C0;&#x6D4B;&#x6807;&#x51C6;&#x662F;list_empty&#xFF0C;&#x4E0D;&#x4F1A;&#x64CD;&#x4F5C;&#x8D85;&#x8FC7;&#x5217;&#x8868;&#x8303;&#x56F4;&#x7684;&#x9875;&#x9762;&#x7684;&#x3002;&#xA0; &#xA0; &#xA0;2&#xFF09;shrink_zone&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;/* &#x6839;&#x636E;priority&#x6765;&#x51B3;&#x5B9A;&#x626B;&#x63CF;&#x9875;&#x9762;&#x7684;&#x6570;&#x91CF;&#xFF0C;inactive&#x7684;&#x6570;&#x91CF;&#x91C7;&#x7528;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x83B7;&#x5F97;&#xA0; &#xA0; &#xA0; &#xA0;* &#x81F3;&#x5C11;&#x8981;&#x4FDD;&#x8BC1;sc-&gt;swap_cluster_max&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x5373;32&#x4E2A;&#x9875;&#x9762;&#xA0; &#xA0; &#xA0; &#xA0;*/918&#xA0;&#xA0;&#xA0;&#xA0; zone-&gt;nr_scan_active +=919&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (zone_page_state(zone, NR_ACTIVE) &gt;&gt; priority) + 1;920&#xA0;&#xA0;&#xA0;&#xA0; nr_active = zone-&gt;nr_scan_active;921&#xA0;&#xA0;&#xA0;&#xA0; if (nr_active &gt;= sc-&gt;swap_cluster_max)922&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; zone-&gt;nr_scan_active = 0;923&#xA0;&#xA0;&#xA0;&#xA0; else924&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_active = 0;925&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;933&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;//&#xA0;nr_active: &#x4ECE;active&#x8F6C;&#x5230;inactive&#x5217;&#x8868;&#x4E0A;&#x7684;&#x9875;&#x9762;&#x6570;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;//&#xA0;nr_inactive: &#x4ECE;inactive&#x5217;&#x8868;&#x6362;&#x51FA;&#x5230;&#x78C1;&#x76D8;&#x7684;&#x9875;&#x9762;&#x6570;934&#xA0;&#xA0;&#xA0;&#xA0; while (nr_active || nr_inactive) {935&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (nr_active) {936&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_to_scan = min(nr_active,937&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (unsigned long)sc-&gt;swap_cluster_max);938&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_active -= nr_to_scan;939&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; shrink_active_list(nr_to_scan, zone, sc, priority);940&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }941942&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (nr_inactive) {943&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_to_scan = min(nr_inactive,944&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (unsigned long)sc-&gt;swap_cluster_max);945&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_inactive -= nr_to_scan;946&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_reclaimed += shrink_inactive_list(nr_to_scan, zone,947&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sc);948&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }949&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0;3&#xFF09;shrink_inactive_list&#xA0; &#xA0; &#xA0;&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;shrink_inactive_list&#x8981;&#x505A;&#x7684;&#x5DE5;&#x4F5C;&#x5C31;&#x662F;&#xFF0C;&#x626B;&#x63CF;&#x4F20;&#x5165;&#x7684;nr_to_scan&#x9875;&#x9762;&#xFF0C;&#x518D;&#x5C06;&#x5408;&#x9002;&#x7684;&#x9875;&#x9762;&#x6362;&#x51FA;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x6362;&#x51FA;&#x7684;&#x9875;&#x9762;&#x6570;&#x3002;&#x5176;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x9519;&#xFF0C;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x3002;isolate_lru_pages&#x8D1F;&#x8D23;&#x626B;&#x63CF;&#x9875;&#x9762;&#x7684;struct page&#x7ED3;&#x6784;&#xFF0C;&#x6839;&#x636E;&#x5176;flags&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6362;&#x51FA;&#xFF0C;&#x53EF;&#x4EE5;&#x6362;&#x51FA;&#x7684;&#x653E;&#x5230;&#x8F93;&#x51FA;&#x5217;&#x8868;&#x4E0A;&#xFF0C;&#x4EE5;&#x5907;shrink_page_list&#x6765;&#x505A;&#x771F;&#x6B63;&#x7684;&#x6362;&#x51FA;&#x3002;&#xA0; &#xA0; &#xA0;4&#xFF09;shrink_page_list&#xA0; &#xA0; &#xA0;&#x5176;&#x4E3B;&#x7EBF;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5224;&#x65AD;&#x540E;&#xFF0C;&#x5C06;&#x9875;&#x9762;&#x6362;&#x51FA;&#xFF0C;&#x5E76;&#x4E14;&#x7528;__pagevec_release_nonlru(&amp;freed_pvec)&#x5C06;&#x9875;&#x9762;&#x91CA;&#x653E;&#x56DE;buddy system&#xFF0C;&#x6CE8;&#x610F;&#x5728;&#x521B;&#x5EFA;freed_pvec&#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x4E86;&#x9875;&#x9762;&#x7684;&#x5C5E;&#x6027;&#x4E3A;cold&#x3002;&#x6574;&#x4E2A;&#x7B97;&#x6CD5;&#x7684;&#x7CBE;&#x9AD3;&#xFF0C;&#x5728;&#x4E8E;&#x54EA;&#x4E9B;inactive&#x7684;&#x9875;&#x9762;&#x4E0D;&#x53EF;&#x4EE5;&#x6362;&#x51FA;&#x3002;&#xA0; &#xA0; &#xA0;&#x5148;&#x770B;&#xFF0C;shrink_page_list&#x4E2D;&#x6709;&#x51E0;&#x4E2A;&#x6807;&#x53F7;keep&#xFF1A;&#x76F4;&#x63A5;&#x5C06;&#x9875;&#x9762;add&#x56DE;page_listkeep_locked&#xFF1A;&#x6307;&#x8BE5;&#x9875;&#x9762;&#x5DF2;&#x7ECF;&#x88AB;lock&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x89E3;&#x9501;&#x518D;&#x8FDB;&#x5165;keep&#x6807;&#x53F7;activate_locked&#xFF1A;&#x5C06;&#x9875;&#x9762;&#x6FC0;&#x6D3B;&#xFF0C;&#x518D;&#x653E;&#x56DE;page_list&#xFF0C;&#x8FD9;&#x4E2A;&#x5728;&#x540E;&#x7EED;&#xFF0C;&#x8BE5;&#x9875;&#x9762;&#x4F1A;&#x88AB;&#x653E;&#x5165;active listfree_it&#xFF1A;&#x8FD9;&#x4E2A;&#x662F;&#x6B63;&#x5E38;&#x6D41;&#x7A0B;&#xFF0C;&#x9875;&#x9762;&#x4F1A;&#x88AB;&#x91CA;&#x653E;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x5165;&#x626B;&#x63CF;&#x4E0B;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#xA0; &#xA0; &#xA0;&#x6240;&#x4EE5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x51E1;&#x662F;&#x7ECF;&#x8FC7;&#x5224;&#x65AD;&#x540E;&#xFF0C;&#x8981;&#x8C03;&#x8F6C;&#x5230;&#x4EE5;&#x4E0A;&#x524D;&#x4E09;&#x4E2A;&#x6807;&#x53F7;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x90A3;&#x4E9B;&#x9875;&#x9762;&#x90FD;&#x662F;&#x4E0D;&#x4F1A;&#x88AB;&#x6362;&#x51FA;&#x91CA;&#x653E;&#x7684;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;&#x6709;&#x4EE5;&#x4E0B;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#xFF1A;&#xA0; &#xA0; &#xA0;a.&#xA0;!sc-&gt;may_swap &amp;&amp; page_mapped(page)&#xA0; &#xA0; &#xA0;b.&#xA0;PageWriteback(page)&#xA0; &#xA0; &#xA0;c.&#xA0;PageDirty(page) &amp;&amp;&#xA0;page_referenced(page, 1)&#xA0; &#xA0; &#xA0;d.&#xA0;PageDirty(page) &amp;&amp;&#xA0;!may_enter_fs&#xA0; &#xA0; &#xA0;e.&#xA0;PageDirty(page) &amp;&amp;&#xA0;!sc-&gt;may_writepage&#xA0; &#xA0; &#xA0;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;Linux&#x8FDB;&#x7A0B;&#x8C03;&#x5EA6;&#x5207;&#x6362;&#x548C;&#x865A;&#x62DF;&#x7A7A;&#x95F4;&#x7BA1;&#x7406;&#x6DF1;&#x5165;&#x5206;&#x6790;&#xA0; &#xA0; &#xA0;&#x4EE3;&#x7801;&#x4E2D;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6D89;&#x53CA;&#x5230;page-&gt;mapping&#x6210;&#x5458;&#xFF0C;&#x4F8B;&#x5982;page_mapping, page_mapped&#x3002;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x6210;&#x5458;&#xFF0C;&#x5176;&#x53D6;&#x503C;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;Linux&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x4E2D;address_space&#x7591;&#x60D1;&#x53CA;&#x89E3;&#x7B54;&#xA0;&#xFF08;1&#xFF09;swapper_space&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x5982;&#x679C;page-&gt;mapping&#x7B49;&#x4E8E;0&#xFF0C;&#x8BF4;&#x660E;&#x8BE5;&#x9875;&#x5C5E;&#x4E8E;&#x4EA4;&#x6362;&#x544A;&#x8BC9;&#x7F13;&#x5B58;swap cache&#xFF08;2&#xFF09;anon_vma&#xFF1A;&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x5982;&#x679C;page-&gt;mapping&#x4E0D;&#x7B49;&#x4E8E;0&#xFF0C;&#x4F46;&#x7B2C;0&#x4F4D;&#x4E3A;0&#xFF0C;&#x8BF4;&#x660E;&#x8BE5;&#x9875;&#x4E3A;&#x533F;&#x540D;&#x4E5F;&#xFF0C;&#x6B64;&#x65F6;mapping&#x6307;&#x5411;&#x4E00;&#x4E2A;struct anon_vma&#x7ED3;&#x6784;&#x53D8;&#x91CF;&#xFF1B;&#xFF08;3&#xFF09;address_space&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x5982;&#x679C;page-&gt;mapping&#x4E0D;&#x7B49;&#x4E8E;0&#xFF0C;&#x4F46;&#x7B2C;0&#x4F4D;&#x4E0D;&#x4E3A;0&#xFF0C;&#x5219;mapping&#x6307;&#x5411;&#x4E00;&#x4E2A;struct address_space&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7ED3;&#x6784;&#x53D8;&#x91CF;&#xFF1B;&#xA0; &#xA0; &#xA0;5&#xFF09;swap cache&#xA0; &#xA0; &#xA0;&#x4E0A;&#x9762;&#x7B80;&#x8FF0;&#x4E86;linux&#x9875;&#x7F13;&#x51B2;&#x4EA4;&#x6362;&#x673A;&#x5236;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x6700;&#x540E;&#x56DE;&#x5230;swap cache&#x8FD9;&#x4E00;&#x57FA;&#x672C;&#x7ED3;&#x6784;&#x4E0A;&#x6765;&#x3002;gorman&#x7684;&#x4E66;&#x91CC;&#x9762;&#x8BB2;&#x5F97;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#x505A;&#x4E00;&#x4E9B;&#x7B14;&#x8BB0;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;swap cache&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#xFF1F;&#xA0; &#xA0; &#xA0;&#x56E0;&#x4E3A;A signi&#xFB01;cant number of the&#xA0;pages referenced by a process early in its life may only be used for initialization and&#xA0;then never used again. It is better to swap out those pages and create more diskbu&#xFB00;ers than leave them resident and unused.&#xA0; &#xA0; &#xA0;swap cache vs. page cache&#xA0; &#xA0; &#xA0;The swap cache is purely&#xA0;conceptual because it is simply a specialization of the page cache.&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 1.&#xA0;in the swap cache rather than the page cache is&#xA0;that pages in the swap cache always use swapper space as their address space in&#xA0;page&#x2192;mapping.&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 2.&#xA0;pages are added to the swap cache&#xA0;with add_to_swap_cache(),shown in Figure 11.3, instead of add_to_page_cache().&#xA0; &#xA0; &#xA0;&#x6240;&#x6709;&#x7684;swap file&#x4FE1;&#x606F;&#x90FD;&#x4FDD;&#x5B58;&#x5728;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x4E2D;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;static struct swap_info_struct swap_info[MAX_SWAPFILES];&#xA0; &#xA0; &#xA0;&#x53EF;&#x89C1;swap file&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x6709;MAX_SWAPFILES&#x4E2A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;32&#x4E2A;&#x3002;64 struct swap_info_struct {65 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int flags;66 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;kdev_t swap_device;67 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;spinlock_t sdev_lock;68 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;struct dentry * swap_file;69 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;struct vfsmount *swap_vfsmnt;70 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned short * swap_map;71 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int lowest_bit;72 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int highest_bit;73 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int cluster_next;74 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int cluster_nr;75 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;int prio;76 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;int pages;77 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned long max;78 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;int next;79 };&#xA0; &#xA0; &#xA0;swap_info&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x94FE;&#x8868;&#xFF0C;&#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x7528;next&#x6307;&#x5411;&#x4E86;&#x4E0B;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x6210;&#x5458;&#x7684;&#x7D22;&#x5F15;&#x53F7;&#x3002;&#x8FD9;&#x4E2A;&#x94FE;&#x8868;&#x540C;&#x65F6;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x63CF;&#x8FF0;&#x3002;&#x8FD9;&#x91CC;&#x6307;&#x660E;&#x4E86;&#x8FD9;&#x4E2A;&#x94FE;&#x8868;&#x7684;&#x5934;&#x5728;&#x54EA;&#x91CC;&#xFF0C;&#x5176;&#x8868;&#x5C3E;&#x6210;&#x5458;&#x7684;next = -1&#x3002;153 struct swap_list_t {154 &#xA0; &#xA0;&#xA0;int head; /* head of priority-ordered swapfile list */155 &#xA0; &#xA0; int next; /* swapfile to be used next */156 };&#xA0; &#xA0; &#xA0;swap area&#x7531;swap_info_struct&#x63CF;&#x8FF0;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x52A8;&#x6001;&#x7684;&#x589E;&#x52A0;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;swap area&#x6307;&#x5411;&#x4E00;&#x4E2A;swap file&#xFF0C;&#x8BE5;file&#x88AB;&#x5206;&#x5272;&#x6210;&#x82E5;&#x5E72;&#x4E2A;page size&#x7684;slot&#xFF0C;&#x7B2C;0&#x4E2A;slot&#x88AB;&#x7528;&#x6765;&#x5B58;&#x50A8;swap_header&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;25 union swap_header {26&#xA0;&#xA0; &#xA0; &#xA0;struct27&#xA0;&#xA0; &#xA0; &#xA0;{28&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;char reserved[PAGE_SIZE - 10];29&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;char magic[10];30&#xA0;&#xA0; &#xA0; &#xA0;} magic;31&#xA0;&#xA0; &#xA0; &#xA0;struct32&#xA0;&#xA0; &#xA0; &#xA0;{33&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;char bootbits[1024];34&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int version;35&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int last_page;36&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int nr_badpages;37&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int padding[125];38&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned int badpages[1];39&#xA0;&#xA0; &#xA0; &#xA0;} info;40 };&#xA0; &#xA0; &#xA0;&#x6DFB;&#x52A0;padding&#x662F;&#x4E3A;&#x4E86;&#x80FD;&#x548C;&#x78C1;&#x76D8;&#x7684;cluster&#x5BF9;&#x9F50;&#xFF0C;badpages&#x6570;&#x7EC4;&#x9650;&#x5236;&#x4E86;&#x4E00;&#x4E2A;swap area&#x7684;&#x9875;&#x6570;&#xFF0C;&#x5176;&#x5C3A;&#x5BF8;&#x7531;&#x4E0B;&#x9762;&#x7684;&#x516C;&#x5F0F;&#x5F97;&#x5230;&#x3002;&#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x6307;&#x5411;&#x4E86;&#x4E00;&#x4E2A;page&#x7ED3;&#x6784;&#x4F53;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;swap cache&#x6700;&#x6838;&#x5FC3;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x53EB;&#x505A;swp_entry_t&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x5176;&#x5B9E;&#x4ED6;&#x5C31;&#x662F;&#x4E00;&#x4E2A;unsigned long&#x3002;&#x5F53;&#x9875;&#x9762;&#x88AB;&#x6362;&#x51FA;&#x65F6;&#xFF0C;&#x5176;&#x539F;&#x5148;&#x7684;&#x9875;&#x8868;&#x9879;pte&#x88AB;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x8FD9;&#x4E2A;&#x503C;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;swp_entry_t&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4F4D;&#x5230;&#x8BE5;&#x9875;&#x6570;&#x636E;&#x88AB;&#x5199;&#x5230;&#x54EA;&#x4E2A;swap area&#x7684;&#x54EA;&#x4E2A;&#x4F4D;&#x7F6E;&#x3002;&#x5176;&#x7EC4;&#x6210;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;&#xA0; &#xA0; &#xA0;Type&#x6307;&#x5F15;&#x4E86;&#x54EA;&#x4E2A;swap area&#xFF0C;offset&#x6307;&#x5F15;&#x4E86;&#x8BE5;&#x9875;&#x5728;swap_map&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6539;offset&#x7B97;&#x5F97;swap file&#x4E2D;&#x7684;sector&#x4F4D;&#x7F6E;&#x3002;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E0B;&#x9762;&#x7684;&#x51FD;&#x6570;&#xA0; &#xA0; &#xA0;(swapper_space.a_ops-&gt;swap_writepage) -&gt;&#xA0;get_swap_bio -&gt;&#xA0;map_swap_page938&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for ( ; ; ) {939&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; struct list_head *lh;940&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; /*&#x4E00;&#x76F4;&#x5FAA;&#x73AF;&#x5230;offset&#x843D;&#x5728;&#x8BE5;sector&#x4E2D;*/941&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (se-&gt;start_page &lt;= offset &amp;&amp;942&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; offset &lt; (se-&gt;start_page + se-&gt;nr_pages)) {943&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return se-&gt;start_block + (offset - se-&gt;start_page);944&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }945&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; lh = se-&gt;list.next;946&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (lh == &amp;sis-&gt;extent_list)947&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; lh = lh-&gt;next;948&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; se = list_entry(lh, struct swap_extent, list);949&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sis-&gt;curr_swap_extent = se;951&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;swap_entry_t&#x662F;&#x600E;&#x4E48;&#x6765;&#x7684;&#xFF1F;&#x5176;&#x5B9E;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x5728;swap_map&#x6570;&#x7EC4;&#x4E2D;&#x6328;&#x4E2A;&#x627E;&#xFF0C;first fit&#x6CD5;&#x3002;&#x5F53;&#x7136;&#x5177;&#x4F53;&#x8FD8;&#x6709;&#x4E9B;&#x6280;&#x5DE7;&#xFF0C;&#x5176;&#x5B9E;&#x5728;&#x641C;&#x7D22;&#x65F6;&#xFF0C;&#x662F;&#x6309;&#x7167;cluster&#x7684;&#x8303;&#x56F4;&#x5BFB;&#x627E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5FAA;&#x73AF;&#x76F4;&#x5230;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;cluster&#xFF08;256&#x4E2A;&#x7B49;&#x4E8E;0&#x7684;swap_map&#x6210;&#x5458;&#xFF09;&#x4E3A;&#x6B62;&#xFF0C;&#x76EE;&#x7684;&#x662F;to have pages swapped out at the same time close together on the premise that&#xA0;pages swapped out together are related&#xA0;&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[slab allocator （4）—— kmalloc]]></title>
    <url>%2F2012%2F12%2F25%2Fslab_allocator_%EF%BC%884%EF%BC%89%E2%80%94%E2%80%94_kmalloc%2F</url>
    <content type="text"><![CDATA[]]></content>
  </entry>
  <entry>
    <title><![CDATA[slab allocator （2）—— kmem_cache_create]]></title>
    <url>%2F2012%2F12%2F18%2Fslab_allocator_%EF%BC%882%EF%BC%89-_kmem_cache_create%2F</url>
    <content type="text"><![CDATA[&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F;slab&#x7CFB;&#x7EDF;&#x7684;&#x6838;&#x5FC3;&#x51FD;&#x6570;&#x4E4B;&#x4E00;&#xFF0C;&#x4ED6;&#x662F;kmalloc&#x7684;&#x540E;&#x76FE;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F5C;&#x4E3A;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x4F9B;&#x9A71;&#x52A8;&#x8C03;&#x7528;&#x3002;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x770B;ldd3&#x7684;chp 8&#x7684;&#x540E;&#x5907;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x4E00;&#x8282;&#xFF08;P217&#xFF09;&#x3002;&#x4ED6;&#x5176;&#x5B9E;&#x548C;&#x6211;&#x4EEC;CPU&#x7684;L1&#xFF0C;L2&#x7F13;&#x5B58;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5173;&#x7CFB;&#x3002;&#x4ED6;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E;&#x5185;&#x5B58;&#x6C60;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x4E2D;&#x5206;&#x914D;&#x82E5;&#x5E72;&#x4E2A;size&#x76F8;&#x540C;&#x7684;&#x5185;&#x5B58;&#x5757;&#x4F7F;&#x7528;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5176;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x4E3B;&#x7EBF;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x4E3B;&#x7EBF;&#x8FD8;&#x662F;&#x5F88;&#x6E05;&#x695A;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x901A;&#x8FC7;kmem_cache_zalloc&#x5206;&#x914D;kmem_cache&#xFF0C;&#x7136;&#x540E;&#x5404;&#x79CD;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6700;&#x540E;&#x52A0;&#x5165;cache_chain&#x4E2D;&#x3002;&#x4E4B;&#x524D;&#x4E0D;&#x6E05;&#x695A;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x2014;&#x2014;cache_chain&#x662F;&#x505A;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x770B;&#x8D77;&#x6765;&#x5E94;&#x8BE5;&#x662F;&#x6709;&#x7B54;&#x6848;&#x4E86;&#x3002;&#x4ED6;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x4FDD;&#x5B58;&#x5DF2;&#x5206;&#x914D;&#x7684;kmem_cache&#x8BB0;&#x5F55;&#xFF0C;&#x9632;&#x6B62;&#x91CD;&#x540D;&#x7684;cache&#x4EA7;&#x751F;&#xFF0C;&#x65B9;&#x4FBF;proc&#x7CFB;&#x7EDF;&#x663E;&#x793A;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x4E2D;&#x6709;&#x51E0;&#x4E2A;&#x503C;&#x5F97;&#x5173;&#x6CE8;&#x7684;&#x5730;&#x65B9;1. kmem_cache&#x7684;&#x521D;&#x59CB;&#x5316;&#xA0; &#xA0; &#xA0;1&#xFF09;&#x5F53;size &gt;= (PAGE_SIZE &gt;&gt; 3 = 512KB&#x65F6;&#xFF0C;flags |= CFLGS_OFF_SLAB&#xA0; &#xA0; &#xA0;2&#xFF09;calculate_slab_order(cachep, size, align, flags)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6240;&#x8C13;&#x7684;num&#x4E0E;offslab_limit&#x5C31;&#x662F;&#x4E0B;&#x9762;off-slab&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7531;&#x6574;&#x5757;2^order&#x4E2A;&#x9875;&#x9762;&#x51B3;&#x5B9A;&#x7684;object&#x6570;(num)&#xFF0C;&#x548C;&#x53F3;&#x8FB9;kmem_bufctl_t&#x6570;&#x7EC4;&#x51B3;&#x5B9A;&#x7684;object&#x6570;(offslab_limit)&#x3002;&#x53EF;&#x89C1;&#x6709;&#x4E00;&#x4E2A;&#x7EA6;&#x675F;&#x5C31;&#x662F;&#xFF0C;num&#x8981;&#x5C0F;&#x4E8E;offslab_limit&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5DE6;&#x8FB9;&#x5C0F;&#x4E8E;&#x53F3;&#x8FB9;&#x3002;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x56E0;&#x4E3A;&#x53F3;&#x8FB9;&#x662F;&#x5DE6;&#x8FB9;&#x7684;&#x7BA1;&#x63A7;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 3&#xFF09;&#x5982;&#x679C;left_over&#x592A;&#x591A;&#xFF0C;&#x8DB3;&#x591F;&#x653E;&#x5F97;&#x4E0B;slab_size&#xFF0C;&#x4F1A;&#x5C06;off-slab&#x8F6C;&#x53D8;&#x4E3A;on-slab2. off-slab&#x65F6;&#xFF0C;slab mngmt&#x653E;&#x5728;&#x54EA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x8C03;&#x7528;cachep-&gt;slabp_cache = kmem_find_general_cachep(slab_size, 0u)&#xFF0C;&#x53BB;&#x5BFB;&#x627E;&#x8FD9;&#x4E2A;size cache&#x6765;&#x5B58;&#x653E;slab mngmt&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;kmem_find_general_cachep -&gt;&#xA0;__find_general_cachep -&gt; (return malloc_sizes[n]-&gt;cs_cachep)3. CPU cache&#x7684;&#x521D;&#x59CB;&#x5316;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;setup_cpu_cache(cachep, gfp)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x590D;&#x6742;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5148;&#x770B;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x6839;&#x636E;g_cpucache_up&#x5206;&#x6210;&#x4E09;&#x4E2A;&#x90E8;&#x5206;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 1&#xFF09;FULL&#x72B6;&#x6001;&#xFF0C;&#x6B64;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;cache&#x521D;&#x59CB;&#x5316;&#x90FD;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;setup_cpu_cache&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;enable_cpucache&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x590D;&#x6742;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x518D;&#x53E6;&#x5F00;&#x65B0;&#x7BC7;&#x4ECB;&#x7ECD;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 2&#xFF09;PARTIAL_AC/L3&#x72B6;&#x6001;&#xFF0C;&#x6B64;&#x65F6;&#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#x7684;kmem_cache_create&#x4ECD;&#x5728;kmem_cache_init&#x4E2D;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x624D;&#x521A;&#x5F00;&#x59CB;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x5BF9;struct arracy_cache&#x548C;kmem_list3s&#x7528;&#x5230;&#x7684;&#x5185;&#x5B58;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5426;&#x5219;&#x5176;&#x4ED6;cache&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x65E0;&#x6CD5;&#x52A8;&#x6001;&#x5730;&#x4E3A;&#x8FD9;&#x4E24;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x5206;&#x914D;&#x5185;&#x5B58;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 3&#xFF09;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#xFF0C;AC&#x548C;L3&#x90FD;&#x5206;&#x914D;&#x597D;&#x4E86;&#xFF0C;&#x5176;&#x4ED6;&#x7684;cache&#x518D;create&#x5C31;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x7684;&#x8C03;&#x7528;kmalloc&#x4E86;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; INDEX_AC&#x7684;array_cache&#x521D;&#x59CB;&#x5316;&#x662F;initarray_generic.cache&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; INDEX_AC / L3&#x7684;kmem_list3&#x521D;&#x59CB;&#x5316;&#x662F;initkmem_list3[SIZE_AC / L3]&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; cache_cache&#x7684;array_cache&#x521D;&#x59CB;&#x5316;&#x662F;initarray_cache&#xFF0C;kmem_list3&#x521D;&#x59CB;&#x5316;&#x662F;initkmem_list3[CACHE_CACHE]&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x4E9B;&#x5728;kmem_cache_init&#x7684;step 4,5&#x90FD;&#x4F1A;&#x88AB;&#x91CD;&#x65B0;&#x7528;kmalloc&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x5206;&#x914D;&#xFF0C;&#x5E76;&#x4E14;array_cache&#x4F1A;&#x7528;memcpy&#x5C06;&#x539F;&#x5148;&#x503C;&#x8D4B;&#x5165;&#xFF0C;list&#x4F1A;&#x7528;splice&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[slab allocator （2）—— kmem_cache_create]]></title>
    <url>%2F2012%2F12%2F18%2Fslab_allocator_%EF%BC%882%EF%BC%89%E2%80%94%E2%80%94_kmem_cache_create%2F</url>
    <content type="text"><![CDATA[&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F;slab&#x7CFB;&#x7EDF;&#x7684;&#x6838;&#x5FC3;&#x51FD;&#x6570;&#x4E4B;&#x4E00;&#xFF0C;&#x4ED6;&#x662F;kmalloc&#x7684;&#x540E;&#x76FE;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F5C;&#x4E3A;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x4F9B;&#x9A71;&#x52A8;&#x8C03;&#x7528;&#x3002;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x770B;ldd3&#x7684;chp 8&#x7684;&#x540E;&#x5907;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x4E00;&#x8282;&#xFF08;P217&#xFF09;&#x3002;&#x4ED6;&#x5176;&#x5B9E;&#x548C;&#x6211;&#x4EEC;CPU&#x7684;L1&#xFF0C;L2&#x7F13;&#x5B58;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5173;&#x7CFB;&#x3002;&#x4ED6;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E;&#x5185;&#x5B58;&#x6C60;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x4E2D;&#x5206;&#x914D;&#x82E5;&#x5E72;&#x4E2A;size&#x76F8;&#x540C;&#x7684;&#x5185;&#x5B58;&#x5757;&#x4F7F;&#x7528;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5176;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x4E3B;&#x7EBF;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x4E3B;&#x7EBF;&#x8FD8;&#x662F;&#x5F88;&#x6E05;&#x695A;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x901A;&#x8FC7;kmem_cache_zalloc&#x5206;&#x914D;kmem_cache&#xFF0C;&#x7136;&#x540E;&#x5404;&#x79CD;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6700;&#x540E;&#x52A0;&#x5165;cache_chain&#x4E2D;&#x3002;&#x4E4B;&#x524D;&#x4E0D;&#x6E05;&#x695A;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x2014;&#x2014;cache_chain&#x662F;&#x505A;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x770B;&#x8D77;&#x6765;&#x5E94;&#x8BE5;&#x662F;&#x6709;&#x7B54;&#x6848;&#x4E86;&#x3002;&#x4ED6;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x4FDD;&#x5B58;&#x5DF2;&#x5206;&#x914D;&#x7684;kmem_cache&#x8BB0;&#x5F55;&#xFF0C;&#x9632;&#x6B62;&#x91CD;&#x540D;&#x7684;cache&#x4EA7;&#x751F;&#xFF0C;&#x65B9;&#x4FBF;proc&#x7CFB;&#x7EDF;&#x663E;&#x793A;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x4E2D;&#x6709;&#x51E0;&#x4E2A;&#x503C;&#x5F97;&#x5173;&#x6CE8;&#x7684;&#x5730;&#x65B9;1. kmem_cache&#x7684;&#x521D;&#x59CB;&#x5316;&#xA0; &#xA0; &#xA0;1&#xFF09;&#x5F53;size &gt;= (PAGE_SIZE &gt;&gt; 3 = 512KB&#x65F6;&#xFF0C;flags |= CFLGS_OFF_SLAB&#xA0; &#xA0; &#xA0;2&#xFF09;calculate_slab_order(cachep, size, align, flags)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6240;&#x8C13;&#x7684;num&#x4E0E;offslab_limit&#x5C31;&#x662F;&#x4E0B;&#x9762;off-slab&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7531;&#x6574;&#x5757;2^order&#x4E2A;&#x9875;&#x9762;&#x51B3;&#x5B9A;&#x7684;object&#x6570;(num)&#xFF0C;&#x548C;&#x53F3;&#x8FB9;kmem_bufctl_t&#x6570;&#x7EC4;&#x51B3;&#x5B9A;&#x7684;object&#x6570;(offslab_limit)&#x3002;&#x53EF;&#x89C1;&#x6709;&#x4E00;&#x4E2A;&#x7EA6;&#x675F;&#x5C31;&#x662F;&#xFF0C;num&#x8981;&#x5C0F;&#x4E8E;offslab_limit&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5DE6;&#x8FB9;&#x5C0F;&#x4E8E;&#x53F3;&#x8FB9;&#x3002;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x56E0;&#x4E3A;&#x53F3;&#x8FB9;&#x662F;&#x5DE6;&#x8FB9;&#x7684;&#x7BA1;&#x63A7;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 3&#xFF09;&#x5982;&#x679C;left_over&#x592A;&#x591A;&#xFF0C;&#x8DB3;&#x591F;&#x653E;&#x5F97;&#x4E0B;slab_size&#xFF0C;&#x4F1A;&#x5C06;off-slab&#x8F6C;&#x53D8;&#x4E3A;on-slab2. off-slab&#x65F6;&#xFF0C;slab mngmt&#x653E;&#x5728;&#x54EA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x8C03;&#x7528;cachep-&gt;slabp_cache = kmem_find_general_cachep(slab_size, 0u)&#xFF0C;&#x53BB;&#x5BFB;&#x627E;&#x8FD9;&#x4E2A;size cache&#x6765;&#x5B58;&#x653E;slab mngmt&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;kmem_find_general_cachep -&gt;&#xA0;__find_general_cachep -&gt; (return malloc_sizes[n]-&gt;cs_cachep)3. CPU cache&#x7684;&#x521D;&#x59CB;&#x5316;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;setup_cpu_cache(cachep, gfp)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x590D;&#x6742;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5148;&#x770B;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x6839;&#x636E;g_cpucache_up&#x5206;&#x6210;&#x4E09;&#x4E2A;&#x90E8;&#x5206;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 1&#xFF09;FULL&#x72B6;&#x6001;&#xFF0C;&#x6B64;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;cache&#x521D;&#x59CB;&#x5316;&#x90FD;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;setup_cpu_cache&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;enable_cpucache&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x590D;&#x6742;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x518D;&#x53E6;&#x5F00;&#x65B0;&#x7BC7;&#x4ECB;&#x7ECD;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 2&#xFF09;PARTIAL_AC/L3&#x72B6;&#x6001;&#xFF0C;&#x6B64;&#x65F6;&#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#x7684;kmem_cache_create&#x4ECD;&#x5728;kmem_cache_init&#x4E2D;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x624D;&#x521A;&#x5F00;&#x59CB;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x5BF9;struct arracy_cache&#x548C;kmem_list3s&#x7528;&#x5230;&#x7684;&#x5185;&#x5B58;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5426;&#x5219;&#x5176;&#x4ED6;cache&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x65E0;&#x6CD5;&#x52A8;&#x6001;&#x5730;&#x4E3A;&#x8FD9;&#x4E24;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x5206;&#x914D;&#x5185;&#x5B58;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 3&#xFF09;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#xFF0C;AC&#x548C;L3&#x90FD;&#x5206;&#x914D;&#x597D;&#x4E86;&#xFF0C;&#x5176;&#x4ED6;&#x7684;cache&#x518D;create&#x5C31;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x7684;&#x8C03;&#x7528;kmalloc&#x4E86;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; INDEX_AC&#x7684;array_cache&#x521D;&#x59CB;&#x5316;&#x662F;initarray_generic.cache&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; INDEX_AC / L3&#x7684;kmem_list3&#x521D;&#x59CB;&#x5316;&#x662F;initkmem_list3[SIZE_AC / L3]&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; cache_cache&#x7684;array_cache&#x521D;&#x59CB;&#x5316;&#x662F;initarray_cache&#xFF0C;kmem_list3&#x521D;&#x59CB;&#x5316;&#x662F;initkmem_list3[CACHE_CACHE]&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x4E9B;&#x5728;kmem_cache_init&#x7684;step 4,5&#x90FD;&#x4F1A;&#x88AB;&#x91CD;&#x65B0;&#x7528;kmalloc&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x5206;&#x914D;&#xFF0C;&#x5E76;&#x4E14;array_cache&#x4F1A;&#x7528;memcpy&#x5C06;&#x539F;&#x5148;&#x503C;&#x8D4B;&#x5165;&#xFF0C;list&#x4F1A;&#x7528;splice&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[slab allocator （3）—— array_cache]]></title>
    <url>%2F2012%2F12%2F18%2Fslab_allocator_%EF%BC%883%EF%BC%89-_array_cache%2F</url>
    <content type="text"><![CDATA[array_cache&#x4E5F;&#x5C31;&#x662F;Gorman&#x4E66;&#x4E2D;&#x7684;per-CPU cache&#x3002;&#x4E66;&#x4E2D;&#x63D0;&#x5230;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x6709;&#x4E24;&#x70B9;&#x539F;&#x56E0;&#xFF1A;&#xA0; &#xA0; &#xA0;1&#xFF09;This way the&#xA0;hardware cache will be used for as long as possible on the same CPU.&#xA0; &#xA0; &#xA0;2&#xFF09;The second major bene&#xFB01;t of this method is that spinlocks do not have to be held&#x5148;&#x770B;&#x4E0B;kmem_cache&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1A;struct kmem_cache {/* 1) per-cpu data, touched during every alloc/free */&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache *array[NR_CPUS];/* 2) Cache tunables. Protected by cache_chain_mutex */&#xA0;&#xA0;&#xA0;&#xA0; unsigned int batchcount;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int limit;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int shared;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int buffer_size;&#xA0;&#xA0;&#xA0;&#xA0; u32 reciprocal_buffer_size;&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;}&#xA0; &#xA0; &#xA0;array_cache&#x662F;kmem_cache&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;CPU&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;&#x8FD9;&#x4E5F;&#x5370;&#x8BC1;&#x4E86;&#x4E0A;&#x9762;Gorman&#x63D0;&#x5230;&#x7684;&#x4E24;&#x70B9;&#x539F;&#x56E0;&#x3002;&#x5728;&#x6BCF;&#x4E2A;kmem_cache&#x88AB;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x521D;&#x59CB;&#x5316;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#xFF0C;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#xFF1A;&#xA0; &#xA0; &#xA0;setup_cpu_cache -&gt; enable_cpucache -&gt;&#xA0;do_tune_cpucache&#xA0; &#xA0; &#xA0;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;&#x53EF;&#x89C1;do_tune_cpucache&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5206;&#x914D;&#x8FD9;&#x4E2A;array_cache&#xFF0C;&#x5E76;&#x4ED8;&#x7ED9;&#x5BF9;&#x5E94;&#x7684;CPU&#x7684;&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x91CC;&#x4E0D;&#x6E05;&#x695A;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6240;&#x6709;&#x7684;online CPU&#x90FD;&#x8981;&#x5206;&#x914D;&#x4E00;&#x904D;&#xFF0C;&#x7136;&#x540E;&#x53EA;&#x53D6;&#x7528;&#x4E00;&#x4E2A;&#x5F53;&#x524D;CPU&#x7684;&#x503C;&#x3002;&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;array_cache&#xFF0C;&#x4F1A;&#x5728;&#x8BB2;&#x5206;&#x914D;&#x7684;&#x7B14;&#x8BB0;&#x4E2D;&#x518D;&#x505A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;free_block&#x51FD;&#x6570;&#xFF0C;&#x9605;&#x8BFB;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;array_cache&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x5927;&#x4F53;&#x7684;&#x4E86;&#x89E3;&#x3002;&#xA0; &#xA0; &#xA0;&#x5148;&#x770B;&#x6574;&#x4E2A;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#xFF1A;&#xA0; &#xA0; &#xA0;array_cache&#x6570;&#x636E;&#x7ED3;&#x6784;&#x6B63;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x6240;&#x663E;&#x793A;&#xFF0C;&#x9664;&#x4E86;touched&#x4E0D;&#x77E5;&#x9053;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x4E4B;&#x5916;&#xFF0C;&#x5176;&#x4ED6;&#x51E0;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x4F5C;&#x7528;&#x8FD8;&#x662F;&#x5F88;&#x6E05;&#x6670;&#x7684;&#xFF0C;&#x4ECE;&#x540D;&#x5B57;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5F97;&#x51FA;&#x6765;&#xFF1A;avail&#xFF0C;&#x5F53;&#x524D;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x7A7A;&#x95F2;&#x7684;&#x4F4D;&#x5B50;&#x53EF;&#x4EE5;&#x5206;&#x914D;limit&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x662F;&#x5206;&#x914D;&#x7684;&#x4E0A;&#x9650;&#xFF0C;&#x4E4B;&#x524D;&#x4E5F;&#x8BF4;&#x8FC7;&#xFF0C;&#x5728;enable_cpucache&#x4E2D;&#x4E5F;&#x6709;&#x5B9A;&#x4E49;batchcount&#xFF0C;linux&#x4E2D;&#x4E00;&#x822C;&#xFF0C;&#x4E00;&#x6B21;&#x64CD;&#x4F5C;&#x7684;&#x6570;&#x91CF;&#x90FD;&#x662F;&#x7528;batch&#x6765;&#x8868;&#x793A;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x662F;array_cache&#x5728;&#x589E;&#x957F;&#x6216;&#x91CA;&#x653E;&#x65F6;&#xFF0C;&#x4E00;&#x6B21;&#x64CD;&#x4F5C;&#x7684;object&#x6570;entry&#xFF0C;&#x5C31;&#x662F;array_cache&#x7684;&#x6838;&#x5FC3;&#x6210;&#x5458;&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;object&#x6570;&#x7EC4;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;free_block&#x91CA;&#x653E;&#x7684;&#x662F;ccold-&gt;avail&#x4E2A;object&#xFF0C;avail&#x4E0D;&#x5E94;&#x8BE5;&#x662F;&#x672C;&#x8EAB;&#x5C31;&#x662F;free&#x7684;object&#x5417;&#xFF1F;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x7ECF;&#x8FC7;&#x9605;&#x8BFB;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x56DE;&#x7B54;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x9996;&#x5148;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x90FD;&#x662F;&#x4ECE;array_cache-&gt;entry&#x6570;&#x7EC4;&#x4E2D;&#x53D6;object&#xFF0C;&#x8FD4;&#x56DE;&#x7ED9;&#x8C03;&#x7528;&#x8005;&#xFF0C;&#x6B64;&#x65F6;avail&#x7684;object&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x51FA;&#x53BB;&#xFF0C;avail&#x53D8;&#x5C11;&#x3002;&#x5F53;avail&#x4E3A;0&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4ECE;kmem_cache&#x4E2D;&#x53BB;&#x53D6;object&#xFF0C;&#x8D4B;&#x7ED9;array_cache&#xFF0C;&#x4E00;&#x6B21;&#x53D6;batchcount&#x4E2A;object&#xFF0C;&#x8FD9;&#x65F6;avail&#x5C31;&#x4F1A;&#x589E;&#x52A0;&#xFF0C;&#x800C;kmem_list3-&gt;free_objects&#x5C31;&#x4F1A;&#x51CF;&#x5C11;&#x76F8;&#x5E94;&#x7684;&#x6570;&#x76EE;&#x3002;&#x800C;kmem_list3-&gt;free_objects&#x4F1A;&#x5728;cache_grow&#x65F6;&#x9012;&#x589E;cachep-&gt;num&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[slab allocator （3）—— array_cache]]></title>
    <url>%2F2012%2F12%2F18%2Fslab_allocator_%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94_array_cache%2F</url>
    <content type="text"><![CDATA[array_cache&#x4E5F;&#x5C31;&#x662F;Gorman&#x4E66;&#x4E2D;&#x7684;per-CPU cache&#x3002;&#x4E66;&#x4E2D;&#x63D0;&#x5230;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x6709;&#x4E24;&#x70B9;&#x539F;&#x56E0;&#xFF1A;&#xA0; &#xA0; &#xA0;1&#xFF09;This way the&#xA0;hardware cache will be used for as long as possible on the same CPU.&#xA0; &#xA0; &#xA0;2&#xFF09;The second major bene&#xFB01;t of this method is that spinlocks do not have to be held&#x5148;&#x770B;&#x4E0B;kmem_cache&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1A;struct kmem_cache {/* 1) per-cpu data, touched during every alloc/free */&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache *array[NR_CPUS];/* 2) Cache tunables. Protected by cache_chain_mutex */&#xA0;&#xA0;&#xA0;&#xA0; unsigned int batchcount;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int limit;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int shared;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int buffer_size;&#xA0;&#xA0;&#xA0;&#xA0; u32 reciprocal_buffer_size;&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;}&#xA0; &#xA0; &#xA0;array_cache&#x662F;kmem_cache&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;CPU&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;&#x8FD9;&#x4E5F;&#x5370;&#x8BC1;&#x4E86;&#x4E0A;&#x9762;Gorman&#x63D0;&#x5230;&#x7684;&#x4E24;&#x70B9;&#x539F;&#x56E0;&#x3002;&#x5728;&#x6BCF;&#x4E2A;kmem_cache&#x88AB;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x521D;&#x59CB;&#x5316;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#xFF0C;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#xFF1A;&#xA0; &#xA0; &#xA0;setup_cpu_cache -&gt; enable_cpucache -&gt;&#xA0;do_tune_cpucache&#xA0; &#xA0; &#xA0;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;&#x53EF;&#x89C1;do_tune_cpucache&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5206;&#x914D;&#x8FD9;&#x4E2A;array_cache&#xFF0C;&#x5E76;&#x4ED8;&#x7ED9;&#x5BF9;&#x5E94;&#x7684;CPU&#x7684;&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x91CC;&#x4E0D;&#x6E05;&#x695A;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6240;&#x6709;&#x7684;online CPU&#x90FD;&#x8981;&#x5206;&#x914D;&#x4E00;&#x904D;&#xFF0C;&#x7136;&#x540E;&#x53EA;&#x53D6;&#x7528;&#x4E00;&#x4E2A;&#x5F53;&#x524D;CPU&#x7684;&#x503C;&#x3002;&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;array_cache&#xFF0C;&#x4F1A;&#x5728;&#x8BB2;&#x5206;&#x914D;&#x7684;&#x7B14;&#x8BB0;&#x4E2D;&#x518D;&#x505A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;free_block&#x51FD;&#x6570;&#xFF0C;&#x9605;&#x8BFB;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;array_cache&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x5927;&#x4F53;&#x7684;&#x4E86;&#x89E3;&#x3002;&#xA0; &#xA0; &#xA0;&#x5148;&#x770B;&#x6574;&#x4E2A;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#xFF1A;&#xA0; &#xA0; &#xA0;array_cache&#x6570;&#x636E;&#x7ED3;&#x6784;&#x6B63;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x6240;&#x663E;&#x793A;&#xFF0C;&#x9664;&#x4E86;touched&#x4E0D;&#x77E5;&#x9053;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x4E4B;&#x5916;&#xFF0C;&#x5176;&#x4ED6;&#x51E0;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x4F5C;&#x7528;&#x8FD8;&#x662F;&#x5F88;&#x6E05;&#x6670;&#x7684;&#xFF0C;&#x4ECE;&#x540D;&#x5B57;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5F97;&#x51FA;&#x6765;&#xFF1A;avail&#xFF0C;&#x5F53;&#x524D;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x7A7A;&#x95F2;&#x7684;&#x4F4D;&#x5B50;&#x53EF;&#x4EE5;&#x5206;&#x914D;limit&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x662F;&#x5206;&#x914D;&#x7684;&#x4E0A;&#x9650;&#xFF0C;&#x4E4B;&#x524D;&#x4E5F;&#x8BF4;&#x8FC7;&#xFF0C;&#x5728;enable_cpucache&#x4E2D;&#x4E5F;&#x6709;&#x5B9A;&#x4E49;batchcount&#xFF0C;linux&#x4E2D;&#x4E00;&#x822C;&#xFF0C;&#x4E00;&#x6B21;&#x64CD;&#x4F5C;&#x7684;&#x6570;&#x91CF;&#x90FD;&#x662F;&#x7528;batch&#x6765;&#x8868;&#x793A;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x662F;array_cache&#x5728;&#x589E;&#x957F;&#x6216;&#x91CA;&#x653E;&#x65F6;&#xFF0C;&#x4E00;&#x6B21;&#x64CD;&#x4F5C;&#x7684;object&#x6570;entry&#xFF0C;&#x5C31;&#x662F;array_cache&#x7684;&#x6838;&#x5FC3;&#x6210;&#x5458;&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;object&#x6570;&#x7EC4;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;free_block&#x91CA;&#x653E;&#x7684;&#x662F;ccold-&gt;avail&#x4E2A;object&#xFF0C;avail&#x4E0D;&#x5E94;&#x8BE5;&#x662F;&#x672C;&#x8EAB;&#x5C31;&#x662F;free&#x7684;object&#x5417;&#xFF1F;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x7ECF;&#x8FC7;&#x9605;&#x8BFB;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x56DE;&#x7B54;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x9996;&#x5148;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x90FD;&#x662F;&#x4ECE;array_cache-&gt;entry&#x6570;&#x7EC4;&#x4E2D;&#x53D6;object&#xFF0C;&#x8FD4;&#x56DE;&#x7ED9;&#x8C03;&#x7528;&#x8005;&#xFF0C;&#x6B64;&#x65F6;avail&#x7684;object&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x51FA;&#x53BB;&#xFF0C;avail&#x53D8;&#x5C11;&#x3002;&#x5F53;avail&#x4E3A;0&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4ECE;kmem_cache&#x4E2D;&#x53BB;&#x53D6;object&#xFF0C;&#x8D4B;&#x7ED9;array_cache&#xFF0C;&#x4E00;&#x6B21;&#x53D6;batchcount&#x4E2A;object&#xFF0C;&#x8FD9;&#x65F6;avail&#x5C31;&#x4F1A;&#x589E;&#x52A0;&#xFF0C;&#x800C;kmem_list3-&gt;free_objects&#x5C31;&#x4F1A;&#x51CF;&#x5C11;&#x76F8;&#x5E94;&#x7684;&#x6570;&#x76EE;&#x3002;&#x800C;kmem_list3-&gt;free_objects&#x4F1A;&#x5728;cache_grow&#x65F6;&#x9012;&#x589E;cachep-&gt;num&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[slab allocator （1） —— 初始化]]></title>
    <url>%2F2012%2F12%2F16%2Fslab_allocator_%EF%BC%881%EF%BC%89_-_%E5%88%9D%E5%A7%8B%E5%8C%96%2F</url>
    <content type="text"><![CDATA[&#x524D;&#x9762;&#x63D0;&#x5230;&#x8FC7;&#x7684;buddy allocator&#x901A;&#x8FC7;&#x7528;order&#x5217;&#x8868;&#x6765;&#x7BA1;&#x7406;&#x9875;&#x9762;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x51CF;&#x5C11;&#x5916;&#x90E8;&#x788E;&#x7247;&#x7684;&#x6548;&#x679C;&#x3002;&#x4F46;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x6BCF;&#x6B21;&#x5206;&#x914D;&#x90FD;&#x5206;&#x914D;&#x4E00;&#x9875;&#x6216;&#x8005;&#x51E0;&#x9875;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x90A3;&#x6837;&#x5185;&#x5B58;&#x5229;&#x7528;&#x7387;&#x592A;&#x4F4E;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E2D;&#x5C06;&#x5145;&#x6EE1;&#x4E86;&#x5185;&#x90E8;&#x788E;&#x7247;&#x3002;&#x6240;&#x4EE5;&#xFF0C;slab&#x5206;&#x914D;&#x5668;&#x4E5F;&#x5C31;&#x5E94;&#x8FD0;&#x800C;&#x751F;&#x4E86;&#xFF0C;&#x5176;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5185;&#x90E8;&#x788E;&#x7247;&#x800C;&#x751F;&#x7684;&#x3002;&#x5177;&#x4F53;&#x4E3A;&#x4EC0;&#x4E48;&#x5F15;&#x5165;&#xFF0C;&#x4EE5;&#x53CA;slab&#x7684;&#x4E00;&#x4E9B;&#x7B80;&#x4ECB;&#x53EF;&#x4EE5;&#x53C2;&#x8003; Linux slab &#x5206;&#x914D;&#x5668;&#x5256;&#x6790;&#xFF0C; Fred&apos;s blog: &#x4E09;&#x6708; 2009&#x3002;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#x6240;&#x8C13;&#x7684;slab&#x5C31;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x4E48;&#x4E00;&#x5F20;&#x56FE;&#x7684;&#x7CFB;&#x7EDF;&#x3002;&#x7B80;&#x5316;&#x4E4B;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x57FA;&#x4E8E;&#x540E;&#x5907;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x5185;&#x5B58;&#x5206;&#x914D;&#xFF08;&#x53C2;&#x8003;ldd3&#xFF0C;page247 ch 8&#xFF09;&#x65B9;&#x5F0F;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x4ED6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x7531;&#x4E0B;&#x56FE;&#x4E2D;&#x7684;g_cpucache_up&#x6765;&#x6807;&#x5FD7;&#xFF0C;&#x5171;&#x6709;5&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x6309;&#x987A;&#x5E8F;&#x4F9D;&#x6B21;&#x8FC1;&#x79FB;&#xFF0C;&#x5728;start_kernel -&gt; mm_init -&gt; kmem_cache_init&#x4E2D;&#x5230;&#x8FBE;EARLY&#x72B6;&#x6001;&#x3002;&#x6B64;&#x65F6;slab_is_availabe()&#x51FD;&#x6570;&#x5C31;&#x8FD4;&#x56DE;&#x771F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6B64;&#x65F6;slab&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x5C31;&#x7EEA;&#x4E86;&#x3002;&#x800C;&#x6700;&#x7EC8;&#x7684;FULL&#x72B6;&#x6001;&#x662F;&#x5728;kmem_cache_init_late&#x4E2D;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x4E0A;&#x9762;&#x8FD9;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x6838;&#x5FC3;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#xA0;kmem_cache_init&#x3002;&#x4E0B;&#x9762;&#x5C06;&#x91CD;&#x70B9;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5F88;&#x5927;&#xFF0C;&#x800C;&#x4E14;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x300A;Understanding the Linux&#xAE;&#xA0;Virtual Memory Manager&#x300B;chapter 8&#x3002;&#x5173;&#x4E8E;slab&#x7CFB;&#x7EDF;&#x7684;&#x5185;&#x5BB9;&#x5F88;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x662F;&#x5F88;&#x597D;&#x7406;&#x89E3;&#x3002;&#x5148;&#x5217;&#x4E3E;&#x51E0;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x5F53;&#x7136;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5C31;&#x662F;kmem_cache&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x5DE8;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x5728;&#x6B64;&#x5217;&#x4E3E;&#x4E86;&#x3002;&#xA0; &#xA0; 1.&#xA0;kmem_list3&#xA0; &#xA0; &#xA0;struct kmem_list3 {&#xA0;&#xA0;&#xA0;&#xA0; struct list_head slabs_partial;&#xA0;&#xA0;&#xA0;&#xA0; /* partial list first, better asm code */&#xA0;&#xA0;&#xA0;&#xA0; struct list_head slabs_full;&#xA0;&#xA0;&#xA0;&#xA0; struct list_head slabs_free;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long free_objects;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int free_limit;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int colour_next;&#xA0;&#xA0;&#xA0;&#xA0; /* Per-node cache coloring */&#xA0;&#xA0;&#xA0;&#xA0; spinlock_t list_lock;&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache *shared;&#xA0;&#xA0;&#xA0;&#xA0; /* shared per node */&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache **alien;&#xA0;&#xA0;&#xA0;&#xA0; /* on other nodes */&#xA0;&#xA0;&#xA0;&#xA0; unsigned long next_reap;&#xA0;&#xA0;&#xA0;&#xA0; /* updated without locking */&#xA0;&#xA0;&#xA0;&#xA0; int free_touched;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* updated without locking */};&#x6700;&#x91CD;&#x8981;&#x7684;&#x5C31;&#x662F;&#x524D;3&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x56FE;1&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x4E09;&#x4E2A;list&#xFF1A;slab_full, slab_partial, slab_empty&#x3002;&#xA0; &#xA0; &#xA0;2. array_cachestruct array_cache {&#xA0;&#xA0;&#xA0;&#xA0; unsigned int avail;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int limit;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int batchcount;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int touched;&#xA0;&#xA0;&#xA0;&#xA0; spinlock_t lock;&#xA0;&#xA0;&#xA0;&#xA0; void *entry[];&#xA0;&#xA0;&#xA0;&#xA0; /*&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * Must have this definition in here for the proper&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * alignment of array_cache. Also simplifies accessing&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * the entries.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; */};struct kmem_cache {/* 1) per-cpu data, touched during every alloc/free */&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache *array[NR_CPUS];&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;}&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;array_cache&#x662F;per CPU&#x53D8;&#x91CF;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x53C2;&#x8003;&#x300A;Understanding the Linux&#xAE;&#xA0;Virtual Memory Manager&#x300B;chp 8.5: Per-CPU Object Cache&#x3002;&#x6BCF;&#x4E00;&#x4E2A;cache&#xFF0C;&#x5728;create&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x4E00;&#x4E2A;array_cache&#xFF08;enable_cpucache&#xFF09;&#x6765;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x7684;&#x603B;cache&#x2014;&#x2014;cache_cache&#xFF08;&#x4ECE;&#x540D;&#x5B57;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5B83;&#x662F;cache&#x7684;cache&#xFF09;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x88AB;&#x586B;&#x4E86;&#x4E00;&#x4E2A;__init_data&#xA0;initarray_cache.cache&#x3002;&#x4E4B;&#x540E;&#x5728;kmem_cache_init&#x4E2D;&#x518D;&#x901A;&#x8FC7;kmalloc&#x6765;&#x5206;&#x914D;&#x3002;arraycache&#x4E0E;kmem_cache&#x7684;&#x5173;&#x7CFB;&#x5927;&#x4F53;&#x5982;&#x4E0B;&#x56FE;&#xA0; &#xA0; &#xA0;&#x5173;&#x4E8E;array_cache&#x5177;&#x4F53;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x5728;&#x53E6;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;&#x4E2D;&#x4F5C;&#x4ECB;&#x7ECD;slab allocator &#xFF08;3&#xFF09;&#x2014;&#x2014; arraycache&#x3002;&#xA0; &#xA0; &#xA0;3. cache_sizes&#xA0; &#xA0; &#xA0;Gorman&#x7684;&#x4E66;&#x4E2D;&#x5C06;&#x5176;&#x79F0;&#x4E4B;&#x4E3A;sizes cache&#x3002;&#x5176;&#x5B9E;&#x4ED6;&#x5C31;&#x662F;&#x4E00;&#x7EC4;&#x5B9A;&#x4E49;&#x4E86;size&#x7684;cache&#x3002;&#x5728;slab&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x7ECF;&#x5E38;&#x770B;&#x5230;malloc_sizes&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;struct cache_sizes malloc_sizes[] = {#define CACHE(x) { .cs_size = (x) },#include &lt;linux/kmalloc_sizes.h&gt;&#xA0;&#xA0;&#xA0;&#xA0; CACHE(ULONG_MAX)#undef CACHE};struct cache_sizes {&#xA0;&#xA0;&#xA0;&#xA0; size_t&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0; cs_size;&#xA0;&#xA0;&#xA0;&#xA0; struct kmem_cache&#xA0;&#xA0;&#xA0;&#xA0; *cs_cachep;#ifdef CONFIG_ZONE_DMA&#xA0;&#xA0;&#xA0;&#xA0; struct kmem_cache&#xA0;&#xA0;&#xA0;&#xA0; *cs_dmacachep;#endif};&#x518D;&#x770B;linux/kmalloc_sizes.h#if (PAGE_SIZE == 4096)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(32)#endif&#xA0;&#xA0;&#xA0;&#xA0; CACHE(64)#if L1_CACHE_BYTES &lt; 64&#xA0;&#xA0;&#xA0;&#xA0; CACHE(96)#endif&#xA0;&#xA0;&#xA0;&#xA0; CACHE(128)#if L1_CACHE_BYTES &lt; 128&#xA0;&#xA0;&#xA0;&#xA0; CACHE(192)#endif&#xA0;&#xA0;&#xA0;&#xA0; CACHE(256)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(512)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(1024)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(2048)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(4096)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(8192)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(16384)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(32768)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(65536)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(131072)&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x7A0D;&#x52A0;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x5728;kmalloc_sizes.h&#x4E2D;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x597D;&#x4E86;&#x4E00;&#x7EC4;&#x56FA;&#x5B9A;size&#x7684;cache&#x4E86;&#xFF0C;&#x53EA;&#x662F;&#x4ED6;&#x4EEC;&#x5BF9;&#x5E94;&#x7684;&#x4E24;&#x7EC4;cache&#x5217;&#x8868;&#xFF08;cs_cachep, cs_dmacachep&#xFF09;&#x8FD8;&#x6CA1;&#x5206;&#x914D;&#x3002;&#x4E4B;&#x540E;&#x5728;&#x6211;&#x4EEC;&#x7684;kmem_cache_init&#x4E2D;&#x5BF9;INDEX_AC&#x548C;INDEX_L3&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x90FD;&#x662F;&#x5728;&#x4E3A;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x6210;&#x5458;&#x521D;&#x59CB;&#x5316;&#x3002;INDEX_AC&#xFF1A;sizeof(struct arraycache_init)&#x5BF9;&#x5E94;&#x7684;malloc_sizes&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x3002;INDEX_L3&#xFF1A;sizeof(struct kmem_list3)&#x5BF9;&#x5E94;&#x7684;malloc_sizes&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x628A;&#x8FD9;&#x4E24;&#x4E2A;size&#x5355;&#x72EC;&#x63D0;&#x51FA;&#x6765;&#x505A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6211;&#x63A8;&#x6D4B;&#x662F;&#x56E0;&#x4E3A;&#x5728;kmem_cache_create&#x5230;&#x65F6;&#x5019;&#x9700;&#x8981;&#x9891;&#x7E41;&#x7684;&#x5206;&#x914D;arraycache_init&#x548C;kmem_list3&#xFF0C;&#x800C;&#x4E14;&#x5BF9;&#x4E8E;kmem_cache&#x6765;&#x8BF4;&#x4E5F;&#x5C31;&#x8FD9;&#x4E24;&#x4E2A;struct&#x662F;&#x9700;&#x8981;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5148;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;size&#x7684;cache&#x5148;&#x505A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x521D;&#x59CB;&#x5316;&#x5176;&#x4ED6;malloc_sizes&#x6570;&#x7EC4;&#x6210;&#x5458;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;cache&#x6765;&#x4E3A;&#x4E4B;&#x5206;&#x914D;arraycache_init&#x548C;kmem_list3&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8BF4;&#x5B8C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E86;&#xFF0C;&#x518D;&#x56DE;&#x5934;&#x770B;&#x770B;kmem_cache_init&#x7684;&#x6D41;&#x7A0B;&#x3002;&#x5176;&#x5B9E;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x5BF9;cache_cache&#xFF0C;malloc_sizes&#x505A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4E0B;&#x9762;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x503C;&#x5F97;&#x5173;&#x6CE8;&#x7684;&#x70B9;&#x3002;&#xA0; &#xA0; &#xA0;1. cache_chain&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x5728;kmem_cache_init&#x7684;&#x4E00;&#x5F00;&#x59CB;&#x5904;&#xFF0C;&#x6709;INIT_LIST_HEAD(&amp;cache_chain);list_add(&amp;cache_cache.next, &amp;cache_chain);&#x5C1A;&#x4E0D;&#x77E5;&#x8FD9;&#x4E2A;cache_chain&#x662F;&#x4F5C;&#x4F55;&#x7528;&#x7684;&#xFF0C;&#x5148;&#x6682;&#x4E14;&#x5217;&#x5728;&#x8FD9;&#x91CC;&#xA0; &#xA0; &#xA0;2. cache_estimate&#xA0; &#xA0; &#xA0;1504&#xA0;&#xA0;&#xA0;&#xA0; for (order = 0; order &lt; MAX_ORDER; order++) {1505&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; cache_estimate(order, cache_cache.buffer_size,1506&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; cache_line_size(), 0, &amp;left_over, &amp;cache_cache.num);1507&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (cache_cache.num)1508&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;1509&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F5C;&#x7528;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x51B3;&#x5B9A;&#xFF1A;(1)cache_cache.buffer_size&#xFF0C;&#x4E5F;&#x5C31;&#x662F;cache_cache&#x7684;object size&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x591A;&#x5C11;&#x4E2A;object&#xA0;(2)slab manager&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#xFF08;on-slab/off-slab&#xFF1A;&#x770B;&#x770B;flags&#x662F;&#x5426;&#x5305;&#x542B;CFLGS_OFF_SLAB&#xFF09;(3)&#x5229;&#x7528;slab&#x4E0A;&#x5269;&#x4F59;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x521D;&#x59CB;&#x5316;coloring&#x673A;&#x5236;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x4E00;&#x4E2A;cache_cache&#x7684;slab&#x7A7A;&#x95F4;&#x5206;&#x5272;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5176;&#x4E2D;object&#x7684;size&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;offsetof(struct kmem_cache, nodelists) +&#xA0;nr_node_ids * sizeof(struct kmem_list3 *);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5176;&#x5B9E;&#x5C31;&#x662F;sizeof(kmem_cache)&#x3002;&#x53EF;&#x89C1;cache_cache&#x7684;slab&#x8981;&#x5206;&#x914D;&#x7684;&#x5C31;&#x662F;kmem_cache&#x3002;&#x6700;&#x540E;cache_cache-&gt;slab_size =&#xA0;slab_mgmt_size&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; coloring scheme&#x7684;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;cache_cache.colour_off = cache_line_size();&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;cache_cache.colour = left_over / cache_cache.colour_off;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;3. init_list&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5728;kmem_cache_init&#x7684;&#x6700;&#x540E;&#xFF0C;&#x6709;1604&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for_each_online_node(nid) {1605&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; init_list(&amp;cache_cache, &amp;initkmem_list3[CACHE_CACHE + nid], nid);16061607&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; init_list(malloc_sizes[INDEX_AC].cs_cachep,1608&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &amp;initkmem_list3[SIZE_AC + nid], nid);16091610&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (INDEX_AC != INDEX_L3) {1611&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; init_list(malloc_sizes[INDEX_L3].cs_cachep,1612&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &amp;initkmem_list3[SIZE_L3 + nid], nid);1613&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }1614&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;init_list&#x5199;&#x7684;&#x5F88;&#x590D;&#x6742;&#xFF0C;&#x5176;&#x5B9E;&#x4ED4;&#x7EC6;&#x7406;&#x89E3;&#x4E4B;&#x540E;&#xFF0C;&#x5B9E;&#x73B0;&#x7684;&#x5185;&#x5BB9;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4E3A;cache_cache&#x4EE5;&#x53CA;&#x4E24;&#x4E2A;size cache &#xFF08;INDEX_AC, INDEX_L3&#xFF09;&#x5206;&#x914D;kmem_list3&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x5E76;&#x7528;memcpy&#x5C06;initkmem_list3&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x62F7;&#x8D1D;&#x8FC7;&#x6765;&#xFF0C;&#x53E6;&#x5916;&#x518D;&#x7528;MAKE_ALL_LISTS -&gt;&#xA0;MAKE_LIST -&gt;&#xA0;list_splice &#x6765;&#x5408;&#x5E76;initkmem_list3&#x5217;&#x8868;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x53EF;&#x89C1;&#x6709;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x8981;&#x628A;&#x590D;&#x6742;&#x7684;&#x95EE;&#x9898;&#x60F3;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x8BE5;&#x4ED4;&#x7EC6;&#x5904;&#x7406;&#x7684;&#x8FD8;&#x662F;&#x8981;&#x4ED4;&#x7EC6;&#x5904;&#x7406;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x5217;&#x8868;&#x7ED3;&#x6784;&#x4F53;&#x3002;kmem_cache_init&#x4E2D;&#x4E5F;&#x8FD0;&#x7528;kmem_cache_create&#x6765;&#x5206;&#x914D;cache&#x4E86;&#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#xFF0C;&#x5C06;&#x5728;&#x53E6;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;&#x4E2D;&#x52A0;&#x4EE5;&#x9610;&#x8FF0;slab allocator &#xFF08;2&#xFF09;&#x2014;&#x2014; kmem_cache_create&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[slab allocator （1） —— 初始化]]></title>
    <url>%2F2012%2F12%2F16%2Fslab_allocator_%EF%BC%881%EF%BC%89_%E2%80%94%E2%80%94_%E5%88%9D%E5%A7%8B%E5%8C%96%2F</url>
    <content type="text"><![CDATA[&#x524D;&#x9762;&#x63D0;&#x5230;&#x8FC7;&#x7684;buddy allocator&#x901A;&#x8FC7;&#x7528;order&#x5217;&#x8868;&#x6765;&#x7BA1;&#x7406;&#x9875;&#x9762;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x51CF;&#x5C11;&#x5916;&#x90E8;&#x788E;&#x7247;&#x7684;&#x6548;&#x679C;&#x3002;&#x4F46;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x6BCF;&#x6B21;&#x5206;&#x914D;&#x90FD;&#x5206;&#x914D;&#x4E00;&#x9875;&#x6216;&#x8005;&#x51E0;&#x9875;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x90A3;&#x6837;&#x5185;&#x5B58;&#x5229;&#x7528;&#x7387;&#x592A;&#x4F4E;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E2D;&#x5C06;&#x5145;&#x6EE1;&#x4E86;&#x5185;&#x90E8;&#x788E;&#x7247;&#x3002;&#x6240;&#x4EE5;&#xFF0C;slab&#x5206;&#x914D;&#x5668;&#x4E5F;&#x5C31;&#x5E94;&#x8FD0;&#x800C;&#x751F;&#x4E86;&#xFF0C;&#x5176;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5185;&#x90E8;&#x788E;&#x7247;&#x800C;&#x751F;&#x7684;&#x3002;&#x5177;&#x4F53;&#x4E3A;&#x4EC0;&#x4E48;&#x5F15;&#x5165;&#xFF0C;&#x4EE5;&#x53CA;slab&#x7684;&#x4E00;&#x4E9B;&#x7B80;&#x4ECB;&#x53EF;&#x4EE5;&#x53C2;&#x8003; Linux slab &#x5206;&#x914D;&#x5668;&#x5256;&#x6790;&#xFF0C; Fred&apos;s blog: &#x4E09;&#x6708; 2009&#x3002;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#x6240;&#x8C13;&#x7684;slab&#x5C31;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x4E48;&#x4E00;&#x5F20;&#x56FE;&#x7684;&#x7CFB;&#x7EDF;&#x3002;&#x7B80;&#x5316;&#x4E4B;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x57FA;&#x4E8E;&#x540E;&#x5907;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x5185;&#x5B58;&#x5206;&#x914D;&#xFF08;&#x53C2;&#x8003;ldd3&#xFF0C;page247 ch 8&#xFF09;&#x65B9;&#x5F0F;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x4ED6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x7531;&#x4E0B;&#x56FE;&#x4E2D;&#x7684;g_cpucache_up&#x6765;&#x6807;&#x5FD7;&#xFF0C;&#x5171;&#x6709;5&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x6309;&#x987A;&#x5E8F;&#x4F9D;&#x6B21;&#x8FC1;&#x79FB;&#xFF0C;&#x5728;start_kernel -&gt; mm_init -&gt; kmem_cache_init&#x4E2D;&#x5230;&#x8FBE;EARLY&#x72B6;&#x6001;&#x3002;&#x6B64;&#x65F6;slab_is_availabe()&#x51FD;&#x6570;&#x5C31;&#x8FD4;&#x56DE;&#x771F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6B64;&#x65F6;slab&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x5C31;&#x7EEA;&#x4E86;&#x3002;&#x800C;&#x6700;&#x7EC8;&#x7684;FULL&#x72B6;&#x6001;&#x662F;&#x5728;kmem_cache_init_late&#x4E2D;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x4E0A;&#x9762;&#x8FD9;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x6838;&#x5FC3;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#xA0;kmem_cache_init&#x3002;&#x4E0B;&#x9762;&#x5C06;&#x91CD;&#x70B9;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5F88;&#x5927;&#xFF0C;&#x800C;&#x4E14;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x300A;Understanding the Linux&#xAE;&#xA0;Virtual Memory Manager&#x300B;chapter 8&#x3002;&#x5173;&#x4E8E;slab&#x7CFB;&#x7EDF;&#x7684;&#x5185;&#x5BB9;&#x5F88;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x662F;&#x5F88;&#x597D;&#x7406;&#x89E3;&#x3002;&#x5148;&#x5217;&#x4E3E;&#x51E0;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x5F53;&#x7136;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5C31;&#x662F;kmem_cache&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x5DE8;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x5728;&#x6B64;&#x5217;&#x4E3E;&#x4E86;&#x3002;&#xA0; &#xA0; 1.&#xA0;kmem_list3&#xA0; &#xA0; &#xA0;struct kmem_list3 {&#xA0;&#xA0;&#xA0;&#xA0; struct list_head slabs_partial;&#xA0;&#xA0;&#xA0;&#xA0; /* partial list first, better asm code */&#xA0;&#xA0;&#xA0;&#xA0; struct list_head slabs_full;&#xA0;&#xA0;&#xA0;&#xA0; struct list_head slabs_free;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long free_objects;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int free_limit;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int colour_next;&#xA0;&#xA0;&#xA0;&#xA0; /* Per-node cache coloring */&#xA0;&#xA0;&#xA0;&#xA0; spinlock_t list_lock;&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache *shared;&#xA0;&#xA0;&#xA0;&#xA0; /* shared per node */&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache **alien;&#xA0;&#xA0;&#xA0;&#xA0; /* on other nodes */&#xA0;&#xA0;&#xA0;&#xA0; unsigned long next_reap;&#xA0;&#xA0;&#xA0;&#xA0; /* updated without locking */&#xA0;&#xA0;&#xA0;&#xA0; int free_touched;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* updated without locking */};&#x6700;&#x91CD;&#x8981;&#x7684;&#x5C31;&#x662F;&#x524D;3&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x56FE;1&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x4E09;&#x4E2A;list&#xFF1A;slab_full, slab_partial, slab_empty&#x3002;&#xA0; &#xA0; &#xA0;2. array_cachestruct array_cache {&#xA0;&#xA0;&#xA0;&#xA0; unsigned int avail;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int limit;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int batchcount;&#xA0;&#xA0;&#xA0;&#xA0; unsigned int touched;&#xA0;&#xA0;&#xA0;&#xA0; spinlock_t lock;&#xA0;&#xA0;&#xA0;&#xA0; void *entry[];&#xA0;&#xA0;&#xA0;&#xA0; /*&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * Must have this definition in here for the proper&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * alignment of array_cache. Also simplifies accessing&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * the entries.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; */};struct kmem_cache {/* 1) per-cpu data, touched during every alloc/free */&#xA0;&#xA0;&#xA0;&#xA0; struct array_cache *array[NR_CPUS];&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;}&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;array_cache&#x662F;per CPU&#x53D8;&#x91CF;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x53C2;&#x8003;&#x300A;Understanding the Linux&#xAE;&#xA0;Virtual Memory Manager&#x300B;chp 8.5: Per-CPU Object Cache&#x3002;&#x6BCF;&#x4E00;&#x4E2A;cache&#xFF0C;&#x5728;create&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x4E00;&#x4E2A;array_cache&#xFF08;enable_cpucache&#xFF09;&#x6765;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x7684;&#x603B;cache&#x2014;&#x2014;cache_cache&#xFF08;&#x4ECE;&#x540D;&#x5B57;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5B83;&#x662F;cache&#x7684;cache&#xFF09;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x88AB;&#x586B;&#x4E86;&#x4E00;&#x4E2A;__init_data&#xA0;initarray_cache.cache&#x3002;&#x4E4B;&#x540E;&#x5728;kmem_cache_init&#x4E2D;&#x518D;&#x901A;&#x8FC7;kmalloc&#x6765;&#x5206;&#x914D;&#x3002;arraycache&#x4E0E;kmem_cache&#x7684;&#x5173;&#x7CFB;&#x5927;&#x4F53;&#x5982;&#x4E0B;&#x56FE;&#xA0; &#xA0; &#xA0;&#x5173;&#x4E8E;array_cache&#x5177;&#x4F53;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x5728;&#x53E6;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;&#x4E2D;&#x4F5C;&#x4ECB;&#x7ECD;slab allocator &#xFF08;3&#xFF09;&#x2014;&#x2014; arraycache&#x3002;&#xA0; &#xA0; &#xA0;3. cache_sizes&#xA0; &#xA0; &#xA0;Gorman&#x7684;&#x4E66;&#x4E2D;&#x5C06;&#x5176;&#x79F0;&#x4E4B;&#x4E3A;sizes cache&#x3002;&#x5176;&#x5B9E;&#x4ED6;&#x5C31;&#x662F;&#x4E00;&#x7EC4;&#x5B9A;&#x4E49;&#x4E86;size&#x7684;cache&#x3002;&#x5728;slab&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x7ECF;&#x5E38;&#x770B;&#x5230;malloc_sizes&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;struct cache_sizes malloc_sizes[] = {#define CACHE(x) { .cs_size = (x) },#include &lt;linux/kmalloc_sizes.h&gt;&#xA0;&#xA0;&#xA0;&#xA0; CACHE(ULONG_MAX)#undef CACHE};struct cache_sizes {&#xA0;&#xA0;&#xA0;&#xA0; size_t&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0; cs_size;&#xA0;&#xA0;&#xA0;&#xA0; struct kmem_cache&#xA0;&#xA0;&#xA0;&#xA0; *cs_cachep;#ifdef CONFIG_ZONE_DMA&#xA0;&#xA0;&#xA0;&#xA0; struct kmem_cache&#xA0;&#xA0;&#xA0;&#xA0; *cs_dmacachep;#endif};&#x518D;&#x770B;linux/kmalloc_sizes.h#if (PAGE_SIZE == 4096)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(32)#endif&#xA0;&#xA0;&#xA0;&#xA0; CACHE(64)#if L1_CACHE_BYTES &lt; 64&#xA0;&#xA0;&#xA0;&#xA0; CACHE(96)#endif&#xA0;&#xA0;&#xA0;&#xA0; CACHE(128)#if L1_CACHE_BYTES &lt; 128&#xA0;&#xA0;&#xA0;&#xA0; CACHE(192)#endif&#xA0;&#xA0;&#xA0;&#xA0; CACHE(256)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(512)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(1024)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(2048)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(4096)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(8192)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(16384)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(32768)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(65536)&#xA0;&#xA0;&#xA0;&#xA0; CACHE(131072)&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x7A0D;&#x52A0;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x5728;kmalloc_sizes.h&#x4E2D;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x597D;&#x4E86;&#x4E00;&#x7EC4;&#x56FA;&#x5B9A;size&#x7684;cache&#x4E86;&#xFF0C;&#x53EA;&#x662F;&#x4ED6;&#x4EEC;&#x5BF9;&#x5E94;&#x7684;&#x4E24;&#x7EC4;cache&#x5217;&#x8868;&#xFF08;cs_cachep, cs_dmacachep&#xFF09;&#x8FD8;&#x6CA1;&#x5206;&#x914D;&#x3002;&#x4E4B;&#x540E;&#x5728;&#x6211;&#x4EEC;&#x7684;kmem_cache_init&#x4E2D;&#x5BF9;INDEX_AC&#x548C;INDEX_L3&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x90FD;&#x662F;&#x5728;&#x4E3A;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x6210;&#x5458;&#x521D;&#x59CB;&#x5316;&#x3002;INDEX_AC&#xFF1A;sizeof(struct arraycache_init)&#x5BF9;&#x5E94;&#x7684;malloc_sizes&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x3002;INDEX_L3&#xFF1A;sizeof(struct kmem_list3)&#x5BF9;&#x5E94;&#x7684;malloc_sizes&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x628A;&#x8FD9;&#x4E24;&#x4E2A;size&#x5355;&#x72EC;&#x63D0;&#x51FA;&#x6765;&#x505A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6211;&#x63A8;&#x6D4B;&#x662F;&#x56E0;&#x4E3A;&#x5728;kmem_cache_create&#x5230;&#x65F6;&#x5019;&#x9700;&#x8981;&#x9891;&#x7E41;&#x7684;&#x5206;&#x914D;arraycache_init&#x548C;kmem_list3&#xFF0C;&#x800C;&#x4E14;&#x5BF9;&#x4E8E;kmem_cache&#x6765;&#x8BF4;&#x4E5F;&#x5C31;&#x8FD9;&#x4E24;&#x4E2A;struct&#x662F;&#x9700;&#x8981;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5148;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;size&#x7684;cache&#x5148;&#x505A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x521D;&#x59CB;&#x5316;&#x5176;&#x4ED6;malloc_sizes&#x6570;&#x7EC4;&#x6210;&#x5458;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;cache&#x6765;&#x4E3A;&#x4E4B;&#x5206;&#x914D;arraycache_init&#x548C;kmem_list3&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8BF4;&#x5B8C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E86;&#xFF0C;&#x518D;&#x56DE;&#x5934;&#x770B;&#x770B;kmem_cache_init&#x7684;&#x6D41;&#x7A0B;&#x3002;&#x5176;&#x5B9E;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x5BF9;cache_cache&#xFF0C;malloc_sizes&#x505A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4E0B;&#x9762;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x503C;&#x5F97;&#x5173;&#x6CE8;&#x7684;&#x70B9;&#x3002;&#xA0; &#xA0; &#xA0;1. cache_chain&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x5728;kmem_cache_init&#x7684;&#x4E00;&#x5F00;&#x59CB;&#x5904;&#xFF0C;&#x6709;INIT_LIST_HEAD(&amp;cache_chain);list_add(&amp;cache_cache.next, &amp;cache_chain);&#x5C1A;&#x4E0D;&#x77E5;&#x8FD9;&#x4E2A;cache_chain&#x662F;&#x4F5C;&#x4F55;&#x7528;&#x7684;&#xFF0C;&#x5148;&#x6682;&#x4E14;&#x5217;&#x5728;&#x8FD9;&#x91CC;&#xA0; &#xA0; &#xA0;2. cache_estimate&#xA0; &#xA0; &#xA0;1504&#xA0;&#xA0;&#xA0;&#xA0; for (order = 0; order &lt; MAX_ORDER; order++) {1505&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; cache_estimate(order, cache_cache.buffer_size,1506&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; cache_line_size(), 0, &amp;left_over, &amp;cache_cache.num);1507&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (cache_cache.num)1508&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;1509&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F5C;&#x7528;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x51B3;&#x5B9A;&#xFF1A;(1)cache_cache.buffer_size&#xFF0C;&#x4E5F;&#x5C31;&#x662F;cache_cache&#x7684;object size&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x591A;&#x5C11;&#x4E2A;object&#xA0;(2)slab manager&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#xFF08;on-slab/off-slab&#xFF1A;&#x770B;&#x770B;flags&#x662F;&#x5426;&#x5305;&#x542B;CFLGS_OFF_SLAB&#xFF09;(3)&#x5229;&#x7528;slab&#x4E0A;&#x5269;&#x4F59;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x521D;&#x59CB;&#x5316;coloring&#x673A;&#x5236;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x4E00;&#x4E2A;cache_cache&#x7684;slab&#x7A7A;&#x95F4;&#x5206;&#x5272;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5176;&#x4E2D;object&#x7684;size&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;offsetof(struct kmem_cache, nodelists) +&#xA0;nr_node_ids * sizeof(struct kmem_list3 *);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5176;&#x5B9E;&#x5C31;&#x662F;sizeof(kmem_cache)&#x3002;&#x53EF;&#x89C1;cache_cache&#x7684;slab&#x8981;&#x5206;&#x914D;&#x7684;&#x5C31;&#x662F;kmem_cache&#x3002;&#x6700;&#x540E;cache_cache-&gt;slab_size =&#xA0;slab_mgmt_size&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; coloring scheme&#x7684;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;cache_cache.colour_off = cache_line_size();&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;cache_cache.colour = left_over / cache_cache.colour_off;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;3. init_list&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5728;kmem_cache_init&#x7684;&#x6700;&#x540E;&#xFF0C;&#x6709;1604&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for_each_online_node(nid) {1605&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; init_list(&amp;cache_cache, &amp;initkmem_list3[CACHE_CACHE + nid], nid);16061607&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; init_list(malloc_sizes[INDEX_AC].cs_cachep,1608&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &amp;initkmem_list3[SIZE_AC + nid], nid);16091610&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (INDEX_AC != INDEX_L3) {1611&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; init_list(malloc_sizes[INDEX_L3].cs_cachep,1612&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &amp;initkmem_list3[SIZE_L3 + nid], nid);1613&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }1614&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;init_list&#x5199;&#x7684;&#x5F88;&#x590D;&#x6742;&#xFF0C;&#x5176;&#x5B9E;&#x4ED4;&#x7EC6;&#x7406;&#x89E3;&#x4E4B;&#x540E;&#xFF0C;&#x5B9E;&#x73B0;&#x7684;&#x5185;&#x5BB9;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4E3A;cache_cache&#x4EE5;&#x53CA;&#x4E24;&#x4E2A;size cache &#xFF08;INDEX_AC, INDEX_L3&#xFF09;&#x5206;&#x914D;kmem_list3&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x5E76;&#x7528;memcpy&#x5C06;initkmem_list3&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x62F7;&#x8D1D;&#x8FC7;&#x6765;&#xFF0C;&#x53E6;&#x5916;&#x518D;&#x7528;MAKE_ALL_LISTS -&gt;&#xA0;MAKE_LIST -&gt;&#xA0;list_splice &#x6765;&#x5408;&#x5E76;initkmem_list3&#x5217;&#x8868;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x53EF;&#x89C1;&#x6709;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x8981;&#x628A;&#x590D;&#x6742;&#x7684;&#x95EE;&#x9898;&#x60F3;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x8BE5;&#x4ED4;&#x7EC6;&#x5904;&#x7406;&#x7684;&#x8FD8;&#x662F;&#x8981;&#x4ED4;&#x7EC6;&#x5904;&#x7406;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x5217;&#x8868;&#x7ED3;&#x6784;&#x4F53;&#x3002;kmem_cache_init&#x4E2D;&#x4E5F;&#x8FD0;&#x7528;kmem_cache_create&#x6765;&#x5206;&#x914D;cache&#x4E86;&#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#xFF0C;&#x5C06;&#x5728;&#x53E6;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;&#x4E2D;&#x52A0;&#x4EE5;&#x9610;&#x8FF0;slab allocator &#xFF08;2&#xFF09;&#x2014;&#x2014; kmem_cache_create&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[migrate type——buddy system的好搭档]]></title>
    <url>%2F2012%2F12%2F12%2Fmigrate_type%E2%80%94%E2%80%94buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Linux&#x4E00;&#x5171;&#x5B9A;&#x4E49;5&#x4E2D;migrate type&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;#define MIGRATE_UNMOVABLE&#xA0;&#xA0;&#xA0;&#xA0; 0#define MIGRATE_RECLAIMABLE&#xA0;&#xA0; 1#define MIGRATE_MOVABLE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 2&#xA0;&#xA0;/* &#x672A;&#x89C1;&#x6709;&#x4F7F;&#x7528;&#x8BE5;&#x6807;&#x5FD7;&#x4F4D;&#x7684;&#x4EE3;&#x7801;*/#define MIGRATE_PCPTYPES&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 3 /* the number of types on the pcp lists */#define MIGRATE_RESERVE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 3#define MIGRATE_ISOLATE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 4 /* can&apos;t allocate from here */#define MIGRATE_TYPES&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 5&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5B9A;&#x4E49;migrate type&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;linux&#x5185;&#x6838;&#x5BF9;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x6539;&#x8FDB;--migrate_type&#x3002;&#x7B80;&#x8981;&#x6765;&#x8BF4;&#x5C31;&#x662F;Linux&#x5C06;&#x53EF;&#x79FB;&#x52A8;&#x6216;&#x4E0D;&#x53EF;&#x79FB;&#x52A8;&#x7684;&#x5185;&#x5B58;&#x5206;&#x5F00;&#x5206;&#x914D;&#xFF0C;&#x4EE5;&#x4FBF;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x51CF;&#x5C11;&#x788E;&#x7247;&#xFF0C;&#x63D0;&#x5347;&#x5206;&#x914D;&#x5927;&#x5757;&#x5185;&#x5B58;&#x7684;&#x80FD;&#x529B;&#x3002;&#x57FA;&#x4E8E;&#x8FD9;&#x79CD;&#x601D;&#x8DEF;&#xFF0C;&#x53EF;&#x89C1;&#x4E0A;&#x8FF0;5&#x79CD;migrate type&#x6700;&#x91CD;&#x8981;&#x7684;&#x5C31;&#x662F;MIGRATE_UNMOVABLE&#xFF0C;MIGRATE_MOVABLE&#x3002;&#x53E6;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;type&#x5C31;&#x662F;MIGRATE_RESERVE&#xFF0C;&#x8FD9;&#x8868;&#x793A;page&#x88AB;reserve&#xFF0C;&#x4E0D;&#x63A5;&#x53D7;buddy system&#x7BA1;&#x7406;&#xFF0C;&#x53EF;&#x53C2;&#x89C1;&#x51FD;&#x6570;setup_zone_migrate_reserve&#x3002;&#x5728;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x4F1A;&#x4F9D;&#x636E;water mark min&#x6765;reserve&#x4E00;&#x4E9B;page&#x505A;&#x5907;&#x7528;&#x3002;&#x8FD9;&#x4E09;&#x4E2A;type&#x662F;&#x7528;&#x5230;&#x6700;&#x591A;&#x7684;&#x4E09;&#x79CD;&#xFF0C;&#x4E0B;&#x9762;&#x7684;fallback&#x673A;&#x5236;&#x4E5F;&#x7528;&#x5230;&#x4E86;static int fallbacks[MIGRATE_TYPES][MIGRATE_TYPES-1] = {&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_UNMOVABLE]&#xA0;&#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_MOVABLE,&#xA0;&#xA0; MIGRATE_RESERVE },&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_RECLAIMABLE] = { MIGRATE_UNMOVABLE,&#xA0;&#xA0; MIGRATE_MOVABLE,&#xA0;&#xA0; MIGRATE_RESERVE },&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_MOVABLE]&#xA0;&#xA0;&#xA0;&#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_UNMOVABLE, MIGRATE_RESERVE },&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_RESERVE]&#xA0;&#xA0;&#xA0;&#xA0; = { MIGRATE_RESERVE,&#xA0;&#xA0;&#xA0;&#xA0; MIGRATE_RESERVE,&#xA0;&#xA0; MIGRATE_RESERVE }, /* Never used */};migrate type&#x5728;memmap_init&#x4E2D;&#x521D;&#x59CB;&#x5316;&#x4E3A;MIGRATE_MOVABLE&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;void __meminit memmap_init_zone(unsigned long size, int nid, unsigned long zone,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long start_pfn, enum memmap_context context){&#xA0;&#xA0;&#xA0;&#xA0; struct page *page;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long end_pfn = start_pfn + size;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long pfn;&#xA0;&#xA0;&#xA0;&#xA0; struct zone *z;&#xA0;&#xA0;&#xA0;&#xA0; if (highest_memmap_pfn &lt; end_pfn - 1)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; highest_memmap_pfn = end_pfn - 1;&#xA0;&#xA0;&#xA0;&#xA0; z = &amp;NODE_DATA(nid)-&gt;node_zones[zone];&#xA0;&#xA0;&#xA0;&#xA0; for (pfn = start_pfn; pfn &lt; end_pfn; pfn++) {&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; page = pfn_to_page(pfn);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SetPageReserved(page);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /*&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * Mark the block movable so that blocks are reserved for&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * movable at startup. This will force kernel allocations&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * to reserve their blocks rather than leaking throughout&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * the address space during boot when many long-lived&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * kernel allocations are made. Later some blocks near&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * the start are marked MIGRATE_RESERVE by&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * setup_zone_migrate_reserve()&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; *&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * bitmap is created for zone&apos;s valid pfn range. but memmap&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * can be created for invalid pages (for alignment)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * check here not to call set_pageblock_migratetype() against&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * pfn out of zone.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; */&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if ((z-&gt;zone_start_pfn &lt;= pfn)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &amp;&amp; (pfn &lt; z-&gt;zone_start_pfn + z-&gt;spanned_pages)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &amp;&amp; !(pfn &amp; (pageblock_nr_pages - 1)))&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set_pageblock_migratetype(page, MIGRATE_MOVABLE);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INIT_LIST_HEAD(&amp;page-&gt;lru);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0; }}&#x4E0A;&#x9762;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x904D;&#x5386;memmap&#x6570;&#x7EC4;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BE5;zone&#x6240;&#x6709;&#x9875;&#x9762;&#x7684;page&#x7ED3;&#x6784;&#x4F53;&#xFF0C;1&#xFF09;&#x9996;&#x5148;&#x8BBE;&#x7F6E;page-&gt;flags&#x7684;PG_reserved&#x4F4D;&#xFF0C;&#x610F;&#x601D;&#x662F;&#x4E0D;&#x53D7;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x63A7;&#x5236;&#x3002;&#x6CA1;&#x9519;&#xFF0C;&#x6B64;&#x65F6;&#x4ECD;&#x5728;bootmem&#x63A7;&#x5236;&#x4E0B;&#xFF0C;&#x4E4B;&#x540E;&#x518D;__free_pages_bootmem&#x65F6;&#xFF0C;&#x4F1A;&#x6E05;&#x9664;&#x8BE5;&#x4F4D;&#xFF0C;&#x5C06;&#x5176;&#x7EB3;&#x5165;buddy&#x7CFB;&#x7EDF;&#x3002;2&#xFF09;&#x4E4B;&#x540E;set_pageblock_migratetype&#x5C06;&#x6240;&#x6709;page&#x7684;migrate type&#x8BBE;&#x4E3A;MIGRATE_MOVABLE&#x3002;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x6309;&#x7167;water mark min&#x6765;reserve&#x4E00;&#x4E9B;&#x9875;&#x9762;&#xFF0C;&#x987A;&#x5E8F;&#x4E0A;&#x5728;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x540E;&#x9762;&#x624D;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;3&#xFF09;&#x518D;&#x770B;&#x4E00;&#x4E0B;migrate type&#x7684;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;&#xFF0C;set_pageblock_migratetype -&gt;&#xA0;set_pageblock_flags_groupvoid set_pageblock_flags_group(struct page *page, unsigned long flags,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int start_bitidx, int end_bitidx){&#xA0;&#xA0;&#xA0;&#xA0; struct zone *zone;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long *bitmap;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long pfn, bitidx;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long value = 1;&#xA0;&#xA0;&#xA0;&#xA0; zone = page_zone(page);&#xA0;&#xA0;&#xA0;&#xA0; pfn = page_to_pfn(page);&#xA0;&#xA0;&#xA0;&#xA0; bitmap = get_pageblock_bitmap(zone, pfn);&#xA0;&#xA0;&#xA0;&#xA0; bitidx = pfn_to_bitidx(zone, pfn);&#xA0;&#xA0;&#xA0;&#xA0; for (; start_bitidx &lt;= end_bitidx; start_bitidx++, value &lt;&lt;= 1)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (flags &amp; value)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __set_bit(bitidx + start_bitidx, bitmap);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __clear_bit(bitidx + start_bitidx, bitmap);}&#xA0; &#xA0; &#xA0;&#x6CA1;&#x6709;&#x60F3;&#x8C61;&#x7684;&#x90A3;&#x4E48;&#x7B80;&#x5355;&#x5427;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;bitmap&#xFF0C;&#x4ED6;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x5982;&#x4E0B;&#xFF1A;static unsigned long __init usemap_size(unsigned long zonesize){&#xA0;&#xA0;&#xA0;&#xA0; unsigned long usemapsize;&#xA0;&#xA0;&#xA0;&#xA0; usemapsize = roundup(zonesize, pageblock_nr_pages);&#xA0;&#xA0;&#xA0;&#xA0; usemapsize = usemapsize &gt;&gt; pageblock_order;&#xA0;&#xA0;&#xA0;&#xA0; usemapsize *= NR_PAGEBLOCK_BITS;&#xA0;&#xA0;&#xA0;&#xA0; usemapsize = roundup(usemapsize, 8 * sizeof(unsigned long));&#xA0;&#xA0;&#xA0;&#xA0; return usemapsize / 8;}static void __init setup_usemap(struct pglist_data *pgdat,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; struct zone *zone, unsigned long zonesize){&#xA0;&#xA0;&#xA0;&#xA0; unsigned long usemapsize = usemap_size(zonesize);&#xA0;&#xA0;&#xA0;&#xA0; zone-&gt;pageblock_flags = NULL;&#xA0;&#xA0;&#xA0;&#xA0; if (usemapsize)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; zone-&gt;pageblock_flags = alloc_bootmem_node(pgdat, usemapsize);}&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x6240;&#x8C13;&#x7684;bitmap&#x5C31;&#x662F;zone-&gt;pageblock_flags&#x3002;&#x6BCF;&#x4E2A;zone&#x88AB;&#x5206;&#x5272;&#x6210;&#x82E5;&#x5E72;&#x4E2A;pageblock&#xFF0C;&#x6BCF;&#x4E2A;pageblock&#x5206;&#x914D;3&#x4F4D;&#x6765;&#x8868;&#x793A;migrate type&#x3002;pageblock&#x5176;&#x5B9E;&#x5C31;&#x662F;freearea&#x4E2D;order&#x6700;&#x5927;&#x7684;&#x4E00;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x4ECE;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6765;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free_area_init_core -&gt;&#xA0;set_pageblock_order(pageblock_default_order())&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;static inline int pageblock_default_order(void){&#xA0;&#xA0;&#xA0;&#xA0; if (HPAGE_SHIFT &gt; PAGE_SHIFT)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return HUGETLB_PAGE_ORDER;&#xA0;&#xA0;&#xA0;&#xA0; return MAX_ORDER-1;}&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;get_pageblock_migratetype(page)&#x6765;&#x83B7;&#x5F97;&#x672C;page&#x7684;migrate type&#x3002;&#x56E0;&#x4E3A;&#x53EA;&#x8981;&#x6CA1;&#x6709;&#x505A;migrate type&#x7684;&#x8FC1;&#x79FB;&#xFF0C;&#x6BCF;&#x4E2A;page&#x7684;migrate type&#x603B;&#x662F;&#x548C;&#x4ED6;&#x6240;&#x5728;&#x7684;pageblock&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;migrate type&#x53EA;&#x4F1A;&#x5728;fallback&#x673A;&#x5236;&#x4E2D;&#x6539;&#x53D8;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x5728;&#x672C;migrate type&#x4E2D;&#x65E0;&#x5185;&#x5B58;&#x53EF;&#x5206;&#x914D;&#xFF0C;&#x5C31;&#x8981;&#x53BB;&#x5907;&#x7528;&#x7684;migrate type&#x5217;&#x8868;&#x4E2D;&#x627E;&#x6700;&#x5927;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x8FC1;&#x79FB;&#x8FC7;&#x6765;&#xFF0C;&#x518D;&#x4E0D;&#x6D4E;&#x8FD8;&#x6709;reserved&#x7684;&#x9875;&#x9762;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x4E0B;&#x9762;&#x5206;&#x6790;&#x4E00;&#x4E0B;migrate type&#x662F;&#x5982;&#x4F55;&#x6539;&#x53D8;&#x7684;&#x3002;&#x8FD8;&#x662F;&#x6709;&#x70B9;&#x5C0F;&#x590D;&#x6742;&#x7684;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 1&#xFF09;&#x9996;&#x5148;&#x6240;&#x6709;&#x8BB2;&#x5230;fallback&#x673A;&#x5236;&#x7684;&#x8D44;&#x6599;&#x4E0A;&#x90FD;&#x4F1A;&#x63D0;&#x9192;&#x6211;&#x4EEC;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x4ECE;backup migratetype&#x4E2D;&#x53D6;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x662F;&#x4ECE;&#x5927;&#x7684;order&#x5F80;&#x5C0F;order&#x9012;&#x51CF;&#xFF0C;&#x76F4;&#x5230;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;order&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5C31;&#x8FD4;&#x56DE;NULL&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 2&#xFF09;&#x7B2C;&#x4E8C;&#x70B9;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;fallback&#x673A;&#x5236;&#x4E00;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;page&#x7684;migratetype&#x5C31;&#x4F1A;&#x6539;&#x53D8;&#x3002;&#x800C;&#x662F;&#x5728;&#x6EE1;&#x8DB3;&#x4E00;&#x5B9A;&#x7684;&#x6761;&#x4EF6;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x4F1A;&#x53D1;&#x751F;&#x3002;&#x6761;&#x4EF6;&#x5C31;&#x662F;&#x7EA2;&#x5708;&#x4E2D;&#x7684;&#xFF0C;&#x4EE5;&#x53CA;&#x4E0B;&#x9762;&#x7684;page moved &gt;= pageblock / 2&#x3002;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x5462;&#xFF1F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53;&#x627E;&#x5230;&#x7684;&#x8FD9;&#x5757;&#x5927;&#x5185;&#x5B58;&#x7684;order&#x8D85;&#x8FC7;pageblock_order&#x7684;&#x4E00;&#x534A;&#xFF0C;&#x4EE5;7800&#x4E3A;&#x4F8B;&#xFF0C;default pageblock_order&#x662F;MAX_ORDER-1 = 10&#xFF0C;&#x5219;&#x8FD9;&#x5757;&#x5185;&#x5B58;order&#x8981;&#x8D85;&#x8FC7;5&#xFF0C;&#x5C31;&#x662F;32&#x4E2A;page&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x6761;&#x4EF6;&#x5C31;&#x662F;&#xFF0C;&#x8FD9;&#x5757;&#x5927;&#x5185;&#x5B58;&#x6240;&#x5728;&#x7684;pageblock&#x4E0A;&#x6709;&#x8D85;&#x8FC7;&#x4E00;&#x534A;&#x7684;&#x7A7A;&#x95F2;buddy&#x3002;&#x82E5;&#x6EE1;&#x8DB3;&#x8FD9;&#x4E24;&#x70B9;&#xFF0C;&#x8FD9;&#x5757;&#x5185;&#x5B58;&#x6240;&#x5728;&#x7684;pageblock&#x7684;migratetype&#x4F1A;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x90A3;&#x4E48;&#x5C5E;&#x4E8E;&#x4ED6;&#x4E14;&#x5DF2;&#x5206;&#x914D;&#x51FA;&#x53BB;&#x7684;buddy&#x5728;&#x91CA;&#x653E;&#x65F6;&#xFF0C;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x5230;&#x65B0;&#x7684;migratetype&#x4E2D;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 3&#xFF09;&#x6211;&#x4EEC;&#x5728;&#x6D4B;&#x8BD5;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x6761;&#x4EF6;&#x65F6;&#xFF0C;&#x4F1A;&#x5148;&#x5C06;pageblock&#x4E2D;&#x7A7A;&#x95F2;&#x7684;buddy&#x79FB;&#x5230;&#x65B0;&#x7684;migratetype&#x4E2D;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x771F;&#x6B63;&#x7684;&#x6539;&#x53D8;&#x5176;migratetype&#x3002;&#x56E0;&#x4E3A;&#x6D89;&#x53CA;&#x5230;&#x83B7;&#x53D6;migratetype&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x51FD;&#x6570;get_pageblock_migratetype&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x53EA;&#x8981;&#x4E0D;&#x4FEE;&#x6539;&#x6574;&#x5757;pageblock&#x7684;migratetype&#x5C31;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x5176;&#x4E0B;&#x6240;&#x6709;buddy&#x7684;migratetype&#x5C5E;&#x6027;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 4&#xFF09;&#x5F53;&#x627E;&#x5230;&#x7684;&#x8FD9;&#x5757;&#x5927;&#x5185;&#x5B58;&#x8D85;&#x8FC7;pageblock&#x65F6;&#xFF0C;&#x4F1A;&#x5C06;&#x5176;&#x4E0B;&#x6240;&#x6709;&#x7684;pageblock&#x7684;migratetype&#x90FD;&#x4FEE;&#x6539;&#x6210;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;migratetype&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x91CC;&#x53CD;&#x6620;&#x51FA;&#x7684;&#x601D;&#x60F3;&#x548C;&#x4E0A;&#x9762;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x627E;&#x5230;&#x7684;&#x7A7A;&#x95F2;&#x5185;&#x5B58;&#x8DB3;&#x591F;&#x5927;&#xFF0C;&#x5C31;&#x8FC1;&#x79FB;migratetype&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 5&#xFF09;&#x6700;&#x540E;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x5C31;&#x662F;&#xFF0C;&#x7EA2;&#x5708;&#x4E2D;&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x5176;&#x5B9E;&#x4E0D;&#x5B8C;&#x6574;&#xFF0C;&#x771F;&#x5B9E;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5224;&#x65AD;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;if (unlikely(current_order &gt;= (pageblock_order &gt;&gt; 1)) ||&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start_migratetype == MIGRATE_RECLAIMABLE ||&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;page_group_by_mobility_disabled) { &#x2026;&#x2026; }&#xA0;&#xA0; &#xA0; &#xA0;page_group_by_mobility_disabled&#x8868;&#x793A;&#x8FC1;&#x79FB;&#x7279;&#x6027;&#x5173;&#x95ED;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x9875;&#x9762;&#x5E76;&#x4E0D;&#x53D7;migratetype&#x6240;&#x9650;&#x5236;&#xFF0C;&#x90A3;&#x9875;&#x9762;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x968F;&#x5FC3;&#x6240;&#x6B32;&#x7684;&#x8FC1;&#x79FB;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x786E;&#x5B9E;&#x5982;&#x6B64;&#xFF0C;&#x540E;&#x9762;&#x5982;&#x679C;page_group_by_mobility_disabled&#xFF0C;&#x4E5F;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x5224;&#x65AD;&#x6709;&#x591A;&#x5C11;free buddy&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8FC1;&#x79FB;&#x9875;&#x9762;&#x4E86;&#x3002;&#xA0; &#xA0; &#xA0;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#xFF0C;start_migratetype == MIGRATE_RECLAIMABLE&#x5C31;&#x503C;&#x5F97;&#x63A8;&#x6572;&#x4E86;&#x3002;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x4E2D;&#x90FD;&#x6CA1;&#x6709;&#x770B;&#x5230;&#x5BF9;&#x5176;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x7F51;&#x7EDC;&#x4E0A;&#x5BF9;&#x5176;&#x7684;&#x89E3;&#x91CA;&#x662F;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#x53EF;&#x56DE;&#x6536;&#x9875;&#xFF1A;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x79FB;&#x52A8;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x53EF;&#x4EE5;&#x4ECE;&#x67D0;&#x4E9B;&#x6E90;&#x91CD;&#x65B0;&#x751F;&#x6210;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;&#x6240;&#x4EE5;&#x6211;&#x8BA4;&#x4E3A;MIGRATE_RECLAIMABLE&#x56E0;&#x4E3A;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x91CA;&#x653E;&#xFF08;&#x6216;&#x53EB;&#x56DE;&#x6536;&#xFF09;&#xFF0C;&#x4ED6;&#x4E5F;&#x662F;MIGRATE_UNMOVABLE&#x548C;MIGRATE_MOVABLE&#x7684;&#x7B2C;&#x4E00;&#x66FF;&#x8865;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7BA1;&#x627E;&#x5230;&#x7684;&#x7A7A;&#x95F2;&#x9875;&#x9762;&#x6709;&#x591A;&#x5927;&#xFF0C;&#x90FD;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x8FC1;&#x79FB;&#x7ED9;&#x4ED6;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[migrate type——buddy system的好搭档]]></title>
    <url>%2F2012%2F12%2F12%2Fmigrate_type-buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Linux&#x4E00;&#x5171;&#x5B9A;&#x4E49;5&#x4E2D;migrate type&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;#define MIGRATE_UNMOVABLE&#xA0;&#xA0;&#xA0;&#xA0; 0#define MIGRATE_RECLAIMABLE&#xA0;&#xA0; 1#define MIGRATE_MOVABLE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 2&#xA0;&#xA0;/* &#x672A;&#x89C1;&#x6709;&#x4F7F;&#x7528;&#x8BE5;&#x6807;&#x5FD7;&#x4F4D;&#x7684;&#x4EE3;&#x7801;*/#define MIGRATE_PCPTYPES&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 3 /* the number of types on the pcp lists */#define MIGRATE_RESERVE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 3#define MIGRATE_ISOLATE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 4 /* can&apos;t allocate from here */#define MIGRATE_TYPES&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 5&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5B9A;&#x4E49;migrate type&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;linux&#x5185;&#x6838;&#x5BF9;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x6539;&#x8FDB;--migrate_type&#x3002;&#x7B80;&#x8981;&#x6765;&#x8BF4;&#x5C31;&#x662F;Linux&#x5C06;&#x53EF;&#x79FB;&#x52A8;&#x6216;&#x4E0D;&#x53EF;&#x79FB;&#x52A8;&#x7684;&#x5185;&#x5B58;&#x5206;&#x5F00;&#x5206;&#x914D;&#xFF0C;&#x4EE5;&#x4FBF;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x51CF;&#x5C11;&#x788E;&#x7247;&#xFF0C;&#x63D0;&#x5347;&#x5206;&#x914D;&#x5927;&#x5757;&#x5185;&#x5B58;&#x7684;&#x80FD;&#x529B;&#x3002;&#x57FA;&#x4E8E;&#x8FD9;&#x79CD;&#x601D;&#x8DEF;&#xFF0C;&#x53EF;&#x89C1;&#x4E0A;&#x8FF0;5&#x79CD;migrate type&#x6700;&#x91CD;&#x8981;&#x7684;&#x5C31;&#x662F;MIGRATE_UNMOVABLE&#xFF0C;MIGRATE_MOVABLE&#x3002;&#x53E6;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;type&#x5C31;&#x662F;MIGRATE_RESERVE&#xFF0C;&#x8FD9;&#x8868;&#x793A;page&#x88AB;reserve&#xFF0C;&#x4E0D;&#x63A5;&#x53D7;buddy system&#x7BA1;&#x7406;&#xFF0C;&#x53EF;&#x53C2;&#x89C1;&#x51FD;&#x6570;setup_zone_migrate_reserve&#x3002;&#x5728;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x4F1A;&#x4F9D;&#x636E;water mark min&#x6765;reserve&#x4E00;&#x4E9B;page&#x505A;&#x5907;&#x7528;&#x3002;&#x8FD9;&#x4E09;&#x4E2A;type&#x662F;&#x7528;&#x5230;&#x6700;&#x591A;&#x7684;&#x4E09;&#x79CD;&#xFF0C;&#x4E0B;&#x9762;&#x7684;fallback&#x673A;&#x5236;&#x4E5F;&#x7528;&#x5230;&#x4E86;static int fallbacks[MIGRATE_TYPES][MIGRATE_TYPES-1] = {&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_UNMOVABLE]&#xA0;&#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_MOVABLE,&#xA0;&#xA0; MIGRATE_RESERVE },&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_RECLAIMABLE] = { MIGRATE_UNMOVABLE,&#xA0;&#xA0; MIGRATE_MOVABLE,&#xA0;&#xA0; MIGRATE_RESERVE },&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_MOVABLE]&#xA0;&#xA0;&#xA0;&#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_UNMOVABLE, MIGRATE_RESERVE },&#xA0;&#xA0;&#xA0;&#xA0; [MIGRATE_RESERVE]&#xA0;&#xA0;&#xA0;&#xA0; = { MIGRATE_RESERVE,&#xA0;&#xA0;&#xA0;&#xA0; MIGRATE_RESERVE,&#xA0;&#xA0; MIGRATE_RESERVE }, /* Never used */};migrate type&#x5728;memmap_init&#x4E2D;&#x521D;&#x59CB;&#x5316;&#x4E3A;MIGRATE_MOVABLE&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;void __meminit memmap_init_zone(unsigned long size, int nid, unsigned long zone,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long start_pfn, enum memmap_context context){&#xA0;&#xA0;&#xA0;&#xA0; struct page *page;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long end_pfn = start_pfn + size;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long pfn;&#xA0;&#xA0;&#xA0;&#xA0; struct zone *z;&#xA0;&#xA0;&#xA0;&#xA0; if (highest_memmap_pfn &lt; end_pfn - 1)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; highest_memmap_pfn = end_pfn - 1;&#xA0;&#xA0;&#xA0;&#xA0; z = &amp;NODE_DATA(nid)-&gt;node_zones[zone];&#xA0;&#xA0;&#xA0;&#xA0; for (pfn = start_pfn; pfn &lt; end_pfn; pfn++) {&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; page = pfn_to_page(pfn);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SetPageReserved(page);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /*&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * Mark the block movable so that blocks are reserved for&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * movable at startup. This will force kernel allocations&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * to reserve their blocks rather than leaking throughout&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * the address space during boot when many long-lived&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * kernel allocations are made. Later some blocks near&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * the start are marked MIGRATE_RESERVE by&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * setup_zone_migrate_reserve()&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; *&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * bitmap is created for zone&apos;s valid pfn range. but memmap&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * can be created for invalid pages (for alignment)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * check here not to call set_pageblock_migratetype() against&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * pfn out of zone.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; */&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if ((z-&gt;zone_start_pfn &lt;= pfn)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &amp;&amp; (pfn &lt; z-&gt;zone_start_pfn + z-&gt;spanned_pages)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &amp;&amp; !(pfn &amp; (pageblock_nr_pages - 1)))&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set_pageblock_migratetype(page, MIGRATE_MOVABLE);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INIT_LIST_HEAD(&amp;page-&gt;lru);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0; }}&#x4E0A;&#x9762;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x904D;&#x5386;memmap&#x6570;&#x7EC4;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BE5;zone&#x6240;&#x6709;&#x9875;&#x9762;&#x7684;page&#x7ED3;&#x6784;&#x4F53;&#xFF0C;1&#xFF09;&#x9996;&#x5148;&#x8BBE;&#x7F6E;page-&gt;flags&#x7684;PG_reserved&#x4F4D;&#xFF0C;&#x610F;&#x601D;&#x662F;&#x4E0D;&#x53D7;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x63A7;&#x5236;&#x3002;&#x6CA1;&#x9519;&#xFF0C;&#x6B64;&#x65F6;&#x4ECD;&#x5728;bootmem&#x63A7;&#x5236;&#x4E0B;&#xFF0C;&#x4E4B;&#x540E;&#x518D;__free_pages_bootmem&#x65F6;&#xFF0C;&#x4F1A;&#x6E05;&#x9664;&#x8BE5;&#x4F4D;&#xFF0C;&#x5C06;&#x5176;&#x7EB3;&#x5165;buddy&#x7CFB;&#x7EDF;&#x3002;2&#xFF09;&#x4E4B;&#x540E;set_pageblock_migratetype&#x5C06;&#x6240;&#x6709;page&#x7684;migrate type&#x8BBE;&#x4E3A;MIGRATE_MOVABLE&#x3002;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x6309;&#x7167;water mark min&#x6765;reserve&#x4E00;&#x4E9B;&#x9875;&#x9762;&#xFF0C;&#x987A;&#x5E8F;&#x4E0A;&#x5728;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x540E;&#x9762;&#x624D;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;3&#xFF09;&#x518D;&#x770B;&#x4E00;&#x4E0B;migrate type&#x7684;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;&#xFF0C;set_pageblock_migratetype -&gt;&#xA0;set_pageblock_flags_groupvoid set_pageblock_flags_group(struct page *page, unsigned long flags,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int start_bitidx, int end_bitidx){&#xA0;&#xA0;&#xA0;&#xA0; struct zone *zone;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long *bitmap;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long pfn, bitidx;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long value = 1;&#xA0;&#xA0;&#xA0;&#xA0; zone = page_zone(page);&#xA0;&#xA0;&#xA0;&#xA0; pfn = page_to_pfn(page);&#xA0;&#xA0;&#xA0;&#xA0; bitmap = get_pageblock_bitmap(zone, pfn);&#xA0;&#xA0;&#xA0;&#xA0; bitidx = pfn_to_bitidx(zone, pfn);&#xA0;&#xA0;&#xA0;&#xA0; for (; start_bitidx &lt;= end_bitidx; start_bitidx++, value &lt;&lt;= 1)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (flags &amp; value)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __set_bit(bitidx + start_bitidx, bitmap);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __clear_bit(bitidx + start_bitidx, bitmap);}&#xA0; &#xA0; &#xA0;&#x6CA1;&#x6709;&#x60F3;&#x8C61;&#x7684;&#x90A3;&#x4E48;&#x7B80;&#x5355;&#x5427;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;bitmap&#xFF0C;&#x4ED6;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x5982;&#x4E0B;&#xFF1A;static unsigned long __init usemap_size(unsigned long zonesize){&#xA0;&#xA0;&#xA0;&#xA0; unsigned long usemapsize;&#xA0;&#xA0;&#xA0;&#xA0; usemapsize = roundup(zonesize, pageblock_nr_pages);&#xA0;&#xA0;&#xA0;&#xA0; usemapsize = usemapsize &gt;&gt; pageblock_order;&#xA0;&#xA0;&#xA0;&#xA0; usemapsize *= NR_PAGEBLOCK_BITS;&#xA0;&#xA0;&#xA0;&#xA0; usemapsize = roundup(usemapsize, 8 * sizeof(unsigned long));&#xA0;&#xA0;&#xA0;&#xA0; return usemapsize / 8;}static void __init setup_usemap(struct pglist_data *pgdat,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; struct zone *zone, unsigned long zonesize){&#xA0;&#xA0;&#xA0;&#xA0; unsigned long usemapsize = usemap_size(zonesize);&#xA0;&#xA0;&#xA0;&#xA0; zone-&gt;pageblock_flags = NULL;&#xA0;&#xA0;&#xA0;&#xA0; if (usemapsize)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; zone-&gt;pageblock_flags = alloc_bootmem_node(pgdat, usemapsize);}&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x6240;&#x8C13;&#x7684;bitmap&#x5C31;&#x662F;zone-&gt;pageblock_flags&#x3002;&#x6BCF;&#x4E2A;zone&#x88AB;&#x5206;&#x5272;&#x6210;&#x82E5;&#x5E72;&#x4E2A;pageblock&#xFF0C;&#x6BCF;&#x4E2A;pageblock&#x5206;&#x914D;3&#x4F4D;&#x6765;&#x8868;&#x793A;migrate type&#x3002;pageblock&#x5176;&#x5B9E;&#x5C31;&#x662F;freearea&#x4E2D;order&#x6700;&#x5927;&#x7684;&#x4E00;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x4ECE;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6765;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free_area_init_core -&gt;&#xA0;set_pageblock_order(pageblock_default_order())&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;static inline int pageblock_default_order(void){&#xA0;&#xA0;&#xA0;&#xA0; if (HPAGE_SHIFT &gt; PAGE_SHIFT)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return HUGETLB_PAGE_ORDER;&#xA0;&#xA0;&#xA0;&#xA0; return MAX_ORDER-1;}&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;get_pageblock_migratetype(page)&#x6765;&#x83B7;&#x5F97;&#x672C;page&#x7684;migrate type&#x3002;&#x56E0;&#x4E3A;&#x53EA;&#x8981;&#x6CA1;&#x6709;&#x505A;migrate type&#x7684;&#x8FC1;&#x79FB;&#xFF0C;&#x6BCF;&#x4E2A;page&#x7684;migrate type&#x603B;&#x662F;&#x548C;&#x4ED6;&#x6240;&#x5728;&#x7684;pageblock&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;migrate type&#x53EA;&#x4F1A;&#x5728;fallback&#x673A;&#x5236;&#x4E2D;&#x6539;&#x53D8;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x5728;&#x672C;migrate type&#x4E2D;&#x65E0;&#x5185;&#x5B58;&#x53EF;&#x5206;&#x914D;&#xFF0C;&#x5C31;&#x8981;&#x53BB;&#x5907;&#x7528;&#x7684;migrate type&#x5217;&#x8868;&#x4E2D;&#x627E;&#x6700;&#x5927;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x8FC1;&#x79FB;&#x8FC7;&#x6765;&#xFF0C;&#x518D;&#x4E0D;&#x6D4E;&#x8FD8;&#x6709;reserved&#x7684;&#x9875;&#x9762;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x4E0B;&#x9762;&#x5206;&#x6790;&#x4E00;&#x4E0B;migrate type&#x662F;&#x5982;&#x4F55;&#x6539;&#x53D8;&#x7684;&#x3002;&#x8FD8;&#x662F;&#x6709;&#x70B9;&#x5C0F;&#x590D;&#x6742;&#x7684;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 1&#xFF09;&#x9996;&#x5148;&#x6240;&#x6709;&#x8BB2;&#x5230;fallback&#x673A;&#x5236;&#x7684;&#x8D44;&#x6599;&#x4E0A;&#x90FD;&#x4F1A;&#x63D0;&#x9192;&#x6211;&#x4EEC;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x4ECE;backup migratetype&#x4E2D;&#x53D6;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x662F;&#x4ECE;&#x5927;&#x7684;order&#x5F80;&#x5C0F;order&#x9012;&#x51CF;&#xFF0C;&#x76F4;&#x5230;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;order&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5C31;&#x8FD4;&#x56DE;NULL&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 2&#xFF09;&#x7B2C;&#x4E8C;&#x70B9;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;fallback&#x673A;&#x5236;&#x4E00;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;page&#x7684;migratetype&#x5C31;&#x4F1A;&#x6539;&#x53D8;&#x3002;&#x800C;&#x662F;&#x5728;&#x6EE1;&#x8DB3;&#x4E00;&#x5B9A;&#x7684;&#x6761;&#x4EF6;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x4F1A;&#x53D1;&#x751F;&#x3002;&#x6761;&#x4EF6;&#x5C31;&#x662F;&#x7EA2;&#x5708;&#x4E2D;&#x7684;&#xFF0C;&#x4EE5;&#x53CA;&#x4E0B;&#x9762;&#x7684;page moved &gt;= pageblock / 2&#x3002;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x5462;&#xFF1F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53;&#x627E;&#x5230;&#x7684;&#x8FD9;&#x5757;&#x5927;&#x5185;&#x5B58;&#x7684;order&#x8D85;&#x8FC7;pageblock_order&#x7684;&#x4E00;&#x534A;&#xFF0C;&#x4EE5;7800&#x4E3A;&#x4F8B;&#xFF0C;default pageblock_order&#x662F;MAX_ORDER-1 = 10&#xFF0C;&#x5219;&#x8FD9;&#x5757;&#x5185;&#x5B58;order&#x8981;&#x8D85;&#x8FC7;5&#xFF0C;&#x5C31;&#x662F;32&#x4E2A;page&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x6761;&#x4EF6;&#x5C31;&#x662F;&#xFF0C;&#x8FD9;&#x5757;&#x5927;&#x5185;&#x5B58;&#x6240;&#x5728;&#x7684;pageblock&#x4E0A;&#x6709;&#x8D85;&#x8FC7;&#x4E00;&#x534A;&#x7684;&#x7A7A;&#x95F2;buddy&#x3002;&#x82E5;&#x6EE1;&#x8DB3;&#x8FD9;&#x4E24;&#x70B9;&#xFF0C;&#x8FD9;&#x5757;&#x5185;&#x5B58;&#x6240;&#x5728;&#x7684;pageblock&#x7684;migratetype&#x4F1A;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x90A3;&#x4E48;&#x5C5E;&#x4E8E;&#x4ED6;&#x4E14;&#x5DF2;&#x5206;&#x914D;&#x51FA;&#x53BB;&#x7684;buddy&#x5728;&#x91CA;&#x653E;&#x65F6;&#xFF0C;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x5230;&#x65B0;&#x7684;migratetype&#x4E2D;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 3&#xFF09;&#x6211;&#x4EEC;&#x5728;&#x6D4B;&#x8BD5;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x6761;&#x4EF6;&#x65F6;&#xFF0C;&#x4F1A;&#x5148;&#x5C06;pageblock&#x4E2D;&#x7A7A;&#x95F2;&#x7684;buddy&#x79FB;&#x5230;&#x65B0;&#x7684;migratetype&#x4E2D;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x771F;&#x6B63;&#x7684;&#x6539;&#x53D8;&#x5176;migratetype&#x3002;&#x56E0;&#x4E3A;&#x6D89;&#x53CA;&#x5230;&#x83B7;&#x53D6;migratetype&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x51FD;&#x6570;get_pageblock_migratetype&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x53EA;&#x8981;&#x4E0D;&#x4FEE;&#x6539;&#x6574;&#x5757;pageblock&#x7684;migratetype&#x5C31;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x5176;&#x4E0B;&#x6240;&#x6709;buddy&#x7684;migratetype&#x5C5E;&#x6027;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 4&#xFF09;&#x5F53;&#x627E;&#x5230;&#x7684;&#x8FD9;&#x5757;&#x5927;&#x5185;&#x5B58;&#x8D85;&#x8FC7;pageblock&#x65F6;&#xFF0C;&#x4F1A;&#x5C06;&#x5176;&#x4E0B;&#x6240;&#x6709;&#x7684;pageblock&#x7684;migratetype&#x90FD;&#x4FEE;&#x6539;&#x6210;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;migratetype&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x91CC;&#x53CD;&#x6620;&#x51FA;&#x7684;&#x601D;&#x60F3;&#x548C;&#x4E0A;&#x9762;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x627E;&#x5230;&#x7684;&#x7A7A;&#x95F2;&#x5185;&#x5B58;&#x8DB3;&#x591F;&#x5927;&#xFF0C;&#x5C31;&#x8FC1;&#x79FB;migratetype&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 5&#xFF09;&#x6700;&#x540E;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x5C31;&#x662F;&#xFF0C;&#x7EA2;&#x5708;&#x4E2D;&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x5176;&#x5B9E;&#x4E0D;&#x5B8C;&#x6574;&#xFF0C;&#x771F;&#x5B9E;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5224;&#x65AD;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;if (unlikely(current_order &gt;= (pageblock_order &gt;&gt; 1)) ||&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start_migratetype == MIGRATE_RECLAIMABLE ||&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;page_group_by_mobility_disabled) { &#x2026;&#x2026; }&#xA0;&#xA0; &#xA0; &#xA0;page_group_by_mobility_disabled&#x8868;&#x793A;&#x8FC1;&#x79FB;&#x7279;&#x6027;&#x5173;&#x95ED;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x9875;&#x9762;&#x5E76;&#x4E0D;&#x53D7;migratetype&#x6240;&#x9650;&#x5236;&#xFF0C;&#x90A3;&#x9875;&#x9762;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x968F;&#x5FC3;&#x6240;&#x6B32;&#x7684;&#x8FC1;&#x79FB;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x786E;&#x5B9E;&#x5982;&#x6B64;&#xFF0C;&#x540E;&#x9762;&#x5982;&#x679C;page_group_by_mobility_disabled&#xFF0C;&#x4E5F;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x5224;&#x65AD;&#x6709;&#x591A;&#x5C11;free buddy&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8FC1;&#x79FB;&#x9875;&#x9762;&#x4E86;&#x3002;&#xA0; &#xA0; &#xA0;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#xFF0C;start_migratetype == MIGRATE_RECLAIMABLE&#x5C31;&#x503C;&#x5F97;&#x63A8;&#x6572;&#x4E86;&#x3002;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x4E2D;&#x90FD;&#x6CA1;&#x6709;&#x770B;&#x5230;&#x5BF9;&#x5176;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x7F51;&#x7EDC;&#x4E0A;&#x5BF9;&#x5176;&#x7684;&#x89E3;&#x91CA;&#x662F;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#x53EF;&#x56DE;&#x6536;&#x9875;&#xFF1A;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x79FB;&#x52A8;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x53EF;&#x4EE5;&#x4ECE;&#x67D0;&#x4E9B;&#x6E90;&#x91CD;&#x65B0;&#x751F;&#x6210;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;&#x6240;&#x4EE5;&#x6211;&#x8BA4;&#x4E3A;MIGRATE_RECLAIMABLE&#x56E0;&#x4E3A;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x91CA;&#x653E;&#xFF08;&#x6216;&#x53EB;&#x56DE;&#x6536;&#xFF09;&#xFF0C;&#x4ED6;&#x4E5F;&#x662F;MIGRATE_UNMOVABLE&#x548C;MIGRATE_MOVABLE&#x7684;&#x7B2C;&#x4E00;&#x66FF;&#x8865;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7BA1;&#x627E;&#x5230;&#x7684;&#x7A7A;&#x95F2;&#x9875;&#x9762;&#x6709;&#x591A;&#x5927;&#xFF0C;&#x90FD;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x8FC1;&#x79FB;&#x7ED9;&#x4ED6;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[伙伴系统buddy allocator (1)——初始化]]></title>
    <url>%2F2012%2F12%2F08%2F%E4%BC%99%E4%BC%B4%E7%B3%BB%E7%BB%9Fbuddy_allocator_(1)-%E5%88%9D%E5%A7%8B%E5%8C%96%2F</url>
    <content type="text"><![CDATA[&#x4E4B;&#x524D;&#x6709;&#x5B66;&#x4E60;&#x8FC7;bootmem&#x548C;memblock&#x4E24;&#x79CD;&#x5185;&#x5B58;&#x5206;&#x914D;&#x65B9;&#x5F0F;&#xFF0C;&#x5206;&#x522B;&#x5728;&#x7B14;&#x8BB0; memblock&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x548C;&#xA0;bootmem&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x4E2D;&#x6709;&#x6240;&#x8BB0;&#x5F55;&#x3002;&#x8FD9;&#x662F;&#x4E24;&#x79CD;&#x5728;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#x65B9;&#x5F0F;&#x3002;&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x8981;&#x7528;bootmem&#x8FD9;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x5206;&#x914D;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x76F4;&#x63A5;&#x4E0A;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x5462;&#xFF0C;Gorman&#x5728;&#x5176;&#x4E66;&#x4E2D;&#x8FD9;&#x6837;&#x6307;&#x51FA;&#xFF1A;It is impractical to statically initialize all the core kernel memory structures at&#xA0;compile time because there are simply far too many permutations of hardware con-&#xFB01;gurations. To set up even the basic structures, though, requires memory because&#xA0;even the physical page allocator, discussed in the next chapter, needs to allocate&#xA0;memory to initialize itself.&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; -- &#x300A;Understanding the Linux&#xAE;Virtual Memory Manager&#x300B;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5C31;&#x662F;&#x4E0D;&#x7BA1;&#x662F;buddy allocator&#x8FD8;&#x662F;slab allocator&#xFF0C;&#x90FD;&#x592A;&#x590D;&#x6742;&#xFF0C;&#x7275;&#x6D89;&#x5230;&#x5404;&#x79CD;&#x5BF9;&#x6297;&#x788E;&#x7247;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5176;&#x672C;&#x8EAB;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5C31;&#x8981;&#x7275;&#x6D89;&#x5230;&#x5185;&#x5B58;&#x5206;&#x914D;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6240;&#x4EE5;Linux kernel&#x5148;&#x7528;bootmem&#x7B49;&#x7B80;&#x5355;&#x673A;&#x5236;&#x9876;&#x4E00;&#x9635;&#xFF0C;&#x4E4B;&#x540E;&#x518D;&#x628A;&#x6240;&#x6709;&#x5185;&#x5B58;&#x90FD;&#x5206;&#x914D;&#x7ED9;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#xFF0C;&#x4EA4;&#x7ED9;&#x4ED6;&#x7BA1;&#x7406;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x672C;&#x7BC7;&#x5148;&#x8BF4;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x3002;&#x5173;&#x4E8E;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x5C31;&#x4E0D;&#x505A;&#x4ECB;&#x7ECD;&#x4E86;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;Linux&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;(&#x4E00;)--&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x6982;&#x8FF0; - vanbreaker&#x7684;&#x4E13;&#x680F; - &#x535A;&#x5BA2;&#x9891;&#x9053; - CSDN.NET&#x3002;&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x5217;&#x4E00;&#x4E0B;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x51E0;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;struct zone {&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;struct per_cpu_pageset __percpu *pageset;&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;struct free_area&#xA0;&#xA0;&#xA0;&#xA0; free_area[MAX_ORDER];&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;}struct free_area {&#xA0;&#xA0;&#xA0;&#xA0; struct list_head&#xA0;&#xA0;&#xA0;&#xA0; free_list[MIGRATE_TYPES];&#xA0;&#xA0;&#xA0;&#xA0; unsigned long&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_free;};&#x4E0D;&#x4E00;&#x4E00;&#x4F5C;&#x89E3;&#x91CA;&#x4E86;&#xFF0C;&#x53EA;&#x8BF4;&#x4E00;&#x4E0B;&#x548C;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x7684;&#x90E8;&#x5206;&#x3002;&#x6240;&#x6709;&#x7684;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x5728;zone-&gt;free_area[MAX_ORDER]&#x4E2D;&#xFF0C;&#x501F;&#x7528;Gorman&#x7684;&#x4E00;&#x5E45;&#x56FE;&#x6BCF;&#x4E00;&#x4E2A;order&#x7684;free_area&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x7EC4;&#x6309;migrate type&#x5206;&#x7C7B;&#x7684;list&#xFF0C;nr_free&#x8868;&#x793A;&#x8FD9;&#x4E2A;order&#x5171;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x7A7A;&#x95F2;&#x5757;&#x3002;&#x800C;list&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x5C31;&#x662F;page-&gt;lru&#x3002;&#x4E0B;&#x9762;&#x5F00;&#x59CB;&#x771F;&#x6B63;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x8003;&#x8651;&#x9AD8;&#x7AEF;&#x5185;&#x5B58;&#x7684;&#x8BDD;&#xFF0C;&#x6838;&#x5FC3;&#x51FD;&#x6570;&#x5C31;&#x5728;free_all_bootmem&#x3002;free_all_bootmem&#x5C31;&#x662F;&#x5728;&#x904D;&#x5386;bootmem&#xFF0C;&#x5E76;&#x91CA;&#x653E;bdata_list&#x4E0A;&#x7684;&#x6BCF;&#x4E00;&#x5757;bootmem&#x3002;&#x4E0B;&#x9762;&#x4EE5;&#x91CA;&#x653E;&#x4E00;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x4E3A;&#x4F8B;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;while (start &lt; end) {unsigned long *map, idx, vec;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; map = bdata-&gt;node_bootmem_map;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; idx = start - bdata-&gt;node_min_pfn;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; vec = ~map[idx / BITS_PER_LONG]; // vec&#x662F;map&#x53D6;&#x53CD;&#xFF0C;&#x5219;vec&#x4E2D;0&#x8868;&#x793A;&#x5DF2;&#x5206;&#x914D;&#xFF0C;1&#x8868;&#x793A;&#x672A;&#x5206;&#x914D;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; /* aligned&#x7684;&#x542B;&#x4E49;&#x662F;&#xFF0C;start&#x6709;&#x6CA1;&#x6709;&#x548C;LONG&#x8FB9;&#x754C;&#x5BF9;&#x9F50;&#xFF0C;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;* &#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x591A;&#x51FA;&#x6765;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x4E5F;&#x8981;&#x6309;order 0&#x6765;&#x91CA;&#x653E;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;*/&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (aligned &amp;&amp; vec == ~0UL &amp;&amp; start + BITS_PER_LONG &lt; end) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int order = ilog2(BITS_PER_LONG);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __free_pages_bootmem(pfn_to_page(start), order);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; count += BITS_PER_LONG;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; } else {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long off = 0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; while (vec &amp;&amp; off &lt; BITS_PER_LONG) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (vec &amp; 1) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; page = pfn_to_page(start + off);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __free_pages_bootmem(page, 0);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; count++;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; vec &gt;&gt;= 1;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; off++;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start += BITS_PER_LONG;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x770B;&#x8D77;&#x6765;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4ED6;&#x7684;&#x6838;&#x5FC3;&#x5185;&#x5BB9;&#x90FD;&#x5728;&#x91CA;&#x653E;bootmem&#x4E0A;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x6574;&#x7247;&#x91CA;&#x653E;&#x8FD8;&#x662F;&#x6309;&#x9875;&#x91CA;&#x653E;&#xFF0C;&#x6700;&#x540E;&#x90FD;&#x4F1A;&#x843D;&#x5230;&#x51FD;&#x6570;__free_pages_bootmem&#x91CC;&#x3002;&#x5176;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x662F;&#xA0; &#xA0; &#xA0;1&#xFF09;__ClearPageReserved&#xA0; &#xA0; &#xA0;2&#xFF09;&#x6240;&#x6709;page count&#x8BBE;&#x4E3A;0&#xFF0C;set_page_count(page, 0)&#xA0; &#xA0; &#xA0;3&#xFF09;page block&#x9996;&#x9875;count&#x8BBE;&#x4E3A;1&#xFF0C;set_page_refcounted(page);&#xA0; &#xA0; &#xA0;4&#xFF09;__free_pages(page, order);&#x6240;&#x4EE5;&#x6700;&#x540E;&#x5F52;&#x6839;&#x7ED3;&#x5E95;&#x5C31;&#x5230;&#x4E86;__free_pages&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x77E5;&#x8BC6;&#x70B9;&#x3002;&#x5176;&#x5B9A;&#x4E49;&#x5728;mm/page_alloc.c&#x4E2D;&#x3002;&#x6240;&#x6709;&#x7684;&#x91CA;&#x653E;&#x88AB;&#x5206;&#x6210;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;1&#xFF09;&#x5355;&#x9875;&#x91CA;&#x653E; 2&#xFF09;&#x6309;order&#x91CA;&#x653E;&#x3002;1.&#x5355;&#x9875;&#x91CA;&#x653E;&#x5982;&#x679C;&#x662F;&#x5355;&#x9875;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x5C06;&#x4E4B;&#x91CA;&#x653E;&#x5230;zone-&gt;pageset&#x4E2D;&#xFF0C;&#x51B7;&#x9875;&#x52A0;&#x5165;&#x5934;&#x90E8;&#xFF0C;&#x70ED;&#x9875;&#x52A0;&#x5165;&#x5C3E;&#x90E8;&#x3002;&#x5173;&#x4E8E;&#x51B7;&#x70ED;&#x9875;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x7B14;&#x8BB0;&#x8BA4;&#x8BC6;Linux&#x7269;&#x7406;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;--Buddy System&#x3002;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;zone-&gt;pageset&#x662F;&#x4E2A;per-CPU&#x53D8;&#x91CF;&#xFF0C;&#x6BCF;&#x4E2A;pageset&#x6709;&#x4E2A;struct per_cpu_pages pcp&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E2A;&#x6210;&#x5458;&#x5C31;&#x4EE3;&#x8868;&#x7740;&#x4E00;&#x7EC4;page&#x3002;&#x6240;&#x6709;&#x7684;page&#x5C31;&#x5728;&#x4E0B;&#x9762;&#x7684;lists&#x8FD9;&#x7EC4;&#x5217;&#x8868;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x7EC4;&#x5185;&#x5B58;&#x4ECE;&#x4F55;&#x800C;&#x6765;&#xFF0C;&#x4ECE;&#x521D;&#x59CB;&#x5316;&#x7684;&#x8FDB;&#x7A0B;&#x770B;&#x6765;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x91CA;&#x653E;bootmem&#x65F6;&#x5019;&#x7684;&#x8FD9;&#x4E9B;&#x5355;&#x4E2A;&#x9875;&#xFF0C;&#x5C31;&#x88AB;&#x91CA;&#x653E;&#x5230;per-CPU&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x6709;&#x8FD9;&#x4E2A;per-CPU&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5728;&#x5206;&#x914D;1&#x9875;&#x8FD9;&#x79CD;&#x5C0F;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x8FD8;&#x8981;&#x83B7;&#x53D6;zone-&gt;lock&#x6765;&#x9501;&#x4F4F;&#x6574;&#x4E2A;&#x533A;&#x57DF;&#xFF0C;&#x8FD9;&#x6837;&#x5F88;&#x4E0D;&#x5212;&#x7B97;&#x3002;struct per_cpu_pageset {&#xA0;&#xA0;&#xA0;&#xA0; struct per_cpu_pages pcp;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;};&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;struct per_cpu_pages {&#xA0;&#xA0;&#xA0;&#xA0; int count;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* number of pages in the list */&#xA0;&#xA0;&#xA0;&#xA0; int high;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* high watermark, emptying needed */&#xA0;&#xA0;&#xA0;&#xA0; int batch;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* chunk size for buddy add/remove */&#xA0;&#xA0;&#xA0;&#xA0; /* Lists of pages, one per migrate type stored on the pcp-lists */&#xA0;&#xA0;&#xA0;&#xA0; struct list_head lists[MIGRATE_PCPTYPES];};&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x6240;&#x8C13;&#x7684;&#x51B7;&#x548C;&#x70ED;&#xFF0C;&#x5C31;&#x662F;&#x6307;&#x662F;&#x5426;&#x5728;CPU&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x5728;L2 Cache&#x3002;zone-&gt;pageset-&gt;pcp[n]&#x8FD9;&#x5F20;&#x8868;&#x4E0A;&#x7684;&#x9879;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x9875;&#x9762;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x7684;&#x89C4;&#x5219;&#x88AB;&#x6362;&#x5165;&#x6362;&#x51FA;&#xFF0C;&#x5934;&#x90E8;&#x6700;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x5728;&#x70ED;&#x533A;&#xFF0C;&#x90A3;&#x4E48;&#x5C3E;&#x90E8;&#x5C31;&#x6700;&#x6709;&#x53EF;&#x80FD;&#x5728;&#x51B7;&#x533A;&#x3002;&#x6240;&#x4EE5;&#x5047;&#x5982;&#x5206;&#x914D;&#x5355;&#x72EC;&#x9875;&#x9762;&#x65F6;&#xFF0C;&#x5C3D;&#x91CF;&#x5206;&#x914D;&#x8BE5;list&#x7684;&#x5934;&#x90E8;&#x9875;&#x9762;&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;pcp-&gt;high, batch&#xFF0C;&#x662F;&#x7EF4;&#x62A4;&#x8FD9;&#x4E9B;list&#x7684;&#x6307;&#x6807;&#xFF0C;&#x5F53;&#x6240;&#x6709;lists&#x4E2D;&#x9875;&#x9762;&#x603B;&#x6570;&#x8D85;&#x8FC7;high&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x8981;&#x91CA;&#x653E;batch&#x4E2A;&#x9875;&#x9762;&#x5230;buddy system&#x3002;&#x4E5F;&#x5C31;&#x662F;free_pcppages_bulk&#xFF0C;&#x5176;&#x8FC7;&#x7A0B;&#x8DDF;&#x540E;&#x9762;&#x7684;__free_pages_ok&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;high, batch&#x7684;&#x521D;&#x59CB;&#x5316;&#x662F;&#x5728;setup_per_cpu_pageset-&gt;setup_zone_pageset(zone)-&gt;setup_pageset(pcp, zone_batchsize(zone)) -&gt;&#xA0;zone_batchsize(zone)&#x3002;&#x5176;&#x9009;&#x62E9;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x8BB2;&#x7A76;&#x7684;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x53C2;&#x8003;mm\page_alloc.c&#x3002;2.&#x6309;order&#x91CA;&#x653E;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6309;order&#x6765;&#x91CA;&#x653E;&#xFF0C;&#x53CD;&#x800C;&#x8FC7;&#x7A0B;&#x7B80;&#x5355;&#x6E05;&#x6670;&#x4E00;&#x4E9B;&#xFF0C;&#x53EA;&#x662F;&#x901A;&#x8FC7;&#x51E0;&#x4E2A;&#x5C0F;&#x6280;&#x5DE7;&#x627E;&#x5230;&#x672C;order&#x5757;&#x7684;buddy&#xFF0C;&#x4EE5;&#x53CA;&#x5408;&#x6210;&#x540E;&#x7684;combined index&#xFF0C;&#x4E4B;&#x540E;&#x53EA;&#x8981;&#x4E0D;&#x65AD;&#x7684;&#x5411;&#x4E0A;&#x5408;&#x5E76;&#x5230;&#x4E0D;&#x80FD;&#x5408;&#x5E76;&#x4E3A;&#x4E4B;&#xFF0C;&#x518D;set order&#xFF0C;&#x5C31;&#x5927;&#x529F;&#x544A;&#x6210;&#x3002;&#x52A0;&#x5165;&#x6CA1;&#x6709;buddy&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;set order&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x7528;__SetPageBuddy&#x6765;&#x8BBE;&#x7F6E;page&#x7ED3;&#x6784;&#x7684;flags&#x7684;&#x7B2C;19&#x4F4D;PG_buddy&#x4F4D;&#xFF0C;&#x8868;&#x793A;&#x672C;page&#x5DF2;&#x91CA;&#x653E;&#xFF0C;&#x5E76;&#x5728;buddy list&#x4E0A;&#x3002;&#x6700;&#x540E;&#x4E00;&#x70B9;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5C31;&#x662F;&#xFF0C;&#x5408;&#x6210;&#x597D;&#x540E;&#x7684;block&#x5982;&#x679C;&#x5C0F;&#x4E8E;MAX_ORDER&#x7684;&#xFF0C;&#x8FD8;&#x8981;&#x653E;&#x5728;zone-&gt;free_area[order].list&#x7684;&#x5C3E;&#x90E8;&#xFF0C;&#x4EE5;&#x4FBF;&#x5C3D;&#x91CF;&#x4E0D;&#x88AB;&#x5206;&#x914D;&#x51FA;&#x53BB;&#xFF0C;&#x6700;&#x597D;&#x80FD;&#x7EE7;&#x7EED;&#x88AB;&#x5408;&#x5E76;&#x6210;&#x5927;&#x5757;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x91CC;&#x503C;&#x5F97;&#x6B23;&#x8D4F;&#x7684;&#x662F;&#xFF0C;&#x600E;&#x4E48;&#x627E;&#x5230;buddy&#x548C;combined index&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x627E;&#x5230;buddy&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;page_idx ^ (1&lt;&lt;order)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x4ED4;&#x7EC6;&#x7B97;&#x7B97;&#x5427;&#xFF0C;&#x4ED6;&#x5C31;&#x662F;page_idx +/- (2^order)&#xFF0C;&#x82E5;page_idx&#x7684;order&#x4F4D;&#x4E3A;1&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x51CF;&#xFF0C;order&#x4F4D;&#x4E3A;0&#x76F8;&#x5F53;&#x4E8E;&#x52A0;&#x3002;&#x8FD9;&#x4E2A;&#x5F0F;&#x5B50;&#x592A;&#x4F18;&#x7F8E;&#x4E86;&#x3002;&#x8FD8;&#x6709;&#x600E;&#x4E48;&#x627E;&#x5230;parent index&#x5462;&#xFF1F;&#x540C;&#x6837;&#x5F88;&#x7B80;&#x6D01;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;combined_idx = page_idx &amp; (1&lt;&lt;order)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x503C;&#x5F97;&#x597D;&#x597D;&#x5B66;&#x4E60;&#x5B66;&#x4E60;&#x3002;]]></content>
  </entry>
  <entry>
    <title><![CDATA[伙伴系统buddy allocator (1)——初始化]]></title>
    <url>%2F2012%2F12%2F08%2F%E4%BC%99%E4%BC%B4%E7%B3%BB%E7%BB%9Fbuddy_allocator_(1)%E2%80%94%E2%80%94%E5%88%9D%E5%A7%8B%E5%8C%96%2F</url>
    <content type="text"><![CDATA[&#x4E4B;&#x524D;&#x6709;&#x5B66;&#x4E60;&#x8FC7;bootmem&#x548C;memblock&#x4E24;&#x79CD;&#x5185;&#x5B58;&#x5206;&#x914D;&#x65B9;&#x5F0F;&#xFF0C;&#x5206;&#x522B;&#x5728;&#x7B14;&#x8BB0; memblock&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x548C;&#xA0;bootmem&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x4E2D;&#x6709;&#x6240;&#x8BB0;&#x5F55;&#x3002;&#x8FD9;&#x662F;&#x4E24;&#x79CD;&#x5728;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#x65B9;&#x5F0F;&#x3002;&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x8981;&#x7528;bootmem&#x8FD9;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x5206;&#x914D;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x76F4;&#x63A5;&#x4E0A;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x5462;&#xFF0C;Gorman&#x5728;&#x5176;&#x4E66;&#x4E2D;&#x8FD9;&#x6837;&#x6307;&#x51FA;&#xFF1A;It is impractical to statically initialize all the core kernel memory structures at&#xA0;compile time because there are simply far too many permutations of hardware con-&#xFB01;gurations. To set up even the basic structures, though, requires memory because&#xA0;even the physical page allocator, discussed in the next chapter, needs to allocate&#xA0;memory to initialize itself.&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; -- &#x300A;Understanding the Linux&#xAE;Virtual Memory Manager&#x300B;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5C31;&#x662F;&#x4E0D;&#x7BA1;&#x662F;buddy allocator&#x8FD8;&#x662F;slab allocator&#xFF0C;&#x90FD;&#x592A;&#x590D;&#x6742;&#xFF0C;&#x7275;&#x6D89;&#x5230;&#x5404;&#x79CD;&#x5BF9;&#x6297;&#x788E;&#x7247;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5176;&#x672C;&#x8EAB;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5C31;&#x8981;&#x7275;&#x6D89;&#x5230;&#x5185;&#x5B58;&#x5206;&#x914D;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6240;&#x4EE5;Linux kernel&#x5148;&#x7528;bootmem&#x7B49;&#x7B80;&#x5355;&#x673A;&#x5236;&#x9876;&#x4E00;&#x9635;&#xFF0C;&#x4E4B;&#x540E;&#x518D;&#x628A;&#x6240;&#x6709;&#x5185;&#x5B58;&#x90FD;&#x5206;&#x914D;&#x7ED9;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#xFF0C;&#x4EA4;&#x7ED9;&#x4ED6;&#x7BA1;&#x7406;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x672C;&#x7BC7;&#x5148;&#x8BF4;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x3002;&#x5173;&#x4E8E;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x5C31;&#x4E0D;&#x505A;&#x4ECB;&#x7ECD;&#x4E86;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;Linux&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;(&#x4E00;)--&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x6982;&#x8FF0; - vanbreaker&#x7684;&#x4E13;&#x680F; - &#x535A;&#x5BA2;&#x9891;&#x9053; - CSDN.NET&#x3002;&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x5217;&#x4E00;&#x4E0B;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x51E0;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;struct zone {&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;struct per_cpu_pageset __percpu *pageset;&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;struct free_area&#xA0;&#xA0;&#xA0;&#xA0; free_area[MAX_ORDER];&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;}struct free_area {&#xA0;&#xA0;&#xA0;&#xA0; struct list_head&#xA0;&#xA0;&#xA0;&#xA0; free_list[MIGRATE_TYPES];&#xA0;&#xA0;&#xA0;&#xA0; unsigned long&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nr_free;};&#x4E0D;&#x4E00;&#x4E00;&#x4F5C;&#x89E3;&#x91CA;&#x4E86;&#xFF0C;&#x53EA;&#x8BF4;&#x4E00;&#x4E0B;&#x548C;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x7684;&#x90E8;&#x5206;&#x3002;&#x6240;&#x6709;&#x7684;&#x4F19;&#x4F34;&#x7CFB;&#x7EDF;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x5728;zone-&gt;free_area[MAX_ORDER]&#x4E2D;&#xFF0C;&#x501F;&#x7528;Gorman&#x7684;&#x4E00;&#x5E45;&#x56FE;&#x6BCF;&#x4E00;&#x4E2A;order&#x7684;free_area&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x7EC4;&#x6309;migrate type&#x5206;&#x7C7B;&#x7684;list&#xFF0C;nr_free&#x8868;&#x793A;&#x8FD9;&#x4E2A;order&#x5171;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x7A7A;&#x95F2;&#x5757;&#x3002;&#x800C;list&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x5C31;&#x662F;page-&gt;lru&#x3002;&#x4E0B;&#x9762;&#x5F00;&#x59CB;&#x771F;&#x6B63;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x8003;&#x8651;&#x9AD8;&#x7AEF;&#x5185;&#x5B58;&#x7684;&#x8BDD;&#xFF0C;&#x6838;&#x5FC3;&#x51FD;&#x6570;&#x5C31;&#x5728;free_all_bootmem&#x3002;free_all_bootmem&#x5C31;&#x662F;&#x5728;&#x904D;&#x5386;bootmem&#xFF0C;&#x5E76;&#x91CA;&#x653E;bdata_list&#x4E0A;&#x7684;&#x6BCF;&#x4E00;&#x5757;bootmem&#x3002;&#x4E0B;&#x9762;&#x4EE5;&#x91CA;&#x653E;&#x4E00;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x4E3A;&#x4F8B;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;while (start &lt; end) {unsigned long *map, idx, vec;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; map = bdata-&gt;node_bootmem_map;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; idx = start - bdata-&gt;node_min_pfn;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; vec = ~map[idx / BITS_PER_LONG]; // vec&#x662F;map&#x53D6;&#x53CD;&#xFF0C;&#x5219;vec&#x4E2D;0&#x8868;&#x793A;&#x5DF2;&#x5206;&#x914D;&#xFF0C;1&#x8868;&#x793A;&#x672A;&#x5206;&#x914D;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; /* aligned&#x7684;&#x542B;&#x4E49;&#x662F;&#xFF0C;start&#x6709;&#x6CA1;&#x6709;&#x548C;LONG&#x8FB9;&#x754C;&#x5BF9;&#x9F50;&#xFF0C;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;* &#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x591A;&#x51FA;&#x6765;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x4E5F;&#x8981;&#x6309;order 0&#x6765;&#x91CA;&#x653E;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;*/&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (aligned &amp;&amp; vec == ~0UL &amp;&amp; start + BITS_PER_LONG &lt; end) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int order = ilog2(BITS_PER_LONG);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __free_pages_bootmem(pfn_to_page(start), order);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; count += BITS_PER_LONG;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; } else {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long off = 0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; while (vec &amp;&amp; off &lt; BITS_PER_LONG) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (vec &amp; 1) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; page = pfn_to_page(start + off);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __free_pages_bootmem(page, 0);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; count++;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; vec &gt;&gt;= 1;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; off++;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start += BITS_PER_LONG;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x770B;&#x8D77;&#x6765;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4ED6;&#x7684;&#x6838;&#x5FC3;&#x5185;&#x5BB9;&#x90FD;&#x5728;&#x91CA;&#x653E;bootmem&#x4E0A;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x6574;&#x7247;&#x91CA;&#x653E;&#x8FD8;&#x662F;&#x6309;&#x9875;&#x91CA;&#x653E;&#xFF0C;&#x6700;&#x540E;&#x90FD;&#x4F1A;&#x843D;&#x5230;&#x51FD;&#x6570;__free_pages_bootmem&#x91CC;&#x3002;&#x5176;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x662F;&#xA0; &#xA0; &#xA0;1&#xFF09;__ClearPageReserved&#xA0; &#xA0; &#xA0;2&#xFF09;&#x6240;&#x6709;page count&#x8BBE;&#x4E3A;0&#xFF0C;set_page_count(page, 0)&#xA0; &#xA0; &#xA0;3&#xFF09;page block&#x9996;&#x9875;count&#x8BBE;&#x4E3A;1&#xFF0C;set_page_refcounted(page);&#xA0; &#xA0; &#xA0;4&#xFF09;__free_pages(page, order);&#x6240;&#x4EE5;&#x6700;&#x540E;&#x5F52;&#x6839;&#x7ED3;&#x5E95;&#x5C31;&#x5230;&#x4E86;__free_pages&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x77E5;&#x8BC6;&#x70B9;&#x3002;&#x5176;&#x5B9A;&#x4E49;&#x5728;mm/page_alloc.c&#x4E2D;&#x3002;&#x6240;&#x6709;&#x7684;&#x91CA;&#x653E;&#x88AB;&#x5206;&#x6210;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;1&#xFF09;&#x5355;&#x9875;&#x91CA;&#x653E; 2&#xFF09;&#x6309;order&#x91CA;&#x653E;&#x3002;1.&#x5355;&#x9875;&#x91CA;&#x653E;&#x5982;&#x679C;&#x662F;&#x5355;&#x9875;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x5C06;&#x4E4B;&#x91CA;&#x653E;&#x5230;zone-&gt;pageset&#x4E2D;&#xFF0C;&#x51B7;&#x9875;&#x52A0;&#x5165;&#x5934;&#x90E8;&#xFF0C;&#x70ED;&#x9875;&#x52A0;&#x5165;&#x5C3E;&#x90E8;&#x3002;&#x5173;&#x4E8E;&#x51B7;&#x70ED;&#x9875;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x7B14;&#x8BB0;&#x8BA4;&#x8BC6;Linux&#x7269;&#x7406;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;--Buddy System&#x3002;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;zone-&gt;pageset&#x662F;&#x4E2A;per-CPU&#x53D8;&#x91CF;&#xFF0C;&#x6BCF;&#x4E2A;pageset&#x6709;&#x4E2A;struct per_cpu_pages pcp&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E2A;&#x6210;&#x5458;&#x5C31;&#x4EE3;&#x8868;&#x7740;&#x4E00;&#x7EC4;page&#x3002;&#x6240;&#x6709;&#x7684;page&#x5C31;&#x5728;&#x4E0B;&#x9762;&#x7684;lists&#x8FD9;&#x7EC4;&#x5217;&#x8868;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x7EC4;&#x5185;&#x5B58;&#x4ECE;&#x4F55;&#x800C;&#x6765;&#xFF0C;&#x4ECE;&#x521D;&#x59CB;&#x5316;&#x7684;&#x8FDB;&#x7A0B;&#x770B;&#x6765;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x91CA;&#x653E;bootmem&#x65F6;&#x5019;&#x7684;&#x8FD9;&#x4E9B;&#x5355;&#x4E2A;&#x9875;&#xFF0C;&#x5C31;&#x88AB;&#x91CA;&#x653E;&#x5230;per-CPU&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x6709;&#x8FD9;&#x4E2A;per-CPU&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5728;&#x5206;&#x914D;1&#x9875;&#x8FD9;&#x79CD;&#x5C0F;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x8FD8;&#x8981;&#x83B7;&#x53D6;zone-&gt;lock&#x6765;&#x9501;&#x4F4F;&#x6574;&#x4E2A;&#x533A;&#x57DF;&#xFF0C;&#x8FD9;&#x6837;&#x5F88;&#x4E0D;&#x5212;&#x7B97;&#x3002;struct per_cpu_pageset {&#xA0;&#xA0;&#xA0;&#xA0; struct per_cpu_pages pcp;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;};&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;struct per_cpu_pages {&#xA0;&#xA0;&#xA0;&#xA0; int count;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* number of pages in the list */&#xA0;&#xA0;&#xA0;&#xA0; int high;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* high watermark, emptying needed */&#xA0;&#xA0;&#xA0;&#xA0; int batch;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /* chunk size for buddy add/remove */&#xA0;&#xA0;&#xA0;&#xA0; /* Lists of pages, one per migrate type stored on the pcp-lists */&#xA0;&#xA0;&#xA0;&#xA0; struct list_head lists[MIGRATE_PCPTYPES];};&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x6240;&#x8C13;&#x7684;&#x51B7;&#x548C;&#x70ED;&#xFF0C;&#x5C31;&#x662F;&#x6307;&#x662F;&#x5426;&#x5728;CPU&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x5728;L2 Cache&#x3002;zone-&gt;pageset-&gt;pcp[n]&#x8FD9;&#x5F20;&#x8868;&#x4E0A;&#x7684;&#x9879;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x9875;&#x9762;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x7684;&#x89C4;&#x5219;&#x88AB;&#x6362;&#x5165;&#x6362;&#x51FA;&#xFF0C;&#x5934;&#x90E8;&#x6700;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x5728;&#x70ED;&#x533A;&#xFF0C;&#x90A3;&#x4E48;&#x5C3E;&#x90E8;&#x5C31;&#x6700;&#x6709;&#x53EF;&#x80FD;&#x5728;&#x51B7;&#x533A;&#x3002;&#x6240;&#x4EE5;&#x5047;&#x5982;&#x5206;&#x914D;&#x5355;&#x72EC;&#x9875;&#x9762;&#x65F6;&#xFF0C;&#x5C3D;&#x91CF;&#x5206;&#x914D;&#x8BE5;list&#x7684;&#x5934;&#x90E8;&#x9875;&#x9762;&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;pcp-&gt;high, batch&#xFF0C;&#x662F;&#x7EF4;&#x62A4;&#x8FD9;&#x4E9B;list&#x7684;&#x6307;&#x6807;&#xFF0C;&#x5F53;&#x6240;&#x6709;lists&#x4E2D;&#x9875;&#x9762;&#x603B;&#x6570;&#x8D85;&#x8FC7;high&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x8981;&#x91CA;&#x653E;batch&#x4E2A;&#x9875;&#x9762;&#x5230;buddy system&#x3002;&#x4E5F;&#x5C31;&#x662F;free_pcppages_bulk&#xFF0C;&#x5176;&#x8FC7;&#x7A0B;&#x8DDF;&#x540E;&#x9762;&#x7684;__free_pages_ok&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;high, batch&#x7684;&#x521D;&#x59CB;&#x5316;&#x662F;&#x5728;setup_per_cpu_pageset-&gt;setup_zone_pageset(zone)-&gt;setup_pageset(pcp, zone_batchsize(zone)) -&gt;&#xA0;zone_batchsize(zone)&#x3002;&#x5176;&#x9009;&#x62E9;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x8BB2;&#x7A76;&#x7684;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x53C2;&#x8003;mm\page_alloc.c&#x3002;2.&#x6309;order&#x91CA;&#x653E;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6309;order&#x6765;&#x91CA;&#x653E;&#xFF0C;&#x53CD;&#x800C;&#x8FC7;&#x7A0B;&#x7B80;&#x5355;&#x6E05;&#x6670;&#x4E00;&#x4E9B;&#xFF0C;&#x53EA;&#x662F;&#x901A;&#x8FC7;&#x51E0;&#x4E2A;&#x5C0F;&#x6280;&#x5DE7;&#x627E;&#x5230;&#x672C;order&#x5757;&#x7684;buddy&#xFF0C;&#x4EE5;&#x53CA;&#x5408;&#x6210;&#x540E;&#x7684;combined index&#xFF0C;&#x4E4B;&#x540E;&#x53EA;&#x8981;&#x4E0D;&#x65AD;&#x7684;&#x5411;&#x4E0A;&#x5408;&#x5E76;&#x5230;&#x4E0D;&#x80FD;&#x5408;&#x5E76;&#x4E3A;&#x4E4B;&#xFF0C;&#x518D;set order&#xFF0C;&#x5C31;&#x5927;&#x529F;&#x544A;&#x6210;&#x3002;&#x52A0;&#x5165;&#x6CA1;&#x6709;buddy&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;set order&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x7528;__SetPageBuddy&#x6765;&#x8BBE;&#x7F6E;page&#x7ED3;&#x6784;&#x7684;flags&#x7684;&#x7B2C;19&#x4F4D;PG_buddy&#x4F4D;&#xFF0C;&#x8868;&#x793A;&#x672C;page&#x5DF2;&#x91CA;&#x653E;&#xFF0C;&#x5E76;&#x5728;buddy list&#x4E0A;&#x3002;&#x6700;&#x540E;&#x4E00;&#x70B9;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5C31;&#x662F;&#xFF0C;&#x5408;&#x6210;&#x597D;&#x540E;&#x7684;block&#x5982;&#x679C;&#x5C0F;&#x4E8E;MAX_ORDER&#x7684;&#xFF0C;&#x8FD8;&#x8981;&#x653E;&#x5728;zone-&gt;free_area[order].list&#x7684;&#x5C3E;&#x90E8;&#xFF0C;&#x4EE5;&#x4FBF;&#x5C3D;&#x91CF;&#x4E0D;&#x88AB;&#x5206;&#x914D;&#x51FA;&#x53BB;&#xFF0C;&#x6700;&#x597D;&#x80FD;&#x7EE7;&#x7EED;&#x88AB;&#x5408;&#x5E76;&#x6210;&#x5927;&#x5757;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x91CC;&#x503C;&#x5F97;&#x6B23;&#x8D4F;&#x7684;&#x662F;&#xFF0C;&#x600E;&#x4E48;&#x627E;&#x5230;buddy&#x548C;combined index&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x627E;&#x5230;buddy&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;page_idx ^ (1&lt;&lt;order)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x4ED4;&#x7EC6;&#x7B97;&#x7B97;&#x5427;&#xFF0C;&#x4ED6;&#x5C31;&#x662F;page_idx +/- (2^order)&#xFF0C;&#x82E5;page_idx&#x7684;order&#x4F4D;&#x4E3A;1&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x51CF;&#xFF0C;order&#x4F4D;&#x4E3A;0&#x76F8;&#x5F53;&#x4E8E;&#x52A0;&#x3002;&#x8FD9;&#x4E2A;&#x5F0F;&#x5B50;&#x592A;&#x4F18;&#x7F8E;&#x4E86;&#x3002;&#x8FD8;&#x6709;&#x600E;&#x4E48;&#x627E;&#x5230;parent index&#x5462;&#xFF1F;&#x540C;&#x6837;&#x5F88;&#x7B80;&#x6D01;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;combined_idx = page_idx &amp; (1&lt;&lt;order)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x503C;&#x5F97;&#x597D;&#x597D;&#x5B66;&#x4E60;&#x5B66;&#x4E60;&#x3002;]]></content>
  </entry>
  <entry>
    <title><![CDATA[Linux内存之页表]]></title>
    <url>%2F2012%2F11%2F23%2FLinux%E5%86%85%E5%AD%98%E4%B9%8B%E9%A1%B5%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[Linux&#x7684;&#x76F8;&#x5173;&#x9875;&#x8868;&#x7684;&#x6846;&#x67B6;&#x5728; vmalloc&#x5206;&#x6790;&#x4E2D;&#xFF0C;__vmalloc_area_node&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x4E0E;&#x5206;&#x914D;&#x9875;&#x8868;&#x9879;&#x4E24;&#x8282;&#x4E2D;&#x5DF2;&#x7ECF;&#x6709;&#x6240;&#x9610;&#x8FF0;&#x3002;&#x672C;&#x6587;&#x518D;&#x505A;&#x4E00;&#x4E9B;&#x603B;&#x4F53;&#x4E0A;&#x7684;&#x628A;&#x63E1;&#x3002;&#x6587;&#x4E2D;&#x4F1A;&#x501F;&#x7528;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x56FE;&#x3002;&#x6240;&#x8C13;&#x7684;&#x9875;&#x8868;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x3002;&#x9488;&#x5BF9;&#x73B0;&#x5728;&#x7684;64&#x4F4D;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;Linux&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x652F;&#x6301;4&#x7EA7;&#x9875;&#x8868;&#x64CD;&#x4F5C;&#xFF0C;&#x5373;pgd&#xFF0C;pud&#xFF0C;pmd&#x548C;pte&#x3002;&#x4F46;&#x76EE;&#x524D;&#x4E00;&#x822C;&#x5D4C;&#x5165;&#x5F0F;&#x7684;&#x5E94;&#x7528;&#x5E76;&#x4E0D;&#x4F1A;&#x4F7F;&#x80FD;&#x8BE5;&#x529F;&#x80FD;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6D89;&#x53CA;&#x5230;pud&#x548C;pmd&#x7684;&#x6307;&#x9488;&#xFF0C;&#x5B9E;&#x9645;&#x90FD;&#x662F;&#x6307;&#x5411;pgd&#x8868;&#x9879;&#x7684;&#x3002;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B;&#x8FD9;&#x5E45;&#x56FE;&#xA0; &#xA0; &#xA0;1. &#x6240;&#x6709;Linux&#x90FD;&#x662F;4G&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x6BCF;&#x4E2A;&#x8868;&#x9879;&#x4EE3;&#x8868;2MB&#x7A7A;&#x95F4;&#xFF0C;&#x5171;2K&#x8868;&#x9879;&#xFF0C;&#x5360;2&#x4E2A;page&#xA0; &#xA0; &#xA0;2. &#x6240;&#x6709;&#x7684;&#x5185;&#x5B58;&#x5728;&#x8868;&#x4E2D;&#x90FD;&#x662F;&#x6709;&#x5E8F;&#x7684;&#xFF0C;&#x5373;&#x7269;&#x7406;&#x5730;&#x5740;&#x5728;&#x8FD9;&#x4E2A;&#x7A7A;&#x95F4;&#x4E2D;&#x4E5F;&#x662F;&#x6709;&#x4F4E;&#x5230;&#x9AD8;&#x7684;&#xA0; &#xA0; &#xA0;2. &#x6BCF;&#x4E2A;pgd&#x8868;&#x9879;&#x6307;&#x5411;&#x4E00;&#x4E2A;page&#xFF0C;4KB&#xFF0C;&#x5206;&#x6210;4&#x4E2A;&#x5B50;&#x8868;&#x5982;&#x4E0A;&#x56FE;&#x3002;&#xA0; &#xA0; &#xA0;3. &#x4E0B;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x5B50;&#x8868;2KB&#xFF0C;&#x5305;&#x542B;512&#x4E2A;&#x8868;&#x9879;&#xFF0C;&#x6B63;&#x597D;2MB&#x7A7A;&#x95F4;&#xFF0C;&#x89C6;&#x4E3A;&#x4E00;&#x4E2A;pte&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4E2A;&#x8868;&#x9879;&#x6307;&#x5411;&#x4E00;&#x4E2A;page&#xA0; &#xA0; &#xA0;pgd&#x8868;&#x4FDD;&#x5B58;&#x5728;&#x8FDB;&#x7A0B;&#x7684;mm_struct&#x4E2D;&#xA0; &#xA0; &#xA0;struct mm_struct {&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;pgd_t * pgd;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0; &#xA0; &#xA0;}&#xA0; &#xA0; &#xA0;pte_alloc_map /&#xA0;pte_alloc_map_lock /&#xA0;pte_alloc_kernel&#x8FD9;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#x4E3A;pgd&#x7684;&#x6BCF;&#x4E2A;&#x8868;&#x9879;&#x5206;&#x914D;&#x4ED6;&#x6240;&#x6307;&#x5411;&#x7684;&#x90A3;&#x4E00;&#x9875;&#x6570;&#x636E;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;pte&#x3002;&#xA0; &#xA0; &#xA0;&#x56E0;&#x4E3A;&#x5185;&#x5B58;&#x4F1A;&#x4E0D;&#x65AD;&#x7684;&#x5206;&#x914D;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x6BCF;&#x6B21;&#x5206;&#x914D;&#x4E00;&#x4E2A;page&#x90FD;&#x4F1A;&#x65B0;&#x5EFA;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x5F20;&#x8868;&#x683C;&#xFF0C;&#x6240;&#x4EE5;Linux&#x4E3A;&#x6BCF;&#x4E2A;pgd&#x8868;&#x9879;&#xFF08;&#x4EE3;&#x7801;&#x4E2D;&#x4E3A;&#x4E86;&#x517C;&#x5BB9;&#xFF0C;&#x8FD8;&#x662F;&#x5C06;&#x4E4B;&#x79F0;&#x4E3A;pmd&#xFF09;&#x52A0;&#x5165;&#x4E86;&#x4E00;&#x4E9B;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x5E76;&#x5728;&#x6BCF;&#x6B21;&#x5206;&#x914D;&#x4E4B;&#x524D;&#xFF0C;&#x7528;&#x5B8F;pmd_present(*(pmd))&#x6765;&#x68C0;&#x9A8C;&#x6B64;pte&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5206;&#x914D;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5206;&#x914D;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x5206;&#x914D;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#x662F;&#x600E;&#x4E48;&#x5206;&#x914D;&#x7684;&#x5462;&#xFF1F;vmalloc&#x5206;&#x6790;&#x4E5F;&#x6709;&#x6240;&#x5206;&#x6790;&#x3002;&#x5373;&#x51FD;&#x6570;pmd_populate_kernel&#xFF0C;&#x5176;&#x5B9E;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#xFF0C;&#x4F8B;&#x5982;pmd_populate&#x3002;&#x4ED6;&#x4EEC;&#x8C03;&#x7528;&#x8FD9;&#x7684;&#x6700;&#x7EC8;&#x51FD;&#x6570;&#x90FD;&#x540C;&#x662F;__pmd_populate&#x3002;&#x5373;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;pmdp[0] = __pmd(pmdval) ; &#xA0;// =&#xA0;pmdval&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;pmdp[1] = __pmd(pmdval + 256 * sizeof(pte_t)); // = &#xA0;pmdval + 256 * sizeof(pte_t)&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;pmd_populate&#x662F;&#x5728;&#x4E3A;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x5730;&#x5740;&#x5EFA;&#x7ACB;&#x9875;&#x8868;&#xFF0C;&#x800C;pmd_populate_kernel&#x662F;&#x5728;&#x4E3A;&#x5185;&#x6838;&#x5730;&#x5740;&#x5EFA;&#x7ACB;&#x9875;&#x8868;&#x3002;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x522B;&#x4FBF;&#x6C34;&#x5230;&#x6E20;&#x6210;&#x4E86;&#xFF1A;&#xA0; &#xA0; &#xA0;1. &#x4E24;&#x8005;&#x4E3A;pmd&#x586B;&#x5145;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x4E00;&#x6837;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;pmd_populate_kernel&#xFF1A;__pa(pte_ptr) | _PAGE_KERNEL_TABLE&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;pmd_populate&#xFF1A;page_to_pfn(ptep) &lt;&lt; PAGE_SHIFT | _PAGE_USER_TABLE&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x53EF;&#x89C1;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x7269;&#x7406;&#x5730;&#x5740;+kernel&#x6807;&#x5FD7;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x5185;&#x6838;&#x903B;&#x8F91;&#x5730;&#x5740;+user&#x6807;&#x5FD7;&#xA0; &#xA0; &#xA0;2. &#x4E24;&#x8005;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x4E5F;&#x4E0D;&#x540C;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;pmd_populate_kernel&#x4F20;&#x5165;&#x7684;&#x662F;&#x5185;&#x6838;&#x903B;&#x8F91;&#x5730;&#x5740;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;pmd_populate&#x4F20;&#x5165;&#x7684;&#x5219;&#x662F;page&#x7ED3;&#x6784;&#x6307;&#x9488;&#xA0; &#xA0; &#xA0;&#x4E0D;&#x7BA1;&#x600E;&#x4E48;&#x6837;&#xFF0C;&#x5176;&#x5B9E;&#x4ED6;&#x4EEC;&#x7684;&#x5B9E;&#x8D28;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;pmd&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x662F;&#x8FD9;&#x4E00;&#x4E2A;page&#x8868;&#x683C;&#x6240;&#x5728;&#x7684;&#x5177;&#x4F53;&#x4F4D;&#x7F6E;&#xFF08;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF0C;&#x6216;&#x8005;&#x7269;&#x7406;&#x5730;&#x5740;&#x504F;&#x79FB;PAGE_SHIFT&#x7684;&#x5185;&#x6838;&#x903B;&#x8F91;&#x5730;&#x5740;&#xFF09;+&#x4E00;&#x4E2A;&#x6807;&#x5FD7;&#x5185;&#x6838;&#x8FDB;&#x7A0B;&#x8FD8;&#x662F;&#x7528;&#x6237;&#x8FDB;&#x7A0B; &#x7684;&#x6807;&#x5FD7;&#x4F4D;&#x3002;&#xA0; &#xA0; &#xA0;&#x81F3;&#x6B64;&#xFF0C;pte&#xFF08;&#x6216;&#x8005;pmd&#xFF09;&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x8BB2;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x90A3;&#x6709;&#x4E86;&#x8FD9;&#x9875;&#x8868;&#x683C;&#x540E;&#xFF0C;&#x5C31;&#x987A;&#x5229;&#x6210;&#x7AE0;&#x7684;&#x8BE5;&#x5F80;&#x91CC;&#x9762;&#x586B;pte&#x8868;&#x9879;&#x4E86;&#x3002;&#x9996;&#x5148;&#x7528;pte_offset_map / pte_offset_kernel&#x627E;&#x5230;&#x8868;&#x683C;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x8868;&#x9879;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x51FD;&#x6570;set_pte_at&#x771F;&#x6B63;&#x7684;&#x505A;&#x586B;&#x5145;&#x3002;set_pte_at&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;&#x5230;&#x4E00;&#x4E2A;&#x6C47;&#x7F16;&#x51FD;&#x6570;set_pte_ext&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8003;&#x8651;&#x9AD8;&#x7AEF;&#x5185;&#x5B58;&#x7684;&#x8BDD;&#xFF0C;pte_offset_map&#x548C;pte_offset_kernel&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x90FD;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;=&#xA0;pmd_page_vaddr(*(dir)) + __pte_index(addr)&#x524D;&#x534A;&#x90E8;&#x5206;&#x662F;pmd&#x7684;&#x903B;&#x8F91;&#x5730;&#x5740;&#xFF0C;&#x540E;&#x534A;&#x90E8;&#x5206;&#x662F;&#x672C;page&#x5728;pmd&#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x3002;=========================&#x5206;&#x5272;&#x7EBF;===================================&#xA0; &#xA0; &#xA0;&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x9875;&#x8868;&#x7684;&#x5EFA;&#x7ACB;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x4E9B;&#x4E8B;&#x60C5;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#x518D;&#x4E3E;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x662F;mmap&#x5B9E;&#x73B0;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;remap_pfn_range&#x3002;mmap&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#x628A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF08;&#x5305;&#x62EC;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x8981;&#x9A71;&#x52A8;&#x6765;&#x652F;&#x6301;&#xFF09;&#x6620;&#x5C04;&#x5230;&#x4E00;&#x6B3E;&#x5185;&#x5B58;&#x5730;&#x5740;&#x4E0A;&#xFF0C;&#x90A3;remap_pfn_range&#x5C31;&#x662F;&#x8981;&#x4E3A;&#x4E00;&#x6BB5;&#x7269;&#x7406;page&#x5EFA;&#x7ACB;&#x9875;&#x8868;&#x9879;&#x3002;&#x5148;&#x770B;&#x4ED6;&#x4EEC;&#x7684;&#x539F;&#x578B;&#xFF1A;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;mmap (caddr_t addr, size_t len, int prot, int flags, int fd, off_t offset)&#xA0; &#xA0; &#xA0;int remap_pfn_range(struct vm_area_struct *vma,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long virt_addr, unsigned long pfn,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long size, pgprot_t prot);&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#x4E0A;&#x9762;&#x7684;mmap&#x662F;Linux&#x7684;API&#xFF0C;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x666E;&#x901A;&#x6587;&#x4EF6;&#x548C;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x6BD4;&#x8F83;&#x6709;&#x666E;&#x904D;&#x6027;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x9A71;&#x52A8;&#x4E2D;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;mmap&#x7ECF;&#x5E38;&#x4F1A;&#x7528;&#x5230;&#x7684;remap_pfn_range&#x51FD;&#x6570;&#x3002;&#x7406;&#x4E00;&#x4E0B;&#x4ED6;&#x4EEC;&#x7684;&#x53C2;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;mmap&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;remap_pfn_range&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;addr&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &lt;=&gt; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; vma,&#xA0;&#xA0;&#xA0;virt_addrfd,offset,len&#xA0; &lt;=&gt; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;pfn,&#xA0;size&#xA0; &#xA0; &#xA0;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#xFF1A;&#xA0; &#xA0; &#xA0;1. &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;mmap&#x6765;&#x6620;&#x5C04;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;fd&#x4E2D;offset~offset+len&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x3002;&#xA0; &#xA0; &#xA0;2. &#x5185;&#x6838;&#x6309;&#x7167;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x6765;&#xFF0C;&#x5206;&#x914D;&#x4E00;&#x4E2A;vma_area_struct&#xFF0C;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;&#x8981;&#x5206;&#x914D;&#x7684;&#x5730;&#x5740;&#x6620;&#x5C04;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF08;fd, offset,len&#xFF09;&#x548C;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF08;addr&#xFF09;&#xFF0C;&#x6240;&#x4EE5;remap_pfn_range&#x7684;&#x53C2;&#x6570;virt_addr&#xFF0C;pfn&#xFF0C;size&#xFF0C;&#x90FD;&#x5728;vma&#x4E2D;&#x6709;&#x6240;&#x63CF;&#x8FF0;&#x4E86;&#x3002;&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x6211;&#x731C;&#x662F;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x6BD5;&#x7ADF;vma&#x53EF;&#x4EE5;&#x8D85;&#x8FC7;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6620;&#x5C04;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x6BD4;&#x5982;&#x5185;&#x6838;&#x5728;&#x5206;&#x914D;vma&#x65F6;&#x53D1;&#x73B0;&#x6709;&#x4E24;&#x4E2A;vma&#x53EF;&#x4EE5;&#x5408;&#x5E76;&#xFF0C;&#x5219;&#x4F20;&#x5165;&#x7684;vma&#x5C31;&#x5927;&#x4E8E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x7528;virt_addr&#xFF0C;pfn&#xFF0C;size&#x6765;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x6620;&#x5C04;&#x3002;&#xA0; &#xA0; &#xA0;remap_pfn_range&#x6700;&#x6838;&#x5FC3;&#x7684;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x4E3A;virt_addr~virt_addr+PAGE_ALIGN(size)&#x7684;&#x533A;&#x95F4;&#x5EFA;&#x7ACB;&#x9875;&#x8868;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;int remap_pfn_range(struct vm_area_struct *vma, unsigned long addr,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long pfn, unsigned long size, pgprot_t prot){&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;do {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; next = pgd_addr_end(addr, end);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; err = remap_pud_range(mm, pgd, addr, next,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; pfn + (addr &gt;&gt; PAGE_SHIFT), prot);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (err)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;&#xA0;&#xA0;&#xA0; } while (pgd++, addr = next, addr != end);&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;}&#xA0; &#xA0; &#xA0;remap_pud_range -&gt;&#xA0;remap_pmd_range -&gt;&#xA0;remap_pte_range&#xA0; &#xA0; &#xA0;&#x524D;&#x9762;&#x4E24;&#x4E2A;&#x662F;&#x865A;&#x7684;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5C31;&#x662F;&#x5EFA;&#x7ACB;&#x9875;&#x8868;&#x4E86;&#xA0; &#xA0; &#xA0;static int remap_pte_range(struct mm_struct *mm, pmd_t *pmd,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long addr, unsigned long end,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long pfn, pgprot_t prot){&#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0; pte = pte_alloc_map_lock(mm, pmd, addr, &amp;ptl);&#xA0; &#xA0; &#x2026;&#x2026;&#xA0;&#xA0;&#xA0; do {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set_pte_at(mm, addr, pte, pte_mkspecial(pfn_pte(pfn, prot)));&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; pfn++;&#xA0;&#xA0;&#xA0; } while (pte++, addr += PAGE_SIZE, addr != end);&#xA0; &#xA0; &#x2026;&#x2026;}&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;1. pmd&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;pgd&#x8868;&#x9879;&#x6307;&#x5411;&#x7684;&#x90A3;1&#x4E2A;page2. addr~end&#x662F;&#x8981;&#x5EFA;&#x7ACB;&#x9875;&#x8868;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;&#x8303;&#x56F4;3. pfn&#x662F;&#x8FD9;&#x5757;&#x865A;&#x62DF;&#x5730;&#x5740;&#x8303;&#x56F4;&#x9996;&#x5730;&#x5740;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x5E27;&#x53F7;4. prot&#x662F;&#x4E00;&#x4E9B;&#x6807;&#x5FD7;&#x4F4D;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[内存页的wait-wake机制]]></title>
    <url>%2F2012%2F11%2F13%2F%E5%86%85%E5%AD%98%E9%A1%B5%E7%9A%84wait-wake%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[&#x5173;&#x4E8E;&#x5185;&#x5B58;&#x4E5F;&#x5728;&#x5206;&#x914D;&#x65F6;&#x7684;&#x7B49;&#x5F85;&#x5524;&#x9192;&#x673A;&#x5236;&#xFF0C;include/linux/mmzone.h 389&#x884C;&#x7684;&#x6CE8;&#x91CA;&#x4E3A;&#x6211;&#x4EEC;&#x6307;&#x51FA;&#x4E86;&#x7528;&#x6237;&#x53EF;&#x7528; &#x7684;&#x6700;&#x57FA;&#x672C;&#x7684;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#x51FD;&#x6570;&#xFF0C;__wait_on_page_locked / &#xA0;unlock_page&#xFF0C;&#x5B9A;&#x4E49;&#x5728;mm/filemap.c&#x4E2D;&#x3002;&#x4F46;&#x7ECF;&#x8FC7;&#x68C0;&#x67E5;&#x53D1;&#x73B0;&#xFF0C;&#x771F;&#x6B63;&#x80FD;&#x63D0;&#x4F9B;&#x4F7F;&#x7528;&#x7684;&#x5176;&#x5B9E;&#x662F;wait_on_page_locked&#x51FD;&#x6570;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;__wait_on_page_locked&#xA0;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x5176;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x5728;&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;inline&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x88AB;&#x5305;&#x542B;&#x6B64;&#x5934;&#x6587;&#x4EF6;&#x7684;c&#x6587;&#x4EF6;&#x8C03;&#x7528;&#xFF0C;&#x5176;&#x5B9E;&#x73B0;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;wait_on_page_bit&#x51FD;&#x6570;&#x3002;* __wait_on_page_locked() and unlock_page() in mm/filemap.c, are the* primary users of these fields, and in mm/page_alloc.c* free_area_init_core() performs the initialization of them.wait_on_page_bit&#x7684;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E0D;&#x8FC7;&#x91CC;&#x9762;&#x6697;&#x85CF;&#x7384;&#x673A;&#x3002;&#xA0; &#xA0; &#xA0;1&#xFF09;DEFINE_WAIT_BIT&#x505A;&#x4E86;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x5B83;&#x662F;&#x6807;&#x51C6;&#x7684;Linux&#x7B49;&#x5F85;&#x673A;&#x5236;&#x4E2D;DEFINE_WAIT&#x7684;&#x53D8;&#x79CD;&#x3002;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x6807;&#x51C6;&#x7684;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;wait_queue_t&#x3002;&#x53E6;&#x5916;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;bit&#xFF0C;&#x901A;&#x8FC7;word&#x548C;bit_nr&#x6307;&#x5B9A;&#x3002;&#xA0; &#xA0; &#xA0;2&#xFF09;__wait_on_bit&#x901A;&#x8FC7;page_waitqueue&#x6765;&#x627E;&#x5230;&#x961F;&#x5217;&#x5934;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x5C31;&#x7275;&#x6D89;&#x5230;&#x54C8;&#x5E0C;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;linux&#x5185;&#x6838;&#x54C8;&#x5E0C;&#x67E5;&#x627E;&#xFF08;1&#xFF09;_zhe_wang-ChinaUnix&#x535A;&#x5BA2;&#xFF0C;&#x8FD9;&#x91CC;&#x7B80;&#x8981;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x54C8;&#x5E0C;&#x8868;&#x5171;&#x6709;&#x8868;&#x9879;size&#x4E2A;&#xFF0C;2^size &gt;= pages / PAGES_PER_WAITQUEUE = pages/256&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x7528;&#x6765;&#x8BA1;&#x7B97;&#x54C8;&#x5E0C;&#x503C;&#x7684;wait_table_bits&#xFF0C;&#x662F;size&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;1&#x4F4D;&#x7684;&#x7D22;&#x5F15;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x54C8;&#x5E0C;&#x503C;&#x7684;&#x8BA1;&#x7B97;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#xFF0C;&#x8BE5;&#x9875;&#x7684;page&#x7ED3;&#x6784;&#x6307;&#x9488;&#xFF08;&#x5728;mem_map&#x6570;&#x7EC4;&#x4E2D;&#xFF09;&#xFF0C;wait_table_bits&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x6240;&#x8C13;&#x7684;&#x54C8;&#x5E0C;&#x8BA1;&#x7B97;&#x5C31;&#x662F;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5DE7;&#x5999;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x751F;&#x6210;&#x67D0;&#x4E2A;&#x533A;&#x95F4;&#x5185;&#x7684;&#x968F;&#x673A;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x6563;&#x5217;&#x5230;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x54C8;&#x5E0C;&#x51B2;&#x7A81;&#xFF0C;&#x5219;&#x540C;&#x4E00;&#x4E2A;&#x8868;&#x9879;&#x91C7;&#x7528;&#x94FE;&#x8868;&#x7684;&#x5F62;&#x5F0F;&#x8868;&#x793A;&#x82E5;&#x5E72;&#x4E2A;&#x6210;&#x5458;&#x3002;&#x6240;&#x4EE5;&#x54C8;&#x5E0C;&#x503C;&#x53C8;&#x53EB;&#x6563;&#x5217;&#x503C;&#x3002;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x91CC;&#x7684;&#x54C8;&#x5E0C;&#x8BA1;&#x7B97;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;(val * GOLDEN_RATIO_PRIME_32) &#xA0;&gt;&gt;(32 - bits)&#xFF0C;GOLDEN_RATIO_PRIME_32&#x662F;&#x4E2A;&#x5F88;&#x7279;&#x522B;&#x7684;&#x503C;&#xFF0C;&#x7ECF;&#x8FC7;&#x7814;&#x7A76;&#xFF0C;&#x56FA;&#x5B9A;&#x4E0B;&#x6765;&#x7684;&#xFF0C;&#x7528;&#x5B83;&#x4E58;&#x8FC7;&#x4E4B;&#x540E;&#xFF0C;&#x6EA2;&#x51FA;&#x540E;&#x5269;&#x4E0B;&#x6765;&#x7684;&#x503C;&#xFF0C;&#x968F;&#x673A;&#x6027;&#x6BD4;&#x8F83;&#x5927;&#x3002;&#x56E0;&#x4E3A;bits&#x662F;size&#x7684;&#x7B2C;&#x4E00;&#x4E2A;1&#xFF0C;&#x6240;&#x4EE5;&#x53F3;&#x79FB;&#x540E;&#x7684;&#x503C;&#x4E00;&#x5B9A;&lt;size&#xFF0C;&#x6B63;&#x597D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x8981;&#x6C42;&#x3002;&#xA0; &#xA0; &#xA0;3&#xFF09;&#x5728;__wait_on_bit&#x4E2D;&#x4F1A;&#x4E0D;&#x65AD;&#x6D4B;&#x8BD5;page-&gt;flags&#x7684;PageLocked&#x4F4D;&#xFF0C;&#x5373;&#x7B2C;0&#x4F4D;&#x3002;&#x7136;&#x540E;&#x4F1A;&#x5728;&#x771F;&#x6B63;&#x8981;&#x4F11;&#x7720;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528;&#x4F20;&#x5165;&#x7684;sync_page&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x7275;&#x6D89;&#x5F88;&#x5E7F;&#xFF0C;&#x548C;address_space&#x7ED3;&#x6784;&#x6709;&#x5173;&#x3002;&#xA0; &#xA0; &#xA0;4&#xFF09;&#x5728;&#x505A;&#x5B8C;&#x4E00;&#x7CFB;&#x5217;&#x7684;sync&#x4E4B;&#x540E;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;io_schedule&#xFF0C;&#x8BA9;&#x51FA;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x8FDB;&#x884C;&#x7B49;&#x5F85;&#x3002;unlock_page&#x4E00;&#x6837;&#x901A;&#x8FC7;page&#x7ED3;&#x6784;&#x6307;&#x9488;&#x548C;PageLocked&#x4F4D;&#xFF0C;&#x627E;&#x5230;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x7684;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x3002;&#x4F46;&#x4E00;&#x4E2A;&#x54C8;&#x5E0C;&#x8868;&#x9879;&#x53EF;&#x4EE5;&#x6709;256&#x4E2A;page&#x7B49;&#x5728;&#x5176;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x786E;&#x5B9A;&#x662F;&#x600E;&#x4E48;&#x5524;&#x9192;&#x60F3;&#x8981;&#x7684;&#x90A3;&#x4E2A;page&#x7684;&#x3002;&#x53EF;&#x80FD;&#x548C;wait-&gt;func=wake_bit_function&#x6709;&#x5173;&#x3002;&#x7275;&#x626F;&#x5230;wait queue&#x673A;&#x5236;&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[find_next_zero_bit]]></title>
    <url>%2F2012%2F11%2F12%2Ffind_next_zero_bit%2F</url>
    <content type="text"><![CDATA[unsigned long find_next_zero_bit(const unsigned long *addr,&#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned long size,&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;unsigned long offset)&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x7528;&#x610F;&#x662F;&#x5728;addr&#x5F00;&#x59CB;&#x7684;&#x5730;&#x5740;&#x6BB5;&#x4E2D;&#xFF0C;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x4E3A;0&#x7684;&#x4F4D;&#xFF0C;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;&#x8BE5;&#x4F4D;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x627E;&#x5230;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;size&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x641C;&#x7D22;&#x8303;&#x56F4;&#x5E76;&#x4E0D;&#x5305;&#x542B;size&#x8FD9;&#x4E2A;&#x70B9;&#xFF0C;&#x56E0;&#x4E3A;&#x5373;&#x4FBF;size&#x8FD9;&#x4E2A;&#x70B9;&#x4E3A;0&#xFF0C;&#x6EE1;&#x8DB3;&#x8981;&#x6C42;&#xFF0C;&#x4F46;&#x5176;&#x8FD4;&#x56DE;&#x503C;&#x548C;&#x5931;&#x8D25;&#x65F6;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x770B;&#x4F5C;&#x662F;&#x5931;&#x8D25;&#x3002;&#x641C;&#x7D22;&#x793A;&#x610F;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;&#x518D;&#x5206;&#x6790;&#x4EE3;&#x7801;&#xFF1A;unsigned long find_next_zero_bit(const unsigned long *addr, unsigned long size,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; unsigned long offset){&#xA0;&#xA0;&#xA0; const unsigned long *p = addr + BITOP_WORD(offset);&#xA0;&#xA0;&#xA0; unsigned long result = offset &amp; ~(BITS_PER_LONG-1); // result&#x5982;&#x4E0A;&#x56FE;&#xFF0C;&#x641C;&#x7D22;&#x8D77;&#x59CB;&#x70B9;&#x6240;&#x5728;ULONG&#x4E4B;&#x524D;&#x6240;&#x6709;&#x7684;bit&#xA0;&#xA0;&#xA0; unsigned long tmp;&#xA0;&#xA0;&#xA0; if (offset &gt;= size)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return size;&#xA0;&#xA0;&#xA0; size -= result; // &#x6263;&#x6389;result&#xFF0C;&#x5373;size_new&#xA0;&#xA0;&#xA0; offset %= BITS_PER_LONG; // &#x53D6;&#x5F97;&#x6240;&#x5728;ULONG&#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;&#xFF0C;&#x5373;offset_new&#xA0;&#xA0;&#xA0; if (offset) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tmp = *(p++);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tmp |= ~0UL &gt;&gt; (BITS_PER_LONG - offset); // &#x5C06;offset&#x4E4B;&#x5185;&#x7684;bit&#x5168;&#x90E8;&#x7F6E;1&#xFF0C;&#x53C2;&#x770B;&#x56FE;1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (size &lt; BITS_PER_LONG) // &#x8FD9;&#x8868;&#x793A;&#x641C;&#x7D22;&#x8303;&#x56F4;&#x5728;&#x4E00;&#x4E2A;ULONG&#x8303;&#x56F4;&#x4E4B;&#x5185;&#xFF0C;&#x53C2;&#x770B;&#x56FE;2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto found_first;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (~tmp) // tmp&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;0&#x4F4D;&#xFF0C;&#x5373;tmp&#x7684;BPL - offset&#x8FD9;&#x4E00;&#x6BB5;&#x4E2D;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;0&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto found_middle;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; size -= BITS_PER_LONG;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; result += BITS_PER_LONG;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0; while (size &amp; ~(BITS_PER_LONG-1)) { // &#x4E0D;&#x65AD;&#x904D;&#x5386;size&#x524D;&#x7684;ULONG&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (~(tmp = *(p++)))&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto found_middle;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; result += BITS_PER_LONG;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; size -= BITS_PER_LONG;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0; if (!size) // &#x5F53;size&#x6B63;&#x597D;&#x662F;&#x6574;&#x6570;&#x4E2A;ULONG&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x627E;&#x7740;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x662F;&#x539F;&#x59CB;&#x7684;size&#xFF0C;&#x82E5;&#x4E0D;&#x662F;&#xFF0C;&#x4F1A;&#x4F9D;&#x6B21;&#x8FDB;found_first&#xFF0C;&#x7136;&#x540E;found_middle&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return result;&#xA0;&#xA0;&#xA0; tmp = *p;found_first:&#xA0;&#xA0;&#xA0; tmp |= ~0UL &lt;&lt; size; // &#x5C06;size&#x4EE5;&#x4E0A;&#x90E8;&#x5206;&#x5168;&#x90E8;&#x7F6E;1&#xA0;&#xA0;&#xA0; if (tmp == ~0UL)&#xA0;&#xA0;&#xA0; //&#xA0;offset~size&#x6216;head~size&#x4E4B;&#x95F4;&#x6CA1;&#x6709;0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return result + size;&#xA0;&#xA0; // &#x8FD4;&#x56DE;&#x503C;&#x5373;&#x4E3A;&#x4F20;&#x5165;&#x7684;sizefound_middle:&#xA0;&#xA0;&#xA0; return result + ffz(tmp); //&#xA0;ffz&#x5C31;&#x662F;&#x5BFB;&#x627E;unsigned long&#x53D8;&#x91CF;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;0&#x4F4D;&#x7D22;&#x5F15;&#x7684;&#x5B8F;}]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bootmem工作原理]]></title>
    <url>%2F2012%2F11%2F06%2Fbootmem%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (test_bit(i, bdata-&gt;node_bootmem_map)) { // &#x5982;&#x679C;&#x8FDE;&#x7EED;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x91CD;&#x65B0;&#x641C;&#x7D22;&#x672A;&#x5206;&#x914D;&#x533A;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sidx = align_idx(bdata, i, step);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (sidx == i)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sidx += step;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto find_block;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (bdata-&gt;last_end_off &amp; (PAGE_SIZE - 1) &amp;&amp; // &#x4E0A;&#x4E00;&#x6B21;&#x5206;&#x914D;&#x7684;&#x7A7A;&#x95F4;&#x672B;&#x5730;&#x5740;&#x5728;&#x9875;&#x8FB9;&#x754C;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PFN_DOWN(bdata-&gt;last_end_off) + 1 == sidx) &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start_off = align_off(bdata, bdata-&gt;last_end_off, align); // align = 64&#xFF0C;&#x5C06;start_off&#x63D0;&#x5347;&#x5230;last_end_off&#x9644;&#x8FD1;&#xFF0C;&#x8981;&#x6309;align&#x5411;&#x4E0B;&#x5BF9;&#x9F50;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else1.&#x521D;&#x59CB;&#x5316;1)arm_bootmem_init&#xA0; &#xA0; &#xA0;&#x6709;&#x4E00;&#x70B9;&#xFF0C;&#x5148;&#x7406;&#x6E05;&#x695A;&#xFF0C;Linux&#x652F;&#x6301;NUMA&#x67B6;&#x6784;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF0C;&#x4F46;NUMA&#x4E00;&#x822C;&#x5E94;&#x7528;&#x4E8E;&#x4E2D;&#x5927;&#x578B;&#x7CFB;&#x7EDF;&#xFF0C;&#x6765;&#x7075;&#x6D3B;&#x5904;&#x7406;&#x672C;&#x5730;&#x5185;&#x5B58;&#x4E0E;&#x8FDC;&#x7AEF;&#x5185;&#x5B58;&#xFF0C;&#x4EE5;&#x63D0;&#x9AD8;&#x5E73;&#x5747;&#x5185;&#x5B58;&#x8BFB;&#x5199;&#x901F;&#x5EA6;&#xFF0C;&#x5373;&#x4F18;&#x5148;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x5185;&#x5B58;&#x6216;&#x8005;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x8F83;&#x5FEB;&#x7684;&#x5185;&#x5B58;&#x3002;&#x4F46;&#x5D4C;&#x5165;&#x5F0F;&#x8BBE;&#x5907;&#x6216;&#x8005;&#x6211;&#x4EEC;&#x7684;D7800&#x5E76;&#x6CA1;&#x6709;&#x4F7F;&#x7528;Linux&#x7684;NUMA&#x67B6;&#x6784;&#x6765;&#x7BA1;&#x7406;&#x5185;&#x5B58;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x53EA;&#x6709;node 0&#xFF0C;&#x5373;&#x5176;&#x4E0A;&#x53EA;&#x6709;&#x672C;&#x5730;&#x5185;&#x5B58;&#x3002;&#xA0; &#xA0; &#xA0;&#x4E0A;&#x56FE;&#x4E2D;bdata_list&#x5728;NUMA&#x67B6;&#x6784;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;node&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#xFF0C;&#x4F46;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x8BE5;list&#x4E0A;&#x53EA;&#x6709;node 0&#x7684;&#xFF1A;min~max_low&#x4F4E;&#x7AEF;&#x5185;&#x5B58;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x3002;&#x518D;&#x770B;memblock&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x8003;memblock&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x5176;&#x4E2D;memblock.memory&#x8868;&#x683C;&#x4E2D;&#xFF0C;&#x5305;&#x542B;&#x4E86;meminfo&#x4E2D;&#x6240;&#x6709;bank&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x533A;&#x95F4;&#x3002;&#x5BF9;&#x5E94;&#x5230;&#x4E00;&#x5F20;&#x56FE;&#x4E0A;&#xFF0C;&#x5C31;&#x5982;&#x4E0A;&#x56FE;&#x5DE6;&#x534A;&#x90E8;&#x5206;&#x7684;&#x793A;&#x610F;&#x56FE;&#x6240;&#x793A;&#xFF0C;bdata_list&#x4E0A;node 0&#x7684;min~max_low&#x533A;&#x6BB5;&#x4E0A;&#xFF0C;&#x6709;&#x7740;nrbanks&#x4E2A;region_start~region_end&#x5185;&#x5B58;&#x533A;&#x95F4;&#x3002;&#xA0; &#xA0; &#xA0;&#x4E8E;&#x662F;&#xFF0C;&#x5BF9;&#x5E94;&#x5230;&#x4EE3;&#x7801;&#x91CC;&#x5C31;&#x5F88;&#x597D;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x5728;&#x51FD;&#x6570;mark_bootmem&#x4E2D;&#xFF0C;&#x904D;&#x5386;bdata_list&#x5217;&#x8868;&#xFF0C;&#x5224;&#x65AD;&#x533A;&#x6BB5;&#x662F;&#x5426;&#x7B26;&#x5408;&#x7684;&#x6761;&#x4EF6;&#x5982;&#x4E0B;&#x3002;&#xA0; &#xA0; &#xA0;if (pos &lt; bdata-&gt;node_min_pfn ||&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; pos &gt;= bdata-&gt;node_low_pfn) { // &#x8868;&#x793A;&#x8D85;&#x8FC7;&#x4E86;&#x6B64;node&#x5BF9;&#x5E94;&#x7684;&#x533A;&#x6BB5;&#xFF0C;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; BUG_ON(pos != start);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; continue;&#xA0; &#xA0; &#xA0;}&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (max == end) // end&#x4F1A;&#x4E0D;&#x4F1A;&#x8D85;&#x8FC7;max_low&#xFF0C;&#x5373;end&#x662F;&#x9AD8;&#x7AEF;&#x5730;&#x5740;&#xFF1F;&#x6211;&#x7684;&#x7406;&#x89E3;&#xFF0C;end&#x53EF;&#x4EE5;&#x8D85;&#x8FC7;low mem&#x7684;&#x9650;&#x5236;&#xFF0C;&#x4E0D;&#x8FC7;&#x5728;bootmem&#x4E2D;&#x6211;&#x4EEC;&#x53EA;&#x8003;&#x8651;low mem&#x7684;&#x90E8;&#x5206;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return 0;&#xA0; &#xA0; &#xA0;pos = bdata-&gt;node_low_pfn; // &#x8FD0;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x8868;&#x793A;start~end&#x7684;region&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x8FC7;&#x4E86;&#xFF0C;&#x53EA;&#x662F;max!=end&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x7A7A;&#x8DD1;&#x5B8C;&#x5269;&#x4E0B;&#x7684;&#x5FAA;&#x73AF;&#xA0; &#xA0; &#xA0;&#x603B;&#x4F53;&#x6765;&#x8BF4;&#x6240;&#x8C13;&#x7684;bootmem&#xFF0C;&#x5373;&#x662F;&#x4E3A;meminfo&#x4E2D;&#x6240;&#x6709;nrbanks&#x5185;&#x5B58;&#x7684;min~maxlow&#xFF0C;&#x6765;&#x5206;&#x914D;&#x4E00;&#x5F20;bitmap&#xFF0C;&#x6BCF;&#x4E00;&#x4F4D;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;page&#x662F;&#x5426;&#x5206;&#x914D;&#x3002;&#x4ED6;&#x548C;memblock&#x4E24;&#x5957;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5236;&#x3002;bootmem&#x7684;bitmap&#x88AB;memblock&#x7BA1;&#x7406;&#xFF0C;memblock&#x53D8;&#x91CF;&#xFF0C;&#x4EE5;&#x53CA;memblock&#x7684;&#x4E24;&#x5F20;&#x8868;&#x683C;memblock_memory_init_regions&#x548C;memblock_reserved_init_regions&#xFF0C;&#x90FD;&#x662F;&#x5B58;&#x5728;.init.data section&#x4E2D;&#xFF0C;&#x5373;&#x5728;kernel image&#x91CC;&#x3002;2)arm_bootmem_free&#x5176;&#x4E2D;&#x672C;node&#x5185;&#x5B58;&#x6307;&#x6807;&#x793A;&#x610F;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;alloc_node_mem_map&#x5728;&#x540E;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x8BA8;&#x8BBA;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x8865;&#x5145;&#x4E00;&#x4E0B;&#xFF0C;pgdat&#x4E00;&#x822C;&#x6307;&#x5411;NODE_DATA(i)&#xFF0C;&#x5373;node_data[i]&#x6210;&#x5458;&#x3002;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x53EA;&#x8003;&#x8651;node 0&#xFF0C;&#x6240;&#x4EE5;pgdat&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x770B;&#x6210;&#x662F;&#x6307;&#x5411;node 0&#x7684;&#x6570;&#x636E;&#x3002;&#x5728;init_bootmem_node&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x8BE5;node&#x7684;bootmem&#x90E8;&#x5206;&#x52A0;&#x4EE5;&#x521D;&#x59CB;&#x5316;&#x3002;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x5728;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x521D;&#x59CB;&#x5316;&#x3002;3)free_area_init_core&#xA0; &#xA0; &#xA0;a) &#x6BCF;&#x4E2A;zone&#x7684;page&#x6309;&#x7167;page block&#x7EC4;&#x7EC7;&#xFF0C;&#x6BCF;&#x4E2A;page block&#x5305;&#x542B;MAX_ORDER-1 = 10&#xFF0C;&#x5373;1024&#x9875;&#xA0; &#xA0; &#xA0;b) &#x4EE3;&#x7801;&#x4E2D;&#x51E0;&#x4E2A;&#x6307;&#x6807;&#x5907;&#x6CE8;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;size: &#x7B2C;j&#x4E2A;zone&#x7684;total_size&#xFF0C;&#x5355;&#x4F4D;page&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;memmap_pages: &#x672C;zone&#x7684;memmap&#x6570;&#x7EC4;&#x9700;&#x8981;&#x7684;page&#x6570;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;realsize: totalsize - zhole_size[j] -&#xA0;memmap_pages -&#xA0;dma_reserve(&#x5982;&#x679C;&#x662F;zone[0])&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;nr_kernel_pages += realsize; // &#x5982;&#x679C;&#x662F;HIGHMEM zone&#xFF0C;&#x66F4;&#x65B0;nr_kernel_pages&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;nr_all_pages += realsize;&#xA0; &#xA0; &#xA0;c)&#xA0;init_currently_empty_zone,&#xA0;memmap_init&#x5728;&#x540E;&#x9762;&#x7AE0;&#x8282;&#x8BA8;&#x8BBA;4)&#xA0;memmap_initmemmap&#x6570;&#x7EC4;&#x5728;arm_bootmem_free-&gt;free_area_init_node&#x4E2D;&#x901A;&#x8FC7;alloc_node_mem_map-&gt; alloc_bootmem_node&#x6765;&#x5206;&#x914D;&#x4E00;&#x6BB5;bootmem&#x5185;&#x5B58;&#xFF0C;&#x5E76;&#x8D4B;&#x7ED9;pgdat-&gt;node_mem_map&#x3002;memmap_init&#x51FD;&#x6570;&#x8D1F;&#x8D23;&#x521D;&#x59CB;&#x5316;&#x8FD9;&#x5757;&#x533A;&#x57DF;&#xFF08;&#x6570;&#x7EC4;&#xFF09;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x3002;&#xA0; &#xA0; &#xA0;a)&#x5173;&#x4E8E;SetPageReserved&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4E0D;&#x77E5;&#x4F55;&#x7528;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x5185;&#x6838;&#x4E2D;&#x7533;&#x8BF7;&#x5230;&#x9875;&#x9762;&#x4E4B;&#x540E;&#xFF0C;&#x8981;&#x8C03;&#x7528;&#x4E00;&#x4E0B;SetPageReserved&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x544A;&#x8BC9;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x6211;&#x5DF2;&#x7ECF;&#x5360;&#x4E86;&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x7533;&#x8BF7;&#x5230;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x5E94;&#x8BE5;&#x90FD;&#x8981;&#x8FD9;&#x6837;&#x505A;&#x3002;&#xA0; &#xA0; &#xA0;b)&#x4E3A;&#x6BCF;&#x4E2A;&#x9875;&#x9762;&#x8BBE;&#x7F6E;miagrate type&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5916;&#x90E8;&#x788E;&#x7247;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x673A;&#x5236;&#x4E5F;&#x7565;&#x6709;&#x4E9B;&#x590D;&#x6742;&#xA0; &#xA0; &#xA0;c)lru list&#x662F;&#x4E3A;&#x4E86;&#x56DE;&#x6536;&#x673A;&#x5236;&#x8BBE;&#x8BA1;&#x7684;&#xFF0C;&#x5168;&#x79F0;&#x662F;Least Recently Used&#xA0; &#xA0; &#xA0;d)&#x5173;&#x4E8E;struct page&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;Mel Gorman&#x7684;&#x300A;Understanding the Linux&#xAE;&#xA0;Virtual Memory Manager&#x300B;&#x7684;P41&#xFF1A;Pages&#x4E00;&#x8282;&#x3002;5)&#xA0;alloc_bootmem_node&#xA0; &#xA0; &#xA0;alloc_bootmem_node -&gt;&#xA0;__alloc_bootmem_node -&gt;&#xA0;___alloc_bootmem_node -&gt;&#xA0;alloc_arch_preferred_bootmem / alloc_bootmem_core / ___alloc_bootmem&#xA0; &#xA0; &#xA0;&#x6700;&#x540E;&#x843D;&#x5B9E;&#x5230;&#x4E09;&#x4E2A;&#x51FD;&#x6570;alloc_arch_preferred_bootmem / alloc_bootmem_core / ___alloc_bootmem&#x3002;&#xA0; &#xA0; &#xA0;alloc_arch_preferred_bootmem&#xA0;&#x548C;___alloc_bootmem&#x5728;&#x672A;&#x5B9A;&#x4E49;CONFIG_NO_BOOTMEM&#x65F6;&#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x90FD;&#x662F;alloc_bootmem_core&#xA0;&#x3002;&#x6240;&#x4EE5;alloc_bootmem_core&#xA0;&#x662F;&#x6838;&#x5FC3;&#x51FD;&#x6570;&#x3002;&#xA0; &#xA0; &#xA0;&#x90A3;&#x4E48;&#x6765;&#x770B;alloc_bootmem_core&#x3002;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x5176;&#x4E2D;&#x6709;&#x5F88;&#x591A;&#x4E2A;&#x6307;&#x6807;&#xFF0C;&#x5927;&#x4F53;&#x603B;&#x7ED3;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;sidx / midx:&#xA0;start - bdata-&gt;node_min_pfn /&#xA0;max - bdata-&gt;node_min_pfn // &#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x4E5F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x5927;&#x4F53;&#x4E0A;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x672C;node&#x4F4E;&#x7AEF;&#x5185;&#x5B58;&#x7684;&#x9996;&#x672B;&#x5730;&#x5740;&#x9875;&#x7D22;&#x5F15;&#x3002;&#xA0; &#xA0; &#xA0;eidx: sidx + PFN_UP(size) // &#x9700;&#x8981;&#x5206;&#x914D;&#x7A7A;&#x95F4;&#x672B;&#x5730;&#x5740;&#x6309;&#x9875;&#x5411;&#x4E0B;&#xFF08;&#x589E;&#x957F;&#x65B9;&#x5411;&#xFF09;&#x5BF9;&#x9F50;&#x540E;&#x7684;&#x9875;&#x7D22;&#x5F15;&#xA0; &#xA0; &#xA0;start_off / end_off: &#x5206;&#x914D;&#x7A7A;&#x95F4;&#x59CB;&#x672B;&#x5730;&#x5740;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#xA0; &#xA0; &#xA0;merge:&#xA0;PFN_DOWN(start_off) &lt; sidx // &#x6B64;&#x65F6;start_off&#x662F;&#x7ECF;&#x8FC7;&#x5904;&#x7406;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x524D;&#x6B21;&#x5206;&#x914D;&#x7684;&#x672B;&#x5730;&#x5740;&#xFF08;last_end_off&#xFF09;&#x6240;&#x5728;&#x9875;&#x8FD8;&#x6709;&#x7A7A;&#x95F2;&#xFF0C;&#x5219;&#x5C06;start_off&#x5411;&#x4E0A;&#x63D0;&#x5347;&#x5230;&#x8BE5;&#x9875;&#xFF0C;&#x5E76;&#x4E0E;last_end_off&#x9694;&#x5F00;&#x4E00;&#x5B9A;&#x7684;&#x8DDD;&#x79BB;&#xA0; &#xA0; &#xA0;bdata-&gt;last_end_off: &#x8BB0;&#x5F55;&#x4E0A;&#x4E00;&#x6B21;&#x5206;&#x914D;&#x672B;&#x5730;&#x5740;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF0C;&#x5E76;&#x4E0D;&#x6309;&#x9875;&#x5BF9;&#x9F50;&#xFF0C;&#x6B64;&#x53D8;&#x91CF;&#x53EA;&#x5728;alloc_bootmem_core&#x4E2D;&#x66F4;&#x65B0;&#xA0; &#xA0; &#xA0;bdata-&gt;hint_idx: &#x5728;alloc_bootmem_core&#x4E2D;= PFN_UP(end_off)&#xFF0C;&#x5728;__free&#x7684;&#x65F6;&#x5019;= sidx&#xFF0C;&#x8BB0;&#x5F55;&#x7684;&#x662F;&#x53EF;&#x5206;&#x914D;&#x5730;&#x5740;&#x7684;&#x6700;&#x5C0F;&#x503C;&#x7684;&#x9875;&#x7D22;&#x5F15;&#xA0; &#xA0; &#xA0;&#x4E86;&#x89E3;&#x8FD9;&#x4E9B;&#x6307;&#x6807;&#x4E4B;&#x540E;&#xFF0C;&#x5BF9;code&#x5C31;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x6458;&#x5F55;&#x5982;&#x4E0B;&#xA0; &#xA0; &#xA0;static void * __init alloc_bootmem_core (&#x2026;&#x2026;) {&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0; &#xA0; &#xA0;find_block:&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;sidx = find_next_zero_bit(bdata-&gt;node_bootmem_map, midx, sidx); //&#xA0;find_next_zero_bit&#x53C2;&#x8003;&#x53E6;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;find_next_zero_bit&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sidx = align_idx(bdata, sidx, step);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; eidx = sidx + PFN_UP(size);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (sidx &gt;= midx || eidx &gt; midx) // sidx &gt; midx&#x548C;eidx &gt; midx&#x6BD4;&#x8F83;&#x597D;&#x7406;&#x89E3;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; break; //&#xA0;sidx = midx&#x7684;&#x60C5;&#x51B5;&#x6307;&#x7684;&#x662F;find_next_zero_bit&#x8FD4;&#x56DE;&#x7684;&#x662F;midx&#xFF0C;&#x6839;&#x636E;find_next_zero_bit&#x8FD9;&#x7BC7;&#x7B14;&#x8BB0;&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x662F;find_next_zero_bit&#x5931;&#x8D25;&#xFF0C;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x672A;&#x5206;&#x914D;&#x9875;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for (i = sidx; i &lt; eidx; i++)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start_off = PFN_PHYS(sidx);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;merge = PFN_DOWN(start_off) &lt; sidx; // &#x8868;&#x793A;&#x672C;&#x6B21;&#x5206;&#x914D;&#x4E0E;&#x4E0A;&#x6B21;&#x5206;&#x914D;&#x6709;&#x4EA4;&#x53E0;&#xFF0C;&#x53C2;&#x770B;&#x56FE;1&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0; &#xA0; &#xA0; &#xA0; /*&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * Reserve the area now:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; */&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (__reserve(bdata, PFN_DOWN(start_off) + merge, // merge =0: &#x6CA1;&#x6709;&#x4EA4;&#x53E0;&#xFF0C;&#x6B63;&#x5E38;&#x5206;&#x914D;&#xFF0C;merge =1&#xFF1A;&#x548C;&#x4E0A;&#x6B21;&#x6709;&#x4EA4;&#x53E0;&#xFF0C;&#x4F46;&#x6709;&#x4EA4;&#x53E0;&#x7684;&#x9875;&#x5DF2;&#x7ECF;reserve&#x8FC7;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4ECE;&#x4E0B;&#x4E00;&#x9875;&#x5F00;&#x59CB;reserve&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; PFN_UP(end_off), BOOTMEM_EXCLUSIVE))&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;}&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;&#xA0; &#xA0; &#xA0;alloc_bootmem_core&#x4E2D;&#x8FD8;&#x6709;&#x4E2A;fall_back&#x673A;&#x5236;&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;&#xFF1A;&#xA0; &#xA0; &#xA0;static void * __init alloc_bootmem_core (&#x2026;&#x2026;) {&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x2026;&#x2026;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (bdata-&gt;hint_idx &gt; sidx) { //&#xA0;hint_idx&#x662F;&#x53EF;&#x5206;&#x914D;&#x7A7A;&#x95F4;&#x7684;&#x6700;&#x5C0F;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x6761;&#x4EF6;&#x8868;&#x793A;&#x641C;&#x7D22;&#x8D77;&#x59CB;&#x70B9;&#x53EF;&#x4EE5;&#x5411;&#x524D;&#x63D0;&#x5347;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /*&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * Handle the valid case of sidx being zero and still&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; * catch the fallback below.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; */&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; fallback = sidx + 1; // &#x8BB0;&#x5F55;fall_back&#x503C;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sidx = align_idx(bdata, bdata-&gt;hint_idx, step); // &#x5C06;sidx&#x63D0;&#x5347;&#x5230;hint_idx&#x9644;&#x8FD1;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}&#xA0; &#xA0; &#xA0;while(1) {find_block:&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x2026;&#x2026;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (fallback) { // &#x5982;&#x679C;&#x641C;&#x7D22;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x5C06;sidx&#x8FD8;&#x539F;&#x518D;&#x91CD;&#x65B0;&#x641C;&#x7D22;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sidx = align_idx(bdata, fallback - 1, step);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; fallback = 0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto find_block;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}&#xA0; &#xA0; &#xA0;return NULL;&#xA0; &#xA0; &#xA0;}6) init_currently_empty_zone&#x672C;&#x51FD;&#x6570;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x521D;&#x59CB;&#x5316;zone&#x7ED3;&#x6784;&#xFF0C;&#x66F4;&#x660E;&#x786E;&#x7684;&#x5C31;&#x662F;&#xFF1A;&#xFF08;1&#xFF09;wait queue table&#x521D;&#x59CB;&#x5316;&#xFF0C;&#xFF08;2&#xFF09;free_area&#x521D;&#x59CB;&#x5316;&#x8C03;&#x7528;&#x987A;&#x5E8F;&#x5982;&#x4E0B;zone_wait_table_init -&gt;&#xA0;zone_init_free_lists(zone)&#xA0; &#xA0; &#xA0;a)&#xA0;zone_wait_table_init&#xA0;&#xA0; &#xA0; &#xA0;&#x6B64;&#x51FD;&#x6570;&#x521D;&#x59CB;&#x5316;&#x4E86;zone-&gt;wait_table&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x5F20;&#x54C8;&#x5E0C;&#x8868;&#xFF0C;&#x6709;zone-&gt;wait_table_hash_nr_entries&#x4E2A;&#x8868;&#x9879;&#xFF08;&#x6700;&#x5C11;4&#xFF0C;&#x6700;&#x591A;4096&#xFF09;&#x3002;wait_table&#x76F8;&#x5173;&#x5185;&#x5BB9;&#x53EF;&#x53C2;&#x8003;&#x53EF;&#x4EE5;&#x53C2;&#x8003;Mel Gorman&#x7684;&#x300A;Understanding the Linux&#xAE;&#xA0;Virtual Memory Manager&#x300B;P40&#xFF1A;Zone Wait Queue Table&#x4E00;&#x8282;&#x3002;&#x5185;&#x5B58;&#x9875;&#x7684;wait-wake&#x673A;&#x5236;&#x8BF7;&#x53C2;&#x8003;&#x7B14;&#x8BB0;&#x5185;&#x5B58;&#x9875;&#x7684;wait-wake&#x673A;&#x5236;&#x3002;&#xA0; &#xA0; &#xA0;&#x672C;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x4E3A;&#xFF1A;wait_table_hash_nr_entries(zone_size_pages) -&gt;&#xA0;wait_table_bits(zone-&gt;wait_table_hash_nr_entries) -&gt;&#xA0;alloc_bootmem_node(pgdat, alloc_size) -&gt; &#x904D;&#x5386;&#x6240;&#x6709;&#x54C8;&#x5E0C;&#x9879;&#xFF0C;&#x5E76;&#x521D;&#x59CB;&#x5316;init_waitqueue_head(zone-&gt;wait_table + i)&#xA0; &#xA0; &#xA0;b&#xFF09;zone_init_free_lists&#xA0; &#xA0; &#xA0;&#x7275;&#x6D89;&#x5230;migrate type&#xFF0C;&#x5C1A;&#x4E0D;&#x6E05;&#x695A;&#x5176;&#x4E2D;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x4F1A;&#x7528;&#x65B0;&#x7BC7;&#x6765;&#x4F5C;&#x4ECB;&#x7ECD;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[arm架构，函数调用过程]]></title>
    <url>%2F2012%2F11%2F01%2Farm%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[&#x6CE8;&#x610F;&#xFF1A;R11=fp;R12=ip;R13=SP&#xFF1B;R14=LR&#xFF1B;R15=PC&#xFF1B;R0,R1,R2&#x7528;&#x4E8E;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x548C;&#x5B58;&#x653E;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x6CE8;&#x610F;&#xFF1B;&#x4F4E;&#x5730;&#x5740;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x88AB;&#x538B;&#x5165;&#x4F4E;&#x5730;&#x5740;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5982;&#x679C;&#x5411;&#x4E0B;&#x589E;&#x957F;&#xFF0C;&#x9AD8;&#x5730;&#x5740;&#x5BC4;&#x5B58;&#x5668;&#x5148;&#x538B;&#xFF0C;&#x5411;&#x4E0A;&#x589E;&#x957F;&#x6D4B;&#x8BD5;&#x4F4E;&#x5730;&#x5740;&#x5148;&#x538B;&#x3002;&#xA0;&#x6CE8;&#x610F;&#xFF1A;&#x6839;&#x636E;&#x201C;ARM-thumb &#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x6807;&#x51C6;&#x201D;&#xFF1A;1&#xFF0C; r0-r3 &#x7528;&#x4F5C;&#x4F20;&#x5165;&#x51FD;&#x6570;&#x53C2;&#x6570;&#xFF0C;&#x4F20;&#x51FA;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x5728;&#x5B50;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x4E4B;&#x95F4;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06; r0-r3 &#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x7528;&#x9014;&#x3002;&#x88AB;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x5728;&#x8FD4;&#x56DE;&#x4E4B;&#x524D;&#x4E0D;&#x5FC5;&#x6062;&#x590D; r0-r3&#x3002;---&#x5982;&#x679C;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x9700;&#x8981;&#x518D;&#x6B21;&#x4F7F;&#x7528; r0-r3 &#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5219;&#x5B83;&#x5FC5;&#x987B;&#x4FDD;&#x7559;&#x8FD9;&#x4E9B;&#x5185;&#x5BB9;&#x3002;2&#xFF0C; r4-r11 &#x88AB;&#x7528;&#x6765;&#x5B58;&#x653E;&#x51FD;&#x6570;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x3002;&#x5982;&#x679C;&#x88AB;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x4F7F;&#x7528;&#x4E86;&#x8FD9;&#x4E9B;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5B83;&#x5728;&#x8FD4;&#x56DE;&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x6062;&#x590D;&#x8FD9;&#x4E9B;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#x3002;3&#xFF0C; r12 &#x662F;&#x5185;&#x90E8;&#x8C03;&#x7528;&#x6682;&#x65F6;&#x5BC4;&#x5B58;&#x5668; ip&#x3002;&#x5B83;&#x5728;&#x8FC7;&#x7A0B;&#x94FE;&#x63A5;&#x80F6;&#x5408;&#x4EE3;&#x7801;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x4EA4;&#x4E92;&#x64CD;&#x4F5C;&#x80F6;&#x5408;&#x4EE3;&#x7801;&#xFF09;&#x4E2D;&#x7528;&#x4E8E;&#x6B64;&#x89D2;&#x8272;&#x3002;&#x5728;&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x4E4B;&#x95F4;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5B83;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x7528;&#x9014;&#x3002;&#x88AB;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x5728;&#x8FD4;&#x56DE;&#x4E4B;&#x524D;&#x4E0D;&#x5FC5;&#x6062;&#x590D; r12&#x3002;4&#xFF0C;&#x5BC4;&#x5B58;&#x5668; r13 &#x662F;&#x6808;&#x6307;&#x9488; sp&#x3002;&#x5B83;&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x5176;&#x5B83;&#x7528;&#x9014;&#x3002;sp &#x4E2D;&#x5B58;&#x653E;&#x7684;&#x503C;&#x5728;&#x9000;&#x51FA;&#x88AB;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x65F6;&#x5FC5;&#x987B;&#x4E0E;&#x8FDB;&#x5165;&#x65F6;&#x7684;&#x503C;&#x76F8;&#x540C;&#x3002;5&#xFF0C;&#x5BC4;&#x5B58;&#x5668; r14 &#x662F;&#x94FE;&#x63A5;&#x5BC4;&#x5B58;&#x5668; lr&#x3002;&#x5982;&#x679C;&#x60A8;&#x4FDD;&#x5B58;&#x4E86;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5728;&#x8C03;&#x7528;&#x4E4B;&#x95F4;&#x5C06; r14 &#x7528;&#x4E8E;&#x5176;&#x5B83;&#x7528;&#x9014;&#xFF0C;&#x7A0B;&#x5E8F;&#x8FD4;&#x56DE;&#x65F6;&#x8981;&#x6062;&#x590D;6&#xFF0C;&#x5BC4;&#x5B58;&#x5668; r15 &#x662F;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668; PC&#x3002;&#x5B83;&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x5176;&#x5B83;&#x7528;&#x9014;&#x3002;7&#xFF0C;&#x5728;&#x4E2D;&#x65AD;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x90FD;&#x5FC5;&#x987B;&#x4FDD;&#x62A4;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x81EA;&#x52A8;&#x4FDD;&#x62A4;R4&#xFF5E;R11&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x822C;&#x4F60;&#x81EA;&#x5DF1;&#x53EA;&#x8981;&#x5728;&#x7A0B;&#x5E8F;&#x7684;&#x5F00;&#x5934;sub lr,lr,#4stmfd sp!,{r0-r3,r12,lr}&#xFF1B;&#x4FDD;&#x62A4;R0&#xFF5E;R3&#xFF0C;R12,LR&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x7528;&#x6C47;&#x7F16;&#x4EBA;&#x4E3A;&#x7684;&#x53BB;&#x6539;&#x53D8;R4~R11&#x7684;&#x503C;&#x3002;&#xFF08;&#x5177;&#x4F53;&#x53BB;&#x770B;UCOS os_cpu_a.S&#x4E2D;&#x7684;IRQ&#x4E2D;&#x65AD;&#x7684;&#x4EE3;&#x7801;&#xFF09;1.&#x51FD;&#x6570;&#x8C03;&#x7528;&#x524D;&#xFF0C;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x9700;&#x8981;&#x4FDD;&#x62A4;&#x73B0;&#x573A;&#xFF0C;&#x5373;r0-r3&#xFF0C;&#x56E0;&#x4E3A;&#x88AB;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x4E0D;&#x4F1A;&#x5E2E;&#x52A9;&#x4FDD;&#x5B58;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E4B;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x628A;&#x53C2;&#x6570;&#x4F20;&#x5165;r0-r3&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;4&#x4E2A;&#x53C2;&#x6570;&#x5219;&#x5F00;&#x8F9F;&#x6808;&#x7A7A;&#x95F4;&#xFF0C;&#x5C06;&#x53C2;&#x6570;&#x538B;&#x6808;2.&#x4E09;&#x4E2A;&#x91CD;&#x8981;&#x53C2;&#x6570;&#x9700;&#x8981;&#x538B;&#x6808;&#xFF0C;fp&#xFF0C;lr&#xFF0C;ip&#xFF0C;&#x5373;r11-r13&#xFF0C;fp&#x662F;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x4FDD;&#x5B58;&#x73B0;&#x573A;&#x7684;&#x5E95;&#x90E8;&#xFF0C;lr&#x662F;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#xFF0C;ip&#x662F;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x7684;&#x6808;&#x5E95;&#x6307;&#x9488;3.&#x5728;&#x51FD;&#x6570;&#x9000;&#x51FA;&#x65F6;&#xFF0C;lr&#x4F1A;&#x88AB;&#x52A0;&#x8F7D;&#x5230;pc&#xFF0C;ip&#x52A0;&#x8F7D;&#x5230;sp&#xFF0C;&#x6B64;&#x65F6;&#x8DF3;&#x8F6C;&#x56DE;&#x8C03;&#x7528;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x62F7;&#x8D1D;&#x51FA;r0-r3&#x4E2D;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5E76;&#x5F00;&#x59CB;&#x6062;&#x590D;&#x73B0;&#x573A;&#x3002;]]></content>
      <tags>
        <tag>arm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CPU调度]]></title>
    <url>%2F2012%2F10%2F10%2FCPU%E8%B0%83%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[1.&#x8BC4;&#x4EF7;&#x51C6;&#x5219;CPU&#x4F7F;&#x7528;&#x7387;&#xFF1A;&lt;40% &#x8F7B;&#x8D1F;&#x8377;&#xFF0C;&gt;90% &#x91CD;&#x8D1F;&#x8377;&#x541E;&#x5410;&#x91CF;&#xFF1A;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x5355;&#x5143;&#x5185;&#x5904;&#x7406;&#x8FDB;&#x7A0B;&#x7684;&#x6570;&#x91CF;&#x5468;&#x8F6C;&#x65F6;&#x95F4;&#xFF1A;&#x8FDB;&#x7A0B;&#x63D0;&#x4EA4;&#x5230;&#x5B8C;&#x6210;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x7B49;&#x5F85;&#x548C;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x3002;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#xFF1A;&#x4ECE;&#x63D0;&#x4EA4;&#x5230;&#x7B2C;&#x4E00;&#x6B21;&#x54CD;&#x5E94;&#x4E4B;&#x95F4;&#x7684;&#x65F6;&#x95F4;&#x95F4;&#x9694;2.&#x7B97;&#x6CD5;1&#xFF09;&#x5148;&#x5230;&#x5148;&#x670D;&#x52A1;&#xFF08;FCFS&#xFF09;&#xA0; &#xA0; &#xA0;&#x6700;&#x666E;&#x901A;&#x7684;&#x4E00;&#x79CD;&#x8C03;&#x5EA6;&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x662F;&#x975E;&#x62A2;&#x5360;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x5F80;&#x5F80;&#x4E0D;&#x662F;&#x6700;&#x4F18;&#x7B97;&#x6CD5;&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x4F9D;&#x8D56;&#x4E8E;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x7684;&#x987A;&#x5E8F;&#x3002;2&#xFF09;&#x6700;&#x77ED;&#x4F5C;&#x4E1A;&#x4F18;&#x5148;&#xFF08;SJF&#xFF09;&#xA0; &#xA0; &#xA0;SJF&#x7B97;&#x6CD5;&#x88AB;&#x8BC1;&#x660E;&#x4E3A;&#x662F;&#x6700;&#x4F73;&#x7B97;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x6700;&#x77ED;&#x3002;&#x4F46;&#x5176;&#x5B9E;&#x73B0;&#x96BE;&#x5EA6;&#x662F;&#x65E0;&#x6CD5;&#x9884;&#x6599;&#x4E0B;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x3002;&#x73B0;&#x5728;&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684;&#x505A;&#x6CD5;&#x662F;&#xFF0C;&#x91C7;&#x7528;&#x4F30;&#x8BA1;&#x7B97;&#x6CD5;&#x6765;&#x9884;&#x6D4B;&#x4E0B;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x3002;&#x6240;&#x4EE5;&#x5F80;&#x5F80;&#x65F6;&#x95F4;&#x8D8A;&#x4E45;&#xFF0C;&#x9884;&#x6D4B;&#x8D8A;&#x51C6;&#x786E;&#xFF0C;&#x6240;&#x4EE5;SJF&#x8C03;&#x5EA6;&#x7ECF;&#x5E38;&#x7528;&#x4E8E;&#x957F;&#x671F;&#x8C03;&#x5EA6;&#x3002;&#xA0; &#xA0; &#xA0;&#x53EF;&#x62A2;&#x5360;&#x5F0F;&#x7684;SJF&#x7B97;&#x6CD5;&#xFF0C;&#x88AB;&#x79F0;&#x4F5C;&#x6700;&#x77ED;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x4F18;&#x5148;&#x8C03;&#x5EA6;&#x3002;3&#xFF09;&#x4F18;&#x5148;&#x6743;&#x8C03;&#x5EA6;&#xA0; &#xA0; &#xA0;SJF&#x662F;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x4F18;&#x5148;&#x6743;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x3002;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x6709;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5373;&#x65E0;&#x7A77;&#x963B;&#x585E;&#xFF0C;&#x53C8;&#x53EB;&#x9965;&#x997F;&#x3002;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x4E00;&#x76F4;&#x6709;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#x6765;&#x62A2;&#x5360;&#x8D44;&#x6E90;&#xFF0C;&#x5219;&#x6709;&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x4E9B;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#x6C38;&#x8FDC;&#x5F97;&#x4E0D;&#x5230;&#x64CD;&#x4F5C;&#x3002;&#x9965;&#x997F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x8001;&#x5316;&#xFF0C;&#x5373;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x63A8;&#x79FB;&#xFF0C;&#x589E;&#x5927;&#x4E00;&#x4E9B;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x4EFB;&#x52A1;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002;4&#xFF09;&#x8F6E;&#x8F6C;&#x6CD5;&#xFF08;RR&#xFF0C;round-robin&#xFF09;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x662F;&#x5C06;CPU&#x5904;&#x7406;&#x65F6;&#x95F4;&#x5206;&#x6210;&#x8BB8;&#x591A;&#x5C0F;&#x7684;&#x65F6;&#x95F4;&#x7247;&#xFF0C;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#x8F6E;&#x6D41;&#x83B7;&#x5F97;CPU&#x65F6;&#x95F4;&#x3002;&#x8FD9;&#x662F;&#x4E13;&#x95E8;&#x4E3A;&#x5206;&#x65F6;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#x90FD;&#x4F1A;&#x5F97;&#x5230;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x3002;&#x4F46;&#x6BCF;&#x6B21;&#x5207;&#x6362;&#x4EFB;&#x52A1;&#x90FD;&#x4F1A;&#x53C8;&#x4E00;&#x6B21;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x8FD9;&#x4E2A;&#x4F1A;&#x6D88;&#x8017;&#x4E00;&#x5B9A;&#x7684;&#x8D44;&#x6E90;&#x3002;5&#xFF09;&#x591A;&#x7EA7;&#x961F;&#x5217;&#x8C03;&#x5EA6;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x662F;&#x6307;&#x5C06;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x4E2A;&#x5904;&#x7406;&#x961F;&#x5217;&#xFF0C;&#x6BCF;&#x4E2A;&#x961F;&#x5217;&#x53EF;&#x91C7;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x961F;&#x5217;&#x4E4B;&#x95F4;&#x53EF;&#x91C7;&#x7528;&#x56FA;&#x5B9A;&#x4F18;&#x5148;&#x6743;&#x53EF;&#x62A2;&#x5360;&#x8C03;&#x5EA6;&#xFF0C;&#x6216;&#x8005;&#x91C7;&#x7528;round-robin&#x8C03;&#x5EA6;&#xFF0C;&#x5373;&#x6240;&#x6709;&#x961F;&#x5217;&#x5206;&#x4EAB;&#x65F6;&#x95F4;&#x7247;&#x3002;6&#xFF09;&#x591A;&#x7EA7;&#x53CD;&#x9988;&#x961F;&#x5217;&#x8C03;&#x5EA6;&#xA0; &#xA0; &#xA0;&#x8FD9;&#x662F;&#x5F53;&#x4E0B;&#x6700;&#x901A;&#x7528;&#x7684;CPU&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x3002;&#x8FD9;&#x662F;&#x52A0;&#x5F3A;&#x7248;&#x7684;&#x591A;&#x7EA7;&#x961F;&#x5217;&#x8C03;&#x5EA6;&#x3002;&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x5728;&#x961F;&#x5217;&#x4E4B;&#x95F4;&#x79FB;&#x52A8;&#x3002;&#x9700;&#x8981;&#x957F;&#x65F6;&#x95F4;&#x64CD;&#x4F5C;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4F1A;&#x88AB;&#x8F6C;&#x79FB;&#x5230;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x961F;&#x5217;&#xFF1B;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x8FC7;&#x957F;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4F1A;&#x88AB;&#x8F6C;&#x79FB;&#x5230;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x961F;&#x5217;&#x3002;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x8FD9;&#x79CD;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x53EF;&#x7531;&#x4E0B;&#x5217;&#x53C2;&#x6570;&#x5B9A;&#x4E49;&#xFF1A;&#x961F;&#x5217;&#x6570;&#x91CF;&#x6BCF;&#x4E2A;&#x961F;&#x5217;&#x7684;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x4EFB;&#x52A1;&#x5347;&#x7EA7;&#x5230;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x961F;&#x5217;&#x7684;&#x6761;&#x4EF6;&#x4EFB;&#x52A1;&#x964D;&#x7EA7;&#x5230;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x961F;&#x5217;&#x7684;&#x6761;&#x4EF6;&#x67D0;&#x4E2A;&#x4EFB;&#x52A1;&#x521D;&#x59CB;&#x65F6;&#x8BE5;&#x8FDB;&#x5165;&#x54EA;&#x4E2A;&#x961F;&#x5217; &#xA0; &#xA0;&#xA0;3.Linux&#x8C03;&#x5EA6;&#x7B97;&#x6CD5; &#xA0;&#xA0; &#xA0; &#xA0;Linux assigns higher-priority tasks longer time&#xA0;quanta and lower-priority tasks shorter time quanta.&#xA0; &#xA0;The relationship between&#xA0;priorities and time-slice length is shown in Figure 5.15.&#xA0; &#xA0; &#xA0;Each runqueue contains two priority arrays: active and expired.The&#xA0;active array contains all tasks with time remaining in their time slices, and the&#xA0;expired array contains all expired tasks.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Each of these priority arrays contains a&#xA0;list of tasks indexed according to priority (Figure 5.16). The scheduler chooses&#xA0;the task with the highest priority from the active array for execution on the&#xA0;CPU.&#xA0; &#xA0; &#xA0;When all tasks have&#xA0;exhausted their time slices (that is, the active array is empty), the two priority&#xA0;arrays are exchanged: the expired array becomes the active array, and vice&#xA0;versa.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Real-time tasks are assigned static priorities. All&#xA0;other tasks have dynamic priorities that are based on their nice values plus or&#xA0;minus the value 5. &#x8FD9;&#x4E2A;&#x8981;&#x770B;&#x4EFB;&#x52A1;&#x7684;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#xFF0C;&#x7B49;&#x592A;&#x4E45;&#x4E86;&#x5C31;&#x8981;&#x51CF;5&#x4EE5;&#x63D0;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5426;&#x5219;&#x8981;&#x52A0;5&#x964D;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x3002;&#xA0; &#xA0; &#xA0;A task&#x2019;s dynamic priority is recalculated when the task has exhausted its&#xA0;time quantum and is to be moved to the expired array.&#xA0;Thus, when the two&#xA0;arrays are exchanged, all tasks in the new active array have been assigned new&#xA0;priorities and corresponding time slices.]]></content>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[memblock工作原理]]></title>
    <url>%2F2012%2F10%2F08%2Fmemblock%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[memblock&#x662F;Linux&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x7684;&#x4E00;&#x79CD;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x5BF9;bootmem&#x7684;&#x8865;&#x5145;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;bootmem&#x6613;&#x4EA7;&#x751F;&#x5916;&#x90E8;&#x788E;&#x7247;&#x800C;&#x4EA7;&#x751F;&#x3002;&#x4ED6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;arm_memblock_init&#x548C;bootmem&#x521D;&#x59CB;&#x5316;&#x6240;&#x5728;&#x7684;&#x51FD;&#x6570;paging_init&#x7D27;&#x6328;&#x7740;&#xFF0C;&#x90FD;&#x5728;setup_arch&#x4E2D;&#x3002;struct memblock {&#xA0;&#xA0;&#xA0; phys_addr_t current_limit;&#xA0;&#xA0;&#xA0; phys_addr_t memory_size;&#xA0;&#xA0;&#xA0; /* Updated by memblock_analyze() */&#xA0;&#xA0;&#xA0; struct memblock_type memory;&#xA0;&#xA0;&#xA0; struct memblock_type reserved;};current_limit&#xFF1A;&#x8868;&#x793A;memblock&#x53EF;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#x7684;&#x4E0A;&#x9650;&#x503C;&#xFF0C;&#x5176;&#x521D;&#x59CB;&#x5316;&#x7684;&#x8FC7;&#x7A0B;&#x4E3A;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;paging_init -&gt; sanity_check_meminfo -&gt; memblock_set current_limit(limit)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#x5176;&#x4E2D;limit = __pa(vmalloc_min-1) + 1 = VMALLOC_END - 128M = 4G - 128M(high mem)memory_size&#xFF1A;&#x8BB0;&#x5F55;&#x603B;&#x7684;&#x5185;&#x5B58;&#x6570;&#x91CF;&#xFF0C;&#x5728;memory_analyze&#x4E2D;&#x66F4;&#x65B0;memory,reserved&#xFF1A;&#x662F;&#x4E24;&#x5F20;&#x8868;&#x683C;&#xFF0C;&#x524D;&#x8005;&#x662F;&#x7CFB;&#x7EDF;&#x6240;&#x62E5;&#x6709;&#x7684;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5757;&#xFF0C;&#x540E;&#x8005;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x5DF2;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5757;1. &#x521D;&#x59CB;&#x5316;&#xA0; &#xA0; &#xA0;1&#xFF09;mdesc-&gt;reserve&#x662F;&#x5728;arch/arm/mach-omap2/board-d7800.c&#x4E2D;&#x5206;&#x914D;&#x7ED9;machine_desc&#x53D8;&#x91CF;&#x3002;&#xA0; &#xA0; &#xA0;2&#xFF09;meminfo&#x7684;&#x521D;&#x59CB;&#x5316;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x53E6;&#x5916;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;meminfo&#x521D;&#x59CB;&#x5316;2.&#x5185;&#x5B58;&#x5206;&#x914D;&#xA0; &#xA0; &#xA0;1&#xFF09;MEMBLOCK_ALLOC_ACCESSIBLE&#x7684;&#x503C;&#x4E3A;0&#xFF0C;&#x5219;&#x540E;&#x9762;&#x7684;max_addr&#x4E5F;&#x4E3A;0&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x641C;&#x7D22;&#x7684;&#x4E0A;&#x9650;&#x4E5F;&#x4E3A;0&#x3002;&#x5728;memblock_find_base&#x4E2D;end&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x641C;&#x7D22;&#x7684;&#x4E0A;&#x9650;&#xFF08;&#x5176;&#x5B9E;&#x662F;&#x641C;&#x7D22;&#x7684;&#x8D77;&#x59CB;&#x503C;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x641C;&#x7D22;&#x65F6;&#x4ECE;&#x5185;&#x5B58;&#x7684;&#x6700;&#x9AD8;&#x503C;&#x5F00;&#x59CB;&#x7684;&#xFF0C;&#x8FD9;&#x4E48;&#x505A;&#x662F;&#x6709;&#x7528;&#x610F;&#x7684;&#xFF0C;&#x8BE6;&#x89C1;&#x7B2C;2&#x70B9;&#xFF09;&#x8D4B;&#x4E3A;memblock.current_limit&#xFF0C;&#x5B83;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x672C;&#x6587;&#x524D;&#x9762;&#x7684;&#x4ECB;&#x7ECD;&#x3002;&#xA0; &#xA0; &#xA0;2&#xFF09;&#x4E3A;&#x4EC0;&#x4E48;&#x662F;&#x4ECE;&#x5185;&#x5B58;&#x7684;&#x9AD8;&#x5730;&#x5740;&#x5F00;&#x59CB;&#x641C;&#x7D22;&#xFF0C;mm/memblock.c&#x4E2D;&#x7684;&#x6709;&#x6CE8;&#x91CA;&#x9053;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;/* We do a top-down search, this tends to limit memory&#xA0;&#xA0;&#xA0;&#xA0; * fragmentation by keeping early boot allocs near the&#xA0;&#xA0;&#xA0;&#xA0; * top of memory&#xA0;&#xA0;&#xA0;&#xA0; */&#x770B;&#x8D77;&#x6765;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x788E;&#x7247;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x80FD;&#x89E3;&#x51B3;&#xFF0C;&#x4E0D;&#x6E05;&#x695A;&#x3002;&#xA0; &#xA0; &#xA0;3&#xFF09;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x8DDF;&#x5185;&#x5B58;&#x533A;&#x7684;&#x59CB;&#x672B;&#x4F4D;&#x7F6E;&#x6709;&#x5173;&#x7684;&#x503C;&#x90FD;&#x8FDB;&#x884C;&#x4E86;&#x5BF9;&#x9F50;&#xFF0C;&#x7528;&#x5230;&#x5982;&#x4E0B;&#x7684;&#x8BED;&#x53E5;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;size = memblock_align_up(size, align)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;base = memblock_align_down((end - size), align)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x8FD9;&#x4E9B;&#x4E5F;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x788E;&#x7247;&#x95EE;&#x9898;&#xFF0C;mm/memblock.c &#x4E2D;&#x6709;&#x6CE8;&#x91CA;&#xFF0C;&#x9053;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;/* We align the size to limit fragmentation. Without this, a lot of&#xA0;&#xA0;&#xA0;&#xA0; * small allocs quickly eat up the whole reserve array on sparc&#xA0;&#xA0;&#xA0;&#xA0; */&#xA0; &#xA0; &#xA0;4&#xFF09;memblock_addrs_overlap&#x4E2D;&#x5224;&#x65AD;&#x4EA4;&#x53E0;&#x7684;&#x65B9;&#x6CD5;&#x5F88;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[meminfo初始化]]></title>
    <url>%2F2012%2F09%2F29%2Fmeminfo%E5%88%9D%E5%A7%8B%E5%8C%96%2F</url>
    <content type="text"><![CDATA[1. u-boot&#x4E2D;&#x8BBE;&#x7F6E;&#x542F;&#x52A8;&#x53C2;&#x6570;&#xA0; &#xA0; &#xA0;1&#xFF09;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;u-boot-env.txt&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bootcmd&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if ${recovery}; then&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run nandrecovery;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if mmc init; then&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if run loadbootscript; then&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run bootscript;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if run loaduImage; then&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run mmcboot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run nandboot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;fi;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;fi;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run nandboot;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; fi;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;fi&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;nandboot&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;echo Booting from nand ...;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run nandargs;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;nand read ${loadaddr} boot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;booti 0x82000008&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;nandargs&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;setenv bootargs console=${console} init=${init} mem=${mem} ip=${ip} mpurate=${mpurate} omap_vout.vid1_static_vrfb_alloc=y vram=${vram} omapfb.vram=0:8M androidboot.console=${tty} root=${root_nand} rootfstype=${rootfstype_nand} ubi.mtd=${ubi_mtd}&#xA0; &#xA0; &#xA0;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x5C5E;&#x4E8E;commandline&#xFF0C;&#x4F1A;&#x5728;setup_commandline_tag&#x4E2D;&#x63D2;&#x5165;params&#x6570;&#x7EC4;&#xFF0C;&#x5E76;&#x6807;&#x4E0A;ATAG_CMDLINE&#xFF0C;&#x4F1A;&#x5728;parse_args&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x6765;&#x5904;&#x7406;&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;&#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;2&#xFF09;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;include/configs/d7800.h&#xA0; &#xA0; &#xA0;#define CONFIG_EXTRA_ENV_SETTINGS \&#xA0; &#xA0; &quot;init=/init\0&quot; \&#xA0; &#xA0; &quot;mem=256M\0&quot; \&#xA0; &#xA0; &quot;mpurate=800\0&quot; \&#xA0; &#xA0;&#x2026;&#x2026;2.kernel&#x4E2D;&#x7528;parse_args&#x89E3;&#x6790;&#x6B64;bootarg&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x53C2;&#x8003;&#x53E6;&#x4E00;&#x4EFD;&#x7B14;&#x8BB0;Linux&#x542F;&#x52A8;&#x53C2;&#x6570;&#x201C;init=xxx&#x201D;&#x5206;&#x6790;&#xA0; &#xA0; &#xA0;parse_args -&gt;&#xA0;parse_one -&gt;&#xA0;unknown_bootoption -&gt;&#xA0;obsolete_checksetup -&gt;&#xA0;obs_kernel_param.setup_func =&#xA0;early_mem3.kernel&#x4E2D;&#x8BBE;&#x7F6E;&#x5BF9;&#x5E94;bootarg&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#xA0; &#xA0; &#xA0;early_param(&quot;mem&quot;, early_mem); -&gt;&#xA0;__setup_param(str, fn, fn, 1) -&gt;&#xA0;&#xA0; &#xA0; &#xA0;#define __setup_param(str, unique_id, fn, early)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; \&#xA0; &#xA0; &#xA0;static const char __setup_str_##unique_id[] __initconst \&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __aligned(1) = str; \&#xA0; &#xA0; &#xA0;static struct obs_kernel_param __setup_##unique_id&#xA0; \&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __used __section(.init.setup)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; \&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __attribute__((aligned((sizeof(long)))))&#xA0;&#xA0;&#xA0; \&#xA0; &#xA0; &#xA0; &#xA0; = { __setup_str_##unique_id, fn, early } &#xA0;&#xA0;4.early_mem&#x51FD;&#x6570;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;static int __init early_mem(char *p){&#xA0;&#xA0;&#xA0; static int usermem __initdata = 0;&#xA0;&#xA0;&#xA0; unsigned long size, start;&#xA0;&#xA0;&#xA0; char *endp;&#xA0;&#xA0;&#xA0; /*&#xA0;&#xA0;&#xA0;&#xA0; * If the user specifies memory size, we&#xA0;&#xA0;&#xA0;&#xA0; * blow away any automatically generated&#xA0;&#xA0;&#xA0;&#xA0; * size.&#xA0;&#xA0;&#xA0;&#xA0; */&#xA0;&#xA0;&#xA0; if (usermem == 0) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; usermem = 1;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; meminfo.nr_banks = 0;&#xA0;&#xA0;&#xA0; }&#xA0; &#xA0; &#xA0; &#xA0;&#xA0;/*&#xA0;&#xA0;&#xA0;&#xA0; *&#xA0;defined in&#xA0;arch/arm/plat-omap/include/plat/memory.h&#xA0;&#xA0;&#xA0;&#xA0; *&#xA0;PHYS_OFFSET &#xA0;= UL(0x80000000)&#xA0;&#xA0;&#xA0;&#xA0; */&#xA0;&#xA0;&#xA0; start = PHYS_OFFSET;&#xA0;&#xA0;&#xA0; size&#xA0; = memparse(p, &amp;endp);&#xA0;&#xA0;&#xA0; if (*endp == &apos;@&apos;)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start = memparse(endp + 1, NULL);&#xA0;&#xA0;&#xA0; arm_add_memory(start, size);&#xA0;&#xA0;&#xA0; return 0;}&#x6700;&#x540E;&#x9057;&#x7559;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5047;&#x5982;&#x6709;&#x51E0;&#x5757;&#x5185;&#x5B58;&#x9700;&#x8981;&#x5904;&#x7406;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#xA0; &#xA0; &#xA0;&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;Linux&#x63D0;&#x4F9B;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x673A;&#x5236;&#x3002;&#x5C31;&#x662F;__tagtable(ATAG_MEM, parse_tag_mem32);&#x8FD9;&#x662F;&#x4E00;&#x5F20;&#x8868;&#x683C;&#xFF0C;&#x4EE3;&#x8868;&#x4E86;&#x4E00;&#x7EC4;ATAG_MEM param&#xFF0C;&#x7528;parse_tag_mem32&#x6765;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x4E00;&#x7EC4;param&#x540C;&#x6837;&#x4E5F;&#x662F;&#x5728;u-boot&#x9636;&#x6BB5;&#x5C31;&#x52A0;&#x5165;&#x4E86;&#x3002;&#x5373;&#xFF1A;&#xA0; &#xA0; &#xA0;do_bootm_linux -&gt;&#xA0;setup_memory_tags (u-boot)static void setup_memory_tags (bd_t *bd){&#xA0;&#xA0;&#xA0; int i;&#xA0;&#xA0;&#xA0; for (i = 0; i &lt; CONFIG_NR_DRAM_BANKS; i++) {&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;hdr.tag = ATAG_MEM;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;hdr.size = tag_size (tag_mem32);&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;u.mem.start = bd-&gt;bi_dram[i].start;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;u.mem.size = bd-&gt;bi_dram[i].size;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params = tag_next (params);&#xA0;&#xA0;&#xA0; }}&#xA0; &#xA0; &#xA0;&#x53EA;&#x4E0D;&#x8FC7;&#x5728;D7800&#x4E2D;CONFIG_NR_DRAM_BANKS=1&#xFF08;configs/d7800.h&#xFF09;&#x3002;&#xA0; &#xA0; &#xA0;meminfo&#x4E2D;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#x5168;&#x90E8;&#x662F;&#x771F;&#x6B63;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x3002;&#xA0; &#xA0; &#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
        <tag>uboot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[USB驱动程序]]></title>
    <url>%2F2012%2F09%2F12%2FUSB%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[1. device&#xFF0C;configuration&#xFF0C;interface&#xFF0C;endpoint&#x6211;&#x7684;&#x7406;&#x89E3;&#xFF1A;&#xA0; &#xA0; &#xA0;1&#xFF09;&#x9996;&#x5148;&#xFF0C;&#x4E00;&#x4E2A;device&#x5305;&#x542B;&#x591A;&#x4E2A;configuration&#xFF0C;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x4E00;&#x4E2A;configuration&#x5305;&#x542B;&#x591A;&#x4E2A;interface&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#x4E00;&#x4E2A;interface&#x4F7F;&#x7528;&#x591A;&#x4E2A;endpoint&#x6765;&#x5B8C;&#x6210;&#x529F;&#x80FD;&#xA0; &#xA0; &#xA0;2&#xFF09;&#x5176;&#x6B21;&#xFF0C;interface&#x5BF9;&#x5E94;&#x5230;USB device&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x903B;&#x8F91;&#x8BBE;&#x5907;&#x3002;&#x4E00;&#x4E2A;configuration&#x5C31;&#x5305;&#x542B;&#x4E86;&#x591A;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x903B;&#x8F91;&#x8BBE;&#x5907;&#xFF0C;&#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x5BF9;&#x5E94;&#x4E86;&#x67D0;&#x4E00;&#x4E2A;&#x65F6;&#x523B;&#x7684;USB device&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E00;&#x4E2A;USB device&#x5728;&#x4E0D;&#x540C;&#x7684;&#x65F6;&#x523B;&#xFF0C;&#x9700;&#x8981;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x9014;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x7528;&#x9014;&#x7531;&#x591A;&#x4E2A;&#x903B;&#x8F91;&#x8BBE;&#x5907;&#x6765;&#x8FBE;&#x6210;&#x3002;&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF1A;&#x4E00;&#x4E9B;USB&#x8BBE;&#x5907;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x56FA;&#x4EF6;&#x5230;&#x5176;&#x4E0A;&#xFF0C;&#x5219;&#x8FD9;&#x4E9B;&#x8BBE;&#x5907;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x65F6;&#x5019;&#x626E;&#x6F14;&#x4E0D;&#x540C;&#x7684;&#x89D2;&#x8272;&#xFF08;&#x5B58;&#x50A8;&#x8BBE;&#x5907;&#xFF0C;&#x6216;&#x8005;&#x65E0;&#x7EBF;&#x7F51;&#x5361;&#x7B49;&#x7B49;&#xFF09;&#x3002;&#xA0; &#xA0; &#xA0;usb_interface --&#xA0;usb_host_interface (altsetting) --&#xA0;usb_interface_descriptor --&#xA0;bAlternateSetting:altsetting&#x7F16;&#x53F7;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;| &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;|- &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;+ bInterfaceNumber&#xFF1A;interface&#x7F16;&#x53F7;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;| &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;|- extra: following usb_host_interface_descriptor in this interface (hence usb_interface)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;| &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;|- usb_host_endpoint: &#x6B64;&#x914D;&#x7F6E;&#x4E0B;&#x7684;endpoint&#x6570;&#x7EC4;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x6BCF;&#x4E2A;ep&#x7684;desc&#x548C;urb_list&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;|-&#xA0;usb_host_interface&#xA0;(altsetting[1])&#xA0; &#xA0; &#xA0;3&#xFF09;&#x5982;&#x4E0A;&#x56FE;&#xFF0C;&#x6BCF;&#x4E2A;interface&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x591A;&#x79CD;&#x914D;&#x7F6E;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x662F;&#x4E00;&#x4E2A;altsetting&#xFF0C;&#x7C7B;&#x578B;&#x662F;usb_host_interface&#xFF0C;&#x6BCF;&#x4E2A;altsetting&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;descriptor&#xFF08;&#x8BB0;&#x5F55;&#x4E86;&#x5F53;&#x524D;interface&#x548C;&#x5F53;&#x524D;interface&#x7684;altsetting&#x7684;&#x4FE1;&#x606F;&#xFF09;&#xFF0C;&#x548C;&#x4E00;&#x7EC4;endpoint&#xFF08;&#x5305;&#x542B;&#x4E86;endpoint&#x7684;descriptor&#x548C;&#x5BF9;&#x5E94;&#x7684;urb_list&#xFF09;&#x3002;&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Alternate settings allow a portion of the device configuration to be varied while other interfaces remain in&#xA0;operation. &#xA0;-- USB 2.0 spec.&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;The default setting for an interface is always alternate setting zero.The SetInterface() request is used to select an alternate setting or to return to the default setting. &#xA0;&#xA0;-- USB 2.0 spec.&#xA0; &#xA0; &#xA0;4&#xFF09;&#x6CE8;&#x610F;&#x4E0D;&#x540C;&#x7684;DescriptorType&#x503C;&#xFF0C;&#x4F1A;&#x6709;&#x4E0D;&#x540C;descriptor&#x7684;&#x683C;&#x5F0F;2. USB&#x8BBE;&#x5907;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#x7684;&#x57FA;&#x672C;&#x5355;&#x4F4D;&#x4E3A;endpoint&#xFF0C;&#x6709;4&#x79CD;ep&#xFF0C;&#x5BF9;&#x5E94;&#x5230;4&#x4E2D;USB&#x4F20;&#x8F93;&#x7C7B;&#x578B;&#xFF1A;control&#xFF0C;bulk&#xFF0C;interrupt&#xFF0C;isochronous&#x3002;&#x6240;&#x8C13;&#x7684;pipe&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6307;&#x5B9A;&#x4E86;&#x7684;&#x76EE;&#x7684;ep&#xFF0C;&#x5F88;&#x5F62;&#x8C61;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#x6210;&#x4E00;&#x4E2A;&#x7BA1;&#x9053;&#x3002;&#x8868;&#x5F81;&#x8D77;&#x6765;&#x5C31;&#x662F;&#x4E00;&#x4E2A;int&#x7C7B;&#x578B;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x76EE;&#x7684;ep&#x4FE1;&#x606F;&#xFF08;8&#x4F4D;&#xFF09;&#x548C;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x4FE1;&#x606F;&#x3002;3. USB sysfs&#x540D;&#x5B57;&#x89E3;&#x6790;sysfs&#x4E2D;&#x53EA;&#x663E;&#x793A;&#x4E86;&#x548C;&#x5F53;&#x524D;&#x914D;&#x7F6E;&#x548C;&#x63A5;&#x53E3;&#xFF0C;&#x6240;&#x6709;&#x53EF;&#x9009;&#x7684;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x67E5;&#x770B;usbfs(/proc/bus/usb)&#x6765;&#x83B7;&#x5F97;&#x9700;&#x8981;&#x7684;&#x4FE1;&#x606F;4. 1&#xFF09;USB&#x8BBE;&#x5907;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x901A;&#x8FC7;urb&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x5F02;&#x6B65;&#x901A;&#x4FE1;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x540C;&#x6B65;&#x901A;&#x4FE1;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5373;&#x7ED5;&#x5F00;urb&#x76F4;&#x63A5;&#x4F20;&#x8F93;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x79CD;&#x540C;&#x6B65;&#x65B9;&#x5F0F;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#xFF0C;&#x5206;&#x522B;&#x4E3A;usb_bulk_msg&#x548C;usb_control_msg&#x3002;&#xA0; &#xA0; 2&#xFF09;&#x63A7;&#x5236;&#xFF0C;&#x4E2D;&#x65AD;&#xFF0C;&#x6279;&#x91CF;&#xFF0C;&#x7B49;&#x65F6;&#x56DB;&#x79CD;urb&#x53EA;&#x6709;&#x7B49;&#x65F6;urb&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x624B;&#x52A8;&#x7684;&#x521D;&#x59CB;&#x5316;&#x3002;&#x5176;&#x4ED6;&#x7684;&#x5747;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5F62;&#x4E3A;usb_fill_xxx_urb&#x7684;&#x51FD;&#x6570;&#x6765;&#x4F5C;&#x521D;&#x59CB;&#x5316;&#x3002;&#xA0; &#xA0; 3&#xFF09;&#x901A;&#x8FC7;usb_submit_urb&#x6765;&#x63D0;&#x4EA4;urb&#x7ED9;USB core&#x3002;urb&#x88AB;&#x5904;&#x7406;&#x5B8C;&#x540E;&#x4F1A;&#x8C03;&#x7528;urb&#x6CE8;&#x518C;&#x7684;complete&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x505A;&#x7ED3;&#x675F;&#x5DE5;&#x4F5C;&#x3002;5. usb_driver&#x901A;&#x8FC7;usb_device_id&#x6570;&#x7EC4;&#x544A;&#x8BC9;USB core&#xFF0C;&#x672C;&#x9A71;&#x52A8;&#x652F;&#x6301;&#x4EC0;&#x4E48;&#x6837;&#x7684;USB&#x8BBE;&#x5907;&#x3002;&#x5F53;&#x6709;&#x8BBE;&#x5907;&#x63D2;&#x5165;&#x65F6;&#xFF0C;USB core&#x6765;&#x5224;&#x65AD;&#x54EA;&#x4E2A;&#x9A71;&#x52A8;&#x652F;&#x6301;&#x8BE5;&#x8BBE;&#x5907;&#xFF0C;&#x627E;&#x5230;&#x4E86;&#x4E4B;&#x540E;&#xFF0C;&#x8C03;&#x7528;usb_driver-&gt;probe&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x5E76;&#x5728;&#x9000;&#x51FA;&#x65F6;&#x8C03;&#x7528;disconnect&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;6. &#x4E3A;&#x4E86;&#x4F7F;&#x7528;&#x4F20;&#x7EDF;&#x7684;&#x5B57;&#x7B26;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;usb_register_dev&#x6765;&#x6CE8;&#x518C;USB&#x8BBE;&#x5907;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>USB</tag>
        <tag>Linux Device Drivers</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vmalloc分析]]></title>
    <url>%2F2012%2F08%2F27%2Fvmalloc%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[vmalloc&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#xFF1A;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[工作队列work queue解析]]></title>
    <url>%2F2012%2F08%2F10%2F%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97work_queue%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[2.6&#x5185;&#x6838;&#x7684;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x505A;&#x4E86;&#x5F88;&#x5927;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x65B0;&#x7684;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x673A;&#x5236;&#x88AB;&#x79F0;&#x4E3A;Concurrency Managed Work Queue&#xFF08;&#x5E76;&#x53D1;&#x7BA1;&#x7406;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#xFF0C;&#x7B80;&#x79F0;cmwq&#xFF09;&#x3002;&#x5176;&#x4E3B;&#x65E8;&#x662F;&#x589E;&#x5F3A;&#x591A;&#x6838;&#x65F6;&#x7684;&#x5904;&#x7406;&#x6027;&#x80FD;&#x3002;cmwq &#x7684;&#x5B9E;&#x73B0;&#x9075;&#x5FAA;&#x4E86;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x539F;&#x5219;&#xFF1A;&#x4E0E;&#x539F;&#x6709;&#x7684;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x63A5;&#x53E3;&#x4FDD;&#x6301;&#x517C;&#x5BB9;&#xFF0C;cmwq &#x53EA;&#x662F;&#x66F4;&#x6539;&#x4E86;&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x79FB;&#x690D;&#x5230;&#x65B0;&#x7684;&#x63A5;&#x53E3;&#xFF08;__create_workqueue -&gt; alloc_workqueue&#xFF09;&#x3002;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x5171;&#x4EAB; per-CPU &#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x63D0;&#x4F9B;&#x7075;&#x6D3B;&#x7684;&#x5E76;&#x53D1;&#x7EA7;&#x522B;&#x800C;&#x4E0D;&#x518D;&#x6D6A;&#x8D39;&#x5927;&#x91CF;&#x7684;&#x8D44;&#x6E90;&#x3002;&#x81EA;&#x52A8;&#x5E73;&#x8861;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x6C60;&#x548C;&#x5E76;&#x53D1;&#x7EA7;&#x522B;&#xFF0C;&#x8FD9;&#x6837;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x7528;&#x6237;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x5982;&#x6B64;&#x591A;&#x7684;&#x7EC6;&#x8282;&#x3002;create_workqueue (create_singlethread_workqueue) -&gt; alloc_workqueue -&gt; __alloc_workqueue_keystruct workqueue_struct*alloc_workqueue(char *name, unsigned int flags, int max_active);&#x5176;&#x4E2D;&#xFF1A;name&#xFF1A;&#x4E3A;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x800C;&#x4E0D;&#x50CF; 2.6.36 &#x4E4B;&#x524D;&#x5B9E;&#x9645;&#x662F;&#x4E3A;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x670D;&#x52A1;&#x7684;&#x5185;&#x6838;&#x7EBF;&#x7A0B;&#x7684;&#x540D;&#x5B57;&#x3002;flag &#x6307;&#x660E;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x5B9A;&#x7684;&#x6807;&#x8BB0;&#x5982;&#x4E0B;&#xFF1A;WQ_NON_REENTRANT&#xFF1A;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x53EA;&#x662F;&#x786E;&#x4FDD;&#x5728;&#x540C;&#x4E00; CPU &#x4E0A;&#x4E0D;&#x53EF;&#x91CD;&#x5165;&#xFF0C;&#x5373;&#x5DE5;&#x4F5C;&#x9879;&#x4E0D;&#x80FD;&#x5728;&#x540C;&#x4E00; CPU &#x4E0A;&#x88AB;&#x591A;&#x4E2A;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x5BB9;&#x8BB8;&#x5728;&#x591A;&#x4E2A; CPU &#x4E0A;&#x5E76;&#x53D1;&#x6267;&#x884C;&#x3002;&#x4F46;&#x8BE5;&#x6807;&#x5FD7;&#x6807;&#x660E;&#x5728;&#x591A;&#x4E2A; CPU &#x4E0A;&#x4E5F;&#x662F;&#x4E0D;&#x53EF;&#x91CD;&#x5165;&#x7684;&#xFF0C;&#x5DE5;&#x4F5C;&#x9879;&#x5C06;&#x5728;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x91CD;&#x5165;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x4E2D;&#x6392;&#x961F;&#xFF0C;&#x5E76;&#x786E;&#x4FDD;&#x81F3;&#x591A;&#x5728;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8303;&#x56F4;&#x5185;&#x7684;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x88AB;&#x6267;&#x884C;&#x3002;WQ_UNBOUND&#xFF1A;&#x5DE5;&#x4F5C;&#x9879;&#x88AB;&#x653E;&#x5165;&#x4E00;&#x4E2A;&#x7531;&#x7279;&#x5B9A; gcwq &#x670D;&#x52A1;&#x7684;&#x672A;&#x9650;&#x5B9A;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#xFF0C;&#x8BE5;&#x5BA2;&#x6237;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x6CA1;&#x6709;&#x88AB;&#x9650;&#x5B9A;&#x5230;&#x7279;&#x5B9A;&#x7684; CPU&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x672A;&#x9650;&#x5B9A;&#x5DE5;&#x4F5C;&#x8005;&#x961F;&#x5217;&#x5C31;&#x50CF;&#x7B80;&#x5355;&#x7684;&#x6267;&#x884C;&#x4E0A;&#x4E0B;&#x6587;&#x4E00;&#x822C;&#xFF0C;&#x6CA1;&#x6709;&#x5E76;&#x53D1;&#x7BA1;&#x7406;&#x3002;&#x672A;&#x9650;&#x5B9A;&#x7684; gcwq &#x8BD5;&#x56FE;&#x5C3D;&#x53EF;&#x80FD;&#x5FEB;&#x7684;&#x6267;&#x884C;&#x5DE5;&#x4F5C;&#x9879;&#x3002;WQ_FREEZEABLE&#xFF1A;&#x53EF;&#x51BB;&#x7ED3; wq &#x53C2;&#x4E0E;&#x7CFB;&#x7EDF;&#x7684;&#x6682;&#x505C;&#x64CD;&#x4F5C;&#x3002;&#x8BE5;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x5DE5;&#x4F5C;&#x9879;&#x5C06;&#x88AB;&#x6682;&#x505C;&#xFF0C;&#x9664;&#x975E;&#x88AB;&#x5524;&#x9192;&#xFF0C;&#x5426;&#x8005;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x5DE5;&#x4F5C;&#x9879;&#x88AB;&#x6267;&#x884C;&#x3002;WQ_MEM_RECLAIM&#xFF1A;&#x6240;&#x6709;&#x7684;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x53EF;&#x80FD;&#x5728;&#x5185;&#x5B58;&#x56DE;&#x6536;&#x8DEF;&#x5F84;&#x4E0A;&#x88AB;&#x4F7F;&#x7528;&#x3002;&#x4F7F;&#x7528;&#x8BE5;&#x6807;&#x5FD7;&#x5219;&#x4FDD;&#x8BC1;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x4E0A;&#x4E0B;&#x6587;&#x800C;&#x4E0D;&#x7BA1;&#x5728;&#x4EFB;&#x4F55;&#x5185;&#x5B58;&#x538B;&#x529B;&#x4E4B;&#x4E0B;&#x3002;WQ_HIGHPRI&#xFF1A;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x5DE5;&#x4F5C;&#x9879;&#x5C06;&#x88AB;&#x6392;&#x7EC3;&#x5728;&#x961F;&#x5217;&#x5934;&#x4E0A;&#xFF0C;&#x5E76;&#x4E14;&#x6267;&#x884C;&#x65F6;&#x4E0D;&#x8003;&#x8651;&#x5E76;&#x53D1;&#x7EA7;&#x522B;&#xFF1B;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x53EA;&#x8981;&#x8D44;&#x6E90;&#x53EF;&#x7528;&#xFF0C;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x5DE5;&#x4F5C;&#x9879;&#x5C06;&#x5C3D;&#x53EF;&#x80FD;&#x5FEB;&#x7684;&#x6267;&#x884C;&#x3002;&#x9AD8;&#x4F18;&#x5148;&#x5DE5;&#x4F5C;&#x9879;&#x4E4B;&#x95F4;&#x4F9D;&#x636E;&#x63D0;&#x4EA4;&#x7684;&#x987A;&#x5E8F;&#x88AB;&#x6267;&#x884C;&#x3002;WQ_CPU_INTENSIVE&#xFF1A;CPU &#x5BC6;&#x96C6;&#x7684;&#x5DE5;&#x4F5C;&#x9879;&#x5BF9;&#x5E76;&#x53D1;&#x7EA7;&#x522B;&#x5E76;&#x65E0;&#x8D21;&#x732E;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x53EF;&#x8FD0;&#x884C;&#x7684; CPU &#x5BC6;&#x96C6;&#x578B;&#x5DE5;&#x4F5C;&#x9879;&#x5C06;&#x4E0D;&#x963B;&#x6B62;&#x5176;&#x5B83;&#x5DE5;&#x4F5C;&#x9879;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x9650;&#x5B9A;&#x5F97;&#x5DE5;&#x4F5C;&#x9879;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x671F;&#x671B;&#x66F4;&#x591A;&#x7684; CPU &#x65F6;&#x949F;&#x5468;&#x671F;&#xFF0C;&#x6240;&#x4EE5;&#x5C06;&#x5B83;&#x4EEC;&#x7684;&#x6267;&#x884C;&#x8C03;&#x5EA6;&#x4EA4;&#x7ED9;&#x7CFB;&#x7EDF;&#x8C03;&#x5EA6;&#x5668;&#x3002;max_active&#xFF1A;&#x51B3;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A; wq &#x5728; per-CPU &#x4E0A;&#x80FD;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x5DE5;&#x4F5C;&#x9879;&#x3002;&#x6BD4;&#x5982; max_active &#x8BBE;&#x7F6E;&#x4E3A; 16 &#x8868;&#x793A;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x4E0A;&#x6700;&#x591A; 16 &#x4E2A;&#x5DE5;&#x4F5C;&#x9879;&#x80FD;&#x540C;&#x65F6;&#x5728; per-CPU &#x4E0A;&#x540C;&#x65F6;&#x6267;&#x884C;&#x3002;&#x5F53;&#x524D;&#x5B9E;&#x884C;&#x4E2D;&#xFF0C;&#x5BF9;&#x6240;&#x6709;&#x9650;&#x5B9A;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#xFF0C;max_active &#x7684;&#x6700;&#x5927;&#x503C;&#x662F; 512&#xFF0C;&#x800C;&#x8BBE;&#x5B9A;&#x4E3A; 0 &#x65F6;&#x8868;&#x793A;&#x662F; 256&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;&#x672A;&#x9650;&#x5B9A;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#xFF0C;&#x8BE5;&#x6700;&#x5927;&#x503C;&#x4E3A;&#xFF1A;MAX[512&#xFF0C;4 * num_possible_cpus() ]&#xFF0C;&#x9664;&#x975E;&#x6709;&#x7279;&#x522B;&#x7684;&#x7406;&#x7531;&#x9700;&#x8981;&#x9650;&#x6D41;&#x6216;&#x8005;&#x5176;&#x5B83;&#x539F;&#x56E0;&#xFF0C;&#x4E00;&#x822C;&#x8BBE;&#x5B9A;&#x4E3A; 0 &#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x4E00;&#x4E9B;&#x7528;&#x6237;&#x4F9D;&#x8D56;&#x4E8E; ST &#x4E2D;&#x7684;&#x4E25;&#x683C;&#x6267;&#x884C;&#x987A;&#x5E8F;&#xFF0C;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x5728; cmwq &#x4E2D;&#x53EF;&#x4EE5;&#x5C06; max_active &#x8BBE;&#x4E3A; 1&#xFF0C;flag &#x8BBE;&#x7F6E;&#x4E3A; WQ_UNBOUND &#x6765;&#x83B7;&#x5F97;&#x76F8;&#x540C;&#x7684;&#x884C;&#x4E3A;cmwq &#x672C;&#x8D28;&#x4E0A;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x516C;&#x5171;&#x7684;&#x5185;&#x6838;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x63A5;&#x53E3;&#x57FA;&#x672C;&#x4E0A;&#x548C;&#x4EE5;&#x524D;&#x4FDD;&#x6301;&#x4E86;&#x517C;&#x5BB9;&#xFF0C;&#x53EA;&#x662F;&#x66F4;&#x6539;&#x4E86;&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x51FD;&#x6570;&#x7684;&#x540E;&#x7AEF;&#xFF0C;&#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x548C;&#x5185;&#x6838;&#x7EBF;&#x7A0B;&#x7684;&#x4E00;&#x4E00;&#x7ED1;&#x5B9A;&#x5173;&#x7CFB;&#x6539;&#x4E3A;&#x7531;&#x5185;&#x6838;&#x6765;&#x7BA1;&#x7406;&#x5185;&#x6838;&#x7EBF;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x56E0;&#x6B64;&#x5728; cmwq &#x4E2D;&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x4E00;&#x5B9A;&#x4F1A;&#x521B;&#x5EFA;&#x5185;&#x6838;&#x7EBF;&#x7A0B;&#x3002;&#x5185;&#x6838;&#x5B9E;&#x73B0;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x57FA;&#x672C;&#x6846;&#x67B6;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;1.&#xA0;gcwq&#x5C01;&#x88C5;&#x4E86;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;worker&#x5C01;&#x88C5;&#x4E86;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#xFF0C;work&#x5C31;&#x662F;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x771F;&#x6B63;&#x5728;&#x5904;&#x7406;&#x7684;&#x4E8B;&#x52A1;&#x3002;2.&#xA0;&#x9488;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;CPU&#xFF0C;&#x5185;&#x6838;&#x7528;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;global_cwq&#x6765;&#x8868;&#x793A;cmwq&#xFF0C;&#x5373;gcwq&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x672A;&#x548C;CPU&#x7ED1;&#x5B9A;&#x7684;gcwq&#xFF0C;&#x6240;&#x4EE5;&#x603B;&#x5171;gcwq&#x7684;&#x6570;&#x91CF;&#x4E3A;CPU&#x6570;&#x76EE;+1.3. gcwq&#x4E2D;&#x6709;&#x4E09;&#x4E2A;&#x91CD;&#x8981;&#x7684;list&#xFF0C;&#x5206;&#x522B;&#x662F;: 1) &#x7BA1;&#x7406;&#x7A7A;&#x95F2;worker&#x7684;idlelist; 2)&#x7BA1;&#x7406;&#x6B63;&#x5728;&#x5DE5;&#x4F5C;&#x7684;worker&#x7684;busy_hash; 3) &#x4EE5;&#x53CA;&#x672C;CPU&#x4E0A;&#x7B49;&#x5F85;&#x5904;&#x7406;&#x7684;work&#x5217;&#x8868;worklist4. worker&#x624D;&#x662F;Linux&#x8C03;&#x5EA6;&#x5668;&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#x7684;&#x57FA;&#x672C;&#x5355;&#x4F4D;&#xFF0C;worker&#x6709;&#x4E00;&#x4E2A;&#x6210;&#x5458;task_struct&#xFF0C;&#x8C03;&#x5EA6;&#x5668;&#x5229;&#x7528;&#x6B64;&#x7ED3;&#x6784;&#x6765;&#x8C03;&#x5EA6;worker_thread&#xFF0C;&#x51B3;&#x5B9A;&#x4ED6;&#x4F55;&#x65F6;&#x4F11;&#x7720;&#xFF0C;&#x5408;&#x9002;&#x5524;&#x9192;&#x5DE5;&#x4F5C;&#x961F;&#x5217;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;workqueue&#x6709;&#x4E24;&#x79CD;&#x5F62;&#x5F0F;&#xFF1A;1. ST &#xFF08;Single Thread&#xFF09;&#xFF1A;&#x53EA;&#x5728;&#x521B;&#x5EFA;&#x5B83;&#x7684;CPU&#x4E0A;&#x6709;cwq&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;2. MT &#xFF08;Multi Thread&#xFF09;&#xFF1A;&#x5728;&#x6BCF;&#x4E2A;active CPU&#x4E0A;&#x5747;&#x6709;cwq&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;&#x5BF9;&#x5E94;&#x5230;&#x6BCF;&#x4E2A;CPU&#x4E0A;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;cpu_workqueue_struct&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;&#x5373;cwqwq&#x4E0E;cwq&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x662F;&#x5728;__alloc_workqueue_key&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;1. &#x901A;&#x8FC7;alloc_cwqs&#x521B;&#x5EFA;&#x4E00;&#x7EC4;per-CPU&#x53D8;&#x91CF;2. &#x7528;&#x4E00;&#x4E2A;for_each_cwq_cpu&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x6240;&#x6709;CPU&#xFF0C;&#x5E76;&#x4E3A;&#x6BCF;&#x4E2A;CPU&#x7684;cwq&#x7ED3;&#x6784;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6307;&#x5B9A;cwq-&gt;gcwq&#x548C;cwq-&gt;wqwork&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;work&#x5728;&#x5404;&#x4E2A;list&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#x7684;&#x5173;&#x7CFB;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;work&#x5982;&#x4F55;&#x5904;&#x7406;: process_scheduled_work()1. &#x5728;busy_hash table&#x4E2D;&#x627E;&#xFF0C;&#x662F;&#x5426;&#x6709;thread&#x6B63;&#x5728;&#x5904;&#x7406;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x3002;&#x5982;&#x679C;&#x6709;&#xFF0C;&#x5219;&#x5C06;&#x672C;&#x4E8B;&#x52A1;&#x8F6C;&#x79FB;&#x5230;&#x90A3;&#x4E2A;worker thread&#x7684;scheduled&#x5217;&#x8868;&#x4E0A;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x540C;&#x4E00;&#x4E2A;work&#x4E0D;&#x5728;&#x540C;&#x4E00;CPU&#x7684;&#x4E0D;&#x540C;thread&#x4E0A;&#x5E76;&#x53D1;&#x3002;2. &#x914D;&#x7F6E;worker-&gt;current_work = work&#xFF0C;&#xA0;worker-&gt;current_cwq = cwq&#xFF0C; &#x8BB0;&#x5F55;&#x6B64;&#x65F6;&#x5728;&#x5904;&#x7406;&#x7684;&#x662F;&#x54EA;&#x4E2A;workqueue&#x4E0A;&#x7684;&#x54EA;&#x4E2A;work&#x3002;&#x7531;&#x4E8E;&#x6B64;&#x65F6;gcwq-&gt;lock&#x662F;&#x9501;&#x4E0A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x548C;&#x5176;&#x4ED6;&#x672C;&#x5730;thread&#x540C;&#x6B65;&#x6CA1;&#x6709;&#x95EE;&#x9898;3. &#x8BB0;&#x5F55;CPU number&#x5230;work-&gt;data&#xFF0C;&#x4ECE;scheduled&#x5217;&#x8868;&#x4E2D;&#x5220;&#x9664;&#x8BE5;work4. &#x5904;&#x7406;gcwq&#x6709;GCWQ_HIGHPRI_PENDING&#x6807;&#x5FD7;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x52A0;&#x5165;&#x4E0B;&#x4E00;&#x4E2A;work&#x4ECD;&#x7136;&#x662F;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5219;&#x53BB;&#x53EB;&#x9192;idle&#x7684;worker&#x6765;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5219;&#x7EE7;&#x7EED;&#x3002;&#x4FDD;&#x8BC1;&#x5728;&#x6709;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;pending&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C3D;&#x91CF;&#x591A;&#x7684;worker&#x53C2;&#x4E0E;&#x5904;&#x7406;&#x3002;5. &#x89E3;&#x9501;gcwq-&gt;lock6. &#x4E3A;work&#x6E05;&#x9664;pending&#x6807;&#x5FD7;&#xFF0C;&#x5F00;&#x59CB;&#x771F;&#x6B63;&#x7684;&#x5904;&#x7406;&#x8BE5;work&#xFF0C;&#x8C03;&#x7528;work-&gt;func7. &#x9501;&#x4F4F;gcwq-&gt;lock8. &#x505A;&#x4E00;&#x4E9B;&#x5B8C;&#x6210;&#x65F6;&#x7684;&#x66F4;&#x65B0;&#xFF1A;1) &#x4ECE;busy_hash&#x4E2D;&#x5220;&#x9664;&#x8BE5;worker; 2) &#x5C06;current_work&#x548C;current_cwq&#x8D4B;&#x4E3A;NULLqueue_work&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;cpu id&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x9ED8;&#x8BA4;&#x8C03;&#x7528;get_cpu()&#x83B7;&#x5F97;&#x5F53;&#x524D;thread&#x6240;&#x5728;&#x7684;CPU&#x53F7;&#xFF08;&#x4E5F;&#x5C31;&#x662F;queue_work&#x6240;&#x5728;&#x7684;CPU&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x63D0;&#x4EA4;work&#x6240;&#x5728;&#x7684;CPU&#xFF09;&#xFF0C;&#x5E76;&#x5C06;work&#x52A0;&#x5230;CPU&#x5BF9;&#x5E94;&#x7684;gcwq&#x7684;worklist&#x4E0A;&#xFF0C;&#x4EE5;&#x5F85;&#x8FDB;&#x4E00;&#x6B65;&#x5904;&#x7406;&#x3002;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x5982;&#x4F55;&#x8C03;&#x5EA6;&#x6240;&#x6709;&#x7684;&#x7EBF;&#x7A0B;&#x901A;&#x8FC7;gcwq-&gt;lock&#x505A;&#x540C;&#x6B65;&#xFF0C;&#x5F53;&#x5728;&#x62F7;&#x8D1D;&#x5217;&#x8868;&#xFF0C;&#x4EE5;&#x53CA;&#x524D;&#x671F;&#x5904;&#x7406;&#x65F6;&#xFF08;&#x4FEE;&#x6539;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;manage worker&#xFF09;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x83B7;&#x5F97;&#x9501;&#xFF0C;&#x4F46;&#x771F;&#x6B63;&#x5904;&#x7406;&#x65F6;&#xFF08;&#x53EF;&#x80FD;&#x662F;&#x6700;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#xFF09;&#xFF0C;&#x9501;&#x662F;&#x91CA;&#x653E;&#x72B6;&#x6001;&#x7684;&#x3002;&#x5F53;&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x5B8C;&#x4EE5;&#x540E;&#xFF0C;&#x7EBF;&#x7A0B;&#x6807;&#x5FD7;&#x4F4D;&#x8BBE;&#x4E3A;TASK_INTERRUPTIBLE&#xFF0C;&#x5E76;&#x8C03;&#x7528;schedule()&#xFF0C;&#x4EE5;&#x4EA4;&#x51FA;&#x63A7;&#x5236;&#x6743;&#xFF0C;&#x7B49;&#x5F85;&#x8C03;&#x5EA6;&#x5668;&#x5C06;&#x5176;&#x5524;&#x9192;&#xFF0C;&#x5524;&#x9192;&#x540E;&#xFF0C;&#x7ACB;&#x5373;&#x8FDB;&#x5165;woke_up&#x5206;&#x652F;&#xFF0C;&#x5E76;&#x9996;&#x5148;&#x83B7;&#x5F97;gcwq-&gt;lock&#x9501;&#x3002;&#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>中断处理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[内核同步-spin_lock系列]]></title>
    <url>%2F2012%2F07%2F31%2F%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5-spin_lock%E7%B3%BB%E5%88%97%2F</url>
    <content type="text"><![CDATA[spin_lock_irq &amp;&#xA0;spin_unlock_irq&#x5728;&#x83B7;&#x5F97;&#x9501;&#x4E4B;&#x524D;&#x4F1A;&#x7981;&#x6B62;&#x4E2D;&#x65AD;&#xFF0C;&#x91CA;&#x653E;&#x9501;&#x65F6;&#x4F1A;&#x4F7F;&#x80FD;&#x4E2D;&#x65AD;&#xFF0C;&#x800C;&#x4E0D;&#x7BA1;&#x5728;&#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#x524D;&#x4E2D;&#x65AD;&#x72B6;&#x6001;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;spin_lock_irqsave &amp;&#xA0;spin_unlock_irqrestore&#x7C7B;&#x4F3C;spin_lock_irq&#xFF0C;&#x4F46;&#x4F1A;&#x8BB0;&#x4F4F;&#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#x4E4B;&#x524D;&#x7684;&#x4E2D;&#x65AD;&#x72B6;&#x6001;(&#x662F;&#x5426;&#x4F7F;&#x80FD;)&#xFF0C;&#x5728;&#x91CA;&#x653E;&#x9501;&#x65F6;&#x8FDB;&#x884C;&#x6062;&#x590D;spin_lock_bh &amp;&#xA0;spin_unlock_bh&#x4F1A;&#x5728;&#x8BF7;&#x6C42;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7981;&#x6B62;&#x8F6F;&#x4E2D;&#x65AD;&#xFF08;bh = bottom half&#xFF0C;&#x5E95;&#x534A;&#x90E8;&#xFF09;&#x4E09;&#x79CD;&#x73AF;&#x5883;&#xFF1A;&#x8FDB;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x8F6F;&#x4E2D;&#x65AD;&#xFF0C;&#x786C;&#x4E2D;&#x65AD;&#x4F18;&#x5148;&#x7EA7;&#x4F9D;&#x6B21;&#x589E;&#x9AD8;&#xFF0C;&#x5373;&#x540E;&#x8005;&#x80FD;&#x5C06;&#x524D;&#x8005;&#x6253;&#x65AD;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x73AF;&#x5883;&#x4E2D;&#x8BF7;&#x6C42;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x5C4F;&#x853D;&#x6389;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x8FD0;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;spin_lock&#x51FD;&#x6570;&#x6765;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x76EE;&#x7684;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x751F;&#x6B7B;&#x9501;&#x3002;&#x4E3E;&#x4F8B;&#xFF1A;A&#x8FDB;&#x7A0B;&#x7528;spin_lock&#x83B7;&#x5F97;&#x4E86;&#x67D0;&#x4E00;&#x8D44;&#x6E90;&#xFF0C;&#x8FD8;&#x672A;&#x91CA;&#x653E;&#xFF0C;&#x6B64;&#x65F6;&#x4E2D;&#x65AD;&#x6765;&#x4E86;&#xFF0C;&#x8FDB;&#x5165;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#xFF0C;&#x82E5;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x8981;&#x7528;spin_lock&#x8BF7;&#x6C42;&#x9501;&#xFF0C;&#x4F46;&#x8FD9;&#x65F6;&#x5047;&#x5982;&#x8FDB;&#x7A0B;A&#x548C;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x5728;&#x540C;&#x4E00;CPU&#x4E0A;&#xFF0C;&#x5219;A&#x6CA1;&#x6709;&#x673A;&#x4F1A;&#x518D;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5BFC;&#x81F4;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x4E2D;&#x6B7B;&#x9501;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x8FDB;&#x7A0B;A&#x4E2D;&#x5FC5;&#x987B;&#x8981;&#x5728;&#x83B7;&#x53D6;&#x9501;&#x4E4B;&#x524D;&#x5C4F;&#x853D;&#x4E2D;&#x65AD;&#xFF08;&#x53EA;&#x9700;&#x5C4F;&#x853D;&#x672C;&#x5730;&#x4E2D;&#x65AD;&#x5373;&#x53EF;&#xFF0C;&#x56E0;&#x4E3A;&#x5047;&#x5982;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x5728;&#x53E6;&#x5916;&#x4E00;&#x4E2A;CPU&#x4E0A;&#x65F6;&#xFF0C;&#x6362;&#x4E00;&#x79CD;&#x8BF4;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x53E6;&#x5916;&#x4E00;&#x4E2A;CPU&#x4EA7;&#x751F;&#x4E86;&#x4E2D;&#x65AD;&#xFF0C;&#x5176;&#x5B9E;&#x548C;&#x672C;CPU&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#xFF0C;&#x8FDB;&#x7A0B;A&#x7684;&#x64CD;&#x4F5C;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF0C;&#x53EF;&#x4EE5;&#x987A;&#x5229;&#x91CA;&#x653E;&#x9501;&#xFF09;&#x3002;&#x56E0;&#x4E3A;&#x5728;&#x4E0D;&#x540C;&#x7684;CPU&#x4E0A;&#x51FA;&#x73B0;&#x4E2D;&#x65AD;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x8FDB;&#x7A0B;A&#x7684;&#x72B6;&#x6001;&#x88AB;&#x8BBE;&#x4E3A;TASK_INTERRUPT&#xFF0C;&#x53EA;&#x662F;&#x6362;&#x51FA;&#x3002;&#x5F53;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x5FD9;&#x7B49;&#x88AB;&#x6362;&#x51FA;&#x540E;&#xFF0C;&#x8FDB;&#x7A0B;A&#x8FD8;&#x662F;&#x6709;&#x673A;&#x4F1A;&#x83B7;&#x5F97;CPU&#xFF0C;&#x6267;&#x884C;&#x5E76;&#x9000;&#x51FA;&#x4E34;&#x754C;&#x533A;&#x3002;*&#x6CE8;&#xFF1A;spin_lock_irq&#x5305;&#x542B;&#x4E86;local_irq_disable&#xFF08;&#x7981;&#x6B62;&#x4E2D;&#x65AD;&#xFF09;&#xFF0C;preempt_disable&#xFF08;&#x7981;&#x6B62;&#x5185;&#x6838;&#x62A2;&#x5360;&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;spin_lock&#x672C;&#x8EAB;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5047;&#x5982;&#x53EA;&#x8003;&#x8651;&#x591A;CPU&#x540C;&#x6B65;&#x7684;&#x60C5;&#x51B5;&#xFF0C;spin_lock&#x8DB3;&#x591F;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;CPU&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x8F6F;/&#x786C;&#x4E2D;&#x65AD;&#xFF0C;&#x5BF9;&#x672C;&#x5730;CPU&#x5E76;&#x6CA1;&#x6709;&#x5F71;&#x54CD;&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>同步</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux启动流程]]></title>
    <url>%2F2012%2F07%2F29%2FLinux%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[&#x5165;&#x53E3;&#x70B9;&#x5728;head.S&#x4E2D;&#xFF0C;&#x8F6F;&#x4EF6;&#x6267;&#x884C;&#x7684;&#x7B2C;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;__HEAD &#xA0;// 0xc000_8000ENTRY(stext)&#x2026;&#x2026;ENDPROC(stext)&#x4ECE;head-common.S&#x4E2D;&#x8DF3;&#x8F6C;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;C&#x51FD;&#x6570;start_kernel&#x57FA;&#x672C;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;&#xA0;&#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux启动参数“init=xxx”分析]]></title>
    <url>%2F2012%2F07%2F22%2FLinux%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E2%80%9Cinit%3Dxxx%E2%80%9D%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[1. UBOOT&#x90E8;&#x5206;U-Boot&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;gd_t&#x6765;&#x5B58;&#x50A8;&#x5168;&#x5C40;&#x6570;&#x636E;&#x533A;&#x7684;&#x6570;&#x636E;&#x3002;UBOOT&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#xFF0C;&#x5C06;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x653E;&#x5728;r8&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#xFF0C;&#x6B64;&#x65F6;&#xFF0C;r8&#x4E0D;&#x4F1A;&#x518D;&#x505A;&#x4ED6;&#x7528;DECLARE_GLOBAL_DATA_PTR#define DECLARE_GLOBAL_DATA_PTR &#xA0; &#xA0; register volatile gd_t *gd asm (&quot;r8&quot;)&#x5728;start_armboot&#x4E2D;&#x5BF9;&#x8BE5;&#x6307;&#x9488;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;gd = (gd_t*)(_armboot_start - CONFIG_SYS_MALLOC_LEN - sizeof(gd_t));&#x5728;bootm command&#x4E2D;&#x5BF9;tag&#x7ED3;&#x6784;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;run_command(&quot;bootm&quot;) -&gt; do_bootm_linux -&gt; setup_start_tag -&gt;&#xA0;setup_start_tag(&#x521D;&#x59CB;&#x5316;params&#x533A;&#x57DF;(&#x6570;&#x7EC4;)&#xFF0C;params = bd-&gt;bi_boot_params = (OMAP34xx_SDRC_CS0+0x100) = 0x8000_0100&#xFF0C;d7800.c/board_init)-&gt;&#x2026;&#x2026;-&gt;setup_commandline_tag (&#x5C06;&#x73AF;&#x5883;&#x53D8;&#x91CF;bootargs&#x653E;&#x5165;params&#x6570;&#x7EC4;&#xFF0C;&#x5176;tag&#x4E3A;ATAG_CMDLINE)&#xA0; &#xA0; &#xA0; &#xA0; params&#x6570;&#x7EC4;&#x4EE5;tag&#x4E3A;ATAG_NONE&#x7684;tag&#x4F5C;&#x7ED3;&#x675F;&#x3002;params&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x7EC4;struct tag&#xFF0C;&#x5B9A;&#x4E49;&#x4E3A;&#xFF1A;struct tag {&#xA0; &#xA0; &#xA0;struct tag_header hdr;&#xA0; &#xA0; &#xA0;union { // &#x5404;&#x79CD;tag&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;struct tag_cmdline&#xA0; cmdline;&#xA0; &#xA0; &#xA0;&#x2026;&#x2026;&#xA0; &#xA0; &#xA0;}u;}2. kernel&#x90E8;&#x5206;&#x5728;board-d7800.c&#x4E2D;&#x5BF9;mdesc&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;MACHINE_START(D7800, &quot;HSM D7800 Board&quot;)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;/* Maintainer: Syed Mohammed Khasim - Texas Instruments */&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;.boot_params&#xA0;&#xA0;&#xA0; = 0x80000100, &#xA0;// &#x4E0E;UBOOT&#x4E00;&#x81F4; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; &#xA0; &#xA0;.map_io&#xA0;&#xA0;&#xA0;&#xA0; = omap3_map_io,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;.reserve&#xA0;&#xA0;&#xA0; = omap_reserve,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;.init_irq&#xA0;&#xA0; = d7800_init_irq,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;.init_machine&#xA0;&#xA0; = d7800_init,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0;.timer&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = &amp;omap_timer,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;MACHINE_END&#xA0;&#x5728;setup_arch(&amp;command_line);&#x4E2D;&#x5F15;&#x7528;parse_tags(tags)&#xFF0C;&#x4EE5;tag.hdr.size = 0&#x4E3A;&#x5FAA;&#x73AF;&#x7EC8;&#x6B62;&#x6761;&#x4EF6;&#xFF0C;&#x904D;&#x5386;params&#x533A;&#x57DF;&#xFF08;&#x5373;struct tag&#x6570;&#x7EC4;&#xFF09;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x8BE5;param&#x7684;tag(ATAG_xxx)&#x5728;.taglist.init&#x533A;&#x57DF;&#x4E2D;&#x5BFB;&#x627E;&#x5408;&#x9002;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;&#x5BF9;&#x4E8E;ATAG_CMDLINE&#xFF0C;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x5373;&#x4E3A;parse_tag_cmdline&#xFF0C;&#x5373;&#x5C06;tag-&gt;u.cmdline.cmdline copy&#x5230;default_command_line&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x5728;setup_arch&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x5C31;&#x662F;from&#x6570;&#x7EC4;&#x3002;tag-&gt;u.cmdline.cmdline =&gt;&#xA0;default_command_line =&gt; boot_command_line =&gt; comdline_p =&gt; command_line =&gt;&#xA0;static_command_line (setup_command_line&#x4E2D;&#x5B9E;&#x73B0;)&#x5BF9;&#x4E8E;.taglist.init&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x662F;&#x901A;&#x8FC7;&#x5F15;&#x7528;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5982;&#x4E0B;&#x7684;&#x5B8F;&#x6765;&#x5B9E;&#x73B0;&#x7684;__tagtable(ATAG_CORE, parse_tag_core);__tagtable(ATAG_MEM, parse_tag_mem32);__tagtable(ATAG_CMDLINE, parse_tag_cmdline);&#x8FD9;&#x4E9B;&#x5B8F;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5C06;&#x4E00;&#x7EC4;struct tagtable&#x653E;&#x5230;.taglist.init&#x533A;&#x57DF;&#x4E2D;&#xFF0C;&#x6B64;&#x533A;&#x57DF;&#x53EF;&#x4EE5;&#x7528;__taglist_begin, __taglist_end&#x6765;&#x8868;&#x793A;&#x5728;start_kernel&#x4E2D;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#xFF0C;&#x771F;&#x6B63; &#x7684;&#x5904;&#x7406;paramsparse_args(&quot;Booting kernel&quot;, static_command_line, __start___param,&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; __stop___param - __start___param,&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &amp;unknown_bootoption);&#x8BE5;&#x51FD;&#x6570;&#x4ECE;static_command_line&#x4E2D;&#x53D6;param&#x51FA;&#x6765;&#xFF0C;&#x5E76;&#x7528;parse_one&#x5904;&#x7406;&#x3002;parse_one&#x4F1A;&#x5148;&#x4EE5;param&#x7684;name&#x53BB;__param section&#x4E2D;&#x67E5;&#x627E;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6709;&#x6B64;&#x53D8;&#x91CF;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;1&#xFF09;&#x5982;&#x679C;&#x6709;&#x6B64;&#x5B9A;&#x4E49;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x8BE5;param&#x7684;kernel_param_ops(&#x4F8B;&#x5982;param_ops_bool = {.set = param_set_bool; .get = param_get_bool})2&#xFF09;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#xFF0C;&#x5219;&#x8C03;&#x7528;handle_unknown&#xFF0C;&#x5373;unknown_bootoptionunknown_bootoption -&gt;&#xA0;obsolete_checksetup(param)obsolete_checksetup&#x51FD;&#x6570;&#x4F1A;&#x904D;&#x5386;__setup_start~__setup_end&#x533A;&#x57DF;&#xFF0C;&#x5047;&#x5982;&#x5728;&#x6B64;&#x533A;&#x57DF;&#x4E2D;&#x627E;&#x5230;param&#x5BF9;&#x5E94;&#x7684;obs_kernel_param&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x8BE5;obs_kernel_param&#x7684;setup_func&#xFF08;&#x5176;&#x5B9E;init&#x53C2;&#x6570;&#x5C31;&#x662F;&#x5728;&#x6B64;&#x65F6;&#x88AB;&#x5904;&#x7406;&#x7684;&#xFF09;&#x3002;3&#xFF09;&#x5982;&#x679C;param&#x5728;__setup_start~__setup_end&#x4E2D;&#x4ECD;&#x7136;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x5904;&#x7406;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x4F1A;&#x653E;&#x5230;envp_init&#x4E2D;* obsolete&#x662F;&#x8FC7;&#x65F6;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x4ECE;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;linux&#x4E2D;&#x8BA4;&#x4E3A;param&#x53C2;&#x6570;&#x662F;&#x4EE5;&#x540E;&#x4E3B;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x65B9;&#x5F0F;&#xFF0C;&#x5C06;&#x6162;&#x6162;&#x6452;&#x5F03;__setup&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;module_param&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x4E2D;&#x4E3A;&#x9A71;&#x52A8;&#x7684;&#x53C2;&#x6570;&#x8D4B;&#x503C;&#xFF0C;&#x8FD9;&#x79CD;&#x8D4B;&#x521D;&#x503C;&#x7684;&#x65B9;&#x5F0F;&#x5C06;&#x6210;&#x4E3A;&#x4E3B;&#x6D41;* &#x5173;&#x4E8E;__setup_start~__setup_end&#x533A;&#x57DF;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x53C2;&#x8003;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;init/main.c&#x91CC;&#x6709;&#x5982;&#x4E0B;&#x4E00;&#x884C;__setup(&quot;init=&quot;, init_setup);&#x5C55;&#x5F00;&#x540E;__setup_param(str, fn, fn, 0)static const char __setup_str_##unique_id[] __initconst \__aligned(1) = str; \static struct obs_kernel_param __setup_##unique_id \__used __section(.init.setup) \__attribute__((aligned((sizeof(long))))) \= { __setup_str_##unique_id, fn, early }&#x4E00;&#x4E9B;&#x7F16;&#x8BD1;&#x53C2;&#x6570;&#xFF1A;__initconst&#xFF1A; __section(.init.rodata),&#x5C06;&#x8BE5;&#x53D8;&#x91CF;&#x653E;&#x5165;&#x540D;&#x5B57;&#x4E3A;&#x201C;.init.rodata&#x201D;&#x7684;&#x6BB5;&#x4E2D;__used&#xFF1A;&#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#x65E0;&#x8BBA; GCC &#x662F;&#x5426;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8C03;&#x7528;&#x5B9E;&#x4F8B;&#xFF0C;&#x90FD;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x4ECE;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x4E2D;&#x8C03;&#x7528; C &#x51FD;&#x6570;&#x6709;&#x5E2E;&#x52A9;__attribute__&#xFF1A;gcc&#x7684;&#x6807;&#x5FD7;&#xFF0C;&#x4E3A;&#x51FD;&#x6570;&#x548C;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#xFF0C;&#x4EE5;&#x589E;&#x5F3A;&#x7F16;&#x8BD1;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x7528;&#x7F16;&#x8BD1;&#x65F6;&#x53C2;&#x6570;WALL&#x6253;&#x5F00;&#x5728;start_kernel-&gt;setup_arch&#x4E2D;&#x5BF9;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x7684;&#x5904;&#x7406;&#xFF1A;1.mdesc = setup_machine(machine_arch_type);&#x6240;&#x83B7;&#x5F97;&#x7684;machine_desc&#x6CA1;&#x6709;fixup&#x6210;&#x5458;&#x3002;&#x5176;&#x5B9A;&#x4E49;&#x5728;arch/arm/mach-omap/board-d7800.c&#x4E2D;2.&#x4F9D;&#x4E0A;&#xFF0C;&#x5219;char *from = default_command_line =&#xA0;CONFIG_CMDLINE =&#xA0;&quot;root=/dev/mmcblk0p2 rootwait console=ttyO2,115200&quot;3.strlcpy(boot_command_line, from, COMMAND_LINE_SIZE);4.strlcpy(cmd_line, boot_command_line, COMMAND_LINE_SIZE);5.*cmdline_p = cmd_line;&#xA0;parse_early_param();start_kernel&#x8C03;&#x7528;parse_args(&quot;Booting kernel&quot;, static_command_line, __start___param,&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; __stop___param - __start___param,&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &amp;unknown_bootoption);&#x6765;&#x5904;&#x7406;&#xFF0C;&#x5B9A;&#x4E49;&#x5728;&#x4EE5;&#x4E0B;&#x6BB5;&#x4E2D;&#x7684;param__start___param = .; *(__param); &#xA0;__stop___param = .gd&#x6307;&#x9488;&#x53EA;&#x6709;&#x5728;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x51FD;&#x6570;&#x4E2D;&#x5B9A;&#x4E49;&#x4E3A;&#x4E00;&#x4E2A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF1A;DECLARE_GLOBAL_DATA_PTR&#x56E0;&#x4E3A;&#x5728;u-boot&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x6307;&#x9488;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x6765;&#x4FDD;&#x5B58;&#x5B83;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#x662F;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x5728;&#x6240;&#x6709;&#x4F7F;&#x7528;&#x5230;&#x5B83;&#x7684;&#x5730;&#x65B9;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x5728;board_init_f&#x4E2D;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6307;&#x5411;CFG_GBL_DATA_ADDR]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux物理内存管理]]></title>
    <url>%2F2012%2F07%2F15%2FLinux%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[1. &#x6BCF;&#x4E00;&#x5757;&#x5B9E;&#x9645;&#x7684;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;node&#xFF08;struct pglistdata&#xFF0C;pg_data_t&#xFF09;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x5185;&#x5B58;&#x7531;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x6765;&#x7BA1;&#x7406;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;node&#x5BF9;&#x5E94;&#x7684;&#x7269;&#x7406;&#x5185;&#x5B58;&#x88AB;&#x5206;&#x5272;&#x6210;&#x6700;&#x591A;&#x4E09;&#x4E2A;zone&#xFF08;normal&#xFF0C;dma&#xFF0C;highmem&#xFF09;&#xFF08;struct zone_struct, zone_t&#xFF09;&#x3002;&#x4EE5;x86&#x4E3A;&#x4F8B;&#xFF1A;ZONEDMA First 16MiB of memoryZONENORMAL 16MiB - 896MiBZONEHIGHMEM 896 MiB - Endall the structs are kept in a global&#xA0;mem_map array, which is usually stored at the beginning of ZONE_NORMAL or just after&#xA0;the area reserved for the loaded kernel image in low memory machines.2.&#xA0;Zone Watermarks1)watermark&#x6307;zone&#x72B6;&#x6001;&#x7684;&#x4E09;&#x4E2A;&#x8F6C;&#x6298;&#x70B9;&#xFF0C;&#x5728;&#x8FD9;&#x4E09;&#x4E2A;&#x4E34;&#x754C;&#x503C;&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x91C7;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x914D;&#x7B56;&#x7565;&#x6765;&#x6EE1;&#x8DB3;&#x7CFB;&#x7EDF;&#x8981;&#x6C42;&#x4E0E;&#x6027;&#x80FD;&#x6700;&#x5927;&#x5316;&#x7684;&#x5E73;&#x8861;2)&#x6709;3&#x4E2A;watermark&#xFF1A;pages_min, pages_low and pages_high (1:2:3)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[arm体系架构]]></title>
    <url>%2F2012%2F07%2F15%2Farm%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ARM&#x5904;&#x7406;&#x5668;&#x5171;&#x6709;37&#x4E2A;&#x5BC4;&#x5B58;&#x5668;31&#x4E2A;&#x901A;&#x7528;&#x5BC4;&#x5B58;&#x5668;&#xFF08;PC&#xFF0C;R0~R14&#xFF0C;&#x7279;&#x6B8A;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;Rx:&#x5176;&#x4E2D;PC&#xFF0C;R0~R7&#x662F;&#x6240;&#x6709;ARM7&#x4E2A;&#x6A21;&#x5F0F;&#x5171;&#x6709;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#xFF09;6&#x4E2A;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;&#xFF08;ARM&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5F53;&#x524D;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;&#xFF08;CPSR&#xFF09;&#x548C;&#x4E94;&#x4E2A;&#x5907;&#x4EFD;&#x7684;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;&#xFF08;SPSRs&#xFF09;&#xFF09;]]></content>
      <tags>
        <tag>arm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux内核内存管理]]></title>
    <url>%2F2012%2F07%2F08%2FLinux%E5%86%85%E6%A0%B8%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[&#x5185;&#x6838;&#x903B;&#x8F91;&#x5730;&#x5740;&#xFF1A;&#x5F00;&#x59CB;&#x4E8E;0xC000_0000&#xFF08;3G&#xFF0C;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x6307;&#x5B9A;&#xFF0C;&#x5373;PAGE_OFFSET=3G&#xFF09;&#x5904;&#xFF0C;&#x662F;&#x7269;&#x7406;&#x5730;&#x5740;&#x7684;&#x7EBF;&#x6027;&#x6620;&#x5C04;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x6B64;&#x914D;&#x7F6E;&#x7684;32&#x4F4D;CPU&#x7684;&#x53EF;&#x63A7;&#x5185;&#x5B58;&#x6700;&#x5927;&#x503C;&#x5373;&#x4E3A;1GB&#x3002;&#x7531;&#x4E8E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7684;&#x4F4E;&#x5730;&#x5740;&#x548C;&#x9AD8;&#x5730;&#x5740;&#x4F1A;&#x7559;&#x4F5C;&#x4ED6;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x822C;&#x53EF;&#x7528;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x53EA;&#x6709;&#x5927;&#x7EA6;950MB&#x3002;&#x5982;&#x679C;&#x7269;&#x7406;&#x5185;&#x5B58;&#x8D85;&#x8FC7;950MB&#xFF0C;&#x5219;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x8981;&#x6307;&#x5B9A;CONFIG_HIGHMEM4G&#x548C;CONFIG_HIGHMEM64G&#x3002;&#x7531;&#x4E8E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x672C;&#x8EAB;&#x4E5F;&#x662F;&#x6709;&#x9875;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x51B2;&#x7A81;&#x3002;&#x5176;&#x7EBF;&#x6027;&#x5730;&#x5740;&#x4ECD;&#x7136;&#x7531;&#x9875;&#x8868;&#x6765;&#x5BF9;&#x5E94;&#x5230;&#x5177;&#x4F53;&#x7684;&#x5185;&#x5B58;&#x5355;&#x5143;&#x3002;&#x5185;&#x6838;&#x865A;&#x62DF;&#x5730;&#x5740;&#xFF1A;&#x662F;&#x6307;&#x6574;&#x4E2A;1G&#x7684;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x5185;&#x6838;&#x903B;&#x8F91;&#x5730;&#x5740;&#x4EE5;&#x53CA;&#x8D85;&#x8FC7;&#x5185;&#x6838;&#x903B;&#x8F91;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7684;&#x9AD8;&#x7AEF;&#x5185;&#x5B58;&#x3002;&#x8FD9;&#x4E00;&#x5757;&#x5185;&#x5B58;&#x662F;&#x4E3A;&#x6570;&#x91CF;&#x5927;&#x4E8E;896MB&#x7684;&#x7269;&#x7406;&#x5185;&#x5B58;&#x51C6;&#x5907;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x7531;kmap&#x5C06;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5230;&#x8BE5;&#x533A;&#x57DF;&#x4E0A;&#x6765;&#x4F7F;&#x7528;&#xFF0C;&#x7528;&#x5B8C;&#x518D;&#x7528;kunmap&#x6765;&#x91CA;&#x653E;&#x3002;&#x903B;&#x8F91;&#x5730;&#x5740;&#x5E94;&#x5F53;&#x662F;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;&#xFF0C;&#x4ED6;&#x5E94;&#x8BE5;&#x548C;&#x6BB5;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5BF9;&#x5E94;&#x8D77;&#x6765;&#x3002;&#x5185;&#x5B58;&#x8F6C;&#x6362;: &#x903B;&#x8F91;&#x5730;&#x5740; -&gt; &#x7EBF;&#x6027;&#x5730;&#x5740; -&gt; &#x7269;&#x7406;&#x5730;&#x5740;&#x903B;&#x8F91;&#x5730;&#x5740;&#xFF1A; = &#x6BB5;&#x6807;&#x8BC6;&#x7B26; + &#x6BB5;&#x5185;&#x504F;&#x79FB;&#x91CF;&#x3002;&#x4E3A;&#x4E86;&#x517C;&#x5BB9;&#xFF0C;&#x5C06;&#x8FDC;&#x53E4;&#x65F6;&#x4EE3;&#x7684;&#x6BB5;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x65B9;&#x5F0F;&#x4FDD;&#x7559;&#x4E86;&#x4E0B;&#x6765;&#x3002;CPU&#x5C06;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x5730;&#x5740;&#x8F6C;&#x6362;&#x4E3A;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4E24;&#x6B65;&#xFF1A;&#x9996;&#x5148;&#x5C06;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x903B;&#x8F91;&#x5730;&#x5740;&#xFF08;&#x5176;&#x5B9E;&#x662F;&#x6BB5;&#x5185;&#x504F;&#x79FB;&#x91CF;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E00;&#x5B9A;&#x8981;&#x7406;&#x89E3;&#xFF01;&#xFF01;&#xFF01;&#xFF09;&#xFF0C;CPU&#x8981;&#x5229;&#x7528;&#x5176;&#x6BB5;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5355;&#x5143;&#xFF0C;&#x5148;&#x5C06;&#x4E3A;&#x4E2A;&#x903B;&#x8F91;&#x5730;&#x5740;&#x8F6C;&#x6362;&#x6210;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5730;&#x5740;&#xFF0C;&#x518D;&#x5229;&#x7528;&#x5176;&#x9875;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5355;&#x5143;&#xFF0C;&#x8F6C;&#x6362;&#x4E3A;&#x6700;&#x7EC8;&#x7269;&#x7406;&#x5730;&#x5740;&#x3002; &#xFF08;http://bbs.chinaunix.net/thread-2083672-1-1.html&#xFF09;&#x6240;&#x8C13;&#x7684;&#x6BB5;&#x5F0F;&#x7BA1;&#x7406;&#xFF0C;&#x5C31;&#x662F;&#x628A;&#x6240;&#x6709;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x5206;&#x4E3A;&#xFF1A;&#x6570;&#x636E;&#x6BB5;&#xFF0C;&#x4EE3;&#x7801;&#x6BB5;&#xFF0C;&#x7CFB;&#x7EDF;&#x6BB5;&#x7B49;&#x7B49;&#xFF08;&#x53EF;&#x53C2;&#x8003;UBOOT&#x91CC;&#x9762;&#x7684;lds&#x94FE;&#x63A5;&#x811A;&#x672C;&#xFF09;&#x3002;&#x6BCF;&#x4E2A;&#x6BB5;&#x6709;&#x4E00;&#x4E2A;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x79F0;&#x4E3A;&#x6BB5;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x800C;&#x6BB5;&#x63CF;&#x8FF0;&#x7B26;&#x53C8;&#x5206;&#x4E3A;&#x5168;&#x5C40;&#x7684;(GDT, &#x7528;&#x4E8E;&#x7CFB;&#x7EDF;&#x6216;&#x5185;&#x6838;&#x7EA7;)&#xFF0C;&#x5C40;&#x90E8;&#x7684;(LDT, &#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x7EA7;)&#x3002;&#x4E0D;&#x540C;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x7684;&#x903B;&#x8F91;&#x5730;&#x5740;&#x4F1A;&#x53D6;&#x5230;&#x4E0D;&#x540C; &#x7684;&#x6BB5;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x518D;&#x4ECE;&#x6BB5;&#x63CF;&#x8FF0;&#x7B26;&#x4E2D;&#x53D6;&#x5230;&#x6BB5;&#x57FA;&#x5730;&#x5740;&#xFF0C;&#x7136;&#x540E;&#x5F97;&#x5230;&#x7EBF;&#x6027;&#x5730;&#x5740;&#x3002;linux&#x7684;&#x6BB5;&#x5F0F;&#x7BA1;&#x7406;&#x505A;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x7B80;&#x5316;&#xFF0C;&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x548C;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x6765;&#x8BF4;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x4EE3;&#x7801;&#x770B;&#x51FA;&#xFF0C;&#x5176;&#x57FA;&#x5730;&#x5740;&#x5747;&#x4E3A;0&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;&#x903B;&#x8F91;&#x5730;&#x5740;&#x5176;&#x5B9E;&#x5C31;=&#x7EBF;&#x6027;&#x5730;&#x5740;&#xFF0C;&#x56E0;&#x4E3A;&#x7EBF;&#x6027;&#x5730;&#x5740;=&#x57FA;&#x5730;&#x5740;&#xFF08;0&#xFF09;+offset=&#x903B;&#x8F91;&#x5730;&#x5740;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[per-CPU变量]]></title>
    <url>%2F2012%2F07%2F01%2Fper-CPU%E5%8F%98%E9%87%8F%2F</url>
    <content type="text"><![CDATA[&#x6BCF;&#x4E2A;CPU&#x90FD;&#x4F1A;&#x4FDD;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x56E0;&#x4E3A;CPU&#x7684;&#x6307;&#x4EE4;&#x90FD;&#x662F;&#x5206;&#x65F6;&#x590D;&#x7528;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x64CD;&#x4F5C;&#x4E0D;&#x7528;&#x9501;&#x5B9A;&#xFF0C;&#x7528;DEFINE_PER_CPU(type, name)&#x6765;&#x58F0;&#x660E;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x6700;&#x597D;&#x4FDD;&#x8BC1;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x8F83;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x67D0;&#x4E9B;&#x67B6;&#x6784;&#x7684;CPU&#x4E0A;per-CPU&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x662F;&#x53D7;&#x9650;&#x7684;&#x3002;&#x4E00;&#x822C;per-CPU&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x4F1A;&#x88AB;&#x9891;&#x7E41;&#x64CD;&#x4F5C;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x4F7F;&#x7528;&#x3002;&#x9759;&#x6001;&#x7684;per-CPU&#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;get_cpu_var, put_cpu_var&#x6765;&#x64CD;&#x4F5C;&#x8BE5;&#x53D8;&#x91CF;&#x3002;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5185;&#x6838;&#x88AB;&#x62A2;&#x5360;&#x6216;&#x5207;&#x6362;&#x5230;&#x5176;&#x4ED6;CPU&#x8FD0;&#x884C;&#xFF0C;&#x52A8;&#x6001;per-CPU&#x53D8;&#x91CF;&#x5728;&#x64CD;&#x4F5C;&#x524D;&#xFF0C;&#x6700;&#x597D;&#x7528;get_cpu&#xFF08;&#xFF09;&#x6765;&#x963B;&#x585E;&#x5185;&#x6838;&#x62A2;&#x5360;&#x3002;]]></content>
  </entry>
  <entry>
    <title><![CDATA[Linux内存分配]]></title>
    <url>%2F2012%2F07%2F01%2FLinux%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%2F</url>
    <content type="text"><![CDATA[Linux&#x5185;&#x5B58;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x533A;&#x6BB5;&#xFF1A;DMA&#x5185;&#x5B58;&#x5E38;&#x89C4;&#x5185;&#x5B58;&#x9AD8;&#x7AEF;&#x5185;&#x5B58;&#x5185;&#x6838;&#x53EA;&#x80FD;&#x5206;&#x914D;&#x4E00;&#x4E9B;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#xA0;1. kmalloc&#x4E0D;&#x80FD;&#x5206;&#x914D;&#x9AD8;&#x7AEF;&#x5185;&#x5B58;2. &#x540E;&#x5907;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x6C60;&#xFF0C;&#x5BB9;&#x7EB3;&#x4E86;&#x4EFB;&#x610F;&#x6570;&#x91CF;&#x7684;&#x5C0F;&#x5185;&#x5B58;&#x5757;&#xFF0C;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x7531;&#x5206;&#x914D;&#x8BE5;&#x7F13;&#x5B58;&#x6C60;&#x65F6;&#x6307;&#x5B9A;&#x3002;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x7684;&#x4F7F;&#x7528;&#x7EDF;&#x8BA1;&#x53EF;&#x4EE5;&#x4ECE;/proc/slabinfo&#x4E2D;&#x83B7;&#x5F97;&#x3002;3. &#x5185;&#x5B58;&#x6C60;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#xFF0C;&#x5176;&#x4F1A;&#x4FDD;&#x5B58;&#x67D0;&#x4E2A;&#x6700;&#x5C0F;&#x6570;&#x989D;&#x7684;&#x5206;&#x914D;&#x5757;&#xFF0C;&#x5F53;&#x8D85;&#x8FC7;&#x8BE5;&#x6700;&#x5C0F;&#x6570;&#x989D;&#x7684;&#x5185;&#x5B58;&#x5757;&#x88AB;&#x91CA;&#x653E;&#x65F6;&#xFF0C;&#x4F1A;&#x88AB;&#x8FD4;&#x56DE;&#x7ED9;&#x7CFB;&#x7EDF;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x6B64;&#x6570;&#x989D;&#x4E4B;&#x5185;&#xFF0C;&#x5219;&#x8FD8;&#x662F;&#x4F1A;&#x7559;&#x5728;&#x8FD9;&#x5757;&#x5185;&#x5B58;&#x6C60;&#x4E2D;&#x3002;&#x5728;&#x5185;&#x5B58;&#x6C60;&#x88AB;&#x9500;&#x6BC1;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x5DF2;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x5426;&#x5219;&#x5185;&#x6838;&#x4F1A;&#x6709;oops&#x3002;4. get_free_page&#x4EE5;&#x9875;&#xFF08;2&#x7684;n&#x6B21;&#x65B9;&#xFF09;&#x4E3A;&#x5355;&#x4F4D;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x907F;&#x514D;&#x5916;&#x90E8;&#x788E;&#x7247;5. vmalloc&#xFF0C;&#x7528;&#x6765;&#x5206;&#x914D;&#x5927;&#x5C3A;&#x5BF8;&#x5185;&#x5B58;&#x3002;&#x56E0;&#x4E3A;&#x5176;&#x4F1A;&#x5EFA;&#x7ACB;&#x9875;&#x8868;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x7684;&#x7269;&#x7406;&#x5185;&#x5B58;&#x53EF;&#x80FD;&#x4E0D;&#x8FDE;&#x7EED;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x7684;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x4E00;&#x5B9A;&#x662F;&#x8FDE;&#x7EED;&#x7684;&#x3002;6. &#x5185;&#x6838;&#x751A;&#x81F3;&#x5141;&#x8BB8;&#x5728;&#x5F15;&#x5BFC;&#x65F6;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x5F97;&#x5DF2;&#x91C7;&#x53D6;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x5F15;&#x5BFC;&#x65F6;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x662F;&#x6CA1;&#x529E;&#x6CD5;&#x7531;&#x5185;&#x6838;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x6A21;&#x5757;&#x7BA1;&#x7406;&#x7684;&#xFF0C;&#x5176;&#x63A5;&#x53E3;&#x662F;alloc_bootmem_xxx&#x5185;&#x5B58;&#x6280;&#x672F;&#x7684;&#x533A;&#x522B;&#xFF1A;1. kmalloc&#xFF0C;__get_free_pages&#xFF0C;vmalloc&#x5747;&#x5206;&#x914D;&#x7684;&#x662F;&#x865A;&#x62DF;&#x5730;&#x5740;&#x3002;&#x524D;&#x4E24;&#x4E2A;&#x7684;&#x5730;&#x5740;&#x662F;&#x76F4;&#x63A5;&#x7EBF;&#x6027;&#x6620;&#x5C04;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x865A;&#x62DF;&#x5730;&#x5740;&#x548C;&#x7269;&#x7406;&#x5730;&#x5740;&#x662F;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x7684;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x662F;&#x901A;&#x8FC7;&#x9875;&#x8868;&#x95F4;&#x63A5;&#x6620;&#x5C04;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5206;&#x914D;&#x65F6;&#x8F83;&#x6162;&#xFF0C;&#x4E14;&#x4E0D;&#x548C;&#x7269;&#x7406;&#x5730;&#x5740;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;2. vmalloc&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x539F;&#x5B50;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x662F;&#x7528;kmalloc(GFP_KERNEL)&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x7528;GFP_ATMIC&#x6807;&#x5FD7;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x4F11;&#x7720;&#x3002;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>内存管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[可撤销性]]></title>
    <url>%2F2012%2F06%2F12%2F%E5%8F%AF%E6%92%A4%E9%94%80%E6%80%A7%2F</url>
    <content type="text"><![CDATA[&#x4F60;&#x6B63;&#x5728;&#x5F00;&#x53D1;UNIX&#x8F6F;&#x4EF6;&#xFF1F;&#x54EA;&#x4E00;&#x79CD;&#xFF1F;&#x4F60;&#x662F;&#x5426;&#x5904;&#x7406;&#x4E86;&#x6240;&#x6709;&#x53EF;&#x79FB;&#x690D;&#x6027;&#x95EE;&#x9898;&#xFF1F;&#x4F60;&#x6B63;&#x5728;&#x4E3A;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x7248;&#x672C;&#x7684;Windows&#x505A;&#x5F00;&#x53D1;&#xFF1F;&#x54EA;&#x4E00;&#x79CD;&#x2014;&#x2014;3.1,95,98&#xFF0C;NT&#xFF0C;CE&#xFF0C;&#x8FD8;&#x662F;2000&#xFF1F;&#x652F;&#x6301;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x6709;&#x591A;&#x96BE;&#xFF1F;&#x5982;&#x679C;&#x4F60;&#x8BA9;&#x51B3;&#x7B56;&#x4FDD;&#x6301;&#x8F6F;&#x548C;&#x4E0E;&#x67D4;&#x97E7;&#xFF0C;&#x4E8B;&#x60C5;&#x5C31;&#x5B8C;&#x5168;&#x4E0D;&#x56F0;&#x96BE;&#x3002;&#x5982;&#x679C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6709;&#x7740;&#x7CDF;&#x7CD5;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x9AD8;&#x5EA6;&#x8026;&#x5408;&#x4EE5;&#x53CA;&#x786C;&#x7F16;&#x7801;&#x7684;&#x903B;&#x8F91;&#x6216;&#x53C2;&#x6570;&#xFF0C;&#x4E8B;&#x60C5;&#x4E5F;&#x8BB8;&#x5C31;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x3002;&#x5F97;&#x58A8;&#x5FD2;&#x5C14;(Demeter)&#x6CD5;&#x5219;&#xFF1A;1.&#x8C03;&#x7528;&#x5C5E;&#x4E8E;&#x7C7B;&#x672C;&#x8EAB;&#x7684;&#x51FD;&#x6570;2.&#x8C03;&#x7528;&#x901A;&#x8FC7;&#x53C2;&#x6570;&#x4F20;&#x5165;&#x7684;&#x51FD;&#x6570;3.&#x8C03;&#x7528;&#x5728;&#x51FD;&#x6570;&#x4F53;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#xFF08;&#x5305;&#x62EC;new&#x51FA;&#x6765;&#x7684;&#x548C;&#x6309;&#x503C;&#x5B9A;&#x4E49;&#x7684;&#xFF09;&#x7684;&#x51FD;&#x6570;&#x8FD9;&#x4E00;&#x6CD5;&#x5219;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x5F88;&#x591A;&#x53EA;&#x6709;&#x5305;&#x88C5;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x505A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x800C;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x5904;&#x7406;&#x3002;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x6027;&#x80FD;&#x7684;&#x727A;&#x7272;&#xFF0C;&#x5728;&#x5FC5;&#x8981;&#x65F6;&#x5FC5;&#x987B;&#x505A;&#x51FA;&#x53D6;&#x820D;&#x3002;&#x4F46;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x54F2;&#x5B66;&#xFF0C;&#x5FC5;&#x987B;&#x7262;&#x8BB0;&#x3002;]]></content>
      <tags>
        <tag>读书笔记</tag>
        <tag>程序员修炼之道</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[资源配平]]></title>
    <url>%2F2012%2F06%2F11%2F%E8%B5%84%E6%BA%90%E9%85%8D%E5%B9%B3%2F</url>
    <content type="text"><![CDATA[&#x914D;&#x5E73;&#xFF1A;&#x4E00;&#x4E2A;&#x5206;&#x914D;&#x6CE8;&#x5B9A;&#x4E00;&#x6B21;&#x91CA;&#x653E;C++&#xFF1A;&#x4F9D;&#x9760;&#x6784;&#x9020;&#x51FD;&#x6570;&#x548C;&#x6790;&#x6784;&#x51FD;&#x6570;&#xFF0C;&#x81EA;&#x52A8;&#x91CA;&#x653E;&#xFF0C;&#x800C;&#x907F;&#x514D;&#x624B;&#x52A8;&#x64CD;&#x4F5C;&#x548C;&#x4E11;&#x964B;&#x7684;&#x4EE3;&#x7801;JAVA&#xFF1A;&#x4E00;&#x53E3;finally&#x5B50;&#x53E5;&#xFF0C;&#x53EA;&#x8981;&#x7528;try&#xFF0C;&#x4E0D;&#x7BA1;&#x53D1;&#x4E0D;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x6539;&#x5B50;&#x53E5;&#x90FD;&#x4F1A;&#x88AB;call&#x5230;&#x9488;&#x5BF9;C&#x8FD9;&#x6837;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x4E3A;&#x6BCF;&#x4E2A;&#x91CD;&#x8981;&#x7ED3;&#x6784;&#x7F16;&#x5199;&#x81EA;&#x5DF1;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x63D0;&#x4F9B;&#x76F8;&#x5E94;&#x7684;&#x5206;&#x914D;&#x548C;&#x89E3;&#x9664;&#x63AA;&#x65BD;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x662F;&#x4E3A;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#x5BF9;&#x8C61;&#x5B9E;&#x73B0;&#x5F15;&#x7528;&#x8BA1;&#x6570;]]></content>
      <tags>
        <tag>读书笔记</tag>
        <tag>程序员修炼之道</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello world！]]></title>
    <url>%2F2010%2F10%2F02%2Fhello-world-trashed%2F</url>
    <content type="text"><![CDATA[Welcome to WordPress.com. This is your first post. Edit or delete it and start blogging!]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[登记啦^_^]]></title>
    <url>%2F2009%2F11%2F06%2Fe7-99-bb-e8-ae-b0-e5-95-a6%2F</url>
    <content type="text"><![CDATA[]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[购书计划]]></title>
    <url>%2F2009%2F05%2F13%2Fe8-b4-ad-e4-b9-a6-e8-ae-a1-e5-88-92%2F</url>
    <content type="text"><![CDATA[明朝7二月河的三帝系列银河英雄传说李自成加起来得有小30本了，够我看好些年了先这么定了，一套套买]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[10月19日]]></title>
    <url>%2F2008%2F10%2F19%2F10-e6-9c-8819-e6-97-a5%2F</url>
    <content type="text"><![CDATA[今晚一如往常的看bbs，看到chinese版聚的帖子。对chinese的人气早有耳闻，只是一直没有去浏览。 我本对文学有些兴趣，不排斥读书，也好些古文之类，读诗也不过是在写字之余略吟几首。很向往文采斐然的人，什么样的文字都可以写的很优美。说这些，又显得有点叶公好龙了。大学以来，或者高中以来，甚至初中，书读的是很少的。偶尔会借几本小说看看，没有看过诗集，没有读过思辨的文字，书法方面也没读过名家的书论，只有小说，而且看完就忘记了。如果说时间都是花来学习了，或许也不是我所愿，但至少也有所得。然而也非如此，大段的时间都是人浮于事，浑浑噩噩。也不至于后悔，只是可以更心平气和一些，把时间花在一些更有意义的事情上。 可是话又说回来，当下我也不知道哪些是更有意义的，至少chinese版我会常去潜水的。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[3月22日 23:35]]></title>
    <url>%2F2008%2F03%2F22%2F3-e6-9c-8822-e6-97-a5-2335%2F</url>
    <content type="text"><![CDATA[又在实验室厮混了一天。晚上十一点，徒步回寝室。 刚下过雨，三月的风吹过来，夹杂了细雨，还是有些冷的。没有月亮，路灯很亮，没有行人，只有我。 为了让CD不至于放坏了，路上开始听。偶尔听到张，范合唱的别让情两难。这是一个电视剧的片尾曲，片首曲是华仔的你震撼了我的心灵，片名已经记不得了。只记得大概是小学末，初中初的时候安徽台放的。范文芳和万梓良主演的。记得书记好像也看过。 那是夏末的季节。外公还没有去世。那时我爱唱你震撼了我的心灵，粤语的。外公总是呵斥我，“歌都不好好唱！” 而我继续：“奔奔波波就像人生，多多少少各自成怨恨。。。。”。 十来年了。外公也去世快十年了。十年以后，不知道我会听到哪首歌，想到今天。 寝室太热了，一身汗。今天肚子不舒服，明天还要起来看球。笔记本电源丢在实验室了。快十二点了，又是一天了]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[谨以此文献给陪伴我五年的破车]]></title>
    <url>%2F2007%2F10%2F26%2Fe8-b0-a8-e4-bb-a5-e6-ad-a4-e6-96-87-e7-8c-ae-e7-bb-99-e9-99-aa-e4-bc-b4-e6-88-91-e4-ba-94-e5-b9-b4-e7-9a-84-e7-a0-b4-e8-bd-a6%2F</url>
    <content type="text"><![CDATA[本礼拜的周一的晚上，在东川路轻轨站的对面，陪我五年之久的那辆破车终于没有守住最后的贞操，失身于一个傻贼之手。 万般没有想到的是，破旧如我的车，也会有人惦记。看来革命还差很远，老胡仍需努力，这贼都穷疯了。 现在每天徒步于实验室、食堂、校门口、寝室，我开始无限怀念我那辆，一骑就嘎吱作响，一加速就掉链子，破旧不堪，锈迹斑斑的，购于永平路，表兄亲手移交，原价220元的黑色破车。又不知，如今被卖了几钱，又躲在哪里呜咽了。 另：相比起那辆破车，我更舍不得的是，母亲亲手所织的，毛线车座垫套，亦是几经寒暑了，颇有不舍]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[实习第一天]]></title>
    <url>%2F2007%2F10%2F11%2Fe5-ae-9e-e4-b9-a0-e7-ac-ac-e4-b8-80-e5-a4-a9%2F</url>
    <content type="text"><![CDATA[换了个地方，换台电脑，继续上网。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[从提香到戈雅]]></title>
    <url>%2F2007%2F09%2F23%2Fe4-bb-8e-e6-8f-90-e9-a6-99-e5-88-b0-e6-88-88-e9-9b-85%2F</url>
    <content type="text"><![CDATA[从提香到戈雅 从文艺复兴的装饰主义到巴罗克再到洛可可 今日去看上博的展览，西班牙普拉多博物馆的绘画展，算是附庸一下风雅 完全不懂西方的画，只知道用油画出来的，还是很像的 喜欢洛可可的精致与华丽，不喜欢装饰主义的阴沉，巴罗克的气势恢宏看起来比较有距离，还是最后几幅戈雅的草稿让我更想去把玩。不过应该把我卖了也买不起吧。。。 去的时候下雨，展厅人很多，还把伞给丢了，出来的时候太阳很烈，又热得不行 还好现在坐在寝室了 休息休息一下~]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[down]]></title>
    <url>%2F2007%2F08%2F16%2Fdown%2F</url>
    <content type="text"><![CDATA[心情低落 今天在寝室窝了整整一天，除了去四楼打了一瓶洗澡用的热水]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[再回实验室]]></title>
    <url>%2F2007%2F08%2F13%2Fe5-86-8d-e5-9b-9e-e5-ae-9e-e9-aa-8c-e5-ae-a4%2F</url>
    <content type="text"><![CDATA[回去了不到一个月（差一天），前天下午又回到了上海。在寝室捣持了两天，今天又再次回到实验室。来上海之前，看中央台的天气预报，上海一直是35以上的高温，我想这回傻X了。没想到前天回来，温度就开始下降，今天已经巨凉快了，风吹的，真爽！——不过后面应该还是会热吧，我想。回去了不短不长的30天，也是说充实也不充实，说无聊也挺忙的30天。前十天，东奔西跑，调查市场，查阅资料，最终买了一台冬天用比较合适的宏基的笔记本。接下来的20天，用这台笔记本稍微的学习了一下C++，不过老板布置的任务一点还没碰呢，惭愧惭愧——弄得我现在都不好意思去见他老人家。 去了两次采石公园，那里有很多童年的回忆。不过现在已经翻修的大变样了，童年的回忆也越来越少。现在的采石公园已经是国家4A级景区。亭台楼阁，小桥流水，宽阔而起伏的草地，斑驳而沧桑的石砖路面。竹林葱郁，蝉声鸣鸣。第一次去，逛了一下新开发的进门右拐的部分，很漂亮，挺有感觉，不过也只是浅尝辄止。第二次，我是一个雨后的中午去的，阳光有一点刺眼，不过倒不是很热。走在非常熟悉的鹅卵石的小路，曲径通幽。那是为数不多的，我很熟悉的事物了。去了早就如雷贯耳，却一直缘悭一面的江浦草堂——林散之纪念馆。看了他很多成熟的，不成熟的作品，用过的器物。说实话，我还是喜欢他早期的作品，潇洒而飘逸，又不失刚强。晚期的有很多的淹留，又有很多的佛法，内容是很多，确是我一时吃不下来的。午后的纪念馆只有我一个人驻足，还有一个年轻的管理员在一进屋的门口安静地练着字，另外两个在各自所管的房间里打盹。屋外有时断时续的蝉鸣，屋内有清凉的空调，而我很冒昧地破坏了一个人的美梦，帮土豆买了一把锈着二美对弈图的绢制团扇，踏着阳光而去。在三进的江浦草堂之侧有老人的墓碑，松柏掩映，青苔满阶。我也像模像样地鞠了三躬，希望这位当代的草圣能保佑我书艺大进。听到有人声的喧闹，我赶紧类似于逃，却又装作信步游缰地走出了这座颇有些历史的地方了（好像也只有20来年，不过是在我刚认识这里时便有了的）。 路过一片藕塘，穿过一条爬满藤蔓的长廊，身边的乱石和汉白玉石桥已无暇顾及，再穿过万竹坞，我知道很快就是阔别已久的太白楼了。这里从来都是采石公园所大力宣传的旅游中心，据说现在在这里每年还有国际吟诗节，甚至连中央都会报道。这次不凑巧的是主建筑太白楼在装修，李白纪念馆也就大为逊色了。那里只有一些无关痛痒的东西，一些李白事迹的记载。同样是三进的老房，后面的墙上镶了一块很大的刻着将进酒的汉白玉，书法是老毛的。身份是很显贵，不过书法确实也很好，很配合这首诗的跌宕与大气。再深处还有一座小亭，里面也有一幅书法，是一幅楹联，印象已经不是很深了，只记得此兄名字有点怪。 此行的目的有很大一部分，就是要去隔壁的一个纪念品商店买毛笔。还好它开着，让我能勉强的不虚此行。小时候经常来买东西，毛笔阿，墨啊，篆刻用的石头阿，又便宜又好用，颇得我的欢心。若干年没来过了，说实话，行前还颇有一些担心。进去了，还是那个破破烂烂的小房间，没有空调，只有一个很不热心的30多岁略显一些臃肿的男性服务员，在“心无旁骛”地看着一本武侠小说，只有一台破旧的电风扇的声音。货物也大不同于往昔，多了一些乱七八糟的ms是赶时髦的小饰品，不过占绝大多数的还是我熟悉的那些事物（非文房四宝，一些可作为留念的书籍，一些当地名人的书画作品）。我要的东西倒好像没有以前多了——还是因为我长大了，长高了，看到原来一样的东西，却以为少了，小了。想买一支，好使的，笔锋不会分叉的狼毫笔，不过只有两种：一种8.4，一种19块。 “笔拿给我看一下” “哪个” 这位仁兄服务态度还成，至少脸不臭，话不冷，有那么点热心。 “这两种都拿给我看一下”（我尽量以比较土的当地话——虽然我也不大会说，那个调调我还成） 两种一共5支，贵的两支笔头都掉了，便宜的三支有两支笔头也松动了。我抱着豁出去的心理，无可奈何之地付了8块4。 没有上翠罗山——虽然那里有很多景致，也可能是变化最大的地方，不过我有一些疲倦了，留着下次来消化吧，有可能是春节了。坐在满是蚂蚁的长椅上休息，看着一堆ms是外地的美女，光鲜亮丽，衣着时髦，皮肤白皙，身材姣好。。。。。。等她们上车了，车又缓缓地开走了，我意识到了蚂蚁兄的存在。于是，我想，该回去了。 走在那条同样很熟悉的公园的公路上，看着潮涨的那条名为锁溪，实通长江的河，看着河对岸用草地弄出来的几个大字（好像是国家什么什么风景区，具体忘记了），看着那片如茵的草地（小时候来外婆家过寒暑假的早上，都会拖懒惰的表哥，再带上几个小朋友，来这里踢球或打羽毛球），一切都是熟悉而又不熟悉的，现在我想起了一首歌，最熟悉的陌生人，难道就是这种感觉？或者叫最熟悉的陌生公园吧。 再来说说那支我无可奈何的毛笔吧。出乎我的意料的是，那支笔真的还挺好写的，笔锋很好，虽然有时候写的快的话会分叉，不过笔锋真的很尖和健。本来这次回来写字的热情不高，回去20天就写过一次——一来是因为那个纸不好写，主要还是因为笔不好，弄得我很没有欲望。用了这支新笔临了初月，姨母和丧乱，感觉好极了（虽然感觉好，限于水平问题，又是初次临写，这个写的还是，啊，有待讨论）。于是，有了欲望，就连续写了几天（大概4天，然后就回来了）。看来我童年的记忆没有错，物美而又价廉，看来今年寒假我大概还会去光顾吧。 另：昨天看我猜，看到一句话，叫“冲拖泡盖送”。虽然是娱乐节目，有点不登大雅之堂，不过感觉还是挺对的。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[又放假了]]></title>
    <url>%2F2007%2F07%2F07%2Fe5-8f-88-e6-94-be-e5-81-87-e4-ba-86%2F</url>
    <content type="text"><![CDATA[其实早放假了，在考完英语之后，数天之前。不过研究生到底是研究生，完全没有放假的感觉。每天校园里大四的疯子们倒是提醒了我，原来又已经是七月了。 前几天去买了12号的火车票，还有不到一个礼拜就可以回家了，归心似箭阿，什么事儿都不想做。可恶的是，下个礼拜老板还要开会。唉。。。 今年的上海挺热的，真的。本来以为现在住到面南的寝室，可以享受一下自然风。真是naive啊，门开的再大，那个破风根本就不来。没办法，多实验室纳凉吧。想想到底还是研究生好啊，还有有空调的实验室。不过实验室空调吹着又冷，好吧，我把尘封许久的本科校服找出来了。不过关节还是吹得疼。唉，忘记有关节炎了，好像很小的时候就有了。毛病真多，作~~ 还好12号我就滚了 研一过去了。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[输了2.5目。。。。]]></title>
    <url>%2F2007%2F06%2F20%2Fe8-be-93-e4-ba-862-5-e7-9b-ae-e3-80-82-e3-80-82-e3-80-82-e3-80-82%2F</url>
    <content type="text"><![CDATA[最近开始混清风，已经9胜27负了-__-b 虽然输棋是家常便饭，不过2.5目还是让我小小郁闷了一下（看来对方也不怎么样）]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[感随]]></title>
    <url>%2F2007%2F06%2F01%2Fe6-84-9f-e9-9a-8f%2F</url>
    <content type="text"><![CDATA[我不知道我这样是傻还是什么， 我只知道我要做我认为正确的事 我不会那么容易放弃的 ps：今天是六一，想到以前的儿童节，和爸爸一起上班，呆在他单位里无聊的一天。于是，现在的儿童节对我来说，又能意味什么呢？]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[不得不说，真没意思]]></title>
    <url>%2F2007%2F05%2F23%2Fe4-b8-8d-e5-be-97-e4-b8-8d-e8-af-b4-ef-bc-8c-e7-9c-9f-e6-b2-a1-e6-84-8f-e6-80-9d%2F</url>
    <content type="text"><![CDATA[看了炒得沸沸扬扬的，如雷贯耳的“满城尽带黄金乳”。 感觉剧本应该还是不错地，不过不得不说，真是烂片 到处是视觉冲击，不管是一对对浑圆的胸部，还是博大的激战场面，还是精致的画面感。我想问的是，这是说的中国的事吗？ 按照各位大牌的黄皮肤，和说的半文半白的中国话，应该是中国的事。不过我感觉更像是魔戒之类的魔幻片，吵吵闹闹。 看来老张，老陈他们是误入歧途了，拍的片越来越不像中国人拍的了，就想着迎合老外的胃口。 太俗了！我替他们感到相当的遗憾！]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[平淡如水，却有点回味]]></title>
    <url>%2F2007%2F03%2F04%2Fe5-b9-b3-e6-b7-a1-e5-a6-82-e6-b0-b4-ef-bc-8c-e5-8d-b4-e6-9c-89-e7-82-b9-e5-9b-9e-e5-91-b3%2F</url>
    <content type="text"><![CDATA[余华这个名字，好像很久以前我就听说过。知道是一个作家，具体写过什么，就一概不知了。直到去年偶尔见书记电脑里有余华的电子书，才知道，《兄弟》、《许三观卖血记》，《活着》。。。。。。都是出自余华之手。于是暑假买了一本《兄弟》，拜读了一下。没什么感觉，情节也有些奇怪，不是那么自然，说了一些丑恶的事和为了衬托丑恶的一些美好的事，总而言之我感觉到的就是丑恶，龌龊。文笔有点像小学生，无峰无谷，无跌宕无起伏，一任自然，就像白开水。充满了短句，读起来倒是很轻松，不咬口倒是真的，难道这就是传说中的平民作家？ 今年寒假又借了《许三观卖血记》，据说是余华的名作——是不是成名作，就不知道了。对于语言还是一样的平淡，毫无词藻。不过感觉起来，题材倒是挺有趣的。讲的是一个叫许三观的人，卖了很多次血。除了第一次是觉得好玩——大概是作为铺垫，把卖血这样的赚钱方式介绍给了许三观，之后的若干次都是被生活所迫，甚至期间有几次，差点要了小命。以前一提到血，总归是要和血腥、生死、恐怖联系到一起的，而书中的人却视之为稀松平常。这大概便是底层人民的无助吧，因为他们除了血，其他身上也没别的值钱的东西了。这和被生活所迫而卖身养家的风尘女子有异曲同工之妙。不过卖身的题材估计已经被写滥了吧，卖身也不如血更有冲击力，而且一些卖身的女人，不一定是为生活所迫，所以难免让人有龌龊之感，所以卖血这个题材还是相当精彩的。 另外读余华的书还有个好处，就是不会走火入魔，不会陷进去，因为再痴迷的读者，也能一眼看出他的故事完全是杜撰出来的，有一些生活基础，不过真实性确实太差。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[英国人的幽默]]></title>
    <url>%2F2007%2F02%2F28%2Fe8-8b-b1-e5-9b-bd-e4-ba-ba-e7-9a-84-e5-b9-bd-e9-bb-98%2F</url>
    <content type="text"><![CDATA[第一本看的书是土豆的，名字叫做《普罗旺斯的一年》。看这本书之前，孤陋寡闻的我愚蠢的认为普罗旺斯是个什么好吃的，或者是个什么酒店之类的东西。后来才知道，原来只是法国的一个地名，一个法国的农村而已，不过名字确实挺好听的，而且能钩起我的食欲，且据说风景也不错。 书是很精美的，每一页都有彩色的镶边图案。全书分为十二个月逐个的介绍，每个月的开始都有一页很精美的插图，和一小段很诗意的文字。整本书都在介绍一对侨居普罗旺斯的一对英国夫妇的见闻和他们与法国人打交道的一些小故事。很琐碎，也没什么情节，不过看着却很轻松，大概是他的幽默的文风一直吸引着我吧。同样的风格，我在看哈里波特的时候也发现了（哈里波特的作者jk罗琳也是英国的）。所以我总结为，这种幽默应该是英国人固有的幽默吧——一些很稀松平常的事，总是被写得很可笑；一些很普通的人，在书里都很可爱。 看完这本书，给我留下深刻印象的，除了英国人的幽默，就是法国人的贪吃和不守时了。不过让我想不通的是，西餐里就那点原料，能做出什么样的可口美味呢？估计这俩英国佬也没见过啥市面，他要来中华上国，估计就知道什么叫美食了，或者说他就知道天下美食到底有多少种了。对于欧洲人的慢节奏早有耳闻，不过从具体的方面了解到他们是如何的不守时却还是第一次。这两夫妇也是好说话，要换作某些中国的急性子泼妇，估计那些搞装潢的一个都不用混下去了，更别说还好吃好喝招待，临了还弄了一个party。看来英国人不仅幽默，涵养的功夫也是了得阿。 书已经还给土豆了，希望以后还有机会看到传说中的《永远的普罗旺斯》]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[读书]]></title>
    <url>%2F2007%2F02%2F28%2Fe8-af-bb-e4-b9-a6%2F</url>
    <content type="text"><![CDATA[很久没来这里了，反正是写给自己看的，也没必要天天都写。上次来好像还是海底光缆崩溃之前，这一晃又是一个新的学期开始了。 寒假在家闲来无事，弄了几本书看了看，大部分是小说，还带了一本专业书，也还装模作样的翻了几页，不过闲书还倒是都看完了。因此，寒假曾有几次想在space上写一点读书笔记之类的东西。不过想想也荒唐，网吧里人声嘈杂，还不断地吸着二手烟怎么可能写得出什么读书笔记。现在有机会了，只不过那些书也忘得差不多了。反正写一点是一点吧。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[大腕经典台词各种版本 - [网摘]]]></title>
    <url>%2F2007%2F01%2F05%2Fe5-a4-a7-e8-85-95-e7-bb-8f-e5-85-b8-e5-8f-b0-e8-af-8d-e5-90-84-e7-a7-8d-e7-89-88-e6-9c-ac-e7-bd-91-e6-91-98%2F</url>
    <content type="text"><![CDATA[《原版》 一定得选最好的黄金地段，雇法国设计师，建就得建最高档次的公寓！电梯直接入户，户型最小也得四百平米，什么宽带呀，光缆呀，卫星呀能给他接的全给他接上，楼上边有花园(儿)，楼里边有游泳池，楼子里站一个英国管家，戴假发，特绅士的那种，业主一进门(儿)，甭管有事(儿)没事，(儿)都得跟人家说may I help you sir(我能为您作点什么吗?)？一口地道的英国伦敦腔(儿)，倍(儿)有面子！社区里再建一所贵族学校，教材用哈佛的，一年光学费就得几万美金，再建一所美国诊所(儿)，二十四小时候诊，就是一个字(儿)贵，看感冒就得花个万八千的！周围的邻居不是开宝马就是开奔驰，你要是开一日本车呀，你都不好意思跟人家打招呼，你说这样的公寓，一平米你得卖多少钱？我觉得怎么着也得两千美金吧！两千美金那是成本，四千美金起，你别嫌贵还不打折，你得研究业主的购物心理，愿意掏两千美金买房的业主，根本不在乎再多掏两千，什么叫成功人士你知道吗？成功人士就是买什么东西，都买最贵的不买最好的！所以，我们做房地产的口号(儿)就是，不求最好但求最贵！ 《MM版》 一定得选最漂亮的女孩，特有气质的那种。泡，就泡最骄傲最矜持的女孩，情书直接送到她手中。字数最少也得比资本论多八九倍，什么雀巢啊，德芙啊，梦特娇啊，能送的都给她送过去。早上递热牛奶，晚上奉鲜橙汁,包里还藏着一支玫瑰，带着水滴，倍儿精神的那种。每天堵着她，甭管她身边有人没人都得说：“见君日短，思君日长”一口地道的巴黎流氓腔，倍儿动人。她的生日再开个烛光晚宴，酒水用外卖的。光小费就得给百八十块，再作完全陶醉状。二十四小时都跟着她。就是一个字，爱！眨个眼都得看她几百回，来得人不是傍着马子就是跨着小蜜的，你要是带个同学来你都不好意思跟人家打招呼。你说这样的泡妞法，一年能泡多少个吧，我觉得怎么也得六七个吧。六七个？？那是灾年，起码十二个，你别嫌多，还不撞车。你得研究咱们的素质程度，真正博爱的。根本不在乎一月换一个。什么叫爱情杀手你知道吗？爱情杀手就是泡什么妞都只泡最好的，不泡好泡的。所以我们泡MM的口号是：不求好泡，但泡最好！ 《CS版》 一定得选沙二这张图，兄弟几个一起进。当就当悍匪，买枪一定得快。速度最次的也得比条子快上几秒，什么重甲啊、套雷啊、沙鹰啊能带的全带上。中门有狙击手，A门有冲锋队， B区洞口站一悍匪，寄红头巾长大胡子那种条子刚进洞，甭管炸的着炸不着都得扔颗雷大吼一声：Fire in the Hole! 一口地道的沙漠土匪腔 ，倍儿有男人味 。扔完接着回去买什么闪眼啊、炸子啊全伺候着，光买雷就得花个几千块，甭看哥们跟个二道贩子似的跑上跑下，就为一个字“爽”，拿雷都得炸死七八个。冲A门的兄弟,你要是拿把mp5你都不好意思和哥几个一起冲！你说这样的战队一关得杀多少？我觉得怎么也得六七个吧。六七个？？那是是碰上鼠标不好使！ 最少也的得办 100多口子。你还别不服哥几个还都不作弊，你得研究玩CS人的心理，玩CS玩的好的根本就不愿意在局域网切，什么叫牛X高手你知道吗？高手就是玩CS只上互连网废老外不在网吧杀菜鸟，所以我们玩CS的口号就是：不当高手，只虐菜鸟！ 《宿舍版》 一定得选最差的成都地段，雇天大设计师，建，就得建最低档次的宿舍，楼梯直接入户，户型最大的也就14平米，什么电话呀，局域网，有线啊，能不给他接的全不接上，楼上面没阳台，楼里面没水房，楼门口站一个四川老伯，戴一胸牌特傻B的那种，同学一进门甭管有事没事都得给人说：干啥子三？！一口地道的四川味，倍没面子。楼里面再建一个小卖部，方便面用康师傅的，买包洋蜡都得花块儿八毛的，再建一所租盗版盘的，二十四小时营业，就是一个字，贵！看个《大腕》都得花个一两块，周围的同学不是骑自行车就是登三轮，你要是走路呀，人家都不好意思跟你打招呼，你说，这样的宿舍一年得多少钱？我觉得怎么着也得五百块钱吧？五百！那是前年！八百块钱起，你别嫌贵，还不给你住，你得研究现在学生的住房需求心理，愿意花五千块钱上学的学生，根本不在乎这八百块钱。什么叫大学生，你知道吗？大学生就是住什么房子都是被迫的，不是自愿的！所以，我们建宿舍的口号就是：不求住得好，但求住得多！！！ 《娶妻版》 一定得选最有身份的，怎么也得美国名牌学校硕士毕业。找就找罪漂亮最有身段儿的，在学校就是校花。身高最少也得1米70 。什么钢琴呀，跳舞呀，卡拉OK呀，一般人能会的全会。还得特有脾气，动不动就象训孙子一样训你一把。要找这么一主儿，你得早上5：00起床准备早餐，晚上还得早早回来做饭，做好饭就站楼门口，匝一围裙，特恭敬那种。等她一进门(儿)，甭管有事(儿)没事(儿)都得跟人家说：阿拉能为侬做点啥不。一口地道的上海男人腔(儿) ，倍(儿)有面子，有事没事的就出去玩，住总统套房，一年光住HOTEL就几万美金，老婆这排场那应酬的，一天二十四小时花钱，就是一个字(儿) 贵，光香水儿就得花个万八千的。现在这行市你不这么着你被人瞧不起，周围的邻居不是泡影星就是彪歌星，你要是找一日本妞呀，你都不好意思跟人掖蛘泻?你说这样的老婆，一天你得达多少钱。我觉得怎么着也得两千美金吧，两千美金？？那是结婚十年后，四千美金起。你别嫌贵还不打折，你得研究单身汉的择偶心理，愿意一天掏两千美金供老婆的主，根本不在乎再多掏两千。什么叫犯贱你知道吗？就是找老婆时，都找最难养的，不找最好养的！！ 《抗日版》I 一定要选最好的袭击目标，雇塔里班恐怖设计大师。什么东京呀横滨呀京都呀，能炸的全都给他炸了，干就干惊天动地的恐怖事业。用中国最新型的轰炸机，个头比航母还大三倍，导弹呀，核弹头呀，能挂的全给他挂上，原子弹最少也得挂百八十个，你要是挂普通炸弹，你都不好意思跟人家打招呼，轰炸机机长用阿富汗人，头上蒙一头巾，上面加一头圈，特野蛮的那种，到了日本上空，甭管有事没事，他都得跟人家日本人说：“May I help you sir？”一口地道的阿拉伯腔，倍有面子，你说这样的轰炸机一次能炸死多少日本人？我觉的怎么也得十来万吧，十来万？那还得是当场死亡，到医院死亡的还不算，你还别嫌多，还不打折，就一字：狠！你得揣摸日本人的心理，经受过原子弹打击的日本人，根本就不在乎再死个十万八万的，什么叫日本人你知道吗，真正的日本人就是不挨炸难受，炸了倒痛快！所以我们对日恐怖主义的口号就是“不求最准，但求最狠！” 《抗日版》II 一定得选最好的黄金地段，雇中国科学家。炸弹造就得造最大最狠的，飞机直接投过去，杀伤力最小也得上千平米。什么红外制导呀，自动跟踪呀，卫星定位呀，能给他接的全给他接上。上边还得写上字，“看你还牛B”，上面还要贴几张照片，象马家爵那样，特狠的那种，以后日本人一看见中国人甭管有事，没事，都得说“爷爷！我服了。”一口地道的日本三孙子腔(儿) ，倍(儿)想抽丫的。原子弹上再绑几颗导弹，导弹用伊拉克的。就是不爆炸砸也得砸死几千人，再派恐怖组织包围，二十四小时待命，就是一个字(儿) 狠！光吓就得吓死万八千的，日本的军队不是逃跑就是倒戈，你要是说你还是日本人啊，你都能被人用B4弹死。你说这样的战争，得弄死丫多少人？我觉得怎么着也得两千多万吧。两千多万？？那是动手前吓死的，四千多万起，你别嫌多，还不打折，你得研究中国人的反日心理，觉得杀两千万还不够的中国人。根本不在乎再多杀两千万，什么叫日本人，你知道吗？日本人就是怕什么，都怕最狠的，不怕最仁的，所以，我们弄死日本人口号(儿)就是“不求最仁，但求最狠！” 《PDA版》 一定要选最新的操作系统，安一个全钛金属外壳。做就要做最贵的掌上电脑。机器里外全是接口，怎么也得十来个吧，什么红外、蓝牙、记忆棒呀，能安的全都给安上。CPU怎么也得是P4级别的，还得是inter专门为咱们设计的。每次开机的时候，7寸彩屏上蹦出一个美国小子，穿夹克，戴个近视镜的那种，不管你点那儿，有事没事他就给你来一句：“WELLCOME TO MICROSOFT”。真正的三维环绕立体声，倍儿有面子。配上两根纯金的多功能触笔，还能当手电筒用，光这根笔的设计费就得几万美金。再安上无线宽带100M网卡，二十四小时随地上网，网费就是一个字儿－－贵！发条短信就得十块八块的，你要还是用CF猫电话上网，都没法在QQ上跟人聊天，你说这种掌上电脑一台得买多少钱？“我觉的得怎么着也得五千吧？”五千？！那是成本！标配一万，全配一万八。你还别嫌贵，还不打折。你得研究蜥蜴迷的心理，什么叫真正的蜥蜴迷你知道吗？真正的晰蜴发烧友是机器越贵，越要攒钱去买！“为什么呀？”废什么话呀，你知道联想天玑为什么火不了吗？！所以，我们作PDA的厂家的口号就是：不求产品最好，但求产品最贵！！！ 《网络勾狼版》 一定得起最吸引人的名字，跟着琼瑶小说学。上站就上男人最多的聊天室，直接悄悄话招呼，动作指令背的倍儿熟，什么//kiss、//love、//ai，能用全都给他用上，套出他信箱，再让他QQ加你，QQ的头像要选好，大眼睛，特纯情那种，有事没事都要说：“你怎么才来呀，我自己好无聊呀。”还要叫加个亲嘴符号:* 倍儿煽情。时不常跟他二人世界，要用耳麦聊天，一天光说‘我想你了’就得几十遍。再把照片发给他，就是一个字：靓。别人都是明星照，写真集，你要是弄个一寸免冠，你都不好意思跟人家说你有照片。你说这样的美女，一天能勾多少人？“我觉得怎么着也得三五十吧”，三五十，那时为你杀妻灭子的。150起，你还别嫌多，还不算说“你好”的。你就得研究上网的男人的心理，愿意上网找MM的主，要的就是找漂亮的。什么叫没事撑的，你知道吗？没事撑的就是同时找8个MM聊，都是找最美的，不是找最爱的。所以，我们上网勾狼的口号就是：不求最爱，但求最美！ 《装机版》 一定得选最好的CPU，装P4都算一般。配就得配最高档次的部件，不要集成的东西，内存最少也得2G，什么DVD刻录机呀，GEFORCE4呀，200G的硬盘，RAID呀，能给他接上的全给他接上。机箱上要镀金，机箱里边要有一排散热风扇，主板上安一个DEBUG的芯片，带真人语音，特灵敏的那种。配件一插上去，甭管有问题没问题都得发音：your pc is very NB。一口地道的英国伦敦腔儿，倍儿有面子。主板上再插一块超级显卡，芯片用NVIDIA最新的，一年光升级就得几万人民币，再配一台大功率UPS电源，24小时开机。就是一个字儿——贵！换鼠标就得花个万八千的，周围的网友不是用19寸液晶屏就是2G内存，你要是用P3你都不好意思跟人家联星际。你说这样的电脑一台你得出多少钱？我觉得怎么着也得两万人民币吧，两万人民币？！那是成本。三万人民币起，你别嫌贵，还不打折。你得研究莱鸟们装机的购物心理，愿意掏两万装机的主根本不在乎再多掏一万，什么叫莱鸟DIYER你知道吗？莱鸟DIYER就是买什么配件都买最贵的，不买最好的。所以我们做装机JS的口号就是：不求最好，但求最贵！ 《考研版》 一定得报北大清华，找最热门的系。考就考mm听了抛媚眼的专业，工作干脆甭打算找。每天复习时间最少也得二十四小时，什么毕设呀，实习呀，gf呀，能糊弄的全给它糊弄过去，枕头底下掖着张锦芯，马桶边上摆着任汝芬。手里捏着根签字笔，三块钱，博实买的那种，但凡碰见能写字的地方，有空就得练作文：There‘s no denying the fact that.. 地道的朱太祺腔儿，倍儿有面子。包里再揣十沓笔记，一定得找出题老师讲的，光复印费就得几百，再订一本专业课试题，打有狗那年就有的卷子都搜罗来，就是一个字儿——全。英语阅读是重点，周围的傻缺不是错一个就是错两个，你要是错上三个呀，你都不好意思跟人家说你考研。你说这样的准备，到头你得考多少分？我觉得怎么着也得三百五吧？三百五？！那是瞎忙活，四百分起，你还别嫌高，这才刚够复试。你得研究如今的考研形势，能逼着你考出三百五的专业，根本不在乎再多折腾你五十。什么叫成功人士你知道吗？成功人士就是不管答哪道题，都答最准的不答最对的，所以，我们考研的口号儿就是：不求最对，但求最准！！！ 《论坛版》 一定得选最好的服务器，雇比尔盖茨来做技术支持。论坛的速度要快，10条256M的专线直联，网页的设计一定要cool，下载速度绝不能低于500K/s。什么图片呀、电影呀、软件呀，没有不能上传的，连限制级的都随便传，要是不怕贵，直接收购playboy.com。再雇一长的像张朝阳的做版主，只要网友来了、立马跑过去问好，挨拍还不许还嘴，倍儿有面子。论坛里到处都是按键，一个按钮就能操控几千项功能。一年光维护就得几百万美金。不管人家有没有电脑，注册成功就送一台。要是方便的话，把上网费电话费都帮人家交了。就一个字儿——烧。专门雇几十人负责回帖子，不管谁发帖子了，立马几十人说：写的好，精品。让来论坛的网友觉得自己不是痞子蔡就是李敖。那些每天都去搜狐的都不好意思跟咱论坛的人打招呼。就说这么一论坛，最低得有多少用户？我觉得怎么也得两千万用户吧，两千万用户？！那是搜狐，六千万用户起，你还别嫌多，还不包括潜水的。你得研究网友的上网心理，愿意泡在论坛的网友，根本就不在乎别人写的是什么。什么叫灌水你知道么？灌水就是不管什么文章都只看标题、不看内容，直接回复。所以我们做论坛的口号就是：不求内容好，但求水最多！！！ 《北京堵车版》 一定要选最远的地儿，走最堵的路段。出门直接上三环，四环最少也得绕半圈。什么杜家坎啊，西二环啊，回龙观啊，能绕的都给他绕上。车里面带盒饭，车后带厕所，车外边再站一个买报纸的，戴一鸭舌帽，特胆大的那种，只要车一停，甭管有事儿没事儿都得跟人家说“精神点儿，别睡着了”。一口地道的北京土著腔儿，倍儿有面子。马路上看见军车咱就躲，遇上加塞儿的就让。从复兴门到官园桥就得3个多小时，再要是碰上有活动，一两条车道被封，就是一个字儿－堵，上个立交桥就得坡起个百十回。别人上班不是花二小时就是三小时，你要是才花了一小时，你都不好意思跟人家打招呼。你说这样的路况，想不堵你得几点出来？“我觉得怎么着六点也够了吧？”六点出来，那是找死！四点半以前，你还别嫌早，还得看有没大货。你得研究车主的心理，愿意六点出发的车主，根本不在乎再提前两小时。什么叫马路天使你知道吗？马路天使就是不管去哪儿上班都选最堵的，不选最快的。所以，我们做司机的口号就是：不求最快，但求最堵！！！]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[11月20日 阴转晴 星期一]]></title>
    <url>%2F2006%2F11%2F20%2F11-e6-9c-8820-e6-97-a5-e9-98-b4-e8-bd-ac-e6-99-b4-e6-98-9f-e6-9c-9f-e4-b8-80%2F</url>
    <content type="text"><![CDATA[今天逛吴军的qq空间，看到了一张照片。是以前本科打球的照片。 他说：“时间过得真快，我们都老了。。。。” 于是我难过了。。。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[11月18日 雨一直下 星期六]]></title>
    <url>%2F2006%2F11%2F18%2F11-e6-9c-8818-e6-97-a5-e9-9b-a8-e4-b8-80-e7-9b-b4-e4-b8-8b-e6-98-9f-e6-9c-9f-e5-85-ad%2F</url>
    <content type="text"><![CDATA[事很多的周末，雨也很多。害得我只好找个理由在寝室睡觉了。 最近心情不怎么样，于是又开始听重金属了。不过不是以前的linkin park 和 marylin manson了——换成了limp bizkit。一只hip-hop&amp;rock的乐队。喜欢break stuff这首歌，虽然歌词听不懂，也没仔细去查，就是喜欢背景里震撼的重金属音乐。大概我是想发泄一下吧。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[11月17日 时晴时雨 星期五]]></title>
    <url>%2F2006%2F11%2F17%2F11-e6-9c-8817-e6-97-a5-e6-97-b6-e6-99-b4-e6-97-b6-e9-9b-a8-e6-98-9f-e6-9c-9f-e4-ba-94%2F</url>
    <content type="text"><![CDATA[早上又是我独自一人推开寝室的门，行色匆匆的赶往F楼。 没有了昨天突如其来的冷风冷雨，11月底的早晨倒是有了一些清爽的春风的感觉。 一样的课一样的老师，只不过荒废已久的我，开始听不懂着乱七八糟的东西了。虽然是在第一排，我依然忍不住地打了两节课的瞌睡。本来准备第三节课下课，回来见周公的。结果老吉直接将第四节课放了——虽然我的计划没有成功，不过心里还是小有点暗爽的——成全了我和火箭的“第四节”。 看了一节惊心动魄的比赛，更加困了。本来也没打算去上课，于是就钻被窝了。虽然早上晴了一会儿，下午又阴沉了起来。寝室一如昨天的黑暗——适合睡觉的天气。闹铃也没定，一睡就是四个多小时。 等我醒了，周末也来了，不过还有那么多做不完的事等着我。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[11月16日 雨 星期四]]></title>
    <url>%2F2006%2F11%2F16%2F11-e6-9c-8816-e6-97-a5-e9-9b-a8-e6-98-9f-e6-9c-9f-e5-9b-9b%2F</url>
    <content type="text"><![CDATA[今年的第一场冬雨。刺骨的风夹着冰冷的雨。 漆黑的寝室，熟睡的荡仔。 我硬撑着去上了老板的课。 腰伤和膝伤折磨着我的身体，心也受着摧残。 心身俱疲。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[静坐以待黎明]]></title>
    <url>%2F2006%2F11%2F07%2Fe9-9d-99-e5-9d-90-e4-bb-a5-e5-be-85-e9-bb-8e-e6-98-8e%2F</url>
    <content type="text"><![CDATA[昨夜丑时听rap，听到太high。就寝，无法入睡，与荡仔乱聊。 荡仔睡着了，我却更加的无法入睡。听着对床间歇性的鼾声和磨牙之类的怪声，兼之腹饿难忍，直至4：30觉得更加清醒了。 然后起床，穿上睡衣裤，套上外套，看书——数值分析。 六点，日出；六点半，天大亮。我有点困了，并且没有了各种奇怪的声音，遂再次就寝。 先前的计划全部打乱，睡觉至中午12点。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[一沙一世界，一花一天堂]]></title>
    <url>%2F2006%2F11%2F06%2Fe4-b8-80-e6-b2-99-e4-b8-80-e4-b8-96-e7-95-8c-ef-bc-8c-e4-b8-80-e8-8a-b1-e4-b8-80-e5-a4-a9-e5-a0-82%2F</url>
    <content type="text"><![CDATA[To see a World in a Grain of SandAnd a Heaven in a Wild Flower,Hold Infinity in the palm of your handAnd Eternity in an hour. －－－英国诗人威廉·布莱克（William Blake）(1757-1827)著。 一粒沙里有一个世界，一朵花里有一个天堂，把无穷无尽握于手掌，永恒宁非是刹那时光。 －－－台湾的散文家陈之藩译 。 另：蒲柏为牛顿作的悼词 Nature and nature’s law lay hid in night:God said，let Newton be！And all was light. 自然与自然规律为黑暗隐蔽，上帝说让牛顿来，一切遂真光明。 今聆振宁先生讲座提及此，特以志之。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[11月6日 晴 星期一]]></title>
    <url>%2F2006%2F11%2F06%2F11-e6-9c-886-e6-97-a5-e6-99-b4-e6-98-9f-e6-9c-9f-e4-b8-80%2F</url>
    <content type="text"><![CDATA[天依然是晴的，很久了，一直是晴天，只在昨天去买夜宵的时候，在迈出楼栋的一霎那，飘了几滴雨。 太阳虽然还在，只是温度已大不如前。加上肆虐的狂风，吹得骑着车的我开始觉得有些冷，并且很干。 这两天一直在忙着赶作业，刚才终于把矩阵的作业赶完了，不过还有数值分析的作业还没写。事有轻重缓急，还是决定先搞一会儿VB。因为下午师兄qq说要检查进度了。唉，茫然，我还没开始编呢。 前天公公他们回来了，原来的521寝室也重新聚首，不过已经不是在当年的那个5楼朝北的西面墙头的，常年忍受冬冷夏热的，局促而又脏乱差的小破房子里了。不过四个人的碰面，各自的回忆又不免回到从前。想起来，虽然有点简陋，却还是有一些怀念。 公公是礼拜五来的。礼拜六中午，和很多人一起在蒸好菜坊吃了很丰盛的一顿。菜很好，人也很好。开学来第一次见到了一只鸡，并且想到了泡泡堂。很想和他们一起重出江湖，不过恐怕这也只能是想了。大家聊得很开心，吃得也很尽兴——虽然最后还剩了很多肉没有吃完。 下午，就是我们寝室四友的时间了。去陪公公买了衣服——一套休闲的西服和一件不起眼的羊毛衫（尽管公公穿起来很帅，毕竟是有身高，且不胖的人啊）。其间另外三个感叹了学生与有收入者的差别——一边是一出手就是4，5百的衣服，另一边是除了热风不敢再逛其他的店。尽管如此，公公还是公公，我们并没有什么不同。 可怜的是买的high过头的公公，没有赶上最后一班去海盐的长途车，落寞的，拖着疲惫的，有伤的腿，重新回到了我们身边。这时的我们已经在味千面馆享受美食了。虽然没赶上末班车，不过却因此而多了若干小时的相聚，这未尝不是塞翁失马阿。小厉子请的客，四个人吃掉了200多块，我都替神有些心疼。吃完了，又聊了很久。再之后，我们先和龟毛的书记道了别，之后是小厉子，第二天清晨，在我惺忪的睡眼里，看见公公离我而去的背影。我说了句“byebye，以后常来玩”，然后又睡着了。至此四友又作鸟兽散。只不过现在我们离得不是很远了。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[11月3日 多云转阴 星期五]]></title>
    <url>%2F2006%2F11%2F03%2F11-e6-9c-883-e6-97-a5-e5-a4-9a-e4-ba-91-e8-bd-ac-e9-98-b4-e6-98-9f-e6-9c-9f-e4-ba-94%2F</url>
    <content type="text"><![CDATA[天在不知不觉中已经冷了，我也在不知不觉中发现了被窝的温暖——又逃了两节课，睡了两个小时。 总是习惯在一个人的时候再打开space，所以，荡仔去打球了，而我就来了。 今天晚上，公公要回闵行了。很喜欢同学相聚的感觉。 公公是大张旗鼓地宣传了好几个礼拜了。而上个礼拜却有一个人像鬼魅一样的飘过。 真的对这个人很失望——不光是我，应该是我认识的所有他的同学。四年的同学，枉费我们曾经关系还不错。 暑假里，他换手机就没通知我们，而我打听到了，给他发短信竟也不回。后来听说，是因为sim卡丢了，通讯录没了——虽然这个理由有点牵强。 这也算了，短信不回的事儿咱也不是没干过。但这次真的有点过分了。难道我们得罪他了，他就这样与我们划清界限。 搞不懂他在想什么。四年的大学同学就这么不值一提吗？ 我无语，静静的等待公公的到来。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[时而多云时而晴 星期五]]></title>
    <url>%2F2006%2F10%2F13%2Fe6-97-b6-e8-80-8c-e5-a4-9a-e4-ba-91-e6-97-b6-e8-80-8c-e6-99-b4-e6-98-9f-e6-9c-9f-e4-ba-94%2F</url>
    <content type="text"><![CDATA[很久没来space了，很难的能静下心来写点东西。 研一开学已经一个多月了，自从网络一开之后，就一直沉迷于三11之中。既没有学习也没有做别的事，连课都逃了一大把。今天又逃了半天。 下午去听了了一个很牛比的人的讲座。IEEE的主席兼CEO DR.Lightner的一个对IEEE的介绍性的讲座。虽然他说的很简单也很清楚，但我还是听得很吃力，看来是要读读英语了。 暑假一直想写一些大学的回忆，但却苦于没有电脑，说是要到学校再写，可是来了之后，又总是沉浸在谈笑间樯橹灰飞烟灭。在这个礼拜五的晚上，在绝大多数人都去自习的时候，在被荡仔好好的数落了一番之后，我痛定思痛，抱着几丝内疚的心情，准备写点什么东西。 还是想想大学的事吧。最近一个月，一直有大学的同学回来看望水深火热中的我们，很开心却也有一些世事无常。说起一些大学的事，大家总能high起来。 想想我的大学四年，想想原来的D20-521，却还是总有一些值得怀念的东西的。 说起我们寝室，大概最有特色的可能就是对语言的研究了吧——更确切一点应该是说话的方式。我们称之为“普通发（4声）”。 此普通发非彼普通话。这个最早大概起源于天皇和阿黄极具特色的，带有方言特色的普通话发音吧。天皇是东北人：一概翘舌，r、y不分；阿黄是广西人：一概平舌，h、f不分。一开始是大家学的好玩儿，后来说得多了，便真的成了一种说话的方式。后来发展到不再只局限于天皇与阿黄的口音了，也吸收了一些皇子、亮亮还有江爷爷的一些奇怪口音，甚至我们也自创了好些。管shui叫fei，把qu念成qiu，好读hou（2声），爷爷读遥遥。。。。。。反正是乱七八糟，怎么读奇怪就怎么读，越奇怪的发音，就越觉得爽。 告别了D20-521了，这些话也不怎么说了。只能想想了，这大概也是我大学四年的一部分吧]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[7月25日 阴]]></title>
    <url>%2F2006%2F07%2F25%2F7-e6-9c-8825-e6-97-a5-e9-98-b4%2F</url>
    <content type="text"><![CDATA[7月25号，天凉快得令人诧异。 前一段时间看了一本据说是很流行的书，名字叫《狼图腾》，据说是少有的男性小说。 虽然该书的语言是傻了一点，不过情节还不错和要表达的思想也是挺深刻的。我看了也颇有一些感触。 本书主要就是阐述了一些内蒙草原上农耕民族的愚昧与草原民族的狼崇拜之间的矛盾。最后是人多势众而且及其强大的外来户赢了，但输了的确实整个中华民族。 以前我觉得宗教其实就是迷信，不过现在我总算有了一点小认识。宗教固然是原始族人对世界的蒙昧的认识，但经过了很长很长时间的千锤百炼，其中大部分精神应该是正确的，因为经过了时间和历史的考验。 现在凡是说起来都是要讲科学，可又有多少人真正的懂科学，就算是知道科学的人又有几个。而目前国人社会的中坚力量有信仰的恐怕凤毛麟角了。所以实际上最可恶的一些人是那些对科学一知半解，有毫无信仰的人，实可谓是“无知者无畏”。 想想当年的新民主主义革命，确实打倒了封建礼教，但是也彻底摧毁了整个中华民族的信仰。在当时对革命发展影响看，可能是胜利了，不过在我看来，几十年或者百年之后，却未必是一件好事儿。 本书也从信仰的角度揭示了华夏民族的发展轨迹，在我看来，也是甚有些道理的。整个中国大概就是毁在了宋明理学的手上了。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[7.7 晴 关于泡泡堂]]></title>
    <url>%2F2006%2F07%2F07%2F7-7-e6-99-b4-e5-85-b3-e4-ba-8e-e6-b3-a1-e6-b3-a1-e5-a0-82%2F</url>
    <content type="text"><![CDATA[最近总是想写一些东西几年我的大学四年。 昨天晚上躺在地上睡不着的时候，想到了大概是大学里玩得最多的游戏——泡泡堂。 记得最一开始，是在表哥家开始玩的——那是在大一暑假。大二上刚买电脑，就装上了。网络很卡，但是大家一起，还是很有兴致的。一度，厉杰和书记都是我们的队友；一度，还进行过寝室大战，在11点断网之前。这一段热情坚持了一年，寒暑假也从未间断。大三上，网络越来越差的我们痛苦的发现用道具 的人越来越多了，于是，团结的 我们也做鸟兽散了。我，开始了三国——那时是三国九。 蛰伏了一个学期。 在大三下的某一天，我，独自早起的我，带着复古之心打开了早已尘封的泡泡堂，然后就是惊奇的发现，盛大终于大发善心的开设了教育网。于是，我又再次复出了。之后是公公、皇子，再后来是张博、一只鸡的加入，不过，书记和厉杰就离我们而去了。泡泡堂也不再有当年寝室大战的辉煌。 不过，因为技术的迅速恢复，我们还是很尽兴。而且组成了若干个小团体，有了各种配合，有了一系列的战术。并将之昵称为ppt。 但大肆上的考研也不期而至了，在因为泡泡堂而耗去大量复习时间之后，在越来越感受到考研的急迫之后，我决定戒掉泡泡堂。没想到至此之后，我的电脑就告别了泡泡堂，因为在考完研之后，我莫名的发现，我的电脑因为莫名的原因再也玩不了泡泡堂了。 不过在考玩研之后的一两天里，我们还是在一起玩过几次的，不过已经没了当年的感觉了。之后，我们所有人都告别了ppt。之后，我们移情别恋去大富翁了。虽然我们心里都还想念着那个当年的泡泡堂。 队友们都作鸟兽散了，我一个人留在了交大，或许他们还有明天，不过我没有了，或许能把军军培养出来。不过还是怀念公公、皇子、一只鸡、张博和我，五个人中的三个，一起玩小区10、墓地18、海盗14、大海02的日子。。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[回家了]]></title>
    <url>%2F2006%2F07%2F03%2Fe5-9b-9e-e5-ae-b6-e4-ba-86%2F</url>
    <content type="text"><![CDATA[正式告别了大学的四年，所有的一切都正式的成为纪念。 再不想的离别，如今都已成了现实，剩下的也只有回忆了。开始一段新的生活吧。 随然心里还是有那么一点淡淡的难过]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[真的要走了]]></title>
    <url>%2F2006%2F06%2F30%2Fe7-9c-9f-e7-9a-84-e8-a6-81-e8-b5-b0-e4-ba-86%2F</url>
    <content type="text"><![CDATA[从第一轮的院搓,到班搓,再到很多次的寝室聚餐,再到最后一轮的系搓…….. 从一开始等待考研成绩的慌慌张张到五一回家的悠然自得,再到毕业设计的紧锣密鼓,毕设结束的一缕失落,在无数的气球与飞翔的白鸽中,我们走完了大学四年的最后的时刻. 匆匆四年,18岁到22岁的蜕变. 所有人把学士帽扔向了天空,也有很多人让眼泪落向了大地.台上是断断续续的歌声,台 下是欢笑与泪水.大概所有人都在这一刻与人拥抱了,至少我是这样.从这一天起,我们大概也不再会有这十几年来的学子之心了吧. 这一切都已经是前天的事了,今天我真的要走了.离开陪伴我四年的寝室,离开陪伴我四年的同学.虽然我四年前就知道有这么一天,虽然这四年来我一直试图挽住时间的脚步,但一切都是那么的不约而至,一切又是那么的准时.我不想面对的这一切,但他终于来了. 写下这一切的时候,或许我已经泪流满面…….. 我是一个喜欢后悔的人,大概这在我小学四年级的时候就已经注定了吧.记得那时候买了一把折扇,上面是那时很流行的生肖运势.属于我的老鼠上写着: 做事喜欢后悔.而在这十几年里,我一直体会着这六个字.当我打开MSNspace开始写下这篇日记的时候，我又再一次的品尝了这一句，大概会陪伴我此生的这一句。 嗯，大概我真的后悔了。 四年来，学业毫无建树，生活毫无精彩，现在回想起来，大概最后悔的就是没有找一个女朋友吧。但我还是有那么多美好的回忆留下来了，留在了东川路800号，留在了上海交大，留在了测控系，留在了F0203501班，留在了d20-521。。。。。。如果能有重新生活的机会，大概我可能还是如此吧。这可能就是我的性格。或者这可能就是命中注定。 前天晚上，大家还在游街，还在喝酒，还聚在女生楼下唱歌，我还和书记一起玩着大富翁，昨天晚上已经和大部分同学互道离别，校园已经冷清了，毕业的离情已经淡了，已经到了曲终人散的时候了。 早上看到书记电脑里的两张交大雪景，看着窗外的似火的骄阳，心里不禁怆然，所以写下了以上的惶然不知所云。 晚上十点的火车。。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[系搓]]></title>
    <url>%2F2006%2F06%2F27%2Fe7-b3-bb-e6-90-93%2F</url>
    <content type="text"><![CDATA[场面有点混乱 很多人喝了很多酒。也有几个兄弟醉得不省人事。场面有点感人，又一时失去了控制。 林蔚捂着流血的脸，被朱飞送走了。不知他现在怎么样了。祝福他，希望他爸爸也能平安。 大家该喝的酒该流的泪，都留在了今晚，新疆人特色菜。 虽然我还是一个人安静地坐，大概是感情隐藏得太深了。 我真的很爱他们。。。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[VOS]]></title>
    <url>%2F2006%2F06%2F26%2Fvos%2F</url>
    <content type="text"><![CDATA[今天vos。 刚知道vos的全称是voice of star（星之声，可能是这么译吧）。人很多，而且不对号入座，场面有点乱。 但是当帷幕拉开，大屏幕亮起的那一霎那，大家都的注意力都集中了。在演出开始之前，屏幕上放着02级最熟悉的那一幕幕，教室、图书馆、思源、思春湖、北区食堂、北区修车的师傅、管车的大爷、宿舍的阿姨。。。。。。耳边想起的还是那首陈韵若《的记得这首歌》。心里一紧、鼻子有点酸、眼睛也挺酸的、整个人都有点酸。。。。。。 演出就在此时恰如其分的开始了，很强劲的音乐，是校园原创的摇滚乐队，全场的人开始high了起来。每一个节目都很精彩，每个节目都在回忆着这四年的一路走来。 当交大超女张媛把气氛带到最高点时，我的手机响了，vos对我戛然而止。就像我的大学生活，有缺憾了，却也有着大把美好的回忆。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[昨天班搓]]></title>
    <url>%2F2006%2F06%2F26%2Fe6-98-a8-e5-a4-a9-e7-8f-ad-e6-90-93%2F</url>
    <content type="text"><![CDATA[快要毕业了，我们班也去散伙饭了。 菜很多，不想学院里的半吊子，酒也很足，大家很尽兴。书记喝得很high，最后让我第一次看见他醉了，不过看起来很高兴的样子。我——一个尽量滴酒不沾的人，今天也喝了好几杯，结果回来的时候，头疼得厉害。 酒足饭饱之后，最“骚”的厉杰开始high了，在全班人面前，发扬了我们的寝室文化——打劫、大腕、江爷爷、天皇语录、李毛——大家都是第一次领略神的魅力，都开心的紧。神也算是酒后助了兴吧。可能明天就没这么有意思的场面了。 酒饭之后，便回寝室睡了，三点例行公事的看了荷葡之战]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[饭局开始了]]></title>
    <url>%2F2006%2F06%2F24%2Fe9-a5-ad-e5-b1-80-e5-bc-80-e5-a7-8b-e4-ba-86%2F</url>
    <content type="text"><![CDATA[在别人行将结束时，我们的饭局在昨天，拉开了序幕 很多人都很high，一对地下情人公开了恋情，林蔚嚷着要喝酒，太皇太后拉住朱峰不放，所有的人一起唱歌，然后拥抱——很多男生和一小撮女生。全系的人一起拍照——没有白洁和王俊璞，只有我们，60几个本科生。 大家或者是大部分人都很high，我却high不起来。可能是还要在这读两年半，毕业的感觉不是那么的强烈，或者也可能是性格使然。 大家要去唱歌，我没有去。。。。。。。。。 明天要班撮了。。。。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[六月天真热]]></title>
    <url>%2F2006%2F06%2F21%2Fe5-85-ad-e6-9c-88-e5-a4-a9-e7-9c-9f-e7-83-ad%2F</url>
    <content type="text"><![CDATA[还有一个多礼拜，天突然地热起来。 最近也没有什么活动，只是和同寝室的公公，书记，厉杰去吃了一顿烤肉 大家都忙着自己最后的大学生活]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[答辩结束了]]></title>
    <url>%2F2006%2F06%2F19%2Fe7-ad-94-e8-be-a9-e7-bb-93-e6-9d-9f-e4-ba-86%2F</url>
    <content type="text"><![CDATA[今天，大学所有官方的生活基本都过完了，只剩下了一个毕业典礼 心里不觉得如何的轻松 有一点点失落]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[6月13日 晴转雨 星期二]]></title>
    <url>%2F2006%2F06%2F13%2F6-e6-9c-8813-e6-97-a5-e6-99-b4-e8-bd-ac-e9-9b-a8-e6-98-9f-e6-9c-9f-e4-ba-8c%2F</url>
    <content type="text"><![CDATA[昨天，交了书法的重新学习费200块 今天毕设老师又给我发邮件说我编的程序太简单 毕业也没几天了 不知道还要忙多久]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[6.1 雨 星期四]]></title>
    <url>%2F2006%2F06%2F01%2F6-1-e9-9b-a8-e6-98-9f-e6-9c-9f-e5-9b-9b%2F</url>
    <content type="text"><![CDATA[看了VOS的宣传片，有一些些的感触。 过了今天就少了一天和你相聚的时间不愿看见分别的情节你的背影已走远面对未来你要勇敢不管它有多艰难坚持你的梦想和最初时一样现在我们唱着这首歌心里多么舍不得想要把所有的快乐记得这首歌装进你行囊陪你每一刻你要记得这首歌无论多久都别忘了因为哼着它就可以看见家乡天空的颜色 太多的快乐悲伤在这首歌里唱让它陪你走在世界每一个地方 陈韵若的歌，平淡的，一个不怎么好看的女生撑着黑伞，在淅沥的小雨中走着。。。。。 一路，都是熟悉的景色 棚子里，靠在椅子里，熟睡的修自行车的师傅；倒下的，多米诺骨牌似的，自行车；教室里，安静的，睡着的和写着的人们；曾经的，名存实亡的商业街；雨中的宿舍楼，思源湖，长椅，鸽子。。。。。。 能看见我的影子，都是我的鞋子曾经踩过无数遍的地方 现在，我们唱着这首歌，心里多么舍不得 四年了，只剩下一个月了 过了一天就少一天，七月你还有多远。。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[4月30日 晴 星期日]]></title>
    <url>%2F2006%2F04%2F30%2F4-e6-9c-8830-e6-97-a5-e6-99-b4-e6-98-9f-e6-9c-9f-e6-97-a5%2F</url>
    <content type="text"><![CDATA[好久没有感受初夏之际，呆在家里，或是走在马鞍山的街道上的感觉了。五一在家里，难得悠哉游哉。没试过在网吧里写blog，今天就来体验一下。 刚才看了dodolook的vlog，实在是可爱的紧。所以忍不住到blog上为她唱一下赞歌。 五一的假期还有几天，好好享受一下。 另：昨天看了《达文西密码》，触及到一些欧洲宗教的东西，有点好奇，有点无法理解，还有一点毛骨悚然]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[S10PK完~整攻略. [转]]]></title>
    <url>%2F2006%2F04%2F22%2Fs10pk-e5-ae-8c-e6-95-b4-e6-94-bb-e7-95-a5-e8-bd-ac%2F</url>
    <content type="text"><![CDATA[三国志10PK：完整的结婚条件攻略 结婚的剧情大家自己体验，我只提供触发条件 （另外结婚后有许多有趣的小事件，大家可以慢慢体会，呵呵） 其中和特殊人物结婚我都测试过了 和特殊人物结婚一般分两步，第一是相识或者听说，第二一般是考验 一些要求是共同的 第一步的共同要求： 游戏开始超过1年（这点很重要） 主角没有依赖事，名声超过200（这点很重要） 双方超过20岁（有的只要求对象超过18岁即可，不过这些对象登场时的年龄就21岁了，所以无所谓），两者均未结婚 （这个也很重要，光荣不提倡早婚，呵呵） 主角正常 主角在野或者仕官（但自势力不能放浪） 当然，主角的性别必须对头。光荣可不允许同性恋啊^_^ 第二步的共同要求： 比第一步的要求要低，可以不必考虑 秦香莲 第一步：进入自宅发生 在河北的城市 主角所在城市治安为100，主角治安经验超过200 和主角关系为亲密的人超过10个 第二步：进入自宅发生 至少30天以后 和主角关系为亲密的人超过20个 丁月华 第一步：进入酒家发生 在吴越的城市 主角拥有酒 第二步：进入自宅发生 何玉凤 第一步：进入城市界面发生 在西北的城市 第二步： 进入和第一步不同的一个西北城市白小青 第一步：进入城市界面发生 在巴蜀的城市 第二步： 进入和第一步相同的那个西北城市 至少60天以后 崔莺莺 第一步：进入城市界面发生 在中原的城市 第二步： 进入和第一步不同的一个中原城市 红娘 第一步：进入自宅发生 在楚的城市 战胜超过10，单挑胜利超过10，舌战胜超过10 第二步：进入自宅发生 根据第一步红娘的要求 增加对应的战斗或单挑或舌战胜利的次数 智化 第一步：进入城市界面发生 在河北、中原、西北的城市 主角受伤 第二步： 进入和第一步不同的城市（需要有智力、政治、统率学问所或太学之一） 白玉堂 第一步：进入城市界面发生 在楚、吴越、巴蜀的城市 第二步：进入城市界面发生 至少90天以后 其它（未测试） 在主角所到的那座城中，有亲密超过91的人存在，并取亲密最高的那个作为对象 主角不在宫城、政厅、自宅 游戏开始超过1年 主角和对象超过20岁，两者均未结婚 双方面识，不是父母、子女、血缘、义兄弟的关系 主角没有依赖事，名声超过200 主角、对象正常 满足以下两个条件之一 1、两者都在野 2、主角仕官（但自势力不能放浪），对象在野或者和主角同势力同城 通常情况是起初能力+50就是成年后的能力 只要健康平安就好，自由之路——各项能力成长+5% 其余的相关能力成长+10% 至于五围高的武将一定生不出来天才来，我做了个试验，自创女武将各项200，与赵云的后代每项能力都是90以上武力为天下无双，100。 满月 1、文之道—智+100政+100 2、武之道—统+100武+100 3、德之道—魅+100其余各加20 4、健康快乐成长—各项加40 周岁（不能选择，可用S/L大法） 1、笔—智+150 2、书—政+150 3、弓—武+150 4、令旗—统+150 5、玩具—魅+150 6、糖果—寿命+5 第3年 1、木马—统+50 2、积木—智+50 3、蹴鞠—政+50 4、木剑—武+50 第4年 1、办家家酒—政+50 2、文字接龙—智+50 3、哼歌画画—魅+50 4、踩影子—武+50 第5年 1、教导其鸟的饲养与利用方法—统+50 2、教导其认识各种生物—政+50 3、谈论生物的生命—魅+50 4、一起思考鸟为何会飞—智+50 第6年 1、无言地注视其—统+50 2、以大道理说教—政+50 3、大声叱喝—武+50 4、心平气和慢慢指引其领悟—魅+50 第7年 1、就来说说马的价值吧！—统+50 2、就来说说马的魅力吧！—魅+50 3、就实际来骑一次马看看吧！—武+50 4、就来教如何骑马吧！—智+50 第8年 1、文之道—智+100其余各加10 2、武之道—统+100其余各加10 3、德之道—魅+100其余各加10 4、自由之道—各项加20 第9年（自动为能力最高的加10%) ——女儿 1、要培养高贵的气质—统+50 2、要变得更贤慧一点—智+50 3、要变得更开朗—政+50 4、要变得更懂撒娇—武+50 ——儿子 1、要变得更有阳光气息—政+50 2、要变得更聪明一点—智+50 3、要让心胸宽大一点—统+50 4、要变得帅气一点—武+50 第10年 1、要把握机会并积极行动—武+50 2、要有远见—智+50 3、要以直觉行动—魅+50 4、要以远大的视点来观察大局—政+50 第11年 1、买进较重要的政书、史书—政+50 2、买进翻译浮屠经典的书籍—魅+50 3、采购较重要的经书、论文—智+50 4、采购较重要的兵书—武+50 第12年 1、以成为天下无双为天命—武+50 2、天命是自己决定的—魅+50 3、视救国济民为天命—政+50 4、视统一天下为天命—统+50 第13年 1、能决定战局趋势的情报—智+50 2、抓住士兵之心的方法—魅+50 3、如何指挥好士兵的方法—统+50 4、能在现实战场上运用的武技—武+50 第14年 1、必定为文之道—智+50政+50 2、必定为武之道—统+50武+50 3、必定为德之道—魅+100其余各加10 4、必定为自由之道—各项加20 第15年 冠礼 san10之修行 ★几个老妖怪的位置和教授技能:禰衡(一般在河北地区,教面骂)历史上裸奔的创始人,骂人的典范,喝酒的达人左慈(建业附近,给遁甲天书,教仙术也教面骂)当面骂曹操的妖怪司马徽(襄阳附近,给名士资格,告知各个妖怪的具体位置)乔玄(洛阳附近,给名士资格)江东二乔的老爹蔡MM(洛阳,邺附近,教各种内政技能教除面骂外各种舌战技能)华佗(云游无定所,给青囊书,教医术)管格(一般在成都附近,延长寿命并教战斗战术技能)管格延命的典故,呵呵,游戏再现于吉(云游无定所,给太平青领道,教仙术)黄承彦(襄阳附近,教各种计谋技能,单挑系和天文)许子将(汝南附近逛游,游戏中叫许邵,也给名士资格) 另外,天文地理的达人:天文：张角、张宝、诸葛亮、司马懿、庞统、谯周、陆绩、阚泽、木鹿大王周昕石阵：诸葛亮、诸葛均、庞统、徐庶、尹默、向朗、韩嵩医者：张角、虞翻仙人：张角 ★其它较难的个人修行:名产的巡无期限吴越春秋15政治＋1鱼：襄平，北海，江夏，会稽果物：蓟，河内，武威，永昌，桂阳陶瓷器：南皮，西平，柴桑，交趾油：晋阳，江陵，零陵麦：上党，麦，长安，永安，襄阳茶：下坯，庐江，武都，建宁，宛，长沙，建业棉花：小沛，天水，新野绢织物：许昌，成都，上庸，南海米：寿春，梓潼，吴 七名所:洛阳白马寺、长安王陵、江陵玉泉寺、小沛孔庙、江夏黄鹤楼、吴甘露寺、蓟桃园 七王都战国七雄旧都:长安,江陵,平原,蓟,许昌,邺,陈留 全国地图绘制:50个城池去一圈,如果忘了还有哪个城市没去,去酒馆听见闻,会有提示 仙术任务:木的实的采取90日金3004仙术经验30药草的采取120日金5004仙术经验30这两个都在任务提示的方位延长线上,找有草的地方就轻松找到.灵山的巡180日金5008仙术经验60，所有能力加1五岳（恒山，嵩山，泰山，华山，衡山）这个很简单,名山都在能修阵的地方还有山名 ★在还不能修改武将生死的时候,暂时用药维持生命吧,去长安和邺买药送给你的武将麻沸散药30－寿命延长－15年漆叶青粘散药25－寿命延长－10年亭历犬血散药25－寿命延长－10年五石散药20－寿命延长－5年武侯行军散药20－寿命延长－5年屠苏延命散药20－寿命延长－5年 长安有老子（智力+10）太平要术（统帅+1，仙人）濮阳：赤兔马,大地图飞快,打仗退却100%不会被擒韩非子（政治+10）长沙：孙子兵法(智力+10)山海经（统帅+1，仙人）邺:七星宝刀(武力+10)和大宛马,传说中的斩蛇剑也在这里★诸葛亮的在野位置:开始在柴桑后来在襄阳,区分的时间点我具体忘了.]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[无]]></title>
    <url>%2F2006%2F04%2F21%2Fe6-97-a0%2F</url>
    <content type="text"><![CDATA[看着前几天拍毕业照时，大家自己拍的照片。 一张张笑顏如花，一个个风华正茂 耳中听着《花心》，有点恍惚 而且心里很酸]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[4月21日 晴有雷阵雨 星期五]]></title>
    <url>%2F2006%2F04%2F21%2F4-e6-9c-8821-e6-97-a5-e6-99-b4-e6-9c-89-e9-9b-b7-e9-98-b5-e9-9b-a8-e6-98-9f-e6-9c-9f-e4-ba-94%2F</url>
    <content type="text"><![CDATA[下午去买了车票，又是一个五一。大四的五一又和以前的不同。本科的最后一个五一。 很累。 傍晚，下了今夏的第一场轰轰烈烈的雷阵雨，又冷了起来。倒是希望一直冷下去，因为不想迎接那个七月。可能还是我太怀旧了吧，总是连着现状不愿改变。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[4月11日 星期二 晴]]></title>
    <url>%2F2006%2F04%2F11%2F4-e6-9c-8811-e6-97-a5-e6-98-9f-e6-9c-9f-e4-ba-8c-e6-99-b4%2F</url>
    <content type="text"><![CDATA[校庆也过了，四月也没剩几天了。盛大的晚会像在给我们送行。令人感到荣幸的是，连国母都屈驾而至。不过我没有去瞻仰她和江core的风采。和打着游戏的书记，以期呆在寝室，享受大四的闲暇的时光。或许这样的时光也没几天了。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[《中日书法名品展》目录]]></title>
    <url>%2F2006%2F04%2F05%2Fe3-80-8a-e4-b8-ad-e6-97-a5-e4-b9-a6-e6-b3-95-e5-90-8d-e5-93-81-e5-b1-95-e3-80-8b-e7-9b-ae-e5-bd-95%2F</url>
    <content type="text"><![CDATA[先秦、秦汉部分：1、甲骨文-(商(殷)・上海博物馆藏)2、保卣-(西周・上海博物馆藏)3、史颂鼎 -(西周・上海博物馆藏)4、石鼓文（先锋本）-(战国・东京三井纪念美术馆藏)5、石鼓文（中权本）-(战国・东京三井纪念美术馆藏)6、石鼓文（后劲本）-(战国・东京三井纪念美术馆藏)7、泰山刻石（百六十五字本）-(秦・东京台东区立书道博物馆藏)8、西岳华山庙碑（长垣本）-(后汉・东京台东区立书道博物馆藏)9、曹全碑（因字未损本）-(后汉・上海博物馆藏 ) 晋唐部分：10、说文木部残卷-(唐・大阪武田科学振兴财团杏雨书屋藏)11、丧乱帖-(唐・王羲之・宫内厅三之丸尚藏館藏)12、孔侍中帖-(唐・王羲之・东京前田育德会藏)13、妹至帖-(唐・王羲之・个人藏)14、定武兰亭序（吴炳本）-(东晋・王羲之・东京国立博物馆藏)15、定武兰亭序（韩珠船本）-(东晋・王羲之・东京台东区立书道博物馆藏)16、定武兰亭序（犬养本）-(东晋・王羲之・东京国立博物馆藏)17、十七帖（上野本）-(东晋・王羲之・京都国立博物馆藏)18、集王圣教序（松烟拓本）-(唐・王羲之・东京三井纪念美术馆藏)19、淳化阁帖（最善本）-(宋・王羲之・上海博物馆藏 )20、淳化阁帖（夹雪本）-(宋・王羲之・东京台东区立书道博物馆藏)21、鸭头丸帖-(东晋・王献之・上海博物馆藏)22、地黄汤帖-(东晋・王献之・东京台东区立书道博物馆藏)23、真草千字文-(隋・智永・个人藏)24、李柏尺牍稿-(前凉・李柏・京都龙谷大学学术情报中心大宫图书馆藏) 25、维摩经卷-(后凉・王相高・上海博物馆藏 )26、九成宫醴泉铭（海内第一本）-(唐・欧阳询・东京三井纪念美术馆藏) 27、化度寺碑（翁方纲本）-(唐・欧阳询・京都大谷大学藏)28、汝南公主墓志铭稿卷-(唐・虞世南・上海博物馆藏 )29、孟法师碑（唐拓孤本）-(唐・褚遂良・东京三井纪念美术馆藏)30、善才寺碑（宋拓孤本）-(唐・魏栖梧・东京三井纪念美术馆藏)31、草书孝经卷-(唐・贺知章・宫内厅三之丸尚藏館藏)32、苦笋帖-(唐・怀素・上海博物馆藏)33、草书千字文-(唐・高闲・上海博物馆藏)34、法华玄赞卷第六-(唐・上海博物馆藏) 宋元部分：35、行书动止帖-(北宋・沈辽・上海博物馆藏)36、楷书谢赐御书诗表卷-(北宋・蔡襄・东京台东区立书道博物馆藏)37、祭黄几道文卷-(北宋・苏轼・上海博物馆藏)38、行书李白诗仙卷-(北宋・苏轼・大阪市立美术馆藏)39、行书伏波神祠诗卷-(北宋・黄庭坚・东京永青文库藏)40、王史二氏墓志铭稿卷-(北宋・黄庭坚・东京国立博物馆藏)41、草书四帖卷-(北宋・米芾・大阪市立美术馆藏)42、行书三帖卷-(北宋・米芾・东京国立博物馆藏)43、行书虹县诗卷-(北宋・米芾・东京国立博物馆藏)44、多景楼诗册-(北宋・米芾・上海博物馆藏)45、群玉堂米帖-(南宋・米芾・东京五岛美术馆藏)46、群玉堂米帖-(南宋・米芾・东京国立博物馆藏)47、楷书徽宗文集序卷-(南宋・宋高宗・日本文化厅藏)48、行书论语集注残稿-(南宋・朱熹・京都国立博物馆藏)49、行书诗赞卷-(元・鲜于枢・上海博物馆藏)50、行草书十诗五札卷-(元・鲜于枢・东京国立博物馆藏)51、行书杜甫秋兴诗卷-(元・赵孟頫・上海博物馆藏)52、兰亭序十三跋-(元・赵孟頫・东京国立博物馆藏)53、楷书仇锷墓志铭卷-(元・赵孟頫・京都阳明文库藏)54、楷书玄妙观重修三门记卷-(元・赵孟頫・东京国立博物馆藏)55、张氏通波阡表卷-(元・杨维桢・东京国立博物馆藏) 明清部分：56、草书七言绝句轴-(明・张弼・上海博物馆藏)57、行书服山药汤诗轴-(明・吴宽・上海博物馆藏)58、行书七言律诗轴-(明・沈周・上海博物馆藏)59、草书赤壁赋卷-(明・祝允明・上海博物馆藏)60、小楷九歌卷-(明・祝允明・上海博物馆藏)61、行书七言律诗轴-(明・王守仁・上海博物馆藏)62、草书自书诗卷-(明・王宠・上海博物馆藏)63、行书王慎庵六十寿诗轴-(明・陆深・上海博物馆藏)64、草书李白宫中行乐词卷-(明・陈淳・上海博物馆藏)65、行书午门朝见诗轴-(明・文徴明・上海博物馆藏)66、行书午门朝见诗卷-(明・文徴明・上海博物馆藏)67、草书五言律诗轴-(明・文彭・上海博物馆藏)68、隶书诸葛亮前后出师表卷-(明・文彭・上海博物馆藏)69、行书七言律诗轴-(明・王谷祥・上海博物馆藏)70、行书女芙馆十咏卷-(明・徐渭・上海博物馆藏)71、草书杜甫怀西郭茅舍诗轴-(明・徐渭・上海博物馆藏)72、隶书庭园记轴-(明・孙克弘・上海博物馆藏)73、行书五言律诗轴-(明・王稚登・上海博物馆藏)74、行书尊拙园诗轴-(明・米万钟・上海博物馆藏)75、行书李白游洞庭诗轴-(明・李流芳・上海博物馆藏)76、行书苏轼词轴-(明・董其昌・上海博物馆藏)77、楷书阴符经府君碑合卷-(明・董其昌・上海博物馆藏)78、行书自书诗卷-(明・陈继儒・上海博物馆藏)79、行书杜甫诗轴-(明・张瑞图・上海博物馆藏)80、行书五言律诗轴-(明・倪元璐・上海博物馆藏)81、行书赠高仲兄丈文语轴-(明・黄道周・上海博物馆藏)82、楷书嘉命辞卷-(明・黄道周・上海博物馆藏)83、行书五言律诗轴-(清・王铎・上海博物馆藏)84、小楷恭贺张老年伯荣寿卷-(清・王铎・上海博物馆藏)85、草书自书七言绝句诗四屏-(清・傅山・上海博物馆藏)86、行书五言诗卷-(清・朱耷・上海博物馆藏)87、行书题画五绝诗轴-(清・朱耷・上海博物馆藏)88、隶书赵构女史箴轴-(清・金农・上海博物馆藏)89、楷书画竹题记册-(清・金农・上海博物馆藏)90、行书王维诗轴-(清・郑燮・上海博物馆藏)91、隶书节临华山庙碑轴-(清・黄易・上海博物馆藏)92、行书黄庭坚论书轴-(清・王文治・上海博物馆藏)93、行书赠高华长老书卷-(清・刘墉・上海博物馆藏)94、篆书四斋铭-(清・邓石如・上海博物馆藏)95、行书论谷神章轴-(清・梁同书・上海博物馆藏)96、行书节临唐宋人书四屏-(清・伊秉绶・上海博物馆藏)97、行书七言律诗轴-(清・翁方纲・上海博物馆藏)98、草书节录王羲之传-(清・包世臣・上海博物馆藏)99、篆书诗经四屏-(清・吴熙载・上海博物馆藏)100、行书苏轼诗四屏-(清・何绍基・上海博物馆藏)101、篆隶书四屏-(清・赵之谦・上海博物馆藏)102、行书五言律诗轴-(清・吴昌硕・上海博物馆藏)]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[两次书展之观感]]></title>
    <url>%2F2006%2F04%2F05%2Fe4-b8-a4-e6-ac-a1-e4-b9-a6-e5-b1-95-e4-b9-8b-e8-a7-82-e6-84-9f%2F</url>
    <content type="text"><![CDATA[值交大百十校庆之年，前几天，徐庆华和詹人左两位老师在程及美术馆办了一次联合书画展。我也有幸去参观了一次。虽名为书画展，其实当为艺术展。其间除了书法与绘画，还有篆刻，雕版，制陶等其它的艺术形式。不过，对于我，那些都是不甚懂得的。吸引我的，还是那些白底黑字，加些红色印章的书法作品。而印象比较深的还是徐庆华老师的作品——人左老师的书法较少，且风格比较传统，究竟不如徐的先声夺人。 一直在上徐老师的书法选修课，所以对他的书风也有一定的了解——大致是稚拙一路的。而如此大规模的接触他的作品，却是头一回。徐老师长于篆刻，书法上工于行草隶篆，尤工大草。他的草书作品大气磅礴，用比较爽辣，不拘小节。不以小处患得失，多从整体上谋篇，所以作品多参差，且章法千变万化。他的草书多金石气，阅之笔笔如刀刻。后听他的介绍方知，他始学书法，也是因篆刻之故。所以他和常人不同的是，徐老师启蒙是从篆隶入手，转而练习其它书体。他的书法创作也是多从篆刻的刀法中取法，尽量吸纳各种元素，进行书法创作。而现在他进行了更大胆的书法尝试，体现在他的《书非书》系列中。作品中无字形，主要以下意识行笔，表达线条的美感，有点像西方的抽象画。 在观詹徐书展的后几天，我与同学相邀去了上海博物馆。这里举办的中日书法名品展，早已宣传得沸沸扬扬。久慕盛名之下，我也来凑个热闹。 这里展出的全都是历代书法名家的法书作品，以唐摹王羲之的《丧乱帖》为重头戏，而我这次却机缘不巧未得一见。展出中很多宋朝时的书法，主要是宋是苏黄米蔡四家。来上博之前，对于这些书家的认识，不过是一些照片和一些只言片语，而这次一次看到这么多珍品法书，对他们的了解又更深了一些。二王之秀逸，唐人写经的工谨，东坡的丰腴，山谷的恣肆，米芾的爽劲，蔡襄的精到，赵松雪的婉转却不媚俗，欧阳率更的险绝谨严却又不失变化。虽然各书家的风格迥异，他们都有一个共同点，就是用笔无不笔笔精纯，如入化境——实在佩服古人的笔感。 再观隔壁的日本书家的作品，对中国的书法文化又更增了敬仰之情。日本谓书法为书道，但却无甚可观之处。日本书法有三迹——小叶道风，藤原佐理，藤原行成。无非是学二王的笔法，无甚新意，在日本虽可谓圣人，贤者，放入中华书海之中，不过三可不甚亮的水珠而已。而如今，在日本，书法上为人所崇尚，在国内，却渐如死灰，心痛莫过于此。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[无]]></title>
    <url>%2F2006%2F03%2F26%2Fe6-97-a0-2%2F</url>
    <content type="text"><![CDATA[今天，考研复试——考研工程的最后一站。结果已经不是很重要了。没有了上个学期的诚惶诚恐和不达目的不罢休。 想想，已经大半年过去了——忙忙碌碌的大半年。眼看着就要毕业了。大学的最后一站，最后的一个学期。看着未来的同学，陌生的朋友，却又恍若隔世。 经过数个七月，这一个又不远了。。。。。。。。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[星期天 晴]]></title>
    <url>%2F2006%2F03%2F26%2Fe6-98-9f-e6-9c-9f-e5-a4-a9-e6-99-b4%2F</url>
    <content type="text"><![CDATA[看了《童梦奇缘》。一个童话一样的电影，又像极了佛经里的寓言。 人总是那么执著的,非要等到历经世事才能看透……十几岁的孩子，变成了八十几岁的老人，在数天之内——从顽皮、叛逆变成棺材里的其言也哀。 孩子总盼望着自己长大，却不知道岁月的可怕。等到老了，才知道曾经的珍贵。生命是一个过程，可悲的是它不能够重来；可喜的是，它也不需要重来…… 上天赋予每一个人的时间都是一样的，可是结果怎么样，是要靠自己把握的。 人生无过几十年，却又何必太执着]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[晴转多云]]></title>
    <url>%2F2006%2F03%2F07%2Fe6-99-b4-e8-bd-ac-e5-a4-9a-e4-ba-91%2F</url>
    <content type="text"><![CDATA[三月，乍暖还寒。感冒，难受。上课，点名。 晚上，刚申请了msn space。听着外面稚拙的笛声，写点什么吧。]]></content>
      <categories>
        <category>未分类</category>
      </categories>
  </entry>
</search>