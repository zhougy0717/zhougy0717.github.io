{
    "version": "https://jsonfeed.org/version/1",
    "title": "Big Ben • All posts by \"android\" tag",
    "description": null,
    "home_page_url": "https://blog.zhougy.top",
    "items": [
        {
            "id": "https://blog.zhougy.top/2018/04/22/Android%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95(%E4%BA%8C)_-_Roboletric_+_Powermock/",
            "url": "https://blog.zhougy.top/2018/04/22/Android%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95(%E4%BA%8C)_-_Roboletric_+_Powermock/",
            "title": "Android单元测试(二) - Roboletric + Powermock",
            "date_published": "2018-04-21T23:56:16.000Z",
            "content_html": "<!DOCTYPE en-note SYSTEM 'http://xml.evernote.com/pub/enml2.dtd'><div class=\"enNote\" style=\"color: #2c3f51; line-height: 1.6; background: none;\" title lang=\"v2\" xml:lang dir><del style=\"position:relative;display:block;z-index:10;\"><a style=\"position: absolute;color: #FFF;text-decoration: none;font-size: 12px;height: 25px;border-radius: 0;margin-top: -20px;right: 15px;background: rgba(0, 0, 0, 0);border-left: 10px solid #BB3A34;border-right: 10px solid #BB3A34;border-bottom: 5px solid rgba(0, 0, 0, 0);width: 0;text-indent:-100000px;\" href=\"http://maxiang.info/#/?provider=evernote&amp;guid=d168d11e-2deb-4f55-9005-c03b345f4a48&amp;notebook=myblog\">Edit</a></del><div style=\"color: #2c3f51; line-height: 1.6;\"><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"></p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">2016&#x5E74;&#x5728;&#x505A;&#x5FAE;&#x4FE1;&#x6253;&#x5370;Android agent app&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7814;&#x7A76;&#x8FC7;&#x5982;&#x4F55;&#x5728;&#x5F00;&#x53D1;Android app&#x7684;&#x65F6;&#x5019;TDD&#x3002;&#x8BE6;&#x7EC6;&#x53C2;&#x8003;&#x6B64;&#x7BC7;&#x535A;&#x6587;<a href=\"https://zhougy0717.github.io/2016/10/19/Android%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;</a>&#x3002; <br>&#x5F53;&#x65F6;&#x7684;&#x6700;&#x7EC8;&#x65B9;&#x6848;&#x662F;&#xFF1A;Powermock + Mockito + JUnit&#x505A;<a href=\"https://developer.android.com/training/testing/unit-testing/local-unit-tests.html\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">local test</a>&#x3002;&#x56E0;&#x4E3A;&#x8981;Mock&#x5404;&#x79CD;Android SDK&#x4E2D;&#x7684;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x4E00;&#x79CD;&#x88AB;&#x65E0;&#x529B;&#x63A7;&#x5236;&#x7684;&#x6050;&#x60E7;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x505A;Niwatori&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FDF;&#x8FDF;&#x6CA1;&#x6709;&#x5F00;&#x5C55;TDD&#x3002;&#x56E0;&#x4E3A;&#x6700;&#x8FD1;&#x6DFB;&#x52A0;&#x7684;&#x529F;&#x80FD;&#x7A0D;&#x5FAE;&#x6709;&#x70B9;&#x590D;&#x6742;&#x4E86;&#xFF0C;&#x611F;&#x89C9;&#x5404;&#x79CD;&#x4E0D;&#x987A;&#xFF0C;&#x6240;&#x4EE5;&#x8003;&#x8651;&#x91CD;&#x65B0;&#x62FE;&#x8D77;TDD&#x3002;&#x4E8E;&#x662F;&#x6709;&#x4E86;&#x5404;&#x79CD;&#x6298;&#x817E;&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x4E86;&#x4E4B;&#x524D;&#x65E0;&#x529B;&#x7684;&#x6050;&#x60E7;&#x540E;&#x7684;&#x8FD9;&#x4E00;&#x7BC7;&#x3002;&#x4E0D;&#x8FC7;&#x7ED3;&#x679C;&#x597D;&#x7684;&#x662F;&#x770B;&#x8D77;&#x6765;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x6761;Android app TDD&#x5F00;&#x53D1;&#x4E0D;&#x9519;&#x7684;&#x8DEF;&#x5B50;&#x3002;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x8981;&#x5F52;&#x529F;&#x4E8E;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">Roboletric</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x8D77;&#x521D;&#x7684;&#x76F8;&#x8BC6;&#x8FD8;&#x662F;&#x5728;<a href=\"https://developer.android.com/training/testing/fundamentals.html\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android developer&#x5B98;&#x7F51;&#x5173;&#x4E8E;&#x6D4B;&#x8BD5;&#x7684;&#x9875;&#x9762;</a>&#x3002;&#x7136;&#x540E;&#x5728;&#x641C;&#x7D22;Powermock&#x7528;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x770B;&#x5230;&#x5F88;&#x591A;&#x5E16;&#x5B50;&#x90FD;&#x63D0;&#x5230;&#x4E86;roboletric&#x3002;&#x56E0;&#x4E3A;&#x8BA4;&#x8BC6;&#x5230;Mockito + Powermock&#x7684;&#x5F31;&#x70B9;(&#x5982;&#x4E0B;)&#xFF0C;&#x6240;&#x4EE5;&#x51B3;&#x5B9A;&#x8F6C;&#x5411;roboletric&#x3002;</p><blockquote style=\"padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;\"><p style=\"margin: 0 0 1.1em; font-size: 1em; font-weight: 300; margin-bottom: 1.1em; line-height: 1.6;\">Mockito</p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\">&#x4E0D;&#x80FD;mock final class/method</li><li style=\"line-height: 1.6;\">&#x4E0D;&#x80FD;mock private/static</li></ul><p style=\"margin: 0 0 1.1em; font-size: 1em; font-weight: 300; margin-bottom: 1.1em; line-height: 1.6;\">Powermock</p><ul style=\"margin-top: 0; margin-bottom: 0; line-height: 1.6;\"><li style=\"line-height: 1.6;\">&#x9700;&#x8981;&#x81EA;&#x5DF1;mock&#x5404;&#x79CD;class&#xFF0C;&#x5F53;&#x51FD;&#x6570;&#x5927;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x56E0;&#x4E3A;&#x4F1A;&#x5F15;&#x7528;&#x975E;&#x5E38;&#x591A;&#x7684;Android&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x8BA9;&#x4EBA;&#x611F;&#x5230;&#x5F88;&#x65E0;&#x529B;</li></ul></blockquote><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5728;&#x7F16;&#x8BD1;Android app&#x7684;&#x65F6;&#x5019;&#xFF0C;Android SDK&#x4EE5;android.jar&#x7684;&#x5F62;&#x5F0F;&#x53C2;&#x4E0E;&#x7F16;&#x8BD1;&#x3002;&#x800C;&#x8FD9;&#x4E2A;android.jar&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x7C7B;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;stub&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4E0D;&#x7ECF;&#x8FC7;mock&#x5C31;&#x76F4;&#x63A5;&#x5728;Unit Test&#x4E2D;&#x4F7F;&#x7528;Android&#x7C7B;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">Error java.lang.RuntimeException: Stub!</code>&#x9519;&#x8BEF;&#x3002; <br>Roboletric&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x6D88;&#x9664;&#x8FD9;&#x79CD;&#x9519;&#x8BEF;&#x8BDE;&#x751F;&#x7684;&#x3002;&#x5B83;&#x4E3A;&#x6240;&#x6709;&#x7684;Android&#x7C7B;&#x5B9A;&#x4E49;&#x4E86;&#x53EF;&#x4EE5;&#x8DD1;&#x5728;PC&#x7AEF;JVM&#x4E0B;&#x7684;class&#x3002;&#x800C;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x989D;&#x5916;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x505A;&#x9694;&#x79BB;&#x6D4B;&#x8BD5;&#x4EE5;&#x53CA;UI&#x65B9;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x3002;</p><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 27.2px; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">&#x5165;&#x95E8;</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x9996;&#x5148;&#x63A8;&#x8350;&#x7684;&#x8FD8;&#x662F;<a href=\"http://robolectric.org/\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">&#x5B98;&#x7F51;&#x4E3B;&#x9875;</a>&#x3002;&#x7136;&#x540E;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x4E2D;&#x6587;&#x5E16;&#x5B50;&#xFF1A;</p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\"><a href=\"http://www.cnblogs.com/slgkaifa/p/7354609.html\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Robolectric&#x4F7F;&#x7528;&#x6559;&#x7A0B;</a>: &#x53EF;&#x4EE5;&#x53C2;&#x8003;Properties&#x6587;&#x4EF6;&#x4EE5;&#x53CA;Activity&#x751F;&#x547D;&#x5468;&#x671F;&#x90E8;&#x5206;&#x3002;</li><li style=\"line-height: 1.6;\"><a href=\"https://maxwell-nc.github.io/android/robolectricTest.html\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E4B;Robolectric&#x6846;&#x67B6;</a>: &#x53EF;&#x4EE5;&#x53C2;&#x8003;Robolectric&#x914D;&#x7F6E;&#x4EE5;&#x53CA;&#x9488;&#x5BF9;&#x5404;&#x79CD;Android&#x7EC4;&#x4EF6;&#x7684;&#x6D4B;&#x8BD5;&#x65B9;&#x6CD5;&#x90E8;&#x5206;&#x3002;</li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5BF9;&#x4E8E;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x548C;&#x7B2C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x6309;&#x7167;&#x5B98;&#x7F51;&#x7684;&#x6B65;&#x9AA4;&#x53BB;&#x505A;&#x3002;&#x56E0;&#x4E3A;&#x5728;setup&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5F80;&#x5F80;&#x6709;&#x5F88;&#x591A;&#x7248;&#x672C;&#x53F7;&#x4F9D;&#x8D56;&#x8981;&#x5904;&#x7406;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x8FD9;&#x79CD;&#x51FA;&#x8EAB;&#x793E;&#x533A;&#x7684;&#x6846;&#x67B6;&#x3002;&#x5F80;&#x5F80;&#x4F9D;&#x8D56;&#x5904;&#x7406;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x597D;&#x3002;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">Powermock + Roboletric</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x7528;&#x4E0A;Roboletric&#x4EE5;&#x540E;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x539F;&#x5148;&#x9700;&#x8981;&#x5404;&#x79CD;mock&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x73B0;&#x5728;&#x4E0D;&#x7528;&#x600E;&#x4E48;mock&#x5C31;&#x80FD;&#x7F16;&#x8FC7;&#x4E86;&#xFF0C;&#x751A;&#x81F3;&#x6709;&#x4E9B;listener&#x90FD;&#x80FD;&#x8D77;&#x4F5C;&#x7528;&#x3002;&#x4F46;&#x662F;&#x56E0;&#x4E3A;Roboletric&#x672C;&#x8EAB;&#x53EA;&#x662F;&#x63D0;&#x4F9B;Android SDK&#x7684;&#x526F;&#x672C;&#xFF0C;&#x5BF9;&#x4E8E;&#x6D4B;&#x8BD5;&#x5E76;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5728;&#x884C;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x5176;&#x76EE;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x66F4;power&#x7684;mock&#x5E93;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;&#x67D0;&#x4E9B;class&#x63D0;&#x4F9B;&#x9884;&#x8BBE;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5F02;&#x6216;&#x9700;&#x8981;&#x5BF9;&#x67D0;&#x4E9B;&#x5BF9;&#x8C61;&#x8C03;&#x7528;&#x6B21;&#x6570;&#x8FDB;&#x884C;verify&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD8;&#x662F;&#x9700;&#x8981;powermock&#x7684;&#xFF08;&#x6216;&#x8005;Mockito&#xFF0C;&#x4F46;&#x9274;&#x4E8E;&#x5176;&#x529F;&#x80FD;&#x5B9E;&#x5728;&#x592A;low&#xFF0C;&#x80FD;&#x7528;Powermock&#x7684;&#x5C31;&#x7528;Powermock&#x5427;&#xFF09;&#x3002; <br>&#x5165;&#x95E8;&#x53C2;&#x770B;Roboletric GitHub wiki&#xFF1A;<a href=\"https://github.com/robolectric/robolectric/wiki/Using-PowerMock\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Using PowerMock</a>&#x3002;&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; overflow-x: auto; background: #23241f; padding: 1.3em 2em;\"><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #75715e; background-color: transparent;\">@RunWith</span>(RobolectricTestRunner.class)</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #75715e; background-color: transparent;\">@Config</span>(constants = BuildConfig.class)</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #75715e; background-color: transparent;\">@PowerMockIgnore</span>(&#123; <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;org.mockito.*&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;org.robolectric.*&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;android.*&quot;</span> &#125;)</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #75715e; background-color: transparent;\">@PrepareForTest</span>(Static.class)</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">public</span> <span style=\"display: inline; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #66d9ef; background-color: transparent;\">class</span> <span style=\"display: inline; line-height: 1.6; color: #a6e22e; font-style: italic; background-color: transparent;\">DeckardActivityTest</span> </span>&#123;</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><div style=\"line-height: 1.6;\"></div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    <span style=\"display: inline; line-height: 1.6; color: #75715e; background-color: transparent;\">@Rule</span></div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    <span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">public</span> PowerMockRule rule = <span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">new</span> PowerMockRule();</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><div style=\"line-height: 1.6;\"></div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    <span style=\"display: inline; line-height: 1.6; color: #75715e; background-color: transparent;\">@Test</span></div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    <span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #66d9ef; background-color: transparent;\">public</span> <span style=\"display: inline; line-height: 1.6; color: #66d9ef; background-color: transparent;\">void</span> <span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">testStaticMocking</span><span style=\"display: inline; line-height: 1.6; color: #f8f8f2; background-color: transparent;\">()</span> </span>&#123;</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">        PowerMockito.mockStatic(Static.class);</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">        Mockito.when(Static.staticMethod()).thenReturn(<span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;hello mock&quot;</span>);</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><div style=\"line-height: 1.6;\"></div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">        assertTrue(Static.staticMethod().equals(<span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;hello mock&quot;</span>));</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &#125;</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">&#125;</div></div></div></div></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x7279;&#x522B;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;</p><ol start=\"1\" style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\">&#x56E0;&#x4E3A;class&#x5F00;&#x5934;&#x7528;&#x4E86;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">@RunWith(RobolectricTestRunner.class)</code>&#x6807;&#x6CE8;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x7528;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">PowermockTestRunner.class</code>&#x3002;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x52A0;&#x4E0A;&#x4E0B;&#x9762;&#x4E24;&#x884C;&#xFF1A;</li></ol><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; overflow-x: auto; background: #23241f; padding: 1.3em 2em;\"><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #75715e; background-color: transparent;\">@Rule</span></div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">public</span> PowerMockRule rule = <span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">new</span> PowerMockRule();</div></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5426;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x5404;&#x79CD;Powermock&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x4F8B;&#x5982;class&#x6CA1;&#x6709;prepare&#x5566;&#xFF0C;&#x4E0D;&#x80FD;mock private&#x51FD;&#x6570;&#x7B49;&#x7B49;&#x3002;</p><ol start=\"2\" style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\">&#x56E0;&#x4E3A;Roboletric&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;Shadow&#x7C7B;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x7C7B;&#x548C;mock&#x6709;&#x51B2;&#x7A81;&#x3002;&#x4F8B;&#x5982;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">Intent intent = mock(Intent.class)</code>&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD9;&#x4E2A;&#x83AB;&#x540D;&#x5176;&#x5999;&#x7684;&#x9519;&#x8BEF;&#x3002;</li></ol><blockquote style=\"padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;\"><p style=\"margin: 0 0 1.1em; font-size: 1em; font-weight: 300; margin-bottom: 0; line-height: 1.6;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">java.lang.LinkageError: loader constraint violation: loader (instance of net/bytebuddy/dynamic/loading/MultipleParentClassLoader) previously initiated loading for a different type with name &quot;org/xmlpull/v1/XmlSerializer</code></p></blockquote><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x6240;&#x4EE5;&#x5C31;&#x8981;&#x52A0;&#x4E0A;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">@PowerMockIgnore</code>&#x3002;&#x751A;&#x81F3;Ignore&#x7684;&#x5217;&#x8868;&#x8981;&#x66F4;&#x957F;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; overflow-x: auto; background: #23241f; padding: 1.3em 2em;\"><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">@<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">PowerMockIgnore</span>(&#123;</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">org</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.mockito</span>.*&quot;,</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">org</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.robolectric</span>.*&quot;,</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">android</span>.*&quot;,</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">javax</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.xml</span>.*&quot;,</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">org</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.xml</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.sax</span>.*&quot;,</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">org</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.w3c</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.dom</span>.*&quot;,</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">org</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.springframework</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.context</span>.*&quot;,</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">    &quot;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">org</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.apache</span><span style=\"display: inline; line-height: 1.6; color: #a6e22e; background-color: transparent;\">.log4j</span>.*&quot;</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">&#125;)</div></code></pre><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">&#x8E29;&#x5751;&#x5217;&#x8868;</h2><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 27.2px; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">PowerMockito.whenNew is not working</h3><blockquote style=\"padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;\"><p style=\"margin: 0 0 1.1em; font-size: 1em; font-weight: 300; margin-bottom: 0; line-height: 1.6;\">You need to put the class <strong style=\"font-weight: bold; line-height: 1.6;\">where the constructor is called</strong> into the @PrepareForTest annotation instead of the class which is being constructed - see Mock construction of new objects.</p></blockquote><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">&#x603B;&#x7ED3;</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x7528;Roboletric&#x6765;&#x89E3;&#x51B3;Android SDK&#x95EE;&#x9898;&#xFF0C;&#x7528;Powermock+JUnit&#x6765;&#x89E3;&#x51B3;unit test&#x95EE;&#x9898;&#x3002;</p></div><center style=\"display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden\">%23%20Android%u5355%u5143%u6D4B%u8BD5%28%u4E8C%29%20-%20Roboletric%20+%20Powermock%0A@%28myblog%29%5BAndroid%2C%20unittest%5D%0A%0A2016%u5E74%u5728%u505A%u5FAE%u4FE1%u6253%u5370Android%20agent%20app%u7684%u65F6%u5019%uFF0C%u7814%u7A76%u8FC7%u5982%u4F55%u5728%u5F00%u53D1Android%20app%u7684%u65F6%u5019TDD%u3002%u8BE6%u7EC6%u53C2%u8003%u6B64%u7BC7%u535A%u6587%5BAndroid%u5355%u5143%u6D4B%u8BD5%5D%28https%3A//zhougy0717.github.io/2016/10/19/Android%25E5%258D%2595%25E5%2585%2583%25E6%25B5%258B%25E8%25AF%2595/%29%u3002%0A%u5F53%u65F6%u7684%u6700%u7EC8%u65B9%u6848%u662F%uFF1APowermock%20+%20Mockito%20+%20JUnit%u505A%5Blocal%20test%5D%28https%3A//developer.android.com/training/testing/unit-testing/local-unit-tests.html%29%u3002%u56E0%u4E3A%u8981Mock%u5404%u79CDAndroid%20SDK%u4E2D%u7684%u7C7B%uFF0C%u6240%u4EE5%u6709%u4E00%u79CD%u88AB%u65E0%u529B%u63A7%u5236%u7684%u6050%u60E7%u3002%u6240%u4EE5%u5728%u505ANiwatori%u7684%u65F6%u5019%uFF0C%u8FDF%u8FDF%u6CA1%u6709%u5F00%u5C55TDD%u3002%u56E0%u4E3A%u6700%u8FD1%u6DFB%u52A0%u7684%u529F%u80FD%u7A0D%u5FAE%u6709%u70B9%u590D%u6742%u4E86%uFF0C%u611F%u89C9%u5404%u79CD%u4E0D%u987A%uFF0C%u6240%u4EE5%u8003%u8651%u91CD%u65B0%u62FE%u8D77TDD%u3002%u4E8E%u662F%u6709%u4E86%u5404%u79CD%u6298%u817E%uFF0C%u5E76%u9A8C%u8BC1%u4E86%u4E4B%u524D%u65E0%u529B%u7684%u6050%u60E7%u540E%u7684%u8FD9%u4E00%u7BC7%u3002%u4E0D%u8FC7%u7ED3%u679C%u597D%u7684%u662F%u770B%u8D77%u6765%u627E%u5230%u4E86%u4E00%u6761Android%20app%20TDD%u5F00%u53D1%u4E0D%u9519%u7684%u8DEF%u5B50%u3002%0A%0A%u8FD9%u4E00%u5207%u90FD%u8981%u5F52%u529F%u4E8E%0A%23%23%20Roboletric%0A%u8D77%u521D%u7684%u76F8%u8BC6%u8FD8%u662F%u5728%5BAndroid%20developer%u5B98%u7F51%u5173%u4E8E%u6D4B%u8BD5%u7684%u9875%u9762%5D%28https%3A//developer.android.com/training/testing/fundamentals.html%29%u3002%u7136%u540E%u5728%u641C%u7D22Powermock%u7528%u6CD5%u7684%u65F6%u5019%uFF0C%u770B%u5230%u5F88%u591A%u5E16%u5B50%u90FD%u63D0%u5230%u4E86roboletric%u3002%u56E0%u4E3A%u8BA4%u8BC6%u5230Mockito%20+%20Powermock%u7684%u5F31%u70B9%28%u5982%u4E0B%29%uFF0C%u6240%u4EE5%u51B3%u5B9A%u8F6C%u5411roboletric%u3002%0A%3E%20Mockito%0A%3E%20-%20%u4E0D%u80FDmock%20final%20class/method%0A%3E%20-%20%u4E0D%u80FDmock%20private/static%0A%0A%3E%20Powermock%0A%3E%20-%20%u9700%u8981%u81EA%u5DF1mock%u5404%u79CDclass%uFF0C%u5F53%u51FD%u6570%u5927%u4E86%u7684%u65F6%u5019%uFF0C%u56E0%u4E3A%u4F1A%u5F15%u7528%u975E%u5E38%u591A%u7684Android%u7C7B%uFF0C%u6240%u4EE5%u4F1A%u8BA9%u4EBA%u611F%u5230%u5F88%u65E0%u529B%0A%0A%u5728%u7F16%u8BD1Android%20app%u7684%u65F6%u5019%uFF0CAndroid%20SDK%u4EE5android.jar%u7684%u5F62%u5F0F%u53C2%u4E0E%u7F16%u8BD1%u3002%u800C%u8FD9%u4E2Aandroid.jar%u4E2D%u7684%u5404%u4E2A%u7C7B%u5E76%u6CA1%u6709%u5177%u4F53%u7684%u5B9E%u73B0%uFF0C%u53EA%u662F%u4E00%u4E2Astub%u3002%u6240%u4EE5%u5982%u679C%u4E0D%u7ECF%u8FC7mock%u5C31%u76F4%u63A5%u5728Unit%20Test%u4E2D%u4F7F%u7528Android%u7C7B%u5C31%u4F1A%u51FA%u73B0%60Error%20java.lang.RuntimeException%3A%20Stub%21%60%u9519%u8BEF%u3002%0ARoboletric%u5C31%u662F%u4E3A%u4E86%u6D88%u9664%u8FD9%u79CD%u9519%u8BEF%u8BDE%u751F%u7684%u3002%u5B83%u4E3A%u6240%u6709%u7684Android%u7C7B%u5B9A%u4E49%u4E86%u53EF%u4EE5%u8DD1%u5728PC%u7AEFJVM%u4E0B%u7684class%u3002%u800C%u4E14%u63D0%u4F9B%u4E86%u5F88%u591A%u989D%u5916%u7684%u529F%u80FD%uFF0C%u65B9%u4FBF%u5F00%u53D1%u8005%u505A%u9694%u79BB%u6D4B%u8BD5%u4EE5%u53CAUI%u65B9%u9762%u7684%u6D4B%u8BD5%u3002%0A%0A%23%23%23%20%u5165%u95E8%0A%u9996%u5148%u63A8%u8350%u7684%u8FD8%u662F%5B%u5B98%u7F51%u4E3B%u9875%5D%28http%3A//robolectric.org/%29%u3002%u7136%u540E%u8FD8%u6709%u51E0%u4E2A%u4E0D%u9519%u7684%u4E2D%u6587%u5E16%u5B50%uFF1A%0A-%20%5BRobolectric%u4F7F%u7528%u6559%u7A0B%5D%28http%3A//www.cnblogs.com/slgkaifa/p/7354609.html%29%3A%20%u53EF%u4EE5%u53C2%u8003Properties%u6587%u4EF6%u4EE5%u53CAActivity%u751F%u547D%u5468%u671F%u90E8%u5206%u3002%0A-%20%5BAndroid%u5355%u5143%u6D4B%u8BD5%u4E4BRobolectric%u6846%u67B6%5D%28https%3A//maxwell-nc.github.io/android/robolectricTest.html%29%3A%20%u53EF%u4EE5%u53C2%u8003Robolectric%u914D%u7F6E%u4EE5%u53CA%u9488%u5BF9%u5404%u79CDAndroid%u7EC4%u4EF6%u7684%u6D4B%u8BD5%u65B9%u6CD5%u90E8%u5206%u3002%0A%0A%u5BF9%u4E8E%u914D%u7F6E%u73AF%u5883%u548C%u7B2C%u4E00%u4E2A%u7B80%u5355%u7684%u5B9E%u4F8B%uFF0C%u6700%u597D%u662F%u6309%u7167%u5B98%u7F51%u7684%u6B65%u9AA4%u53BB%u505A%u3002%u56E0%u4E3A%u5728setup%u7684%u65F6%u5019%uFF0C%u5F80%u5F80%u6709%u5F88%u591A%u7248%u672C%u53F7%u4F9D%u8D56%u8981%u5904%u7406%uFF0C%u5C24%u5176%u662F%u8FD9%u79CD%u51FA%u8EAB%u793E%u533A%u7684%u6846%u67B6%u3002%u5F80%u5F80%u4F9D%u8D56%u5904%u7406%u4E0D%u662F%u7279%u522B%u597D%u3002%0A%0A%23%23%20Powermock%20+%20Roboletric%0A%u7528%u4E0ARoboletric%u4EE5%u540E%uFF0C%u4F60%u4F1A%u53D1%u73B0%u539F%u5148%u9700%u8981%u5404%u79CDmock%u7684%u51FD%u6570%uFF0C%u73B0%u5728%u4E0D%u7528%u600E%u4E48mock%u5C31%u80FD%u7F16%u8FC7%u4E86%uFF0C%u751A%u81F3%u6709%u4E9Blistener%u90FD%u80FD%u8D77%u4F5C%u7528%u3002%u4F46%u662F%u56E0%u4E3ARoboletric%u672C%u8EAB%u53EA%u662F%u63D0%u4F9BAndroid%20SDK%u7684%u526F%u672C%uFF0C%u5BF9%u4E8E%u6D4B%u8BD5%u5E76%u4E0D%u662F%u90A3%u4E48%u5728%u884C%uFF0C%u6216%u8005%u8BF4%u5176%u76EE%u7684%u5E76%u4E0D%u662F%u4E00%u4E2A%u66F4power%u7684mock%u5E93%u3002%u5F53%u6211%u4EEC%u9700%u8981%u4E3A%u67D0%u4E9Bclass%u63D0%u4F9B%u9884%u8BBE%u7684%u529F%u80FD%uFF0C%u5F02%u6216%u9700%u8981%u5BF9%u67D0%u4E9B%u5BF9%u8C61%u8C03%u7528%u6B21%u6570%u8FDB%u884Cverify%u7684%u65F6%u5019%uFF0C%u8FD8%u662F%u9700%u8981powermock%u7684%uFF08%u6216%u8005Mockito%uFF0C%u4F46%u9274%u4E8E%u5176%u529F%u80FD%u5B9E%u5728%u592Alow%uFF0C%u80FD%u7528Powermock%u7684%u5C31%u7528Powermock%u5427%uFF09%u3002%0A%u5165%u95E8%u53C2%u770BRoboletric%20GitHub%20wiki%uFF1A%5BUsing%20PowerMock%5D%28https%3A//github.com/robolectric/robolectric/wiki/Using-PowerMock%29%u3002%u793A%u4F8B%u5982%u4E0B%uFF1A%0A%60%60%60java%0A@RunWith%28RobolectricTestRunner.class%29%0A@Config%28constants%20%3D%20BuildConfig.class%29%0A@PowerMockIgnore%28%7B%20%22org.mockito.*%22%2C%20%22org.robolectric.*%22%2C%20%22android.*%22%20%7D%29%0A@PrepareForTest%28Static.class%29%0Apublic%20class%20DeckardActivityTest%20%7B%0A%0A%20%20%20%20@Rule%0A%20%20%20%20public%20PowerMockRule%20rule%20%3D%20new%20PowerMockRule%28%29%3B%0A%0A%20%20%20%20@Test%0A%20%20%20%20public%20void%20testStaticMocking%28%29%20%7B%0A%20%20%20%20%20%20%20%20PowerMockito.mockStatic%28Static.class%29%3B%0A%20%20%20%20%20%20%20%20Mockito.when%28Static.staticMethod%28%29%29.thenReturn%28%22hello%20mock%22%29%3B%0A%0A%20%20%20%20%20%20%20%20assertTrue%28Static.staticMethod%28%29.equals%28%22hello%20mock%22%29%29%3B%0A%20%20%20%20%7D%0A%7D%0A%60%60%60%0A%u7279%u522B%u8981%u6CE8%u610F%u7684%u662F%uFF1A%0A1.%20%u56E0%u4E3Aclass%u5F00%u5934%u7528%u4E86%60@RunWith%28RobolectricTestRunner.class%29%60%u6807%u6CE8%uFF0C%u6240%u4EE5%u65E0%u6CD5%u7528%60PowermockTestRunner.class%60%u3002%u6240%u4EE5%u5FC5%u987B%u52A0%u4E0A%u4E0B%u9762%u4E24%u884C%uFF1A%0A%60%60%60%0A@Rule%0Apublic%20PowerMockRule%20rule%20%3D%20new%20PowerMockRule%28%29%3B%0A%60%60%60%0A%u5426%u5219%u4F1A%u51FA%u73B0%u5404%u79CDPowermock%u65E0%u6CD5%u5DE5%u4F5C%u7684%u5F02%u5E38%uFF0C%u4F8B%u5982class%u6CA1%u6709prepare%u5566%uFF0C%u4E0D%u80FDmock%20private%u51FD%u6570%u7B49%u7B49%u3002%0A%0A2.%20%u56E0%u4E3ARoboletric%u63D0%u4F9B%u4E86%u5F88%u591AShadow%u7C7B%uFF0C%u800C%u8FD9%u4E9B%u7C7B%u548Cmock%u6709%u51B2%u7A81%u3002%u4F8B%u5982%60Intent%20intent%20%3D%20mock%28Intent.class%29%60%u5C31%u4F1A%u5BFC%u81F4%u8FD9%u4E2A%u83AB%u540D%u5176%u5999%u7684%u9519%u8BEF%u3002%0A%0A%3E%60java.lang.LinkageError%3A%20loader%20constraint%20violation%3A%20loader%20%28instance%20of%20net/bytebuddy/dynamic/loading/MultipleParentClassLoader%29%20previously%20initiated%20loading%20for%20a%20different%20type%20with%20name%20%22org/xmlpull/v1/XmlSerializer%60%0A%0A%u6240%u4EE5%u5C31%u8981%u52A0%u4E0A%60@PowerMockIgnore%60%u3002%u751A%u81F3Ignore%u7684%u5217%u8868%u8981%u66F4%u957F%uFF0C%u4F8B%u5982%uFF1A%0A%60%60%60%0A@PowerMockIgnore%28%7B%20%0A%09%22org.mockito.*%22%2C%20%0A%09%22org.robolectric.*%22%2C%20%0A%09%22android.*%22%2C%0A%09%22javax.xml.*%22%2C%20%0A%09%22org.xml.sax.*%22%2C%20%0A%09%22org.w3c.dom.*%22%2C%20%20%0A%09%22org.springframework.context.*%22%2C%20%0A%09%22org.apache.log4j.*%22%20%0A%7D%29%0A%60%60%60%0A%0A%23%23%20%u8E29%u5751%u5217%u8868%0A%23%23%23%20PowerMockito.whenNew%20is%20not%20working%0A%3EYou%20need%20to%20put%20the%20class%20**where%20the%20constructor%20is%20called**%20into%20the%20@PrepareForTest%20annotation%20instead%20of%20the%20class%20which%20is%20being%20constructed%20-%20see%20Mock%20construction%20of%20new%20objects.%0A%0A%23%23%20%u603B%u7ED3%0A%u7528Roboletric%u6765%u89E3%u51B3Android%20SDK%u95EE%u9898%uFF0C%u7528Powermock+JUnit%u6765%u89E3%u51B3unit%20test%u95EE%u9898%u3002</center><br></div>",
            "tags": [
                "Android",
                "unittest"
            ]
        },
        {
            "id": "https://blog.zhougy.top/2018/01/17/XSharedPreference%20&%20SharedPreference%20-%20XPosed%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84preference%E4%BD%BF%E7%94%A8/",
            "url": "https://blog.zhougy.top/2018/01/17/XSharedPreference%20&%20SharedPreference%20-%20XPosed%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84preference%E4%BD%BF%E7%94%A8/",
            "title": "XSharedPreference & SharedPreference - XPosed模块中的preference使用",
            "date_published": "2018-01-17T04:39:32.000Z",
            "content_html": "<div class=\"enNote\" style=\"color: #2c3f51; line-height: 1.6; display: block;\" title lang=\"v2\" xml:lang dir><del style=\"position:relative;display:block;z-index:10;\"><a style=\"position: absolute;color: #FFF;text-decoration: none;font-size: 12px;height: 25px;border-radius: 0;margin-top: -20px;right: 15px;background: rgba(0, 0, 0, 0);border-left: 10px solid #BB3A34;border-right: 10px solid #BB3A34;border-bottom: 5px solid rgba(0, 0, 0, 0);width: 0;text-indent:-100000px;\" href=\"http://maxiang.info/#/?provider=evernote&amp;guid=08e07dee-5c97-456f-bc56-9bc11bb354a0&amp;notebook=myblog\">Edit</a></del><div style=\"color: #2c3f51; line-height: 1.6; display: block;\"><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"></p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x6700;&#x8FD1;&#x5728;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;Xposed&#x6A21;&#x5757;[]Niwatori-One Handed Mode](<a href=\"https://github.com/tkgktyk/Niwatori\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">https://github.com/tkgktyk/Niwatori</a>)&#x3002;&#x539F;&#x4F5C;&#x8005;tkgktyk&#x5DF2;&#x7ECF;&#x505C;&#x6B62;&#x66F4;&#x65B0;&#x4E86;&#xFF0C;&#x5BFC;&#x81F4;&#x6A21;&#x5757;&#x5728;Xposed Framework for Nougat&#x53D1;&#x5E03;&#x4EE5;&#x540E;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x3002;&#x4E8E;&#x662F;&#x6211;fork&#x4E86;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#xFF0C;&#x5F00;&#x59CB;&#x505A;Android Nougat&#x4E0A;&#x7684;&#x9002;&#x914D;&#x5DE5;&#x4F5C;&#xFF0C;&#x5E76;&#x5728;XDA&#x4E0A;&#x53D1;&#x5E03;&#x4E86;&#x66F4;&#x65B0;<a href=\"https://forum.xda-developers.com/xposed/modules/mod-niwatori-one-handed-mode-t3730963\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">&#x94FE;&#x63A5;</a>&#x3002; <br>&#x5728;&#x9002;&#x914D;&#x4E86;Nougat&#x4E4B;&#x540E;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x66F4;&#x597D;&#x3002;&#x76EE;&#x524D;&#x60F3;&#x505A;&#x7684;&#x662F;&#x80FD;&#x901A;&#x8FC7;fooview&#x8C03;&#x7528;Niwatori&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x3002;&#x5E76;&#x4E14;&#x8BE5;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x662F;small screen&#x8FD8;&#x662F;slide down&#x7B49;&#x7B49;&#xFF0C;&#x80FD;&#x901A;&#x8FC7;Niwatori&#x672C;&#x8EAB;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;&#x4F46;&#x662F;&#x5728;&#x5F00;&#x53D1;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x52A8;&#x6001;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x52A0;&#x8F7D;&#x9700;&#x8981;&#x4F7F;&#x7528;SDK 25&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x4ECE;SDK 25&#x5F00;&#x59CB;&#xFF0C;&#x539F;&#x5148;SharedPreference&#x7684;&#x6253;&#x5F00;&#x65B9;&#x5F0F;MODE_WORLD_PRIVATE&#x5DF2;&#x7ECF;&#x88AB;&#x7981;&#x6B62;&#x4E86;&#x3002;&#x4F7F;&#x7528;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;security exception&#x3002; <br>&#x6240;&#x4EE5;&#x8981;&#x5347;&#x5230;&#x4F7F;&#x7528;SDK 25&#xFF0C;&#x5FC5;&#x987B;&#x89E3;&#x51B3;preference&#x5F15;&#x7528;&#x7684;&#x95EE;&#x9898;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5230;&#x5E95;&#x4F1A;&#x5728;&#x54EA;&#x91CC;&#x5F71;&#x54CD;&#x5230;&#x6211;&#x4EEC;&#x7684;Xposed&#x6A21;&#x5757;&#x5462;&#xFF1F;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">Xposed&#x4E2D;&#x7684;preference</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">Xposed&#x6A21;&#x5757;&#x4E2D;&#x4F7F;&#x7528;preference&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x901A;&#x8FC7;XSharedPreference&#x6765;&#x64CD;&#x4F5C;&#x3002;XSharedPreference&#x5728;Android&#x6807;&#x51C6;&#x7684;SharedPreference&#x7C7B;&#x4E0A;&#x5305;&#x4E86;&#x4E00;&#x5C42;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;security&#x7684;fix&#x6216;&#x8005;work around&#x3002;&#x4F8B;&#x5982;&#xFF1A;XSharedPreference.makeWorldReadable&#x3002;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;&#x52A0;&#x8F7D;app data&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;xml&#x6587;&#x4EF6;&#x6765;&#x8BFB;&#x53D6;&#x3001;&#x5B58;&#x50A8;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E3A;&#xFF08;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF09;&#xFF1A;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml</code>&#x3002;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x901A;&#x5E38;Xposed&#x4E2D;&#x5982;&#x4E0B;&#x4F7F;&#x7528;preference&#x4F1A;&#x6309;&#x7167;&#x5982;&#x4E0B;&#x7684;&#x65F6;&#x5E8F;&#x56FE;&#xFF0C;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF1A;</p><div style=\"text-align: center; margin-bottom: 1.1em; line-height: 1.6; display: block;\"><span style=\"line-height: 1.6;\"><img class=\"enMedia\" src=\"/images/XSharedPreference &amp; SharedPreference - XPosed&#x6A21;&#x5757;&#x4E2D;&#x7684;preference&#x4F7F;&#x7528;/SVG78bf507dfa06d67d15e9356fa67699ec\" hash=\"faf526b522cf280365ebea346d0a680e\" align alt longdesc width=\"1057.2\" height=\"454.2\" border hspace vspace usemap style=\"border: 0; vertical-align: middle; max-width: 100%; margin-top: 0; margin-bottom: 0;\" title lang xml:lang dir></span></div><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\">XSharedPreference&#x5B9E;&#x4F8B;&#x521B;&#x5EFA;&#x5728;&#x6A21;&#x5757;&#x52A0;&#x8F7D;&#x7684;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">initZygote</code>&#x4E2D;</li><li style=\"line-height: 1.6;\">&#x6570;&#x636E;&#x7684;&#x4F7F;&#x7528;&#x901A;&#x8FC7;&#x94A9;&#x5B50;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x5404;&#x4E2A;app&#x7684;Context&#x5E95;&#x4E0B;&#x6267;&#x884C;</li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x4E8E;&#x662F;&#x5F53;MODE_WORLD_READABLE&#x88AB;&#x5E9F;&#x6B62;&#x4EE5;&#x540E;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x5373;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;app1&#x662F;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x67E5;&#x770B;Niwatori&#x7684;preference&#x6587;&#x4EF6;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x6CD5;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x3002;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">Xposed&#x5B98;&#x65B9;&#x6216;&#x8005;&#x4F5C;&#x8005;rovo89&#x8FD8;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x5B98;&#x65B9;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x603B;&#x662F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x672A;&#x96E8;&#x7EF8;&#x7F2A;&#x7684;&#x52C7;&#x58EB;&#xFF0C;XDA&#x4E0A;&#x6709;&#x4E00;&#x4E2A;&#x5E16;&#x5B50;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;work around&#xFF1A;<a href=\"https://forum.xda-developers.com/xposed/development/modeworldreadable-android-n-t3407123\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">MODE_WORLD_READABLE in Android N</a></p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x6211;&#x5728;Niwatori&#x4E2D;&#x4E5F;&#x4F7F;&#x7528;&#x4E86;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x4E0D;&#x662F;&#x5B8C;&#x7F8E;&#x89E3;&#x51B3;&#xFF0C;&#x800C;&#x4E14;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x6539;&#x8FDB;&#x3002;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898;</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x8BE5;work around&#x548C;XSharedPreference.makeWorldReadable&#x540C;&#x7406;&#xFF0C;&#x6211;&#x5982;&#x4E0B;&#x8C03;&#x7528;preference&#xFF1A;</p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; overflow-x: auto; background: #23241f; padding: 1.3em 2em;\"><div style=\"line-height: 1.6; display: block;\">mPrefs.makeWorldReadable();</div><div style=\"line-height: 1.6; display: block;\"><span style=\"display: inline; line-height: 1.6; color: #f92672;\">Log</span>.<span style=\"display: inline; line-height: 1.6; color: #e6db74;\">e</span>(<span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;Ben&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;package:&quot;</span> + decorView.getContext().getPackageName() + <span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;, &quot;</span> + decorView + <span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;,&quot;</span> + mPrefs.getString(<span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;key_boundary_color_ms&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;default value&quot;</span>));</div><div style=\"line-height: 1.6; display: block;\"><span style=\"display: inline; line-height: 1.6; color: #f92672;\">Log</span>.<span style=\"display: inline; line-height: 1.6; color: #e6db74;\">e</span>(<span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;Ben&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74;\">&quot;file can read: &quot;</span> + mPrefs.getFile().canRead()); &lt;-- &#x6709;&#x4E9B;<span style=\"display: inline; line-height: 1.6; color: #f92672;\">app</span>&#x4F1A;&#x662F;true&#xFF0C;&#x6709;&#x4E9B;<span style=\"display: inline; line-height: 1.6; color: #f92672;\">app</span>&#x4F1A;&#x662F;false</div></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5F53;&#x8FD4;&#x56DE;true&#x7684;&#x65F6;&#x5019;&#xFF0C;settings&#x5C31;&#x6210;&#x529F;&#x7684;&#x4F20;&#x5230;&#x4E86;&#x5BF9;&#x5E94;app&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x800C;&#x53EF;&#x4EE5;read&#x65F6;&#x800C;&#x4E0D;&#x53EF;&#x4EE5;read&#xFF0C;&#x6211;&#x4E5F;&#x5F88;&#x82E6;&#x607C;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#x513F;&#x3002;&#x7559;&#x5F85;&#x4EE5;&#x540E;&#x518D;&#x89E3;&#x51B3;&#x4E86;&#x3002;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">&#x89E3;&#x51B3;&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898; - 20180119</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x4EE5;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;Android 7.0&#x5F00;&#x59CB;&#xFF0C;&#x5373;&#x4ECE;SDK 24&#x5F00;&#x59CB;&#xFF0C;Android&#x52A0;&#x5165;&#x4E86;&#x5F88;&#x591A;security&#x65B9;&#x9762;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x53C2;&#x8003;<a href=\"https://blog.compass-security.com/2016/10/android-7-0-security-features-direct-boot/\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android 7.0 Security Features: Direct Boot</a>&#x3002;&#x8FD9;&#x548C;&#x6211;&#x4EEC;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x592A;&#x76F8;&#x5173;&#x3002;&#x76F8;&#x5173;&#x7684;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;Nougat&#x4E0D;&#x5141;&#x8BB8;world readable&#x7684;&#x6587;&#x4EF6;&#x4E86;&#x3002;&#x5982;&#x679C;&#x7528;SDK25&#x7F16;&#x8BD1;&#x7684;app&#x8FD8;&#x7528;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">MODE_WORLD_READABLE</code>&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x62A5;exception&#x3002; <br>Google&#x4E0A;&#x9C9C;&#x5C11;&#x6709;&#x76F8;&#x5173;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;</p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\"><a href=\"https://github.com/GravityBox/GravityBox/commit/d825b7be445c18de9a90eb8f77c1c5eb2b74deb8\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">GravityBox commit - Use device protected storage for preferences and files</a></li><li style=\"line-height: 1.6;\"><a href=\"https://github.com/rovo89/XposedBridge/issues/206\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">XposedBridge issue 1 - Any place to store world readable preferences on Nougat?</a></li><li style=\"line-height: 1.6;\"><a href=\"https://github.com/rovo89/XposedBridge/issues/74\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">XposedBridge issue 2 - Preferences of a module cannot be read from different process on some devices running MM</a></li><li style=\"line-height: 1.6;\"><a href=\"https://github.com/rovo89/XposedBridge/issues/102\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">XposedBridge issue 3 - XSharedPreferences doesn&#x2019;t work</a></li><li style=\"line-height: 1.6;\"><a href=\"https://forum.xda-developers.com/xposed/xposed-nougat-to-read-prefs-ith-fbe-t3690048\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">[Q] Xposed for nougat to read prefs ith fbe or without</a></li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;&#xFF0C;&#x662F;XposedBridge issue 1&#x4E2D;GravityBox&#x4F5C;&#x8005;&#x7684;&#x4E00;&#x4E2A;comment&#x63D0;&#x5230;&#x4E86;&#x6700;&#x7EC8;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;&#x8BE5;comment&#x5982;&#x4E0B;&#xFF1A;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"><img class=\"enMedia\" src=\"/images/XSharedPreference &amp; SharedPreference - XPosed&#x6A21;&#x5757;&#x4E2D;&#x7684;preference&#x4F7F;&#x7528;/1516334231370.png\" hash=\"4bb9cc0ad024876dd28baed5c27bad27\" align alt longdesc width=\"792\" height=\"382\" border hspace vspace usemap style=\"border: 0; vertical-align: middle; max-width: 100%;\" title lang xml:lang dir></p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">setStorageDeviceProtected</code></li><li style=\"line-height: 1.6;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">createDeviceProtectedStorageContext</code></li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5C06;preference&#x6587;&#x4EF6;&#x5B58;&#x5230;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">/data/user_de/0/&lt;package name&gt;/shared_prefs</code>&#x4E0B;&#x3002;&#x5E76;&#x5728;Xposed&#x7684;context&#x7AEF;&#xFF0C;&#x76F4;&#x63A5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002; <br>&#x4F46;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x9700;&#x5982;&#x6B64;&#x3002;&#x53EA;&#x8981;&#x4FDD;&#x8BC1;package folder&#x7684;&#x6743;&#x9650;&#x81F3;&#x5C11;&#x662F;711&#xFF0C;preference.xml&#x6587;&#x4EF6;&#x6709;&#x53EF;&#x8BFB;&#x6743;&#x9650;&#x5373;&#x53EF;&#x3002;</p></div><center style=\"display:none\">%23%20XSharedPreference%20%26%20SharedPreference%20-%20XPosed%u6A21%u5757%u4E2D%u7684preference%u4F7F%u7528%0A@%28myblog%29%5BAndroid%2C%20xposed%5D%0A%0A%u6700%u8FD1%u5728%u7EF4%u62A4%u4E00%u4E2AXposed%u6A21%u5757%5B%5DNiwatori-One%20Handed%20Mode%5D%28https%3A//github.com/tkgktyk/Niwatori%29%u3002%u539F%u4F5C%u8005tkgktyk%u5DF2%u7ECF%u505C%u6B62%u66F4%u65B0%u4E86%uFF0C%u5BFC%u81F4%u6A21%u5757%u5728Xposed%20Framework%20for%20Nougat%u53D1%u5E03%u4EE5%u540E%uFF0C%u4E0D%u80FD%u4F7F%u7528%u3002%u4E8E%u662F%u6211fork%u4E86%u4E00%u4EFD%u4EE3%u7801%uFF0C%u5F00%u59CB%u505AAndroid%20Nougat%u4E0A%u7684%u9002%u914D%u5DE5%u4F5C%uFF0C%u5E76%u5728XDA%u4E0A%u53D1%u5E03%u4E86%u66F4%u65B0%5B%u94FE%u63A5%5D%28https%3A//forum.xda-developers.com/xposed/modules/mod-niwatori-one-handed-mode-t3730963%29%u3002%0A%u5728%u9002%u914D%u4E86Nougat%u4E4B%u540E%uFF0C%u5E0C%u671B%u80FD%u6DFB%u52A0%u4E00%u4E9B%u65B0%u529F%u80FD%uFF0C%u8BA9%u7528%u6237%u4F53%u9A8C%u66F4%u597D%u3002%u76EE%u524D%u60F3%u505A%u7684%u662F%u80FD%u901A%u8FC7fooview%u8C03%u7528Niwatori%u7684%u5FEB%u6377%u65B9%u5F0F%u3002%u5E76%u4E14%u8BE5%u5FEB%u6377%u65B9%u5F0F%u7684%u529F%u80FD%uFF0C%u4F8B%u5982%u662Fsmall%20screen%u8FD8%u662Fslide%20down%u7B49%u7B49%uFF0C%u80FD%u901A%u8FC7Niwatori%u672C%u8EAB%u8FDB%u884C%u914D%u7F6E%u3002%u4F46%u662F%u5728%u5F00%u53D1%u8FD9%u4E00%u529F%u80FD%u7684%u65F6%u5019%uFF0C%u53D1%u73B0%u52A8%u6001%u5FEB%u6377%u65B9%u5F0F%u7684%u52A0%u8F7D%u9700%u8981%u4F7F%u7528SDK%2025%u4EE5%u4E0A%u7248%u672C%uFF0C%u800C%u4ECESDK%2025%u5F00%u59CB%uFF0C%u539F%u5148SharedPreference%u7684%u6253%u5F00%u65B9%u5F0FMODE%5C_WORLD%5C_PRIVATE%u5DF2%u7ECF%u88AB%u7981%u6B62%u4E86%u3002%u4F7F%u7528%u5B83%u4F1A%u5BFC%u81F4security%20exception%u3002%0A%u6240%u4EE5%u8981%u5347%u5230%u4F7F%u7528SDK%2025%uFF0C%u5FC5%u987B%u89E3%u51B3preference%u5F15%u7528%u7684%u95EE%u9898%u3002%u90A3%u4E48%u8FD9%u4E2A%u6A21%u5F0F%u7684%u53D8%u5316%uFF0C%u5230%u5E95%u4F1A%u5728%u54EA%u91CC%u5F71%u54CD%u5230%u6211%u4EEC%u7684Xposed%u6A21%u5757%u5462%uFF1F%0A%0A%23%23%20Xposed%u4E2D%u7684preference%0AXposed%u6A21%u5757%u4E2D%u4F7F%u7528preference%u7684%u65F6%u5019%uFF0C%u901A%u5E38%u90FD%u662F%u901A%u8FC7XSharedPreference%u6765%u64CD%u4F5C%u3002XSharedPreference%u5728Android%u6807%u51C6%u7684SharedPreference%u7C7B%u4E0A%u5305%u4E86%u4E00%u5C42%uFF0C%u63D0%u4F9B%u4E86%u4E00%u4E9Bsecurity%u7684fix%u6216%u8005work%20around%u3002%u4F8B%u5982%uFF1AXSharedPreference.makeWorldReadable%u3002%u4ED6%u4EEC%u90FD%u662F%u52A0%u8F7Dapp%20data%u6587%u4EF6%u5939%u4E0B%u7684xml%u6587%u4EF6%u6765%u8BFB%u53D6%u3001%u5B58%u50A8%u952E%u503C%u5BF9%u7684%u3002%u8BE5%u6587%u4EF6%u8DEF%u5F84%u4E3A%uFF08%u4EE5Niwatori%u4E3A%u4F8B%uFF09%uFF1A%60/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml%60%u3002%0A%0A%u901A%u5E38Xposed%u4E2D%u5982%u4E0B%u4F7F%u7528preference%u4F1A%u6309%u7167%u5982%u4E0B%u7684%u65F6%u5E8F%u56FE%uFF0C%u4EE5Niwatori%u4E3A%u4F8B%uFF1A%0A%60%60%60%20sequence%0ANote%20left%20of%20Niwatori%3A%20initZygote%0ANote%20left%20of%20Niwatori%3A%20Construct%20a%20XSharedPreference%0ANiwatori-%3EActivity.class%3A%20hook%0AActivity.class-%3Eapp1%3A%20onCreate%0ANote%20right%20of%20app1%3A%20load%20the%20XSharedPreference%0AActivity.class-%3Eapp2%3A%20onCreate%0ANote%20right%20of%20app2%3A%20load%20the%20XSharedPreference%0A%60%60%60%0A-%20XSharedPreference%u5B9E%u4F8B%u521B%u5EFA%u5728%u6A21%u5757%u52A0%u8F7D%u7684%60initZygote%60%u4E2D%0A-%20%u6570%u636E%u7684%u4F7F%u7528%u901A%u8FC7%u94A9%u5B50%u51FD%u6570%uFF0C%u5728%u5404%u4E2Aapp%u7684Context%u5E95%u4E0B%u6267%u884C%0A%0A%u4E8E%u662F%u5F53MODE%5C_WORLD%5C_READABLE%u88AB%u5E9F%u6B62%u4EE5%u540E%uFF0C%u8FD9%u91CC%u5C31%u51FA%u95EE%u9898%u4E86%u3002%u5373%u5728%u9ED8%u8BA4%u60C5%u51B5%u4E0B%uFF0Capp1%u662F%u6CA1%u6709%u6743%u9650%u67E5%u770BNiwatori%u7684preference%u6587%u4EF6%u7684%uFF0C%u4E5F%u5C31%u6CA1%u6CD5%u52A0%u8F7D%u914D%u7F6E%u6570%u636E%u3002%0A%0AXposed%u5B98%u65B9%u6216%u8005%u4F5C%u8005rovo89%u8FD8%u6CA1%u6709%u7ED9%u51FA%u5B98%u65B9%u7684%u89E3%u51B3%u529E%u6CD5%uFF0C%u4F46%u603B%u662F%u4F1A%u6709%u4E00%u4E9B%u672A%u96E8%u7EF8%u7F2A%u7684%u52C7%u58EB%uFF0CXDA%u4E0A%u6709%u4E00%u4E2A%u5E16%u5B50%u7ED9%u51FA%u4E86%u4E00%u4E2Awork%20around%uFF1A%5BMODE_WORLD_READABLE%20in%20Android%20N%5D%28https%3A//forum.xda-developers.com/xposed/development/modeworldreadable-android-n-t3407123%29%0A%0A%u6211%u5728Niwatori%u4E2D%u4E5F%u4F7F%u7528%u4E86%u8BE5%u65B9%u6CD5%uFF0C%u4F46%u4ECD%u7136%u4E0D%u662F%u5B8C%u7F8E%u89E3%u51B3%uFF0C%u800C%u4E14%u76EE%u524D%u8FD8%u4E0D%u77E5%u9053%u5982%u4F55%u6539%u8FDB%u3002%0A%0A%23%23%20%u9057%u7559%u7684%u95EE%u9898%0A%u8BE5work%20around%u548CXSharedPreference.makeWorldReadable%u540C%u7406%uFF0C%u6211%u5982%u4E0B%u8C03%u7528preference%uFF1A%0A%60%60%60%0AmPrefs.makeWorldReadable%28%29%3B%0ALog.e%28%22Ben%22%2C%20%22package%3A%22%20+%20decorView.getContext%28%29.getPackageName%28%29%20+%20%22%2C%20%22%20+%20decorView%20+%20%22%2C%22%20+%20mPrefs.getString%28%22key_boundary_color_ms%22%2C%20%22default%20value%22%29%29%3B%0ALog.e%28%22Ben%22%2C%20%22file%20can%20read%3A%20%22%20+%20mPrefs.getFile%28%29.canRead%28%29%29%3B%20%3C--%20%u6709%u4E9Bapp%u4F1A%u662Ftrue%uFF0C%u6709%u4E9Bapp%u4F1A%u662Ffalse%0A%60%60%60%0A%u5F53%u8FD4%u56DEtrue%u7684%u65F6%u5019%uFF0Csettings%u5C31%u6210%u529F%u7684%u4F20%u5230%u4E86%u5BF9%u5E94app%u4E86%u3002%u8FD9%u4E2A%u65F6%u800C%u53EF%u4EE5read%u65F6%u800C%u4E0D%u53EF%u4EE5read%uFF0C%u6211%u4E5F%u5F88%u82E6%u607C%uFF0C%u4E0D%u77E5%u9053%u662F%u600E%u4E48%u56DE%u4E8B%u513F%u3002%u7559%u5F85%u4EE5%u540E%u518D%u89E3%u51B3%u4E86%u3002%0A%0A%23%23%20%u89E3%u51B3%u9057%u7559%u7684%u95EE%u9898%20-%2020180119%0A%u4EE5%u4E0A%u7684%u95EE%u9898%u5728%u4E8E%uFF0CAndroid%207.0%u5F00%u59CB%uFF0C%u5373%u4ECESDK%2024%u5F00%u59CB%uFF0CAndroid%u52A0%u5165%u4E86%u5F88%u591Asecurity%u65B9%u9762%u7684%u7279%u6027%uFF0C%u53C2%u8003%5BAndroid%207.0%20Security%20Features%3A%20Direct%20Boot%5D%28https%3A//blog.compass-security.com/2016/10/android-7-0-security-features-direct-boot/%29%u3002%u8FD9%u548C%u6211%u4EEC%u7684%u95EE%u9898%u4E0D%u592A%u76F8%u5173%u3002%u76F8%u5173%u7684%u662F%u5982%u4E0A%u6240%u8BF4%uFF0CNougat%u4E0D%u5141%u8BB8world%20readable%u7684%u6587%u4EF6%u4E86%u3002%u5982%u679C%u7528SDK25%u7F16%u8BD1%u7684app%u8FD8%u7528%60MODE_WORLD_READABLE%60%uFF0C%u7CFB%u7EDF%u4F1A%u62A5exception%u3002%0AGoogle%u4E0A%u9C9C%u5C11%u6709%u76F8%u5173%u7684%u89E3%u51B3%u65B9%u6848%uFF0C%u6709%u5982%u4E0B%u51E0%u4E2A%u94FE%u63A5%u53EF%u4EE5%u53C2%u8003%uFF1A%0A-%20%5BGravityBox%20commit%20-%20Use%20device%20protected%20storage%20for%20preferences%20and%20files%5D%28https%3A//github.com/GravityBox/GravityBox/commit/d825b7be445c18de9a90eb8f77c1c5eb2b74deb8%29%0A-%20%5BXposedBridge%20issue%201%20-%20Any%20place%20to%20store%20world%20readable%20preferences%20on%20Nougat%3F%5D%28https%3A//github.com/rovo89/XposedBridge/issues/206%29%0A-%20%5BXposedBridge%20issue%202%20-%20Preferences%20of%20a%20module%20cannot%20be%20read%20from%20different%20process%20on%20some%20devices%20running%20MM%5D%28https%3A//github.com/rovo89/XposedBridge/issues/74%29%0A-%20%5BXposedBridge%20issue%203%20-%20XSharedPreferences%20doesn%27t%20work%5D%28https%3A//github.com/rovo89/XposedBridge/issues/102%29%0A-%20%5B%5BQ%5D%20Xposed%20for%20nougat%20to%20read%20prefs%20ith%20fbe%20or%20without%5D%28https%3A//forum.xda-developers.com/xposed/xposed-nougat-to-read-prefs-ith-fbe-t3690048%29%0A%0A%u7ECF%u8FC7%u9A8C%u8BC1%uFF0C%u662FXposedBridge%20issue%201%u4E2DGravityBox%u4F5C%u8005%u7684%u4E00%u4E2Acomment%u63D0%u5230%u4E86%u6700%u7EC8%u7684%u89E3%u51B3%u65B9%u6CD5%u3002%u8BE5comment%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%5D%28./1516334231370.png%29%0A%u5728%u4E0A%u9762XDA%u7684%u5E16%u5B50%uFF0C%u4EE5%u53CAGravityBox%u7684commit%u4E2D%uFF0C%u6211%u4EEC%u53EF%u4EE5%u770B%u5230GravityBox%u7684%u4F5C%u8005%u91C7%u7528%u4E86Android%207.0%u4E2D%u65B0%u7684SharedPreference%u5B58%u50A8%u65B9%u5F0F%uFF0C%u5373%u901A%u8FC7%u4E0B%u9762%u4E24%u4E2A%u51FD%u6570%uFF1A%0A-%20%60setStorageDeviceProtected%60%0A-%20%60createDeviceProtectedStorageContext%60%0A%0A%u5C06preference%u6587%u4EF6%u5B58%u5230%60/data/user_de/0/%3Cpackage%20name%3E/shared_prefs%60%u4E0B%u3002%u5E76%u5728Xposed%u7684context%u7AEF%uFF0C%u76F4%u63A5%u6253%u5F00%u6587%u4EF6%u8FDB%u884C%u64CD%u4F5C%u3002%0A%u4F46%u5176%u5B9E%u6211%u4EEC%u5E76%u4E0D%u9700%u5982%u6B64%u3002%u53EA%u8981%u4FDD%u8BC1package%20folder%u7684%u6743%u9650%u81F3%u5C11%u662F711%uFF0Cpreference.xml%u6587%u4EF6%u6709%u53EF%u8BFB%u6743%u9650%u5373%u53EF%u3002%0A</center><br></div>",
            "tags": [
                "Android",
                "xposed"
            ]
        },
        {
            "id": "https://blog.zhougy.top/2018/01/17/XSharedPreference_&_SharedPreference_-_XPosed%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84preference%E4%BD%BF%E7%94%A8/",
            "url": "https://blog.zhougy.top/2018/01/17/XSharedPreference_&_SharedPreference_-_XPosed%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84preference%E4%BD%BF%E7%94%A8/",
            "title": "XSharedPreference & SharedPreference - XPosed模块中的preference使用",
            "date_published": "2018-01-17T04:39:32.000Z",
            "content_html": "<!DOCTYPE en-note SYSTEM 'http://xml.evernote.com/pub/enml2.dtd'><div class=\"enNote\" style=\"color: #2c3f51; line-height: 1.6; background: none;\" title lang=\"v2\" xml:lang dir><del style=\"position:relative;display:block;z-index:10;\"><a style=\"position: absolute;color: #FFF;text-decoration: none;font-size: 12px;height: 25px;border-radius: 0;margin-top: -20px;right: 15px;background: rgba(0, 0, 0, 0);border-left: 10px solid #BB3A34;border-right: 10px solid #BB3A34;border-bottom: 5px solid rgba(0, 0, 0, 0);width: 0;text-indent:-100000px;\" href=\"http://maxiang.io/#/?provider=evernote&amp;guid=08e07dee-5c97-456f-bc56-9bc11bb354a0&amp;notebook=myblog\">Edit</a></del><div style=\"color: #2c3f51; line-height: 1.6;\"><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"></p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x6700;&#x8FD1;&#x5728;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;Xposed&#x6A21;&#x5757;[]Niwatori-One Handed Mode](<a href=\"https://github.com/tkgktyk/Niwatori\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">https://github.com/tkgktyk/Niwatori</a>)&#x3002;&#x539F;&#x4F5C;&#x8005;tkgktyk&#x5DF2;&#x7ECF;&#x505C;&#x6B62;&#x66F4;&#x65B0;&#x4E86;&#xFF0C;&#x5BFC;&#x81F4;&#x6A21;&#x5757;&#x5728;Xposed Framework for Nougat&#x53D1;&#x5E03;&#x4EE5;&#x540E;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x3002;&#x4E8E;&#x662F;&#x6211;fork&#x4E86;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#xFF0C;&#x5F00;&#x59CB;&#x505A;Android Nougat&#x4E0A;&#x7684;&#x9002;&#x914D;&#x5DE5;&#x4F5C;&#xFF0C;&#x5E76;&#x5728;XDA&#x4E0A;&#x53D1;&#x5E03;&#x4E86;&#x66F4;&#x65B0;<a href=\"https://forum.xda-developers.com/xposed/modules/mod-niwatori-one-handed-mode-t3730963\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">&#x94FE;&#x63A5;</a>&#x3002; <br>&#x5728;&#x9002;&#x914D;&#x4E86;Nougat&#x4E4B;&#x540E;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x66F4;&#x597D;&#x3002;&#x76EE;&#x524D;&#x60F3;&#x505A;&#x7684;&#x662F;&#x80FD;&#x901A;&#x8FC7;fooview&#x8C03;&#x7528;Niwatori&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x3002;&#x5E76;&#x4E14;&#x8BE5;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x662F;small screen&#x8FD8;&#x662F;slide down&#x7B49;&#x7B49;&#xFF0C;&#x80FD;&#x901A;&#x8FC7;Niwatori&#x672C;&#x8EAB;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;&#x4F46;&#x662F;&#x5728;&#x5F00;&#x53D1;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x52A8;&#x6001;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x7684;&#x52A0;&#x8F7D;&#x9700;&#x8981;&#x4F7F;&#x7528;SDK 25&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#xFF0C;&#x800C;&#x4ECE;SDK 25&#x5F00;&#x59CB;&#xFF0C;&#x539F;&#x5148;SharedPreference&#x7684;&#x6253;&#x5F00;&#x65B9;&#x5F0F;MODE_WORLD_PRIVATE&#x5DF2;&#x7ECF;&#x88AB;&#x7981;&#x6B62;&#x4E86;&#x3002;&#x4F7F;&#x7528;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;security exception&#x3002; <br>&#x6240;&#x4EE5;&#x8981;&#x5347;&#x5230;&#x4F7F;&#x7528;SDK 25&#xFF0C;&#x5FC5;&#x987B;&#x89E3;&#x51B3;preference&#x5F15;&#x7528;&#x7684;&#x95EE;&#x9898;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5230;&#x5E95;&#x4F1A;&#x5728;&#x54EA;&#x91CC;&#x5F71;&#x54CD;&#x5230;&#x6211;&#x4EEC;&#x7684;Xposed&#x6A21;&#x5757;&#x5462;&#xFF1F;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">Xposed&#x4E2D;&#x7684;preference</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">Xposed&#x6A21;&#x5757;&#x4E2D;&#x4F7F;&#x7528;preference&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x901A;&#x8FC7;XSharedPreference&#x6765;&#x64CD;&#x4F5C;&#x3002;XSharedPreference&#x5728;Android&#x6807;&#x51C6;&#x7684;SharedPreference&#x7C7B;&#x4E0A;&#x5305;&#x4E86;&#x4E00;&#x5C42;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;security&#x7684;fix&#x6216;&#x8005;work around&#x3002;&#x4F8B;&#x5982;&#xFF1A;XSharedPreference.makeWorldReadable&#x3002;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;&#x52A0;&#x8F7D;app data&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;xml&#x6587;&#x4EF6;&#x6765;&#x8BFB;&#x53D6;&#x3001;&#x5B58;&#x50A8;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E3A;&#xFF08;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF09;&#xFF1A;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml</code>&#x3002;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x901A;&#x5E38;Xposed&#x4E2D;&#x5982;&#x4E0B;&#x4F7F;&#x7528;preference&#x4F1A;&#x6309;&#x7167;&#x5982;&#x4E0B;&#x7684;&#x65F6;&#x5E8F;&#x56FE;&#xFF0C;&#x4EE5;Niwatori&#x4E3A;&#x4F8B;&#xFF1A;</p><div style=\"text-align: center; margin-bottom: 1.1em; line-height: 1.6;\"><span style=\"line-height: 1.6;\"><img class=\"enMedia\" src=\"/images/XSharedPreference &amp; SharedPreference - XPosed&#x6A21;&#x5757;&#x4E2D;&#x7684;preference&#x4F7F;&#x7528;/SVG78bf507dfa06d67d15e9356fa67699ec\" hash=\"faf526b522cf280365ebea346d0a680e\" align alt longdesc width=\"870.953125\" height=\"378.875\" border hspace vspace usemap style=\"border: 0; vertical-align: middle; max-width: 100%; margin-top: 0; margin-bottom: 0;\" title lang xml:lang dir></span></div><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\">XSharedPreference&#x5B9E;&#x4F8B;&#x521B;&#x5EFA;&#x5728;&#x6A21;&#x5757;&#x52A0;&#x8F7D;&#x7684;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">initZygote</code>&#x4E2D;</li><li style=\"line-height: 1.6;\">&#x6570;&#x636E;&#x7684;&#x4F7F;&#x7528;&#x901A;&#x8FC7;&#x94A9;&#x5B50;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x5404;&#x4E2A;app&#x7684;Context&#x5E95;&#x4E0B;&#x6267;&#x884C;</li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x4E8E;&#x662F;&#x5F53;MODE_WORLD_READABLE&#x88AB;&#x5E9F;&#x6B62;&#x4EE5;&#x540E;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x5373;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;app1&#x662F;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x67E5;&#x770B;Niwatori&#x7684;preference&#x6587;&#x4EF6;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x6CD5;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x3002;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">Xposed&#x5B98;&#x65B9;&#x6216;&#x8005;&#x4F5C;&#x8005;rovo89&#x8FD8;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x5B98;&#x65B9;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x603B;&#x662F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x672A;&#x96E8;&#x7EF8;&#x7F2A;&#x7684;&#x52C7;&#x58EB;&#xFF0C;XDA&#x4E0A;&#x6709;&#x4E00;&#x4E2A;&#x5E16;&#x5B50;&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;work around&#xFF1A;<a href=\"https://forum.xda-developers.com/xposed/development/modeworldreadable-android-n-t3407123\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">MODE_WORLD_READABLE in Android N</a></p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x6211;&#x5728;Niwatori&#x4E2D;&#x4E5F;&#x4F7F;&#x7528;&#x4E86;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x4E0D;&#x662F;&#x5B8C;&#x7F8E;&#x89E3;&#x51B3;&#xFF0C;&#x800C;&#x4E14;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x6539;&#x8FDB;&#x3002;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898;</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x8BE5;work around&#x548C;XSharedPreference.makeWorldReadable&#x540C;&#x7406;&#xFF0C;&#x6211;&#x5982;&#x4E0B;&#x8C03;&#x7528;preference&#xFF1A;</p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; overflow-x: auto; background: #23241f; padding: 1.3em 2em;\"><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\">mPrefs.makeWorldReadable();</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">Log</span>.<span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">e</span>(<span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;Ben&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;package:&quot;</span> + decorView.getContext().getPackageName() + <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;, &quot;</span> + decorView + <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;,&quot;</span> + mPrefs.getString(<span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;key_boundary_color_ms&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;default value&quot;</span>));</div><div style=\"min-height: 1.5em; color: inherit; line-height: 1.6; background-color: transparent;\"><span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">Log</span>.<span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">e</span>(<span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;Ben&quot;</span>, <span style=\"display: inline; line-height: 1.6; color: #e6db74; background-color: transparent;\">&quot;file can read: &quot;</span> + mPrefs.getFile().canRead()); &lt;-- &#x6709;&#x4E9B;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">app</span>&#x4F1A;&#x662F;true&#xFF0C;&#x6709;&#x4E9B;<span style=\"display: inline; line-height: 1.6; color: #f92672; background-color: transparent;\">app</span>&#x4F1A;&#x662F;false</div></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5F53;&#x8FD4;&#x56DE;true&#x7684;&#x65F6;&#x5019;&#xFF0C;settings&#x5C31;&#x6210;&#x529F;&#x7684;&#x4F20;&#x5230;&#x4E86;&#x5BF9;&#x5E94;app&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x800C;&#x53EF;&#x4EE5;read&#x65F6;&#x800C;&#x4E0D;&#x53EF;&#x4EE5;read&#xFF0C;&#x6211;&#x4E5F;&#x5F88;&#x82E6;&#x607C;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#x513F;&#x3002;&#x7559;&#x5F85;&#x4EE5;&#x540E;&#x518D;&#x89E3;&#x51B3;&#x4E86;&#x3002;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 34.4px; margin: 1.2em 0 .6em 0; text-align: start;\">&#x89E3;&#x51B3;&#x9057;&#x7559;&#x7684;&#x95EE;&#x9898; - 20180119</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x4EE5;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;Android 7.0&#x5F00;&#x59CB;&#xFF0C;&#x5373;&#x4ECE;SDK 24&#x5F00;&#x59CB;&#xFF0C;Android&#x52A0;&#x5165;&#x4E86;&#x5F88;&#x591A;security&#x65B9;&#x9762;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x53C2;&#x8003;<a href=\"https://blog.compass-security.com/2016/10/android-7-0-security-features-direct-boot/\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android 7.0 Security Features: Direct Boot</a>&#x3002;&#x8FD9;&#x548C;&#x6211;&#x4EEC;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x592A;&#x76F8;&#x5173;&#x3002;&#x76F8;&#x5173;&#x7684;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;Nougat&#x4E0D;&#x5141;&#x8BB8;world readable&#x7684;&#x6587;&#x4EF6;&#x4E86;&#x3002;&#x5982;&#x679C;&#x7528;SDK25&#x7F16;&#x8BD1;&#x7684;app&#x8FD8;&#x7528;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">MODE_WORLD_READABLE</code>&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x62A5;exception&#x3002; <br>Google&#x4E0A;&#x9C9C;&#x5C11;&#x6709;&#x76F8;&#x5173;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;</p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\"><a href=\"https://github.com/GravityBox/GravityBox/commit/d825b7be445c18de9a90eb8f77c1c5eb2b74deb8\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">GravityBox commit - Use device protected storage for preferences and files</a></li><li style=\"line-height: 1.6;\"><a href=\"https://github.com/rovo89/XposedBridge/issues/206\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">XposedBridge issue 1 - Any place to store world readable preferences on Nougat?</a></li><li style=\"line-height: 1.6;\"><a href=\"https://github.com/rovo89/XposedBridge/issues/74\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">XposedBridge issue 2 - Preferences of a module cannot be read from different process on some devices running MM</a></li><li style=\"line-height: 1.6;\"><a href=\"https://github.com/rovo89/XposedBridge/issues/102\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">XposedBridge issue 3 - XSharedPreferences doesn&#x2019;t work</a></li><li style=\"line-height: 1.6;\"><a href=\"https://forum.xda-developers.com/xposed/xposed-nougat-to-read-prefs-ith-fbe-t3690048\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">[Q] Xposed for nougat to read prefs ith fbe or without</a></li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;&#xFF0C;&#x662F;XposedBridge issue 1&#x4E2D;GravityBox&#x4F5C;&#x8005;&#x7684;&#x4E00;&#x4E2A;comment&#x63D0;&#x5230;&#x4E86;&#x6700;&#x7EC8;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;&#x8BE5;comment&#x5982;&#x4E0B;&#xFF1A;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"><img class=\"enMedia\" src=\"/images/XSharedPreference &amp; SharedPreference - XPosed&#x6A21;&#x5757;&#x4E2D;&#x7684;preference&#x4F7F;&#x7528;/1516334231370.png\" hash=\"4bb9cc0ad024876dd28baed5c27bad27\" align alt longdesc width height border hspace vspace usemap style=\"border: 0; vertical-align: middle; max-width: 100%;\" title lang xml:lang dir></p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">setStorageDeviceProtected</code></li><li style=\"line-height: 1.6;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">createDeviceProtectedStorageContext</code></li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5C06;preference&#x6587;&#x4EF6;&#x5B58;&#x5230;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">/data/user_de/0/&lt;package name&gt;/shared_prefs</code>&#x4E0B;&#x3002;&#x5E76;&#x5728;Xposed&#x7684;context&#x7AEF;&#xFF0C;&#x76F4;&#x63A5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002; <br>&#x4F46;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x9700;&#x5982;&#x6B64;&#x3002;&#x53EA;&#x8981;&#x4FDD;&#x8BC1;package folder&#x7684;&#x6743;&#x9650;&#x81F3;&#x5C11;&#x662F;711&#xFF0C;preference.xml&#x6587;&#x4EF6;&#x6709;&#x53EF;&#x8BFB;&#x6743;&#x9650;&#x5373;&#x53EF;&#x3002;</p></div><center style=\"display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden\">%23%20XSharedPreference%20%26%20SharedPreference%20-%20XPosed%u6A21%u5757%u4E2D%u7684preference%u4F7F%u7528%0A@%28myblog%29%5BAndroid%2C%20xposed%5D%0A%0A%u6700%u8FD1%u5728%u7EF4%u62A4%u4E00%u4E2AXposed%u6A21%u5757%5B%5DNiwatori-One%20Handed%20Mode%5D%28https%3A//github.com/tkgktyk/Niwatori%29%u3002%u539F%u4F5C%u8005tkgktyk%u5DF2%u7ECF%u505C%u6B62%u66F4%u65B0%u4E86%uFF0C%u5BFC%u81F4%u6A21%u5757%u5728Xposed%20Framework%20for%20Nougat%u53D1%u5E03%u4EE5%u540E%uFF0C%u4E0D%u80FD%u4F7F%u7528%u3002%u4E8E%u662F%u6211fork%u4E86%u4E00%u4EFD%u4EE3%u7801%uFF0C%u5F00%u59CB%u505AAndroid%20Nougat%u4E0A%u7684%u9002%u914D%u5DE5%u4F5C%uFF0C%u5E76%u5728XDA%u4E0A%u53D1%u5E03%u4E86%u66F4%u65B0%5B%u94FE%u63A5%5D%28https%3A//forum.xda-developers.com/xposed/modules/mod-niwatori-one-handed-mode-t3730963%29%u3002%0A%u5728%u9002%u914D%u4E86Nougat%u4E4B%u540E%uFF0C%u5E0C%u671B%u80FD%u6DFB%u52A0%u4E00%u4E9B%u65B0%u529F%u80FD%uFF0C%u8BA9%u7528%u6237%u4F53%u9A8C%u66F4%u597D%u3002%u76EE%u524D%u60F3%u505A%u7684%u662F%u80FD%u901A%u8FC7fooview%u8C03%u7528Niwatori%u7684%u5FEB%u6377%u65B9%u5F0F%u3002%u5E76%u4E14%u8BE5%u5FEB%u6377%u65B9%u5F0F%u7684%u529F%u80FD%uFF0C%u4F8B%u5982%u662Fsmall%20screen%u8FD8%u662Fslide%20down%u7B49%u7B49%uFF0C%u80FD%u901A%u8FC7Niwatori%u672C%u8EAB%u8FDB%u884C%u914D%u7F6E%u3002%u4F46%u662F%u5728%u5F00%u53D1%u8FD9%u4E00%u529F%u80FD%u7684%u65F6%u5019%uFF0C%u53D1%u73B0%u52A8%u6001%u5FEB%u6377%u65B9%u5F0F%u7684%u52A0%u8F7D%u9700%u8981%u4F7F%u7528SDK%2025%u4EE5%u4E0A%u7248%u672C%uFF0C%u800C%u4ECESDK%2025%u5F00%u59CB%uFF0C%u539F%u5148SharedPreference%u7684%u6253%u5F00%u65B9%u5F0FMODE%5C_WORLD%5C_PRIVATE%u5DF2%u7ECF%u88AB%u7981%u6B62%u4E86%u3002%u4F7F%u7528%u5B83%u4F1A%u5BFC%u81F4security%20exception%u3002%0A%u6240%u4EE5%u8981%u5347%u5230%u4F7F%u7528SDK%2025%uFF0C%u5FC5%u987B%u89E3%u51B3preference%u5F15%u7528%u7684%u95EE%u9898%u3002%u90A3%u4E48%u8FD9%u4E2A%u6A21%u5F0F%u7684%u53D8%u5316%uFF0C%u5230%u5E95%u4F1A%u5728%u54EA%u91CC%u5F71%u54CD%u5230%u6211%u4EEC%u7684Xposed%u6A21%u5757%u5462%uFF1F%0A%0A%23%23%20Xposed%u4E2D%u7684preference%0AXposed%u6A21%u5757%u4E2D%u4F7F%u7528preference%u7684%u65F6%u5019%uFF0C%u901A%u5E38%u90FD%u662F%u901A%u8FC7XSharedPreference%u6765%u64CD%u4F5C%u3002XSharedPreference%u5728Android%u6807%u51C6%u7684SharedPreference%u7C7B%u4E0A%u5305%u4E86%u4E00%u5C42%uFF0C%u63D0%u4F9B%u4E86%u4E00%u4E9Bsecurity%u7684fix%u6216%u8005work%20around%u3002%u4F8B%u5982%uFF1AXSharedPreference.makeWorldReadable%u3002%u4ED6%u4EEC%u90FD%u662F%u52A0%u8F7Dapp%20data%u6587%u4EF6%u5939%u4E0B%u7684xml%u6587%u4EF6%u6765%u8BFB%u53D6%u3001%u5B58%u50A8%u952E%u503C%u5BF9%u7684%u3002%u8BE5%u6587%u4EF6%u8DEF%u5F84%u4E3A%uFF08%u4EE5Niwatori%u4E3A%u4F8B%uFF09%uFF1A%60/data/data/jp.tkgktyk.xposed.niwatori/shared_prefs/jp.tkgktyk.xposed.niwatori_preferences.xml%60%u3002%0A%0A%u901A%u5E38Xposed%u4E2D%u5982%u4E0B%u4F7F%u7528preference%u4F1A%u6309%u7167%u5982%u4E0B%u7684%u65F6%u5E8F%u56FE%uFF0C%u4EE5Niwatori%u4E3A%u4F8B%uFF1A%0A%60%60%60%20sequence%0ANote%20left%20of%20Niwatori%3A%20initZygote%0ANote%20left%20of%20Niwatori%3A%20Construct%20a%20XSharedPreference%0ANiwatori-%3EActivity.class%3A%20hook%0AActivity.class-%3Eapp1%3A%20onCreate%0ANote%20right%20of%20app1%3A%20load%20the%20XSharedPreference%0AActivity.class-%3Eapp2%3A%20onCreate%0ANote%20right%20of%20app2%3A%20load%20the%20XSharedPreference%0A%60%60%60%0A-%20XSharedPreference%u5B9E%u4F8B%u521B%u5EFA%u5728%u6A21%u5757%u52A0%u8F7D%u7684%60initZygote%60%u4E2D%0A-%20%u6570%u636E%u7684%u4F7F%u7528%u901A%u8FC7%u94A9%u5B50%u51FD%u6570%uFF0C%u5728%u5404%u4E2Aapp%u7684Context%u5E95%u4E0B%u6267%u884C%0A%0A%u4E8E%u662F%u5F53MODE%5C_WORLD%5C_READABLE%u88AB%u5E9F%u6B62%u4EE5%u540E%uFF0C%u8FD9%u91CC%u5C31%u51FA%u95EE%u9898%u4E86%u3002%u5373%u5728%u9ED8%u8BA4%u60C5%u51B5%u4E0B%uFF0Capp1%u662F%u6CA1%u6709%u6743%u9650%u67E5%u770BNiwatori%u7684preference%u6587%u4EF6%u7684%uFF0C%u4E5F%u5C31%u6CA1%u6CD5%u52A0%u8F7D%u914D%u7F6E%u6570%u636E%u3002%0A%0AXposed%u5B98%u65B9%u6216%u8005%u4F5C%u8005rovo89%u8FD8%u6CA1%u6709%u7ED9%u51FA%u5B98%u65B9%u7684%u89E3%u51B3%u529E%u6CD5%uFF0C%u4F46%u603B%u662F%u4F1A%u6709%u4E00%u4E9B%u672A%u96E8%u7EF8%u7F2A%u7684%u52C7%u58EB%uFF0CXDA%u4E0A%u6709%u4E00%u4E2A%u5E16%u5B50%u7ED9%u51FA%u4E86%u4E00%u4E2Awork%20around%uFF1A%5BMODE_WORLD_READABLE%20in%20Android%20N%5D%28https%3A//forum.xda-developers.com/xposed/development/modeworldreadable-android-n-t3407123%29%0A%0A%u6211%u5728Niwatori%u4E2D%u4E5F%u4F7F%u7528%u4E86%u8BE5%u65B9%u6CD5%uFF0C%u4F46%u4ECD%u7136%u4E0D%u662F%u5B8C%u7F8E%u89E3%u51B3%uFF0C%u800C%u4E14%u76EE%u524D%u8FD8%u4E0D%u77E5%u9053%u5982%u4F55%u6539%u8FDB%u3002%0A%0A%23%23%20%u9057%u7559%u7684%u95EE%u9898%0A%u8BE5work%20around%u548CXSharedPreference.makeWorldReadable%u540C%u7406%uFF0C%u6211%u5982%u4E0B%u8C03%u7528preference%uFF1A%0A%60%60%60%0AmPrefs.makeWorldReadable%28%29%3B%0ALog.e%28%22Ben%22%2C%20%22package%3A%22%20+%20decorView.getContext%28%29.getPackageName%28%29%20+%20%22%2C%20%22%20+%20decorView%20+%20%22%2C%22%20+%20mPrefs.getString%28%22key_boundary_color_ms%22%2C%20%22default%20value%22%29%29%3B%0ALog.e%28%22Ben%22%2C%20%22file%20can%20read%3A%20%22%20+%20mPrefs.getFile%28%29.canRead%28%29%29%3B%20%3C--%20%u6709%u4E9Bapp%u4F1A%u662Ftrue%uFF0C%u6709%u4E9Bapp%u4F1A%u662Ffalse%0A%60%60%60%0A%u5F53%u8FD4%u56DEtrue%u7684%u65F6%u5019%uFF0Csettings%u5C31%u6210%u529F%u7684%u4F20%u5230%u4E86%u5BF9%u5E94app%u4E86%u3002%u8FD9%u4E2A%u65F6%u800C%u53EF%u4EE5read%u65F6%u800C%u4E0D%u53EF%u4EE5read%uFF0C%u6211%u4E5F%u5F88%u82E6%u607C%uFF0C%u4E0D%u77E5%u9053%u662F%u600E%u4E48%u56DE%u4E8B%u513F%u3002%u7559%u5F85%u4EE5%u540E%u518D%u89E3%u51B3%u4E86%u3002%0A%0A%23%23%20%u89E3%u51B3%u9057%u7559%u7684%u95EE%u9898%20-%2020180119%0A%u4EE5%u4E0A%u7684%u95EE%u9898%u5728%u4E8E%uFF0CAndroid%207.0%u5F00%u59CB%uFF0C%u5373%u4ECESDK%2024%u5F00%u59CB%uFF0CAndroid%u52A0%u5165%u4E86%u5F88%u591Asecurity%u65B9%u9762%u7684%u7279%u6027%uFF0C%u53C2%u8003%5BAndroid%207.0%20Security%20Features%3A%20Direct%20Boot%5D%28https%3A//blog.compass-security.com/2016/10/android-7-0-security-features-direct-boot/%29%u3002%u8FD9%u548C%u6211%u4EEC%u7684%u95EE%u9898%u4E0D%u592A%u76F8%u5173%u3002%u76F8%u5173%u7684%u662F%u5982%u4E0A%u6240%u8BF4%uFF0CNougat%u4E0D%u5141%u8BB8world%20readable%u7684%u6587%u4EF6%u4E86%u3002%u5982%u679C%u7528SDK25%u7F16%u8BD1%u7684app%u8FD8%u7528%60MODE_WORLD_READABLE%60%uFF0C%u7CFB%u7EDF%u4F1A%u62A5exception%u3002%0AGoogle%u4E0A%u9C9C%u5C11%u6709%u76F8%u5173%u7684%u89E3%u51B3%u65B9%u6848%uFF0C%u6709%u5982%u4E0B%u51E0%u4E2A%u94FE%u63A5%u53EF%u4EE5%u53C2%u8003%uFF1A%0A-%20%5BGravityBox%20commit%20-%20Use%20device%20protected%20storage%20for%20preferences%20and%20files%5D%28https%3A//github.com/GravityBox/GravityBox/commit/d825b7be445c18de9a90eb8f77c1c5eb2b74deb8%29%0A-%20%5BXposedBridge%20issue%201%20-%20Any%20place%20to%20store%20world%20readable%20preferences%20on%20Nougat%3F%5D%28https%3A//github.com/rovo89/XposedBridge/issues/206%29%0A-%20%5BXposedBridge%20issue%202%20-%20Preferences%20of%20a%20module%20cannot%20be%20read%20from%20different%20process%20on%20some%20devices%20running%20MM%5D%28https%3A//github.com/rovo89/XposedBridge/issues/74%29%0A-%20%5BXposedBridge%20issue%203%20-%20XSharedPreferences%20doesn%27t%20work%5D%28https%3A//github.com/rovo89/XposedBridge/issues/102%29%0A-%20%5B%5BQ%5D%20Xposed%20for%20nougat%20to%20read%20prefs%20ith%20fbe%20or%20without%5D%28https%3A//forum.xda-developers.com/xposed/xposed-nougat-to-read-prefs-ith-fbe-t3690048%29%0A%0A%u7ECF%u8FC7%u9A8C%u8BC1%uFF0C%u662FXposedBridge%20issue%201%u4E2DGravityBox%u4F5C%u8005%u7684%u4E00%u4E2Acomment%u63D0%u5230%u4E86%u6700%u7EC8%u7684%u89E3%u51B3%u65B9%u6CD5%u3002%u8BE5comment%u5982%u4E0B%uFF1A%0A%21%5BAlt%20text%5D%28./1516334231370.png%29%0A%u5728%u4E0A%u9762XDA%u7684%u5E16%u5B50%uFF0C%u4EE5%u53CAGravityBox%u7684commit%u4E2D%uFF0C%u6211%u4EEC%u53EF%u4EE5%u770B%u5230GravityBox%u7684%u4F5C%u8005%u91C7%u7528%u4E86Android%207.0%u4E2D%u65B0%u7684SharedPreference%u5B58%u50A8%u65B9%u5F0F%uFF0C%u5373%u901A%u8FC7%u4E0B%u9762%u4E24%u4E2A%u51FD%u6570%uFF1A%0A-%20%60setStorageDeviceProtected%60%0A-%20%60createDeviceProtectedStorageContext%60%0A%0A%u5C06preference%u6587%u4EF6%u5B58%u5230%60/data/user_de/0/%3Cpackage%20name%3E/shared_prefs%60%u4E0B%u3002%u5E76%u5728Xposed%u7684context%u7AEF%uFF0C%u76F4%u63A5%u6253%u5F00%u6587%u4EF6%u8FDB%u884C%u64CD%u4F5C%u3002%0A%u4F46%u5176%u5B9E%u6211%u4EEC%u5E76%u4E0D%u9700%u5982%u6B64%u3002%u53EA%u8981%u4FDD%u8BC1package%20folder%u7684%u6743%u9650%u81F3%u5C11%u662F711%uFF0Cpreference.xml%u6587%u4EF6%u6709%u53EF%u8BFB%u6743%u9650%u5373%u53EF%u3002%0A</center><br></div>",
            "tags": [
                "Android",
                "xposed"
            ]
        },
        {
            "id": "https://blog.zhougy.top/2016/10/19/Android%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/",
            "url": "https://blog.zhougy.top/2016/10/19/Android%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/",
            "title": "Android单元测试",
            "date_published": "2016-10-18T23:41:45.000Z",
            "content_html": "<!DOCTYPE en-note SYSTEM 'http://xml.evernote.com/pub/enml2.dtd'><div class=\"enNote\" style=\"color: #2c3f51; font-family: &apos;Helvetica Neue&apos;, Arial, &apos;Hiragino Sans GB&apos;, STHeiti, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, SimSun, Song, sans-serif; line-height: 1.6;\" title lang=\"v2\" xml:lang dir><del style=\"position:relative;display:block;z-index:10;\"><a style=\"position: absolute;color: #FFF;text-decoration: none;font-size: 12px;height: 25px;border-radius: 0;margin-top: -20px;right: 15px;background: rgba(0, 0, 0, 0);border-left: 10px solid #BB3A34;border-right: 10px solid #BB3A34;border-bottom: 5px solid rgba(0, 0, 0, 0);width: 0;text-indent:-100000px;\" href=\"http://maxiang.info/#/?provider=evernote_int&amp;guid=ade7b067-6df9-46f4-a97e-71b9e0b2cff8&amp;notebook=%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0\">Edit</a></del><div style=\"color: #2c3f51; font-family: &apos;Helvetica Neue&apos;, Arial, &apos;Hiragino Sans GB&apos;, STHeiti, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, SimSun, Song, sans-serif; line-height: 1.6;\"><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"> <br>&#x4ECA;&#x65E5;&#x5728;&#x505A;&#x5FAE;&#x4FE1;IoT&#x6253;&#x5370;&#x673A;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x5176;&#x4E2D;&#x6D89;&#x53CA;&#x5230;&#x7528;Android&#x7A0B;&#x5E8F;&#x8BBF;&#x95EE;WPS&#x670D;&#x52A1;&#x6765;&#x5B9E;&#x73B0;&#x5C06;word&#x6587;&#x6863;&#x53E6;&#x5B58;&#x4E3A;PDF&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x79C9;&#x7740;TDD&#x7684;&#x7CBE;&#x795E;&#xFF0C;&#x5F00;&#x59CB;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x5728;Android&#x4E2D;&#x505A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002;</p><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 2.15em; margin: 1.2em 0 .6em 0; text-align: start;\">&#x5165;&#x95E8;</h2><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">JUnit</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x9996;&#x5148;&#x770B;&#x5230;&#x7684;&#x662F;Android&#x7684;&#x5B98;&#x7F51;&#x6587;&#x6863;<a href=\"https://developer.android.com/training/testing/start/index.html\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Getting Started with Testing</a>, <a href=\"https://developer.android.com/training/testing/unit-testing/local-unit-tests.html\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Building Local Unit Tests</a>&#x3002;&#x6709;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x8DD1;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#xFF0C;&#x53EB;Local Unit Test&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x8DD1;&#x5728;&#x76EE;&#x6807;&#x673A;&#x4E0A;&#xFF0C;&#x53EB;Instrumented Unit Test&#x3002; <br>Local Unit Test&#x57FA;&#x4E8E;JUnit&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x5173;&#x4E8E;Local Unit Test&#x7684;&#x94FE;&#x63A5;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5982;&#x4F55;&#x5728;Android Studio&#x4E2D;&#x4F7F;&#x80FD;JUnit&#x7684;&#x8303;&#x4F8B;&#x4E86;&#x3002;&#x914D;&#x7F6E;&#x597D;Dependencies&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;Android Studio&#x4F1A;&#x53BB;maven&#x5E93;&#x4E2D;&#x6293;&#x53D6;JUnit&#x7684;jar&#x5305;&#x5E76;&#x5BFC;&#x5165;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E86;&#x3002; <br>&#x9047;&#x5230;&#x9519;&#x8BEF;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">Error:(23, 17)&quot;Failed to resolve: junit:junit:4.12</code>&#xFF0C;&#x5728;build.gradle&#x4E0B;&#x9762;&#x52A0;</p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\"><span style=\"line-height: 1.6; color: #f92672;\">repositories</span> &#123;<br>        <span style=\"line-height: 1.6; color: #f92672;\">maven</span> &#123; <span style=\"line-height: 1.6; color: #f92672;\">url</span> <span style=\"line-height: 1.6; color: #e6db74;\">&apos;http://repo1.maven.org/maven2&apos;</span> &#125;<br>        jcenter &#123; <span style=\"line-height: 1.6; color: #f92672;\">url</span> <span style=\"line-height: 1.6; color: #e6db74;\">&quot;http://jcenter.bintray.com/&quot;</span> &#125;<br>&#125;<br></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x6216;&#x8005;&#x81EA;&#x884C;&#x53BB;&#x4E0B;&#x8F7D;junit-4.12.jar&#xFF0C;&#x518D;&#x653E;&#x5230;libs&#x76EE;&#x5F55;&#x5E95;&#x4E0B;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">Mockito</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5728;C++&#x4E2D;&#x505A;Unit Test&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6784;&#x5EFA;stub&#xFF0C;&#x6765;&#x9694;&#x79BB;&#x9700;&#x8981;&#x6D4B;&#x8BD5;&#x7684;code&#x3002;&#x5728;Java&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x73B0;&#x6210;&#x7684;&#x6846;&#x67B6;&#x53EF;&#x4EE5;&#x7528;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;<a href=\"https://github.com/mockito/mockito\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Mockito</a>&#x3002;&#x7F51;&#x4E0A;&#x5173;&#x4E8E;Mockito+Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x7684;&#x6587;&#x7AE0;&#x4E00;&#x641C;&#x4E00;&#x5927;&#x645E;&#x3002;&#x6211;&#x4E5F;&#x7B80;&#x5355;&#x7684;&#x6458;&#x5F55;&#x4E86;&#x51E0;&#x4E2A;&#x3002;</p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\"><a href=\"https://www.evernote.com/shard/s24/nl/2724128/360fa827-de1f-46e7-b815-465c074a5b9e\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android&#x6D4B;&#x8BD5;&#x4E8C;&#xFF1A;Mockito&#x4E0E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;</a></li><li style=\"line-height: 1.6;\"><a href=\"https://www.evernote.com/shard/s24/nl/2724128/beaaf776-621e-4fdb-9dca-e6eedc6a1029\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android &#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E4B;JUnit&#x548C;Mockito</a></li><li style=\"line-height: 1.6;\"><a href=\"https://www.evernote.com/shard/s24/nl/2724128/78565e6e-82eb-4f74-80c8-177863a6499c\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Android&#x6700;&#x4F73;Mock&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x65B9;&#x6848;:Junit + Mockito + Powermock</a> <br>Mockito&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x6A21;&#x62DF;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x8FBE;&#x5230;&#x9694;&#x79BB;&#x5F85;&#x6D4B;&#x4EE3;&#x7801;&#x7684;&#x76EE;&#x7684;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#x3002;</li></ul><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"><img class=\"enMedia\" src=\"/images/Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;/1476833497231.png\" hash=\"24f2966fe93c86710a6f591544903ae1\" align alt longdesc width height border hspace vspace usemap style=\"border: 0; vertical-align: middle; max-width: 100%;\" title lang xml:lang dir></p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\"><span style=\"line-height: 1.6; color: #f92672;\">import</span> android.os.classA<br><span style=\"line-height: 1.6;\"><span style=\"line-height: 1.6; color: #66d9ef;\">class</span> <span style=\"line-height: 1.6; color: #a6e22e; font-style: italic;\">B</span> </span>&#123;<br>    <span style=\"line-height: 1.6; color: #f92672;\"><span style=\"line-height: 1.6; color: #66d9ef;\">public</span> <span style=\"line-height: 1.6; color: #66d9ef;\">void</span> <span style=\"line-height: 1.6; color: #a6e22e;\">methodC</span> <span style=\"line-height: 1.6; color: #f8f8f2;\">()</span></span>&#123;<br>        classA a = <span style=\"line-height: 1.6; color: #f92672;\">new</span> classA();<br>        a.methodA();<br>    &#125;<br>&#125;<br></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x8BF7;&#x95EE;&#x8FD9;&#x91CC;&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728;methodC&#x4E2D;&#x6A21;&#x62DF;&#x5BF9;&#x8C61;A&#x7684;&#x884C;&#x4E3A;&#x3002;&#x8BF8;&#x5982;&#x6B64;&#x7C7B;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x4F1A;&#x5728;&#x4E0B;&#x9762;&#x4E00;&#x7AE0;&#x8FDB;&#x884C;&#x7F57;&#x5217;&#x3002;&#x4E8E;&#x662F;&#x5728;Google&#x4E4B;&#x4E2D;&#x5C31;&#x77E5;&#x9053;&#x4E86;PowerMock&#x3002;</p><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">PowerMock</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">PowerMock&#x662F;Mock&#x6846;&#x67B6;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x4ED6;&#x540C;&#x65F6;&#x652F;&#x6301;EasyMock&#x548C;Mockito&#x3002;&#x7F51;&#x4E0A;&#x7684;&#x6587;&#x7AE0;&#x4E5F;&#x662F;&#x5343;&#x5343;&#x4E07;&#xFF0C;&#x5177;&#x4F53;&#x6D4B;&#x8BD5;&#x8BED;&#x53E5;&#x7684;&#x5199;&#x6CD5;&#x4E5F;&#x662F;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x9760;&#x8C31;&#x7684;&#x8FD8;&#x662F;<a href=\"https://github.com/jayway/powermock\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">&#x5B98;&#x7F51;</a>&#x3002;PowerMock&#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;&#x6A21;&#x62DF;&#x7684;&#x9014;&#x5F84;&#xFF1A;</p><ul style=\"margin-top: 0; margin-bottom: 1.1em; line-height: 1.6;\"><li style=\"line-height: 1.6;\">&#x6A21;&#x62DF;&#x6784;&#x9020;&#x51FD;&#x6570;</li><li style=\"line-height: 1.6;\">&#x6A21;&#x62DF;&#x9759;&#x6001;&#x7C7B;</li><li style=\"line-height: 1.6;\">&#x7A81;&#x7834;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x63A7;&#x5236;&#xFF0C;&#x64CD;&#x7EB5;&#x79C1;&#x6709;&#x6210;&#x5458;&#xFF0C;&#x79C1;&#x6709;&#x9759;&#x6001;&#x6210;&#x5458;</li><li style=\"line-height: 1.6;\">&#x8C03;&#x7528;&#x79C1;&#x6709;&#x65B9;&#x6CD5;&#x3002;</li></ul><h2 style=\"font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 2.15em; margin: 1.2em 0 .6em 0; text-align: start;\">&#x8FDB;&#x9636;</h2><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x5728;&#x5B9E;&#x9645;&#x7684;&#x7F16;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x9047;&#x5230;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;Google&#x4E86;&#x5F88;&#x4E45;&#xFF0C;&#x73B0;&#x5C06;&#x6240;&#x6709;&#x95EE;&#x9898;&#x4EE5;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7F57;&#x5217;&#x4E00;&#x4E0B;&#xFF1A;</p><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">&#x5BF9;static&#x65B9;&#x6CD5;&#x7684;&#x6A21;&#x62DF;</h3><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\"><span style=\"line-height: 1.6; color: #66d9ef;\">Looper</span> mockLooper = mock(<span style=\"line-height: 1.6; color: #66d9ef;\">Looper</span>.<span style=\"line-height: 1.6; color: #f92672;\">class</span>);<br><span style=\"line-height: 1.6; color: #66d9ef;\">PowerMockito</span>.mockStatic(<span style=\"line-height: 1.6; color: #66d9ef;\">Looper</span>.<span style=\"line-height: 1.6; color: #f92672;\">class</span>);<br><span style=\"line-height: 1.6; color: #66d9ef;\">PowerMockito</span>.<span style=\"line-height: 1.6; color: #f92672;\">when</span>(<span style=\"line-height: 1.6; color: #66d9ef;\">Looper</span>.<span style=\"line-height: 1.6; color: #f92672;\">class</span>, <span style=\"line-height: 1.6; color: #e6db74;\">&quot;getMainLooper&quot;</span>).thenReturn(mockLooper);<br></code></pre><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">&#x5BF9;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x6A21;&#x62DF;</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x89E3;&#x51B3;&#x4E0A;&#x4E00;&#x7AE0;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6A21;&#x62DF;classA&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6765;&#x89E3;&#x51B3;&#xFF0C;&#x540C;&#x6837;&#x662F;&#x7528;&#x5230;PowerMockito</p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\"><span style=\"line-height: 1.6; color: #f92672;\">PowerMockito</span><span style=\"line-height: 1.6; color: #a6e22e;\">.whenNew</span>(<span style=\"line-height: 1.6; color: #f92672;\">Intent</span><span style=\"line-height: 1.6; color: #a6e22e;\">.class</span>)<span style=\"line-height: 1.6; color: #a6e22e;\">.withNoArguments</span>()<span style=\"line-height: 1.6; color: #a6e22e;\">.thenReturn</span>(<span style=\"line-height: 1.6; color: #f92672;\">mockIntent</span>);<br><span style=\"line-height: 1.6; color: #f92672;\">PowerMockito</span><span style=\"line-height: 1.6; color: #a6e22e;\">.whenNew</span>(<span style=\"line-height: 1.6; color: #f92672;\">Intent</span><span style=\"line-height: 1.6; color: #a6e22e;\">.class</span>)<span style=\"line-height: 1.6; color: #a6e22e;\">.withArguments</span>(<span style=\"line-height: 1.6; color: #f92672;\">anyString</span>())<span style=\"line-height: 1.6; color: #a6e22e;\">.thenReturn</span>(<span style=\"line-height: 1.6; color: #f92672;\">mockIntent</span>);<br></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x9488;&#x5BF9;&#x6709;&#x53C2;&#x6570;&#x548C;&#x6CA1;&#x6709;&#x53C2;&#x6570;&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;</p><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">&#x64CD;&#x4F5C;private&#x6210;&#x5458;</h3><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\"><span style=\"line-height: 1.6; color: #75715e;\">// &#x64CD;&#x4F5C;&#x79C1;&#x6709;&#x975E;&#x9759;&#x6001;&#x6210;&#x5458;</span><br>Whitebox.setInternalState(mockObj, <span style=\"line-height: 1.6; color: #e6db74;\">&quot;mPrivateStaticVariable&quot;</span>, <span style=\"line-height: 1.6; color: #f92672;\">value</span>);<br>Whitebox.getInternalState(mockObj, <span style=\"line-height: 1.6; color: #e6db74;\">&quot;mPrivateStaticVariable&quot;</span>);<br><br><span style=\"line-height: 1.6; color: #75715e;\">// &#x64CD;&#x4F5C;&#x79C1;&#x6709;&#x9759;&#x6001;&#x6210;&#x5458;</span><br>Whitebox.setInternalState(xxx.<span style=\"line-height: 1.6; color: #f92672;\">class</span>, <span style=\"line-height: 1.6; color: #e6db74;\">&quot;mPrivateStaticVariable&quot;</span>, <span style=\"line-height: 1.6; color: #f92672;\">value</span>, xxx.<span style=\"line-height: 1.6; color: #f92672;\">class</span>);<br>Whitebox.getInternalState(xxx.<span style=\"line-height: 1.6; color: #f92672;\">class</span>, <span style=\"line-height: 1.6; color: #e6db74;\">&quot;mPrivateStaticVariable&quot;</span>, xxx.<span style=\"line-height: 1.6; color: #f92672;\">class</span>);<br></code></pre><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">&#x5C40;&#x90E8;&#x6A21;&#x62DF;</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x8FD9;&#x4E2A;&#x4F1A;&#x7528;&#x5230;Mockito&#x4E2D;&#x7684;spy&#x5173;&#x952E;&#x5B57;&#x3002;&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x5265;&#x79BB;&#x9700;&#x8981;&#x6A21;&#x62DF;&#x7684;&#x7C7B;&#x548C;&#x5F85;&#x6D4B;&#x8BD5;&#x7684;&#x7C7B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5B9E;&#x9645;&#x4E2D;&#x7528;&#x5230;&#x7684;&#x4E0B;&#x9762;&#x7684;&#x7C7B;&#xFF1A;</p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\">public <span style=\"line-height: 1.6;\"><span style=\"line-height: 1.6; color: #66d9ef;\">class</span> <span style=\"line-height: 1.6; color: #f8f8f2;\">ConverterFacade</span> <span style=\"line-height: 1.6; color: #f92672;\"><span style=\"line-height: 1.6; color: #66d9ef;\">extends</span></span> <span style=\"line-height: 1.6; color: #a6e22e; font-style: italic;\">Service</span>&#123;</span><br>    <span style=\"line-height: 1.6; color: #f92672;\">private</span> void bindOfficeService()&#123;<br>        <span style=\"line-height: 1.6; color: #f92672;\">if</span> (bindService(intent, connection, <span style=\"line-height: 1.6;\">BIND_AUTO_CREATE</span>)) &#123;<br>            ...<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">ConverterFacade&#x7EE7;&#x627F;&#x81EA;Android&#x81EA;&#x6709;&#x7684;&#x7C7B;Service&#xFF0C;Service&#x7EE7;&#x627F;&#x81EA;Context&#xFF0C;bindService&#x662F;Context&#x63A5;&#x53E3;&#x7684;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x5BF9;&#x4E4B;&#x8FDB;&#x884C;mock&#xFF0C;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x62A5;&#x9519;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8981;&#x6D4B;&#x8BD5;ConverterFacade&#xFF0C;&#x53C8;&#x4E0D;&#x80FD;&#x5C06;&#x4E4B;mock&#x6389;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x9000;&#x800C;&#x6C42;&#x5176;&#x6B21;&#xFF0C;&#x91C7;&#x7528;partial mock&#x3002;&#x63D2;&#x5165;&#x5B98;&#x7F51;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;<a href=\"http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html#spy%28T%29\" target=\"_blank\" style=\"background: transparent; color: #1980e6; text-decoration: none;\">Mockito.spy</a>&#x3002;&#x5B98;&#x65B9;&#x5E76;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;spy&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;&#x6A21;&#x62DF;&#x7684;code&#x548C;&#x771F;&#x5B9E;&#x7684;code&#x6DF7;&#x5728;&#x4E00;&#x8D77;&#x3002;</p><blockquote style=\"padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;\"><p style=\"margin: 0 0 1.1em; font-size: 1em; font-weight: 300; margin-bottom: 0; line-height: 1.6;\">Real spies should be used <strong style=\"font-weight: bold; line-height: 1.6;\">carefully and occasionally</strong>. <br>&#x4F8B;&#x5B50;&#xFF1A;</p></blockquote><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\">   List list = <span style=\"line-height: 1.6; color: #f92672;\">new</span> LinkedList();<br>   List spy = spy(list);<br><br>   <span style=\"line-height: 1.6; color: #75715e;\">//optionally, you can stub out some methods:</span><br>   when(spy.<span style=\"line-height: 1.6; color: #e6db74;\">size</span>()).thenReturn(<span style=\"line-height: 1.6; color: #ae81ff;\">100</span>);<br><br>   <span style=\"line-height: 1.6; color: #75715e;\">//using the spy calls real methods</span><br>   spy.<span style=\"line-height: 1.6; color: #e6db74;\">add</span>(<span style=\"line-height: 1.6; color: #e6db74;\">&quot;one&quot;</span>);<br>   spy.<span style=\"line-height: 1.6; color: #e6db74;\">add</span>(<span style=\"line-height: 1.6; color: #e6db74;\">&quot;two&quot;</span>);<br><br>   <span style=\"line-height: 1.6; color: #75715e;\">//prints &quot;one&quot; - the first element of a list</span><br>   System.out.<span style=\"line-height: 1.6; color: #e6db74;\">println</span>(spy.<span style=\"line-height: 1.6; color: #e6db74;\">get</span>(<span style=\"line-height: 1.6; color: #ae81ff;\">0</span>));<br><br>   <span style=\"line-height: 1.6; color: #75715e;\">//size() method was stubbed - 100 is printed</span><br>   System.out.<span style=\"line-height: 1.6; color: #e6db74;\">println</span>(spy.<span style=\"line-height: 1.6; color: #e6db74;\">size</span>());<br><br>   <span style=\"line-height: 1.6; color: #75715e;\">//optionally, you can verify</span><br>   verify(spy).<span style=\"line-height: 1.6; color: #e6db74;\">add</span>(<span style=\"line-height: 1.6; color: #e6db74;\">&quot;one&quot;</span>);<br>   verify(spy).<span style=\"line-height: 1.6; color: #e6db74;\">add</span>(<span style=\"line-height: 1.6; color: #e6db74;\">&quot;two&quot;</span>);<br></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">doReturn().when()</code>&#x800C;&#x4E0D;&#x80FD;&#x7528;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">when().doReturn()</code></p><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\"> //<span style=\"line-height: 1.6;\">Impossible</span>: real <span style=\"line-height: 1.6; color: #f92672;\">method</span> <span style=\"line-height: 1.6; color: #f92672;\">is</span> called so spy.get(<span style=\"line-height: 1.6; color: #ae81ff;\">0</span>) throws <span style=\"line-height: 1.6;\">IndexOutOfBoundsException</span> (the list <span style=\"line-height: 1.6; color: #f92672;\">is</span> yet empty)<br><span style=\"line-height: 1.6; color: #f92672;\">when</span>(spy.get(<span style=\"line-height: 1.6; color: #ae81ff;\">0</span>)).thenReturn(<span style=\"line-height: 1.6; color: #e6db74;\">&quot;foo&quot;</span>);<br><br>//<span style=\"line-height: 1.6;\">You</span> have to use doReturn() <span style=\"line-height: 1.6; color: #f92672;\">for</span> stubbing<br>doReturn(<span style=\"line-height: 1.6; color: #e6db74;\">&quot;foo&quot;</span>).<span style=\"line-height: 1.6; color: #f92672;\">when</span>(spy).get(<span style=\"line-height: 1.6; color: #ae81ff;\">0</span>);<br></code></pre><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">java.lang.NoClassDefFoundError</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x9047;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x6CA1;&#x6709;&#x5BFC;&#x5165;moffice-service-base&#x5305;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x5F04;&#x597D;&#x5C31;&#x884C;&#x4E86;</p><p style=\"margin: 0 0 1.1em; line-height: 1.6;\"><img class=\"enMedia\" src=\"/images/Android&#x5355;&#x5143;&#x6D4B;&#x8BD5;/1476841513603.png\" hash=\"3e0e82cf948615d59ce5b84bb1d626be\" align alt longdesc width height border hspace vspace usemap style=\"border: 0; vertical-align: middle; max-width: 100%;\" title lang xml:lang dir></p><blockquote style=\"padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;\"><p style=\"margin: 0 0 1.1em; font-size: 1em; font-weight: 300; margin-bottom: 0; line-height: 1.6;\"><strong style=\"font-weight: bold; line-height: 1.6;\">java.lang.ClassNotFoundException</strong> <br>This exception indicates that the class was not found on the classpath. This indicates that we were trying to load the class definition, and the class did not exist on the classpath. <br><strong style=\"font-weight: bold; line-height: 1.6;\">java.lang.NoClassDefFoundError</strong> <br>This exception indicates that the JVM looked in its internal class definition data structure for the definition of a class and did not find it. This is different than saying that it could not be loaded from the classpath. Usually this indicates that we previously attempted to load a class from the classpath, but it failed for some reason - now we&#x2019;re trying to use the class again (and thus need to load it, since it failed last time), but we&#x2019;re not even going to try to load it, because we failed loading it earlier (and reasonably suspect that we would fail again). The earlier failure could be a ClassNotFoundException or an ExceptionInInitializerError (indicating a failure in the static initialization block) or any number of other problems. The point is, a NoClassDefFoundError is not necessarily a classpath problem.</p></blockquote><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">mockStatic&#x5BFC;&#x81F4;&#x5185;&#x90E8;&#x7C7B;&#x65E0;&#x6CD5;&#x6709;&#x6548;&#x5F15;&#x7528;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x6210;&#x5458;</h3><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x662F;&#xFF0C;&#x4E0D;&#x8981;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">mockStatic(ConverterFacade.class);</code>&#x8981;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">mockStatic(ConverterFacade.class, CALLS_REAL_METHODS);</code></p><h3 style=\"font-family: inherit; font-weight: bold; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 1.7em; margin: 1.2em 0 .6em 0; text-align: start; line-height: 1.6;\">&#x6355;&#x83B7;&#x53C2;&#x6570;</h3><pre style=\"font-family: &apos;Source Code Pro&apos;,monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; border: 0; border-radius: 5px; text-align: start; word-break: break-all;\"><code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 1.3em 2em;\">Message <span style=\"line-height: 1.6; color: #f92672;\">m</span> = mock(Message.<span style=\"line-height: 1.6; color: #f92672;\">class</span>);<br><span style=\"line-height: 1.6; color: #f92672;\">m</span>.what = 1;<br>Handler mHandler = mock(Handler.<span style=\"line-height: 1.6; color: #f92672;\">class</span>);<br>mHandler.sendMessage(<span style=\"line-height: 1.6; color: #f92672;\">m</span>);<br><br><span style=\"line-height: 1.6; color: #f92672;\">m</span>.what = 2;<br>mHandler.sendMessage(<span style=\"line-height: 1.6; color: #f92672;\">m</span>);<br><br>ArgumentCaptor&lt;Message&gt; argumentCaptor2 = ArgumentCaptor.forClass(Message.<span style=\"line-height: 1.6; color: #f92672;\">class</span>);<br>verify(mHandler, times(2)).sendMessage(argumentCaptor2.<span style=\"line-height: 1.6; color: #f92672;\">capture</span>());<br><span style=\"line-height: 1.6; color: #f92672;\">List</span>&lt;Message&gt; msgList = argumentCaptor2.getAllValues();<br></code></pre><p style=\"margin: 0 0 1.1em; line-height: 1.6;\">ArgumentCaptor&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6355;&#x83B7;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x60C5;&#x51B5;&#x3002;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">argumentCaptor.getValue()</code>&#x53EF;&#x4EE5;&#x6355;&#x83B7;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF0C;<code style=\"font-family: &apos;Source Code Pro&apos;,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;\">argumentCaptor.getAllValues()</code>&#x53EF;&#x4EE5;&#x6355;&#x83B7;&#x591A;&#x6B21;&#x8C03;&#x7528;&#x6216;&#x8005;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x4F20;&#x9012;&#x591A;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x3002; <br>&#x8FD9;&#x5176;&#x4E2D;&#x7275;&#x6D89;&#x5230;Java&#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5982;&#x4E0A;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#xFF0C;&#x867D;&#x7136;&#x6700;&#x7EC8;&#x5F97;&#x5230;&#x7684;List&#x7684;size&#x662F;2&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;&#x8868;&#x9879;&#x7684;what&#x503C;&#x90FD;&#x6307;&#x5411;2&#xFF0C;&#x7528;Android Studio&#x67E5;&#x770B;&#x5BF9;&#x8C61;&#x5730;&#x5740;&#xFF0C;&#x53D1;&#x73B0;&#x8FD9;&#x4FE9;&#x90FD;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x503C;&#x76F8;&#x540C;&#x4E5F;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x5982;&#x679C;&#x60F3;&#x8981;&#x6355;&#x83B7;&#x5230;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x503C;&#xFF0C;&#x5C31;&#x8981;new&#x4E24;&#x6B21;&#x3002;</p></div><center style=\"display:none\">%23Android%u5355%u5143%u6D4B%u8BD5%0A@%28%u5B66%u4E60%u7B14%u8BB0%29%5BAndroid%2C%20unittest%2C%20mockito%2C%20powermock%5D%0A%u4ECA%u65E5%u5728%u505A%u5FAE%u4FE1IoT%u6253%u5370%u673A%u7684%u9879%u76EE%uFF0C%u5176%u4E2D%u6D89%u53CA%u5230%u7528Android%u7A0B%u5E8F%u8BBF%u95EEWPS%u670D%u52A1%u6765%u5B9E%u73B0%u5C06word%u6587%u6863%u53E6%u5B58%u4E3APDF%u7684%u529F%u80FD%u3002%u4E8E%u662F%uFF0C%u79C9%u7740TDD%u7684%u7CBE%u795E%uFF0C%u5F00%u59CB%u5B66%u4E60%u5982%u4F55%u5728Android%u4E2D%u505A%u5355%u5143%u6D4B%u8BD5%u3002%0A%23%23%u5165%u95E8%0A%23%23%23JUnit%0A%u9996%u5148%u770B%u5230%u7684%u662FAndroid%u7684%u5B98%u7F51%u6587%u6863%5BGetting%20Started%20with%20Testing%5D%28https%3A//developer.android.com/training/testing/start/index.html%29%2C%20%5BBuilding%20Local%20Unit%20Tests%5D%28https%3A//developer.android.com/training/testing/unit-testing/local-unit-tests.html%29%u3002%u6709%u4E24%u79CD%u7C7B%u578B%u7684%u6D4B%u8BD5%uFF0C%u4E00%u79CD%u662F%u8DD1%u5728%u4E3B%u673A%u4E0A%u7684%uFF0C%u53EBLocal%20Unit%20Test%uFF0C%u53E6%u4E00%u79CD%u8DD1%u5728%u76EE%u6807%u673A%u4E0A%uFF0C%u53EBInstrumented%20Unit%20Test%u3002%0ALocal%20Unit%20Test%u57FA%u4E8EJUnit%uFF0C%u4E0A%u9762%u7684%u5173%u4E8ELocal%20Unit%20Test%u7684%u94FE%u63A5%u5DF2%u7ECF%u6709%u4E86%u5982%u4F55%u5728Android%20Studio%u4E2D%u4F7F%u80FDJUnit%u7684%u8303%u4F8B%u4E86%u3002%u914D%u7F6E%u597DDependencies%u5C31%u53EF%u4EE5%u4E86%u3002Android%20Studio%u4F1A%u53BBmaven%u5E93%u4E2D%u6293%u53D6JUnit%u7684jar%u5305%u5E76%u5BFC%u5165%u5230%u9879%u76EE%u4E2D%uFF0C%u4E4B%u540E%u5C31%u53EF%u4EE5%u4F7F%u7528%u4E86%u3002%0A%u9047%u5230%u9519%u8BEF%60Error%3A%2823%2C%2017%29%22Failed%20to%20resolve%3A%20junit%3Ajunit%3A4.12%60%uFF0C%u5728build.gradle%u4E0B%u9762%u52A0%0A%60%60%60%0Arepositories%20%7B%0A%20%20%20%20%20%20%20%20maven%20%7B%20url%20%27http%3A//repo1.maven.org/maven2%27%20%7D%0A%20%20%20%20%20%20%20%20jcenter%20%7B%20url%20%22http%3A//jcenter.bintray.com/%22%20%7D%0A%7D%0A%60%60%60%0A%u6216%u8005%u81EA%u884C%u53BB%u4E0B%u8F7Djunit-4.12.jar%uFF0C%u518D%u653E%u5230libs%u76EE%u5F55%u5E95%u4E0B%u5C31%u53EF%u4EE5%u4E86%u3002%0A%0A%23%23%23Mockito%0A%u5728C++%u4E2D%u505AUnit%20Test%u7684%u65F6%u5019%uFF0C%u6211%u4EEC%u5F80%u5F80%u9700%u8981%u81EA%u5DF1%u6784%u5EFAstub%uFF0C%u6765%u9694%u79BB%u9700%u8981%u6D4B%u8BD5%u7684code%u3002%u5728Java%u4E2D%uFF0C%u6211%u4EEC%u6709%u73B0%u6210%u7684%u6846%u67B6%u53EF%u4EE5%u7528%uFF0C%u8FD9%u5C31%u662F%5BMockito%5D%28https%3A//github.com/mockito/mockito%29%u3002%u7F51%u4E0A%u5173%u4E8EMockito+Android%u5355%u5143%u6D4B%u8BD5%u7684%u6587%u7AE0%u4E00%u641C%u4E00%u5927%u645E%u3002%u6211%u4E5F%u7B80%u5355%u7684%u6458%u5F55%u4E86%u51E0%u4E2A%u3002%0A-%20%5BAndroid%u6D4B%u8BD5%u4E8C%uFF1AMockito%u4E0E%u5355%u5143%u6D4B%u8BD5%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/360fa827-de1f-46e7-b815-465c074a5b9e%29%0A-%20%5BAndroid%20%u5355%u5143%u6D4B%u8BD5%u4E4BJUnit%u548CMockito%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/beaaf776-621e-4fdb-9dca-e6eedc6a1029%29%0A-%20%5BAndroid%u6700%u4F73Mock%u5355%u5143%u6D4B%u8BD5%u65B9%u6848%3AJunit%20+%20Mockito%20+%20Powermock%5D%28https%3A//www.evernote.com/shard/s24/nl/2724128/78565e6e-82eb-4f74-80c8-177863a6499c%29%0AMockito%u7684%u4E3B%u8981%u4F5C%u7528%u5C31%u662F%u6A21%u62DF%u5916%u90E8%u7C7B%u7684%u884C%u4E3A%uFF0C%u8FBE%u5230%u9694%u79BB%u5F85%u6D4B%u4EE3%u7801%u7684%u76EE%u7684%u3002%u5982%u4E0B%u56FE%u3002%0A%21%5BAlt%20text%5D%28./1476833497231.png%29%0A%u5728Android%u7684%u6D4B%u8BD5%u4E2D%uFF0CMockito%u7684%u4E3B%u8981%u4F5C%u7528%u5C31%u662F%u6A21%u62DF%u6240%u6709Android%u7684%u7C7B%u3002%60ClassA%20mockObj%20%3D%20mock%28ClassA%29%60%u5C31%u4F1A%u751F%u6210%u4E00%u4E2Amock%u7684%u5BF9%u8C61%u3002%u7136%u540E%u6211%u4EEC%u5C31%u53EF%u4EE5%u901A%u8FC7Mockito%u63D0%u4F9B%u7684%u5404%u79CD%u624B%u6BB5%u6765%u5B9A%u5236%u8FD9%u4E2A%u5BF9%u8C61%u7684%u5404%u79CD%u884C%u4E3A%u3002%u4F46%u8FD9%u6709%u5F88%u5927%u7684%u5C40%u9650%u6027%u3002%u770B%u4E0B%u9762%u7684%u4EE3%u7801%0A%60%60%60%0Aimport%20android.os.classA%0Aclass%20B%20%7B%0A%09public%20void%20methodC%20%28%29%7B%0A%09%09classA%20a%20%3D%20new%20classA%28%29%3B%0A%09%09a.methodA%28%29%3B%0A%09%7D%0A%7D%0A%60%60%60%0A%u8BF7%u95EE%u8FD9%u91CC%u6211%u8981%u600E%u4E48%u5728methodC%u4E2D%u6A21%u62DF%u5BF9%u8C61A%u7684%u884C%u4E3A%u3002%u8BF8%u5982%u6B64%u7C7B%u5F88%u591A%u95EE%u9898%uFF0C%u4F1A%u5728%u4E0B%u9762%u4E00%u7AE0%u8FDB%u884C%u7F57%u5217%u3002%u4E8E%u662F%u5728Google%u4E4B%u4E2D%u5C31%u77E5%u9053%u4E86PowerMock%u3002%0A%0A%23%23%23PowerMock%0APowerMock%u662FMock%u6846%u67B6%u7684%u6269%u5C55%uFF0C%u4ED6%u540C%u65F6%u652F%u6301EasyMock%u548CMockito%u3002%u7F51%u4E0A%u7684%u6587%u7AE0%u4E5F%u662F%u5343%u5343%u4E07%uFF0C%u5177%u4F53%u6D4B%u8BD5%u8BED%u53E5%u7684%u5199%u6CD5%u4E5F%u662F%u5404%u4E0D%u76F8%u540C%uFF0C%u6240%u4EE5%u6700%u9760%u8C31%u7684%u8FD8%u662F%5B%u5B98%u7F51%5D%28https%3A//github.com/jayway/powermock%29%u3002PowerMock%u63D0%u4F9B%u4E86%u4EE5%u4E0B%u6A21%u62DF%u7684%u9014%u5F84%uFF1A%0A-%20%u6A21%u62DF%u6784%u9020%u51FD%u6570%0A-%20%u6A21%u62DF%u9759%u6001%u7C7B%0A-%20%u7A81%u7834%u8BBF%u95EE%u6743%u9650%u63A7%u5236%uFF0C%u64CD%u7EB5%u79C1%u6709%u6210%u5458%uFF0C%u79C1%u6709%u9759%u6001%u6210%u5458%0A-%20%u8C03%u7528%u79C1%u6709%u65B9%u6CD5%u3002%0A%0A%23%23%u8FDB%u9636%0A%u5728%u5B9E%u9645%u7684%u7F16%u7801%u8FC7%u7A0B%u4E2D%uFF0C%u9047%u5230%u5F88%u591A%u95EE%u9898%uFF0CGoogle%u4E86%u5F88%u4E45%uFF0C%u73B0%u5C06%u6240%u6709%u95EE%u9898%u4EE5%u53CA%u89E3%u51B3%u65B9%u6848%u7F57%u5217%u4E00%u4E0B%uFF1A%0A%23%23%23%20%u5BF9static%u65B9%u6CD5%u7684%u6A21%u62DF%0A%60%60%60%0ALooper%20mockLooper%20%3D%20mock%28Looper.class%29%3B%0APowerMockito.mockStatic%28Looper.class%29%3B%0APowerMockito.when%28Looper.class%2C%20%22getMainLooper%22%29.thenReturn%28mockLooper%29%3B%0A%60%60%60%0A%0A%23%23%23%u5BF9%u6784%u9020%u51FD%u6570%u7684%u6A21%u62DF%0A%u89E3%u51B3%u4E0A%u4E00%u7AE0%u63D0%u5230%u7684%u95EE%u9898%uFF0C%u53EF%u4EE5%u7528%u6A21%u62DFclassA%u7684%u6784%u9020%u51FD%u6570%u6765%u89E3%u51B3%uFF0C%u540C%u6837%u662F%u7528%u5230PowerMockito%0A%60%60%60%0APowerMockito.whenNew%28Intent.class%29.withNoArguments%28%29.thenReturn%28mockIntent%29%3B%0APowerMockito.whenNew%28Intent.class%29.withArguments%28anyString%28%29%29.thenReturn%28mockIntent%29%3B%0A%60%60%60%0A%u9488%u5BF9%u6709%u53C2%u6570%u548C%u6CA1%u6709%u53C2%u6570%u7684%u4E24%u79CD%u60C5%u51B5%0A%0A%23%23%23%u64CD%u4F5Cprivate%u6210%u5458%0A%60%60%60%0A//%20%u64CD%u4F5C%u79C1%u6709%u975E%u9759%u6001%u6210%u5458%0AWhitebox.setInternalState%28mockObj%2C%20%22mPrivateStaticVariable%22%2C%20value%29%3B%0AWhitebox.getInternalState%28mockObj%2C%20%22mPrivateStaticVariable%22%29%3B%0A%0A//%20%u64CD%u4F5C%u79C1%u6709%u9759%u6001%u6210%u5458%0AWhitebox.setInternalState%28xxx.class%2C%20%22mPrivateStaticVariable%22%2C%20value%2C%20xxx.class%29%3B%0AWhitebox.getInternalState%28xxx.class%2C%20%22mPrivateStaticVariable%22%2C%20xxx.class%29%3B%0A%60%60%60%0A%0A%23%23%23%u5C40%u90E8%u6A21%u62DF%0A%u8FD9%u4E2A%u4F1A%u7528%u5230Mockito%u4E2D%u7684spy%u5173%u952E%u5B57%u3002%u5728%u5F88%u591A%u60C5%u51B5%u4E0B%uFF0C%u6211%u4EEC%u65E0%u6CD5%u5265%u79BB%u9700%u8981%u6A21%u62DF%u7684%u7C7B%u548C%u5F85%u6D4B%u8BD5%u7684%u7C7B%u3002%u4F8B%u5982%uFF0C%u5B9E%u9645%u4E2D%u7528%u5230%u7684%u4E0B%u9762%u7684%u7C7B%uFF1A%0A%60%60%60%0Apublic%20class%20ConverterFacade%20extends%20Service%7B%0A%09private%20void%20bindOfficeService%28%29%7B%0A%09%09if%20%28bindService%28intent%2C%20connection%2C%20BIND_AUTO_CREATE%29%29%20%7B%0A%09%09%09...%0A%09%09%7D%0A%09%7D%0A%7D%0A%60%60%60%0AConverterFacade%u7EE7%u627F%u81EAAndroid%u81EA%u6709%u7684%u7C7BService%uFF0CService%u7EE7%u627F%u81EAContext%uFF0CbindService%u662FContext%u63A5%u53E3%u7684%u4E00%u4E2A%u65B9%u6CD5%u3002%u5982%u679C%u4E0D%u5BF9%u4E4B%u8FDB%u884Cmock%uFF0C%u6D4B%u8BD5%u7684%u65F6%u5019%u4F1A%u62A5%u9519%u3002%u56E0%u4E3A%u6211%u4EEC%u8981%u6D4B%u8BD5ConverterFacade%uFF0C%u53C8%u4E0D%u80FD%u5C06%u4E4Bmock%u6389%uFF0C%u6240%u4EE5%u53EA%u80FD%u9000%u800C%u6C42%u5176%u6B21%uFF0C%u91C7%u7528partial%20mock%u3002%u63D2%u5165%u5B98%u7F51%u7684%u4ECB%u7ECD%uFF0C%5BMockito.spy%5D%28http%3A//site.mockito.org/mockito/docs/current/org/mockito/Mockito.html%23spy%28T%29%29%u3002%u5B98%u65B9%u5E76%u4E0D%u63A8%u8350%u4F7F%u7528spy%uFF0C%u56E0%u4E3A%u8FD9%u6837%u4F1A%u8BA9%u6A21%u62DF%u7684code%u548C%u771F%u5B9E%u7684code%u6DF7%u5728%u4E00%u8D77%u3002%0A%3E%20Real%20spies%20should%20be%20used%20**carefully%20and%20occasionally**.%0A%u4F8B%u5B50%uFF1A%0A%60%60%60%0A%20%20%20List%20list%20%3D%20new%20LinkedList%28%29%3B%0A%20%20%20List%20spy%20%3D%20spy%28list%29%3B%0A%0A%20%20%20//optionally%2C%20you%20can%20stub%20out%20some%20methods%3A%0A%20%20%20when%28spy.size%28%29%29.thenReturn%28100%29%3B%0A%0A%20%20%20//using%20the%20spy%20calls%20real%20methods%0A%20%20%20spy.add%28%22one%22%29%3B%0A%20%20%20spy.add%28%22two%22%29%3B%0A%0A%20%20%20//prints%20%22one%22%20-%20the%20first%20element%20of%20a%20list%0A%20%20%20System.out.println%28spy.get%280%29%29%3B%0A%0A%20%20%20//size%28%29%20method%20was%20stubbed%20-%20100%20is%20printed%0A%20%20%20System.out.println%28spy.size%28%29%29%3B%0A%0A%20%20%20//optionally%2C%20you%20can%20verify%0A%20%20%20verify%28spy%29.add%28%22one%22%29%3B%0A%20%20%20verify%28spy%29.add%28%22two%22%29%3B%0A%60%60%60%0A%u4E3A%u4EC0%u4E48%u8981%u7528%60doReturn%28%29.when%28%29%60%u800C%u4E0D%u80FD%u7528%60when%28%29.doReturn%28%29%60%0A%60%60%60%0A%20//Impossible%3A%20real%20method%20is%20called%20so%20spy.get%280%29%20throws%20IndexOutOfBoundsException%20%28the%20list%20is%20yet%20empty%29%0Awhen%28spy.get%280%29%29.thenReturn%28%22foo%22%29%3B%0A%0A//You%20have%20to%20use%20doReturn%28%29%20for%20stubbing%0AdoReturn%28%22foo%22%29.when%28spy%29.get%280%29%3B%0A%60%60%60%0A%0A%23%23%23java.lang.NoClassDefFoundError%0A%u9047%u5230%u4E86%u8FD9%u4E2A%u95EE%u9898%uFF0C%u539F%u56E0%u662F%u6CA1%u6709%u5BFC%u5165moffice-service-base%u5305%u3002%u5728%u8FD9%u91CC%u5F04%u597D%u5C31%u884C%u4E86%0A%21%5BAlt%20text%5D%28./1476841513603.png%29%0A%u4E0D%u8FC7%u521A%u770B%u5230%u8FD9%u4E2Aexception%u7684%u65F6%u5019%uFF0C%u4E5F%u633A%u552C%u4EBA%u7684%u3002%u5728StackOverflow%u4E0A%u641C%u5230%u4E86%u8FD9%u4E2A%u5E16%u5B50%uFF0C%u4E5F%u7B97%u662F%u5BF9%u8FD9%u4E2A%u9519%u8BEF%u7684%u4E00%u4E2A%u5C0F%u5C0F%u7684%u5165%u95E8%uFF1A%0A%3E%20**java.lang.ClassNotFoundException**%0A%3E%20This%20exception%20indicates%20that%20the%20class%20was%20not%20found%20on%20the%20classpath.%20This%20indicates%20that%20we%20were%20trying%20to%20load%20the%20class%20definition%2C%20and%20the%20class%20did%20not%20exist%20on%20the%20classpath.%0A%3E**java.lang.NoClassDefFoundError**%0A%3EThis%20exception%20indicates%20that%20the%20JVM%20looked%20in%20its%20internal%20class%20definition%20data%20structure%20for%20the%20definition%20of%20a%20class%20and%20did%20not%20find%20it.%20This%20is%20different%20than%20saying%20that%20it%20could%20not%20be%20loaded%20from%20the%20classpath.%20Usually%20this%20indicates%20that%20we%20previously%20attempted%20to%20load%20a%20class%20from%20the%20classpath%2C%20but%20it%20failed%20for%20some%20reason%20-%20now%20we%27re%20trying%20to%20use%20the%20class%20again%20%28and%20thus%20need%20to%20load%20it%2C%20since%20it%20failed%20last%20time%29%2C%20but%20we%27re%20not%20even%20going%20to%20try%20to%20load%20it%2C%20because%20we%20failed%20loading%20it%20earlier%20%28and%20reasonably%20suspect%20that%20we%20would%20fail%20again%29.%20The%20earlier%20failure%20could%20be%20a%20ClassNotFoundException%20or%20an%20ExceptionInInitializerError%20%28indicating%20a%20failure%20in%20the%20static%20initialization%20block%29%20or%20any%20number%20of%20other%20problems.%20The%20point%20is%2C%20a%20NoClassDefFoundError%20is%20not%20necessarily%20a%20classpath%20problem.%0A%0A%23%23%23mockStatic%u5BFC%u81F4%u5185%u90E8%u7C7B%u65E0%u6CD5%u6709%u6548%u5F15%u7528%u5916%u90E8%u7C7B%u7684%u6210%u5458%0A%u89E3%u51B3%u65B9%u6CD5%u662F%uFF0C%u4E0D%u8981%60mockStatic%28ConverterFacade.class%29%3B%60%u8981%60mockStatic%28ConverterFacade.class%2C%20CALLS_REAL_METHODS%29%3B%60%0A%0A%23%23%23%u6355%u83B7%u53C2%u6570%0A%60%60%60%0AMessage%20m%20%3D%20mock%28Message.class%29%3B%0Am.what%20%3D%201%3B%0AHandler%20mHandler%20%3D%20mock%28Handler.class%29%3B%0AmHandler.sendMessage%28m%29%3B%0A%0Am.what%20%3D%202%3B%0AmHandler.sendMessage%28m%29%3B%0A%0AArgumentCaptor%3CMessage%3E%20argumentCaptor2%20%3D%20ArgumentCaptor.forClass%28Message.class%29%3B%0Averify%28mHandler%2C%20times%282%29%29.sendMessage%28argumentCaptor2.capture%28%29%29%3B%0AList%3CMessage%3E%20msgList%20%3D%20argumentCaptor2.getAllValues%28%29%3B%0A%60%60%60%0AArgumentCaptor%u53EF%u4EE5%u5E2E%u52A9%u6355%u83B7%u53C2%u6570%u8C03%u7528%u60C5%u51B5%u3002%60argumentCaptor.getValue%28%29%60%u53EF%u4EE5%u6355%u83B7%u6700%u540E%u4E00%u6B21%u8C03%u7528%u7684%u53C2%u6570%uFF0C%60argumentCaptor.getAllValues%28%29%60%u53EF%u4EE5%u6355%u83B7%u591A%u6B21%u8C03%u7528%u6216%u8005%u4E00%u6B21%u8C03%u7528%u4F20%u9012%u591A%u4E2A%u53C2%u6570%u7684%u60C5%u51B5%u3002%0A%u8FD9%u5176%u4E2D%u7275%u6D89%u5230Java%u5BF9%u8C61%u4F20%u9012%u7684%u65B9%u6CD5%u3002%u5982%u4E0A%u7A0B%u5E8F%u4EE3%u7801%uFF0C%u867D%u7136%u6700%u7EC8%u5F97%u5230%u7684List%u7684size%u662F2%uFF0C%u4F46%u662F%u8FD9%u4E24%u4E2A%u8868%u9879%u7684what%u503C%u90FD%u6307%u54112%uFF0C%u7528Android%20Studio%u67E5%u770B%u5BF9%u8C61%u5730%u5740%uFF0C%u53D1%u73B0%u8FD9%u4FE9%u90FD%u6307%u5411%u540C%u4E00%u4E2A%u5BF9%u8C61%uFF0C%u6240%u4EE5%u5176%u503C%u76F8%u540C%u4E5F%u5C31%u4E0D%u96BE%u7406%u89E3%u4E86%u3002%u5982%u679C%u60F3%u8981%u6355%u83B7%u5230%u4E24%u4E2A%u4E0D%u540C%u7684%u503C%uFF0C%u5C31%u8981new%u4E24%u6B21%u3002</center><br></div>",
            "tags": [
                "Android",
                "unittest",
                "mockito",
                "powermock"
            ]
        }
    ]
}