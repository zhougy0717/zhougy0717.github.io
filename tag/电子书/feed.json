{
    "version": "https://jsonfeed.org/version/1",
    "title": "Big Ben • All posts by \"电子书\" tag",
    "description": null,
    "home_page_url": "https://blog.zhougy.top",
    "items": [
        {
            "id": "https://blog.zhougy.top/2021/09/25/obsidian_posts/%E7%BE%A4%E6%99%96%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%94%B5%E5%AD%90%E4%B9%A6%E5%9B%BE%E4%B9%A6%E9%A6%86/",
            "url": "https://blog.zhougy.top/2021/09/25/obsidian_posts/%E7%BE%A4%E6%99%96%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%94%B5%E5%AD%90%E4%B9%A6%E5%9B%BE%E4%B9%A6%E9%A6%86/",
            "title": "群晖搭建个人电子书图书馆",
            "date_published": "2021-09-25T14:24:30.253Z",
            "content_html": "<p>最近比较迷群晖的docker。虽然电子书库对我来说用处不是很大，但也忍不住折腾了一番。最后导入藏书的时候才发现，原来像收破烂一样，收了很多书，真正读的不过1，2成。最近看过一些整理笔记或者知识管理的博文，里面提到知识应当不断整理，才能转化为自己的知识。这些收藏在角落里的应当果断地断舍离。这是题外话了。<br>本文主要还是记录一些折腾心得，希望可以帮到需要的人，可以节省一些时间和精力。网络上其实有很多已经实践了的文章，可作参考：</p>\n<ul>\n<li><a href=\"https://sspai.com/post/64202\">打造基于 NAS 的个人随身数字书库 - 少数派</a></li>\n<li><a href=\"https://post.smzdm.com/p/534074/\">skylake架构DIY NAS 篇二：打造属于自己的私人云书库<em>NAS存储</em>什么值得买</a></li>\n<li><a href=\"https://www.jianshu.com/p/66c160ee6677\">[拍娃党之文件管理：NAS篇二]Calibre-web电子书库解决方案 - 简书</a></li>\n</ul>\n<p>Calibre是一个电子书管理软件，请看“<a href=\"https://calibre-ebook.com/zh_CN\">calibre - 电子书管理</a>”。然后，有热心网友，将其web化，提供了基于Bootstrap框架的web客户端，即“<a href=\"https://github.com/janeczku/calibre-web\">janeczku/calibre-web</a>”。再然后，docker镜像也就应运而生，于是群晖结合docker又具备了新的可玩性。Calibre-web的docker镜像主要有两个：</p>\n<ul>\n<li><a href=\"https://hub.docker.com/r/technosoft2000/calibre-web\">technosoft2000/calibre-web - Docker Image | Docker Hub</a></li>\n<li><a href=\"https://hub.docker.com/r/linuxserver/calibre-web\">linuxserver/calibre-web - Docker Image | Docker Hub</a></li>\n</ul>\n<p>在群晖的docker中都可以安装，两款docker的主要区别在于后者不包含电子书格式转换模块，而前者则是包含了转换模块。可以将电子书转换成不同格式，例如：PDF，EPUB，AZW3，MOBI等等。</p>\n<p>我最终选择了technosoft2000/calibre-web，倒不是因为电子书转换功能。而是因为linuxserver/calibre-web过于精简。该docker中vi工具都没有，也缺少calibredb工具。对于我这种需要批量导入已有图书的就不太友好了。后文有针对批量导入的一些个人的经验分享。</p>\n<p>后续章节罗列一些我遇到的问题和解决的方法。</p>\n<h1 id=\"数据库\"><a href=\"#数据库\" class=\"headerlink\" title=\"数据库\"></a>数据库</h1><p>第一次打开Calibre界面时，需要选择数据库地址。一开始选择的linuxserver/calibre-web镜像，怎么都没法进入主界面。参考<a href=\"https://zhuanlan.zhihu.com/p/357220232\">Calibre-web部署后一些细节问题答疑 - 知乎</a></p>\n<blockquote>\n<ol>\n<li>其他文章提到部署时需要metadata.db文件，不然在进入网页配置时会无法进行下一步。</li>\n</ol>\n<p>答：technosoft2000/calibre-web这个镜像倒是会自动去创建metadata.db文件，不需要像其他镜像那样需要用户先用PC版calibre来创建metadata.db然后复制进群晖相关文件夹。但更容易遇到另一个问题，我在问题2里说。</p>\n<ol>\n<li>最初运行technosoft2000/calibre-web镜像数分钟后，calibre-web会自动停止运行。并且在日志里查看会提示缺少“<code>***.py</code>”文件。</li>\n</ol>\n<p>答：虽然technosoft2000/calibre-web会自动下载运行所需的文件，但因为它本身服务器和国内连接不畅的原因，很容易出现下载失败的情况，然后就会有类似提示。需要等待其他时间段尝试让其自动下载文件，或者改善网络。</p>\n</blockquote>\n<p>我是使用technosoft2000/calibre-web镜像，直接可以生成metadata.db，并直接进入界面。如果是用linuxserver/calibre-web镜像可能要动点其他的小心思。比如用PC端Calibre生成好metadta.db文件，再拷过来。为了省事儿，可以直接上technosoft2000/calibre-web，各种定制性还是令人省心不少。</p>\n<h1 id=\"支持豆瓣\"><a href=\"#支持豆瓣\" class=\"headerlink\" title=\"支持豆瓣\"></a>支持豆瓣</h1><p>豆瓣已经在2020年8月无情地关闭了书籍元数据下载功能（俗称刮削）。网上搜到的大多是无效的解答，例如：“<a href=\"https://blog.csdn.net/wangrui1573/article/details/111880264\">calibre-web 获取元数据 豆瓣API失效解决办法_瑞哥的博客-CSDN博客_calibre 元数据</a>”。<br>最新（2021年9月）亲测可用的办法是使用这个docker镜像服务：<a href=\"https://github.com/fugary/simple-boot-douban-api\">fugary/simple-boot-douban-api: Simple douban book api</a>。具体方法也很简单，在群晖上下载好docker，并启动，然后再修改代码，重启Calibre-web docker镜像即可：<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /calibre-web/app/cps/<span class=\"built_in\">static</span>/js/get_meta.js</span><br><span class=\"line\"><span class=\"comment\"># 找到 var douban = &quot;https://api.douban.com&quot;; 替换成自己的NAS_IP地址</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> douban = <span class=\"string\">&quot;http://NAS_IP:8085&quot;</span>;</span><br></pre></td></tr></table></figure><br>成功示例：<br><img src=\"/2021/09/25/obsidian_posts/%E7%BE%A4%E6%99%96%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%94%B5%E5%AD%90%E4%B9%A6%E5%9B%BE%E4%B9%A6%E9%A6%86/Pasted%20image%2020210926070735.png\" alt></p>\n<p>另外值得一提的是，calibre-web集成的Google books搜索，在客户端（非NAS端）科学上网的情况下，就可以获取数据。针对日常刮削场景多一个选择总归是好的。<br><img src=\"/2021/09/25/obsidian_posts/%E7%BE%A4%E6%99%96%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%94%B5%E5%AD%90%E4%B9%A6%E5%9B%BE%E4%B9%A6%E9%A6%86/Pasted%20image%2020210926071201.png\" alt></p>\n<h1 id=\"批量导入\"><a href=\"#批量导入\" class=\"headerlink\" title=\"批量导入\"></a>批量导入</h1><p>可以参考这一篇“<a href=\"https://blog.einverne.info/post/2020/02/qnap-calibre-web.html\">威联通折腾篇十九：Calibre-web | Verne in GitHub</a>”。其实就是会用这个命令就可以了：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">calibredb add --library-path=/books -r /path/to/your/book_dir_you_want_to_add</span><br></pre></td></tr></table></figure><br>calibredb还有很多其他功能，看帮助文档就好了，简单易学：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Usage: calibredb command [options] [arguments]</span><br><span class=\"line\"></span><br><span class=\"line\">calibredb is the command line interface to the calibre books database.</span><br><span class=\"line\"></span><br><span class=\"line\">command is one of:</span><br><span class=\"line\">  list</span><br><span class=\"line\">  add</span><br><span class=\"line\">  remove</span><br><span class=\"line\">  add_format</span><br><span class=\"line\">  remove_format</span><br><span class=\"line\">  show_metadata</span><br><span class=\"line\">  set_metadata</span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<h1 id=\"SSL-setting\"><a href=\"#SSL-setting\" class=\"headerlink\" title=\"SSL setting\"></a>SSL setting</h1><p>如果需要通过https访问calibre-web网页，建议通过群晖反向代理设置。只要配置好证书，就可以访问。不要轻易碰下面的配置。<br><img src=\"/2021/09/25/obsidian_posts/%E7%BE%A4%E6%99%96%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%94%B5%E5%AD%90%E4%B9%A6%E5%9B%BE%E4%B9%A6%E9%A6%86/Pasted%20image%2020210928222325.png\" alt><br>如果一定需要，请参考<a href=\"https://github.com/Technosoft2000/docker-calibre-web/issues/98\">SSL setting · Issue #98 · Technosoft2000/docker-calibre-web · GitHub</a>。<br>我就是误配置，导致页面显示ERR_EMPTY_RESPONSE。最后需要将书库中的这几个文件删除，才能打开网页。</p>\n<ul>\n<li>app.db</li>\n<li>gdrive.db</li>\n</ul>\n<p>具体原因不详。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><ul>\n<li>建议选择technosoft2000/calibre-web镜像</li>\n<li>建议使用fugary/simple-boot-douban-api取代豆瓣API刮削</li>\n</ul>\n",
            "tags": [
                "群晖",
                "Calibre",
                "电子书"
            ]
        }
    ]
}