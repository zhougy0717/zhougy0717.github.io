<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>Big Ben • Posts by &#34;glibc&#34; tag</title>
        <link>https://blog.zhougy.top</link>
        <description></description>
        <language>en</language>
        <pubDate>Sun, 03 Feb 2019 20:00:24 +0800</pubDate>
        <lastBuildDate>Sun, 03 Feb 2019 20:00:24 +0800</lastBuildDate>
        <category>javascript</category>
        <category>angular</category>
        <category>操作系统</category>
        <category>arm</category>
        <category>单片机</category>
        <category>machine learning</category>
        <category>deep learning</category>
        <category>Linux</category>
        <category>内存管理</category>
        <category>Markdown</category>
        <category>python</category>
        <category>win32com</category>
        <category>nas</category>
        <category>synology</category>
        <category>USB</category>
        <category>Linux Device Drivers</category>
        <category>uboot</category>
        <category>http</category>
        <category>同步</category>
        <category>算法</category>
        <category>读书笔记</category>
        <category>程序员修炼之道</category>
        <category>c/c++</category>
        <category>capability</category>
        <category>LD_PRELOAD</category>
        <category>UT</category>
        <category>TDD</category>
        <category>C++</category>
        <category>coding</category>
        <category>SELinux</category>
        <category>hexo</category>
        <category>印象笔记</category>
        <category>Obsidian</category>
        <category>Android</category>
        <category>xposed</category>
        <category>GitHub</category>
        <category>中断处理</category>
        <category>群晖</category>
        <category>docker</category>
        <category>ttrss</category>
        <category>rsshub</category>
        <category>wallabag</category>
        <category>unittest</category>
        <category>mockito</category>
        <category>powermock</category>
        <category>QT</category>
        <category>nlp</category>
        <category>vim</category>
        <category>SpaceVim</category>
        <category>tmux</category>
        <category>面向对象</category>
        <category>promise</category>
        <category>mongodb</category>
        <category>Programming</category>
        <category>security</category>
        <category>C++11</category>
        <category>IoT</category>
        <category>broadlink</category>
        <category>domoticz</category>
        <category>UML</category>
        <category>socket</category>
        <category>iptables</category>
        <category>neural network</category>
        <category>mock</category>
        <category>深度学习</category>
        <category>schedule algorithm</category>
        <category>glibc</category>
        <category>gtest</category>
        <category>gmock</category>
        <category>golang</category>
        <category>elf</category>
        <category>软件开发</category>
        <category>设计模式</category>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2019/02/03/PIP%E5%9C%A8Linux+glibc%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/</guid>
            <title>PIP在Linux+glibc中的实现</title>
            <link>https://blog.zhougy.top/2019/02/03/PIP%E5%9C%A8Linux+glibc%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/</link>
            <category>Linux</category>
            <category>schedule algorithm</category>
            <category>glibc</category>
            <pubDate>Sun, 03 Feb 2019 20:00:24 +0800</pubDate>
            <description><![CDATA[ &lt;div style=&#34;font-size: 14px; margin: 0; padding: 0; width: 100%;&#34;&gt;&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53CD;&amp;#x8F6C;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53CD;&amp;#x8F6C;&amp;#x6307;&amp;#x4E00;&amp;#x4E2A;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x4EFB;&amp;#x52A1;&amp;#x56E0;&amp;#x4E3A;&amp;#x8D44;&amp;#x6E90;&amp;#x88AB;&amp;#x4F4E;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x4EFB;&amp;#x52A1;&amp;#x5360;&amp;#x7528;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x5F97;&amp;#x4E0D;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x672C;&amp;#x8EAB;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53CD;&amp;#x8F6C;&amp;#x5E26;&amp;#x6765;&amp;#x6700;&amp;#x76F4;&amp;#x63A5;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x5C31;&amp;#x662F;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53EF;&amp;#x80FD;&amp;#x56E0;&amp;#x4E3A;&amp;#x8FD9;&amp;#x6B21;&amp;#x963B;&amp;#x585E;&amp;#xFF0C;&amp;#x800C;&amp;#x65E0;&amp;#x6CD5;&amp;#x786E;&amp;#x5B9A;&amp;#x963B;&amp;#x585E;&amp;#x65F6;&amp;#x5EF6;&amp;#x3002;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#x3002;&lt;br&gt;

        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1547609810638.png&#34; hash=&#34;8df099f053cbeaee4881a9d6ffc8963f&#34; align alt longdesc width=&#34;765&#34; height=&#34;210&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Task 9&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x8F83;&amp;#x4F4E;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5F88;&amp;#x5BB9;&amp;#x6613;&amp;#x88AB;&amp;#x5176;&amp;#x4ED6;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7684;&amp;#x4EFB;&amp;#x52A1;&amp;#x62A2;&amp;#x5360;&amp;#x8FD0;&amp;#x884C;&amp;#xFF0C;&amp;#x5BFC;&amp;#x81F4;&amp;#x5BF9;&amp;#x8D44;&amp;#x6E90;S&amp;#x7684;&amp;#x9501;&amp;#x65E0;&amp;#x6CD5;&amp;#x91CA;&amp;#x653E;&amp;#xFF0C;&amp;#x800C;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7684;&amp;#x4EFB;&amp;#x52A1;&amp;#x56E0;&amp;#x4E3A;&amp;#x8981;&amp;#x6301;&amp;#x6709;&amp;#x8BE5;&amp;#x9501;&amp;#xFF0C;&amp;#x4E0D;&amp;#x5F97;&amp;#x4E0D;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&lt;/p&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Priority Inheritance Protocol&amp;#x7FFB;&amp;#x8BD1;&amp;#x4E3A;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#xFF0C;&amp;#x7B80;&amp;#x79F0;PIP&amp;#x3002;&amp;#x8FD9;&amp;#x662F;&amp;#x89E3;&amp;#x51B3;&amp;#x4E0A;&amp;#x8FF0;Unbounded inversion&amp;#x6700;&amp;#x76F4;&amp;#x63A5;&amp;#x7684;&amp;#x529E;&amp;#x6CD5;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;&amp;#x5360;&amp;#x6709;&amp;#x9501;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x8C03;&amp;#x6574;&amp;#x5230;&amp;#x5728;&amp;#x7B49;&amp;#x5F85;&amp;#x7684;&amp;#x4EFB;&amp;#x52A1;&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x503C;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7B97;&amp;#x6CD5;&amp;#x662F;&amp;#x8D2A;&amp;#x5A6A;&amp;#x7684;&amp;#xFF0C;&amp;#x5C40;&amp;#x90E8;&amp;#x6700;&amp;#x4F18;&amp;#xFF0C;&amp;#x4F46;&amp;#x4E0D;&amp;#x662F;&amp;#x6574;&amp;#x4F53;&amp;#x6700;&amp;#x4F18;&amp;#x89E3;&amp;#xFF0C;&amp;#x5728;&amp;#x6B64;&amp;#x4E4B;&amp;#x4E0A;&amp;#x53C8;&amp;#x6709;PCP(&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x5929;&amp;#x82B1;&amp;#x677F;)&amp;#x548C;SRP(&amp;#x57FA;&amp;#x4E8E;&amp;#x6808;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#x7B56;&amp;#x7565;)&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E0D;&amp;#x505A;&amp;#x8BA8;&amp;#x8BBA;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECE;&amp;#x6E90;&amp;#x7801;&amp;#x7684;&amp;#x89D2;&amp;#x5EA6;&amp;#xFF0C;&amp;#x9610;&amp;#x8FF0;PIP&amp;#x5728;Linux&amp;#x548C;glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&lt;/p&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;Overview&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549009792507.png&#34; hash=&#34;b16f478e9d2cf9485b4b8bba9e81e3b0&#34; align alt longdesc width=&#34;719&#34; height=&#34;287&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Linux&amp;#x4E0B;&amp;#x7684;PIP&amp;#x5B9E;&amp;#x73B0;&amp;#x5206;&amp;#x6210;&amp;#x4EE5;&amp;#x4E0A;3&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;glibc&amp;#x4E2D;&amp;#x7684;pthread_mutex_lock&amp;#x63D0;&amp;#x4F9B;&amp;#x7528;&amp;#x6237;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;FUTEX_LOCK_PI&amp;#x5B9E;&amp;#x73B0;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x8C03;&amp;#x6574;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;Linux&amp;#x7684;futex&amp;#x90E8;&amp;#x5206;&amp;#x63D0;&amp;#x4F9B;FUTEX_LOCK_PI&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x6700;&amp;#x7EC8;&amp;#x7684;&amp;#x9501;&amp;#x673A;&amp;#x5236;&amp;#x901A;&amp;#x8FC7;rt_mutex&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;pthread_mutex&lt;/h2&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;Types&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;pthread mutex&amp;#x662F;POSIX pthread&amp;#x5E93;&amp;#x4E2D;&amp;#x5B9A;&amp;#x4E49;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;&amp;#x9501;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4E0E;&amp;#x4FE1;&amp;#x53F7;&amp;#x91CF;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x9501;&amp;#x53EA;&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x72B6;&amp;#x6001;&amp;#xFF1A;locked&amp;#x6216;unlocked&amp;#x3002;&amp;#x4E0E;binary semaphore&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;mutex&amp;#x53EA;&amp;#x80FD;&amp;#x88AB;lock&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;unlock&amp;#xFF0C;&amp;#x5373;&amp;#x53EA;&amp;#x80FD;&amp;#x88AB;mutex owner unlock&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x76EE;&amp;#x524D;&lt;a href=&#34;http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;POSIX&amp;#x6807;&amp;#x51C6;(1003.1-2008)&lt;/a&gt;&amp;#x4E2D;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E86;4&amp;#x79CD;&amp;#x7C7B;&amp;#x578B;&amp;#x7684;mutex:&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_NORMAL&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_ERRORCHECK&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_RECURSIVE&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_DEFAULT&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;4&amp;#x79CD;mutex&amp;#x4E0D;&amp;#x540C;&amp;#x4E4B;&amp;#x5904;&amp;#x5982;&amp;#x4E0B;&lt;/p&gt;
&lt;table style=&#34;margin: 2px 0 14px; color: #333; width: auto; border-collapse: collapse; box-sizing: border-box;&#34;&gt;&lt;thead style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;th style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;&#34;&gt;&lt;/th&gt;&lt;th style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;&#34;&gt;attempting to relock this mutex without first unlocking&lt;/th&gt;&lt;th style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;&#34;&gt;Attempting to unlock a mutex locked by a different thread&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;NORMAL&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;deadlock&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;undefined&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;ERRORCHECK&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;return error -EDEADLOCK&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;return error&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;RECURSIVE&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;succeed in locking&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;return error&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;DEFAULT&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;undefined&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;undefined&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;glibc&amp;#x5BF9;&amp;#x4E0A;&amp;#x8FF0;4&amp;#x79CD;&amp;#x7C7B;&amp;#x578B;&amp;#x7684;mutex&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;&amp;#x6269;&amp;#x5C55;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_RECURSIVE_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ERRORCHECK_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_NORMAL_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ADAPTIVE_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_RECURSIVE_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_ERRORCHECK_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_NORMAL_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_ADAPTIVE_NP:
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4E3B;&amp;#x8981;&amp;#x591A;&amp;#x4E86;&amp;#x8FD9;3&amp;#x79CD;&amp;#x5C5E;&amp;#x6027;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;ADAPTIVE&amp;#xFF1A;&amp;#x5728;SMP&amp;#x67B6;&amp;#x6784;&amp;#x4E0B;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x76F4;&amp;#x63A5;&amp;#x8FDB;&amp;#x5165;wait&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x5148;&amp;#x8C03;&amp;#x7528;spinlock&amp;#x7B49;&amp;#x5F85;&amp;#x4E00;&amp;#x5C0F;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;musl&amp;#x91CC;&amp;#x9ED8;&amp;#x8BA4;&amp;#x90FD;&amp;#x91C7;&amp;#x7528;&amp;#x4E86;&amp;#x8FD9;&amp;#x79CD;&amp;#x5B9E;&amp;#x73B0;&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;PI&amp;#xFF1A;&amp;#x5305;&amp;#x542B;&amp;#x8BE5;&amp;#x5C5E;&amp;#x6027;&amp;#x7684;mutex&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;(Priority Inheritance, PI)&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;ROBUST&amp;#xFF1A;&amp;#x82E5;&amp;#x7EBF;&amp;#x7A0B;&amp;#x9000;&amp;#x51FA;&amp;#x65F6;&amp;#x672A;&amp;#x91CA;&amp;#x653E;&amp;#x9501;&amp;#xFF0C;&amp;#x5219;&amp;#x4EE5;&amp;#x540E;&amp;#x5BF9;&amp;#x8BE5;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;&amp;#x90FD;&amp;#x4F1A;&amp;#x8FD4;&amp;#x56DE;-EOWNERDEAD&amp;#xFF0C;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x662F;PTHREAD_MUTEX_STALLED(&amp;#x8FD9;&amp;#x662F;&amp;#x9ED8;&amp;#x8BA4;&amp;#x914D;&amp;#x7F6E;)&amp;#xFF0C;&amp;#x5BF9;&amp;#x8BE5;&amp;#x5F02;&amp;#x5E38;&amp;#x9501;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x4F1A;&amp;#x51FA;&amp;#x73B0;undefined&amp;#x884C;&amp;#x4E3A;&amp;#x3002;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x518D;&amp;#x4E0E;&amp;#x539F;&amp;#x5148;&amp;#x7684;4&amp;#x79CD;&amp;#x5C5E;&amp;#x6027;&amp;#x8FDB;&amp;#x884C;&amp;#x6392;&amp;#x5217;&amp;#x7EC4;&amp;#x5408;&amp;#x3002;&lt;/p&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0;&#34;&gt;&lt;strong style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700;&#34;&gt;&amp;quot;_NP&amp;quot; suffix&lt;/strong&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Note: the _NP suffix indicates a non-portable extension to the POSIX specification. In fact the latest specification, 1003.1-2008 [&lt;a href=&#34;http://2net.co.uk/tutorial/mutex_mutandis#ref_2&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;2]&lt;/a&gt;, includes most of the Linux additions so you can leave the _NP ending off. I have chosen not to because some older versions of the header files only have the _NP variants.&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-bottom: 0;&#34;&gt;&amp;#x6839;&amp;#x636E;&amp;#x6700;&amp;#x65B0;&amp;#x7684;POSIX&amp;#x6807;&amp;#x51C6;1003.1-2008&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6269;&amp;#x5C55;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x52A0;&amp;#x5165;&amp;#x3002;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x672C;&amp;#x6587;&amp;#x53EA;&amp;#x5173;&amp;#x6CE8;MUTEX_PI&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&lt;/p&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;PTHREAD_MUTEX_PI&lt;/h3&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;pthread_mutex_lock&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x91CD;&amp;#x8981;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt;
&amp;#123;
  &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; __&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pthread_mutex_s&lt;/span&gt; __&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;data&lt;/span&gt;;&lt;/span&gt;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;char&lt;/span&gt; __size[__SIZEOF_PTHREAD_MUTEX_T];
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __align;
&amp;#125; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;pthread_mutex_t&lt;/span&gt;;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; __&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pthread_mutex_s&lt;/span&gt;
&amp;#123;&lt;/span&gt;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __lock __LOCK_ALIGNMENT;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __count;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __owner;
  ...
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x8003;&amp;#x8651;ROBUST&amp;#x60C5;&amp;#x51B5;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x9488;&amp;#x5BF9;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;PI&amp;#x5C5E;&amp;#x6027;&amp;#x7684;pthread_mutex_lock&amp;#x64CD;&amp;#x4F5C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;

        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549014356838.png&#34; hash=&#34;36c67b688ae44843223a576d9cc0be30&#34; align alt longdesc width=&#34;599&#34; height=&#34;632&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0;&#34;&gt;&lt;strong style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700;&#34;&gt;atomic_compare_and_exchange_val_acq&lt;/strong&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5148;&amp;#x6BD4;&amp;#x8F83;&amp;#x518D;&amp;#x8D4B;&amp;#x503C;&amp;#xFF0C;&amp;#x4F2A;&amp;#x4EE3;&amp;#x7801;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;compare_and_swap&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt;* reg, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; oldval, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; newval)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
    ATOMIC();
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; old_reg_val = *reg;
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (old_reg_val == oldval)
      *reg = newval;
    END_ATOMIC();
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;return&lt;/span&gt; old_reg_val;
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x9488;&amp;#x5BF9;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;oldval == 0&lt;/code&gt;: &amp;#x8868;&amp;#x793A;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;mutex-&amp;gt;__data.__lock == 0&lt;/code&gt;&amp;#xFF0C;&amp;#x5373;&amp;#x8BE5;lock&amp;#x65E0;owner&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x83B7;&amp;#x5F97;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;oldval != 0&lt;/code&gt;: &amp;#x8868;&amp;#x793A;&amp;#x8BE5;mutex&amp;#x88AB;lock&amp;#x4E86;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x5165;kernel&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x9501;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;pthread_mutex_lock&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x6BD4;&amp;#x8F83;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x4E00;&amp;#x4E2A;&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&amp;#x5224;&amp;#x65AD;&amp;#x9501;&amp;#x662F;&amp;#x5426;&amp;#x5DF2;&amp;#x7ECF;&amp;#x88AB;&amp;#x9501;&amp;#x4F4F;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x9501;&amp;#x4F4F;&amp;#x5C31;&amp;#x66F4;&amp;#x65B0;owner&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;user&amp;#x8BA1;&amp;#x6570;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x5DF2;&amp;#x7ECF;&amp;#x88AB;&amp;#x9501;&amp;#x4F4F;&amp;#xFF0C;&amp;#x5219;&amp;#x9677;&amp;#x5165;&amp;#x5185;&amp;#x6838;&amp;#x8C03;&amp;#x7528;FUTEX_LOCK_PI&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x5B8C;&amp;#x6210;&amp;#x4E0A;&amp;#x9501;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;pthread_mutex_unlock&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x63A5;&amp;#x53E3;&amp;#x57FA;&amp;#x672C;&amp;#x4E0A;&amp;#x5C31;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x8C03;&amp;#x7528;futex_unlock_pi SYSCALL&amp;#x6765;&amp;#x5B8C;&amp;#x6210;&amp;#x5DE5;&amp;#x4F5C;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;      &lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/* Unlock the mutex using a CAS unless there are futex waiters or our
&amp;#x203A;    TID is not the value of __lock anymore, in which case we let the
&amp;#x203A;    kernel take care of the situation.  Use release MO in the CAS to
&amp;#x203A;    synchronize with acquire MO in lock acquisitions.  */&lt;/span&gt;
      &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; l = atomic_load_relaxed (&amp;amp;mutex-&amp;gt;__data.__lock);
      &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;do&lt;/span&gt;
&amp;#x203A;   &amp;#123;
&amp;#x203A;     &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (((l &amp;amp; FUTEX_WAITERS) != &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;)
&amp;#x203A;         || (l != THREAD_GETMEM (THREAD_SELF, tid)))
&amp;#x203A;       &amp;#123;
&amp;#x203A;         INTERNAL_SYSCALL_DECL (__err);
&amp;#x203A;         INTERNAL_SYSCALL (futex, __err, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;2&lt;/span&gt;, &amp;amp;mutex-&amp;gt;__data.__lock,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   __lll_private_flag (FUTEX_UNLOCK_PI, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;private&lt;/span&gt;));
&amp;#x203A;         &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;break&lt;/span&gt;;
&amp;#x203A;       &amp;#125;
&amp;#x203A;   &amp;#125;
      &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;while&lt;/span&gt; (!atomic_compare_exchange_weak_release (&amp;amp;mutex-&amp;gt;__data.__lock,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;       &amp;amp;l, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;));
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;futex&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;futex&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x5185;&amp;#x6838;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x7B49;&amp;#x5F85;&amp;#x67D0;&amp;#x4E2A;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x6570;&amp;#x636E;&amp;#x88AB;&amp;#x8BBE;&amp;#x7F6E;&amp;#x6210;&amp;#x67D0;&amp;#x4E2A;&amp;#x503C;&amp;#x3002;&amp;#x9488;&amp;#x5BF9;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;futex&amp;#x7565;&amp;#x6709;&amp;#x4E0D;&amp;#x540C;&amp;#x3002;&amp;#x5B83;&amp;#x4E0D;&amp;#x518D;&amp;#x7B49;&amp;#x5F85;&amp;#x7528;&amp;#x6237;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x4E0A;&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x5185;&amp;#x6838;rt_mutex&amp;#x673A;&amp;#x5236;&amp;#x5B9E;&amp;#x73B0;&amp;#x7B49;&amp;#x5F85;&amp;#xFF0C;&amp;#x4E0A;&amp;#x9501;&amp;#x548C;&amp;#x89E3;&amp;#x9501;&amp;#x7684;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&amp;#x770B;&amp;#x4E0B;&amp;#x9762;glibc&amp;#x548C;Linux&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#x5BF9;&amp;#x63A5;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;// glibc: pthread_mutex_lock.c&lt;/span&gt;
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; e = INTERNAL_SYSCALL (futex, __err, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;4&lt;/span&gt;, &amp;amp;mutex-&amp;gt;__data.__lock,
&amp;#x203A;   &amp;#x203A;         __lll_private_flag (FUTEX_LOCK_PI,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;     &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;private&lt;/span&gt;), &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;);

&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;// Linux: futex.c&lt;/span&gt;
&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;do_futex&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(u32 __user *uaddr, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; op, u32 val, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;ktime_t&lt;/span&gt; *timeout,
&amp;#x203A;   &amp;#x203A;   u32 __user *uaddr2, u32 val2, u32 val3)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
...
	&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; FUTEX_LOCK_PI:
&amp;#x203A;   	&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;return&lt;/span&gt; futex_lock_pi(uaddr, flags, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;NULL&lt;/span&gt;, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;1&lt;/span&gt;);    
... 
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x53EF;&amp;#x89C1;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;uaddr = &amp;amp;mutex-&amp;gt;__data.__lock&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;flags = __lll_private_flag (FUTEX_LOCK_PI, private)&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;val = 1, timeout = NULL&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;&amp;#x5173;&amp;#x4E8E;lock/unlock&amp;#x7684;&amp;#x53D9;&amp;#x8FF0;&amp;#x4F1A;&amp;#x7B80;&amp;#x5316;&amp;#x6389;time&amp;#x76F8;&amp;#x5173;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;PI&amp;#x65E0;&amp;#x5173;&amp;#x7684;ROBUST&amp;#x7B49;&amp;#x7279;&amp;#x6027;&amp;#x3002;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;&amp;#x91CD;&amp;#x8981;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&lt;/h3&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
 * Hash buckets are shared by all the futex_keys that hash to the same
 * location.  Each key may have multiple futex_q structures, one for each task
 * waiting on a futex.
 */&lt;/span&gt;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_hash_bucket&lt;/span&gt; &amp;#123;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;atomic_t&lt;/span&gt; waiters;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;spinlock_t&lt;/span&gt; lock;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;plist_head&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;chain&lt;/span&gt;;&lt;/span&gt;
&amp;#125; ____cacheline_aligned_in_smp;

&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/**
 * struct futex_q - The hashed futex queue entry, one per waiting task
 * @list:&amp;#x203A;  &amp;#x203A;   priority-sorted list of tasks waiting on this futex
 * @task:&amp;#x203A;  &amp;#x203A;   the task waiting on the futex
 * @lock_ptr:&amp;#x203A;  &amp;#x203A;   the hash bucket lock
 * @key:&amp;#x203A;   &amp;#x203A;   the key the futex is hashed on
 * @pi_state:&amp;#x203A;  &amp;#x203A;   optional priority inheritance state
 * @rt_waiter:&amp;#x203A; &amp;#x203A;   rt_waiter storage for use with requeue_pi
 * @requeue_pi_key:&amp;#x203A;the requeue_pi target futex key
 * @bitset:&amp;#x203A;&amp;#x203A;   bitset for the optional bitmasked wakeup
 *
 * We use this hashed waitqueue, instead of a normal wait_queue_entry_t, so
 * we can wake only the relevant ones (hashed queues may be shared).
 *
 * A futex_q has a woken state, just like tasks have TASK_RUNNING.
 * It is considered woken when plist_node_empty(&amp;amp;q-&amp;gt;list) || q-&amp;gt;lock_ptr == 0.
 * The order of wakeup is always to make the first condition true, then
 * the second.
 *
 * PI futexes are typically woken before they are removed from the hash list via
 * the rt_mutex code. See unqueue_me_pi().
 */&lt;/span&gt;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_q&lt;/span&gt; &amp;#123;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;plist_node&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;list&lt;/span&gt;;&lt;/span&gt;

&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;task_struct&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;task&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;spinlock_t&lt;/span&gt; *lock_ptr;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt; futex_key key;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_pi_state&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pi_state&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;rt_mutex_waiter&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;rt_waiter&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt; futex_key *requeue_pi_key;
&amp;#x203A;   u32 &lt;span style=&#34;color: #4ec9b0; line-height: 160%; box-sizing: content-box;&#34;&gt;bitset&lt;/span&gt;;
&amp;#125; __randomize_layout;

&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
 * Priority Inheritance state:
 */&lt;/span&gt;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_pi_state&lt;/span&gt; &amp;#123;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
&amp;#x203A;    * list of &amp;apos;owned&amp;apos; pi_state instances - these have to be
&amp;#x203A;    * cleaned up in do_exit() if the task exits prematurely:
&amp;#x203A;    */&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;list_head&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;list&lt;/span&gt;;&lt;/span&gt;

&amp;#x203A;   &lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
&amp;#x203A;    * The PI object:
&amp;#x203A;    */&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;rt_mutex&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pi_mutex&lt;/span&gt;;&lt;/span&gt;

&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;task_struct&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;owner&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;atomic_t&lt;/span&gt; refcount;

&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt; futex_key key;
&amp;#125; __randomize_layout;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_hash_bucket&lt;/code&gt;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E00;&amp;#x4E2A;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;uaddr&lt;/code&gt;&amp;#x3002;&amp;#x901A;&amp;#x8FC7;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x4F20;&amp;#x5165;&amp;#x7684;uaddr&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;futex&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&amp;#x7528;hash&amp;#x7684;&amp;#x539F;&amp;#x56E0;&amp;#x662F;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x662F;uaddr&amp;#x5730;&amp;#x5740;&amp;#x503C;&amp;#xFF0C;&amp;#x6570;&amp;#x5B57;&amp;#x5F88;&amp;#x5927;&amp;#xFF0C;&amp;#x5206;&amp;#x5E03;&amp;#x5F88;&amp;#x6563;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x7528;hash&amp;#x53EF;&amp;#x4EE5;&amp;#x6709;&amp;#x6548;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_q&lt;/code&gt;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E34;&amp;#x65F6;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;futex&amp;#x7684;waiter&amp;#x7EBF;&amp;#x7A0B;&amp;#x3002;&amp;#x5B83;&amp;#x901A;&amp;#x5E38;&amp;#x88AB;&amp;#x7528;&amp;#x6765;&amp;#x4F20;&amp;#x9012;&amp;#x5404;&amp;#x79CD;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;pi_state&lt;/code&gt;&amp;#x662F;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;task_struct&lt;/code&gt;&amp;#x5185;&amp;#x90E8;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_lock_pi&lt;/code&gt;&amp;#x8C03;&amp;#x7528;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;refill_pi_state_cache&lt;/code&gt;&amp;#x91CC;&amp;#x9762;&amp;#x505A;&amp;#x5206;&amp;#x914D;&amp;#x3002;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;refill_pi_state_cache&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;void&lt;/span&gt;)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
...
	pi_state = kzalloc(&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;sizeof&lt;/span&gt;(*pi_state), GFP_KERNEL);
    current-&amp;gt;pi_state_cache = pi_state;
...
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;futex_lock_pi&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8FD8;&amp;#x662F;&amp;#x6BD4;&amp;#x8F83;&amp;#x76F4;&amp;#x7EBF;&amp;#x7684;&amp;#xFF0C;&amp;#x540C;&amp;#x5927;&amp;#x591A;&amp;#x6570;&amp;#x9501;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x5148;&amp;#x5C1D;&amp;#x8BD5;&amp;#x539F;&amp;#x5B50;&amp;#x9501;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x884C;&amp;#xFF0C;&amp;#x5219;&amp;#x8C03;&amp;#x7528;rt_mutex&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;&amp;#x4EE5;&amp;#x4E0B;&amp;#x6361;&amp;#x53D6;&amp;#x6BD4;&amp;#x8F83;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#x505A;&amp;#x9610;&amp;#x8FF0;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;[3], [4]&amp;#x4E2D;&amp;#x7684;&amp;#x63CF;&amp;#x8FF0;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;queue_lock, queue_unlock&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5BF9;hash_bucket&amp;#x8FDB;&amp;#x884C;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x4ED6;&amp;#x4EEC;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x662F;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;hash_bucket&lt;/code&gt;&amp;#x4E0B;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;lock&lt;/code&gt;&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x4E5F;&amp;#x662F;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_q&lt;/code&gt;&amp;#x4E0B;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;lock_ptr&lt;/code&gt;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x9501;&amp;#x7684;&amp;#x51FA;&amp;#x73B0;&amp;#x6BD4;&amp;#x8F83;&amp;#x6DF7;&amp;#x4E71;&amp;#xFF0C;&amp;#x6709;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x6709;&amp;#x65F6;&amp;#x76F4;&amp;#x63A5;&amp;#x5BF9;lock&amp;#x6307;&amp;#x9488;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x9700;&amp;#x8981;&amp;#x5C0F;&amp;#x5FC3;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;__queue_me, unqueue_me&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C06;&amp;#x7533;&amp;#x8BF7;futex&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5728;hash_bucket&amp;#x7684;chain&amp;#x4E0A;&amp;#x505A;&amp;#x6DFB;&amp;#x52A0;&amp;#x6216;&amp;#x79FB;&amp;#x9664;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x8FD8;&amp;#x4F1A;&amp;#x6D89;&amp;#x53CA;&amp;#x9501;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4EE5;&amp;#x4E0A;4&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x66F4;&amp;#x591A;&amp;#x7684;&amp;#x4E0E;futex&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x76F8;&amp;#x5173;&amp;#xFF0C;&amp;#x4E0E;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x5E76;&amp;#x65E0;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x7565;&amp;#x8FC7;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;futex_lock_pi_atomic&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549076735129.png&#34; hash=&#34;8f64be7a14c9e36fb86aff8b54e61062&#34; align alt longdesc width=&#34;783&#34; height=&#34;523&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&amp;#x6765;&amp;#x8BF7;&amp;#x6C42;&amp;#x9501;&amp;#xFF0C;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x5982;&amp;#x679C;futex&amp;#x6CA1;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5219;&amp;#x76F4;&amp;#x63A5;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#x5E76;&amp;#x8FD4;&amp;#x56DE;1&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6210;&amp;#x529F;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF0C;&amp;#x8868;&amp;#x793A;ready to wait&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x662F;&amp;#x4F1A;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x4E0E;PI&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x6709;waiter&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x8C03;&amp;#x7528;attach_to_pi_state&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x8BE5;top_waiter&amp;#x7684;pi_state&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x6CA1;&amp;#x6709;waiter&amp;#x7684;&amp;#x60C5;&amp;#x51B5;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x8C03;&amp;#x7528;attach_to_pi_owner&amp;#x6765;&amp;#x53D6;&amp;#x7528;&amp;#x672C;&amp;#x7EBF;&amp;#x7A0B;&amp;#x91CC;&amp;#x5206;&amp;#x914D;&amp;#x7684;pi_state&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&amp;#x5E76;&amp;#x66F4;&amp;#x65B0;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;queue&amp;#x5230;hash_bucket&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x4E2D;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;rt_mutex&amp;#x63A5;&amp;#x53E3;&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;futex_lock_pi&amp;#x4E2D;&amp;#x4F7F;&amp;#x7528;&amp;#x5230;&amp;#x5982;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E9B;rt_mutex&amp;#x63A5;&amp;#x53E3;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;rt_mutex_init_waiter&amp;#xFF1A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;waiter&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EA2;&amp;#x9ED1;&amp;#x6811;&amp;#x7684;&amp;#x8282;&amp;#x70B9;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;waiter&amp;#x5BF9;&amp;#x5E94;&amp;#x5F53;&amp;#x524D;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5E76;&amp;#x53CD;&amp;#x6620;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5728;&amp;#x67D0;&amp;#x4E2A;&amp;#x9501;&amp;#x4E0A;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;__rt_mutex_start_proxy_lock&amp;#xFF1A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x662F;PI&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x7528;&amp;#x6765;&amp;#x5BF9;&amp;#x5404;waiters&amp;#x6570;&amp;#x636E;&amp;#x8FDB;&amp;#x884C;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x904D;&amp;#x5386;lock&amp;#x94FE;&amp;#x6765;&amp;#x68C0;&amp;#x67E5;&amp;#x6B7B;&amp;#x9501;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E0E;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x539F;&amp;#x5B50;&amp;#x68C0;&amp;#x67E5;&amp;#x7C7B;&amp;#x4F3C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD4;&amp;#x56DE;1&amp;#x8868;&amp;#x793A;&amp;#x5DF2;&amp;#x7ECF;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF0C;&amp;#x5219;ready to wait&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;rt_mutex_wait_proxy_lock&amp;#xFF1A;&amp;#x901A;&amp;#x8FC7;__rt_mutex_start_proxy_lock&amp;#x5904;&amp;#x7406;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#xFF0C;&amp;#x90A3;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5F00;&amp;#x59CB;&amp;#x7B49;&amp;#x5F85;&amp;#x4E86;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5C06;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5207;&amp;#x6362;&amp;#x4E3A;TASK_INTERRUPTIBLE&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x5E76;&amp;#x5F00;&amp;#x59CB;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&amp;#x8FD9;&amp;#x5176;&amp;#x95F4;&amp;#x4F1A;&amp;#x5904;&amp;#x7406;&amp;#x57FA;&amp;#x4E8E;&amp;#x65F6;&amp;#x95F4;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#xFF0C;&amp;#x4E14;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;&amp;#x8C03;&amp;#x5EA6;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;rt_mutex_cleanup_proxy_lock&amp;#xFF1A;&amp;#x73B0;&amp;#x5728;&amp;#x5DF2;&amp;#x7ECF;&amp;#x963B;&amp;#x585E;&amp;#x7ED3;&amp;#x675F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD8;&amp;#x6CA1;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#xFF0C;&amp;#x8981;&amp;#x4E48;&amp;#x662F;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&amp;#x8981;&amp;#x4E48;&amp;#x662F;&amp;#x51FA;&amp;#x9519;&amp;#xFF0C;&amp;#x603B;&amp;#x4E4B;&amp;#x8981;&amp;#x5C06;&amp;#x672C;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4ECE;waiters&amp;#x4E2D;&amp;#x79FB;&amp;#x9664;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x662F;&amp;#x8D77;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4F5C;&amp;#x7528;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;fixup_owner&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4ECE;&amp;#x6CE8;&amp;#x91CA;&amp;#x4E0A;&amp;#x770B;&amp;#xFF0C;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x5904;&amp;#x7406;lock steal&amp;#x3002;&amp;#x800C;lock steal&amp;#x4F3C;&amp;#x4E4E;&amp;#x591A;&amp;#x53D1;&amp;#x751F;&amp;#x5728;futex requeue&amp;#x64CD;&amp;#x4F5C;&amp;#x4E0A;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x5C1A;&amp;#x672A;&amp;#x4ED4;&amp;#x7EC6;&amp;#x7814;&amp;#x7A76;&amp;#x3002;&lt;/p&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;futex_unlock_pi&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;futex_unlock_pi&amp;#x91CA;&amp;#x653E;futex&amp;#x4EE5;&amp;#x53CA;&amp;#x66F4;&amp;#x65B0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;pi_state&amp;#x548C;rt_mutex&amp;#x7684;owner&amp;#x5B57;&amp;#x6BB5;&amp;#x3002;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x5C42;&amp;#x6B21;&amp;#x6BD4;&amp;#x8F83;&amp;#x6DF1;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C;&amp;#x4E0A;&amp;#x90FD;&amp;#x662F;&amp;#x6BCF;&amp;#x4E00;&amp;#x5C42;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x57FA;&amp;#x672C;&amp;#x7684;&amp;#x66F4;&amp;#x65B0;&amp;#x5DE5;&amp;#x4F5C;&amp;#xFF0C;&amp;#x6700;&amp;#x7EC8;&amp;#x8C03;&amp;#x7528;&amp;#x5230;__rt_mutex_futex_unlock&amp;#x6765;&amp;#x91CD;&amp;#x65B0;&amp;#x8C03;&amp;#x6574;&amp;#x672C;&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x5E76;&amp;#x5C06;top waiter&amp;#x653E;&amp;#x5230;wake queue&amp;#x4E0A;&amp;#x3002;&amp;#x5728;rt_mutex_postunlock&amp;#x8C03;&amp;#x7528;&amp;#x7684;rt_mutex_postunlock&amp;#x5C06;&amp;#x65B0;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5524;&amp;#x9192;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5219;&amp;#x4F7F;&amp;#x7528;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;cmpxchg_futex_value_locked&lt;/code&gt;&amp;#x6765;&amp;#x5C06;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x5730;&amp;#x5740;uaddr&amp;#x4E0A;&amp;#x7684;&amp;#x503C;&amp;#x8BBE;&amp;#x4E3A;0&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x9501;&amp;#x6CA1;&amp;#x6709;waiter&amp;#x4E86;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x4E5F;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x6062;&amp;#x590D;&amp;#x4E86;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x5DF2;&amp;#x7ECF;&amp;#x6062;&amp;#x590D;&amp;#x8FC7;&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5C31;&amp;#x4F7F;&amp;#x7528;&amp;#x4E0B;&amp;#x9762;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x5207;&amp;#x6362;lock owner&amp;#xFF0C;&amp;#x5E76;&amp;#x6062;&amp;#x590D;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;wake_futex_pi&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x505A;&amp;#x4E86;&amp;#x4E0B;&amp;#x9762;&amp;#x51E0;&amp;#x4EF6;&amp;#x4E8B;&amp;#xFF1A;&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x7528;cmpxchg_futex_value_locked&amp;#x5C06;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x4F20;&amp;#x5165;&amp;#x7684;uaddr&amp;#x5904;&amp;#x7684;&amp;#x6570;&amp;#x503C;&amp;#x66F4;&amp;#x65B0;&amp;#x4E3A;&amp;#x65B0;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_next_owner() | FUTEX_WAITERS&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;list_del_init(&amp;amp;pi_state-&amp;gt;list)&lt;/code&gt;&amp;#xFF1A;&amp;#x5C06;list&amp;#x4ECE;&amp;#x539F;&amp;#x5148;&amp;#x7684;&amp;#x8868;&amp;#x4E0A;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x5E76;&amp;#x91CD;&amp;#x65B0;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x51C6;&amp;#x5907;&amp;#x79FB;&amp;#x5230;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;&amp;#x8868;&amp;#x4E0A;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;list_add(&amp;amp;pi_state-&amp;gt;list, &amp;amp;new_owner-&amp;gt;pi_state_list)&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;pi_state-&amp;gt;owner = new_owner&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;__rt_mutex_futex_unlock&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_postunlock&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;mark_wakeup_next_waiter&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6CE8;&amp;#x610F;&amp;#xFF1A;&amp;#x6B64;&amp;#x65F6;pi_state-&amp;gt;owner&amp;#x5DF2;&amp;#x7ECF;&amp;#x8BBE;&amp;#x7F6E;&amp;#x8FC7;&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;pi_state-&amp;gt;pi_mutex-&amp;gt;owner&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x8BBE;&amp;#x7F6E;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E3B;&amp;#x8981;&amp;#x505A;&amp;#x4E86;&amp;#x4E0B;&amp;#x9762;&amp;#x51E0;&amp;#x4EF6;&amp;#x4E8B;&amp;#x60C5;&amp;#xFF1A;&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_dequeue_pi(current, waiter);&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_adjust_prio(current)&lt;/code&gt;:&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x8C03;&amp;#x6574;&amp;#x4E86;&amp;#x5F53;&amp;#x524D;&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x5B8C;&amp;#x6210;&amp;#x4E86;&amp;#x6574;&amp;#x4E2A;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x534F;&amp;#x8BAE;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;wake_q_add(wake_q, waiter-&amp;gt;task)&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;put_pi_state&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x66F4;&amp;#x591A;&amp;#x7684;&amp;#x662F;&amp;#x6E05;&amp;#x7406;&amp;#x5DE5;&amp;#x4F5C;:&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x8C03;&amp;#x7528;&amp;#x4E86;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_proxy_unlock&lt;/code&gt;&amp;#x6765;&amp;#x91CA;&amp;#x653E;pi_state-&amp;gt;pi_mutex.&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x91CA;&amp;#x653E;&amp;#x4E86;current-&amp;gt;pi_state_cache&amp;#x7A7A;&amp;#x95F4;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0;&#34;&gt;&lt;strong style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700;&#34;&gt;cmpxchg_futex_value_locked&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&lt;/strong&gt;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8; margin-bottom: 0;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;cmpxchg_futex_value_locked&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(u32 *uval, u32 __user *uaddr,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;         u32 oldval, u32 newval)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
ATOMIC();
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; val = *uaddr;
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (val == oldval) &amp;#123;
*uaddr = newval;
&amp;#125;
*uval = val;
END_ATOMIC();
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;;
&amp;#125;

&amp;#x5176;&amp;#x4E2D;ATOMIC&amp;#x64CD;&amp;#x4F5C;&amp;#x901A;&amp;#x8FC7;page_disable()&amp;#x548C;preempt_disable()&amp;#x4FDD;&amp;#x8BC1;&amp;#x3002;
&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;__rt_mutex_start_proxy_lock&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;futex_lock_pi&amp;#x7528;&amp;#x5230;&amp;#x7684;rt_mutex&amp;#x63A5;&amp;#x53E3;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E2D;&amp;#x53EF;&amp;#x77E5;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;PI&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x53C8;&amp;#x4E3B;&amp;#x8981;&amp;#x8C03;&amp;#x7528;task_blocks_on_rt_mutex&amp;#x6765;&amp;#x5904;&amp;#x7406;PI&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549078599538.png&#34; hash=&#34;692787b6adf4be8b04b3aa57c3612c37&#34; align alt longdesc width=&#34;840&#34; height=&#34;712&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;rt_mutex_adjust_prio(owner)&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x662F;&amp;#x8C03;&amp;#x6574;&amp;#x963B;&amp;#x585E;&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5B9E;&amp;#x73B0;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;&amp;#x3002;&amp;#x5B9E;&amp;#x73B0;&amp;#x65B9;&amp;#x5F0F;&amp;#x4E5F;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (task_has_pi_waiters(p))
&amp;#x203A;   pi_task = task_top_pi_waiter(p)-&amp;gt;task;

rt_mutex_setprio(p, pi_task);
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x628A;owner&amp;#x7EBF;&amp;#x7A0B;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;owner&amp;#x7EBF;&amp;#x7A0B;&amp;#x6240;&amp;#x6709;waiter(&amp;#x53EF;&amp;#x80FD;&amp;#x6765;&amp;#x81EA;&amp;#x591A;&amp;#x4E2A;&amp;#x9501;)&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;rt_mutex_adjust_prio_chain&lt;/h4&gt;
&lt;h5 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x6709;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x5F0F;&amp;#x8C03;&amp;#x6574;&amp;#xFF1F;&lt;/h5&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549078908946.png&#34; hash=&#34;c4badef8862a4db7fb98b88635d31ecb&#34; align alt longdesc width=&#34;1021&#34; height=&#34;358&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E24;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x6BCF;&amp;#x4E2A;rt_mutex&amp;#x6709;&amp;#x5F20;waiters&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6240;&amp;#x6709;&amp;#x7B49;&amp;#x5F85;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x6BCF;&amp;#x4E2A;task&amp;#x4E5F;&amp;#x6709;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x8868;&amp;#x683C;&amp;#x91CC;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x9879;&amp;#x5BF9;&amp;#x5E94;owner&amp;#x7EBF;&amp;#x7A0B;&amp;#x5360;&amp;#x6709;&amp;#x7684;&amp;#x9501;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E00;&amp;#x9879;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;rt_mutex_waiter&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x7533;&amp;#x8BF7;&amp;#x8BE5;&amp;#x9501;&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;waiter&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5047;&amp;#x8BBE;Task1&amp;#x5C31;&amp;#x662F;owner&amp;#xFF0C;Task0&amp;#x5BF9;Lock0&amp;#x7684;&amp;#x7533;&amp;#x8BF7;&amp;#x5BFC;&amp;#x81F4;Task1&amp;#x63D0;&amp;#x5347;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;Task1&amp;#x540C;&amp;#x65F6;&amp;#x88AB;Task2&amp;#x6301;&amp;#x6709;&amp;#x7684;&amp;#x67D0;&amp;#x4E2A;&amp;#x9501;&amp;#x963B;&amp;#x585E;&amp;#xFF0C;&amp;#x5219;Task1&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7684;&amp;#x6539;&amp;#x53D8;&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;Task2 pi_waiters&amp;#x5217;&amp;#x8868;&amp;#x6539;&amp;#x53D8;&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x53EF;&amp;#x80FD;&amp;#x5BFC;&amp;#x81F4;Task2&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x4F9D;&amp;#x6B64;&amp;#x7C7B;&amp;#x63A8;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x8FD9;&amp;#x79CD;&amp;#x94FE;&amp;#x5F0F;&amp;#x53CD;&amp;#x5E94;&amp;#x3002;&lt;/p&gt;
&lt;h5 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;&#34;&gt;&amp;#x94FE;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&lt;/h5&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6574;&amp;#x4E2A;chain&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x5927;&amp;#x81F4;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x5982;&amp;#x679C;Task0&amp;#x662F;Lock0&amp;#x7684;top waiter&amp;#xFF0C;&amp;#x5219;&amp;#x6FC0;&amp;#x53D1;&amp;#x8BE5;&amp;#x94FE;&amp;#x5F0F;&amp;#x8C03;&amp;#x6574;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x56E0;&amp;#x4E3A;Task0&amp;#x6210;&amp;#x4E3A;Lock0&amp;#x7684;topwaiter&amp;#xFF0C;&amp;#x5219;Task1&amp;#x7684;pi_waiters&amp;#x9700;&amp;#x8981;&amp;#x8C03;&amp;#x6574;&amp;#xFF0C;&amp;#x5219;Task1&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53EF;&amp;#x80FD;&amp;#x9700;&amp;#x8981;&amp;#x8C03;&amp;#x6574;&amp;#x3002;&amp;#x9000;&amp;#x51FA;&amp;#x53EF;&amp;#x80FD;&amp;#xFF1A;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x8D77;&amp;#x70B9;&amp;#x9501;&amp;#x91CA;&amp;#x653E;&amp;#x4E86;&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x94FE;&amp;#x7684;&amp;#x5F53;&amp;#x524D;&amp;#x73AF;&amp;#x8282;&amp;#x88AB;&amp;#x66F4;&amp;#x6539;( next_lock &amp;#x2260;waiter-&amp;gt;lock)&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;Task1&amp;#x6CA1;&amp;#x6709;&amp;#x5360;&amp;#x9501;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x5982;&amp;#x679C;Task1&amp;#x4E5F;wait&amp;#x5728;&amp;#x67D0;&amp;#x4E2A;lock&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5219;&amp;#x8BE5;lock&amp;#x7684;waiters&amp;#x9700;&amp;#x8981;&amp;#x8C03;&amp;#x6574;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x82E5;&amp;#x5E72;&amp;#x79CD;&amp;#x9000;&amp;#x51FA;&amp;#x53EF;&amp;#x80FD;&amp;#x3002;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;Task1&amp;#x6CA1;&amp;#x6709;&amp;#x88AB;block&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;Task1 pi_waiters&amp;#x4E2D;&amp;#x6709;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x9AD8;&amp;#x4E8E;Task0&amp;#x7684;waiter&amp;#xFF0C;&amp;#x6362;&amp;#x53E5;&amp;#x8BDD;&amp;#x8BF4;&amp;#xFF0C;lock0&amp;#x7684;top_waiter&amp;#x4E0D;&amp;#x662F;Task1&amp;#x7684;top pi_waiter&amp;#xFF0C;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x7EE7;&amp;#x7EED;&amp;#x4F20;&amp;#x9012;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x5982;&amp;#x679C;Task1&amp;#x5728;&amp;#x7533;&amp;#x8BF7;Lock1 &amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF08;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8BB0;&amp;#x5F55;&amp;#x5728;waiter-&amp;gt;prio&amp;#x91CC;&amp;#xFF09;&amp;#x4E0E;&amp;#x5F53;&amp;#x524D;&amp;#x8C03;&amp;#x6574;&amp;#x540E;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x76F8;&amp;#x7B49;&amp;#xFF0C;&amp;#x5219;&amp;#x540E;&amp;#x7EED;&amp;#x6CA1;&amp;#x5FC5;&amp;#x8981;&amp;#x5728;&amp;#x7EE7;&amp;#x7EED;&amp;#x8C03;&amp;#x6574;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x68C0;&amp;#x6D4B;&amp;#x5230;DEADLOCK&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34; style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x56DE;&amp;#x5230;1&amp;#x7EE7;&amp;#x7EED;&amp;#x6267;&amp;#x884C;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x9000;&amp;#x51FA;&amp;#x94FE;&amp;#x5F0F;&amp;#x5904;&amp;#x7406;&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;&#34;&gt;&amp;#x6B7B;&amp;#x9501;&lt;/h5&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6709;3&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x51FD;&amp;#x6570;&amp;#x4F1A;&amp;#x8FD4;&amp;#x56DE;&amp;#x6B7B;&amp;#x9501;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x94FE;&amp;#x4E0A;&amp;#x8D85;&amp;#x8FC7;1024&amp;#x4E2A;&amp;#x9501;&amp;#x8282;&amp;#x70B9;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x94FE;&amp;#x4E0A;&amp;#x4EFB;&amp;#x610F;Task&amp;#x8282;&amp;#x70B9;&amp;#x7533;&amp;#x8BF7;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x9501;&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x5373;Lock0&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x94FE;&amp;#x4E0A;&amp;#x4EFB;&amp;#x610F;&amp;#x4E00;&amp;#x4E2A;&amp;#x9501;owner&amp;#x662F;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;Task&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x5373;Task0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[1] [Mutex mutandis: understanding mutex types and attributes]. (http://2net.co.uk/tutorial/mutex_mutandis)&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[2] &lt;a href=&#34;http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;POSIX Revision of IEEE Std 1003.1-2008&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[3] &lt;a href=&#34;https://zihan.me/2018/08/15/source-code-analysis-pthread-mutex-lock/&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;Source code analysis of pthread_mutex_lock&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[4] &lt;a href=&#34;https://yq.aliyun.com/articles/6044&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;linux pi_futex&amp;#x6D45;&amp;#x6790;&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[5] Linux 4.20-rc3 source code&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[6] glibc 2.28 source code&lt;/p&gt;
&lt;/div&gt;&lt;center style=&#34;display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden&#34;&gt;%23%23%20%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%0A%0A%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E6%8C%87%E4%B8%80%E4%B8%AA%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E5%9B%A0%E4%B8%BA%E8%B5%84%E6%BA%90%E8%A2%AB%E4%BD%8E%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E5%8D%A0%E7%94%A8%EF%BC%8C%E8%80%8C%E4%B8%8D%E5%BE%97%E4%B8%8D%E7%AD%89%E5%BE%85%E3%80%82%E8%BF%99%E4%B8%AA%E9%80%BB%E8%BE%91%E6%9C%AC%E8%BA%AB%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E3%80%82%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E5%B8%A6%E6%9D%A5%E6%9C%80%E7%9B%B4%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98%E5%B0%B1%E6%98%AF%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%AF%E8%83%BD%E5%9B%A0%E4%B8%BA%E8%BF%99%E6%AC%A1%E9%98%BB%E5%A1%9E%EF%BC%8C%E8%80%8C%E6%97%A0%E6%B3%95%E7%A1%AE%E5%AE%9A%E9%98%BB%E5%A1%9E%E6%97%B6%E5%BB%B6%E3%80%82%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82%0A!%5B8df099f053cbeaee4881a9d6ffc8963f.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5789)%0A%0ATask%209%E4%BC%98%E5%85%88%E7%BA%A7%E8%BE%83%E4%BD%8E%EF%BC%8C%E6%89%80%E4%BB%A5%E5%BE%88%E5%AE%B9%E6%98%93%E8%A2%AB%E5%85%B6%E4%BB%96%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%8A%A2%E5%8D%A0%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%AF%B9%E8%B5%84%E6%BA%90S%E7%9A%84%E9%94%81%E6%97%A0%E6%B3%95%E9%87%8A%E6%94%BE%EF%BC%8C%E8%80%8C%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%9B%A0%E4%B8%BA%E8%A6%81%E6%8C%81%E6%9C%89%E8%AF%A5%E9%94%81%EF%BC%8C%E4%B8%8D%E5%BE%97%E4%B8%8D%E7%AD%89%E5%BE%85%E3%80%82%0A%0A%23%23%20%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%0A%0APriority%20Inheritance%20Protocol%E7%BF%BB%E8%AF%91%E4%B8%BA%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%EF%BC%8C%E7%AE%80%E7%A7%B0PIP%E3%80%82%E8%BF%99%E6%98%AF%E8%A7%A3%E5%86%B3%E4%B8%8A%E8%BF%B0Unbounded%20inversion%E6%9C%80%E7%9B%B4%E6%8E%A5%E7%9A%84%E5%8A%9E%E6%B3%95%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%B0%86%E5%8D%A0%E6%9C%89%E9%94%81%E7%9A%84%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E6%95%B4%E5%88%B0%E5%9C%A8%E7%AD%89%E5%BE%85%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%9C%80%E9%AB%98%E5%80%BC%E3%80%82%E8%BF%99%E4%B8%AA%E7%AE%97%E6%B3%95%E6%98%AF%E8%B4%AA%E5%A9%AA%E7%9A%84%EF%BC%8C%E5%B1%80%E9%83%A8%E6%9C%80%E4%BC%98%EF%BC%8C%E4%BD%86%E4%B8%8D%E6%98%AF%E6%95%B4%E4%BD%93%E6%9C%80%E4%BC%98%E8%A7%A3%EF%BC%8C%E5%9C%A8%E6%AD%A4%E4%B9%8B%E4%B8%8A%E5%8F%88%E6%9C%89PCP(%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF)%E5%92%8CSRP(%E5%9F%BA%E4%BA%8E%E6%A0%88%E7%9A%84%E8%B5%84%E6%BA%90%E7%AD%96%E7%95%A5)%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%8D%E5%81%9A%E8%AE%A8%E8%AE%BA%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E4%BB%8E%E6%BA%90%E7%A0%81%E7%9A%84%E8%A7%92%E5%BA%A6%EF%BC%8C%E9%98%90%E8%BF%B0PIP%E5%9C%A8Linux%E5%92%8Cglibc%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%23%23%20Overview%0A!%5Bb16f478e9d2cf9485b4b8bba9e81e3b0.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5790)%0A%0ALinux%E4%B8%8B%E7%9A%84PIP%E5%AE%9E%E7%8E%B0%E5%88%86%E6%88%90%E4%BB%A5%E4%B8%8A3%E4%B8%AA%E9%83%A8%E5%88%86%EF%BC%9A%0A%0A-%20glibc%E4%B8%AD%E7%9A%84pthread_mutex_lock%E6%8F%90%E4%BE%9B%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3%EF%BC%8C%E9%80%9A%E8%BF%87FUTEX_LOCK_PI%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E6%95%B4%0A-%20Linux%E7%9A%84futex%E9%83%A8%E5%88%86%E6%8F%90%E4%BE%9BFUTEX_LOCK_PI%E7%9A%84%E5%AE%9E%E7%8E%B0%0A-%20%E6%9C%80%E7%BB%88%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6%E9%80%9A%E8%BF%87rt_mutex%E6%9D%A5%E5%AE%9E%E7%8E%B0%0A%0A%23%23%20pthread_mutex%0A%0A%23%23%23%20Types%0A%0Apthread%20mutex%E6%98%AFPOSIX%20pthread%E5%BA%93%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E4%B8%80%E7%A7%8D%E9%94%81%E6%9C%BA%E5%88%B6%EF%BC%8C%E4%B8%8E%E4%BF%A1%E5%8F%B7%E9%87%8F%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%94%81%E5%8F%AA%E6%9C%89%E4%B8%A4%E7%A7%8D%E7%8A%B6%E6%80%81%EF%BC%9Alocked%E6%88%96unlocked%E3%80%82%E4%B8%8Ebinary%20semaphore%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%8Cmutex%E5%8F%AA%E8%83%BD%E8%A2%ABlock%E7%9A%84%E7%BA%BF%E7%A8%8Bunlock%EF%BC%8C%E5%8D%B3%E5%8F%AA%E8%83%BD%E8%A2%ABmutex%20owner%20unlock%E3%80%82%0A%0A%E7%9B%AE%E5%89%8D%5BPOSIX%E6%A0%87%E5%87%86(1003.1-2008)%5D(http%3A%2F%2Fpubs.opengroup.org%2Fonlinepubs%2F9699919799%2Ffunctions%2Fcontents.html)%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BA%864%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84mutex%3A%0A%0A-%20PTHREAD_MUTEX_NORMAL%0A-%20PTHREAD_MUTEX_ERRORCHECK%0A-%20PTHREAD_MUTEX_RECURSIVE%0A-%20PTHREAD_MUTEX_DEFAULT%0A%0A%E8%BF%994%E7%A7%8Dmutex%E4%B8%8D%E5%90%8C%E4%B9%8B%E5%A4%84%E5%A6%82%E4%B8%8B%0A%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%20attempting%20to%20relock%20this%20mutex%20without%20first%20unlocking%20%7C%20Attempting%20to%20unlock%20a%20mutex%20locked%20by%20a%20different%20thread%20%7C%0A%7C%20----------%20%7C%20-------------------------------------------------------%20%7C%20---------------------------------------------------------%20%7C%0A%7C%20NORMAL%20%20%20%20%20%7C%20deadlock%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20ERRORCHECK%20%7C%20return%20error%20-EDEADLOCK%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20return%20error%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20RECURSIVE%20%20%7C%20succeed%20in%20locking%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20return%20error%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20DEFAULT%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%0Aglibc%E5%AF%B9%E4%B8%8A%E8%BF%B04%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84mutex%E8%BF%9B%E8%A1%8C%E4%BA%86%E6%89%A9%E5%B1%95%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9A%0A%0A%60%60%60c%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_RECURSIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ERRORCHECK_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_NORMAL_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ADAPTIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_RECURSIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_ERRORCHECK_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_NORMAL_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_ADAPTIVE_NP%3A%0A%60%60%60%0A%0A%E4%B8%BB%E8%A6%81%E5%A4%9A%E4%BA%86%E8%BF%993%E7%A7%8D%E5%B1%9E%E6%80%A7%EF%BC%9A%0A%0A-%20ADAPTIVE%EF%BC%9A%E5%9C%A8SMP%E6%9E%B6%E6%9E%84%E4%B8%8B%EF%BC%8C%E5%B9%B6%E4%B8%8D%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5wait%EF%BC%8C%E8%80%8C%E6%98%AF%E5%85%88%E8%B0%83%E7%94%A8spinlock%E7%AD%89%E5%BE%85%E4%B8%80%E5%B0%8F%E6%AE%B5%E6%97%B6%E9%97%B4%E3%80%82musl%E9%87%8C%E9%BB%98%E8%AE%A4%E9%83%BD%E9%87%87%E7%94%A8%E4%BA%86%E8%BF%99%E7%A7%8D%E5%AE%9E%E7%8E%B0%0A%0A-%20PI%EF%BC%9A%E5%8C%85%E5%90%AB%E8%AF%A5%E5%B1%9E%E6%80%A7%E7%9A%84mutex%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BA%86%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF(Priority%20Inheritance%2C%20PI)%0A%0A-%20ROBUST%EF%BC%9A%E8%8B%A5%E7%BA%BF%E7%A8%8B%E9%80%80%E5%87%BA%E6%97%B6%E6%9C%AA%E9%87%8A%E6%94%BE%E9%94%81%EF%BC%8C%E5%88%99%E4%BB%A5%E5%90%8E%E5%AF%B9%E8%AF%A5%E9%94%81%E6%93%8D%E4%BD%9C%E9%83%BD%E4%BC%9A%E8%BF%94%E5%9B%9E-EOWNERDEAD%EF%BC%8C%E4%B8%8E%E4%B9%8B%E5%AF%B9%E5%BA%94%E7%9A%84%E6%98%AFPTHREAD_MUTEX_STALLED(%E8%BF%99%E6%98%AF%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE)%EF%BC%8C%E5%AF%B9%E8%AF%A5%E5%BC%82%E5%B8%B8%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BC%9A%E5%87%BA%E7%8E%B0undefined%E8%A1%8C%E4%B8%BA%E3%80%82%0A%0A%E5%86%8D%E4%B8%8E%E5%8E%9F%E5%85%88%E7%9A%844%E7%A7%8D%E5%B1%9E%E6%80%A7%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E3%80%82%0A%0A%3E%20**%22_NP%22%20suffix**%0A%3E%0A%3E%20Note%3A%20the%20_NP%20suffix%20indicates%20a%20non-portable%20extension%20to%20the%20POSIX%20specification.%20In%20fact%20the%20latest%20specification%2C%201003.1-2008%20%5B%5B2%5C%5D%5D(http%3A%2F%2F2net.co.uk%2Ftutorial%2Fmutex_mutandis%23ref_2)%2C%20includes%20most%20of%20the%20Linux%20additions%20so%20you%20can%20leave%20the%20_NP%20ending%20off.%20I%20have%20chosen%20not%20to%20because%20some%20older%20versions%20of%20the%20header%20files%20only%20have%20the%20_NP%20variants.%0A%3E%0A%3E%20%E6%A0%B9%E6%8D%AE%E6%9C%80%E6%96%B0%E7%9A%84POSIX%E6%A0%87%E5%87%861003.1-2008%EF%BC%8C%E8%BF%99%E4%BA%9B%E6%89%A9%E5%B1%95%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%8A%A0%E5%85%A5%E3%80%82%0A%0A%E6%9C%AC%E6%96%87%E5%8F%AA%E5%85%B3%E6%B3%A8MUTEX_PI%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%23%23%23%20PTHREAD_MUTEX_PI%0A%0A%23%23%23%23%20pthread_mutex_lock%0A%0A%E9%87%8D%E8%A6%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A%60%60%60C%0Atypedef%20union%0A%7B%0A%20%20struct%20__pthread_mutex_s%20__data%3B%0A%20%20char%20__size%5B__SIZEOF_PTHREAD_MUTEX_T%5D%3B%0A%20%20long%20int%20__align%3B%0A%7D%20pthread_mutex_t%3B%0Astruct%20__pthread_mutex_s%0A%7B%0A%20%20int%20__lock%20__LOCK_ALIGNMENT%3B%0A%20%20unsigned%20int%20__count%3B%0A%20%20int%20__owner%3B%0A%20%20...%0A%7D%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%80%83%E8%99%91ROBUST%E6%83%85%E5%86%B5%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%8C%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E5%AE%9E%E7%8E%B0%E4%BA%86PI%E5%B1%9E%E6%80%A7%E7%9A%84pthread_mutex_lock%E6%93%8D%E4%BD%9C%E5%A6%82%E4%B8%8B%EF%BC%9A%0A!%5B36c67b688ae44843223a576d9cc0be30.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5791)%0A%0A%0A%3E%20**atomic_compare_and_exchange_val_acq**%0A%3E%0A%3E%20%E8%BF%99%E6%98%AF%E4%B8%80%E7%A7%8D%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%85%88%E6%AF%94%E8%BE%83%E5%86%8D%E8%B5%8B%E5%80%BC%EF%BC%8C%E4%BC%AA%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%3E%0A%3E%20%60%60%60C%0A%3E%20int%20compare_and_swap(int*%20reg%2C%20int%20oldval%2C%20int%20newval)%0A%3E%20%7B%0A%3E%20%20%20%20%20ATOMIC()%3B%0A%3E%20%20%20%20%20int%20old_reg_val%20%3D%20*reg%3B%0A%3E%20%20%20%20%20if%20(old_reg_val%20%3D%3D%20oldval)%0A%3E%20%20%20%20%20%20%20*reg%20%3D%20newval%3B%0A%3E%20%20%20%20%20END_ATOMIC()%3B%0A%3E%20%20%20%20%20return%20old_reg_val%3B%0A%3E%20%7D%0A%3E%20%60%60%60%0A%3E%0A%3E%20%E9%92%88%E5%AF%B9%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E6%83%85%E5%86%B5%EF%BC%9A%0A%3E%0A%3E%20-%20%60oldval%20%3D%3D%200%60%3A%20%E8%A1%A8%E7%A4%BA%60mutex-%3E__data.__lock%20%3D%3D%200%60%EF%BC%8C%E5%8D%B3%E8%AF%A5lock%E6%97%A0owner%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%BE%97%E3%80%82%0A%3E%20-%20%60oldval%20!%3D%200%60%3A%20%E8%A1%A8%E7%A4%BA%E8%AF%A5mutex%E8%A2%ABlock%E4%BA%86%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%BF%9B%E5%85%A5kernel%E6%9D%A5%E5%A4%84%E7%90%86%E9%94%81%E7%9A%84%E6%83%85%E5%86%B5%E3%80%82%0A%0Apthread_mutex_lock%E7%9A%84%E9%80%BB%E8%BE%91%E6%AF%94%E8%BE%83%E7%AE%80%E5%8D%95%EF%BC%8C%E5%B0%B1%E6%98%AF%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%88%A4%E6%96%AD%E9%94%81%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E8%A2%AB%E9%94%81%E4%BD%8F%E3%80%82%E5%A6%82%E6%9E%9C%E6%B2%A1%E9%94%81%E4%BD%8F%E5%B0%B1%E6%9B%B4%E6%96%B0owner%EF%BC%8C%E4%BB%A5%E5%8F%8Auser%E8%AE%A1%E6%95%B0%E3%80%82%E5%A6%82%E6%9E%9C%E5%B7%B2%E7%BB%8F%E8%A2%AB%E9%94%81%E4%BD%8F%EF%BC%8C%E5%88%99%E9%99%B7%E5%85%A5%E5%86%85%E6%A0%B8%E8%B0%83%E7%94%A8FUTEX_LOCK_PI%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AE%8C%E6%88%90%E4%B8%8A%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82%0A%0A%23%23%23%23%20pthread_mutex_unlock%0A%0A%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%E5%9F%BA%E6%9C%AC%E4%B8%8A%E5%B0%B1%E6%98%AF%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8futex_unlock_pi%20SYSCALL%E6%9D%A5%E5%AE%8C%E6%88%90%E5%B7%A5%E4%BD%9C%EF%BC%9A%0A%0A%60%60%60c%0A%20%20%20%20%20%20%2F*%20Unlock%20the%20mutex%20using%20a%20CAS%20unless%20there%20are%20futex%20waiters%20or%20our%0A%E2%80%BA%20%20%20%20TID%20is%20not%20the%20value%20of%20__lock%20anymore%2C%20in%20which%20case%20we%20let%20the%0A%E2%80%BA%20%20%20%20kernel%20take%20care%20of%20the%20situation.%20%20Use%20release%20MO%20in%20the%20CAS%20to%0A%E2%80%BA%20%20%20%20synchronize%20with%20acquire%20MO%20in%20lock%20acquisitions.%20%20*%2F%0A%20%20%20%20%20%20int%20l%20%3D%20atomic_load_relaxed%20(%26mutex-%3E__data.__lock)%3B%0A%20%20%20%20%20%20do%0A%E2%80%BA%20%20%20%7B%0A%E2%80%BA%20%20%20%20%20if%20(((l%20%26%20FUTEX_WAITERS)%20!%3D%200)%0A%E2%80%BA%20%20%20%20%20%20%20%20%20%7C%7C%20(l%20!%3D%20THREAD_GETMEM%20(THREAD_SELF%2C%20tid)))%0A%E2%80%BA%20%20%20%20%20%20%20%7B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20INTERNAL_SYSCALL_DECL%20(__err)%3B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20INTERNAL_SYSCALL%20(futex%2C%20__err%2C%202%2C%20%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20__lll_private_flag%20(FUTEX_UNLOCK_PI%2C%20private))%3B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20break%3B%0A%E2%80%BA%20%20%20%20%20%20%20%7D%0A%E2%80%BA%20%20%20%7D%0A%20%20%20%20%20%20while%20(!atomic_compare_exchange_weak_release%20(%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%26l%2C%200))%3B%0A%60%60%60%0A%0A%0A%0A%23%23%20futex%0A%0Afutex%E6%98%AF%E4%B8%80%E7%A7%8D%E5%86%85%E6%A0%B8%E7%9A%84%E7%AD%89%E5%BE%85%E6%9C%BA%E5%88%B6%EF%BC%8C%E7%AD%89%E5%BE%85%E6%9F%90%E4%B8%AA%E7%94%A8%E6%88%B7%E6%80%81%E6%95%B0%E6%8D%AE%E8%A2%AB%E8%AE%BE%E7%BD%AE%E6%88%90%E6%9F%90%E4%B8%AA%E5%80%BC%E3%80%82%E9%92%88%E5%AF%B9%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84futex%E7%95%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E3%80%82%E5%AE%83%E4%B8%8D%E5%86%8D%E7%AD%89%E5%BE%85%E7%94%A8%E6%88%B7%E4%BC%A0%E5%85%A5%E7%9A%84%E5%9C%B0%E5%9D%80%E4%B8%8A%E7%9A%84%E5%80%BC%EF%BC%8C%E8%80%8C%E6%98%AF%E5%9F%BA%E4%BA%8E%E5%86%85%E6%A0%B8rt_mutex%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E7%AD%89%E5%BE%85%EF%BC%8C%E4%B8%8A%E9%94%81%E5%92%8C%E8%A7%A3%E9%94%81%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%E7%9C%8B%E4%B8%8B%E9%9D%A2glibc%E5%92%8CLinux%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%AF%B9%E6%8E%A5%EF%BC%9A%0A%0A%60%60%60c%0A%2F%2F%20glibc%3A%20pthread_mutex_lock.c%0Aint%20e%20%3D%20INTERNAL_SYSCALL%20(futex%2C%20__err%2C%204%2C%20%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%20%20__lll_private_flag%20(FUTEX_LOCK_PI%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20private)%2C%201%2C%200)%3B%0A%0A%2F%2F%20Linux%3A%20futex.c%0Along%20do_futex(u32%20__user%20*uaddr%2C%20int%20op%2C%20u32%20val%2C%20ktime_t%20*timeout%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20u32%20__user%20*uaddr2%2C%20u32%20val2%2C%20u32%20val3)%0A%7B%0A...%0A%09case%20FUTEX_LOCK_PI%3A%0A%E2%80%BA%20%20%20%09return%20futex_lock_pi(uaddr%2C%20flags%2C%20NULL%2C%201)%3B%20%20%20%20%0A...%20%0A%7D%0A%60%60%60%0A%0A%E5%8F%AF%E8%A7%81%EF%BC%9A%0A%0A-%20%60uaddr%20%3D%20%26mutex-%3E__data.__lock%60%0A-%20%60flags%20%3D%20__lll_private_flag%20(FUTEX_LOCK_PI%2C%20private)%60%0A-%20%60val%20%3D%201%2C%20timeout%20%3D%20NULL%60%0A%0A%3E%20%E5%85%B3%E4%BA%8Elock%2Funlock%E7%9A%84%E5%8F%99%E8%BF%B0%E4%BC%9A%E7%AE%80%E5%8C%96%E6%8E%89time%E7%9B%B8%E5%85%B3%E9%83%A8%E5%88%86%EF%BC%8C%E4%BB%A5%E5%8F%8API%E6%97%A0%E5%85%B3%E7%9A%84ROBUST%E7%AD%89%E7%89%B9%E6%80%A7%E3%80%82%0A%0A%23%23%23%20%E9%87%8D%E8%A6%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%0A%0A%60%60%60c%0A%2F*%0A%20*%20Hash%20buckets%20are%20shared%20by%20all%20the%20futex_keys%20that%20hash%20to%20the%20same%0A%20*%20location.%20%20Each%20key%20may%20have%20multiple%20futex_q%20structures%2C%20one%20for%20each%20task%0A%20*%20waiting%20on%20a%20futex.%0A%20*%2F%0Astruct%20futex_hash_bucket%20%7B%0A%E2%80%BA%20%20%20atomic_t%20waiters%3B%0A%E2%80%BA%20%20%20spinlock_t%20lock%3B%0A%E2%80%BA%20%20%20struct%20plist_head%20chain%3B%0A%7D%20____cacheline_aligned_in_smp%3B%0A%0A%2F**%0A%20*%20struct%20futex_q%20-%20The%20hashed%20futex%20queue%20entry%2C%20one%20per%20waiting%20task%0A%20*%20%40list%3A%E2%80%BA%20%20%E2%80%BA%20%20%20priority-sorted%20list%20of%20tasks%20waiting%20on%20this%20futex%0A%20*%20%40task%3A%E2%80%BA%20%20%E2%80%BA%20%20%20the%20task%20waiting%20on%20the%20futex%0A%20*%20%40lock_ptr%3A%E2%80%BA%20%20%E2%80%BA%20%20%20the%20hash%20bucket%20lock%0A%20*%20%40key%3A%E2%80%BA%20%20%20%E2%80%BA%20%20%20the%20key%20the%20futex%20is%20hashed%20on%0A%20*%20%40pi_state%3A%E2%80%BA%20%20%E2%80%BA%20%20%20optional%20priority%20inheritance%20state%0A%20*%20%40rt_waiter%3A%E2%80%BA%20%E2%80%BA%20%20%20rt_waiter%20storage%20for%20use%20with%20requeue_pi%0A%20*%20%40requeue_pi_key%3A%E2%80%BAthe%20requeue_pi%20target%20futex%20key%0A%20*%20%40bitset%3A%E2%80%BA%E2%80%BA%20%20%20bitset%20for%20the%20optional%20bitmasked%20wakeup%0A%20*%0A%20*%20We%20use%20this%20hashed%20waitqueue%2C%20instead%20of%20a%20normal%20wait_queue_entry_t%2C%20so%0A%20*%20we%20can%20wake%20only%20the%20relevant%20ones%20(hashed%20queues%20may%20be%20shared).%0A%20*%0A%20*%20A%20futex_q%20has%20a%20woken%20state%2C%20just%20like%20tasks%20have%20TASK_RUNNING.%0A%20*%20It%20is%20considered%20woken%20when%20plist_node_empty(%26q-%3Elist)%20%7C%7C%20q-%3Elock_ptr%20%3D%3D%200.%0A%20*%20The%20order%20of%20wakeup%20is%20always%20to%20make%20the%20first%20condition%20true%2C%20then%0A%20*%20the%20second.%0A%20*%0A%20*%20PI%20futexes%20are%20typically%20woken%20before%20they%20are%20removed%20from%20the%20hash%20list%20via%0A%20*%20the%20rt_mutex%20code.%20See%20unqueue_me_pi().%0A%20*%2F%0Astruct%20futex_q%20%7B%0A%E2%80%BA%20%20%20struct%20plist_node%20list%3B%0A%0A%E2%80%BA%20%20%20struct%20task_struct%20*task%3B%0A%E2%80%BA%20%20%20spinlock_t%20*lock_ptr%3B%0A%E2%80%BA%20%20%20union%20futex_key%20key%3B%0A%E2%80%BA%20%20%20struct%20futex_pi_state%20*pi_state%3B%0A%E2%80%BA%20%20%20struct%20rt_mutex_waiter%20*rt_waiter%3B%0A%E2%80%BA%20%20%20union%20futex_key%20*requeue_pi_key%3B%0A%E2%80%BA%20%20%20u32%20bitset%3B%0A%7D%20__randomize_layout%3B%0A%0A%2F*%0A%20*%20Priority%20Inheritance%20state%3A%0A%20*%2F%0Astruct%20futex_pi_state%20%7B%0A%E2%80%BA%20%20%20%2F*%0A%E2%80%BA%20%20%20%20*%20list%20of%20&amp;apos;owned&amp;apos;%20pi_state%20instances%20-%20these%20have%20to%20be%0A%E2%80%BA%20%20%20%20*%20cleaned%20up%20in%20do_exit()%20if%20the%20task%20exits%20prematurely%3A%0A%E2%80%BA%20%20%20%20*%2F%0A%E2%80%BA%20%20%20struct%20list_head%20list%3B%0A%0A%E2%80%BA%20%20%20%2F*%0A%E2%80%BA%20%20%20%20*%20The%20PI%20object%3A%0A%E2%80%BA%20%20%20%20*%2F%0A%E2%80%BA%20%20%20struct%20rt_mutex%20pi_mutex%3B%0A%0A%E2%80%BA%20%20%20struct%20task_struct%20*owner%3B%0A%E2%80%BA%20%20%20atomic_t%20refcount%3B%0A%0A%E2%80%BA%20%20%20union%20futex_key%20key%3B%0A%7D%20__randomize_layout%3B%0A%60%60%60%0A%0A%60futex_hash_bucket%60%E5%AF%B9%E5%BA%94%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E6%80%81%E7%9A%84%60uaddr%60%E3%80%82%E9%80%9A%E8%BF%87%E7%94%A8%E6%88%B7%E6%80%81%E4%BC%A0%E5%85%A5%E7%9A%84uaddr%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%9D%A5%E8%8E%B7%E5%BE%97%E5%AF%B9%E5%BA%94%E7%9A%84futex%E7%BB%93%E6%9E%84%E4%BD%93%E3%80%82%E7%94%A8hash%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%98%AF%E4%BC%A0%E5%85%A5%E7%9A%84%E6%98%AFuaddr%E5%9C%B0%E5%9D%80%E5%80%BC%EF%BC%8C%E6%95%B0%E5%AD%97%E5%BE%88%E5%A4%A7%EF%BC%8C%E5%88%86%E5%B8%83%E5%BE%88%E6%95%A3%EF%BC%8C%E6%89%80%E4%BB%A5%E7%94%A8hash%E5%8F%AF%E4%BB%A5%E6%9C%89%E6%95%88%E7%B4%A2%E5%BC%95%E3%80%82%0A%0A%60futex_q%20%60%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F%EF%BC%8C%E5%AF%B9%E5%BA%94%E4%BA%86%E4%B8%80%E4%B8%AAfutex%E7%9A%84waiter%E7%BA%BF%E7%A8%8B%E3%80%82%E5%AE%83%E9%80%9A%E5%B8%B8%E8%A2%AB%E7%94%A8%E6%9D%A5%E4%BC%A0%E9%80%92%E5%90%84%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%82%0A%0A%60pi_state%60%E6%98%AF%60task_struct%60%E5%86%85%E9%83%A8%E7%9A%84%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%EF%BC%8C%E5%9C%A8%60futex_lock_pi%60%E8%B0%83%E7%94%A8%60refill_pi_state_cache%60%E9%87%8C%E9%9D%A2%E5%81%9A%E5%88%86%E9%85%8D%E3%80%82%0A%0A%0A%60%60%60c%0Astatic%20int%20refill_pi_state_cache(void)%0A%7B%0A...%0A%09pi_state%20%3D%20kzalloc(sizeof(*pi_state)%2C%20GFP_KERNEL)%3B%0A%20%20%20%20current-%3Epi_state_cache%20%3D%20pi_state%3B%0A...%0A%7D%0A%60%60%60%0A%23%23%23%20futex_lock_pi%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E7%9A%84%E9%80%BB%E8%BE%91%E8%BF%98%E6%98%AF%E6%AF%94%E8%BE%83%E7%9B%B4%E7%BA%BF%E7%9A%84%EF%BC%8C%E5%90%8C%E5%A4%A7%E5%A4%9A%E6%95%B0%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%85%88%E5%B0%9D%E8%AF%95%E5%8E%9F%E5%AD%90%E9%94%81%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%A1%8C%EF%BC%8C%E5%88%99%E8%B0%83%E7%94%A8rt_mutex%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%9D%A5%E5%A4%84%E7%90%86%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E6%9C%BA%E5%88%B6%E3%80%82%E4%BB%A5%E4%B8%8B%E6%8D%A1%E5%8F%96%E6%AF%94%E8%BE%83%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%BD%E6%95%B0%E5%81%9A%E9%98%90%E8%BF%B0%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%5C%5B3%5D%2C%20%5C%5B4%5D%E4%B8%AD%E7%9A%84%E6%8F%8F%E8%BF%B0%E3%80%82%0A%0A%23%23%23%23%20queue_lock%2C%20queue_unlock%0A%0A%E5%AF%B9hash_bucket%E8%BF%9B%E8%A1%8C%E9%94%81%E6%93%8D%E4%BD%9C%E3%80%82%E4%BB%96%E4%BB%AC%E6%93%8D%E4%BD%9C%E7%9A%84%E6%98%AF%60hash_bucket%60%E4%B8%8B%E7%9A%84%60lock%60%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E6%98%AF%60futex_q%60%E4%B8%8B%E7%9A%84%60lock_ptr%60%E3%80%82%E8%BF%99%E9%87%8C%E9%94%81%E7%9A%84%E5%87%BA%E7%8E%B0%E6%AF%94%E8%BE%83%E6%B7%B7%E4%B9%B1%EF%BC%8C%E6%9C%89%E6%97%B6%E8%B0%83%E7%94%A8%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%87%BD%E6%95%B0%EF%BC%8C%E6%9C%89%E6%97%B6%E7%9B%B4%E6%8E%A5%E5%AF%B9lock%E6%8C%87%E9%92%88%E6%93%8D%E4%BD%9C%E3%80%82%E9%9C%80%E8%A6%81%E5%B0%8F%E5%BF%83%E3%80%82%0A%0A%23%23%23%23%20__queue_me%2C%20unqueue_me%0A%0A%E8%BF%99%E9%87%8C%E5%B0%86%E7%94%B3%E8%AF%B7futex%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%9C%A8hash_bucket%E7%9A%84chain%E4%B8%8A%E5%81%9A%E6%B7%BB%E5%8A%A0%E6%88%96%E7%A7%BB%E9%99%A4%E6%93%8D%E4%BD%9C%E3%80%82%E8%BF%98%E4%BC%9A%E6%B6%89%E5%8F%8A%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82%0A%0A%E4%BB%A5%E4%B8%8A4%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9B%B4%E5%A4%9A%E7%9A%84%E4%B8%8Efutex%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9B%B8%E5%85%B3%EF%BC%8C%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E5%B9%B6%E6%97%A0%E5%85%B3%E7%B3%BB%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E7%95%A5%E8%BF%87%E3%80%82%0A%0A%23%23%23%23%20futex_lock_pi_atomic%0A!%5B8f64be7a14c9e36fb86aff8b54e61062.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5792)%0A%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E6%9D%A5%E8%AF%B7%E6%B1%82%E9%94%81%EF%BC%8C%0A%0A-%20%E5%A6%82%E6%9E%9Cfutex%E6%B2%A1%E6%9C%89waiter%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E8%8E%B7%E5%BE%97%E9%94%81%E5%B9%B6%E8%BF%94%E5%9B%9E1%EF%BC%8C%E8%A1%A8%E7%A4%BA%E6%88%90%E5%8A%9F%E8%8E%B7%E5%BE%97%E9%94%81%0A-%20%E5%A6%82%E6%9E%9C%E6%9C%89waiter%EF%BC%8C%E5%B0%B1%E8%BF%94%E5%9B%9E0%EF%BC%8C%E8%A1%A8%E7%A4%BAready%20to%20wait%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%E4%BC%9A%E5%81%9A%E4%B8%80%E4%BA%9B%E4%B8%8EPI%E7%9B%B8%E5%85%B3%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%9A%0A%0A-%20%E6%9C%89waiter%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9A%0A%20%20-%20%E8%B0%83%E7%94%A8attach_to_pi_state%E6%9D%A5%E8%8E%B7%E5%BE%97%E8%AF%A5top_waiter%E7%9A%84pi_state%0A-%20%E6%B2%A1%E6%9C%89waiter%E7%9A%84%E6%83%85%E5%86%B5%0A%20%20-%20%E8%B0%83%E7%94%A8attach_to_pi_owner%E6%9D%A5%E5%8F%96%E7%94%A8%E6%9C%AC%E7%BA%BF%E7%A8%8B%E9%87%8C%E5%88%86%E9%85%8D%E7%9A%84pi_state%E7%BB%93%E6%9E%84%E4%BD%93%EF%BC%8C%E5%B9%B6%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E3%80%82%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E8%A2%ABqueue%E5%88%B0hash_bucket%E7%9A%84%E9%98%9F%E5%88%97%E4%B8%AD%E3%80%82%0A%0A%23%23%23%23%20rt_mutex%E6%8E%A5%E5%8F%A3%0A%0Afutex_lock_pi%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%88%B0%E5%A6%82%E4%B8%8B%E8%BF%99%E4%BA%9Brt_mutex%E6%8E%A5%E5%8F%A3%EF%BC%9A%0A%0A-%20rt_mutex_init_waiter%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96waiter%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E5%85%B6%E5%AE%9E%E4%B8%BA%E4%B8%80%E4%B8%AA%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E8%8A%82%E7%82%B9%E3%80%82%E8%BF%99%E4%B8%AAwaiter%E5%AF%B9%E5%BA%94%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%EF%BC%8C%E5%B9%B6%E5%8F%8D%E6%98%A0%E7%BA%BF%E7%A8%8B%E5%9C%A8%E6%9F%90%E4%B8%AA%E9%94%81%E4%B8%8A%E7%9A%84%E7%AD%89%E5%BE%85%E5%85%B3%E7%B3%BB%E3%80%82%0A-%20__rt_mutex_start_proxy_lock%EF%BC%9A%E8%BF%99%E4%B8%AA%E6%98%AFPI%E7%9A%84%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%AF%B9%E5%90%84waiters%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%BB%A5%E5%8F%8A%E9%81%8D%E5%8E%86lock%E9%93%BE%E6%9D%A5%E6%A3%80%E6%9F%A5%E6%AD%BB%E9%94%81%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%8E%E4%B9%8B%E5%89%8D%E7%9A%84%E5%8E%9F%E5%AD%90%E6%A3%80%E6%9F%A5%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%94%E5%9B%9E1%E8%A1%A8%E7%A4%BA%E5%B7%B2%E7%BB%8F%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%94%E5%9B%9E0%EF%BC%8C%E5%88%99ready%20to%20wait%E3%80%82%0A-%20rt_mutex_wait_proxy_lock%EF%BC%9A%E9%80%9A%E8%BF%87__rt_mutex_start_proxy_lock%E5%A4%84%E7%90%86%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%98%E6%B2%A1%E6%9C%89%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E9%82%A3%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BC%80%E5%A7%8B%E7%AD%89%E5%BE%85%E4%BA%86%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%86%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E4%B8%BATASK_INTERRUPTIBLE%E7%8A%B6%E6%80%81%EF%BC%8C%E5%B9%B6%E5%BC%80%E5%A7%8B%E7%AD%89%E5%BE%85%E3%80%82%E8%BF%99%E5%85%B6%E9%97%B4%E4%BC%9A%E5%A4%84%E7%90%86%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E7%AD%89%E5%BE%85%EF%BC%8C%E4%B8%94%E4%BC%9A%E8%A7%A6%E5%8F%91%E8%B0%83%E5%BA%A6%E3%80%82%0A-%20rt_mutex_cleanup_proxy_lock%EF%BC%9A%E7%8E%B0%E5%9C%A8%E5%B7%B2%E7%BB%8F%E9%98%BB%E5%A1%9E%E7%BB%93%E6%9D%9F%E4%BA%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%98%E6%B2%A1%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E8%A6%81%E4%B9%88%E6%98%AF%E8%B6%85%E6%97%B6%EF%BC%8C%E8%A6%81%E4%B9%88%E6%98%AF%E5%87%BA%E9%94%99%EF%BC%8C%E6%80%BB%E4%B9%8B%E8%A6%81%E5%B0%86%E6%9C%AC%E7%BA%BF%E7%A8%8B%E4%BB%8Ewaiters%E4%B8%AD%E7%A7%BB%E9%99%A4%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%B1%E6%98%AF%E8%B5%B7%E8%BF%99%E4%B8%AA%E4%BD%9C%E7%94%A8%E3%80%82%0A%0A%23%23%23%23%20fixup_owner%0A%0A%E4%BB%8E%E6%B3%A8%E9%87%8A%E4%B8%8A%E7%9C%8B%EF%BC%8C%E6%98%AF%E4%B8%BA%E4%BA%86%E5%A4%84%E7%90%86lock%20steal%E3%80%82%E8%80%8Clock%20steal%E4%BC%BC%E4%B9%8E%E5%A4%9A%E5%8F%91%E7%94%9F%E5%9C%A8futex%20requeue%E6%93%8D%E4%BD%9C%E4%B8%8A%EF%BC%8C%E7%9B%AE%E5%89%8D%E5%B0%9A%E6%9C%AA%E4%BB%94%E7%BB%86%E7%A0%94%E7%A9%B6%E3%80%82%0A%0A%23%23%23%20futex_unlock_pi%0A%0Afutex_unlock_pi%E9%87%8A%E6%94%BEfutex%E4%BB%A5%E5%8F%8A%E6%9B%B4%E6%96%B0%E7%9B%B8%E5%BA%94%E7%9A%84pi_state%E5%92%8Crt_mutex%E7%9A%84owner%E5%AD%97%E6%AE%B5%E3%80%82%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%B1%82%E6%AC%A1%E6%AF%94%E8%BE%83%E6%B7%B1%EF%BC%8C%E5%9F%BA%E6%9C%AC%E4%B8%8A%E9%83%BD%E6%98%AF%E6%AF%8F%E4%B8%80%E5%B1%82%E5%81%9A%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%9B%B4%E6%96%B0%E5%B7%A5%E4%BD%9C%EF%BC%8C%E6%9C%80%E7%BB%88%E8%B0%83%E7%94%A8%E5%88%B0__rt_mutex_futex_unlock%E6%9D%A5%E9%87%8D%E6%96%B0%E8%B0%83%E6%95%B4%E6%9C%AC%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%B9%B6%E5%B0%86top%20waiter%E6%94%BE%E5%88%B0wake%20queue%E4%B8%8A%E3%80%82%E5%9C%A8rt_mutex_postunlock%E8%B0%83%E7%94%A8%E7%9A%84rt_mutex_postunlock%E5%B0%86%E6%96%B0%E7%BA%BF%E7%A8%8B%E5%94%A4%E9%86%92%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89waiter%EF%BC%8C%E5%88%99%E4%BD%BF%E7%94%A8%60cmpxchg_futex_value_locked%60%E6%9D%A5%E5%B0%86%E7%94%A8%E6%88%B7%E6%80%81%E5%9C%B0%E5%9D%80uaddr%E4%B8%8A%E7%9A%84%E5%80%BC%E8%AE%BE%E4%B8%BA0%E3%80%82%E5%9B%A0%E4%B8%BA%E9%94%81%E6%B2%A1%E6%9C%89waiter%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BC%98%E5%85%88%E7%BA%A7%E4%B9%9F%E4%B8%8D%E9%9C%80%E8%A6%81%E6%81%A2%E5%A4%8D%E4%BA%86%EF%BC%8C%E6%88%96%E8%80%85%E5%B7%B2%E7%BB%8F%E6%81%A2%E5%A4%8D%E8%BF%87%E4%BA%86%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%9C%89waiter%EF%BC%8C%E5%B0%B1%E4%BD%BF%E7%94%A8%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9D%A5%E5%88%87%E6%8D%A2lock%20owner%EF%BC%8C%E5%B9%B6%E6%81%A2%E5%A4%8D%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%0A%0A%23%23%23%23%20wake_futex_pi%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%81%9A%E4%BA%86%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%BB%B6%E4%BA%8B%EF%BC%9A%0A%0A1.%20%E7%94%A8cmpxchg_futex_value_locked%E5%B0%86%E7%94%A8%E6%88%B7%E6%80%81%E4%BC%A0%E5%85%A5%E7%9A%84uaddr%E5%A4%84%E7%9A%84%E6%95%B0%E5%80%BC%E6%9B%B4%E6%96%B0%E4%B8%BA%E6%96%B0%E7%9A%84%60rt_mutex_next_owner()%20%7C%20FUTEX_WAITERS%60%0A2.%20%60list_del_init(%26pi_state-%3Elist)%60%EF%BC%9A%E5%B0%86list%E4%BB%8E%E5%8E%9F%E5%85%88%E7%9A%84%E8%A1%A8%E4%B8%8A%E5%88%A0%E9%99%A4%EF%BC%8C%E5%B9%B6%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8C%E5%87%86%E5%A4%87%E7%A7%BB%E5%88%B0%E5%85%B6%E4%BB%96%E7%9A%84%E8%A1%A8%E4%B8%8A%E3%80%82%0A3.%20%60list_add(%26pi_state-%3Elist%2C%20%26new_owner-%3Epi_state_list)%60%0A4.%20%60pi_state-%3Eowner%20%3D%20new_owner%60%0A5.%20%60__rt_mutex_futex_unlock%60%0A6.%20%60rt_mutex_postunlock%60%0A%0A%23%23%23%23%20mark_wakeup_next_waiter%0A%0A%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%AD%A4%E6%97%B6pi_state-%3Eowner%E5%B7%B2%E7%BB%8F%E8%AE%BE%E7%BD%AE%E8%BF%87%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AFpi_state-%3Epi_mutex-%3Eowner%E8%BF%98%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AE%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%BB%E8%A6%81%E5%81%9A%E4%BA%86%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%BB%B6%E4%BA%8B%E6%83%85%EF%BC%9A%0A%0A1.%20%60rt_mutex_dequeue_pi(current%2C%20waiter)%3B%60%0A2.%20%60rt_mutex_adjust_prio(current)%60%3A%E5%9C%A8%E8%BF%99%E9%87%8C%E8%B0%83%E6%95%B4%E4%BA%86%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%AE%8C%E6%88%90%E4%BA%86%E6%95%B4%E4%B8%AA%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E5%8D%8F%E8%AE%AE%E3%80%82%0A3.%20%60wake_q_add(wake_q%2C%20waiter-%3Etask)%60%0A%0A%23%23%23%23%20put_pi_state%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%98%AF%E6%B8%85%E7%90%86%E5%B7%A5%E4%BD%9C%3A%0A%0A1.%20%E8%B0%83%E7%94%A8%E4%BA%86%60rt_mutex_proxy_unlock%60%E6%9D%A5%E9%87%8A%E6%94%BEpi_state-%3Epi_mutex.%0A2.%20%E9%87%8A%E6%94%BE%E4%BA%86current-%3Epi_state_cache%E7%A9%BA%E9%97%B4%0A%0A%3E**cmpxchg_futex_value_locked%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C**%0A%3E%0A%3E%60%60%60c%0A%3Estatic%20int%20cmpxchg_futex_value_locked(u32%20*uval%2C%20u32%20__user%20*uaddr%2C%0A%3E%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%20%20u32%20oldval%2C%20u32%20newval)%0A%3E%7B%0A%3EATOMIC()%3B%0A%3Eint%20val%20%3D%20*uaddr%3B%0A%3Eif%20(val%20%3D%3D%20oldval)%20%7B%0A%3E*uaddr%20%3D%20newval%3B%0A%3E%7D%0A%3E*uval%20%3D%20val%3B%0A%3EEND_ATOMIC()%3B%0A%3Ereturn%200%3B%0A%3E%7D%0A%3E%0A%3E%E5%85%B6%E4%B8%ADATOMIC%E6%93%8D%E4%BD%9C%E9%80%9A%E8%BF%87page_disable()%E5%92%8Cpreempt_disable()%E4%BF%9D%E8%AF%81%E3%80%82%0A%3E%60%60%60%0A%0A%23%23%20__rt_mutex_start_proxy_lock%0A%0A%E4%BB%8E%E4%B8%8A%E9%9D%A2futex_lock_pi%E7%94%A8%E5%88%B0%E7%9A%84rt_mutex%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D%E4%B8%AD%E5%8F%AF%E7%9F%A5%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%98%AF%E6%95%B4%E4%B8%AAPI%E5%A4%84%E7%90%86%E7%9A%84%E6%A0%B8%E5%BF%83%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%88%E4%B8%BB%E8%A6%81%E8%B0%83%E7%94%A8task_blocks_on_rt_mutex%E6%9D%A5%E5%A4%84%E7%90%86PI%E3%80%82%0A%0A!%5B692787b6adf4be8b04b3aa57c3612c37.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5793)%0A%0A%0A%23%23%23%23%20rt_mutex_adjust_prio(owner)%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%B1%E6%98%AF%E8%B0%83%E6%95%B4%E9%98%BB%E5%A1%9E%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E3%80%82%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E4%B9%9F%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%9A%0A%0A%60%60%60c%0Aif%20(task_has_pi_waiters(p))%0A%E2%80%BA%20%20%20pi_task%20%3D%20task_top_pi_waiter(p)-%3Etask%3B%0A%0Art_mutex_setprio(p%2C%20pi_task)%3B%0A%60%60%60%0A%0A%E6%8A%8Aowner%E7%BA%BF%E7%A8%8B%E8%AE%BE%E7%BD%AE%E4%B8%BAowner%E7%BA%BF%E7%A8%8B%E6%89%80%E6%9C%89waiter(%E5%8F%AF%E8%83%BD%E6%9D%A5%E8%87%AA%E5%A4%9A%E4%B8%AA%E9%94%81)%E7%9A%84%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%0A%0A%23%23%23%23%20rt_mutex_adjust_prio_chain%0A%0A%23%23%23%23%23%20%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E8%BF%99%E4%B8%AA%E9%93%BE%E5%BC%8F%E8%B0%83%E6%95%B4%EF%BC%9F%0A!%5Bc4badef8862a4db7fb98b88635d31ecb.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5794)%0A%0A%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%A4%E5%BC%A0%E8%A1%A8%E6%A0%BC%EF%BC%9A%0A%0A-%20%E6%AF%8F%E4%B8%AArt_mutex%E6%9C%89%E5%BC%A0waiters%E8%A1%A8%E6%A0%BC%EF%BC%8C%E8%A1%A8%E7%A4%BA%E6%89%80%E6%9C%89%E7%AD%89%E5%BE%85%E7%9A%84%E7%BA%BF%E7%A8%8B%0A%0A-%20%E6%AF%8F%E4%B8%AAtask%E4%B9%9F%E6%9C%89%E5%BC%A0%E8%A1%A8%E6%A0%BC%EF%BC%8C%E8%A1%A8%E6%A0%BC%E9%87%8C%E7%9A%84%E6%AF%8F%E4%B8%80%E9%A1%B9%E5%AF%B9%E5%BA%94owner%E7%BA%BF%E7%A8%8B%E5%8D%A0%E6%9C%89%E7%9A%84%E9%94%81%EF%BC%8C%E6%AF%8F%E4%B8%80%E9%A1%B9%E6%98%AF%E4%B8%80%E4%B8%AArt_mutex_waiter%EF%BC%8C%E8%A1%A8%E7%A4%BA%E7%94%B3%E8%AF%B7%E8%AF%A5%E9%94%81%E7%9A%84%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7waiter%0A%0A%E5%81%87%E8%AE%BETask1%E5%B0%B1%E6%98%AFowner%EF%BC%8CTask0%E5%AF%B9Lock0%E7%9A%84%E7%94%B3%E8%AF%B7%E5%AF%BC%E8%87%B4Task1%E6%8F%90%E5%8D%87%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%A6%82%E6%9E%9CTask1%E5%90%8C%E6%97%B6%E8%A2%ABTask2%E6%8C%81%E6%9C%89%E7%9A%84%E6%9F%90%E4%B8%AA%E9%94%81%E9%98%BB%E5%A1%9E%EF%BC%8C%E5%88%99Task1%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E6%94%B9%E5%8F%98%EF%BC%8C%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4Task2%20pi_waiters%E5%88%97%E8%A1%A8%E6%94%B9%E5%8F%98%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4Task2%E4%BC%98%E5%85%88%E7%BA%A7%E6%94%B9%E5%8F%98%E3%80%82%E4%BE%9D%E6%AD%A4%E7%B1%BB%E6%8E%A8%EF%BC%8C%E5%B0%B1%E4%BC%9A%E5%AF%BC%E8%87%B4%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%BF%99%E7%A7%8D%E9%93%BE%E5%BC%8F%E5%8F%8D%E5%BA%94%E3%80%82%0A%0A%0A%0A%23%23%23%23%23%20%E9%93%BE%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%0A%E6%95%B4%E4%B8%AAchain%E7%9A%84%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%A4%A7%E8%87%B4%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A1.%20%E5%A6%82%E6%9E%9CTask0%E6%98%AFLock0%E7%9A%84top%20waiter%EF%BC%8C%E5%88%99%E6%BF%80%E5%8F%91%E8%AF%A5%E9%93%BE%E5%BC%8F%E8%B0%83%E6%95%B4%E3%80%82%0A2.%20%E5%9B%A0%E4%B8%BATask0%E6%88%90%E4%B8%BALock0%E7%9A%84topwaiter%EF%BC%8C%E5%88%99Task1%E7%9A%84pi_waiters%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%EF%BC%8C%E5%88%99Task1%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%E3%80%82%E9%80%80%E5%87%BA%E5%8F%AF%E8%83%BD%EF%BC%9A%0A%20%20%20%20-%20%E8%B5%B7%E7%82%B9%E9%94%81%E9%87%8A%E6%94%BE%E4%BA%86%0A%0A%20%20%20%20-%20%E9%93%BE%E7%9A%84%E5%BD%93%E5%89%8D%E7%8E%AF%E8%8A%82%E8%A2%AB%E6%9B%B4%E6%94%B9(%20next_lock%20%E2%89%A0waiter-%3Elock)%0A%0A%20%20%20%20-%20Task1%E6%B2%A1%E6%9C%89%E5%8D%A0%E9%94%81%0A3.%20%E5%A6%82%E6%9E%9CTask1%E4%B9%9Fwait%E5%9C%A8%E6%9F%90%E4%B8%AAlock%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%88%99%E8%AF%A5lock%E7%9A%84waiters%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%EF%BC%8C%E8%BF%99%E9%87%8C%E6%9C%89%E8%8B%A5%E5%B9%B2%E7%A7%8D%E9%80%80%E5%87%BA%E5%8F%AF%E8%83%BD%E3%80%82%0A%0A%20%20-%20Task1%E6%B2%A1%E6%9C%89%E8%A2%ABblock%0A%20%20-%20Task1%20pi_waiters%E4%B8%AD%E6%9C%89%E4%BC%98%E5%85%88%E7%BA%A7%E9%AB%98%E4%BA%8ETask0%E7%9A%84waiter%EF%BC%8C%E6%8D%A2%E5%8F%A5%E8%AF%9D%E8%AF%B4%EF%BC%8Clock0%E7%9A%84top_waiter%E4%B8%8D%E6%98%AFTask1%E7%9A%84top%20pi_waiter%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E4%B8%8D%E9%9C%80%E8%A6%81%E7%BB%A7%E7%BB%AD%E4%BC%A0%E9%80%92%20%0A%20%20-%20%E5%A6%82%E6%9E%9CTask1%E5%9C%A8%E7%94%B3%E8%AF%B7Lock1%20%E7%9A%84%E6%97%B6%E5%80%99%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88%E8%BF%99%E4%B8%AA%E8%AE%B0%E5%BD%95%E5%9C%A8waiter-%3Eprio%E9%87%8C%EF%BC%89%E4%B8%8E%E5%BD%93%E5%89%8D%E8%B0%83%E6%95%B4%E5%90%8E%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E7%9B%B8%E7%AD%89%EF%BC%8C%E5%88%99%E5%90%8E%E7%BB%AD%E6%B2%A1%E5%BF%85%E8%A6%81%E5%9C%A8%E7%BB%A7%E7%BB%AD%E8%B0%83%E6%95%B4%E4%BC%98%E5%85%88%E7%BA%A7%0A%20%20-%20%E6%A3%80%E6%B5%8B%E5%88%B0DEADLOCK%0A4.%20%E5%9B%9E%E5%88%B01%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%EF%BC%8C%E7%9B%B4%E5%88%B0%E9%80%80%E5%87%BA%E9%93%BE%E5%BC%8F%E5%A4%84%E7%90%86%0A%0A%23%23%23%23%23%20%E6%AD%BB%E9%94%81%0A%0A%E6%9C%893%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%8C%E5%87%BD%E6%95%B0%E4%BC%9A%E8%BF%94%E5%9B%9E%E6%AD%BB%E9%94%81%0A%0A-%20%E9%93%BE%E4%B8%8A%E8%B6%85%E8%BF%871024%E4%B8%AA%E9%94%81%E8%8A%82%E7%82%B9%0A-%20%E9%93%BE%E4%B8%8A%E4%BB%BB%E6%84%8FTask%E8%8A%82%E7%82%B9%E7%94%B3%E8%AF%B7%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%94%81%E8%8A%82%E7%82%B9%EF%BC%8C%E5%8D%B3Lock0%0A-%20%E9%93%BE%E4%B8%8A%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E9%94%81owner%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AATask%E8%8A%82%E7%82%B9%EF%BC%8C%E5%8D%B3Task0%0A%0A%0A%23%23%20%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%0A%0A%5C%5B1%5D%20%5BMutex%20mutandis%3A%20understanding%20mutex%20types%20and%20attributes%5D.%20(http%3A%2F%2F2net.co.uk%2Ftutorial%2Fmutex_mutandis)%0A%0A%5C%5B2%5D%20%5BPOSIX%20Revision%20of%20IEEE%20Std%201003.1-2008%5D(http%3A%2F%2Fpubs.opengroup.org%2Fonlinepubs%2F9699919799%2Ffunctions%2Fcontents.html)%0A%0A%5C%5B3%5D%20%5BSource%20code%20analysis%20of%20pthread_mutex_lock%5D(https%3A%2F%2Fzihan.me%2F2018%2F08%2F15%2Fsource-code-analysis-pthread-mutex-lock%2F)%0A%0A%5C%5B4%5D%20%5Blinux%20pi_futex%E6%B5%85%E6%9E%90%5D(https%3A%2F%2Fyq.aliyun.com%2Farticles%2F6044)%0A%0A%5C%5B5%5D%20Linux%204.20-rc3%20source%20code%0A%0A%5C%5B6%5D%20glibc%202.28%20source%20code%0A&lt;/center&gt; ]]></description>
        </item>
    </channel>
</rss>
