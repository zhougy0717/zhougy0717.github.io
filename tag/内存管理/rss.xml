<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>Big Ben • Posts by &#34;内存管理&#34; tag</title>
        <link>https://blog.zhougy.top</link>
        <description></description>
        <language>en</language>
        <pubDate>Sat, 16 Feb 2013 12:14:01 +0800</pubDate>
        <lastBuildDate>Sat, 16 Feb 2013 12:14:01 +0800</lastBuildDate>
        <category>javascript</category>
        <category>angular</category>
        <category>操作系统</category>
        <category>arm</category>
        <category>单片机</category>
        <category>machine learning</category>
        <category>deep learning</category>
        <category>Linux</category>
        <category>内存管理</category>
        <category>Markdown</category>
        <category>python</category>
        <category>win32com</category>
        <category>nas</category>
        <category>synology</category>
        <category>USB</category>
        <category>Linux Device Drivers</category>
        <category>uboot</category>
        <category>http</category>
        <category>同步</category>
        <category>算法</category>
        <category>读书笔记</category>
        <category>程序员修炼之道</category>
        <category>c/c++</category>
        <category>capability</category>
        <category>LD_PRELOAD</category>
        <category>UT</category>
        <category>TDD</category>
        <category>C++</category>
        <category>coding</category>
        <category>SELinux</category>
        <category>hexo</category>
        <category>印象笔记</category>
        <category>Obsidian</category>
        <category>Android</category>
        <category>xposed</category>
        <category>GitHub</category>
        <category>中断处理</category>
        <category>群晖</category>
        <category>docker</category>
        <category>ttrss</category>
        <category>rsshub</category>
        <category>wallabag</category>
        <category>unittest</category>
        <category>mockito</category>
        <category>powermock</category>
        <category>QT</category>
        <category>nlp</category>
        <category>vim</category>
        <category>SpaceVim</category>
        <category>tmux</category>
        <category>面向对象</category>
        <category>promise</category>
        <category>mongodb</category>
        <category>Programming</category>
        <category>security</category>
        <category>C++11</category>
        <category>IoT</category>
        <category>broadlink</category>
        <category>domoticz</category>
        <category>UML</category>
        <category>socket</category>
        <category>iptables</category>
        <category>neural network</category>
        <category>mock</category>
        <category>深度学习</category>
        <category>schedule algorithm</category>
        <category>glibc</category>
        <category>gtest</category>
        <category>gmock</category>
        <category>golang</category>
        <category>elf</category>
        <category>软件开发</category>
        <category>设计模式</category>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2013/02/16/swap_cache/</guid>
            <title>swap cache</title>
            <link>https://blog.zhougy.top/2013/02/16/swap_cache/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sat, 16 Feb 2013 12:14:01 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;span style=&#34;line-height: 22.390625px; background-color: rgb(255, 255, 255);&#34;&gt;1.&amp;#x4EC0;&amp;#x4E48;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;swap&amp;#xFF1F;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x6362;&amp;#x51FA;&lt;span style=&#34;line-height: 22px;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5F53;&amp;#x5185;&amp;#x6838;&amp;#x5728;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x65F6;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;__alloc_pages&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x7A7A;&amp;#x95F2;&amp;#x9875;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x4F1A;&amp;#x542F;&amp;#x52A8;&amp;#x9875;&amp;#x9762;&amp;#x4EA4;&amp;#x6362;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;try_to_free_pages&amp;#x3002;&amp;#x4EE3;&amp;#x7801;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1293 &amp;#xA0; &amp;#xA0;page = get_page_from_freelist(gfp_mask, order,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1294&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zonelist, ALLOC_NO_WATERMARKS);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1295&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (page)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1296&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto got_pg;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1306 &amp;#xA0; &amp;#xA0;if (!w ait)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1307&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto nopage;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1316&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1317&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; did_some_progress = try_to_free_pages(zonelist-&amp;gt;zones, gfp_mask);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5206;&amp;#x914D;&amp;#x8005;&amp;#x5141;&amp;#x8BB8;&amp;#x7B49;&amp;#x5F85;&amp;#xFF0C;&amp;#x5219;&amp;#x4F1A;&amp;#x5F00;&amp;#x59CB;&amp;#x56DE;&amp;#x6536;&amp;#x9875;&amp;#x9762;&amp;#x3002;&amp;#x518D;&amp;#x5F80;&amp;#x4E0B;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x5173;&amp;#x7CFB;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;try_to_free_pages-&amp;gt;shrink_zones-&amp;gt;shrink_zone-&amp;gt;shrink_inactive_list-&amp;gt;add_to_swap-&amp;gt;pageout-&amp;gt;(swapper_space.a_ops-&amp;gt;writepage)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6700;&amp;#x7EC8;&amp;#x8C03;&amp;#x7528;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x5C06;page&amp;#x5199;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4EA4;&amp;#x6362;&amp;#x5206;&amp;#x533A;&amp;#x7684;swap file&amp;#x4E0A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;&amp;#x6362;&amp;#x5165;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5F53;&amp;#x5F15;&amp;#x53D1;&amp;#x7F3A;&amp;#x9875;&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x8C03;&amp;#x7528;handle_pte_fault&amp;#xFF0C;&amp;#x5F53;&amp;#x68C0;&amp;#x6D4B;&amp;#x5230;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;!pte_present(entry) &amp;lt;=&amp;gt; (pte_val(pte) &amp;amp; L_PTE_PRESENT == 0)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6B64;&amp;#x65F6;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;do_swap_page-&amp;gt;read_swap_cache_async-&amp;gt;swap_readpage&amp;#x6765;&amp;#x8BFB;&amp;#x5165;&amp;#x6362;&amp;#x51FA;&amp;#x7684;&amp;#x9875;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x65B0;&amp;#x7684;&amp;#x4E00;&amp;#x9875;&amp;#xFF0C;&amp;#x539F;&amp;#x5148;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x4F1A;&amp;#x91CA;&amp;#x653E;&amp;#x6210;hot page&amp;#x5230;&amp;#x4F19;&amp;#x4F34;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.swap&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap&amp;#x5C31;&amp;#x662F;&amp;#x4EA4;&amp;#x6362;&amp;#xFF0C;&amp;#x6BCF;&amp;#x6B21;&amp;#x9700;&amp;#x8981;&amp;#x4EA4;&amp;#x6362;&amp;#x54EA;&amp;#x4E9B;&amp;#xFF0C;&amp;#x548C;linux&amp;#x7684;&amp;#x9875;&amp;#x56DE;&amp;#x6536;&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8457;&amp;#x540D;&amp;#x7684;LRU&amp;#x7B97;&amp;#x6CD5;&amp;#xFF0C;&amp;#x6709;&amp;#x4E9B;&amp;#x76F8;&amp;#x4F3C;&amp;#x3002;&amp;#x5F7C;&amp;#x662F;&amp;#x51B3;&amp;#x5B9A;&amp;#x8981;&amp;#x56DE;&amp;#x6536;&amp;#x54EA;&amp;#x4E9B;&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x6211;&amp;#x4EEC;&amp;#x4E5F;&amp;#x63D0;&amp;#x5230;&amp;#x8FC7;LRU&amp;#x8FD9;&amp;#x4E2A;&amp;#x540D;&amp;#x8BCD;&amp;#x3002;&amp;#x73B0;&amp;#x5728;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x4ED6;&amp;#x5230;&amp;#x5E95;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x4EC0;&amp;#x4E48;&amp;#x6837;&amp;#x7684;&amp;#x7B97;&amp;#x6CD5;&amp;#x4E86;&amp;#x3002;LRU = Least Recently Used&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;a href=&#34;http://blog.csdn.net/antfang/article/details/5751786&#34;&gt;LRU&amp;#x7B97;&amp;#x6CD5;&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4EA4;&amp;#x6362;&amp;#x7B97;&amp;#x6CD5;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5BF9;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x65B0;&amp;#x65E7;&amp;#x7A0B;&amp;#x5EA6;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x5F04;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x77E5;&amp;#x9053;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;list&amp;#xFF1A;active_list &amp;amp; inactive_list&amp;#x3002;&amp;#x6BCF;&amp;#x6B21;try_to_free_pages&amp;#x5728;&amp;#x4EA4;&amp;#x6362;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C06;active page&amp;#x653E;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x5230;inactive list&amp;#xFF0C;&amp;#x518D;&amp;#x5C06;inactive page&amp;#x91CA;&amp;#x653E;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x3002;&amp;#x5176;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x662F;&amp;#x4E0A;&amp;#x9762;&amp;#x63D0;&amp;#x5230;&amp;#x7684;shrink_zone&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&amp;#x6765;&amp;#x770B;try_to_free_pages&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;for (priority = DEF_PRIORITY; priority &amp;gt;= 0; priority--) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nr_reclaimed += shrink_zones(priority, zones, &amp;amp;sc);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;shrink_slab(sc.nr_scanned, gfp_mask, lru_pages);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;priority&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x5176;&amp;#x5B9E;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;&amp;#x6BCF;&amp;#x6B21;&amp;#x5C3D;&amp;#x91CF;&amp;#x5C11;&amp;#x7684;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FDD;&amp;#x8BC1;&amp;#x901F;&amp;#x7387;&amp;#x3002;&amp;#x5230;shrink_zone&amp;#x91CC;&amp;#x9762;&amp;#x6709;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;font color=&#34;#2D4FC9&#34;&gt;zone-&amp;gt;nr_scan_active +=&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;(zone_page_state(zone, NR_ACTIVE) &amp;gt;&amp;gt; priority) + 1;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E00;&amp;#x6BB5;&amp;#x6211;&amp;#x4E00;&amp;#x5EA6;&amp;#x770B;&amp;#x4E86;&amp;#x597D;&amp;#x4E45;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4E0D;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x6B7B;&amp;#x3002;&amp;#x4ED6;&amp;#x53EA;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E00;&amp;#x6B65;&amp;#x6B65;&amp;#x589E;&amp;#x52A0;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&amp;#x5F53;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;priority&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;= 12~1&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x626B;&amp;#x63CF;&amp;#x6570;&amp;#x91CF;&amp;#x6BCF;&amp;#x6B21;&amp;#x589E;&amp;#x52A0;zone-&amp;gt;nr_active/(2^priority)&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x5230;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;priority&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;=1&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&lt;/span&gt;nr_scan_active&amp;#x4ECD;&amp;#x7136;&amp;#x6CA1;&amp;#x8FBE;&amp;#x5230;sc-&amp;gt;swap_cluster_max&amp;#xFF08;32&amp;#xFF09;&amp;#x7684;&amp;#x8BDD;&amp;#xFF0C;&amp;#x5373;scan&amp;#x7684;&amp;#x603B;&amp;#x6570;&amp;#x7684;&amp;#x7406;&amp;#x8BBA;&amp;#x503C;&amp;#x4E3A;zone-&amp;gt;nr_active*(1-1/(2^12))&amp;#xFF0C;&amp;#x5219;priority=0&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;scan&amp;#x603B;&amp;#x6570;&amp;#x5C06;&amp;#x8D85;&amp;#x8FC7;zone-&amp;gt;nr_active&amp;#x7684;&amp;#x603B;&amp;#x6570;&amp;#x3002;&amp;#x90A3;&amp;#x662F;&amp;#x4E0D;&amp;#x662F;&amp;#x5C31;&amp;#x6709;&amp;#x95EE;&amp;#x9898;&amp;#x4E86;&amp;#x5462;&amp;#xFF1F;&amp;#x5F53;&amp;#x7136;&amp;#x4E0D;&amp;#x662F;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x540E;&amp;#x9762;&amp;#x518D;&amp;#x505A;&amp;#x9875;&amp;#x9762;&amp;#x8F6C;&amp;#x79FB;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x68C0;&amp;#x6D4B;&amp;#x6807;&amp;#x51C6;&amp;#x662F;list_empty&amp;#xFF0C;&amp;#x4E0D;&amp;#x4F1A;&amp;#x64CD;&amp;#x4F5C;&amp;#x8D85;&amp;#x8FC7;&amp;#x5217;&amp;#x8868;&amp;#x8303;&amp;#x56F4;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;shrink_zone&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/* &amp;#x6839;&amp;#x636E;priority&amp;#x6765;&amp;#x51B3;&amp;#x5B9A;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#xFF0C;inactive&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x91C7;&amp;#x7528;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x83B7;&amp;#x5F97;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;* &amp;#x81F3;&amp;#x5C11;&amp;#x8981;&amp;#x4FDD;&amp;#x8BC1;sc-&amp;gt;swap_cluster_max&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x5373;32&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;*/&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;918&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;nr_scan_active +=&lt;br&gt;919&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; (zone_page_state(zone, NR_ACTIVE) &amp;gt;&amp;gt; priority) + 1;&lt;br&gt;920&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_active = zone-&amp;gt;nr_scan_active;&lt;br&gt;921&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (nr_active &amp;gt;= sc-&amp;gt;swap_cluster_max)&lt;br&gt;922&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;nr_scan_active = 0;&lt;br&gt;923&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;br&gt;924&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_active = 0;&lt;br&gt;925&lt;br&gt;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;br&gt;933&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;nr_active: &amp;#x4ECE;active&amp;#x8F6C;&amp;#x5230;inactive&amp;#x5217;&amp;#x8868;&amp;#x4E0A;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6570;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;nr_inactive: &amp;#x4ECE;inactive&amp;#x5217;&amp;#x8868;&amp;#x6362;&amp;#x51FA;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6570;&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;934&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; while (nr_active || nr_inactive) {&lt;br&gt;935&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (nr_active) {&lt;br&gt;936&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_to_scan = min(nr_active,&lt;br&gt;937&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; (unsigned long)sc-&amp;gt;swap_cluster_max);&lt;br&gt;938&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_active -= nr_to_scan;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;939&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; shrink_active_list(nr_to_scan, zone, sc, priority);&lt;br&gt;940&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;941&lt;br&gt;942&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (nr_inactive) {&lt;br&gt;943&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_to_scan = min(nr_inactive,&lt;br&gt;944&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; (unsigned long)sc-&amp;gt;swap_cluster_max);&lt;br&gt;945&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_inactive -= nr_to_scan;&lt;br&gt;946&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_reclaimed += shrink_inactive_list(nr_to_scan, zone,&lt;br&gt;947&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sc);&lt;br&gt;948&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;949&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3&amp;#xFF09;shrink_inactive_list&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5DF2;&amp;#x7ECF;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;shrink_inactive_list&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x626B;&amp;#x63CF;&amp;#x4F20;&amp;#x5165;&amp;#x7684;nr_to_scan&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x518D;&amp;#x5C06;&amp;#x5408;&amp;#x9002;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6362;&amp;#x51FA;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#xFF0C;&amp;#x5E76;&amp;#x8FD4;&amp;#x56DE;&amp;#x6362;&amp;#x51FA;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6570;&amp;#x3002;&amp;#x5176;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027008&#34; hash=&#34;0d7d10ac0843681ee240a2949d8e2eef&#34; align alt longdesc width=&#34;768&#34; height=&#34;306&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x662F;&amp;#x4E0D;&amp;#x662F;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x6CA1;&amp;#x9519;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x8FD9;&amp;#x4E48;&amp;#x7B80;&amp;#x5355;&amp;#x3002;isolate_lru_pages&amp;#x8D1F;&amp;#x8D23;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#x7684;struct page&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&amp;#x5176;flags&amp;#x6765;&amp;#x51B3;&amp;#x5B9A;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x4EE5;&amp;#x6362;&amp;#x51FA;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x6362;&amp;#x51FA;&amp;#x7684;&amp;#x653E;&amp;#x5230;&amp;#x8F93;&amp;#x51FA;&amp;#x5217;&amp;#x8868;&amp;#x4E0A;&amp;#xFF0C;&amp;#x4EE5;&amp;#x5907;shrink_page_list&amp;#x6765;&amp;#x505A;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x6362;&amp;#x51FA;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;4&amp;#xFF09;shrink_page_list&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5176;&amp;#x4E3B;&amp;#x7EBF;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027018&#34; hash=&#34;16f5dc62bc972f71ccf3912bd9d6bff5&#34; align alt longdesc width=&#34;584&#34; height=&#34;782&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E00;&amp;#x7CFB;&amp;#x5217;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x9875;&amp;#x9762;&amp;#x6362;&amp;#x51FA;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x7528;__pagevec_release_nonlru(&amp;amp;freed_pvec)&amp;#x5C06;&amp;#x9875;&amp;#x9762;&amp;#x91CA;&amp;#x653E;&amp;#x56DE;buddy system&amp;#xFF0C;&amp;#x6CE8;&amp;#x610F;&amp;#x5728;&amp;#x521B;&amp;#x5EFA;freed_pvec&amp;#x65F6;&amp;#xFF0C;&amp;#x6307;&amp;#x5B9A;&amp;#x4E86;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x4E3A;cold&amp;#x3002;&amp;#x6574;&amp;#x4E2A;&amp;#x7B97;&amp;#x6CD5;&amp;#x7684;&amp;#x7CBE;&amp;#x9AD3;&amp;#xFF0C;&amp;#x5728;&amp;#x4E8E;&amp;#x54EA;&amp;#x4E9B;inactive&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x4E0D;&amp;#x53EF;&amp;#x4EE5;&amp;#x6362;&amp;#x51FA;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5148;&amp;#x770B;&amp;#xFF0C;shrink_page_list&amp;#x4E2D;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x6807;&amp;#x53F7;&lt;/div&gt;&lt;div&gt;keep&amp;#xFF1A;&amp;#x76F4;&amp;#x63A5;&amp;#x5C06;&amp;#x9875;&amp;#x9762;add&amp;#x56DE;page_list&lt;/div&gt;&lt;div&gt;keep_locked&amp;#xFF1A;&amp;#x6307;&amp;#x8BE5;&amp;#x9875;&amp;#x9762;&amp;#x5DF2;&amp;#x7ECF;&amp;#x88AB;lock&amp;#x4E86;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x89E3;&amp;#x9501;&amp;#x518D;&amp;#x8FDB;&amp;#x5165;keep&amp;#x6807;&amp;#x53F7;&lt;/div&gt;&lt;div&gt;activate_locked&amp;#xFF1A;&amp;#x5C06;&amp;#x9875;&amp;#x9762;&amp;#x6FC0;&amp;#x6D3B;&amp;#xFF0C;&amp;#x518D;&amp;#x653E;&amp;#x56DE;page_list&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5728;&amp;#x540E;&amp;#x7EED;&amp;#xFF0C;&amp;#x8BE5;&amp;#x9875;&amp;#x9762;&amp;#x4F1A;&amp;#x88AB;&amp;#x653E;&amp;#x5165;active list&lt;/div&gt;&lt;div&gt;free_it&amp;#xFF1A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x662F;&amp;#x6B63;&amp;#x5E38;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x9875;&amp;#x9762;&amp;#x4F1A;&amp;#x88AB;&amp;#x91CA;&amp;#x653E;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8FDB;&amp;#x5165;&amp;#x626B;&amp;#x63CF;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x4EE5;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#xFF0C;&amp;#x51E1;&amp;#x662F;&amp;#x7ECF;&amp;#x8FC7;&amp;#x5224;&amp;#x65AD;&amp;#x540E;&amp;#xFF0C;&amp;#x8981;&amp;#x8C03;&amp;#x8F6C;&amp;#x5230;&amp;#x4EE5;&amp;#x4E0A;&amp;#x524D;&amp;#x4E09;&amp;#x4E2A;&amp;#x6807;&amp;#x53F7;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E9B;&amp;#x9875;&amp;#x9762;&amp;#x90FD;&amp;#x662F;&amp;#x4E0D;&amp;#x4F1A;&amp;#x88AB;&amp;#x6362;&amp;#x51FA;&amp;#x91CA;&amp;#x653E;&amp;#x7684;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x6709;&amp;#x4EE5;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E9B;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a.&amp;#xA0;!sc-&amp;gt;may_swap &amp;amp;&amp;amp; page_mapped(page)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b.&amp;#xA0;PageWriteback(page)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;c.&amp;#xA0;PageDirty(page) &amp;amp;&amp;amp;&amp;#xA0;page_referenced(page, 1)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;d.&amp;#xA0;PageDirty(page) &amp;amp;&amp;amp;&amp;#xA0;!may_enter_fs&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;e.&amp;#xA0;PageDirty(page) &amp;amp;&amp;amp;&amp;#xA0;!sc-&amp;gt;may_writepage&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x63A5;&lt;a href=&#34;https://www.google.com.hk/url?sa=t&amp;amp;amp;rct=j&amp;amp;amp;q=&amp;amp;amp;esrc=s&amp;amp;amp;source=web&amp;amp;amp;cd=2&amp;amp;amp;ved=0CD4QFjAB&amp;amp;amp;url=%68%74%74%70%3a%2f%2f%77%77%77%2e%34%75%63%6f%64%65%2e%63%6f%6d%2f%53%74%75%64%79%2f%54%6f%70%69%63%2f%31%34%37%33%37%35%34&amp;amp;amp;ei=uoIkUcrgKIiuiQeZ8YDoCA&amp;amp;amp;usg=AFQjCNEOl8IlmiO6gZG3632d58gOlDaxkA&amp;amp;amp;sig2=7PgH7HVDHgF5OF-ko0qESA&#34; target=&#34;_blank&#34;&gt;Linux&amp;#x8FDB;&amp;#x7A0B;&amp;#x8C03;&amp;#x5EA6;&amp;#x5207;&amp;#x6362;&amp;#x548C;&amp;#x865A;&amp;#x62DF;&amp;#x7A7A;&amp;#x95F4;&amp;#x7BA1;&amp;#x7406;&amp;#x6DF1;&amp;#x5165;&amp;#x5206;&amp;#x6790;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x591A;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;page-&amp;gt;mapping&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;page_mapping, page_mapped&amp;#x3002;&amp;#x7B80;&amp;#x5355;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E00;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x5176;&amp;#x53D6;&amp;#x503C;&amp;#x6709;&amp;#x4EE5;&amp;#x4E0B;&amp;#x4E09;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x3002;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x63A5;&lt;a href=&#34;http://blog.chinaunix.net/uid-24517893-id-404640.html&#34;&gt;Linux&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x4E2D;address_space&amp;#x7591;&amp;#x60D1;&amp;#x53CA;&amp;#x89E3;&amp;#x7B54;&lt;/a&gt;&lt;span&gt;&amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;#xFF08;1&amp;#xFF09;swapper_space&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span&gt;&amp;#x5982;&amp;#x679C;page-&amp;gt;mapping&amp;#x7B49;&amp;#x4E8E;0&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x8BE5;&amp;#x9875;&amp;#x5C5E;&amp;#x4E8E;&amp;#x4EA4;&amp;#x6362;&amp;#x544A;&amp;#x8BC9;&amp;#x7F13;&amp;#x5B58;swap cache&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;#xFF08;2&amp;#xFF09;anon_vma&amp;#xFF1A;&amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span&gt;&amp;#x5982;&amp;#x679C;page-&amp;gt;mapping&amp;#x4E0D;&amp;#x7B49;&amp;#x4E8E;0&amp;#xFF0C;&amp;#x4F46;&amp;#x7B2C;0&amp;#x4F4D;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x8BE5;&amp;#x9875;&amp;#x4E3A;&amp;#x533F;&amp;#x540D;&amp;#x4E5F;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;mapping&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;struct anon_vma&amp;#x7ED3;&amp;#x6784;&amp;#x53D8;&amp;#x91CF;&amp;#xFF1B;&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;#xFF08;3&amp;#xFF09;address_space&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span&gt;&amp;#x5982;&amp;#x679C;page-&amp;gt;mapping&amp;#x4E0D;&amp;#x7B49;&amp;#x4E8E;0&amp;#xFF0C;&amp;#x4F46;&amp;#x7B2C;0&amp;#x4F4D;&amp;#x4E0D;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x5219;mapping&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;struct address_space&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x7ED3;&amp;#x6784;&amp;#x53D8;&amp;#x91CF;&amp;#xFF1B;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;5&amp;#xFF09;swap cache&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0A;&amp;#x9762;&amp;#x7B80;&amp;#x8FF0;&amp;#x4E86;linux&amp;#x9875;&amp;#x7F13;&amp;#x51B2;&amp;#x4EA4;&amp;#x6362;&amp;#x673A;&amp;#x5236;&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x56DE;&amp;#x5230;swap cache&amp;#x8FD9;&amp;#x4E00;&amp;#x57FA;&amp;#x672C;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0A;&amp;#x6765;&amp;#x3002;gorman&amp;#x7684;&amp;#x4E66;&amp;#x91CC;&amp;#x9762;&amp;#x8BB2;&amp;#x5F97;&amp;#x5F88;&amp;#x6E05;&amp;#x695A;&amp;#x4E86;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x7B14;&amp;#x8BB0;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-size: 15px;&#34;&gt;&lt;i&gt;&lt;font color=&#34;#FA7A00&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6709;swap cache&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E1C;&amp;#x897F;&amp;#xFF1F;&lt;/font&gt;&lt;/i&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x56E0;&amp;#x4E3A;A signi&amp;#xFB01;cant number of the&amp;#xA0;pages referenced by a process early in its life may only be used for initialization and&amp;#xA0;then never used again. It is better to swap out those pages and create more disk&lt;/div&gt;bu&amp;#xFB00;ers than leave them resident and unused.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &lt;span style=&#34;font-size: 15px;&#34;&gt;&lt;i&gt;&lt;font color=&#34;#FA7A00&#34;&gt;&amp;#xA0;swap cache vs. page cache&lt;/font&gt;&lt;/i&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;The swap cache is purely&amp;#xA0;conceptual because it is simply a specialization of the page cache.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1.&amp;#xA0;in the swap cache rather than the page cache is&amp;#xA0;that pages in the swap cache always use swapper space as their address space in&amp;#xA0;page&amp;#x2192;mapping.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2.&amp;#xA0;pages are added to the swap cache&amp;#xA0;with add_to_swap_cache(),shown in Figure 11.3, instead of add_to_page_cache().&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(250, 122, 0); font-size: 15px;&#34;&gt;&lt;font color=&#34;#000000&#34; size=&#34;3&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x6709;&amp;#x7684;swap file&amp;#x4FE1;&amp;#x606F;&amp;#x90FD;&amp;#x4FDD;&amp;#x5B58;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;static struct swap_info_struct swap_info[MAX_SWAPFILES];&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EF;&amp;#x89C1;swap file&amp;#x6700;&amp;#x591A;&amp;#x53EF;&amp;#x4EE5;&amp;#x6709;MAX_SWAPFILES&amp;#x4E2A;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;32&amp;#x4E2A;&amp;#x3002;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;64 struct swap_info_struct {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;65 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int flags;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;66 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;kdev_t swap_device;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;67 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;spinlock_t sdev_lock;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;68 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;struct dentry * swap_file;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;69 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;struct vfsmount *swap_vfsmnt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;70 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned short * swap_map;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;71 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int lowest_bit;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;72 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int highest_bit;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;73 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int cluster_next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;74 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int cluster_nr;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;75 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;int prio;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;76 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;int pages;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;77 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned long max;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;78 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;int next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;79 };&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap_info&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x865A;&amp;#x62DF;&amp;#x94FE;&amp;#x8868;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x7528;next&amp;#x6307;&amp;#x5411;&amp;#x4E86;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x94FE;&amp;#x8868;&amp;#x6210;&amp;#x5458;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x53F7;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x8868;&amp;#x540C;&amp;#x65F6;&amp;#x7528;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x63CF;&amp;#x8FF0;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x6307;&amp;#x660E;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x8868;&amp;#x7684;&amp;#x5934;&amp;#x5728;&amp;#x54EA;&amp;#x91CC;&amp;#xFF0C;&amp;#x5176;&amp;#x8868;&amp;#x5C3E;&amp;#x6210;&amp;#x5458;&amp;#x7684;next = -1&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;153 struct swap_list_t {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;154 &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;/font&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;int head; /* head of priority-ordered swapfile list */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;155 &amp;#xA0; &amp;#xA0; int next; /* swapfile to be used next */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;156 };&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap area&amp;#x7531;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;swap_info_struct&amp;#x63CF;&amp;#x8FF0;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x547D;&amp;#x4EE4;&amp;#x52A8;&amp;#x6001;&amp;#x7684;&amp;#x589E;&amp;#x52A0;&amp;#x3002;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;swap area&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;swap file&amp;#xFF0C;&amp;#x8BE5;file&amp;#x88AB;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;page size&amp;#x7684;slot&amp;#xFF0C;&amp;#x7B2C;0&amp;#x4E2A;slot&amp;#x88AB;&amp;#x7528;&amp;#x6765;&amp;#x5B58;&amp;#x50A8;swap_header&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;25 union swap_header {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;26&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;struct&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;27&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;28&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;char reserved[PAGE_SIZE - 10];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;29&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;char magic[10];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;30&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;} magic;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;31&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;struct&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;32&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;33&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;char bootbits[1024];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;34&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int version;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;35&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int last_page;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;36&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int nr_badpages;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;37&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int padding[125];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;38&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int badpages[1];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;39&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;} info;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;40 };&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6DFB;&amp;#x52A0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;padding&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x80FD;&amp;#x548C;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;cluster&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;badpages&amp;#x6570;&amp;#x7EC4;&amp;#x9650;&amp;#x5236;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;swap area&amp;#x7684;&amp;#x9875;&amp;#x6570;&amp;#xFF0C;&amp;#x5176;&amp;#x5C3A;&amp;#x5BF8;&amp;#x7531;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x516C;&amp;#x5F0F;&amp;#x5F97;&amp;#x5230;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x6307;&amp;#x5411;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;page&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027013&#34; hash=&#34;14fe0b7c21d8c7aa9f25c571de57b141&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap cache&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x53EB;&amp;#x505A;swp_entry_t&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;unsigned long&amp;#x3002;&amp;#x5F53;&amp;#x9875;&amp;#x9762;&amp;#x88AB;&amp;#x6362;&amp;#x51FA;&amp;#x65F6;&amp;#xFF0C;&amp;#x5176;&amp;#x539F;&amp;#x5148;&amp;#x7684;&amp;#x9875;&amp;#x8868;&amp;#x9879;pte&amp;#x88AB;&amp;#x7528;&amp;#x4E8E;&amp;#x5B58;&amp;#x50A8;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x3002;&amp;#x901A;&amp;#x8FC7;&amp;#x8FD9;&amp;#x4E2A;swp_entry_t&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x53EF;&amp;#x4EE5;&amp;#x5B9A;&amp;#x4F4D;&amp;#x5230;&amp;#x8BE5;&amp;#x9875;&amp;#x6570;&amp;#x636E;&amp;#x88AB;&amp;#x5199;&amp;#x5230;&amp;#x54EA;&amp;#x4E2A;swap area&amp;#x7684;&amp;#x54EA;&amp;#x4E2A;&amp;#x4F4D;&amp;#x7F6E;&amp;#x3002;&amp;#x5176;&amp;#x7EC4;&amp;#x6210;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027021&#34; hash=&#34;bf705025623bd89201ec33f566eb4063&#34; align alt longdesc width=&#34;701&#34; height=&#34;306&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;Type&amp;#x6307;&amp;#x5F15;&amp;#x4E86;&amp;#x54EA;&amp;#x4E2A;swap area&amp;#xFF0C;offset&amp;#x6307;&amp;#x5F15;&amp;#x4E86;&amp;#x8BE5;&amp;#x9875;&amp;#x5728;swap_map&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x7684;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x6539;offset&amp;#x7B97;&amp;#x5F97;swap file&amp;#x4E2D;&amp;#x7684;sector&amp;#x4F4D;&amp;#x7F6E;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;(swapper_space.a_ops-&amp;gt;swap_writepage) -&amp;gt;&amp;#xA0;get_swap_bio -&amp;gt;&amp;#xA0;map_swap_page&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;938&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;for ( ; ; ) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;939&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head *lh;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;940&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/*&amp;#x4E00;&amp;#x76F4;&amp;#x5FAA;&amp;#x73AF;&amp;#x5230;offset&amp;#x843D;&amp;#x5728;&amp;#x8BE5;sector&amp;#x4E2D;*/&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;941&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (se-&amp;gt;start_page &amp;lt;= offset &amp;amp;&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;942&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; offset &amp;lt; (se-&amp;gt;start_page + se-&amp;gt;nr_pages)) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;943&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return se-&amp;gt;start_block + (offset - se-&amp;gt;start_page);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;944&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;945&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; lh = se-&amp;gt;list.next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;946&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (lh == &amp;amp;sis-&amp;gt;extent_list)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;947&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; lh = lh-&amp;gt;next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;948&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; se = list_entry(lh, struct swap_extent, list);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;949&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sis-&amp;gt;curr_swap_extent = se;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;951&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x90A3;&amp;#x4E48;&amp;#x8FD9;&amp;#x4E2A;swap_entry_t&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x6765;&amp;#x7684;&amp;#xFF1F;&amp;#x5176;&amp;#x5B9E;&amp;#x4E5F;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5728;swap_map&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x6328;&amp;#x4E2A;&amp;#x627E;&amp;#xFF0C;first fit&amp;#x6CD5;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x5177;&amp;#x4F53;&amp;#x8FD8;&amp;#x6709;&amp;#x4E9B;&amp;#x6280;&amp;#x5DE7;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5728;&amp;#x641C;&amp;#x7D22;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x6309;&amp;#x7167;cluster&amp;#x7684;&amp;#x8303;&amp;#x56F4;&amp;#x5BFB;&amp;#x627E;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5FAA;&amp;#x73AF;&amp;#x76F4;&amp;#x5230;&amp;#x627E;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x7A7A;&amp;#x7684;cluster&amp;#xFF08;256&amp;#x4E2A;&amp;#x7B49;&amp;#x4E8E;0&amp;#x7684;swap_map&amp;#x6210;&amp;#x5458;&amp;#xFF09;&amp;#x4E3A;&amp;#x6B62;&amp;#xFF0C;&amp;#x76EE;&amp;#x7684;&amp;#x662F;to have pages swapped out at the same time close together on the premise that&amp;#xA0;pages swapped out together are related&amp;#xA0;&amp;#x3002;&lt;div&gt;&lt;span style=&#34;font-family: song, Verdana; font-size: 14px; line-height: 22.390625px; background-color: rgb(255, 255, 255);&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;song, Verdana&#34;&gt;&lt;span style=&#34;font-size: 14px; line-height: 22px;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89-_kmem_cache_create/</guid>
            <title>slab allocator （2）—— kmem_cache_create</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89-_kmem_cache_create/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 20:54:16 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x662F;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x4E4B;&amp;#x4E00;&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;kmalloc&amp;#x7684;&amp;#x540E;&amp;#x76FE;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4F5C;&amp;#x4E3A;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x4F9B;&amp;#x9A71;&amp;#x52A8;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x770B;ldd3&amp;#x7684;chp 8&amp;#x7684;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x4E00;&amp;#x8282;&amp;#xFF08;P217&amp;#xFF09;&amp;#x3002;&amp;#x4ED6;&amp;#x5176;&amp;#x5B9E;&amp;#x548C;&amp;#x6211;&amp;#x4EEC;CPU&amp;#x7684;L1&amp;#xFF0C;L2&amp;#x7F13;&amp;#x5B58;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&amp;#x4ED6;&amp;#x6709;&amp;#x70B9;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;&amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x4E2D;&amp;#x5206;&amp;#x914D;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;size&amp;#x76F8;&amp;#x540C;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E3B;&amp;#x7EBF;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796586&#34; hash=&#34;7c2730c8cad130f3604736abf0582ab5&#34; align alt longdesc width=&#34;687&#34; height=&#34;362&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E3B;&amp;#x7EBF;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;kmem_cache_zalloc&amp;#x5206;&amp;#x914D;kmem_cache&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x79CD;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x52A0;&amp;#x5165;cache_chain&amp;#x4E2D;&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x2014;&amp;#x2014;cache_chain&amp;#x662F;&amp;#x505A;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x73B0;&amp;#x5728;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x6709;&amp;#x7B54;&amp;#x6848;&amp;#x4E86;&amp;#x3002;&amp;#x4ED6;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x7684;kmem_cache&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x9632;&amp;#x6B62;&amp;#x91CD;&amp;#x540D;&amp;#x7684;cache&amp;#x4EA7;&amp;#x751F;&amp;#xFF0C;&amp;#x65B9;&amp;#x4FBF;proc&amp;#x7CFB;&amp;#x7EDF;&amp;#x663E;&amp;#x793A;&amp;#x8C03;&amp;#x8BD5;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;1. kmem_cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x5F53;size &amp;gt;= (PAGE_SIZE &amp;gt;&amp;gt; 3 = 512KB&amp;#x65F6;&amp;#xFF0C;flags |= CFLGS_OFF_SLAB&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;calculate_slab_order(cachep, size, align, flags)&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796244&#34; hash=&#34;10a4a7586d7d29b19d2e2a600adc2ef0&#34; align alt longdesc width=&#34;482&#34; height=&#34;512&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6240;&amp;#x8C13;&amp;#x7684;num&amp;#x4E0E;offslab_limit&amp;#x5C31;&amp;#x662F;&amp;#x4E0B;&amp;#x9762;off-slab&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x7531;&amp;#x6574;&amp;#x5757;2^order&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(num)&amp;#xFF0C;&amp;#x548C;&amp;#x53F3;&amp;#x8FB9;kmem_bufctl_t&amp;#x6570;&amp;#x7EC4;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(offslab_limit)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EA6;&amp;#x675F;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;num&amp;#x8981;&amp;#x5C0F;&amp;#x4E8E;offslab_limit&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x5C0F;&amp;#x4E8E;&amp;#x53F3;&amp;#x8FB9;&amp;#x3002;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x53F3;&amp;#x8FB9;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x7684;&amp;#x7BA1;&amp;#x63A7;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796738&#34; hash=&#34;a6edb8ef026079cb61b86575d2695089&#34; align alt longdesc width=&#34;429&#34; height=&#34;212&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5982;&amp;#x679C;left_over&amp;#x592A;&amp;#x591A;&amp;#xFF0C;&amp;#x8DB3;&amp;#x591F;&amp;#x653E;&amp;#x5F97;&amp;#x4E0B;slab_size&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;off-slab&amp;#x8F6C;&amp;#x53D8;&amp;#x4E3A;on-slab&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;2. off-slab&amp;#x65F6;&amp;#xFF0C;slab mngmt&amp;#x653E;&amp;#x5728;&amp;#x54EA;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8C03;&amp;#x7528;cachep-&amp;gt;slabp_cache = kmem_find_general_cachep(slab_size, 0u)&amp;#xFF0C;&amp;#x53BB;&amp;#x5BFB;&amp;#x627E;&amp;#x8FD9;&amp;#x4E2A;size cache&amp;#x6765;&amp;#x5B58;&amp;#x653E;slab mngmt&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;kmem_find_general_cachep -&amp;gt;&amp;#xA0;__find_general_cachep -&amp;gt; (return malloc_sizes[n]-&amp;gt;cs_cachep)&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;3. CPU cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;setup_cpu_cache(cachep, gfp)&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5148;&amp;#x770B;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796416&#34; hash=&#34;5fac5be0e836af7f4e8bf4ff71375b8d&#34; align alt longdesc width=&#34;902&#34; height=&#34;682&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x6839;&amp;#x636E;g_cpucache_up&amp;#x5206;&amp;#x6210;&amp;#x4E09;&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;FULL&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x7684;cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x90FD;&amp;#x5B8C;&amp;#x6210;&amp;#x4E86;&amp;#xFF0C;setup_cpu_cache&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;enable_cpucache&amp;#x3002;&amp;#x8FD9;&amp;#x4E5F;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x518D;&amp;#x53E6;&amp;#x5F00;&amp;#x65B0;&amp;#x7BC7;&amp;#x4ECB;&amp;#x7ECD;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;PARTIAL_AC/L3&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;&amp;#x6B64;&amp;#x51FD;&amp;#x6570;&amp;#x7684;kmem_cache_create&amp;#x4ECD;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x624D;&amp;#x521A;&amp;#x5F00;&amp;#x59CB;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;struct arracy_cache&amp;#x548C;kmem_list3s&amp;#x7528;&amp;#x5230;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x8FDB;&amp;#x884C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5176;&amp;#x4ED6;cache&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#xFF0C;&amp;#x65E0;&amp;#x6CD5;&amp;#x52A8;&amp;#x6001;&amp;#x5730;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5269;&amp;#x4E0B;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;AC&amp;#x548C;L3&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x597D;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;cache&amp;#x518D;create&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x8C03;&amp;#x7528;kmalloc&amp;#x4E86;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_generic.cache&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC / L3&amp;#x7684;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[SIZE_AC / L3]&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; cache_cache&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_cache&amp;#xFF0C;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[CACHE_CACHE]&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E9B;&amp;#x5728;kmem_cache_init&amp;#x7684;step 4,5&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x91CD;&amp;#x65B0;&amp;#x7528;kmalloc&amp;#x8FDB;&amp;#x884C;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;array_cache&amp;#x4F1A;&amp;#x7528;memcpy&amp;#x5C06;&amp;#x539F;&amp;#x5148;&amp;#x503C;&amp;#x8D4B;&amp;#x5165;&amp;#xFF0C;list&amp;#x4F1A;&amp;#x7528;splice&amp;#x8FDB;&amp;#x884C;&amp;#x5408;&amp;#x5E76;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89%E2%80%94%E2%80%94_kmem_cache_create/</guid>
            <title>slab allocator （2）—— kmem_cache_create</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89%E2%80%94%E2%80%94_kmem_cache_create/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 20:54:16 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x662F;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x4E4B;&amp;#x4E00;&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;kmalloc&amp;#x7684;&amp;#x540E;&amp;#x76FE;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4F5C;&amp;#x4E3A;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x4F9B;&amp;#x9A71;&amp;#x52A8;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x770B;ldd3&amp;#x7684;chp 8&amp;#x7684;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x4E00;&amp;#x8282;&amp;#xFF08;P217&amp;#xFF09;&amp;#x3002;&amp;#x4ED6;&amp;#x5176;&amp;#x5B9E;&amp;#x548C;&amp;#x6211;&amp;#x4EEC;CPU&amp;#x7684;L1&amp;#xFF0C;L2&amp;#x7F13;&amp;#x5B58;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&amp;#x4ED6;&amp;#x6709;&amp;#x70B9;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;&amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x4E2D;&amp;#x5206;&amp;#x914D;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;size&amp;#x76F8;&amp;#x540C;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E3B;&amp;#x7EBF;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030569&#34; hash=&#34;7c2730c8cad130f3604736abf0582ab5&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E3B;&amp;#x7EBF;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;kmem_cache_zalloc&amp;#x5206;&amp;#x914D;kmem_cache&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x79CD;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x52A0;&amp;#x5165;cache_chain&amp;#x4E2D;&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x2014;&amp;#x2014;cache_chain&amp;#x662F;&amp;#x505A;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x73B0;&amp;#x5728;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x6709;&amp;#x7B54;&amp;#x6848;&amp;#x4E86;&amp;#x3002;&amp;#x4ED6;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x7684;kmem_cache&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x9632;&amp;#x6B62;&amp;#x91CD;&amp;#x540D;&amp;#x7684;cache&amp;#x4EA7;&amp;#x751F;&amp;#xFF0C;&amp;#x65B9;&amp;#x4FBF;proc&amp;#x7CFB;&amp;#x7EDF;&amp;#x663E;&amp;#x793A;&amp;#x8C03;&amp;#x8BD5;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. kmem_cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x5F53;size &amp;gt;= (PAGE_SIZE &amp;gt;&amp;gt; 3 = 512KB&amp;#x65F6;&amp;#xFF0C;flags |= CFLGS_OFF_SLAB&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;calculate_slab_order(cachep, size, align, flags)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030564&#34; hash=&#34;10a4a7586d7d29b19d2e2a600adc2ef0&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6240;&amp;#x8C13;&amp;#x7684;num&amp;#x4E0E;offslab_limit&amp;#x5C31;&amp;#x662F;&amp;#x4E0B;&amp;#x9762;off-slab&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x7531;&amp;#x6574;&amp;#x5757;2^order&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(num)&amp;#xFF0C;&amp;#x548C;&amp;#x53F3;&amp;#x8FB9;kmem_bufctl_t&amp;#x6570;&amp;#x7EC4;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(offslab_limit)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EA6;&amp;#x675F;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;num&amp;#x8981;&amp;#x5C0F;&amp;#x4E8E;offslab_limit&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x5C0F;&amp;#x4E8E;&amp;#x53F3;&amp;#x8FB9;&amp;#x3002;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x53F3;&amp;#x8FB9;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x7684;&amp;#x7BA1;&amp;#x63A7;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030571&#34; hash=&#34;a6edb8ef026079cb61b86575d2695089&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5982;&amp;#x679C;left_over&amp;#x592A;&amp;#x591A;&amp;#xFF0C;&amp;#x8DB3;&amp;#x591F;&amp;#x653E;&amp;#x5F97;&amp;#x4E0B;slab_size&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;off-slab&amp;#x8F6C;&amp;#x53D8;&amp;#x4E3A;on-slab&lt;/div&gt;&lt;div&gt;2. off-slab&amp;#x65F6;&amp;#xFF0C;slab mngmt&amp;#x653E;&amp;#x5728;&amp;#x54EA;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8C03;&amp;#x7528;cachep-&amp;gt;slabp_cache = kmem_find_general_cachep(slab_size, 0u)&amp;#xFF0C;&amp;#x53BB;&amp;#x5BFB;&amp;#x627E;&amp;#x8FD9;&amp;#x4E2A;size cache&amp;#x6765;&amp;#x5B58;&amp;#x653E;slab mngmt&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;kmem_find_general_cachep -&amp;gt;&amp;#xA0;__find_general_cachep -&amp;gt; (return malloc_sizes[n]-&amp;gt;cs_cachep)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. CPU cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;setup_cpu_cache(cachep, gfp)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5148;&amp;#x770B;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030566&#34; hash=&#34;5fac5be0e836af7f4e8bf4ff71375b8d&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x6839;&amp;#x636E;g_cpucache_up&amp;#x5206;&amp;#x6210;&amp;#x4E09;&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;FULL&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x7684;cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x90FD;&amp;#x5B8C;&amp;#x6210;&amp;#x4E86;&amp;#xFF0C;setup_cpu_cache&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;enable_cpucache&amp;#x3002;&amp;#x8FD9;&amp;#x4E5F;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x518D;&amp;#x53E6;&amp;#x5F00;&amp;#x65B0;&amp;#x7BC7;&amp;#x4ECB;&amp;#x7ECD;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;PARTIAL_AC/L3&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;&amp;#x6B64;&amp;#x51FD;&amp;#x6570;&amp;#x7684;kmem_cache_create&amp;#x4ECD;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x624D;&amp;#x521A;&amp;#x5F00;&amp;#x59CB;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;struct arracy_cache&amp;#x548C;kmem_list3s&amp;#x7528;&amp;#x5230;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x8FDB;&amp;#x884C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5176;&amp;#x4ED6;cache&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#xFF0C;&amp;#x65E0;&amp;#x6CD5;&amp;#x52A8;&amp;#x6001;&amp;#x5730;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5269;&amp;#x4E0B;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;AC&amp;#x548C;L3&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x597D;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;cache&amp;#x518D;create&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x8C03;&amp;#x7528;kmalloc&amp;#x4E86;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_generic.cache&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC / L3&amp;#x7684;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[SIZE_AC / L3]&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; cache_cache&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_cache&amp;#xFF0C;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[CACHE_CACHE]&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E9B;&amp;#x5728;kmem_cache_init&amp;#x7684;step 4,5&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x91CD;&amp;#x65B0;&amp;#x7528;kmalloc&amp;#x8FDB;&amp;#x884C;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;array_cache&amp;#x4F1A;&amp;#x7528;memcpy&amp;#x5C06;&amp;#x539F;&amp;#x5148;&amp;#x503C;&amp;#x8D4B;&amp;#x5165;&amp;#xFF0C;list&amp;#x4F1A;&amp;#x7528;splice&amp;#x8FDB;&amp;#x884C;&amp;#x5408;&amp;#x5E76;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89-_array_cache/</guid>
            <title>slab allocator （3）—— array_cache</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89-_array_cache/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 08:39:28 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;array_cache&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;Gorman&amp;#x4E66;&amp;#x4E2D;&amp;#x7684;per-CPU cache&amp;#x3002;&amp;#x4E66;&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6709;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#xFF1A;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;This way the&amp;#xA0;hardware cache will be used for as long as possible on the same CPU.&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;The second major bene&amp;#xFB01;t of this method is that spinlocks do not have to be held&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#x5148;&amp;#x770B;&amp;#x4E0B;kmem_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;br&gt;/* 2) Cache tunables. Protected by cache_chain_mutex */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int shared;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int buffer_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; u32 reciprocal_buffer_size;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;array_cache&amp;#x662F;kmem_cache&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x6BCF;&amp;#x4E2A;CPU&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5BF9;&amp;#x5E94;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E5F;&amp;#x5370;&amp;#x8BC1;&amp;#x4E86;&amp;#x4E0A;&amp;#x9762;Gorman&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#x3002;&amp;#x5728;&amp;#x6BCF;&amp;#x4E2A;kmem_cache&amp;#x88AB;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x9700;&amp;#x8981;&amp;#x53BB;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;setup_cpu_cache -&amp;gt; enable_cpucache -&amp;gt;&amp;#xA0;&lt;span style=&#34;font-size: 10pt; font-family: Arial; text-indent: 0mm;&#34;&gt;do_tune_cpucache&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5177;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1499486792698&#34; hash=&#34;049b0a76d483a641fc99b8981d3f1d3a&#34; align alt longdesc width=&#34;902&#34; height=&#34;536&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#x53EF;&amp;#x89C1;do_tune_cpucache&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x5E76;&amp;#x4ED8;&amp;#x7ED9;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;CPU&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6240;&amp;#x6709;&amp;#x7684;online CPU&amp;#x90FD;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x904D;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53EA;&amp;#x53D6;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F53;&amp;#x524D;CPU&amp;#x7684;&amp;#x503C;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x600E;&amp;#x4E48;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;&amp;#x8BB2;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x518D;&amp;#x505A;&amp;#x8BE6;&amp;#x7EC6;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&amp;#x4E0D;&amp;#x8FC7;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E2A;free_block&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x9605;&amp;#x8BFB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;array_cache&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x5927;&amp;#x4F53;&amp;#x7684;&amp;#x4E86;&amp;#x89E3;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5148;&amp;#x770B;&amp;#x6574;&amp;#x4E2A;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1499486792860&#34; hash=&#34;2bff79d1ec9cde7eaa6122d0bccbeefe&#34; align alt longdesc width=&#34;999&#34; height=&#34;753&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;array_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x6B63;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x6240;&amp;#x663E;&amp;#x793A;&amp;#xFF0C;&amp;#x9664;&amp;#x4E86;touched&amp;#x4E0D;&amp;#x77E5;&amp;#x9053;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x4E4B;&amp;#x5916;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x51E0;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x6670;&amp;#x7684;&amp;#xFF0C;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5F97;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;ul&gt;&lt;li&gt;avail&amp;#xFF0C;&amp;#x5F53;&amp;#x524D;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;&amp;#x4F4D;&amp;#x5B50;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x914D;&lt;/li&gt;&lt;li&gt;limit&amp;#xFF0C;&amp;#x81EA;&amp;#x7136;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#xFF0C;&amp;#x4E4B;&amp;#x524D;&amp;#x4E5F;&amp;#x8BF4;&amp;#x8FC7;&amp;#xFF0C;&amp;#x5728;enable_cpucache&amp;#x4E2D;&amp;#x4E5F;&amp;#x6709;&amp;#x5B9A;&amp;#x4E49;&lt;/li&gt;&lt;li&gt;batchcount&amp;#xFF0C;linux&amp;#x4E2D;&amp;#x4E00;&amp;#x822C;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x90FD;&amp;#x662F;&amp;#x7528;batch&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x5728;&amp;#x589E;&amp;#x957F;&amp;#x6216;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;object&amp;#x6570;&lt;/li&gt;&lt;li&gt;entry&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x6210;&amp;#x5458;&amp;#x4E86;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;object&amp;#x6570;&amp;#x7EC4;&lt;/li&gt;&lt;/ul&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;free_block&amp;#x91CA;&amp;#x653E;&amp;#x7684;&amp;#x662F;ccold-&amp;gt;avail&amp;#x4E2A;object&amp;#xFF0C;avail&amp;#x4E0D;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x672C;&amp;#x8EAB;&amp;#x5C31;&amp;#x662F;free&amp;#x7684;object&amp;#x5417;&amp;#xFF1F;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x9605;&amp;#x8BFB;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x56DE;&amp;#x7B54;&amp;#x8FD9;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E86;&amp;#xFF0C;&amp;#x9996;&amp;#x5148;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x4ECE;array_cache-&amp;gt;entry&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;avail&amp;#x7684;object&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#xFF0C;avail&amp;#x53D8;&amp;#x5C11;&amp;#x3002;&amp;#x5F53;avail&amp;#x4E3A;0&amp;#x65F6;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x67D0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4ECE;kmem_cache&amp;#x4E2D;&amp;#x53BB;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8D4B;&amp;#x7ED9;array_cache&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x53D6;batchcount&amp;#x4E2A;object&amp;#xFF0C;&amp;#x8FD9;&amp;#x65F6;avail&amp;#x5C31;&amp;#x4F1A;&amp;#x589E;&amp;#x52A0;&amp;#xFF0C;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x5C31;&amp;#x4F1A;&amp;#x51CF;&amp;#x5C11;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x6570;&amp;#x76EE;&amp;#x3002;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x4F1A;&amp;#x5728;cache_grow&amp;#x65F6;&amp;#x9012;&amp;#x589E;cachep-&amp;gt;num&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94_array_cache/</guid>
            <title>slab allocator （3）—— array_cache</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94_array_cache/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 08:39:28 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;array_cache&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;Gorman&amp;#x4E66;&amp;#x4E2D;&amp;#x7684;per-CPU cache&amp;#x3002;&amp;#x4E66;&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6709;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#xFF1A;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;This way the&amp;#xA0;hardware cache will be used for as long as possible on the same CPU.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;The second major bene&amp;#xFB01;t of this method is that spinlocks do not have to be held&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x5148;&amp;#x770B;&amp;#x4E0B;kmem_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;br&gt;/* 2) Cache tunables. Protected by cache_chain_mutex */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int shared;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int buffer_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; u32 reciprocal_buffer_size;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;array_cache&amp;#x662F;kmem_cache&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x6BCF;&amp;#x4E2A;CPU&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5BF9;&amp;#x5E94;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E5F;&amp;#x5370;&amp;#x8BC1;&amp;#x4E86;&amp;#x4E0A;&amp;#x9762;Gorman&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#x3002;&amp;#x5728;&amp;#x6BCF;&amp;#x4E2A;kmem_cache&amp;#x88AB;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x9700;&amp;#x8981;&amp;#x53BB;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;setup_cpu_cache -&amp;gt; enable_cpucache -&amp;gt;&amp;#xA0;&lt;span style=&#34;font-size: 10pt; font-family: Arial; text-indent: 0mm;&#34;&gt;do_tune_cpucache&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5177;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1537085030103&#34; hash=&#34;049b0a76d483a641fc99b8981d3f1d3a&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x53EF;&amp;#x89C1;do_tune_cpucache&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x5E76;&amp;#x4ED8;&amp;#x7ED9;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;CPU&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6240;&amp;#x6709;&amp;#x7684;online CPU&amp;#x90FD;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x904D;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53EA;&amp;#x53D6;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F53;&amp;#x524D;CPU&amp;#x7684;&amp;#x503C;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x600E;&amp;#x4E48;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;&amp;#x8BB2;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x518D;&amp;#x505A;&amp;#x8BE6;&amp;#x7EC6;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&amp;#x4E0D;&amp;#x8FC7;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E2A;free_block&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x9605;&amp;#x8BFB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;array_cache&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x5927;&amp;#x4F53;&amp;#x7684;&amp;#x4E86;&amp;#x89E3;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5148;&amp;#x770B;&amp;#x6574;&amp;#x4E2A;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1537085030106&#34; hash=&#34;2bff79d1ec9cde7eaa6122d0bccbeefe&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;array_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x6B63;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x6240;&amp;#x663E;&amp;#x793A;&amp;#xFF0C;&amp;#x9664;&amp;#x4E86;touched&amp;#x4E0D;&amp;#x77E5;&amp;#x9053;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x4E4B;&amp;#x5916;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x51E0;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x6670;&amp;#x7684;&amp;#xFF0C;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5F97;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;avail&amp;#xFF0C;&amp;#x5F53;&amp;#x524D;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;&amp;#x4F4D;&amp;#x5B50;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x914D;&lt;/li&gt;&lt;li&gt;limit&amp;#xFF0C;&amp;#x81EA;&amp;#x7136;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#xFF0C;&amp;#x4E4B;&amp;#x524D;&amp;#x4E5F;&amp;#x8BF4;&amp;#x8FC7;&amp;#xFF0C;&amp;#x5728;enable_cpucache&amp;#x4E2D;&amp;#x4E5F;&amp;#x6709;&amp;#x5B9A;&amp;#x4E49;&lt;/li&gt;&lt;li&gt;batchcount&amp;#xFF0C;linux&amp;#x4E2D;&amp;#x4E00;&amp;#x822C;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x90FD;&amp;#x662F;&amp;#x7528;batch&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x5728;&amp;#x589E;&amp;#x957F;&amp;#x6216;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;object&amp;#x6570;&lt;/li&gt;&lt;li&gt;entry&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x6210;&amp;#x5458;&amp;#x4E86;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;object&amp;#x6570;&amp;#x7EC4;&lt;/li&gt;&lt;/ul&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;free_block&amp;#x91CA;&amp;#x653E;&amp;#x7684;&amp;#x662F;ccold-&amp;gt;avail&amp;#x4E2A;object&amp;#xFF0C;avail&amp;#x4E0D;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x672C;&amp;#x8EAB;&amp;#x5C31;&amp;#x662F;free&amp;#x7684;object&amp;#x5417;&amp;#xFF1F;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x9605;&amp;#x8BFB;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x56DE;&amp;#x7B54;&amp;#x8FD9;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E86;&amp;#xFF0C;&amp;#x9996;&amp;#x5148;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x4ECE;array_cache-&amp;gt;entry&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;avail&amp;#x7684;object&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#xFF0C;avail&amp;#x53D8;&amp;#x5C11;&amp;#x3002;&amp;#x5F53;avail&amp;#x4E3A;0&amp;#x65F6;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x67D0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4ECE;kmem_cache&amp;#x4E2D;&amp;#x53BB;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8D4B;&amp;#x7ED9;array_cache&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x53D6;batchcount&amp;#x4E2A;object&amp;#xFF0C;&amp;#x8FD9;&amp;#x65F6;avail&amp;#x5C31;&amp;#x4F1A;&amp;#x589E;&amp;#x52A0;&amp;#xFF0C;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x5C31;&amp;#x4F1A;&amp;#x51CF;&amp;#x5C11;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x6570;&amp;#x76EE;&amp;#x3002;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x4F1A;&amp;#x5728;cache_grow&amp;#x65F6;&amp;#x9012;&amp;#x589E;cachep-&amp;gt;num&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_-_%E5%88%9D%E5%A7%8B%E5%8C%96/</guid>
            <title>slab allocator （1） —— 初始化</title>
            <link>https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_-_%E5%88%9D%E5%A7%8B%E5%8C%96/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sun, 16 Dec 2012 22:33:56 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;&amp;#x524D;&amp;#x9762;&amp;#x63D0;&amp;#x5230;&amp;#x8FC7;&amp;#x7684;buddy allocator&amp;#x901A;&amp;#x8FC7;&amp;#x7528;order&amp;#x5217;&amp;#x8868;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FBE;&amp;#x5230;&amp;#x51CF;&amp;#x5C11;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x7684;&amp;#x6548;&amp;#x679C;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x53EF;&amp;#x80FD;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x9875;&amp;#x6216;&amp;#x8005;&amp;#x51E0;&amp;#x9875;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90A3;&amp;#x6837;&amp;#x5185;&amp;#x5B58;&amp;#x5229;&amp;#x7528;&amp;#x7387;&amp;#x592A;&amp;#x4F4E;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#x5C06;&amp;#x5145;&amp;#x6EE1;&amp;#x4E86;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#xFF0C;slab&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x4E5F;&amp;#x5C31;&amp;#x5E94;&amp;#x8FD0;&amp;#x800C;&amp;#x751F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x51CF;&amp;#x5C11;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x800C;&amp;#x751F;&amp;#x7684;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x5F15;&amp;#x5165;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;slab&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7B80;&amp;#x4ECB;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003; &lt;a href=&#34;evernote:///view/161681/s10/1c5db3a9-e828-4651-85a8-865b4b31c896/1c5db3a9-e828-4651-85a8-865b4b31c896/&#34; style=&#34;color:#69aa35&#34;&gt;Linux slab &amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x5256;&amp;#x6790;&lt;/a&gt;&amp;#xFF0C; &lt;a href=&#34;evernote:///view/161681/s10/dd5a8455-ae17-4640-9ab3-318029b5b27a/dd5a8455-ae17-4640-9ab3-318029b5b27a/&#34; style=&#34;color:#69aa35&#34;&gt;Fred&amp;apos;s blog: &amp;#x4E09;&amp;#x6708; 2009&lt;/a&gt;&amp;#x3002;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486800011&#34; hash=&#34;f9aa13f5720f81622ea03ff22545aa90&#34; align alt longdesc width=&#34;402&#34; height=&#34;216&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;slab&amp;#x5C31;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&amp;#x7B80;&amp;#x5316;&amp;#x4E4B;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x57FA;&amp;#x4E8E;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x914D;&amp;#xFF08;&amp;#x53C2;&amp;#x8003;ldd3&amp;#xFF0C;page247 ch 8&amp;#xFF09;&amp;#x65B9;&amp;#x5F0F;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4ED6;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7531;&amp;#x4E0B;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;g_cpucache_up&amp;#x6765;&amp;#x6807;&amp;#x5FD7;&amp;#xFF0C;&amp;#x5171;&amp;#x6709;5&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6309;&amp;#x987A;&amp;#x5E8F;&amp;#x4F9D;&amp;#x6B21;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5728;start_kernel -&amp;gt; mm_init -&amp;gt; kmem_cache_init&amp;#x4E2D;&amp;#x5230;&amp;#x8FBE;EARLY&amp;#x72B6;&amp;#x6001;&amp;#x3002;&amp;#x6B64;&amp;#x65F6;slab_is_availabe()&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;&amp;#x771F;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x6B64;&amp;#x65F6;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5C31;&amp;#x7EEA;&amp;#x4E86;&amp;#x3002;&amp;#x800C;&amp;#x6700;&amp;#x7EC8;&amp;#x7684;FULL&amp;#x72B6;&amp;#x6001;&amp;#x662F;&amp;#x5728;kmem_cache_init_late&amp;#x4E2D;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799339&#34; hash=&#34;03ce74377056ed29ac4d864ca09a0238&#34; align alt longdesc width=&#34;990&#34; height=&#34;382&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x8FD9;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E2D;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x6838;&amp;#x5FC3;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#xA0;kmem_cache_init&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x5C06;&amp;#x91CD;&amp;#x70B9;&amp;#x4ECB;&amp;#x7ECD;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799878&#34; hash=&#34;f81d2f1faf6a6fe1e338c67903cec92c&#34; align alt longdesc width=&#34;920&#34; height=&#34;733&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5F88;&amp;#x5927;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x5F88;&amp;#x591A;&amp;#x77E5;&amp;#x8BC6;&amp;#x70B9;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chapter 8&amp;#x3002;&amp;#x5173;&amp;#x4E8E;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x591A;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x4E0D;&amp;#x662F;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#x3002;&amp;#x5148;&amp;#x5217;&amp;#x4E3E;&amp;#x51E0;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x4E86;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4ED6;&amp;#x5DE8;&amp;#x5927;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5C31;&amp;#x4E0D;&amp;#x5728;&amp;#x6B64;&amp;#x5217;&amp;#x4E3E;&amp;#x4E86;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; 1.&amp;#xA0;kmem_list3&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;struct kmem_list3 {&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_partial;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* partial list first, better asm code */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_full;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_free;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long free_objects;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int free_limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int colour_next;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* Per-node cache coloring */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t list_lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *shared;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* shared per node */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache **alien;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* on other nodes */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long next_reap;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int free_touched;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x524D;3&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x56FE;1&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E09;&amp;#x4E2A;list&amp;#xFF1A;slab_full, slab_partial, slab_empty&amp;#x3002;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. array_cache&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct array_cache {&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int avail;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int touched;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; void *entry[];&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /*&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Must have this definition in here for the proper&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * alignment of array_cache. Also simplifies accessing&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the entries.&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;array_cache&amp;#x662F;per CPU&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chp 8.5: Per-CPU Object Cache&amp;#x3002;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;cache&amp;#xFF0C;&amp;#x5728;create&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;array_cache&amp;#xFF08;enable_cpucache&amp;#xFF09;&amp;#x6765;&amp;#x63D0;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x603B;cache&amp;#x2014;&amp;#x2014;cache_cache&amp;#xFF08;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x5B83;&amp;#x662F;cache&amp;#x7684;cache&amp;#xFF09;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#x88AB;&amp;#x586B;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;__init_data&amp;#xA0;initarray_cache.cache&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#x518D;&amp;#x901A;&amp;#x8FC7;kmalloc&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x3002;arraycache&amp;#x4E0E;kmem_cache&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x5927;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799641&#34; hash=&#34;4daa9a20e6abdf0bb5ff45cff476683c&#34; align alt longdesc width=&#34;490&#34; height=&#34;402&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5173;&amp;#x4E8E;array_cache&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x4F1A;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x4F5C;&amp;#x4ECB;&amp;#x7ECD;&lt;a href=&#34;evernote:///view/161681/s10/e6125cc1-29d9-4e51-b0d7-1e44806f5491/e6125cc1-29d9-4e51-b0d7-1e44806f5491/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; arraycache&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. cache_sizes&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;Gorman&amp;#x7684;&amp;#x4E66;&amp;#x4E2D;&amp;#x5C06;&amp;#x5176;&amp;#x79F0;&amp;#x4E4B;&amp;#x4E3A;sizes cache&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x7EC4;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E86;size&amp;#x7684;cache&amp;#x3002;&amp;#x5728;slab&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x4F1A;&amp;#x7ECF;&amp;#x5E38;&amp;#x770B;&amp;#x5230;malloc_sizes&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9A;&amp;#x4E49;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes malloc_sizes[] = {&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define CACHE(x) { .cs_size = (x) },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#include &amp;lt;linux/kmalloc_sizes.h&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(ULONG_MAX)&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#undef CACHE&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size_t&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cs_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_cachep;&lt;br&gt;#ifdef CONFIG_ZONE_DMA&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_dmacachep;&lt;br&gt;#endif&lt;br&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x518D;&amp;#x770B;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;linux/kmalloc_sizes.h&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#if (PAGE_SIZE == 4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(64)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 64&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(96)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(128)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 128&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(192)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(256)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(512)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(1024)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(2048)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(8192)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(16384)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32768)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(65536)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(131072)&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x7A0D;&amp;#x52A0;&amp;#x5206;&amp;#x6790;&amp;#x6211;&amp;#x4EEC;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x5728;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;kmalloc_sizes.h&amp;#x4E2D;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5B9A;&amp;#x4E49;&amp;#x597D;&amp;#x4E86;&amp;#x4E00;&amp;#x7EC4;&amp;#x56FA;&amp;#x5B9A;size&amp;#x7684;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;&amp;#x4ED6;&amp;#x4EEC;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x4E24;&amp;#x7EC4;cache&amp;#x5217;&amp;#x8868;&amp;#xFF08;cs_cachep, cs_dmacachep&amp;#xFF09;&amp;#x8FD8;&amp;#x6CA1;&amp;#x5206;&amp;#x914D;&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;kmem_cache_init&amp;#x4E2D;&amp;#x5BF9;INDEX_AC&amp;#x548C;INDEX_L3&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#x7684;&amp;#x6210;&amp;#x5458;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_AC&amp;#xFF1A;&lt;/span&gt;sizeof(struct arraycache_init)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_L3&amp;#xFF1A;&lt;/span&gt;sizeof(struct kmem_list3)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x628A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x5355;&amp;#x72EC;&amp;#x63D0;&amp;#x51FA;&amp;#x6765;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6211;&amp;#x63A8;&amp;#x6D4B;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x5728;kmem_cache_create&amp;#x5230;&amp;#x65F6;&amp;#x5019;&amp;#x9700;&amp;#x8981;&amp;#x9891;&amp;#x7E41;&amp;#x7684;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5BF9;&amp;#x4E8E;kmem_cache&amp;#x6765;&amp;#x8BF4;&amp;#x4E5F;&amp;#x5C31;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;struct&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x7684;cache&amp;#x5148;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x5176;&amp;#x4ED6;malloc_sizes&amp;#x6570;&amp;#x7EC4;&amp;#x6210;&amp;#x5458;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;cache&amp;#x6765;&amp;#x4E3A;&amp;#x4E4B;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#x3002;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8BF4;&amp;#x5B8C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x4E86;&amp;#xFF0C;&amp;#x518D;&amp;#x56DE;&amp;#x5934;&amp;#x770B;&amp;#x770B;kmem_cache_init&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x65E0;&amp;#x975E;&amp;#x5C31;&amp;#x662F;&amp;#x5BF9;cache_cache&amp;#xFF0C;malloc_sizes&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x70B9;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. cache_chain&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x5904;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;INIT_LIST_HEAD(&amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;list_add(&amp;amp;cache_cache.next, &amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x5C1A;&amp;#x4E0D;&amp;#x77E5;&amp;#x8FD9;&amp;#x4E2A;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_chain&amp;#x662F;&amp;#x4F5C;&amp;#x4F55;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x5148;&amp;#x6682;&amp;#x4E14;&amp;#x5217;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. cache_estimate&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1504&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (order = 0; order &amp;lt; MAX_ORDER; order++) {&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1505&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_estimate(order, cache_cache.buffer_size,&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1506&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_line_size(), 0, &amp;amp;left_over, &amp;amp;cache_cache.num);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1507&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (cache_cache.num)&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1508&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; break;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1509&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4F5C;&amp;#x7528;&amp;#x5176;&amp;#x5B9E;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x51B3;&amp;#x5B9A;&amp;#xFF1A;(1)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_cache.buffer_size&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;cache_cache&amp;#x7684;object size&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x53EF;&amp;#x4EE5;&amp;#x5B58;&amp;#x50A8;&amp;#x591A;&amp;#x5C11;&amp;#x4E2A;object&amp;#xA0;&lt;/span&gt;(2)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;slab manager&amp;#x5B58;&amp;#x50A8;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF08;on-slab/off-slab&amp;#xFF1A;&amp;#x770B;&amp;#x770B;flags&amp;#x662F;&amp;#x5426;&amp;#x5305;&amp;#x542B;&lt;/span&gt;CFLGS_OFF_SLAB&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF09;&lt;/span&gt;(3)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x5229;&amp;#x7528;slab&amp;#x4E0A;&amp;#x5269;&amp;#x4F59;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;coloring&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/span&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E00;&amp;#x4E2A;cache_cache&amp;#x7684;slab&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x5272;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799475&#34; hash=&#34;4303d9fccee1ae4e2d8a4614f64d90ca&#34; align alt longdesc width=&#34;425&#34; height=&#34;242&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x4E2D;object&amp;#x7684;size&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;offsetof(struct kmem_cache, nodelists) +&amp;#xA0;nr_node_ids * sizeof(struct kmem_list3 *);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;sizeof(kmem_cache)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;cache_cache&amp;#x7684;slab&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x3002;&amp;#x6700;&amp;#x540E;cache_cache-&amp;gt;slab_size =&amp;#xA0;slab_mgmt_size&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; coloring scheme&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour_off = cache_line_size();&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour = left_over / cache_cache.colour_off;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. init_list&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x6700;&amp;#x540E;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1604&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for_each_online_node(nid) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1605&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(&amp;amp;cache_cache, &amp;amp;initkmem_list3[CACHE_CACHE + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1606&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1607&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_AC].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1608&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_AC + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1609&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1610&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (INDEX_AC != INDEX_L3) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1611&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_L3].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1612&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_L3 + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1613&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1614&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;init_list&amp;#x5199;&amp;#x7684;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED4;&amp;#x7EC6;&amp;#x7406;&amp;#x89E3;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;cache_cache&amp;#x4EE5;&amp;#x53CA;&amp;#x4E24;&amp;#x4E2A;size cache &amp;#xFF08;INDEX_AC, INDEX_L3&amp;#xFF09;&amp;#x5206;&amp;#x914D;kmem_list3&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&amp;#x5E76;&amp;#x7528;memcpy&amp;#x5C06;&lt;/font&gt;initkmem_list3&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x518D;&amp;#x7528;MAKE_ALL_LISTS -&amp;gt;&amp;#xA0;MAKE_LIST -&amp;gt;&amp;#xA0;list_splice &amp;#x6765;&amp;#x5408;&amp;#x5E76;initkmem_list3&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x3002;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8981;&amp;#x628A;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x60F3;&amp;#x7B80;&amp;#x5355;&amp;#x4E86;&amp;#xFF0C;&amp;#x8BE5;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x8FD8;&amp;#x662F;&amp;#x8981;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7279;&amp;#x522B;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x8FD9;&amp;#x79CD;&amp;#x5217;&amp;#x8868;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;kmem_cache_init&amp;#x4E2D;&amp;#x4E5F;&amp;#x8FD0;&amp;#x7528;kmem_cache_create&amp;#x6765;&amp;#x5206;&amp;#x914D;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x4E8E;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5C06;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x52A0;&amp;#x4EE5;&amp;#x9610;&amp;#x8FF0;&lt;a href=&#34;evernote:///view/161681/s10/e3b971bf-908b-4dda-8c29-d37666e83f1c/e3b971bf-908b-4dda-8c29-d37666e83f1c/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create&lt;/a&gt;&amp;#x3002;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_%E2%80%94%E2%80%94_%E5%88%9D%E5%A7%8B%E5%8C%96/</guid>
            <title>slab allocator （1） —— 初始化</title>
            <link>https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_%E2%80%94%E2%80%94_%E5%88%9D%E5%A7%8B%E5%8C%96/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sun, 16 Dec 2012 22:33:56 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#x524D;&amp;#x9762;&amp;#x63D0;&amp;#x5230;&amp;#x8FC7;&amp;#x7684;buddy allocator&amp;#x901A;&amp;#x8FC7;&amp;#x7528;order&amp;#x5217;&amp;#x8868;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FBE;&amp;#x5230;&amp;#x51CF;&amp;#x5C11;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x7684;&amp;#x6548;&amp;#x679C;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x53EF;&amp;#x80FD;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x9875;&amp;#x6216;&amp;#x8005;&amp;#x51E0;&amp;#x9875;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90A3;&amp;#x6837;&amp;#x5185;&amp;#x5B58;&amp;#x5229;&amp;#x7528;&amp;#x7387;&amp;#x592A;&amp;#x4F4E;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#x5C06;&amp;#x5145;&amp;#x6EE1;&amp;#x4E86;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#xFF0C;slab&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x4E5F;&amp;#x5C31;&amp;#x5E94;&amp;#x8FD0;&amp;#x800C;&amp;#x751F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x51CF;&amp;#x5C11;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x800C;&amp;#x751F;&amp;#x7684;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x5F15;&amp;#x5165;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;slab&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7B80;&amp;#x4ECB;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003; &lt;a href=&#34;evernote:///view/161681/s10/1c5db3a9-e828-4651-85a8-865b4b31c896/1c5db3a9-e828-4651-85a8-865b4b31c896/&#34; style=&#34;color:#69aa35&#34;&gt;Linux slab &amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x5256;&amp;#x6790;&lt;/a&gt;&amp;#xFF0C; &lt;a href=&#34;evernote:///view/161681/s10/dd5a8455-ae17-4640-9ab3-318029b5b27a/dd5a8455-ae17-4640-9ab3-318029b5b27a/&#34; style=&#34;color:#69aa35&#34;&gt;Fred&amp;apos;s blog: &amp;#x4E09;&amp;#x6708; 2009&lt;/a&gt;&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031252&#34; hash=&#34;f9aa13f5720f81622ea03ff22545aa90&#34; align alt longdesc width=&#34;402&#34; height=&#34;216&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;slab&amp;#x5C31;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&amp;#x7B80;&amp;#x5316;&amp;#x4E4B;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x57FA;&amp;#x4E8E;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x914D;&amp;#xFF08;&amp;#x53C2;&amp;#x8003;ldd3&amp;#xFF0C;page247 ch 8&amp;#xFF09;&amp;#x65B9;&amp;#x5F0F;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4ED6;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7531;&amp;#x4E0B;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;g_cpucache_up&amp;#x6765;&amp;#x6807;&amp;#x5FD7;&amp;#xFF0C;&amp;#x5171;&amp;#x6709;5&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6309;&amp;#x987A;&amp;#x5E8F;&amp;#x4F9D;&amp;#x6B21;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5728;start_kernel -&amp;gt; mm_init -&amp;gt; kmem_cache_init&amp;#x4E2D;&amp;#x5230;&amp;#x8FBE;EARLY&amp;#x72B6;&amp;#x6001;&amp;#x3002;&amp;#x6B64;&amp;#x65F6;slab_is_availabe()&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;&amp;#x771F;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x6B64;&amp;#x65F6;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5C31;&amp;#x7EEA;&amp;#x4E86;&amp;#x3002;&amp;#x800C;&amp;#x6700;&amp;#x7EC8;&amp;#x7684;FULL&amp;#x72B6;&amp;#x6001;&amp;#x662F;&amp;#x5728;kmem_cache_init_late&amp;#x4E2D;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031241&#34; hash=&#34;03ce74377056ed29ac4d864ca09a0238&#34; align alt longdesc width=&#34;990&#34; height=&#34;382&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x8FD9;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E2D;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x6838;&amp;#x5FC3;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#xA0;kmem_cache_init&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x5C06;&amp;#x91CD;&amp;#x70B9;&amp;#x4ECB;&amp;#x7ECD;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031250&#34; hash=&#34;f81d2f1faf6a6fe1e338c67903cec92c&#34; align alt longdesc width=&#34;920&#34; height=&#34;733&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5F88;&amp;#x5927;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x5F88;&amp;#x591A;&amp;#x77E5;&amp;#x8BC6;&amp;#x70B9;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chapter 8&amp;#x3002;&amp;#x5173;&amp;#x4E8E;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x591A;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x4E0D;&amp;#x662F;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#x3002;&amp;#x5148;&amp;#x5217;&amp;#x4E3E;&amp;#x51E0;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x4E86;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4ED6;&amp;#x5DE8;&amp;#x5927;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5C31;&amp;#x4E0D;&amp;#x5728;&amp;#x6B64;&amp;#x5217;&amp;#x4E3E;&amp;#x4E86;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; 1.&amp;#xA0;kmem_list3&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;struct kmem_list3 {&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_partial;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* partial list first, better asm code */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_full;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_free;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long free_objects;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int free_limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int colour_next;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* Per-node cache coloring */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t list_lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *shared;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* shared per node */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache **alien;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* on other nodes */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long next_reap;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int free_touched;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x524D;3&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x56FE;1&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E09;&amp;#x4E2A;list&amp;#xFF1A;slab_full, slab_partial, slab_empty&amp;#x3002;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. array_cache&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct array_cache {&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int avail;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int touched;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; void *entry[];&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /*&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Must have this definition in here for the proper&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * alignment of array_cache. Also simplifies accessing&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the entries.&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;array_cache&amp;#x662F;per CPU&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chp 8.5: Per-CPU Object Cache&amp;#x3002;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;cache&amp;#xFF0C;&amp;#x5728;create&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;array_cache&amp;#xFF08;enable_cpucache&amp;#xFF09;&amp;#x6765;&amp;#x63D0;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x603B;cache&amp;#x2014;&amp;#x2014;cache_cache&amp;#xFF08;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x5B83;&amp;#x662F;cache&amp;#x7684;cache&amp;#xFF09;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#x88AB;&amp;#x586B;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;__init_data&amp;#xA0;initarray_cache.cache&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#x518D;&amp;#x901A;&amp;#x8FC7;kmalloc&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x3002;arraycache&amp;#x4E0E;kmem_cache&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x5927;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031247&#34; hash=&#34;4daa9a20e6abdf0bb5ff45cff476683c&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5173;&amp;#x4E8E;array_cache&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x4F1A;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x4F5C;&amp;#x4ECB;&amp;#x7ECD;&lt;a href=&#34;evernote:///view/161681/s10/e6125cc1-29d9-4e51-b0d7-1e44806f5491/e6125cc1-29d9-4e51-b0d7-1e44806f5491/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; arraycache&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. cache_sizes&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;Gorman&amp;#x7684;&amp;#x4E66;&amp;#x4E2D;&amp;#x5C06;&amp;#x5176;&amp;#x79F0;&amp;#x4E4B;&amp;#x4E3A;sizes cache&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x7EC4;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E86;size&amp;#x7684;cache&amp;#x3002;&amp;#x5728;slab&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x4F1A;&amp;#x7ECF;&amp;#x5E38;&amp;#x770B;&amp;#x5230;malloc_sizes&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9A;&amp;#x4E49;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes malloc_sizes[] = {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define CACHE(x) { .cs_size = (x) },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#include &amp;lt;linux/kmalloc_sizes.h&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(ULONG_MAX)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#undef CACHE&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size_t&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cs_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_cachep;&lt;br&gt;#ifdef CONFIG_ZONE_DMA&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_dmacachep;&lt;br&gt;#endif&lt;br&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x518D;&amp;#x770B;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;linux/kmalloc_sizes.h&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#if (PAGE_SIZE == 4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(64)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 64&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(96)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(128)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 128&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(192)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(256)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(512)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(1024)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(2048)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(8192)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(16384)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32768)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(65536)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(131072)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x7A0D;&amp;#x52A0;&amp;#x5206;&amp;#x6790;&amp;#x6211;&amp;#x4EEC;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x5728;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;kmalloc_sizes.h&amp;#x4E2D;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5B9A;&amp;#x4E49;&amp;#x597D;&amp;#x4E86;&amp;#x4E00;&amp;#x7EC4;&amp;#x56FA;&amp;#x5B9A;size&amp;#x7684;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;&amp;#x4ED6;&amp;#x4EEC;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x4E24;&amp;#x7EC4;cache&amp;#x5217;&amp;#x8868;&amp;#xFF08;cs_cachep, cs_dmacachep&amp;#xFF09;&amp;#x8FD8;&amp;#x6CA1;&amp;#x5206;&amp;#x914D;&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;kmem_cache_init&amp;#x4E2D;&amp;#x5BF9;INDEX_AC&amp;#x548C;INDEX_L3&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#x7684;&amp;#x6210;&amp;#x5458;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_AC&amp;#xFF1A;&lt;/span&gt;sizeof(struct arraycache_init)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_L3&amp;#xFF1A;&lt;/span&gt;sizeof(struct kmem_list3)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x628A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x5355;&amp;#x72EC;&amp;#x63D0;&amp;#x51FA;&amp;#x6765;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6211;&amp;#x63A8;&amp;#x6D4B;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x5728;kmem_cache_create&amp;#x5230;&amp;#x65F6;&amp;#x5019;&amp;#x9700;&amp;#x8981;&amp;#x9891;&amp;#x7E41;&amp;#x7684;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5BF9;&amp;#x4E8E;kmem_cache&amp;#x6765;&amp;#x8BF4;&amp;#x4E5F;&amp;#x5C31;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;struct&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x7684;cache&amp;#x5148;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x5176;&amp;#x4ED6;malloc_sizes&amp;#x6570;&amp;#x7EC4;&amp;#x6210;&amp;#x5458;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;cache&amp;#x6765;&amp;#x4E3A;&amp;#x4E4B;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8BF4;&amp;#x5B8C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x4E86;&amp;#xFF0C;&amp;#x518D;&amp;#x56DE;&amp;#x5934;&amp;#x770B;&amp;#x770B;kmem_cache_init&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x65E0;&amp;#x975E;&amp;#x5C31;&amp;#x662F;&amp;#x5BF9;cache_cache&amp;#xFF0C;malloc_sizes&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x70B9;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. cache_chain&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x5904;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;INIT_LIST_HEAD(&amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;list_add(&amp;amp;cache_cache.next, &amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x5C1A;&amp;#x4E0D;&amp;#x77E5;&amp;#x8FD9;&amp;#x4E2A;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_chain&amp;#x662F;&amp;#x4F5C;&amp;#x4F55;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x5148;&amp;#x6682;&amp;#x4E14;&amp;#x5217;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. cache_estimate&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1504&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (order = 0; order &amp;lt; MAX_ORDER; order++) {&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1505&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_estimate(order, cache_cache.buffer_size,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1506&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_line_size(), 0, &amp;amp;left_over, &amp;amp;cache_cache.num);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1507&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (cache_cache.num)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1508&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; break;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1509&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4F5C;&amp;#x7528;&amp;#x5176;&amp;#x5B9E;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x51B3;&amp;#x5B9A;&amp;#xFF1A;(1)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_cache.buffer_size&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;cache_cache&amp;#x7684;object size&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x53EF;&amp;#x4EE5;&amp;#x5B58;&amp;#x50A8;&amp;#x591A;&amp;#x5C11;&amp;#x4E2A;object&amp;#xA0;&lt;/span&gt;(2)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;slab manager&amp;#x5B58;&amp;#x50A8;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF08;on-slab/off-slab&amp;#xFF1A;&amp;#x770B;&amp;#x770B;flags&amp;#x662F;&amp;#x5426;&amp;#x5305;&amp;#x542B;&lt;/span&gt;CFLGS_OFF_SLAB&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF09;&lt;/span&gt;(3)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x5229;&amp;#x7528;slab&amp;#x4E0A;&amp;#x5269;&amp;#x4F59;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;coloring&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E00;&amp;#x4E2A;cache_cache&amp;#x7684;slab&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x5272;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031245&#34; hash=&#34;4303d9fccee1ae4e2d8a4614f64d90ca&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x4E2D;object&amp;#x7684;size&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;offsetof(struct kmem_cache, nodelists) +&amp;#xA0;nr_node_ids * sizeof(struct kmem_list3 *);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;sizeof(kmem_cache)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;cache_cache&amp;#x7684;slab&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x3002;&amp;#x6700;&amp;#x540E;cache_cache-&amp;gt;slab_size =&amp;#xA0;slab_mgmt_size&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; coloring scheme&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour_off = cache_line_size();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour = left_over / cache_cache.colour_off;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. init_list&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x6700;&amp;#x540E;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1604&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for_each_online_node(nid) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1605&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(&amp;amp;cache_cache, &amp;amp;initkmem_list3[CACHE_CACHE + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1606&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1607&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_AC].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1608&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_AC + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1609&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1610&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (INDEX_AC != INDEX_L3) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1611&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_L3].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1612&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_L3 + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1613&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1614&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;init_list&amp;#x5199;&amp;#x7684;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED4;&amp;#x7EC6;&amp;#x7406;&amp;#x89E3;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;cache_cache&amp;#x4EE5;&amp;#x53CA;&amp;#x4E24;&amp;#x4E2A;size cache &amp;#xFF08;INDEX_AC, INDEX_L3&amp;#xFF09;&amp;#x5206;&amp;#x914D;kmem_list3&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&amp;#x5E76;&amp;#x7528;memcpy&amp;#x5C06;&lt;/font&gt;initkmem_list3&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x518D;&amp;#x7528;MAKE_ALL_LISTS -&amp;gt;&amp;#xA0;MAKE_LIST -&amp;gt;&amp;#xA0;list_splice &amp;#x6765;&amp;#x5408;&amp;#x5E76;initkmem_list3&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x3002;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8981;&amp;#x628A;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x60F3;&amp;#x7B80;&amp;#x5355;&amp;#x4E86;&amp;#xFF0C;&amp;#x8BE5;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x8FD8;&amp;#x662F;&amp;#x8981;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7279;&amp;#x522B;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x8FD9;&amp;#x79CD;&amp;#x5217;&amp;#x8868;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;kmem_cache_init&amp;#x4E2D;&amp;#x4E5F;&amp;#x8FD0;&amp;#x7528;kmem_cache_create&amp;#x6765;&amp;#x5206;&amp;#x914D;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x4E8E;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5C06;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x52A0;&amp;#x4EE5;&amp;#x9610;&amp;#x8FF0;&lt;a href=&#34;evernote:///view/161681/s10/e3b971bf-908b-4dda-8c29-d37666e83f1c/e3b971bf-908b-4dda-8c29-d37666e83f1c/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create&lt;/a&gt;&amp;#x3002;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/12/migrate_type%E2%80%94%E2%80%94buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</guid>
            <title>migrate type——buddy system的好搭档</title>
            <link>https://blog.zhougy.top/2012/12/12/migrate_type%E2%80%94%E2%80%94buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Wed, 12 Dec 2012 21:49:24 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;Linux&amp;#x4E00;&amp;#x5171;&amp;#x5B9A;&amp;#x4E49;5&amp;#x4E2D;migrate type&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;div&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_UNMOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 0&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RECLAIMABLE&amp;#xA0;&amp;#xA0; 1&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_MOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 2&lt;/font&gt;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/* &amp;#x672A;&amp;#x89C1;&amp;#x6709;&amp;#x4F7F;&amp;#x7528;&amp;#x8BE5;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;*/&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_PCPTYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* the number of types on the pcp lists */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RESERVE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_ISOLATE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 4&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* can&amp;apos;t allocate from here */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_TYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 5&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x5B9A;&amp;#x4E49;migrate type&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;/font&gt;&lt;a href=&#34;evernote:///view/161681/s10/47ce963e-2a46-4097-ab3b-85b5e8c113bd/47ce963e-2a46-4097-ab3b-85b5e8c113bd/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;linux&amp;#x5185;&amp;#x6838;&amp;#x5BF9;&amp;#x4F19;&amp;#x4F34;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6539;&amp;#x8FDB;--migrate_type&lt;/a&gt;&amp;#x3002;&amp;#x7B80;&amp;#x8981;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;Linux&amp;#x5C06;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x6216;&amp;#x4E0D;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x5F00;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x6700;&amp;#x5927;&amp;#x7A0B;&amp;#x5EA6;&amp;#x7684;&amp;#x51CF;&amp;#x5C11;&amp;#x788E;&amp;#x7247;&amp;#xFF0C;&amp;#x63D0;&amp;#x5347;&amp;#x5206;&amp;#x914D;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x80FD;&amp;#x529B;&amp;#x3002;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x79CD;&amp;#x601D;&amp;#x8DEF;&amp;#xFF0C;&amp;#x53EF;&amp;#x89C1;&amp;#x4E0A;&amp;#x8FF0;5&amp;#x79CD;migrate type&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;type&amp;#x5C31;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RESERVE&amp;#xFF0C;&amp;#x8FD9;&amp;#x8868;&amp;#x793A;page&amp;#x88AB;reserve&amp;#xFF0C;&amp;#x4E0D;&amp;#x63A5;&amp;#x53D7;buddy system&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x53EF;&amp;#x53C2;&amp;#x89C1;&amp;#x51FD;&amp;#x6570;&lt;/span&gt;setup_zone_migrate_reserve&amp;#x3002;&amp;#x5728;&amp;#x542F;&amp;#x52A8;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4F9D;&amp;#x636E;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;page&amp;#x505A;&amp;#x5907;&amp;#x7528;&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x8FD9;&amp;#x4E09;&amp;#x4E2A;type&amp;#x662F;&amp;#x7528;&amp;#x5230;&amp;#x6700;&amp;#x591A;&amp;#x7684;&amp;#x4E09;&amp;#x79CD;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x7528;&amp;#x5230;&amp;#x4E86;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static int fallbacks[MIGRATE_TYPES][MIGRATE_TYPES-1] = {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_UNMOVABLE]&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RECLAIMABLE] = { MIGRATE_UNMOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_MOVABLE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_UNMOVABLE, MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RESERVE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE }, /* Never used */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;migrate type&amp;#x5728;memmap_init&amp;#x4E2D;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;MIGRATE_MOVABLE&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void __meminit memmap_init_zone(unsigned long size, int nid, unsigned long zone,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long start_pfn, enum memmap_context context)&lt;br&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct page *page;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long end_pfn = start_pfn + size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *z;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (highest_memmap_pfn &amp;lt; end_pfn - 1)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; highest_memmap_pfn = end_pfn - 1;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; z = &amp;amp;NODE_DATA(nid)-&amp;gt;node_zones[zone];&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (pfn = start_pfn; pfn &amp;lt; end_pfn; pfn++) {&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; page = pfn_to_page(pfn);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; SetPageReserved(page);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#328712&#34;&gt;/*&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Mark the block movable so that blocks are reserved for&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * movable at startup. This will force kernel allocations&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * to reserve their blocks rather than leaking throughout&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the address space during boot when many long-lived&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * kernel allocations are made. Later some blocks near&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the start are marked MIGRATE_RESERVE by&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * setup_zone_migrate_reserve()&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * bitmap is created for zone&amp;apos;s valid pfn range. but memmap&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * can be created for invalid pages (for alignment)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * check here not to call set_pageblock_migratetype() against&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * pfn out of zone.&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if ((z-&amp;gt;zone_start_pfn &amp;lt;= pfn)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; (pfn &amp;lt; z-&amp;gt;zone_start_pfn + z-&amp;gt;spanned_pages)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; !(pfn &amp;amp; (pageblock_nr_pages - 1)))&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; set_pageblock_migratetype(page, MIGRATE_MOVABLE);&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; INIT_LIST_HEAD(&amp;amp;page-&amp;gt;lru);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;}&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;memmap&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BE5;zone&amp;#x6240;&amp;#x6709;&amp;#x9875;&amp;#x9762;&amp;#x7684;page&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x8BBE;&amp;#x7F6E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page-&amp;gt;flags&amp;#x7684;PG_reserved&amp;#x4F4D;&amp;#xFF0C;&amp;#x610F;&amp;#x601D;&amp;#x662F;&amp;#x4E0D;&amp;#x53D7;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x63A7;&amp;#x5236;&amp;#x3002;&amp;#x6CA1;&amp;#x9519;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x4ECD;&amp;#x5728;bootmem&amp;#x63A7;&amp;#x5236;&amp;#x4E0B;&amp;#xFF0C;&amp;#x4E4B;&amp;#x540E;&amp;#x518D;__free_pages_bootmem&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6E05;&amp;#x9664;&amp;#x8BE5;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5C06;&amp;#x5176;&amp;#x7EB3;&amp;#x5165;buddy&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;2&amp;#xFF09;&amp;#x4E4B;&amp;#x540E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;set_pageblock_migratetype&amp;#x5C06;&amp;#x6240;&amp;#x6709;page&amp;#x7684;migrate type&amp;#x8BBE;&amp;#x4E3A;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x6309;&amp;#x7167;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x987A;&amp;#x5E8F;&amp;#x4E0A;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x540E;&amp;#x9762;&amp;#x624D;&amp;#x4F1A;&amp;#x88AB;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;3&amp;#xFF09;&amp;#x518D;&amp;#x770B;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;set_pageblock_migratetype -&amp;gt;&amp;#xA0;set_pageblock_flags_group&lt;/blockquote&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void set_pageblock_flags_group(struct page *page, unsigned long flags,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int start_bitidx, int end_bitidx)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long *bitmap;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, bitidx;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long value = 1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone = page_zone(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn = page_to_pfn(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitmap = get_pageblock_bitmap(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitidx = pfn_to_bitidx(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (; start_bitidx &amp;lt;= end_bitidx; start_bitidx++, value &amp;lt;&amp;lt;= 1)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (flags &amp;amp; value)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __set_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __clear_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6CA1;&amp;#x6709;&amp;#x60F3;&amp;#x8C61;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x7B80;&amp;#x5355;&amp;#x5427;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;bitmap&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;&amp;#x4EC0;&amp;#x4E48;&amp;#x5462;&amp;#xFF1F;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static unsigned long __init usemap_size(unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(zonesize, pageblock_nr_pages);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = usemapsize &amp;gt;&amp;gt; pageblock_order;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize *= NR_PAGEBLOCK_BITS;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(usemapsize, 8 * sizeof(unsigned long));&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return usemapsize / 8;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static void __init setup_usemap(struct pglist_data *pgdat,&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone, unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize = usemap_size(zonesize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = NULL;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (usemapsize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = alloc_bootmem_node(pgdat, usemapsize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;bitmap&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;zone-&amp;gt;pageblock_flags&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;zone&amp;#x88AB;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;pageblock&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;pageblock&amp;#x5206;&amp;#x914D;3&amp;#x4F4D;&amp;#x6765;&amp;#x8868;&amp;#x793A;migrate type&amp;#x3002;pageblock&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;freearea&amp;#x4E2D;order&amp;#x6700;&amp;#x5927;&amp;#x7684;&amp;#x4E00;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;free_area_init_core -&amp;gt;&amp;#xA0;set_pageblock_order(pageblock_default_order())&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static inline int pageblock_default_order(void)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (HPAGE_SHIFT &amp;gt; PAGE_SHIFT)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return HUGETLB_PAGE_ORDER;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return MAX_ORDER-1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x7528;get_pageblock_migratetype(page)&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x672C;page&amp;#x7684;migrate type&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x53EA;&amp;#x8981;&amp;#x6CA1;&amp;#x6709;&amp;#x505A;migrate type&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;page&amp;#x7684;migrate type&amp;#x603B;&amp;#x662F;&amp;#x548C;&amp;#x4ED6;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x662F;&amp;#x4E00;&amp;#x81F4;&amp;#x7684;&amp;#x3002;migrate type&amp;#x53EA;&amp;#x4F1A;&amp;#x5728;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E2D;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x5728;&amp;#x672C;migrate type&amp;#x4E2D;&amp;#x65E0;&amp;#x5185;&amp;#x5B58;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5C31;&amp;#x8981;&amp;#x53BB;&amp;#x5907;&amp;#x7528;&amp;#x7684;migrate type&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x627E;&amp;#x6700;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x8FC1;&amp;#x79FB;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x518D;&amp;#x4E0D;&amp;#x6D4E;&amp;#x8FD8;&amp;#x6709;reserved&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0B;&amp;#x9762;&amp;#x5206;&amp;#x6790;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x662F;&amp;#x5982;&amp;#x4F55;&amp;#x6539;&amp;#x53D8;&amp;#x7684;&amp;#x3002;&amp;#x8FD8;&amp;#x662F;&amp;#x6709;&amp;#x70B9;&amp;#x5C0F;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/migrate type&amp;#x2014;&amp;#x2014;buddy system&amp;#x7684;&amp;#x597D;&amp;#x642D;&amp;#x6863;/1537085032358&#34; hash=&#34;78d55e4b7bcdd406f2bf0b19ceba585b&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&amp;#x6240;&amp;#x6709;&amp;#x8BB2;&amp;#x5230;fallback&amp;#x673A;&amp;#x5236;&amp;#x7684;&amp;#x8D44;&amp;#x6599;&amp;#x4E0A;&amp;#x90FD;&amp;#x4F1A;&amp;#x63D0;&amp;#x9192;&amp;#x6211;&amp;#x4EEC;&amp;#x6CE8;&amp;#x610F;&amp;#xFF0C;&amp;#x5728;&amp;#x4ECE;backup migratetype&amp;#x4E2D;&amp;#x53D6;&amp;#x5185;&amp;#x5B58;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x4ECE;&amp;#x5927;&amp;#x7684;order&amp;#x5F80;&amp;#x5C0F;order&amp;#x9012;&amp;#x51CF;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;order&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;NULL&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;&amp;#x7B2C;&amp;#x4E8C;&amp;#x70B9;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E00;&amp;#x8D77;&amp;#x4F5C;&amp;#x7528;&amp;#xFF0C;page&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4F1A;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x800C;&amp;#x662F;&amp;#x5728;&amp;#x6EE1;&amp;#x8DB3;&amp;#x4E00;&amp;#x5B9A;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x624D;&amp;#x4F1A;&amp;#x53D1;&amp;#x751F;&amp;#x3002;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;page moved &amp;gt;= pageblock / 2&amp;#x3002;&amp;#x4EC0;&amp;#x4E48;&amp;#x610F;&amp;#x601D;&amp;#x5462;&amp;#xFF1F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x7684;order&amp;#x8D85;&amp;#x8FC7;pageblock_order&amp;#x7684;&amp;#x4E00;&amp;#x534A;&amp;#xFF0C;&amp;#x4EE5;7800&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;default pageblock_order&amp;#x662F;MAX_ORDER-1 = 10&amp;#xFF0C;&amp;#x5219;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;order&amp;#x8981;&amp;#x8D85;&amp;#x8FC7;5&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;32&amp;#x4E2A;page&amp;#x3002;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x4E0A;&amp;#x6709;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E00;&amp;#x534A;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;buddy&amp;#x3002;&amp;#x82E5;&amp;#x6EE1;&amp;#x8DB3;&amp;#x8FD9;&amp;#x4E24;&amp;#x70B9;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x4F1A;&amp;#x88AB;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C5E;&amp;#x4E8E;&amp;#x4ED6;&amp;#x4E14;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#x7684;buddy&amp;#x5728;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;&amp;#x5408;&amp;#x5E76;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x6D4B;&amp;#x8BD5;&amp;#x4E0A;&amp;#x9762;&amp;#x6240;&amp;#x8BF4;&amp;#x7684;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5148;&amp;#x5C06;pageblock&amp;#x4E2D;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;buddy&amp;#x79FB;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#xFF0C;&amp;#x4F46;&amp;#x5E76;&amp;#x4E0D;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x6539;&amp;#x53D8;&amp;#x5176;migratetype&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x83B7;&amp;#x53D6;migratetype&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x51FD;&amp;#x6570;get_pageblock_migratetype&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x53EA;&amp;#x8981;&amp;#x4E0D;&amp;#x4FEE;&amp;#x6539;&amp;#x6574;&amp;#x5757;pageblock&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;&amp;#x5230;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;buddy&amp;#x7684;migratetype&amp;#x5C5E;&amp;#x6027;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 4&amp;#xFF09;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x8D85;&amp;#x8FC7;pageblock&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x90FD;&amp;#x4FEE;&amp;#x6539;&amp;#x6210;&amp;#x6211;&amp;#x4EEC;&amp;#x6240;&amp;#x9700;&amp;#x8981;&amp;#x7684;migratetype&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD9;&amp;#x91CC;&amp;#x53CD;&amp;#x6620;&amp;#x51FA;&amp;#x7684;&amp;#x601D;&amp;#x60F3;&amp;#x548C;&amp;#x4E0A;&amp;#x9762;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x5185;&amp;#x5B58;&amp;#x8DB3;&amp;#x591F;&amp;#x5927;&amp;#xFF0C;&amp;#x5C31;&amp;#x8FC1;&amp;#x79FB;migratetype&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 5&amp;#xFF09;&amp;#x6700;&amp;#x540E;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x4E00;&amp;#x70B9;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x5224;&amp;#x65AD;&amp;#x5176;&amp;#x5B9E;&amp;#x4E0D;&amp;#x5B8C;&amp;#x6574;&amp;#xFF0C;&amp;#x771F;&amp;#x5B9E;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;if (unlikely(current_order &amp;gt;= (pageblock_order &amp;gt;&amp;gt; 1)) ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_migratetype == MIGRATE_RECLAIMABLE ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;page_group_by_mobility_disabled) { &amp;#x2026;&amp;#x2026; }&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#x8868;&amp;#x793A;&amp;#x8FC1;&amp;#x79FB;&amp;#x7279;&amp;#x6027;&amp;#x5173;&amp;#x95ED;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x9875;&amp;#x9762;&amp;#x5E76;&amp;#x4E0D;&amp;#x53D7;migratetype&amp;#x6240;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x90A3;&amp;#x9875;&amp;#x9762;&amp;#x5E94;&amp;#x8BE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x968F;&amp;#x5FC3;&amp;#x6240;&amp;#x6B32;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x786E;&amp;#x5B9E;&amp;#x5982;&amp;#x6B64;&amp;#xFF0C;&amp;#x540E;&amp;#x9762;&amp;#x5982;&amp;#x679C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#xFF0C;&amp;#x4E5F;&amp;#x5E76;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x5224;&amp;#x65AD;&amp;#x6709;&amp;#x591A;&amp;#x5C11;free buddy&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FC1;&amp;#x79FB;&amp;#x9875;&amp;#x9762;&amp;#x4E86;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF0C;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;start_migratetype == MIGRATE_RECLAIMABLE&amp;#x5C31;&amp;#x503C;&amp;#x5F97;&amp;#x63A8;&amp;#x6572;&amp;#x4E86;&amp;#x3002;&amp;#x6240;&amp;#x6709;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x90FD;&amp;#x6CA1;&amp;#x6709;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&amp;#x7F51;&amp;#x7EDC;&amp;#x4E0A;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x89E3;&amp;#x91CA;&amp;#x662F;&amp;#xFF1A;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;i&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#x53EF;&amp;#x56DE;&amp;#x6536;&amp;#x9875;&amp;#xFF1A;&amp;#x4E0D;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x79FB;&amp;#x52A8;&amp;#xFF0C;&amp;#x4F46;&amp;#x53EF;&amp;#x4EE5;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x5176;&amp;#x5185;&amp;#x5BB9;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x67D0;&amp;#x4E9B;&amp;#x6E90;&amp;#x91CD;&amp;#x65B0;&amp;#x751F;&amp;#x6210;&lt;/span&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#xA0;&amp;#xA0;&lt;/span&gt;&lt;/i&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x4EE5;&amp;#x6211;&amp;#x8BA4;&amp;#x4E3A;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RECLAIMABLE&amp;#x56E0;&amp;#x4E3A;&amp;#x5F88;&amp;#x5BB9;&amp;#x6613;&amp;#x88AB;&amp;#x91CA;&amp;#x653E;&amp;#xFF08;&amp;#x6216;&amp;#x53EB;&amp;#x56DE;&amp;#x6536;&amp;#xFF09;&amp;#xFF0C;&amp;#x4ED6;&amp;#x4E5F;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#x548C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x66FF;&amp;#x8865;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x7BA1;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x9875;&amp;#x9762;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#xFF0C;&amp;#x90FD;&amp;#x5E94;&amp;#x8BE5;&amp;#x5C3D;&amp;#x53EF;&amp;#x80FD;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#x7ED9;&amp;#x4ED6;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;br&gt;&lt;div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/12/migrate_type-buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</guid>
            <title>migrate type——buddy system的好搭档</title>
            <link>https://blog.zhougy.top/2012/12/12/migrate_type-buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Wed, 12 Dec 2012 21:49:24 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;Linux&amp;#x4E00;&amp;#x5171;&amp;#x5B9A;&amp;#x4E49;5&amp;#x4E2D;migrate type&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_UNMOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 0&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RECLAIMABLE&amp;#xA0;&amp;#xA0; 1&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_MOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 2&lt;/font&gt;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/* &amp;#x672A;&amp;#x89C1;&amp;#x6709;&amp;#x4F7F;&amp;#x7528;&amp;#x8BE5;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;*/&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_PCPTYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* the number of types on the pcp lists */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RESERVE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_ISOLATE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 4&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* can&amp;apos;t allocate from here */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_TYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 5&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x5B9A;&amp;#x4E49;migrate type&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;/font&gt;&lt;a href=&#34;evernote:///view/161681/s10/47ce963e-2a46-4097-ab3b-85b5e8c113bd/47ce963e-2a46-4097-ab3b-85b5e8c113bd/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;linux&amp;#x5185;&amp;#x6838;&amp;#x5BF9;&amp;#x4F19;&amp;#x4F34;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6539;&amp;#x8FDB;--migrate_type&lt;/a&gt;&amp;#x3002;&amp;#x7B80;&amp;#x8981;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;Linux&amp;#x5C06;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x6216;&amp;#x4E0D;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x5F00;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x6700;&amp;#x5927;&amp;#x7A0B;&amp;#x5EA6;&amp;#x7684;&amp;#x51CF;&amp;#x5C11;&amp;#x788E;&amp;#x7247;&amp;#xFF0C;&amp;#x63D0;&amp;#x5347;&amp;#x5206;&amp;#x914D;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x80FD;&amp;#x529B;&amp;#x3002;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x79CD;&amp;#x601D;&amp;#x8DEF;&amp;#xFF0C;&amp;#x53EF;&amp;#x89C1;&amp;#x4E0A;&amp;#x8FF0;5&amp;#x79CD;migrate type&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;type&amp;#x5C31;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RESERVE&amp;#xFF0C;&amp;#x8FD9;&amp;#x8868;&amp;#x793A;page&amp;#x88AB;reserve&amp;#xFF0C;&amp;#x4E0D;&amp;#x63A5;&amp;#x53D7;buddy system&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x53EF;&amp;#x53C2;&amp;#x89C1;&amp;#x51FD;&amp;#x6570;&lt;/span&gt;setup_zone_migrate_reserve&amp;#x3002;&amp;#x5728;&amp;#x542F;&amp;#x52A8;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4F9D;&amp;#x636E;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;page&amp;#x505A;&amp;#x5907;&amp;#x7528;&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x8FD9;&amp;#x4E09;&amp;#x4E2A;type&amp;#x662F;&amp;#x7528;&amp;#x5230;&amp;#x6700;&amp;#x591A;&amp;#x7684;&amp;#x4E09;&amp;#x79CD;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x7528;&amp;#x5230;&amp;#x4E86;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static int fallbacks[MIGRATE_TYPES][MIGRATE_TYPES-1] = {&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_UNMOVABLE]&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RECLAIMABLE] = { MIGRATE_UNMOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_MOVABLE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_UNMOVABLE, MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RESERVE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE }, /* Never used */&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;migrate type&amp;#x5728;memmap_init&amp;#x4E2D;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;MIGRATE_MOVABLE&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void __meminit memmap_init_zone(unsigned long size, int nid, unsigned long zone,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long start_pfn, enum memmap_context context)&lt;br&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct page *page;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long end_pfn = start_pfn + size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *z;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (highest_memmap_pfn &amp;lt; end_pfn - 1)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; highest_memmap_pfn = end_pfn - 1;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; z = &amp;amp;NODE_DATA(nid)-&amp;gt;node_zones[zone];&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (pfn = start_pfn; pfn &amp;lt; end_pfn; pfn++) {&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; page = pfn_to_page(pfn);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; SetPageReserved(page);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#328712&#34;&gt;/*&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Mark the block movable so that blocks are reserved for&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * movable at startup. This will force kernel allocations&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * to reserve their blocks rather than leaking throughout&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the address space during boot when many long-lived&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * kernel allocations are made. Later some blocks near&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the start are marked MIGRATE_RESERVE by&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * setup_zone_migrate_reserve()&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * bitmap is created for zone&amp;apos;s valid pfn range. but memmap&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * can be created for invalid pages (for alignment)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * check here not to call set_pageblock_migratetype() against&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * pfn out of zone.&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if ((z-&amp;gt;zone_start_pfn &amp;lt;= pfn)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; (pfn &amp;lt; z-&amp;gt;zone_start_pfn + z-&amp;gt;spanned_pages)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; !(pfn &amp;amp; (pageblock_nr_pages - 1)))&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; set_pageblock_migratetype(page, MIGRATE_MOVABLE);&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; INIT_LIST_HEAD(&amp;amp;page-&amp;gt;lru);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;}&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;memmap&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BE5;zone&amp;#x6240;&amp;#x6709;&amp;#x9875;&amp;#x9762;&amp;#x7684;page&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x8BBE;&amp;#x7F6E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page-&amp;gt;flags&amp;#x7684;PG_reserved&amp;#x4F4D;&amp;#xFF0C;&amp;#x610F;&amp;#x601D;&amp;#x662F;&amp;#x4E0D;&amp;#x53D7;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x63A7;&amp;#x5236;&amp;#x3002;&amp;#x6CA1;&amp;#x9519;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x4ECD;&amp;#x5728;bootmem&amp;#x63A7;&amp;#x5236;&amp;#x4E0B;&amp;#xFF0C;&amp;#x4E4B;&amp;#x540E;&amp;#x518D;__free_pages_bootmem&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6E05;&amp;#x9664;&amp;#x8BE5;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5C06;&amp;#x5176;&amp;#x7EB3;&amp;#x5165;buddy&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;2&amp;#xFF09;&amp;#x4E4B;&amp;#x540E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;set_pageblock_migratetype&amp;#x5C06;&amp;#x6240;&amp;#x6709;page&amp;#x7684;migrate type&amp;#x8BBE;&amp;#x4E3A;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x6309;&amp;#x7167;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x987A;&amp;#x5E8F;&amp;#x4E0A;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x540E;&amp;#x9762;&amp;#x624D;&amp;#x4F1A;&amp;#x88AB;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;3&amp;#xFF09;&amp;#x518D;&amp;#x770B;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;set_pageblock_migratetype -&amp;gt;&amp;#xA0;set_pageblock_flags_group&lt;/blockquote&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void set_pageblock_flags_group(struct page *page, unsigned long flags,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int start_bitidx, int end_bitidx)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long *bitmap;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, bitidx;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long value = 1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone = page_zone(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn = page_to_pfn(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitmap = get_pageblock_bitmap(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitidx = pfn_to_bitidx(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (; start_bitidx &amp;lt;= end_bitidx; start_bitidx++, value &amp;lt;&amp;lt;= 1)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (flags &amp;amp; value)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __set_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __clear_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6CA1;&amp;#x6709;&amp;#x60F3;&amp;#x8C61;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x7B80;&amp;#x5355;&amp;#x5427;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;bitmap&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;&amp;#x4EC0;&amp;#x4E48;&amp;#x5462;&amp;#xFF1F;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static unsigned long __init usemap_size(unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(zonesize, pageblock_nr_pages);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = usemapsize &amp;gt;&amp;gt; pageblock_order;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize *= NR_PAGEBLOCK_BITS;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(usemapsize, 8 * sizeof(unsigned long));&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return usemapsize / 8;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static void __init setup_usemap(struct pglist_data *pgdat,&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone, unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize = usemap_size(zonesize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = NULL;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (usemapsize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = alloc_bootmem_node(pgdat, usemapsize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;bitmap&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;zone-&amp;gt;pageblock_flags&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;zone&amp;#x88AB;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;pageblock&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;pageblock&amp;#x5206;&amp;#x914D;3&amp;#x4F4D;&amp;#x6765;&amp;#x8868;&amp;#x793A;migrate type&amp;#x3002;pageblock&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;freearea&amp;#x4E2D;order&amp;#x6700;&amp;#x5927;&amp;#x7684;&amp;#x4E00;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/span&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;free_area_init_core -&amp;gt;&amp;#xA0;set_pageblock_order(pageblock_default_order())&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static inline int pageblock_default_order(void)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (HPAGE_SHIFT &amp;gt; PAGE_SHIFT)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return HUGETLB_PAGE_ORDER;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return MAX_ORDER-1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x7528;get_pageblock_migratetype(page)&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x672C;page&amp;#x7684;migrate type&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x53EA;&amp;#x8981;&amp;#x6CA1;&amp;#x6709;&amp;#x505A;migrate type&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;page&amp;#x7684;migrate type&amp;#x603B;&amp;#x662F;&amp;#x548C;&amp;#x4ED6;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x662F;&amp;#x4E00;&amp;#x81F4;&amp;#x7684;&amp;#x3002;migrate type&amp;#x53EA;&amp;#x4F1A;&amp;#x5728;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E2D;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x5728;&amp;#x672C;migrate type&amp;#x4E2D;&amp;#x65E0;&amp;#x5185;&amp;#x5B58;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5C31;&amp;#x8981;&amp;#x53BB;&amp;#x5907;&amp;#x7528;&amp;#x7684;migrate type&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x627E;&amp;#x6700;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x8FC1;&amp;#x79FB;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x518D;&amp;#x4E0D;&amp;#x6D4E;&amp;#x8FD8;&amp;#x6709;reserved&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0B;&amp;#x9762;&amp;#x5206;&amp;#x6790;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x662F;&amp;#x5982;&amp;#x4F55;&amp;#x6539;&amp;#x53D8;&amp;#x7684;&amp;#x3002;&amp;#x8FD8;&amp;#x662F;&amp;#x6709;&amp;#x70B9;&amp;#x5C0F;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/migrate type&amp;#x2014;&amp;#x2014;buddy system&amp;#x7684;&amp;#x597D;&amp;#x642D;&amp;#x6863;/1499486799151&#34; hash=&#34;78d55e4b7bcdd406f2bf0b19ceba585b&#34; align alt longdesc width=&#34;910&#34; height=&#34;657&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&amp;#x6240;&amp;#x6709;&amp;#x8BB2;&amp;#x5230;fallback&amp;#x673A;&amp;#x5236;&amp;#x7684;&amp;#x8D44;&amp;#x6599;&amp;#x4E0A;&amp;#x90FD;&amp;#x4F1A;&amp;#x63D0;&amp;#x9192;&amp;#x6211;&amp;#x4EEC;&amp;#x6CE8;&amp;#x610F;&amp;#xFF0C;&amp;#x5728;&amp;#x4ECE;backup migratetype&amp;#x4E2D;&amp;#x53D6;&amp;#x5185;&amp;#x5B58;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x4ECE;&amp;#x5927;&amp;#x7684;order&amp;#x5F80;&amp;#x5C0F;order&amp;#x9012;&amp;#x51CF;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;order&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;NULL&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;&amp;#x7B2C;&amp;#x4E8C;&amp;#x70B9;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E00;&amp;#x8D77;&amp;#x4F5C;&amp;#x7528;&amp;#xFF0C;page&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4F1A;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x800C;&amp;#x662F;&amp;#x5728;&amp;#x6EE1;&amp;#x8DB3;&amp;#x4E00;&amp;#x5B9A;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x624D;&amp;#x4F1A;&amp;#x53D1;&amp;#x751F;&amp;#x3002;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;page moved &amp;gt;= pageblock / 2&amp;#x3002;&amp;#x4EC0;&amp;#x4E48;&amp;#x610F;&amp;#x601D;&amp;#x5462;&amp;#xFF1F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x7684;order&amp;#x8D85;&amp;#x8FC7;pageblock_order&amp;#x7684;&amp;#x4E00;&amp;#x534A;&amp;#xFF0C;&amp;#x4EE5;7800&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;default pageblock_order&amp;#x662F;MAX_ORDER-1 = 10&amp;#xFF0C;&amp;#x5219;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;order&amp;#x8981;&amp;#x8D85;&amp;#x8FC7;5&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;32&amp;#x4E2A;page&amp;#x3002;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x4E0A;&amp;#x6709;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E00;&amp;#x534A;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;buddy&amp;#x3002;&amp;#x82E5;&amp;#x6EE1;&amp;#x8DB3;&amp;#x8FD9;&amp;#x4E24;&amp;#x70B9;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x4F1A;&amp;#x88AB;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C5E;&amp;#x4E8E;&amp;#x4ED6;&amp;#x4E14;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#x7684;buddy&amp;#x5728;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;&amp;#x5408;&amp;#x5E76;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x6D4B;&amp;#x8BD5;&amp;#x4E0A;&amp;#x9762;&amp;#x6240;&amp;#x8BF4;&amp;#x7684;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5148;&amp;#x5C06;pageblock&amp;#x4E2D;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;buddy&amp;#x79FB;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#xFF0C;&amp;#x4F46;&amp;#x5E76;&amp;#x4E0D;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x6539;&amp;#x53D8;&amp;#x5176;migratetype&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x83B7;&amp;#x53D6;migratetype&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x51FD;&amp;#x6570;get_pageblock_migratetype&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x53EA;&amp;#x8981;&amp;#x4E0D;&amp;#x4FEE;&amp;#x6539;&amp;#x6574;&amp;#x5757;pageblock&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;&amp;#x5230;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;buddy&amp;#x7684;migratetype&amp;#x5C5E;&amp;#x6027;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 4&amp;#xFF09;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x8D85;&amp;#x8FC7;pageblock&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x90FD;&amp;#x4FEE;&amp;#x6539;&amp;#x6210;&amp;#x6211;&amp;#x4EEC;&amp;#x6240;&amp;#x9700;&amp;#x8981;&amp;#x7684;migratetype&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD9;&amp;#x91CC;&amp;#x53CD;&amp;#x6620;&amp;#x51FA;&amp;#x7684;&amp;#x601D;&amp;#x60F3;&amp;#x548C;&amp;#x4E0A;&amp;#x9762;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x5185;&amp;#x5B58;&amp;#x8DB3;&amp;#x591F;&amp;#x5927;&amp;#xFF0C;&amp;#x5C31;&amp;#x8FC1;&amp;#x79FB;migratetype&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 5&amp;#xFF09;&amp;#x6700;&amp;#x540E;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x4E00;&amp;#x70B9;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x5224;&amp;#x65AD;&amp;#x5176;&amp;#x5B9E;&amp;#x4E0D;&amp;#x5B8C;&amp;#x6574;&amp;#xFF0C;&amp;#x771F;&amp;#x5B9E;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;if (unlikely(current_order &amp;gt;= (pageblock_order &amp;gt;&amp;gt; 1)) ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_migratetype == MIGRATE_RECLAIMABLE ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;page_group_by_mobility_disabled) { &amp;#x2026;&amp;#x2026; }&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#x8868;&amp;#x793A;&amp;#x8FC1;&amp;#x79FB;&amp;#x7279;&amp;#x6027;&amp;#x5173;&amp;#x95ED;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x9875;&amp;#x9762;&amp;#x5E76;&amp;#x4E0D;&amp;#x53D7;migratetype&amp;#x6240;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x90A3;&amp;#x9875;&amp;#x9762;&amp;#x5E94;&amp;#x8BE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x968F;&amp;#x5FC3;&amp;#x6240;&amp;#x6B32;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x786E;&amp;#x5B9E;&amp;#x5982;&amp;#x6B64;&amp;#xFF0C;&amp;#x540E;&amp;#x9762;&amp;#x5982;&amp;#x679C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#xFF0C;&amp;#x4E5F;&amp;#x5E76;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x5224;&amp;#x65AD;&amp;#x6709;&amp;#x591A;&amp;#x5C11;free buddy&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FC1;&amp;#x79FB;&amp;#x9875;&amp;#x9762;&amp;#x4E86;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF0C;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;start_migratetype == MIGRATE_RECLAIMABLE&amp;#x5C31;&amp;#x503C;&amp;#x5F97;&amp;#x63A8;&amp;#x6572;&amp;#x4E86;&amp;#x3002;&amp;#x6240;&amp;#x6709;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x90FD;&amp;#x6CA1;&amp;#x6709;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&amp;#x7F51;&amp;#x7EDC;&amp;#x4E0A;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x89E3;&amp;#x91CA;&amp;#x662F;&amp;#xFF1A;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;i&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#x53EF;&amp;#x56DE;&amp;#x6536;&amp;#x9875;&amp;#xFF1A;&amp;#x4E0D;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x79FB;&amp;#x52A8;&amp;#xFF0C;&amp;#x4F46;&amp;#x53EF;&amp;#x4EE5;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x5176;&amp;#x5185;&amp;#x5BB9;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x67D0;&amp;#x4E9B;&amp;#x6E90;&amp;#x91CD;&amp;#x65B0;&amp;#x751F;&amp;#x6210;&lt;/span&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#xA0;&amp;#xA0;&lt;/span&gt;&lt;/i&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x4EE5;&amp;#x6211;&amp;#x8BA4;&amp;#x4E3A;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RECLAIMABLE&amp;#x56E0;&amp;#x4E3A;&amp;#x5F88;&amp;#x5BB9;&amp;#x6613;&amp;#x88AB;&amp;#x91CA;&amp;#x653E;&amp;#xFF08;&amp;#x6216;&amp;#x53EB;&amp;#x56DE;&amp;#x6536;&amp;#xFF09;&amp;#xFF0C;&amp;#x4ED6;&amp;#x4E5F;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#x548C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x66FF;&amp;#x8865;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x7BA1;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x9875;&amp;#x9762;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#xFF0C;&amp;#x90FD;&amp;#x5E94;&amp;#x8BE5;&amp;#x5C3D;&amp;#x53EF;&amp;#x80FD;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#x7ED9;&amp;#x4ED6;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;br&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/23/Linux%E5%86%85%E5%AD%98%E4%B9%8B%E9%A1%B5%E8%A1%A8/</guid>
            <title>Linux内存之页表</title>
            <link>https://blog.zhougy.top/2012/11/23/Linux%E5%86%85%E5%AD%98%E4%B9%8B%E9%A1%B5%E8%A1%A8/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Fri, 23 Nov 2012 13:58:08 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;Linux&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x9875;&amp;#x8868;&amp;#x7684;&amp;#x6846;&amp;#x67B6;&amp;#x5728; &lt;a href=&#34;evernote:///view/161681/s10/58f22e85-f865-455a-ad12-948ff6c02459/58f22e85-f865-455a-ad12-948ff6c02459/&#34; style=&#34;color:#69aa35&#34;&gt;vmalloc&amp;#x5206;&amp;#x6790;&lt;/a&gt;&amp;#x4E2D;&amp;#xFF0C;__vmalloc_area_node&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E0E;&amp;#x5206;&amp;#x914D;&amp;#x9875;&amp;#x8868;&amp;#x9879;&amp;#x4E24;&amp;#x8282;&amp;#x4E2D;&amp;#x5DF2;&amp;#x7ECF;&amp;#x6709;&amp;#x6240;&amp;#x9610;&amp;#x8FF0;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x518D;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x603B;&amp;#x4F53;&amp;#x4E0A;&amp;#x7684;&amp;#x628A;&amp;#x63E1;&amp;#x3002;&amp;#x6587;&amp;#x4E2D;&amp;#x4F1A;&amp;#x501F;&amp;#x7528;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x56FE;&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x6240;&amp;#x8C13;&amp;#x7684;&amp;#x9875;&amp;#x8868;&amp;#x7ED3;&amp;#x6784;&amp;#x5982;&amp;#x4E0B;&amp;#x3002;&amp;#x9488;&amp;#x5BF9;&amp;#x73B0;&amp;#x5728;&amp;#x7684;64&amp;#x4F4D;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;Linux&amp;#x5DF2;&amp;#x7ECF;&amp;#x53EF;&amp;#x4EE5;&amp;#x652F;&amp;#x6301;4&amp;#x7EA7;&amp;#x9875;&amp;#x8868;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5373;pgd&amp;#xFF0C;pud&amp;#xFF0C;pmd&amp;#x548C;pte&amp;#x3002;&amp;#x4F46;&amp;#x76EE;&amp;#x524D;&amp;#x4E00;&amp;#x822C;&amp;#x5D4C;&amp;#x5165;&amp;#x5F0F;&amp;#x7684;&amp;#x5E94;&amp;#x7528;&amp;#x5E76;&amp;#x4E0D;&amp;#x4F1A;&amp;#x4F7F;&amp;#x80FD;&amp;#x8BE5;&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;pud&amp;#x548C;pmd&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x90FD;&amp;#x662F;&amp;#x6307;&amp;#x5411;pgd&amp;#x8868;&amp;#x9879;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/Linux&amp;#x5185;&amp;#x5B58;&amp;#x4E4B;&amp;#x9875;&amp;#x8868;/1537085034090&#34; hash=&#34;3e44ac2386ec1722d0f7d00bcbd8748b&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x7B80;&amp;#x5355;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E0B;&amp;#x8FD9;&amp;#x5E45;&amp;#x56FE;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. &amp;#x6240;&amp;#x6709;Linux&amp;#x90FD;&amp;#x662F;4G&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x4EE3;&amp;#x8868;2MB&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x5171;2K&amp;#x8868;&amp;#x9879;&amp;#xFF0C;&amp;#x5360;2&amp;#x4E2A;page&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5728;&amp;#x8868;&amp;#x4E2D;&amp;#x90FD;&amp;#x662F;&amp;#x6709;&amp;#x5E8F;&amp;#x7684;&amp;#xFF0C;&amp;#x5373;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7A7A;&amp;#x95F4;&amp;#x4E2D;&amp;#x4E5F;&amp;#x662F;&amp;#x6709;&amp;#x4F4E;&amp;#x5230;&amp;#x9AD8;&amp;#x7684;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x6BCF;&amp;#x4E2A;pgd&amp;#x8868;&amp;#x9879;&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;page&amp;#xFF0C;4KB&amp;#xFF0C;&amp;#x5206;&amp;#x6210;4&amp;#x4E2A;&amp;#x5B50;&amp;#x8868;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. &amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x5B50;&amp;#x8868;2KB&amp;#xFF0C;&amp;#x5305;&amp;#x542B;512&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#xFF0C;&amp;#x6B63;&amp;#x597D;2MB&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x89C6;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;pte&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;page&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;pgd&amp;#x8868;&amp;#x4FDD;&amp;#x5B58;&amp;#x5728;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7684;mm_struct&amp;#x4E2D;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;struct mm_struct {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;pgd_t * pgd;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;pte_alloc_map /&amp;#xA0;pte_alloc_map_lock /&amp;#xA0;pte_alloc_kernel&amp;#x8FD9;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E3A;pgd&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x5206;&amp;#x914D;&amp;#x4ED6;&amp;#x6240;&amp;#x6307;&amp;#x5411;&amp;#x7684;&amp;#x90A3;&amp;#x4E00;&amp;#x9875;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;pte&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x56E0;&amp;#x4E3A;&amp;#x5185;&amp;#x5B58;&amp;#x4F1A;&amp;#x4E0D;&amp;#x65AD;&amp;#x7684;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x4E0D;&amp;#x53EF;&amp;#x80FD;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;page&amp;#x90FD;&amp;#x4F1A;&amp;#x65B0;&amp;#x5EFA;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x4E00;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;Linux&amp;#x4E3A;&amp;#x6BCF;&amp;#x4E2A;pgd&amp;#x8868;&amp;#x9879;&amp;#xFF08;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x4E3A;&amp;#x4E86;&amp;#x517C;&amp;#x5BB9;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x5C06;&amp;#x4E4B;&amp;#x79F0;&amp;#x4E3A;pmd&amp;#xFF09;&amp;#x52A0;&amp;#x5165;&amp;#x4E86;&amp;#x4E00;&amp;#x4E9B;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5E76;&amp;#x5728;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x4E4B;&amp;#x524D;&amp;#xFF0C;&amp;#x7528;&amp;#x5B8F;pmd_present(*(pmd))&amp;#x6765;&amp;#x68C0;&amp;#x9A8C;&amp;#x6B64;pte&amp;#x662F;&amp;#x5426;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5206;&amp;#x914D;&amp;#x4E86;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5206;&amp;#x914D;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x518D;&amp;#x5206;&amp;#x914D;&amp;#x4E86;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5462;&amp;#xFF1F;&lt;a href=&#34;evernote:///view/161681/s10/58f22e85-f865-455a-ad12-948ff6c02459/58f22e85-f865-455a-ad12-948ff6c02459/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;vmalloc&amp;#x5206;&amp;#x6790;&lt;/a&gt;&amp;#x4E5F;&amp;#x6709;&amp;#x6240;&amp;#x5206;&amp;#x6790;&amp;#x3002;&amp;#x5373;&amp;#x51FD;&amp;#x6570;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD8;&amp;#x6709;&amp;#x5176;&amp;#x4ED6;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;&lt;/span&gt;pmd_populate&amp;#x3002;&amp;#x4ED6;&amp;#x4EEC;&amp;#x8C03;&amp;#x7528;&amp;#x8FD9;&amp;#x7684;&amp;#x6700;&amp;#x7EC8;&amp;#x51FD;&amp;#x6570;&amp;#x90FD;&amp;#x540C;&amp;#x662F;__pmd_populate&amp;#x3002;&amp;#x5373;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;pmdp[0] = __pmd(pmdval) ; &amp;#xA0;&lt;/font&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;// =&amp;#xA0;pmdval&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;pmdp[1] = __pmd(pmdval + 256 * sizeof(pte_t));&lt;/font&gt; &lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;// = &amp;#xA0;pmdval + 256 * sizeof(pte_t)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/Linux&amp;#x5185;&amp;#x5B58;&amp;#x4E4B;&amp;#x9875;&amp;#x8868;/1537085034093&#34; hash=&#34;8b0618db320f080d0cdad5ed8b11f8a9&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;div&gt;pmd_populate&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x7528;&amp;#x6237;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#xFF0C;&amp;#x800C;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x5185;&amp;#x6838;&amp;#x5730;&amp;#x5740;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x4ED6;&amp;#x4EEC;&amp;#x4E4B;&amp;#x95F4;&lt;/span&gt;&amp;#x7684;&amp;#x5DEE;&amp;#x522B;&amp;#x4FBF;&amp;#x6C34;&amp;#x5230;&amp;#x6E20;&amp;#x6210;&amp;#x4E86;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. &amp;#x4E24;&amp;#x8005;&amp;#x4E3A;pmd&amp;#x586B;&amp;#x5145;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x4E0D;&amp;#x4E00;&amp;#x6837;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#xFF1A;&lt;/span&gt;__pa(pte_ptr) | _PAGE_KERNEL_TABLE&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate&amp;#xFF1A;&lt;/span&gt;page_to_pfn(ptep) &amp;lt;&amp;lt; PAGE_SHIFT | _PAGE_USER_TABLE&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x53EF;&amp;#x89C1;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;+kernel&amp;#x6807;&amp;#x5FD7;&amp;#xFF0C;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;+user&amp;#x6807;&amp;#x5FD7;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x4E24;&amp;#x8005;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x4E5F;&amp;#x4E0D;&amp;#x540C;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x5219;&amp;#x662F;page&amp;#x7ED3;&amp;#x6784;&amp;#x6307;&amp;#x9488;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0D;&amp;#x7BA1;&amp;#x600E;&amp;#x4E48;&amp;#x6837;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x4EEC;&amp;#x7684;&amp;#x5B9E;&amp;#x8D28;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;pmd&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x90FD;&amp;#x662F;&amp;#x8FD9;&amp;#x4E00;&amp;#x4E2A;page&amp;#x8868;&amp;#x683C;&amp;#x6240;&amp;#x5728;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF08;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x504F;&amp;#x79FB;PAGE_SHIFT&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#xFF09;+&amp;#x4E00;&amp;#x4E2A;&amp;#x6807;&amp;#x5FD7;&amp;#x5185;&amp;#x6838;&amp;#x8FDB;&amp;#x7A0B;&amp;#x8FD8;&amp;#x662F;&amp;#x7528;&amp;#x6237;&amp;#x8FDB;&amp;#x7A0B; &amp;#x7684;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x81F3;&amp;#x6B64;&amp;#xFF0C;pte&amp;#xFF08;&amp;#x6216;&amp;#x8005;pmd&amp;#xFF09;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5C31;&amp;#x8BB2;&amp;#x6E05;&amp;#x695A;&amp;#x4E86;&amp;#xFF0C;&amp;#x90A3;&amp;#x6709;&amp;#x4E86;&amp;#x8FD9;&amp;#x9875;&amp;#x8868;&amp;#x683C;&amp;#x540E;&amp;#xFF0C;&amp;#x5C31;&amp;#x987A;&amp;#x5229;&amp;#x6210;&amp;#x7AE0;&amp;#x7684;&amp;#x8BE5;&amp;#x5F80;&amp;#x91CC;&amp;#x9762;&amp;#x586B;pte&amp;#x8868;&amp;#x9879;&amp;#x4E86;&amp;#x3002;&amp;#x9996;&amp;#x5148;&amp;#x7528;pte_offset_map / pte_offset_kernel&amp;#x627E;&amp;#x5230;&amp;#x8868;&amp;#x683C;&amp;#x4E2D;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x8868;&amp;#x9879;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x7528;&amp;#x51FD;&amp;#x6570;set_pte_at&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x505A;&amp;#x586B;&amp;#x5145;&amp;#x3002;set_pte_at&amp;#x6700;&amp;#x7EC8;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x6C47;&amp;#x7F16;&amp;#x51FD;&amp;#x6570;set_pte_ext&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x8003;&amp;#x8651;&amp;#x9AD8;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x8BDD;&amp;#xFF0C;pte_offset_map&amp;#x548C;pte_offset_kernel&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x90FD;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;=&amp;#xA0;pmd_page_vaddr(*(dir)) + __pte_index(addr)&lt;/div&gt;&lt;div&gt;&amp;#x524D;&amp;#x534A;&amp;#x90E8;&amp;#x5206;&amp;#x662F;pmd&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x540E;&amp;#x534A;&amp;#x90E8;&amp;#x5206;&amp;#x662F;&amp;#x672C;page&amp;#x5728;pmd&amp;#x4E2D;&amp;#x7684;&amp;#x504F;&amp;#x79FB;&amp;#x91CF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=========================&amp;#x5206;&amp;#x5272;&amp;#x7EBF;===================================&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8BF4;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E48;&amp;#x591A;&amp;#xFF0C;&amp;#x9875;&amp;#x8868;&amp;#x7684;&amp;#x5EFA;&amp;#x7ACB;&amp;#x5C31;&amp;#x662F;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E9B;&amp;#x4E8B;&amp;#x60C5;&amp;#x4E86;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x518D;&amp;#x4E3E;&amp;#x4E2A;&amp;#x5C0F;&amp;#x5C0F;&amp;#x7684;&amp;#x4F8B;&amp;#x5B50;&amp;#xFF0C;&amp;#x662F;mmap&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;remap_pfn_range&amp;#x3002;mmap&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x4E8B;&amp;#x60C5;&amp;#x662F;&amp;#x628A;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#xFF08;&amp;#x5305;&amp;#x62EC;&amp;#x8BBE;&amp;#x5907;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x8BBE;&amp;#x5907;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5219;&amp;#x8981;&amp;#x9A71;&amp;#x52A8;&amp;#x6765;&amp;#x652F;&amp;#x6301;&amp;#xFF09;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x4E00;&amp;#x6B3E;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x4E0A;&amp;#xFF0C;&amp;#x90A3;remap_pfn_range&amp;#x5C31;&amp;#x662F;&amp;#x8981;&amp;#x4E3A;&amp;#x4E00;&amp;#x6BB5;&amp;#x7269;&amp;#x7406;page&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x9879;&amp;#x3002;&amp;#x5148;&amp;#x770B;&amp;#x4ED6;&amp;#x4EEC;&amp;#x7684;&amp;#x539F;&amp;#x578B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;mmap (caddr_t addr, size_t len, int prot, int flags, int fd, off_t offset)&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;int remap_pfn_range(struct vm_area_struct *vma,&lt;/font&gt;&lt;/div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long virt_addr, unsigned long pfn,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long size, pgprot_t prot);&lt;/font&gt;&lt;/font&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;mmap&amp;#x662F;Linux&amp;#x7684;API&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x9488;&amp;#x5BF9;&amp;#x666E;&amp;#x901A;&amp;#x6587;&amp;#x4EF6;&amp;#x548C;&amp;#x8BBE;&amp;#x5907;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x6BD4;&amp;#x8F83;&amp;#x6709;&amp;#x666E;&amp;#x904D;&amp;#x6027;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x662F;&amp;#x9A71;&amp;#x52A8;&amp;#x4E2D;&amp;#x4E3A;&amp;#x4E86;&amp;#x5B9E;&amp;#x73B0;mmap&amp;#x7ECF;&amp;#x5E38;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;&amp;#x7684;remap_pfn_range&amp;#x51FD;&amp;#x6570;&amp;#x3002;&amp;#x7406;&amp;#x4E00;&amp;#x4E0B;&amp;#x4ED6;&amp;#x4EEC;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x5BF9;&amp;#x5E94;&amp;#x5173;&amp;#x7CFB;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;b&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;mmap&lt;/span&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&lt;/span&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;/b&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;b&gt;remap_pfn_range&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;addr&lt;/span&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;lt;=&amp;gt; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;vma,&amp;#xA0;&lt;/span&gt;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;fd&lt;/span&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;,&lt;/font&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;offset,len&lt;/span&gt;&lt;/font&gt;&amp;#xA0; &amp;lt;=&amp;gt; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;pfn,&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;size&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8C03;&amp;#x7528;&amp;#x8FC7;&amp;#x7A0B;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. &amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x8C03;&amp;#x7528;mmap&amp;#x6765;&amp;#x6620;&amp;#x5C04;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;fd&amp;#x4E2D;offset~offset+len&amp;#x8FD9;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x5185;&amp;#x6838;&amp;#x6309;&amp;#x7167;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x6765;&amp;#xFF0C;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;vma_area_struct&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6240;&amp;#x6709;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x6620;&amp;#x5C04;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5305;&amp;#x62EC;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#xFF08;fd, offset,len&amp;#xFF09;&amp;#x548C;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF08;addr&amp;#xFF09;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;remap_pfn_range&amp;#x7684;&amp;#x53C2;&amp;#x6570;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;pfn&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;size&amp;#xFF0C;&amp;#x90FD;&amp;#x5728;vma&amp;#x4E2D;&amp;#x6709;&amp;#x6240;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x3002;&amp;#x81F3;&amp;#x4E8E;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x8FD9;&amp;#x6837;&amp;#x505A;&amp;#xFF0C;&amp;#x6211;&amp;#x731C;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x63D0;&amp;#x4F9B;&amp;#x7075;&amp;#x6D3B;&amp;#x6027;&amp;#xFF0C;&amp;#x6BD5;&amp;#x7ADF;vma&amp;#x53EF;&amp;#x4EE5;&amp;#x8D85;&amp;#x8FC7;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x6620;&amp;#x5C04;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x5185;&amp;#x6838;&amp;#x5728;&amp;#x5206;&amp;#x914D;vma&amp;#x65F6;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;vma&amp;#x53EF;&amp;#x4EE5;&amp;#x5408;&amp;#x5E76;&amp;#xFF0C;&amp;#x5219;&amp;#x4F20;&amp;#x5165;&amp;#x7684;vma&amp;#x5C31;&amp;#x5927;&amp;#x4E8E;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x7528;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;pfn&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;size&amp;#x6765;&amp;#x8BF4;&amp;#x660E;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;remap_pfn_range&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr~&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr+PAGE_ALIGN(size)&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#xFF0C;&amp;#x4EE3;&amp;#x7801;&amp;#x5982;&amp;#x4E0B;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;int remap_pfn_range(struct vm_area_struct *vma, unsigned long addr,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, unsigned long size, pgprot_t prot)&lt;br&gt;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;do {&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; next = pgd_addr_end(addr, end);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; err = remap_pud_range(mm, pgd, addr, next,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn + (addr &amp;gt;&amp;gt; PAGE_SHIFT), prot);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (err)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; break;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; } while (pgd++, addr = next, addr != end);&lt;/font&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;remap_pud_range -&amp;gt;&amp;#xA0;remap_pmd_range -&amp;gt;&amp;#xA0;remap_pte_range&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x524D;&amp;#x9762;&amp;#x4E24;&amp;#x4E2A;&amp;#x662F;&amp;#x865A;&amp;#x7684;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x4E2A;&amp;#x5C31;&amp;#x662F;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x4E86;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;static int remap_pte_range(struct mm_struct *mm, pmd_t *pmd,&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long addr, unsigned long end,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, pgprot_t prot)&lt;br&gt;&lt;/font&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; pte = pte_alloc_map_lock(mm, pmd, addr, &amp;amp;ptl);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; do {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; set_pte_at(mm, addr, pte, pte_mkspecial(pfn_pte(pfn, prot)));&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn++;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; } while (pte++, addr += PAGE_SIZE, addr != end);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;1. pmd&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x4E4B;&amp;#x524D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;pgd&amp;#x8868;&amp;#x9879;&amp;#x6307;&amp;#x5411;&amp;#x7684;&amp;#x90A3;1&amp;#x4E2A;page&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;2. addr~end&amp;#x662F;&amp;#x8981;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x7684;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x8303;&amp;#x56F4;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;3. pfn&amp;#x662F;&amp;#x8FD9;&amp;#x5757;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x8303;&amp;#x56F4;&amp;#x9996;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x5E27;&amp;#x53F7;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;4. prot&amp;#x662F;&amp;#x4E00;&amp;#x4E9B;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/13/%E5%86%85%E5%AD%98%E9%A1%B5%E7%9A%84wait-wake%E6%9C%BA%E5%88%B6/</guid>
            <title>内存页的wait-wake机制</title>
            <link>https://blog.zhougy.top/2012/11/13/%E5%86%85%E5%AD%98%E9%A1%B5%E7%9A%84wait-wake%E6%9C%BA%E5%88%B6/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 13 Nov 2012 19:48:06 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#x5173;&amp;#x4E8E;&amp;#x5185;&amp;#x5B58;&amp;#x4E5F;&amp;#x5728;&amp;#x5206;&amp;#x914D;&amp;#x65F6;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x5524;&amp;#x9192;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;include/linux/mmzone.h 389&amp;#x884C;&amp;#x7684;&amp;#x6CE8;&amp;#x91CA;&amp;#x4E3A;&amp;#x6211;&amp;#x4EEC;&amp;#x6307;&amp;#x51FA;&amp;#x4E86;&amp;#x7528;&amp;#x6237;&amp;#x53EF;&amp;#x7528; &amp;#x7684;&amp;#x6700;&amp;#x57FA;&amp;#x672C;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x63A5;&amp;#x53E3;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;__wait_on_page_locked / &amp;#xA0;unlock_page&amp;#xFF0C;&amp;#x5B9A;&amp;#x4E49;&amp;#x5728;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;mm/filemap.c&amp;#x4E2D;&lt;/span&gt;&amp;#x3002;&amp;#x4F46;&amp;#x7ECF;&amp;#x8FC7;&amp;#x68C0;&amp;#x67E5;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x771F;&amp;#x6B63;&amp;#x80FD;&amp;#x63D0;&amp;#x4F9B;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x5176;&amp;#x5B9E;&amp;#x662F;wait_on_page_locked&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;__wait_on_page_locked&amp;#xA0;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&amp;#x5176;&amp;#x4F5C;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x5B9A;&amp;#x4E49;&amp;#x5728;&amp;#x5934;&amp;#x6587;&amp;#x4EF6;&amp;#x4E2D;&amp;#x7684;inline&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x88AB;&amp;#x5305;&amp;#x542B;&amp;#x6B64;&amp;#x5934;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;c&amp;#x6587;&amp;#x4EF6;&amp;#x8C03;&amp;#x7528;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;wait_on_page_bit&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;* __wait_on_page_locked() and unlock_page() in mm/filemap.c, are the&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;* primary users of these fields, and in mm/page_alloc.c&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;* free_area_init_core() performs the initialization of them.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;wait_on_page_bit&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x7684;wait-wake&amp;#x673A;&amp;#x5236;/1537085035448&#34; hash=&#34;fd66b201ad743e32ad690549b2114dfa&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x91CC;&amp;#x9762;&amp;#x6697;&amp;#x85CF;&amp;#x7384;&amp;#x673A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&lt;span style=&#34;font-size: 10pt; font-family: Arial; text-indent: 0mm;&#34;&gt;DEFINE_WAIT_BIT&amp;#x505A;&amp;#x4E86;&amp;#x5F88;&amp;#x591A;&amp;#x4E8B;&amp;#x60C5;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5B83;&amp;#x662F;&amp;#x6807;&amp;#x51C6;&amp;#x7684;Linux&amp;#x7B49;&amp;#x5F85;&amp;#x673A;&amp;#x5236;&amp;#x4E2D;DEFINE_WAIT&amp;#x7684;&amp;#x53D8;&amp;#x79CD;&amp;#x3002;&amp;#x5176;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6807;&amp;#x51C6;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x961F;&amp;#x5217;&amp;#x7684;&amp;#x6210;&amp;#x5458;&amp;#x53D8;&amp;#x91CF;wait_queue_t&amp;#x3002;&amp;#x53E6;&amp;#x5916;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;bit&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;word&amp;#x548C;bit_nr&amp;#x6307;&amp;#x5B9A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;__wait_on_bit&amp;#x901A;&amp;#x8FC7;page_waitqueue&amp;#x6765;&amp;#x627E;&amp;#x5230;&amp;#x961F;&amp;#x5217;&amp;#x5934;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x5C31;&amp;#x7275;&amp;#x6D89;&amp;#x5230;&amp;#x54C8;&amp;#x5E0C;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;a href=&#34;evernote:///view/161681/s10/60762aee-84ce-441b-b046-d79f9b9fc0da/60762aee-84ce-441b-b046-d79f9b9fc0da/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;linux&amp;#x5185;&amp;#x6838;&amp;#x54C8;&amp;#x5E0C;&amp;#x67E5;&amp;#x627E;&amp;#xFF08;1&amp;#xFF09;_zhe_wang-ChinaUnix&amp;#x535A;&amp;#x5BA2;&lt;/a&gt;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x7B80;&amp;#x8981;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E00;&amp;#x4E0B;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x5171;&amp;#x6709;&amp;#x8868;&amp;#x9879;size&amp;#x4E2A;&amp;#xFF0C;2^size &amp;gt;= pages / PAGES_PER_WAITQUEUE = pages/256&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x7528;&amp;#x6765;&amp;#x8BA1;&amp;#x7B97;&amp;#x54C8;&amp;#x5E0C;&amp;#x503C;&amp;#x7684;wait_table_bits&amp;#xFF0C;&amp;#x662F;size&amp;#x4E2D;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;1&amp;#x4F4D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x54C8;&amp;#x5E0C;&amp;#x503C;&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#xFF0C;&amp;#x8BE5;&amp;#x9875;&amp;#x7684;page&amp;#x7ED3;&amp;#x6784;&amp;#x6307;&amp;#x9488;&amp;#xFF08;&amp;#x5728;mem_map&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#xFF09;&amp;#xFF0C;wait_table_bits&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6240;&amp;#x8C13;&amp;#x7684;&amp;#x54C8;&amp;#x5E0C;&amp;#x8BA1;&amp;#x7B97;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x4E00;&amp;#x4E2A;&amp;#x5DE7;&amp;#x5999;&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&amp;#xFF0C;&amp;#x751F;&amp;#x6210;&amp;#x67D0;&amp;#x4E2A;&amp;#x533A;&amp;#x95F4;&amp;#x5185;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x503C;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6563;&amp;#x5217;&amp;#x5230;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x54C8;&amp;#x5E0C;&amp;#x51B2;&amp;#x7A81;&amp;#xFF0C;&amp;#x5219;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x91C7;&amp;#x7528;&amp;#x94FE;&amp;#x8868;&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x8868;&amp;#x793A;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x54C8;&amp;#x5E0C;&amp;#x503C;&amp;#x53C8;&amp;#x53EB;&amp;#x6563;&amp;#x5217;&amp;#x503C;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x91CC;&amp;#x7684;&amp;#x54C8;&amp;#x5E0C;&amp;#x8BA1;&amp;#x7B97;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;(val * GOLDEN_RATIO_PRIME_32) &amp;#xA0;&amp;gt;&amp;gt;(32 - bits)&amp;#xFF0C;GOLDEN_RATIO_PRIME_32&amp;#x662F;&amp;#x4E2A;&amp;#x5F88;&amp;#x7279;&amp;#x522B;&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x7ECF;&amp;#x8FC7;&amp;#x7814;&amp;#x7A76;&amp;#xFF0C;&amp;#x56FA;&amp;#x5B9A;&amp;#x4E0B;&amp;#x6765;&amp;#x7684;&amp;#xFF0C;&amp;#x7528;&amp;#x5B83;&amp;#x4E58;&amp;#x8FC7;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x6EA2;&amp;#x51FA;&amp;#x540E;&amp;#x5269;&amp;#x4E0B;&amp;#x6765;&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x968F;&amp;#x673A;&amp;#x6027;&amp;#x6BD4;&amp;#x8F83;&amp;#x5927;&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;bits&amp;#x662F;size&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;1&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53F3;&amp;#x79FB;&amp;#x540E;&amp;#x7684;&amp;#x503C;&amp;#x4E00;&amp;#x5B9A;&amp;lt;size&amp;#xFF0C;&amp;#x6B63;&amp;#x597D;&amp;#x7B26;&amp;#x5408;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x8981;&amp;#x6C42;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3&amp;#xFF09;&amp;#x5728;__wait_on_bit&amp;#x4E2D;&amp;#x4F1A;&amp;#x4E0D;&amp;#x65AD;&amp;#x6D4B;&amp;#x8BD5;page-&amp;gt;flags&amp;#x7684;PageLocked&amp;#x4F4D;&amp;#xFF0C;&amp;#x5373;&amp;#x7B2C;0&amp;#x4F4D;&amp;#x3002;&amp;#x7136;&amp;#x540E;&amp;#x4F1A;&amp;#x5728;&amp;#x771F;&amp;#x6B63;&amp;#x8981;&amp;#x4F11;&amp;#x7720;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8C03;&amp;#x7528;&amp;#x4F20;&amp;#x5165;&amp;#x7684;sync_page&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E0D;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x4F46;&amp;#x7275;&amp;#x6D89;&amp;#x5F88;&amp;#x5E7F;&amp;#xFF0C;&amp;#x548C;address_space&amp;#x7ED3;&amp;#x6784;&amp;#x6709;&amp;#x5173;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;4&amp;#xFF09;&amp;#x5728;&amp;#x505A;&amp;#x5B8C;&amp;#x4E00;&amp;#x7CFB;&amp;#x5217;&amp;#x7684;sync&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x8C03;&amp;#x7528;io_schedule&amp;#xFF0C;&amp;#x8BA9;&amp;#x51FA;&amp;#x5904;&amp;#x7406;&amp;#x5668;&amp;#xFF0C;&amp;#x8FDB;&amp;#x884C;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;unlock_page&amp;#x4E00;&amp;#x6837;&amp;#x901A;&amp;#x8FC7;page&amp;#x7ED3;&amp;#x6784;&amp;#x6307;&amp;#x9488;&amp;#x548C;PageLocked&amp;#x4F4D;&amp;#xFF0C;&amp;#x627E;&amp;#x5230;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x961F;&amp;#x5217;&amp;#x3002;&amp;#x4F46;&amp;#x4E00;&amp;#x4E2A;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x9879;&amp;#x53EF;&amp;#x4EE5;&amp;#x6709;256&amp;#x4E2A;page&amp;#x7B49;&amp;#x5728;&amp;#x5176;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x786E;&amp;#x5B9A;&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x5524;&amp;#x9192;&amp;#x60F3;&amp;#x8981;&amp;#x7684;&amp;#x90A3;&amp;#x4E2A;page&amp;#x7684;&amp;#x3002;&amp;#x53EF;&amp;#x80FD;&amp;#x548C;wait-&amp;gt;func=wake_bit_function&amp;#x6709;&amp;#x5173;&amp;#x3002;&amp;#x7275;&amp;#x626F;&amp;#x5230;wait queue&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/12/find_next_zero_bit/</guid>
            <title>find_next_zero_bit</title>
            <link>https://blog.zhougy.top/2012/11/12/find_next_zero_bit/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Mon, 12 Nov 2012 14:10:34 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;font face=&#34;Courier New&#34;&gt;unsigned long find_next_zero_bit(const unsigned long *addr,&amp;#xA0;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;unsigned long size,&lt;br&gt;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;unsigned long offset)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x7528;&amp;#x610F;&amp;#x662F;&amp;#x5728;addr&amp;#x5F00;&amp;#x59CB;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x6BB5;&amp;#x4E2D;&amp;#xFF0C;&amp;#x627E;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E3A;0&amp;#x7684;&amp;#x4F4D;&amp;#xFF0C;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x6210;&amp;#x529F;&amp;#x5219;&amp;#x8FD4;&amp;#x56DE;&amp;#x8BE5;&amp;#x4F4D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x627E;&amp;#x5230;&amp;#xFF0C;&amp;#x5219;&amp;#x8FD4;&amp;#x56DE;size&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#x641C;&amp;#x7D22;&amp;#x8303;&amp;#x56F4;&amp;#x5E76;&amp;#x4E0D;&amp;#x5305;&amp;#x542B;size&amp;#x8FD9;&amp;#x4E2A;&amp;#x70B9;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x5373;&amp;#x4FBF;size&amp;#x8FD9;&amp;#x4E2A;&amp;#x70B9;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x6EE1;&amp;#x8DB3;&amp;#x8981;&amp;#x6C42;&amp;#xFF0C;&amp;#x4F46;&amp;#x5176;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x548C;&amp;#x5931;&amp;#x8D25;&amp;#x65F6;&amp;#x7684;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x662F;&amp;#x76F8;&amp;#x540C;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4E5F;&amp;#x770B;&amp;#x4F5C;&amp;#x662F;&amp;#x5931;&amp;#x8D25;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x641C;&amp;#x7D22;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/find_next_zero_bit/1537085035761&#34; hash=&#34;eb1531c519cf2458b9144f798a8647b2&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/find_next_zero_bit/1537085035759&#34; hash=&#34;18c03589a58345add8371d7feb79093a&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x518D;&amp;#x5206;&amp;#x6790;&amp;#x4EE3;&amp;#x7801;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;unsigned long find_next_zero_bit(const unsigned long *addr, unsigned long size,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long offset)&lt;br&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; const unsigned long *p = addr + BITOP_WORD(offset);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long result = offset &amp;amp; ~(BITS_PER_LONG-1); &lt;font color=&#34;#41AD1C&#34;&gt;// result&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#xFF0C;&amp;#x641C;&amp;#x7D22;&amp;#x8D77;&amp;#x59CB;&amp;#x70B9;&amp;#x6240;&amp;#x5728;ULONG&amp;#x4E4B;&amp;#x524D;&amp;#x6240;&amp;#x6709;&amp;#x7684;bit&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long tmp;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (offset &amp;gt;= size)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; size -= result; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x6263;&amp;#x6389;result&amp;#xFF0C;&amp;#x5373;size_new&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; offset %= BITS_PER_LONG; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x53D6;&amp;#x5F97;&amp;#x6240;&amp;#x5728;ULONG&amp;#x4E2D;&amp;#x7684;&amp;#x504F;&amp;#x79FB;&amp;#x91CF;&amp;#xFF0C;&amp;#x5373;offset_new&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (offset) {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp = *(p++);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp |= ~0UL &amp;gt;&amp;gt; (BITS_PER_LONG - offset); &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x5C06;offset&amp;#x4E4B;&amp;#x5185;&amp;#x7684;bit&amp;#x5168;&amp;#x90E8;&amp;#x7F6E;1&amp;#xFF0C;&amp;#x53C2;&amp;#x770B;&amp;#x56FE;1&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (size &amp;lt; BITS_PER_LONG) &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x8FD9;&amp;#x8868;&amp;#x793A;&amp;#x641C;&amp;#x7D22;&amp;#x8303;&amp;#x56F4;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;ULONG&amp;#x8303;&amp;#x56F4;&amp;#x4E4B;&amp;#x5185;&amp;#xFF0C;&amp;#x53C2;&amp;#x770B;&amp;#x56FE;2&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto found_first;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (~tmp) &lt;font color=&#34;#41AD1C&#34;&gt;// tmp&amp;#x81F3;&amp;#x5C11;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;0&amp;#x4F4D;&amp;#xFF0C;&amp;#x5373;tmp&amp;#x7684;&lt;/font&gt;&lt;/font&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;BPL - offset&amp;#x8FD9;&amp;#x4E00;&amp;#x6BB5;&amp;#x4E2D;&amp;#x81F3;&amp;#x5C11;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;0&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto found_middle;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size -= BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; result += BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; while (size &amp;amp; ~(BITS_PER_LONG-1)) { &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x4E0D;&amp;#x65AD;&amp;#x904D;&amp;#x5386;size&amp;#x524D;&amp;#x7684;ULONG&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (~(tmp = *(p++)))&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto found_middle;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; result += BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size -= BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (!size) &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x5F53;size&amp;#x6B63;&amp;#x597D;&amp;#x662F;&amp;#x6574;&amp;#x6570;&amp;#x4E2A;ULONG&amp;#x65F6;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x627E;&amp;#x7740;&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x5C31;&amp;#x662F;&amp;#x539F;&amp;#x59CB;&amp;#x7684;size&amp;#xFF0C;&amp;#x82E5;&amp;#x4E0D;&amp;#x662F;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4F9D;&amp;#x6B21;&amp;#x8FDB;&lt;/font&gt;&lt;/font&gt;&lt;font color=&#34;#41AD1C&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;found_first&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;found_middle&lt;/span&gt;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return result;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp = *p;&lt;br&gt;&lt;br&gt;found_first:&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp |= ~0UL &amp;lt;&amp;lt; size; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x5C06;size&amp;#x4EE5;&amp;#x4E0A;&amp;#x90E8;&amp;#x5206;&amp;#x5168;&amp;#x90E8;&amp;#x7F6E;1&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (tmp == ~0UL)&amp;#xA0;&amp;#xA0;&amp;#xA0; &lt;font color=&#34;#41AD1C&#34;&gt;//&amp;#xA0;&lt;/font&gt;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;offset~size&amp;#x6216;head~size&amp;#x4E4B;&amp;#x95F4;&amp;#x6CA1;&amp;#x6709;0&lt;/font&gt;&lt;/span&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return result + size;&amp;#xA0;&amp;#xA0; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x5373;&amp;#x4E3A;&amp;#x4F20;&amp;#x5165;&amp;#x7684;size&lt;/font&gt;&lt;br&gt;found_middle:&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; return result + ffz(tmp); &lt;font color=&#34;#41AD1C&#34;&gt;//&amp;#xA0;&lt;/font&gt;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;ffz&amp;#x5C31;&amp;#x662F;&amp;#x5BFB;&amp;#x627E;unsigned long&amp;#x53D8;&amp;#x91CF;&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;0&amp;#x4F4D;&amp;#x7D22;&amp;#x5F15;&amp;#x7684;&amp;#x5B8F;&lt;/font&gt;&lt;/span&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/06/bootmem%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</guid>
            <title>bootmem工作原理</title>
            <link>https://blog.zhougy.top/2012/11/06/bootmem%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 06 Nov 2012 12:07:20 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style title lang xml:lang dir&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (test_bit(i, bdata-&amp;gt;node_bootmem_map)) {&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5982;&amp;#x679C;&amp;#x8FDE;&amp;#x7EED;&amp;#x7A7A;&amp;#x95F4;&amp;#x4E0D;&amp;#x8DB3;&amp;#xFF0C;&amp;#x5219;&amp;#x8FD4;&amp;#x56DE;&amp;#x91CD;&amp;#x65B0;&amp;#x641C;&amp;#x7D22;&amp;#x672A;&amp;#x5206;&amp;#x914D;&amp;#x533A;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, i, step);&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (sidx == i)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx += step;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto find_block;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (bdata-&amp;gt;last_end_off &amp;amp; (PAGE_SIZE - 1) &amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x4E0A;&amp;#x4E00;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x5728;&amp;#x9875;&amp;#x8FB9;&amp;#x754C;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; PFN_DOWN(bdata-&amp;gt;last_end_off) + 1 == sidx) &amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_off = align_off(bdata, bdata-&amp;gt;last_end_off, align);&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// align = 64&amp;#xFF0C;&amp;#x5C06;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;start_off&amp;#x63D0;&amp;#x5347;&amp;#x5230;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;last_end_off&amp;#x9644;&amp;#x8FD1;&amp;#xFF0C;&amp;#x8981;&amp;#x6309;align&amp;#x5411;&amp;#x4E0B;&amp;#x5BF9;&amp;#x9F50;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;1.&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;1)arm_bootmem_init&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960777&#34; hash=&#34;8978309953a6dd59d6856df76150bb5f&#34; align alt longdesc width=&#34;1032&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6709;&amp;#x4E00;&amp;#x70B9;&amp;#xFF0C;&amp;#x5148;&amp;#x7406;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;Linux&amp;#x652F;&amp;#x6301;NUMA&amp;#x67B6;&amp;#x6784;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x4F46;NUMA&amp;#x4E00;&amp;#x822C;&amp;#x5E94;&amp;#x7528;&amp;#x4E8E;&amp;#x4E2D;&amp;#x5927;&amp;#x578B;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x6765;&amp;#x7075;&amp;#x6D3B;&amp;#x5904;&amp;#x7406;&amp;#x672C;&amp;#x5730;&amp;#x5185;&amp;#x5B58;&amp;#x4E0E;&amp;#x8FDC;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x4EE5;&amp;#x63D0;&amp;#x9AD8;&amp;#x5E73;&amp;#x5747;&amp;#x5185;&amp;#x5B58;&amp;#x8BFB;&amp;#x5199;&amp;#x901F;&amp;#x5EA6;&amp;#xFF0C;&amp;#x5373;&amp;#x4F18;&amp;#x5148;&amp;#x4F7F;&amp;#x7528;&amp;#x672C;&amp;#x5730;&amp;#x5185;&amp;#x5B58;&amp;#x6216;&amp;#x8005;&amp;#x8BBF;&amp;#x95EE;&amp;#x901F;&amp;#x5EA6;&amp;#x8F83;&amp;#x5FEB;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&amp;#x4F46;&amp;#x5D4C;&amp;#x5165;&amp;#x5F0F;&amp;#x8BBE;&amp;#x5907;&amp;#x6216;&amp;#x8005;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;D7800&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4F7F;&amp;#x7528;Linux&amp;#x7684;NUMA&amp;#x67B6;&amp;#x6784;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&amp;#x6362;&amp;#x53E5;&amp;#x8BDD;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x53EA;&amp;#x6709;node 0&amp;#xFF0C;&amp;#x5373;&amp;#x5176;&amp;#x4E0A;&amp;#x53EA;&amp;#x6709;&amp;#x672C;&amp;#x5730;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0A;&amp;#x56FE;&amp;#x4E2D;bdata_list&amp;#x5728;NUMA&amp;#x67B6;&amp;#x6784;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6240;&amp;#x6709;node&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x4F46;&amp;#x5728;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#xFF0C;&amp;#x8BE5;list&amp;#x4E0A;&amp;#x53EA;&amp;#x6709;node 0&amp;#x7684;&amp;#xFF1A;min~max_low&amp;#x4F4E;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x3002;&amp;#x518D;&amp;#x770B;memblock&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53C2;&amp;#x8003;&lt;a href=&#34;evernote:///view/161681/s10/84e5d565-822f-4ae2-adce-56fb6ced4c88/84e5d565-822f-4ae2-adce-56fb6ced4c88/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;memblock&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&lt;/a&gt;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;memblock.memory&amp;#x8868;&amp;#x683C;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5305;&amp;#x542B;&amp;#x4E86;meminfo&amp;#x4E2D;&amp;#x6240;&amp;#x6709;bank&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x533A;&amp;#x95F4;&amp;#x3002;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x4E0A;&amp;#xFF0C;&amp;#x5C31;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x5DE6;&amp;#x534A;&amp;#x90E8;&amp;#x5206;&amp;#x7684;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF0C;bdata_list&amp;#x4E0A;node 0&amp;#x7684;min~max_low&amp;#x533A;&amp;#x6BB5;&amp;#x4E0A;&amp;#xFF0C;&amp;#x6709;&amp;#x7740;nrbanks&amp;#x4E2A;region_start~region_end&amp;#x5185;&amp;#x5B58;&amp;#x533A;&amp;#x95F4;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E8E;&amp;#x662F;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x5C31;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#x4E86;&amp;#x3002;&amp;#x5728;&amp;#x51FD;&amp;#x6570;mark_bootmem&amp;#x4E2D;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;bdata_list&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x5224;&amp;#x65AD;&amp;#x533A;&amp;#x6BB5;&amp;#x662F;&amp;#x5426;&amp;#x7B26;&amp;#x5408;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x5982;&amp;#x4E0B;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;if (pos &amp;lt; bdata-&amp;gt;node_min_pfn ||&amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pos &amp;gt;= bdata-&amp;gt;node_low_pfn) {&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8868;&amp;#x793A;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E86;&amp;#x6B64;node&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x533A;&amp;#x6BB5;&amp;#xFF0C;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; BUG_ON(pos != start);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; continue;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;if (max == end)&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// end&amp;#x4F1A;&amp;#x4E0D;&amp;#x4F1A;&amp;#x8D85;&amp;#x8FC7;max_low&amp;#xFF0C;&amp;#x5373;end&amp;#x662F;&amp;#x9AD8;&amp;#x7AEF;&amp;#x5730;&amp;#x5740;&amp;#xFF1F;&amp;#x6211;&amp;#x7684;&amp;#x7406;&amp;#x89E3;&amp;#xFF0C;end&amp;#x53EF;&amp;#x4EE5;&amp;#x8D85;&amp;#x8FC7;low mem&amp;#x7684;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x5728;bootmem&amp;#x4E2D;&amp;#x6211;&amp;#x4EEC;&amp;#x53EA;&amp;#x8003;&amp;#x8651;low mem&amp;#x7684;&amp;#x90E8;&amp;#x5206;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;pos = bdata-&amp;gt;node_low_pfn;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8FD0;&amp;#x884C;&amp;#x5230;&amp;#x8FD9;&amp;#x91CC;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;start~end&amp;#x7684;region&amp;#x5DF2;&amp;#x7ECF;&amp;#x5904;&amp;#x7406;&amp;#x8FC7;&amp;#x4E86;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;max!=end&amp;#xFF0C;&amp;#x4E4B;&amp;#x540E;&amp;#x4F1A;&amp;#x7A7A;&amp;#x8DD1;&amp;#x5B8C;&amp;#x5269;&amp;#x4E0B;&amp;#x7684;&amp;#x5FAA;&amp;#x73AF;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960791&#34; hash=&#34;fd01a1a831a3b7caf3fc5ad38f42a341&#34; align alt longdesc width=&#34;1032&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x603B;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#x6240;&amp;#x8C13;&amp;#x7684;bootmem&amp;#xFF0C;&amp;#x5373;&amp;#x662F;&amp;#x4E3A;meminfo&amp;#x4E2D;&amp;#x6240;&amp;#x6709;nrbanks&amp;#x5185;&amp;#x5B58;&amp;#x7684;min~maxlow&amp;#xFF0C;&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x5F20;bitmap&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E00;&amp;#x4F4D;&amp;#x4EE3;&amp;#x8868;&amp;#x4E00;&amp;#x4E2A;page&amp;#x662F;&amp;#x5426;&amp;#x5206;&amp;#x914D;&amp;#x3002;&amp;#x4ED6;&amp;#x548C;memblock&amp;#x4E24;&amp;#x5957;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;bootmem&amp;#x7684;bitmap&amp;#x88AB;memblock&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;memblock&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;memblock&amp;#x7684;&amp;#x4E24;&amp;#x5F20;&amp;#x8868;&amp;#x683C;memblock_memory_init_regions&amp;#x548C;memblock_reserved_init_regions&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5B58;&amp;#x5728;.init.data section&amp;#x4E2D;&amp;#xFF0C;&amp;#x5373;&amp;#x5728;kernel image&amp;#x91CC;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2)arm_bootmem_free&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960780&#34; hash=&#34;955e31194526ddb9bc3e379df1887a51&#34; align alt longdesc width=&#34;814&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x5176;&amp;#x4E2D;&amp;#x672C;node&amp;#x5185;&amp;#x5B58;&amp;#x6307;&amp;#x6807;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960784&#34; hash=&#34;cc4b0f88b4f266a8c7c70bd14c7867ad&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;alloc_node_mem_map&amp;#x5728;&amp;#x540E;&amp;#x9762;&amp;#x7684;&amp;#x7AE0;&amp;#x8282;&amp;#x8BA8;&amp;#x8BBA;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x8FD8;&amp;#x6709;&amp;#x4E00;&amp;#x70B9;&amp;#x9700;&amp;#x8981;&amp;#x8865;&amp;#x5145;&amp;#x4E00;&amp;#x4E0B;&amp;#xFF0C;pgdat&amp;#x4E00;&amp;#x822C;&amp;#x6307;&amp;#x5411;NODE_DATA(i)&amp;#xFF0C;&amp;#x5373;node_data[i]&amp;#x6210;&amp;#x5458;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x53EA;&amp;#x8003;&amp;#x8651;node 0&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;pgdat&amp;#x53EF;&amp;#x4EE5;&amp;#x7B80;&amp;#x5355;&amp;#x7684;&amp;#x770B;&amp;#x6210;&amp;#x662F;&amp;#x6307;&amp;#x5411;node 0&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x5728;init_bootmem_node&amp;#x4E2D;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5BF9;&amp;#x8BE5;node&amp;#x7684;bootmem&amp;#x90E8;&amp;#x5206;&amp;#x52A0;&amp;#x4EE5;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&amp;#x5176;&amp;#x4ED6;&amp;#x90E8;&amp;#x5206;&amp;#x5728;&amp;#x5176;&amp;#x4ED6;&amp;#x90E8;&amp;#x5206;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3)&lt;span style=&#34;font-size: 10pt; text-indent: 0mm;&#34;&gt;&lt;span style=&#34;font-size: 10pt; font-family: Arial;&#34;&gt;free_area_init_core&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960775&#34; hash=&#34;48dde7c38e2eabd99a09151cd51ce4ba&#34; align alt longdesc width=&#34;816&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a) &amp;#x6BCF;&amp;#x4E2A;zone&amp;#x7684;page&amp;#x6309;&amp;#x7167;page block&amp;#x7EC4;&amp;#x7EC7;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;page block&amp;#x5305;&amp;#x542B;MAX_ORDER-1 = 10&amp;#xFF0C;&amp;#x5373;1024&amp;#x9875;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b) &amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x51E0;&amp;#x4E2A;&amp;#x6307;&amp;#x6807;&amp;#x5907;&amp;#x6CE8;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;size: &amp;#x7B2C;j&amp;#x4E2A;zone&amp;#x7684;total_size&amp;#xFF0C;&amp;#x5355;&amp;#x4F4D;page&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;memmap_pages: &amp;#x672C;zone&amp;#x7684;memmap&amp;#x6570;&amp;#x7EC4;&amp;#x9700;&amp;#x8981;&amp;#x7684;page&amp;#x6570;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;realsize: totalsize - zhole_size[j] -&amp;#xA0;memmap_pages -&amp;#xA0;dma_reserve(&amp;#x5982;&amp;#x679C;&amp;#x662F;zone[0])&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nr_kernel_pages += realsize; &lt;span style=&#34;color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5982;&amp;#x679C;&amp;#x662F;HIGHMEM zone&amp;#xFF0C;&amp;#x66F4;&amp;#x65B0;nr_kernel_pages&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nr_all_pages += realsize;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;c)&amp;#xA0;init_currently_empty_zone,&amp;#xA0;memmap_init&amp;#x5728;&amp;#x540E;&amp;#x9762;&amp;#x7AE0;&amp;#x8282;&amp;#x8BA8;&amp;#x8BBA;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4)&amp;#xA0;memmap_init&lt;/div&gt;&lt;div&gt;memmap&amp;#x6570;&amp;#x7EC4;&amp;#x5728;arm_bootmem_free-&amp;gt;&lt;span style=&#34;font-size: 13px; font-family: Arial;&#34;&gt;free_area_init_node&amp;#x4E2D;&amp;#x901A;&amp;#x8FC7;alloc_node_mem_map-&amp;gt; alloc_bootmem_node&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x6BB5;bootmem&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x5E76;&amp;#x8D4B;&amp;#x7ED9;pgdat-&amp;gt;node_mem_map&amp;#x3002;memmap_init&amp;#x51FD;&amp;#x6570;&amp;#x8D1F;&amp;#x8D23;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FD9;&amp;#x5757;&amp;#x533A;&amp;#x57DF;&amp;#xFF08;&amp;#x6570;&amp;#x7EC4;&amp;#xFF09;&amp;#x4E2D;&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960789&#34; hash=&#34;e61973da74d343ba813529c9abd473ca&#34; align alt longdesc width=&#34;596&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a)&amp;#x5173;&amp;#x4E8E;SetPageReserved&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E0D;&amp;#x77E5;&amp;#x4F55;&amp;#x7528;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;background-color: rgb(255, 255, 255); font-size: 14px; color: rgb(69, 69, 69); font-family: Tahoma, Helvetica, Arial, STHeiti; line-height: 21px;&#34;&gt;&amp;#x5185;&amp;#x6838;&amp;#x4E2D;&amp;#x7533;&amp;#x8BF7;&amp;#x5230;&amp;#x9875;&amp;#x9762;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x8981;&amp;#x8C03;&amp;#x7528;&amp;#x4E00;&amp;#x4E0B;SetPageReserved&amp;#xFF0C;&amp;#x76F8;&amp;#x5F53;&amp;#x4E8E;&amp;#x544A;&amp;#x8BC9;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x6211;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5360;&amp;#x4E86;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;&amp;#x7533;&amp;#x8BF7;&amp;#x5230;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x5E94;&amp;#x8BE5;&amp;#x90FD;&amp;#x8981;&amp;#x8FD9;&amp;#x6837;&amp;#x505A;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b)&amp;#x4E3A;&amp;#x6BCF;&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x8BBE;&amp;#x7F6E;miagrate type&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x9632;&amp;#x6B62;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x7565;&amp;#x6709;&amp;#x4E9B;&amp;#x590D;&amp;#x6742;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;c)lru list&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x56DE;&amp;#x6536;&amp;#x673A;&amp;#x5236;&amp;#x8BBE;&amp;#x8BA1;&amp;#x7684;&amp;#xFF0C;&amp;#x5168;&amp;#x79F0;&amp;#x662F;Least Recently Used&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;d)&amp;#x5173;&amp;#x4E8E;struct page&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;Mel Gorman&amp;#x7684;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;&amp;#x7684;P41&amp;#xFF1A;Pages&amp;#x4E00;&amp;#x8282;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;5)&amp;#xA0;alloc_bootmem_node&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;alloc_bootmem_node -&amp;gt;&amp;#xA0;__alloc_bootmem_node -&amp;gt;&amp;#xA0;___alloc_bootmem_node -&amp;gt;&amp;#xA0;alloc_arch_preferred_bootmem / alloc_bootmem_core / ___alloc_bootmem&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6700;&amp;#x540E;&amp;#x843D;&amp;#x5B9E;&amp;#x5230;&amp;#x4E09;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;alloc_arch_preferred_bootmem / alloc_bootmem_core / ___alloc_bootmem&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;alloc_arch_preferred_bootmem&amp;#xA0;&amp;#x548C;___alloc_bootmem&amp;#x5728;&amp;#x672A;&amp;#x5B9A;&amp;#x4E49;CONFIG_NO_BOOTMEM&amp;#x65F6;&amp;#xFF0C;&amp;#x6700;&amp;#x7EC8;&amp;#x8C03;&amp;#x7528;&amp;#x7684;&amp;#x90FD;&amp;#x662F;alloc_bootmem_core&amp;#xA0;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;alloc_bootmem_core&amp;#xA0;&amp;#x662F;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x90A3;&amp;#x4E48;&amp;#x6765;&amp;#x770B;alloc_bootmem_core&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960786&#34; hash=&#34;ccb96de4575061c281c7fcd12baae0ff&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x5176;&amp;#x4E2D;&amp;#x6709;&amp;#x5F88;&amp;#x591A;&amp;#x4E2A;&amp;#x6307;&amp;#x6807;&amp;#xFF0C;&amp;#x5927;&amp;#x4F53;&amp;#x603B;&amp;#x7ED3;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;sidx / midx&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&amp;#xA0;start - bdata-&amp;gt;node_min_pfn /&amp;#xA0;max - bdata-&amp;gt;node_min_pfn&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x4E5F;&amp;#x4F1A;&amp;#x6709;&amp;#x4E00;&amp;#x4E9B;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4F46;&amp;#x5927;&amp;#x4F53;&amp;#x4E0A;&amp;#x53EF;&amp;#x4EE5;&amp;#x8BA4;&amp;#x4E3A;&amp;#x662F;&amp;#x672C;node&amp;#x4F4E;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x9996;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x9875;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;eidx&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;: sidx + PFN_UP(size)&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x9700;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F4;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x6309;&amp;#x9875;&amp;#x5411;&amp;#x4E0B;&amp;#xFF08;&amp;#x589E;&amp;#x957F;&amp;#x65B9;&amp;#x5411;&amp;#xFF09;&amp;#x5BF9;&amp;#x9F50;&amp;#x540E;&amp;#x7684;&amp;#x9875;&amp;#x7D22;&amp;#x5F15;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;start_off / end_off&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F4;&amp;#x59CB;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;merge&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&amp;#xA0;PFN_DOWN(start_off) &amp;lt; sidx&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x6B64;&amp;#x65F6;start_off&amp;#x662F;&amp;#x7ECF;&amp;#x8FC7;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x524D;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#xFF08;last_end_off&amp;#xFF09;&amp;#x6240;&amp;#x5728;&amp;#x9875;&amp;#x8FD8;&amp;#x6709;&amp;#x7A7A;&amp;#x95F2;&amp;#xFF0C;&amp;#x5219;&amp;#x5C06;start_off&amp;#x5411;&amp;#x4E0A;&amp;#x63D0;&amp;#x5347;&amp;#x5230;&amp;#x8BE5;&amp;#x9875;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0E;last_end_off&amp;#x9694;&amp;#x5F00;&amp;#x4E00;&amp;#x5B9A;&amp;#x7684;&amp;#x8DDD;&amp;#x79BB;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;bdata-&amp;gt;last_end_off&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E0A;&amp;#x4E00;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x6309;&amp;#x9875;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&amp;#x6B64;&amp;#x53D8;&amp;#x91CF;&amp;#x53EA;&amp;#x5728;alloc_bootmem_core&amp;#x4E2D;&amp;#x66F4;&amp;#x65B0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;bdata-&amp;gt;hint_idx&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#x5728;alloc_bootmem_core&amp;#x4E2D;= PFN_UP(end_off)&amp;#xFF0C;&amp;#x5728;__free&amp;#x7684;&amp;#x65F6;&amp;#x5019;= sidx&amp;#xFF0C;&amp;#x8BB0;&amp;#x5F55;&amp;#x7684;&amp;#x662F;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x503C;&amp;#x7684;&amp;#x9875;&amp;#x7D22;&amp;#x5F15;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E86;&amp;#x89E3;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6307;&amp;#x6807;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5BF9;code&amp;#x5C31;&amp;#x6BD4;&amp;#x8F83;&amp;#x5BB9;&amp;#x6613;&amp;#x7406;&amp;#x89E3;&amp;#x4E86;&amp;#x3002;&amp;#x6458;&amp;#x5F55;&amp;#x5982;&amp;#x4E0B;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;static void * __init alloc_bootmem_core (&amp;#x2026;&amp;#x2026;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_block:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;sidx = find_next_zero_bit(bdata-&amp;gt;node_bootmem_map, midx, sidx);&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;//&amp;#xA0;find_next_zero_bit&amp;#x53C2;&amp;#x8003;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&lt;/span&gt;&lt;a href=&#34;evernote:///view/161681/s10/3437e87a-af8c-418e-8219-747687b4f1af/3437e87a-af8c-418e-8219-747687b4f1af/&#34; style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, sidx, step);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; eidx = sidx + PFN_UP(size);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (sidx &amp;gt;= midx || eidx &amp;gt; midx)&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// sidx &amp;gt; midx&amp;#x548C;eidx &amp;gt; midx&amp;#x6BD4;&amp;#x8F83;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; break; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;sidx = midx&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x6307;&amp;#x7684;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&amp;#x8FD4;&amp;#x56DE;&amp;#x7684;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;midx&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&lt;/span&gt;&lt;a href=&#34;evernote:///view/161681/s10/3437e87a-af8c-418e-8219-747687b4f1af/3437e87a-af8c-418e-8219-747687b4f1af/&#34; style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&lt;/a&gt;&lt;span style=&#34;color: rgb(65, 173, 28);&#34;&gt;&amp;#x8FD9;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x53EF;&amp;#x77E5;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x662F;&lt;/span&gt;&lt;a href=&#34;evernote:///view/161681/s10/3437e87a-af8c-418e-8219-747687b4f1af/3437e87a-af8c-418e-8219-747687b4f1af/&#34; style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&lt;/a&gt;&lt;span style=&#34;color: rgb(65, 173, 28);&#34;&gt;&amp;#x5931;&amp;#x8D25;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x672A;&amp;#x5206;&amp;#x914D;&amp;#x9875;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;for (i = sidx; i &amp;lt; eidx; i++)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_off = PFN_PHYS(sidx);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;merge = PFN_DOWN(start_off) &amp;lt; sidx;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8868;&amp;#x793A;&amp;#x672C;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x4E0E;&amp;#x4E0A;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#xFF0C;&amp;#x53C2;&amp;#x770B;&amp;#x56FE;1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Reserve the area now:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (__reserve(bdata, PFN_DOWN(start_off) + merge,&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// merge =0: &amp;#x6CA1;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#xFF0C;&amp;#x6B63;&amp;#x5E38;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;merge =1&amp;#xFF1A;&amp;#x548C;&amp;#x4E0A;&amp;#x6B21;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#xFF0C;&amp;#x4F46;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#x7684;&amp;#x9875;&amp;#x5DF2;&amp;#x7ECF;reserve&amp;#x8FC7;&amp;#x4E86;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4ECE;&amp;#x4E0B;&amp;#x4E00;&amp;#x9875;&amp;#x5F00;&amp;#x59CB;reserve&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; PFN_UP(end_off), BOOTMEM_EXCLUSIVE))&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960782&#34; hash=&#34;b9a9d387c218f326cac764cc823bb17c&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;alloc_bootmem_core&amp;#x4E2D;&amp;#x8FD8;&amp;#x6709;&amp;#x4E2A;fall_back&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;static void * __init alloc_bootmem_core (&amp;#x2026;&amp;#x2026;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;if (bdata-&amp;gt;hint_idx &amp;gt; sidx) { &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;hint_idx&amp;#x662F;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x503C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x8868;&amp;#x793A;&amp;#x641C;&amp;#x7D22;&amp;#x8D77;&amp;#x59CB;&amp;#x70B9;&amp;#x53EF;&amp;#x4EE5;&amp;#x5411;&amp;#x524D;&amp;#x63D0;&amp;#x5347;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Handle the valid case of sidx being zero and still&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * catch the fallback below.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; fallback = sidx + 1;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8BB0;&amp;#x5F55;fall_back&amp;#x503C;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, bdata-&amp;gt;hint_idx, step);&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5C06;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;sidx&amp;#x63D0;&amp;#x5347;&amp;#x5230;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;hint_idx&amp;#x9644;&amp;#x8FD1;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;while(1) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_block:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;if (fallback) {&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5982;&amp;#x679C;&amp;#x641C;&amp;#x7D22;&amp;#x5931;&amp;#x8D25;&amp;#xFF0C;&amp;#x5219;&amp;#x5C06;sidx&amp;#x8FD8;&amp;#x539F;&amp;#x518D;&amp;#x91CD;&amp;#x65B0;&amp;#x641C;&amp;#x7D22;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, fallback - 1, step);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; fallback = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto find_block;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;return NULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;6) init_currently_empty_zone&lt;/div&gt;&lt;div&gt;&amp;#x672C;&amp;#x51FD;&amp;#x6570;&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x521D;&amp;#x59CB;&amp;#x5316;zone&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x66F4;&amp;#x660E;&amp;#x786E;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&amp;#xFF08;1&amp;#xFF09;wait queue table&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#xFF08;2&amp;#xFF09;free_area&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&amp;#x8C03;&amp;#x7528;&amp;#x987A;&amp;#x5E8F;&amp;#x5982;&amp;#x4E0B;&lt;/div&gt;&lt;div&gt;zone_wait_table_init -&amp;gt;&amp;#xA0;zone_init_free_lists(zone)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a)&amp;#xA0;zone_wait_table_init&amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6B64;&amp;#x51FD;&amp;#x6570;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E86;zone-&amp;gt;wait_table&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x5F20;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#xFF0C;&amp;#x6709;zone-&amp;gt;wait_table_hash_nr_entries&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#xFF08;&amp;#x6700;&amp;#x5C11;4&amp;#xFF0C;&amp;#x6700;&amp;#x591A;4096&amp;#xFF09;&amp;#x3002;wait_table&amp;#x76F8;&amp;#x5173;&amp;#x5185;&amp;#x5BB9;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;Mel Gorman&amp;#x7684;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;P40&amp;#xFF1A;Zone Wait Queue Table&amp;#x4E00;&amp;#x8282;&amp;#x3002;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x7684;wait-wake&amp;#x673A;&amp;#x5236;&amp;#x8BF7;&amp;#x53C2;&amp;#x8003;&amp;#x7B14;&amp;#x8BB0;&lt;a href=&#34;evernote:///view/161681/s10/00adfa18-d628-4d70-a080-7c1590a5e613/00adfa18-d628-4d70-a080-7c1590a5e613/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x7684;wait-wake&amp;#x673A;&amp;#x5236;&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x672C;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E3A;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;wait_table_hash_nr_entries(zone_size_pages) -&amp;gt;&amp;#xA0;wait_table_bits(zone-&amp;gt;wait_table_hash_nr_entries) -&amp;gt;&amp;#xA0;alloc_bootmem_node(pgdat, alloc_size) -&amp;gt; &amp;#x904D;&amp;#x5386;&amp;#x6240;&amp;#x6709;&amp;#x54C8;&amp;#x5E0C;&amp;#x9879;&amp;#xFF0C;&amp;#x5E76;&amp;#x521D;&amp;#x59CB;&amp;#x5316;init_waitqueue_head(zone-&amp;gt;wait_table + i)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b&amp;#xFF09;zone_init_free_lists&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x7275;&amp;#x6D89;&amp;#x5230;migrate type&amp;#xFF0C;&amp;#x5C1A;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4F1A;&amp;#x7528;&amp;#x65B0;&amp;#x7BC7;&amp;#x6765;&amp;#x4F5C;&amp;#x4ECB;&amp;#x7ECD;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/10/08/memblock%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</guid>
            <title>memblock工作原理</title>
            <link>https://blog.zhougy.top/2012/10/08/memblock%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Mon, 08 Oct 2012 18:35:54 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style title lang xml:lang dir&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;memblock&amp;#x662F;Linux&amp;#x542F;&amp;#x52A8;&amp;#x9636;&amp;#x6BB5;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x662F;&amp;#x5BF9;bootmem&amp;#x7684;&amp;#x8865;&amp;#x5145;&amp;#xFF0C;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x5E94;&amp;#x5BF9;bootmem&amp;#x6613;&amp;#x4EA7;&amp;#x751F;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x800C;&amp;#x4EA7;&amp;#x751F;&amp;#x3002;&amp;#x4ED6;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x51FD;&amp;#x6570;arm_memblock_init&amp;#x548C;bootmem&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x6240;&amp;#x5728;&amp;#x7684;&amp;#x51FD;&amp;#x6570;paging_init&amp;#x7D27;&amp;#x6328;&amp;#x7740;&amp;#xFF0C;&amp;#x90FD;&amp;#x5728;setup_arch&amp;#x4E2D;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;margin: 0px 0px 0px 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;struct memblock {&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; phys_addr_t current_limit;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; phys_addr_t memory_size;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/* Updated by memblock_analyze() */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct memblock_type memory;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct memblock_type reserved;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;current_limit&amp;#xFF1A;&amp;#x8868;&amp;#x793A;memblock&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#x503C;&amp;#xFF0C;&amp;#x5176;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E3A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;paging_init -&amp;gt; sanity_check_meminfo -&amp;gt; memblock_set current_limit(limit)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5176;&amp;#x4E2D;limit = __pa(vmalloc_min-1) + 1 = VMALLOC_END - 128M = 4G - 128M(high mem)&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;memory_size&amp;#xFF1A;&amp;#x8BB0;&amp;#x5F55;&amp;#x603B;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x6570;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;memory_analyze&amp;#x4E2D;&amp;#x66F4;&amp;#x65B0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;memory,reserved&amp;#xFF1A;&amp;#x662F;&amp;#x4E24;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x524D;&amp;#x8005;&amp;#x662F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6240;&amp;#x62E5;&amp;#x6709;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#xFF0C;&amp;#x540E;&amp;#x8005;&amp;#x53EF;&amp;#x4EE5;&amp;#x7406;&amp;#x89E3;&amp;#x4E3A;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;1. &amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/memblock&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084959865&#34; hash=&#34;7ab6740575d50f5739c1e48b2d63b4cb&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;mdesc-&amp;gt;reserve&amp;#x662F;&amp;#x5728;arch/arm/mach-omap2/board-d7800.c&amp;#x4E2D;&amp;#x5206;&amp;#x914D;&amp;#x7ED9;machine_desc&amp;#x53D8;&amp;#x91CF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;meminfo&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&lt;a href=&#34;evernote:///view/161681/s10/638c401b-6ae0-4f04-85a6-a35529f7768b/638c401b-6ae0-4f04-85a6-a35529f7768b/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;meminfo&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x914D;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/memblock&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084959870&#34; hash=&#34;89a57c932790964dce9ee3e7e6f8d052&#34; align alt longdesc width=&#34;1142&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;MEMBLOCK_ALLOC_ACCESSIBLE&amp;#x7684;&amp;#x503C;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x5219;&amp;#x540E;&amp;#x9762;&amp;#x7684;max_addr&amp;#x4E5F;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x4F46;&amp;#x5E76;&amp;#x4E0D;&amp;#x610F;&amp;#x5473;&amp;#x7740;&amp;#x641C;&amp;#x7D22;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#x4E5F;&amp;#x4E3A;0&amp;#x3002;&amp;#x5728;memblock_find_base&amp;#x4E2D;end&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x641C;&amp;#x7D22;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#xFF08;&amp;#x5176;&amp;#x5B9E;&amp;#x662F;&amp;#x641C;&amp;#x7D22;&amp;#x7684;&amp;#x8D77;&amp;#x59CB;&amp;#x503C;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x641C;&amp;#x7D22;&amp;#x65F6;&amp;#x4ECE;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x503C;&amp;#x5F00;&amp;#x59CB;&amp;#x7684;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E48;&amp;#x505A;&amp;#x662F;&amp;#x6709;&amp;#x7528;&amp;#x610F;&amp;#x7684;&amp;#xFF0C;&amp;#x8BE6;&amp;#x89C1;&amp;#x7B2C;2&amp;#x70B9;&amp;#xFF09;&amp;#x8D4B;&amp;#x4E3A;memblock.current_limit&amp;#xFF0C;&amp;#x5B83;&amp;#x7684;&amp;#x503C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x672C;&amp;#x6587;&amp;#x524D;&amp;#x9762;&amp;#x7684;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;&amp;#x4ECE;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x9AD8;&amp;#x5730;&amp;#x5740;&amp;#x5F00;&amp;#x59CB;&amp;#x641C;&amp;#x7D22;&amp;#xFF0C;mm/memblock.c&amp;#x4E2D;&amp;#x7684;&amp;#x6709;&amp;#x6CE8;&amp;#x91CA;&amp;#x9053;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/* We do a top-down search, this tends to limit memory&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;margin: 0px 0px 0px 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * fragmentation by keeping early boot allocs near the&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * top of memory&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;margin-left: 40px;&#34;&gt;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x89E3;&amp;#x51B3;&amp;#x788E;&amp;#x7247;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x4F46;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x80FD;&amp;#x89E3;&amp;#x51B3;&amp;#xFF0C;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3&amp;#xFF09;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x8DDF;&amp;#x5185;&amp;#x5B58;&amp;#x533A;&amp;#x7684;&amp;#x59CB;&amp;#x672B;&amp;#x4F4D;&amp;#x7F6E;&amp;#x6709;&amp;#x5173;&amp;#x7684;&amp;#x503C;&amp;#x90FD;&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&amp;#x7528;&amp;#x5230;&amp;#x5982;&amp;#x4E0B;&amp;#x7684;&amp;#x8BED;&amp;#x53E5;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0;size = memblock_align_up(size, align)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;base = memblock_align_down((end - size), align)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E9B;&amp;#x4E5F;&amp;#x90FD;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x89E3;&amp;#x51B3;&amp;#x788E;&amp;#x7247;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;mm/memblock.c &amp;#x4E2D;&amp;#x6709;&amp;#x6CE8;&amp;#x91CA;&amp;#xFF0C;&amp;#x9053;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/* We align the size to limit fragmentation. Without this, a lot of&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;margin: 0px 0px 0px 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * small allocs quickly eat up the whole reserve array on sparc&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;4&amp;#xFF09;memblock_addrs_overlap&amp;#x4E2D;&amp;#x5224;&amp;#x65AD;&amp;#x4EA4;&amp;#x53E0;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#x5F88;&amp;#x503C;&amp;#x5F97;&amp;#x5B66;&amp;#x4E60;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/09/29/meminfo%E5%88%9D%E5%A7%8B%E5%8C%96/</guid>
            <title>meminfo初始化</title>
            <link>https://blog.zhougy.top/2012/09/29/meminfo%E5%88%9D%E5%A7%8B%E5%8C%96/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <category>uboot</category>
            <pubDate>Sat, 29 Sep 2012 10:46:46 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;1. u-boot&amp;#x4E2D;&amp;#x8BBE;&amp;#x7F6E;&amp;#x542F;&amp;#x52A8;&amp;#x53C2;&amp;#x6570;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x542F;&amp;#x52A8;&amp;#x547D;&amp;#x4EE4;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;u-boot-env.txt&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;bootcmd&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if ${recovery}; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run nandrecovery;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if mmc init; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if run loadbootscript; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run bootscript;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if run loaduImage; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run mmcboot;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run nandboot;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;fi;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;fi;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;b&gt;&lt;font color=&#34;#FF0000&#34;&gt;run nandboot;&lt;/font&gt;&lt;/b&gt;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; fi;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;fi&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;nandboot&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;echo Booting from nand ...;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#FF0000&#34;&gt;run nandargs;&lt;/font&gt;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nand read ${loadaddr} boot;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;booti 0x82000008&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;nandargs&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;setenv bootargs console=${console} init=${init} &lt;font color=&#34;#FF0000&#34;&gt;mem=${mem}&lt;/font&gt; ip=${ip} mpurate=${mpurate} omap_vout.vid1_static_vrfb_alloc=y vram=${vram} omapfb.vram=0:8M androidboot.console=${tty} root=${root_nand} rootfstype=${rootfstype_nand} ubi.mtd=${ubi_mtd}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x5C5E;&amp;#x4E8E;commandline&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;setup_commandline_tag&amp;#x4E2D;&amp;#x63D2;&amp;#x5165;params&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x5E76;&amp;#x6807;&amp;#x4E0A;ATAG_CMDLINE&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;parse_args&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x7528;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;&amp;#x73AF;&amp;#x5883;&amp;#x53D8;&amp;#x91CF;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;include/configs/d7800.h&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;#define CONFIG_EXTRA_ENV_SETTINGS \&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;quot;init=/init\0&amp;quot; \&lt;br&gt;&amp;#xA0; &amp;#xA0; &lt;font color=&#34;#FF0000&#34;&gt;&amp;quot;mem=256M\0&amp;quot;&lt;/font&gt; \&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;quot;mpurate=800\0&amp;quot; \&lt;br&gt;&amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;2.&lt;font face=&#34;Courier New&#34;&gt;kernel&amp;#x4E2D;&amp;#x7528;parse_args&amp;#x89E3;&amp;#x6790;&amp;#x6B64;bootarg&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x53E6;&amp;#x4E00;&amp;#x4EFD;&amp;#x7B14;&amp;#x8BB0;&lt;/font&gt;&lt;a href=&#34;evernote:///view/161681/s10/39d4ca69-e5d9-4582-9635-d9963aa05e29/39d4ca69-e5d9-4582-9635-d9963aa05e29/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;Linux&amp;#x542F;&amp;#x52A8;&amp;#x53C2;&amp;#x6570;&amp;#x201C;init=xxx&amp;#x201D;&amp;#x5206;&amp;#x6790;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;parse_args -&amp;gt;&amp;#xA0;parse_one -&amp;gt;&amp;#xA0;unknown_bootoption -&amp;gt;&amp;#xA0;obsolete_checksetup -&amp;gt;&amp;#xA0;obs_kernel_param.setup_func =&amp;#xA0;early_mem&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;3.kernel&amp;#x4E2D;&amp;#x8BBE;&amp;#x7F6E;&amp;#x5BF9;&amp;#x5E94;bootarg&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;early_param(&amp;quot;mem&amp;quot;, early_mem); -&amp;gt;&amp;#xA0;__setup_param(str, fn, fn, 1) -&amp;gt;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;#define __setup_param(str, unique_id, fn, early)&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; \&lt;/font&gt;&lt;/div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;static const char __setup_str_##unique_id[] __initconst \&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __aligned(1) = str; \&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;static struct obs_kernel_param __setup_##unique_id&amp;#xA0; \&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __used __section(&lt;font color=&#34;#FF0000&#34;&gt;.init.setup&lt;/font&gt;)&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; \&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __attribute__((aligned((sizeof(long)))))&amp;#xA0;&amp;#xA0;&amp;#xA0; \&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; = { __setup_str_##unique_id, fn, early } &amp;#xA0;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;4.&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;early_mem&amp;#x51FD;&amp;#x6570;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;static int __init early_mem(char *p)&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; static int usermem __initdata = 0;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long size, start;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; char *endp;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; &lt;font color=&#34;#41AD1C&#34;&gt;/*&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * If the user specifies memory size, we&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * blow away any automatically generated&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * size.&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (usermem == 0) {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usermem = 1;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; meminfo.nr_banks = 0;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;/*&lt;/span&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt; &lt;font color=&#34;#41AD1C&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;*&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;defined in&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;arch/arm/plat-omap/include/plat/memory.h&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *&amp;#xA0;&lt;/span&gt;PHYS_OFFSET &amp;#xA0;= UL(0x80000000)&lt;/font&gt;&lt;br style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; start = PHYS_OFFSET;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; size&amp;#xA0; = memparse(p, &amp;amp;endp);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (*endp == &amp;apos;@&amp;apos;)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start = memparse(endp + 1, NULL);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; arm_add_memory(start, size);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; return 0;&lt;br&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6700;&amp;#x540E;&amp;#x9057;&amp;#x7559;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x5047;&amp;#x5982;&amp;#x6709;&amp;#x51E0;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x9700;&amp;#x8981;&amp;#x5904;&amp;#x7406;&amp;#x600E;&amp;#x4E48;&amp;#x529E;&amp;#xFF1F;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6CA1;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;Linux&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;&amp;#x5C31;&amp;#x662F;&lt;/font&gt;__tagtable(ATAG_MEM, parse_tag_mem32);&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x4EE3;&amp;#x8868;&amp;#x4E86;&amp;#x4E00;&amp;#x7EC4;ATAG_MEM param&amp;#xFF0C;&amp;#x7528;parse_tag_mem32&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x8FD9;&amp;#x4E00;&amp;#x7EC4;param&amp;#x540C;&amp;#x6837;&amp;#x4E5F;&amp;#x662F;&amp;#x5728;u-boot&amp;#x9636;&amp;#x6BB5;&amp;#x5C31;&amp;#x52A0;&amp;#x5165;&amp;#x4E86;&amp;#x3002;&amp;#x5373;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;do_bootm_linux -&amp;gt;&amp;#xA0;setup_memory_tags (u-boot)&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;static void setup_memory_tags (bd_t *bd)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; int i;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (i = 0; i &amp;lt; CONFIG_NR_DRAM_BANKS; i++) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;hdr.tag = ATAG_MEM;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;hdr.size = tag_size (tag_mem32);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;u.mem.start = bd-&amp;gt;bi_dram[i].start;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;u.mem.size = bd-&amp;gt;bi_dram[i].size;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params = tag_next (params);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EA;&amp;#x4E0D;&amp;#x8FC7;&amp;#x5728;D7800&amp;#x4E2D;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;CONFIG_NR_DRAM_BANKS=1&amp;#xFF08;configs/d7800.h&amp;#xFF09;&amp;#x3002;&lt;/span&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;meminfo&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x5168;&amp;#x90E8;&amp;#x662F;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x3002;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/08/27/vmalloc%E5%88%86%E6%9E%90/</guid>
            <title>vmalloc分析</title>
            <link>https://blog.zhougy.top/2012/08/27/vmalloc%E5%88%86%E6%9E%90/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Mon, 27 Aug 2012 11:11:07 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;div style=&#34;font-size: 19px;&#34;&gt;&lt;b&gt;&lt;font color=&#34;#FF0000&#34;&gt;vmalloc&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&#34;font-size: 19px;&#34;&gt;&lt;b&gt;&lt;font color=&#34;#FF0000&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&#34;text-align: center;font-size: 19px;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/vmalloc&amp;#x5206;&amp;#x6790;/1537085035259&#34; hash=&#34;2cd4dae44d544b480f792d9950ec22db&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/vmalloc&amp;#x5206;&amp;#x6790;/1537085035251&#34; hash=&#34;2810b6dc987813d10c985f2fd6462c76&#34; align alt longdesc width=&#34;766&#34; height=&#34;312&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/07/15/Linux%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</guid>
            <title>Linux物理内存管理</title>
            <link>https://blog.zhougy.top/2012/07/15/Linux%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sun, 15 Jul 2012 22:24:53 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;div&gt;1. &amp;#x6BCF;&amp;#x4E00;&amp;#x5757;&amp;#x5B9E;&amp;#x9645;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E00;&amp;#x4E2A;node&amp;#xFF08;struct pglistdata&amp;#xFF0C;pg_data_t&amp;#xFF09;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7531;&amp;#x4E00;&amp;#x4E2A;&amp;#x94FE;&amp;#x8868;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;node&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x88AB;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x6700;&amp;#x591A;&amp;#x4E09;&amp;#x4E2A;zone&amp;#xFF08;normal&amp;#xFF0C;dma&amp;#xFF0C;highmem&amp;#xFF09;&amp;#xFF08;struct zone_struct, zone_t&amp;#xFF09;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#x4EE5;x86&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;ZONEDMA First 16MiB of memory&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;ZONENORMAL 16MiB - 896MiB&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;ZONEHIGHMEM 896 MiB - End&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;all the structs are kept in a global&amp;#xA0;mem_map array, which is usually stored at the beginning of ZONE_NORMAL or just after&amp;#xA0;the area reserved for the loaded kernel image in low memory machines.&lt;/div&gt;&lt;div&gt;2.&amp;#xA0;Zone Watermarks&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;1)watermark&amp;#x6307;zone&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x4E09;&amp;#x4E2A;&amp;#x8F6C;&amp;#x6298;&amp;#x70B9;&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x4E09;&amp;#x4E2A;&amp;#x4E34;&amp;#x754C;&amp;#x503C;&amp;#x65F6;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x91C7;&amp;#x7528;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5206;&amp;#x914D;&amp;#x7B56;&amp;#x7565;&amp;#x6765;&amp;#x6EE1;&amp;#x8DB3;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8981;&amp;#x6C42;&amp;#x4E0E;&amp;#x6027;&amp;#x80FD;&amp;#x6700;&amp;#x5927;&amp;#x5316;&amp;#x7684;&amp;#x5E73;&amp;#x8861;&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;2)&amp;#x6709;3&amp;#x4E2A;watermark&amp;#xFF1A;pages_min, pages_low and pages_high (1:2:3)&amp;#xA0;&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/Linux&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;/1537085036029&#34; hash=&#34;f985c4fcfb557ced23a8ce3c4fa004ae&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;p&gt;&amp;#xA0;&lt;/p&gt;&lt;p&gt;&amp;#xA0;&lt;/p&gt;&lt;p&gt;&amp;#xA0;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/07/08/Linux%E5%86%85%E6%A0%B8%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</guid>
            <title>Linux内核内存管理</title>
            <link>https://blog.zhougy.top/2012/07/08/Linux%E5%86%85%E6%A0%B8%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sun, 08 Jul 2012 19:50:56 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;div&gt;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#xFF1A;&amp;#x5F00;&amp;#x59CB;&amp;#x4E8E;0xC000_0000&amp;#xFF08;3G&amp;#xFF0C;&amp;#x5728;&amp;#x7F16;&amp;#x8BD1;&amp;#x65F6;&amp;#x6307;&amp;#x5B9A;&amp;#xFF0C;&amp;#x5373;PAGE_OFFSET=3G&amp;#xFF09;&amp;#x5904;&amp;#xFF0C;&amp;#x662F;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x7EBF;&amp;#x6027;&amp;#x6620;&amp;#x5C04;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5982;&amp;#x6B64;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;32&amp;#x4F4D;CPU&amp;#x7684;&amp;#x53EF;&amp;#x63A7;&amp;#x5185;&amp;#x5B58;&amp;#x6700;&amp;#x5927;&amp;#x503C;&amp;#x5373;&amp;#x4E3A;1GB&amp;#x3002;&amp;#x7531;&amp;#x4E8E;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x4F4E;&amp;#x5730;&amp;#x5740;&amp;#x548C;&amp;#x9AD8;&amp;#x5730;&amp;#x5740;&amp;#x4F1A;&amp;#x7559;&amp;#x4F5C;&amp;#x4ED6;&amp;#x7528;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4E00;&amp;#x822C;&amp;#x53EF;&amp;#x7528;&amp;#x5185;&amp;#x5B58;&amp;#x5927;&amp;#x5C0F;&amp;#x53EA;&amp;#x6709;&amp;#x5927;&amp;#x7EA6;950MB&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x8D85;&amp;#x8FC7;950MB&amp;#xFF0C;&amp;#x5219;&amp;#x5728;&amp;#x7F16;&amp;#x8BD1;&amp;#x65F6;&amp;#x8981;&amp;#x6307;&amp;#x5B9A;CONFIG_HIGHMEM4G&amp;#x548C;CONFIG_HIGHMEM64G&amp;#x3002;&amp;#x7531;&amp;#x4E8E;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x672C;&amp;#x8EAB;&amp;#x4E5F;&amp;#x662F;&amp;#x6709;&amp;#x9875;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5E76;&amp;#x4E0D;&amp;#x51B2;&amp;#x7A81;&amp;#x3002;&amp;#x5176;&amp;#x7EBF;&amp;#x6027;&amp;#x5730;&amp;#x5740;&amp;#x4ECD;&amp;#x7136;&amp;#x7531;&amp;#x9875;&amp;#x8868;&amp;#x6765;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5355;&amp;#x5143;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#x5185;&amp;#x6838;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#xFF1A;&amp;#x662F;&amp;#x6307;&amp;#x6574;&amp;#x4E2A;1G&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#x4EE5;&amp;#x53CA;&amp;#x8D85;&amp;#x8FC7;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x9AD8;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&amp;#x8FD9;&amp;#x4E00;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x662F;&amp;#x4E3A;&amp;#x6570;&amp;#x91CF;&amp;#x5927;&amp;#x4E8E;896MB&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x51C6;&amp;#x5907;&amp;#x7684;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x7531;kmap&amp;#x5C06;&amp;#x5185;&amp;#x5B58;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x8BE5;&amp;#x533A;&amp;#x57DF;&amp;#x4E0A;&amp;#x6765;&amp;#x4F7F;&amp;#x7528;&amp;#xFF0C;&amp;#x7528;&amp;#x5B8C;&amp;#x518D;&amp;#x7528;kunmap&amp;#x6765;&amp;#x91CA;&amp;#x653E;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#x5E94;&amp;#x5F53;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x7279;&amp;#x6B8A;&amp;#x7684;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x4ED6;&amp;#x5E94;&amp;#x8BE5;&amp;#x548C;&amp;#x6BB5;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x5BF9;&amp;#x5E94;&amp;#x8D77;&amp;#x6765;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/Linux&amp;#x5185;&amp;#x6838;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;/www.kerneltravel.net chenlj lecture7.pdf.png&#34; hash=&#34;6257edf5d7f0c8602fada240c602d686&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x5185;&amp;#x5B58;&amp;#x8F6C;&amp;#x6362;: &amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740; -&amp;gt; &amp;#x7EBF;&amp;#x6027;&amp;#x5730;&amp;#x5740; -&amp;gt; &amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#xFF1A; = &amp;#x6BB5;&amp;#x6807;&amp;#x8BC6;&amp;#x7B26; + &amp;#x6BB5;&amp;#x5185;&amp;#x504F;&amp;#x79FB;&amp;#x91CF;&amp;#x3002;&lt;span style=&#34;line-height: 22px;&#34;&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x517C;&amp;#x5BB9;&amp;#xFF0C;&amp;#x5C06;&amp;#x8FDC;&amp;#x53E4;&amp;#x65F6;&amp;#x4EE3;&amp;#x7684;&amp;#x6BB5;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&amp;#x4FDD;&amp;#x7559;&amp;#x4E86;&amp;#x4E0B;&amp;#x6765;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;line-height: 22px;&#34;&gt;&lt;span style=&#34;color: rgb(0, 0, 0); font-family: song, Verdana; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 22px; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(240, 243, 250); display: inline !important; float: none;&#34;&gt;CPU&amp;#x5C06;&amp;#x4E00;&amp;#x4E2A;&amp;#x865A;&amp;#x62DF;&amp;#x5185;&amp;#x5B58;&amp;#x7A7A;&amp;#x95F4;&amp;#x4E2D;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x8F6C;&amp;#x6362;&amp;#x4E3A;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x8FDB;&amp;#x884C;&amp;#x4E24;&amp;#x6B65;&amp;#xFF1A;&amp;#x9996;&amp;#x5148;&amp;#x5C06;&amp;#x7ED9;&amp;#x5B9A;&amp;#x4E00;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#xFF08;&amp;#x5176;&amp;#x5B9E;&amp;#x662F;&amp;#x6BB5;&amp;#x5185;&amp;#x504F;&amp;#x79FB;&amp;#x91CF;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E00;&amp;#x5B9A;&amp;#x8981;&amp;#x7406;&amp;#x89E3;&amp;#xFF01;&amp;#xFF01;&amp;#xFF01;&amp;#xFF09;&amp;#xFF0C;CPU&amp;#x8981;&amp;#x5229;&amp;#x7528;&amp;#x5176;&amp;#x6BB5;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x5355;&amp;#x5143;&amp;#xFF0C;&amp;#x5148;&amp;#x5C06;&amp;#x4E3A;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#x8F6C;&amp;#x6362;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x518D;&amp;#x5229;&amp;#x7528;&amp;#x5176;&amp;#x9875;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x5355;&amp;#x5143;&amp;#xFF0C;&amp;#x8F6C;&amp;#x6362;&amp;#x4E3A;&amp;#x6700;&amp;#x7EC8;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x3002; &amp;#xFF08;&lt;/span&gt;&lt;/span&gt;&lt;a href=&#34;http://bbs.chinaunix.net/thread-2083672-1-1.html&#34;&gt;http://bbs.chinaunix.net/thread-2083672-1-1.html&lt;/a&gt;&lt;span style=&#34;font-family: song, Verdana; font-size: 14px; line-height: 22px;&#34;&gt;&amp;#xFF09;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: song, Verdana; font-size: 14px; line-height: 22px;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;line-height: 22px;&#34;&gt;&amp;#x6240;&amp;#x8C13;&amp;#x7684;&amp;#x6BB5;&amp;#x5F0F;&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x628A;&amp;#x6240;&amp;#x6709;&amp;#x5185;&amp;#x5B58;&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x4E3A;&amp;#xFF1A;&amp;#x6570;&amp;#x636E;&amp;#x6BB5;&amp;#xFF0C;&amp;#x4EE3;&amp;#x7801;&amp;#x6BB5;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6BB5;&amp;#x7B49;&amp;#x7B49;&amp;#xFF08;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;UBOOT&amp;#x91CC;&amp;#x9762;&amp;#x7684;lds&amp;#x94FE;&amp;#x63A5;&amp;#x811A;&amp;#x672C;&amp;#xFF09;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6BB5;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#xFF0C;&amp;#x79F0;&amp;#x4E3A;&amp;#x6BB5;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x3002;&amp;#x800C;&amp;#x6BB5;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x53C8;&amp;#x5206;&amp;#x4E3A;&amp;#x5168;&amp;#x5C40;&amp;#x7684;(GDT, &amp;#x7528;&amp;#x4E8E;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6216;&amp;#x5185;&amp;#x6838;&amp;#x7EA7;)&amp;#xFF0C;&amp;#x5C40;&amp;#x90E8;&amp;#x7684;(LDT, &amp;#x7528;&amp;#x4E8E;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7EA7;)&amp;#x3002;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#x4F1A;&amp;#x53D6;&amp;#x5230;&amp;#x4E0D;&amp;#x540C; &amp;#x7684;&amp;#x6BB5;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#xFF0C;&amp;#x518D;&amp;#x4ECE;&amp;#x6BB5;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E2D;&amp;#x53D6;&amp;#x5230;&amp;#x6BB5;&amp;#x57FA;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5F97;&amp;#x5230;&amp;#x7EBF;&amp;#x6027;&amp;#x5730;&amp;#x5740;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/Linux&amp;#x5185;&amp;#x6838;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;/20080115446d77416115bf806a6eolV4lJub7IYi.jpg&#34; hash=&#34;0914a490d70e17ddd96a0f826e4e3ce8&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;linux&amp;#x7684;&amp;#x6BB5;&amp;#x5F0F;&amp;#x7BA1;&amp;#x7406;&amp;#x505A;&amp;#x4E86;&amp;#x4E00;&amp;#x5B9A;&amp;#x7684;&amp;#x7B80;&amp;#x5316;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x7528;&amp;#x6237;&amp;#x7A7A;&amp;#x95F4;&amp;#x548C;&amp;#x5185;&amp;#x6838;&amp;#x7A7A;&amp;#x95F4;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x4EE3;&amp;#x7801;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x5176;&amp;#x57FA;&amp;#x5730;&amp;#x5740;&amp;#x5747;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4E00;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;=&amp;#x7EBF;&amp;#x6027;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x7EBF;&amp;#x6027;&amp;#x5730;&amp;#x5740;=&amp;#x57FA;&amp;#x5730;&amp;#x5740;&amp;#xFF08;0&amp;#xFF09;+offset=&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;iframe class=&#34;enMedia&#34; src=&#34;https://app.yinxiang.com/shard/s10//res/f0ca44df-f6d7-4a19-808d-68efc68bc01a&#34; hash=&#34;757b7b7452bf4180ee71585260d0d63b&#34; style name frameborder=&#34;0&#34;&gt;&lt;/iframe&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/07/01/Linux%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/</guid>
            <title>Linux内存分配</title>
            <link>https://blog.zhougy.top/2012/07/01/Linux%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sun, 01 Jul 2012 10:31:56 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style title lang xml:lang dir&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;Linux&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x4E3A;&amp;#x4E09;&amp;#x4E2A;&amp;#x533A;&amp;#x6BB5;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;margin-left: 60px;&#34;&gt;DMA&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div style=&#34;margin-left: 60px;&#34;&gt;&amp;#x5E38;&amp;#x89C4;&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div style=&#34;margin-left: 60px;&#34;&gt;&amp;#x9AD8;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div&gt;&lt;br clear=&#34;none&#34;&gt;&lt;/div&gt;&lt;div style=&#34;margin-left: 30px;&#34;&gt;&amp;#x5185;&amp;#x6838;&amp;#x53EA;&amp;#x80FD;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E9B;&amp;#x9884;&amp;#x5B9A;&amp;#x4E49;&amp;#x7684;&amp;#xFF0C;&amp;#x56FA;&amp;#x5B9A;&amp;#x5927;&amp;#x5C0F;&amp;#x5B57;&amp;#x8282;&amp;#x6570;&amp;#x7EC4;&amp;#xA0;&lt;/div&gt;&lt;div&gt;1. kmalloc&amp;#x4E0D;&amp;#x80FD;&amp;#x5206;&amp;#x914D;&amp;#x9AD8;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div&gt;&lt;br clear=&#34;none&#34;&gt;&lt;/div&gt;&lt;div&gt;2. &amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#xFF0C;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#xFF0C;&amp;#x5BB9;&amp;#x7EB3;&amp;#x4E86;&amp;#x4EFB;&amp;#x610F;&amp;#x6570;&amp;#x91CF;&amp;#x7684;&amp;#x5C0F;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#xFF0C;&amp;#x5757;&amp;#x7684;&amp;#x5927;&amp;#x5C0F;&amp;#x7531;&amp;#x5206;&amp;#x914D;&amp;#x8BE5;&amp;#x7F13;&amp;#x5B58;&amp;#x6C60;&amp;#x65F6;&amp;#x6307;&amp;#x5B9A;&amp;#x3002;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x7EDF;&amp;#x8BA1;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;/proc/slabinfo&amp;#x4E2D;&amp;#x83B7;&amp;#x5F97;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br clear=&#34;none&#34;&gt;&lt;/div&gt;&lt;div&gt;3. &amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#xFF0C;&amp;#x5176;&amp;#x4F1A;&amp;#x4FDD;&amp;#x5B58;&amp;#x67D0;&amp;#x4E2A;&amp;#x6700;&amp;#x5C0F;&amp;#x6570;&amp;#x989D;&amp;#x7684;&amp;#x5206;&amp;#x914D;&amp;#x5757;&amp;#xFF0C;&amp;#x5F53;&amp;#x8D85;&amp;#x8FC7;&amp;#x8BE5;&amp;#x6700;&amp;#x5C0F;&amp;#x6570;&amp;#x989D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#x88AB;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5728;&amp;#x6B64;&amp;#x6570;&amp;#x989D;&amp;#x4E4B;&amp;#x5185;&amp;#xFF0C;&amp;#x5219;&amp;#x8FD8;&amp;#x662F;&amp;#x4F1A;&amp;#x7559;&amp;#x5728;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#x4E2D;&amp;#x3002;&amp;#x5728;&amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#x88AB;&amp;#x9500;&amp;#x6BC1;&amp;#x65F6;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x8FD4;&amp;#x56DE;&amp;#x6240;&amp;#x6709;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5185;&amp;#x6838;&amp;#x4F1A;&amp;#x6709;oops&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br clear=&#34;none&#34;&gt;&lt;/div&gt;&lt;div&gt;4. get_free_page&lt;/div&gt;&lt;div&gt;&amp;#x4EE5;&amp;#x9875;&amp;#xFF08;2&amp;#x7684;n&amp;#x6B21;&amp;#x65B9;&amp;#xFF09;&amp;#x4E3A;&amp;#x5355;&amp;#x4F4D;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x6709;&amp;#x6548;&amp;#x907F;&amp;#x514D;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&lt;/div&gt;&lt;div&gt;&lt;br clear=&#34;none&#34;&gt;&lt;/div&gt;&lt;div&gt;5. vmalloc&amp;#xFF0C;&amp;#x7528;&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x5927;&amp;#x5C3A;&amp;#x5BF8;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x5176;&amp;#x4F1A;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4ED6;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x53EF;&amp;#x80FD;&amp;#x4E0D;&amp;#x8FDE;&amp;#x7EED;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4ED6;&amp;#x7684;&amp;#x865A;&amp;#x62DF;&amp;#x5185;&amp;#x5B58;&amp;#x4E00;&amp;#x5B9A;&amp;#x662F;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br clear=&#34;none&#34;&gt;&lt;/div&gt;&lt;div&gt;6. &amp;#x5185;&amp;#x6838;&amp;#x751A;&amp;#x81F3;&amp;#x5141;&amp;#x8BB8;&amp;#x5728;&amp;#x5F15;&amp;#x5BFC;&amp;#x65F6;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E0D;&amp;#x5F97;&amp;#x5DF2;&amp;#x91C7;&amp;#x53D6;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x5728;&amp;#x5F15;&amp;#x5BFC;&amp;#x65F6;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x662F;&amp;#x6CA1;&amp;#x529E;&amp;#x6CD5;&amp;#x7531;&amp;#x5185;&amp;#x6838;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x6A21;&amp;#x5757;&amp;#x7BA1;&amp;#x7406;&amp;#x7684;&amp;#xFF0C;&amp;#x5176;&amp;#x63A5;&amp;#x53E3;&amp;#x662F;alloc_bootmem_xxx&lt;/div&gt;&lt;div&gt;&lt;br clear=&#34;none&#34;&gt;&lt;/div&gt;&lt;div&gt;&amp;#x5185;&amp;#x5B58;&amp;#x6280;&amp;#x672F;&amp;#x7684;&amp;#x533A;&amp;#x522B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;1. kmalloc&amp;#xFF0C;__get_free_pages&amp;#xFF0C;vmalloc&amp;#x5747;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x662F;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x3002;&amp;#x524D;&amp;#x4E24;&amp;#x4E2A;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x7EBF;&amp;#x6027;&amp;#x6620;&amp;#x5C04;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x548C;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x662F;&amp;#x4E00;&amp;#x4E00;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#xFF0C;&amp;#x800C;&amp;#x540E;&amp;#x8005;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x9875;&amp;#x8868;&amp;#x95F4;&amp;#x63A5;&amp;#x6620;&amp;#x5C04;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5206;&amp;#x914D;&amp;#x65F6;&amp;#x8F83;&amp;#x6162;&amp;#xFF0C;&amp;#x4E14;&amp;#x4E0D;&amp;#x548C;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x4E00;&amp;#x4E00;&amp;#x5BF9;&amp;#x5E94;&lt;/div&gt;&lt;div&gt;2. vmalloc&amp;#x4E0D;&amp;#x80FD;&amp;#x7528;&amp;#x4E8E;&amp;#x539F;&amp;#x5B50;&amp;#x4E0A;&amp;#x4E0B;&amp;#x6587;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4ED6;&amp;#x662F;&amp;#x7528;kmalloc(GFP_KERNEL)&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x7528;GFP_ATMIC&amp;#x6807;&amp;#x5FD7;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4F1A;&amp;#x4F11;&amp;#x7720;&amp;#x3002;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
    </channel>
</rss>
