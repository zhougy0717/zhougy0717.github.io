{
    "version": "https://jsonfeed.org/version/1",
    "title": "Big Ben • All posts by \"uboot\" tag",
    "description": null,
    "home_page_url": "https://blog.zhougy.top",
    "items": [
        {
            "id": "https://blog.zhougy.top/2012/09/29/meminfo%E5%88%9D%E5%A7%8B%E5%8C%96/",
            "url": "https://blog.zhougy.top/2012/09/29/meminfo%E5%88%9D%E5%A7%8B%E5%8C%96/",
            "title": "meminfo初始化",
            "date_published": "2012-09-29T02:46:46.000Z",
            "content_html": "<div class=\"enNote\" style=\"word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;\" title lang xml:lang dir>1. u-boot&#x4E2D;&#x8BBE;&#x7F6E;&#x542F;&#x52A8;&#x53C2;&#x6570;<div>&#xA0; &#xA0; &#xA0;1&#xFF09;&#x542F;&#x52A8;&#x547D;&#x4EE4;</div><div>&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;u-boot-env.txt</div><div>&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<font face=\"Courier New\">bootcmd&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if ${recovery}; then&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run nandrecovery;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if mmc init; then&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if run loadbootscript; then&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run bootscript;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if run loaduImage; then&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run mmcboot;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;run nandboot;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;fi;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;fi;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<b><font color=\"#FF0000\">run nandboot;</font></b>&#xA0;</font></div><div><font face=\"Courier New\">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; fi;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;fi</font></div><div>&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<font face=\"Courier New\">nandboot&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;echo Booting from nand ...;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<font color=\"#FF0000\">run nandargs;</font>&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;nand read ${loadaddr} boot;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;booti 0x82000008</font></div><div>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;<span style=\"font-family: &apos;Courier New&apos;;\">nandargs</span></div><div>&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<font face=\"Courier New\">setenv bootargs console=${console} init=${init} <font color=\"#FF0000\">mem=${mem}</font> ip=${ip} mpurate=${mpurate} omap_vout.vid1_static_vrfb_alloc=y vram=${vram} omapfb.vram=0:8M androidboot.console=${tty} root=${root_nand} rootfstype=${rootfstype_nand} ubi.mtd=${ubi_mtd}</font></div><div><font face=\"Courier New\"><br></font></div><div>&#xA0; &#xA0; &#xA0;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x5C5E;&#x4E8E;commandline&#xFF0C;&#x4F1A;&#x5728;setup_commandline_tag&#x4E2D;&#x63D2;&#x5165;params&#x6570;&#x7EC4;&#xFF0C;&#x5E76;&#x6807;&#x4E0A;ATAG_CMDLINE&#xFF0C;&#x4F1A;&#x5728;parse_args&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x6765;&#x5904;&#x7406;&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;</div><div>&#xA0; &#xA0; &#xA0;</div><div>&#xA0; &#xA0; &#xA0;2&#xFF09;&#x73AF;&#x5883;&#x53D8;&#x91CF;</div><div>&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;include/configs/d7800.h</div><div><font face=\"Courier New\">&#xA0; &#xA0; &#xA0;#define CONFIG_EXTRA_ENV_SETTINGS \\</font></div><blockquote style=\"margin: 0 0 0 40px; border: none; padding: 0px;\"><blockquote style=\"margin: 0 0 0 40px; border: none; padding: 0px;\"><font face=\"Courier New\">&#xA0; &#xA0; &quot;init=/init\\0&quot; \\<br>&#xA0; &#xA0; <font color=\"#FF0000\">&quot;mem=256M\\0&quot;</font> \\<br>&#xA0; &#xA0; &quot;mpurate=800\\0&quot; \\<br>&#xA0; &#xA0;&#x2026;&#x2026;</font></blockquote><div><font face=\"Courier New\"><br></font></div><div>2.<font face=\"Courier New\">kernel&#x4E2D;&#x7528;parse_args&#x89E3;&#x6790;&#x6B64;bootarg&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x53C2;&#x8003;&#x53E6;&#x4E00;&#x4EFD;&#x7B14;&#x8BB0;</font><a href=\"evernote:///view/161681/s10/39d4ca69-e5d9-4582-9635-d9963aa05e29/39d4ca69-e5d9-4582-9635-d9963aa05e29/\" style=\"color: rgb(105, 170, 53);\">Linux&#x542F;&#x52A8;&#x53C2;&#x6570;&#x201C;init=xxx&#x201D;&#x5206;&#x6790;</a></div><div><font face=\"Courier New\">&#xA0; &#xA0; &#xA0;parse_args -&gt;&#xA0;parse_one -&gt;&#xA0;unknown_bootoption -&gt;&#xA0;obsolete_checksetup -&gt;&#xA0;obs_kernel_param.setup_func =&#xA0;early_mem</font></div><div><font face=\"Courier New\"><br></font></div><div><div><font face=\"Courier New\">3.kernel&#x4E2D;&#x8BBE;&#x7F6E;&#x5BF9;&#x5E94;bootarg&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;</font></div><div>&#xA0; &#xA0; &#xA0;<font face=\"Courier New\">early_param(&quot;mem&quot;, early_mem); -&gt;&#xA0;__setup_param(str, fn, fn, 1) -&gt;&#xA0;</font></div><div><font face=\"Courier New\">&#xA0; &#xA0; &#xA0;#define __setup_param(str, unique_id, fn, early)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; \\</font></div><font face=\"Courier New\">&#xA0; &#xA0; &#xA0;static const char __setup_str_##unique_id[] __initconst \\<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __aligned(1) = str; \\<br>&#xA0; &#xA0; &#xA0;static struct obs_kernel_param __setup_##unique_id&#xA0; \\<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __used __section(<font color=\"#FF0000\">.init.setup</font>)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; \\<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; __attribute__((aligned((sizeof(long)))))&#xA0;&#xA0;&#xA0; \\<br></font><div><font face=\"Courier New\">&#xA0; &#xA0; &#xA0; &#xA0; = { __setup_str_##unique_id, fn, early } &#xA0;&#xA0;</font></div></div><div><font face=\"Courier New\"><br></font></div><div><font face=\"Courier New\">4.</font><span style=\"font-family: &apos;Courier New&apos;;\">early_mem&#x51FD;&#x6570;</span></div><div>&#xA0; &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<font face=\"Courier New\">static int __init early_mem(char *p)</font></div><blockquote style=\"margin: 0 0 0 40px; border: none; padding: 0px;\"><font face=\"Courier New\">{<br>&#xA0;&#xA0;&#xA0; static int usermem __initdata = 0;<br>&#xA0;&#xA0;&#xA0; unsigned long size, start;<br>&#xA0;&#xA0;&#xA0; char *endp;<br>&#xA0;&#xA0;&#xA0; <font color=\"#41AD1C\">/*<br>&#xA0;&#xA0;&#xA0;&#xA0; * If the user specifies memory size, we<br>&#xA0;&#xA0;&#xA0;&#xA0; * blow away any automatically generated<br>&#xA0;&#xA0;&#xA0;&#xA0; * size.<br>&#xA0;&#xA0;&#xA0;&#xA0; */</font><br>&#xA0;&#xA0;&#xA0; if (usermem == 0) {<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; usermem = 1;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; meminfo.nr_banks = 0;<br>&#xA0;&#xA0;&#xA0; }</font></blockquote><blockquote style=\"margin: 0 0 0 40px; border: none; padding: 0px;\">&#xA0; &#xA0; &#xA0; &#xA0;&#xA0;<span style=\"color: rgb(65, 173, 28); font-family: &apos;Courier New&apos;;\">/*</span><div><span style=\"color: rgb(65, 173, 28); font-family: &apos;Courier New&apos;;\">&#xA0;&#xA0;&#xA0;&#xA0;</span> <font color=\"#41AD1C\"><span style=\"font-family: &apos;Courier New&apos;;\">*&#xA0;</span><span style=\"font-family: &apos;Courier New&apos;;\">defined in</span><span style=\"font-family: &apos;Courier New&apos;;\">&#xA0;</span><span style=\"font-family: &apos;Courier New&apos;;\">arch/arm/plat-omap/include/plat/memory.h</span><span style=\"font-family: &apos;Courier New&apos;;\"><br></span><span style=\"font-family: &apos;Courier New&apos;;\">&#xA0;&#xA0;&#xA0;&#xA0; *&#xA0;</span>PHYS_OFFSET &#xA0;= UL(0x80000000)</font><br style=\"color: rgb(65, 173, 28); font-family: &apos;Courier New&apos;;\"><span style=\"color: rgb(65, 173, 28); font-family: &apos;Courier New&apos;;\">&#xA0;&#xA0;&#xA0;&#xA0; */</span></div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0; start = PHYS_OFFSET;<br>&#xA0;&#xA0;&#xA0; size&#xA0; = memparse(p, &amp;endp);<br>&#xA0;&#xA0;&#xA0; if (*endp == &apos;@&apos;)<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; start = memparse(endp + 1, NULL);<br>&#xA0;&#xA0;&#xA0; arm_add_memory(start, size);<br>&#xA0;&#xA0;&#xA0; return 0;<br>}</font></blockquote><blockquote style=\"margin: 0 0 0 40px; border: none; padding: 0px;\"><font face=\"Courier New\"><br></font></blockquote><font face=\"Courier New\">&#x6700;&#x540E;&#x9057;&#x7559;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5047;&#x5982;&#x6709;&#x51E0;&#x5757;&#x5185;&#x5B58;&#x9700;&#x8981;&#x5904;&#x7406;&#x600E;&#x4E48;&#x529E;&#xFF1F;<br></font><div>&#xA0; &#xA0; &#xA0;<font face=\"Courier New\">&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;Linux&#x63D0;&#x4F9B;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x673A;&#x5236;&#x3002;&#x5C31;&#x662F;</font>__tagtable(ATAG_MEM, parse_tag_mem32);&#x8FD9;&#x662F;&#x4E00;&#x5F20;&#x8868;&#x683C;&#xFF0C;&#x4EE3;&#x8868;&#x4E86;&#x4E00;&#x7EC4;ATAG_MEM param&#xFF0C;&#x7528;parse_tag_mem32&#x6765;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x4E00;&#x7EC4;param&#x540C;&#x6837;&#x4E5F;&#x662F;&#x5728;u-boot&#x9636;&#x6BB5;&#x5C31;&#x52A0;&#x5165;&#x4E86;&#x3002;&#x5373;&#xFF1A;</div><div><font face=\"Courier New\">&#xA0; &#xA0; &#xA0;do_bootm_linux -&gt;&#xA0;setup_memory_tags (u-boot)</font></div><blockquote style=\"margin: 0 0 0 40px; border: none; padding: 0px;\"><div><font face=\"Courier New\">static void setup_memory_tags (bd_t *bd)</font></div><div><font face=\"Courier New\">{</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0; int i;</font></div><div><font face=\"Courier New\"><br></font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0; for (i = 0; i &lt; CONFIG_NR_DRAM_BANKS; i++) {</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;hdr.tag = ATAG_MEM;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;hdr.size = tag_size (tag_mem32);</font></div><div><font face=\"Courier New\"><br></font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;u.mem.start = bd-&gt;bi_dram[i].start;</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params-&gt;u.mem.size = bd-&gt;bi_dram[i].size;</font></div><div><font face=\"Courier New\"><br></font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; params = tag_next (params);</font></div><div><font face=\"Courier New\">&#xA0;&#xA0;&#xA0; }</font></div><div><font face=\"Courier New\">}</font></div><div><font face=\"Courier New\"><br></font></div></blockquote>&#xA0; &#xA0; &#xA0;&#x53EA;&#x4E0D;&#x8FC7;&#x5728;D7800&#x4E2D;<span style=\"font-family: &apos;Courier New&apos;;\">CONFIG_NR_DRAM_BANKS=1&#xFF08;configs/d7800.h&#xFF09;&#x3002;</span><div><font face=\"Courier New\"><br></font></div><div>&#xA0; &#xA0; &#xA0;meminfo&#x4E2D;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#x5168;&#x90E8;&#x662F;&#x771F;&#x6B63;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x3002;<font face=\"Courier New\"><br></font><blockquote style=\"margin: 0 0 0 40px; border: none; padding: 0px;\"><div><font face=\"Courier New\"><br></font></div></blockquote><div><br></div><div>&#xA0; &#xA0; &#xA0;</div></div></blockquote></div>",
            "tags": [
                "Linux",
                "内存管理",
                "uboot"
            ]
        }
    ]
}