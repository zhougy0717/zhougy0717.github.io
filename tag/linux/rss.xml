<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>Big Ben • Posts by &#34;linux&#34; tag</title>
        <link>https://blog.zhougy.top</link>
        <description></description>
        <language>en</language>
        <pubDate>Sat, 30 Nov 2019 16:53:07 +0800</pubDate>
        <lastBuildDate>Sat, 30 Nov 2019 16:53:07 +0800</lastBuildDate>
        <category>javascript</category>
        <category>angular</category>
        <category>arm</category>
        <category>单片机</category>
        <category>操作系统</category>
        <category>machine learning</category>
        <category>deep learning</category>
        <category>Linux</category>
        <category>内存管理</category>
        <category>Markdown</category>
        <category>python</category>
        <category>win32com</category>
        <category>nas</category>
        <category>synology</category>
        <category>USB</category>
        <category>Linux Device Drivers</category>
        <category>uboot</category>
        <category>http</category>
        <category>同步</category>
        <category>读书笔记</category>
        <category>程序员修炼之道</category>
        <category>算法</category>
        <category>c/c++</category>
        <category>hexo</category>
        <category>capability</category>
        <category>LD_PRELOAD</category>
        <category>C++</category>
        <category>coding</category>
        <category>UT</category>
        <category>TDD</category>
        <category>印象笔记</category>
        <category>Obsidian</category>
        <category>SELinux</category>
        <category>Android</category>
        <category>xposed</category>
        <category>GitHub</category>
        <category>中断处理</category>
        <category>群晖</category>
        <category>docker</category>
        <category>ttrss</category>
        <category>rsshub</category>
        <category>wallabag</category>
        <category>unittest</category>
        <category>mockito</category>
        <category>powermock</category>
        <category>QT</category>
        <category>nlp</category>
        <category>vim</category>
        <category>SpaceVim</category>
        <category>tmux</category>
        <category>面向对象</category>
        <category>promise</category>
        <category>mongodb</category>
        <category>Programming</category>
        <category>security</category>
        <category>C++11</category>
        <category>IoT</category>
        <category>broadlink</category>
        <category>domoticz</category>
        <category>UML</category>
        <category>socket</category>
        <category>iptables</category>
        <category>neural network</category>
        <category>mock</category>
        <category>深度学习</category>
        <category>schedule algorithm</category>
        <category>glibc</category>
        <category>gtest</category>
        <category>gmock</category>
        <category>golang</category>
        <category>elf</category>
        <category>软件开发</category>
        <category>设计模式</category>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2019/11/30/seccomp%E4%BB%8B%E7%BB%8D/</guid>
            <title>seccomp介绍</title>
            <link>https://blog.zhougy.top/2019/11/30/seccomp%E4%BB%8B%E7%BB%8D/</link>
            <category>Linux</category>
            <category>security</category>
            <pubDate>Sat, 30 Nov 2019 16:53:07 +0800</pubDate>
            <description><![CDATA[ &lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;
&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x57FA;&amp;#x4E8E;[2], &amp;#x63D0;&amp;#x53D6;&amp;#x51FA;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x63CF;&amp;#x8FF0;&amp;#xFF0C;&amp;#x5E76;&amp;#x7406;&amp;#x6E05;&amp;#x601D;&amp;#x8DEF;&lt;/span&gt;&lt;/div&gt;&lt;h2 style=&#34;box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);&#34;&gt;&lt;span style=&#34;font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;seccomp&amp;#x7684;&amp;#x524D;&amp;#x4E16;&amp;#x4ECA;&amp;#x751F;&lt;/span&gt;&lt;/h2&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;seccomp&amp;#x6700;&amp;#x65E9;&amp;#x51FA;&amp;#x73B0;&amp;#x5728;Linux kernel 2.6.12&amp;#xFF0C;&amp;#x65F6;&amp;#x95F4;&amp;#x662F;2005&amp;#x5E74;&amp;#x3002;2012&amp;#x5E74;&amp;#x7684;Linux 3.5&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x52A0;&amp;#x5165;&amp;#x4E86;&amp;quot;seccomp mode 2&amp;quot; (or &amp;quot;seccomp filter mode&amp;quot;)&amp;#x529F;&amp;#x80FD;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;It added a second mode for seccomp: &lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;SECCOMP_MODE_FILTER&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;. Using that mode, processes can specify which system calls are permitted. By using a mini-program in the Berkeley packet filter (BPF) language, processes could restrict system calls entirely or only for certain argument values.&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x6240;&amp;#x4EE5;&amp;#x6211;&amp;#x4EEC;&amp;#x73B0;&amp;#x5728;&amp;#x7528;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x8FD9;&amp;#x4E2A;seccomp2&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x53EB;seccomp-bpf&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x4E3A;&amp;#x5565;&amp;#x53EB;seccomp-bpf?BPF&amp;#x5230;&amp;#x5E95;&amp;#x662F;&amp;#x4EC0;&amp;#x4E48;&amp;#xFF1F;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;
BPF&amp;#x5168;&amp;#x79F0;&amp;#x662F;Berkeley Packet Filter&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x6700;&amp;#x521D;&amp;#x6784;&amp;#x60F3;&amp;#x63D0;&amp;#x51FA;&amp;#x4E8E;1992&amp;#x5E74;&amp;#xFF0C;&amp;#x5176;&amp;#x76EE;&amp;#x7684;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E00;&amp;#x79CD;&amp;#x8FC7;&amp;#x6EE4;&amp;#x5305;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x8981;&amp;#x907F;&amp;#x514D;&amp;#x4ECE;&amp;#x5185;&amp;#x6838;&amp;#x7A7A;&amp;#x95F4;&amp;#x5230;&amp;#x7528;&amp;#x6237;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x65E0;&amp;#x7528;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x590D;&amp;#x5236;&amp;#x884C;&amp;#x4E3A;&amp;#x3002;&amp;#x5B83;&amp;#x6700;&amp;#x521D;&amp;#x662F;&amp;#x7531;&amp;#x4ECE;&amp;#x7528;&amp;#x6237;&amp;#x7A7A;&amp;#x95F4;&amp;#x6CE8;&amp;#x5165;&amp;#x5230;&amp;#x5185;&amp;#x6838;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x7B80;&amp;#x5355;&amp;#x7684;&amp;#x5B57;&amp;#x8282;&amp;#x7801;&amp;#x6784;&amp;#x6210;&amp;#xFF0C;&amp;#x5B83;&amp;#x5728;&amp;#x90A3;&amp;#x4E2A;&amp;#x4F4D;&amp;#x7F6E;&amp;#x5229;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;&amp;#x6821;&amp;#x9A8C;&amp;#x5668;&amp;#x8FDB;&amp;#x884C;&amp;#x68C0;&amp;#x67E5; &amp;#x2014;&amp;#x2014; &amp;#x4EE5;&amp;#x907F;&amp;#x514D;&amp;#x5185;&amp;#x6838;&amp;#x5D29;&amp;#x6E83;&amp;#x6216;&amp;#x8005;&amp;#x5B89;&amp;#x5168;&amp;#x95EE;&amp;#x9898; &amp;#x2014;&amp;#x2014; &amp;#x5E76;&amp;#x9644;&amp;#x7740;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x5957;&amp;#x63A5;&amp;#x5B57;&amp;#x4E0A;&amp;#x3002;&amp;#x5176;&amp;#x7B80;&amp;#x5316;&amp;#x7684;&amp;#x8BED;&amp;#x8A00;&amp;#x4EE5;&amp;#x53CA;&amp;#x5B58;&amp;#x5728;&amp;#x4E8E;&amp;#x5185;&amp;#x6838;&amp;#x4E2D;&amp;#x7684;&amp;#x5373;&amp;#x65F6;&amp;#x7F16;&amp;#x8BD1;&amp;#x5668;&amp;#xFF08;JIT&amp;#xFF09;&amp;#xFF0C;&amp;#x4F7F; BPF &amp;#x6210;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x6027;&amp;#x80FD;&amp;#x5353;&amp;#x8D8A;&amp;#x7684;&amp;#x5DE5;&amp;#x5177;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x4E3A;&amp;#x5565;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x4E1C;&amp;#x897F;&amp;#x4F1A;&amp;#x7ED1;&amp;#x5230;&amp;#x4E00;&amp;#x8D77;&amp;#x5462;&amp;#xFF1F;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;
&amp;#x56E0;&amp;#x4E3A;seccomp&amp;#x5728;&amp;#x8FC7;&amp;#x6EE4;syscall&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x501F;&amp;#x52A9;&amp;#x4E86;BPF&amp;#x5B9A;&amp;#x4E49;&amp;#x7684;&amp;#x8FC7;&amp;#x6EE4;&amp;#x89C4;&amp;#x5219;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x5904;&amp;#x4E8E;&amp;#x5185;&amp;#x6838;&amp;#x7684;&amp;#x7528;BPF language&amp;#x5199;&amp;#x7684;mini-program&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x91C7;&amp;#x7528;&amp;#x4E86;BPF&amp;#x65B9;&amp;#x6CD5;&amp;#x5BF9;syscall&amp;#x8FDB;&amp;#x884C;&amp;#x8FC7;&amp;#x6EE4;&amp;#x7684;seccomp&amp;#x5C31;&amp;#x662F;seccomp-bpf&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;h2 style=&#34;box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);&#34;&gt;&lt;span style=&#34;font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;seccomp&amp;#x600E;&amp;#x4E48;&amp;#x7528;&lt;/span&gt;&lt;/h2&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;The seccomp filter system uses the Berkley Packet Filter system. Combined with argument checking and the many possible filter return values (kill, trap, trace, errno), this is allows for extensive logic.[2]&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;[2]&amp;#x4EE5;&amp;#x53CA;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x9610;&amp;#x8FF0;&amp;#x4E86;&amp;#x6700;&amp;#x57FA;&amp;#x672C;&amp;#x7684;case&amp;#xFF0C;seccomp&amp;#x7684;&amp;#x9AD8;&amp;#x9636;&amp;#x7528;&amp;#x6CD5;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;/span&gt;&lt;a href=&#34;https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;seccomp&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x6587;&amp;#x6863;&lt;/a&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;h3 style=&#34;box-sizing: content-box; font-size: 27px;&#34;&gt;&lt;span style=&#34;font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;Detect seccomp&lt;/span&gt;&lt;/h3&gt;&lt;div style=&#34;box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);&#34;&gt;&lt;div style=&#34;overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;root@kube-master:~#  cat /boot/config-`uname -r` | grep CONFIG_SECCOMP&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;CONFIG_SECCOMP_FILTER=y&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;CONFIG_SECCOMP=y&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x63A5;&amp;#xFF08;&lt;/span&gt;&lt;a href=&#34;https://outflux.net/teach-seccomp/autodetect.html&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;Detecting seccomp features at runtime&lt;/a&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#xFF09;&amp;#x5199;&amp;#x4E00;&amp;#x4E2A;Linux&amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x8C03;&amp;#x7528;prctl&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x6765;&amp;#x68C0;&amp;#x6D4B;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;h3 style=&#34;box-sizing: content-box; font-size: 27px;&#34;&gt;&lt;span style=&#34;font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;Basic seccomp filtering&lt;/span&gt;&lt;/h3&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x57FA;&amp;#x672C;&amp;#x7684;SYSCALL&amp;#x8FC7;&amp;#x6EE4;&amp;#x975E;&amp;#x5E38;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5927;&amp;#x81F4;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/seccomp&amp;#x4ECB;&amp;#x7ECD;/&amp;#x5C4F;&amp;#x5E55;&amp;#x5FEB;&amp;#x7167; 2020-01-05 &amp;#x4E0B;&amp;#x5348;10.12.13.png&#34; hash=&#34;332e39437bbfaa94a82db3d2e78cf393&#34; align alt longdesc width=&#34;836&#34; height=&#34;510&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x540E;&amp;#x9762;&amp;#x4E24;&amp;#x6B65;&amp;#x90FD;&amp;#x5DEE;&amp;#x4E0D;&amp;#x591A;&amp;#xFF0C;&amp;#x53EF;&amp;#x89C1;&amp;#x5173;&amp;#x952E;&amp;#x7684;&amp;#x662F;&amp;#x7B2C;&amp;#x4E00;&amp;#x6B65;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5B9A;&amp;#x4E49;SYSCALL&amp;#x8FC7;&amp;#x6EE4;&amp;#x5217;&amp;#x8868;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);&#34;&gt;&lt;div style=&#34;overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;&#34;&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;struct&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(220, 220, 220); line-height: 160%;&#34;&gt;sock_filter&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(220, 220, 220); line-height: 160%;&#34;&gt;filter&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt;[] = {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(87, 166, 74); font-style: italic; line-height: 160%;&#34;&gt;/* Validate architecture. */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    VALIDATE_ARCHITECTURE,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(87, 166, 74); font-style: italic; line-height: 160%;&#34;&gt;/* Grab the system call number. */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    EXAMINE_SYSCALL,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(87, 166, 74); font-style: italic; line-height: 160%;&#34;&gt;/* List allowed syscalls. */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    ALLOW_SYSCALL(rt_sigreturn),&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    ...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    KILL_PROCESS,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;struct&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(220, 220, 220); line-height: 160%;&#34;&gt;sock_fprog&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(220, 220, 220); line-height: 160%;&#34;&gt;prog&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt; = {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    .len = (&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;unsigned&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;short&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;)(&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;sizeof&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;(filter)/&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;sizeof&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;(filter[&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;])),&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    .filter = filter,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; (prctl(PR_SET_NO_NEW_PRIVS, &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;, &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;, &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;, &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;)) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    perror(&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(214, 157, 133); line-height: 160%;&#34;&gt;&amp;quot;prctl(NO_NEW_PRIVS)&amp;quot;&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;goto&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; failed;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &amp;amp;prog)) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    perror(&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(214, 157, 133); line-height: 160%;&#34;&gt;&amp;quot;prctl(SECCOMP)&amp;quot;&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;goto&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; failed;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3 style=&#34;box-sizing: content-box; font-size: 27px;&#34;&gt;&lt;span style=&#34;font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;BPF&lt;/span&gt;&lt;/h3&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; padding: 4px 4px 2px 0px; letter-spacing: -0.3px; color: rgb(193, 120, 139); line-height: 160%;&#34;&gt;EXAMINE_SYSCALL&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;, &lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; padding: 4px 4px 2px 0px; letter-spacing: -0.3px; color: rgb(193, 120, 139); line-height: 160%;&#34;&gt;ALLOW_SYSCALL&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x548C; &lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; padding: 4px 4px 2px 0px; letter-spacing: -0.3px; color: rgb(193, 120, 139); line-height: 160%;&#34;&gt;KILL_PROCESS&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x90FD;&amp;#x4E0D;&amp;#x662F;&amp;#x6807;&amp;#x51C6;&amp;#x5E93;&amp;#x63D0;&amp;#x4F9B;&amp;#x7684;&amp;#x3002;&amp;#x770B;&amp;#x672C;&amp;#x9879;&amp;#x76EE;&amp;#x7684;&lt;/span&gt;&lt;a href=&#34;https://outflux.net/teach-seccomp/step-3/seccomp-bpf.h&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;seccomp-bpf.h&lt;/a&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x3002;&amp;#x8FD9;&amp;#x4E9B;&amp;#x90FD;&amp;#x662F;&amp;#x81EA;&amp;#x5B9A;&amp;#x4E49;&amp;#x7684;&amp;#x5B8F;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);&#34;&gt;&lt;div style=&#34;overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; VALIDATE_ARCHITECTURE \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_STMT(BPF_LD+BPF_W+BPF_ABS, arch_nr), \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, ARCH_NR, 1, 0), \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; EXAMINE_SYSCALL \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_STMT(BPF_LD+BPF_W+BPF_ABS, syscall_nr)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; ALLOW_SYSCALL(name) \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, __NR_##name, 0, 1), \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; KILL_PROCESS \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x67E5;&amp;#x770B;Linux&amp;#x6E90;&amp;#x7801;&amp;#x53EF;&amp;#x77E5;, BPF_STMT&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);&#34;&gt;&lt;div style=&#34;overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;./include/uapi/linux/filter.h&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;48:#ifndef BPF_STMT&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;49:#define BPF_STMT(code, k) { (unsigned short)(code), 0, 0, k }&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;If one is &amp;quot;feeling masochistic&amp;quot;, they could write BPF programs numerically, but &lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;there are some constants and macros available to make it easier&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;. [3]&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;BPF&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x4E00;&amp;#x5957;&amp;#x6307;&amp;#x4EE4;&amp;#x96C6;&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;filter&amp;#x529F;&amp;#x80FD;&amp;#x3002;&amp;#x4F60;&amp;#x53EF;&amp;#x4EE5;&amp;#x81EA;&amp;#x884C;&amp;#x5199;&amp;#x4E8C;&amp;#x8FDB;&amp;#x5236;&amp;#xFF08;&amp;#x6C47;&amp;#x7F16;&amp;#xFF09;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x91C7;&amp;#x7528;Linux&amp;#x62BD;&amp;#x8C61;&amp;#x7684;&amp;#x5B8F;&amp;#xFF0C;&amp;#x66F4;&amp;#x9AD8;&amp;#x9636;&amp;#x4E00;&amp;#x70B9;&amp;#x7684;API&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;Libseccomp&amp;#x3002;&amp;#x91CC;&amp;#x9762;&amp;#x4E5F;&amp;#x6709;&amp;#x4E0D;&amp;#x5C11;sample&amp;#x4EE3;&amp;#x7801;&amp;#x3002;Android&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x662F;&lt;/span&gt;&lt;a href=&#34;https://github.com/google/minijail&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;minijai&lt;/a&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;There are a number of tools and resources that can make it easier to work with seccomp filters and BPF. Libseccomp provides a higher-level API for creating filters. He noted that the project also has man pages (for example, seccomp_init()) with lots of examples. [3]&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x9664;&amp;#x4E86;&amp;#x9AD8;&amp;#x9636;API&amp;#x53EF;&amp;#x7528;&amp;#xFF0C;[3]&amp;#x4E2D;&amp;#x8FD8;&amp;#x63D0;&amp;#x53CA;&amp;#x4E86;&amp;#x4E00;&amp;#x4E9B;&amp;#x7F16;&amp;#x8BD1;BPF&amp;#x6307;&amp;#x4EE4;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px 0px 10px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;There is also a &lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;BPF compiler (bpfc)&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt; that is part of the netsniff-ng toolkit project. LLVM has a BPF backend as of its 3.7 release that compiles a subset of C to BPF, though he noted that there is little documentation as yet.&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;Finally, the kernel has a &lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;just-in-time (JIT) compiler&lt;/span&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt; that turns the BPF bytecode into native machine code, which can achieve 2-3x performance (or even better in some cases). The JIT compiler is disabled by default, but it can be enabled by writing a &amp;quot;1&amp;quot; to: &lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; padding: 4px 4px 2px 0px; letter-spacing: -0.3px; color: rgb(193, 120, 139); line-height: 160%;&#34;&gt;/proc/sys/net/core/bpf_jit_enable&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;
Kerrisk&amp;apos;s slides have a wealth of information, including additional &amp;gt;resources for more information.&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;h3 style=&#34;box-sizing: content-box; font-size: 27px;&#34;&gt;&lt;span style=&#34;font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;seccomp&amp;#x9AD8;&amp;#x9636;&amp;#x7528;&amp;#x6CD5;&amp;#x7B80;&amp;#x4ECB;&lt;/span&gt;&lt;/h3&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;seccomp&amp;#x7684;&amp;#x9AD8;&amp;#x9636;&amp;#x7528;&amp;#x6CD5;&amp;#x8FD8;&amp;#x662F;&amp;#x8981;&amp;#x53C2;&amp;#x8003;&lt;/span&gt;&lt;a href=&#34;https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;seccomp&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x6587;&amp;#x6863;&lt;/a&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#xFF0C;&amp;#x672C;&amp;#x8282;&amp;#x4EC5;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x7F57;&amp;#x5217;&amp;#x548C;&amp;#x63D0;&amp;#x793A;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;
&amp;#x5728;[2]&amp;#x4E2D;&amp;#x7684;example&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#xFF0C;&amp;#x4E0D;&amp;#x7B26;&amp;#x5408;&amp;#x8981;&amp;#x6C42;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;&amp;#x76F4;&amp;#x63A5;kill process&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD8;&amp;#x6709;&amp;#x5F88;&amp;#x591A;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;ul style=&#34;box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;&#34;&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_KILL_PROCESS&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_KILL_THREAD&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_TRAP&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_ERRNO&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_USER_NOTIF&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_TRACE&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_LOG&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box; position: relative;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;SECCOMP_RET_ALLOW&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px 0px 10px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;If multiple filters exist, the return value for the evaluation of a given system call will always use the highest precedent value.&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;Precedence is only determined using the SECCOMP_RET_ACTION mask. When multiple filters return values of the same precedence, only the SECCOMP_RET_DATA from the most recently installed filter will be returned.&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;h3 style=&#34;box-sizing: content-box; font-size: 27px;&#34;&gt;&lt;span style=&#34;font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;&amp;#x5751;&amp;#xFF08;Pitfalls&amp;#xFF09;&lt;/span&gt;&lt;/h3&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x6765;&amp;#x81EA;[5]&amp;#xFF0C;&amp;#x6211;&amp;#x53EA;&amp;#x662F;&amp;#x642C;&amp;#x8FD0;&amp;#x5DE5;&lt;/span&gt;&lt;/div&gt;&lt;blockquote style=&#34;box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;&#34;&gt;&lt;div style=&#34;box-sizing: content-box; margin: 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;The biggest pitfall to avoid during use is filtering on system call number without checking the architecture value. Why? On any architecture that supports multiple system call invocation conventions, the system call numbers may vary based on the specific invocation. If the numbers in the different calling conventions overlap, then checks in the filters may be abused. Always check the arch value!&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x7FFB;&amp;#x8BD1;&amp;#x4E00;&amp;#x4E0B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x7684;&amp;#x610F;&amp;#x601D;&amp;#x662F;&amp;#x63D0;&amp;#x9192;seccomp&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x8005;&amp;#xFF0C;&amp;#x5728;&amp;#x8BBE;&amp;#x7F6E;filtering&amp;#x4E4B;&amp;#x524D;&amp;#x8981;&amp;#x8BB0;&amp;#x5F97;&amp;#x9A8C;&amp;#x8BC1;&amp;#x4F53;&amp;#x7CFB;&amp;#x67B6;&amp;#x6784;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x4F53;&amp;#x7CFB;&amp;#x67B6;&amp;#x6784;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x53F7;&amp;#x53EF;&amp;#x80FD;&amp;#x662F;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x3002;&amp;#x4F8B;&amp;#x5982;[2]&amp;#x7684;example&amp;#x4E2D;&amp;#x6709;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);&#34;&gt;&lt;div style=&#34;overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;&#34;&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(86, 156, 214); line-height: 160%;&#34;&gt;struct&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(220, 220, 220); line-height: 160%;&#34;&gt;sock_filter&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(220, 220, 220); line-height: 160%;&#34;&gt;filter&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(184, 215, 163); line-height: 160%;&#34;&gt;[] = {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(87, 166, 74); font-style: italic; line-height: 160%;&#34;&gt;/* Validate architecture. */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    VALIDATE_ARCHITECTURE,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;    ...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(87, 166, 74); font-style: italic; line-height: 160%;&#34;&gt;// in seccomp-bpf.h&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; syscall_nr (offsetof(struct seccomp_data, nr))&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; arch_nr (offsetof(struct seccomp_data, arch))&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; defined(__i386__)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;# &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; REG_SYSCALL&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;REG_EAX&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;# &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; ARCH_NR&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;AUDIT_ARCH_I386&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;elif&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; defined(__x86_64__)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;# &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; REG_SYSCALL&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;REG_RAX&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;# &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; ARCH_NR&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;AUDIT_ARCH_X86_64&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;# &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;warning&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(214, 157, 133); line-height: 160%;&#34;&gt;&amp;quot;Platform does not support seccomp filter yet&amp;quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;# &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; REG_SYSCALL&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;# &lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; ARCH_NR&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;define&lt;/span&gt;&lt;span style=&#34;font-size: 14px; box-sizing: content-box; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt; VALIDATE_ARCHITECTURE \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_STMT(BPF_LD+BPF_W+BPF_ABS, arch_nr), \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, ARCH_NR, 1, 0), \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(155, 155, 155); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;seccomp_data&amp;#x662F;&amp;#x5565;&amp;#xFF1F;&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);&#34;&gt;&lt;div style=&#34;overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; * struct seccomp_data - the format the BPF program executes over.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; * @nr: the system call number&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; * @arch: indicates system call convention as an AUDIT_ARCH_* value&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; *        as defined in &amp;lt;linux/audit.h&amp;gt;.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; * @instruction_pointer: at the time of the system call.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; * @args: up to 6 system call arguments always stored as 64-bit values&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; *        regardless of the architecture.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;struct seccomp_data {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;int nr;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;__u32 arch;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;__u64 instruction_pointer;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;__u64 args[6];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(244, 244, 244); line-height: 160%;&#34;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x6211;&amp;#x7684;&amp;#x7406;&amp;#x89E3;&amp;#xFF1A;&amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;(example.c)&amp;#x628A;sock_filter&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x5199;&amp;#x5165;&amp;#x5185;&amp;#x6838;(&amp;#x901A;&amp;#x8FC7;prctl)&amp;#xFF0C;&amp;#x4E4B;&amp;#x540E;&amp;#x5185;&amp;#x6838;&amp;#x63A5;&amp;#x53D7;SYSCALL&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x6784;&amp;#x9020;&amp;#x51FA;seccomp_data&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x6765;&amp;#x8C03;&amp;#x7528;&amp;#x8FD9;&amp;#x4E00;&amp;#x6BB5;BPF&amp;#x4EE3;&amp;#x7801;&amp;#xFF0C;&amp;#x5E76;&amp;#x83B7;&amp;#x5F97;&amp;#x8FC7;&amp;#x6EE4;&amp;#x7684;&amp;#x7ED3;&amp;#x679C;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;h2 style=&#34;box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);&#34;&gt;&lt;span style=&#34;font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;&amp;#x603B;&amp;#x7ED3;&lt;/span&gt;&lt;/h2&gt;&lt;div style=&#34;box-sizing: content-box; margin: 10px 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;seccomp&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x63D0;&amp;#x4F9B;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;SYSCALL&amp;#x8FC7;&amp;#x6EE4;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x5B83;&amp;#x57FA;&amp;#x4E8E;BPF&amp;#x8FC7;&amp;#x6EE4;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x5199;&amp;#x5165;BPF&amp;#x8FC7;&amp;#x6EE4;&amp;#x5668;&amp;#x4EE3;&amp;#x7801;&amp;#x6765;&amp;#x8FBE;&amp;#x5230;&amp;#x8FC7;&amp;#x6EE4;&amp;#x7684;&amp;#x76EE;&amp;#x7684;&amp;#x3002;BPF&amp;#x89C4;&amp;#x5219;&amp;#x8BED;&amp;#x8A00;&amp;#x539F;&amp;#x751F;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x8FC7;&amp;#x6EE4;&amp;#x7F51;&amp;#x7EDC;&amp;#x5305;&amp;#xFF0C;&amp;#x60C5;&amp;#x666F;&amp;#x6BD4;&amp;#x8F83;&amp;#x590D;&amp;#x6742;&amp;#x3002;&amp;#x9488;&amp;#x5BF9;SYSCALL&amp;#x573A;&amp;#x666F;&amp;#xFF0C;&amp;#x8BED;&amp;#x6CD5;&amp;#x6BD4;&amp;#x8F83;&amp;#x56FA;&amp;#x5B9A;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x81EA;&amp;#x884C;&amp;#x64B0;&amp;#x5199;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x57FA;&amp;#x4E8E;Libseccomp&amp;#x5E93;&amp;#x63D0;&amp;#x4F9B;&amp;#x7684;API&amp;#x6765;&amp;#x7F16;&amp;#x5199;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;
&amp;#x56E0;&amp;#x4E3A;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5728;fork/clone&amp;#x6216;execve&amp;#x65F6;&amp;#xFF0C;BPF filter&amp;#x4F1A;&amp;#x4ECE;&amp;#x7236;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7EE7;&amp;#x627F;&amp;#x5230;&amp;#x5B50;&amp;#x8FDB;&amp;#x7A0B;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5982;&amp;#x679C;&amp;#x60F3;&amp;#x63A7;&amp;#x5236;&amp;#x7B2C;&amp;#x4E09;&amp;#x65B9;&amp;#x7684;&amp;#x7A0B;&amp;#x5E8F;&amp;#x8C03;&amp;#x7528;SYSCALL&amp;#xFF0C;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x5728;fork/clone&amp;#x6216;&amp;#x8005;execve&amp;#x65F6;&amp;#xFF0C;&amp;#x4F20;&amp;#x5165;&amp;#x5408;&amp;#x9002;&amp;#x7684;sock_filter&amp;#x5373;&amp;#x53EF;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;h2 style=&#34;box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);&#34;&gt;&lt;span style=&#34;font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;&#34;&gt;&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;&lt;/span&gt;&lt;/h2&gt;&lt;ol style=&#34;box-sizing: content-box; padding-left: 30px; margin: 6px 0px 10px; list-style-type: decimal;&#34;&gt;&lt;li style=&#34;box-sizing: content-box;&#34;&gt;&lt;div&gt;&lt;a href=&#34;http://atum.li/2017/04/25/linuxsandbox/#linux%E4%B8%AD%E7%9A%84%E6%B2%99%E7%AE%B1%E6%8A%80%E6%9C%AF&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;linux&amp;#x4E2D;&amp;#x7684;&amp;#x5BB9;&amp;#x5668;&amp;#x4E0E;&amp;#x6C99;&amp;#x7BB1;&amp;#x521D;&amp;#x63A2;&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box;&#34;&gt;&lt;div&gt;&lt;a href=&#34;https://outflux.net/teach-seccomp/&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;Using simple seccomp filters&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box;&#34;&gt;&lt;div&gt;&lt;a href=&#34;https://lwn.net/Articles/656307/&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;A seccomp overview&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box;&#34;&gt;&lt;div&gt;&lt;a href=&#34;https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;seccomp&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x6587;&amp;#x6863;&lt;/a&gt;&lt;span style=&#34;font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;&#34;&gt;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box;&#34;&gt;&lt;div&gt;&lt;a href=&#34;https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;kernel doc - Seccomp BPF (SECure COMPuting with filters)&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style=&#34;box-sizing: content-box;&#34;&gt;&lt;div&gt;&lt;a href=&#34;https://www.jianshu.com/p/62ede45cfb2e&#34; style=&#34;box-sizing: content-box; font-size: 14px; color: rgb(82, 134, 188); line-height: 160%; text-decoration: underline;&#34;&gt;Android&amp;#x4E2D;&amp;#x7684;seccomp&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;center style=&#34;display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden&#34;&gt;Linux%E9%87%8C%E9%9D%A2%E6%9C%89%E5%BE%88%E5%A4%9A%E5%AE%89%E5%85%A8feature%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E6%9E%84%E6%88%90%E5%BA%94%E7%94%A8%E6%B2%99%E7%AE%B1%EF%BC%8C%E6%9D%A5%E8%BE%BE%E5%88%B0%E6%8E%A7%E5%88%B6%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8F%91%E8%A1%8C%E7%9A%84app%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E3%80%82%E5%8F%82%E8%80%83%5B1%5D%E5%8F%AF%E4%BB%A5%E6%9C%89%E4%B8%80%E4%B8%AA%E5%A4%A7%E8%87%B4%E7%9A%84%E4%BA%86%E8%A7%A3%E3%80%82Secure%20Computing%2C%20%E7%AE%80%E7%A7%B0seccomp%E6%98%AF%E5%85%B6%E4%B8%AD%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95%E3%80%82%E9%80%9A%E8%BF%87seccomp%E5%8F%AF%E4%BB%A5%E6%8E%A7%E5%88%B6%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%AF%B9%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E8%AE%BF%E9%97%AE%E3%80%82%0A%3E%20seccomp%E6%B2%99%E7%AE%B1%E4%B8%BB%E8%A6%81%E6%9C%89%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F%EF%BC%8CSECCOMP_SET_MODE_STRICT%E5%8F%AA%E8%BF%90%E8%A1%8C%E8%B0%83%E7%94%A84%E4%B8%AA%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8read(2)%2C%20write(2)%2C%20%5C_exit(2)%2C%20sigreturn(2)%E5%9B%9B%E4%B8%AA%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%EF%BC%8C%E8%80%8CSECCOMP_SET_MODE_FILTER%E5%88%99%E5%85%81%E8%AE%B8%E9%80%9A%E8%BF%87BPF%E6%8C%87%E5%AE%9A%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E9%BB%91%E5%90%8D%E5%8D%95%E6%88%96%E8%80%85%E7%99%BD%E5%90%8D%E5%8D%95%5B1%5D%0A%0A%E6%96%87%E7%8C%AE%5B2%5D%E6%8F%90%E4%BE%9B%E4%BA%86seccomp%E5%85%A5%E9%97%A8%E9%9D%9E%E5%B8%B8%E5%A5%BD%E7%9A%84%E4%B8%80%E4%B8%AAexample%E9%A1%B9%E7%9B%AE%E3%80%82%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E6%9C%80%E5%B0%8F%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%EF%BC%8Cstep%20by%20step%E5%9C%B0%E6%BC%94%E7%A4%BA%E4%BA%86seccomp%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%87%E6%BB%A4%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E3%80%82%0A%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E5%9F%BA%E4%BA%8E%5B2%5D%2C%20%E6%8F%90%E5%8F%96%E5%87%BA%E6%A0%B8%E5%BF%83%E7%9A%84%E6%8F%8F%E8%BF%B0%EF%BC%8C%E5%B9%B6%E7%90%86%E6%B8%85%E6%80%9D%E8%B7%AF%0A%0A%23%23%20seccomp%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%0Aseccomp%E6%9C%80%E6%97%A9%E5%87%BA%E7%8E%B0%E5%9C%A8Linux%20kernel%202.6.12%EF%BC%8C%E6%97%B6%E9%97%B4%E6%98%AF2005%E5%B9%B4%E3%80%822012%E5%B9%B4%E7%9A%84Linux%203.5%E7%89%88%E6%9C%AC%EF%BC%8C%E5%8A%A0%E5%85%A5%E4%BA%86%22seccomp%20mode%202%22%20(or%20%22seccomp%20filter%20mode%22)%E5%8A%9F%E8%83%BD%E3%80%82%0A%3E%20It%20added%20a%20second%20mode%20for%20seccomp%3A%20**SECCOMP_MODE_FILTER**.%20Using%20that%20mode%2C%20processes%20can%20specify%20which%20system%20calls%20are%20permitted.%20By%20using%20a%20mini-program%20in%20the%20Berkeley%20packet%20filter%20(BPF)%20language%2C%20processes%20could%20restrict%20system%20calls%20entirely%20or%20only%20for%20certain%20argument%20values.%20%0A%0A%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E7%8E%B0%E5%9C%A8%E7%94%A8%E7%9A%84%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B8%AAseccomp2%EF%BC%8C%E6%88%96%E8%80%85%E5%8F%ABseccomp-bpf%E3%80%82%E9%82%A3%E4%B9%88%E4%B8%BA%E5%95%A5%E5%8F%ABseccomp-bpf%3FBPF%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%0ABPF%E5%85%A8%E7%A7%B0%E6%98%AFBerkeley%20Packet%20Filter%E3%80%82%0A%3E%20%E6%9C%80%E5%88%9D%E6%9E%84%E6%83%B3%E6%8F%90%E5%87%BA%E4%BA%8E1992%E5%B9%B4%EF%BC%8C%E5%85%B6%E7%9B%AE%E7%9A%84%E6%98%AF%E4%B8%BA%E4%BA%86%E6%8F%90%E4%BE%9B%E4%B8%80%E7%A7%8D%E8%BF%87%E6%BB%A4%E5%8C%85%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%A6%81%E9%81%BF%E5%85%8D%E4%BB%8E%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4%E5%88%B0%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E7%9A%84%E6%97%A0%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85%E5%A4%8D%E5%88%B6%E8%A1%8C%E4%B8%BA%E3%80%82%E5%AE%83%E6%9C%80%E5%88%9D%E6%98%AF%E7%94%B1%E4%BB%8E%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E6%B3%A8%E5%85%A5%E5%88%B0%E5%86%85%E6%A0%B8%E7%9A%84%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81%E6%9E%84%E6%88%90%EF%BC%8C%E5%AE%83%E5%9C%A8%E9%82%A3%E4%B8%AA%E4%BD%8D%E7%BD%AE%E5%88%A9%E7%94%A8%E4%B8%80%E4%B8%AA%E6%A0%A1%E9%AA%8C%E5%99%A8%E8%BF%9B%E8%A1%8C%E6%A3%80%E6%9F%A5%20%E2%80%94%E2%80%94%20%E4%BB%A5%E9%81%BF%E5%85%8D%E5%86%85%E6%A0%B8%E5%B4%A9%E6%BA%83%E6%88%96%E8%80%85%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%20%E2%80%94%E2%80%94%20%E5%B9%B6%E9%99%84%E7%9D%80%E5%88%B0%E4%B8%80%E4%B8%AA%E5%A5%97%E6%8E%A5%E5%AD%97%E4%B8%8A%E3%80%82%E5%85%B6%E7%AE%80%E5%8C%96%E7%9A%84%E8%AF%AD%E8%A8%80%E4%BB%A5%E5%8F%8A%E5%AD%98%E5%9C%A8%E4%BA%8E%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88JIT%EF%BC%89%EF%BC%8C%E4%BD%BF%20BPF%20%E6%88%90%E4%B8%BA%E4%B8%80%E4%B8%AA%E6%80%A7%E8%83%BD%E5%8D%93%E8%B6%8A%E7%9A%84%E5%B7%A5%E5%85%B7%E3%80%82%0A%0A%E4%B8%BA%E5%95%A5%E8%BF%99%E4%B8%A4%E4%B8%AA%E4%B8%9C%E8%A5%BF%E4%BC%9A%E7%BB%91%E5%88%B0%E4%B8%80%E8%B5%B7%E5%91%A2%EF%BC%9F%0A%E5%9B%A0%E4%B8%BAseccomp%E5%9C%A8%E8%BF%87%E6%BB%A4syscall%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%80%9F%E5%8A%A9%E4%BA%86BPF%E5%AE%9A%E4%B9%89%E7%9A%84%E8%BF%87%E6%BB%A4%E8%A7%84%E5%88%99%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%A4%84%E4%BA%8E%E5%86%85%E6%A0%B8%E7%9A%84%E7%94%A8BPF%20language%E5%86%99%E7%9A%84mini-program%E3%80%82%E6%89%80%E4%BB%A5%E9%87%87%E7%94%A8%E4%BA%86BPF%E6%96%B9%E6%B3%95%E5%AF%B9syscall%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%E7%9A%84seccomp%E5%B0%B1%E6%98%AFseccomp-bpf%E3%80%82%0A%23%23%20seccomp%E6%80%8E%E4%B9%88%E7%94%A8%0A%3E%20The%20seccomp%20filter%20system%20uses%20the%20Berkley%20Packet%20Filter%20system.%20Combined%20with%20argument%20checking%20and%20the%20many%20possible%20filter%20return%20values%20(kill%2C%20trap%2C%20trace%2C%20errno)%2C%20this%20is%20allows%20for%20extensive%20logic.%5B2%5D%0A%0A%5B2%5D%E4%BB%A5%E5%8F%8A%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E9%98%90%E8%BF%B0%E4%BA%86%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84case%EF%BC%8Cseccomp%E7%9A%84%E9%AB%98%E9%98%B6%E7%94%A8%E6%B3%95%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%5Bseccomp%E7%9A%84%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3%5D(https%3A%2F%2Fwww.kernel.org%2Fdoc%2Fhtml%2Flatest%2Fuserspace-api%2Fseccomp_filter.html)%E3%80%82%0A%23%23%23%20Detect%20seccomp%0A%60%60%60%0Aroot%40kube-master%3A~%23%20%20cat%20%2Fboot%2Fconfig-%60uname%20-r%60%20%7C%20grep%20CONFIG_SECCOMP%0ACONFIG_SECCOMP_FILTER%3Dy%0ACONFIG_SECCOMP%3Dy%0A%60%60%60%0A%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%E8%BF%99%E4%B8%AA%E9%93%BE%E6%8E%A5%EF%BC%88%5BDetecting%20seccomp%20features%20at%20runtime%5D(https%3A%2F%2Foutflux.net%2Fteach-seccomp%2Fautodetect.html)%EF%BC%89%E5%86%99%E4%B8%80%E4%B8%AALinux%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B0%83%E7%94%A8prctl%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%9D%A5%E6%A3%80%E6%B5%8B%E3%80%82%0A%0A%23%23%23%20Basic%20seccomp%20filtering%0A%E5%9F%BA%E6%9C%AC%E7%9A%84SYSCALL%E8%BF%87%E6%BB%A4%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%EF%BC%8C%E5%A4%A7%E8%87%B4%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%60%60%60mermaid%0Agraph%20TD%0AA%5B%22%E5%AE%9A%E4%B9%89filter%E6%95%B0%E7%BB%84%22%5D%0AA%20--%3E%20B%5B%22%E5%AE%9A%E4%B9%89prog%E5%8F%82%E6%95%B0%22%5D%0AB%20--%3E%20C%5B%22prctl(PR_SET_SECCOMP%2C%20SECCOMP_MODE_FILTER%2C%20%26prog)%22%5D%0A%60%60%60%0A%E5%90%8E%E9%9D%A2%E4%B8%A4%E6%AD%A5%E9%83%BD%E5%B7%AE%E4%B8%8D%E5%A4%9A%EF%BC%8C%E5%8F%AF%E8%A7%81%E5%85%B3%E9%94%AE%E7%9A%84%E6%98%AF%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%AE%9A%E4%B9%89SYSCALL%E8%BF%87%E6%BB%A4%E5%88%97%E8%A1%A8%E3%80%82%0A%60%60%60c%0Astruct%20sock_filter%20filter%5B%5D%20%3D%20%7B%0A%20%20%20%20%2F*%20Validate%20architecture.%20*%2F%0A%20%20%20%20VALIDATE_ARCHITECTURE%2C%0A%20%20%20%20%2F*%20Grab%20the%20system%20call%20number.%20*%2F%0A%20%20%20%20EXAMINE_SYSCALL%2C%0A%20%20%20%20%2F*%20List%20allowed%20syscalls.%20*%2F%0A%20%20%20%20ALLOW_SYSCALL(rt_sigreturn)%2C%0A%20%20%20%20...%0A%20%20%20%20KILL_PROCESS%2C%0A%7D%3B%0Astruct%20sock_fprog%20prog%20%3D%20%7B%0A%20%20%20%20.len%20%3D%20(unsigned%20short)(sizeof(filter)%2Fsizeof(filter%5B0%5D))%2C%0A%20%20%20%20.filter%20%3D%20filter%2C%0A%7D%3B%0A%0Aif%20(prctl(PR_SET_NO_NEW_PRIVS%2C%201%2C%200%2C%200%2C%200))%20%7B%0A%20%20%20%20perror(%22prctl(NO_NEW_PRIVS)%22)%3B%0A%20%20%20%20goto%20failed%3B%0A%7D%0Aif%20(prctl(PR_SET_SECCOMP%2C%20SECCOMP_MODE_FILTER%2C%20%26prog))%20%7B%0A%20%20%20%20perror(%22prctl(SECCOMP)%22)%3B%0A%20%20%20%20goto%20failed%3B%0A%7D%0A%60%60%60%0A%0A%23%23%23%20BPF%0A%E8%BF%99%E9%87%8C%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%60EXAMINE_SYSCALL%60%2C%20%60ALLOW_SYSCALL%60%E5%92%8C%20%60KILL_PROCESS%60%E9%83%BD%E4%B8%8D%E6%98%AF%E6%A0%87%E5%87%86%E5%BA%93%E6%8F%90%E4%BE%9B%E7%9A%84%E3%80%82%E7%9C%8B%E6%9C%AC%E9%A1%B9%E7%9B%AE%E7%9A%84%5Bseccomp-bpf.h%5D(https%3A%2F%2Foutflux.net%2Fteach-seccomp%2Fstep-3%2Fseccomp-bpf.h)%E5%8F%AF%E4%BB%A5%E7%9F%A5%E9%81%93%E3%80%82%E8%BF%99%E4%BA%9B%E9%83%BD%E6%98%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AE%8F%EF%BC%9A%0A%60%60%60C%0A%23define%20VALIDATE_ARCHITECTURE%20%5C%0A%09BPF_STMT(BPF_LD%2BBPF_W%2BBPF_ABS%2C%20arch_nr)%2C%20%5C%0A%09BPF_JUMP(BPF_JMP%2BBPF_JEQ%2BBPF_K%2C%20ARCH_NR%2C%201%2C%200)%2C%20%5C%0A%09BPF_STMT(BPF_RET%2BBPF_K%2C%20SECCOMP_RET_KILL)%0A%0A%23define%20EXAMINE_SYSCALL%20%5C%0A%09BPF_STMT(BPF_LD%2BBPF_W%2BBPF_ABS%2C%20syscall_nr)%0A%0A%23define%20ALLOW_SYSCALL(name)%20%5C%0A%09BPF_JUMP(BPF_JMP%2BBPF_JEQ%2BBPF_K%2C%20__NR_%23%23name%2C%200%2C%201)%2C%20%5C%0A%09BPF_STMT(BPF_RET%2BBPF_K%2C%20SECCOMP_RET_ALLOW)%0A%0A%23define%20KILL_PROCESS%20%5C%0A%09BPF_STMT(BPF_RET%2BBPF_K%2C%20SECCOMP_RET_KILL)%0A%60%60%60%0A%E6%9F%A5%E7%9C%8BLinux%E6%BA%90%E7%A0%81%E5%8F%AF%E7%9F%A5%2C%20BPF_STMT%0A%60%60%60%0A.%2Finclude%2Fuapi%2Flinux%2Ffilter.h%0A48%3A%23ifndef%20BPF_STMT%0A49%3A%23define%20BPF_STMT(code%2C%20k)%20%7B%20(unsigned%20short)(code)%2C%200%2C%200%2C%20k%20%7D%0A%60%60%60%0A%3EIf%20one%20is%20%22feeling%20masochistic%22%2C%20they%20could%20write%20BPF%20programs%20numerically%2C%20but%20**there%20are%20some%20constants%20and%20macros%20available%20to%20make%20it%20easier**.%20%5B3%5D%0A%0ABPF%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E5%A5%97%E6%8C%87%E4%BB%A4%E9%9B%86%E6%9D%A5%E5%AE%9E%E7%8E%B0filter%E5%8A%9F%E8%83%BD%E3%80%82%E4%BD%A0%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8C%E5%86%99%E4%BA%8C%E8%BF%9B%E5%88%B6%EF%BC%88%E6%B1%87%E7%BC%96%EF%BC%89%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%87%87%E7%94%A8Linux%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%AE%8F%EF%BC%8C%E6%9B%B4%E9%AB%98%E9%98%B6%E4%B8%80%E7%82%B9%E7%9A%84API%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83Libseccomp%E3%80%82%E9%87%8C%E9%9D%A2%E4%B9%9F%E6%9C%89%E4%B8%8D%E5%B0%91sample%E4%BB%A3%E7%A0%81%E3%80%82Android%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF%5Bminijai%5D(https%3A%2F%2Fgithub.com%2Fgoogle%2Fminijail)%E3%80%82%0A%3EThere%20are%20a%20number%20of%20tools%20and%20resources%20that%20can%20make%20it%20easier%20to%20work%20with%20seccomp%20filters%20and%20BPF.%20Libseccomp%20provides%20a%20higher-level%20API%20for%20creating%20filters.%20He%20noted%20that%20the%20project%20also%20has%20man%20pages%20(for%20example%2C%20seccomp_init())%20with%20lots%20of%20examples.%20%5B3%5D%0A%0A%0A%E9%99%A4%E4%BA%86%E9%AB%98%E9%98%B6API%E5%8F%AF%E7%94%A8%EF%BC%8C%5B3%5D%E4%B8%AD%E8%BF%98%E6%8F%90%E5%8F%8A%E4%BA%86%E4%B8%80%E4%BA%9B%E7%BC%96%E8%AF%91BPF%E6%8C%87%E4%BB%A4%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9A%0A%3EThere%20is%20also%20a%20**BPF%20compiler%20(bpfc)**%20that%20is%20part%20of%20the%20netsniff-ng%20toolkit%20project.%20LLVM%20has%20a%20BPF%20backend%20as%20of%20its%203.7%20release%20that%20compiles%20a%20subset%20of%20C%20to%20BPF%2C%20though%20he%20noted%20that%20there%20is%20little%20documentation%20as%20yet.%0A%3E%0A%3EFinally%2C%20the%20kernel%20has%20a%20**just-in-time%20(JIT)%20compiler**%20that%20turns%20the%20BPF%20bytecode%20into%20native%20machine%20code%2C%20which%20can%20achieve%202-3x%20performance%20(or%20even%20better%20in%20some%20cases).%20The%20JIT%20compiler%20is%20disabled%20by%20default%2C%20but%20it%20can%20be%20enabled%20by%20writing%20a%20%221%22%20to%3A%20%60%2Fproc%2Fsys%2Fnet%2Fcore%2Fbpf_jit_enable%60%0A%3EKerrisk&amp;apos;s%20slides%20have%20a%20wealth%20of%20information%2C%20including%20additional%20%3Eresources%20for%20more%20information.%0A%0A%23%23%23%20seccomp%E9%AB%98%E9%98%B6%E7%94%A8%E6%B3%95%E7%AE%80%E4%BB%8B%0Aseccomp%E7%9A%84%E9%AB%98%E9%98%B6%E7%94%A8%E6%B3%95%E8%BF%98%E6%98%AF%E8%A6%81%E5%8F%82%E8%80%83%5Bseccomp%E7%9A%84%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3%5D(https%3A%2F%2Fwww.kernel.org%2Fdoc%2Fhtml%2Flatest%2Fuserspace-api%2Fseccomp_filter.html)%EF%BC%8C%E6%9C%AC%E8%8A%82%E4%BB%85%E5%81%9A%E4%B8%80%E4%BA%9B%E7%BD%97%E5%88%97%E5%92%8C%E6%8F%90%E7%A4%BA%E3%80%82%0A%E5%9C%A8%5B2%5D%E4%B8%AD%E7%9A%84example%E4%BB%A3%E7%A0%81%E9%87%8C%EF%BC%8C%E4%B8%8D%E7%AC%A6%E5%90%88%E8%A6%81%E6%B1%82%E7%9A%84%E8%B0%83%E7%94%A8%EF%BC%8C%E4%BC%9A%E8%A2%AB%E7%9B%B4%E6%8E%A5kill%20process%E3%80%82%E5%85%B6%E5%AE%9E%E8%BF%98%E6%9C%89%E5%BE%88%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%9A%0A-%20SECCOMP_RET_KILL_PROCESS%0A-%20SECCOMP_RET_KILL_THREAD%0A-%20SECCOMP_RET_TRAP%0A-%20SECCOMP_RET_ERRNO%0A-%20SECCOMP_RET_USER_NOTIF%0A-%20SECCOMP_RET_TRACE%0A-%20SECCOMP_RET_LOG%0A-%20SECCOMP_RET_ALLOW%0A%0A%3EIf%20multiple%20filters%20exist%2C%20the%20return%20value%20for%20the%20evaluation%20of%20a%20given%20system%20call%20will%20always%20use%20the%20highest%20precedent%20value.%0A%3E%0A%3EPrecedence%20is%20only%20determined%20using%20the%20SECCOMP_RET_ACTION%20mask.%20When%20multiple%20filters%20return%20values%20of%20the%20same%20precedence%2C%20only%20the%20SECCOMP_RET_DATA%20from%20the%20most%20recently%20installed%20filter%20will%20be%20returned.%0A%0A%23%23%23%20%E5%9D%91%EF%BC%88Pitfalls%EF%BC%89%0A%E6%9D%A5%E8%87%AA%5B5%5D%EF%BC%8C%E6%88%91%E5%8F%AA%E6%98%AF%E6%90%AC%E8%BF%90%E5%B7%A5%0A%3E%20The%20biggest%20pitfall%20to%20avoid%20during%20use%20is%20filtering%20on%20system%20call%20number%20without%20checking%20the%20architecture%20value.%20Why%3F%20On%20any%20architecture%20that%20supports%20multiple%20system%20call%20invocation%20conventions%2C%20the%20system%20call%20numbers%20may%20vary%20based%20on%20the%20specific%20invocation.%20If%20the%20numbers%20in%20the%20different%20calling%20conventions%20overlap%2C%20then%20checks%20in%20the%20filters%20may%20be%20abused.%20Always%20check%20the%20arch%20value!%0A%0A%E7%BF%BB%E8%AF%91%E4%B8%80%E4%B8%8B%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84%E6%84%8F%E6%80%9D%E6%98%AF%E6%8F%90%E9%86%92seccomp%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85%EF%BC%8C%E5%9C%A8%E8%AE%BE%E7%BD%AEfiltering%E4%B9%8B%E5%89%8D%E8%A6%81%E8%AE%B0%E5%BE%97%E9%AA%8C%E8%AF%81%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%9B%A0%E4%B8%BA%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84%EF%BC%8C%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%8F%B7%E5%8F%AF%E8%83%BD%E6%98%AF%E4%B8%8D%E5%90%8C%E7%9A%84%E3%80%82%E4%BE%8B%E5%A6%82%5B2%5D%E7%9A%84example%E4%B8%AD%E6%9C%89%EF%BC%9A%0A%60%60%60c%0Astruct%20sock_filter%20filter%5B%5D%20%3D%20%7B%0A%20%20%20%20%2F*%20Validate%20architecture.%20*%2F%0A%20%20%20%20VALIDATE_ARCHITECTURE%2C%0A%20%20%20%20...%0A%7D%3B%0A%0A%2F%2F%20in%20seccomp-bpf.h%0A%23define%20syscall_nr%20(offsetof(struct%20seccomp_data%2C%20nr))%0A%23define%20arch_nr%20(offsetof(struct%20seccomp_data%2C%20arch))%0A%0A%23if%20defined(__i386__)%0A%23%20define%20REG_SYSCALL%09REG_EAX%0A%23%20define%20ARCH_NR%09AUDIT_ARCH_I386%0A%23elif%20defined(__x86_64__)%0A%23%20define%20REG_SYSCALL%09REG_RAX%0A%23%20define%20ARCH_NR%09AUDIT_ARCH_X86_64%0A%23else%0A%23%20warning%20%22Platform%20does%20not%20support%20seccomp%20filter%20yet%22%0A%23%20define%20REG_SYSCALL%090%0A%23%20define%20ARCH_NR%090%0A%23endif%0A%0A%23define%20VALIDATE_ARCHITECTURE%20%5C%0A%09BPF_STMT(BPF_LD%2BBPF_W%2BBPF_ABS%2C%20arch_nr)%2C%20%5C%0A%09BPF_JUMP(BPF_JMP%2BBPF_JEQ%2BBPF_K%2C%20ARCH_NR%2C%201%2C%200)%2C%20%5C%0A%09BPF_STMT(BPF_RET%2BBPF_K%2C%20SECCOMP_RET_KILL)%0A%60%60%60%0A%0Aseccomp_data%E6%98%AF%E5%95%A5%EF%BC%9F%0A%60%60%60%0A%2F**%0A%20*%20struct%20seccomp_data%20-%20the%20format%20the%20BPF%20program%20executes%20over.%0A%20*%20%40nr%3A%20the%20system%20call%20number%0A%20*%20%40arch%3A%20indicates%20system%20call%20convention%20as%20an%20AUDIT_ARCH_*%20value%0A%20*%20%20%20%20%20%20%20%20as%20defined%20in%20%3Clinux%2Faudit.h%3E.%0A%20*%20%40instruction_pointer%3A%20at%20the%20time%20of%20the%20system%20call.%0A%20*%20%40args%3A%20up%20to%206%20system%20call%20arguments%20always%20stored%20as%2064-bit%20values%0A%20*%20%20%20%20%20%20%20%20regardless%20of%20the%20architecture.%0A%20*%2F%0Astruct%20seccomp_data%20%7B%0A%09int%20nr%3B%0A%09__u32%20arch%3B%0A%09__u64%20instruction_pointer%3B%0A%09__u64%20args%5B6%5D%3B%0A%7D%3B%0A%60%60%60%0A%E6%88%91%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9A%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F(example.c)%E6%8A%8Asock_filter%E7%BB%93%E6%9E%84%E4%BD%93%E5%86%99%E5%85%A5%E5%86%85%E6%A0%B8(%E9%80%9A%E8%BF%87prctl)%EF%BC%8C%E4%B9%8B%E5%90%8E%E5%86%85%E6%A0%B8%E6%8E%A5%E5%8F%97SYSCALL%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%9E%84%E9%80%A0%E5%87%BAseccomp_data%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%9D%A5%E8%B0%83%E7%94%A8%E8%BF%99%E4%B8%80%E6%AE%B5BPF%E4%BB%A3%E7%A0%81%EF%BC%8C%E6%9D%A5%E8%8E%B7%E5%BE%97%E8%BF%87%E6%BB%A4%E7%9A%84%E7%BB%93%E6%9E%9C%E3%80%82%0A%0A%23%23%20%E6%80%BB%E7%BB%93%0Aseccomp%E6%98%AF%E5%86%85%E6%A0%B8%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%80%E7%A7%8DSYSCALL%E8%BF%87%E6%BB%A4%E6%9C%BA%E5%88%B6%EF%BC%8C%E5%AE%83%E5%9F%BA%E4%BA%8EBPF%E8%BF%87%E6%BB%A4%E6%96%B9%E6%B3%95%EF%BC%8C%E9%80%9A%E8%BF%87%E5%86%99%E5%85%A5BPF%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BB%A3%E7%A0%81%E6%9D%A5%E8%BE%BE%E5%88%B0%E8%BF%87%E6%BB%A4%E7%9A%84%E7%9B%AE%E7%9A%84%E3%80%82BPF%E8%A7%84%E5%88%99%E8%AF%AD%E8%A8%80%E5%8E%9F%E7%94%9F%E6%98%AF%E4%B8%BA%E4%BA%86%E8%BF%87%E6%BB%A4%E7%BD%91%E7%BB%9C%E5%8C%85%EF%BC%8C%E6%83%85%E6%99%AF%E6%AF%94%E8%BE%83%E5%A4%8D%E6%9D%82%E3%80%82%E9%92%88%E5%AF%B9SYSCALL%E5%9C%BA%E6%99%AF%EF%BC%8C%E8%AF%AD%E6%B3%95%E6%AF%94%E8%BE%83%E5%9B%BA%E5%AE%9A%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8C%E6%92%B0%E5%86%99%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9F%BA%E4%BA%8ELibseccomp%E5%BA%93%E6%8F%90%E4%BE%9B%E7%9A%84API%E6%9D%A5%E7%BC%96%E5%86%99%E3%80%82%0A%E5%9B%A0%E4%B8%BA%E7%A8%8B%E5%BA%8F%E5%9C%A8fork%2Fclone%E6%88%96execve%E6%97%B6%EF%BC%8CBPF%20filter%E4%BC%9A%E4%BB%8E%E7%88%B6%E8%BF%9B%E7%A8%8B%E7%BB%A7%E6%89%BF%E5%88%B0%E5%AD%90%E8%BF%9B%E7%A8%8B%EF%BC%8C%E6%89%80%E4%BB%A5%E5%A6%82%E6%9E%9C%E6%83%B3%E6%8E%A7%E5%88%B6%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9A%84%E7%A8%8B%E5%BA%8F%E8%B0%83%E7%94%A8SYSCALL%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E5%9C%A8fork%2Fclone%E6%88%96%E8%80%85execve%E6%97%B6%EF%BC%8C%E4%BC%A0%E5%85%A5%E5%90%88%E9%80%82%E7%9A%84sock_filter%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%23%23%20%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%0A1.%20%5Blinux%E4%B8%AD%E7%9A%84%E5%AE%B9%E5%99%A8%E4%B8%8E%E6%B2%99%E7%AE%B1%E5%88%9D%E6%8E%A2%5D(http%3A%2F%2Fatum.li%2F2017%2F04%2F25%2Flinuxsandbox%2F%23linux%25E4%25B8%25AD%25E7%259A%2584%25E6%25B2%2599%25E7%25AE%25B1%25E6%258A%2580%25E6%259C%25AF)%0A2.%20%5BUsing%20simple%20seccomp%20filters%5D(https%3A%2F%2Foutflux.net%2Fteach-seccomp%2F)%0A3.%20%5BA%20seccomp%20overview%5D(https%3A%2F%2Flwn.net%2FArticles%2F656307%2F)%0A4.%20%5Bseccomp%E7%9A%84%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3%5D(https%3A%2F%2Fwww.kernel.org%2Fdoc%2Fhtml%2Flatest%2Fuserspace-api%2Fseccomp_filter.html)%E3%80%82%0A5.%20%5Bkernel%20doc%20-%20Seccomp%20BPF%20(SECure%20COMPuting%20with%20filters)%5D(https%3A%2F%2Fwww.kernel.org%2Fdoc%2Fhtml%2Flatest%2Fuserspace-api%2Fseccomp_filter.html)%0A6.%20%5BAndroid%E4%B8%AD%E7%9A%84seccomp%5D(https%3A%2F%2Fwww.jianshu.com%2Fp%2F62ede45cfb2e)&lt;/center&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2019/02/22/tmux_+_vim%E7%9A%84%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/</guid>
            <title>tmux + vim的复制配置</title>
            <link>https://blog.zhougy.top/2019/02/22/tmux_+_vim%E7%9A%84%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/</link>
            <category>Linux</category>
            <category>vim</category>
            <category>tmux</category>
            <pubDate>Fri, 22 Feb 2019 06:52:36 +0800</pubDate>
            <description><![CDATA[ &lt;div style=&#34;font-size: 14px; margin: 0; padding: 0; width: 100%;&#34;&gt;&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x505A;&amp;#x5D4C;&amp;#x5165;&amp;#x5F0F;&amp;#x7684;&amp;#x540C;&amp;#x5B66;&amp;#xFF0C;&amp;#x5927;&amp;#x591A;&amp;#x5728;Linux&amp;#x73AF;&amp;#x5883;&amp;#x4E0B;&amp;#x5F00;&amp;#x53D1;&amp;#x3002;&amp;#x73B0;&amp;#x5728;&amp;#x4E5F;&amp;#x6709;&amp;#x5F88;&amp;#x591A;&amp;#x540C;&amp;#x5B66;&amp;#x7528;OSX&amp;#x5F00;&amp;#x53D1;&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x4EEC;&amp;#x90FD;&amp;#x662F;&amp;#x7C7B;Unix&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&amp;#x4F5C;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F00;&amp;#x53D1;&amp;#x8005;&amp;#xFF0C;&amp;#x6548;&amp;#x7387;&amp;#x5F88;&amp;#x91CD;&amp;#x8981;&amp;#x3002;&amp;#x6709;&amp;#x5F88;&amp;#x591A;&amp;#x91CD;&amp;#x590D;&amp;#x7410;&amp;#x788E;&amp;#x7684;&amp;#x52A8;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x80FD;&amp;#x63D0;&amp;#x9AD8;&amp;#x4E00;&amp;#x70B9;&amp;#x6548;&amp;#x7387;&amp;#xFF0C;&amp;#x591A;&amp;#x6B21;&amp;#x7D2F;&amp;#x79EF;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x8282;&amp;#x7701;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x548C;&amp;#x7CBE;&amp;#x529B;&amp;#x4E5F;&amp;#x662F;&amp;#x53EF;&amp;#x89C2;&amp;#x7684;&amp;#x3002;&amp;#x5728;&amp;#x63D0;&amp;#x5347;&amp;#x6548;&amp;#x7387;&amp;#x7684;&amp;#x540C;&amp;#x65F6;&amp;#xFF0C;&amp;#x505A;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x6709;&amp;#x6548;&amp;#x7387;&amp;#xFF0C;&amp;#x800C;&amp;#x907F;&amp;#x514D;&amp;#x7410;&amp;#x788E;&amp;#x91CD;&amp;#x590D;&amp;#x7684;&amp;#x52A8;&amp;#x4F5C;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5F88;&amp;#x6709;&amp;#x52A9;&amp;#x4E8E;&amp;#x5FC3;&amp;#x60C5;&amp;#x7684;&amp;#x6109;&amp;#x60A6;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#xFF0C;&amp;#x4F46;&amp;#x51E1;&amp;#x6709;&amp;#x673A;&amp;#x4F1A;&amp;#xFF0C;&amp;#x6211;&amp;#x90FD;&amp;#x4F1A;&amp;#x7ED9;&amp;#x522B;&amp;#x4EBA;&amp;#x5B89;&amp;#x5229;&amp;#x4E00;&amp;#x4E9B;&amp;#x597D;&amp;#x7528;&amp;#x7684;&amp;#x5DE5;&amp;#x5177;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;tmux&amp;#xFF0C;vim&amp;#xFF0C;fish&amp;#x554A;&amp;#xFF0C;&amp;#x7B49;&amp;#x7B49;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6709;&amp;#x4EBA;&amp;#x79F0;tmux, zsh, vim&amp;#x662F;&amp;#x6587;&amp;#x672C;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x4E09;&amp;#x5251;&amp;#x5BA2;&amp;#x3002;&amp;#x8FD9;&amp;#x4E09;&amp;#x4E2A;&amp;#x5DE5;&amp;#x5177;&amp;#x7528;&amp;#x597D;&amp;#x4E86;&amp;#x786E;&amp;#x5B9E;&amp;#x597D;&amp;#x7528;&amp;#x3002;&amp;#x6211;&amp;#x76EE;&amp;#x524D;&amp;#x7684;&amp;#x5F00;&amp;#x53D1;&amp;#x73AF;&amp;#x5883;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x662F;fish + tmux + vim&amp;#x3002;fish&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x548C;zsh&amp;#x5DEE;&amp;#x4E0D;&amp;#x591A;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x60F3;&amp;#x7740;&amp;#x91CD;&amp;#x4ECB;&amp;#x7ECD;&amp;#x7684;&amp;#x662F;&amp;#x56F0;&amp;#x6270;&amp;#x6211;&amp;#x5F88;&amp;#x591A;&amp;#x5E74;&amp;#x7684;tmux + vim&amp;#x7684;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&lt;/p&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;tmux&amp;#x4E0B;&amp;#x7684;&amp;#x590D;&amp;#x5236;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5728;&amp;#x6BD5;&amp;#x4E1A;&amp;#x540E;&amp;#x7684;&amp;#x82E5;&amp;#x5E72;&amp;#x5E74;&amp;#x5185;&amp;#xFF0C;&amp;#x6211;&amp;#x4E00;&amp;#x76F4;&amp;#x5728;Windows&amp;#x4E0B;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;putty + ssh +tmux&amp;#x8FDE;&amp;#x63A5;&amp;#x8FDC;&amp;#x7AEF;&amp;#x7684;Linux&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#x505A;&amp;#x5F00;&amp;#x53D1;&amp;#x3002;&amp;#x597D;&amp;#x5904;&amp;#x662F;&amp;#xFF0C;tmux&amp;#x53EF;&amp;#x4EE5;&amp;#x505A;session&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x5373;&amp;#x4FBF;putty ssh&amp;#x5173;&amp;#x95ED;&amp;#xFF0C;&amp;#x4EFB;&amp;#x52A1;&amp;#x4E0D;&amp;#x4F1A;&amp;#x4E2D;&amp;#x65AD;&amp;#x3002;&amp;#x53EA;&amp;#x8981;&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#x4E0D;&amp;#x5173;&amp;#x95ED;&amp;#xFF0C;&amp;#x4E0B;&amp;#x6B21;&amp;#x6253;&amp;#x5F00;&amp;#x4ECD;&amp;#x7136;&amp;#x53EF;&amp;#x4EE5;&amp;#x5FEB;&amp;#x901F;&amp;#x6062;&amp;#x590D;&amp;#x5DE5;&amp;#x4F5C;&amp;#x73B0;&amp;#x573A;&amp;#x3002;&lt;/p&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;tmux&amp;#x5206;&amp;#x5C4F;&amp;#x6A21;&amp;#x5F0F;&amp;#x4E0B;&amp;#x7684;&amp;#x6587;&amp;#x672C;&amp;#x9009;&amp;#x4E2D;&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;tmux&amp;#x4E2D;&amp;#x7684;panel&amp;#x5728;&amp;#x591A;&amp;#x4EFB;&amp;#x52A1;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x975E;&amp;#x5E38;&amp;#x597D;&amp;#x7528;&amp;#x3002;&amp;#x4F46;&amp;#x5E26;&amp;#x6765;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x662F;&amp;#xFF0C;&amp;#x5F53;tmux&amp;#x6709;&amp;#x6A2A;&amp;#x5411;&amp;#x5206;&amp;#x5C4F;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x590D;&amp;#x5236;&amp;#x597D;&amp;#x56F0;&amp;#x96BE;&amp;#x3002;&amp;#x6587;&amp;#x672C;&amp;#x7684;&amp;#x9009;&amp;#x4E2D;&amp;#x4F1A;&amp;#x8DE8;&amp;#x8D8A;panel&amp;#x8FB9;&amp;#x754C;&amp;#xFF08;&amp;#x56FE;&amp;#x622A;&amp;#x4E0D;&amp;#x51FA;&amp;#x6765;&amp;#xFF0C;&amp;#x76F8;&amp;#x4FE1;&amp;#x4F7F;&amp;#x7528;tmux&amp;#x7684;&amp;#x65B0;&amp;#x624B;&amp;#x540C;&amp;#x5B66;&amp;#xFF0C;&amp;#x5E94;&amp;#x8BE5;&amp;#x90FD;&amp;#x9047;&amp;#x5230;&amp;#x8FC7;&amp;#x8FD9;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#xFF09;&amp;#x3002;&amp;#x89E3;&amp;#x51B3;&amp;#x7684;&amp;#x529E;&amp;#x6CD5;&amp;#x662F;&amp;#xFF0C;&amp;#x6253;&amp;#x5F00;tmux&amp;#x7684;&amp;#x9F20;&amp;#x6807;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;set-option -g mouse on
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6B64;&amp;#x65F6;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x901A;&amp;#x8FC7;&amp;#x9F20;&amp;#x6807;&amp;#x9009;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x8DE8;&amp;#x8D8A;&amp;#x5206;&amp;#x5C4F;&amp;#x8FB9;&amp;#x754C;&amp;#x3002;&amp;#x600E;&amp;#x4E48;&amp;#x590D;&amp;#x5236;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x65B0;&amp;#x624B;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x53C8;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&lt;/p&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;vim&amp;#x7528;:vsplit&amp;#x547D;&amp;#x4EE4;&amp;#x5206;&amp;#x5C4F;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4E5F;&amp;#x6709;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x89E3;&amp;#x51B3;&amp;#x65B9;&amp;#x6CD5;&amp;#x5982;&amp;#x51FA;&amp;#x4E00;&amp;#x8F99;&amp;#xFF0C;&amp;#x4F7F;&amp;#x80FD;&amp;#x9F20;&amp;#x6807;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF0C;set mouse=a&amp;#x3002;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;tmux&amp;#x590D;&amp;#x5236;&amp;#x6A21;&amp;#x5F0F;&amp;#x4E0B;&amp;#x7684;&amp;#x590D;&amp;#x5236;&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;tmux&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x64CD;&amp;#x4F5C;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;bind-key&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&amp;#x672C;&amp;#x8EAB;&amp;#x6709;&amp;#x4E00;&amp;#x5957;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;bind-key table&amp;#xFF0C;&amp;#x5F53;&amp;#x7136;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x81EA;&amp;#x5B9A;&amp;#x4E49;&amp;#xFF0C;tmux&amp;#x63D2;&amp;#x4EF6;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x5E2E;&amp;#x4F60;&amp;#x5B9A;&amp;#x4E49;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x81EA;&amp;#x884C;&amp;#x67E5;bind-key table&amp;#x3002;&amp;#x65B9;&amp;#x6CD5;&amp;#x662F;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x901A;&amp;#x8FC7;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;ctrl + [:&lt;/code&gt;&amp;#x8FDB;&amp;#x5165;tmux&amp;#x547D;&amp;#x4EE4;&amp;#x6A21;&amp;#x5F0F;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x6267;&amp;#x884C;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;list-keys&lt;/code&gt;&amp;#x547D;&amp;#x4EE4;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x4E86;&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#x8F83;&amp;#x65B0;&amp;#x7684;tmux &amp;#x4E2D;&amp;#x7684;bind-key table&amp;#x8F83;&amp;#x8001;&amp;#x7248;&amp;#x672C;&amp;#x7684;&amp;#x5B8C;&amp;#x5168;&amp;#x4E0D;&amp;#x540C;&amp;#x3002;&amp;#x4F8B;&amp;#x5982;&amp;#x7B14;&amp;#x8005;&amp;#x5F53;&amp;#x524D;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x6700;&amp;#x65B0;release&amp;#x7248;tmux2.8&amp;#xFF0C;&amp;#x800C;Ubuntu 16.04 LTS&amp;#x7248;&amp;#x672C;&amp;#x6E90;&amp;#x4E2D;&amp;#x81EA;&amp;#x5E26;&amp;#x7684;&amp;#x662F;tmux 2.1&amp;#x3002;&amp;#x636E;&amp;#x8BF4;tmux&amp;#x4E2D;&amp;#x95F4;&amp;#x8FDB;&amp;#x884C;&amp;#x8FC7;&amp;#x91CD;&amp;#x6784;&amp;#xFF0C;&amp;#x5BFC;&amp;#x81F4;&amp;#x5F88;&amp;#x591A;&amp;#x529F;&amp;#x80FD;&amp;#x5176;&amp;#x5B9E;&amp;#x5E76;&amp;#x4E0D;&amp;#x517C;&amp;#x5BB9;&amp;#x8001;&amp;#x7248;&amp;#x672C;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x63A8;&amp;#x8350;&amp;#x4F7F;&amp;#x7528;&amp;#x65B0;&amp;#x7248;&amp;#x672C;&amp;#x3002;&lt;/p&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0;&#34;&gt;Ubuntu 16.04 LTS&amp;#x7248;&amp;#x672C;&amp;#x7684;&amp;#x6E90;&amp;#x4E2D;&amp;#x81EA;&amp;#x5E26;&amp;#x7684;tmux&amp;#x662F;2.1&amp;#x7684;&amp;#x3002;&amp;#x8FD9;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;&amp;#x5F88;&amp;#x591A;&amp;#x529F;&amp;#x80FD;&amp;#x6CA1;&amp;#x6CD5;&amp;#x4F7F;&amp;#x7528;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;# tmux 2.8 list-keys
bind-key    -T copy-mode    C-Space           send-keys -X begin-selection
bind-key    -T copy-mode    C-a               send-keys -X start-of-line
bind-key    -T copy-mode    C-b               send-keys -X cursor-left
bind-key    -T copy-mode    C-c               send-keys -X cancel
bind-key    -T copy-mode    C-e               send-keys -X end-of-line
bind-key    -T copy-mode    C-f               send-keys -X cursor-right
bind-key    -T copy-mode    C-g               send-keys -X clear-selection
bind-key    -T copy-mode    C-k               send-keys -X copy-end-of-line
bind-key    -T copy-mode    C-n               send-keys -X cursor-down
bind-key    -T copy-mode    C-p               send-keys -X cursor-up

# tmux 2.1 list-keys
bind-key        C-b send-prefix                                                     
bind-key        C-o rotate-window
bind-key        C-z suspend-client
bind-key      Space next-layout
bind-key          ! break-pane
bind-key          &amp;quot; split-window
bind-key          # list-buffers
bind-key          $ command-prompt -I #S &amp;quot;rename-session &amp;apos;%%&amp;apos;&amp;quot;
bind-key          % split-window -h
bind-key          &amp;amp; confirm-before -p &amp;quot;kill-window #W? (y/n)&amp;quot; kill-window
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x662F;&amp;#x4E0D;&amp;#x662F;&amp;#x5F88;&amp;#x4E0D;&amp;#x4E00;&amp;#x6837;&amp;#xFF1F;&amp;#x8BF7;&amp;#x81EA;&amp;#x884C;&amp;#x5FFD;&amp;#x7565;2.1&amp;#x7248;&amp;#x672C;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;2.8&amp;#x4E2D;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x884C;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD0;&amp;#x884C;&amp;#x7684;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;bind-key&amp;#x547D;&amp;#x4EE4;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53C2;&amp;#x6570;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;a href=&#34;http://man.openbsd.org/OpenBSD-current/man1/tmux.1&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;tmux man page&lt;/a&gt;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;-T: &amp;#x6307;&amp;#x5B9A;&amp;#x8868;&amp;#x683C;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;-r: &amp;#x6307;&amp;#x5B9A;&amp;#x8BE5;&amp;#x6309;&amp;#x952E;&amp;#x53EF;&amp;#x4EE5;repeat&amp;#x3002;&amp;#x4F8B;&amp;#x5982;&amp;#x8C03;&amp;#x6574;panel&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x4F60;&amp;#x4E0D;&amp;#x60F3;&amp;#x6BCF;&amp;#x653E;&amp;#x5927;&amp;#x7F29;&amp;#x5C0F;&amp;#x4E00;&amp;#x6B21;&amp;#x90FD;&amp;#x8981;&amp;#x6309;prefix&amp;#x5427;&amp;#xFF0C;&amp;#x90A3;&amp;#x4F1A;&amp;#x6293;&amp;#x72C2;&amp;#x7684;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-bottom: 0;&#34;&gt;copy-mode&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5177;&amp;#x4F53;table&amp;#xFF0C;&amp;#x5728;&amp;#x4F60;&amp;#x6309;&amp;#x4E0B;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;ctrl + [&lt;/code&gt;&amp;#x8FDB;&amp;#x5165;&amp;#x590D;&amp;#x5236;&amp;#x6A21;&amp;#x5F0F;&amp;#x65F6;&amp;#x751F;&amp;#x6548;&amp;#x3002;&amp;#x540C;&amp;#x7406;&amp;#x8FD8;&amp;#x6709;&amp;#x4E2A;&amp;#x53EB;prefix&amp;#x7684;table&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x666E;&amp;#x901A;&amp;#x6A21;&amp;#x5F0F;&amp;#x4E0B;&amp;#x7684;&amp;#x6309;&amp;#x952E;&amp;#x8868;&amp;#x3002;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8BDD;&amp;#x8BF4;&amp;#x8FD9;&amp;#x4E48;&amp;#x591A;&amp;#xFF0C;&amp;#x5230;&amp;#x5E95;&amp;#x600E;&amp;#x4E48;&amp;#x590D;&amp;#x5236;&amp;#xFF1F;&amp;#x641C;&amp;#x7D22;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8868;&amp;#x683C;&amp;#x7684;&amp;#x662F;&amp;#x5426;&amp;#x6709;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;copy-selection&lt;/code&gt;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x4E86;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x901A;&amp;#x5E38;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;Enter&lt;/code&gt;&amp;#x4F1A;&amp;#x88AB;&amp;#x6620;&amp;#x5C04;&amp;#x6210;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;send-keys -X copy-selection-and-cancel&lt;/code&gt;&amp;#x3002;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&lt;strong style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700;&#34;&gt;&amp;#x6309;&amp;#x4E0B;Enter&amp;#xFF0C;&amp;#x9009;&amp;#x4E2D;&amp;#x7684;&amp;#x6587;&amp;#x5B57;&amp;#x4F1A;&amp;#x88AB;&amp;#x590D;&amp;#x5236;&amp;#x5230;tmux&amp;#x526A;&amp;#x8D34;&amp;#x677F;&lt;/strong&gt;&amp;#x3002;&lt;/p&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;tmux&amp;#x4E0B;&amp;#x590D;&amp;#x5236;&amp;#x5230;Windows&amp;#x526A;&amp;#x8D34;&amp;#x677F;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x624D;&amp;#x662F;&amp;#x672C;&amp;#x7BC7;&amp;#x60F3;&amp;#x8BF4;&amp;#x7684;&amp;#x8BDD;&amp;#x9898;&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x6211;&amp;#x82B1;&amp;#x4E86;&amp;#x597D;&amp;#x4E9B;&amp;#x5E74;&amp;#x624D;&amp;#x627E;&amp;#x5230;&amp;#x7B54;&amp;#x6848;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x53EF;&amp;#x89C1;&amp;#x7ECF;&amp;#x9A8C;&amp;#x7684;&amp;#x4F20;&amp;#x627F;&amp;#x662F;&amp;#x591A;&amp;#x4E48;&amp;#x91CD;&amp;#x8981;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x5148;&amp;#x8BF4;&amp;#x600E;&amp;#x4E48;&amp;#x505A;&amp;#xFF0C;&amp;#x518D;&amp;#x8BF4;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x3002;&lt;/p&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;&amp;#x5982;&amp;#x4F55;&amp;#x505A;&amp;#xFF1F;&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x9996;&amp;#x5148;&amp;#x5355;&amp;#x7EAF;&amp;#x9760;putty&amp;#x662F;&amp;#x6CA1;&amp;#x529E;&amp;#x6CD5;&amp;#x7684;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;putty&amp;#x53EA;&amp;#x662F;&amp;#x5355;&amp;#x7EAF;&amp;#x7684;terminal emulator&amp;#x3002;&amp;#x800C;Linux&amp;#x7684;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x7BA1;&amp;#x7406;&amp;#x662F;&amp;#x9700;&amp;#x8981;X-Window&amp;#x652F;&amp;#x6301;&amp;#x7684;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x4F60;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5B8C;&amp;#x6574;&amp;#x7684;X11 forwarding&amp;#x7684;&amp;#x73AF;&amp;#x5883;&amp;#x3002;X11 forwarding&amp;#x6709;&amp;#x5F88;&amp;#x591A;&amp;#x9014;&amp;#x5F84;&amp;#x53EF;&amp;#x4EE5;&amp;#x505A;&amp;#x5230;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x81EA;&amp;#x884C;google&amp;#xFF0C;&amp;#x7B14;&amp;#x8005;&amp;#x9009;&amp;#x62E9;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;turn key solution&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5B89;&amp;#x88C5;&lt;a href=&#34;https://mobaxterm.mobatek.net/&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;MobaXTerm&lt;/a&gt;&amp;#x3002;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;&amp;#x914D;&amp;#x7F6E;&amp;#x5C31;&amp;#x5DF2;&amp;#x7ECF;&amp;#x4F7F;&amp;#x80FD;X11 server&amp;#x548C;X11 forwarding&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x63A5;&amp;#x4E0B;&amp;#x6765;&amp;#xFF0C;&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x786E;&amp;#x5B9A;&amp;#x4F60;&amp;#x7684;Linux&amp;#x7CFB;&amp;#x7EDF;&amp;#x91CC;&amp;#x6709;X11&amp;#x754C;&amp;#x9762;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x8BF7;&amp;#x81EA;&amp;#x884C;google&amp;#x5B89;&amp;#x88C5;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x786E;&amp;#x5B9A;&amp;#x4F60;&amp;#x7684;Linux&amp;#x7CFB;&amp;#x7EDF;&amp;#x91CC;&amp;#x6709;xclip, xsel&amp;#x6216;xclipboard&amp;#x4E09;&amp;#x8005;&amp;#x4E4B;&amp;#x4E00;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x4F60;&amp;#x7684;DISPLAY&amp;#x53D8;&amp;#x91CF;&amp;#x5728;tmux&amp;#x4E0B;&amp;#x4E0D;&amp;#x6B63;&amp;#x5E38;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x5728;.tmux.conf&amp;#x4E0B;&amp;#x6DFB;&amp;#x52A0;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;set -g update-environment &amp;quot;\
    DISPLAY \
    &amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;bind-key -T copy-mode y send-keys -X copy-pipe-and-cancel &amp;quot;xsel -i --clipboard&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x6B65;&amp;#x66F4;&amp;#x4F18;&amp;#x96C5;&amp;#x7684;&amp;#x89E3;&amp;#x51B3;&amp;#x65B9;&amp;#x6CD5;&amp;#x662F;&amp;#x5B89;&amp;#x88C5;&lt;a href=&#34;https://github.com/tmux-plugins/tmux-yank&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;tmux-yank&lt;/a&gt;&amp;#x63D2;&amp;#x4EF6;&amp;#x3002;&lt;/p&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x8FD9;&amp;#x4E48;&amp;#x505A;&amp;#xFF1F;&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Linux&amp;#x7684;&amp;#x684C;&amp;#x9762;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7BA1;&amp;#x7406;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x4F9D;&amp;#x8D56;&amp;#x4E8E;X Window&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x7531;&amp;#x524D;&amp;#x8FF0;&amp;#x7684;&amp;#x51E0;&amp;#x79CD;app&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;Windows&amp;#x4E0B;&amp;#x7684;clip.exe&amp;#x3002;&amp;#x5F53;&amp;#x5728;Windows&amp;#x4E0B;&amp;#x7528;ssh&amp;#x8FDE;&amp;#x63A5;Linux&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x672A;&amp;#x8BBE;&amp;#x7F6E;X11 forwarding&amp;#xFF0C;&amp;#x5219;&amp;#x5728;Windows&amp;#x4E0B;&amp;#x662F;&amp;#x65E0;&amp;#x6CD5;&amp;#x4F7F;&amp;#x7528;&amp;#x5230;xsel&amp;#xFF0C;xclip&amp;#x6216;&amp;#x8005;xclipboard&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x65E0;&amp;#x6CD5;&amp;#x8BBF;&amp;#x95EE;Linux&amp;#x7684;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x5185;&amp;#x5BB9;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x8BBE;&amp;#x7F6E;&amp;#x597D;&amp;#x4E86;X11 forwarding&amp;#xFF0C;&amp;#x5219;&amp;#x5728;Windows&amp;#x4E0B;&amp;#x5C31;&amp;#x80FD;&amp;#x8BBF;&amp;#x95EE;Linux&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;tmux&amp;#x672C;&amp;#x8EAB;&amp;#x4E5F;&amp;#x7BA1;&amp;#x7406;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#xFF0C;&amp;#x79F0;&amp;#x4E3A;buffer&amp;#x3002;tmux&amp;#x7684;&amp;#x547D;&amp;#x4EE4;copy-selection, paste-buffer, list-buffers&amp;#x5C31;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;tmux&amp;#x81EA;&amp;#x8EAB;&amp;#x7684;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;tmux&amp;#x539F;&amp;#x751F;&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x7A7A;&amp;#x683C;&amp;#x9009;&amp;#x4E2D;&amp;#xFF0C;Enter&amp;#x590D;&amp;#x5236;&amp;#xFF0C;ctrl + ] &amp;#x7C98;&amp;#x8D34;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x60F3;tmux&amp;#x4E0B;&amp;#x5C06;&amp;#x7EC8;&amp;#x7AEF;&amp;#x663E;&amp;#x793A;&amp;#x5185;&amp;#x5BB9;&amp;#x590D;&amp;#x5236;&amp;#x5230;Windows&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x628A;tmux&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x53D1;&amp;#x9001;&amp;#x5230;X11&amp;#x7684;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x4E2D;&amp;#x3002;tmux-yank&amp;#x63D2;&amp;#x4EF6;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x8FD9;&amp;#x4EF6;&amp;#x4E8B;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x4F60;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x5728;copy-mode-vi&amp;#x8868;&amp;#x683C;&amp;#x91CC;&amp;#x7ED1;&amp;#x5B9A;&amp;#x4EFB;&amp;#x4F55;&amp;#x6309;&amp;#x952E;&amp;#x6765;&amp;#x505A;&amp;#x8FD9;&amp;#x4EF6;&amp;#x4E8B;&amp;#x60C5;&amp;#x3002;&lt;/p&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;vim&amp;#x590D;&amp;#x5236;&amp;#x5230;Windows&amp;#x526A;&amp;#x8D34;&amp;#x677F;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6CA1;&amp;#x6709;&amp;#x8FD0;&amp;#x884C;&amp;#x5728;tmux&amp;#x4E0B;&amp;#x7684;vim&amp;#x6216;&amp;#x662F;gvim&amp;#x8981;&amp;#x590D;&amp;#x5236;&amp;#x5230;Windows&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x8BF4;&amp;#x662F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#xFF0C;&amp;#x4F9D;&amp;#x8D56;&amp;#x7684;&amp;#x662F;vim&amp;#x7684;&amp;#x5BC4;&amp;#x5B58;&amp;#x5668;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x53EF;&amp;#x4EE5;&amp;#x81EA;&amp;#x884C;google&amp;#x3002;&amp;#x7CFB;&amp;#x7EDF;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;vim&amp;#x5BC4;&amp;#x5B58;&amp;#x5668;&amp;#x662F;&amp;quot;+&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x5728;vim&amp;#x4E0B;&amp;#x5982;&amp;#x679C;&amp;#x60F3;&amp;#x590D;&amp;#x5236;&amp;#x5230;&amp;#x7CFB;&amp;#x7EDF;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#xFF0C;&amp;#x4F60;&amp;#x53EF;&amp;#x4EE5;&amp;#x7528;&amp;quot;+y&amp;#x6765;&amp;#x53D6;&amp;#x4EE3;&amp;#x5E73;&amp;#x65F6;&amp;#x5E38;&amp;#x7528;&amp;#x7684;y&amp;#x3002;&amp;#x4F8B;&amp;#x5982;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;quot;+yy&amp;#xFF1A;&amp;#x590D;&amp;#x5236;&amp;#x5F53;&amp;#x524D;&amp;#x884C;&amp;#x5230;&amp;#x7CFB;&amp;#x7EDF;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;quot;+yw&amp;#xFF1A;&amp;#x590D;&amp;#x5236;&amp;#x5F53;&amp;#x524D;&amp;#x7684;&amp;#x5355;&amp;#x8BCD;&amp;#x5230;&amp;#x7CFB;&amp;#x7EDF;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;vim&amp;#x8FD0;&amp;#x884C;&amp;#x5728;tmux&amp;#x4E0B;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;tmux&amp;#x81EA;&amp;#x5E26;&amp;#x7684;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x5C31;&amp;#x6709;&amp;#x70B9;&amp;#x9EBB;&amp;#x70E6;&amp;#x4E86;&amp;#x3002;&amp;#x8FD9;&amp;#x65F6;&amp;#x5019;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x63D2;&amp;#x4EF6;&amp;#x5C31;&amp;#x6BD4;&amp;#x8F83;&amp;#x6709;&amp;#x7528;&amp;#x4E86;&amp;#x2014;&amp;#x2014;&lt;a href=&#34;https://github.com/roxma/vim-tmux-clipboard&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;vim-tmux-clipboard&lt;/a&gt;&amp;#x3002;&amp;#x4ED6;&amp;#x4F9D;&amp;#x8D56;&amp;#x4E8E;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;vim&amp;#x63D2;&amp;#x4EF6;&lt;a href=&#34;https://github.com/tmux-plugins/vim-tmux-focus-events&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;vim-tmux-focus-events&lt;/a&gt;&amp;#x3002;&amp;#x88C5;&amp;#x597D;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x63D2;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5728;.tmux.conf&amp;#x4E2D;&amp;#x6DFB;&amp;#x52A0;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;set -g focus-events on
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5927;&amp;#x529F;&amp;#x544A;&amp;#x6210;&amp;#x3002;&amp;#x73B0;&amp;#x5728;&amp;#x5728;vim&amp;#x4E0B;&amp;#xFF0C;&amp;#x76F4;&amp;#x63A5;&amp;#x4F7F;&amp;#x7528;yank&amp;#x5FEB;&amp;#x6377;&amp;#x952E;&amp;#xFF0C;&amp;#x4E0D;&amp;#x7528;&amp;#x6307;&amp;#x5B9A;&amp;#x5BC4;&amp;#x5B58;&amp;#x5668;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x590D;&amp;#x5236;&amp;#x5185;&amp;#x5BB9;&amp;#x5230;tmux&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x56E0;&amp;#x4E3A;tmux-yank&amp;#x7684;&amp;#x5B58;&amp;#x5728;&amp;#xFF0C;&amp;#x6587;&amp;#x672C;&amp;#x4E5F;&amp;#x4F1A;&amp;#x88AB;&amp;#x590D;&amp;#x5236;&amp;#x5230;&amp;#x7CFB;&amp;#x7EDF;&amp;#x526A;&amp;#x8D34;&amp;#x677F;&amp;#x3002;&lt;/p&gt;
&lt;/div&gt;&lt;center style=&#34;display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden&#34;&gt;%E5%81%9A%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%9A%84%E5%90%8C%E5%AD%A6%EF%BC%8C%E5%A4%A7%E5%A4%9A%E5%9C%A8Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%80%E5%8F%91%E3%80%82%E7%8E%B0%E5%9C%A8%E4%B9%9F%E6%9C%89%E5%BE%88%E5%A4%9A%E5%90%8C%E5%AD%A6%E7%94%A8OSX%E5%BC%80%E5%8F%91%E3%80%82%E5%85%B6%E5%AE%9E%E4%BB%96%E4%BB%AC%E9%83%BD%E6%98%AF%E7%B1%BBUnix%E7%B3%BB%E7%BB%9F%E3%80%82%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%BC%80%E5%8F%91%E8%80%85%EF%BC%8C%E6%95%88%E7%8E%87%E5%BE%88%E9%87%8D%E8%A6%81%E3%80%82%E6%9C%89%E5%BE%88%E5%A4%9A%E9%87%8D%E5%A4%8D%E7%90%90%E7%A2%8E%E7%9A%84%E5%8A%A8%E4%BD%9C%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%83%BD%E6%8F%90%E9%AB%98%E4%B8%80%E7%82%B9%E6%95%88%E7%8E%87%EF%BC%8C%E5%A4%9A%E6%AC%A1%E7%B4%AF%E7%A7%AF%E8%B5%B7%E6%9D%A5%EF%BC%8C%E8%8A%82%E7%9C%81%E7%9A%84%E6%97%B6%E9%97%B4%E5%92%8C%E7%B2%BE%E5%8A%9B%E4%B9%9F%E6%98%AF%E5%8F%AF%E8%A7%82%E7%9A%84%E3%80%82%E5%9C%A8%E6%8F%90%E5%8D%87%E6%95%88%E7%8E%87%E7%9A%84%E5%90%8C%E6%97%B6%EF%BC%8C%E5%81%9A%E4%B8%80%E4%B8%AA%E5%BE%88%E6%9C%89%E6%95%88%E7%8E%87%EF%BC%8C%E8%80%8C%E9%81%BF%E5%85%8D%E7%90%90%E7%A2%8E%E9%87%8D%E5%A4%8D%E7%9A%84%E5%8A%A8%E4%BD%9C%EF%BC%8C%E4%B9%9F%E5%BE%88%E6%9C%89%E5%8A%A9%E4%BA%8E%E5%BF%83%E6%83%85%E7%9A%84%E6%84%89%E6%82%A6%E3%80%82%E6%89%80%E4%BB%A5%EF%BC%8C%E4%BD%86%E5%87%A1%E6%9C%89%E6%9C%BA%E4%BC%9A%EF%BC%8C%E6%88%91%E9%83%BD%E4%BC%9A%E7%BB%99%E5%88%AB%E4%BA%BA%E5%AE%89%E5%88%A9%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%EF%BC%8C%E4%BE%8B%E5%A6%82tmux%EF%BC%8Cvim%EF%BC%8Cfish%E5%95%8A%EF%BC%8C%E7%AD%89%E7%AD%89%E3%80%82%0A%0A%E6%9C%89%E4%BA%BA%E7%A7%B0tmux%2C%20zsh%2C%20vim%E6%98%AF%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E7%9A%84%E4%B8%89%E5%89%91%E5%AE%A2%E3%80%82%E8%BF%99%E4%B8%89%E4%B8%AA%E5%B7%A5%E5%85%B7%E7%94%A8%E5%A5%BD%E4%BA%86%E7%A1%AE%E5%AE%9E%E5%A5%BD%E7%94%A8%E3%80%82%E6%88%91%E7%9B%AE%E5%89%8D%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AFfish%20%2B%20tmux%20%2B%20vim%E3%80%82fish%E7%9A%84%E4%BD%9C%E7%94%A8%E5%92%8Czsh%E5%B7%AE%E4%B8%8D%E5%A4%9A%E3%80%82%E6%9C%AC%E6%96%87%E6%83%B3%E7%9D%80%E9%87%8D%E4%BB%8B%E7%BB%8D%E7%9A%84%E6%98%AF%E5%9B%B0%E6%89%B0%E6%88%91%E5%BE%88%E5%A4%9A%E5%B9%B4%E7%9A%84tmux%20%2B%20vim%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E9%97%AE%E9%A2%98%E3%80%82%0A%0A%23%23%20tmux%E4%B8%8B%E7%9A%84%E5%A4%8D%E5%88%B6%0A%0A%E5%9C%A8%E6%AF%95%E4%B8%9A%E5%90%8E%E7%9A%84%E8%8B%A5%E5%B9%B2%E5%B9%B4%E5%86%85%EF%BC%8C%E6%88%91%E4%B8%80%E7%9B%B4%E5%9C%A8Windows%E4%B8%8B%EF%BC%8C%E4%BD%BF%E7%94%A8putty%20%2B%20ssh%20%2Btmux%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%AB%AF%E7%9A%84Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9A%E5%BC%80%E5%8F%91%E3%80%82%E5%A5%BD%E5%A4%84%E6%98%AF%EF%BC%8Ctmux%E5%8F%AF%E4%BB%A5%E5%81%9Asession%E7%AE%A1%E7%90%86%EF%BC%8C%E5%8D%B3%E4%BE%BFputty%20ssh%E5%85%B3%E9%97%AD%EF%BC%8C%E4%BB%BB%E5%8A%A1%E4%B8%8D%E4%BC%9A%E4%B8%AD%E6%96%AD%E3%80%82%E5%8F%AA%E8%A6%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8D%E5%85%B3%E9%97%AD%EF%BC%8C%E4%B8%8B%E6%AC%A1%E6%89%93%E5%BC%80%E4%BB%8D%E7%84%B6%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D%E5%B7%A5%E4%BD%9C%E7%8E%B0%E5%9C%BA%E3%80%82%0A%0A%23%23%23%20tmux%E5%88%86%E5%B1%8F%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%96%87%E6%9C%AC%E9%80%89%E4%B8%AD%0A%0Atmux%E4%B8%AD%E7%9A%84panel%E5%9C%A8%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E9%9D%9E%E5%B8%B8%E5%A5%BD%E7%94%A8%E3%80%82%E4%BD%86%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98%E6%98%AF%EF%BC%8C%E5%BD%93tmux%E6%9C%89%E6%A8%AA%E5%90%91%E5%88%86%E5%B1%8F%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%A4%8D%E5%88%B6%E5%A5%BD%E5%9B%B0%E9%9A%BE%E3%80%82%E6%96%87%E6%9C%AC%E7%9A%84%E9%80%89%E4%B8%AD%E4%BC%9A%E8%B7%A8%E8%B6%8Apanel%E8%BE%B9%E7%95%8C%EF%BC%88%E5%9B%BE%E6%88%AA%E4%B8%8D%E5%87%BA%E6%9D%A5%EF%BC%8C%E7%9B%B8%E4%BF%A1%E4%BD%BF%E7%94%A8tmux%E7%9A%84%E6%96%B0%E6%89%8B%E5%90%8C%E5%AD%A6%EF%BC%8C%E5%BA%94%E8%AF%A5%E9%83%BD%E9%81%87%E5%88%B0%E8%BF%87%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%89%E3%80%82%E8%A7%A3%E5%86%B3%E7%9A%84%E5%8A%9E%E6%B3%95%E6%98%AF%EF%BC%8C%E6%89%93%E5%BC%80tmux%E7%9A%84%E9%BC%A0%E6%A0%87%E6%A8%A1%E5%BC%8F%EF%BC%9A%0A%0A%60%60%60tmux%0Aset-option%20-g%20mouse%20on%0A%60%60%60%0A%0A%E6%AD%A4%E6%97%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%80%9A%E8%BF%87%E9%BC%A0%E6%A0%87%E9%80%89%E4%B8%AD%EF%BC%8C%E5%B0%B1%E4%B8%8D%E4%BC%9A%E8%B7%A8%E8%B6%8A%E5%88%86%E5%B1%8F%E8%BE%B9%E7%95%8C%E3%80%82%E6%80%8E%E4%B9%88%E5%A4%8D%E5%88%B6%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%96%B0%E6%89%8B%E6%9D%A5%E8%AF%B4%EF%BC%8C%E5%8F%88%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E3%80%82%0A%0A%3E%20vim%E7%94%A8%3Avsplit%E5%91%BD%E4%BB%A4%E5%88%86%E5%B1%8F%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%B9%9F%E6%9C%89%E5%90%8C%E6%A0%B7%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E5%A6%82%E5%87%BA%E4%B8%80%E8%BE%99%EF%BC%8C%E4%BD%BF%E8%83%BD%E9%BC%A0%E6%A0%87%E6%A8%A1%E5%BC%8F%EF%BC%8Cset%20mouse%3Da%E3%80%82%0A%0A%23%23%23%20tmux%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E5%A4%8D%E5%88%B6%0A%0Atmux%E7%9A%84%E6%89%80%E6%9C%89%E6%93%8D%E4%BD%9C%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87bind-key%E5%AE%9E%E7%8E%B0%E7%9A%84%E3%80%82%E6%9C%AC%E8%BA%AB%E6%9C%89%E4%B8%80%E5%A5%97%E9%BB%98%E8%AE%A4%E7%9A%84bind-key%20table%EF%BC%8C%E5%BD%93%E7%84%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89%EF%BC%8Ctmux%E6%8F%92%E4%BB%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%B8%AE%E4%BD%A0%E5%AE%9A%E4%B9%89%E3%80%82%E6%89%80%E4%BB%A5%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E6%B8%85%E6%A5%9A%E7%9A%84%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%87%AA%E8%A1%8C%E6%9F%A5bind-key%20table%E3%80%82%E6%96%B9%E6%B3%95%E6%98%AF%EF%BC%9A%0A%0A-%20%E9%80%9A%E8%BF%87%60ctrl%20%2B%20%5B%3A%60%E8%BF%9B%E5%85%A5tmux%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%0A-%20%E6%89%A7%E8%A1%8C%60list-keys%60%E5%91%BD%E4%BB%A4%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%0A%0A%E8%BF%99%E9%87%8C%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%E8%BE%83%E6%96%B0%E7%9A%84tmux%20%E4%B8%AD%E7%9A%84bind-key%20table%E8%BE%83%E8%80%81%E7%89%88%E6%9C%AC%E7%9A%84%E5%AE%8C%E5%85%A8%E4%B8%8D%E5%90%8C%E3%80%82%E4%BE%8B%E5%A6%82%E7%AC%94%E8%80%85%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%80%E6%96%B0release%E7%89%88tmux2.8%EF%BC%8C%E8%80%8CUbuntu%2016.04%20LTS%E7%89%88%E6%9C%AC%E6%BA%90%E4%B8%AD%E8%87%AA%E5%B8%A6%E7%9A%84%E6%98%AFtmux%202.1%E3%80%82%E6%8D%AE%E8%AF%B4tmux%E4%B8%AD%E9%97%B4%E8%BF%9B%E8%A1%8C%E8%BF%87%E9%87%8D%E6%9E%84%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%BE%88%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%85%B6%E5%AE%9E%E5%B9%B6%E4%B8%8D%E5%85%BC%E5%AE%B9%E8%80%81%E7%89%88%E6%9C%AC%E3%80%82%E6%89%80%E4%BB%A5%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%96%B0%E7%89%88%E6%9C%AC%E3%80%82%0A%0A%3E%20Ubuntu%2016.04%20LTS%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E4%B8%AD%E8%87%AA%E5%B8%A6%E7%9A%84tmux%E6%98%AF2.1%E7%9A%84%E3%80%82%E8%BF%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E5%BE%88%E5%A4%9A%E5%8A%9F%E8%83%BD%E6%B2%A1%E6%B3%95%E4%BD%BF%E7%94%A8%0A%3E%0A%3E%20%60%60%60tmux%0A%3E%20%23%20tmux%202.8%20list-keys%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-Space%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20begin-selection%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20start-of-line%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-left%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-c%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cancel%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20end-of-line%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-f%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-right%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-g%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20clear-selection%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-k%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20copy-end-of-line%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-n%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-down%0A%3E%20bind-key%20%20%20%20-T%20copy-mode%20%20%20%20C-p%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20send-keys%20-X%20cursor-up%0A%3E%20%0A%3E%20%23%20tmux%202.1%20list-keys%0A%3E%20bind-key%20%20%20%20%20%20%20%20C-b%20send-prefix%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%3E%20bind-key%20%20%20%20%20%20%20%20C-o%20rotate-window%0A%3E%20bind-key%20%20%20%20%20%20%20%20C-z%20suspend-client%0A%3E%20bind-key%20%20%20%20%20%20Space%20next-layout%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20!%20break-pane%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%22%20split-window%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%23%20list-buffers%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%24%20command-prompt%20-I%20%23S%20%22rename-session%20&amp;apos;%25%25&amp;apos;%22%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%25%20split-window%20-h%0A%3E%20bind-key%20%20%20%20%20%20%20%20%20%20%26%20confirm-before%20-p%20%22kill-window%20%23W%3F%20(y%2Fn)%22%20kill-window%0A%3E%20%60%60%60%0A%3E%0A%3E%20%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%9F%E8%AF%B7%E8%87%AA%E8%A1%8C%E5%BF%BD%E7%95%A52.1%E7%89%88%E6%9C%AC%E3%80%82%0A%3E%0A%3E%202.8%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%80%E8%A1%8C%E5%85%B6%E5%AE%9E%E8%BF%90%E8%A1%8C%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AAbind-key%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%85%B7%E4%BD%93%E5%8F%82%E6%95%B0%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%5Btmux%20man%20page%5D(http%3A%2F%2Fman.openbsd.org%2FOpenBSD-current%2Fman1%2Ftmux.1)%0A%3E%0A%3E%20-%20-T%3A%20%E6%8C%87%E5%AE%9A%E8%A1%A8%E6%A0%BC%0A%3E%20-%20-r%3A%20%E6%8C%87%E5%AE%9A%E8%AF%A5%E6%8C%89%E9%94%AE%E5%8F%AF%E4%BB%A5repeat%E3%80%82%E4%BE%8B%E5%A6%82%E8%B0%83%E6%95%B4panel%E5%A4%A7%E5%B0%8F%EF%BC%8C%E4%BD%A0%E4%B8%8D%E6%83%B3%E6%AF%8F%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F%E4%B8%80%E6%AC%A1%E9%83%BD%E8%A6%81%E6%8C%89prefix%E5%90%A7%EF%BC%8C%E9%82%A3%E4%BC%9A%E6%8A%93%E7%8B%82%E7%9A%84%E3%80%82%0A%3E%0A%3E%20copy-mode%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E5%85%B7%E4%BD%93table%EF%BC%8C%E5%9C%A8%E4%BD%A0%E6%8C%89%E4%B8%8B%60ctrl%20%2B%20%5B%60%E8%BF%9B%E5%85%A5%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E6%97%B6%E7%94%9F%E6%95%88%E3%80%82%E5%90%8C%E7%90%86%E8%BF%98%E6%9C%89%E4%B8%AA%E5%8F%ABprefix%E7%9A%84table%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%99%AE%E9%80%9A%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%8C%89%E9%94%AE%E8%A1%A8%E3%80%82%0A%0A%E8%AF%9D%E8%AF%B4%E8%BF%99%E4%B9%88%E5%A4%9A%EF%BC%8C%E5%88%B0%E5%BA%95%E6%80%8E%E4%B9%88%E5%A4%8D%E5%88%B6%EF%BC%9F%E6%90%9C%E7%B4%A2%E8%BF%99%E4%B8%AA%E8%A1%A8%E6%A0%BC%E7%9A%84%E6%98%AF%E5%90%A6%E6%9C%89%60copy-selection%60%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%E3%80%82%E6%89%80%E4%BB%A5%E9%80%9A%E5%B8%B8%60Enter%60%E4%BC%9A%E8%A2%AB%E6%98%A0%E5%B0%84%E6%88%90%60send-keys%20-X%20copy-selection-and-cancel%60%E3%80%82%E4%B9%9F%E5%B0%B1%E6%98%AF**%E6%8C%89%E4%B8%8BEnter%EF%BC%8C%E9%80%89%E4%B8%AD%E7%9A%84%E6%96%87%E5%AD%97%E4%BC%9A%E8%A2%AB%E5%A4%8D%E5%88%B6%E5%88%B0tmux%E5%89%AA%E8%B4%B4%E6%9D%BF**%E3%80%82%0A%0A%23%23%20tmux%E4%B8%8B%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%0A%0A%E8%BF%99%E4%B8%AA%E6%89%8D%E6%98%AF%E6%9C%AC%E7%AF%87%E6%83%B3%E8%AF%B4%E7%9A%84%E8%AF%9D%E9%A2%98%E3%80%82%E5%9B%A0%E4%B8%BA%E6%88%91%E8%8A%B1%E4%BA%86%E5%A5%BD%E4%BA%9B%E5%B9%B4%E6%89%8D%E6%89%BE%E5%88%B0%E7%AD%94%E6%A1%88%E3%80%82%E6%89%80%E4%BB%A5%E5%8F%AF%E8%A7%81%E7%BB%8F%E9%AA%8C%E7%9A%84%E4%BC%A0%E6%89%BF%E6%98%AF%E5%A4%9A%E4%B9%88%E9%87%8D%E8%A6%81%E3%80%82%E4%B8%8B%E9%9D%A2%E5%85%88%E8%AF%B4%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%8C%E5%86%8D%E8%AF%B4%E4%B8%BA%E4%BB%80%E4%B9%88%E3%80%82%0A%0A%23%23%23%20%E5%A6%82%E4%BD%95%E5%81%9A%EF%BC%9F%0A%0A%E9%A6%96%E5%85%88%E5%8D%95%E7%BA%AF%E9%9D%A0putty%E6%98%AF%E6%B2%A1%E5%8A%9E%E6%B3%95%E7%9A%84%EF%BC%8C%E5%9B%A0%E4%B8%BAputty%E5%8F%AA%E6%98%AF%E5%8D%95%E7%BA%AF%E7%9A%84terminal%20emulator%E3%80%82%E8%80%8CLinux%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E7%AE%A1%E7%90%86%E6%98%AF%E9%9C%80%E8%A6%81X-Window%E6%94%AF%E6%8C%81%E7%9A%84%E3%80%82%E6%89%80%E4%BB%A5%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84X11%20forwarding%E7%9A%84%E7%8E%AF%E5%A2%83%E3%80%82X11%20forwarding%E6%9C%89%E5%BE%88%E5%A4%9A%E9%80%94%E5%BE%84%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%88%B0%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8Cgoogle%EF%BC%8C%E7%AC%94%E8%80%85%E9%80%89%E6%8B%A9%E4%BA%86%E4%B8%80%E4%B8%AAturn%20key%20solution%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%AE%89%E8%A3%85%5BMobaXTerm%5D(https%3A%2F%2Fmobaxterm.mobatek.net%2F)%E3%80%82%E9%BB%98%E8%AE%A4%E7%9A%84%E9%85%8D%E7%BD%AE%E5%B0%B1%E5%B7%B2%E7%BB%8F%E4%BD%BF%E8%83%BDX11%20server%E5%92%8CX11%20forwarding%E4%BA%86%E3%80%82%0A%0A%E6%8E%A5%E4%B8%8B%E6%9D%A5%EF%BC%8C%E8%A6%81%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%EF%BC%9A%0A%0A-%20%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84Linux%E7%B3%BB%E7%BB%9F%E9%87%8C%E6%9C%89X11%E7%95%8C%E9%9D%A2%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E8%AF%B7%E8%87%AA%E8%A1%8Cgoogle%E5%AE%89%E8%A3%85%0A-%20%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84Linux%E7%B3%BB%E7%BB%9F%E9%87%8C%E6%9C%89xclip%2C%20xsel%E6%88%96xclipboard%E4%B8%89%E8%80%85%E4%B9%8B%E4%B8%80%0A-%20%E5%A6%82%E6%9E%9C%E4%BD%A0%E7%9A%84DISPLAY%E5%8F%98%E9%87%8F%E5%9C%A8tmux%E4%B8%8B%E4%B8%8D%E6%AD%A3%E5%B8%B8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8.tmux.conf%E4%B8%8B%E6%B7%BB%E5%8A%A0%0A%0A%60%60%60tmux%0Aset%20-g%20update-environment%20%22%5C%0A%20%20%20%20DISPLAY%20%5C%0A%20%20%20%20%22%0A%60%60%60%0A%0A-%20bind-key%20-T%20copy-mode%20y%20send-keys%20-X%20copy-pipe-and-cancel%20%22xsel%20-i%20--clipboard%22%0A%0A%E6%9C%80%E5%90%8E%E4%B8%80%E6%AD%A5%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%98%AF%E5%AE%89%E8%A3%85%5Btmux-yank%5D(https%3A%2F%2Fgithub.com%2Ftmux-plugins%2Ftmux-yank)%E6%8F%92%E4%BB%B6%E3%80%82%0A%0A%23%23%23%20%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%99%E4%B9%88%E5%81%9A%EF%BC%9F%0A%0ALinux%E7%9A%84%E6%A1%8C%E9%9D%A2%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%BA%86%E4%B8%80%E4%B8%AA%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%89%AA%E8%B4%B4%E6%9D%BF%E4%BE%9D%E8%B5%96%E4%BA%8EX%20Window%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%B1%E5%89%8D%E8%BF%B0%E7%9A%84%E5%87%A0%E7%A7%8Dapp%E7%AE%A1%E7%90%86%EF%BC%8C%E7%B1%BB%E4%BC%BC%E4%BA%8EWindows%E4%B8%8B%E7%9A%84clip.exe%E3%80%82%E5%BD%93%E5%9C%A8Windows%E4%B8%8B%E7%94%A8ssh%E8%BF%9E%E6%8E%A5Linux%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%AA%E8%AE%BE%E7%BD%AEX11%20forwarding%EF%BC%8C%E5%88%99%E5%9C%A8Windows%E4%B8%8B%E6%98%AF%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E5%88%B0xsel%EF%BC%8Cxclip%E6%88%96%E8%80%85xclipboard%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AELinux%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%86%85%E5%AE%B9%E3%80%82%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E5%A5%BD%E4%BA%86X11%20forwarding%EF%BC%8C%E5%88%99%E5%9C%A8Windows%E4%B8%8B%E5%B0%B1%E8%83%BD%E8%AE%BF%E9%97%AELinux%E5%89%AA%E8%B4%B4%E6%9D%BF%E3%80%82%0A%0Atmux%E6%9C%AC%E8%BA%AB%E4%B9%9F%E7%AE%A1%E7%90%86%E4%BA%86%E4%B8%80%E4%B8%AA%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E7%A7%B0%E4%B8%BAbuffer%E3%80%82tmux%E7%9A%84%E5%91%BD%E4%BB%A4copy-selection%2C%20paste-buffer%2C%20list-buffers%E5%B0%B1%E6%98%AF%E9%92%88%E5%AF%B9tmux%E8%87%AA%E8%BA%AB%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82tmux%E5%8E%9F%E7%94%9F%E6%94%AF%E6%8C%81%EF%BC%8C%E9%80%9A%E8%BF%87%E7%A9%BA%E6%A0%BC%E9%80%89%E4%B8%AD%EF%BC%8CEnter%E5%A4%8D%E5%88%B6%EF%BC%8Cctrl%20%2B%20%5D%20%E7%B2%98%E8%B4%B4%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%83%B3tmux%E4%B8%8B%E5%B0%86%E7%BB%88%E7%AB%AF%E6%98%BE%E7%A4%BA%E5%86%85%E5%AE%B9%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%E8%A6%81%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E6%8A%8Atmux%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%8F%91%E9%80%81%E5%88%B0X11%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E4%B8%AD%E3%80%82tmux-yank%E6%8F%92%E4%BB%B6%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E8%BF%99%E4%BB%B6%E4%BA%8B%E3%80%82%E5%BD%93%E7%84%B6%E4%BD%A0%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%9C%A8copy-mode-vi%E8%A1%A8%E6%A0%BC%E9%87%8C%E7%BB%91%E5%AE%9A%E4%BB%BB%E4%BD%95%E6%8C%89%E9%94%AE%E6%9D%A5%E5%81%9A%E8%BF%99%E4%BB%B6%E4%BA%8B%E6%83%85%E3%80%82%0A%0A%23%23%20vim%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%0A%0A%E6%B2%A1%E6%9C%89%E8%BF%90%E8%A1%8C%E5%9C%A8tmux%E4%B8%8B%E7%9A%84vim%E6%88%96%E6%98%AFgvim%E8%A6%81%E5%A4%8D%E5%88%B6%E5%88%B0Windows%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E6%88%96%E8%80%85%E8%AF%B4%E6%98%AF%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E4%BE%9D%E8%B5%96%E7%9A%84%E6%98%AFvim%E7%9A%84%E5%AF%84%E5%AD%98%E5%99%A8%E6%93%8D%E4%BD%9C%E3%80%82%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8Cgoogle%E3%80%82%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%AF%B9%E5%BA%94%E7%9A%84vim%E5%AF%84%E5%AD%98%E5%99%A8%E6%98%AF%22%2B%E3%80%82%E6%89%80%E4%BB%A5%E5%9C%A8vim%E4%B8%8B%E5%A6%82%E6%9E%9C%E6%83%B3%E5%A4%8D%E5%88%B6%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E4%BD%A0%E5%8F%AF%E4%BB%A5%E7%94%A8%22%2By%E6%9D%A5%E5%8F%96%E4%BB%A3%E5%B9%B3%E6%97%B6%E5%B8%B8%E7%94%A8%E7%9A%84y%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%9A%0A%0A-%20%22%2Byy%EF%BC%9A%E5%A4%8D%E5%88%B6%E5%BD%93%E5%89%8D%E8%A1%8C%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%0A-%20%22%2Byw%EF%BC%9A%E5%A4%8D%E5%88%B6%E5%BD%93%E5%89%8D%E7%9A%84%E5%8D%95%E8%AF%8D%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%0A%0A%E5%A6%82%E6%9E%9Cvim%E8%BF%90%E8%A1%8C%E5%9C%A8tmux%E4%B8%8B%EF%BC%8C%E5%9B%A0%E4%B8%BAtmux%E8%87%AA%E5%B8%A6%E7%9A%84%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%B0%B1%E6%9C%89%E7%82%B9%E9%BA%BB%E7%83%A6%E4%BA%86%E3%80%82%E8%BF%99%E6%97%B6%E5%80%99%E6%9C%89%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6%E5%B0%B1%E6%AF%94%E8%BE%83%E6%9C%89%E7%94%A8%E4%BA%86%E2%80%94%E2%80%94%5Bvim-tmux-clipboard%5D(https%3A%2F%2Fgithub.com%2Froxma%2Fvim-tmux-clipboard)%E3%80%82%E4%BB%96%E4%BE%9D%E8%B5%96%E4%BA%8E%E5%8F%A6%E4%B8%80%E4%B8%AAvim%E6%8F%92%E4%BB%B6%5Bvim-tmux-focus-events%5D(https%3A%2F%2Fgithub.com%2Ftmux-plugins%2Fvim-tmux-focus-events)%E3%80%82%E8%A3%85%E5%A5%BD%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%8F%92%E4%BB%B6%EF%BC%8C%E5%9C%A8.tmux.conf%E4%B8%AD%E6%B7%BB%E5%8A%A0%0A%0A%60%60%60tmux%0Aset%20-g%20focus-events%20on%0A%60%60%60%0A%0A%E5%A4%A7%E5%8A%9F%E5%91%8A%E6%88%90%E3%80%82%E7%8E%B0%E5%9C%A8%E5%9C%A8vim%E4%B8%8B%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8yank%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%8C%E4%B8%8D%E7%94%A8%E6%8C%87%E5%AE%9A%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E5%86%85%E5%AE%B9%E5%88%B0tmux%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9B%A0%E4%B8%BAtmux-yank%E7%9A%84%E5%AD%98%E5%9C%A8%EF%BC%8C%E6%96%87%E6%9C%AC%E4%B9%9F%E4%BC%9A%E8%A2%AB%E5%A4%8D%E5%88%B6%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%89%AA%E8%B4%B4%E6%9D%BF%E3%80%82&lt;/center&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2019/02/03/PIP%E5%9C%A8Linux+glibc%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/</guid>
            <title>PIP在Linux+glibc中的实现</title>
            <link>https://blog.zhougy.top/2019/02/03/PIP%E5%9C%A8Linux+glibc%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/</link>
            <category>Linux</category>
            <category>schedule algorithm</category>
            <category>glibc</category>
            <pubDate>Sun, 03 Feb 2019 20:00:24 +0800</pubDate>
            <description><![CDATA[ &lt;div style=&#34;font-size: 14px; margin: 0; padding: 0; width: 100%;&#34;&gt;&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53CD;&amp;#x8F6C;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53CD;&amp;#x8F6C;&amp;#x6307;&amp;#x4E00;&amp;#x4E2A;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x4EFB;&amp;#x52A1;&amp;#x56E0;&amp;#x4E3A;&amp;#x8D44;&amp;#x6E90;&amp;#x88AB;&amp;#x4F4E;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x4EFB;&amp;#x52A1;&amp;#x5360;&amp;#x7528;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x5F97;&amp;#x4E0D;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x672C;&amp;#x8EAB;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53CD;&amp;#x8F6C;&amp;#x5E26;&amp;#x6765;&amp;#x6700;&amp;#x76F4;&amp;#x63A5;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x5C31;&amp;#x662F;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53EF;&amp;#x80FD;&amp;#x56E0;&amp;#x4E3A;&amp;#x8FD9;&amp;#x6B21;&amp;#x963B;&amp;#x585E;&amp;#xFF0C;&amp;#x800C;&amp;#x65E0;&amp;#x6CD5;&amp;#x786E;&amp;#x5B9A;&amp;#x963B;&amp;#x585E;&amp;#x65F6;&amp;#x5EF6;&amp;#x3002;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#x3002;&lt;br&gt;

        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1547609810638.png&#34; hash=&#34;8df099f053cbeaee4881a9d6ffc8963f&#34; align alt longdesc width=&#34;765&#34; height=&#34;210&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Task 9&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x8F83;&amp;#x4F4E;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5F88;&amp;#x5BB9;&amp;#x6613;&amp;#x88AB;&amp;#x5176;&amp;#x4ED6;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7684;&amp;#x4EFB;&amp;#x52A1;&amp;#x62A2;&amp;#x5360;&amp;#x8FD0;&amp;#x884C;&amp;#xFF0C;&amp;#x5BFC;&amp;#x81F4;&amp;#x5BF9;&amp;#x8D44;&amp;#x6E90;S&amp;#x7684;&amp;#x9501;&amp;#x65E0;&amp;#x6CD5;&amp;#x91CA;&amp;#x653E;&amp;#xFF0C;&amp;#x800C;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7684;&amp;#x4EFB;&amp;#x52A1;&amp;#x56E0;&amp;#x4E3A;&amp;#x8981;&amp;#x6301;&amp;#x6709;&amp;#x8BE5;&amp;#x9501;&amp;#xFF0C;&amp;#x4E0D;&amp;#x5F97;&amp;#x4E0D;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&lt;/p&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Priority Inheritance Protocol&amp;#x7FFB;&amp;#x8BD1;&amp;#x4E3A;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#xFF0C;&amp;#x7B80;&amp;#x79F0;PIP&amp;#x3002;&amp;#x8FD9;&amp;#x662F;&amp;#x89E3;&amp;#x51B3;&amp;#x4E0A;&amp;#x8FF0;Unbounded inversion&amp;#x6700;&amp;#x76F4;&amp;#x63A5;&amp;#x7684;&amp;#x529E;&amp;#x6CD5;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;&amp;#x5360;&amp;#x6709;&amp;#x9501;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x8C03;&amp;#x6574;&amp;#x5230;&amp;#x5728;&amp;#x7B49;&amp;#x5F85;&amp;#x7684;&amp;#x4EFB;&amp;#x52A1;&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x503C;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7B97;&amp;#x6CD5;&amp;#x662F;&amp;#x8D2A;&amp;#x5A6A;&amp;#x7684;&amp;#xFF0C;&amp;#x5C40;&amp;#x90E8;&amp;#x6700;&amp;#x4F18;&amp;#xFF0C;&amp;#x4F46;&amp;#x4E0D;&amp;#x662F;&amp;#x6574;&amp;#x4F53;&amp;#x6700;&amp;#x4F18;&amp;#x89E3;&amp;#xFF0C;&amp;#x5728;&amp;#x6B64;&amp;#x4E4B;&amp;#x4E0A;&amp;#x53C8;&amp;#x6709;PCP(&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x5929;&amp;#x82B1;&amp;#x677F;)&amp;#x548C;SRP(&amp;#x57FA;&amp;#x4E8E;&amp;#x6808;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#x7B56;&amp;#x7565;)&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E0D;&amp;#x505A;&amp;#x8BA8;&amp;#x8BBA;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECE;&amp;#x6E90;&amp;#x7801;&amp;#x7684;&amp;#x89D2;&amp;#x5EA6;&amp;#xFF0C;&amp;#x9610;&amp;#x8FF0;PIP&amp;#x5728;Linux&amp;#x548C;glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&lt;/p&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;Overview&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549009792507.png&#34; hash=&#34;b16f478e9d2cf9485b4b8bba9e81e3b0&#34; align alt longdesc width=&#34;719&#34; height=&#34;287&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Linux&amp;#x4E0B;&amp;#x7684;PIP&amp;#x5B9E;&amp;#x73B0;&amp;#x5206;&amp;#x6210;&amp;#x4EE5;&amp;#x4E0A;3&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;glibc&amp;#x4E2D;&amp;#x7684;pthread_mutex_lock&amp;#x63D0;&amp;#x4F9B;&amp;#x7528;&amp;#x6237;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;FUTEX_LOCK_PI&amp;#x5B9E;&amp;#x73B0;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x8C03;&amp;#x6574;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;Linux&amp;#x7684;futex&amp;#x90E8;&amp;#x5206;&amp;#x63D0;&amp;#x4F9B;FUTEX_LOCK_PI&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x6700;&amp;#x7EC8;&amp;#x7684;&amp;#x9501;&amp;#x673A;&amp;#x5236;&amp;#x901A;&amp;#x8FC7;rt_mutex&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;pthread_mutex&lt;/h2&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;Types&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;pthread mutex&amp;#x662F;POSIX pthread&amp;#x5E93;&amp;#x4E2D;&amp;#x5B9A;&amp;#x4E49;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;&amp;#x9501;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4E0E;&amp;#x4FE1;&amp;#x53F7;&amp;#x91CF;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x9501;&amp;#x53EA;&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x72B6;&amp;#x6001;&amp;#xFF1A;locked&amp;#x6216;unlocked&amp;#x3002;&amp;#x4E0E;binary semaphore&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;mutex&amp;#x53EA;&amp;#x80FD;&amp;#x88AB;lock&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;unlock&amp;#xFF0C;&amp;#x5373;&amp;#x53EA;&amp;#x80FD;&amp;#x88AB;mutex owner unlock&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x76EE;&amp;#x524D;&lt;a href=&#34;http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;POSIX&amp;#x6807;&amp;#x51C6;(1003.1-2008)&lt;/a&gt;&amp;#x4E2D;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E86;4&amp;#x79CD;&amp;#x7C7B;&amp;#x578B;&amp;#x7684;mutex:&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_NORMAL&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_ERRORCHECK&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_RECURSIVE&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;PTHREAD_MUTEX_DEFAULT&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;4&amp;#x79CD;mutex&amp;#x4E0D;&amp;#x540C;&amp;#x4E4B;&amp;#x5904;&amp;#x5982;&amp;#x4E0B;&lt;/p&gt;
&lt;table style=&#34;margin: 2px 0 14px; color: #333; width: auto; border-collapse: collapse; box-sizing: border-box;&#34;&gt;&lt;thead style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;th style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;&#34;&gt;&lt;/th&gt;&lt;th style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;&#34;&gt;attempting to relock this mutex without first unlocking&lt;/th&gt;&lt;th style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;&#34;&gt;Attempting to unlock a mutex locked by a different thread&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;NORMAL&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;deadlock&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;undefined&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;ERRORCHECK&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;return error -EDEADLOCK&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;return error&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;RECURSIVE&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;succeed in locking&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;return error&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;DEFAULT&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;undefined&lt;/td&gt;&lt;td style=&#34;line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;&#34;&gt;undefined&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;glibc&amp;#x5BF9;&amp;#x4E0A;&amp;#x8FF0;4&amp;#x79CD;&amp;#x7C7B;&amp;#x578B;&amp;#x7684;mutex&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;&amp;#x6269;&amp;#x5C55;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_RECURSIVE_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ERRORCHECK_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_NORMAL_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ADAPTIVE_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_RECURSIVE_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_ERRORCHECK_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_NORMAL_NP:
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; PTHREAD_MUTEX_PI_ROBUST_ADAPTIVE_NP:
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4E3B;&amp;#x8981;&amp;#x591A;&amp;#x4E86;&amp;#x8FD9;3&amp;#x79CD;&amp;#x5C5E;&amp;#x6027;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;ADAPTIVE&amp;#xFF1A;&amp;#x5728;SMP&amp;#x67B6;&amp;#x6784;&amp;#x4E0B;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x76F4;&amp;#x63A5;&amp;#x8FDB;&amp;#x5165;wait&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x5148;&amp;#x8C03;&amp;#x7528;spinlock&amp;#x7B49;&amp;#x5F85;&amp;#x4E00;&amp;#x5C0F;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;musl&amp;#x91CC;&amp;#x9ED8;&amp;#x8BA4;&amp;#x90FD;&amp;#x91C7;&amp;#x7528;&amp;#x4E86;&amp;#x8FD9;&amp;#x79CD;&amp;#x5B9E;&amp;#x73B0;&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;PI&amp;#xFF1A;&amp;#x5305;&amp;#x542B;&amp;#x8BE5;&amp;#x5C5E;&amp;#x6027;&amp;#x7684;mutex&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;(Priority Inheritance, PI)&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;ROBUST&amp;#xFF1A;&amp;#x82E5;&amp;#x7EBF;&amp;#x7A0B;&amp;#x9000;&amp;#x51FA;&amp;#x65F6;&amp;#x672A;&amp;#x91CA;&amp;#x653E;&amp;#x9501;&amp;#xFF0C;&amp;#x5219;&amp;#x4EE5;&amp;#x540E;&amp;#x5BF9;&amp;#x8BE5;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;&amp;#x90FD;&amp;#x4F1A;&amp;#x8FD4;&amp;#x56DE;-EOWNERDEAD&amp;#xFF0C;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x662F;PTHREAD_MUTEX_STALLED(&amp;#x8FD9;&amp;#x662F;&amp;#x9ED8;&amp;#x8BA4;&amp;#x914D;&amp;#x7F6E;)&amp;#xFF0C;&amp;#x5BF9;&amp;#x8BE5;&amp;#x5F02;&amp;#x5E38;&amp;#x9501;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x4F1A;&amp;#x51FA;&amp;#x73B0;undefined&amp;#x884C;&amp;#x4E3A;&amp;#x3002;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x518D;&amp;#x4E0E;&amp;#x539F;&amp;#x5148;&amp;#x7684;4&amp;#x79CD;&amp;#x5C5E;&amp;#x6027;&amp;#x8FDB;&amp;#x884C;&amp;#x6392;&amp;#x5217;&amp;#x7EC4;&amp;#x5408;&amp;#x3002;&lt;/p&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0;&#34;&gt;&lt;strong style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700;&#34;&gt;&amp;quot;_NP&amp;quot; suffix&lt;/strong&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;Note: the _NP suffix indicates a non-portable extension to the POSIX specification. In fact the latest specification, 1003.1-2008 [&lt;a href=&#34;http://2net.co.uk/tutorial/mutex_mutandis#ref_2&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;2]&lt;/a&gt;, includes most of the Linux additions so you can leave the _NP ending off. I have chosen not to because some older versions of the header files only have the _NP variants.&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-bottom: 0;&#34;&gt;&amp;#x6839;&amp;#x636E;&amp;#x6700;&amp;#x65B0;&amp;#x7684;POSIX&amp;#x6807;&amp;#x51C6;1003.1-2008&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6269;&amp;#x5C55;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x52A0;&amp;#x5165;&amp;#x3002;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x672C;&amp;#x6587;&amp;#x53EA;&amp;#x5173;&amp;#x6CE8;MUTEX_PI&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&lt;/p&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;PTHREAD_MUTEX_PI&lt;/h3&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;pthread_mutex_lock&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x91CD;&amp;#x8981;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt;
&amp;#123;
  &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; __&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pthread_mutex_s&lt;/span&gt; __&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;data&lt;/span&gt;;&lt;/span&gt;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;char&lt;/span&gt; __size[__SIZEOF_PTHREAD_MUTEX_T];
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __align;
&amp;#125; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;pthread_mutex_t&lt;/span&gt;;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; __&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pthread_mutex_s&lt;/span&gt;
&amp;#123;&lt;/span&gt;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __lock __LOCK_ALIGNMENT;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __count;
  &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; __owner;
  ...
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x8003;&amp;#x8651;ROBUST&amp;#x60C5;&amp;#x51B5;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x9488;&amp;#x5BF9;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;PI&amp;#x5C5E;&amp;#x6027;&amp;#x7684;pthread_mutex_lock&amp;#x64CD;&amp;#x4F5C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;

        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549014356838.png&#34; hash=&#34;36c67b688ae44843223a576d9cc0be30&#34; align alt longdesc width=&#34;599&#34; height=&#34;632&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0;&#34;&gt;&lt;strong style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700;&#34;&gt;atomic_compare_and_exchange_val_acq&lt;/strong&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5148;&amp;#x6BD4;&amp;#x8F83;&amp;#x518D;&amp;#x8D4B;&amp;#x503C;&amp;#xFF0C;&amp;#x4F2A;&amp;#x4EE3;&amp;#x7801;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;compare_and_swap&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt;* reg, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; oldval, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; newval)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
    ATOMIC();
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; old_reg_val = *reg;
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (old_reg_val == oldval)
      *reg = newval;
    END_ATOMIC();
    &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;return&lt;/span&gt; old_reg_val;
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x9488;&amp;#x5BF9;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;oldval == 0&lt;/code&gt;: &amp;#x8868;&amp;#x793A;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;mutex-&amp;gt;__data.__lock == 0&lt;/code&gt;&amp;#xFF0C;&amp;#x5373;&amp;#x8BE5;lock&amp;#x65E0;owner&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x83B7;&amp;#x5F97;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;oldval != 0&lt;/code&gt;: &amp;#x8868;&amp;#x793A;&amp;#x8BE5;mutex&amp;#x88AB;lock&amp;#x4E86;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x5165;kernel&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x9501;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;pthread_mutex_lock&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x6BD4;&amp;#x8F83;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x4E00;&amp;#x4E2A;&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&amp;#x5224;&amp;#x65AD;&amp;#x9501;&amp;#x662F;&amp;#x5426;&amp;#x5DF2;&amp;#x7ECF;&amp;#x88AB;&amp;#x9501;&amp;#x4F4F;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x9501;&amp;#x4F4F;&amp;#x5C31;&amp;#x66F4;&amp;#x65B0;owner&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;user&amp;#x8BA1;&amp;#x6570;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x5DF2;&amp;#x7ECF;&amp;#x88AB;&amp;#x9501;&amp;#x4F4F;&amp;#xFF0C;&amp;#x5219;&amp;#x9677;&amp;#x5165;&amp;#x5185;&amp;#x6838;&amp;#x8C03;&amp;#x7528;FUTEX_LOCK_PI&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x5B8C;&amp;#x6210;&amp;#x4E0A;&amp;#x9501;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;pthread_mutex_unlock&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x63A5;&amp;#x53E3;&amp;#x57FA;&amp;#x672C;&amp;#x4E0A;&amp;#x5C31;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x8C03;&amp;#x7528;futex_unlock_pi SYSCALL&amp;#x6765;&amp;#x5B8C;&amp;#x6210;&amp;#x5DE5;&amp;#x4F5C;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;      &lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/* Unlock the mutex using a CAS unless there are futex waiters or our
&amp;#x203A;    TID is not the value of __lock anymore, in which case we let the
&amp;#x203A;    kernel take care of the situation.  Use release MO in the CAS to
&amp;#x203A;    synchronize with acquire MO in lock acquisitions.  */&lt;/span&gt;
      &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; l = atomic_load_relaxed (&amp;amp;mutex-&amp;gt;__data.__lock);
      &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;do&lt;/span&gt;
&amp;#x203A;   &amp;#123;
&amp;#x203A;     &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (((l &amp;amp; FUTEX_WAITERS) != &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;)
&amp;#x203A;         || (l != THREAD_GETMEM (THREAD_SELF, tid)))
&amp;#x203A;       &amp;#123;
&amp;#x203A;         INTERNAL_SYSCALL_DECL (__err);
&amp;#x203A;         INTERNAL_SYSCALL (futex, __err, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;2&lt;/span&gt;, &amp;amp;mutex-&amp;gt;__data.__lock,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   __lll_private_flag (FUTEX_UNLOCK_PI, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;private&lt;/span&gt;));
&amp;#x203A;         &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;break&lt;/span&gt;;
&amp;#x203A;       &amp;#125;
&amp;#x203A;   &amp;#125;
      &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;while&lt;/span&gt; (!atomic_compare_exchange_weak_release (&amp;amp;mutex-&amp;gt;__data.__lock,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;       &amp;amp;l, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;));
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;futex&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;futex&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x5185;&amp;#x6838;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x7B49;&amp;#x5F85;&amp;#x67D0;&amp;#x4E2A;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x6570;&amp;#x636E;&amp;#x88AB;&amp;#x8BBE;&amp;#x7F6E;&amp;#x6210;&amp;#x67D0;&amp;#x4E2A;&amp;#x503C;&amp;#x3002;&amp;#x9488;&amp;#x5BF9;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;futex&amp;#x7565;&amp;#x6709;&amp;#x4E0D;&amp;#x540C;&amp;#x3002;&amp;#x5B83;&amp;#x4E0D;&amp;#x518D;&amp;#x7B49;&amp;#x5F85;&amp;#x7528;&amp;#x6237;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x4E0A;&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x5185;&amp;#x6838;rt_mutex&amp;#x673A;&amp;#x5236;&amp;#x5B9E;&amp;#x73B0;&amp;#x7B49;&amp;#x5F85;&amp;#xFF0C;&amp;#x4E0A;&amp;#x9501;&amp;#x548C;&amp;#x89E3;&amp;#x9501;&amp;#x7684;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&amp;#x770B;&amp;#x4E0B;&amp;#x9762;glibc&amp;#x548C;Linux&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#x5BF9;&amp;#x63A5;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;// glibc: pthread_mutex_lock.c&lt;/span&gt;
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; e = INTERNAL_SYSCALL (futex, __err, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;4&lt;/span&gt;, &amp;amp;mutex-&amp;gt;__data.__lock,
&amp;#x203A;   &amp;#x203A;         __lll_private_flag (FUTEX_LOCK_PI,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;     &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;private&lt;/span&gt;), &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;);

&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;// Linux: futex.c&lt;/span&gt;
&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;do_futex&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(u32 __user *uaddr, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; op, u32 val, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;ktime_t&lt;/span&gt; *timeout,
&amp;#x203A;   &amp;#x203A;   u32 __user *uaddr2, u32 val2, u32 val3)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
...
	&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;case&lt;/span&gt; FUTEX_LOCK_PI:
&amp;#x203A;   	&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;return&lt;/span&gt; futex_lock_pi(uaddr, flags, &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;NULL&lt;/span&gt;, &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;1&lt;/span&gt;);    
... 
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x53EF;&amp;#x89C1;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;uaddr = &amp;amp;mutex-&amp;gt;__data.__lock&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;flags = __lll_private_flag (FUTEX_LOCK_PI, private)&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;val = 1, timeout = NULL&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;&amp;#x5173;&amp;#x4E8E;lock/unlock&amp;#x7684;&amp;#x53D9;&amp;#x8FF0;&amp;#x4F1A;&amp;#x7B80;&amp;#x5316;&amp;#x6389;time&amp;#x76F8;&amp;#x5173;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;PI&amp;#x65E0;&amp;#x5173;&amp;#x7684;ROBUST&amp;#x7B49;&amp;#x7279;&amp;#x6027;&amp;#x3002;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;&amp;#x91CD;&amp;#x8981;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&lt;/h3&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
 * Hash buckets are shared by all the futex_keys that hash to the same
 * location.  Each key may have multiple futex_q structures, one for each task
 * waiting on a futex.
 */&lt;/span&gt;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_hash_bucket&lt;/span&gt; &amp;#123;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;atomic_t&lt;/span&gt; waiters;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;spinlock_t&lt;/span&gt; lock;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;plist_head&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;chain&lt;/span&gt;;&lt;/span&gt;
&amp;#125; ____cacheline_aligned_in_smp;

&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/**
 * struct futex_q - The hashed futex queue entry, one per waiting task
 * @list:&amp;#x203A;  &amp;#x203A;   priority-sorted list of tasks waiting on this futex
 * @task:&amp;#x203A;  &amp;#x203A;   the task waiting on the futex
 * @lock_ptr:&amp;#x203A;  &amp;#x203A;   the hash bucket lock
 * @key:&amp;#x203A;   &amp;#x203A;   the key the futex is hashed on
 * @pi_state:&amp;#x203A;  &amp;#x203A;   optional priority inheritance state
 * @rt_waiter:&amp;#x203A; &amp;#x203A;   rt_waiter storage for use with requeue_pi
 * @requeue_pi_key:&amp;#x203A;the requeue_pi target futex key
 * @bitset:&amp;#x203A;&amp;#x203A;   bitset for the optional bitmasked wakeup
 *
 * We use this hashed waitqueue, instead of a normal wait_queue_entry_t, so
 * we can wake only the relevant ones (hashed queues may be shared).
 *
 * A futex_q has a woken state, just like tasks have TASK_RUNNING.
 * It is considered woken when plist_node_empty(&amp;amp;q-&amp;gt;list) || q-&amp;gt;lock_ptr == 0.
 * The order of wakeup is always to make the first condition true, then
 * the second.
 *
 * PI futexes are typically woken before they are removed from the hash list via
 * the rt_mutex code. See unqueue_me_pi().
 */&lt;/span&gt;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_q&lt;/span&gt; &amp;#123;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;plist_node&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;list&lt;/span&gt;;&lt;/span&gt;

&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;task_struct&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;task&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;spinlock_t&lt;/span&gt; *lock_ptr;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt; futex_key key;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_pi_state&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pi_state&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;rt_mutex_waiter&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;rt_waiter&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt; futex_key *requeue_pi_key;
&amp;#x203A;   u32 &lt;span style=&#34;color: #4ec9b0; line-height: 160%; box-sizing: content-box;&#34;&gt;bitset&lt;/span&gt;;
&amp;#125; __randomize_layout;

&lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
 * Priority Inheritance state:
 */&lt;/span&gt;
&lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;futex_pi_state&lt;/span&gt; &amp;#123;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
&amp;#x203A;    * list of &amp;apos;owned&amp;apos; pi_state instances - these have to be
&amp;#x203A;    * cleaned up in do_exit() if the task exits prematurely:
&amp;#x203A;    */&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;list_head&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;list&lt;/span&gt;;&lt;/span&gt;

&amp;#x203A;   &lt;span style=&#34;color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;&#34;&gt;/*
&amp;#x203A;    * The PI object:
&amp;#x203A;    */&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;rt_mutex&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;pi_mutex&lt;/span&gt;;&lt;/span&gt;

&amp;#x203A;   &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;task_struct&lt;/span&gt; *&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;owner&lt;/span&gt;;&lt;/span&gt;
&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;atomic_t&lt;/span&gt; refcount;

&amp;#x203A;   &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;union&lt;/span&gt; futex_key key;
&amp;#125; __randomize_layout;
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_hash_bucket&lt;/code&gt;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E00;&amp;#x4E2A;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;uaddr&lt;/code&gt;&amp;#x3002;&amp;#x901A;&amp;#x8FC7;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x4F20;&amp;#x5165;&amp;#x7684;uaddr&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;futex&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&amp;#x7528;hash&amp;#x7684;&amp;#x539F;&amp;#x56E0;&amp;#x662F;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x662F;uaddr&amp;#x5730;&amp;#x5740;&amp;#x503C;&amp;#xFF0C;&amp;#x6570;&amp;#x5B57;&amp;#x5F88;&amp;#x5927;&amp;#xFF0C;&amp;#x5206;&amp;#x5E03;&amp;#x5F88;&amp;#x6563;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x7528;hash&amp;#x53EF;&amp;#x4EE5;&amp;#x6709;&amp;#x6548;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_q&lt;/code&gt;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E34;&amp;#x65F6;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;futex&amp;#x7684;waiter&amp;#x7EBF;&amp;#x7A0B;&amp;#x3002;&amp;#x5B83;&amp;#x901A;&amp;#x5E38;&amp;#x88AB;&amp;#x7528;&amp;#x6765;&amp;#x4F20;&amp;#x9012;&amp;#x5404;&amp;#x79CD;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;pi_state&lt;/code&gt;&amp;#x662F;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;task_struct&lt;/code&gt;&amp;#x5185;&amp;#x90E8;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_lock_pi&lt;/code&gt;&amp;#x8C03;&amp;#x7528;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;refill_pi_state_cache&lt;/code&gt;&amp;#x91CC;&amp;#x9762;&amp;#x505A;&amp;#x5206;&amp;#x914D;&amp;#x3002;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;refill_pi_state_cache&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;void&lt;/span&gt;)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
...
	pi_state = kzalloc(&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;sizeof&lt;/span&gt;(*pi_state), GFP_KERNEL);
    current-&amp;gt;pi_state_cache = pi_state;
...
&amp;#125;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;futex_lock_pi&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8FD8;&amp;#x662F;&amp;#x6BD4;&amp;#x8F83;&amp;#x76F4;&amp;#x7EBF;&amp;#x7684;&amp;#xFF0C;&amp;#x540C;&amp;#x5927;&amp;#x591A;&amp;#x6570;&amp;#x9501;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x5148;&amp;#x5C1D;&amp;#x8BD5;&amp;#x539F;&amp;#x5B50;&amp;#x9501;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x884C;&amp;#xFF0C;&amp;#x5219;&amp;#x8C03;&amp;#x7528;rt_mutex&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;&amp;#x4EE5;&amp;#x4E0B;&amp;#x6361;&amp;#x53D6;&amp;#x6BD4;&amp;#x8F83;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#x505A;&amp;#x9610;&amp;#x8FF0;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;[3], [4]&amp;#x4E2D;&amp;#x7684;&amp;#x63CF;&amp;#x8FF0;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;queue_lock, queue_unlock&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5BF9;hash_bucket&amp;#x8FDB;&amp;#x884C;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x4ED6;&amp;#x4EEC;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x662F;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;hash_bucket&lt;/code&gt;&amp;#x4E0B;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;lock&lt;/code&gt;&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x4E5F;&amp;#x662F;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;futex_q&lt;/code&gt;&amp;#x4E0B;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;lock_ptr&lt;/code&gt;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x9501;&amp;#x7684;&amp;#x51FA;&amp;#x73B0;&amp;#x6BD4;&amp;#x8F83;&amp;#x6DF7;&amp;#x4E71;&amp;#xFF0C;&amp;#x6709;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x6709;&amp;#x65F6;&amp;#x76F4;&amp;#x63A5;&amp;#x5BF9;lock&amp;#x6307;&amp;#x9488;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x9700;&amp;#x8981;&amp;#x5C0F;&amp;#x5FC3;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;__queue_me, unqueue_me&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C06;&amp;#x7533;&amp;#x8BF7;futex&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5728;hash_bucket&amp;#x7684;chain&amp;#x4E0A;&amp;#x505A;&amp;#x6DFB;&amp;#x52A0;&amp;#x6216;&amp;#x79FB;&amp;#x9664;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x8FD8;&amp;#x4F1A;&amp;#x6D89;&amp;#x53CA;&amp;#x9501;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4EE5;&amp;#x4E0A;4&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x66F4;&amp;#x591A;&amp;#x7684;&amp;#x4E0E;futex&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x76F8;&amp;#x5173;&amp;#xFF0C;&amp;#x4E0E;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x5E76;&amp;#x65E0;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x7565;&amp;#x8FC7;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;futex_lock_pi_atomic&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549076735129.png&#34; hash=&#34;8f64be7a14c9e36fb86aff8b54e61062&#34; align alt longdesc width=&#34;783&#34; height=&#34;523&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&amp;#x6765;&amp;#x8BF7;&amp;#x6C42;&amp;#x9501;&amp;#xFF0C;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x5982;&amp;#x679C;futex&amp;#x6CA1;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5219;&amp;#x76F4;&amp;#x63A5;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#x5E76;&amp;#x8FD4;&amp;#x56DE;1&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6210;&amp;#x529F;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF0C;&amp;#x8868;&amp;#x793A;ready to wait&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x662F;&amp;#x4F1A;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x4E0E;PI&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x6709;waiter&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x8C03;&amp;#x7528;attach_to_pi_state&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x8BE5;top_waiter&amp;#x7684;pi_state&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x6CA1;&amp;#x6709;waiter&amp;#x7684;&amp;#x60C5;&amp;#x51B5;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x8C03;&amp;#x7528;attach_to_pi_owner&amp;#x6765;&amp;#x53D6;&amp;#x7528;&amp;#x672C;&amp;#x7EBF;&amp;#x7A0B;&amp;#x91CC;&amp;#x5206;&amp;#x914D;&amp;#x7684;pi_state&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&amp;#x5E76;&amp;#x66F4;&amp;#x65B0;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;queue&amp;#x5230;hash_bucket&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x4E2D;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;rt_mutex&amp;#x63A5;&amp;#x53E3;&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;futex_lock_pi&amp;#x4E2D;&amp;#x4F7F;&amp;#x7528;&amp;#x5230;&amp;#x5982;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E9B;rt_mutex&amp;#x63A5;&amp;#x53E3;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;rt_mutex_init_waiter&amp;#xFF1A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;waiter&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EA2;&amp;#x9ED1;&amp;#x6811;&amp;#x7684;&amp;#x8282;&amp;#x70B9;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;waiter&amp;#x5BF9;&amp;#x5E94;&amp;#x5F53;&amp;#x524D;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5E76;&amp;#x53CD;&amp;#x6620;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5728;&amp;#x67D0;&amp;#x4E2A;&amp;#x9501;&amp;#x4E0A;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;__rt_mutex_start_proxy_lock&amp;#xFF1A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x662F;PI&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x7528;&amp;#x6765;&amp;#x5BF9;&amp;#x5404;waiters&amp;#x6570;&amp;#x636E;&amp;#x8FDB;&amp;#x884C;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x904D;&amp;#x5386;lock&amp;#x94FE;&amp;#x6765;&amp;#x68C0;&amp;#x67E5;&amp;#x6B7B;&amp;#x9501;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E0E;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x539F;&amp;#x5B50;&amp;#x68C0;&amp;#x67E5;&amp;#x7C7B;&amp;#x4F3C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD4;&amp;#x56DE;1&amp;#x8868;&amp;#x793A;&amp;#x5DF2;&amp;#x7ECF;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF0C;&amp;#x5219;ready to wait&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;rt_mutex_wait_proxy_lock&amp;#xFF1A;&amp;#x901A;&amp;#x8FC7;__rt_mutex_start_proxy_lock&amp;#x5904;&amp;#x7406;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#xFF0C;&amp;#x90A3;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5F00;&amp;#x59CB;&amp;#x7B49;&amp;#x5F85;&amp;#x4E86;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5C06;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5207;&amp;#x6362;&amp;#x4E3A;TASK_INTERRUPTIBLE&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x5E76;&amp;#x5F00;&amp;#x59CB;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&amp;#x8FD9;&amp;#x5176;&amp;#x95F4;&amp;#x4F1A;&amp;#x5904;&amp;#x7406;&amp;#x57FA;&amp;#x4E8E;&amp;#x65F6;&amp;#x95F4;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#xFF0C;&amp;#x4E14;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;&amp;#x8C03;&amp;#x5EA6;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;rt_mutex_cleanup_proxy_lock&amp;#xFF1A;&amp;#x73B0;&amp;#x5728;&amp;#x5DF2;&amp;#x7ECF;&amp;#x963B;&amp;#x585E;&amp;#x7ED3;&amp;#x675F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD8;&amp;#x6CA1;&amp;#x83B7;&amp;#x5F97;&amp;#x9501;&amp;#xFF0C;&amp;#x8981;&amp;#x4E48;&amp;#x662F;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&amp;#x8981;&amp;#x4E48;&amp;#x662F;&amp;#x51FA;&amp;#x9519;&amp;#xFF0C;&amp;#x603B;&amp;#x4E4B;&amp;#x8981;&amp;#x5C06;&amp;#x672C;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4ECE;waiters&amp;#x4E2D;&amp;#x79FB;&amp;#x9664;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x662F;&amp;#x8D77;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4F5C;&amp;#x7528;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;fixup_owner&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4ECE;&amp;#x6CE8;&amp;#x91CA;&amp;#x4E0A;&amp;#x770B;&amp;#xFF0C;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x5904;&amp;#x7406;lock steal&amp;#x3002;&amp;#x800C;lock steal&amp;#x4F3C;&amp;#x4E4E;&amp;#x591A;&amp;#x53D1;&amp;#x751F;&amp;#x5728;futex requeue&amp;#x64CD;&amp;#x4F5C;&amp;#x4E0A;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x5C1A;&amp;#x672A;&amp;#x4ED4;&amp;#x7EC6;&amp;#x7814;&amp;#x7A76;&amp;#x3002;&lt;/p&gt;
&lt;h3 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;&#34;&gt;futex_unlock_pi&lt;/h3&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;futex_unlock_pi&amp;#x91CA;&amp;#x653E;futex&amp;#x4EE5;&amp;#x53CA;&amp;#x66F4;&amp;#x65B0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;pi_state&amp;#x548C;rt_mutex&amp;#x7684;owner&amp;#x5B57;&amp;#x6BB5;&amp;#x3002;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x5C42;&amp;#x6B21;&amp;#x6BD4;&amp;#x8F83;&amp;#x6DF1;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C;&amp;#x4E0A;&amp;#x90FD;&amp;#x662F;&amp;#x6BCF;&amp;#x4E00;&amp;#x5C42;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x57FA;&amp;#x672C;&amp;#x7684;&amp;#x66F4;&amp;#x65B0;&amp;#x5DE5;&amp;#x4F5C;&amp;#xFF0C;&amp;#x6700;&amp;#x7EC8;&amp;#x8C03;&amp;#x7528;&amp;#x5230;__rt_mutex_futex_unlock&amp;#x6765;&amp;#x91CD;&amp;#x65B0;&amp;#x8C03;&amp;#x6574;&amp;#x672C;&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x5E76;&amp;#x5C06;top waiter&amp;#x653E;&amp;#x5230;wake queue&amp;#x4E0A;&amp;#x3002;&amp;#x5728;rt_mutex_postunlock&amp;#x8C03;&amp;#x7528;&amp;#x7684;rt_mutex_postunlock&amp;#x5C06;&amp;#x65B0;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5524;&amp;#x9192;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5219;&amp;#x4F7F;&amp;#x7528;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;cmpxchg_futex_value_locked&lt;/code&gt;&amp;#x6765;&amp;#x5C06;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x5730;&amp;#x5740;uaddr&amp;#x4E0A;&amp;#x7684;&amp;#x503C;&amp;#x8BBE;&amp;#x4E3A;0&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x9501;&amp;#x6CA1;&amp;#x6709;waiter&amp;#x4E86;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x4E5F;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x6062;&amp;#x590D;&amp;#x4E86;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x5DF2;&amp;#x7ECF;&amp;#x6062;&amp;#x590D;&amp;#x8FC7;&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6709;waiter&amp;#xFF0C;&amp;#x5C31;&amp;#x4F7F;&amp;#x7528;&amp;#x4E0B;&amp;#x9762;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x5207;&amp;#x6362;lock owner&amp;#xFF0C;&amp;#x5E76;&amp;#x6062;&amp;#x590D;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;wake_futex_pi&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x505A;&amp;#x4E86;&amp;#x4E0B;&amp;#x9762;&amp;#x51E0;&amp;#x4EF6;&amp;#x4E8B;&amp;#xFF1A;&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x7528;cmpxchg_futex_value_locked&amp;#x5C06;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x4F20;&amp;#x5165;&amp;#x7684;uaddr&amp;#x5904;&amp;#x7684;&amp;#x6570;&amp;#x503C;&amp;#x66F4;&amp;#x65B0;&amp;#x4E3A;&amp;#x65B0;&amp;#x7684;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_next_owner() | FUTEX_WAITERS&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;list_del_init(&amp;amp;pi_state-&amp;gt;list)&lt;/code&gt;&amp;#xFF1A;&amp;#x5C06;list&amp;#x4ECE;&amp;#x539F;&amp;#x5148;&amp;#x7684;&amp;#x8868;&amp;#x4E0A;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x5E76;&amp;#x91CD;&amp;#x65B0;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x51C6;&amp;#x5907;&amp;#x79FB;&amp;#x5230;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;&amp;#x8868;&amp;#x4E0A;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;list_add(&amp;amp;pi_state-&amp;gt;list, &amp;amp;new_owner-&amp;gt;pi_state_list)&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;pi_state-&amp;gt;owner = new_owner&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;__rt_mutex_futex_unlock&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_postunlock&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;mark_wakeup_next_waiter&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6CE8;&amp;#x610F;&amp;#xFF1A;&amp;#x6B64;&amp;#x65F6;pi_state-&amp;gt;owner&amp;#x5DF2;&amp;#x7ECF;&amp;#x8BBE;&amp;#x7F6E;&amp;#x8FC7;&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;pi_state-&amp;gt;pi_mutex-&amp;gt;owner&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x8BBE;&amp;#x7F6E;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E3B;&amp;#x8981;&amp;#x505A;&amp;#x4E86;&amp;#x4E0B;&amp;#x9762;&amp;#x51E0;&amp;#x4EF6;&amp;#x4E8B;&amp;#x60C5;&amp;#xFF1A;&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_dequeue_pi(current, waiter);&lt;/code&gt;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_adjust_prio(current)&lt;/code&gt;:&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x8C03;&amp;#x6574;&amp;#x4E86;&amp;#x5F53;&amp;#x524D;&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x5B8C;&amp;#x6210;&amp;#x4E86;&amp;#x6574;&amp;#x4E2A;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x534F;&amp;#x8BAE;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;wake_q_add(wake_q, waiter-&amp;gt;task)&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;put_pi_state&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x66F4;&amp;#x591A;&amp;#x7684;&amp;#x662F;&amp;#x6E05;&amp;#x7406;&amp;#x5DE5;&amp;#x4F5C;:&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x8C03;&amp;#x7528;&amp;#x4E86;&lt;code style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;&#34;&gt;rt_mutex_proxy_unlock&lt;/code&gt;&amp;#x6765;&amp;#x91CA;&amp;#x653E;pi_state-&amp;gt;pi_mutex.&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x91CA;&amp;#x653E;&amp;#x4E86;current-&amp;gt;pi_state_cache&amp;#x7A7A;&amp;#x95F4;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote style=&#34;line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0;&#34;&gt;&lt;strong style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700;&#34;&gt;cmpxchg_futex_value_locked&amp;#x539F;&amp;#x5B50;&amp;#x64CD;&amp;#x4F5C;&lt;/strong&gt;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8; margin-bottom: 0;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;cmpxchg_futex_value_locked&lt;/span&gt;&lt;span style=&#34;color: #dcdcdc; line-height: 160%; box-sizing: content-box;&#34;&gt;(u32 *uval, u32 __user *uaddr,
&amp;#x203A;   &amp;#x203A;   &amp;#x203A;   &amp;#x203A;         u32 oldval, u32 newval)&lt;/span&gt;
&lt;/span&gt;&amp;#123;
ATOMIC();
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;int&lt;/span&gt; val = *uaddr;
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (val == oldval) &amp;#123;
*uaddr = newval;
&amp;#125;
*uval = val;
END_ATOMIC();
&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #b8d7a3; line-height: 160%; box-sizing: content-box;&#34;&gt;0&lt;/span&gt;;
&amp;#125;

&amp;#x5176;&amp;#x4E2D;ATOMIC&amp;#x64CD;&amp;#x4F5C;&amp;#x901A;&amp;#x8FC7;page_disable()&amp;#x548C;preempt_disable()&amp;#x4FDD;&amp;#x8BC1;&amp;#x3002;
&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;__rt_mutex_start_proxy_lock&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;futex_lock_pi&amp;#x7528;&amp;#x5230;&amp;#x7684;rt_mutex&amp;#x63A5;&amp;#x53E3;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E2D;&amp;#x53EF;&amp;#x77E5;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;PI&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x53C8;&amp;#x4E3B;&amp;#x8981;&amp;#x8C03;&amp;#x7528;task_blocks_on_rt_mutex&amp;#x6765;&amp;#x5904;&amp;#x7406;PI&amp;#x3002;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549078599538.png&#34; hash=&#34;692787b6adf4be8b04b3aa57c3612c37&#34; align alt longdesc width=&#34;840&#34; height=&#34;712&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;rt_mutex_adjust_prio(owner)&lt;/h4&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x662F;&amp;#x8C03;&amp;#x6574;&amp;#x963B;&amp;#x585E;&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5B9E;&amp;#x73B0;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x7684;&amp;#x3002;&amp;#x5B9E;&amp;#x73B0;&amp;#x65B9;&amp;#x5F0F;&amp;#x4E5F;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF1A;&lt;/p&gt;
&lt;pre style=&#34;line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;&#34;&gt;&lt;code style=&#34;display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;&#34;&gt;&lt;span style=&#34;color: #569cd6; line-height: 160%; box-sizing: content-box;&#34;&gt;if&lt;/span&gt; (task_has_pi_waiters(p))
&amp;#x203A;   pi_task = task_top_pi_waiter(p)-&amp;gt;task;

rt_mutex_setprio(p, pi_task);
&lt;/code&gt;&lt;/pre&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x628A;owner&amp;#x7EBF;&amp;#x7A0B;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;owner&amp;#x7EBF;&amp;#x7A0B;&amp;#x6240;&amp;#x6709;waiter(&amp;#x53EF;&amp;#x80FD;&amp;#x6765;&amp;#x81EA;&amp;#x591A;&amp;#x4E2A;&amp;#x9501;)&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x3002;&lt;/p&gt;
&lt;h4 style=&#34;line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;&#34;&gt;rt_mutex_adjust_prio_chain&lt;/h4&gt;
&lt;h5 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x6709;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x5F0F;&amp;#x8C03;&amp;#x6574;&amp;#xFF1F;&lt;/h5&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;
        &lt;img class=&#34;enMedia&#34; src=&#34;/images/PIP&amp;#x5728;Linux+glibc&amp;#x4E2D;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;/1549078908946.png&#34; hash=&#34;c4badef8862a4db7fb98b88635d31ecb&#34; align alt longdesc width=&#34;1021&#34; height=&#34;358&#34; border hspace vspace usemap style title lang xml:lang dir&gt;
      &lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E24;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF1A;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x6BCF;&amp;#x4E2A;rt_mutex&amp;#x6709;&amp;#x5F20;waiters&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6240;&amp;#x6709;&amp;#x7B49;&amp;#x5F85;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x6BCF;&amp;#x4E2A;task&amp;#x4E5F;&amp;#x6709;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x8868;&amp;#x683C;&amp;#x91CC;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x9879;&amp;#x5BF9;&amp;#x5E94;owner&amp;#x7EBF;&amp;#x7A0B;&amp;#x5360;&amp;#x6709;&amp;#x7684;&amp;#x9501;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E00;&amp;#x9879;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;rt_mutex_waiter&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x7533;&amp;#x8BF7;&amp;#x8BE5;&amp;#x9501;&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;waiter&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x5047;&amp;#x8BBE;Task1&amp;#x5C31;&amp;#x662F;owner&amp;#xFF0C;Task0&amp;#x5BF9;Lock0&amp;#x7684;&amp;#x7533;&amp;#x8BF7;&amp;#x5BFC;&amp;#x81F4;Task1&amp;#x63D0;&amp;#x5347;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;Task1&amp;#x540C;&amp;#x65F6;&amp;#x88AB;Task2&amp;#x6301;&amp;#x6709;&amp;#x7684;&amp;#x67D0;&amp;#x4E2A;&amp;#x9501;&amp;#x963B;&amp;#x585E;&amp;#xFF0C;&amp;#x5219;Task1&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7684;&amp;#x6539;&amp;#x53D8;&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;Task2 pi_waiters&amp;#x5217;&amp;#x8868;&amp;#x6539;&amp;#x53D8;&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x53EF;&amp;#x80FD;&amp;#x5BFC;&amp;#x81F4;Task2&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x4F9D;&amp;#x6B64;&amp;#x7C7B;&amp;#x63A8;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x8FD9;&amp;#x79CD;&amp;#x94FE;&amp;#x5F0F;&amp;#x53CD;&amp;#x5E94;&amp;#x3002;&lt;/p&gt;
&lt;h5 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;&#34;&gt;&amp;#x94FE;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&lt;/h5&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6574;&amp;#x4E2A;chain&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x5927;&amp;#x81F4;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;ol style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x5982;&amp;#x679C;Task0&amp;#x662F;Lock0&amp;#x7684;top waiter&amp;#xFF0C;&amp;#x5219;&amp;#x6FC0;&amp;#x53D1;&amp;#x8BE5;&amp;#x94FE;&amp;#x5F0F;&amp;#x8C03;&amp;#x6574;&amp;#x3002;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x56E0;&amp;#x4E3A;Task0&amp;#x6210;&amp;#x4E3A;Lock0&amp;#x7684;topwaiter&amp;#xFF0C;&amp;#x5219;Task1&amp;#x7684;pi_waiters&amp;#x9700;&amp;#x8981;&amp;#x8C03;&amp;#x6574;&amp;#xFF0C;&amp;#x5219;Task1&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x53EF;&amp;#x80FD;&amp;#x9700;&amp;#x8981;&amp;#x8C03;&amp;#x6574;&amp;#x3002;&amp;#x9000;&amp;#x51FA;&amp;#x53EF;&amp;#x80FD;&amp;#xFF1A;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x8D77;&amp;#x70B9;&amp;#x9501;&amp;#x91CA;&amp;#x653E;&amp;#x4E86;&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;&amp;#x94FE;&amp;#x7684;&amp;#x5F53;&amp;#x524D;&amp;#x73AF;&amp;#x8282;&amp;#x88AB;&amp;#x66F4;&amp;#x6539;( next_lock &amp;#x2260;waiter-&amp;gt;lock)&lt;/p&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; color: #333; margin: 0;&#34;&gt;Task1&amp;#x6CA1;&amp;#x6709;&amp;#x5360;&amp;#x9501;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x5982;&amp;#x679C;Task1&amp;#x4E5F;wait&amp;#x5728;&amp;#x67D0;&amp;#x4E2A;lock&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5219;&amp;#x8BE5;lock&amp;#x7684;waiters&amp;#x9700;&amp;#x8981;&amp;#x8C03;&amp;#x6574;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x82E5;&amp;#x5E72;&amp;#x79CD;&amp;#x9000;&amp;#x51FA;&amp;#x53EF;&amp;#x80FD;&amp;#x3002;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;Task1&amp;#x6CA1;&amp;#x6709;&amp;#x88AB;block&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;Task1 pi_waiters&amp;#x4E2D;&amp;#x6709;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x9AD8;&amp;#x4E8E;Task0&amp;#x7684;waiter&amp;#xFF0C;&amp;#x6362;&amp;#x53E5;&amp;#x8BDD;&amp;#x8BF4;&amp;#xFF0C;lock0&amp;#x7684;top_waiter&amp;#x4E0D;&amp;#x662F;Task1&amp;#x7684;top pi_waiter&amp;#xFF0C;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x7EE7;&amp;#x627F;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x7EE7;&amp;#x7EED;&amp;#x4F20;&amp;#x9012;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x5982;&amp;#x679C;Task1&amp;#x5728;&amp;#x7533;&amp;#x8BF7;Lock1 &amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF08;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8BB0;&amp;#x5F55;&amp;#x5728;waiter-&amp;gt;prio&amp;#x91CC;&amp;#xFF09;&amp;#x4E0E;&amp;#x5F53;&amp;#x524D;&amp;#x8C03;&amp;#x6574;&amp;#x540E;&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x76F8;&amp;#x7B49;&amp;#xFF0C;&amp;#x5219;&amp;#x540E;&amp;#x7EED;&amp;#x6CA1;&amp;#x5FC5;&amp;#x8981;&amp;#x5728;&amp;#x7EE7;&amp;#x7EED;&amp;#x8C03;&amp;#x6574;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x68C0;&amp;#x6D4B;&amp;#x5230;DEADLOCK&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34; style=&#34;line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box;&#34;&gt;&amp;#x56DE;&amp;#x5230;1&amp;#x7EE7;&amp;#x7EED;&amp;#x6267;&amp;#x884C;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x9000;&amp;#x51FA;&amp;#x94FE;&amp;#x5F0F;&amp;#x5904;&amp;#x7406;&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;&#34;&gt;&amp;#x6B7B;&amp;#x9501;&lt;/h5&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;&amp;#x6709;3&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x51FD;&amp;#x6570;&amp;#x4F1A;&amp;#x8FD4;&amp;#x56DE;&amp;#x6B7B;&amp;#x9501;&lt;/p&gt;
&lt;ul style=&#34;line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;&#34;&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x94FE;&amp;#x4E0A;&amp;#x8D85;&amp;#x8FC7;1024&amp;#x4E2A;&amp;#x9501;&amp;#x8282;&amp;#x70B9;&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x94FE;&amp;#x4E0A;&amp;#x4EFB;&amp;#x610F;Task&amp;#x8282;&amp;#x70B9;&amp;#x7533;&amp;#x8BF7;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x9501;&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x5373;Lock0&lt;/li&gt;
&lt;li style=&#34;line-height: 160%; box-sizing: content-box; position: relative;&#34;&gt;&amp;#x94FE;&amp;#x4E0A;&amp;#x4EFB;&amp;#x610F;&amp;#x4E00;&amp;#x4E2A;&amp;#x9501;owner&amp;#x662F;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;Task&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x5373;Task0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 style=&#34;line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;&#34;&gt;&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;&lt;/h2&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[1] [Mutex mutandis: understanding mutex types and attributes]. (http://2net.co.uk/tutorial/mutex_mutandis)&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[2] &lt;a href=&#34;http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;POSIX Revision of IEEE Std 1003.1-2008&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[3] &lt;a href=&#34;https://zihan.me/2018/08/15/source-code-analysis-pthread-mutex-lock/&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;Source code analysis of pthread_mutex_lock&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[4] &lt;a href=&#34;https://yq.aliyun.com/articles/6044&#34; style=&#34;line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;&#34;&gt;linux pi_futex&amp;#x6D45;&amp;#x6790;&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[5] Linux 4.20-rc3 source code&lt;/p&gt;
&lt;p style=&#34;line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;&#34;&gt;[6] glibc 2.28 source code&lt;/p&gt;
&lt;/div&gt;&lt;center style=&#34;display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden&#34;&gt;%23%23%20%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%0A%0A%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E6%8C%87%E4%B8%80%E4%B8%AA%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E5%9B%A0%E4%B8%BA%E8%B5%84%E6%BA%90%E8%A2%AB%E4%BD%8E%E4%BC%98%E5%85%88%E7%BA%A7%E4%BB%BB%E5%8A%A1%E5%8D%A0%E7%94%A8%EF%BC%8C%E8%80%8C%E4%B8%8D%E5%BE%97%E4%B8%8D%E7%AD%89%E5%BE%85%E3%80%82%E8%BF%99%E4%B8%AA%E9%80%BB%E8%BE%91%E6%9C%AC%E8%BA%AB%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E3%80%82%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%8D%E8%BD%AC%E5%B8%A6%E6%9D%A5%E6%9C%80%E7%9B%B4%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98%E5%B0%B1%E6%98%AF%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%AF%E8%83%BD%E5%9B%A0%E4%B8%BA%E8%BF%99%E6%AC%A1%E9%98%BB%E5%A1%9E%EF%BC%8C%E8%80%8C%E6%97%A0%E6%B3%95%E7%A1%AE%E5%AE%9A%E9%98%BB%E5%A1%9E%E6%97%B6%E5%BB%B6%E3%80%82%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82%0A!%5B8df099f053cbeaee4881a9d6ffc8963f.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5789)%0A%0ATask%209%E4%BC%98%E5%85%88%E7%BA%A7%E8%BE%83%E4%BD%8E%EF%BC%8C%E6%89%80%E4%BB%A5%E5%BE%88%E5%AE%B9%E6%98%93%E8%A2%AB%E5%85%B6%E4%BB%96%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%8A%A2%E5%8D%A0%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%AF%B9%E8%B5%84%E6%BA%90S%E7%9A%84%E9%94%81%E6%97%A0%E6%B3%95%E9%87%8A%E6%94%BE%EF%BC%8C%E8%80%8C%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%9B%A0%E4%B8%BA%E8%A6%81%E6%8C%81%E6%9C%89%E8%AF%A5%E9%94%81%EF%BC%8C%E4%B8%8D%E5%BE%97%E4%B8%8D%E7%AD%89%E5%BE%85%E3%80%82%0A%0A%23%23%20%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%0A%0APriority%20Inheritance%20Protocol%E7%BF%BB%E8%AF%91%E4%B8%BA%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%EF%BC%8C%E7%AE%80%E7%A7%B0PIP%E3%80%82%E8%BF%99%E6%98%AF%E8%A7%A3%E5%86%B3%E4%B8%8A%E8%BF%B0Unbounded%20inversion%E6%9C%80%E7%9B%B4%E6%8E%A5%E7%9A%84%E5%8A%9E%E6%B3%95%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%B0%86%E5%8D%A0%E6%9C%89%E9%94%81%E7%9A%84%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E6%95%B4%E5%88%B0%E5%9C%A8%E7%AD%89%E5%BE%85%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%9C%80%E9%AB%98%E5%80%BC%E3%80%82%E8%BF%99%E4%B8%AA%E7%AE%97%E6%B3%95%E6%98%AF%E8%B4%AA%E5%A9%AA%E7%9A%84%EF%BC%8C%E5%B1%80%E9%83%A8%E6%9C%80%E4%BC%98%EF%BC%8C%E4%BD%86%E4%B8%8D%E6%98%AF%E6%95%B4%E4%BD%93%E6%9C%80%E4%BC%98%E8%A7%A3%EF%BC%8C%E5%9C%A8%E6%AD%A4%E4%B9%8B%E4%B8%8A%E5%8F%88%E6%9C%89PCP(%E4%BC%98%E5%85%88%E7%BA%A7%E5%A4%A9%E8%8A%B1%E6%9D%BF)%E5%92%8CSRP(%E5%9F%BA%E4%BA%8E%E6%A0%88%E7%9A%84%E8%B5%84%E6%BA%90%E7%AD%96%E7%95%A5)%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%8D%E5%81%9A%E8%AE%A8%E8%AE%BA%E3%80%82%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E4%BB%8E%E6%BA%90%E7%A0%81%E7%9A%84%E8%A7%92%E5%BA%A6%EF%BC%8C%E9%98%90%E8%BF%B0PIP%E5%9C%A8Linux%E5%92%8Cglibc%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%23%23%20Overview%0A!%5Bb16f478e9d2cf9485b4b8bba9e81e3b0.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5790)%0A%0ALinux%E4%B8%8B%E7%9A%84PIP%E5%AE%9E%E7%8E%B0%E5%88%86%E6%88%90%E4%BB%A5%E4%B8%8A3%E4%B8%AA%E9%83%A8%E5%88%86%EF%BC%9A%0A%0A-%20glibc%E4%B8%AD%E7%9A%84pthread_mutex_lock%E6%8F%90%E4%BE%9B%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3%EF%BC%8C%E9%80%9A%E8%BF%87FUTEX_LOCK_PI%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%85%88%E7%BA%A7%E8%B0%83%E6%95%B4%0A-%20Linux%E7%9A%84futex%E9%83%A8%E5%88%86%E6%8F%90%E4%BE%9BFUTEX_LOCK_PI%E7%9A%84%E5%AE%9E%E7%8E%B0%0A-%20%E6%9C%80%E7%BB%88%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6%E9%80%9A%E8%BF%87rt_mutex%E6%9D%A5%E5%AE%9E%E7%8E%B0%0A%0A%23%23%20pthread_mutex%0A%0A%23%23%23%20Types%0A%0Apthread%20mutex%E6%98%AFPOSIX%20pthread%E5%BA%93%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E4%B8%80%E7%A7%8D%E9%94%81%E6%9C%BA%E5%88%B6%EF%BC%8C%E4%B8%8E%E4%BF%A1%E5%8F%B7%E9%87%8F%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%94%81%E5%8F%AA%E6%9C%89%E4%B8%A4%E7%A7%8D%E7%8A%B6%E6%80%81%EF%BC%9Alocked%E6%88%96unlocked%E3%80%82%E4%B8%8Ebinary%20semaphore%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%8Cmutex%E5%8F%AA%E8%83%BD%E8%A2%ABlock%E7%9A%84%E7%BA%BF%E7%A8%8Bunlock%EF%BC%8C%E5%8D%B3%E5%8F%AA%E8%83%BD%E8%A2%ABmutex%20owner%20unlock%E3%80%82%0A%0A%E7%9B%AE%E5%89%8D%5BPOSIX%E6%A0%87%E5%87%86(1003.1-2008)%5D(http%3A%2F%2Fpubs.opengroup.org%2Fonlinepubs%2F9699919799%2Ffunctions%2Fcontents.html)%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BA%864%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84mutex%3A%0A%0A-%20PTHREAD_MUTEX_NORMAL%0A-%20PTHREAD_MUTEX_ERRORCHECK%0A-%20PTHREAD_MUTEX_RECURSIVE%0A-%20PTHREAD_MUTEX_DEFAULT%0A%0A%E8%BF%994%E7%A7%8Dmutex%E4%B8%8D%E5%90%8C%E4%B9%8B%E5%A4%84%E5%A6%82%E4%B8%8B%0A%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%20attempting%20to%20relock%20this%20mutex%20without%20first%20unlocking%20%7C%20Attempting%20to%20unlock%20a%20mutex%20locked%20by%20a%20different%20thread%20%7C%0A%7C%20----------%20%7C%20-------------------------------------------------------%20%7C%20---------------------------------------------------------%20%7C%0A%7C%20NORMAL%20%20%20%20%20%7C%20deadlock%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20ERRORCHECK%20%7C%20return%20error%20-EDEADLOCK%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20return%20error%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20RECURSIVE%20%20%7C%20succeed%20in%20locking%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20return%20error%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20DEFAULT%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20undefined%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%0Aglibc%E5%AF%B9%E4%B8%8A%E8%BF%B04%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84mutex%E8%BF%9B%E8%A1%8C%E4%BA%86%E6%89%A9%E5%B1%95%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9A%0A%0A%60%60%60c%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_RECURSIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ERRORCHECK_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_NORMAL_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ADAPTIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_RECURSIVE_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_ERRORCHECK_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_NORMAL_NP%3A%0A%20%20%20%20case%20PTHREAD_MUTEX_PI_ROBUST_ADAPTIVE_NP%3A%0A%60%60%60%0A%0A%E4%B8%BB%E8%A6%81%E5%A4%9A%E4%BA%86%E8%BF%993%E7%A7%8D%E5%B1%9E%E6%80%A7%EF%BC%9A%0A%0A-%20ADAPTIVE%EF%BC%9A%E5%9C%A8SMP%E6%9E%B6%E6%9E%84%E4%B8%8B%EF%BC%8C%E5%B9%B6%E4%B8%8D%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5wait%EF%BC%8C%E8%80%8C%E6%98%AF%E5%85%88%E8%B0%83%E7%94%A8spinlock%E7%AD%89%E5%BE%85%E4%B8%80%E5%B0%8F%E6%AE%B5%E6%97%B6%E9%97%B4%E3%80%82musl%E9%87%8C%E9%BB%98%E8%AE%A4%E9%83%BD%E9%87%87%E7%94%A8%E4%BA%86%E8%BF%99%E7%A7%8D%E5%AE%9E%E7%8E%B0%0A%0A-%20PI%EF%BC%9A%E5%8C%85%E5%90%AB%E8%AF%A5%E5%B1%9E%E6%80%A7%E7%9A%84mutex%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BA%86%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF(Priority%20Inheritance%2C%20PI)%0A%0A-%20ROBUST%EF%BC%9A%E8%8B%A5%E7%BA%BF%E7%A8%8B%E9%80%80%E5%87%BA%E6%97%B6%E6%9C%AA%E9%87%8A%E6%94%BE%E9%94%81%EF%BC%8C%E5%88%99%E4%BB%A5%E5%90%8E%E5%AF%B9%E8%AF%A5%E9%94%81%E6%93%8D%E4%BD%9C%E9%83%BD%E4%BC%9A%E8%BF%94%E5%9B%9E-EOWNERDEAD%EF%BC%8C%E4%B8%8E%E4%B9%8B%E5%AF%B9%E5%BA%94%E7%9A%84%E6%98%AFPTHREAD_MUTEX_STALLED(%E8%BF%99%E6%98%AF%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE)%EF%BC%8C%E5%AF%B9%E8%AF%A5%E5%BC%82%E5%B8%B8%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BC%9A%E5%87%BA%E7%8E%B0undefined%E8%A1%8C%E4%B8%BA%E3%80%82%0A%0A%E5%86%8D%E4%B8%8E%E5%8E%9F%E5%85%88%E7%9A%844%E7%A7%8D%E5%B1%9E%E6%80%A7%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E3%80%82%0A%0A%3E%20**%22_NP%22%20suffix**%0A%3E%0A%3E%20Note%3A%20the%20_NP%20suffix%20indicates%20a%20non-portable%20extension%20to%20the%20POSIX%20specification.%20In%20fact%20the%20latest%20specification%2C%201003.1-2008%20%5B%5B2%5C%5D%5D(http%3A%2F%2F2net.co.uk%2Ftutorial%2Fmutex_mutandis%23ref_2)%2C%20includes%20most%20of%20the%20Linux%20additions%20so%20you%20can%20leave%20the%20_NP%20ending%20off.%20I%20have%20chosen%20not%20to%20because%20some%20older%20versions%20of%20the%20header%20files%20only%20have%20the%20_NP%20variants.%0A%3E%0A%3E%20%E6%A0%B9%E6%8D%AE%E6%9C%80%E6%96%B0%E7%9A%84POSIX%E6%A0%87%E5%87%861003.1-2008%EF%BC%8C%E8%BF%99%E4%BA%9B%E6%89%A9%E5%B1%95%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%8A%A0%E5%85%A5%E3%80%82%0A%0A%E6%9C%AC%E6%96%87%E5%8F%AA%E5%85%B3%E6%B3%A8MUTEX_PI%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%23%23%23%20PTHREAD_MUTEX_PI%0A%0A%23%23%23%23%20pthread_mutex_lock%0A%0A%E9%87%8D%E8%A6%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A%60%60%60C%0Atypedef%20union%0A%7B%0A%20%20struct%20__pthread_mutex_s%20__data%3B%0A%20%20char%20__size%5B__SIZEOF_PTHREAD_MUTEX_T%5D%3B%0A%20%20long%20int%20__align%3B%0A%7D%20pthread_mutex_t%3B%0Astruct%20__pthread_mutex_s%0A%7B%0A%20%20int%20__lock%20__LOCK_ALIGNMENT%3B%0A%20%20unsigned%20int%20__count%3B%0A%20%20int%20__owner%3B%0A%20%20...%0A%7D%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%80%83%E8%99%91ROBUST%E6%83%85%E5%86%B5%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%8C%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E5%AE%9E%E7%8E%B0%E4%BA%86PI%E5%B1%9E%E6%80%A7%E7%9A%84pthread_mutex_lock%E6%93%8D%E4%BD%9C%E5%A6%82%E4%B8%8B%EF%BC%9A%0A!%5B36c67b688ae44843223a576d9cc0be30.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5791)%0A%0A%0A%3E%20**atomic_compare_and_exchange_val_acq**%0A%3E%0A%3E%20%E8%BF%99%E6%98%AF%E4%B8%80%E7%A7%8D%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%85%88%E6%AF%94%E8%BE%83%E5%86%8D%E8%B5%8B%E5%80%BC%EF%BC%8C%E4%BC%AA%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%3E%0A%3E%20%60%60%60C%0A%3E%20int%20compare_and_swap(int*%20reg%2C%20int%20oldval%2C%20int%20newval)%0A%3E%20%7B%0A%3E%20%20%20%20%20ATOMIC()%3B%0A%3E%20%20%20%20%20int%20old_reg_val%20%3D%20*reg%3B%0A%3E%20%20%20%20%20if%20(old_reg_val%20%3D%3D%20oldval)%0A%3E%20%20%20%20%20%20%20*reg%20%3D%20newval%3B%0A%3E%20%20%20%20%20END_ATOMIC()%3B%0A%3E%20%20%20%20%20return%20old_reg_val%3B%0A%3E%20%7D%0A%3E%20%60%60%60%0A%3E%0A%3E%20%E9%92%88%E5%AF%B9%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E6%83%85%E5%86%B5%EF%BC%9A%0A%3E%0A%3E%20-%20%60oldval%20%3D%3D%200%60%3A%20%E8%A1%A8%E7%A4%BA%60mutex-%3E__data.__lock%20%3D%3D%200%60%EF%BC%8C%E5%8D%B3%E8%AF%A5lock%E6%97%A0owner%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%BE%97%E3%80%82%0A%3E%20-%20%60oldval%20!%3D%200%60%3A%20%E8%A1%A8%E7%A4%BA%E8%AF%A5mutex%E8%A2%ABlock%E4%BA%86%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%BF%9B%E5%85%A5kernel%E6%9D%A5%E5%A4%84%E7%90%86%E9%94%81%E7%9A%84%E6%83%85%E5%86%B5%E3%80%82%0A%0Apthread_mutex_lock%E7%9A%84%E9%80%BB%E8%BE%91%E6%AF%94%E8%BE%83%E7%AE%80%E5%8D%95%EF%BC%8C%E5%B0%B1%E6%98%AF%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%88%A4%E6%96%AD%E9%94%81%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E8%A2%AB%E9%94%81%E4%BD%8F%E3%80%82%E5%A6%82%E6%9E%9C%E6%B2%A1%E9%94%81%E4%BD%8F%E5%B0%B1%E6%9B%B4%E6%96%B0owner%EF%BC%8C%E4%BB%A5%E5%8F%8Auser%E8%AE%A1%E6%95%B0%E3%80%82%E5%A6%82%E6%9E%9C%E5%B7%B2%E7%BB%8F%E8%A2%AB%E9%94%81%E4%BD%8F%EF%BC%8C%E5%88%99%E9%99%B7%E5%85%A5%E5%86%85%E6%A0%B8%E8%B0%83%E7%94%A8FUTEX_LOCK_PI%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AE%8C%E6%88%90%E4%B8%8A%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82%0A%0A%23%23%23%23%20pthread_mutex_unlock%0A%0A%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%E5%9F%BA%E6%9C%AC%E4%B8%8A%E5%B0%B1%E6%98%AF%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8futex_unlock_pi%20SYSCALL%E6%9D%A5%E5%AE%8C%E6%88%90%E5%B7%A5%E4%BD%9C%EF%BC%9A%0A%0A%60%60%60c%0A%20%20%20%20%20%20%2F*%20Unlock%20the%20mutex%20using%20a%20CAS%20unless%20there%20are%20futex%20waiters%20or%20our%0A%E2%80%BA%20%20%20%20TID%20is%20not%20the%20value%20of%20__lock%20anymore%2C%20in%20which%20case%20we%20let%20the%0A%E2%80%BA%20%20%20%20kernel%20take%20care%20of%20the%20situation.%20%20Use%20release%20MO%20in%20the%20CAS%20to%0A%E2%80%BA%20%20%20%20synchronize%20with%20acquire%20MO%20in%20lock%20acquisitions.%20%20*%2F%0A%20%20%20%20%20%20int%20l%20%3D%20atomic_load_relaxed%20(%26mutex-%3E__data.__lock)%3B%0A%20%20%20%20%20%20do%0A%E2%80%BA%20%20%20%7B%0A%E2%80%BA%20%20%20%20%20if%20(((l%20%26%20FUTEX_WAITERS)%20!%3D%200)%0A%E2%80%BA%20%20%20%20%20%20%20%20%20%7C%7C%20(l%20!%3D%20THREAD_GETMEM%20(THREAD_SELF%2C%20tid)))%0A%E2%80%BA%20%20%20%20%20%20%20%7B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20INTERNAL_SYSCALL_DECL%20(__err)%3B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20INTERNAL_SYSCALL%20(futex%2C%20__err%2C%202%2C%20%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20__lll_private_flag%20(FUTEX_UNLOCK_PI%2C%20private))%3B%0A%E2%80%BA%20%20%20%20%20%20%20%20%20break%3B%0A%E2%80%BA%20%20%20%20%20%20%20%7D%0A%E2%80%BA%20%20%20%7D%0A%20%20%20%20%20%20while%20(!atomic_compare_exchange_weak_release%20(%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%26l%2C%200))%3B%0A%60%60%60%0A%0A%0A%0A%23%23%20futex%0A%0Afutex%E6%98%AF%E4%B8%80%E7%A7%8D%E5%86%85%E6%A0%B8%E7%9A%84%E7%AD%89%E5%BE%85%E6%9C%BA%E5%88%B6%EF%BC%8C%E7%AD%89%E5%BE%85%E6%9F%90%E4%B8%AA%E7%94%A8%E6%88%B7%E6%80%81%E6%95%B0%E6%8D%AE%E8%A2%AB%E8%AE%BE%E7%BD%AE%E6%88%90%E6%9F%90%E4%B8%AA%E5%80%BC%E3%80%82%E9%92%88%E5%AF%B9%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84futex%E7%95%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E3%80%82%E5%AE%83%E4%B8%8D%E5%86%8D%E7%AD%89%E5%BE%85%E7%94%A8%E6%88%B7%E4%BC%A0%E5%85%A5%E7%9A%84%E5%9C%B0%E5%9D%80%E4%B8%8A%E7%9A%84%E5%80%BC%EF%BC%8C%E8%80%8C%E6%98%AF%E5%9F%BA%E4%BA%8E%E5%86%85%E6%A0%B8rt_mutex%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E7%AD%89%E5%BE%85%EF%BC%8C%E4%B8%8A%E9%94%81%E5%92%8C%E8%A7%A3%E9%94%81%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%E7%9C%8B%E4%B8%8B%E9%9D%A2glibc%E5%92%8CLinux%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%AF%B9%E6%8E%A5%EF%BC%9A%0A%0A%60%60%60c%0A%2F%2F%20glibc%3A%20pthread_mutex_lock.c%0Aint%20e%20%3D%20INTERNAL_SYSCALL%20(futex%2C%20__err%2C%204%2C%20%26mutex-%3E__data.__lock%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%20%20__lll_private_flag%20(FUTEX_LOCK_PI%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20private)%2C%201%2C%200)%3B%0A%0A%2F%2F%20Linux%3A%20futex.c%0Along%20do_futex(u32%20__user%20*uaddr%2C%20int%20op%2C%20u32%20val%2C%20ktime_t%20*timeout%2C%0A%E2%80%BA%20%20%20%E2%80%BA%20%20%20u32%20__user%20*uaddr2%2C%20u32%20val2%2C%20u32%20val3)%0A%7B%0A...%0A%09case%20FUTEX_LOCK_PI%3A%0A%E2%80%BA%20%20%20%09return%20futex_lock_pi(uaddr%2C%20flags%2C%20NULL%2C%201)%3B%20%20%20%20%0A...%20%0A%7D%0A%60%60%60%0A%0A%E5%8F%AF%E8%A7%81%EF%BC%9A%0A%0A-%20%60uaddr%20%3D%20%26mutex-%3E__data.__lock%60%0A-%20%60flags%20%3D%20__lll_private_flag%20(FUTEX_LOCK_PI%2C%20private)%60%0A-%20%60val%20%3D%201%2C%20timeout%20%3D%20NULL%60%0A%0A%3E%20%E5%85%B3%E4%BA%8Elock%2Funlock%E7%9A%84%E5%8F%99%E8%BF%B0%E4%BC%9A%E7%AE%80%E5%8C%96%E6%8E%89time%E7%9B%B8%E5%85%B3%E9%83%A8%E5%88%86%EF%BC%8C%E4%BB%A5%E5%8F%8API%E6%97%A0%E5%85%B3%E7%9A%84ROBUST%E7%AD%89%E7%89%B9%E6%80%A7%E3%80%82%0A%0A%23%23%23%20%E9%87%8D%E8%A6%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%0A%0A%60%60%60c%0A%2F*%0A%20*%20Hash%20buckets%20are%20shared%20by%20all%20the%20futex_keys%20that%20hash%20to%20the%20same%0A%20*%20location.%20%20Each%20key%20may%20have%20multiple%20futex_q%20structures%2C%20one%20for%20each%20task%0A%20*%20waiting%20on%20a%20futex.%0A%20*%2F%0Astruct%20futex_hash_bucket%20%7B%0A%E2%80%BA%20%20%20atomic_t%20waiters%3B%0A%E2%80%BA%20%20%20spinlock_t%20lock%3B%0A%E2%80%BA%20%20%20struct%20plist_head%20chain%3B%0A%7D%20____cacheline_aligned_in_smp%3B%0A%0A%2F**%0A%20*%20struct%20futex_q%20-%20The%20hashed%20futex%20queue%20entry%2C%20one%20per%20waiting%20task%0A%20*%20%40list%3A%E2%80%BA%20%20%E2%80%BA%20%20%20priority-sorted%20list%20of%20tasks%20waiting%20on%20this%20futex%0A%20*%20%40task%3A%E2%80%BA%20%20%E2%80%BA%20%20%20the%20task%20waiting%20on%20the%20futex%0A%20*%20%40lock_ptr%3A%E2%80%BA%20%20%E2%80%BA%20%20%20the%20hash%20bucket%20lock%0A%20*%20%40key%3A%E2%80%BA%20%20%20%E2%80%BA%20%20%20the%20key%20the%20futex%20is%20hashed%20on%0A%20*%20%40pi_state%3A%E2%80%BA%20%20%E2%80%BA%20%20%20optional%20priority%20inheritance%20state%0A%20*%20%40rt_waiter%3A%E2%80%BA%20%E2%80%BA%20%20%20rt_waiter%20storage%20for%20use%20with%20requeue_pi%0A%20*%20%40requeue_pi_key%3A%E2%80%BAthe%20requeue_pi%20target%20futex%20key%0A%20*%20%40bitset%3A%E2%80%BA%E2%80%BA%20%20%20bitset%20for%20the%20optional%20bitmasked%20wakeup%0A%20*%0A%20*%20We%20use%20this%20hashed%20waitqueue%2C%20instead%20of%20a%20normal%20wait_queue_entry_t%2C%20so%0A%20*%20we%20can%20wake%20only%20the%20relevant%20ones%20(hashed%20queues%20may%20be%20shared).%0A%20*%0A%20*%20A%20futex_q%20has%20a%20woken%20state%2C%20just%20like%20tasks%20have%20TASK_RUNNING.%0A%20*%20It%20is%20considered%20woken%20when%20plist_node_empty(%26q-%3Elist)%20%7C%7C%20q-%3Elock_ptr%20%3D%3D%200.%0A%20*%20The%20order%20of%20wakeup%20is%20always%20to%20make%20the%20first%20condition%20true%2C%20then%0A%20*%20the%20second.%0A%20*%0A%20*%20PI%20futexes%20are%20typically%20woken%20before%20they%20are%20removed%20from%20the%20hash%20list%20via%0A%20*%20the%20rt_mutex%20code.%20See%20unqueue_me_pi().%0A%20*%2F%0Astruct%20futex_q%20%7B%0A%E2%80%BA%20%20%20struct%20plist_node%20list%3B%0A%0A%E2%80%BA%20%20%20struct%20task_struct%20*task%3B%0A%E2%80%BA%20%20%20spinlock_t%20*lock_ptr%3B%0A%E2%80%BA%20%20%20union%20futex_key%20key%3B%0A%E2%80%BA%20%20%20struct%20futex_pi_state%20*pi_state%3B%0A%E2%80%BA%20%20%20struct%20rt_mutex_waiter%20*rt_waiter%3B%0A%E2%80%BA%20%20%20union%20futex_key%20*requeue_pi_key%3B%0A%E2%80%BA%20%20%20u32%20bitset%3B%0A%7D%20__randomize_layout%3B%0A%0A%2F*%0A%20*%20Priority%20Inheritance%20state%3A%0A%20*%2F%0Astruct%20futex_pi_state%20%7B%0A%E2%80%BA%20%20%20%2F*%0A%E2%80%BA%20%20%20%20*%20list%20of%20&amp;apos;owned&amp;apos;%20pi_state%20instances%20-%20these%20have%20to%20be%0A%E2%80%BA%20%20%20%20*%20cleaned%20up%20in%20do_exit()%20if%20the%20task%20exits%20prematurely%3A%0A%E2%80%BA%20%20%20%20*%2F%0A%E2%80%BA%20%20%20struct%20list_head%20list%3B%0A%0A%E2%80%BA%20%20%20%2F*%0A%E2%80%BA%20%20%20%20*%20The%20PI%20object%3A%0A%E2%80%BA%20%20%20%20*%2F%0A%E2%80%BA%20%20%20struct%20rt_mutex%20pi_mutex%3B%0A%0A%E2%80%BA%20%20%20struct%20task_struct%20*owner%3B%0A%E2%80%BA%20%20%20atomic_t%20refcount%3B%0A%0A%E2%80%BA%20%20%20union%20futex_key%20key%3B%0A%7D%20__randomize_layout%3B%0A%60%60%60%0A%0A%60futex_hash_bucket%60%E5%AF%B9%E5%BA%94%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E6%80%81%E7%9A%84%60uaddr%60%E3%80%82%E9%80%9A%E8%BF%87%E7%94%A8%E6%88%B7%E6%80%81%E4%BC%A0%E5%85%A5%E7%9A%84uaddr%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%9D%A5%E8%8E%B7%E5%BE%97%E5%AF%B9%E5%BA%94%E7%9A%84futex%E7%BB%93%E6%9E%84%E4%BD%93%E3%80%82%E7%94%A8hash%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%98%AF%E4%BC%A0%E5%85%A5%E7%9A%84%E6%98%AFuaddr%E5%9C%B0%E5%9D%80%E5%80%BC%EF%BC%8C%E6%95%B0%E5%AD%97%E5%BE%88%E5%A4%A7%EF%BC%8C%E5%88%86%E5%B8%83%E5%BE%88%E6%95%A3%EF%BC%8C%E6%89%80%E4%BB%A5%E7%94%A8hash%E5%8F%AF%E4%BB%A5%E6%9C%89%E6%95%88%E7%B4%A2%E5%BC%95%E3%80%82%0A%0A%60futex_q%20%60%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F%EF%BC%8C%E5%AF%B9%E5%BA%94%E4%BA%86%E4%B8%80%E4%B8%AAfutex%E7%9A%84waiter%E7%BA%BF%E7%A8%8B%E3%80%82%E5%AE%83%E9%80%9A%E5%B8%B8%E8%A2%AB%E7%94%A8%E6%9D%A5%E4%BC%A0%E9%80%92%E5%90%84%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%82%0A%0A%60pi_state%60%E6%98%AF%60task_struct%60%E5%86%85%E9%83%A8%E7%9A%84%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%EF%BC%8C%E5%9C%A8%60futex_lock_pi%60%E8%B0%83%E7%94%A8%60refill_pi_state_cache%60%E9%87%8C%E9%9D%A2%E5%81%9A%E5%88%86%E9%85%8D%E3%80%82%0A%0A%0A%60%60%60c%0Astatic%20int%20refill_pi_state_cache(void)%0A%7B%0A...%0A%09pi_state%20%3D%20kzalloc(sizeof(*pi_state)%2C%20GFP_KERNEL)%3B%0A%20%20%20%20current-%3Epi_state_cache%20%3D%20pi_state%3B%0A...%0A%7D%0A%60%60%60%0A%23%23%23%20futex_lock_pi%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E7%9A%84%E9%80%BB%E8%BE%91%E8%BF%98%E6%98%AF%E6%AF%94%E8%BE%83%E7%9B%B4%E7%BA%BF%E7%9A%84%EF%BC%8C%E5%90%8C%E5%A4%A7%E5%A4%9A%E6%95%B0%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%85%88%E5%B0%9D%E8%AF%95%E5%8E%9F%E5%AD%90%E9%94%81%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%A1%8C%EF%BC%8C%E5%88%99%E8%B0%83%E7%94%A8rt_mutex%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%9D%A5%E5%A4%84%E7%90%86%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E6%9C%BA%E5%88%B6%E3%80%82%E4%BB%A5%E4%B8%8B%E6%8D%A1%E5%8F%96%E6%AF%94%E8%BE%83%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%BD%E6%95%B0%E5%81%9A%E9%98%90%E8%BF%B0%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%5C%5B3%5D%2C%20%5C%5B4%5D%E4%B8%AD%E7%9A%84%E6%8F%8F%E8%BF%B0%E3%80%82%0A%0A%23%23%23%23%20queue_lock%2C%20queue_unlock%0A%0A%E5%AF%B9hash_bucket%E8%BF%9B%E8%A1%8C%E9%94%81%E6%93%8D%E4%BD%9C%E3%80%82%E4%BB%96%E4%BB%AC%E6%93%8D%E4%BD%9C%E7%9A%84%E6%98%AF%60hash_bucket%60%E4%B8%8B%E7%9A%84%60lock%60%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E6%98%AF%60futex_q%60%E4%B8%8B%E7%9A%84%60lock_ptr%60%E3%80%82%E8%BF%99%E9%87%8C%E9%94%81%E7%9A%84%E5%87%BA%E7%8E%B0%E6%AF%94%E8%BE%83%E6%B7%B7%E4%B9%B1%EF%BC%8C%E6%9C%89%E6%97%B6%E8%B0%83%E7%94%A8%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%87%BD%E6%95%B0%EF%BC%8C%E6%9C%89%E6%97%B6%E7%9B%B4%E6%8E%A5%E5%AF%B9lock%E6%8C%87%E9%92%88%E6%93%8D%E4%BD%9C%E3%80%82%E9%9C%80%E8%A6%81%E5%B0%8F%E5%BF%83%E3%80%82%0A%0A%23%23%23%23%20__queue_me%2C%20unqueue_me%0A%0A%E8%BF%99%E9%87%8C%E5%B0%86%E7%94%B3%E8%AF%B7futex%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%9C%A8hash_bucket%E7%9A%84chain%E4%B8%8A%E5%81%9A%E6%B7%BB%E5%8A%A0%E6%88%96%E7%A7%BB%E9%99%A4%E6%93%8D%E4%BD%9C%E3%80%82%E8%BF%98%E4%BC%9A%E6%B6%89%E5%8F%8A%E9%94%81%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82%0A%0A%E4%BB%A5%E4%B8%8A4%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9B%B4%E5%A4%9A%E7%9A%84%E4%B8%8Efutex%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9B%B8%E5%85%B3%EF%BC%8C%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E5%B9%B6%E6%97%A0%E5%85%B3%E7%B3%BB%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E7%95%A5%E8%BF%87%E3%80%82%0A%0A%23%23%23%23%20futex_lock_pi_atomic%0A!%5B8f64be7a14c9e36fb86aff8b54e61062.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5792)%0A%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E6%9D%A5%E8%AF%B7%E6%B1%82%E9%94%81%EF%BC%8C%0A%0A-%20%E5%A6%82%E6%9E%9Cfutex%E6%B2%A1%E6%9C%89waiter%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E8%8E%B7%E5%BE%97%E9%94%81%E5%B9%B6%E8%BF%94%E5%9B%9E1%EF%BC%8C%E8%A1%A8%E7%A4%BA%E6%88%90%E5%8A%9F%E8%8E%B7%E5%BE%97%E9%94%81%0A-%20%E5%A6%82%E6%9E%9C%E6%9C%89waiter%EF%BC%8C%E5%B0%B1%E8%BF%94%E5%9B%9E0%EF%BC%8C%E8%A1%A8%E7%A4%BAready%20to%20wait%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%E4%BC%9A%E5%81%9A%E4%B8%80%E4%BA%9B%E4%B8%8EPI%E7%9B%B8%E5%85%B3%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%9A%0A%0A-%20%E6%9C%89waiter%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9A%0A%20%20-%20%E8%B0%83%E7%94%A8attach_to_pi_state%E6%9D%A5%E8%8E%B7%E5%BE%97%E8%AF%A5top_waiter%E7%9A%84pi_state%0A-%20%E6%B2%A1%E6%9C%89waiter%E7%9A%84%E6%83%85%E5%86%B5%0A%20%20-%20%E8%B0%83%E7%94%A8attach_to_pi_owner%E6%9D%A5%E5%8F%96%E7%94%A8%E6%9C%AC%E7%BA%BF%E7%A8%8B%E9%87%8C%E5%88%86%E9%85%8D%E7%9A%84pi_state%E7%BB%93%E6%9E%84%E4%BD%93%EF%BC%8C%E5%B9%B6%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E3%80%82%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E8%A2%ABqueue%E5%88%B0hash_bucket%E7%9A%84%E9%98%9F%E5%88%97%E4%B8%AD%E3%80%82%0A%0A%23%23%23%23%20rt_mutex%E6%8E%A5%E5%8F%A3%0A%0Afutex_lock_pi%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%88%B0%E5%A6%82%E4%B8%8B%E8%BF%99%E4%BA%9Brt_mutex%E6%8E%A5%E5%8F%A3%EF%BC%9A%0A%0A-%20rt_mutex_init_waiter%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96waiter%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E5%85%B6%E5%AE%9E%E4%B8%BA%E4%B8%80%E4%B8%AA%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E8%8A%82%E7%82%B9%E3%80%82%E8%BF%99%E4%B8%AAwaiter%E5%AF%B9%E5%BA%94%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%EF%BC%8C%E5%B9%B6%E5%8F%8D%E6%98%A0%E7%BA%BF%E7%A8%8B%E5%9C%A8%E6%9F%90%E4%B8%AA%E9%94%81%E4%B8%8A%E7%9A%84%E7%AD%89%E5%BE%85%E5%85%B3%E7%B3%BB%E3%80%82%0A-%20__rt_mutex_start_proxy_lock%EF%BC%9A%E8%BF%99%E4%B8%AA%E6%98%AFPI%E7%9A%84%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%AF%B9%E5%90%84waiters%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%BB%A5%E5%8F%8A%E9%81%8D%E5%8E%86lock%E9%93%BE%E6%9D%A5%E6%A3%80%E6%9F%A5%E6%AD%BB%E9%94%81%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%8E%E4%B9%8B%E5%89%8D%E7%9A%84%E5%8E%9F%E5%AD%90%E6%A3%80%E6%9F%A5%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%94%E5%9B%9E1%E8%A1%A8%E7%A4%BA%E5%B7%B2%E7%BB%8F%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%94%E5%9B%9E0%EF%BC%8C%E5%88%99ready%20to%20wait%E3%80%82%0A-%20rt_mutex_wait_proxy_lock%EF%BC%9A%E9%80%9A%E8%BF%87__rt_mutex_start_proxy_lock%E5%A4%84%E7%90%86%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%98%E6%B2%A1%E6%9C%89%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E9%82%A3%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BC%80%E5%A7%8B%E7%AD%89%E5%BE%85%E4%BA%86%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%86%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E4%B8%BATASK_INTERRUPTIBLE%E7%8A%B6%E6%80%81%EF%BC%8C%E5%B9%B6%E5%BC%80%E5%A7%8B%E7%AD%89%E5%BE%85%E3%80%82%E8%BF%99%E5%85%B6%E9%97%B4%E4%BC%9A%E5%A4%84%E7%90%86%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E7%AD%89%E5%BE%85%EF%BC%8C%E4%B8%94%E4%BC%9A%E8%A7%A6%E5%8F%91%E8%B0%83%E5%BA%A6%E3%80%82%0A-%20rt_mutex_cleanup_proxy_lock%EF%BC%9A%E7%8E%B0%E5%9C%A8%E5%B7%B2%E7%BB%8F%E9%98%BB%E5%A1%9E%E7%BB%93%E6%9D%9F%E4%BA%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%98%E6%B2%A1%E8%8E%B7%E5%BE%97%E9%94%81%EF%BC%8C%E8%A6%81%E4%B9%88%E6%98%AF%E8%B6%85%E6%97%B6%EF%BC%8C%E8%A6%81%E4%B9%88%E6%98%AF%E5%87%BA%E9%94%99%EF%BC%8C%E6%80%BB%E4%B9%8B%E8%A6%81%E5%B0%86%E6%9C%AC%E7%BA%BF%E7%A8%8B%E4%BB%8Ewaiters%E4%B8%AD%E7%A7%BB%E9%99%A4%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%B1%E6%98%AF%E8%B5%B7%E8%BF%99%E4%B8%AA%E4%BD%9C%E7%94%A8%E3%80%82%0A%0A%23%23%23%23%20fixup_owner%0A%0A%E4%BB%8E%E6%B3%A8%E9%87%8A%E4%B8%8A%E7%9C%8B%EF%BC%8C%E6%98%AF%E4%B8%BA%E4%BA%86%E5%A4%84%E7%90%86lock%20steal%E3%80%82%E8%80%8Clock%20steal%E4%BC%BC%E4%B9%8E%E5%A4%9A%E5%8F%91%E7%94%9F%E5%9C%A8futex%20requeue%E6%93%8D%E4%BD%9C%E4%B8%8A%EF%BC%8C%E7%9B%AE%E5%89%8D%E5%B0%9A%E6%9C%AA%E4%BB%94%E7%BB%86%E7%A0%94%E7%A9%B6%E3%80%82%0A%0A%23%23%23%20futex_unlock_pi%0A%0Afutex_unlock_pi%E9%87%8A%E6%94%BEfutex%E4%BB%A5%E5%8F%8A%E6%9B%B4%E6%96%B0%E7%9B%B8%E5%BA%94%E7%9A%84pi_state%E5%92%8Crt_mutex%E7%9A%84owner%E5%AD%97%E6%AE%B5%E3%80%82%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%B1%82%E6%AC%A1%E6%AF%94%E8%BE%83%E6%B7%B1%EF%BC%8C%E5%9F%BA%E6%9C%AC%E4%B8%8A%E9%83%BD%E6%98%AF%E6%AF%8F%E4%B8%80%E5%B1%82%E5%81%9A%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%9B%B4%E6%96%B0%E5%B7%A5%E4%BD%9C%EF%BC%8C%E6%9C%80%E7%BB%88%E8%B0%83%E7%94%A8%E5%88%B0__rt_mutex_futex_unlock%E6%9D%A5%E9%87%8D%E6%96%B0%E8%B0%83%E6%95%B4%E6%9C%AC%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%B9%B6%E5%B0%86top%20waiter%E6%94%BE%E5%88%B0wake%20queue%E4%B8%8A%E3%80%82%E5%9C%A8rt_mutex_postunlock%E8%B0%83%E7%94%A8%E7%9A%84rt_mutex_postunlock%E5%B0%86%E6%96%B0%E7%BA%BF%E7%A8%8B%E5%94%A4%E9%86%92%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89waiter%EF%BC%8C%E5%88%99%E4%BD%BF%E7%94%A8%60cmpxchg_futex_value_locked%60%E6%9D%A5%E5%B0%86%E7%94%A8%E6%88%B7%E6%80%81%E5%9C%B0%E5%9D%80uaddr%E4%B8%8A%E7%9A%84%E5%80%BC%E8%AE%BE%E4%B8%BA0%E3%80%82%E5%9B%A0%E4%B8%BA%E9%94%81%E6%B2%A1%E6%9C%89waiter%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BC%98%E5%85%88%E7%BA%A7%E4%B9%9F%E4%B8%8D%E9%9C%80%E8%A6%81%E6%81%A2%E5%A4%8D%E4%BA%86%EF%BC%8C%E6%88%96%E8%80%85%E5%B7%B2%E7%BB%8F%E6%81%A2%E5%A4%8D%E8%BF%87%E4%BA%86%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%9C%89waiter%EF%BC%8C%E5%B0%B1%E4%BD%BF%E7%94%A8%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9D%A5%E5%88%87%E6%8D%A2lock%20owner%EF%BC%8C%E5%B9%B6%E6%81%A2%E5%A4%8D%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%0A%0A%23%23%23%23%20wake_futex_pi%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%81%9A%E4%BA%86%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%BB%B6%E4%BA%8B%EF%BC%9A%0A%0A1.%20%E7%94%A8cmpxchg_futex_value_locked%E5%B0%86%E7%94%A8%E6%88%B7%E6%80%81%E4%BC%A0%E5%85%A5%E7%9A%84uaddr%E5%A4%84%E7%9A%84%E6%95%B0%E5%80%BC%E6%9B%B4%E6%96%B0%E4%B8%BA%E6%96%B0%E7%9A%84%60rt_mutex_next_owner()%20%7C%20FUTEX_WAITERS%60%0A2.%20%60list_del_init(%26pi_state-%3Elist)%60%EF%BC%9A%E5%B0%86list%E4%BB%8E%E5%8E%9F%E5%85%88%E7%9A%84%E8%A1%A8%E4%B8%8A%E5%88%A0%E9%99%A4%EF%BC%8C%E5%B9%B6%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8C%E5%87%86%E5%A4%87%E7%A7%BB%E5%88%B0%E5%85%B6%E4%BB%96%E7%9A%84%E8%A1%A8%E4%B8%8A%E3%80%82%0A3.%20%60list_add(%26pi_state-%3Elist%2C%20%26new_owner-%3Epi_state_list)%60%0A4.%20%60pi_state-%3Eowner%20%3D%20new_owner%60%0A5.%20%60__rt_mutex_futex_unlock%60%0A6.%20%60rt_mutex_postunlock%60%0A%0A%23%23%23%23%20mark_wakeup_next_waiter%0A%0A%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%AD%A4%E6%97%B6pi_state-%3Eowner%E5%B7%B2%E7%BB%8F%E8%AE%BE%E7%BD%AE%E8%BF%87%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AFpi_state-%3Epi_mutex-%3Eowner%E8%BF%98%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AE%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%BB%E8%A6%81%E5%81%9A%E4%BA%86%E4%B8%8B%E9%9D%A2%E5%87%A0%E4%BB%B6%E4%BA%8B%E6%83%85%EF%BC%9A%0A%0A1.%20%60rt_mutex_dequeue_pi(current%2C%20waiter)%3B%60%0A2.%20%60rt_mutex_adjust_prio(current)%60%3A%E5%9C%A8%E8%BF%99%E9%87%8C%E8%B0%83%E6%95%B4%E4%BA%86%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%AE%8C%E6%88%90%E4%BA%86%E6%95%B4%E4%B8%AA%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E5%8D%8F%E8%AE%AE%E3%80%82%0A3.%20%60wake_q_add(wake_q%2C%20waiter-%3Etask)%60%0A%0A%23%23%23%23%20put_pi_state%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%98%AF%E6%B8%85%E7%90%86%E5%B7%A5%E4%BD%9C%3A%0A%0A1.%20%E8%B0%83%E7%94%A8%E4%BA%86%60rt_mutex_proxy_unlock%60%E6%9D%A5%E9%87%8A%E6%94%BEpi_state-%3Epi_mutex.%0A2.%20%E9%87%8A%E6%94%BE%E4%BA%86current-%3Epi_state_cache%E7%A9%BA%E9%97%B4%0A%0A%3E**cmpxchg_futex_value_locked%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C**%0A%3E%0A%3E%60%60%60c%0A%3Estatic%20int%20cmpxchg_futex_value_locked(u32%20*uval%2C%20u32%20__user%20*uaddr%2C%0A%3E%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%E2%80%BA%20%20%20%20%20%20%20%20%20u32%20oldval%2C%20u32%20newval)%0A%3E%7B%0A%3EATOMIC()%3B%0A%3Eint%20val%20%3D%20*uaddr%3B%0A%3Eif%20(val%20%3D%3D%20oldval)%20%7B%0A%3E*uaddr%20%3D%20newval%3B%0A%3E%7D%0A%3E*uval%20%3D%20val%3B%0A%3EEND_ATOMIC()%3B%0A%3Ereturn%200%3B%0A%3E%7D%0A%3E%0A%3E%E5%85%B6%E4%B8%ADATOMIC%E6%93%8D%E4%BD%9C%E9%80%9A%E8%BF%87page_disable()%E5%92%8Cpreempt_disable()%E4%BF%9D%E8%AF%81%E3%80%82%0A%3E%60%60%60%0A%0A%23%23%20__rt_mutex_start_proxy_lock%0A%0A%E4%BB%8E%E4%B8%8A%E9%9D%A2futex_lock_pi%E7%94%A8%E5%88%B0%E7%9A%84rt_mutex%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D%E4%B8%AD%E5%8F%AF%E7%9F%A5%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%98%AF%E6%95%B4%E4%B8%AAPI%E5%A4%84%E7%90%86%E7%9A%84%E6%A0%B8%E5%BF%83%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%88%E4%B8%BB%E8%A6%81%E8%B0%83%E7%94%A8task_blocks_on_rt_mutex%E6%9D%A5%E5%A4%84%E7%90%86PI%E3%80%82%0A%0A!%5B692787b6adf4be8b04b3aa57c3612c37.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5793)%0A%0A%0A%23%23%23%23%20rt_mutex_adjust_prio(owner)%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%B0%B1%E6%98%AF%E8%B0%83%E6%95%B4%E9%98%BB%E5%A1%9E%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84%E3%80%82%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E4%B9%9F%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%9A%0A%0A%60%60%60c%0Aif%20(task_has_pi_waiters(p))%0A%E2%80%BA%20%20%20pi_task%20%3D%20task_top_pi_waiter(p)-%3Etask%3B%0A%0Art_mutex_setprio(p%2C%20pi_task)%3B%0A%60%60%60%0A%0A%E6%8A%8Aowner%E7%BA%BF%E7%A8%8B%E8%AE%BE%E7%BD%AE%E4%B8%BAowner%E7%BA%BF%E7%A8%8B%E6%89%80%E6%9C%89waiter(%E5%8F%AF%E8%83%BD%E6%9D%A5%E8%87%AA%E5%A4%9A%E4%B8%AA%E9%94%81)%E7%9A%84%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%0A%0A%23%23%23%23%20rt_mutex_adjust_prio_chain%0A%0A%23%23%23%23%23%20%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E8%BF%99%E4%B8%AA%E9%93%BE%E5%BC%8F%E8%B0%83%E6%95%B4%EF%BC%9F%0A!%5Bc4badef8862a4db7fb98b88635d31ecb.png%5D(evernotecid%3A%2F%2F22617523-9521-4D00-B771-5F27B85F00EB%2Fappyinxiangcom%2F161681%2FENResource%2Fp5794)%0A%0A%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%A4%E5%BC%A0%E8%A1%A8%E6%A0%BC%EF%BC%9A%0A%0A-%20%E6%AF%8F%E4%B8%AArt_mutex%E6%9C%89%E5%BC%A0waiters%E8%A1%A8%E6%A0%BC%EF%BC%8C%E8%A1%A8%E7%A4%BA%E6%89%80%E6%9C%89%E7%AD%89%E5%BE%85%E7%9A%84%E7%BA%BF%E7%A8%8B%0A%0A-%20%E6%AF%8F%E4%B8%AAtask%E4%B9%9F%E6%9C%89%E5%BC%A0%E8%A1%A8%E6%A0%BC%EF%BC%8C%E8%A1%A8%E6%A0%BC%E9%87%8C%E7%9A%84%E6%AF%8F%E4%B8%80%E9%A1%B9%E5%AF%B9%E5%BA%94owner%E7%BA%BF%E7%A8%8B%E5%8D%A0%E6%9C%89%E7%9A%84%E9%94%81%EF%BC%8C%E6%AF%8F%E4%B8%80%E9%A1%B9%E6%98%AF%E4%B8%80%E4%B8%AArt_mutex_waiter%EF%BC%8C%E8%A1%A8%E7%A4%BA%E7%94%B3%E8%AF%B7%E8%AF%A5%E9%94%81%E7%9A%84%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7waiter%0A%0A%E5%81%87%E8%AE%BETask1%E5%B0%B1%E6%98%AFowner%EF%BC%8CTask0%E5%AF%B9Lock0%E7%9A%84%E7%94%B3%E8%AF%B7%E5%AF%BC%E8%87%B4Task1%E6%8F%90%E5%8D%87%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E5%A6%82%E6%9E%9CTask1%E5%90%8C%E6%97%B6%E8%A2%ABTask2%E6%8C%81%E6%9C%89%E7%9A%84%E6%9F%90%E4%B8%AA%E9%94%81%E9%98%BB%E5%A1%9E%EF%BC%8C%E5%88%99Task1%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E6%94%B9%E5%8F%98%EF%BC%8C%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4Task2%20pi_waiters%E5%88%97%E8%A1%A8%E6%94%B9%E5%8F%98%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4Task2%E4%BC%98%E5%85%88%E7%BA%A7%E6%94%B9%E5%8F%98%E3%80%82%E4%BE%9D%E6%AD%A4%E7%B1%BB%E6%8E%A8%EF%BC%8C%E5%B0%B1%E4%BC%9A%E5%AF%BC%E8%87%B4%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%BF%99%E7%A7%8D%E9%93%BE%E5%BC%8F%E5%8F%8D%E5%BA%94%E3%80%82%0A%0A%0A%0A%23%23%23%23%23%20%E9%93%BE%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%0A%E6%95%B4%E4%B8%AAchain%E7%9A%84%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%A4%A7%E8%87%B4%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A1.%20%E5%A6%82%E6%9E%9CTask0%E6%98%AFLock0%E7%9A%84top%20waiter%EF%BC%8C%E5%88%99%E6%BF%80%E5%8F%91%E8%AF%A5%E9%93%BE%E5%BC%8F%E8%B0%83%E6%95%B4%E3%80%82%0A2.%20%E5%9B%A0%E4%B8%BATask0%E6%88%90%E4%B8%BALock0%E7%9A%84topwaiter%EF%BC%8C%E5%88%99Task1%E7%9A%84pi_waiters%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%EF%BC%8C%E5%88%99Task1%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%E3%80%82%E9%80%80%E5%87%BA%E5%8F%AF%E8%83%BD%EF%BC%9A%0A%20%20%20%20-%20%E8%B5%B7%E7%82%B9%E9%94%81%E9%87%8A%E6%94%BE%E4%BA%86%0A%0A%20%20%20%20-%20%E9%93%BE%E7%9A%84%E5%BD%93%E5%89%8D%E7%8E%AF%E8%8A%82%E8%A2%AB%E6%9B%B4%E6%94%B9(%20next_lock%20%E2%89%A0waiter-%3Elock)%0A%0A%20%20%20%20-%20Task1%E6%B2%A1%E6%9C%89%E5%8D%A0%E9%94%81%0A3.%20%E5%A6%82%E6%9E%9CTask1%E4%B9%9Fwait%E5%9C%A8%E6%9F%90%E4%B8%AAlock%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%88%99%E8%AF%A5lock%E7%9A%84waiters%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4%EF%BC%8C%E8%BF%99%E9%87%8C%E6%9C%89%E8%8B%A5%E5%B9%B2%E7%A7%8D%E9%80%80%E5%87%BA%E5%8F%AF%E8%83%BD%E3%80%82%0A%0A%20%20-%20Task1%E6%B2%A1%E6%9C%89%E8%A2%ABblock%0A%20%20-%20Task1%20pi_waiters%E4%B8%AD%E6%9C%89%E4%BC%98%E5%85%88%E7%BA%A7%E9%AB%98%E4%BA%8ETask0%E7%9A%84waiter%EF%BC%8C%E6%8D%A2%E5%8F%A5%E8%AF%9D%E8%AF%B4%EF%BC%8Clock0%E7%9A%84top_waiter%E4%B8%8D%E6%98%AFTask1%E7%9A%84top%20pi_waiter%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E7%BB%A7%E6%89%BF%E4%B8%8D%E9%9C%80%E8%A6%81%E7%BB%A7%E7%BB%AD%E4%BC%A0%E9%80%92%20%0A%20%20-%20%E5%A6%82%E6%9E%9CTask1%E5%9C%A8%E7%94%B3%E8%AF%B7Lock1%20%E7%9A%84%E6%97%B6%E5%80%99%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88%E8%BF%99%E4%B8%AA%E8%AE%B0%E5%BD%95%E5%9C%A8waiter-%3Eprio%E9%87%8C%EF%BC%89%E4%B8%8E%E5%BD%93%E5%89%8D%E8%B0%83%E6%95%B4%E5%90%8E%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E7%9B%B8%E7%AD%89%EF%BC%8C%E5%88%99%E5%90%8E%E7%BB%AD%E6%B2%A1%E5%BF%85%E8%A6%81%E5%9C%A8%E7%BB%A7%E7%BB%AD%E8%B0%83%E6%95%B4%E4%BC%98%E5%85%88%E7%BA%A7%0A%20%20-%20%E6%A3%80%E6%B5%8B%E5%88%B0DEADLOCK%0A4.%20%E5%9B%9E%E5%88%B01%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%EF%BC%8C%E7%9B%B4%E5%88%B0%E9%80%80%E5%87%BA%E9%93%BE%E5%BC%8F%E5%A4%84%E7%90%86%0A%0A%23%23%23%23%23%20%E6%AD%BB%E9%94%81%0A%0A%E6%9C%893%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%8C%E5%87%BD%E6%95%B0%E4%BC%9A%E8%BF%94%E5%9B%9E%E6%AD%BB%E9%94%81%0A%0A-%20%E9%93%BE%E4%B8%8A%E8%B6%85%E8%BF%871024%E4%B8%AA%E9%94%81%E8%8A%82%E7%82%B9%0A-%20%E9%93%BE%E4%B8%8A%E4%BB%BB%E6%84%8FTask%E8%8A%82%E7%82%B9%E7%94%B3%E8%AF%B7%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%94%81%E8%8A%82%E7%82%B9%EF%BC%8C%E5%8D%B3Lock0%0A-%20%E9%93%BE%E4%B8%8A%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E9%94%81owner%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AATask%E8%8A%82%E7%82%B9%EF%BC%8C%E5%8D%B3Task0%0A%0A%0A%23%23%20%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%0A%0A%5C%5B1%5D%20%5BMutex%20mutandis%3A%20understanding%20mutex%20types%20and%20attributes%5D.%20(http%3A%2F%2F2net.co.uk%2Ftutorial%2Fmutex_mutandis)%0A%0A%5C%5B2%5D%20%5BPOSIX%20Revision%20of%20IEEE%20Std%201003.1-2008%5D(http%3A%2F%2Fpubs.opengroup.org%2Fonlinepubs%2F9699919799%2Ffunctions%2Fcontents.html)%0A%0A%5C%5B3%5D%20%5BSource%20code%20analysis%20of%20pthread_mutex_lock%5D(https%3A%2F%2Fzihan.me%2F2018%2F08%2F15%2Fsource-code-analysis-pthread-mutex-lock%2F)%0A%0A%5C%5B4%5D%20%5Blinux%20pi_futex%E6%B5%85%E6%9E%90%5D(https%3A%2F%2Fyq.aliyun.com%2Farticles%2F6044)%0A%0A%5C%5B5%5D%20Linux%204.20-rc3%20source%20code%0A%0A%5C%5B6%5D%20glibc%202.28%20source%20code%0A&lt;/center&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2013/02/16/swap_cache/</guid>
            <title>swap cache</title>
            <link>https://blog.zhougy.top/2013/02/16/swap_cache/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sat, 16 Feb 2013 12:14:01 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;span style=&#34;line-height: 22.390625px; background-color: rgb(255, 255, 255);&#34;&gt;1.&amp;#x4EC0;&amp;#x4E48;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;swap&amp;#xFF1F;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x6362;&amp;#x51FA;&lt;span style=&#34;line-height: 22px;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5F53;&amp;#x5185;&amp;#x6838;&amp;#x5728;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x65F6;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;__alloc_pages&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x7A7A;&amp;#x95F2;&amp;#x9875;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x4F1A;&amp;#x542F;&amp;#x52A8;&amp;#x9875;&amp;#x9762;&amp;#x4EA4;&amp;#x6362;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;try_to_free_pages&amp;#x3002;&amp;#x4EE3;&amp;#x7801;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1293 &amp;#xA0; &amp;#xA0;page = get_page_from_freelist(gfp_mask, order,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1294&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zonelist, ALLOC_NO_WATERMARKS);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1295&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (page)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1296&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto got_pg;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1306 &amp;#xA0; &amp;#xA0;if (!w ait)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1307&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto nopage;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1316&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1317&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; did_some_progress = try_to_free_pages(zonelist-&amp;gt;zones, gfp_mask);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5206;&amp;#x914D;&amp;#x8005;&amp;#x5141;&amp;#x8BB8;&amp;#x7B49;&amp;#x5F85;&amp;#xFF0C;&amp;#x5219;&amp;#x4F1A;&amp;#x5F00;&amp;#x59CB;&amp;#x56DE;&amp;#x6536;&amp;#x9875;&amp;#x9762;&amp;#x3002;&amp;#x518D;&amp;#x5F80;&amp;#x4E0B;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x5173;&amp;#x7CFB;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;try_to_free_pages-&amp;gt;shrink_zones-&amp;gt;shrink_zone-&amp;gt;shrink_inactive_list-&amp;gt;add_to_swap-&amp;gt;pageout-&amp;gt;(swapper_space.a_ops-&amp;gt;writepage)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6700;&amp;#x7EC8;&amp;#x8C03;&amp;#x7528;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x5C06;page&amp;#x5199;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4EA4;&amp;#x6362;&amp;#x5206;&amp;#x533A;&amp;#x7684;swap file&amp;#x4E0A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;&amp;#x6362;&amp;#x5165;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5F53;&amp;#x5F15;&amp;#x53D1;&amp;#x7F3A;&amp;#x9875;&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x8C03;&amp;#x7528;handle_pte_fault&amp;#xFF0C;&amp;#x5F53;&amp;#x68C0;&amp;#x6D4B;&amp;#x5230;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;!pte_present(entry) &amp;lt;=&amp;gt; (pte_val(pte) &amp;amp; L_PTE_PRESENT == 0)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6B64;&amp;#x65F6;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;do_swap_page-&amp;gt;read_swap_cache_async-&amp;gt;swap_readpage&amp;#x6765;&amp;#x8BFB;&amp;#x5165;&amp;#x6362;&amp;#x51FA;&amp;#x7684;&amp;#x9875;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x65B0;&amp;#x7684;&amp;#x4E00;&amp;#x9875;&amp;#xFF0C;&amp;#x539F;&amp;#x5148;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x4F1A;&amp;#x91CA;&amp;#x653E;&amp;#x6210;hot page&amp;#x5230;&amp;#x4F19;&amp;#x4F34;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.swap&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap&amp;#x5C31;&amp;#x662F;&amp;#x4EA4;&amp;#x6362;&amp;#xFF0C;&amp;#x6BCF;&amp;#x6B21;&amp;#x9700;&amp;#x8981;&amp;#x4EA4;&amp;#x6362;&amp;#x54EA;&amp;#x4E9B;&amp;#xFF0C;&amp;#x548C;linux&amp;#x7684;&amp;#x9875;&amp;#x56DE;&amp;#x6536;&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8457;&amp;#x540D;&amp;#x7684;LRU&amp;#x7B97;&amp;#x6CD5;&amp;#xFF0C;&amp;#x6709;&amp;#x4E9B;&amp;#x76F8;&amp;#x4F3C;&amp;#x3002;&amp;#x5F7C;&amp;#x662F;&amp;#x51B3;&amp;#x5B9A;&amp;#x8981;&amp;#x56DE;&amp;#x6536;&amp;#x54EA;&amp;#x4E9B;&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x6211;&amp;#x4EEC;&amp;#x4E5F;&amp;#x63D0;&amp;#x5230;&amp;#x8FC7;LRU&amp;#x8FD9;&amp;#x4E2A;&amp;#x540D;&amp;#x8BCD;&amp;#x3002;&amp;#x73B0;&amp;#x5728;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x4ED6;&amp;#x5230;&amp;#x5E95;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x4EC0;&amp;#x4E48;&amp;#x6837;&amp;#x7684;&amp;#x7B97;&amp;#x6CD5;&amp;#x4E86;&amp;#x3002;LRU = Least Recently Used&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;a href=&#34;http://blog.csdn.net/antfang/article/details/5751786&#34;&gt;LRU&amp;#x7B97;&amp;#x6CD5;&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4EA4;&amp;#x6362;&amp;#x7B97;&amp;#x6CD5;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5BF9;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x65B0;&amp;#x65E7;&amp;#x7A0B;&amp;#x5EA6;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x5F04;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x77E5;&amp;#x9053;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;list&amp;#xFF1A;active_list &amp;amp; inactive_list&amp;#x3002;&amp;#x6BCF;&amp;#x6B21;try_to_free_pages&amp;#x5728;&amp;#x4EA4;&amp;#x6362;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C06;active page&amp;#x653E;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x5230;inactive list&amp;#xFF0C;&amp;#x518D;&amp;#x5C06;inactive page&amp;#x91CA;&amp;#x653E;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x3002;&amp;#x5176;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x662F;&amp;#x4E0A;&amp;#x9762;&amp;#x63D0;&amp;#x5230;&amp;#x7684;shrink_zone&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&amp;#x6765;&amp;#x770B;try_to_free_pages&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;for (priority = DEF_PRIORITY; priority &amp;gt;= 0; priority--) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nr_reclaimed += shrink_zones(priority, zones, &amp;amp;sc);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;shrink_slab(sc.nr_scanned, gfp_mask, lru_pages);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;priority&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x5176;&amp;#x5B9E;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;&amp;#x6BCF;&amp;#x6B21;&amp;#x5C3D;&amp;#x91CF;&amp;#x5C11;&amp;#x7684;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FDD;&amp;#x8BC1;&amp;#x901F;&amp;#x7387;&amp;#x3002;&amp;#x5230;shrink_zone&amp;#x91CC;&amp;#x9762;&amp;#x6709;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;font color=&#34;#2D4FC9&#34;&gt;zone-&amp;gt;nr_scan_active +=&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;(zone_page_state(zone, NR_ACTIVE) &amp;gt;&amp;gt; priority) + 1;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E00;&amp;#x6BB5;&amp;#x6211;&amp;#x4E00;&amp;#x5EA6;&amp;#x770B;&amp;#x4E86;&amp;#x597D;&amp;#x4E45;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4E0D;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x6B7B;&amp;#x3002;&amp;#x4ED6;&amp;#x53EA;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E00;&amp;#x6B65;&amp;#x6B65;&amp;#x589E;&amp;#x52A0;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&amp;#x5F53;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;priority&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;= 12~1&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x626B;&amp;#x63CF;&amp;#x6570;&amp;#x91CF;&amp;#x6BCF;&amp;#x6B21;&amp;#x589E;&amp;#x52A0;zone-&amp;gt;nr_active/(2^priority)&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x5230;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;priority&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;=1&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&lt;/span&gt;nr_scan_active&amp;#x4ECD;&amp;#x7136;&amp;#x6CA1;&amp;#x8FBE;&amp;#x5230;sc-&amp;gt;swap_cluster_max&amp;#xFF08;32&amp;#xFF09;&amp;#x7684;&amp;#x8BDD;&amp;#xFF0C;&amp;#x5373;scan&amp;#x7684;&amp;#x603B;&amp;#x6570;&amp;#x7684;&amp;#x7406;&amp;#x8BBA;&amp;#x503C;&amp;#x4E3A;zone-&amp;gt;nr_active*(1-1/(2^12))&amp;#xFF0C;&amp;#x5219;priority=0&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;scan&amp;#x603B;&amp;#x6570;&amp;#x5C06;&amp;#x8D85;&amp;#x8FC7;zone-&amp;gt;nr_active&amp;#x7684;&amp;#x603B;&amp;#x6570;&amp;#x3002;&amp;#x90A3;&amp;#x662F;&amp;#x4E0D;&amp;#x662F;&amp;#x5C31;&amp;#x6709;&amp;#x95EE;&amp;#x9898;&amp;#x4E86;&amp;#x5462;&amp;#xFF1F;&amp;#x5F53;&amp;#x7136;&amp;#x4E0D;&amp;#x662F;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x540E;&amp;#x9762;&amp;#x518D;&amp;#x505A;&amp;#x9875;&amp;#x9762;&amp;#x8F6C;&amp;#x79FB;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x68C0;&amp;#x6D4B;&amp;#x6807;&amp;#x51C6;&amp;#x662F;list_empty&amp;#xFF0C;&amp;#x4E0D;&amp;#x4F1A;&amp;#x64CD;&amp;#x4F5C;&amp;#x8D85;&amp;#x8FC7;&amp;#x5217;&amp;#x8868;&amp;#x8303;&amp;#x56F4;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;shrink_zone&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/* &amp;#x6839;&amp;#x636E;priority&amp;#x6765;&amp;#x51B3;&amp;#x5B9A;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#xFF0C;inactive&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x91C7;&amp;#x7528;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x83B7;&amp;#x5F97;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;* &amp;#x81F3;&amp;#x5C11;&amp;#x8981;&amp;#x4FDD;&amp;#x8BC1;sc-&amp;gt;swap_cluster_max&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x5373;32&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;*/&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;918&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;nr_scan_active +=&lt;br&gt;919&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; (zone_page_state(zone, NR_ACTIVE) &amp;gt;&amp;gt; priority) + 1;&lt;br&gt;920&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_active = zone-&amp;gt;nr_scan_active;&lt;br&gt;921&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (nr_active &amp;gt;= sc-&amp;gt;swap_cluster_max)&lt;br&gt;922&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;nr_scan_active = 0;&lt;br&gt;923&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;br&gt;924&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_active = 0;&lt;br&gt;925&lt;br&gt;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;br&gt;933&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;nr_active: &amp;#x4ECE;active&amp;#x8F6C;&amp;#x5230;inactive&amp;#x5217;&amp;#x8868;&amp;#x4E0A;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6570;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;nr_inactive: &amp;#x4ECE;inactive&amp;#x5217;&amp;#x8868;&amp;#x6362;&amp;#x51FA;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6570;&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;934&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; while (nr_active || nr_inactive) {&lt;br&gt;935&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (nr_active) {&lt;br&gt;936&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_to_scan = min(nr_active,&lt;br&gt;937&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; (unsigned long)sc-&amp;gt;swap_cluster_max);&lt;br&gt;938&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_active -= nr_to_scan;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;939&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; shrink_active_list(nr_to_scan, zone, sc, priority);&lt;br&gt;940&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;941&lt;br&gt;942&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (nr_inactive) {&lt;br&gt;943&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_to_scan = min(nr_inactive,&lt;br&gt;944&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; (unsigned long)sc-&amp;gt;swap_cluster_max);&lt;br&gt;945&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_inactive -= nr_to_scan;&lt;br&gt;946&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; nr_reclaimed += shrink_inactive_list(nr_to_scan, zone,&lt;br&gt;947&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sc);&lt;br&gt;948&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;949&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3&amp;#xFF09;shrink_inactive_list&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5DF2;&amp;#x7ECF;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;shrink_inactive_list&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x626B;&amp;#x63CF;&amp;#x4F20;&amp;#x5165;&amp;#x7684;nr_to_scan&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x518D;&amp;#x5C06;&amp;#x5408;&amp;#x9002;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6362;&amp;#x51FA;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#xFF0C;&amp;#x5E76;&amp;#x8FD4;&amp;#x56DE;&amp;#x6362;&amp;#x51FA;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x6570;&amp;#x3002;&amp;#x5176;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027008&#34; hash=&#34;0d7d10ac0843681ee240a2949d8e2eef&#34; align alt longdesc width=&#34;768&#34; height=&#34;306&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x662F;&amp;#x4E0D;&amp;#x662F;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x6CA1;&amp;#x9519;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x8FD9;&amp;#x4E48;&amp;#x7B80;&amp;#x5355;&amp;#x3002;isolate_lru_pages&amp;#x8D1F;&amp;#x8D23;&amp;#x626B;&amp;#x63CF;&amp;#x9875;&amp;#x9762;&amp;#x7684;struct page&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&amp;#x5176;flags&amp;#x6765;&amp;#x51B3;&amp;#x5B9A;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x4EE5;&amp;#x6362;&amp;#x51FA;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x6362;&amp;#x51FA;&amp;#x7684;&amp;#x653E;&amp;#x5230;&amp;#x8F93;&amp;#x51FA;&amp;#x5217;&amp;#x8868;&amp;#x4E0A;&amp;#xFF0C;&amp;#x4EE5;&amp;#x5907;shrink_page_list&amp;#x6765;&amp;#x505A;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x6362;&amp;#x51FA;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;4&amp;#xFF09;shrink_page_list&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5176;&amp;#x4E3B;&amp;#x7EBF;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027018&#34; hash=&#34;16f5dc62bc972f71ccf3912bd9d6bff5&#34; align alt longdesc width=&#34;584&#34; height=&#34;782&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E00;&amp;#x7CFB;&amp;#x5217;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x9875;&amp;#x9762;&amp;#x6362;&amp;#x51FA;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x7528;__pagevec_release_nonlru(&amp;amp;freed_pvec)&amp;#x5C06;&amp;#x9875;&amp;#x9762;&amp;#x91CA;&amp;#x653E;&amp;#x56DE;buddy system&amp;#xFF0C;&amp;#x6CE8;&amp;#x610F;&amp;#x5728;&amp;#x521B;&amp;#x5EFA;freed_pvec&amp;#x65F6;&amp;#xFF0C;&amp;#x6307;&amp;#x5B9A;&amp;#x4E86;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x4E3A;cold&amp;#x3002;&amp;#x6574;&amp;#x4E2A;&amp;#x7B97;&amp;#x6CD5;&amp;#x7684;&amp;#x7CBE;&amp;#x9AD3;&amp;#xFF0C;&amp;#x5728;&amp;#x4E8E;&amp;#x54EA;&amp;#x4E9B;inactive&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x4E0D;&amp;#x53EF;&amp;#x4EE5;&amp;#x6362;&amp;#x51FA;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5148;&amp;#x770B;&amp;#xFF0C;shrink_page_list&amp;#x4E2D;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x6807;&amp;#x53F7;&lt;/div&gt;&lt;div&gt;keep&amp;#xFF1A;&amp;#x76F4;&amp;#x63A5;&amp;#x5C06;&amp;#x9875;&amp;#x9762;add&amp;#x56DE;page_list&lt;/div&gt;&lt;div&gt;keep_locked&amp;#xFF1A;&amp;#x6307;&amp;#x8BE5;&amp;#x9875;&amp;#x9762;&amp;#x5DF2;&amp;#x7ECF;&amp;#x88AB;lock&amp;#x4E86;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x89E3;&amp;#x9501;&amp;#x518D;&amp;#x8FDB;&amp;#x5165;keep&amp;#x6807;&amp;#x53F7;&lt;/div&gt;&lt;div&gt;activate_locked&amp;#xFF1A;&amp;#x5C06;&amp;#x9875;&amp;#x9762;&amp;#x6FC0;&amp;#x6D3B;&amp;#xFF0C;&amp;#x518D;&amp;#x653E;&amp;#x56DE;page_list&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5728;&amp;#x540E;&amp;#x7EED;&amp;#xFF0C;&amp;#x8BE5;&amp;#x9875;&amp;#x9762;&amp;#x4F1A;&amp;#x88AB;&amp;#x653E;&amp;#x5165;active list&lt;/div&gt;&lt;div&gt;free_it&amp;#xFF1A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x662F;&amp;#x6B63;&amp;#x5E38;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x9875;&amp;#x9762;&amp;#x4F1A;&amp;#x88AB;&amp;#x91CA;&amp;#x653E;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8FDB;&amp;#x5165;&amp;#x626B;&amp;#x63CF;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x4EE5;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#xFF0C;&amp;#x51E1;&amp;#x662F;&amp;#x7ECF;&amp;#x8FC7;&amp;#x5224;&amp;#x65AD;&amp;#x540E;&amp;#xFF0C;&amp;#x8981;&amp;#x8C03;&amp;#x8F6C;&amp;#x5230;&amp;#x4EE5;&amp;#x4E0A;&amp;#x524D;&amp;#x4E09;&amp;#x4E2A;&amp;#x6807;&amp;#x53F7;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E9B;&amp;#x9875;&amp;#x9762;&amp;#x90FD;&amp;#x662F;&amp;#x4E0D;&amp;#x4F1A;&amp;#x88AB;&amp;#x6362;&amp;#x51FA;&amp;#x91CA;&amp;#x653E;&amp;#x7684;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x6709;&amp;#x4EE5;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E9B;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a.&amp;#xA0;!sc-&amp;gt;may_swap &amp;amp;&amp;amp; page_mapped(page)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b.&amp;#xA0;PageWriteback(page)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;c.&amp;#xA0;PageDirty(page) &amp;amp;&amp;amp;&amp;#xA0;page_referenced(page, 1)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;d.&amp;#xA0;PageDirty(page) &amp;amp;&amp;amp;&amp;#xA0;!may_enter_fs&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;e.&amp;#xA0;PageDirty(page) &amp;amp;&amp;amp;&amp;#xA0;!sc-&amp;gt;may_writepage&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x63A5;&lt;a href=&#34;https://www.google.com.hk/url?sa=t&amp;amp;amp;rct=j&amp;amp;amp;q=&amp;amp;amp;esrc=s&amp;amp;amp;source=web&amp;amp;amp;cd=2&amp;amp;amp;ved=0CD4QFjAB&amp;amp;amp;url=%68%74%74%70%3a%2f%2f%77%77%77%2e%34%75%63%6f%64%65%2e%63%6f%6d%2f%53%74%75%64%79%2f%54%6f%70%69%63%2f%31%34%37%33%37%35%34&amp;amp;amp;ei=uoIkUcrgKIiuiQeZ8YDoCA&amp;amp;amp;usg=AFQjCNEOl8IlmiO6gZG3632d58gOlDaxkA&amp;amp;amp;sig2=7PgH7HVDHgF5OF-ko0qESA&#34; target=&#34;_blank&#34;&gt;Linux&amp;#x8FDB;&amp;#x7A0B;&amp;#x8C03;&amp;#x5EA6;&amp;#x5207;&amp;#x6362;&amp;#x548C;&amp;#x865A;&amp;#x62DF;&amp;#x7A7A;&amp;#x95F4;&amp;#x7BA1;&amp;#x7406;&amp;#x6DF1;&amp;#x5165;&amp;#x5206;&amp;#x6790;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x591A;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;page-&amp;gt;mapping&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;page_mapping, page_mapped&amp;#x3002;&amp;#x7B80;&amp;#x5355;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E00;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x5176;&amp;#x53D6;&amp;#x503C;&amp;#x6709;&amp;#x4EE5;&amp;#x4E0B;&amp;#x4E09;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x3002;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x63A5;&lt;a href=&#34;http://blog.chinaunix.net/uid-24517893-id-404640.html&#34;&gt;Linux&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x4E2D;address_space&amp;#x7591;&amp;#x60D1;&amp;#x53CA;&amp;#x89E3;&amp;#x7B54;&lt;/a&gt;&lt;span&gt;&amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;#xFF08;1&amp;#xFF09;swapper_space&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span&gt;&amp;#x5982;&amp;#x679C;page-&amp;gt;mapping&amp;#x7B49;&amp;#x4E8E;0&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x8BE5;&amp;#x9875;&amp;#x5C5E;&amp;#x4E8E;&amp;#x4EA4;&amp;#x6362;&amp;#x544A;&amp;#x8BC9;&amp;#x7F13;&amp;#x5B58;swap cache&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;#xFF08;2&amp;#xFF09;anon_vma&amp;#xFF1A;&amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span&gt;&amp;#x5982;&amp;#x679C;page-&amp;gt;mapping&amp;#x4E0D;&amp;#x7B49;&amp;#x4E8E;0&amp;#xFF0C;&amp;#x4F46;&amp;#x7B2C;0&amp;#x4F4D;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x8BE5;&amp;#x9875;&amp;#x4E3A;&amp;#x533F;&amp;#x540D;&amp;#x4E5F;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;mapping&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;struct anon_vma&amp;#x7ED3;&amp;#x6784;&amp;#x53D8;&amp;#x91CF;&amp;#xFF1B;&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;#xFF08;3&amp;#xFF09;address_space&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span&gt;&amp;#x5982;&amp;#x679C;page-&amp;gt;mapping&amp;#x4E0D;&amp;#x7B49;&amp;#x4E8E;0&amp;#xFF0C;&amp;#x4F46;&amp;#x7B2C;0&amp;#x4F4D;&amp;#x4E0D;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x5219;mapping&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;struct address_space&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x7ED3;&amp;#x6784;&amp;#x53D8;&amp;#x91CF;&amp;#xFF1B;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;5&amp;#xFF09;swap cache&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0A;&amp;#x9762;&amp;#x7B80;&amp;#x8FF0;&amp;#x4E86;linux&amp;#x9875;&amp;#x7F13;&amp;#x51B2;&amp;#x4EA4;&amp;#x6362;&amp;#x673A;&amp;#x5236;&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x56DE;&amp;#x5230;swap cache&amp;#x8FD9;&amp;#x4E00;&amp;#x57FA;&amp;#x672C;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0A;&amp;#x6765;&amp;#x3002;gorman&amp;#x7684;&amp;#x4E66;&amp;#x91CC;&amp;#x9762;&amp;#x8BB2;&amp;#x5F97;&amp;#x5F88;&amp;#x6E05;&amp;#x695A;&amp;#x4E86;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x7B14;&amp;#x8BB0;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-size: 15px;&#34;&gt;&lt;i&gt;&lt;font color=&#34;#FA7A00&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6709;swap cache&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E1C;&amp;#x897F;&amp;#xFF1F;&lt;/font&gt;&lt;/i&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x56E0;&amp;#x4E3A;A signi&amp;#xFB01;cant number of the&amp;#xA0;pages referenced by a process early in its life may only be used for initialization and&amp;#xA0;then never used again. It is better to swap out those pages and create more disk&lt;/div&gt;bu&amp;#xFB00;ers than leave them resident and unused.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &lt;span style=&#34;font-size: 15px;&#34;&gt;&lt;i&gt;&lt;font color=&#34;#FA7A00&#34;&gt;&amp;#xA0;swap cache vs. page cache&lt;/font&gt;&lt;/i&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;The swap cache is purely&amp;#xA0;conceptual because it is simply a specialization of the page cache.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1.&amp;#xA0;in the swap cache rather than the page cache is&amp;#xA0;that pages in the swap cache always use swapper space as their address space in&amp;#xA0;page&amp;#x2192;mapping.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2.&amp;#xA0;pages are added to the swap cache&amp;#xA0;with add_to_swap_cache(),shown in Figure 11.3, instead of add_to_page_cache().&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(250, 122, 0); font-size: 15px;&#34;&gt;&lt;font color=&#34;#000000&#34; size=&#34;3&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x6709;&amp;#x7684;swap file&amp;#x4FE1;&amp;#x606F;&amp;#x90FD;&amp;#x4FDD;&amp;#x5B58;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;static struct swap_info_struct swap_info[MAX_SWAPFILES];&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EF;&amp;#x89C1;swap file&amp;#x6700;&amp;#x591A;&amp;#x53EF;&amp;#x4EE5;&amp;#x6709;MAX_SWAPFILES&amp;#x4E2A;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;32&amp;#x4E2A;&amp;#x3002;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;64 struct swap_info_struct {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;65 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int flags;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;66 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;kdev_t swap_device;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;67 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;spinlock_t sdev_lock;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;68 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;struct dentry * swap_file;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;69 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;struct vfsmount *swap_vfsmnt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;70 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned short * swap_map;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;71 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int lowest_bit;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;72 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int highest_bit;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;73 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int cluster_next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;74 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned int cluster_nr;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;75 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;int prio;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;76 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;int pages;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;77 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;unsigned long max;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;78 &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;int next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;79 };&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap_info&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x865A;&amp;#x62DF;&amp;#x94FE;&amp;#x8868;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x7528;next&amp;#x6307;&amp;#x5411;&amp;#x4E86;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x94FE;&amp;#x8868;&amp;#x6210;&amp;#x5458;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x53F7;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x8868;&amp;#x540C;&amp;#x65F6;&amp;#x7528;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x63CF;&amp;#x8FF0;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x6307;&amp;#x660E;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;&amp;#x94FE;&amp;#x8868;&amp;#x7684;&amp;#x5934;&amp;#x5728;&amp;#x54EA;&amp;#x91CC;&amp;#xFF0C;&amp;#x5176;&amp;#x8868;&amp;#x5C3E;&amp;#x6210;&amp;#x5458;&amp;#x7684;next = -1&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;153 struct swap_list_t {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;154 &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;/font&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;int head; /* head of priority-ordered swapfile list */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;155 &amp;#xA0; &amp;#xA0; int next; /* swapfile to be used next */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;156 };&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap area&amp;#x7531;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;swap_info_struct&amp;#x63CF;&amp;#x8FF0;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x547D;&amp;#x4EE4;&amp;#x52A8;&amp;#x6001;&amp;#x7684;&amp;#x589E;&amp;#x52A0;&amp;#x3002;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;swap area&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;swap file&amp;#xFF0C;&amp;#x8BE5;file&amp;#x88AB;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;page size&amp;#x7684;slot&amp;#xFF0C;&amp;#x7B2C;0&amp;#x4E2A;slot&amp;#x88AB;&amp;#x7528;&amp;#x6765;&amp;#x5B58;&amp;#x50A8;swap_header&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;25 union swap_header {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;26&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;struct&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;27&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;28&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;char reserved[PAGE_SIZE - 10];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;29&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;char magic[10];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;30&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;} magic;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;31&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;struct&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;32&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;33&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;char bootbits[1024];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;34&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int version;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;35&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int last_page;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;36&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int nr_badpages;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;37&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int padding[125];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;38&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;unsigned int badpages[1];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;39&amp;#xA0;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;} info;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;40 };&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6DFB;&amp;#x52A0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;padding&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x80FD;&amp;#x548C;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;cluster&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;badpages&amp;#x6570;&amp;#x7EC4;&amp;#x9650;&amp;#x5236;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;swap area&amp;#x7684;&amp;#x9875;&amp;#x6570;&amp;#xFF0C;&amp;#x5176;&amp;#x5C3A;&amp;#x5BF8;&amp;#x7531;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x516C;&amp;#x5F0F;&amp;#x5F97;&amp;#x5230;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x6307;&amp;#x5411;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;page&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027013&#34; hash=&#34;14fe0b7c21d8c7aa9f25c571de57b141&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;swap cache&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x53EB;&amp;#x505A;swp_entry_t&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;unsigned long&amp;#x3002;&amp;#x5F53;&amp;#x9875;&amp;#x9762;&amp;#x88AB;&amp;#x6362;&amp;#x51FA;&amp;#x65F6;&amp;#xFF0C;&amp;#x5176;&amp;#x539F;&amp;#x5148;&amp;#x7684;&amp;#x9875;&amp;#x8868;&amp;#x9879;pte&amp;#x88AB;&amp;#x7528;&amp;#x4E8E;&amp;#x5B58;&amp;#x50A8;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x3002;&amp;#x901A;&amp;#x8FC7;&amp;#x8FD9;&amp;#x4E2A;swp_entry_t&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x53EF;&amp;#x4EE5;&amp;#x5B9A;&amp;#x4F4D;&amp;#x5230;&amp;#x8BE5;&amp;#x9875;&amp;#x6570;&amp;#x636E;&amp;#x88AB;&amp;#x5199;&amp;#x5230;&amp;#x54EA;&amp;#x4E2A;swap area&amp;#x7684;&amp;#x54EA;&amp;#x4E2A;&amp;#x4F4D;&amp;#x7F6E;&amp;#x3002;&amp;#x5176;&amp;#x7EC4;&amp;#x6210;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/swap cache/1537085027021&#34; hash=&#34;bf705025623bd89201ec33f566eb4063&#34; align alt longdesc width=&#34;701&#34; height=&#34;306&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;Type&amp;#x6307;&amp;#x5F15;&amp;#x4E86;&amp;#x54EA;&amp;#x4E2A;swap area&amp;#xFF0C;offset&amp;#x6307;&amp;#x5F15;&amp;#x4E86;&amp;#x8BE5;&amp;#x9875;&amp;#x5728;swap_map&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x7684;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x6539;offset&amp;#x7B97;&amp;#x5F97;swap file&amp;#x4E2D;&amp;#x7684;sector&amp;#x4F4D;&amp;#x7F6E;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;(swapper_space.a_ops-&amp;gt;swap_writepage) -&amp;gt;&amp;#xA0;get_swap_bio -&amp;gt;&amp;#xA0;map_swap_page&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;938&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;for ( ; ; ) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;939&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head *lh;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;940&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/*&amp;#x4E00;&amp;#x76F4;&amp;#x5FAA;&amp;#x73AF;&amp;#x5230;offset&amp;#x843D;&amp;#x5728;&amp;#x8BE5;sector&amp;#x4E2D;*/&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;941&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (se-&amp;gt;start_page &amp;lt;= offset &amp;amp;&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;942&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; offset &amp;lt; (se-&amp;gt;start_page + se-&amp;gt;nr_pages)) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;943&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return se-&amp;gt;start_block + (offset - se-&amp;gt;start_page);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;944&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;945&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; lh = se-&amp;gt;list.next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;946&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (lh == &amp;amp;sis-&amp;gt;extent_list)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;947&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; lh = lh-&amp;gt;next;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;948&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; se = list_entry(lh, struct swap_extent, list);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;949&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sis-&amp;gt;curr_swap_extent = se;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;951&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x90A3;&amp;#x4E48;&amp;#x8FD9;&amp;#x4E2A;swap_entry_t&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x6765;&amp;#x7684;&amp;#xFF1F;&amp;#x5176;&amp;#x5B9E;&amp;#x4E5F;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5728;swap_map&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x6328;&amp;#x4E2A;&amp;#x627E;&amp;#xFF0C;first fit&amp;#x6CD5;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x5177;&amp;#x4F53;&amp;#x8FD8;&amp;#x6709;&amp;#x4E9B;&amp;#x6280;&amp;#x5DE7;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5728;&amp;#x641C;&amp;#x7D22;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x6309;&amp;#x7167;cluster&amp;#x7684;&amp;#x8303;&amp;#x56F4;&amp;#x5BFB;&amp;#x627E;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5FAA;&amp;#x73AF;&amp;#x76F4;&amp;#x5230;&amp;#x627E;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x7A7A;&amp;#x7684;cluster&amp;#xFF08;256&amp;#x4E2A;&amp;#x7B49;&amp;#x4E8E;0&amp;#x7684;swap_map&amp;#x6210;&amp;#x5458;&amp;#xFF09;&amp;#x4E3A;&amp;#x6B62;&amp;#xFF0C;&amp;#x76EE;&amp;#x7684;&amp;#x662F;to have pages swapped out at the same time close together on the premise that&amp;#xA0;pages swapped out together are related&amp;#xA0;&amp;#x3002;&lt;div&gt;&lt;span style=&#34;font-family: song, Verdana; font-size: 14px; line-height: 22.390625px; background-color: rgb(255, 255, 255);&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;song, Verdana&#34;&gt;&lt;span style=&#34;font-size: 14px; line-height: 22px;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89-_kmem_cache_create/</guid>
            <title>slab allocator （2）—— kmem_cache_create</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89-_kmem_cache_create/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 20:54:16 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x662F;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x4E4B;&amp;#x4E00;&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;kmalloc&amp;#x7684;&amp;#x540E;&amp;#x76FE;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4F5C;&amp;#x4E3A;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x4F9B;&amp;#x9A71;&amp;#x52A8;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x770B;ldd3&amp;#x7684;chp 8&amp;#x7684;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x4E00;&amp;#x8282;&amp;#xFF08;P217&amp;#xFF09;&amp;#x3002;&amp;#x4ED6;&amp;#x5176;&amp;#x5B9E;&amp;#x548C;&amp;#x6211;&amp;#x4EEC;CPU&amp;#x7684;L1&amp;#xFF0C;L2&amp;#x7F13;&amp;#x5B58;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&amp;#x4ED6;&amp;#x6709;&amp;#x70B9;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;&amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x4E2D;&amp;#x5206;&amp;#x914D;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;size&amp;#x76F8;&amp;#x540C;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E3B;&amp;#x7EBF;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796586&#34; hash=&#34;7c2730c8cad130f3604736abf0582ab5&#34; align alt longdesc width=&#34;687&#34; height=&#34;362&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E3B;&amp;#x7EBF;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;kmem_cache_zalloc&amp;#x5206;&amp;#x914D;kmem_cache&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x79CD;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x52A0;&amp;#x5165;cache_chain&amp;#x4E2D;&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x2014;&amp;#x2014;cache_chain&amp;#x662F;&amp;#x505A;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x73B0;&amp;#x5728;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x6709;&amp;#x7B54;&amp;#x6848;&amp;#x4E86;&amp;#x3002;&amp;#x4ED6;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x7684;kmem_cache&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x9632;&amp;#x6B62;&amp;#x91CD;&amp;#x540D;&amp;#x7684;cache&amp;#x4EA7;&amp;#x751F;&amp;#xFF0C;&amp;#x65B9;&amp;#x4FBF;proc&amp;#x7CFB;&amp;#x7EDF;&amp;#x663E;&amp;#x793A;&amp;#x8C03;&amp;#x8BD5;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;1. kmem_cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x5F53;size &amp;gt;= (PAGE_SIZE &amp;gt;&amp;gt; 3 = 512KB&amp;#x65F6;&amp;#xFF0C;flags |= CFLGS_OFF_SLAB&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;calculate_slab_order(cachep, size, align, flags)&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796244&#34; hash=&#34;10a4a7586d7d29b19d2e2a600adc2ef0&#34; align alt longdesc width=&#34;482&#34; height=&#34;512&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6240;&amp;#x8C13;&amp;#x7684;num&amp;#x4E0E;offslab_limit&amp;#x5C31;&amp;#x662F;&amp;#x4E0B;&amp;#x9762;off-slab&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x7531;&amp;#x6574;&amp;#x5757;2^order&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(num)&amp;#xFF0C;&amp;#x548C;&amp;#x53F3;&amp;#x8FB9;kmem_bufctl_t&amp;#x6570;&amp;#x7EC4;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(offslab_limit)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EA6;&amp;#x675F;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;num&amp;#x8981;&amp;#x5C0F;&amp;#x4E8E;offslab_limit&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x5C0F;&amp;#x4E8E;&amp;#x53F3;&amp;#x8FB9;&amp;#x3002;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x53F3;&amp;#x8FB9;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x7684;&amp;#x7BA1;&amp;#x63A7;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796738&#34; hash=&#34;a6edb8ef026079cb61b86575d2695089&#34; align alt longdesc width=&#34;429&#34; height=&#34;212&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5982;&amp;#x679C;left_over&amp;#x592A;&amp;#x591A;&amp;#xFF0C;&amp;#x8DB3;&amp;#x591F;&amp;#x653E;&amp;#x5F97;&amp;#x4E0B;slab_size&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;off-slab&amp;#x8F6C;&amp;#x53D8;&amp;#x4E3A;on-slab&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;2. off-slab&amp;#x65F6;&amp;#xFF0C;slab mngmt&amp;#x653E;&amp;#x5728;&amp;#x54EA;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8C03;&amp;#x7528;cachep-&amp;gt;slabp_cache = kmem_find_general_cachep(slab_size, 0u)&amp;#xFF0C;&amp;#x53BB;&amp;#x5BFB;&amp;#x627E;&amp;#x8FD9;&amp;#x4E2A;size cache&amp;#x6765;&amp;#x5B58;&amp;#x653E;slab mngmt&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;kmem_find_general_cachep -&amp;gt;&amp;#xA0;__find_general_cachep -&amp;gt; (return malloc_sizes[n]-&amp;gt;cs_cachep)&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;3. CPU cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;setup_cpu_cache(cachep, gfp)&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5148;&amp;#x770B;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1499486796416&#34; hash=&#34;5fac5be0e836af7f4e8bf4ff71375b8d&#34; align alt longdesc width=&#34;902&#34; height=&#34;682&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x6839;&amp;#x636E;g_cpucache_up&amp;#x5206;&amp;#x6210;&amp;#x4E09;&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;FULL&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x7684;cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x90FD;&amp;#x5B8C;&amp;#x6210;&amp;#x4E86;&amp;#xFF0C;setup_cpu_cache&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;enable_cpucache&amp;#x3002;&amp;#x8FD9;&amp;#x4E5F;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x518D;&amp;#x53E6;&amp;#x5F00;&amp;#x65B0;&amp;#x7BC7;&amp;#x4ECB;&amp;#x7ECD;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;PARTIAL_AC/L3&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;&amp;#x6B64;&amp;#x51FD;&amp;#x6570;&amp;#x7684;kmem_cache_create&amp;#x4ECD;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x624D;&amp;#x521A;&amp;#x5F00;&amp;#x59CB;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;struct arracy_cache&amp;#x548C;kmem_list3s&amp;#x7528;&amp;#x5230;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x8FDB;&amp;#x884C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5176;&amp;#x4ED6;cache&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#xFF0C;&amp;#x65E0;&amp;#x6CD5;&amp;#x52A8;&amp;#x6001;&amp;#x5730;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5269;&amp;#x4E0B;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;AC&amp;#x548C;L3&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x597D;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;cache&amp;#x518D;create&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x8C03;&amp;#x7528;kmalloc&amp;#x4E86;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_generic.cache&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC / L3&amp;#x7684;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[SIZE_AC / L3]&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; cache_cache&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_cache&amp;#xFF0C;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[CACHE_CACHE]&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E9B;&amp;#x5728;kmem_cache_init&amp;#x7684;step 4,5&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x91CD;&amp;#x65B0;&amp;#x7528;kmalloc&amp;#x8FDB;&amp;#x884C;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;array_cache&amp;#x4F1A;&amp;#x7528;memcpy&amp;#x5C06;&amp;#x539F;&amp;#x5148;&amp;#x503C;&amp;#x8D4B;&amp;#x5165;&amp;#xFF0C;list&amp;#x4F1A;&amp;#x7528;splice&amp;#x8FDB;&amp;#x884C;&amp;#x5408;&amp;#x5E76;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89%E2%80%94%E2%80%94_kmem_cache_create/</guid>
            <title>slab allocator （2）—— kmem_cache_create</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%882%EF%BC%89%E2%80%94%E2%80%94_kmem_cache_create/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 20:54:16 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x662F;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x4E4B;&amp;#x4E00;&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;kmalloc&amp;#x7684;&amp;#x540E;&amp;#x76FE;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4F5C;&amp;#x4E3A;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x4F9B;&amp;#x9A71;&amp;#x52A8;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x770B;ldd3&amp;#x7684;chp 8&amp;#x7684;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x4E00;&amp;#x8282;&amp;#xFF08;P217&amp;#xFF09;&amp;#x3002;&amp;#x4ED6;&amp;#x5176;&amp;#x5B9E;&amp;#x548C;&amp;#x6211;&amp;#x4EEC;CPU&amp;#x7684;L1&amp;#xFF0C;L2&amp;#x7F13;&amp;#x5B58;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&amp;#x4ED6;&amp;#x6709;&amp;#x70B9;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;&amp;#x5185;&amp;#x5B58;&amp;#x6C60;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x4E2D;&amp;#x5206;&amp;#x914D;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;size&amp;#x76F8;&amp;#x540C;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E3B;&amp;#x7EBF;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030569&#34; hash=&#34;7c2730c8cad130f3604736abf0582ab5&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E3B;&amp;#x7EBF;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;kmem_cache_zalloc&amp;#x5206;&amp;#x914D;kmem_cache&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x79CD;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x52A0;&amp;#x5165;cache_chain&amp;#x4E2D;&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x2014;&amp;#x2014;cache_chain&amp;#x662F;&amp;#x505A;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x73B0;&amp;#x5728;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x6709;&amp;#x7B54;&amp;#x6848;&amp;#x4E86;&amp;#x3002;&amp;#x4ED6;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x7684;kmem_cache&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x9632;&amp;#x6B62;&amp;#x91CD;&amp;#x540D;&amp;#x7684;cache&amp;#x4EA7;&amp;#x751F;&amp;#xFF0C;&amp;#x65B9;&amp;#x4FBF;proc&amp;#x7CFB;&amp;#x7EDF;&amp;#x663E;&amp;#x793A;&amp;#x8C03;&amp;#x8BD5;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. kmem_cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x5F53;size &amp;gt;= (PAGE_SIZE &amp;gt;&amp;gt; 3 = 512KB&amp;#x65F6;&amp;#xFF0C;flags |= CFLGS_OFF_SLAB&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;calculate_slab_order(cachep, size, align, flags)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030564&#34; hash=&#34;10a4a7586d7d29b19d2e2a600adc2ef0&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6240;&amp;#x8C13;&amp;#x7684;num&amp;#x4E0E;offslab_limit&amp;#x5C31;&amp;#x662F;&amp;#x4E0B;&amp;#x9762;off-slab&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x7531;&amp;#x6574;&amp;#x5757;2^order&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(num)&amp;#xFF0C;&amp;#x548C;&amp;#x53F3;&amp;#x8FB9;kmem_bufctl_t&amp;#x6570;&amp;#x7EC4;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;object&amp;#x6570;(offslab_limit)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EA6;&amp;#x675F;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;num&amp;#x8981;&amp;#x5C0F;&amp;#x4E8E;offslab_limit&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x5C0F;&amp;#x4E8E;&amp;#x53F3;&amp;#x8FB9;&amp;#x3002;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x53F3;&amp;#x8FB9;&amp;#x662F;&amp;#x5DE6;&amp;#x8FB9;&amp;#x7684;&amp;#x7BA1;&amp;#x63A7;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030571&#34; hash=&#34;a6edb8ef026079cb61b86575d2695089&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5982;&amp;#x679C;left_over&amp;#x592A;&amp;#x591A;&amp;#xFF0C;&amp;#x8DB3;&amp;#x591F;&amp;#x653E;&amp;#x5F97;&amp;#x4E0B;slab_size&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;off-slab&amp;#x8F6C;&amp;#x53D8;&amp;#x4E3A;on-slab&lt;/div&gt;&lt;div&gt;2. off-slab&amp;#x65F6;&amp;#xFF0C;slab mngmt&amp;#x653E;&amp;#x5728;&amp;#x54EA;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x8C03;&amp;#x7528;cachep-&amp;gt;slabp_cache = kmem_find_general_cachep(slab_size, 0u)&amp;#xFF0C;&amp;#x53BB;&amp;#x5BFB;&amp;#x627E;&amp;#x8FD9;&amp;#x4E2A;size cache&amp;#x6765;&amp;#x5B58;&amp;#x653E;slab mngmt&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;kmem_find_general_cachep -&amp;gt;&amp;#xA0;__find_general_cachep -&amp;gt; (return malloc_sizes[n]-&amp;gt;cs_cachep)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. CPU cache&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;setup_cpu_cache(cachep, gfp)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5148;&amp;#x770B;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create/1537085030566&#34; hash=&#34;5fac5be0e836af7f4e8bf4ff71375b8d&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6574;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x6839;&amp;#x636E;g_cpucache_up&amp;#x5206;&amp;#x6210;&amp;#x4E09;&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;FULL&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x7684;cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x90FD;&amp;#x5B8C;&amp;#x6210;&amp;#x4E86;&amp;#xFF0C;setup_cpu_cache&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x5C31;&amp;#x662F;enable_cpucache&amp;#x3002;&amp;#x8FD9;&amp;#x4E5F;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x518D;&amp;#x53E6;&amp;#x5F00;&amp;#x65B0;&amp;#x7BC7;&amp;#x4ECB;&amp;#x7ECD;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;PARTIAL_AC/L3&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;&amp;#x6B64;&amp;#x51FD;&amp;#x6570;&amp;#x7684;kmem_cache_create&amp;#x4ECD;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x624D;&amp;#x521A;&amp;#x5F00;&amp;#x59CB;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;struct arracy_cache&amp;#x548C;kmem_list3s&amp;#x7528;&amp;#x5230;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x8FDB;&amp;#x884C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5176;&amp;#x4ED6;cache&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#xFF0C;&amp;#x65E0;&amp;#x6CD5;&amp;#x52A8;&amp;#x6001;&amp;#x5730;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x5269;&amp;#x4E0B;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;AC&amp;#x548C;L3&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x597D;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;cache&amp;#x518D;create&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x8C03;&amp;#x7528;kmalloc&amp;#x4E86;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_generic.cache&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; INDEX_AC / L3&amp;#x7684;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[SIZE_AC / L3]&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; cache_cache&amp;#x7684;array_cache&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initarray_cache&amp;#xFF0C;kmem_list3&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x662F;initkmem_list3[CACHE_CACHE]&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E9B;&amp;#x5728;kmem_cache_init&amp;#x7684;step 4,5&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x91CD;&amp;#x65B0;&amp;#x7528;kmalloc&amp;#x8FDB;&amp;#x884C;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;array_cache&amp;#x4F1A;&amp;#x7528;memcpy&amp;#x5C06;&amp;#x539F;&amp;#x5148;&amp;#x503C;&amp;#x8D4B;&amp;#x5165;&amp;#xFF0C;list&amp;#x4F1A;&amp;#x7528;splice&amp;#x8FDB;&amp;#x884C;&amp;#x5408;&amp;#x5E76;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89-_array_cache/</guid>
            <title>slab allocator （3）—— array_cache</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89-_array_cache/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 08:39:28 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;array_cache&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;Gorman&amp;#x4E66;&amp;#x4E2D;&amp;#x7684;per-CPU cache&amp;#x3002;&amp;#x4E66;&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6709;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#xFF1A;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;This way the&amp;#xA0;hardware cache will be used for as long as possible on the same CPU.&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;The second major bene&amp;#xFB01;t of this method is that spinlocks do not have to be held&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#x5148;&amp;#x770B;&amp;#x4E0B;kmem_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;br&gt;/* 2) Cache tunables. Protected by cache_chain_mutex */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int shared;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int buffer_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; u32 reciprocal_buffer_size;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;array_cache&amp;#x662F;kmem_cache&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x6BCF;&amp;#x4E2A;CPU&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5BF9;&amp;#x5E94;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E5F;&amp;#x5370;&amp;#x8BC1;&amp;#x4E86;&amp;#x4E0A;&amp;#x9762;Gorman&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#x3002;&amp;#x5728;&amp;#x6BCF;&amp;#x4E2A;kmem_cache&amp;#x88AB;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x9700;&amp;#x8981;&amp;#x53BB;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;setup_cpu_cache -&amp;gt; enable_cpucache -&amp;gt;&amp;#xA0;&lt;span style=&#34;font-size: 10pt; font-family: Arial; text-indent: 0mm;&#34;&gt;do_tune_cpucache&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5177;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1499486792698&#34; hash=&#34;049b0a76d483a641fc99b8981d3f1d3a&#34; align alt longdesc width=&#34;902&#34; height=&#34;536&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#x53EF;&amp;#x89C1;do_tune_cpucache&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x5E76;&amp;#x4ED8;&amp;#x7ED9;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;CPU&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6240;&amp;#x6709;&amp;#x7684;online CPU&amp;#x90FD;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x904D;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53EA;&amp;#x53D6;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F53;&amp;#x524D;CPU&amp;#x7684;&amp;#x503C;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x600E;&amp;#x4E48;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;&amp;#x8BB2;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x518D;&amp;#x505A;&amp;#x8BE6;&amp;#x7EC6;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&amp;#x4E0D;&amp;#x8FC7;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E2A;free_block&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x9605;&amp;#x8BFB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;array_cache&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x5927;&amp;#x4F53;&amp;#x7684;&amp;#x4E86;&amp;#x89E3;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5148;&amp;#x770B;&amp;#x6574;&amp;#x4E2A;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1499486792860&#34; hash=&#34;2bff79d1ec9cde7eaa6122d0bccbeefe&#34; align alt longdesc width=&#34;999&#34; height=&#34;753&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;array_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x6B63;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x6240;&amp;#x663E;&amp;#x793A;&amp;#xFF0C;&amp;#x9664;&amp;#x4E86;touched&amp;#x4E0D;&amp;#x77E5;&amp;#x9053;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x4E4B;&amp;#x5916;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x51E0;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x6670;&amp;#x7684;&amp;#xFF0C;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5F97;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;ul&gt;&lt;li&gt;avail&amp;#xFF0C;&amp;#x5F53;&amp;#x524D;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;&amp;#x4F4D;&amp;#x5B50;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x914D;&lt;/li&gt;&lt;li&gt;limit&amp;#xFF0C;&amp;#x81EA;&amp;#x7136;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#xFF0C;&amp;#x4E4B;&amp;#x524D;&amp;#x4E5F;&amp;#x8BF4;&amp;#x8FC7;&amp;#xFF0C;&amp;#x5728;enable_cpucache&amp;#x4E2D;&amp;#x4E5F;&amp;#x6709;&amp;#x5B9A;&amp;#x4E49;&lt;/li&gt;&lt;li&gt;batchcount&amp;#xFF0C;linux&amp;#x4E2D;&amp;#x4E00;&amp;#x822C;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x90FD;&amp;#x662F;&amp;#x7528;batch&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x5728;&amp;#x589E;&amp;#x957F;&amp;#x6216;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;object&amp;#x6570;&lt;/li&gt;&lt;li&gt;entry&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x6210;&amp;#x5458;&amp;#x4E86;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;object&amp;#x6570;&amp;#x7EC4;&lt;/li&gt;&lt;/ul&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;free_block&amp;#x91CA;&amp;#x653E;&amp;#x7684;&amp;#x662F;ccold-&amp;gt;avail&amp;#x4E2A;object&amp;#xFF0C;avail&amp;#x4E0D;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x672C;&amp;#x8EAB;&amp;#x5C31;&amp;#x662F;free&amp;#x7684;object&amp;#x5417;&amp;#xFF1F;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x9605;&amp;#x8BFB;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x56DE;&amp;#x7B54;&amp;#x8FD9;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E86;&amp;#xFF0C;&amp;#x9996;&amp;#x5148;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x4ECE;array_cache-&amp;gt;entry&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;avail&amp;#x7684;object&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#xFF0C;avail&amp;#x53D8;&amp;#x5C11;&amp;#x3002;&amp;#x5F53;avail&amp;#x4E3A;0&amp;#x65F6;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x67D0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4ECE;kmem_cache&amp;#x4E2D;&amp;#x53BB;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8D4B;&amp;#x7ED9;array_cache&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x53D6;batchcount&amp;#x4E2A;object&amp;#xFF0C;&amp;#x8FD9;&amp;#x65F6;avail&amp;#x5C31;&amp;#x4F1A;&amp;#x589E;&amp;#x52A0;&amp;#xFF0C;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x5C31;&amp;#x4F1A;&amp;#x51CF;&amp;#x5C11;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x6570;&amp;#x76EE;&amp;#x3002;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x4F1A;&amp;#x5728;cache_grow&amp;#x65F6;&amp;#x9012;&amp;#x589E;cachep-&amp;gt;num&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94_array_cache/</guid>
            <title>slab allocator （3）—— array_cache</title>
            <link>https://blog.zhougy.top/2012/12/18/slab_allocator_%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94_array_cache/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 18 Dec 2012 08:39:28 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;array_cache&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;Gorman&amp;#x4E66;&amp;#x4E2D;&amp;#x7684;per-CPU cache&amp;#x3002;&amp;#x4E66;&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6709;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#xFF1A;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;This way the&amp;#xA0;hardware cache will be used for as long as possible on the same CPU.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;The second major bene&amp;#xFB01;t of this method is that spinlocks do not have to be held&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x5148;&amp;#x770B;&amp;#x4E0B;kmem_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;br&gt;/* 2) Cache tunables. Protected by cache_chain_mutex */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int shared;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int buffer_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; u32 reciprocal_buffer_size;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;array_cache&amp;#x662F;kmem_cache&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x6BCF;&amp;#x4E2A;CPU&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5BF9;&amp;#x5E94;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E5F;&amp;#x5370;&amp;#x8BC1;&amp;#x4E86;&amp;#x4E0A;&amp;#x9762;Gorman&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E24;&amp;#x70B9;&amp;#x539F;&amp;#x56E0;&amp;#x3002;&amp;#x5728;&amp;#x6BCF;&amp;#x4E2A;kmem_cache&amp;#x88AB;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x9700;&amp;#x8981;&amp;#x53BB;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;setup_cpu_cache -&amp;gt; enable_cpucache -&amp;gt;&amp;#xA0;&lt;span style=&#34;font-size: 10pt; font-family: Arial; text-indent: 0mm;&#34;&gt;do_tune_cpucache&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5177;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1537085030103&#34; hash=&#34;049b0a76d483a641fc99b8981d3f1d3a&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x53EF;&amp;#x89C1;do_tune_cpucache&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x5E76;&amp;#x4ED8;&amp;#x7ED9;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;CPU&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x6240;&amp;#x6709;&amp;#x7684;online CPU&amp;#x90FD;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x904D;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53EA;&amp;#x53D6;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;&amp;#x5F53;&amp;#x524D;CPU&amp;#x7684;&amp;#x503C;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x600E;&amp;#x4E48;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;array_cache&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;&amp;#x8BB2;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x518D;&amp;#x505A;&amp;#x8BE6;&amp;#x7EC6;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&amp;#x4E0D;&amp;#x8FC7;&amp;#x8FD9;&amp;#x91CC;&amp;#x6709;&amp;#x4E2A;free_block&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x9605;&amp;#x8BFB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;array_cache&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x5927;&amp;#x4F53;&amp;#x7684;&amp;#x4E86;&amp;#x89E3;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5148;&amp;#x770B;&amp;#x6574;&amp;#x4E2A;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; array_cache/1537085030106&#34; hash=&#34;2bff79d1ec9cde7eaa6122d0bccbeefe&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;array_cache&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x6B63;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x6240;&amp;#x663E;&amp;#x793A;&amp;#xFF0C;&amp;#x9664;&amp;#x4E86;touched&amp;#x4E0D;&amp;#x77E5;&amp;#x9053;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#x4E4B;&amp;#x5916;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x51E0;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x8FD8;&amp;#x662F;&amp;#x5F88;&amp;#x6E05;&amp;#x6670;&amp;#x7684;&amp;#xFF0C;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5F97;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;avail&amp;#xFF0C;&amp;#x5F53;&amp;#x524D;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;&amp;#x4F4D;&amp;#x5B50;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x914D;&lt;/li&gt;&lt;li&gt;limit&amp;#xFF0C;&amp;#x81EA;&amp;#x7136;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#xFF0C;&amp;#x4E4B;&amp;#x524D;&amp;#x4E5F;&amp;#x8BF4;&amp;#x8FC7;&amp;#xFF0C;&amp;#x5728;enable_cpucache&amp;#x4E2D;&amp;#x4E5F;&amp;#x6709;&amp;#x5B9A;&amp;#x4E49;&lt;/li&gt;&lt;li&gt;batchcount&amp;#xFF0C;linux&amp;#x4E2D;&amp;#x4E00;&amp;#x822C;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x6570;&amp;#x91CF;&amp;#x90FD;&amp;#x662F;&amp;#x7528;batch&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x5728;&amp;#x589E;&amp;#x957F;&amp;#x6216;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;object&amp;#x6570;&lt;/li&gt;&lt;li&gt;entry&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;array_cache&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x6210;&amp;#x5458;&amp;#x4E86;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;object&amp;#x6570;&amp;#x7EC4;&lt;/li&gt;&lt;/ul&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;free_block&amp;#x91CA;&amp;#x653E;&amp;#x7684;&amp;#x662F;ccold-&amp;gt;avail&amp;#x4E2A;object&amp;#xFF0C;avail&amp;#x4E0D;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x672C;&amp;#x8EAB;&amp;#x5C31;&amp;#x662F;free&amp;#x7684;object&amp;#x5417;&amp;#xFF1F;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x7ECF;&amp;#x8FC7;&amp;#x9605;&amp;#x8BFB;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x56DE;&amp;#x7B54;&amp;#x8FD9;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#x4E86;&amp;#xFF0C;&amp;#x9996;&amp;#x5148;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x4ECE;array_cache-&amp;gt;entry&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;avail&amp;#x7684;object&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#xFF0C;avail&amp;#x53D8;&amp;#x5C11;&amp;#x3002;&amp;#x5F53;avail&amp;#x4E3A;0&amp;#x65F6;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x67D0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4ECE;kmem_cache&amp;#x4E2D;&amp;#x53BB;&amp;#x53D6;object&amp;#xFF0C;&amp;#x8D4B;&amp;#x7ED9;array_cache&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x53D6;batchcount&amp;#x4E2A;object&amp;#xFF0C;&amp;#x8FD9;&amp;#x65F6;avail&amp;#x5C31;&amp;#x4F1A;&amp;#x589E;&amp;#x52A0;&amp;#xFF0C;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x5C31;&amp;#x4F1A;&amp;#x51CF;&amp;#x5C11;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x6570;&amp;#x76EE;&amp;#x3002;&amp;#x800C;kmem_list3-&amp;gt;free_objects&amp;#x4F1A;&amp;#x5728;cache_grow&amp;#x65F6;&amp;#x9012;&amp;#x589E;cachep-&amp;gt;num&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_-_%E5%88%9D%E5%A7%8B%E5%8C%96/</guid>
            <title>slab allocator （1） —— 初始化</title>
            <link>https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_-_%E5%88%9D%E5%A7%8B%E5%8C%96/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sun, 16 Dec 2012 22:33:56 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;&amp;#x524D;&amp;#x9762;&amp;#x63D0;&amp;#x5230;&amp;#x8FC7;&amp;#x7684;buddy allocator&amp;#x901A;&amp;#x8FC7;&amp;#x7528;order&amp;#x5217;&amp;#x8868;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FBE;&amp;#x5230;&amp;#x51CF;&amp;#x5C11;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x7684;&amp;#x6548;&amp;#x679C;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x53EF;&amp;#x80FD;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x9875;&amp;#x6216;&amp;#x8005;&amp;#x51E0;&amp;#x9875;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90A3;&amp;#x6837;&amp;#x5185;&amp;#x5B58;&amp;#x5229;&amp;#x7528;&amp;#x7387;&amp;#x592A;&amp;#x4F4E;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#x5C06;&amp;#x5145;&amp;#x6EE1;&amp;#x4E86;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#xFF0C;slab&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x4E5F;&amp;#x5C31;&amp;#x5E94;&amp;#x8FD0;&amp;#x800C;&amp;#x751F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x51CF;&amp;#x5C11;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x800C;&amp;#x751F;&amp;#x7684;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x5F15;&amp;#x5165;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;slab&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7B80;&amp;#x4ECB;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003; &lt;a href=&#34;evernote:///view/161681/s10/1c5db3a9-e828-4651-85a8-865b4b31c896/1c5db3a9-e828-4651-85a8-865b4b31c896/&#34; style=&#34;color:#69aa35&#34;&gt;Linux slab &amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x5256;&amp;#x6790;&lt;/a&gt;&amp;#xFF0C; &lt;a href=&#34;evernote:///view/161681/s10/dd5a8455-ae17-4640-9ab3-318029b5b27a/dd5a8455-ae17-4640-9ab3-318029b5b27a/&#34; style=&#34;color:#69aa35&#34;&gt;Fred&amp;apos;s blog: &amp;#x4E09;&amp;#x6708; 2009&lt;/a&gt;&amp;#x3002;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486800011&#34; hash=&#34;f9aa13f5720f81622ea03ff22545aa90&#34; align alt longdesc width=&#34;402&#34; height=&#34;216&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;slab&amp;#x5C31;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&amp;#x7B80;&amp;#x5316;&amp;#x4E4B;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x57FA;&amp;#x4E8E;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x914D;&amp;#xFF08;&amp;#x53C2;&amp;#x8003;ldd3&amp;#xFF0C;page247 ch 8&amp;#xFF09;&amp;#x65B9;&amp;#x5F0F;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4ED6;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7531;&amp;#x4E0B;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;g_cpucache_up&amp;#x6765;&amp;#x6807;&amp;#x5FD7;&amp;#xFF0C;&amp;#x5171;&amp;#x6709;5&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6309;&amp;#x987A;&amp;#x5E8F;&amp;#x4F9D;&amp;#x6B21;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5728;start_kernel -&amp;gt; mm_init -&amp;gt; kmem_cache_init&amp;#x4E2D;&amp;#x5230;&amp;#x8FBE;EARLY&amp;#x72B6;&amp;#x6001;&amp;#x3002;&amp;#x6B64;&amp;#x65F6;slab_is_availabe()&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;&amp;#x771F;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x6B64;&amp;#x65F6;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5C31;&amp;#x7EEA;&amp;#x4E86;&amp;#x3002;&amp;#x800C;&amp;#x6700;&amp;#x7EC8;&amp;#x7684;FULL&amp;#x72B6;&amp;#x6001;&amp;#x662F;&amp;#x5728;kmem_cache_init_late&amp;#x4E2D;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799339&#34; hash=&#34;03ce74377056ed29ac4d864ca09a0238&#34; align alt longdesc width=&#34;990&#34; height=&#34;382&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x8FD9;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E2D;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x6838;&amp;#x5FC3;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#xA0;kmem_cache_init&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x5C06;&amp;#x91CD;&amp;#x70B9;&amp;#x4ECB;&amp;#x7ECD;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799878&#34; hash=&#34;f81d2f1faf6a6fe1e338c67903cec92c&#34; align alt longdesc width=&#34;920&#34; height=&#34;733&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5F88;&amp;#x5927;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x5F88;&amp;#x591A;&amp;#x77E5;&amp;#x8BC6;&amp;#x70B9;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chapter 8&amp;#x3002;&amp;#x5173;&amp;#x4E8E;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x591A;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x4E0D;&amp;#x662F;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#x3002;&amp;#x5148;&amp;#x5217;&amp;#x4E3E;&amp;#x51E0;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x4E86;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4ED6;&amp;#x5DE8;&amp;#x5927;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5C31;&amp;#x4E0D;&amp;#x5728;&amp;#x6B64;&amp;#x5217;&amp;#x4E3E;&amp;#x4E86;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; 1.&amp;#xA0;kmem_list3&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;struct kmem_list3 {&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_partial;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* partial list first, better asm code */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_full;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_free;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long free_objects;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int free_limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int colour_next;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* Per-node cache coloring */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t list_lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *shared;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* shared per node */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache **alien;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* on other nodes */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long next_reap;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int free_touched;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x524D;3&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x56FE;1&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E09;&amp;#x4E2A;list&amp;#xFF1A;slab_full, slab_partial, slab_empty&amp;#x3002;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. array_cache&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct array_cache {&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int avail;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int touched;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; void *entry[];&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /*&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Must have this definition in here for the proper&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * alignment of array_cache. Also simplifies accessing&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the entries.&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;array_cache&amp;#x662F;per CPU&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chp 8.5: Per-CPU Object Cache&amp;#x3002;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;cache&amp;#xFF0C;&amp;#x5728;create&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;array_cache&amp;#xFF08;enable_cpucache&amp;#xFF09;&amp;#x6765;&amp;#x63D0;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x603B;cache&amp;#x2014;&amp;#x2014;cache_cache&amp;#xFF08;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x5B83;&amp;#x662F;cache&amp;#x7684;cache&amp;#xFF09;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#x88AB;&amp;#x586B;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;__init_data&amp;#xA0;initarray_cache.cache&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#x518D;&amp;#x901A;&amp;#x8FC7;kmalloc&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x3002;arraycache&amp;#x4E0E;kmem_cache&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x5927;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799641&#34; hash=&#34;4daa9a20e6abdf0bb5ff45cff476683c&#34; align alt longdesc width=&#34;490&#34; height=&#34;402&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5173;&amp;#x4E8E;array_cache&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x4F1A;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x4F5C;&amp;#x4ECB;&amp;#x7ECD;&lt;a href=&#34;evernote:///view/161681/s10/e6125cc1-29d9-4e51-b0d7-1e44806f5491/e6125cc1-29d9-4e51-b0d7-1e44806f5491/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; arraycache&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. cache_sizes&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;Gorman&amp;#x7684;&amp;#x4E66;&amp;#x4E2D;&amp;#x5C06;&amp;#x5176;&amp;#x79F0;&amp;#x4E4B;&amp;#x4E3A;sizes cache&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x7EC4;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E86;size&amp;#x7684;cache&amp;#x3002;&amp;#x5728;slab&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x4F1A;&amp;#x7ECF;&amp;#x5E38;&amp;#x770B;&amp;#x5230;malloc_sizes&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9A;&amp;#x4E49;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes malloc_sizes[] = {&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define CACHE(x) { .cs_size = (x) },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#include &amp;lt;linux/kmalloc_sizes.h&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(ULONG_MAX)&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#undef CACHE&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size_t&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cs_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_cachep;&lt;br&gt;#ifdef CONFIG_ZONE_DMA&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_dmacachep;&lt;br&gt;#endif&lt;br&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x518D;&amp;#x770B;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;linux/kmalloc_sizes.h&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#if (PAGE_SIZE == 4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(64)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 64&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(96)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(128)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 128&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(192)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(256)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(512)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(1024)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(2048)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(8192)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(16384)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32768)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(65536)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(131072)&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x7A0D;&amp;#x52A0;&amp;#x5206;&amp;#x6790;&amp;#x6211;&amp;#x4EEC;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x5728;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;kmalloc_sizes.h&amp;#x4E2D;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5B9A;&amp;#x4E49;&amp;#x597D;&amp;#x4E86;&amp;#x4E00;&amp;#x7EC4;&amp;#x56FA;&amp;#x5B9A;size&amp;#x7684;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;&amp;#x4ED6;&amp;#x4EEC;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x4E24;&amp;#x7EC4;cache&amp;#x5217;&amp;#x8868;&amp;#xFF08;cs_cachep, cs_dmacachep&amp;#xFF09;&amp;#x8FD8;&amp;#x6CA1;&amp;#x5206;&amp;#x914D;&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;kmem_cache_init&amp;#x4E2D;&amp;#x5BF9;INDEX_AC&amp;#x548C;INDEX_L3&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#x7684;&amp;#x6210;&amp;#x5458;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_AC&amp;#xFF1A;&lt;/span&gt;sizeof(struct arraycache_init)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_L3&amp;#xFF1A;&lt;/span&gt;sizeof(struct kmem_list3)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x628A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x5355;&amp;#x72EC;&amp;#x63D0;&amp;#x51FA;&amp;#x6765;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6211;&amp;#x63A8;&amp;#x6D4B;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x5728;kmem_cache_create&amp;#x5230;&amp;#x65F6;&amp;#x5019;&amp;#x9700;&amp;#x8981;&amp;#x9891;&amp;#x7E41;&amp;#x7684;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5BF9;&amp;#x4E8E;kmem_cache&amp;#x6765;&amp;#x8BF4;&amp;#x4E5F;&amp;#x5C31;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;struct&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x7684;cache&amp;#x5148;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x5176;&amp;#x4ED6;malloc_sizes&amp;#x6570;&amp;#x7EC4;&amp;#x6210;&amp;#x5458;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;cache&amp;#x6765;&amp;#x4E3A;&amp;#x4E4B;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#x3002;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8BF4;&amp;#x5B8C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x4E86;&amp;#xFF0C;&amp;#x518D;&amp;#x56DE;&amp;#x5934;&amp;#x770B;&amp;#x770B;kmem_cache_init&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x65E0;&amp;#x975E;&amp;#x5C31;&amp;#x662F;&amp;#x5BF9;cache_cache&amp;#xFF0C;malloc_sizes&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x70B9;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. cache_chain&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x5904;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;INIT_LIST_HEAD(&amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;list_add(&amp;amp;cache_cache.next, &amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x5C1A;&amp;#x4E0D;&amp;#x77E5;&amp;#x8FD9;&amp;#x4E2A;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_chain&amp;#x662F;&amp;#x4F5C;&amp;#x4F55;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x5148;&amp;#x6682;&amp;#x4E14;&amp;#x5217;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. cache_estimate&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1504&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (order = 0; order &amp;lt; MAX_ORDER; order++) {&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1505&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_estimate(order, cache_cache.buffer_size,&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1506&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_line_size(), 0, &amp;amp;left_over, &amp;amp;cache_cache.num);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1507&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (cache_cache.num)&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1508&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; break;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1509&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4F5C;&amp;#x7528;&amp;#x5176;&amp;#x5B9E;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x51B3;&amp;#x5B9A;&amp;#xFF1A;(1)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_cache.buffer_size&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;cache_cache&amp;#x7684;object size&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x53EF;&amp;#x4EE5;&amp;#x5B58;&amp;#x50A8;&amp;#x591A;&amp;#x5C11;&amp;#x4E2A;object&amp;#xA0;&lt;/span&gt;(2)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;slab manager&amp;#x5B58;&amp;#x50A8;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF08;on-slab/off-slab&amp;#xFF1A;&amp;#x770B;&amp;#x770B;flags&amp;#x662F;&amp;#x5426;&amp;#x5305;&amp;#x542B;&lt;/span&gt;CFLGS_OFF_SLAB&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF09;&lt;/span&gt;(3)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x5229;&amp;#x7528;slab&amp;#x4E0A;&amp;#x5269;&amp;#x4F59;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;coloring&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/span&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E00;&amp;#x4E2A;cache_cache&amp;#x7684;slab&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x5272;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1499486799475&#34; hash=&#34;4303d9fccee1ae4e2d8a4614f64d90ca&#34; align alt longdesc width=&#34;425&#34; height=&#34;242&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x4E2D;object&amp;#x7684;size&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;offsetof(struct kmem_cache, nodelists) +&amp;#xA0;nr_node_ids * sizeof(struct kmem_list3 *);&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;sizeof(kmem_cache)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;cache_cache&amp;#x7684;slab&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x3002;&amp;#x6700;&amp;#x540E;cache_cache-&amp;gt;slab_size =&amp;#xA0;slab_mgmt_size&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; coloring scheme&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;&amp;#xFF1A;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour_off = cache_line_size();&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour = left_over / cache_cache.colour_off;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. init_list&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x6700;&amp;#x540E;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1604&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for_each_online_node(nid) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1605&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(&amp;amp;cache_cache, &amp;amp;initkmem_list3[CACHE_CACHE + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1606&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1607&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_AC].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1608&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_AC + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1609&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1610&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (INDEX_AC != INDEX_L3) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1611&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_L3].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1612&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_L3 + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1613&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1614&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;init_list&amp;#x5199;&amp;#x7684;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED4;&amp;#x7EC6;&amp;#x7406;&amp;#x89E3;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;cache_cache&amp;#x4EE5;&amp;#x53CA;&amp;#x4E24;&amp;#x4E2A;size cache &amp;#xFF08;INDEX_AC, INDEX_L3&amp;#xFF09;&amp;#x5206;&amp;#x914D;kmem_list3&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&amp;#x5E76;&amp;#x7528;memcpy&amp;#x5C06;&lt;/font&gt;initkmem_list3&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x518D;&amp;#x7528;MAKE_ALL_LISTS -&amp;gt;&amp;#xA0;MAKE_LIST -&amp;gt;&amp;#xA0;list_splice &amp;#x6765;&amp;#x5408;&amp;#x5E76;initkmem_list3&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x3002;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8981;&amp;#x628A;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x60F3;&amp;#x7B80;&amp;#x5355;&amp;#x4E86;&amp;#xFF0C;&amp;#x8BE5;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x8FD8;&amp;#x662F;&amp;#x8981;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7279;&amp;#x522B;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x8FD9;&amp;#x79CD;&amp;#x5217;&amp;#x8868;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;kmem_cache_init&amp;#x4E2D;&amp;#x4E5F;&amp;#x8FD0;&amp;#x7528;kmem_cache_create&amp;#x6765;&amp;#x5206;&amp;#x914D;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x4E8E;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5C06;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x52A0;&amp;#x4EE5;&amp;#x9610;&amp;#x8FF0;&lt;a href=&#34;evernote:///view/161681/s10/e3b971bf-908b-4dda-8c29-d37666e83f1c/e3b971bf-908b-4dda-8c29-d37666e83f1c/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create&lt;/a&gt;&amp;#x3002;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_%E2%80%94%E2%80%94_%E5%88%9D%E5%A7%8B%E5%8C%96/</guid>
            <title>slab allocator （1） —— 初始化</title>
            <link>https://blog.zhougy.top/2012/12/16/slab_allocator_%EF%BC%881%EF%BC%89_%E2%80%94%E2%80%94_%E5%88%9D%E5%A7%8B%E5%8C%96/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Sun, 16 Dec 2012 22:33:56 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#x524D;&amp;#x9762;&amp;#x63D0;&amp;#x5230;&amp;#x8FC7;&amp;#x7684;buddy allocator&amp;#x901A;&amp;#x8FC7;&amp;#x7528;order&amp;#x5217;&amp;#x8868;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FBE;&amp;#x5230;&amp;#x51CF;&amp;#x5C11;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x7684;&amp;#x6548;&amp;#x679C;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x53EF;&amp;#x80FD;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x90FD;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x9875;&amp;#x6216;&amp;#x8005;&amp;#x51E0;&amp;#x9875;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x90A3;&amp;#x6837;&amp;#x5185;&amp;#x5B58;&amp;#x5229;&amp;#x7528;&amp;#x7387;&amp;#x592A;&amp;#x4F4E;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#x5C06;&amp;#x5145;&amp;#x6EE1;&amp;#x4E86;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#xFF0C;slab&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x4E5F;&amp;#x5C31;&amp;#x5E94;&amp;#x8FD0;&amp;#x800C;&amp;#x751F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5176;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x51CF;&amp;#x5C11;&amp;#x5185;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x800C;&amp;#x751F;&amp;#x7684;&amp;#x3002;&amp;#x5177;&amp;#x4F53;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x5F15;&amp;#x5165;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;slab&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7B80;&amp;#x4ECB;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003; &lt;a href=&#34;evernote:///view/161681/s10/1c5db3a9-e828-4651-85a8-865b4b31c896/1c5db3a9-e828-4651-85a8-865b4b31c896/&#34; style=&#34;color:#69aa35&#34;&gt;Linux slab &amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x5256;&amp;#x6790;&lt;/a&gt;&amp;#xFF0C; &lt;a href=&#34;evernote:///view/161681/s10/dd5a8455-ae17-4640-9ab3-318029b5b27a/dd5a8455-ae17-4640-9ab3-318029b5b27a/&#34; style=&#34;color:#69aa35&#34;&gt;Fred&amp;apos;s blog: &amp;#x4E09;&amp;#x6708; 2009&lt;/a&gt;&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031252&#34; hash=&#34;f9aa13f5720f81622ea03ff22545aa90&#34; align alt longdesc width=&#34;402&#34; height=&#34;216&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;slab&amp;#x5C31;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&amp;#x7B80;&amp;#x5316;&amp;#x4E4B;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x57FA;&amp;#x4E8E;&amp;#x540E;&amp;#x5907;&amp;#x9AD8;&amp;#x901F;&amp;#x7F13;&amp;#x5B58;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x914D;&amp;#xFF08;&amp;#x53C2;&amp;#x8003;ldd3&amp;#xFF0C;page247 ch 8&amp;#xFF09;&amp;#x65B9;&amp;#x5F0F;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4ED6;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7531;&amp;#x4E0B;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;g_cpucache_up&amp;#x6765;&amp;#x6807;&amp;#x5FD7;&amp;#xFF0C;&amp;#x5171;&amp;#x6709;5&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6309;&amp;#x987A;&amp;#x5E8F;&amp;#x4F9D;&amp;#x6B21;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5728;start_kernel -&amp;gt; mm_init -&amp;gt; kmem_cache_init&amp;#x4E2D;&amp;#x5230;&amp;#x8FBE;EARLY&amp;#x72B6;&amp;#x6001;&amp;#x3002;&amp;#x6B64;&amp;#x65F6;slab_is_availabe()&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;&amp;#x771F;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x6B64;&amp;#x65F6;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5C31;&amp;#x7EEA;&amp;#x4E86;&amp;#x3002;&amp;#x800C;&amp;#x6700;&amp;#x7EC8;&amp;#x7684;FULL&amp;#x72B6;&amp;#x6001;&amp;#x662F;&amp;#x5728;kmem_cache_init_late&amp;#x4E2D;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031241&#34; hash=&#34;03ce74377056ed29ac4d864ca09a0238&#34; align alt longdesc width=&#34;990&#34; height=&#34;382&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x8FD9;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E2D;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x6838;&amp;#x5FC3;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#xA0;kmem_cache_init&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x5C06;&amp;#x91CD;&amp;#x70B9;&amp;#x4ECB;&amp;#x7ECD;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031250&#34; hash=&#34;f81d2f1faf6a6fe1e338c67903cec92c&#34; align alt longdesc width=&#34;920&#34; height=&#34;733&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5F88;&amp;#x5927;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x5F88;&amp;#x591A;&amp;#x77E5;&amp;#x8BC6;&amp;#x70B9;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chapter 8&amp;#x3002;&amp;#x5173;&amp;#x4E8E;slab&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x591A;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x4E0D;&amp;#x662F;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#x3002;&amp;#x5148;&amp;#x5217;&amp;#x4E3E;&amp;#x51E0;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x4E86;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4ED6;&amp;#x5DE8;&amp;#x5927;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5C31;&amp;#x4E0D;&amp;#x5728;&amp;#x6B64;&amp;#x5217;&amp;#x4E3E;&amp;#x4E86;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; 1.&amp;#xA0;kmem_list3&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;struct kmem_list3 {&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_partial;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* partial list first, better asm code */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_full;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct list_head slabs_free;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long free_objects;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int free_limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int colour_next;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* Per-node cache coloring */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t list_lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *shared;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* shared per node */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache **alien;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* on other nodes */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long next_reap;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int free_touched;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /* updated without locking */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x524D;3&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x56FE;1&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x4E09;&amp;#x4E2A;list&amp;#xFF1A;slab_full, slab_partial, slab_empty&amp;#x3002;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. array_cache&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct array_cache {&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int avail;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int limit;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int batchcount;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned int touched;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; spinlock_t lock;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; void *entry[];&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; /*&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Must have this definition in here for the proper&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * alignment of array_cache. Also simplifies accessing&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the entries.&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct kmem_cache {&lt;br&gt;/* 1) per-cpu data, touched during every alloc/free */&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct array_cache *array[NR_CPUS];&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;array_cache&amp;#x662F;per CPU&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;chp 8.5: Per-CPU Object Cache&amp;#x3002;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;cache&amp;#xFF0C;&amp;#x5728;create&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x88AB;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;array_cache&amp;#xFF08;enable_cpucache&amp;#xFF09;&amp;#x6765;&amp;#x63D0;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&amp;#x5F53;&amp;#x7136;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x603B;cache&amp;#x2014;&amp;#x2014;cache_cache&amp;#xFF08;&amp;#x4ECE;&amp;#x540D;&amp;#x5B57;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x5B83;&amp;#x662F;cache&amp;#x7684;cache&amp;#xFF09;&amp;#x4E5F;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#x88AB;&amp;#x586B;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;__init_data&amp;#xA0;initarray_cache.cache&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;kmem_cache_init&amp;#x4E2D;&amp;#x518D;&amp;#x901A;&amp;#x8FC7;kmalloc&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x3002;arraycache&amp;#x4E0E;kmem_cache&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x5927;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031247&#34; hash=&#34;4daa9a20e6abdf0bb5ff45cff476683c&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5173;&amp;#x4E8E;array_cache&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x4F1A;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x4F5C;&amp;#x4ECB;&amp;#x7ECD;&lt;a href=&#34;evernote:///view/161681/s10/e6125cc1-29d9-4e51-b0d7-1e44806f5491/e6125cc1-29d9-4e51-b0d7-1e44806f5491/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;3&amp;#xFF09;&amp;#x2014;&amp;#x2014; arraycache&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. cache_sizes&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;Gorman&amp;#x7684;&amp;#x4E66;&amp;#x4E2D;&amp;#x5C06;&amp;#x5176;&amp;#x79F0;&amp;#x4E4B;&amp;#x4E3A;sizes cache&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x7EC4;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E86;size&amp;#x7684;cache&amp;#x3002;&amp;#x5728;slab&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x4F1A;&amp;#x7ECF;&amp;#x5E38;&amp;#x770B;&amp;#x5230;malloc_sizes&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9A;&amp;#x4E49;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes malloc_sizes[] = {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define CACHE(x) { .cs_size = (x) },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#include &amp;lt;linux/kmalloc_sizes.h&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(ULONG_MAX)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#undef CACHE&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;struct cache_sizes {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size_t&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cs_size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_cachep;&lt;br&gt;#ifdef CONFIG_ZONE_DMA&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct kmem_cache&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *cs_dmacachep;&lt;br&gt;#endif&lt;br&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x518D;&amp;#x770B;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;linux/kmalloc_sizes.h&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#if (PAGE_SIZE == 4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(64)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 64&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(96)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(128)&lt;br&gt;#if L1_CACHE_BYTES &amp;lt; 128&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(192)&lt;br&gt;#endif&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(256)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(512)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(1024)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(2048)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(4096)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(8192)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(16384)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(32768)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(65536)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; CACHE(131072)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x7A0D;&amp;#x52A0;&amp;#x5206;&amp;#x6790;&amp;#x6211;&amp;#x4EEC;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x5728;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;kmalloc_sizes.h&amp;#x4E2D;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5B9A;&amp;#x4E49;&amp;#x597D;&amp;#x4E86;&amp;#x4E00;&amp;#x7EC4;&amp;#x56FA;&amp;#x5B9A;size&amp;#x7684;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;&amp;#x4ED6;&amp;#x4EEC;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x4E24;&amp;#x7EC4;cache&amp;#x5217;&amp;#x8868;&amp;#xFF08;cs_cachep, cs_dmacachep&amp;#xFF09;&amp;#x8FD8;&amp;#x6CA1;&amp;#x5206;&amp;#x914D;&amp;#x3002;&amp;#x4E4B;&amp;#x540E;&amp;#x5728;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;kmem_cache_init&amp;#x4E2D;&amp;#x5BF9;INDEX_AC&amp;#x548C;INDEX_L3&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x7EC4;&amp;#x7684;&amp;#x6210;&amp;#x5458;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_AC&amp;#xFF1A;&lt;/span&gt;sizeof(struct arraycache_init)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;INDEX_L3&amp;#xFF1A;&lt;/span&gt;sizeof(struct kmem_list3)&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;malloc_sizes&amp;#x4E2D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x628A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x5355;&amp;#x72EC;&amp;#x63D0;&amp;#x51FA;&amp;#x6765;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x6211;&amp;#x63A8;&amp;#x6D4B;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x5728;kmem_cache_create&amp;#x5230;&amp;#x65F6;&amp;#x5019;&amp;#x9700;&amp;#x8981;&amp;#x9891;&amp;#x7E41;&amp;#x7684;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5BF9;&amp;#x4E8E;kmem_cache&amp;#x6765;&amp;#x8BF4;&amp;#x4E5F;&amp;#x5C31;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;struct&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x52A8;&amp;#x6001;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;size&amp;#x7684;cache&amp;#x5148;&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x5728;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x5176;&amp;#x4ED6;malloc_sizes&amp;#x6570;&amp;#x7EC4;&amp;#x6210;&amp;#x5458;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;cache&amp;#x6765;&amp;#x4E3A;&amp;#x4E4B;&amp;#x5206;&amp;#x914D;arraycache_init&amp;#x548C;kmem_list3&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8BF4;&amp;#x5B8C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x4E86;&amp;#xFF0C;&amp;#x518D;&amp;#x56DE;&amp;#x5934;&amp;#x770B;&amp;#x770B;kmem_cache_init&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x65E0;&amp;#x975E;&amp;#x5C31;&amp;#x662F;&amp;#x5BF9;cache_cache&amp;#xFF0C;malloc_sizes&amp;#x505A;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x8FD8;&amp;#x6709;&amp;#x51E0;&amp;#x4E2A;&amp;#x503C;&amp;#x5F97;&amp;#x5173;&amp;#x6CE8;&amp;#x7684;&amp;#x70B9;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. cache_chain&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x5904;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;INIT_LIST_HEAD(&amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;list_add(&amp;amp;cache_cache.next, &amp;amp;cache_chain);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x5C1A;&amp;#x4E0D;&amp;#x77E5;&amp;#x8FD9;&amp;#x4E2A;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_chain&amp;#x662F;&amp;#x4F5C;&amp;#x4F55;&amp;#x7528;&amp;#x7684;&amp;#xFF0C;&amp;#x5148;&amp;#x6682;&amp;#x4E14;&amp;#x5217;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. cache_estimate&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1504&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (order = 0; order &amp;lt; MAX_ORDER; order++) {&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1505&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_estimate(order, cache_cache.buffer_size,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1506&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; cache_line_size(), 0, &amp;amp;left_over, &amp;amp;cache_cache.num);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1507&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (cache_cache.num)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1508&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; break;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1509&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4F5C;&amp;#x7528;&amp;#x5176;&amp;#x5B9E;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x51B3;&amp;#x5B9A;&amp;#xFF1A;(1)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;cache_cache.buffer_size&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;cache_cache&amp;#x7684;object size&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x53EF;&amp;#x4EE5;&amp;#x5B58;&amp;#x50A8;&amp;#x591A;&amp;#x5C11;&amp;#x4E2A;object&amp;#xA0;&lt;/span&gt;(2)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;slab manager&amp;#x5B58;&amp;#x50A8;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF08;on-slab/off-slab&amp;#xFF1A;&amp;#x770B;&amp;#x770B;flags&amp;#x662F;&amp;#x5426;&amp;#x5305;&amp;#x542B;&lt;/span&gt;CFLGS_OFF_SLAB&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF09;&lt;/span&gt;(3)&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x5229;&amp;#x7528;slab&amp;#x4E0A;&amp;#x5269;&amp;#x4F59;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;coloring&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E00;&amp;#x4E2A;cache_cache&amp;#x7684;slab&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x5272;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/slab allocator &amp;#xFF08;1&amp;#xFF09; &amp;#x2014;&amp;#x2014; &amp;#x521D;&amp;#x59CB;&amp;#x5316;/1537085031245&#34; hash=&#34;4303d9fccee1ae4e2d8a4614f64d90ca&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x4E2D;object&amp;#x7684;size&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;offsetof(struct kmem_cache, nodelists) +&amp;#xA0;nr_node_ids * sizeof(struct kmem_list3 *);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;sizeof(kmem_cache)&amp;#x3002;&amp;#x53EF;&amp;#x89C1;cache_cache&amp;#x7684;slab&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5C31;&amp;#x662F;kmem_cache&amp;#x3002;&amp;#x6700;&amp;#x540E;cache_cache-&amp;gt;slab_size =&amp;#xA0;slab_mgmt_size&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; coloring scheme&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour_off = cache_line_size();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;cache_cache.colour = left_over / cache_cache.colour_off;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. init_list&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5728;kmem_cache_init&amp;#x7684;&amp;#x6700;&amp;#x540E;&amp;#xFF0C;&amp;#x6709;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1604&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for_each_online_node(nid) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1605&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(&amp;amp;cache_cache, &amp;amp;initkmem_list3[CACHE_CACHE + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1606&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1607&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_AC].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1608&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_AC + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1609&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1610&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (INDEX_AC != INDEX_L3) {&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1611&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; init_list(malloc_sizes[INDEX_L3].cs_cachep,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1612&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;initkmem_list3[SIZE_L3 + nid], nid);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1613&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;1614&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;init_list&amp;#x5199;&amp;#x7684;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED4;&amp;#x7EC6;&amp;#x7406;&amp;#x89E3;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;cache_cache&amp;#x4EE5;&amp;#x53CA;&amp;#x4E24;&amp;#x4E2A;size cache &amp;#xFF08;INDEX_AC, INDEX_L3&amp;#xFF09;&amp;#x5206;&amp;#x914D;kmem_list3&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&amp;#x5E76;&amp;#x7528;memcpy&amp;#x5C06;&lt;/font&gt;initkmem_list3&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x518D;&amp;#x7528;MAKE_ALL_LISTS -&amp;gt;&amp;#xA0;MAKE_LIST -&amp;gt;&amp;#xA0;list_splice &amp;#x6765;&amp;#x5408;&amp;#x5E76;initkmem_list3&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x3002;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x53EF;&amp;#x89C1;&amp;#x6709;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8981;&amp;#x628A;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x60F3;&amp;#x7B80;&amp;#x5355;&amp;#x4E86;&amp;#xFF0C;&amp;#x8BE5;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x8FD8;&amp;#x662F;&amp;#x8981;&amp;#x4ED4;&amp;#x7EC6;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7279;&amp;#x522B;&amp;#x662F;&amp;#x9488;&amp;#x5BF9;&amp;#x8FD9;&amp;#x79CD;&amp;#x5217;&amp;#x8868;&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#x3002;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;kmem_cache_init&amp;#x4E2D;&amp;#x4E5F;&amp;#x8FD0;&amp;#x7528;kmem_cache_create&amp;#x6765;&amp;#x5206;&amp;#x914D;cache&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x4E8E;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x5C06;&amp;#x5728;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x4E2D;&amp;#x52A0;&amp;#x4EE5;&amp;#x9610;&amp;#x8FF0;&lt;a href=&#34;evernote:///view/161681/s10/e3b971bf-908b-4dda-8c29-d37666e83f1c/e3b971bf-908b-4dda-8c29-d37666e83f1c/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;slab allocator &amp;#xFF08;2&amp;#xFF09;&amp;#x2014;&amp;#x2014; kmem_cache_create&lt;/a&gt;&amp;#x3002;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/12/migrate_type%E2%80%94%E2%80%94buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</guid>
            <title>migrate type——buddy system的好搭档</title>
            <link>https://blog.zhougy.top/2012/12/12/migrate_type%E2%80%94%E2%80%94buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Wed, 12 Dec 2012 21:49:24 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;Linux&amp;#x4E00;&amp;#x5171;&amp;#x5B9A;&amp;#x4E49;5&amp;#x4E2D;migrate type&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;div&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_UNMOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 0&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RECLAIMABLE&amp;#xA0;&amp;#xA0; 1&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_MOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 2&lt;/font&gt;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/* &amp;#x672A;&amp;#x89C1;&amp;#x6709;&amp;#x4F7F;&amp;#x7528;&amp;#x8BE5;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;*/&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_PCPTYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* the number of types on the pcp lists */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RESERVE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_ISOLATE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 4&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* can&amp;apos;t allocate from here */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_TYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 5&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x5B9A;&amp;#x4E49;migrate type&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;/font&gt;&lt;a href=&#34;evernote:///view/161681/s10/47ce963e-2a46-4097-ab3b-85b5e8c113bd/47ce963e-2a46-4097-ab3b-85b5e8c113bd/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;linux&amp;#x5185;&amp;#x6838;&amp;#x5BF9;&amp;#x4F19;&amp;#x4F34;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6539;&amp;#x8FDB;--migrate_type&lt;/a&gt;&amp;#x3002;&amp;#x7B80;&amp;#x8981;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;Linux&amp;#x5C06;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x6216;&amp;#x4E0D;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x5F00;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x6700;&amp;#x5927;&amp;#x7A0B;&amp;#x5EA6;&amp;#x7684;&amp;#x51CF;&amp;#x5C11;&amp;#x788E;&amp;#x7247;&amp;#xFF0C;&amp;#x63D0;&amp;#x5347;&amp;#x5206;&amp;#x914D;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x80FD;&amp;#x529B;&amp;#x3002;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x79CD;&amp;#x601D;&amp;#x8DEF;&amp;#xFF0C;&amp;#x53EF;&amp;#x89C1;&amp;#x4E0A;&amp;#x8FF0;5&amp;#x79CD;migrate type&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;type&amp;#x5C31;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RESERVE&amp;#xFF0C;&amp;#x8FD9;&amp;#x8868;&amp;#x793A;page&amp;#x88AB;reserve&amp;#xFF0C;&amp;#x4E0D;&amp;#x63A5;&amp;#x53D7;buddy system&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x53EF;&amp;#x53C2;&amp;#x89C1;&amp;#x51FD;&amp;#x6570;&lt;/span&gt;setup_zone_migrate_reserve&amp;#x3002;&amp;#x5728;&amp;#x542F;&amp;#x52A8;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4F9D;&amp;#x636E;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;page&amp;#x505A;&amp;#x5907;&amp;#x7528;&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x8FD9;&amp;#x4E09;&amp;#x4E2A;type&amp;#x662F;&amp;#x7528;&amp;#x5230;&amp;#x6700;&amp;#x591A;&amp;#x7684;&amp;#x4E09;&amp;#x79CD;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x7528;&amp;#x5230;&amp;#x4E86;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static int fallbacks[MIGRATE_TYPES][MIGRATE_TYPES-1] = {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_UNMOVABLE]&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RECLAIMABLE] = { MIGRATE_UNMOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_MOVABLE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_UNMOVABLE, MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RESERVE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE }, /* Never used */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;migrate type&amp;#x5728;memmap_init&amp;#x4E2D;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;MIGRATE_MOVABLE&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void __meminit memmap_init_zone(unsigned long size, int nid, unsigned long zone,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long start_pfn, enum memmap_context context)&lt;br&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct page *page;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long end_pfn = start_pfn + size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *z;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (highest_memmap_pfn &amp;lt; end_pfn - 1)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; highest_memmap_pfn = end_pfn - 1;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; z = &amp;amp;NODE_DATA(nid)-&amp;gt;node_zones[zone];&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (pfn = start_pfn; pfn &amp;lt; end_pfn; pfn++) {&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; page = pfn_to_page(pfn);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; SetPageReserved(page);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#328712&#34;&gt;/*&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Mark the block movable so that blocks are reserved for&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * movable at startup. This will force kernel allocations&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * to reserve their blocks rather than leaking throughout&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the address space during boot when many long-lived&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * kernel allocations are made. Later some blocks near&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the start are marked MIGRATE_RESERVE by&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * setup_zone_migrate_reserve()&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * bitmap is created for zone&amp;apos;s valid pfn range. but memmap&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * can be created for invalid pages (for alignment)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * check here not to call set_pageblock_migratetype() against&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * pfn out of zone.&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if ((z-&amp;gt;zone_start_pfn &amp;lt;= pfn)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; (pfn &amp;lt; z-&amp;gt;zone_start_pfn + z-&amp;gt;spanned_pages)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; !(pfn &amp;amp; (pageblock_nr_pages - 1)))&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; set_pageblock_migratetype(page, MIGRATE_MOVABLE);&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; INIT_LIST_HEAD(&amp;amp;page-&amp;gt;lru);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;}&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;memmap&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BE5;zone&amp;#x6240;&amp;#x6709;&amp;#x9875;&amp;#x9762;&amp;#x7684;page&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x8BBE;&amp;#x7F6E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page-&amp;gt;flags&amp;#x7684;PG_reserved&amp;#x4F4D;&amp;#xFF0C;&amp;#x610F;&amp;#x601D;&amp;#x662F;&amp;#x4E0D;&amp;#x53D7;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x63A7;&amp;#x5236;&amp;#x3002;&amp;#x6CA1;&amp;#x9519;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x4ECD;&amp;#x5728;bootmem&amp;#x63A7;&amp;#x5236;&amp;#x4E0B;&amp;#xFF0C;&amp;#x4E4B;&amp;#x540E;&amp;#x518D;__free_pages_bootmem&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6E05;&amp;#x9664;&amp;#x8BE5;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5C06;&amp;#x5176;&amp;#x7EB3;&amp;#x5165;buddy&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;2&amp;#xFF09;&amp;#x4E4B;&amp;#x540E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;set_pageblock_migratetype&amp;#x5C06;&amp;#x6240;&amp;#x6709;page&amp;#x7684;migrate type&amp;#x8BBE;&amp;#x4E3A;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x6309;&amp;#x7167;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x987A;&amp;#x5E8F;&amp;#x4E0A;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x540E;&amp;#x9762;&amp;#x624D;&amp;#x4F1A;&amp;#x88AB;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;3&amp;#xFF09;&amp;#x518D;&amp;#x770B;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;set_pageblock_migratetype -&amp;gt;&amp;#xA0;set_pageblock_flags_group&lt;/blockquote&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void set_pageblock_flags_group(struct page *page, unsigned long flags,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int start_bitidx, int end_bitidx)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long *bitmap;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, bitidx;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long value = 1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone = page_zone(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn = page_to_pfn(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitmap = get_pageblock_bitmap(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitidx = pfn_to_bitidx(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (; start_bitidx &amp;lt;= end_bitidx; start_bitidx++, value &amp;lt;&amp;lt;= 1)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (flags &amp;amp; value)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __set_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __clear_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6CA1;&amp;#x6709;&amp;#x60F3;&amp;#x8C61;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x7B80;&amp;#x5355;&amp;#x5427;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;bitmap&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;&amp;#x4EC0;&amp;#x4E48;&amp;#x5462;&amp;#xFF1F;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static unsigned long __init usemap_size(unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(zonesize, pageblock_nr_pages);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = usemapsize &amp;gt;&amp;gt; pageblock_order;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize *= NR_PAGEBLOCK_BITS;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(usemapsize, 8 * sizeof(unsigned long));&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return usemapsize / 8;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static void __init setup_usemap(struct pglist_data *pgdat,&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone, unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize = usemap_size(zonesize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = NULL;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (usemapsize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = alloc_bootmem_node(pgdat, usemapsize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;bitmap&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;zone-&amp;gt;pageblock_flags&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;zone&amp;#x88AB;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;pageblock&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;pageblock&amp;#x5206;&amp;#x914D;3&amp;#x4F4D;&amp;#x6765;&amp;#x8868;&amp;#x793A;migrate type&amp;#x3002;pageblock&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;freearea&amp;#x4E2D;order&amp;#x6700;&amp;#x5927;&amp;#x7684;&amp;#x4E00;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/span&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;free_area_init_core -&amp;gt;&amp;#xA0;set_pageblock_order(pageblock_default_order())&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static inline int pageblock_default_order(void)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (HPAGE_SHIFT &amp;gt; PAGE_SHIFT)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return HUGETLB_PAGE_ORDER;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return MAX_ORDER-1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x7528;get_pageblock_migratetype(page)&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x672C;page&amp;#x7684;migrate type&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x53EA;&amp;#x8981;&amp;#x6CA1;&amp;#x6709;&amp;#x505A;migrate type&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;page&amp;#x7684;migrate type&amp;#x603B;&amp;#x662F;&amp;#x548C;&amp;#x4ED6;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x662F;&amp;#x4E00;&amp;#x81F4;&amp;#x7684;&amp;#x3002;migrate type&amp;#x53EA;&amp;#x4F1A;&amp;#x5728;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E2D;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x5728;&amp;#x672C;migrate type&amp;#x4E2D;&amp;#x65E0;&amp;#x5185;&amp;#x5B58;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5C31;&amp;#x8981;&amp;#x53BB;&amp;#x5907;&amp;#x7528;&amp;#x7684;migrate type&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x627E;&amp;#x6700;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x8FC1;&amp;#x79FB;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x518D;&amp;#x4E0D;&amp;#x6D4E;&amp;#x8FD8;&amp;#x6709;reserved&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0B;&amp;#x9762;&amp;#x5206;&amp;#x6790;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x662F;&amp;#x5982;&amp;#x4F55;&amp;#x6539;&amp;#x53D8;&amp;#x7684;&amp;#x3002;&amp;#x8FD8;&amp;#x662F;&amp;#x6709;&amp;#x70B9;&amp;#x5C0F;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/migrate type&amp;#x2014;&amp;#x2014;buddy system&amp;#x7684;&amp;#x597D;&amp;#x642D;&amp;#x6863;/1537085032358&#34; hash=&#34;78d55e4b7bcdd406f2bf0b19ceba585b&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&amp;#x6240;&amp;#x6709;&amp;#x8BB2;&amp;#x5230;fallback&amp;#x673A;&amp;#x5236;&amp;#x7684;&amp;#x8D44;&amp;#x6599;&amp;#x4E0A;&amp;#x90FD;&amp;#x4F1A;&amp;#x63D0;&amp;#x9192;&amp;#x6211;&amp;#x4EEC;&amp;#x6CE8;&amp;#x610F;&amp;#xFF0C;&amp;#x5728;&amp;#x4ECE;backup migratetype&amp;#x4E2D;&amp;#x53D6;&amp;#x5185;&amp;#x5B58;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x4ECE;&amp;#x5927;&amp;#x7684;order&amp;#x5F80;&amp;#x5C0F;order&amp;#x9012;&amp;#x51CF;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;order&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;NULL&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;&amp;#x7B2C;&amp;#x4E8C;&amp;#x70B9;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E00;&amp;#x8D77;&amp;#x4F5C;&amp;#x7528;&amp;#xFF0C;page&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4F1A;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x800C;&amp;#x662F;&amp;#x5728;&amp;#x6EE1;&amp;#x8DB3;&amp;#x4E00;&amp;#x5B9A;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x624D;&amp;#x4F1A;&amp;#x53D1;&amp;#x751F;&amp;#x3002;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;page moved &amp;gt;= pageblock / 2&amp;#x3002;&amp;#x4EC0;&amp;#x4E48;&amp;#x610F;&amp;#x601D;&amp;#x5462;&amp;#xFF1F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x7684;order&amp;#x8D85;&amp;#x8FC7;pageblock_order&amp;#x7684;&amp;#x4E00;&amp;#x534A;&amp;#xFF0C;&amp;#x4EE5;7800&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;default pageblock_order&amp;#x662F;MAX_ORDER-1 = 10&amp;#xFF0C;&amp;#x5219;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;order&amp;#x8981;&amp;#x8D85;&amp;#x8FC7;5&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;32&amp;#x4E2A;page&amp;#x3002;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x4E0A;&amp;#x6709;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E00;&amp;#x534A;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;buddy&amp;#x3002;&amp;#x82E5;&amp;#x6EE1;&amp;#x8DB3;&amp;#x8FD9;&amp;#x4E24;&amp;#x70B9;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x4F1A;&amp;#x88AB;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C5E;&amp;#x4E8E;&amp;#x4ED6;&amp;#x4E14;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#x7684;buddy&amp;#x5728;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;&amp;#x5408;&amp;#x5E76;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x6D4B;&amp;#x8BD5;&amp;#x4E0A;&amp;#x9762;&amp;#x6240;&amp;#x8BF4;&amp;#x7684;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5148;&amp;#x5C06;pageblock&amp;#x4E2D;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;buddy&amp;#x79FB;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#xFF0C;&amp;#x4F46;&amp;#x5E76;&amp;#x4E0D;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x6539;&amp;#x53D8;&amp;#x5176;migratetype&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x83B7;&amp;#x53D6;migratetype&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x51FD;&amp;#x6570;get_pageblock_migratetype&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x53EA;&amp;#x8981;&amp;#x4E0D;&amp;#x4FEE;&amp;#x6539;&amp;#x6574;&amp;#x5757;pageblock&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;&amp;#x5230;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;buddy&amp;#x7684;migratetype&amp;#x5C5E;&amp;#x6027;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 4&amp;#xFF09;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x8D85;&amp;#x8FC7;pageblock&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x90FD;&amp;#x4FEE;&amp;#x6539;&amp;#x6210;&amp;#x6211;&amp;#x4EEC;&amp;#x6240;&amp;#x9700;&amp;#x8981;&amp;#x7684;migratetype&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD9;&amp;#x91CC;&amp;#x53CD;&amp;#x6620;&amp;#x51FA;&amp;#x7684;&amp;#x601D;&amp;#x60F3;&amp;#x548C;&amp;#x4E0A;&amp;#x9762;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x5185;&amp;#x5B58;&amp;#x8DB3;&amp;#x591F;&amp;#x5927;&amp;#xFF0C;&amp;#x5C31;&amp;#x8FC1;&amp;#x79FB;migratetype&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 5&amp;#xFF09;&amp;#x6700;&amp;#x540E;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x4E00;&amp;#x70B9;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x5224;&amp;#x65AD;&amp;#x5176;&amp;#x5B9E;&amp;#x4E0D;&amp;#x5B8C;&amp;#x6574;&amp;#xFF0C;&amp;#x771F;&amp;#x5B9E;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;if (unlikely(current_order &amp;gt;= (pageblock_order &amp;gt;&amp;gt; 1)) ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_migratetype == MIGRATE_RECLAIMABLE ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;page_group_by_mobility_disabled) { &amp;#x2026;&amp;#x2026; }&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#x8868;&amp;#x793A;&amp;#x8FC1;&amp;#x79FB;&amp;#x7279;&amp;#x6027;&amp;#x5173;&amp;#x95ED;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x9875;&amp;#x9762;&amp;#x5E76;&amp;#x4E0D;&amp;#x53D7;migratetype&amp;#x6240;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x90A3;&amp;#x9875;&amp;#x9762;&amp;#x5E94;&amp;#x8BE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x968F;&amp;#x5FC3;&amp;#x6240;&amp;#x6B32;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x786E;&amp;#x5B9E;&amp;#x5982;&amp;#x6B64;&amp;#xFF0C;&amp;#x540E;&amp;#x9762;&amp;#x5982;&amp;#x679C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#xFF0C;&amp;#x4E5F;&amp;#x5E76;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x5224;&amp;#x65AD;&amp;#x6709;&amp;#x591A;&amp;#x5C11;free buddy&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FC1;&amp;#x79FB;&amp;#x9875;&amp;#x9762;&amp;#x4E86;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF0C;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;start_migratetype == MIGRATE_RECLAIMABLE&amp;#x5C31;&amp;#x503C;&amp;#x5F97;&amp;#x63A8;&amp;#x6572;&amp;#x4E86;&amp;#x3002;&amp;#x6240;&amp;#x6709;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x90FD;&amp;#x6CA1;&amp;#x6709;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&amp;#x7F51;&amp;#x7EDC;&amp;#x4E0A;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x89E3;&amp;#x91CA;&amp;#x662F;&amp;#xFF1A;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;i&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#x53EF;&amp;#x56DE;&amp;#x6536;&amp;#x9875;&amp;#xFF1A;&amp;#x4E0D;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x79FB;&amp;#x52A8;&amp;#xFF0C;&amp;#x4F46;&amp;#x53EF;&amp;#x4EE5;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x5176;&amp;#x5185;&amp;#x5BB9;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x67D0;&amp;#x4E9B;&amp;#x6E90;&amp;#x91CD;&amp;#x65B0;&amp;#x751F;&amp;#x6210;&lt;/span&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#xA0;&amp;#xA0;&lt;/span&gt;&lt;/i&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x4EE5;&amp;#x6211;&amp;#x8BA4;&amp;#x4E3A;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RECLAIMABLE&amp;#x56E0;&amp;#x4E3A;&amp;#x5F88;&amp;#x5BB9;&amp;#x6613;&amp;#x88AB;&amp;#x91CA;&amp;#x653E;&amp;#xFF08;&amp;#x6216;&amp;#x53EB;&amp;#x56DE;&amp;#x6536;&amp;#xFF09;&amp;#xFF0C;&amp;#x4ED6;&amp;#x4E5F;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#x548C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x66FF;&amp;#x8865;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x7BA1;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x9875;&amp;#x9762;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#xFF0C;&amp;#x90FD;&amp;#x5E94;&amp;#x8BE5;&amp;#x5C3D;&amp;#x53EF;&amp;#x80FD;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#x7ED9;&amp;#x4ED6;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;br&gt;&lt;div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/12/12/migrate_type-buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</guid>
            <title>migrate type——buddy system的好搭档</title>
            <link>https://blog.zhougy.top/2012/12/12/migrate_type-buddy_system%E7%9A%84%E5%A5%BD%E6%90%AD%E6%A1%A3/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Wed, 12 Dec 2012 21:49:24 +0800</pubDate>
            <description><![CDATA[ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!DOCTYPE en-note SYSTEM &#34;http://xml.evernote.com/pub/enml2.dtd&#34;&gt;&lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; display: block;&#34; title lang xml:lang dir&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;Linux&amp;#x4E00;&amp;#x5171;&amp;#x5B9A;&amp;#x4E49;5&amp;#x4E2D;migrate type&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_UNMOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 0&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RECLAIMABLE&amp;#xA0;&amp;#xA0; 1&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_MOVABLE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 2&lt;/font&gt;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;/* &amp;#x672A;&amp;#x89C1;&amp;#x6709;&amp;#x4F7F;&amp;#x7528;&amp;#x8BE5;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;*/&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_PCPTYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* the number of types on the pcp lists */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_RESERVE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 3&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_ISOLATE&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 4&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;/* can&amp;apos;t allocate from here */&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;#define MIGRATE_TYPES&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; 5&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x5B9A;&amp;#x4E49;migrate type&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;/font&gt;&lt;a href=&#34;evernote:///view/161681/s10/47ce963e-2a46-4097-ab3b-85b5e8c113bd/47ce963e-2a46-4097-ab3b-85b5e8c113bd/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;linux&amp;#x5185;&amp;#x6838;&amp;#x5BF9;&amp;#x4F19;&amp;#x4F34;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6539;&amp;#x8FDB;--migrate_type&lt;/a&gt;&amp;#x3002;&amp;#x7B80;&amp;#x8981;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;Linux&amp;#x5C06;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x6216;&amp;#x4E0D;&amp;#x53EF;&amp;#x79FB;&amp;#x52A8;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x5F00;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x6700;&amp;#x5927;&amp;#x7A0B;&amp;#x5EA6;&amp;#x7684;&amp;#x51CF;&amp;#x5C11;&amp;#x788E;&amp;#x7247;&amp;#xFF0C;&amp;#x63D0;&amp;#x5347;&amp;#x5206;&amp;#x914D;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x80FD;&amp;#x529B;&amp;#x3002;&amp;#x57FA;&amp;#x4E8E;&amp;#x8FD9;&amp;#x79CD;&amp;#x601D;&amp;#x8DEF;&amp;#xFF0C;&amp;#x53EF;&amp;#x89C1;&amp;#x4E0A;&amp;#x8FF0;5&amp;#x79CD;migrate type&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;type&amp;#x5C31;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RESERVE&amp;#xFF0C;&amp;#x8FD9;&amp;#x8868;&amp;#x793A;page&amp;#x88AB;reserve&amp;#xFF0C;&amp;#x4E0D;&amp;#x63A5;&amp;#x53D7;buddy system&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x53EF;&amp;#x53C2;&amp;#x89C1;&amp;#x51FD;&amp;#x6570;&lt;/span&gt;setup_zone_migrate_reserve&amp;#x3002;&amp;#x5728;&amp;#x542F;&amp;#x52A8;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4F9D;&amp;#x636E;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;page&amp;#x505A;&amp;#x5907;&amp;#x7528;&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#x8FD9;&amp;#x4E09;&amp;#x4E2A;type&amp;#x662F;&amp;#x7528;&amp;#x5230;&amp;#x6700;&amp;#x591A;&amp;#x7684;&amp;#x4E09;&amp;#x79CD;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x7528;&amp;#x5230;&amp;#x4E86;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static int fallbacks[MIGRATE_TYPES][MIGRATE_TYPES-1] = {&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_UNMOVABLE]&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RECLAIMABLE] = { MIGRATE_UNMOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_MOVABLE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_MOVABLE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RECLAIMABLE, MIGRATE_UNMOVABLE, MIGRATE_RESERVE },&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; [MIGRATE_RESERVE]&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; = { MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE,&amp;#xA0;&amp;#xA0; MIGRATE_RESERVE }, /* Never used */&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;migrate type&amp;#x5728;memmap_init&amp;#x4E2D;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E3A;MIGRATE_MOVABLE&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void __meminit memmap_init_zone(unsigned long size, int nid, unsigned long zone,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long start_pfn, enum memmap_context context)&lt;br&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct page *page;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long end_pfn = start_pfn + size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *z;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (highest_memmap_pfn &amp;lt; end_pfn - 1)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; highest_memmap_pfn = end_pfn - 1;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; z = &amp;amp;NODE_DATA(nid)-&amp;gt;node_zones[zone];&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (pfn = start_pfn; pfn &amp;lt; end_pfn; pfn++) {&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; page = pfn_to_page(pfn);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; SetPageReserved(page);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/font&gt; &lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#328712&#34;&gt;/*&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Mark the block movable so that blocks are reserved for&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * movable at startup. This will force kernel allocations&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * to reserve their blocks rather than leaking throughout&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the address space during boot when many long-lived&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * kernel allocations are made. Later some blocks near&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * the start are marked MIGRATE_RESERVE by&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * setup_zone_migrate_reserve()&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * bitmap is created for zone&amp;apos;s valid pfn range. but memmap&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * can be created for invalid pages (for alignment)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * check here not to call set_pageblock_migratetype() against&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * pfn out of zone.&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if ((z-&amp;gt;zone_start_pfn &amp;lt;= pfn)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; (pfn &amp;lt; z-&amp;gt;zone_start_pfn + z-&amp;gt;spanned_pages)&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0; &amp;amp;&amp;amp; !(pfn &amp;amp; (pageblock_nr_pages - 1)))&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; set_pageblock_migratetype(page, MIGRATE_MOVABLE);&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; INIT_LIST_HEAD(&amp;amp;page-&amp;gt;lru);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;br&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;}&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;memmap&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BE5;zone&amp;#x6240;&amp;#x6709;&amp;#x9875;&amp;#x9762;&amp;#x7684;page&amp;#x7ED3;&amp;#x6784;&amp;#x4F53;&amp;#xFF0C;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x8BBE;&amp;#x7F6E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page-&amp;gt;flags&amp;#x7684;PG_reserved&amp;#x4F4D;&amp;#xFF0C;&amp;#x610F;&amp;#x601D;&amp;#x662F;&amp;#x4E0D;&amp;#x53D7;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&amp;#x63A7;&amp;#x5236;&amp;#x3002;&amp;#x6CA1;&amp;#x9519;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x4ECD;&amp;#x5728;bootmem&amp;#x63A7;&amp;#x5236;&amp;#x4E0B;&amp;#xFF0C;&amp;#x4E4B;&amp;#x540E;&amp;#x518D;__free_pages_bootmem&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6E05;&amp;#x9664;&amp;#x8BE5;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5C06;&amp;#x5176;&amp;#x7EB3;&amp;#x5165;buddy&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;2&amp;#xFF09;&amp;#x4E4B;&amp;#x540E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;set_pageblock_migratetype&amp;#x5C06;&amp;#x6240;&amp;#x6709;page&amp;#x7684;migrate type&amp;#x8BBE;&amp;#x4E3A;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x3002;&amp;#x4E4B;&amp;#x524D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x6309;&amp;#x7167;water mark min&amp;#x6765;reserve&amp;#x4E00;&amp;#x4E9B;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x987A;&amp;#x5E8F;&amp;#x4E0A;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x540E;&amp;#x9762;&amp;#x624D;&amp;#x4F1A;&amp;#x88AB;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;3&amp;#xFF09;&amp;#x518D;&amp;#x770B;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;set_pageblock_migratetype -&amp;gt;&amp;#xA0;set_pageblock_flags_group&lt;/blockquote&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;void set_pageblock_flags_group(struct page *page, unsigned long flags,&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; int start_bitidx, int end_bitidx)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long *bitmap;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, bitidx;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long value = 1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone = page_zone(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn = page_to_pfn(page);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitmap = get_pageblock_bitmap(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; bitidx = pfn_to_bitidx(zone, pfn);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (; start_bitidx &amp;lt;= end_bitidx; start_bitidx++, value &amp;lt;&amp;lt;= 1)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (flags &amp;amp; value)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __set_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __clear_bit(bitidx + start_bitidx, bitmap);&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6CA1;&amp;#x6709;&amp;#x60F3;&amp;#x8C61;&amp;#x7684;&amp;#x90A3;&amp;#x4E48;&amp;#x7B80;&amp;#x5355;&amp;#x5427;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;bitmap&amp;#xFF0C;&amp;#x4ED6;&amp;#x662F;&amp;#x4EC0;&amp;#x4E48;&amp;#x5462;&amp;#xFF1F;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static unsigned long __init usemap_size(unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(zonesize, pageblock_nr_pages);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = usemapsize &amp;gt;&amp;gt; pageblock_order;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize *= NR_PAGEBLOCK_BITS;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usemapsize = roundup(usemapsize, 8 * sizeof(unsigned long));&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return usemapsize / 8;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static void __init setup_usemap(struct pglist_data *pgdat,&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct zone *zone, unsigned long zonesize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long usemapsize = usemap_size(zonesize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = NULL;&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (usemapsize)&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; zone-&amp;gt;pageblock_flags = alloc_bootmem_node(pgdat, usemapsize);&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x8C13;&amp;#x7684;bitmap&amp;#x5C31;&amp;#x662F;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;zone-&amp;gt;pageblock_flags&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;zone&amp;#x88AB;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;pageblock&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;pageblock&amp;#x5206;&amp;#x914D;3&amp;#x4F4D;&amp;#x6765;&amp;#x8868;&amp;#x793A;migrate type&amp;#x3002;pageblock&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;freearea&amp;#x4E2D;order&amp;#x6700;&amp;#x5927;&amp;#x7684;&amp;#x4E00;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#x6765;&amp;#xFF1A;&lt;/span&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;free_area_init_core -&amp;gt;&amp;#xA0;set_pageblock_order(pageblock_default_order())&lt;/font&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;static inline int pageblock_default_order(void)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (HPAGE_SHIFT &amp;gt; PAGE_SHIFT)&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return HUGETLB_PAGE_ORDER;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return MAX_ORDER-1;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x7528;get_pageblock_migratetype(page)&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x672C;page&amp;#x7684;migrate type&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x53EA;&amp;#x8981;&amp;#x6CA1;&amp;#x6709;&amp;#x505A;migrate type&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;page&amp;#x7684;migrate type&amp;#x603B;&amp;#x662F;&amp;#x548C;&amp;#x4ED6;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x662F;&amp;#x4E00;&amp;#x81F4;&amp;#x7684;&amp;#x3002;migrate type&amp;#x53EA;&amp;#x4F1A;&amp;#x5728;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E2D;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5206;&amp;#x914D;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x5728;&amp;#x672C;migrate type&amp;#x4E2D;&amp;#x65E0;&amp;#x5185;&amp;#x5B58;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x5C31;&amp;#x8981;&amp;#x53BB;&amp;#x5907;&amp;#x7528;&amp;#x7684;migrate type&amp;#x5217;&amp;#x8868;&amp;#x4E2D;&amp;#x627E;&amp;#x6700;&amp;#x5927;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x8FC1;&amp;#x79FB;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x518D;&amp;#x4E0D;&amp;#x6D4E;&amp;#x8FD8;&amp;#x6709;reserved&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0B;&amp;#x9762;&amp;#x5206;&amp;#x6790;&amp;#x4E00;&amp;#x4E0B;migrate type&amp;#x662F;&amp;#x5982;&amp;#x4F55;&amp;#x6539;&amp;#x53D8;&amp;#x7684;&amp;#x3002;&amp;#x8FD8;&amp;#x662F;&amp;#x6709;&amp;#x70B9;&amp;#x5C0F;&amp;#x590D;&amp;#x6742;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/migrate type&amp;#x2014;&amp;#x2014;buddy system&amp;#x7684;&amp;#x597D;&amp;#x642D;&amp;#x6863;/1499486799151&#34; hash=&#34;78d55e4b7bcdd406f2bf0b19ceba585b&#34; align alt longdesc width=&#34;910&#34; height=&#34;657&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&amp;#x6240;&amp;#x6709;&amp;#x8BB2;&amp;#x5230;fallback&amp;#x673A;&amp;#x5236;&amp;#x7684;&amp;#x8D44;&amp;#x6599;&amp;#x4E0A;&amp;#x90FD;&amp;#x4F1A;&amp;#x63D0;&amp;#x9192;&amp;#x6211;&amp;#x4EEC;&amp;#x6CE8;&amp;#x610F;&amp;#xFF0C;&amp;#x5728;&amp;#x4ECE;backup migratetype&amp;#x4E2D;&amp;#x53D6;&amp;#x5185;&amp;#x5B58;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x4ECE;&amp;#x5927;&amp;#x7684;order&amp;#x5F80;&amp;#x5C0F;order&amp;#x9012;&amp;#x51CF;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;order&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;NULL&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 2&amp;#xFF09;&amp;#x7B2C;&amp;#x4E8C;&amp;#x70B9;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;fallback&amp;#x673A;&amp;#x5236;&amp;#x4E00;&amp;#x8D77;&amp;#x4F5C;&amp;#x7528;&amp;#xFF0C;page&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4F1A;&amp;#x6539;&amp;#x53D8;&amp;#x3002;&amp;#x800C;&amp;#x662F;&amp;#x5728;&amp;#x6EE1;&amp;#x8DB3;&amp;#x4E00;&amp;#x5B9A;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x624D;&amp;#x4F1A;&amp;#x53D1;&amp;#x751F;&amp;#x3002;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;page moved &amp;gt;= pageblock / 2&amp;#x3002;&amp;#x4EC0;&amp;#x4E48;&amp;#x610F;&amp;#x601D;&amp;#x5462;&amp;#xFF1F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x7684;order&amp;#x8D85;&amp;#x8FC7;pageblock_order&amp;#x7684;&amp;#x4E00;&amp;#x534A;&amp;#xFF0C;&amp;#x4EE5;7800&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;default pageblock_order&amp;#x662F;MAX_ORDER-1 = 10&amp;#xFF0C;&amp;#x5219;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;order&amp;#x8981;&amp;#x8D85;&amp;#x8FC7;5&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;32&amp;#x4E2A;page&amp;#x3002;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x4E0A;&amp;#x6709;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E00;&amp;#x534A;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;buddy&amp;#x3002;&amp;#x82E5;&amp;#x6EE1;&amp;#x8DB3;&amp;#x8FD9;&amp;#x4E24;&amp;#x70B9;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x6240;&amp;#x5728;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x4F1A;&amp;#x88AB;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C5E;&amp;#x4E8E;&amp;#x4ED6;&amp;#x4E14;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#x7684;buddy&amp;#x5728;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x88AB;&amp;#x5408;&amp;#x5E76;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x6D4B;&amp;#x8BD5;&amp;#x4E0A;&amp;#x9762;&amp;#x6240;&amp;#x8BF4;&amp;#x7684;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5148;&amp;#x5C06;pageblock&amp;#x4E2D;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;buddy&amp;#x79FB;&amp;#x5230;&amp;#x65B0;&amp;#x7684;migratetype&amp;#x4E2D;&amp;#xFF0C;&amp;#x4F46;&amp;#x5E76;&amp;#x4E0D;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x6539;&amp;#x53D8;&amp;#x5176;migratetype&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x83B7;&amp;#x53D6;migratetype&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x51FD;&amp;#x6570;get_pageblock_migratetype&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x53EA;&amp;#x8981;&amp;#x4E0D;&amp;#x4FEE;&amp;#x6539;&amp;#x6574;&amp;#x5757;pageblock&amp;#x7684;migratetype&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;&amp;#x5230;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;buddy&amp;#x7684;migratetype&amp;#x5C5E;&amp;#x6027;&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 4&amp;#xFF09;&amp;#x5F53;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x8FD9;&amp;#x5757;&amp;#x5927;&amp;#x5185;&amp;#x5B58;&amp;#x8D85;&amp;#x8FC7;pageblock&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;&amp;#x5176;&amp;#x4E0B;&amp;#x6240;&amp;#x6709;&amp;#x7684;pageblock&amp;#x7684;migratetype&amp;#x90FD;&amp;#x4FEE;&amp;#x6539;&amp;#x6210;&amp;#x6211;&amp;#x4EEC;&amp;#x6240;&amp;#x9700;&amp;#x8981;&amp;#x7684;migratetype&amp;#x3002;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD9;&amp;#x91CC;&amp;#x53CD;&amp;#x6620;&amp;#x51FA;&amp;#x7684;&amp;#x601D;&amp;#x60F3;&amp;#x548C;&amp;#x4E0A;&amp;#x9762;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x5185;&amp;#x5B58;&amp;#x8DB3;&amp;#x591F;&amp;#x5927;&amp;#xFF0C;&amp;#x5C31;&amp;#x8FC1;&amp;#x79FB;migratetype&amp;#x3002;&lt;/div&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; 5&amp;#xFF09;&amp;#x6700;&amp;#x540E;&amp;#x503C;&amp;#x5F97;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x4E00;&amp;#x70B9;&amp;#x5C31;&amp;#x662F;&amp;#xFF0C;&amp;#x7EA2;&amp;#x5708;&amp;#x4E2D;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x5224;&amp;#x65AD;&amp;#x5176;&amp;#x5B9E;&amp;#x4E0D;&amp;#x5B8C;&amp;#x6574;&amp;#xFF0C;&amp;#x771F;&amp;#x5B9E;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#xFF1A;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;if (unlikely(current_order &amp;gt;= (pageblock_order &amp;gt;&amp;gt; 1)) ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_migratetype == MIGRATE_RECLAIMABLE ||&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;page_group_by_mobility_disabled) { &amp;#x2026;&amp;#x2026; }&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#x8868;&amp;#x793A;&amp;#x8FC1;&amp;#x79FB;&amp;#x7279;&amp;#x6027;&amp;#x5173;&amp;#x95ED;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x9875;&amp;#x9762;&amp;#x5E76;&amp;#x4E0D;&amp;#x53D7;migratetype&amp;#x6240;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x90A3;&amp;#x9875;&amp;#x9762;&amp;#x5E94;&amp;#x8BE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x968F;&amp;#x5FC3;&amp;#x6240;&amp;#x6B32;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x786E;&amp;#x5B9E;&amp;#x5982;&amp;#x6B64;&amp;#xFF0C;&amp;#x540E;&amp;#x9762;&amp;#x5982;&amp;#x679C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;page_group_by_mobility_disabled&amp;#xFF0C;&amp;#x4E5F;&amp;#x5E76;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x5224;&amp;#x65AD;&amp;#x6709;&amp;#x591A;&amp;#x5C11;free buddy&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FC1;&amp;#x79FB;&amp;#x9875;&amp;#x9762;&amp;#x4E86;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF0C;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;start_migratetype == MIGRATE_RECLAIMABLE&amp;#x5C31;&amp;#x503C;&amp;#x5F97;&amp;#x63A8;&amp;#x6572;&amp;#x4E86;&amp;#x3002;&amp;#x6240;&amp;#x6709;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x90FD;&amp;#x6CA1;&amp;#x6709;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&amp;#x7F51;&amp;#x7EDC;&amp;#x4E0A;&amp;#x5BF9;&amp;#x5176;&amp;#x7684;&amp;#x89E3;&amp;#x91CA;&amp;#x662F;&amp;#xFF1A;&lt;/span&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;i&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#x53EF;&amp;#x56DE;&amp;#x6536;&amp;#x9875;&amp;#xFF1A;&amp;#x4E0D;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x79FB;&amp;#x52A8;&amp;#xFF0C;&amp;#x4F46;&amp;#x53EF;&amp;#x4EE5;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x5176;&amp;#x5185;&amp;#x5BB9;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x67D0;&amp;#x4E9B;&amp;#x6E90;&amp;#x91CD;&amp;#x65B0;&amp;#x751F;&amp;#x6210;&lt;/span&gt;&lt;span style=&#34;box-sizing: inherit !important; padding: 0px; margin: 0px; cursor: default; font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;, Verdana, sans-serif, &amp;#x5B8B;&amp;#x4F53;; text-align: left; background-color: rgb(255, 255, 255);&#34;&gt;&amp;#xA0;&amp;#xA0;&lt;/span&gt;&lt;/i&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6240;&amp;#x4EE5;&amp;#x6211;&amp;#x8BA4;&amp;#x4E3A;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_RECLAIMABLE&amp;#x56E0;&amp;#x4E3A;&amp;#x5F88;&amp;#x5BB9;&amp;#x6613;&amp;#x88AB;&amp;#x91CA;&amp;#x653E;&amp;#xFF08;&amp;#x6216;&amp;#x53EB;&amp;#x56DE;&amp;#x6536;&amp;#xFF09;&amp;#xFF0C;&amp;#x4ED6;&amp;#x4E5F;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_UNMOVABLE&amp;#x548C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;MIGRATE_MOVABLE&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x66FF;&amp;#x8865;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x7BA1;&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x9875;&amp;#x9762;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#xFF0C;&amp;#x90FD;&amp;#x5E94;&amp;#x8BE5;&amp;#x5C3D;&amp;#x53EF;&amp;#x80FD;&amp;#x7684;&amp;#x8FC1;&amp;#x79FB;&amp;#x7ED9;&amp;#x4ED6;&amp;#x3002;&lt;/span&gt;&lt;/blockquote&gt;&lt;div style=&#34;display: block;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;br&gt;&lt;div style=&#34;display: block;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/23/Linux%E5%86%85%E5%AD%98%E4%B9%8B%E9%A1%B5%E8%A1%A8/</guid>
            <title>Linux内存之页表</title>
            <link>https://blog.zhougy.top/2012/11/23/Linux%E5%86%85%E5%AD%98%E4%B9%8B%E9%A1%B5%E8%A1%A8/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Fri, 23 Nov 2012 13:58:08 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;Linux&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x9875;&amp;#x8868;&amp;#x7684;&amp;#x6846;&amp;#x67B6;&amp;#x5728; &lt;a href=&#34;evernote:///view/161681/s10/58f22e85-f865-455a-ad12-948ff6c02459/58f22e85-f865-455a-ad12-948ff6c02459/&#34; style=&#34;color:#69aa35&#34;&gt;vmalloc&amp;#x5206;&amp;#x6790;&lt;/a&gt;&amp;#x4E2D;&amp;#xFF0C;__vmalloc_area_node&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E0E;&amp;#x5206;&amp;#x914D;&amp;#x9875;&amp;#x8868;&amp;#x9879;&amp;#x4E24;&amp;#x8282;&amp;#x4E2D;&amp;#x5DF2;&amp;#x7ECF;&amp;#x6709;&amp;#x6240;&amp;#x9610;&amp;#x8FF0;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x518D;&amp;#x505A;&amp;#x4E00;&amp;#x4E9B;&amp;#x603B;&amp;#x4F53;&amp;#x4E0A;&amp;#x7684;&amp;#x628A;&amp;#x63E1;&amp;#x3002;&amp;#x6587;&amp;#x4E2D;&amp;#x4F1A;&amp;#x501F;&amp;#x7528;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x56FE;&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x6240;&amp;#x8C13;&amp;#x7684;&amp;#x9875;&amp;#x8868;&amp;#x7ED3;&amp;#x6784;&amp;#x5982;&amp;#x4E0B;&amp;#x3002;&amp;#x9488;&amp;#x5BF9;&amp;#x73B0;&amp;#x5728;&amp;#x7684;64&amp;#x4F4D;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;Linux&amp;#x5DF2;&amp;#x7ECF;&amp;#x53EF;&amp;#x4EE5;&amp;#x652F;&amp;#x6301;4&amp;#x7EA7;&amp;#x9875;&amp;#x8868;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5373;pgd&amp;#xFF0C;pud&amp;#xFF0C;pmd&amp;#x548C;pte&amp;#x3002;&amp;#x4F46;&amp;#x76EE;&amp;#x524D;&amp;#x4E00;&amp;#x822C;&amp;#x5D4C;&amp;#x5165;&amp;#x5F0F;&amp;#x7684;&amp;#x5E94;&amp;#x7528;&amp;#x5E76;&amp;#x4E0D;&amp;#x4F1A;&amp;#x4F7F;&amp;#x80FD;&amp;#x8BE5;&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;pud&amp;#x548C;pmd&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x90FD;&amp;#x662F;&amp;#x6307;&amp;#x5411;pgd&amp;#x8868;&amp;#x9879;&amp;#x7684;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/Linux&amp;#x5185;&amp;#x5B58;&amp;#x4E4B;&amp;#x9875;&amp;#x8868;/1537085034090&#34; hash=&#34;3e44ac2386ec1722d0f7d00bcbd8748b&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x7B80;&amp;#x5355;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E0B;&amp;#x8FD9;&amp;#x5E45;&amp;#x56FE;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. &amp;#x6240;&amp;#x6709;Linux&amp;#x90FD;&amp;#x662F;4G&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x4EE3;&amp;#x8868;2MB&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x5171;2K&amp;#x8868;&amp;#x9879;&amp;#xFF0C;&amp;#x5360;2&amp;#x4E2A;page&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5728;&amp;#x8868;&amp;#x4E2D;&amp;#x90FD;&amp;#x662F;&amp;#x6709;&amp;#x5E8F;&amp;#x7684;&amp;#xFF0C;&amp;#x5373;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7A7A;&amp;#x95F4;&amp;#x4E2D;&amp;#x4E5F;&amp;#x662F;&amp;#x6709;&amp;#x4F4E;&amp;#x5230;&amp;#x9AD8;&amp;#x7684;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x6BCF;&amp;#x4E2A;pgd&amp;#x8868;&amp;#x9879;&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;page&amp;#xFF0C;4KB&amp;#xFF0C;&amp;#x5206;&amp;#x6210;4&amp;#x4E2A;&amp;#x5B50;&amp;#x8868;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3. &amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x5B50;&amp;#x8868;2KB&amp;#xFF0C;&amp;#x5305;&amp;#x542B;512&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#xFF0C;&amp;#x6B63;&amp;#x597D;2MB&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x89C6;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;pte&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;page&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;pgd&amp;#x8868;&amp;#x4FDD;&amp;#x5B58;&amp;#x5728;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7684;mm_struct&amp;#x4E2D;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;struct mm_struct {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;pgd_t * pgd;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;pte_alloc_map /&amp;#xA0;pte_alloc_map_lock /&amp;#xA0;pte_alloc_kernel&amp;#x8FD9;&amp;#x51E0;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E3A;pgd&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x5206;&amp;#x914D;&amp;#x4ED6;&amp;#x6240;&amp;#x6307;&amp;#x5411;&amp;#x7684;&amp;#x90A3;&amp;#x4E00;&amp;#x9875;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;pte&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x56E0;&amp;#x4E3A;&amp;#x5185;&amp;#x5B58;&amp;#x4F1A;&amp;#x4E0D;&amp;#x65AD;&amp;#x7684;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x4E0D;&amp;#x53EF;&amp;#x80FD;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;page&amp;#x90FD;&amp;#x4F1A;&amp;#x65B0;&amp;#x5EFA;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x4E00;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;Linux&amp;#x4E3A;&amp;#x6BCF;&amp;#x4E2A;pgd&amp;#x8868;&amp;#x9879;&amp;#xFF08;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x4E3A;&amp;#x4E86;&amp;#x517C;&amp;#x5BB9;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x5C06;&amp;#x4E4B;&amp;#x79F0;&amp;#x4E3A;pmd&amp;#xFF09;&amp;#x52A0;&amp;#x5165;&amp;#x4E86;&amp;#x4E00;&amp;#x4E9B;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5E76;&amp;#x5728;&amp;#x6BCF;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x4E4B;&amp;#x524D;&amp;#xFF0C;&amp;#x7528;&amp;#x5B8F;pmd_present(*(pmd))&amp;#x6765;&amp;#x68C0;&amp;#x9A8C;&amp;#x6B64;pte&amp;#x662F;&amp;#x5426;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5206;&amp;#x914D;&amp;#x4E86;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5206;&amp;#x914D;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x518D;&amp;#x5206;&amp;#x914D;&amp;#x4E86;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5462;&amp;#xFF1F;&lt;a href=&#34;evernote:///view/161681/s10/58f22e85-f865-455a-ad12-948ff6c02459/58f22e85-f865-455a-ad12-948ff6c02459/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;vmalloc&amp;#x5206;&amp;#x6790;&lt;/a&gt;&amp;#x4E5F;&amp;#x6709;&amp;#x6240;&amp;#x5206;&amp;#x6790;&amp;#x3002;&amp;#x5373;&amp;#x51FD;&amp;#x6570;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x8FD8;&amp;#x6709;&amp;#x5176;&amp;#x4ED6;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;&lt;/span&gt;pmd_populate&amp;#x3002;&amp;#x4ED6;&amp;#x4EEC;&amp;#x8C03;&amp;#x7528;&amp;#x8FD9;&amp;#x7684;&amp;#x6700;&amp;#x7EC8;&amp;#x51FD;&amp;#x6570;&amp;#x90FD;&amp;#x540C;&amp;#x662F;__pmd_populate&amp;#x3002;&amp;#x5373;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;pmdp[0] = __pmd(pmdval) ; &amp;#xA0;&lt;/font&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;// =&amp;#xA0;pmdval&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;pmdp[1] = __pmd(pmdval + 256 * sizeof(pte_t));&lt;/font&gt; &lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;// = &amp;#xA0;pmdval + 256 * sizeof(pte_t)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/Linux&amp;#x5185;&amp;#x5B58;&amp;#x4E4B;&amp;#x9875;&amp;#x8868;/1537085034093&#34; hash=&#34;8b0618db320f080d0cdad5ed8b11f8a9&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/div&gt;&lt;div&gt;pmd_populate&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x7528;&amp;#x6237;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#xFF0C;&amp;#x800C;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#x662F;&amp;#x5728;&amp;#x4E3A;&amp;#x5185;&amp;#x6838;&amp;#x5730;&amp;#x5740;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x4ED6;&amp;#x4EEC;&amp;#x4E4B;&amp;#x95F4;&lt;/span&gt;&amp;#x7684;&amp;#x5DEE;&amp;#x522B;&amp;#x4FBF;&amp;#x6C34;&amp;#x5230;&amp;#x6E20;&amp;#x6210;&amp;#x4E86;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. &amp;#x4E24;&amp;#x8005;&amp;#x4E3A;pmd&amp;#x586B;&amp;#x5145;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x4E0D;&amp;#x4E00;&amp;#x6837;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#xFF1A;&lt;/span&gt;__pa(pte_ptr) | _PAGE_KERNEL_TABLE&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate&amp;#xFF1A;&lt;/span&gt;page_to_pfn(ptep) &amp;lt;&amp;lt; PAGE_SHIFT | _PAGE_USER_TABLE&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x53EF;&amp;#x89C1;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;+kernel&amp;#x6807;&amp;#x5FD7;&amp;#xFF0C;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;+user&amp;#x6807;&amp;#x5FD7;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x4E24;&amp;#x8005;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x4E5F;&amp;#x4E0D;&amp;#x540C;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate_kernel&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;pmd_populate&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x5219;&amp;#x662F;page&amp;#x7ED3;&amp;#x6784;&amp;#x6307;&amp;#x9488;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;#x5FAE;&amp;#x8F6F;&amp;#x96C5;&amp;#x9ED1;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0D;&amp;#x7BA1;&amp;#x600E;&amp;#x4E48;&amp;#x6837;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x4ED6;&amp;#x4EEC;&amp;#x7684;&amp;#x5B9E;&amp;#x8D28;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;pmd&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x90FD;&amp;#x662F;&amp;#x8FD9;&amp;#x4E00;&amp;#x4E2A;page&amp;#x8868;&amp;#x683C;&amp;#x6240;&amp;#x5728;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF08;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x504F;&amp;#x79FB;PAGE_SHIFT&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#xFF09;+&amp;#x4E00;&amp;#x4E2A;&amp;#x6807;&amp;#x5FD7;&amp;#x5185;&amp;#x6838;&amp;#x8FDB;&amp;#x7A0B;&amp;#x8FD8;&amp;#x662F;&amp;#x7528;&amp;#x6237;&amp;#x8FDB;&amp;#x7A0B; &amp;#x7684;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x81F3;&amp;#x6B64;&amp;#xFF0C;pte&amp;#xFF08;&amp;#x6216;&amp;#x8005;pmd&amp;#xFF09;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5C31;&amp;#x8BB2;&amp;#x6E05;&amp;#x695A;&amp;#x4E86;&amp;#xFF0C;&amp;#x90A3;&amp;#x6709;&amp;#x4E86;&amp;#x8FD9;&amp;#x9875;&amp;#x8868;&amp;#x683C;&amp;#x540E;&amp;#xFF0C;&amp;#x5C31;&amp;#x987A;&amp;#x5229;&amp;#x6210;&amp;#x7AE0;&amp;#x7684;&amp;#x8BE5;&amp;#x5F80;&amp;#x91CC;&amp;#x9762;&amp;#x586B;pte&amp;#x8868;&amp;#x9879;&amp;#x4E86;&amp;#x3002;&amp;#x9996;&amp;#x5148;&amp;#x7528;pte_offset_map / pte_offset_kernel&amp;#x627E;&amp;#x5230;&amp;#x8868;&amp;#x683C;&amp;#x4E2D;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x8868;&amp;#x9879;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x7528;&amp;#x51FD;&amp;#x6570;set_pte_at&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x505A;&amp;#x586B;&amp;#x5145;&amp;#x3002;set_pte_at&amp;#x6700;&amp;#x7EC8;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x6C47;&amp;#x7F16;&amp;#x51FD;&amp;#x6570;set_pte_ext&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x8003;&amp;#x8651;&amp;#x9AD8;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x8BDD;&amp;#xFF0C;pte_offset_map&amp;#x548C;pte_offset_kernel&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x90FD;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;=&amp;#xA0;pmd_page_vaddr(*(dir)) + __pte_index(addr)&lt;/div&gt;&lt;div&gt;&amp;#x524D;&amp;#x534A;&amp;#x90E8;&amp;#x5206;&amp;#x662F;pmd&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x540E;&amp;#x534A;&amp;#x90E8;&amp;#x5206;&amp;#x662F;&amp;#x672C;page&amp;#x5728;pmd&amp;#x4E2D;&amp;#x7684;&amp;#x504F;&amp;#x79FB;&amp;#x91CF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=========================&amp;#x5206;&amp;#x5272;&amp;#x7EBF;===================================&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8BF4;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E48;&amp;#x591A;&amp;#xFF0C;&amp;#x9875;&amp;#x8868;&amp;#x7684;&amp;#x5EFA;&amp;#x7ACB;&amp;#x5C31;&amp;#x662F;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E9B;&amp;#x4E8B;&amp;#x60C5;&amp;#x4E86;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x518D;&amp;#x4E3E;&amp;#x4E2A;&amp;#x5C0F;&amp;#x5C0F;&amp;#x7684;&amp;#x4F8B;&amp;#x5B50;&amp;#xFF0C;&amp;#x662F;mmap&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;remap_pfn_range&amp;#x3002;mmap&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x4E8B;&amp;#x60C5;&amp;#x662F;&amp;#x628A;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#xFF08;&amp;#x5305;&amp;#x62EC;&amp;#x8BBE;&amp;#x5907;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x8BBE;&amp;#x5907;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5219;&amp;#x8981;&amp;#x9A71;&amp;#x52A8;&amp;#x6765;&amp;#x652F;&amp;#x6301;&amp;#xFF09;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x4E00;&amp;#x6B3E;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x4E0A;&amp;#xFF0C;&amp;#x90A3;remap_pfn_range&amp;#x5C31;&amp;#x662F;&amp;#x8981;&amp;#x4E3A;&amp;#x4E00;&amp;#x6BB5;&amp;#x7269;&amp;#x7406;page&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x9879;&amp;#x3002;&amp;#x5148;&amp;#x770B;&amp;#x4ED6;&amp;#x4EEC;&amp;#x7684;&amp;#x539F;&amp;#x578B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;mmap (caddr_t addr, size_t len, int prot, int flags, int fd, off_t offset)&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;int remap_pfn_range(struct vm_area_struct *vma,&lt;/font&gt;&lt;/div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long virt_addr, unsigned long pfn,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long size, pgprot_t prot);&lt;/font&gt;&lt;/font&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;mmap&amp;#x662F;Linux&amp;#x7684;API&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x9488;&amp;#x5BF9;&amp;#x666E;&amp;#x901A;&amp;#x6587;&amp;#x4EF6;&amp;#x548C;&amp;#x8BBE;&amp;#x5907;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x6BD4;&amp;#x8F83;&amp;#x6709;&amp;#x666E;&amp;#x904D;&amp;#x6027;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x662F;&amp;#x9A71;&amp;#x52A8;&amp;#x4E2D;&amp;#x4E3A;&amp;#x4E86;&amp;#x5B9E;&amp;#x73B0;mmap&amp;#x7ECF;&amp;#x5E38;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;&amp;#x7684;remap_pfn_range&amp;#x51FD;&amp;#x6570;&amp;#x3002;&amp;#x7406;&amp;#x4E00;&amp;#x4E0B;&amp;#x4ED6;&amp;#x4EEC;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x5BF9;&amp;#x5E94;&amp;#x5173;&amp;#x7CFB;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;b&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;mmap&lt;/span&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&lt;/span&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;/b&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;b&gt;remap_pfn_range&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;addr&lt;/span&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;lt;=&amp;gt; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;vma,&amp;#xA0;&lt;/span&gt;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;fd&lt;/span&gt;&lt;font color=&#34;#2D4FC9&#34;&gt;,&lt;/font&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;offset,len&lt;/span&gt;&lt;/font&gt;&amp;#xA0; &amp;lt;=&amp;gt; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;pfn,&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;size&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8C03;&amp;#x7528;&amp;#x8FC7;&amp;#x7A0B;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1. &amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x8C03;&amp;#x7528;mmap&amp;#x6765;&amp;#x6620;&amp;#x5C04;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;fd&amp;#x4E2D;offset~offset+len&amp;#x8FD9;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2. &amp;#x5185;&amp;#x6838;&amp;#x6309;&amp;#x7167;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x6765;&amp;#xFF0C;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;vma_area_struct&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6240;&amp;#x6709;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x6620;&amp;#x5C04;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5305;&amp;#x62EC;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#xFF08;fd, offset,len&amp;#xFF09;&amp;#x548C;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF08;addr&amp;#xFF09;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;remap_pfn_range&amp;#x7684;&amp;#x53C2;&amp;#x6570;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;pfn&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;size&amp;#xFF0C;&amp;#x90FD;&amp;#x5728;vma&amp;#x4E2D;&amp;#x6709;&amp;#x6240;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x3002;&amp;#x81F3;&amp;#x4E8E;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x8981;&amp;#x8FD9;&amp;#x6837;&amp;#x505A;&amp;#xFF0C;&amp;#x6211;&amp;#x731C;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x63D0;&amp;#x4F9B;&amp;#x7075;&amp;#x6D3B;&amp;#x6027;&amp;#xFF0C;&amp;#x6BD5;&amp;#x7ADF;vma&amp;#x53EF;&amp;#x4EE5;&amp;#x8D85;&amp;#x8FC7;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x6620;&amp;#x5C04;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x5185;&amp;#x6838;&amp;#x5728;&amp;#x5206;&amp;#x914D;vma&amp;#x65F6;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;vma&amp;#x53EF;&amp;#x4EE5;&amp;#x5408;&amp;#x5E76;&amp;#xFF0C;&amp;#x5219;&amp;#x4F20;&amp;#x5165;&amp;#x7684;vma&amp;#x5C31;&amp;#x5927;&amp;#x4E8E;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x7528;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;pfn&amp;#xFF0C;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;size&amp;#x6765;&amp;#x8BF4;&amp;#x660E;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;remap_pfn_range&amp;#x6700;&amp;#x6838;&amp;#x5FC3;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr~&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;virt_addr+PAGE_ALIGN(size)&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#xFF0C;&amp;#x4EE3;&amp;#x7801;&amp;#x5982;&amp;#x4E0B;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;int remap_pfn_range(struct vm_area_struct *vma, unsigned long addr,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, unsigned long size, pgprot_t prot)&lt;br&gt;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;do {&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; next = pgd_addr_end(addr, end);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; err = remap_pud_range(mm, pgd, addr, next,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn + (addr &amp;gt;&amp;gt; PAGE_SHIFT), prot);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (err)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; break;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; } while (pgd++, addr = next, addr != end);&lt;/font&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;remap_pud_range -&amp;gt;&amp;#xA0;remap_pmd_range -&amp;gt;&amp;#xA0;remap_pte_range&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x524D;&amp;#x9762;&amp;#x4E24;&amp;#x4E2A;&amp;#x662F;&amp;#x865A;&amp;#x7684;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x4E2A;&amp;#x5C31;&amp;#x662F;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x4E86;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;static int remap_pte_range(struct mm_struct *mm, pmd_t *pmd,&lt;/font&gt;&lt;/div&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long addr, unsigned long end,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long pfn, pgprot_t prot)&lt;br&gt;&lt;/font&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font color=&#34;#2D4FC9&#34; face=&#34;Courier New&#34;&gt;{&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; pte = pte_alloc_map_lock(mm, pmd, addr, &amp;amp;ptl);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; do {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; set_pte_at(mm, addr, pte, pte_mkspecial(pfn_pte(pfn, prot)));&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pfn++;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; } while (pte++, addr += PAGE_SIZE, addr != end);&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;br&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;1. pmd&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x4E4B;&amp;#x524D;&amp;#x63D0;&amp;#x5230;&amp;#x7684;pgd&amp;#x8868;&amp;#x9879;&amp;#x6307;&amp;#x5411;&amp;#x7684;&amp;#x90A3;1&amp;#x4E2A;page&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;2. addr~end&amp;#x662F;&amp;#x8981;&amp;#x5EFA;&amp;#x7ACB;&amp;#x9875;&amp;#x8868;&amp;#x7684;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x8303;&amp;#x56F4;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;3. pfn&amp;#x662F;&amp;#x8FD9;&amp;#x5757;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#x8303;&amp;#x56F4;&amp;#x9996;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x5E27;&amp;#x53F7;&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;4. prot&amp;#x662F;&amp;#x4E00;&amp;#x4E9B;&amp;#x6807;&amp;#x5FD7;&amp;#x4F4D;&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/13/%E5%86%85%E5%AD%98%E9%A1%B5%E7%9A%84wait-wake%E6%9C%BA%E5%88%B6/</guid>
            <title>内存页的wait-wake机制</title>
            <link>https://blog.zhougy.top/2012/11/13/%E5%86%85%E5%AD%98%E9%A1%B5%E7%9A%84wait-wake%E6%9C%BA%E5%88%B6/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 13 Nov 2012 19:48:06 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&amp;#x5173;&amp;#x4E8E;&amp;#x5185;&amp;#x5B58;&amp;#x4E5F;&amp;#x5728;&amp;#x5206;&amp;#x914D;&amp;#x65F6;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x5524;&amp;#x9192;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;include/linux/mmzone.h 389&amp;#x884C;&amp;#x7684;&amp;#x6CE8;&amp;#x91CA;&amp;#x4E3A;&amp;#x6211;&amp;#x4EEC;&amp;#x6307;&amp;#x51FA;&amp;#x4E86;&amp;#x7528;&amp;#x6237;&amp;#x53EF;&amp;#x7528; &amp;#x7684;&amp;#x6700;&amp;#x57FA;&amp;#x672C;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x63A5;&amp;#x53E3;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;__wait_on_page_locked / &amp;#xA0;unlock_page&amp;#xFF0C;&amp;#x5B9A;&amp;#x4E49;&amp;#x5728;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;mm/filemap.c&amp;#x4E2D;&lt;/span&gt;&amp;#x3002;&amp;#x4F46;&amp;#x7ECF;&amp;#x8FC7;&amp;#x68C0;&amp;#x67E5;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x771F;&amp;#x6B63;&amp;#x80FD;&amp;#x63D0;&amp;#x4F9B;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x5176;&amp;#x5B9E;&amp;#x662F;wait_on_page_locked&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;__wait_on_page_locked&amp;#xA0;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&amp;#x5176;&amp;#x4F5C;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x5B9A;&amp;#x4E49;&amp;#x5728;&amp;#x5934;&amp;#x6587;&amp;#x4EF6;&amp;#x4E2D;&amp;#x7684;inline&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x88AB;&amp;#x5305;&amp;#x542B;&amp;#x6B64;&amp;#x5934;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;c&amp;#x6587;&amp;#x4EF6;&amp;#x8C03;&amp;#x7528;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;wait_on_page_bit&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;* __wait_on_page_locked() and unlock_page() in mm/filemap.c, are the&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;* primary users of these fields, and in mm/page_alloc.c&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;* free_area_init_core() performs the initialization of them.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;wait_on_page_bit&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x7684;wait-wake&amp;#x673A;&amp;#x5236;/1537085035448&#34; hash=&#34;fd66b201ad743e32ad690549b2114dfa&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x5F88;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x91CC;&amp;#x9762;&amp;#x6697;&amp;#x85CF;&amp;#x7384;&amp;#x673A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&lt;span style=&#34;font-size: 10pt; font-family: Arial; text-indent: 0mm;&#34;&gt;DEFINE_WAIT_BIT&amp;#x505A;&amp;#x4E86;&amp;#x5F88;&amp;#x591A;&amp;#x4E8B;&amp;#x60C5;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x5B83;&amp;#x662F;&amp;#x6807;&amp;#x51C6;&amp;#x7684;Linux&amp;#x7B49;&amp;#x5F85;&amp;#x673A;&amp;#x5236;&amp;#x4E2D;DEFINE_WAIT&amp;#x7684;&amp;#x53D8;&amp;#x79CD;&amp;#x3002;&amp;#x5176;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6807;&amp;#x51C6;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x961F;&amp;#x5217;&amp;#x7684;&amp;#x6210;&amp;#x5458;&amp;#x53D8;&amp;#x91CF;wait_queue_t&amp;#x3002;&amp;#x53E6;&amp;#x5916;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;bit&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;word&amp;#x548C;bit_nr&amp;#x6307;&amp;#x5B9A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;__wait_on_bit&amp;#x901A;&amp;#x8FC7;page_waitqueue&amp;#x6765;&amp;#x627E;&amp;#x5230;&amp;#x961F;&amp;#x5217;&amp;#x5934;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x5C31;&amp;#x7275;&amp;#x6D89;&amp;#x5230;&amp;#x54C8;&amp;#x5E0C;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&lt;a href=&#34;evernote:///view/161681/s10/60762aee-84ce-441b-b046-d79f9b9fc0da/60762aee-84ce-441b-b046-d79f9b9fc0da/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;linux&amp;#x5185;&amp;#x6838;&amp;#x54C8;&amp;#x5E0C;&amp;#x67E5;&amp;#x627E;&amp;#xFF08;1&amp;#xFF09;_zhe_wang-ChinaUnix&amp;#x535A;&amp;#x5BA2;&lt;/a&gt;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x7B80;&amp;#x8981;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E00;&amp;#x4E0B;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x5171;&amp;#x6709;&amp;#x8868;&amp;#x9879;size&amp;#x4E2A;&amp;#xFF0C;2^size &amp;gt;= pages / PAGES_PER_WAITQUEUE = pages/256&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x7528;&amp;#x6765;&amp;#x8BA1;&amp;#x7B97;&amp;#x54C8;&amp;#x5E0C;&amp;#x503C;&amp;#x7684;wait_table_bits&amp;#xFF0C;&amp;#x662F;size&amp;#x4E2D;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;1&amp;#x4F4D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x54C8;&amp;#x5E0C;&amp;#x503C;&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#xFF0C;&amp;#x8BE5;&amp;#x9875;&amp;#x7684;page&amp;#x7ED3;&amp;#x6784;&amp;#x6307;&amp;#x9488;&amp;#xFF08;&amp;#x5728;mem_map&amp;#x6570;&amp;#x7EC4;&amp;#x4E2D;&amp;#xFF09;&amp;#xFF0C;wait_table_bits&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x6240;&amp;#x8C13;&amp;#x7684;&amp;#x54C8;&amp;#x5E0C;&amp;#x8BA1;&amp;#x7B97;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x4E00;&amp;#x4E2A;&amp;#x5DE7;&amp;#x5999;&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&amp;#xFF0C;&amp;#x751F;&amp;#x6210;&amp;#x67D0;&amp;#x4E2A;&amp;#x533A;&amp;#x95F4;&amp;#x5185;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x503C;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6563;&amp;#x5217;&amp;#x5230;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x54C8;&amp;#x5E0C;&amp;#x51B2;&amp;#x7A81;&amp;#xFF0C;&amp;#x5219;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#x91C7;&amp;#x7528;&amp;#x94FE;&amp;#x8868;&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x8868;&amp;#x793A;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x54C8;&amp;#x5E0C;&amp;#x503C;&amp;#x53C8;&amp;#x53EB;&amp;#x6563;&amp;#x5217;&amp;#x503C;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x91CC;&amp;#x7684;&amp;#x54C8;&amp;#x5E0C;&amp;#x8BA1;&amp;#x7B97;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;(val * GOLDEN_RATIO_PRIME_32) &amp;#xA0;&amp;gt;&amp;gt;(32 - bits)&amp;#xFF0C;GOLDEN_RATIO_PRIME_32&amp;#x662F;&amp;#x4E2A;&amp;#x5F88;&amp;#x7279;&amp;#x522B;&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x7ECF;&amp;#x8FC7;&amp;#x7814;&amp;#x7A76;&amp;#xFF0C;&amp;#x56FA;&amp;#x5B9A;&amp;#x4E0B;&amp;#x6765;&amp;#x7684;&amp;#xFF0C;&amp;#x7528;&amp;#x5B83;&amp;#x4E58;&amp;#x8FC7;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x6EA2;&amp;#x51FA;&amp;#x540E;&amp;#x5269;&amp;#x4E0B;&amp;#x6765;&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x968F;&amp;#x673A;&amp;#x6027;&amp;#x6BD4;&amp;#x8F83;&amp;#x5927;&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;bits&amp;#x662F;size&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;1&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53F3;&amp;#x79FB;&amp;#x540E;&amp;#x7684;&amp;#x503C;&amp;#x4E00;&amp;#x5B9A;&amp;lt;size&amp;#xFF0C;&amp;#x6B63;&amp;#x597D;&amp;#x7B26;&amp;#x5408;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x8981;&amp;#x6C42;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3&amp;#xFF09;&amp;#x5728;__wait_on_bit&amp;#x4E2D;&amp;#x4F1A;&amp;#x4E0D;&amp;#x65AD;&amp;#x6D4B;&amp;#x8BD5;page-&amp;gt;flags&amp;#x7684;PageLocked&amp;#x4F4D;&amp;#xFF0C;&amp;#x5373;&amp;#x7B2C;0&amp;#x4F4D;&amp;#x3002;&amp;#x7136;&amp;#x540E;&amp;#x4F1A;&amp;#x5728;&amp;#x771F;&amp;#x6B63;&amp;#x8981;&amp;#x4F11;&amp;#x7720;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8C03;&amp;#x7528;&amp;#x4F20;&amp;#x5165;&amp;#x7684;sync_page&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E0D;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x4F46;&amp;#x7275;&amp;#x6D89;&amp;#x5F88;&amp;#x5E7F;&amp;#xFF0C;&amp;#x548C;address_space&amp;#x7ED3;&amp;#x6784;&amp;#x6709;&amp;#x5173;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;4&amp;#xFF09;&amp;#x5728;&amp;#x505A;&amp;#x5B8C;&amp;#x4E00;&amp;#x7CFB;&amp;#x5217;&amp;#x7684;sync&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x8C03;&amp;#x7528;io_schedule&amp;#xFF0C;&amp;#x8BA9;&amp;#x51FA;&amp;#x5904;&amp;#x7406;&amp;#x5668;&amp;#xFF0C;&amp;#x8FDB;&amp;#x884C;&amp;#x7B49;&amp;#x5F85;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;unlock_page&amp;#x4E00;&amp;#x6837;&amp;#x901A;&amp;#x8FC7;page&amp;#x7ED3;&amp;#x6784;&amp;#x6307;&amp;#x9488;&amp;#x548C;PageLocked&amp;#x4F4D;&amp;#xFF0C;&amp;#x627E;&amp;#x5230;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x961F;&amp;#x5217;&amp;#x3002;&amp;#x4F46;&amp;#x4E00;&amp;#x4E2A;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#x9879;&amp;#x53EF;&amp;#x4EE5;&amp;#x6709;256&amp;#x4E2A;page&amp;#x7B49;&amp;#x5728;&amp;#x5176;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x786E;&amp;#x5B9A;&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x5524;&amp;#x9192;&amp;#x60F3;&amp;#x8981;&amp;#x7684;&amp;#x90A3;&amp;#x4E2A;page&amp;#x7684;&amp;#x3002;&amp;#x53EF;&amp;#x80FD;&amp;#x548C;wait-&amp;gt;func=wake_bit_function&amp;#x6709;&amp;#x5173;&amp;#x3002;&amp;#x7275;&amp;#x626F;&amp;#x5230;wait queue&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;font color=&#34;#41AD1C&#34; face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/12/find_next_zero_bit/</guid>
            <title>find_next_zero_bit</title>
            <link>https://blog.zhougy.top/2012/11/12/find_next_zero_bit/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Mon, 12 Nov 2012 14:10:34 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;font face=&#34;Courier New&#34;&gt;unsigned long find_next_zero_bit(const unsigned long *addr,&amp;#xA0;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;unsigned long size,&lt;br&gt;&lt;/font&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;unsigned long offset)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x7528;&amp;#x610F;&amp;#x662F;&amp;#x5728;addr&amp;#x5F00;&amp;#x59CB;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x6BB5;&amp;#x4E2D;&amp;#xFF0C;&amp;#x627E;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E3A;0&amp;#x7684;&amp;#x4F4D;&amp;#xFF0C;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x6210;&amp;#x529F;&amp;#x5219;&amp;#x8FD4;&amp;#x56DE;&amp;#x8BE5;&amp;#x4F4D;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x627E;&amp;#x5230;&amp;#xFF0C;&amp;#x5219;&amp;#x8FD4;&amp;#x56DE;size&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#x641C;&amp;#x7D22;&amp;#x8303;&amp;#x56F4;&amp;#x5E76;&amp;#x4E0D;&amp;#x5305;&amp;#x542B;size&amp;#x8FD9;&amp;#x4E2A;&amp;#x70B9;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x5373;&amp;#x4FBF;size&amp;#x8FD9;&amp;#x4E2A;&amp;#x70B9;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x6EE1;&amp;#x8DB3;&amp;#x8981;&amp;#x6C42;&amp;#xFF0C;&amp;#x4F46;&amp;#x5176;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x548C;&amp;#x5931;&amp;#x8D25;&amp;#x65F6;&amp;#x7684;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x662F;&amp;#x76F8;&amp;#x540C;&amp;#x7684;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4E5F;&amp;#x770B;&amp;#x4F5C;&amp;#x662F;&amp;#x5931;&amp;#x8D25;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#x641C;&amp;#x7D22;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/find_next_zero_bit/1537085035761&#34; hash=&#34;eb1531c519cf2458b9144f798a8647b2&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/find_next_zero_bit/1537085035759&#34; hash=&#34;18c03589a58345add8371d7feb79093a&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x518D;&amp;#x5206;&amp;#x6790;&amp;#x4EE3;&amp;#x7801;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;unsigned long find_next_zero_bit(const unsigned long *addr, unsigned long size,&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long offset)&lt;br&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; const unsigned long *p = addr + BITOP_WORD(offset);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long result = offset &amp;amp; ~(BITS_PER_LONG-1); &lt;font color=&#34;#41AD1C&#34;&gt;// result&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#xFF0C;&amp;#x641C;&amp;#x7D22;&amp;#x8D77;&amp;#x59CB;&amp;#x70B9;&amp;#x6240;&amp;#x5728;ULONG&amp;#x4E4B;&amp;#x524D;&amp;#x6240;&amp;#x6709;&amp;#x7684;bit&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long tmp;&lt;br&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (offset &amp;gt;= size)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return size;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; size -= result; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x6263;&amp;#x6389;result&amp;#xFF0C;&amp;#x5373;size_new&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; offset %= BITS_PER_LONG; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x53D6;&amp;#x5F97;&amp;#x6240;&amp;#x5728;ULONG&amp;#x4E2D;&amp;#x7684;&amp;#x504F;&amp;#x79FB;&amp;#x91CF;&amp;#xFF0C;&amp;#x5373;offset_new&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (offset) {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp = *(p++);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp |= ~0UL &amp;gt;&amp;gt; (BITS_PER_LONG - offset); &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x5C06;offset&amp;#x4E4B;&amp;#x5185;&amp;#x7684;bit&amp;#x5168;&amp;#x90E8;&amp;#x7F6E;1&amp;#xFF0C;&amp;#x53C2;&amp;#x770B;&amp;#x56FE;1&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (size &amp;lt; BITS_PER_LONG) &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x8FD9;&amp;#x8868;&amp;#x793A;&amp;#x641C;&amp;#x7D22;&amp;#x8303;&amp;#x56F4;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;ULONG&amp;#x8303;&amp;#x56F4;&amp;#x4E4B;&amp;#x5185;&amp;#xFF0C;&amp;#x53C2;&amp;#x770B;&amp;#x56FE;2&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto found_first;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (~tmp) &lt;font color=&#34;#41AD1C&#34;&gt;// tmp&amp;#x81F3;&amp;#x5C11;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;0&amp;#x4F4D;&amp;#xFF0C;&amp;#x5373;tmp&amp;#x7684;&lt;/font&gt;&lt;/font&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;BPL - offset&amp;#x8FD9;&amp;#x4E00;&amp;#x6BB5;&amp;#x4E2D;&amp;#x81F3;&amp;#x5C11;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;0&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto found_middle;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size -= BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; result += BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; while (size &amp;amp; ~(BITS_PER_LONG-1)) { &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x4E0D;&amp;#x65AD;&amp;#x904D;&amp;#x5386;size&amp;#x524D;&amp;#x7684;ULONG&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (~(tmp = *(p++)))&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto found_middle;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; result += BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; size -= BITS_PER_LONG;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (!size) &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x5F53;size&amp;#x6B63;&amp;#x597D;&amp;#x662F;&amp;#x6574;&amp;#x6570;&amp;#x4E2A;ULONG&amp;#x65F6;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x627E;&amp;#x7740;&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x5C31;&amp;#x662F;&amp;#x539F;&amp;#x59CB;&amp;#x7684;size&amp;#xFF0C;&amp;#x82E5;&amp;#x4E0D;&amp;#x662F;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4F9D;&amp;#x6B21;&amp;#x8FDB;&lt;/font&gt;&lt;/font&gt;&lt;font color=&#34;#41AD1C&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;found_first&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;found_middle&lt;/span&gt;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return result;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp = *p;&lt;br&gt;&lt;br&gt;found_first:&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; tmp |= ~0UL &amp;lt;&amp;lt; size; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x5C06;size&amp;#x4EE5;&amp;#x4E0A;&amp;#x90E8;&amp;#x5206;&amp;#x5168;&amp;#x90E8;&amp;#x7F6E;1&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (tmp == ~0UL)&amp;#xA0;&amp;#xA0;&amp;#xA0; &lt;font color=&#34;#41AD1C&#34;&gt;//&amp;#xA0;&lt;/font&gt;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;offset~size&amp;#x6216;head~size&amp;#x4E4B;&amp;#x95F4;&amp;#x6CA1;&amp;#x6709;0&lt;/font&gt;&lt;/span&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return result + size;&amp;#xA0;&amp;#xA0; &lt;font color=&#34;#41AD1C&#34;&gt;// &amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x5373;&amp;#x4E3A;&amp;#x4F20;&amp;#x5165;&amp;#x7684;size&lt;/font&gt;&lt;br&gt;found_middle:&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; return result + ffz(tmp); &lt;font color=&#34;#41AD1C&#34;&gt;//&amp;#xA0;&lt;/font&gt;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;font color=&#34;#41AD1C&#34;&gt;ffz&amp;#x5C31;&amp;#x662F;&amp;#x5BFB;&amp;#x627E;unsigned long&amp;#x53D8;&amp;#x91CF;&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;0&amp;#x4F4D;&amp;#x7D22;&amp;#x5F15;&amp;#x7684;&amp;#x5B8F;&lt;/font&gt;&lt;/span&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;font face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/11/06/bootmem%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</guid>
            <title>bootmem工作原理</title>
            <link>https://blog.zhougy.top/2012/11/06/bootmem%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Tue, 06 Nov 2012 12:07:20 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style title lang xml:lang dir&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (test_bit(i, bdata-&amp;gt;node_bootmem_map)) {&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5982;&amp;#x679C;&amp;#x8FDE;&amp;#x7EED;&amp;#x7A7A;&amp;#x95F4;&amp;#x4E0D;&amp;#x8DB3;&amp;#xFF0C;&amp;#x5219;&amp;#x8FD4;&amp;#x56DE;&amp;#x91CD;&amp;#x65B0;&amp;#x641C;&amp;#x7D22;&amp;#x672A;&amp;#x5206;&amp;#x914D;&amp;#x533A;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, i, step);&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (sidx == i)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx += step;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto find_block;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (bdata-&amp;gt;last_end_off &amp;amp; (PAGE_SIZE - 1) &amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x4E0A;&amp;#x4E00;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x5728;&amp;#x9875;&amp;#x8FB9;&amp;#x754C;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; PFN_DOWN(bdata-&amp;gt;last_end_off) + 1 == sidx) &amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_off = align_off(bdata, bdata-&amp;gt;last_end_off, align);&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// align = 64&amp;#xFF0C;&amp;#x5C06;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;start_off&amp;#x63D0;&amp;#x5347;&amp;#x5230;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;last_end_off&amp;#x9644;&amp;#x8FD1;&amp;#xFF0C;&amp;#x8981;&amp;#x6309;align&amp;#x5411;&amp;#x4E0B;&amp;#x5BF9;&amp;#x9F50;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; else&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;1.&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;1)arm_bootmem_init&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960777&#34; hash=&#34;8978309953a6dd59d6856df76150bb5f&#34; align alt longdesc width=&#34;1032&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6709;&amp;#x4E00;&amp;#x70B9;&amp;#xFF0C;&amp;#x5148;&amp;#x7406;&amp;#x6E05;&amp;#x695A;&amp;#xFF0C;Linux&amp;#x652F;&amp;#x6301;NUMA&amp;#x67B6;&amp;#x6784;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x4F46;NUMA&amp;#x4E00;&amp;#x822C;&amp;#x5E94;&amp;#x7528;&amp;#x4E8E;&amp;#x4E2D;&amp;#x5927;&amp;#x578B;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x6765;&amp;#x7075;&amp;#x6D3B;&amp;#x5904;&amp;#x7406;&amp;#x672C;&amp;#x5730;&amp;#x5185;&amp;#x5B58;&amp;#x4E0E;&amp;#x8FDC;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x4EE5;&amp;#x63D0;&amp;#x9AD8;&amp;#x5E73;&amp;#x5747;&amp;#x5185;&amp;#x5B58;&amp;#x8BFB;&amp;#x5199;&amp;#x901F;&amp;#x5EA6;&amp;#xFF0C;&amp;#x5373;&amp;#x4F18;&amp;#x5148;&amp;#x4F7F;&amp;#x7528;&amp;#x672C;&amp;#x5730;&amp;#x5185;&amp;#x5B58;&amp;#x6216;&amp;#x8005;&amp;#x8BBF;&amp;#x95EE;&amp;#x901F;&amp;#x5EA6;&amp;#x8F83;&amp;#x5FEB;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&amp;#x4F46;&amp;#x5D4C;&amp;#x5165;&amp;#x5F0F;&amp;#x8BBE;&amp;#x5907;&amp;#x6216;&amp;#x8005;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;D7800&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x4F7F;&amp;#x7528;Linux&amp;#x7684;NUMA&amp;#x67B6;&amp;#x6784;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&amp;#x6362;&amp;#x53E5;&amp;#x8BDD;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x53EA;&amp;#x6709;node 0&amp;#xFF0C;&amp;#x5373;&amp;#x5176;&amp;#x4E0A;&amp;#x53EA;&amp;#x6709;&amp;#x672C;&amp;#x5730;&amp;#x5185;&amp;#x5B58;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E0A;&amp;#x56FE;&amp;#x4E2D;bdata_list&amp;#x5728;NUMA&amp;#x67B6;&amp;#x6784;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6240;&amp;#x6709;node&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x4F46;&amp;#x5728;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#xFF0C;&amp;#x8BE5;list&amp;#x4E0A;&amp;#x53EA;&amp;#x6709;node 0&amp;#x7684;&amp;#xFF1A;min~max_low&amp;#x4F4E;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x3002;&amp;#x518D;&amp;#x770B;memblock&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53C2;&amp;#x8003;&lt;a href=&#34;evernote:///view/161681/s10/84e5d565-822f-4ae2-adce-56fb6ced4c88/84e5d565-822f-4ae2-adce-56fb6ced4c88/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;memblock&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;&lt;/a&gt;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;memblock.memory&amp;#x8868;&amp;#x683C;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5305;&amp;#x542B;&amp;#x4E86;meminfo&amp;#x4E2D;&amp;#x6240;&amp;#x6709;bank&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x533A;&amp;#x95F4;&amp;#x3002;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x4E0A;&amp;#xFF0C;&amp;#x5C31;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x5DE6;&amp;#x534A;&amp;#x90E8;&amp;#x5206;&amp;#x7684;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF0C;bdata_list&amp;#x4E0A;node 0&amp;#x7684;min~max_low&amp;#x533A;&amp;#x6BB5;&amp;#x4E0A;&amp;#xFF0C;&amp;#x6709;&amp;#x7740;nrbanks&amp;#x4E2A;region_start~region_end&amp;#x5185;&amp;#x5B58;&amp;#x533A;&amp;#x95F4;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E8E;&amp;#x662F;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x5C31;&amp;#x5F88;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&amp;#x4E86;&amp;#x3002;&amp;#x5728;&amp;#x51FD;&amp;#x6570;mark_bootmem&amp;#x4E2D;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;bdata_list&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x5224;&amp;#x65AD;&amp;#x533A;&amp;#x6BB5;&amp;#x662F;&amp;#x5426;&amp;#x7B26;&amp;#x5408;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x5982;&amp;#x4E0B;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;if (pos &amp;lt; bdata-&amp;gt;node_min_pfn ||&amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; pos &amp;gt;= bdata-&amp;gt;node_low_pfn) {&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8868;&amp;#x793A;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E86;&amp;#x6B64;node&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x533A;&amp;#x6BB5;&amp;#xFF0C;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; BUG_ON(pos != start);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; continue;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;if (max == end)&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// end&amp;#x4F1A;&amp;#x4E0D;&amp;#x4F1A;&amp;#x8D85;&amp;#x8FC7;max_low&amp;#xFF0C;&amp;#x5373;end&amp;#x662F;&amp;#x9AD8;&amp;#x7AEF;&amp;#x5730;&amp;#x5740;&amp;#xFF1F;&amp;#x6211;&amp;#x7684;&amp;#x7406;&amp;#x89E3;&amp;#xFF0C;end&amp;#x53EF;&amp;#x4EE5;&amp;#x8D85;&amp;#x8FC7;low mem&amp;#x7684;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x5728;bootmem&amp;#x4E2D;&amp;#x6211;&amp;#x4EEC;&amp;#x53EA;&amp;#x8003;&amp;#x8651;low mem&amp;#x7684;&amp;#x90E8;&amp;#x5206;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; return 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201);&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;pos = bdata-&amp;gt;node_low_pfn;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8FD0;&amp;#x884C;&amp;#x5230;&amp;#x8FD9;&amp;#x91CC;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;start~end&amp;#x7684;region&amp;#x5DF2;&amp;#x7ECF;&amp;#x5904;&amp;#x7406;&amp;#x8FC7;&amp;#x4E86;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;max!=end&amp;#xFF0C;&amp;#x4E4B;&amp;#x540E;&amp;#x4F1A;&amp;#x7A7A;&amp;#x8DD1;&amp;#x5B8C;&amp;#x5269;&amp;#x4E0B;&amp;#x7684;&amp;#x5FAA;&amp;#x73AF;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960791&#34; hash=&#34;fd01a1a831a3b7caf3fc5ad38f42a341&#34; align alt longdesc width=&#34;1032&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x603B;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#x6240;&amp;#x8C13;&amp;#x7684;bootmem&amp;#xFF0C;&amp;#x5373;&amp;#x662F;&amp;#x4E3A;meminfo&amp;#x4E2D;&amp;#x6240;&amp;#x6709;nrbanks&amp;#x5185;&amp;#x5B58;&amp;#x7684;min~maxlow&amp;#xFF0C;&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x5F20;bitmap&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E00;&amp;#x4F4D;&amp;#x4EE3;&amp;#x8868;&amp;#x4E00;&amp;#x4E2A;page&amp;#x662F;&amp;#x5426;&amp;#x5206;&amp;#x914D;&amp;#x3002;&amp;#x4ED6;&amp;#x548C;memblock&amp;#x4E24;&amp;#x5957;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;bootmem&amp;#x7684;bitmap&amp;#x88AB;memblock&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;memblock&amp;#x53D8;&amp;#x91CF;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;memblock&amp;#x7684;&amp;#x4E24;&amp;#x5F20;&amp;#x8868;&amp;#x683C;memblock_memory_init_regions&amp;#x548C;memblock_reserved_init_regions&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5B58;&amp;#x5728;.init.data section&amp;#x4E2D;&amp;#xFF0C;&amp;#x5373;&amp;#x5728;kernel image&amp;#x91CC;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2)arm_bootmem_free&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960780&#34; hash=&#34;955e31194526ddb9bc3e379df1887a51&#34; align alt longdesc width=&#34;814&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#x5176;&amp;#x4E2D;&amp;#x672C;node&amp;#x5185;&amp;#x5B58;&amp;#x6307;&amp;#x6807;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960784&#34; hash=&#34;cc4b0f88b4f266a8c7c70bd14c7867ad&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;alloc_node_mem_map&amp;#x5728;&amp;#x540E;&amp;#x9762;&amp;#x7684;&amp;#x7AE0;&amp;#x8282;&amp;#x8BA8;&amp;#x8BBA;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#x8FD8;&amp;#x6709;&amp;#x4E00;&amp;#x70B9;&amp;#x9700;&amp;#x8981;&amp;#x8865;&amp;#x5145;&amp;#x4E00;&amp;#x4E0B;&amp;#xFF0C;pgdat&amp;#x4E00;&amp;#x822C;&amp;#x6307;&amp;#x5411;NODE_DATA(i)&amp;#xFF0C;&amp;#x5373;node_data[i]&amp;#x6210;&amp;#x5458;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x53EA;&amp;#x8003;&amp;#x8651;node 0&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;pgdat&amp;#x53EF;&amp;#x4EE5;&amp;#x7B80;&amp;#x5355;&amp;#x7684;&amp;#x770B;&amp;#x6210;&amp;#x662F;&amp;#x6307;&amp;#x5411;node 0&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x5728;init_bootmem_node&amp;#x4E2D;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5BF9;&amp;#x8BE5;node&amp;#x7684;bootmem&amp;#x90E8;&amp;#x5206;&amp;#x52A0;&amp;#x4EE5;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&amp;#x5176;&amp;#x4ED6;&amp;#x90E8;&amp;#x5206;&amp;#x5728;&amp;#x5176;&amp;#x4ED6;&amp;#x90E8;&amp;#x5206;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3)&lt;span style=&#34;font-size: 10pt; text-indent: 0mm;&#34;&gt;&lt;span style=&#34;font-size: 10pt; font-family: Arial;&#34;&gt;free_area_init_core&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960775&#34; hash=&#34;48dde7c38e2eabd99a09151cd51ce4ba&#34; align alt longdesc width=&#34;816&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a) &amp;#x6BCF;&amp;#x4E2A;zone&amp;#x7684;page&amp;#x6309;&amp;#x7167;page block&amp;#x7EC4;&amp;#x7EC7;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;page block&amp;#x5305;&amp;#x542B;MAX_ORDER-1 = 10&amp;#xFF0C;&amp;#x5373;1024&amp;#x9875;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b) &amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x51E0;&amp;#x4E2A;&amp;#x6307;&amp;#x6807;&amp;#x5907;&amp;#x6CE8;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;size: &amp;#x7B2C;j&amp;#x4E2A;zone&amp;#x7684;total_size&amp;#xFF0C;&amp;#x5355;&amp;#x4F4D;page&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;memmap_pages: &amp;#x672C;zone&amp;#x7684;memmap&amp;#x6570;&amp;#x7EC4;&amp;#x9700;&amp;#x8981;&amp;#x7684;page&amp;#x6570;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;realsize: totalsize - zhole_size[j] -&amp;#xA0;memmap_pages -&amp;#xA0;dma_reserve(&amp;#x5982;&amp;#x679C;&amp;#x662F;zone[0])&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nr_kernel_pages += realsize; &lt;span style=&#34;color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5982;&amp;#x679C;&amp;#x662F;HIGHMEM zone&amp;#xFF0C;&amp;#x66F4;&amp;#x65B0;nr_kernel_pages&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nr_all_pages += realsize;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;c)&amp;#xA0;init_currently_empty_zone,&amp;#xA0;memmap_init&amp;#x5728;&amp;#x540E;&amp;#x9762;&amp;#x7AE0;&amp;#x8282;&amp;#x8BA8;&amp;#x8BBA;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4)&amp;#xA0;memmap_init&lt;/div&gt;&lt;div&gt;memmap&amp;#x6570;&amp;#x7EC4;&amp;#x5728;arm_bootmem_free-&amp;gt;&lt;span style=&#34;font-size: 13px; font-family: Arial;&#34;&gt;free_area_init_node&amp;#x4E2D;&amp;#x901A;&amp;#x8FC7;alloc_node_mem_map-&amp;gt; alloc_bootmem_node&amp;#x6765;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x6BB5;bootmem&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x5E76;&amp;#x8D4B;&amp;#x7ED9;pgdat-&amp;gt;node_mem_map&amp;#x3002;memmap_init&amp;#x51FD;&amp;#x6570;&amp;#x8D1F;&amp;#x8D23;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FD9;&amp;#x5757;&amp;#x533A;&amp;#x57DF;&amp;#xFF08;&amp;#x6570;&amp;#x7EC4;&amp;#xFF09;&amp;#x4E2D;&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6210;&amp;#x5458;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960789&#34; hash=&#34;e61973da74d343ba813529c9abd473ca&#34; align alt longdesc width=&#34;596&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a)&amp;#x5173;&amp;#x4E8E;SetPageReserved&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E0D;&amp;#x77E5;&amp;#x4F55;&amp;#x7528;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;background-color: rgb(255, 255, 255); font-size: 14px; color: rgb(69, 69, 69); font-family: Tahoma, Helvetica, Arial, STHeiti; line-height: 21px;&#34;&gt;&amp;#x5185;&amp;#x6838;&amp;#x4E2D;&amp;#x7533;&amp;#x8BF7;&amp;#x5230;&amp;#x9875;&amp;#x9762;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x8981;&amp;#x8C03;&amp;#x7528;&amp;#x4E00;&amp;#x4E0B;SetPageReserved&amp;#xFF0C;&amp;#x76F8;&amp;#x5F53;&amp;#x4E8E;&amp;#x544A;&amp;#x8BC9;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x6211;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5360;&amp;#x4E86;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;&amp;#x7533;&amp;#x8BF7;&amp;#x5230;&amp;#x7684;&amp;#x9875;&amp;#x9762;&amp;#xFF0C;&amp;#x5E94;&amp;#x8BE5;&amp;#x90FD;&amp;#x8981;&amp;#x8FD9;&amp;#x6837;&amp;#x505A;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b)&amp;#x4E3A;&amp;#x6BCF;&amp;#x4E2A;&amp;#x9875;&amp;#x9762;&amp;#x8BBE;&amp;#x7F6E;miagrate type&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x9632;&amp;#x6B62;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x4E5F;&amp;#x7565;&amp;#x6709;&amp;#x4E9B;&amp;#x590D;&amp;#x6742;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;c)lru list&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x56DE;&amp;#x6536;&amp;#x673A;&amp;#x5236;&amp;#x8BBE;&amp;#x8BA1;&amp;#x7684;&amp;#xFF0C;&amp;#x5168;&amp;#x79F0;&amp;#x662F;Least Recently Used&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;d)&amp;#x5173;&amp;#x4E8E;struct page&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;Mel Gorman&amp;#x7684;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;&amp;#x7684;P41&amp;#xFF1A;Pages&amp;#x4E00;&amp;#x8282;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;5)&amp;#xA0;alloc_bootmem_node&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;alloc_bootmem_node -&amp;gt;&amp;#xA0;__alloc_bootmem_node -&amp;gt;&amp;#xA0;___alloc_bootmem_node -&amp;gt;&amp;#xA0;alloc_arch_preferred_bootmem / alloc_bootmem_core / ___alloc_bootmem&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6700;&amp;#x540E;&amp;#x843D;&amp;#x5B9E;&amp;#x5230;&amp;#x4E09;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;alloc_arch_preferred_bootmem / alloc_bootmem_core / ___alloc_bootmem&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;alloc_arch_preferred_bootmem&amp;#xA0;&amp;#x548C;___alloc_bootmem&amp;#x5728;&amp;#x672A;&amp;#x5B9A;&amp;#x4E49;CONFIG_NO_BOOTMEM&amp;#x65F6;&amp;#xFF0C;&amp;#x6700;&amp;#x7EC8;&amp;#x8C03;&amp;#x7528;&amp;#x7684;&amp;#x90FD;&amp;#x662F;alloc_bootmem_core&amp;#xA0;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;alloc_bootmem_core&amp;#xA0;&amp;#x662F;&amp;#x6838;&amp;#x5FC3;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x90A3;&amp;#x4E48;&amp;#x6765;&amp;#x770B;alloc_bootmem_core&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960786&#34; hash=&#34;ccb96de4575061c281c7fcd12baae0ff&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x5176;&amp;#x4E2D;&amp;#x6709;&amp;#x5F88;&amp;#x591A;&amp;#x4E2A;&amp;#x6307;&amp;#x6807;&amp;#xFF0C;&amp;#x5927;&amp;#x4F53;&amp;#x603B;&amp;#x7ED3;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;sidx / midx&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&amp;#xA0;start - bdata-&amp;gt;node_min_pfn /&amp;#xA0;max - bdata-&amp;gt;node_min_pfn&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x53D8;&amp;#x91CF;&amp;#x4E5F;&amp;#x4F1A;&amp;#x6709;&amp;#x4E00;&amp;#x4E9B;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4F46;&amp;#x5927;&amp;#x4F53;&amp;#x4E0A;&amp;#x53EF;&amp;#x4EE5;&amp;#x8BA4;&amp;#x4E3A;&amp;#x662F;&amp;#x672C;node&amp;#x4F4E;&amp;#x7AEF;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x9996;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x9875;&amp;#x7D22;&amp;#x5F15;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;eidx&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;: sidx + PFN_UP(size)&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x9700;&amp;#x8981;&amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F4;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x6309;&amp;#x9875;&amp;#x5411;&amp;#x4E0B;&amp;#xFF08;&amp;#x589E;&amp;#x957F;&amp;#x65B9;&amp;#x5411;&amp;#xFF09;&amp;#x5BF9;&amp;#x9F50;&amp;#x540E;&amp;#x7684;&amp;#x9875;&amp;#x7D22;&amp;#x5F15;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;start_off / end_off&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F4;&amp;#x59CB;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;merge&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&amp;#xA0;PFN_DOWN(start_off) &amp;lt; sidx&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x6B64;&amp;#x65F6;start_off&amp;#x662F;&amp;#x7ECF;&amp;#x8FC7;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x524D;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#xFF08;last_end_off&amp;#xFF09;&amp;#x6240;&amp;#x5728;&amp;#x9875;&amp;#x8FD8;&amp;#x6709;&amp;#x7A7A;&amp;#x95F2;&amp;#xFF0C;&amp;#x5219;&amp;#x5C06;start_off&amp;#x5411;&amp;#x4E0A;&amp;#x63D0;&amp;#x5347;&amp;#x5230;&amp;#x8BE5;&amp;#x9875;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0E;last_end_off&amp;#x9694;&amp;#x5F00;&amp;#x4E00;&amp;#x5B9A;&amp;#x7684;&amp;#x8DDD;&amp;#x79BB;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;bdata-&amp;gt;last_end_off&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E0A;&amp;#x4E00;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x672B;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x6309;&amp;#x9875;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&amp;#x6B64;&amp;#x53D8;&amp;#x91CF;&amp;#x53EA;&amp;#x5728;alloc_bootmem_core&amp;#x4E2D;&amp;#x66F4;&amp;#x65B0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(45, 79, 201); font-weight: bold;&#34;&gt;bdata-&amp;gt;hint_idx&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#x5728;alloc_bootmem_core&amp;#x4E2D;= PFN_UP(end_off)&amp;#xFF0C;&amp;#x5728;__free&amp;#x7684;&amp;#x65F6;&amp;#x5019;= sidx&amp;#xFF0C;&amp;#x8BB0;&amp;#x5F55;&amp;#x7684;&amp;#x662F;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x503C;&amp;#x7684;&amp;#x9875;&amp;#x7D22;&amp;#x5F15;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x4E86;&amp;#x89E3;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6307;&amp;#x6807;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5BF9;code&amp;#x5C31;&amp;#x6BD4;&amp;#x8F83;&amp;#x5BB9;&amp;#x6613;&amp;#x7406;&amp;#x89E3;&amp;#x4E86;&amp;#x3002;&amp;#x6458;&amp;#x5F55;&amp;#x5982;&amp;#x4E0B;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;static void * __init alloc_bootmem_core (&amp;#x2026;&amp;#x2026;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_block:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;sidx = find_next_zero_bit(bdata-&amp;gt;node_bootmem_map, midx, sidx);&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;//&amp;#xA0;find_next_zero_bit&amp;#x53C2;&amp;#x8003;&amp;#x53E6;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&lt;/span&gt;&lt;a href=&#34;evernote:///view/161681/s10/3437e87a-af8c-418e-8219-747687b4f1af/3437e87a-af8c-418e-8219-747687b4f1af/&#34; style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, sidx, step);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; eidx = sidx + PFN_UP(size);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (sidx &amp;gt;= midx || eidx &amp;gt; midx)&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// sidx &amp;gt; midx&amp;#x548C;eidx &amp;gt; midx&amp;#x6BD4;&amp;#x8F83;&amp;#x597D;&amp;#x7406;&amp;#x89E3;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; break; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;sidx = midx&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x6307;&amp;#x7684;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&amp;#x8FD4;&amp;#x56DE;&amp;#x7684;&amp;#x662F;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;midx&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&lt;/span&gt;&lt;a href=&#34;evernote:///view/161681/s10/3437e87a-af8c-418e-8219-747687b4f1af/3437e87a-af8c-418e-8219-747687b4f1af/&#34; style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&lt;/a&gt;&lt;span style=&#34;color: rgb(65, 173, 28);&#34;&gt;&amp;#x8FD9;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&amp;#x53EF;&amp;#x77E5;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x662F;&lt;/span&gt;&lt;a href=&#34;evernote:///view/161681/s10/3437e87a-af8c-418e-8219-747687b4f1af/3437e87a-af8c-418e-8219-747687b4f1af/&#34; style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_next_zero_bit&lt;/a&gt;&lt;span style=&#34;color: rgb(65, 173, 28);&#34;&gt;&amp;#x5931;&amp;#x8D25;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x672A;&amp;#x5206;&amp;#x914D;&amp;#x9875;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;for (i = sidx; i &amp;lt; eidx; i++)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start_off = PFN_PHYS(sidx);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;merge = PFN_DOWN(start_off) &amp;lt; sidx;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8868;&amp;#x793A;&amp;#x672C;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x4E0E;&amp;#x4E0A;&amp;#x6B21;&amp;#x5206;&amp;#x914D;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#xFF0C;&amp;#x53C2;&amp;#x770B;&amp;#x56FE;1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Reserve the area now:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (__reserve(bdata, PFN_DOWN(start_off) + merge,&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// merge =0: &amp;#x6CA1;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#xFF0C;&amp;#x6B63;&amp;#x5E38;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;merge =1&amp;#xFF1A;&amp;#x548C;&amp;#x4E0A;&amp;#x6B21;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#xFF0C;&amp;#x4F46;&amp;#x6709;&amp;#x4EA4;&amp;#x53E0;&amp;#x7684;&amp;#x9875;&amp;#x5DF2;&amp;#x7ECF;reserve&amp;#x8FC7;&amp;#x4E86;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4ECE;&amp;#x4E0B;&amp;#x4E00;&amp;#x9875;&amp;#x5F00;&amp;#x59CB;reserve&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; PFN_UP(end_off), BOOTMEM_EXCLUSIVE))&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;img class=&#34;enMedia&#34; src=&#34;/images/bootmem&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084960782&#34; hash=&#34;b9a9d387c218f326cac764cc823bb17c&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;alloc_bootmem_core&amp;#x4E2D;&amp;#x8FD8;&amp;#x6709;&amp;#x4E2A;fall_back&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;static void * __init alloc_bootmem_core (&amp;#x2026;&amp;#x2026;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x2026;&amp;#x2026;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;if (bdata-&amp;gt;hint_idx &amp;gt; sidx) { &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;//&amp;#xA0;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;hint_idx&amp;#x662F;&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x503C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6761;&amp;#x4EF6;&amp;#x8868;&amp;#x793A;&amp;#x641C;&amp;#x7D22;&amp;#x8D77;&amp;#x59CB;&amp;#x70B9;&amp;#x53EF;&amp;#x4EE5;&amp;#x5411;&amp;#x524D;&amp;#x63D0;&amp;#x5347;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * Handle the valid case of sidx being zero and still&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * catch the fallback below.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; fallback = sidx + 1;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x8BB0;&amp;#x5F55;fall_back&amp;#x503C;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, bdata-&amp;gt;hint_idx, step);&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5C06;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;sidx&amp;#x63D0;&amp;#x5347;&amp;#x5230;&lt;/span&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;hint_idx&amp;#x9644;&amp;#x8FD1;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;while(1) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;find_block:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#x2026;&amp;#x2026;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;if (fallback) {&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;// &amp;#x5982;&amp;#x679C;&amp;#x641C;&amp;#x7D22;&amp;#x5931;&amp;#x8D25;&amp;#xFF0C;&amp;#x5219;&amp;#x5C06;sidx&amp;#x8FD8;&amp;#x539F;&amp;#x518D;&amp;#x91CD;&amp;#x65B0;&amp;#x641C;&amp;#x7D22;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; sidx = align_idx(bdata, fallback - 1, step);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; fallback = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; goto find_block;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;return NULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;6) init_currently_empty_zone&lt;/div&gt;&lt;div&gt;&amp;#x672C;&amp;#x51FD;&amp;#x6570;&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x521D;&amp;#x59CB;&amp;#x5316;zone&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x66F4;&amp;#x660E;&amp;#x786E;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#xFF1A;&amp;#xFF08;1&amp;#xFF09;wait queue table&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF0C;&amp;#xFF08;2&amp;#xFF09;free_area&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&amp;#x8C03;&amp;#x7528;&amp;#x987A;&amp;#x5E8F;&amp;#x5982;&amp;#x4E0B;&lt;/div&gt;&lt;div&gt;zone_wait_table_init -&amp;gt;&amp;#xA0;zone_init_free_lists(zone)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;a)&amp;#xA0;zone_wait_table_init&amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x6B64;&amp;#x51FD;&amp;#x6570;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E86;zone-&amp;gt;wait_table&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x5F20;&amp;#x54C8;&amp;#x5E0C;&amp;#x8868;&amp;#xFF0C;&amp;#x6709;zone-&amp;gt;wait_table_hash_nr_entries&amp;#x4E2A;&amp;#x8868;&amp;#x9879;&amp;#xFF08;&amp;#x6700;&amp;#x5C11;4&amp;#xFF0C;&amp;#x6700;&amp;#x591A;4096&amp;#xFF09;&amp;#x3002;wait_table&amp;#x76F8;&amp;#x5173;&amp;#x5185;&amp;#x5BB9;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;Mel Gorman&amp;#x7684;&amp;#x300A;Understanding the Linux&amp;#xAE;&amp;#xA0;Virtual Memory Manager&amp;#x300B;P40&amp;#xFF1A;Zone Wait Queue Table&amp;#x4E00;&amp;#x8282;&amp;#x3002;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x7684;wait-wake&amp;#x673A;&amp;#x5236;&amp;#x8BF7;&amp;#x53C2;&amp;#x8003;&amp;#x7B14;&amp;#x8BB0;&lt;a href=&#34;evernote:///view/161681/s10/00adfa18-d628-4d70-a080-7c1590a5e613/00adfa18-d628-4d70-a080-7c1590a5e613/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x7684;wait-wake&amp;#x673A;&amp;#x5236;&lt;/a&gt;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x672C;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E3A;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;wait_table_hash_nr_entries(zone_size_pages) -&amp;gt;&amp;#xA0;wait_table_bits(zone-&amp;gt;wait_table_hash_nr_entries) -&amp;gt;&amp;#xA0;alloc_bootmem_node(pgdat, alloc_size) -&amp;gt; &amp;#x904D;&amp;#x5386;&amp;#x6240;&amp;#x6709;&amp;#x54C8;&amp;#x5E0C;&amp;#x9879;&amp;#xFF0C;&amp;#x5E76;&amp;#x521D;&amp;#x59CB;&amp;#x5316;init_waitqueue_head(zone-&amp;gt;wait_table + i)&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;b&amp;#xFF09;zone_init_free_lists&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x7275;&amp;#x6D89;&amp;#x5230;migrate type&amp;#xFF0C;&amp;#x5C1A;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4F1A;&amp;#x7528;&amp;#x65B0;&amp;#x7BC7;&amp;#x6765;&amp;#x4F5C;&amp;#x4ECB;&amp;#x7ECD;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/10/08/memblock%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</guid>
            <title>memblock工作原理</title>
            <link>https://blog.zhougy.top/2012/10/08/memblock%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Mon, 08 Oct 2012 18:35:54 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style title lang xml:lang dir&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;memblock&amp;#x662F;Linux&amp;#x542F;&amp;#x52A8;&amp;#x9636;&amp;#x6BB5;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x662F;&amp;#x5BF9;bootmem&amp;#x7684;&amp;#x8865;&amp;#x5145;&amp;#xFF0C;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x5E94;&amp;#x5BF9;bootmem&amp;#x6613;&amp;#x4EA7;&amp;#x751F;&amp;#x5916;&amp;#x90E8;&amp;#x788E;&amp;#x7247;&amp;#x800C;&amp;#x4EA7;&amp;#x751F;&amp;#x3002;&amp;#x4ED6;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x51FD;&amp;#x6570;arm_memblock_init&amp;#x548C;bootmem&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x6240;&amp;#x5728;&amp;#x7684;&amp;#x51FD;&amp;#x6570;paging_init&amp;#x7D27;&amp;#x6328;&amp;#x7740;&amp;#xFF0C;&amp;#x90FD;&amp;#x5728;setup_arch&amp;#x4E2D;&amp;#x3002;&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;margin: 0px 0px 0px 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34;&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;struct memblock {&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; phys_addr_t current_limit;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; phys_addr_t memory_size;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt; &lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/* Updated by memblock_analyze() */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct memblock_type memory;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; struct memblock_type reserved;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;current_limit&amp;#xFF1A;&amp;#x8868;&amp;#x793A;memblock&amp;#x53EF;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#x503C;&amp;#xFF0C;&amp;#x5176;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E3A;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;paging_init -&amp;gt; sanity_check_meminfo -&amp;gt; memblock_set current_limit(limit)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x5176;&amp;#x4E2D;limit = __pa(vmalloc_min-1) + 1 = VMALLOC_END - 128M = 4G - 128M(high mem)&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;memory_size&amp;#xFF1A;&amp;#x8BB0;&amp;#x5F55;&amp;#x603B;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x6570;&amp;#x91CF;&amp;#xFF0C;&amp;#x5728;memory_analyze&amp;#x4E2D;&amp;#x66F4;&amp;#x65B0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;memory,reserved&amp;#xFF1A;&amp;#x662F;&amp;#x4E24;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x524D;&amp;#x8005;&amp;#x662F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6240;&amp;#x62E5;&amp;#x6709;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&amp;#xFF0C;&amp;#x540E;&amp;#x8005;&amp;#x53EF;&amp;#x4EE5;&amp;#x7406;&amp;#x89E3;&amp;#x4E3A;&amp;#x5DF2;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5757;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;1. &amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/memblock&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084959865&#34; hash=&#34;7ab6740575d50f5739c1e48b2d63b4cb&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;mdesc-&amp;gt;reserve&amp;#x662F;&amp;#x5728;arch/arm/mach-omap2/board-d7800.c&amp;#x4E2D;&amp;#x5206;&amp;#x914D;&amp;#x7ED9;machine_desc&amp;#x53D8;&amp;#x91CF;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;meminfo&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x7BC7;&amp;#x7B14;&amp;#x8BB0;&lt;a href=&#34;evernote:///view/161681/s10/638c401b-6ae0-4f04-85a6-a35529f7768b/638c401b-6ae0-4f04-85a6-a35529f7768b/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;meminfo&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&amp;#x5185;&amp;#x5B58;&amp;#x5206;&amp;#x914D;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/memblock&amp;#x5DE5;&amp;#x4F5C;&amp;#x539F;&amp;#x7406;/1537084959870&#34; hash=&#34;89a57c932790964dce9ee3e7e6f8d052&#34; align alt longdesc width=&#34;1142&#34; height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;MEMBLOCK_ALLOC_ACCESSIBLE&amp;#x7684;&amp;#x503C;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x5219;&amp;#x540E;&amp;#x9762;&amp;#x7684;max_addr&amp;#x4E5F;&amp;#x4E3A;0&amp;#xFF0C;&amp;#x4F46;&amp;#x5E76;&amp;#x4E0D;&amp;#x610F;&amp;#x5473;&amp;#x7740;&amp;#x641C;&amp;#x7D22;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#x4E5F;&amp;#x4E3A;0&amp;#x3002;&amp;#x5728;memblock_find_base&amp;#x4E2D;end&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x641C;&amp;#x7D22;&amp;#x7684;&amp;#x4E0A;&amp;#x9650;&amp;#xFF08;&amp;#x5176;&amp;#x5B9E;&amp;#x662F;&amp;#x641C;&amp;#x7D22;&amp;#x7684;&amp;#x8D77;&amp;#x59CB;&amp;#x503C;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x641C;&amp;#x7D22;&amp;#x65F6;&amp;#x4ECE;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x6700;&amp;#x9AD8;&amp;#x503C;&amp;#x5F00;&amp;#x59CB;&amp;#x7684;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E48;&amp;#x505A;&amp;#x662F;&amp;#x6709;&amp;#x7528;&amp;#x610F;&amp;#x7684;&amp;#xFF0C;&amp;#x8BE6;&amp;#x89C1;&amp;#x7B2C;2&amp;#x70B9;&amp;#xFF09;&amp;#x8D4B;&amp;#x4E3A;memblock.current_limit&amp;#xFF0C;&amp;#x5B83;&amp;#x7684;&amp;#x503C;&amp;#x53EF;&amp;#x4EE5;&amp;#x53C2;&amp;#x8003;&amp;#x672C;&amp;#x6587;&amp;#x524D;&amp;#x9762;&amp;#x7684;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;&amp;#x4ECE;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x9AD8;&amp;#x5730;&amp;#x5740;&amp;#x5F00;&amp;#x59CB;&amp;#x641C;&amp;#x7D22;&amp;#xFF0C;mm/memblock.c&amp;#x4E2D;&amp;#x7684;&amp;#x6709;&amp;#x6CE8;&amp;#x91CA;&amp;#x9053;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/* We do a top-down search, this tends to limit memory&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;margin: 0px 0px 0px 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * fragmentation by keeping early boot allocs near the&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * top of memory&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#34;margin-left: 40px;&#34;&gt;&amp;#x770B;&amp;#x8D77;&amp;#x6765;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x89E3;&amp;#x51B3;&amp;#x788E;&amp;#x7247;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x4F46;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x80FD;&amp;#x89E3;&amp;#x51B3;&amp;#xFF0C;&amp;#x4E0D;&amp;#x6E05;&amp;#x695A;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3&amp;#xFF09;&amp;#x4EE3;&amp;#x7801;&amp;#x4E2D;&amp;#x7684;&amp;#x8DDF;&amp;#x5185;&amp;#x5B58;&amp;#x533A;&amp;#x7684;&amp;#x59CB;&amp;#x672B;&amp;#x4F4D;&amp;#x7F6E;&amp;#x6709;&amp;#x5173;&amp;#x7684;&amp;#x503C;&amp;#x90FD;&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&amp;#x7528;&amp;#x5230;&amp;#x5982;&amp;#x4E0B;&amp;#x7684;&amp;#x8BED;&amp;#x53E5;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0;size = memblock_align_up(size, align)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(45, 79, 201); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;base = memblock_align_down((end - size), align)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x8FD9;&amp;#x4E9B;&amp;#x4E5F;&amp;#x90FD;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x89E3;&amp;#x51B3;&amp;#x788E;&amp;#x7247;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;mm/memblock.c &amp;#x4E2D;&amp;#x6709;&amp;#x6CE8;&amp;#x91CA;&amp;#xFF0C;&amp;#x9053;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;quot;Courier New&amp;quot;; color: rgb(65, 173, 28);&#34;&gt;/* We align the size to limit fragmentation. Without this, a lot of&lt;/span&gt;&lt;/div&gt;&lt;div style=&#34;margin: 0px 0px 0px 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * small allocs quickly eat up the whole reserve array on sparc&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;quot;Courier New&amp;quot;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;4&amp;#xFF09;memblock_addrs_overlap&amp;#x4E2D;&amp;#x5224;&amp;#x65AD;&amp;#x4EA4;&amp;#x53E0;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#x5F88;&amp;#x503C;&amp;#x5F97;&amp;#x5B66;&amp;#x4E60;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/09/29/meminfo%E5%88%9D%E5%A7%8B%E5%8C%96/</guid>
            <title>meminfo初始化</title>
            <link>https://blog.zhougy.top/2012/09/29/meminfo%E5%88%9D%E5%A7%8B%E5%8C%96/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <category>uboot</category>
            <pubDate>Sat, 29 Sep 2012 10:46:46 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;1. u-boot&amp;#x4E2D;&amp;#x8BBE;&amp;#x7F6E;&amp;#x542F;&amp;#x52A8;&amp;#x53C2;&amp;#x6570;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x542F;&amp;#x52A8;&amp;#x547D;&amp;#x4EE4;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;u-boot-env.txt&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;bootcmd&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if ${recovery}; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run nandrecovery;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if mmc init; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if run loadbootscript; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run bootscript;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;if run loaduImage; then&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run mmcboot;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;run nandboot;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;fi;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;fi;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;else&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;b&gt;&lt;font color=&#34;#FF0000&#34;&gt;run nandboot;&lt;/font&gt;&lt;/b&gt;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; fi;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;fi&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;nandboot&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;echo Booting from nand ...;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font color=&#34;#FF0000&#34;&gt;run nandargs;&lt;/font&gt;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;nand read ${loadaddr} boot;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;booti 0x82000008&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;nandargs&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;setenv bootargs console=${console} init=${init} &lt;font color=&#34;#FF0000&#34;&gt;mem=${mem}&lt;/font&gt; ip=${ip} mpurate=${mpurate} omap_vout.vid1_static_vrfb_alloc=y vram=${vram} omapfb.vram=0:8M androidboot.console=${tty} root=${root_nand} rootfstype=${rootfstype_nand} ubi.mtd=${ubi_mtd}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x8FD9;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x5C5E;&amp;#x4E8E;commandline&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;setup_commandline_tag&amp;#x4E2D;&amp;#x63D2;&amp;#x5165;params&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x5E76;&amp;#x6807;&amp;#x4E0A;ATAG_CMDLINE&amp;#xFF0C;&amp;#x4F1A;&amp;#x5728;parse_args&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x7528;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;&amp;#x73AF;&amp;#x5883;&amp;#x53D8;&amp;#x91CF;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;include/configs/d7800.h&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;#define CONFIG_EXTRA_ENV_SETTINGS \&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;quot;init=/init\0&amp;quot; \&lt;br&gt;&amp;#xA0; &amp;#xA0; &lt;font color=&#34;#FF0000&#34;&gt;&amp;quot;mem=256M\0&amp;quot;&lt;/font&gt; \&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;quot;mpurate=800\0&amp;quot; \&lt;br&gt;&amp;#xA0; &amp;#xA0;&amp;#x2026;&amp;#x2026;&lt;/font&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;2.&lt;font face=&#34;Courier New&#34;&gt;kernel&amp;#x4E2D;&amp;#x7528;parse_args&amp;#x89E3;&amp;#x6790;&amp;#x6B64;bootarg&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53EF;&amp;#x53C2;&amp;#x8003;&amp;#x53E6;&amp;#x4E00;&amp;#x4EFD;&amp;#x7B14;&amp;#x8BB0;&lt;/font&gt;&lt;a href=&#34;evernote:///view/161681/s10/39d4ca69-e5d9-4582-9635-d9963aa05e29/39d4ca69-e5d9-4582-9635-d9963aa05e29/&#34; style=&#34;color: rgb(105, 170, 53);&#34;&gt;Linux&amp;#x542F;&amp;#x52A8;&amp;#x53C2;&amp;#x6570;&amp;#x201C;init=xxx&amp;#x201D;&amp;#x5206;&amp;#x6790;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;parse_args -&amp;gt;&amp;#xA0;parse_one -&amp;gt;&amp;#xA0;unknown_bootoption -&amp;gt;&amp;#xA0;obsolete_checksetup -&amp;gt;&amp;#xA0;obs_kernel_param.setup_func =&amp;#xA0;early_mem&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;3.kernel&amp;#x4E2D;&amp;#x8BBE;&amp;#x7F6E;&amp;#x5BF9;&amp;#x5E94;bootarg&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;early_param(&amp;quot;mem&amp;quot;, early_mem); -&amp;gt;&amp;#xA0;__setup_param(str, fn, fn, 1) -&amp;gt;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;#define __setup_param(str, unique_id, fn, early)&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; \&lt;/font&gt;&lt;/div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;static const char __setup_str_##unique_id[] __initconst \&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __aligned(1) = str; \&lt;br&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;static struct obs_kernel_param __setup_##unique_id&amp;#xA0; \&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __used __section(&lt;font color=&#34;#FF0000&#34;&gt;.init.setup&lt;/font&gt;)&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; \&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; __attribute__((aligned((sizeof(long)))))&amp;#xA0;&amp;#xA0;&amp;#xA0; \&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; = { __setup_str_##unique_id, fn, early } &amp;#xA0;&amp;#xA0;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;4.&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;early_mem&amp;#x51FD;&amp;#x6570;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;static int __init early_mem(char *p)&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;{&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; static int usermem __initdata = 0;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; unsigned long size, start;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; char *endp;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; &lt;font color=&#34;#41AD1C&#34;&gt;/*&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * If the user specifies memory size, we&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * blow away any automatically generated&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; * size.&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/font&gt;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (usermem == 0) {&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; usermem = 1;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; meminfo.nr_banks = 0;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;/*&lt;/span&gt;&lt;div&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;/span&gt; &lt;font color=&#34;#41AD1C&#34;&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;*&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;defined in&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;arch/arm/plat-omap/include/plat/memory.h&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; *&amp;#xA0;&lt;/span&gt;PHYS_OFFSET &amp;#xA0;= UL(0x80000000)&lt;/font&gt;&lt;br style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&lt;span style=&#34;color: rgb(65, 173, 28); font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; */&lt;/span&gt;&lt;/div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; start = PHYS_OFFSET;&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; size&amp;#xA0; = memparse(p, &amp;amp;endp);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; if (*endp == &amp;apos;@&amp;apos;)&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; start = memparse(endp + 1, NULL);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; arm_add_memory(start, size);&lt;br&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; return 0;&lt;br&gt;}&lt;/font&gt;&lt;/blockquote&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6700;&amp;#x540E;&amp;#x9057;&amp;#x7559;&amp;#x4E00;&amp;#x4E2A;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x5047;&amp;#x5982;&amp;#x6709;&amp;#x51E0;&amp;#x5757;&amp;#x5185;&amp;#x5B58;&amp;#x9700;&amp;#x8981;&amp;#x5904;&amp;#x7406;&amp;#x600E;&amp;#x4E48;&amp;#x529E;&amp;#xFF1F;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;font face=&#34;Courier New&#34;&gt;&amp;#x6CA1;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;Linux&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x3002;&amp;#x5C31;&amp;#x662F;&lt;/font&gt;__tagtable(ATAG_MEM, parse_tag_mem32);&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x5F20;&amp;#x8868;&amp;#x683C;&amp;#xFF0C;&amp;#x4EE3;&amp;#x8868;&amp;#x4E86;&amp;#x4E00;&amp;#x7EC4;ATAG_MEM param&amp;#xFF0C;&amp;#x7528;parse_tag_mem32&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x8FD9;&amp;#x4E00;&amp;#x7EC4;param&amp;#x540C;&amp;#x6837;&amp;#x4E5F;&amp;#x662F;&amp;#x5728;u-boot&amp;#x9636;&amp;#x6BB5;&amp;#x5C31;&amp;#x52A0;&amp;#x5165;&amp;#x4E86;&amp;#x3002;&amp;#x5373;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;do_bootm_linux -&amp;gt;&amp;#xA0;setup_memory_tags (u-boot)&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;static void setup_memory_tags (bd_t *bd)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; int i;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; for (i = 0; i &amp;lt; CONFIG_NR_DRAM_BANKS; i++) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;hdr.tag = ATAG_MEM;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;hdr.size = tag_size (tag_mem32);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;u.mem.start = bd-&amp;gt;bi_dram[i].start;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params-&amp;gt;u.mem.size = bd-&amp;gt;bi_dram[i].size;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; params = tag_next (params);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#x53EA;&amp;#x4E0D;&amp;#x8FC7;&amp;#x5728;D7800&amp;#x4E2D;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;CONFIG_NR_DRAM_BANKS=1&amp;#xFF08;configs/d7800.h&amp;#xFF09;&amp;#x3002;&lt;/span&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;meminfo&amp;#x4E2D;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x5730;&amp;#x5740;&amp;#x5168;&amp;#x90E8;&amp;#x662F;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5730;&amp;#x5740;&amp;#x3002;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;blockquote style=&#34;margin: 0 0 0 40px; border: none; padding: 0px;&#34;&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/09/12/USB%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/</guid>
            <title>USB驱动程序</title>
            <link>https://blog.zhougy.top/2012/09/12/USB%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/</link>
            <category>Linux</category>
            <category>USB</category>
            <category>Linux Device Drivers</category>
            <pubDate>Wed, 12 Sep 2012 14:23:07 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;div&gt;1. device&amp;#xFF0C;configuration&amp;#xFF0C;interface&amp;#xFF0C;endpoint&lt;/div&gt;&lt;div&gt;&amp;#x6211;&amp;#x7684;&amp;#x7406;&amp;#x89E3;&amp;#xFF1A;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;1&amp;#xFF09;&amp;#x9996;&amp;#x5148;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;device&amp;#x5305;&amp;#x542B;&amp;#x591A;&amp;#x4E2A;configuration&amp;#xFF0C;&lt;/div&gt;&lt;div&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#x4E00;&amp;#x4E2A;configuration&amp;#x5305;&amp;#x542B;&amp;#x591A;&amp;#x4E2A;interface&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#x4E00;&amp;#x4E2A;interface&amp;#x4F7F;&amp;#x7528;&amp;#x591A;&amp;#x4E2A;endpoint&amp;#x6765;&amp;#x5B8C;&amp;#x6210;&amp;#x529F;&amp;#x80FD;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;2&amp;#xFF09;&amp;#x5176;&amp;#x6B21;&amp;#xFF0C;interface&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;USB device&amp;#x7684;&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x7406;&amp;#x89E3;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x72EC;&amp;#x7ACB;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&amp;#x4E00;&amp;#x4E2A;configuration&amp;#x5C31;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x591A;&amp;#x4E2A;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5B83;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x5C31;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E86;&amp;#x67D0;&amp;#x4E00;&amp;#x4E2A;&amp;#x65F6;&amp;#x523B;&amp;#x7684;USB device&amp;#x3002;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x4E00;&amp;#x4E2A;USB device&amp;#x5728;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x65F6;&amp;#x523B;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x6709;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x7528;&amp;#x9014;&amp;#xFF0C;&amp;#x800C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7528;&amp;#x9014;&amp;#x7531;&amp;#x591A;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#x6765;&amp;#x8FBE;&amp;#x6210;&amp;#x3002;&amp;#x4E3E;&amp;#x4F8B;&amp;#x6765;&amp;#x8BF4;&amp;#xFF1A;&amp;#x4E00;&amp;#x4E9B;USB&amp;#x8BBE;&amp;#x5907;&amp;#x9700;&amp;#x8981;&amp;#x4E0B;&amp;#x8F7D;&amp;#x56FA;&amp;#x4EF6;&amp;#x5230;&amp;#x5176;&amp;#x4E0A;&amp;#xFF0C;&amp;#x5219;&amp;#x8FD9;&amp;#x4E9B;&amp;#x8BBE;&amp;#x5907;&amp;#x5728;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x626E;&amp;#x6F14;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x89D2;&amp;#x8272;&amp;#xFF08;&amp;#x5B58;&amp;#x50A8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x65E0;&amp;#x7EBF;&amp;#x7F51;&amp;#x5361;&amp;#x7B49;&amp;#x7B49;&amp;#xFF09;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;usb_interface --&amp;#xA0;usb_host_interface (altsetting) --&amp;#xA0;usb_interface_descriptor --&amp;#xA0;bAlternateSetting:&lt;font color=&#34;#3665EE&#34;&gt;altsetting&amp;#x7F16;&amp;#x53F7;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;| &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;|- &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;+ bInterfaceNumber&amp;#xFF1A;&lt;font color=&#34;#3665EE&#34;&gt;interface&amp;#x7F16;&amp;#x53F7;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;| &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;|- extra: &lt;font color=&#34;#3665EE&#34;&gt;following usb_host_interface_descriptor in this interface (hence usb_interface)&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;| &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;|- usb_host_endpoint: &lt;font color=&#34;#3665EE&#34;&gt;&amp;#x6B64;&amp;#x914D;&amp;#x7F6E;&amp;#x4E0B;&amp;#x7684;endpoint&amp;#x6570;&amp;#x7EC4;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6BCF;&amp;#x4E2A;ep&amp;#x7684;desc&amp;#x548C;urb_list&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&#34;Courier New&#34;&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;|-&amp;#xA0;&lt;/font&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;usb_host_interface&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;&amp;#xA0;&lt;/span&gt;&lt;span style=&#34;font-family: &amp;apos;Courier New&amp;apos;;&#34;&gt;(altsetting[1])&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;3&amp;#xFF09;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;interface&amp;#x53EF;&amp;#x4EE5;&amp;#x5305;&amp;#x542B;&amp;#x591A;&amp;#x79CD;&amp;#x914D;&amp;#x7F6E;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;&amp;#x914D;&amp;#x7F6E;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;altsetting&amp;#xFF0C;&amp;#x7C7B;&amp;#x578B;&amp;#x662F;usb_host_interface&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;altsetting&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;descriptor&amp;#xFF08;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E86;&amp;#x5F53;&amp;#x524D;interface&amp;#x548C;&amp;#x5F53;&amp;#x524D;interface&amp;#x7684;altsetting&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#xFF09;&amp;#xFF0C;&amp;#x548C;&amp;#x4E00;&amp;#x7EC4;endpoint&amp;#xFF08;&amp;#x5305;&amp;#x542B;&amp;#x4E86;endpoint&amp;#x7684;descriptor&amp;#x548C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;urb_list&amp;#xFF09;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;Alternate settings allow a portion of the device configuration to be varied while other interfaces remain in&amp;#xA0;operation. &amp;#xA0;-- USB 2.0 spec.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0; &amp;#xA0;&amp;#xA0;The default setting for an interface is always alternate setting zero.The SetInterface() request is used to select an alternate setting or to return to the default setting. &amp;#xA0;&amp;#xA0;-- USB 2.0 spec.&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; &amp;#xA0;4&amp;#xFF09;&amp;#x6CE8;&amp;#x610F;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;DescriptorType&amp;#x503C;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6709;&amp;#x4E0D;&amp;#x540C;descriptor&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;2. USB&amp;#x8BBE;&amp;#x5907;&amp;#x95F4;&amp;#x7684;&amp;#x901A;&amp;#x8BAF;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x5355;&amp;#x4F4D;&amp;#x4E3A;endpoint&amp;#xFF0C;&amp;#x6709;4&amp;#x79CD;ep&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;4&amp;#x4E2D;USB&amp;#x4F20;&amp;#x8F93;&amp;#x7C7B;&amp;#x578B;&amp;#xFF1A;control&amp;#xFF0C;bulk&amp;#xFF0C;interrupt&amp;#xFF0C;isochronous&amp;#x3002;&amp;#x6240;&amp;#x8C13;&amp;#x7684;pipe&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6307;&amp;#x5B9A;&amp;#x4E86;&amp;#x7684;&amp;#x76EE;&amp;#x7684;ep&amp;#xFF0C;&amp;#x5F88;&amp;#x5F62;&amp;#x8C61;&amp;#x7684;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x60F3;&amp;#x8C61;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x7BA1;&amp;#x9053;&amp;#x3002;&amp;#x8868;&amp;#x5F81;&amp;#x8D77;&amp;#x6765;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;int&amp;#x7C7B;&amp;#x578B;&amp;#xFF0C;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x76EE;&amp;#x7684;ep&amp;#x4FE1;&amp;#x606F;&amp;#xFF08;8&amp;#x4F4D;&amp;#xFF09;&amp;#x548C;&amp;#x4E00;&amp;#x4E9B;&amp;#x5176;&amp;#x4ED6;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. USB sysfs&amp;#x540D;&amp;#x5B57;&amp;#x89E3;&amp;#x6790;&lt;/div&gt;&lt;div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/USB&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;/sysfs&amp;#x547D;&amp;#x540D;.jpg&#34; hash=&#34;364251971225dd3ebb0a891194318f2e&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;div&gt;sysfs&amp;#x4E2D;&amp;#x53EA;&amp;#x663E;&amp;#x793A;&amp;#x4E86;&amp;#x548C;&amp;#x5F53;&amp;#x524D;&amp;#x914D;&amp;#x7F6E;&amp;#x548C;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x53EF;&amp;#x9009;&amp;#x7684;&amp;#x5176;&amp;#x4ED6;&amp;#x914D;&amp;#x7F6E;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x67E5;&amp;#x770B;usbfs(/proc/bus/usb)&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4. 1&amp;#xFF09;USB&amp;#x8BBE;&amp;#x5907;&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x901A;&amp;#x4FE1;&amp;#x901A;&amp;#x8FC7;urb&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x79CD;&amp;#x5F02;&amp;#x6B65;&amp;#x901A;&amp;#x4FE1;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x540C;&amp;#x6B65;&amp;#x901A;&amp;#x4FE1;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x5373;&amp;#x7ED5;&amp;#x5F00;urb&amp;#x76F4;&amp;#x63A5;&amp;#x4F20;&amp;#x8F93;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x540C;&amp;#x6B65;&amp;#x65B9;&amp;#x5F0F;&amp;#x53EA;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x53EF;&amp;#x4EE5;&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x5206;&amp;#x522B;&amp;#x4E3A;usb_bulk_msg&amp;#x548C;usb_control_msg&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; 2&amp;#xFF09;&amp;#x63A7;&amp;#x5236;&amp;#xFF0C;&amp;#x4E2D;&amp;#x65AD;&amp;#xFF0C;&amp;#x6279;&amp;#x91CF;&amp;#xFF0C;&amp;#x7B49;&amp;#x65F6;&amp;#x56DB;&amp;#x79CD;urb&amp;#x53EA;&amp;#x6709;&amp;#x7B49;&amp;#x65F6;urb&amp;#x9700;&amp;#x8981;&amp;#x81EA;&amp;#x5DF1;&amp;#x624B;&amp;#x52A8;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;&amp;#x5747;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x5F62;&amp;#x4E3A;usb_fill_xxx_urb&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x4F5C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&amp;#xA0; &amp;#xA0; 3&amp;#xFF09;&amp;#x901A;&amp;#x8FC7;usb_submit_urb&amp;#x6765;&amp;#x63D0;&amp;#x4EA4;urb&amp;#x7ED9;USB core&amp;#x3002;urb&amp;#x88AB;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x540E;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;urb&amp;#x6CE8;&amp;#x518C;&amp;#x7684;complete&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x505A;&amp;#x7ED3;&amp;#x675F;&amp;#x5DE5;&amp;#x4F5C;&amp;#x3002;&lt;/div&gt;&lt;div&gt;5. usb_driver&amp;#x901A;&amp;#x8FC7;usb_device_id&amp;#x6570;&amp;#x7EC4;&amp;#x544A;&amp;#x8BC9;USB core&amp;#xFF0C;&amp;#x672C;&amp;#x9A71;&amp;#x52A8;&amp;#x652F;&amp;#x6301;&amp;#x4EC0;&amp;#x4E48;&amp;#x6837;&amp;#x7684;USB&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&amp;#x5F53;&amp;#x6709;&amp;#x8BBE;&amp;#x5907;&amp;#x63D2;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;USB core&amp;#x6765;&amp;#x5224;&amp;#x65AD;&amp;#x54EA;&amp;#x4E2A;&amp;#x9A71;&amp;#x52A8;&amp;#x652F;&amp;#x6301;&amp;#x8BE5;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x627E;&amp;#x5230;&amp;#x4E86;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;usb_driver-&amp;gt;probe&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&amp;#x5E76;&amp;#x5728;&amp;#x9000;&amp;#x51FA;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;disconnect&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;6. &amp;#x4E3A;&amp;#x4E86;&amp;#x4F7F;&amp;#x7528;&amp;#x4F20;&amp;#x7EDF;&amp;#x7684;&amp;#x5B57;&amp;#x7B26;&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x8C03;&amp;#x7528;usb_register_dev&amp;#x6765;&amp;#x6CE8;&amp;#x518C;USB&amp;#x8BBE;&amp;#x5907;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://blog.zhougy.top/2012/08/27/vmalloc%E5%88%86%E6%9E%90/</guid>
            <title>vmalloc分析</title>
            <link>https://blog.zhougy.top/2012/08/27/vmalloc%E5%88%86%E6%9E%90/</link>
            <category>Linux</category>
            <category>内存管理</category>
            <pubDate>Mon, 27 Aug 2012 11:11:07 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;enNote&#34; style=&#34;word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;&#34; title lang xml:lang dir&gt;&lt;div style=&#34;font-size: 19px;&#34;&gt;&lt;b&gt;&lt;font color=&#34;#FF0000&#34;&gt;vmalloc&amp;#x8C03;&amp;#x7528;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&#34;font-size: 19px;&#34;&gt;&lt;b&gt;&lt;font color=&#34;#FF0000&#34;&gt;&lt;br&gt;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&#34;text-align: center;font-size: 19px;&#34;&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/vmalloc&amp;#x5206;&amp;#x6790;/1537085035259&#34; hash=&#34;2cd4dae44d544b480f792d9950ec22db&#34; align alt longdesc width height border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt;&lt;img class=&#34;enMedia&#34; src=&#34;/images/vmalloc&amp;#x5206;&amp;#x6790;/1537085035251&#34; hash=&#34;2810b6dc987813d10c985f2fd6462c76&#34; align alt longdesc width=&#34;766&#34; height=&#34;312&#34; border hspace vspace usemap style=&#34;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;&#34; title lang xml:lang dir&gt;&lt;/div&gt; ]]></description>
        </item>
    </channel>
</rss>
